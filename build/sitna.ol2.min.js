!function(e,t,n){function r(e,t){return typeof e===t}function i(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):d?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function s(){var e=t.body;return e||((e=i(d?"svg":"body")).fake=!0),e}function o(e,n,r,o){var a,l,c,u,p="modernizr",d=i("div"),f=s();if(parseInt(r,10))for(;r--;)(c=i("div")).id=o?o[r]:p+(r+1),d.appendChild(c);return(a=i("style")).type="text/css",a.id="s"+p,(f.fake?f:d).appendChild(a),f.appendChild(d),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),d.id=p,f.fake&&(f.style.background="",f.style.overflow="hidden",u=h.style.overflow,h.style.overflow="hidden",h.appendChild(f)),l=n(d,e),f.fake?(f.parentNode.removeChild(f),h.style.overflow=u,h.offsetHeight):d.parentNode.removeChild(d),!!l}var a=[],l={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){a.push({name:e,fn:t,options:n})},addAsyncTest:function(e){a.push({name:null,fn:e})}},c=function(){};c.prototype=l,(c=new c).addTest("urlparser",function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}});var u=[],h=t.documentElement,p=l._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];l._prefixes=p;var d="svg"===h.nodeName.toLowerCase(),f=i("input"),y="search tel url email datetime date month week time datetime-local number range color".split(" "),m={};c.inputtypes=function(e){for(var n,r,i,s=e.length,o=0;s>o;o++)f.setAttribute("type",n=e[o]),(i="text"!==f.type&&"style"in f)&&(f.value="1)",f.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(n)&&void 0!==f.style.WebkitAppearance?(h.appendChild(f),i=(r=t.defaultView).getComputedStyle&&"textfield"!==r.getComputedStyle(f,null).WebkitAppearance&&0!==f.offsetHeight,h.removeChild(f)):/^(search|tel)$/.test(n)||(i=/^(url|email)$/.test(n)?f.checkValidity&&!1===f.checkValidity():"1)"!=f.value)),m[e[o]]=!!i;return m}(y);var g=function(){var t=e.matchMedia||e.msMatchMedia;return t?function(e){var n=t(e);return n&&n.matches||!1}:function(t){var n=!1;return o("@media "+t+" { #modernizr { position: absolute; } }",function(t){n="absolute"==(e.getComputedStyle?e.getComputedStyle(t,null):t.currentStyle).position}),n}}();l.mq=g;var C=l.testStyles=o;c.addTest("touchevents",function(){var n;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)n=!0;else{var r=["@media (",p.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");C(r,function(e){n=9===e.offsetTop})}return n}),c.addTest("canvas",function(){var e=i("canvas");return!(!e.getContext||!e.getContext("2d"))}),function(){var e,t,n,i,s,o;for(var l in a)if(a.hasOwnProperty(l)){if(e=[],(t=a[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(i=r(t.fn,"function")?t.fn():t.fn,s=0;s<e.length;s++)1===(o=e[s].split(".")).length?c[o[0]]=i:(!c[o[0]]||c[o[0]]instanceof Boolean||(c[o[0]]=new Boolean(c[o[0]])),c[o[0]][o[1]]=i),u.push((i?"":"no-")+o.join("-"))}}(),delete l.addTest,delete l.addAsyncTest;for(var v=0;v<c._q.length;v++)c._q[v]();e.Modernizr=c}(window,document);!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function c(e,t){if(e)return"function"==typeof e&&e.template?e.template:n.isTemplateFn(e)?e:!1!==t?n.cache[e]:void 0}function o(e,t,r){if(!e)return t.setError(new Error("No template or template name provided to render"));var s=c(e,n.config.cache);return s?s(t,i.wrap(r,s.templateName)):n.onLoad?t.map(function(t){function s(e,s){var a;if(e)return t.setError(e);if(!(a=c(s,!1)||c(o,n.config.cache))){if(!n.compile)return t.setError(new Error("Dust compiler not available"));a=n.loadSource(n.compile(s,o))}a(t,i.wrap(r,a.templateName)).end()}var o=e;3===n.onLoad.length?n.onLoad(o,r.options,s):n.onLoad(o,s)}):t.setError(new Error("Template Not Found: "+e))}function i(e,t,n,r,i){void 0===e||e instanceof l||(e=new l(e));this.stack=e;this.global=t;this.options=n;this.blocks=r;this.templateName=i}function k(e,t,n){return function(r){return e.push(r)._get(t,n)}}function l(e,t,n,r){this.tail=t;this.isObject=e&&"object"==typeof e;this.head=e;this.index=n;this.of=r}function a(e){this.head=new t(this);this.callback=e;this.out=""}function e(){this.head=new t(this)}function t(e,t,n){this.root=e;this.next=t;this.data=[];this.flushable=!1;this.taps=n}function s(e,t){this.head=e;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=y;n.log=function(e,i){r[i=i||v]>=r[n.debugLevel]&&t("[DUST:"+i+"]",e)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(e,t){e&&(t.templateName=e,!1!==n.config.cache&&(n.cache[e]=t))};n.render=function(e,t,n){var r=new a(n).head;try{o(e,r,t).end()}catch(e){r.setError(e)}};n.stream=function(t,r){var i=new e,s=i.head;return n.nextTick(function(){try{o(t,s,r).end()}catch(e){s.setError(e)}}),i};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.nextTick=function(e){setTimeout(e,0)};n.isEmpty=function(e){return 0!==e&&(!(!n.isArray(e)||e.length)||!e)};n.isEmptyObject=function(e){var t;if(null===e||void 0===e||e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0};n.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody};n.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then};n.isStreamable=function(e){return e&&"function"==typeof e.on};n.filter=function(e,t,r){var i,s,o;if(r)for(i=0,s=r.length;s>i;i++)"s"===(o=r[i])?t=null:"function"==typeof n.filters[o]?e=n.filters[o](e):n.log("Invalid filter `"+o+"`",u);return t&&(e=n.filters[t](e)),e};n.filters={h:function(e){return n.escapeHtml(e)},j:function(e){return n.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return n.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(n.log("JSON is undefined; could not parse `"+e+"`",u),e)}};n.makeBase=n.context=function(e,t){return new i(void 0,e,t)};i.wrap=function(e,t){return e instanceof i?e:new i(e,{},{},null,t)};i.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)};i.prototype._get=function(e,t){var i,s,o,a,l,c=this.stack||{},u=1;if(s=t[0],o=t.length,e&&0===o)a=c,c=c.head;else{if(e)c&&(c=c.head?c.head[s]:void 0);else{for(;c&&(!c.isObject||(a=c.head,void 0===(i=c.head[s])));)c=c.tail;c=void 0!==i?i:this.global&&this.global[s]}for(;c&&o>u;){if(n.isThenable(c))return c.then(k(this,e,t.slice(u)));a=c;c=c[t[u]];u++}}return"function"==typeof c?((l=function(){try{return c.apply(a,arguments)}catch(e){throw n.log(e,r),e}}).__dustBody=!!c.__dustBody,l):(void 0===c&&n.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",v),c)};i.prototype.getPath=function(e,t){return this._get(e,t)};i.prototype.push=function(e,t,r){return void 0===e?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(e,this.stack,t,r))};i.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e};i.prototype.rebase=function(e){return new i(e,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(e){var r,i,s;if("function"==typeof e&&(e=e(new t,this).data.join("")),!(r=this.blocks))return n.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",f),!1;for(i=r.length;i--;)if(s=r[i][e])return s;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(e){var n;return"function"!=typeof e?e:(n=(new t).render(e,this))instanceof t?n.data.join(""):n};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),n.log("Rendering failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.out+=e.data.join("");e=e.next;this.head=e}this.callback(null,this.out)};e.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),n.log("Streaming failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.emit("data",e.data.join(""));e=e.next;this.head=e}this.emit("end")};e.prototype.emit=function(e,t){var r,i,s=(this.events||{})[e]||[];if(!s.length)return n.log("Stream broadcasting, but no listeners for `"+e+"`",f),!1;for(r=0,i=(s=s.slice(0)).length;i>r;r++)s[r](t);return!0};e.prototype.on=function(e,t){var r=this.events=this.events||{},i=r[e]=r[e]||[];return"function"!=typeof t?n.log("No callback function provided for `"+e+"` event listener",u):i.push(t),this};e.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return n.log("Incompatible stream passed to `pipe`",u),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(i){if(!t)try{e.write(i,"utf8")}catch(e){n.log(e,r)}}).on("end",function(){if(!t)try{e.end();t=!0}catch(e){n.log(e,r)}})};t.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this};t.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(e){var i=new t(this.root,this.next,this.taps),s=new t(this.root,i,this.taps);this.next=s;this.flushable=!0;try{e(s)}catch(e){n.log(e,r);s.setError(e)}return i};t.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new s(e),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(e,t){return e(this,t)};t.prototype.reference=function(e,r,i,s){return"function"==typeof e?(e=e.apply(r.current(),[this,r,null,{auto:i,filters:s}]))instanceof t?e:this.reference(e,r,i,s):n.isThenable(e)?this.await(e,r,null,i,s):n.isStreamable(e)?this.stream(e,r,null,i,s):n.isEmpty(e)?this:this.write(n.filter(e,i,s))};t.prototype.section=function(e,i,s,o){var a,l,c,u=s.block,h=s.else,p=this;if("function"==typeof e&&!n.isTemplateFn(e)){try{e=e.apply(i.current(),[this,i,s,o])}catch(e){return n.log(e,r),this.setError(e)}if(e instanceof t)return e}if(n.isEmptyObject(o)||(i=i.push(o)),n.isArray(e)){if(u){if((l=e.length)>0){for((c=i.stack&&i.stack.head||{}).$len=l,a=0;l>a;a++)c.$idx=a,p=u(p,i.push(e[a],a,l));return c.$idx=void 0,c.$len=void 0,p}if(h)return h(this,i)}}else{if(n.isThenable(e))return this.await(e,i,s);if(n.isStreamable(e))return this.stream(e,i,s);if(!0===e){if(u)return u(this,i)}else if(e||0===e){if(u)return u(this,i.push(e))}else if(h)return h(this,i)}return n.log("Section without corresponding key in template `"+i.getTemplateName()+"`",f),this};t.prototype.exists=function(e,t,r){var i=r.block,s=r.else;if(n.isEmpty(e)){if(s)return s(this,t)}else{if(i)return i(this,t);n.log("No block for exists check in template `"+t.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(e,t,r){var i=r.block,s=r.else;if(n.isEmpty(e)){if(i)return i(this,t);n.log("No block for not-exists check in template `"+t.getTemplateName()+"`",f)}else if(s)return s(this,t);return this};t.prototype.block=function(e,t,n){var r=e||n.block;return r?r(this,t):this};t.prototype.partial=function(e,t,r,i){var s;return void 0===i&&(i=r,r=t),n.isEmptyObject(i)||(s=(r=r.clone()).pop(),r=r.push(i).push(s)),n.isTemplateFn(e)?this.capture(e,t,function(e,t){r.templateName=e;o(e,t,r).end()}):(r.templateName=e,o(e,this,r))};t.prototype.helper=function(e,t,i,s){var o,a=this;if(!n.helpers[e])return n.log("Helper `"+e+"` does not exist",u),a;try{return o=n.helpers[e](a,t,i,s),n.isThenable(o)?this.await(o,t,i):o}catch(t){return n.log("Error in helper `"+e+"`: "+t.message,r),a.setError(t)}};t.prototype.await=function(e,t,r,i,s){var o=r&&r.block,a=r&&r.error;return this.map(function(r){e.then(function(e){o?r.render(o,t.push(e)).end():r.reference(e,t,i,s).end()},function(e){a?r.render(a,t.push(e)).end():(n.log("Unhandled promise rejection in `"+t.getTemplateName()+"`"),r.end())})})};t.prototype.stream=function(e,t,r,i,s){var o=r&&r.block,a=r&&r.error;return this.map(function(r){var l=!1;e.on("data",function(e){l||(r=o?r.map(function(n){n.render(o,t.push(e)).end()}):r.reference(e,t,i,s))}).on("error",function(e){l||(a?r.render(a,t.push(e)):n.log("Unhandled stream error in `"+t.getTemplateName()+"`"),l||(l=!0,r.end()))}).on("end",function(){l||(l=!0,r.end())})})};t.prototype.capture=function(e,t,n){return this.map(function(r){var i=new a(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})};t.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(e){return new s(e,this)};s.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),g.test(e)?e.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):e):e};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(e){return"string"==typeof e?e.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):e},n.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+e+"`",u),e)},n}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t,n,r,i,s){this.message=e;this.expected=t;this.found=n;this.offset=r;this.line=i;this.column=s;this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype;e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){function n(e){return yn!==e&&(yn>e&&(yn=0,mn={line:1,column:1,seenCR:!1}),function(e,n,r){for(var i,s=n;r>s;s++)"\n"===(i=t.charAt(s))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(mn,yn,e),yn=e),mn}function r(e){gn>dn||(dn>gn&&(gn=dn,Cn=[]),Cn.push(e))}function i(r,i,s){var o=n(s),a=s<t.length?t.charAt(s):null;return null!==i&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(i),new e(null!==r?r:function(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r].description;return"Expected "+(e.length>1?n.slice(0,-1).join(", ")+" or "+n[e.length-1]:n[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(i,a),i,a,s,o.line,o.column)}function s(){return o()}function o(){var e,t,n;for(e=dn,t=[],n=a();n!==U;)t.push(n),n=a();return t!==U&&(fn=e,t=H(t)),t}function a(){var e;return(e=_())===U&&(e=N())===U&&(e=function(){var e,n,i,s,a,u,h;if(vn++,e=dn,(n=l())!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();i!==U&&(s=k())!==U&&(a=o())!==U&&(u=p())!==U?((h=c())===U&&(h=V),h!==U?(fn=dn,($(n,a,u,h)?Y:z)!==U?(fn=e,n=X(n,a,u,h),e=n):(dn=e,e=z)):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;if(e===U)if(e=dn,(n=l())!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();i!==U?(47===t.charCodeAt(dn)?(s=K,dn++):(s=U,0===vn&&r(J)),s!==U&&(a=k())!==U?(fn=e,n=Q(n),e=n):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(W)),e}())===U&&(e=function(){var e,n,i,s,o,a,l,c,p;if(vn++,e=dn,(n=I())!==U)if(62===t.charCodeAt(dn)?(i=Ce,dn++):(i=U,0===vn&&r(ve)),i===U&&(43===t.charCodeAt(dn)?(i=Te,dn++):(i=U,0===vn&&r(Le))),i!==U){for(s=[],o=D();o!==U;)s.push(o),o=D();if(s!==U)if(o=dn,(a=b())!==U&&(fn=o,a=Se(a)),(o=a)===U&&(o=O()),o!==U)if((a=u())!==U)if((l=h())!==U){for(c=[],p=D();p!==U;)c.push(p),p=D();c!==U?(47===t.charCodeAt(dn)?(p=K,dn++):(p=U,0===vn&&r(J)),p!==U&&k()!==U?(fn=e,n=be(i,o,a,l),e=n):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;else dn=e,e=z;else dn=e,e=z;else dn=e,e=z}else dn=e,e=z;else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(ge)),e}())===U&&(e=y())===U&&(e=d())===U&&(e=function(){var e,n,i,s,o,a,l,c;if(vn++,e=dn,(n=R())!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();i!==U?(fn=e,n=Tt(n,i),e=n):(dn=e,e=z)}else dn=e,e=z;if(e===U){if(e=dn,n=[],i=dn,s=dn,vn++,o=M(),vn--,o===U?s=Y:(dn=s,s=z),s!==U?(o=dn,vn++,a=_(),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(a=dn,vn++,l=N(),vn--,l===U?a=Y:(dn=a,a=z),a!==U?(l=dn,vn++,c=R(),vn--,c===U?l=Y:(dn=l,l=z),l!==U?(t.length>dn?(c=t.charAt(dn),dn++):(c=U,0===vn&&r(Lt)),c!==U?(fn=i,s=St(c),i=s):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z),i!==U)for(;i!==U;)n.push(i),i=dn,s=dn,vn++,o=M(),vn--,o===U?s=Y:(dn=s,s=z),s!==U?(o=dn,vn++,a=_(),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(a=dn,vn++,l=N(),vn--,l===U?a=Y:(dn=a,a=z),a!==U?(l=dn,vn++,c=R(),vn--,c===U?l=Y:(dn=l,l=z),l!==U?(t.length>dn?(c=t.charAt(dn),dn++):(c=U,0===vn&&r(Lt)),c!==U?(fn=i,s=St(c),i=s):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z);else n=z;n!==U&&(fn=e,n=bt(n));e=n}return vn--,e===U&&(n=U,0===vn&&r(vt)),e}()),e}function l(){var e,n,i,s,o,a;if(e=dn,I()!==U)if(Z.test(t.charAt(dn))?(n=t.charAt(dn),dn++):(n=U,0===vn&&r(ee)),n!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();i!==U&&(s=m())!==U&&(o=u())!==U&&(a=h())!==U?(fn=e,e=te(n,s,o,a)):(dn=e,e=z)}else dn=e,e=z;else dn=e,e=z;return e}function c(){var e,n,i,s,o,a;if(vn++,e=dn,I()!==U)if(47===t.charCodeAt(dn)?(n=K,dn++):(n=U,0===vn&&r(J)),n!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();if(i!==U)if((s=m())!==U){for(o=[],a=D();a!==U;)o.push(a),a=D();o!==U&&(a=k())!==U?(fn=e,e=re(s)):(dn=e,e=z)}else dn=e,e=z;else dn=e,e=z}else dn=e,e=z;else dn=e,e=z;return vn--,e===U&&0===vn&&r(ne),e}function u(){var e,n,i,s;return e=dn,n=dn,58===t.charCodeAt(dn)?(i=ie,dn++):(i=U,0===vn&&r(se)),i!==U&&(s=m())!==U?(fn=n,n=i=oe(s)):(dn=n,n=z),n===U&&(n=V),n!==U&&(fn=e,n=ae(n)),n}function h(){var e,n,i,s,o,a,l;if(vn++,e=dn,n=[],i=dn,s=[],(o=D())!==U)for(;o!==U;)s.push(o),o=D();else s=z;for(s!==U&&(o=b())!==U?(61===t.charCodeAt(dn)?(a=ce,dn++):(a=U,0===vn&&r(ue)),a!==U?((l=g())===U&&(l=m())===U&&(l=O()),l!==U?(fn=i,i=s=he(o,l)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z);i!==U;){if(n.push(i),i=dn,s=[],(o=D())!==U)for(;o!==U;)s.push(o),o=D();else s=z;s!==U&&(o=b())!==U?(61===t.charCodeAt(dn)?(a=ce,dn++):(a=U,0===vn&&r(ue)),a!==U?((l=g())===U&&(l=m())===U&&(l=O()),l!==U?(fn=i,i=s=he(o,l)):(dn=i,i=z)):(dn=i,i=z)):(dn=i,i=z)}return n!==U&&(fn=e,n=pe(n)),vn--,(e=n)===U&&(n=U,0===vn&&r(le)),e}function p(){var e,n,i,s,a,l;for(vn++,e=dn,n=[],i=dn,I()!==U?(58===t.charCodeAt(dn)?(s=ie,dn++):(s=U,0===vn&&r(se)),s!==U&&(a=b())!==U&&k()!==U&&(l=o())!==U?(fn=i,i=he(a,l)):(dn=i,i=z)):(dn=i,i=z);i!==U;)n.push(i),i=dn,I()!==U?(58===t.charCodeAt(dn)?(s=ie,dn++):(s=U,0===vn&&r(se)),s!==U&&(a=b())!==U&&k()!==U&&(l=o())!==U?(fn=i,i=he(a,l)):(dn=i,i=z)):(dn=i,i=z);return n!==U&&(fn=e,n=fe(n)),vn--,(e=n)===U&&(n=U,0===vn&&r(de)),e}function d(){var e,t,n;return vn++,e=dn,I()!==U&&(t=m())!==U&&(n=f())!==U&&k()!==U?(fn=e,e=me(t,n)):(dn=e,e=z),vn--,e===U&&0===vn&&r(ye),e}function f(){var e,n,i,s,o;for(vn++,e=dn,n=[],i=dn,124===t.charCodeAt(dn)?(s=Ee,dn++):(s=U,0===vn&&r(Oe)),s!==U&&(o=b())!==U?(fn=i,i=s=oe(o)):(dn=i,i=z);i!==U;)n.push(i),i=dn,124===t.charCodeAt(dn)?(s=Ee,dn++):(s=U,0===vn&&r(Oe)),s!==U&&(o=b())!==U?(fn=i,i=s=oe(o)):(dn=i,i=z);return n!==U&&(fn=e,n=Ae(n)),vn--,(e=n)===U&&(n=U,0===vn&&r(we)),e}function y(){var e,n,i;return vn++,e=dn,I()!==U?(126===t.charCodeAt(dn)?(n=Pe,dn++):(n=U,0===vn&&r(_e)),n!==U&&(i=b())!==U&&k()!==U?(fn=e,e=Ne(i)):(dn=e,e=z)):(dn=e,e=z),vn--,e===U&&0===vn&&r(xe),e}function m(){var e,t;return vn++,e=dn,(t=S())!==U&&(fn=e,t=Ie(t)),(e=t)===U&&(e=dn,(t=b())!==U&&(fn=e,t=ke(t)),e=t),vn--,e===U&&(t=U,0===vn&&r(Me)),e}function g(){var e,t;return vn++,e=dn,(t=C())===U&&(t=L()),t!==U&&(fn=e,t=De(t)),vn--,(e=t)===U&&(t=U,0===vn&&r(Re)),e}function C(){var e,n,i,s;return vn++,e=dn,(n=L())!==U?(46===t.charCodeAt(dn)?(i=Be,dn++):(i=U,0===vn&&r(je)),i!==U&&(s=v())!==U?(fn=e,e=n=Ue(n,s)):(dn=e,e=z)):(dn=e,e=z),vn--,e===U&&(n=U,0===vn&&r(Fe)),e}function v(){var e,n,i;if(vn++,e=dn,n=[],qe.test(t.charAt(dn))?(i=t.charAt(dn),dn++):(i=U,0===vn&&r(He)),i!==U)for(;i!==U;)n.push(i),qe.test(t.charAt(dn))?(i=t.charAt(dn),dn++):(i=U,0===vn&&r(He));else n=z;return n!==U&&(fn=e,n=We(n)),vn--,(e=n)===U&&(n=U,0===vn&&r(Ge)),e}function T(){var e,n,i;return vn++,e=dn,45===t.charCodeAt(dn)?(n=Ve,dn++):(n=U,0===vn&&r($e)),n!==U&&(i=v())!==U?(fn=e,e=n=Ye(n,i)):(dn=e,e=z),vn--,e===U&&(n=U,0===vn&&r(ze)),e}function L(){var e;return vn++,(e=T())===U&&(e=v()),vn--,e===U&&0===vn&&r(Xe),e}function S(){var e,n,i,s;if(vn++,e=dn,(n=b())===U&&(n=V),n!==U){if(i=[],(s=E())===U&&(s=w()),s!==U)for(;s!==U;)i.push(s),(s=E())===U&&(s=w());else i=z;i!==U?(fn=e,e=n=Je(n,i)):(dn=e,e=z)}else dn=e,e=z;if(e===U)if(e=dn,46===t.charCodeAt(dn)?(n=Be,dn++):(n=U,0===vn&&r(je)),n!==U){for(i=[],(s=E())===U&&(s=w());s!==U;)i.push(s),(s=E())===U&&(s=w());i!==U?(fn=e,e=n=Qe(i)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(Ke)),e}function b(){var e,n,i,s;if(vn++,e=dn,et.test(t.charAt(dn))?(n=t.charAt(dn),dn++):(n=U,0===vn&&r(tt)),n!==U){for(i=[],nt.test(t.charAt(dn))?(s=t.charAt(dn),dn++):(s=U,0===vn&&r(rt));s!==U;)i.push(s),nt.test(t.charAt(dn))?(s=t.charAt(dn),dn++):(s=U,0===vn&&r(rt));i!==U?(fn=e,e=n=it(n,i)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(Ze)),e}function w(){var e,n,i,s,o,a;if(vn++,e=dn,n=dn,(i=function(){var e;return 91===t.charCodeAt(dn)?(e=Kt,dn++):(e=U,0===vn&&r(Jt)),e}())!==U){if(s=dn,o=[],qe.test(t.charAt(dn))?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(He)),a!==U)for(;a!==U;)o.push(a),qe.test(t.charAt(dn))?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(He));else o=z;o!==U&&(fn=s,o=ot(o));(s=o)===U&&(s=m());s!==U&&(o=function(){var e;return 93===t.charCodeAt(dn)?(e=Qt,dn++):(e=U,0===vn&&r(Zt)),e}())!==U?(fn=n,n=i=at(s)):(dn=n,n=z)}else dn=n,n=z;return n!==U?((i=E())===U&&(i=V),i!==U?(fn=e,e=n=lt(n,i)):(dn=e,e=z)):(dn=e,e=z),vn--,e===U&&(n=U,0===vn&&r(st)),e}function E(){var e,n,i,s,o;if(vn++,e=dn,n=[],i=dn,46===t.charCodeAt(dn)?(s=Be,dn++):(s=U,0===vn&&r(je)),s!==U&&(o=b())!==U?(fn=i,i=s=ut(o)):(dn=i,i=z),i!==U)for(;i!==U;)n.push(i),i=dn,46===t.charCodeAt(dn)?(s=Be,dn++):(s=U,0===vn&&r(je)),s!==U&&(o=b())!==U?(fn=i,i=s=ut(o)):(dn=i,i=z);else n=z;return n!==U?((i=w())===U&&(i=V),i!==U?(fn=e,e=n=ht(n,i)):(dn=e,e=z)):(dn=e,e=z),vn--,e===U&&(n=U,0===vn&&r(ct)),e}function O(){var e,n,i,s;if(vn++,e=dn,34===t.charCodeAt(dn)?(n=dt,dn++):(n=U,0===vn&&r(ft)),n!==U?(34===t.charCodeAt(dn)?(i=dt,dn++):(i=U,0===vn&&r(ft)),i!==U?(fn=e,e=n=yt()):(dn=e,e=z)):(dn=e,e=z),e===U&&(e=dn,34===t.charCodeAt(dn)?(n=dt,dn++):(n=U,0===vn&&r(ft)),n!==U&&(i=x())!==U?(34===t.charCodeAt(dn)?(s=dt,dn++):(s=U,0===vn&&r(ft)),s!==U?(fn=e,e=n=mt(i)):(dn=e,e=z)):(dn=e,e=z),e===U))if(e=dn,34===t.charCodeAt(dn)?(n=dt,dn++):(n=U,0===vn&&r(ft)),n!==U){if(i=[],(s=A())!==U)for(;s!==U;)i.push(s),s=A();else i=z;i!==U?(34===t.charCodeAt(dn)?(s=dt,dn++):(s=U,0===vn&&r(ft)),s!==U?(fn=e,e=n=gt(i)):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(pt)),e}function A(){var e,t;return(e=y())===U&&(e=d())===U&&(e=dn,(t=x())!==U&&(fn=e,t=Ct(t)),e=t),e}function x(){var e,n,i,s,o;if(vn++,e=dn,n=[],i=dn,s=dn,vn++,o=M(),vn--,o===U?s=Y:(dn=s,s=z),s!==U?((o=P())===U&&(Et.test(t.charAt(dn))?(o=t.charAt(dn),dn++):(o=U,0===vn&&r(Ot))),o!==U?(fn=i,i=s=St(o)):(dn=i,i=z)):(dn=i,i=z),i!==U)for(;i!==U;)n.push(i),i=dn,s=dn,vn++,o=M(),vn--,o===U?s=Y:(dn=s,s=z),s!==U?((o=P())===U&&(Et.test(t.charAt(dn))?(o=t.charAt(dn),dn++):(o=U,0===vn&&r(Ot))),o!==U?(fn=i,i=s=St(o)):(dn=i,i=z)):(dn=i,i=z);else n=z;return n!==U&&(fn=e,n=At(n)),vn--,(e=n)===U&&(n=U,0===vn&&r(wt)),e}function P(){var e,n;return e=dn,t.substr(dn,2)===xt?(n=xt,dn+=2):(n=U,0===vn&&r(Pt)),n!==U&&(fn=e,n=_t()),n}function _(){var e,n,i,s,o,a;if(vn++,e=dn,t.substr(dn,2)===Mt?(n=Mt,dn+=2):(n=U,0===vn&&r(It)),n!==U){for(i=[],s=dn,o=dn,vn++,t.substr(dn,2)===kt?(a=kt,dn+=2):(a=U,0===vn&&r(Rt)),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(t.length>dn?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(Lt)),a!==U?(fn=s,s=o=Dt(a)):(dn=s,s=z)):(dn=s,s=z);s!==U;)i.push(s),s=dn,o=dn,vn++,t.substr(dn,2)===kt?(a=kt,dn+=2):(a=U,0===vn&&r(Rt)),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(t.length>dn?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(Lt)),a!==U?(fn=s,s=o=Dt(a)):(dn=s,s=z)):(dn=s,s=z);i!==U?(t.substr(dn,2)===kt?(s=kt,dn+=2):(s=U,0===vn&&r(Rt)),s!==U?(fn=e,e=n=Ft(i)):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(Nt)),e}function N(){var e,n,i,s,o,a;if(vn++,e=dn,t.substr(dn,2)===jt?(n=jt,dn+=2):(n=U,0===vn&&r(Ut)),n!==U){for(i=[],s=dn,o=dn,vn++,t.substr(dn,2)===Gt?(a=Gt,dn+=2):(a=U,0===vn&&r(qt)),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(t.length>dn?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(Lt)),a!==U?(fn=s,s=o=St(a)):(dn=s,s=z)):(dn=s,s=z);s!==U;)i.push(s),s=dn,o=dn,vn++,t.substr(dn,2)===Gt?(a=Gt,dn+=2):(a=U,0===vn&&r(qt)),vn--,a===U?o=Y:(dn=o,o=z),o!==U?(t.length>dn?(a=t.charAt(dn),dn++):(a=U,0===vn&&r(Lt)),a!==U?(fn=s,s=o=St(a)):(dn=s,s=z)):(dn=s,s=z);i!==U?(t.substr(dn,2)===Gt?(s=Gt,dn+=2):(s=U,0===vn&&r(qt)),s!==U?(fn=e,e=n=Ht(i)):(dn=e,e=z)):(dn=e,e=z)}else dn=e,e=z;return vn--,e===U&&(n=U,0===vn&&r(Bt)),e}function M(){var e,n,i,s,o,a,l,c,u,h;if(e=dn,(n=I())!==U){for(i=[],s=D();s!==U;)i.push(s),s=D();if(i!==U)if(Wt.test(t.charAt(dn))?(s=t.charAt(dn),dn++):(s=U,0===vn&&r(zt)),s!==U){for(o=[],a=D();a!==U;)o.push(a),a=D();if(o!==U){if(a=[],l=dn,c=dn,vn++,u=k(),vn--,u===U?c=Y:(dn=c,c=z),c!==U?(u=dn,vn++,h=R(),vn--,h===U?u=Y:(dn=u,u=z),u!==U?(t.length>dn?(h=t.charAt(dn),dn++):(h=U,0===vn&&r(Lt)),h!==U?l=c=[c,u,h]:(dn=l,l=z)):(dn=l,l=z)):(dn=l,l=z),l!==U)for(;l!==U;)a.push(l),l=dn,c=dn,vn++,u=k(),vn--,u===U?c=Y:(dn=c,c=z),c!==U?(u=dn,vn++,h=R(),vn--,h===U?u=Y:(dn=u,u=z),u!==U?(t.length>dn?(h=t.charAt(dn),dn++):(h=U,0===vn&&r(Lt)),h!==U?l=c=[c,u,h]:(dn=l,l=z)):(dn=l,l=z)):(dn=l,l=z);else a=z;if(a!==U){for(l=[],c=D();c!==U;)l.push(c),c=D();l!==U&&(c=k())!==U?e=n=[n,i,s,o,a,l,c]:(dn=e,e=z)}else dn=e,e=z}else dn=e,e=z}else dn=e,e=z;else dn=e,e=z}else dn=e,e=z;return e===U&&(e=d()),e}function I(){var e;return 123===t.charCodeAt(dn)?(e=Vt,dn++):(e=U,0===vn&&r($t)),e}function k(){var e;return 125===t.charCodeAt(dn)?(e=Yt,dn++):(e=U,0===vn&&r(Xt)),e}function R(){var e;return 10===t.charCodeAt(dn)?(e=en,dn++):(e=U,0===vn&&r(tn)),e===U&&(t.substr(dn,2)===nn?(e=nn,dn+=2):(e=U,0===vn&&r(rn)),e===U&&(13===t.charCodeAt(dn)?(e=sn,dn++):(e=U,0===vn&&r(on)),e===U&&(8232===t.charCodeAt(dn)?(e=an,dn++):(e=U,0===vn&&r(ln)),e===U&&(8233===t.charCodeAt(dn)?(e=cn,dn++):(e=U,0===vn&&r(un)))))),e}function D(){var e;return hn.test(t.charAt(dn))?(e=t.charAt(dn),dn++):(e=U,0===vn&&r(pn)),e===U&&(e=R()),e}function F(e){return e.concat([["line",n(fn).line],["col",n(fn).column]])}var B,j=arguments.length>1?arguments[1]:{},U={},G={start:s},q=s,H=function(e){return F(["body"].concat(e))},W={type:"other",description:"section"},z=U,V=null,$=function(e,t,n,r){return r&&e[1].text===r.text||function(e){throw i(e,null,fn)}("Expected end tag for "+e[1].text+" but it was not found."),!0},Y=void 0,X=function(e,t,n){return n.push(["param",["literal","block"],t]),e.push(n),F(e)},K="/",J={type:"literal",value:"/",description:'"/"'},Q=function(e){return e.push(["bodies"]),F(e)},Z=/^[#?\^<+@%]/,ee={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},te=function(e,t,n,r){return[e,t,n,r]},ne={type:"other",description:"end tag"},re=function(e){return e},ie=":",se={type:"literal",value:":",description:'":"'},oe=function(e){return e},ae=function(e){return e?["context",e]:["context"]},le={type:"other",description:"params"},ce="=",ue={type:"literal",value:"=",description:'"="'},he=function(e,t){return["param",["literal",e],t]},pe=function(e){return["params"].concat(e)},de={type:"other",description:"bodies"},fe=function(e){return["bodies"].concat(e)},ye={type:"other",description:"reference"},me=function(e,t){return F(["reference",e,t])},ge={type:"other",description:"partial"},Ce=">",ve={type:"literal",value:">",description:'">"'},Te="+",Le={type:"literal",value:"+",description:'"+"'},Se=function(e){return["literal",e]},be=function(e,t,n,r){return F([">"===e?"partial":e,t,n,r])},we={type:"other",description:"filters"},Ee="|",Oe={type:"literal",value:"|",description:'"|"'},Ae=function(e){return["filters"].concat(e)},xe={type:"other",description:"special"},Pe="~",_e={type:"literal",value:"~",description:'"~"'},Ne=function(e){return F(["special",e])},Me={type:"other",description:"identifier"},Ie=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},ke=function(e){var t=["key",e];return t.text=e,t},Re={type:"other",description:"number"},De=function(e){return["literal",e]},Fe={type:"other",description:"float"},Be=".",je={type:"literal",value:".",description:'"."'},Ue=function(e,t){return parseFloat(e+"."+t)},Ge={type:"other",description:"unsigned_integer"},qe=/^[0-9]/,He={type:"class",value:"[0-9]",description:"[0-9]"},We=function(e){return function(e){return parseInt(e.join(""),10)}(e)},ze={type:"other",description:"signed_integer"},Ve="-",$e={type:"literal",value:"-",description:'"-"'},Ye=function(e,t){return-1*t},Xe={type:"other",description:"integer"},Ke={type:"other",description:"path"},Je=function(e,t){return t=t[0],e&&t?(t.unshift(e),F([!1,t])):F([!0,t])},Qe=function(e){return F(e.length>0?[!0,e[0]]:[!0,[]])},Ze={type:"other",description:"key"},et=/^[a-zA-Z_$]/,tt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},nt=/^[0-9a-zA-Z_$\-]/,rt={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},it=function(e,t){return e+t.join("")},st={type:"other",description:"array"},ot=function(e){return e.join("")},at=function(e){return e},lt=function(e,t){return t?t.unshift(e):t=[e],t},ct={type:"other",description:"array_part"},ut=function(e){return e},ht=function(e,t){return t?e.concat(t):e},pt={type:"other",description:"inline"},dt='"',ft={type:"literal",value:'"',description:'"\\""'},yt=function(){return F(["literal",""])},mt=function(e){return F(["literal",e])},gt=function(e){return F(["body"].concat(e))},Ct=function(e){return["buffer",e]},vt={type:"other",description:"buffer"},Tt=function(e,t){return F(["format",e,t.join("")])},Lt={type:"any",description:"any character"},St=function(e){return e},bt=function(e){return F(["buffer",e.join("")])},wt={type:"other",description:"literal"},Et=/^[^"]/,Ot={type:"class",value:'[^"]',description:'[^"]'},At=function(e){return e.join("")},xt='\\"',Pt={type:"literal",value:'\\"',description:'"\\\\\\""'},_t=function(){return'"'},Nt={type:"other",description:"raw"},Mt="{`",It={type:"literal",value:"{`",description:'"{`"'},kt="`}",Rt={type:"literal",value:"`}",description:'"`}"'},Dt=function(e){return e},Ft=function(e){return F(["raw",e.join("")])},Bt={type:"other",description:"comment"},jt="{!",Ut={type:"literal",value:"{!",description:'"{!"'},Gt="!}",qt={type:"literal",value:"!}",description:'"!}"'},Ht=function(e){return F(["comment",e.join("")])},Wt=/^[#?\^><+%:@\/~%]/,zt={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},Vt="{",$t={type:"literal",value:"{",description:'"{"'},Yt="}",Xt={type:"literal",value:"}",description:'"}"'},Kt="[",Jt={type:"literal",value:"[",description:'"["'},Qt="]",Zt={type:"literal",value:"]",description:'"]"'},en="\n",tn={type:"literal",value:"\n",description:'"\\n"'},nn="\r\n",rn={type:"literal",value:"\r\n",description:'"\\r\\n"'},sn="\r",on={type:"literal",value:"\r",description:'"\\r"'},an="\u2028",ln={type:"literal",value:"\u2028",description:'"\\u2028"'},cn="\u2029",un={type:"literal",value:"\u2029",description:'"\\u2029"'},hn=/^[\t\x0B\f \xA0\uFEFF]/,pn={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},dn=0,fn=0,yn=0,mn={line:1,column:1,seenCR:!1},gn=0,Cn=[],vn=0;if("startRule"in j){if(!(j.startRule in G))throw new Error("Can't start parsing from rule \""+j.startRule+'".');q=G[j.startRule]}if((B=q())!==U&&dn===t.length)return B;throw B!==U&&dn<t.length&&r({type:"end",description:"end of input"}),i(null,Cn,gn)}}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.compile",["dust.core","dust.parse"],function(e,n){return t(n,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){return h.filterNode({},e)}function r(e,t){for(var n,r=[t[0]],i=1,s=t.length;s>i;i++)(n=h.filterNode(e,t[i]))&&r.push(n);return r}function i(e,t){return t}function s(){}function o(e,n){var r,i={name:n,bodies:[],blocks:{},index:0,auto:"h"},s=t.escapeJs(n),o=n?'"'+s+'",':"",a="function(dust){",l=h.compileNode(i,e);return n&&(a+='dust.register("'+s+'",'+l+");"),r="("+(a+=function(e){var t,n=[],r=e.blocks;for(t in r)n.push('"'+t+'":'+r[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):(e.blocks="",e.blocks)}(i)+function(e){for(var t=[],n=e.bodies,r=e.blocks,i=0,s=n.length;s>i;i++)t[i]="function body_"+i+"(chk,ctx){"+r+"return chk"+n[i]+";}body_"+i+".__dustBody=!0;";return t.join("")}(i)+"return "+l+"}")+"(dust));",t.config.amd?"define("+o+'["dust.core"],'+a+");":t.config.cjs?"module.exports=function(dust){var tmpl="+r+"var f="+c().toString()+";f.template=tmpl;return f}":r}function a(e,t){for(var n="",r=1,i=t.length;i>r;r++)n+=h.compileNode(e,t[r]);return n}function l(e,n,r){return"."+(t._aliases[r]||r)+"("+h.compileNode(e,n[1])+","+h.compileNode(e,n[2])+","+h.compileNode(e,n[4])+","+h.compileNode(e,n[3])+")"}function c(e){return function(n,r){return t[r?"render":"stream"](e,n,r)}}var u,h={},p=t.isArray;h.compile=function(t,r){try{return o(n(e(t)),r)}catch(e){if(!e.line||!e.column)throw e;throw new SyntaxError(e.message+" At line : "+e.line+", column : "+e.column)}};h.filterNode=function(e,t){return h.optimizers[t[0]](e,t)};h.optimizers={body:function(e,t){for(var n,r,i=[t[0]],s=1,o=t.length;o>s;s++)(r=h.filterNode(e,t[s]))&&("buffer"===r[0]||"format"===r[0]?n?(n[0]="buffer"===r[0]?"buffer":n[0],n[1]+=r.slice(1,-2).join("")):(n=r,i.push(r)):(n=null,i.push(r)));return i},buffer:i,special:function(e,t){return["buffer",u[t[1]],t[2],t[3]]},format:function(e,n){return t.config.whitespace?(n.splice(1,2,n.slice(1,-2).join("")),n):null},reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:i,key:i,path:i,literal:i,raw:i,comment:s,line:s,col:s};h.pragmas={esc:function(e,t,n){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=a(e,n.block),e.auto=i,r}};u={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};h.compileNode=function(e,t){return h.nodes[t[0]](e,t)};h.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=a(e,t),r},buffer:function(e,t){return".w("+v(t[1])+")"},format:function(e,t){return".w("+v(t[1])+")"},reference:function(e,t){return".f("+h.compileNode(e,t[1])+",ctx,"+h.compileNode(e,t[2])+")"},"#":function(e,t){return l(e,t,"section")},"?":function(e,t){return l(e,t,"exists")},"^":function(e,t){return l(e,t,"notexists")},"<":function(e,t){for(var n,r=t[4],i=1,s=r.length;s>i;i++)if("block"===(n=r[i])[1][1])return e.blocks[t[1].text]=h.compileNode(e,n[2]),"";return""},"+":function(e,t){return void 0===t[1].text&&void 0===t[4]?".b(ctx.getBlock("+h.compileNode(e,t[1])+",chk, ctx),"+h.compileNode(e,t[2])+", {},"+h.compileNode(e,t[3])+")":".b(ctx.getBlock("+v(t[1].text)+"),"+h.compileNode(e,t[2])+","+h.compileNode(e,t[4])+","+h.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+v(t[1].text)+","+h.compileNode(e,t[2])+","+h.compileNode(e,t[4])+","+h.compileNode(e,t[3])+")"},"%":function(e,t){var n,r,i,s,o,a,l,c,u,p=t[1][1];if(!h.pragmas[p])return"";for(r={},c=1,u=(n=t[4]).length;u>c;c++)r[(a=n[c])[1][1]]=a[2];for(s={},c=1,u=(i=t[3]).length;u>c;c++)s[(l=i[c])[1][1]]=l[2][1];return o=t[2][1]?t[2][1].text:null,h.pragmas[p](e,o,r,s)},partial:function(e,t){return".p("+h.compileNode(e,t[1])+",ctx,"+h.compileNode(e,t[2])+","+h.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+h.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(h.compileNode(e,t[r]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(h.compileNode(e,t[r]));return"{"+n.join(",")+"}"},param:function(e,t){return h.compileNode(e,t[1])+":"+h.compileNode(e,t[2])},filters:function(e,t){for(var n,r=[],i=1,s=t.length;s>i;i++)n=t[i],r.push('"'+n+'"');return'"'+e.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],r=t[2],i=[],s=0,o=r.length;o>s;s++)i.push(p(r[s])?h.compileNode(e,r[s]):'"'+r[s]+'"');return"ctx.getPath("+n+", ["+i.join(",")+"])"},literal:function(e,t){return v(t[1])},raw:function(e,t){return".w("+v(t[1])+")"}};var d=/\\/g,f=/"/g,y=/\f/g,m=/\n/g,g=/\r/g,C=/\t/g,v="undefined"==typeof JSON?function(e){return'"'+function(e){return e.replace(d,"\\\\").replace(f,'\\"').replace(y,"\\f").replace(m,"\\n").replace(g,"\\r").replace(C,"\\t")}(e)+'"'}:JSON.stringify;return t.compiler=h,t.compile=t.compiler.compile,t.renderSource=function(e,n,r){return c(t.loadSource(t.compile(e)))(n,r)},t.compileFn=function(e,n){return c(t.loadSource(t.compile(e,n)))},t.filterNode=h.filterNode,t.optimizers=h.optimizers,t.pragmas=h.pragmas,t.compileNode=h.compileNode,t.nodes=h.nodes,h});"function"==typeof define&&define.amd&&!0===define.amd.dust&&define(["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,n){e([t],function(){n()})},t});!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define(["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,n,r){r=r||"INFO";t=t?"{@"+t+"}: ":"";e.log(t+n,r)}function n(e){u[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),u[e]=!0)}function r(e){return function(e){return e.stack.tail&&e.stack.tail.head&&void 0!==e.stack.tail.head.__select__}(e)&&e.get("__select__")}function i(e,t){var n,r,i=e.stack.head,s=e.rebase();e.stack&&e.stack.tail&&(s.stack=e.stack.tail);r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)r[n]=t[n];return s.push({__select__:r}).push(i,e.stack.index,e.stack.of)}function s(e){var t,n;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;t<n;t++)e.deferreds[t]();e.isDeferredPending=!1}function o(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function a(e,t){return function(n,r,i,s){return l(n,r,i,s,e,t)}}function l(e,n,i,s,o,a){var l,u,h,p=i.block,d=i.else,f=r(n)||{};if(f.isResolved&&!f.isDeferredPending)return e;if(s.hasOwnProperty("key"))u=s.key;else{if(!f.hasOwnProperty("key"))return t(o,"No key specified","WARN"),e;u=f.key}return h=s.type||f.type,a(u=c(n.resolve(u),h),c(n.resolve(s.value),h))?(f.isPending||(l=!0,f.isPending=!0),p&&(e=e.render(p,n)),l&&(f.isResolved=!0)):d&&(e=e.render(d,n)),e}function c(e,t){t&&(t=t.toLowerCase());switch(t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"!==e&&e,Boolean(e);case"date":return new Date(e)}return e}var u={},h={tap:function(e,t,r){return n("tap"),r.resolve(e)},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,n,r,i){var s,a,l=n.resolve(i.to);switch(n.resolve(i.key)){case"full":s=n.stack;break;default:s=n.stack.head}a=JSON.stringify(s,o,2);switch(l){case"console":t("contextDump",a);break;default:a=a.replace(/</g,"\\u003c");e=e.write(a)}return e},math:function(e,n,o,a){var l,c=a.key,u=a.method,h=a.operand,p=a.round;if(!a.hasOwnProperty("key")||!a.method)return t("math","`key` or `method` was not provided","ERROR"),e;c=parseFloat(n.resolve(c));h=parseFloat(n.resolve(h));switch(u){case"mod":0===h&&t("math","Division by 0","ERROR");l=c%h;break;case"add":l=c+h;break;case"subtract":l=c-h;break;case"multiply":l=c*h;break;case"divide":0===h&&t("math","Division by 0","ERROR");l=c/h;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:t("math","Method `"+u+"` is not supported","ERROR")}return void 0!==l&&(p&&(l=Math.round(l)),o&&o.block?(n=i(n,{key:l}),e=e.render(o.block,n),s(r(n))):e=e.write(l)),e},select:function(e,n,o,a){var l=o.block,c={};return a.hasOwnProperty("key")&&(c.key=n.resolve(a.key)),a.hasOwnProperty("type")&&(c.type=a.type),l?(n=i(n,c),e=e.render(l,n),s(r(n))):t("select","Missing body block","WARN"),e},eq:a("eq",function(e,t){return e===t}),ne:a("ne",function(e,t){return e!==t}),lt:a("lt",function(e,t){return e<t}),lte:a("lte",function(e,t){return e<=t}),gt:a("gt",function(e,t){return e>t}),gte:a("gte",function(e,t){return e>=t}),any:function(e,n,i){var s=r(n);return s?s.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){s.isResolved&&(e=e.render(i.block,n));e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,n,i){var s=r(n);return s?s.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){s.isResolved||(e=e.render(i.block,n));e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,n,r,i){var s,o,a=i.key;if((a=n.resolve(i.key))&&!0!==a)if(e.isArray(a))s=a.length;else if(!isNaN(parseFloat(a))&&isFinite(a))s=a;else if("object"==typeof a){s=0;for(o in a)a.hasOwnProperty(o)&&s++}else s=(a+"").length;else s=0;return t.write(s)}};for(var p in h)e.helpers[p]=h[p];return e});!function(e,t){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(n){return t(n,e)}):"object"==typeof module&&module.exports?module.exports=t(require("dustjs-linkedin"),this):e.dust=t(e.dust,e)}(this,function(e,t,n){"use strict";var r=Object.prototype.toString,i=typeof console!==n?console:{log:function(){}},s={isArray:Array.isArray||function(e){return"[object Array]"===r.call(e)},isAvailable:function(e){return a[e]!==n},log:i.log},o={selected:n,languages:{},filters:{}},a=o.languages;return typeof String.prototype.trim===n&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.i18n={resetContext:function(){o.selected=n,Object.keys(a).forEach(function(e){delete a[e]})},setLanguage:function(e){if(!s.isAvailable(e))throw new Error("language '"+e+"' not available!");o.selected=e},setLanguages:function(e){s.isArray(e)&&e.forEach(function(e){s.isAvailable(e)||(a[e]={}),o.selected===n&&(o.selected=e)})},add:function(e,t){if(s.isAvailable(e)){var n=a[e];Object.keys(t).forEach(function(e){n[e]=t[e]})}},addFilter:function(e,t){e in o.filters||(o.filters[e]=t)}},e.helpers.i18n=function(t,r,i,l){if(l&&l.$key!==n){var c,u,h,p,d=o.selected,f=a[d],y=/\{(\s*[\w]+\s*)\}/g;h=e.helpers.tap(l.$key,t,r).split("|");var m=e.helpers.tap(h.shift(),t,r);for(p=f!==n&&f[m]!==n?f[m]:null;null!==(c=y.exec(p));)"$key"===c[1].trim()?(u="",s.log("$key can't be used as a parameter")):u=e.helpers.tap(l[c[1].trim()],t,r),p=p.replace(c[0],u);h.forEach(function(e){e in o.filters&&(p=o.filters[e](p))}),t.write(p)}else s.log("No key given in the i18n helper");return t},e});!function(){dust.helpers.iterate=function(e,t,n,r){var i=(r=r||{}).on||t.current(),s=null!=r.excludedKeys?r.excludedKeys.split(","):null;for(var o in i)(null==s||s.indexOf(o)<0)&&(e=e.render(n.block,t.push({key:o,value:i[o]})));return e};dust.helpers.startsWith=function(e,t,n,r){var i=n.block,s=n.else,o=r.key,a=r.value;"string"==typeof o&&0===o.toLowerCase().indexOf(a.toLowerCase())?e=e.render(i,t):s&&(e=e.render(s,t));return e}}();var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype;e.prototype=new n},exports,define;function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,r=0;r<this.length;r++)n=e(n,this[r],r,this);return n});var t="";return("."+e).split(".").reduce(function(e,n,r,i){void 0===(n=e["__"+(t=t?t+"."+n:n)])&&(JL.Logger.prototype=e,n=new JL.Logger(t),e["__"+t]=n);return n},JL.__)}!function(e){function t(e,t,n){void 0!==t[e]&&(null===t[e]?delete n[e]:n[e]=t[e])}function n(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function s(e){switch(typeof(e=i(e))){case"string":return new o(e,null,e);case"number":case"boolean":return e=e.toString(),new o(e,null,e);case"undefined":return new o("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new o(e,null,e)):new o(null,e,JSON.stringify(e));default:return new o("unknown",null,"unknown")}}e.enabled;e.maxMessages;e.defaultAjaxUrl;e.clientIP;e.defaultBeforeSend;e.requestId="";var o=function(e,t,n){this.msg=e;this.meta=t;this.finalString=n};e.setOptions=function(e){t("enabled",e,this);t("maxMessages",e,this);t("defaultAjaxUrl",e,this);t("clientIP",e,this);t("requestId",e,this);t("defaultBeforeSend",e,this);return this};e.getAllLevel=function(){return-2147483648};e.getTraceLevel=function(){return 1e3};e.getDebugLevel=function(){return 2e3};e.getInfoLevel=function(){return 3e3};e.getWarnLevel=function(){return 4e3};e.getErrorLevel=function(){return 5e3};e.getFatalLevel=function(){return 6e3};e.getOffLevel=function(){return 2147483647};var a=function(e,t){this.inner=t;this.name="JL.Exception";this.message=s(e).finalString};e.Exception=a;a.prototype=Error();var l=function(e,t,n,r){this.l=e;this.m=t;this.n=n;this.t=r};e.LogItem=l;a=function(){function i(t,n){this.appenderName=t;this.sendLogItems=n;this.level=e.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(e){t("level",e,this);t("ipRegex",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("sendWithBufferLevel",e,this);t("storeInBufferLevel",e,this);t("bufferSize",e,this);t("batchSize",e,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(e,t,i,s,o,a,c){!n(this)||!r(this,a)||o<this.storeInBufferLevel||(e=new l(o,a,c,(new Date).getTime()),o<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(o<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();e.Appender=a;var c=function(n){function r(e){n.call(this,e,r.prototype.sendLogItemsAjax)}__extends(r,n);r.prototype.setOptions=function(e){t("url",e,this);t("beforeSend",e,this);n.prototype.setOptions.call(this,e);return this};r.prototype.sendLogItemsAjax=function(t){try{var n="/jsnlog.logger";null!=e.defaultAjaxUrl&&(n=e.defaultAjaxUrl);this.url&&(n=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(n);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i);i.send(r)}catch(e){}};r.prototype.getXhr=function(t){var n=new XMLHttpRequest;if(!("withCredentials"in n)&&"undefined"!=typeof XDomainRequest)return(n=new XDomainRequest).open("POST",t),n;n.open("POST",t);n.setRequestHeader("Content-Type","application/json");n.setRequestHeader("JSNLog-RequestId",e.requestId);return n};return r}(a);e.AjaxAppender=c;var u=function(t){function n(e){t.call(this,e,n.prototype.sendLogItemsConsole)}__extends(n,t);n.prototype.clog=function(e){console.log(e)};n.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)};n.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)};n.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)};n.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)};n.prototype.sendLogItemsConsole=function(t){try{if(console){var n;for(n=0;n<t.length;++n){var r=t[n],i=r.n+": "+r.m;"undefined"==typeof window&&(i=new Date(r.t)+" | "+i);r.l<=e.getDebugLevel()?this.cdebug(i):r.l<=e.getInfoLevel()?this.cinfo(i):r.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(e){}};return n}(a);e.ConsoleAppender=u;a=function(){function e(e){this.loggerName=e;this.seenRegexes=[]}e.prototype.setOptions=function(e){t("level",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("ipRegex",e,this);t("appenders",e,this);t("onceOnly",e,this);this.seenRegexes=[];return this};e.prototype.buildExceptionObject=function(e){var t={};e.stack?t.stack=e.stack:t.e=e;e.message&&(t.message=e.message);e.name&&(t.name=e.name);e.data&&(t.data=e.data);e.inner&&(t.inner=this.buildExceptionObject(e.inner));return t};e.prototype.log=function(e,t,o){var a=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(o?(a=this.buildExceptionObject(o)).logData=i(t):a=t,r(this,(t=s(a)).finalString))){if(this.onceOnly)for(a=this.onceOnly.length-1;0<=a;){if(RegExp(this.onceOnly[a]).test(t.finalString)){if(this.seenRegexes[a])return this;this.seenRegexes[a]=!0}a--}t.meta=t.meta||{};t.meta.loggerName=this.loggerName;for(a=this.appenders.length-1;0<=a;)this.appenders[a].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,function(){},e,t.finalString,this.loggerName),a--}return this};e.prototype.trace=function(e){return this.log(1e3,e)};e.prototype.debug=function(e){return this.log(2e3,e)};e.prototype.info=function(e){return this.log(3e3,e)};e.prototype.warn=function(e){return this.log(4e3,e)};e.prototype.error=function(e){return this.log(5e3,e)};e.prototype.fatal=function(e){return this.log(6e3,e)};e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)};return e}();e.Logger=a;e.createAjaxAppender=function(e){return new c(e)};e.createConsoleAppender=function(e){return new u(e)};a=new c("");"undefined"==typeof window&&(a=new u(""));e.__=new e.Logger("");e.__.setOptions({level:e.getDebugLevel(),appenders:[a]})}(JL||(JL={}));void 0!==exports&&(exports.JL=JL);"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var e,t,n=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),r=document.getElementsByTagName("script"),i="",s=0,o=r.length;s<o;s++)if((e=r[s].getAttribute("src"))&&(t=e.match(n))){i=t[1];break}return function(){return i}}(),ImgPath:"",Class:function(){var e=arguments.length,t=arguments[0],n=arguments[e-1],r="function"==typeof n.initialize?n.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var i=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),n);OpenLayers.inherit.apply(null,i)}else r.prototype=n;return r},inherit:function(e,t){var n,r,i,s=function(){};s.prototype=t.prototype;e.prototype=new s;for(n=2,r=arguments.length;n<r;n++){"function"==typeof(i=arguments[n])&&(i=i.prototype);OpenLayers.Util.extend(e.prototype,i)}}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(e,t){e=e||{};if(t){for(var n in t){var r=t[n];void 0!==r&&(e[n]=r)}!("function"==typeof window.Event&&t instanceof window.Event)&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e};OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),n=t[0],r=1,i=t.length;r<i;r++){var s=t[r];n+=s.charAt(0).toUpperCase()+s.substring(1)}return n},format:function(e,t,n){t||(t=window);return e.replace(OpenLayers.String.tokenRegEx,function(e,r){for(var i,s=r.split(/\.+/),o=0;o<s.length;o++){0==o&&(i=t);if(void 0===i)break;i=i[s[o]]}"function"==typeof i&&(i=n?i.apply(null,n):i());return void 0===i?"undefined":i})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var n=e;!0===t&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(e)?parseFloat(e):n}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var n=0;t>0&&(n=parseFloat(e.toPrecision(t)));return n},format:function(e,t,n,r){t=void 0!==t?t:0;n=void 0!==n?n:OpenLayers.Number.thousandsSeparator;r=void 0!==r?r:OpenLayers.Number.decimalSeparator;null!=t&&(e=parseFloat(e.toFixed(t)));var i=e.toString().split(".");1==i.length&&null==t&&(t=0);var s,o=i[0];if(n)for(var a=/(-?[0-9]+)([0-9]{3})/;a.test(o);)o=o.replace(a,"$1"+n+"$2");if(0==t)s=o;else{var l=i.length>1?i[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0"));s=o+r+l}return s},zeroPad:function(e,t,n){for(var r=e.toString(n||10);r.length<t;)r="0"+r;return r}};OpenLayers.Function={bind:function(e,t){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var r=n.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(n){return e.call(t,n||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};OpenLayers.Array={filter:function(e,t,n){var r=[];if(Array.prototype.filter)r=e.filter(t,n);else{var i=e.length;if("function"!=typeof t)throw new TypeError;for(var s=0;s<i;s++)if(s in e){var o=e[s];t.call(n,o,s,e)&&r.push(o)}}return r}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,n,r){if(OpenLayers.Util.isArray(e)){r=e[3];n=e[2];t=e[1];e=e[0]}null!=e&&(this.left=OpenLayers.Util.toFloat(e));null!=t&&(this.bottom=OpenLayers.Util.toFloat(t));null!=n&&(this.right=OpenLayers.Util.toFloat(n));null!=r&&(this.top=OpenLayers.Util.toFloat(r))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom);return t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return!0===e?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var n=Math.pow(10,e),r=Math.round(this.left*n)/n,i=Math.round(this.bottom*n)/n,s=Math.round(this.right*n)/n,o=Math.round(this.top*n)/n;return!0===t?i+","+r+","+o+","+s:r+","+i+","+s+","+o},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var n,r;if("OpenLayers.LonLat"==t.CLASS_NAME){n=t.lon;r=t.lat}else{n=t.x;r=t.y}var i=(this.left-n)*e+n,s=(this.bottom-r)*e+r,o=(this.right-n)*e+n,a=(this.top-r)*e+r;return new OpenLayers.Bounds(i,s,o,a)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null;(null==this.left||e.left<this.left)&&(this.left=e.left);(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom);(null==this.right||e.right>this.right)&&(this.right=e.right);(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null;(null==this.left||e<this.left)&&(this.left=e);(null==this.bottom||t<this.bottom)&&(this.bottom=t);(null==this.right||e>this.right)&&(this.right=e);(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t});t=t||{};var n=this.contains(e.lon,e.lat,t.inclusive),r=t.worldBounds;if(r&&!n){var i=r.getWidth(),s=(r.left+r.right)/2,o=Math.round((e.lon-s)/i);n=this.containsLonLat({lon:e.lon-o*i,lat:e.lat},{inclusive:t.inclusive})}return n},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,n){null==n&&(n=!0);if(null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e);t=OpenLayers.Util.toFloat(t);return n?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){"boolean"==typeof t&&(t={inclusive:t});if((t=t||{}).worldBounds){var n=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else n=this;null==t.inclusive&&(t.inclusive=!0);var r=!1,i=n.left==e.right||n.right==e.left||n.top==e.bottom||n.bottom==e.top;if(t.inclusive||!i){var s=e.bottom>=n.bottom&&e.bottom<=n.top||n.bottom>=e.bottom&&n.bottom<=e.top,o=e.top>=n.bottom&&e.top<=n.top||n.top>e.bottom&&n.top<e.top,a=e.left>=n.left&&e.left<=n.right||n.left>=e.left&&n.left<=e.right,l=e.right>=n.left&&e.right<=n.right||n.right>=e.left&&n.right<=e.right;r=(s||o)&&(a||l)}if(t.worldBounds&&!r){var c=t.worldBounds,u=c.getWidth(),h=!c.containsBounds(n),p=!c.containsBounds(e);if(h&&!p){e=e.add(-u,0);r=n.intersectsBounds(e,{inclusive:t.inclusive})}else if(p&&!h){n=n.add(-u,0);r=e.intersectsBounds(n,{inclusive:t.inclusive})}}return r},containsBounds:function(e,t,n){null==t&&(t=!1);null==n&&(n=!0);var r=this.contains(e.left,e.bottom,n),i=this.contains(e.right,e.bottom,n),s=this.contains(e.left,e.top,n),o=this.contains(e.right,e.top,n);return t?r||i||s||o:r&&i&&s&&o},determineQuadrant:function(e){var t="",n=this.getCenterLonLat();t+=e.lat<n.lat?"b":"t";return t+=e.lon<n.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var n=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),i=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),s=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);this.left=Math.min(n.x,i.x);this.bottom=Math.min(n.y,r.y);this.right=Math.max(r.x,s.x);this.top=Math.max(i.y,s.y);return this},wrapDateLine:function(e,t){var n=(t=t||{}).leftTolerance||0,r=t.rightTolerance||0,i=this.clone();if(e){for(var s=e.getWidth();i.left<e.left&&i.right-r<=e.left;)i=i.add(s,0);for(;i.left+n>=e.right&&i.right>e.right;)i=i.add(-s,0);var o=i.left+n;o<e.right&&o>e.left&&i.right-r>e.right&&(i=i.add(-s,0))}return i},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,t){var n=e.split(",");return OpenLayers.Bounds.fromArray(n,t)};OpenLayers.Bounds.fromArray=function(e,t){return!0===t?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])};OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";t+="t"==e.charAt(0)?"b":"t";return t+="l"==e.charAt(1)?"r":"l"};OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var n=OpenLayers.Util.getElement(arguments[e]),r=OpenLayers.Element.visible(n)?"none":"";n.style.display=r}},remove:function(e){(e=OpenLayers.Util.getElement(e)).parentNode.removeChild(e)},getHeight:function(e){return(e=OpenLayers.Util.getElement(e)).offsetHeight},hasClass:function(e,t){var n=e.className;return!!n&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)},addClass:function(e,t){OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t);return e},removeClass:function(e,t){var n=e.className;n&&(e.className=OpenLayers.String.trim(n.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")));return e},toggleClass:function(e,t){OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t);return e},getStyle:function(e,t){var n=null;if((e=OpenLayers.Util.getElement(e))&&e.style){if(!(n=e.style[OpenLayers.String.camelize(t)]))if(document.defaultView&&document.defaultView.getComputedStyle){var r=document.defaultView.getComputedStyle(e,null);n=r?r.getPropertyValue(t):null}else e.currentStyle&&(n=e.currentStyle[OpenLayers.String.camelize(t)]);window.opera&&-1!=OpenLayers.Util.indexOf(["left","top","right","bottom"],t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(n="auto")}return"auto"==n?null:n}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){if(OpenLayers.Util.isArray(e)){t=e[1];e=e[0]}this.lon=OpenLayers.Util.toFloat(e);this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat));return t},transform:function(e,t){var n=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);this.lon=n.x;this.lat=n.y;return this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])};OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),n=t&&e[0],r=t&&e[1];return new OpenLayers.LonLat(n,r)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e);this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();e&&(t=this.add(e.x,e.y));return t},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e);this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h));return t},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};!function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var n=e.split("-");n[0]=n[0].toLowerCase();"object"==typeof OpenLayers.Lang[n[0]]&&(t=n[0]);if(n[1]){var r=n[0]+"-"+n[1].toUpperCase();"object"==typeof OpenLayers.Lang[r]&&(t=r)}if(!t){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+n.join("-")+" dictionary, falling back to default language");t=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=t},translate:function(e,t){var n=OpenLayers.Lang[OpenLayers.Lang.getCode()],r=n&&n[e];r||(r=e);t&&(r=OpenLayers.String.format(r,t));return r}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var e=[],t=0,n=arguments.length;t<n;t++){var r=arguments[t];"string"==typeof r&&(r=document.getElementById(r));if(1==arguments.length)return r;e.push(r)}return e};OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)};OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};OpenLayers.Util.removeItem=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]==t&&e.splice(n,1);return e};OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]==t)return n;return-1};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(e,t,n,r,i,s,o,a){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_"));if(n){e.style.left=n.x+"px";e.style.top=n.y+"px"}if(r){e.style.width=r.w+"px";e.style.height=r.h+"px"}i&&(e.style.position=i);s&&(e.style.border=s);o&&(e.style.overflow=o);if(parseFloat(a)>=0&&parseFloat(a)<1){e.style.filter="alpha(opacity="+100*a+")";e.style.opacity=a}else if(1==parseFloat(a)){e.style.filter="";e.style.opacity=""}};OpenLayers.Util.createDiv=function(e,t,n,r,i,s,o,a){var l=document.createElement("div");r&&(l.style.backgroundImage="url("+r+")");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="absolute");OpenLayers.Util.modifyDOMElement(l,e,t,n,i,s,o,a);return l};OpenLayers.Util.createImage=function(e,t,n,r,i,s,o,a){var l=document.createElement("img");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="relative");OpenLayers.Util.modifyDOMElement(l,e,t,n,i,s,null,o);if(a){l.style.display="none";function c(){l.style.display="";OpenLayers.Event.stopObservingElement(l)}OpenLayers.Event.observe(l,"load",c);OpenLayers.Event.observe(l,"error",c)}l.style.alt=e;l.galleryImg="no";r&&(l.src=r);return l};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),n=!1;try{n=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=n&&t>=5.5&&t<7}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(e,t,n,r,i,s,o,a,l){OpenLayers.Util.modifyDOMElement(e,t,n,r,s,null,null,l);var c=e.childNodes[0];i&&(c.src=i);OpenLayers.Util.modifyDOMElement(c,e.id+"_innerImage",null,r,"relative",o);if(OpenLayers.Util.alphaHack()){"none"!=e.style.display&&(e.style.display="inline-block");null==a&&(a="scale");e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c.src+"', sizingMethod='"+a+"')";parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")");c.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(e,t,n,r,i,s,o,a,l){var c=OpenLayers.Util.createDiv(),u=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);u.className="olAlphaImg";c.appendChild(u);OpenLayers.Util.modifyAlphaImageDiv(c,e,t,n,r,i,s,o,a);return c};OpenLayers.Util.upperCaseObject=function(e){var t={};for(var n in e)t[n.toUpperCase()]=e[n];return t};OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var n="function"==typeof window.Event&&t instanceof window.Event;for(var r in t)(void 0===e[r]||!n&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))&&(e[r]=t[r]);!n&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString);return e};OpenLayers.Util.getParameterString=function(e){var t=[];for(var n in e){var r=e[n];if(null!=r&&"function"!=typeof r){var i;if("object"==typeof r&&r.constructor==Array){for(var s,o=[],a=0,l=r.length;a<l;a++){s=r[a];o.push(encodeURIComponent(null===s||void 0===s?"":s))}i=o.join(",")}else i=encodeURIComponent(r);t.push(encodeURIComponent(n)+"="+i)}}return t.join("&")};OpenLayers.Util.urlAppend=function(e,t){var n=e;if(t){var r=(e+" ").split(/[?&]/);n+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return n};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e};OpenLayers.Util.Try=function(){for(var e=null,t=0,n=arguments.length;t<n;t++){var r=arguments[t];try{e=r();break}catch(e){}}return e};OpenLayers.Util.getXmlNodeValue=function(e){var t=null;OpenLayers.Util.Try(function(){(t=e.text)||(t=e.textContent);t||(t=e.firstChild.nodeValue)},function(){t=e.textContent});return t};OpenLayers.Util.mouseLeft=function(e,t){for(var n=e.relatedTarget?e.relatedTarget:e.toElement;n!=t&&null!=n;)n=n.parentNode;return n!=t};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(e,t){null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION);"number"!=typeof e&&(e=parseFloat(e));return 0===t?e:parseFloat(e.toPrecision(t))};OpenLayers.Util.rad=function(e){return e*Math.PI/180};OpenLayers.Util.deg=function(e){return 180*e/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(e,t){for(var n=OpenLayers.Util.VincentyConstants,r=n.a,i=n.b,s=n.f,o=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-s)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-s)*Math.tan(OpenLayers.Util.rad(t.lat))),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),d=o,f=2*Math.PI,y=20;Math.abs(d-f)>1e-12&&--y>0;){var m=Math.sin(d),g=Math.cos(d),C=Math.sqrt(p*m*(p*m)+(u*h-c*p*g)*(u*h-c*p*g));if(0==C)return 0;var v=c*h+u*p*g,T=Math.atan2(C,v),L=Math.asin(u*p*m/C),S=Math.cos(L)*Math.cos(L),b=v-2*c*h/S,w=s/16*S*(4+s*(4-3*S));f=d;d=o+(1-w)*s*Math.sin(L)*(T+w*C*(b+w*v*(2*b*b-1)))}if(0==y)return NaN;var E=S*(r*r-i*i)/(i*i),O=E/1024*(256+E*(E*(74-47*E)-128));return(i*(1+E/16384*(4096+E*(E*(320-175*E)-768)))*(T-O*C*(b+O/4*(v*(2*b*b-1)-O/6*b*(4*C*C-3)*(4*b*b-3))))).toFixed(3)/1e3};OpenLayers.Util.destinationVincenty=function(e,t,n){for(var r=OpenLayers.Util,i=r.VincentyConstants,s=i.a,o=i.b,a=i.f,l=e.lon,c=e.lat,u=n,h=r.rad(t),p=Math.sin(h),d=Math.cos(h),f=(1-a)*Math.tan(r.rad(c)),y=1/Math.sqrt(1+f*f),m=f*y,g=Math.atan2(f,d),C=y*p,v=1-C*C,T=v*(s*s-o*o)/(o*o),L=1+T/16384*(4096+T*(T*(320-175*T)-768)),S=T/1024*(256+T*(T*(74-47*T)-128)),b=u/(o*L),w=2*Math.PI;Math.abs(b-w)>1e-12;){var E=Math.cos(2*g+b),O=Math.sin(b),A=Math.cos(b);w=b;b=u/(o*L)+S*O*(E+S/4*(A*(2*E*E-1)-S/6*E*(4*O*O-3)*(4*E*E-3)))}var x=m*O-y*A*d,P=Math.atan2(m*A+y*O*d,(1-a)*Math.sqrt(C*C+x*x)),_=a/16*v*(4+a*(4-3*v)),N=Math.atan2(O*p,y*A-m*O*d)-(1-_)*a*C*(b+_*O*(E+_*A*(2*E*E-1)));Math.atan2(C,-x);return new OpenLayers.LonLat(l+r.deg(N),r.deg(P))};OpenLayers.Util.getParameters=function(e,t){t=t||{};e=null===e||void 0===e?window.location.href:e;var n="";if(OpenLayers.String.contains(e,"?")){var r=e.indexOf("?")+1,i=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;n=e.substring(r,i)}for(var s={},o=n.split(/[&;]/),a=0,l=o.length;a<l;++a){var c=o[a].split("=");if(c[0]){var u=c[0];try{u=decodeURIComponent(u)}catch(e){u=unescape(u)}var h=(c[1]||"").replace(/\+/g," ");try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}!1!==t.splitArgs&&(h=h.split(","));1==h.length&&(h=h[0]);s[u]=h}}return s};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(e){e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return e+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT.in=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(e){return e>1?1/e:e};OpenLayers.Util.getResolutionFromScale=function(e,t){var n;if(e){null==t&&(t="degrees");n=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return n};OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");return e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH};OpenLayers.Util.pagePosition=function(e){var t=[0,0],n=OpenLayers.Util.getViewportElement();if(!e||e==window||e==n)return t;var r,i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),s=null;if(e.getBoundingClientRect){r=e.getBoundingClientRect();var o=window.pageYOffset||n.scrollTop,a=window.pageXOffset||n.scrollLeft;t[0]=r.left+a;t[1]=r.top+o}else if(document.getBoxObjectFor&&!i){r=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(n);t[0]=r.screenX-l.screenX;t[1]=r.screenY-l.screenY}else{t[0]=e.offsetLeft;t[1]=e.offsetTop;if((s=e.offsetParent)!=e)for(;s;){t[0]+=s.offsetLeft;t[1]+=s.offsetTop;s=s.offsetParent}var c=OpenLayers.BROWSER_NAME;("opera"==c||"safari"==c&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop);s=e.offsetParent;for(;s&&s!=document.body;){t[0]-=s.scrollLeft;"opera"==c&&"TR"==s.tagName||(t[1]-=s.scrollTop);s=s.offsetParent}}return t};OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;if(void 0==e){e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement;arguments.callee.viewportElement=e}return e};OpenLayers.Util.isEquivalentUrl=function(e,t,n){n=n||{};OpenLayers.Util.applyDefaults(n,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var r=OpenLayers.Util.createUrlObject(e,n),i=OpenLayers.Util.createUrlObject(t,n);for(var s in r)if("args"!==s&&r[s]!=i[s])return!1;for(var s in r.args){if(r.args[s]!=i.args[s])return!1;delete i.args[s]}for(var s in i.args)return!1;return!0};OpenLayers.Util.createUrlObject=function(e,t){t=t||{};if(!/^\w+:\/\//.test(e)){var n=window.location,r=n.port?":"+n.port:"",i=n.protocol+"//"+n.host.split(":").shift()+r;if(0===e.indexOf("/"))e=i+e;else{var s=n.pathname.split("/");s.pop();e=i+s.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var o=document.createElement("a");o.href=e;var a={};a.host=o.host.split(":").shift();a.protocol=o.protocol;t.ignorePort80?a.port="80"==o.port||"0"==o.port?"":o.port:a.port=""==o.port||"0"==o.port?"80":o.port;a.hash=t.ignoreHash||"#"===o.hash?"":o.hash;var l=o.search;if(!l){var c=e.indexOf("?");l=-1!=c?e.substr(c):""}a.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs});a.pathname="/"==o.pathname.charAt(0)?o.pathname:"/"+o.pathname;return a};OpenLayers.Util.removeTail=function(e){var t=e.indexOf("?"),n=e.indexOf("#");return-1==t?-1!=n?e.substr(0,n):e:-1!=n?e.substr(0,Math.min(t,n)):e.substr(0,t)};OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}();OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla");return e}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(e,t,n){var r,i,s=document.createElement("div");s.style.visibility="hidden";for(var o=n&&n.containerElement?n.containerElement:document.body,a=!1,l=null,c=o;c&&"body"!=c.tagName.toLowerCase();){var u=OpenLayers.Element.getStyle(c,"position");if("absolute"==u){a=!0;break}if(u&&"static"!=u)break;c=c.parentNode}if(a&&(0===o.clientHeight||0===o.clientWidth)){(l=document.createElement("div")).style.visibility="hidden";l.style.position="absolute";l.style.overflow="visible";l.style.width=document.body.clientWidth+"px";l.style.height=document.body.clientHeight+"px";l.appendChild(s)}s.style.position="absolute";if(t)if(t.w){r=t.w;s.style.width=r+"px"}else if(t.h){i=t.h;s.style.height=i+"px"}n&&n.displayClass&&(s.className=n.displayClass);var h=document.createElement("div");h.innerHTML=e;h.style.overflow="visible";if(h.childNodes)for(var p=0,d=h.childNodes.length;p<d;p++)h.childNodes[p].style&&(h.childNodes[p].style.overflow="visible");s.appendChild(h);l?o.appendChild(l):o.appendChild(s);if(!r){r=parseInt(h.scrollWidth);s.style.width=r+"px"}i||(i=parseInt(h.scrollHeight));s.removeChild(h);if(l){l.removeChild(s);o.removeChild(l)}else o.removeChild(s);return new OpenLayers.Size(r,i)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t,n,r=null,i=null;(r=document.createElement("div")).style.position="absolute";r.style.top="-1000px";r.style.left="-1000px";r.style.width="100px";r.style.height="50px";r.style.overflow="hidden";(i=document.createElement("div")).style.width="100%";i.style.height="200px";r.appendChild(i);document.body.appendChild(r);t=i.offsetWidth;r.style.overflow="scroll";n=i.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=t-n;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(e,t,n){n||(n="dms");e=(e+540)%360-180;var r=Math.abs(e),i=Math.floor(r),s=(r-i)/(1/60),o=(s-(s=Math.floor(s)))/(1/60);o=Math.round(10*o);if((o/=10)>=60){o-=60;if((s+=1)>=60){s-=60;i+=1}}i<10&&(i="0"+i);var a=i+"\xb0";if(n.indexOf("dm")>=0){s<10&&(s="0"+s);a+=s+"'";if(n.indexOf("dms")>=0){o<10&&(o="0"+o);a+=o+'"'}}return a+="lon"==t?e<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):e<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){"use strict";var e=["","O","ms","Moz","Webkit"],t=document.createElement("div").style,n={},r={};function i(t,n){if(void 0===r[n]){var i,s,o=0,a=e.length,l=void 0!==t.cssText;r[n]=null;for(;o<a;o++){if(s=e[o]){l||(s=s.toLowerCase());i=s+n.charAt(0).toUpperCase()+n.slice(1)}else i=n;if(void 0!==t[i]){r[n]=i;break}}}return r[n]}function s(e){return i(t,e)}return{css:function(e){if(void 0===n[e]){var t=s(e.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}));n[e]=function(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}(t)}return n[e]},js:i,style:s,cssCache:n,jsCache:r}}();OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e);e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var n=OpenLayers.Event.element(e);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase());)n=n.parentNode;return n},observe:function(e,t,n,r){var i=OpenLayers.Util.getElement(e);r=r||!1;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(t="keydown");this.observers||(this.observers={});if(!i._eventCacheID){var s="eventCacheID_";i.id&&(s=i.id+"_"+s);i._eventCacheID=OpenLayers.Util.createUniqueID(s)}var o=i._eventCacheID;this.observers[o]||(this.observers[o]=[]);this.observers[o].push({element:i,name:t,observer:n,useCapture:r});i.addEventListener?i.addEventListener(t,n,r):i.attachEvent&&i.attachEvent("on"+t,n)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e)._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[t])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];OpenLayers.Event.stopObserving.apply(this,[n.element,n.name,n.observer,n.useCapture])}},stopObserving:function(e,t,n,r){r=r||!1;var i=OpenLayers.Util.getElement(e),s=i._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(t="keydown");var o=!1,a=OpenLayers.Event.observers[s];if(a)for(var l=0;!o&&l<a.length;){var c=a[l];if(c.name==t&&c.observer==n&&c.useCapture==r){a.splice(l,1);0==a.length&&delete OpenLayers.Event.observers[s];o=!0;break}l++}o&&(i.removeEventListener?i.removeEventListener(t,n,r):i&&i.detachEvent&&i.detachEvent("on"+t,n));return o},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,n,r,i){OpenLayers.Util.extend(this,i);this.object=e;this.fallThrough=r;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null;if(this.element){OpenLayers.Event.stopObservingElement(this.element);this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){if(this.element)OpenLayers.Event.stopObservingElement(this.element);else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)}this.element=e;for(var t,n=!!window.navigator.msMaxTouchPoints,r=0,i=this.BROWSER_EVENTS.length;r<i;r++){t=this.BROWSER_EVENTS[r];OpenLayers.Event.observe(e,t,this.eventHandler);n&&0===t.indexOf("touch")&&this.addMsTouchListener(e,t,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,n,r){e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this));if(null!=n){null==t&&(t=this.object);var i=this.listeners[e];if(!i){i=[];this.listeners[e]=i;this.extensionCount[e]=0}var s={obj:t,func:n};if(r){i.splice(this.extensionCount[e],0,s);"object"==typeof r&&r.extension&&this.extensionCount[e]++}else i.push(s)}},registerPriority:function(e,t,n){this.register(e,t,n,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,n){null==t&&(t=this.object);var r=this.listeners[e];if(null!=r)for(var i=0,s=r.length;i<s;i++)if(r[i].obj==t&&r[i].func==n){r.splice(i,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var n=this.listeners[e];if(n&&0!=n.length){null==t&&(t={});t.object=this.object;t.element=this.element;t.type||(t.type=e);for(var r,i=0,s=(n=n.slice()).length;i<s;i++){var o=n[i];if(void 0!=(r=o.func.apply(o.obj,[t]))&&0==r)break}this.fallThrough||OpenLayers.Event.stop(t,!0);return r}},handleBrowserEvent:function(e){var t=e.type,n=this.listeners[t];if(n&&0!=n.length){var r=e.touches;if(r&&r[0]){for(var i,s=0,o=0,a=r.length,l=0;l<a;++l){s+=(i=this.getTouchClientXY(r[l])).clientX;o+=i.clientY}e.clientX=s/a;e.clientY=o/a}this.includeXY&&(e.xy=this.getMousePosition(e));this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,n=t.pageXOffset,r=t.pageYOffset,i=e.clientX,s=e.clientY;if(0===e.pageY&&Math.floor(s)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)){i-=n;s-=r}else if(s<e.pageY-r||i<e.pageX-n){i=e.pageX-n;s=e.pageY-r}e.olClientX=i;e.olClientY=s;return{clientX:i,clientY:s}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(e){if(this.includeXY){if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=!0}}else this.clearMouseCache();if(!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,n){this.eventHandler;var r=this._msTouches;function i(e){n(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=r.length-1;e>=0;--e)r[e].stopPropagation()},preventDefault:function(){for(var e=r.length-1;e>=0;--e)r[e].preventDefault()},type:t},e))}switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,i);case"touchend":return this.addMsTouchListenerEnd(e,t,i);case"touchmove":return this.addMsTouchListenerMove(e,t,i);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,n){var r=this._msTouches;OpenLayers.Event.observe(e,"MSPointerDown",function(e){for(var t=!1,i=0,s=r.length;i<s;++i)if(r[i].pointerId==e.pointerId){t=!0;break}t||r.push(e);e.touches=r.slice();n(e)});OpenLayers.Event.observe(e,"MSPointerUp",function(e){for(var t=0,n=r.length;t<n;++t)if(r[t].pointerId==e.pointerId){r.splice(t,1);break}})},addMsTouchListenerMove:function(e,t,n){var r=this._msTouches;OpenLayers.Event.observe(e,"MSPointerMove",function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==r.length&&r[0].pageX==e.pageX&&r[0].pageY==e.pageY)){for(var t=0,i=r.length;t<i;++t)if(r[t].pointerId==e.pointerId){r[t]=e;break}e.touches=r.slice();n(e)}})},addMsTouchListenerEnd:function(e,t,n){var r=this._msTouches;OpenLayers.Event.observe(e,"MSPointerUp",function(e){for(var t=0,i=r.length;t<i;++t)if(r[t].pointerId==e.pointerId){r.splice(t,1);break}e.touches=r.slice();n(e)})},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Animation=function(e){var t,n=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),r=!!n,i=(t=e[n]||function(t,n){e.setTimeout(t,16)},function(n,r){t.apply(e,[n,r])}),s=0,o={};return{isNative:r,requestFrame:i,start:function(e,t,n){t=t>0?t:Number.POSITIVE_INFINITY;var r=++s,a=+new Date;o[r]=function(){if(o[r]&&+new Date-a<=t){e();o[r]&&i(o[r],n)}else delete o[r]};i(o[r],n);return r},stop:function(e){delete o[e]}}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e||OpenLayers.Easing.Expo.easeOut},start:function(e,t,n,r){this.playing=!0;this.begin=e;this.finish=t;this.duration=n;this.callbacks=r.callbacks;this.minFrameRate=r.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){if(this.playing){this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish);OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.playing=!1}},play:function(){var e={};for(var t in this.begin){var n=this.begin[t],r=this.finish[t];if(null==n||null==r||isNaN(n)||isNaN(r))throw new TypeError("invalid value for Tween");var i=r-n;e[t]=this.easing.apply(this,[this.time,n,i,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,t,n,r){return n*e/r+t},easeOut:function(e,t,n,r){return n*e/r+t},easeInOut:function(e,t,n,r){return n*e/r+t},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,t,n,r){return 0==e?t:n*Math.pow(2,10*(e/r-1))+t},easeOut:function(e,t,n,r){return e==r?t+n:n*(1-Math.pow(2,-10*e/r))+t},easeInOut:function(e,t,n,r){return 0==e?t:e==r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(2-Math.pow(2,-10*--e))+t},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.projCode=e;"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,n=!1;if(t){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));if("object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)n=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var r=this.getCode(),i=t.getCode();n=r==i||!!OpenLayers.Projection.transforms[r]&&OpenLayers.Projection.transforms[r][i]===OpenLayers.Projection.nullTransform}}return n},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(e,t,n){if(n===OpenLayers.Projection.nullTransform){var r=OpenLayers.Projection.defaults[e];r&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=r)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={});OpenLayers.Projection.transforms[e][t]=n};OpenLayers.Projection.transform=function(e,t,n){if(t&&n){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));n instanceof OpenLayers.Projection||(n=new OpenLayers.Projection(n));if(t.proj&&n.proj)e=Proj4js.transform(t.proj,n.proj,e);else{var r=t.getCode(),i=n.getCode(),s=OpenLayers.Projection.transforms;s[r]&&s[r][i]&&s[r][i](e)}}return e};OpenLayers.Projection.nullTransform=function(e){return e};!function(){var e=20037508.34;function t(t){t.x=180*t.x/e;t.y=180/Math.PI*(2*Math.atan(Math.exp(t.y/e*Math.PI))-Math.PI/2);return t}function n(t){t.x=t.x*e/180;var n=Math.log(Math.tan((90+t.y)*Math.PI/360))/Math.PI*e;t.y=Math.max(-20037508.34,Math.min(n,20037508.34));return t}function r(e,r){var i,s,o,a,l,c=OpenLayers.Projection.addTransform,u=OpenLayers.Projection.nullTransform;for(i=0,s=r.length;i<s;++i){c(e,o=r[i],n);c(o,e,t);for(l=i+1;l<s;++l){c(o,a=r[l],u);c(a,o,u)}}}var i,s=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],o=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(i=s.length-1;i>=0;--i)r(s[i],o);for(i=o.length-1;i>=0;--i)r(o[i],s)}();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(e=(t=e)&&t.div);this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},t);OpenLayers.Util.extend(this,t);var n=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[n]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(e);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var r=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(r,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});if(OpenLayers.TileManager&&null!==this.tileManager){this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager));this.tileManager.addMap(this)}r=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(r);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();this.eventListeners instanceof Object&&this.events.on(this.eventListeners);if(!0===this.autoUpdateSize){this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){for(var i=!0,s=document.getElementsByTagName("link"),o=0,a=s.length;o<a;++o)if(OpenLayers.Util.isEquivalentUrl(s.item(o).href,this.theme)){i=!1;break}if(i){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l)}}if(null==this.controls){this.controls=[];if(null!=OpenLayers.Control){OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation);OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom);OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser);OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)}}for(o=0,a=this.controls.length;o<a;o++)this.addControlToMap(this.controls[o]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(t&&t.layers){delete this.center;delete this.zoom;this.addLayers(t.layers);t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)}this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween){this.panTween.stop();this.panTween=null}if(this.zoomTween){this.zoomTween.stop();this.zoomTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.viewPortDiv=null;if(this.tileManager){this.tileManager.removeMap(this);this.tileManager=null}if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e);t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,n){var r="function"==typeof n.test;return OpenLayers.Array.filter(this[e],function(e){return e[t]==n||r&&n.test(e[t])})},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,n=0,r=this.layers.length;n<r;n++){var i=this.layers[n];if(i.id==e){t=i;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++){var n=this.layers[e];this.setLayerZIndex(n,e)}},addLayer:function(e){for(var t=0,n=this.layers.length;t<n;t++)if(this.layers[t]==e)return!1;if(!1===this.events.triggerEvent("preaddlayer",{layer:e}))return!1;this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return!0},addLayers:function(e){for(var t=0,n=e.length;t<n;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(!1!==this.events.triggerEvent("preremovelayer",{layer:e})){null==t&&(t=!0);e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.layers,e);e.removeMap(this);e.map=null;if(this.baseLayer==e){this.baseLayer=null;if(t)for(var n=0,r=this.layers.length;n<r;n++){var i=this.layers[n];if(i.isBaseLayer||this.allOverlays){this.setBaseLayer(i);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:e});e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var n=this.getLayerIndex(e);t<0?t=0:t>this.layers.length&&(t=this.layers.length);if(n!=t){this.layers.splice(n,1);this.layers.splice(t,0,e);for(var r=0,i=this.layers.length;r<i;r++)this.setLayerZIndex(this.layers[r],r);this.events.triggerEvent("changelayer",{layer:e,property:"order"});this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var n=this.getLayerIndex(e)+t;this.setLayerIndex(e,n)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),n=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0);!1===this.baseLayer.inRange&&this.baseLayer.redraw()}if(null!=t){var r=this.getZoomForResolution(n||this.resolution,!0);this.setCenter(t,r,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e);this.addControlToMap(e,t)},addControls:function(e,t){for(var n=1===arguments.length?[]:t,r=0,i=e.length;r<i;r++){var s=e[r],o=n[r]?n[r]:null;this.addControl(s,o)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var n=e.draw(t);if(n&&!e.outsideViewport){n.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(n)}e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,n=0,r=this.controls.length;n<r;n++){var i=this.controls[n];if(i.id==e){t=i;break}}return t},removeControl:function(e){if(e&&e==this.getControl(e.id)){e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.controls,e)}},addPopup:function(e,t){if(t)for(var n=this.popups.length-1;n>=0;--n)this.removePopup(this.popups[n]);e.map=this;this.popups.push(e);var r=e.draw();if(r){r.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(r)}},removePopup:function(e){OpenLayers.Util.removeItem(this.popups,e);if(e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(e){}e.map=null},getSize:function(){var e=null;null!=this.size&&(e=this.size.clone());return e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();null==t&&(this.size=t=e);if(!e.equals(t)){this.size=e;for(var n=0,r=this.layers.length;n<r;n++)this.layers[n].onMapResize();var i=this.getCachedCenter();if(null!=this.baseLayer&&null!=i){var s=this.getZoom();this.zoom=null;this.setCenter(i,s)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=this.div.offsetWidth;e.h=this.div.offsetHeight}if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=parseInt(this.div.style.width);e.h=parseInt(this.div.style.height)}return e},calculateBounds:function(e,t){var n=null;null==e&&(e=this.getCachedCenter());null==t&&(t=this.getResolution());if(null!=e&&null!=t){var r=this.size.w*t/2,i=this.size.h*t/2;n=new OpenLayers.Bounds(e.lon-r,e.lat-i,e.lon+r,e.lat+i)}return n},getCenter:function(){var e=null,t=this.getCachedCenter();t&&(e=t.clone());return e},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(e,t,n){if((n=OpenLayers.Util.applyDefaults(n,{animate:!0,dragging:!1})).dragging)0==e&&0==t||this.moveByPx(e,t);else{var r=this.getViewPortPxFromLonLat(this.getCachedCenter()),i=r.add(e,t);if(this.dragging||!i.equals(r)){var s=this.getLonLatFromViewPortPx(i);if(n.animate)this.panTo(s);else{this.moveTo(s);if(this.dragging){this.dragging=!1;this.events.triggerEvent("moveend")}}}}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(e.equals(t))return;var n=this.getPixelFromLonLat(t),r=this.getPixelFromLonLat(e),i={x:r.x-n.x,y:r.y-n.y},s={x:0,y:0};this.panTween.start({x:0,y:0},i,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-s.x,n=e.y-s.y;this.moveByPx(t,n);s.x=Math.round(e.x);s.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e);this.dragging=!1;this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,n,r){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(e,t,{dragging:n,forceZoomChange:r})},moveByPx:function(e,t){var n=this.size.w/2,r=this.size.h/2,i=n+e,s=r+t,o=this.baseLayer.wrapDateLine,a=0,l=0;if(this.restrictedExtent){a=n;l=r;o=!1}e=o||i<=this.maxPx.x-a&&i>=this.minPx.x+a?Math.round(e):0;t=s<=this.maxPx.y-l&&s>=this.minPx.y+l?Math.round(t):0;if(e||t){if(!this.dragging){this.dragging=!0;this.events.triggerEvent("movestart")}this.center=null;if(e){this.layerContainerOriginPx.x-=e;this.minPx.x-=e;this.maxPx.x-=e}if(t){this.layerContainerOriginPx.y-=t;this.minPx.y-=t;this.maxPx.y-=t}this.applyTransform();var c,u,h;for(u=0,h=this.layers.length;u<h;++u)if((c=this.layers[u]).visibility&&(c===this.baseLayer||c.inRange)){c.moveByPx(e,t);c.events.triggerEvent("move")}this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,n=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>n)if(this.fractionalZoom)e=this.getZoomForResolution(n);else for(var r=0|e,i=t.length;r<i;++r)if(t[r]<=n){e=r;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,n){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e));n||(n={});if(null!=t){t=parseFloat(t);this.fractionalZoom||(t=Math.round(t))}var r=t;(t=this.adjustZoom(t))!==r&&(e=this.getCenter());var i=n.dragging||this.dragging,s=n.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(e)){e=this.maxExtent.getCenterLonLat();this.center=e.clone()}if(null!=this.restrictedExtent){null==e&&(e=this.center);null==t&&(t=this.getZoom());var o=this.getResolutionForZoom(t),a=this.calculateBounds(e,o);if(!this.restrictedExtent.containsBounds(a)){var l=this.restrictedExtent.getCenterLonLat();a.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):a.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-a.left,0):a.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-a.right,0));a.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):a.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-a.bottom):a.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-a.top))}}var c=s||this.isValidZoomLevel(t)&&t!=this.getZoom(),u=this.isValidLonLat(e)&&!e.equals(this.center);if(c||u||i){i||this.events.triggerEvent("movestart",{zoomChanged:c});if(u){!c&&this.center&&this.centerLayerContainer(e);this.center=e.clone()}var h=c?this.getResolutionForZoom(t):this.getResolution();if(c||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var p=this.getMaxExtent({restricted:!0}),d=p.getCenterLonLat(),f=this.center.lon-d.lon,y=d.lat-this.center.lat,m=Math.round(p.getWidth()/h),g=Math.round(p.getHeight()/h);this.minPx={x:(this.size.w-m)/2-f/h,y:(this.size.h-g)/2-y/h};this.maxPx={x:this.minPx.x+Math.round(p.getWidth()/h),y:this.minPx.y+Math.round(p.getHeight()/h)}}if(c){this.zoom=t;this.resolution=h}var C=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(C,c,n.dragging);n.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:c})}C=this.baseLayer.getExtent();for(var v=this.layers.length-1;v>=0;--v){var T=this.layers[v];if(T!==this.baseLayer&&!T.isBaseLayer){var L=T.calculateInRange();if(T.inRange!=L){T.inRange=L;L||T.display(!1);this.events.triggerEvent("changelayer",{layer:T,property:"visibility"})}if(L&&T.visibility){T.moveTo(C,c,n.dragging);n.dragging||T.events.triggerEvent("moveend",{zoomChanged:c})}}}this.events.triggerEvent("move");i||this.events.triggerEvent("moveend");if(c){v=0;for(var S=this.popups.length;v<S;v++)this.popups[v].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),n=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=n){var r=this.layerContainerOriginPx.x,i=this.layerContainerOriginPx.y,s=Math.round(t.x-n.x),o=Math.round(t.y-n.y);this.applyTransform(this.layerContainerOriginPx.x=s,this.layerContainerOriginPx.y=o);var a=r-s,l=i-o;this.minPx.x-=a;this.maxPx.x-=a;this.minPx.y-=l;this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var n=this.getMaxExtent(),r=this.baseLayer.wrapDateLine&&n;t=n.containsLonLat(e,{worldBounds:r})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.projection);return e},getMaxResolution:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.maxResolution);return e},getMaxExtent:function(e){var t=null;e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent);return t},getNumZoomLevels:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels);return e},getExtent:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.getExtent());return e},getResolution:function(){var e=null;null!=this.baseLayer?e=this.baseLayer.getResolution():!0===this.allOverlays&&this.layers.length>0&&(e=this.layers[0].getResolution());return e},getUnits:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.units);return e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),n=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,n)}return e},getZoomForExtent:function(e,t){var n=null;null!=this.baseLayer&&(n=this.baseLayer.getZoomForExtent(e,t));return n},getResolutionForZoom:function(e){var t=null;this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e));return t},getZoomForResolution:function(e,t){var n=null;null!=this.baseLayer&&(n=this.baseLayer.getZoomForResolution(e,t));return n},zoomTo:function(e,t){var n=this;if(n.isValidZoomLevel(e)){n.baseLayer.wrapDateLine&&(e=n.adjustZoom(e));if(n.zoomTween){var r={scale:n.getResolution()/n.getResolutionForZoom(e)};if(n.zoomTween.playing&&n.zoomTween.duration<3*n.zoomDuration)n.zoomTween.finish={scale:n.zoomTween.finish.scale*r.scale};else{if(!t){var i=n.getSize();t={x:i.w/2,y:i.h/2}}n.zoomTween.start({scale:1},r,n.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var r=n.layerContainerOriginPx,i=e.scale,s=(i-1)*(r.x-t.x)|0,o=(i-1)*(r.y-t.y)|0;n.applyTransform(r.x+s,r.y+o,i)},done:function(e){n.applyTransform();var r=n.getResolution()/e.scale,i=n.getZoomForResolution(r,!0);n.moveTo(n.getZoomTargetCenter(t,r),i,!0)}}})}}else{var s=t?n.getZoomTargetCenter(t,n.getResolutionForZoom(e)):null;n.setCenter(s,e)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var n=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var r=this.getMaxExtent();e=e.clone();for(;e.right<e.left;)e.right+=r.getWidth();n=e.getCenterLonLat().wrapDateLine(r)}this.setCenter(n,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=!e||e.restricted,n=this.getMaxExtent({restricted:t});this.zoomToExtent(n)},zoomToScale:function(e,t){var n=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),r=this.size.w*n/2,i=this.size.h*n/2,s=this.getCachedCenter(),o=new OpenLayers.Bounds(s.lon-r,s.lat-i,s.lon+r,s.lat+i);this.zoomToExtent(o,t)},getLonLatFromViewPortPx:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e));return t},getViewPortPxFromLonLat:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e));return t},getZoomTargetCenter:function(e,t){var n=null,r=this.getSize(),i=r.w/2-e.x,s=e.y-r.h/2,o=this.getLonLatFromPixel(e);o&&(n=new OpenLayers.LonLat(o.lon+i*t,o.lat+s*t));return n},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);t.x=Math.round(t.x);t.y=Math.round(t.y);return t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),n=this.getResolution(),r=t.add(-n/2,0),i=t.add(n/2,0),s=t.add(0,-n/2),o=t.add(0,n/2),a=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||a;if(!l.equals(a)){r.transform(l,a);i.transform(l,a);s.transform(l,a);o.transform(l,a)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(r,i),OpenLayers.Util.distVincenty(s,o))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var n=this.layerContainerOriginPx.x,r=this.layerContainerOriginPx.y;t=e.add(n,r)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var n=-this.layerContainerOriginPx.x,r=-this.layerContainerOriginPx.y;t=e.add(n,r);(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){e=this.getViewPortPxFromLayerPx(e);return this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,n){n=n||1;var r=this.layerContainerOriginPx,i=1!==n;e=e||r.x;t=t||r.y;var s=this.layerContainerDiv.style,o=this.applyTransform.transform,a=this.applyTransform.template;if(void 0===o){o=OpenLayers.Util.vendorPrefix.style("transform");this.applyTransform.transform=o;if(o){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));if(!l||"none"!==l){a=["translate3d(",",0) ","scale3d(",",1)"];s[o]=[a[0],"0,0",a[1]].join("")}a&&~s[o].indexOf(a[0])||(a=["translate(",") ","scale(",")"]);this.applyTransform.template=a}}if(null===o||"translate3d("!==a[0]&&!0!==i){s.left=e+"px";s.top=t+"px";null!==o&&(s[o]="")}else{if(!0===i&&"translate("===a[0]){e-=r.x;t-=r.y;s.left=r.x+"px";s.top=r.y+"px"}s[o]=[a[0],e,"px,",t,"px",a[1],a[2],n,",",n,a[3]].join("")}},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={};t=OpenLayers.Util.extend({},t);null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange);this.addOptions(t);this.name=e;if(null==this.id){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}},destroy:function(e){null==e&&(e=!0);null!=this.map&&this.map.removeLayer(this,e);this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(e){null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(e,this);e.map=null;return e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){if(e!=this.name){this.name=e;null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}},addOptions:function(e,t){null==this.options&&(this.options={});if(e){"string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection));e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]);!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent));!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))}OpenLayers.Util.extend(this.options,e);OpenLayers.Util.extend(this,e);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var n=this.map.getResolution(),r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var i in e)if(e.hasOwnProperty(i)&&OpenLayers.Util.indexOf(r,i)>=0){this.initResolutions();if(t&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(n),!1,!0);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){this.moveTo(t,!0,!1);this.events.triggerEvent("moveend",{zoomChanged:!0});e=!0}}return e},moveTo:function(e,t,n){var r=this.visibility;this.isBaseLayer||(r=r&&this.inRange);this.display(r)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){this.map=e;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection));this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e||(this.tileSize?this.tileSize:this.map.getTileSize());this.tileSize=t;this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){if(e!=this.visibility){this.visibility=e;this.display(e);this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});this.events.triggerEvent("visibilitychanged")}},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){if(e!=this.isBaseLayer){this.isBaseLayer=e;null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this})}},initResolutions:function(){var e,t,n,r,i,s={},o=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++){s[n=this.RESOLUTION_PROPERTIES[e]]=this.options[n];o&&this.options[n]&&(o=!1)}null==this.options.alwaysInRange&&(this.alwaysInRange=o);null==s.resolutions&&(s.resolutions=this.resolutionsFromScales(s.scales));null==s.resolutions&&(s.resolutions=this.calculateResolutions(s));if(null==s.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)s[n=this.RESOLUTION_PROPERTIES[e]]=null!=this.options[n]?this.options[n]:this.map[n];null==s.resolutions&&(s.resolutions=this.resolutionsFromScales(s.scales));null==s.resolutions&&(s.resolutions=this.calculateResolutions(s))}this.options.maxResolution&&"auto"!==this.options.maxResolution&&(r=this.options.maxResolution);this.options.minScale&&(r=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));this.options.minResolution&&"auto"!==this.options.minResolution&&(i=this.options.minResolution);this.options.maxScale&&(i=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));if(s.resolutions){s.resolutions.sort(function(e,t){return t-e});r||(r=s.resolutions[0]);if(!i){var a=s.resolutions.length-1;i=s.resolutions[a]}}this.resolutions=s.resolutions;if(this.resolutions){t=this.resolutions.length;this.scales=new Array(t);for(e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=i;i&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(i,this.units));this.maxResolution=r;r&&(this.minScale=OpenLayers.Util.getScaleFromResolution(r,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,n,r;r=e.length;t=new Array(r);for(n=0;n<r;n++)t[n]=OpenLayers.Util.getResolutionFromScale(e[n],this.units);return t}},calculateResolutions:function(e){var t,n,r,i=e.maxResolution;if(null!=e.minScale)i=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units);else if("auto"==i&&null!=this.maxExtent){t=this.map.getSize();n=this.maxExtent.getWidth()/t.w;r=this.maxExtent.getHeight()/t.h;i=Math.max(n,r)}var s=e.minResolution;if(null!=e.maxScale)s=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units);else if("auto"==e.minResolution&&null!=this.minExtent){t=this.map.getSize();n=this.minExtent.getWidth()/t.w;r=this.minExtent.getHeight()/t.h;s=Math.max(n,r)}if("number"!=typeof i&&"number"!=typeof s&&null!=this.maxExtent){var o=this.map.getTileSize();i=Math.max(this.maxExtent.getWidth()/o.w,this.maxExtent.getHeight()/o.h)}var a=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof s&&"number"==typeof i&&void 0===l){var c=i/s;l=Math.floor(Math.log(c)/Math.log(2))+1}else void 0===l&&null!=a&&(l=a+1);if(!("number"!=typeof l||l<=0||"number"!=typeof i&&"number"!=typeof s)){var u,h=new Array(l),p=2;"number"==typeof s&&"number"==typeof i&&(p=Math.pow(i/s,1/(l-1)));if("number"==typeof i)for(u=0;u<l;u++)h[u]=i/Math.pow(p,u);else for(u=0;u<l;u++)h[l-1-u]=s*Math.pow(p,u);return h}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var n=this.map.getSize(),r=Math.max(e.getWidth()/n.w,e.getHeight()/n.h);return this.getZoomForResolution(r,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var n=Math.floor(e),r=Math.ceil(e);t=this.resolutions[n]-(e-n)*(this.resolutions[n]-this.resolutions[r])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var n,r,i;if(this.map.fractionalZoom){var s,o=0,a=this.resolutions.length-1,l=this.resolutions[o],c=this.resolutions[a];for(r=0,i=this.resolutions.length;r<i;++r){if((s=this.resolutions[r])>=e){l=s;o=r}if(s<=e){c=s;a=r;break}}var u=l-c;n=u>0?o+(l-e)/u:o}else{var h,p=Number.POSITIVE_INFINITY;for(r=0,i=this.resolutions.length;r<i;r++)if(t){if((h=Math.abs(this.resolutions[r]-e))>p)break;p=h}else if(this.resolutions[r]<e)break;n=Math.max(0,r-1)}return n},getLonLatFromViewPortPx:function(e){var t=null,n=this.map;if(null!=e&&n.minPx){var r=n.getResolution(),i=n.getMaxExtent({restricted:!0}),s=(e.x-n.minPx.x)*r+i.left,o=(n.minPx.y-e.y)*r+i.top;t=new OpenLayers.LonLat(s,o);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var n=null;if(null!=e){t=t||this.map.getResolution();var r=this.map.calculateBounds(null,t);n=new OpenLayers.Pixel(1/t*(e.lon-r.left),1/t*(r.top-e.lat))}return n},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,n=0,r=t.length;n<r;++n){var i=t[n].firstChild||t[n],s=t[n].lastChild;s&&"iframe"===s.nodeName.toLowerCase()&&(i=s.parentNode);OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var n={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,n)}return e},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,n,r){OpenLayers.Layer.prototype.initialize.apply(this,[e,r]);this.url=t;this.params||(this.params=OpenLayers.Util.extend({},n))},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));return e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var n=1,r=0,i=e.length;r<i;r++){n*=e.charCodeAt(r)*this.URL_HASH_FACTOR;n-=Math.floor(n)}return t[Math.floor(n*t.length)]},getFullRequestString:function(e,t){var n=t||this.url,r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var i=OpenLayers.Util.getParameterString(r);OpenLayers.Util.isArray(n)&&(n=this.selectUrl(i,n));var s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(n));for(var o in r)o.toUpperCase()in s&&delete r[o];i=OpenLayers.Util.getParameterString(r);return OpenLayers.Util.urlAppend(n,i)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,n,r,i,s){this.layer=e;this.position=t.clone();this.setBounds(n);this.url=r;i&&(this.size=i.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,s);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){if(this.isLoading){this.isLoading=!1;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.eventListeners=null;this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();t&&!e&&!1===this.events.triggerEvent("beforedraw")&&(t=null);return t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var n=this.layer.map,r=n.baseLayer.wrapDateLine&&n.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:r})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),n=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:n,rightTolerance:n})}this.bounds=e},moveTo:function(e,t,n){null==n&&(n=!0);this.setBounds(e);this.position=t.clone();n&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,n,r,i,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=r;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e){this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position));if(this.isLoading)this._loadEvent="reload";else{this.isLoading=!0;this._loadEvent="loadstart"}this.renderTile();this.positionTile()}else!1===e&&this.unload();return e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){if(e==this.asyncRequestId){this.url=t;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),n=1;this.layer instanceof OpenLayers.Layer.Grid&&(n=this.layer.getServerResolution()/this.layer.map.getResolution());e.left=this.position.x+"px";e.top=this.position.y+"px";e.width=Math.round(n*t.w)+"px";e.height=Math.round(n*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t);this.setImgSrc();!0===this.layerAlphaHack&&(e.style.filter="");OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,n=0;if(this.layer.gutter){t=this.layer.gutter/this.layer.tileSize.w*100;n=this.layer.gutter/this.layer.tileSize.h*100}e.left=-t+"%";e.top=-n+"%";e.width=2*t+100+"%";e.height=2*n+100+"%"}e.visibility="hidden";e.opacity=0;this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";if(this.layerAlphaHack){e.paddingTop=e.height;e.height="0";e.width="100%"}this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";if(this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url))this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0);else{this.stopLoading();this.crossOriginKeyword&&e.removeAttribute("crossorigin");OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)}}else this.isLoading=!1},setImgSrc:function(e){var t=this.imgDiv;if(e){t.style.visibility="hidden";t.style.opacity=0;this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin"));t.src=e}else{this.stopLoading();this.imgDiv=null;t.parentNode&&t.parentNode.removeChild(t)}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;this.frame?(e=this.frame.cloneNode(!1)).appendChild(this.imgDiv):e=this.imgDiv;this.imgDiv=null;return e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading();e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;if(null!=e.src){this.imageReloadAttempts++;if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS)this.setImgSrc(this.layer.getURL(this.bounds));else{OpenLayers.Element.addClass(e,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w;e.height=this.size.h;this.canvasContext=e.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;e.className="olTileImage";e.galleryImg="no";return e}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,n,r){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var n=this.grid[e],r=0,i=n.length;r<i;r++){var s=n[r];this.destroyTile(s)}this.grid=[];this.gridResolution=null;this.gridLayout=null}},addOptions:function(e,t){var n=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);if(this.map&&n){this.initProperties();this.clearGrid();this.tileSize=this.options.tileSize;this.setTileSize();this.moveTo(null,!0)}},clone:function(e){null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]);null!=this.tileSize&&(e.tileSize=this.tileSize.clone());e.grid=[];e.gridResolution=null;e.backBuffer=null;e.backBufferTimerId=null;e.loading=!1;e.numLoadingTiles=0;return e},moveTo:function(e,t,n){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);if(null!=(e=e||this.map.getExtent())){var r=!this.grid.length||t,i=this.getTilesBounds(),s=this.map.getResolution();this.getServerResolution(s);if(this.singleTile){if(r||!n&&!i.containsBounds(e)){t&&"resize"!==this.transitionEffect&&this.removeBackBuffer();t&&"resize"!==this.transitionEffect||this.applyBackBuffer(s);this.initSingleTile(e)}}else if(r=r||!i.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()})){!t||"resize"!==this.transitionEffect&&this.gridResolution!==s||this.applyBackBuffer(s);this.initGriddedTiles(e)}else this.moveGriddedTiles()}},getTileData:function(e){var t=null,n=e.lon,r=e.lat,i=this.grid.length;if(this.map&&i){var s=this.map.getResolution(),o=this.tileSize.w,a=this.tileSize.h,l=this.grid[0][0].bounds,c=l.left,u=l.top;if(n<c&&this.map.baseLayer.wrapDateLine){var h=this.map.getMaxExtent().getWidth();n+=h*Math.ceil((c-n)/h)}var p=(n-c)/(s*o),d=(u-r)/(s*a),f=Math.floor(p),y=Math.floor(d);if(y>=0&&y<i){var m=this.grid[y][f];m&&(t={tile:m,i:Math.floor((p-f)*o),j:Math.floor((d-y)*a)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e);e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var n,r,i,s;for(n=this.serverResolutions.length-1;n>=0;n--){i=this.serverResolutions[n];if((r=Math.abs(i-e))>t)break;t=r;s=i}e=s}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(!(t=this.createBackBuffer()))return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div);this.backBuffer=t;var n=this.grid[0][0].bounds;this.backBufferLonLat={lon:n.left,lat:n.top};this.backBufferResolution=this.gridResolution}for(var r,i=this.backBufferResolution/e,s=t.childNodes,o=s.length-1;o>=0;--o){(r=s[o]).style.top=(i*r._i*r._h|0)+"px";r.style.left=(i*r._j*r._w|0)+"px";r.style.width=Math.round(i*r._w)+"px";r.style.height=Math.round(i*r._h)+"px"}var a=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,c=this.map.layerContainerOriginPx.y;t.style.left=Math.round(a.x-l)+"px";t.style.top=Math.round(a.y-c)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){(e=document.createElement("div")).id=this.div.id+"_bb";e.className="olBackBuffer";e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var n=0,r=this.grid.length;n<r;n++)for(var i=0,s=this.grid[n].length;i<s;i++){var o=this.grid[n][i],a=this.grid[n][i].createBackBuffer();if(a){a._i=n;a._j=i;a._w=o.size.w;a._h=o.size.h;a.id=o.id+"_bb";e.appendChild(a)}}}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}if(this.backBuffer){this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer);this.backBuffer=null;this.backBufferResolution=null;if(null!==this.backBufferTimerId){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){if(this.singleTile){(e=this.map.getSize()).h=parseInt(e.h*this.ratio,10);e.w=parseInt(e.w*this.ratio,10)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var n=this.grid[t-1][0].bounds,r=this.grid[0].length*n.getWidth(),i=this.grid.length*n.getHeight();e=new OpenLayers.Bounds(n.left,n.bottom,n.left+r,n.bottom+i)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),n=e.getWidth()*this.ratio,r=e.getHeight()*this.ratio,i=new OpenLayers.Bounds(t.lon-n/2,t.lat-r/2,t.lon+n/2,t.lat+r/2),s=this.map.getLayerPxFromLonLat({lon:i.left,lat:i.top});this.grid.length||(this.grid[0]=[]);var o=this.grid[0][0];if(o)o.moveTo(i,s);else{o=this.addTile(i,s);this.addTileMonitoringHooks(o);o.draw();this.grid[0][0]=o}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,n){var r=n*this.tileSize.w,i=n*this.tileSize.h,s=e.left-t.lon,o=Math.floor(s/r)-this.buffer,a=this.rowSign,l=a*(t.lat-e.top+i);return{tilelon:r,tilelat:i,startcol:o,startrow:Math[~a?"floor":"ceil"](l/i)-this.buffer*a}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),n={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[n[0]],t[n[1]])}return e},getTileBoundsForGridIndex:function(e,t){var n=this.getTileOrigin(),r=this.gridLayout,i=r.tilelon,s=r.tilelat,o=r.startcol,a=r.startrow,l=this.rowSign;return new OpenLayers.Bounds(n.lon+(o+t)*i,n.lat-(a+e*l)*s*l,n.lon+(o+t+1)*i,n.lat-(a+(e-1)*l)*s*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),n=this.getTileOrigin(),r=this.map.getResolution(),i=this.getServerResolution(),s=r/i,o={w:this.tileSize.w/s,h:this.tileSize.h/s},a=Math.ceil(t.h/o.h)+2*this.buffer+1,l=Math.ceil(t.w/o.w)+2*this.buffer+1,c=this.calculateGridLayout(e,n,i);this.gridLayout=c;var u=c.tilelon,h=c.tilelat,p=this.map.layerContainerOriginPx.x,d=this.map.layerContainerOriginPx.y,f=this.getTileBoundsForGridIndex(0,0),y=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));y.x=Math.round(y.x)-p;y.y=Math.round(y.y)-d;var m=[],g=this.map.getCenter(),C=0;do{var v=this.grid[C];if(!v){v=[];this.grid.push(v)}var T=0;do{f=this.getTileBoundsForGridIndex(C,T);var L=y.clone();L.x=L.x+T*Math.round(o.w);L.y=L.y+C*Math.round(o.h);var S=v[T];if(S)S.moveTo(f,L,!1);else{S=this.addTile(f,L);this.addTileMonitoringHooks(S);v.push(S)}var b=f.getCenterLonLat();m.push({tile:S,distance:Math.pow(b.lon-g.lon,2)+Math.pow(b.lat-g.lat,2)});T+=1}while(f.right<=e.right+u*this.buffer||T<l);C+=1}while(f.bottom>=e.bottom-h*this.buffer||C<a);this.removeExcessTiles(C,T);r=this.getServerResolution();this.gridResolution=r;m.sort(function(e,t){return e.distance-t.distance});for(var w=0,E=m.length;w<E;++w)m[w].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var n=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:n});return n},addTileMonitoringHooks:function(e){e.onLoadStart=function(){if(!1===this.loading){this.loading=!0;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:e});this.numLoadingTiles++;!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),"olTileReplacing")};e.onLoadEnd=function(t){this.numLoadingTiles--;var n="unload"===t.type;this.events.triggerEvent("tileloaded",{tile:e,aborted:n});if(!this.singleTile&&!n&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var r=e.getTile();if("none"===OpenLayers.Element.getStyle(r,"display")){var i=document.getElementById(e.id+"_bb");i&&i.parentNode.removeChild(i)}OpenLayers.Element.removeClass(r,"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=n?this.div.lastChild:e.imgDiv;for(var s=this.transitionendEvents,o=s.length-1;o>=0;--o)OpenLayers.Event.observe(this._transitionElement,s[o],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1;this.events.triggerEvent("loadend")}};e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})};e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload();e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],n={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},r=this.getServerResolution()/this.map.getResolution(),i={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)};if(n.x>-i.w*(e-1))this.shiftColumn(!0,i);else if(n.x<-i.w*e)this.shiftColumn(!1,i);else if(n.y>-i.h*(e-1))this.shiftRow(!0,i);else{if(!(n.y<-i.h*e))break;this.shiftRow(!1,i)}}},shiftRow:function(e,t){var n=this.grid,r=e?0:n.length-1,i=e?-1:1,s=this.rowSign;this.gridLayout.startrow+=i*s;for(var o=n[r],a=n[e?"pop":"shift"](),l=0,c=a.length;l<c;l++){var u=a[l],h=o[l].position.clone();h.y+=t.h*i;u.moveTo(this.getTileBoundsForGridIndex(r,l),h)}n[e?"unshift":"push"](a)},shiftColumn:function(e,t){var n=this.grid,r=e?0:n[0].length-1,i=e?-1:1;this.gridLayout.startcol+=i;for(var s=0,o=n.length;s<o;s++){var a=n[s],l=a[r].position.clone(),c=a[e?"pop":"shift"]();l.x+=t.w*i;c.moveTo(this.getTileBoundsForGridIndex(s,r),l);a[e?"unshift":"push"](c)}},removeExcessTiles:function(e,t){for(var n,r;this.grid.length>e;){for(n=0,r=(s=this.grid.pop()).length;n<r;n++){var i=s[n];this.destroyTile(i)}}for(n=0,r=this.grid.length;n<r;n++)for(;this.grid[n].length>t;){var s;i=(s=this.grid[n]).pop();this.destroyTile(i)}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var t=this.maxExtent,n=this.getResolution(),r=n*this.tileSize.w,i=n*this.tileSize.h,s=this.getLonLatFromViewPortPx(e),o=t.left+r*Math.floor((s.lon-t.left)/r),a=t.bottom+i*Math.floor((s.lat-t.bottom)/i);return new OpenLayers.Bounds(o,a,o+r,a+i)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){for(var t in{url:!0,layer:!0,style:!0,matrixSet:!0})if(!(t in e))throw new Error("Missing property '"+t+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var n=[e.name,e.url,e.params,e];OpenLayers.Layer.Grid.prototype.initialize.apply(this,n);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds){var r=this.matrixIds.length;if(r&&"string"==typeof this.matrixIds[0]){var i=this.matrixIds;this.matrixIds=new Array(r);for(var s=0;s<r;++s)this.matrixIds[s]={identifier:i[s]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner);this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight));this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top));this.tileFullExtent||(this.tileFullExtent=this.maxExtent)}},moveTo:function(e,t,n){!t&&this.matrix||this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMTS(this.options));return e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0]){for(var t,n=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,r=Number.POSITIVE_INFINITY,i=0,s=this.matrixIds.length;i<s;++i)if((t=Math.abs(1-this.matrixIds[i].scaleDenominator/n))<r){r=t;e=this.matrixIds[i]}}else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),n=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),r=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),i=Math.floor(n),s=Math.floor(r);return{col:i,row:s,i:Math.floor((n-i)*this.tileSize.w),j:Math.floor((r-s)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var n,r=e.getCenterLonLat(),i=this.getTileInfo(r),s=(this.matrix.identifier,this.dimensions);t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,i.row,i.col].join(","),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase()){n=this.params;if(-1!==t.indexOf("{")){var o=t.replace(/\{/g,"${"),a={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:i.row,TileCol:i.col};if(s){var l;for(u=s.length-1;u>=0;--u)a[l=s[u]]=n[l.toUpperCase()]}t=OpenLayers.String.format(o,a)}else{var c=this.version+"/"+this.layer+"/"+this.style+"/";if(s)for(var u=0;u<s.length;u++)n[s[u]]&&(c=c+n[s[u]]+"/");c=c+this.matrixSet+"/"+this.matrix.identifier+"/"+i.row+"/"+i.col+"."+this.formatSuffix;t.match(/\/$/)||(t+="/");t+=c}}else if("KVP"===this.requestEncoding.toUpperCase()){n={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:i.row,TILECOL:i.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[n])}}return t},mergeNewParams:function(e){if("KVP"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)])},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,n=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--n>0&&e);return t},ignore:function(e){var t=3,n=!1;do{if("a"===e.nodeName.toLowerCase()){n=!0;break}e=e.parentNode}while(--t>0&&e);return n},buttonClick:function(e){var t=!0,n=OpenLayers.Event.element(e);if(n&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var r=this.getPressedButton(n);if(r){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:r});OpenLayers.Event.stop(e);t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var i=OpenLayers.Util.pagePosition(r),s=OpenLayers.Util.getViewportElement(),o=window.pageYOffset||s.scrollTop,a=window.pageXOffset||s.scrollLeft;i[0]=i[0]-a;i[1]=i[1]-o;this.target.triggerEvent("buttonclick",{buttonElement:r,buttonXY:{x:this.startEvt.clientX-i[0],y:this.startEvt.clientY-i[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt;OpenLayers.Event.stop(e);t=!1}if(this.startRegEx.test(e.type)){this.startEvt=e;OpenLayers.Event.stop(e);t=!1}}else{t=!this.ignore(OpenLayers.Event.element(e));delete this.startEvt}}return t}});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[e]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t;this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var n=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;(t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom).loadXML(e);return t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1);t.overrideMimeType&&t.overrideMimeType("text/xml");t.send(null);return t.responseXML});this.keepData&&(this.data=n);return n},write:function(e){var t;if(this.xmldom)t=e.xml;else{var n=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0));r.appendChild(e);t=n.serializeToString(r)}else t=n.serializeToString(e)}return t},createElementNS:function(e,t){return this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){"string"!=typeof e&&(e=String(e));return this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,n){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,n);else for(var i,s,o=e.getElementsByTagName("*"),a=0,l=o.length;a<l;++a){s=(i=o[a]).prefix?i.prefix+":"+n:n;"*"!=n&&s!=i.nodeName||"*"!=t&&t!=i.namespaceURI||r.push(i)}return r},getAttributeNodeNS:function(e,t,n){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,n);else for(var i,s=e.attributes,o=0,a=s.length;o<a;++o)if((i=s[o]).namespaceURI==t&&(i.prefix?i.prefix+":"+n:n)==i.nodeName){r=i;break}return r},getAttributeNS:function(e,t,n){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,n)||"";else{var i=this.getAttributeNodeNS(e,t,n);i&&(r=i.nodeValue)}return r},getChildValue:function(e,t){var n=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:n+=r.nodeValue}return n},isSimpleContent:function(e){for(var t=!0,n=e.firstChild;n;n=n.nextSibling)if(1===n.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,n=!1,r=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,i=e.firstChild;i;i=i.nextSibling){switch(i.nodeType){case 1:n=!0;break;case 8:break;default:t=!0}if(n&&t)break}if(n&&t)r=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(n)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,n){return e.hasAttributeNS?e.hasAttributeNS(t,n):!!this.getAttributeNodeNS(e,t,n)},setAttributeNS:function(e,t,n,r){if(e.setAttributeNS)e.setAttributeNS(t,n,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var i=e.ownerDocument.createNode(2,n,t);i.nodeValue=r;e.setAttributeNode(i)}else e.setAttribute(n,r)}},createElementNSPlus:function(e,t){var n=(t=t||{}).uri||this.namespaces[t.prefix];if(!n){var r=e.indexOf(":");n=this.namespaces[e.substring(0,r)]}n||(n=this.namespaces[this.defaultPrefix]);var i=this.createElementNS(n,e);t.attributes&&this.setAttributes(i,t.attributes);var s=t.value;null!=s&&i.appendChild(this.createTextNode(s));return i},setAttributes:function(e,t){var n,r;for(var i in t)if(null!=t[i]&&t[i].toString){n=t[i].toString();r=this.namespaces[i.substring(0,i.indexOf(":"))]||null;this.setAttributeNS(e,r,i,n)}},readNode:function(e,t){t||(t={});var n=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(n){var r=n[e.localName||e.nodeName.split(":").pop()]||n["*"];r&&r.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var n,r=e.childNodes,i=0,s=r.length;i<s;++i)1==(n=r[i]).nodeType&&this.readNode(n,t);return t},writeNode:function(e,t,n){var r,i,s=e.indexOf(":");if(s>0){r=e.substring(0,s);i=e.substring(s+1)}else{r=n?this.namespaceAlias[n.namespaceURI]:this.defaultPrefix;i=e}var o=this.writers[r][i].apply(this,[t]);n&&n.appendChild(o);return o},getChildEl:function(e,t,n){return e&&this.getThisOrNextEl(e.firstChild,t,n)},getNextEl:function(e,t,n){return e&&this.getThisOrNextEl(e.nextSibling,t,n)},getThisOrNextEl:function(e,t,n){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||n&&n!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var n=null;if(e)if(e.lookupNamespaceURI)n=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){n=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var i,s=0;s<r;++s){if("xmlns"===(i=e.attributes[s]).prefix&&i.name==="xmlns:"+t){n=i.value||null;break e}if("xmlns"===i.name&&null===t){n=i.value||null;break e}}n=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:n=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:n=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:n=this.lookupNamespaceURI(e.parentNode,t)}return n},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,n){this.layer=e;this.lonlat=t;this.data=null!=n?n:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(null!=this.marker){this.destroyMarker(this.marker);this.marker=null}if(null!=this.popup){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){e=this.layer.map.getExtent().containsLonLat(this.lonlat)}return e},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,n=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new n(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow);this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,n){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]);this.lonlat=null;this.geometry=e||null;this.state=null;this.attributes={};t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t));this.style=n||null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var n=this.layer.map.getExtent();if(e){var r=this.geometry.getBounds();t=n.intersectsBounds(r)}else{t=n.toGeometry().intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,n){var r=!1;this.geometry&&(r=this.geometry.atPoint(e,t,n));return r},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var n=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),r=this.layer.map.getResolution();this.geometry.move(r*(t.x-n.x),r*(n.y-t.y));this.layer.drawFeature(this);return n}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.rules=[];t&&t.rules&&this.addRules(t.rules);this.setDefaultStyle(e||OpenLayers.Feature.Vector.style.default);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++){this.rules[e].destroy();this.rules[e]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(e){for(var t,n=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),r=this.rules,i=[],s=!1,o=0,a=r.length;o<a;o++){if((t=r[o]).evaluate(e))if(t instanceof OpenLayers.Rule&&t.elseFilter)i.push(t);else{s=!0;this.applySymbolizer(t,n,e)}}if(0==s&&i.length>0){s=!0;for(o=0,a=i.length;o<a;o++)this.applySymbolizer(i[o],n,e)}r.length>0&&0==s&&(n.display="none");null!=n.label&&"string"!=typeof n.label&&(n.label=String(n.label));return n},applySymbolizer:function(e,t,n){var r=n.geometry?this.getSymbolizerPrefix(n.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],i=e.symbolizer[r]||e.symbolizer;if(!0===this.defaultsPerSymbolizer){var s=this.defaultStyle;OpenLayers.Util.applyDefaults(i,{pointRadius:s.pointRadius});!0!==i.stroke&&!0!==i.graphic||OpenLayers.Util.applyDefaults(i,{strokeWidth:s.strokeWidth,strokeColor:s.strokeColor,strokeOpacity:s.strokeOpacity,strokeDashstyle:s.strokeDashstyle,strokeLinecap:s.strokeLinecap});!0!==i.fill&&!0!==i.graphic||OpenLayers.Util.applyDefaults(i,{fillColor:s.fillColor,fillOpacity:s.fillOpacity});!0===i.graphic&&OpenLayers.Util.applyDefaults(i,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,i),n)},createLiterals:function(e,t){var n=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(n,this.context);for(var r in this.propertyStyles)e[r]=OpenLayers.Style.createLiteral(e[r],n,t,r);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var n,r,i=this.rules,s=0,o=i.length;s<o;s++){n=i[s].symbolizer;for(var a in n){if("object"!=typeof(r=n[a])){this.addPropertyStyles(e,n);break}this.addPropertyStyles(e,r)}}return e},addPropertyStyles:function(e,t){var n;for(var r in t)"string"==typeof(n=t[r])&&n.match(/\$\{\w+\}/)&&(e[r]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,n=0,r=t.length;n<r;n++)if(-1!=e.CLASS_NAME.indexOf(t[n]))return t[n]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,n=this.rules.length;t<n;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var r=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(r,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,t,n,r){if("string"==typeof e&&-1!=e.indexOf("${")){e=OpenLayers.String.format(e,t,[n,r]);e=isNaN(e)||!e?e:parseFloat(e)}return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var n=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(n=this.value.toGeometry());e.geometry.intersects(n)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,n=this.fids.length;t<n;t++){if((e.fid||e.id)==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(e,this);e.fids=this.fids.slice();return e},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var n=t&&t.srsName;n||(n=e&&e.layer?e.layer.projection.getCode():this.srsName);return n},read:function(e,t){t=t||{};OpenLayers.Util.applyDefaults(t,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var n={};e&&this.readNode(e,n,!0);n.features&&"features"===t.output&&(n=n.features);return n},readers:{wfs:{FeatureCollection:function(e,t){t.features=[];this.readChildNodes(e,t)}}},write:function(e,t){var n=this.writeNode("wfs:Transaction",{features:e,options:t}),r=this.schemaLocationAttr();r&&this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",r);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var n=0,r=this.featureType.length;n<r;n++){e.featureType=this.featureType[n];this.writeNode("Query",e,t)}return t},Transaction:function(e){var t,n,r=(e=e||{}).options||{},i=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:r.handle}}),s=e.features;if(s){!0===r.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var o,a;for(t=0,n=s.length;t<n;++t){a=s[t];(o=this.stateName[a.state])&&this.writeNode(o,{feature:a,options:r},i)}!0===r.multi&&this.setGeometryTypes()}if(r.nativeElements)for(t=0,n=r.nativeElements.length;t<n;++t)this.writeNode("wfs:Native",r.nativeElements[t],i);return i},Native:function(e){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value})},Insert:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:n&&n.handle}});this.srsName=this.getSrsName(t);this.writeNode("feature:_typeName",t,r);return r},Update:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Update",{attributes:{handle:n&&n.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=t.modified;if(null!==this.geometryName&&(!i||void 0!==i.geometry)){this.srsName=this.getSrsName(t);this.writeNode("Property",{name:this.geometryName,value:t.geometry},r)}for(var s in t.attributes)void 0===t.attributes[s]||i&&i.attributes&&(!i.attributes||void 0===i.attributes[s])||this.writeNode("Property",{name:s,value:t.attributes[s]},r);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");this.writeNode("Name",e.name,t);null!==e.value&&this.writeNode("Value",e.value,t);return t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var n=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(n)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:n&&n.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var n,r=[];for(var i in t)(n=this.namespaces[i])&&r.push(n+" "+t[i]);return r.join(" ")||void 0},setFilterProperty:function(e){if(e.filters)for(var t=0,n=e.filters.length;t<n;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t={exceptionReport:null};if(e.documentElement){this.readChildNodes(e,t);null===t.exceptionReport&&(t=(new OpenLayers.Format.OWSCommon).read(e))}return t},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]};this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var n={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(n)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var n;e?(n=this.version)||(n=e.getAttribute("version"))||(n=this.defaultVersion):n=t&&t.version||this.version||this.defaultVersion;return n},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var n=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!n){if(""!==t&&this.allowFallback){t="";n=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]}if(!n)throw"Can't find a "+this.name+" parser for version "+e+t}this.parser=new n(this.options)}return this.parser},write:function(e,t){var n=this.getVersion(null,t);this.parser=this.getParser(n);var r=this.parser.write(e,t);return!1===this.stringifyOutput?r:OpenLayers.Format.XML.prototype.write.apply(this,[r])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var n=e.documentElement,r=this.getVersion(n);this.parser=this.getParser(r);var i=this.parser.read(e,t),s=this.parser.errorProperty||null;if(null!==s&&void 0===i[s]){var o=new OpenLayers.Format.OGCExceptionReport;i.error=o.read(e)}i.version=r;return i},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,n;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,n=this.filters.length;t<n;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,n=this.filters.length;t<n;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}},clone:function(){for(var e=[],t=0,n=this.filters.length;t<n;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,n=!1,r=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value;n=this.matchCase||"string"!=typeof r||"string"!=typeof t?r==t:r.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value;n=this.matchCase||"string"!=typeof r||"string"!=typeof t?r!=t:r.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:n=r<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:n=r>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:n=r<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:n=r>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:n=r>=this.lowerBoundary&&r<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:n=new RegExp(this.value,"gi").test(r);break;case OpenLayers.Filter.Comparison.IS_NULL:n=null===r}return n},value2regex:function(e,t,n){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");e=e||"*";t=t||".";n=n||"!";this.value=this.value.replace(new RegExp("\\"+n+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+t,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t);return this.value},regex2value:function(){var e=this.value;return e=(e=(e=(e=(e=e.replace(/!/g,"!!")).replace(/(\\)?\\\./g,function(e,t){return t?e:"!."})).replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"})).replace(/\\\\/g,"\\")).replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){return isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"},parse:function(e){var t,n=e.match(this.dateRegEx);if(n&&(n[1]||n[7])){var r=parseInt(n[1],10)||0,i=parseInt(n[2],10)-1||0,s=parseInt(n[3],10)||1;t=new Date(Date.UTC(r,i,s));var o=n[7];if(o){var a=parseInt(n[4],10),l=parseInt(n[5],10),c=parseFloat(n[6]),u=0|c,h=Math.round(1e3*(c-u));t.setUTCHours(a,l,u,h);if("Z"!==o){var p=-1e3*(60*parseInt(o,10)*60+60*(parseInt(n[8],10)||0));t=new Date(t.getTime()+p)}}}else t=new Date("invalid");return t}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};this.readers.ogc.Filter.apply(this,[e,t]);return t.filter},readers:{ogc:{_expression:function(e){for(var t,n="",r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 1:(t=this.readNode(r)).property?n+="${"+t.property+"}":void 0!==t.value&&(n+=t.value);break;case 3:case 4:n+=r.nodeValue}return n},Filter:function(e,t){var n={fids:[],filters:[]};this.readChildNodes(e,n);n.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:n.fids}):n.filters.length>0&&(t.filter=n.filters[0])},FeatureId:function(e,t){var n=e.getAttribute("fid");n&&t.fids.push(n)},And:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,n);t.filters.push(n)},Or:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,n);t.filters.push(n)},Not:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLessThan:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsGreaterThan:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLessThanOrEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsGreaterThanOrEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsBetween:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,n);t.filters.push(n)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e));t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,n);t.filters.push(n)}}},readSpatial:function(e,t,n){var r=new OpenLayers.Filter.Spatial({type:n});this.readChildNodes(e,r);r.value=r.components[0];delete r.components;t.filters.push(r)},encodeLiteral:function(e){e instanceof Date&&(e=OpenLayers.Date.toISOString(e));return e},writeOgcExpression:function(e,t){e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(e),e,t);return t},_featureIds:function(e){for(var t=this.createDocumentFragment(),n=0,r=e.fids.length;n<r;++n)this.writeNode("ogc:FeatureId",e.fids[n],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,n=this.createElementNSPlus("ogc:And"),r=0,i=e.filters.length;r<i;++r){t=e.filters[r];this.writeNode(this.getFilterType(t),t,n)}return n},Or:function(e){for(var t,n=this.createElementNSPlus("ogc:Or"),r=0,i=e.filters.length;r<i;++r){t=e.filters[r];this.writeNode(this.getFilterType(t),t,n)}return n},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),n=e.filters[0];this.writeNode(this.getFilterType(n),n,t);return t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",e,t);this.writeNode("LowerBoundary",e,t);this.writeNode("UpperBoundary",e,t);return t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(e.lowerBoundary,t);return t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",e.upperBoundary,t);return t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");this.writeNode("Distance",e,t);return t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),n=e.params,r=0,i=n.length;r<i;r++)this.writeOgcExpression(n[r],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",e,t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,n){var r=!1;if(null!=this.getBounds()&&null!=e){var i=null!=t?t:0,s=null!=n?n:0;r=new OpenLayers.Bounds(this.bounds.left-i,this.bounds.bottom-s,this.bounds.right+i,this.bounds.top+s).containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var n=OpenLayers.Geometry.fromWKT.format;if(!n){n=new OpenLayers.Format.WKT;OpenLayers.Geometry.fromWKT.format=n}var r=n.read(e);if(r instanceof OpenLayers.Feature.Vector)t=r.geometry;else if(OpenLayers.Util.isArray(r)){for(var i=r.length,s=new Array(i),o=0;o<i;++o)s[o]=r[o].geometry;t=new OpenLayers.Geometry.Collection(s)}}return t};OpenLayers.Geometry.segmentsIntersect=function(e,t,n){var r=n&&n.point,i=n&&n.tolerance,s=!1,o=e.x1-t.x1,a=e.y1-t.y1,l=e.x2-e.x1,c=e.y2-e.y1,u=t.y2-t.y1,h=t.x2-t.x1,p=u*l-h*c,d=h*a-u*o,f=l*a-c*o;if(0==p)0==d&&0==f&&(s=!0);else{var y=d/p,m=f/p;if(y>=0&&y<=1&&m>=0&&m<=1)if(r){var g=e.x1+y*l,C=e.y1+y*c;s=new OpenLayers.Geometry.Point(g,C)}else s=!0}if(i){if(s){if(r){var v,T=[e,t];e:for(var L=0;L<2;++L){v=T[L];for(var S=1;S<3;++S){g=v["x"+S];C=v["y"+S];if(Math.sqrt(Math.pow(g-s.x,2)+Math.pow(C-s.y,2))<i){s.x=g;s.y=C;break e}}}}}else{var b,w,E;T=[e,t];e:for(L=0;L<2;++L){b=T[L];w=T[(L+1)%2];for(S=1;S<3;++S){E={x:b["x"+S],y:b["y"+S]};if(OpenLayers.Geometry.distanceToSegment(E,w).distance<i){s=!r||new OpenLayers.Geometry.Point(E.x,E.y);break e}}}}}return s};OpenLayers.Geometry.distanceToSegment=function(e,t){var n=OpenLayers.Geometry.distanceSquaredToSegment(e,t);n.distance=Math.sqrt(n.distance);return n};OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var n,r,i=e.x,s=e.y,o=t.x1,a=t.y1,l=t.x2,c=t.y2,u=l-o,h=c-a,p=(u*(i-o)+h*(s-a))/(Math.pow(u,2)+Math.pow(h,2));if(p<=0){n=o;r=a}else if(p>=1){n=l;r=c}else{n=o+p*u;r=a+p*h}return{distance:Math.pow(n-i,2)+Math.pow(r-s,2),x:n,y:r,along:p}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(e);this.y=parseFloat(t)},clone:function(e){null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(e,this);return e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var n,r,i,s,o,a,l=!(t&&!1===t.edge)&&t&&t.details;if(e instanceof OpenLayers.Geometry.Point){r=this.x;i=this.y;s=e.x;o=e.y;n=Math.sqrt(Math.pow(r-s,2)+Math.pow(i-o,2));a=l?{x0:r,y0:i,x1:s,y1:o,distance:n}:n}else{a=e.distanceTo(this,t);l&&(a={x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0,distance:a.distance})}return a},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e;this.y=this.y+t;this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var n=this.distanceTo(t),r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+n*Math.cos(r);this.y=t.y+n*Math.sin(r);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,n){n=void 0==n?1:n;this.x=t.x+e*n*(this.x-t.x);this.y=t.y+e*(this.y-t.y);this.clearBounds();return this},intersects:function(e){return"OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){if(e&&t){OpenLayers.Projection.transform(this,e,t);this.bounds=null}return this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){for(var e=[],t=0,n=this.components.length;t<n;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var n=0,r=t.length;n<r;n++)e.extend(t[n].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;t++)this.addComponent(e[t])},addComponent:function(e,t){var n=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var r=this.components.slice(0,t),i=this.components.slice(t,this.components.length);r.push(e);this.components=r.concat(i)}else this.components.push(e);e.parent=this;this.clearBounds();n=!0}return n},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var n=e.length-1;n>=0;--n)t=this.removeComponent(e[n])||t;return t},removeComponent:function(e){OpenLayers.Util.removeItem(this.components,e);this.clearBounds();return!0},getLength:function(){for(var e=0,t=0,n=this.components.length;t<n;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,n=this.components.length;t<n;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,n=0,r=this.components.length;n<r;n++)t+=this.components[n].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var n,r=[],i=[],s=0,o=Number.MAX_VALUE,a=0;a<t;++a){var l=(n=this.components[a]).getArea(),c=n.getCentroid(!0);if(!(isNaN(l)||isNaN(c.x)||isNaN(c.y))){r.push(l);s+=l;o=l<o&&l>0?l:o;i.push(c)}}t=r.length;if(0===s){for(a=0;a<t;++a)r[a]=1;s=r.length}else{for(a=0;a<t;++a)r[a]/=o;s/=o}var u=0,h=0;for(a=0;a<t;++a){c=i[a];l=r[a];u+=c.x*l;h+=c.y*l}return new OpenLayers.Geometry.Point(u/s,h/s)},getGeodesicLength:function(e){for(var t=0,n=0,r=this.components.length;n<r;n++)t+=this.components[n].getGeodesicLength(e);return t},move:function(e,t){for(var n=0,r=this.components.length;n<r;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,r=this.components.length;n<r;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var r=0;r<this.components.length;++r)this.components[r].resize(e,t,n);return this},distanceTo:function(e,t){for(var n,r,i,s=!(t&&!1===t.edge)&&t&&t.details,o=Number.POSITIVE_INFINITY,a=0,l=this.components.length;a<l;++a){n=this.components[a].distanceTo(e,t);if((i=s?n.distance:n)<o){r=n;if(0==(o=i))break}}return r},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var n=0,r=this.components.length;n<r;++n)if(!this.components[n].equals(e.components[n])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var n=0,r=this.components.length;n<r;n++){this.components[n].transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,n=0,r=this.components.length;n<r&&!(t=e.intersects(this.components[n]));++n);return t},getVertices:function(e){for(var t=[],n=0,r=this.components.length;n<r;++n)Array.prototype.push.apply(t,this.components[n].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,n=this.components.length;t<n;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}var r=0;if(t.components&&t.components.length>1)for(var i,s,o=1,a=t.components.length;o<a;o++){i=t.components[o-1];s=t.components[o];r+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:s.x,lat:s.y})}return 1e3*r},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return t},intersects:function(e){var t=!1,n=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==n||"OpenLayers.Geometry.LinearRing"==n||"OpenLayers.Geometry.Point"==n){var r,i,s,o,a,l,c,u,h,p=this.getSortedSegments();r="OpenLayers.Geometry.Point"==n?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();e:for(var d=0,f=p.length;d<f;++d){s=(i=p[d]).x1;o=i.x2;a=i.y1;l=i.y2;for(var y=0,m=r.length;y<m&&!((c=r[y]).x1>o);++y)if(!(c.x2<s)){u=c.y1;h=c.y2;if(!(Math.min(u,h)>Math.max(a,l))&&!(Math.max(u,h)<Math.min(a,l))&&OpenLayers.Geometry.segmentsIntersect(i,c)){t=!0;break e}}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,n=this.components.length-1,r=new Array(n),i=0;i<n;++i){e=this.components[i];t=this.components[i+1];e.x<t.x?r[i]={x1:e.x,y1:e.y,x2:t.x,y2:t.y}:r[i]={x1:t.x,y1:t.y,x2:e.x,y2:e.y}}return r.sort(function(e,t){return e.x1-t.x1})},splitWithSegment:function(e,t){for(var n,r,i,s,o=!(t&&!1===t.edge),a=t&&t.tolerance,l=[],c=this.getVertices(),u=[],h=[],p=!1,d={point:!0,tolerance:a},f=null,y=0,m=c.length-2;y<=m;++y){n=c[y];u.push(n.clone());r=c[y+1];s={x1:n.x,y1:n.y,x2:r.x,y2:r.y};if((i=OpenLayers.Geometry.segmentsIntersect(e,s,d))instanceof OpenLayers.Geometry.Point&&(!!(i.x===e.x1&&i.y===e.y1||i.x===e.x2&&i.y===e.y2||i.equals(n)||i.equals(r))||o)){i.equals(h[h.length-1])||h.push(i.clone());if(0===y&&i.equals(n))continue;if(i.equals(r))continue;p=!0;i.equals(n)||u.push(i);l.push(new OpenLayers.Geometry.LineString(u));u=[i.clone()]}}if(p){u.push(r.clone());l.push(new OpenLayers.Geometry.LineString(u))}if(h.length>0){var g=e.x1<e.x2?1:-1,C=e.y1<e.y2?1:-1;f={lines:l,points:h.sort(function(e,t){return g*e.x-g*t.x||C*e.y-C*t.y})}}return f},split:function(e,t){var n,r,i,s,o=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,c,u,h,p,d,f=this.getVertices(),y=[];i=[];for(var m=0,g=f.length-2;m<=g;++m){l=f[m];c=f[m+1];u={x1:l.x,y1:l.y,x2:c.x,y2:c.y};s=s||[e];a&&y.push(l.clone());for(var C=0;C<s.length;++C)if(h=s[C].splitWithSegment(u,t)){if((p=h.lines).length>0){p.unshift(C,1);Array.prototype.splice.apply(s,p);C+=p.length-2}if(a)for(var v=0,T=h.points.length;v<T;++v)if(!(d=h.points[v]).equals(l)){y.push(d);i.push(new OpenLayers.Geometry.LineString(y));y=d.equals(c)?[]:[d.clone()]}}}if(a&&i.length>0&&y.length>0){y.push(c.clone());i.push(new OpenLayers.Geometry.LineString(y))}}else o=e.splitWith(this,t);s&&s.length>1?r=!0:s=[];i&&i.length>1?n=!0:i=[];(r||n)&&(o=a?[i,s]:s);return o},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var n,r=!(t&&!1===t.edge)&&t&&t.details,i={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,a=this.getSortedSegments(),l=e.x,c=e.y,u=0,h=a.length;u<h;++u){o=a[u];if((n=OpenLayers.Geometry.distanceToSegment(e,o)).distance<s){s=n.distance;i=n;if(0===s)break}else if(o.x2>l&&(c>o.y1&&c<o.y2||c<o.y1&&c>o.y2))break}i=r?{distance:i.distance,x0:i.x,y0:i.y,x1:l,y1:c}:i.distance}else if(e instanceof OpenLayers.Geometry.LineString){var p,d,f,y,m,g=this.getSortedSegments(),C=e.getSortedSegments(),v=C.length,T={point:!0};e:for(u=0,h=g.length;u<h;++u){y=(p=g[u]).x1;m=p.y1;for(var L=0;L<v;++L){d=C[L];if(f=OpenLayers.Geometry.segmentsIntersect(p,d,T)){s=0;i={distance:0,x0:f.x,y0:f.y,x1:f.x,y1:f.y};break e}(n=OpenLayers.Geometry.distanceToSegment({x:y,y:m},d)).distance<s&&(i={distance:s=n.distance,x0:y,y0:m,x1:n.x,y1:n.y})}}r||(i=i.distance);if(0!==s&&p){n=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var S=r?n.distance:n;S<s&&(i=r?{distance:s,x0:n.x1,y0:n.y1,x1:n.x0,y1:n.y0}:S)}}else{i=e.distanceTo(this,t);r&&(i={distance:i.distance,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0})}return i},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var n=function(e,t,i,o){for(var a,l=0,c=0,u=t;u<i;u++)if((a=r(e[t],e[i],e[u]))>l){l=a;c=u}if(l>o&&c!=t){s.push(c);n(e,t,c,o);n(e,c,i,o)}},r=function(e,t,n){return Math.abs(.5*(e.x*t.y+t.x*n.y+n.x*e.y-t.x*e.y-n.x*t.y-e.x*n.y))/Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))*2},i=t.length-1,s=[];s.push(0);s.push(i);for(;t[0].equals(t[i]);){i--;s.push(i)}n(t,0,i,e);var o=[];s.sort(function(e,t){return e-t});for(var a=0;a<s.length;a++)o.push(t[s[a]]);return new OpenLayers.Geometry.LineString(o)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var n,r,i,s,o,a=null,l=t&&t.mutual,c=[],u=[e],h=0,p=this.components.length;h<p;++h){r=this.components[h];s=!1;for(var d=0;d<u.length;++d)if(n=r.split(u[d],t)){if(l){for(var f=0,y=(i=n[0]).length;f<y;++f)0===f&&c.length?c[c.length-1].addComponent(i[f]):c.push(new OpenLayers.Geometry.MultiLineString([i[f]]));s=!0;n=n[1]}if(n.length){n.unshift(d,1);Array.prototype.splice.apply(u,n);break}}s||(c.length?c[c.length-1].addComponent(r.clone()):c=[new OpenLayers.Geometry.MultiLineString(r.clone())])}c&&c.length>1?s=!0:c=[];u&&u.length>1?o=!0:u=[];(s||o)&&(a=l?[c,u]:u);return a},splitWith:function(e,t){var n,r,i,s,o,a,l,c=null,u=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[];a=[e];for(var h=0,p=this.components.length;h<p;++h){o=!1;r=this.components[h];for(var d=0;d<a.length;++d)if(n=a[d].split(r,t)){if(u){if((i=n[0]).length){i.unshift(d,1);Array.prototype.splice.apply(a,i);d+=i.length-2}0===(n=n[1]).length&&(n=[r.clone()])}for(var f=0,y=n.length;f<y;++f)0===f&&l.length?l[l.length-1].addComponent(n[f]):l.push(new OpenLayers.Geometry.MultiLineString([n[f]]));o=!0}o||(l.length?l[l.length-1].addComponent(r.clone()):l=[new OpenLayers.Geometry.MultiLineString([r.clone()])])}}else c=e.split(this);a&&a.length>1?s=!0:a=[];l&&l.length>1?o=!0:l=[];(s||o)&&(c=u?[a,l]:l);return c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var n=!1,r=this.components.pop();null==t&&e.equals(r)||(n=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i]);return n},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var n=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[n])}return t},move:function(e,t){for(var n=0,r=this.components.length;n<r-1;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,r=this.components.length;n<r-1;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var r=0,i=this.components.length;r<i-1;++r)this.components[r].resize(e,t,n);return this},transform:function(e,t){if(e&&t){for(var n=0,r=this.components.length;n<r-1;n++){this.components[n].transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&e<=2)return this.components[0].clone();if(e>2){var t=0,n=0,r=this.components[0].x,i=this.components[0].y,s=-1*this.getArea();if(0!=s){for(var o=0;o<e-1;o++){var a=this.components[o],l=this.components[o+1];t+=(a.x+l.x-2*r)*((a.x-r)*(l.y-i)-(l.x-r)*(a.y-i));n+=(a.y+l.y-2*i)*((a.x-r)*(l.y-i)-(l.x-r)*(a.y-i))}var c=r+t/(6*s),u=i+n/(6*s)}else{for(o=0;o<e-1;o++){t+=this.components[o].x;n+=this.components[o].y}c=t/(e-1),u=n/(e-1)}return new OpenLayers.Geometry.Point(c,u)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,n=0,r=this.components.length;n<r-1;n++){var i=this.components[n],s=this.components[n+1];t+=(i.x+s.x)*(s.y-i.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}var r=0,i=t.components&&t.components.length;if(i>2){for(var s,o,a=0;a<i-1;a++){s=t.components[a];o=t.components[a+1];r+=OpenLayers.Util.rad(o.x-s.x)*(2+Math.sin(OpenLayers.Util.rad(s.y))+Math.sin(OpenLayers.Util.rad(o.y)))}r=6378137*r*6378137/2}return r},containsPoint:function(e){var t=OpenLayers.Number.limitSigDigs,n=t(e.x,14),r=t(e.y,14);function i(e,t,n,r,i){return(r-t)/(i-n)*(e-i)+r}for(var s,o,a,l,c,u,h,p=this.components.length-1,d=0,f=0;f<p;++f){a=t((s=this.components[f]).x,14);l=t(s.y,14);c=t((o=this.components[f+1]).x,14);if(l!=(u=t(o.y,14))){if((h=t(i(r,a,l,c,u),14))==n&&(l<u&&r>=l&&r<=u||l>u&&r<=l&&r>=u)){d=-1;break}h<=n||a!=c&&(h<Math.min(a,c)||h>Math.max(a,c))||(l<u&&r>=l&&r<u||l>u&&r<l&&r>=u)&&++d}else if(r==l&&(a<=c&&n>=a&&n<=c||a>=c&&n<=a&&n>=c)){d=-1;break}}return-1==d?1:!!(1&d)},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var n=0,r=e.components.length;n<r&&!(t=e.components[n].intersects(this));++n);return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,n=this.components.length;t<n;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var n=1,r=this.components.length;n<r;n++)t-=Math.abs(this.components[n].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,n=!1;if(t>0&&1!==(n=this.components[0].containsPoint(e))&&n&&t>1)for(var r,i=1;i<t;++i)if(r=this.components[i].containsPoint(e)){n=1===r&&1;break}return n},intersects:function(e){var t,n,r=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)r=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,n=this.components.length;t<n&&!(r=e.intersects(this.components[t]));++t);if(!r)for(t=0,n=e.components.length;t<n&&!(r=this.containsPoint(e.components[t]));++t);}else for(t=0,n=e.components.length;t<n&&!(r=this.intersects(e.components[t]));++t);if(!r&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var i=this.components[0];for(t=0,n=i.components.length;t<n&&!(r=e.containsPoint(i.components[t]));++t);}return r},distanceTo:function(e,t){return!!(t&&!1===t.edge)&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,n,r){var i,s,o,a=Math.PI*(1/n-.5);r&&(a+=r/180*Math.PI);for(var l=[],c=0;c<n;++c){i=a+2*c*Math.PI/n;s=e.x+t*Math.cos(i);o=e.y+t*Math.sin(i);l.push(new OpenLayers.Geometry.Point(s,o))}var u=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([u])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),n=[],r=0;r<t.length;r++){var i=this.parseFeature(t[r]);i&&n.push(i)}return n},parseFeature:function(e){for(var t,n,r,i,s,o=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],a=0;a<o.length;++a){t=o[a];if((n=this.getElementsByTagNameNS(e,this.gmlns,t)).length>0){if(!(i=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=i.apply(this,[n[0]]);this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}}var l,c=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(a=0;a<c.length;++a){var u=c[a],h=this.parseGeometry.box.apply(this,[u]),p=u.parentNode;"boundedBy"===(p.localName||p.nodeName.split(":").pop())?s=h:r=h.toGeometry()}this.extractAttributes&&(l=this.parseAttributes(e));var d=new OpenLayers.Feature.Vector(r,l);d.bounds=s;d.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var f,y=e.firstChild;y&&(1!=y.nodeType||!(f=y.getAttribute("fid")||y.getAttribute("id")));)y=y.nextSibling;d.fid=f;return d},parseGeometry:{point:function(e){var t,n=[];(t=this.getElementsByTagNameNS(e,this.gmlns,"pos")).length>0&&(n=t[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace));0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length>0&&(n=t[0].firstChild.nodeValue.replace(this.regExes.removeSpace,"").split(","));if(0==n.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord")).length>0){var r=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),i=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");r.length>0&&i.length>0&&(n=[r[0].firstChild.nodeValue,i[0].firstChild.nodeValue])}2==n.length&&(n[2]=null);return this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i)(r=this.parseGeometry.point.apply(this,[t[i]]))&&n.push(r);return new OpenLayers.Geometry.MultiPoint(n)},linestring:function(e,t){var n,r=[],i=[];if((n=this.getElementsByTagNameNS(e,this.gmlns,"posList")).length>0){r=this.getChildValue(n[0]).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);for(var s,o,a,l,c=parseInt(n[0].getAttribute("dimension")),u=0;u<r.length/c;++u){o=r[s=u*c];a=r[s+1];l=2==c?null:r[s+2];this.xy?i.push(new OpenLayers.Geometry.Point(o,a,l)):i.push(new OpenLayers.Geometry.Point(a,o,l))}}if(0==r.length&&(n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length>0){var h=this.getChildValue(n[0]).replace(this.regExes.trimSpace,"").replace(this.regExes.trimComma,",").split(this.regExes.splitSpace);for(u=0;u<h.length;++u){2==(r=h[u].split(",")).length&&(r[2]=null);this.xy?i.push(new OpenLayers.Geometry.Point(r[0],r[1],r[2])):i.push(new OpenLayers.Geometry.Point(r[1],r[0],r[2]))}}var p=null;0!=i.length&&(p=t?new OpenLayers.Geometry.LinearRing(i):new OpenLayers.Geometry.LineString(i));return p},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i)(r=this.parseGeometry.linestring.apply(this,[t[i]]))&&n.push(r);return new OpenLayers.Geometry.MultiLineString(n)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i)(r=this.parseGeometry.linestring.apply(this,[t[i],!0]))&&n.push(r);return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i)(r=this.parseGeometry.polygon.apply(this,[t[i]]))&&n.push(r);return new OpenLayers.Geometry.MultiPolygon(n)},envelope:function(e){var t,n=[],r=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(r.length>0){var i=[];r.length>0&&(i=r[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace));2==i.length&&(i[2]=null);if(this.xy)var s=new OpenLayers.Geometry.Point(i[0],i[1],i[2]);else s=new OpenLayers.Geometry.Point(i[1],i[0],i[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){i=[];o.length>0&&(i=o[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace));2==i.length&&(i[2]=null);if(this.xy)var a=new OpenLayers.Geometry.Point(i[0],i[1],i[2]);else a=new OpenLayers.Geometry.Point(i[1],i[0],i[2])}if(s&&a){n.push(new OpenLayers.Geometry.Point(s.x,s.y));n.push(new OpenLayers.Geometry.Point(a.x,s.y));n.push(new OpenLayers.Geometry.Point(a.x,a.y));n.push(new OpenLayers.Geometry.Point(s.x,a.y));n.push(new OpenLayers.Geometry.Point(s.x,s.y));var l=new OpenLayers.Geometry.LinearRing(n);t=new OpenLayers.Geometry.Polygon([l])}return t},box:function(e){var t,n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),r=null,i=null;if(n.length>0&&2==(t=n[0].firstChild.nodeValue.split(" ")).length){r=t[0].split(",");i=t[1].split(",")}if(null!==r&&null!==i)return new OpenLayers.Bounds(parseFloat(r[0]),parseFloat(r[1]),parseFloat(i[0]),parseFloat(i[1]))}},parseAttributes:function(e){for(var t,n,r,i,s,o,a,l={},c=e.firstChild;c;){if(1==c.nodeType){t=c.childNodes;for(n=0;n<t.length;++n)if(1==(r=t[n]).nodeType)if(1==(i=r.childNodes).length){if(3==(s=i[0]).nodeType||4==s.nodeType){o=r.prefix?r.nodeName.split(":")[1]:r.nodeName;a=s.nodeValue.replace(this.regExes.trimSpace,"");l[o]=a}}else l[r.nodeName.split(":").pop()]=null;break}c=c.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),n=0;n<e.length;n++)t.appendChild(this.createFeatureXML(e[n]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,n=this.buildGeometryNode(t),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(n);var i=this.createElementNS(this.gmlns,"gml:"+this.featureName),s=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),o=e.fid||e.id;s.setAttribute("fid",o);s.appendChild(r);for(var a in e.attributes){var l=this.createTextNode(e.attributes[a]),c=a.substring(a.lastIndexOf(":")+1),u=this.createElementNS(this.featureNS,this.featurePrefix+":"+c);u.appendChild(l);s.appendChild(u)}i.appendChild(s);return i},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME,n=t.substring(t.lastIndexOf(".")+1);return this.buildGeometry[n.toLowerCase()].apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiPoint"),i=e.components,s=0;s<i.length;s++){t=this.createElementNS(this.gmlns,"gml:pointMember");n=this.buildGeometry.point.apply(this,[i[s]]);t.appendChild(n);r.appendChild(t)}return r},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiLineString"),i=e.components,s=0;s<i.length;++s){t=this.createElementNS(this.gmlns,"gml:lineStringMember");n=this.buildGeometry.linestring.apply(this,[i[s]]);t.appendChild(n);r.appendChild(t)}return r},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,n,r,i=this.createElementNS(this.gmlns,"gml:Polygon"),s=e.components,o=0;o<s.length;++o){r=0==o?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.gmlns,"gml:"+r);n=this.buildGeometry.linearring.apply(this,[s[o]]);t.appendChild(n);i.appendChild(t)}return i},multipolygon:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiPolygon"),i=e.components,s=0;s<i.length;++s){t=this.createElementNS(this.gmlns,"gml:polygonMember");n=this.buildGeometry.polygon.apply(this,[i[s]]);t.appendChild(n);r.appendChild(t)}return r},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");t.appendChild(this.buildCoordinatesNode(e));return t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal",".");t.setAttribute("cs",",");t.setAttribute("ts"," ");var n=[];if(e instanceof OpenLayers.Bounds){n.push(e.left+","+e.bottom);n.push(e.right+","+e.top)}else for(var r=e.components?e.components:[e],i=0;i<r.length;i++)n.push(r[i].x+","+r[i].y);var s=this.createTextNode(n.join(" "));t.appendChild(s);return t},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.setGeometryTypes();e&&e.featureNS&&this.setNamespace("feature",e.featureNS);this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t=[];this.readNode(e,{features:t},!0);if(0==t.length){if((i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember")).length)for(var n=0,r=i.length;n<r;++n)this.readNode(i[n],{features:t},!0);else{var i;(i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers")).length&&this.readNode(i[0],{features:t},!0)}}return t},readNode:function(e,t,n){if(!0===n&&!0===this.autoConfig){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=!0}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,n){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var n={};this.readChildNodes(e,n);n.components&&n.components.length>0&&(t.bounds=n.components[0])},Point:function(e,t){var n={points:[]};this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(n.points[0])},coordinates:function(e,t){for(var n,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),i=(r=r.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),s=i.length,o=new Array(s),a=0;a<s;++a){n=i[a].split(",");this.xy?o[a]=new OpenLayers.Geometry.Point(n[0],n[1],n[2]):o[a]=new OpenLayers.Geometry.Point(n[1],n[0],n[2])}t.points=o},coord:function(e,t){var n={};this.readChildNodes(e,n);t.points||(t.points=[]);t.points.push(new OpenLayers.Geometry.Point(n.x,n.y,n.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiPoint(n.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var n={};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(n.points))},MultiLineString:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiLineString(n.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var n={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.inner.unshift(n.outer);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.Polygon(n.inner))},LinearRing:function(e,t){var n={};this.readers.gml._inherit.apply(this,[e,n]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.LinearRing(n.points)]},MultiPolygon:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiPolygon(n.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.Collection(n.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var n,r=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,r)?r===this.featureType&&(n="_typeName"):n="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(n="_attribute"):n="_geometry";n&&this.readers.feature[n].apply(this,[e,t])},_typeName:function(e,t){var n={components:[],attributes:{}};this.readChildNodes(e,n);n.name&&(n.attributes.name=n.name);var r=new OpenLayers.Feature.Vector(n.components[0],n.attributes);if(!this.singleFeatureType){r.type=e.nodeName.split(":").pop();r.namespace=e.namespaceURI}var i=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");i&&(r.fid=i);this.internalProjection&&this.externalProjection&&r.geometry&&r.geometry.transform(this.externalProjection,this.internalProjection);n.bounds&&(r.bounds=n.bounds);t.features.push(r)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop());this.readChildNodes(e,t)},_attribute:function(e,t){var n=e.localName||e.nodeName.split(":").pop(),r=this.getChildValue(e);t.attributes[n]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var n=this.writeNode("gml:"+t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",e,t);return t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),n=e.components||[e],r=0,i=n.length;r<i;++r)this.writeNode("pointMember",n[r],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",e,t);return t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),n=e.components||[e],r=0,i=n.length;r<i;++r)this.writeNode("lineStringMember",n[r],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",e,t);return t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),n=e.components||[e],r=0,i=n.length;r<i;++r)this.writeNode("polygonMember",n[r],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",e,t);return t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),n=0,r=e.components.length;n<r;++n)this.writeNode("geometryMember",e.components[n],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),n=this.writeNode("feature:_geometry",e);t.appendChild(n.firstChild);return t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var n in e.attributes){var r=e.attributes[n];null!=r&&this.writeNode("feature:_attribute",{name:n,value:r},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),n=this.geometryTypes[e.CLASS_NAME],r=this.writeNode("gml:"+n,e,t);this.srsName&&r.setAttribute("srsName",this.srsName);return t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),n=0,r=e.length;n<r;++n)this.writeNode("gml:featureMember",e[n],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,n){var r=parseInt(e.getAttribute("srsDimension"),10)||n&&n.srsDimension;r&&(t.srsDimension=r)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var n={points:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(n.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var n={};this.readChildNodes(e,n);n.points&&Array.prototype.push.apply(t.points,n.points)},pos:function(e,t){var n,r=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);n=this.xy?new OpenLayers.Geometry.Point(r[0],r[1],r[2]):new OpenLayers.Geometry.Point(r[1],r[0],r[2]);t.points=[n]},posList:function(e,t){for(var n,r,i,s=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),o=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,a=s.length/o,l=new Array(a),c=0,u=s.length;c<u;c+=o){n=s[c];r=s[c+1];i=2==o?void 0:s[c+2];this.xy?l[c/o]=new OpenLayers.Geometry.Point(n,r,i):l[c/o]=new OpenLayers.Geometry.Point(r,n,i)}t.points=l},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var n={};this.readChildNodes(e,n);t.outer=n.components[0]},interior:function(e,t){var n={};this.readChildNodes(e,n);t.inner.push(n.components[0])},MultiCurve:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(n.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(n.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var n={points:new Array(2)};this.readChildNodes(e,n);t.components||(t.components=[]);var r=n.points[0],i=n.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,i.x,i.y))},lowerCorner:function(e,t){var n={};this.readers.gml.pos.apply(this,[e,n]);t.points[0]=n.points[0]},upperCorner:function(e,t){var n={};this.readers.gml.pos.apply(this,[e,n]);t.points[1]=n.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var n=this.writeNode("gml:"+t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),n=0,r=e.length;n<r;++n)this.writeNode("feature:_typeName",e[n],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("pos",e,t);return t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("posList",e.components,t);return t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");this.writeNode("segments",e,t);return t},segments:function(e){var t=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",e,t);return t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",e.components,t);return t},posList:function(e){for(var t,n=e.length,r=new Array(n),i=0;i<n;++i){t=e[i];this.xy?r[i]=t.x+" "+t.y:r[i]=t.y+" "+t.x}return this.createElementNSPlus("gml:posList",{value:r.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");this.writeNode("patches",e,t);return t},patches:function(e){var t=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",e,t);return t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var n=1,r=e.components.length;n<r;++n)this.writeNode("interior",e.components[n],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var n=1,r=e.components.length;n<r;++n)this.writeNode("interior",e.components[n],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",e,t);return t},interior:function(e){var t=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",e.components,t);return t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),n=e.components||[e],r=0,i=n.length;r<i;++r)this.writeNode("curveMember",n[r],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t);return t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),n=e.components||[e],r=0,i=n.length;r<i;++r)this.writeNode("surfaceMember",n[r],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t);return t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",e,t);this.writeNode("upperCorner",e,t);this.srsName&&t.setAttribute("srsName",this.srsName);return t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var n=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===n||"0"===n)});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var n=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===n||"0"===n)});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLike:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,n);var r=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),s=e.getAttribute("escapeChar");n.value2regex(r,i,s);t.filters.push(n)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var n=this.writeNode("gml:Envelope",e.value);e.projection&&n.setAttribute("srsName",e.projection);t.appendChild(n);return t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),n=0,r=e.length;n<r;n++)this.writeNode("ogc:SortProperty",e[n],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",e,t);this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t);return t},SortOrder:function(e){return this.createElementNSPlus("ogc:SortOrder",{value:e})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var n=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,n);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,n);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value);e.projection&&r.setAttribute("srsName",e.projection);n.appendChild(r)}return n},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var n=this.version;if(!n){var r=e.getAttribute("xmlns:ows");r&&"1.1"===r.substring(r.lastIndexOf("/")+1)&&(n="1.1.0");n||(n=this.defaultVersion)}return n},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n={};this.readChildNodes(e,n);return n},readers:{ows:{Exception:function(e,t){var n={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(n);this.readChildNodes(e,n)},ExceptionText:function(e,t){var n=this.getChildValue(e);t.texts.push(n)},ServiceIdentification:function(e,t){t.serviceIdentification={};this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},Keywords:function(e,t){t.keywords={};this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={};this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={};this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={};this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={};this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={};this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={};this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var n=e.getAttribute("name");t[n]={};this.readChildNodes(e,t[n])},DCP:function(e,t){t.dcp={};this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={};this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var n={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,n);t.get.push(n)},Post:function(e,t){t.post||(t.post=[]);var n={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,n);t.post.push(n)},Parameter:function(e,t){t.parameters||(t.parameters={});var n=e.getAttribute("name");t.parameters[n]={};this.readChildNodes(e,t.parameters[n])},Constraint:function(e,t){t.constraints||(t.constraints={});var n=e.getAttribute("name");t.constraints[n]={};this.readChildNodes(e,t.constraints[n])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)});this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var n={};n.crs=e.getAttribute("crs");if(t.BoundingBox)t.BoundingBox.push(n);else{t.projection=n.crs;n=t}this.readChildNodes(e,n)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(n=n.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.left=r[0];t.bottom=r[1]},UpperCorner:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(n=n.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.right=r[0];t.top=r[1];t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top);delete t.left;delete t.bottom;delete t.right;delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var n=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});this.writeNode("ows:LowerCorner",e,n);this.writeNode("ows:UpperCorner",e,n);return n},LowerCorner:function(e){return this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom})},UpperCorner:function(e){return this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top})},Identifier:function(e){return this.createElementNSPlus("ows:Identifier",{value:e})},Title:function(e){return this.createElementNSPlus("ows:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("ows:Abstract",{value:e})},OutputFormat:function(e){return this.createElementNSPlus("ows:OutputFormat",{value:e})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1;t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,n){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var n={fids:[]};this.readChildNodes(e,n);t.insertIds.push(n.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count});return t},Query:function(e){var t=(e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e)).featurePrefix,n=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});e.featureNS&&n.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var r=0,i=e.propertyNames.length;r<i;r++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},n);if(e.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter);this.writeNode("ogc:Filter",e.filter,n)}return n},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,e);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners);null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(e){this.map=e;this.handler&&this.handler.setMap(e)},draw:function(e){if(null==this.div){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}""!=this.title&&(this.div.title=this.title)}null!=e&&(this.position=e.clone());this.moveTo(this.position);return this.div},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return!0},deactivate:function(){if(this.active){this.handler&&this.handler.deactivate();this.active=!1;this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("deactivate");return!0}return!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(e){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.buttons=null;this.position=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var t={w:18,h:18},n=new OpenLayers.Pixel(e.x+t.w/2,e.y);this._addButton("panup","north-mini.png",n,t);e.y=n.y+t.h;this._addButton("panleft","west-mini.png",e,t);this._addButton("panright","east-mini.png",e.add(t.w,0),t);this._addButton("pandown","south-mini.png",n.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",n.add(0,3*t.h+5),t);this._addButton("zoomworld","zoom-world-mini.png",n.add(0,4*t.h+5),t);this._addButton("zoomout","zoom-minus-mini.png",n.add(0,5*t.h+5),t);return this.div},_addButton:function(e,t,n,r){var i=OpenLayers.Util.getImageLocation(t),s=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,n,r,i,"absolute");s.style.cursor="pointer";this.div.appendChild(s);s.action=e;s.className="olButton";this.buttons.push(s);return s},_removeButton:function(e){this.div.removeChild(e);OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){switch(e.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){if(null!=this.div){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position.clone();this.buttons=[];var t={w:18,h:18};if(this.panIcons){var n=new OpenLayers.Pixel(e.x+t.w/2,e.y),r=t.w;this.zoomWorldIcon&&(n=new OpenLayers.Pixel(e.x+t.w,e.y));this._addButton("panup","north-mini.png",n,t);e.y=n.y+t.h;this._addButton("panleft","west-mini.png",e,t);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t);r*=2}this._addButton("panright","east-mini.png",e.add(r,0),t);this._addButton("pandown","south-mini.png",n.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",n.add(0,3*t.h+5),t);n=this._addZoomBar(n.add(0,4*t.h+5));this._addButton("zoomout","zoom-minus-mini.png",n,t)}else{this._addButton("zoomin","zoom-plus-mini.png",e,t);n=this._addZoomBar(e.add(0,t.h));this._addButton("zoomout","zoom-minus-mini.png",n,t);if(this.zoomWorldIcon){n=n.add(0,t.h+3);this._addButton("zoomworld","zoom-world-mini.png",n,t)}}return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),n=this.id+"_"+this.map.id,r=this.map.getMinZoom(),i=this.map.getNumZoomLevels()-1-this.map.getZoom(),s=OpenLayers.Util.createAlphaImageDiv(n,e.add(-1,i*this.zoomStopHeight),{w:20,h:9},t,"absolute");s.style.cursor="move";this.slider=s;this.sliderEvents=new OpenLayers.Events(this,s,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var o={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-r)},a=(t=OpenLayers.Util.getImageLocation("zoombar.png"),null);if(OpenLayers.Util.alphaHack()){n=this.id+"_"+this.map.id;(a=OpenLayers.Util.createAlphaImageDiv(n,e,{w:o.w,h:this.zoomStopHeight},t,"absolute",null,"crop")).style.height=o.h+"px"}else a=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,o,t);a.style.cursor="pointer";a.className="olButton";this.zoombarDiv=a;this.div.appendChild(a);this.startTop=parseInt(a.style.top);this.div.appendChild(s);this.map.events.register("zoomend",this,this.moveZoomBar);return e=e.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-r))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(t=Math.floor(t));var n=this.map.getNumZoomLevels()-1-t;n=Math.min(Math.max(n,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(n)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=e.xy.clone();this.zoomStart=e.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,n=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-n[1]>0&&e.clientY-n[1]<parseInt(this.zoombarDiv.style.height)-2){var r=parseInt(this.slider.style.top)-t;this.slider.style.top=r+"px";this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y;OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var t=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){t+=this.deltaY/this.zoomStopHeight;t=Math.min(Math.max(t,0),this.map.getNumZoomLevels()-1)}else{t+=this.deltaY/this.zoomStopHeight;t=Math.max(Math.round(t),0)}this.map.zoomTo(t);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(e){this.target=e;if(e.object instanceof OpenLayers.Map)this.setMap(e.object);else{if(!(e.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";e.object.map?this.setMap(e.object.map):e.object.events.register("added",this,function(t){this.setMap(e.object.map)})}for(var t=this.provides.length-1;t>=0;--t)e.extensions[this.provides[t]]=!0},setMap:function(e){this.map=e;this.cache={};e.events.register("mousedown",this,this.start,{extension:!0});e.events.register("mouseup",this,this.onClick,{extension:!0});e.events.register("touchstart",this,this.start,{extension:!0});e.events.register("touchmove",this,this.cancel,{extension:!0});e.events.register("touchend",this,this.onClick,{extension:!0});e.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(e){this.startEvt=e},cancel:function(e){delete this.startEvt},onClick:function(e){if(this.startEvt&&("touchend"===e.type||OpenLayers.Event.isLeftClick(e))){var t=this.getFeatures(this.startEvt);delete this.startEvt;for(var n,r,i={},s=0,o=t.length;s<o;++s){i[(r=(n=t[s]).layer).id]=!0;if(!1===this.triggerEvent("featureclick",{feature:n}))break}for(s=0,o=this.map.layers.length;s<o;++s)(r=this.map.layers[s])instanceof OpenLayers.Layer.Vector&&!i[r.id]&&this.triggerEvent("nofeatureclick",{layer:r})}},onMousemove:function(e){delete this.startEvt;for(var t,n=this.getFeatures(e),r={},i=[],s=0,o=n.length;s<o;++s){r[(t=n[s]).id]=t;this.cache[t.id]||i.push(t)}var a=[];for(var l in this.cache)(t=this.cache[l]).layer&&t.layer.map?r[t.id]||a.push(t):delete this.cache[l];for(s=0,o=i.length;s<o;++s){t=i[s];this.cache[t.id]=t;if(!1===this.triggerEvent("featureover",{feature:t}))break}for(s=0,o=a.length;s<o;++s){t=a[s];delete this.cache[t.id];if(!1===this.triggerEvent("featureout",{feature:t}))break}},triggerEvent:function(e,t){var n=t.feature?t.feature.layer:t.layer,r=this.target.object;if(r instanceof OpenLayers.Map||r===n)return this.target.triggerEvent(e,t)},getFeatures:function(e){var t,n,r,i,s,o=e.clientX,a=e.clientY,l=[],c=[],u=[];for(i=this.map.layers.length-1;i>=0;--i)if("none"!==(t=this.map.layers[i]).div.style.display)if(t.renderer instanceof OpenLayers.Renderer.Elements){if(t instanceof OpenLayers.Layer.Vector){n=document.elementFromPoint(o,a);for(;n&&n._featureId;)if(r=t.getFeatureById(n._featureId)){l.push(r);n.style.display="none";c.push(n);n=document.elementFromPoint(o,a)}else n=!1}u.push(t);t.div.style.display="none"}else if(t.renderer instanceof OpenLayers.Renderer.Canvas&&(r=t.renderer.getFeatureIdFromEvent(e))){l.push(r);u.push(t)}for(i=0,s=c.length;i<s;++i)c[i].style.display="";for(i=u.length-1;i>=0;--i)u[i].div.style.display="block";return l},destroy:function(){for(var e=this.provides.length-1;e>=0;--e)delete this.target.extensions[this.provides[e]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,n){OpenLayers.Util.extend(this,n);this.control=e;this.callbacks=t;var r=this.map||e.map;r&&this.setMap(r);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){return null==this.keyMask||((e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;t<n;t++)this[e[t]]&&this.register(e[t],this[e[t]]);this.active=!0;return!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;t<n;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);this.touch=!1;this.active=!1;return!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,n=e.length;t<n;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t);this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t);this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){this.evt=e;return!0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,n){n&&n.layerOptions&&n.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e);this.map.addLayer(this.layer);return!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();if(null!=this.layer.map){this.destroyFeature(!0);this.layer.destroy(!1)}this.layer=null;return!0},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(t,[this.geometryClone()]);this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){OpenLayers.Event.stop(e);return!1},dblclick:function(e){OpenLayers.Event.stop(e);return!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon;this.point.geometry.y=t.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e]));return e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){this.startTouch();this.lastTouchPx=e.xy;return this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){this.lastTouchPx=e.xy;return this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){e.xy=this.lastTouchPx;return this.up(e)},down:function(e){this.mouseDown=!0;this.lastDown=e.xy;this.touch||this.modifyFeature(e.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(e){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy);return!0},up:function(e){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(e))return!0;if(this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=e.xy;this.finalize();return!this.stopUp}return!0},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=!1}},passesTolerance:function(e,t,n){var r=!0;if(null!=n&&e&&t){e.distanceTo(t)>n&&(r=!1)}return r},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e);this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,t){var n=this.getCurrentPointIndex()-1,r=this.line.geometry.components[n];!r||isNaN(r.x)||isNaN(r.y)||this.insertXY(r.x+e,r.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var n=t*Math.cos(e),r=t*Math.sin(e);this.insertDeltaXY(n,r)},insertDeflectionLength:function(e,t){var n=this.getCurrentPointIndex()-1;if(n>0){var r=this.line.geometry.components[n],i=this.line.geometry.components[n-1],s=Math.atan2(r.y-i.y,r.x-i.x);this.insertDirectionLength(180*s/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,n=this.getCurrentPointIndex()-1,r=t[n],i=e.removeComponent(r);if(i){if(this.touch&&n>0){var s=(t=e.components)[n-1],o=t[this.getCurrentPointIndex()];o.x=s.x;o.y=s.y}this.redoStack||(this.redoStack=[]);this.redoStack.push(r);this.drawFeature()}return i},redo:function(){var e=this.redoStack&&this.redoStack.pop();if(e){this.line.geometry.addComponent(e,this.getCurrentPointIndex());this.drawFeature()}return!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var n=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=n.lon;this.point.geometry.y=n.lat;this.callback("modify",[this.point.geometry,this.getSketch(),t]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e]));return e},touchstart:function(e){if(this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return!1}if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,e)},down:function(e){var t=this.stopDown;if(this.freehandMode(e)){t=!0;if(this.touch){this.modifyFeature(e.xy,!!this.lastUp);OpenLayers.Event.stop(e)}}this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=e.xy;this.stoppedDown=t;return!t},move:function(e){if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize()}else this.addPoint(e.xy);return!1}this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp);return!0},up:function(e){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(e.xy)))if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();this.removePoint();this.finalize()}else if(this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);null==this.lastUp&&this.persist&&this.destroyPersistedFeature();this.addPoint(e.xy);this.lastUp=e.xy;this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()}this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},dblclick:function(e){this.freehandMode(e)||this.finishGeometry();return!1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,n,r=this.point.geometry,i=this.control.layer.features,s=i.length-1;s>=0;--s)if(((t=i[s].geometry)instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(r)){n=i[s];this.control.layer.removeFeatures([n],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);n.geometry.addComponent(this.line.geometry);this.polygon=n;this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,n=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var r=n[n.length-3];t.x=r.x;t.y=r.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var n=this.polygon.geometry.components,r=n.length-2;r>=0;--r)if(e.intersects(n[r])){t=!1;break}if(t){e:for(r=n.length-2;r>0;--r)for(var i=n[r].components,s=0,o=i.length;s<o;++s)if(e.containsPoint(i[s])){t=!1;break e}}}t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e);this.restoreFeature();return!1},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(!0)}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e]));return e},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e);OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return!1},setExtent:function(e,t){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var n=e.getWidth()/this.map.getExtent().getWidth();e=e.scale(1/n);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(n)}t&&(this.resolution=null);return!0},setSize:function(e){this.size=e.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(e,t){null==t&&(t=e.style);if(e.geometry){var n=e.geometry.getBounds();if(n){var r;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent());n.intersectsBounds(this.extent,{worldBounds:r})?this.calculateFeatureDx(n,r):t={display:"none"};var i=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&!1!==i){var s=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var o=isNaN(t.labelXOffset)?0:t.labelXOffset,a=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();s.move(o*l,a*l)}this.drawText(e.id,t,s)}else this.removeText(e.id);return i}}},calculateFeatureDx:function(e,t){this.featureDx=0;if(t){var n=t.getWidth(),r=(this.extent.left+this.extent.right)/2,i=(e.left+e.right)/2,s=Math.round((i-r)/n);this.featureDx=s*n}},drawGeometry:function(e,t,n){},drawText:function(e,t,n){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;t<n;++t){var r=e[t];this.eraseGeometry(r.geometry,r.id);this.removeText(r.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(!1===e.stroke){delete t.strokeWidth;delete t.strokeColor}!1===e.fill&&delete t.fillColor;OpenLayers.Util.extend(t,e);return t},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px";t.style.height=e.h+"px";t.width=e.w;t.height=e.h;this.resolution=null;if(this.hitDetection){var n=this.hitCanvas;n.style.width=e.w+"px";n.style.height=e.h+"px";n.width=e.w;n.height=e.h}},drawFeature:function(e,t){var n;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var r,i=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent());var s=i&&i.intersectsBounds(this.extent,{worldBounds:r});(n="none"!==t.display&&!!i&&s)?this.features[e.id]=[e,t]:delete this.features[e.id];this.pendingRedraw=!0}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=!1}return n},drawGeometry:function(e,t,n){var r=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=r&&"OpenLayers.Geometry.MultiPoint"!=r&&"OpenLayers.Geometry.MultiLineString"!=r&&"OpenLayers.Geometry.MultiPolygon"!=r)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,n);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,n);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,n);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,n)}else for(var i=0;i<e.components.length;i++)this.drawGeometry(e.components[i],t,n)},drawExternalGraphic:function(e,t,n){var r=new Image,i=t.title||t.graphicTitle;i&&(r.title=i);var s=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;s=s||2*t.pointRadius;o=o||2*t.pointRadius;var a=void 0!=t.graphicXOffset?t.graphicXOffset:-.5*s,l=void 0!=t.graphicYOffset?t.graphicYOffset:-.5*o,c=t.graphicOpacity||t.fillOpacity;r.onload=OpenLayers.Function.bind(function(){if(this.features[n]){var t=this.getLocalXY(e),i=t[0],u=t[1];if(!isNaN(i)&&!isNaN(u)){var h=i+a|0,p=u+l|0,d=this.canvas;d.globalAlpha=c;var f=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(r,h*f,p*f,s*f,o*f);if(this.hitDetection){this.setHitContextStyle("fill",n);this.hitContext.fillRect(h,p,s,o)}}}},this);r.src=t.externalGraphic},drawNamedSymbol:function(e,t,n){var r,i,s,o,a,l,c,u,h,p=Math.PI/180,d=OpenLayers.Renderer.symbol[t.graphicName];if(!d)throw new Error(t.graphicName+" is not a valid symbol name");if(d.length&&!(d.length<2)){var f=this.getLocalXY(e),y=f[0],m=f[1];if(!isNaN(y)&&!isNaN(m)){this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{l=new OpenLayers.Bounds;for(a=0;a<d.length;a+=2)l.extend(new OpenLayers.LonLat(d[a],d[a+1]));this.cachedSymbolBounds[t.graphicName]=l}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(y,m);this.hitDetection&&this.hitContext.translate(y,m);u=p*t.rotation;if(!isNaN(u)){this.canvas.rotate(u);this.hitDetection&&this.hitContext.rotate(u)}c=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight());this.canvas.scale(c,c);this.hitDetection&&this.hitContext.scale(c,c);s=l.getCenterLonLat().lon;o=l.getCenterLonLat().lat;this.canvas.translate(-s,-o);this.hitDetection&&this.hitContext.translate(-s,-o);h=t.strokeWidth;t.strokeWidth=h/c;if(!1!==t.fill){this.setCanvasStyle("fill",t);this.canvas.beginPath();for(a=0;a<d.length;a+=2){r=d[a];i=d[a+1];0==a&&this.canvas.moveTo(r,i);this.canvas.lineTo(r,i)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.hitContext.beginPath();for(a=0;a<d.length;a+=2){r=d[a];i=d[a+1];0==a&&this.canvas.moveTo(r,i);this.hitContext.lineTo(r,i)}this.hitContext.closePath();this.hitContext.fill()}}if(!1!==t.stroke){this.setCanvasStyle("stroke",t);this.canvas.beginPath();for(a=0;a<d.length;a+=2){r=d[a];i=d[a+1];0==a&&this.canvas.moveTo(r,i);this.canvas.lineTo(r,i)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",n,t,c);this.hitContext.beginPath();for(a=0;a<d.length;a+=2){r=d[a];i=d[a+1];0==a&&this.hitContext.moveTo(r,i);this.hitContext.lineTo(r,i)}this.hitContext.closePath();this.hitContext.stroke()}}t.strokeWidth=h;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){if("fill"===e){this.canvas.globalAlpha=t.fillOpacity;this.canvas.fillStyle=t.fillColor}else if("stroke"===e){this.canvas.globalAlpha=t.strokeOpacity;this.canvas.strokeStyle=t.strokeColor;this.canvas.lineWidth=t.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;if(t>=16777216){this.hitOverflow=t-16777215;t=t%16777216+1}var n="000000"+t.toString(16),r=n.length;return n="#"+n.substring(r-6,r)},setHitContextStyle:function(e,t,n,r){var i=this.featureIdToHex(t);if("fill"==e){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=i}else if("stroke"==e){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=i;void 0===r?this.hitContext.lineWidth=n.strokeWidth+2:isNaN(r)||(this.hitContext.lineWidth=n.strokeWidth+2/r)}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}},drawPoint:function(e,t,n){if(!1!==t.graphic)if(t.externalGraphic)this.drawExternalGraphic(e,t,n);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,n);else{var r=this.getLocalXY(e),i=r[0],s=r[1];if(!isNaN(i)&&!isNaN(s)){var o=2*Math.PI,a=t.pointRadius;if(!1!==t.fill){this.setCanvasStyle("fill",t);this.canvas.beginPath();this.canvas.arc(i,s,a,0,o,!0);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.hitContext.beginPath();this.hitContext.arc(i,s,a,0,o,!0);this.hitContext.fill()}}if(!1!==t.stroke){this.setCanvasStyle("stroke",t);this.canvas.beginPath();this.canvas.arc(i,s,a,0,o,!0);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",n,t);this.hitContext.beginPath();this.hitContext.arc(i,s,a,0,o,!0);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}},drawLineString:function(e,t,n){t=OpenLayers.Util.applyDefaults({fill:!1},t);this.drawLinearRing(e,t,n)},drawLinearRing:function(e,t,n){if(!1!==t.fill){this.setCanvasStyle("fill",t);this.renderPath(this.canvas,e,t,n,"fill");if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.renderPath(this.hitContext,e,t,n,"fill")}}if(!1!==t.stroke){this.setCanvasStyle("stroke",t);this.renderPath(this.canvas,e,t,n,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",n,t);this.renderPath(this.hitContext,e,t,n,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(e,t,n,r,i){var s=t.components,o=s.length;e.beginPath();var a=this.getLocalXY(s[0]),l=a[0],c=a[1];if(!isNaN(l)&&!isNaN(c)){e.moveTo(a[0],a[1]);for(var u=1;u<o;++u){var h=this.getLocalXY(s[u]);e.lineTo(h[0],h[1])}"fill"===i?e.fill():e.stroke()}},drawPolygon:function(e,t,n){var r=e.components,i=r.length;this.drawLinearRing(r[0],t,n);for(var s=1;s<i;++s){this.canvas.globalCompositeOperation="destination-out";this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out");this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),n);this.canvas.globalCompositeOperation="source-over";this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over");this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({fill:!1},t),n)}},drawText:function(e,t){var n=this.getLocalXY(e);this.setCanvasStyle("reset");this.canvas.fillStyle=t.fontColor;this.canvas.globalAlpha=t.fontOpacity||1;var r=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),i=t.label.split("\n"),s=i.length;if(this.canvas.fillText){this.canvas.font=r;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";null==(l=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]])&&(l=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;n[1]+=o*l*(s-1);for(var a=0;a<s;a++){if(t.labelOutlineWidth){this.canvas.save();this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1;this.canvas.strokeStyle=t.labelOutlineColor;this.canvas.lineWidth=t.labelOutlineWidth;this.canvas.strokeText(i[a],n[0],n[1]+o*a+1);this.canvas.restore()}this.canvas.fillText(i[a],n[0],n[1]+o*a)}}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=r;var l,c=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==c&&(c=-.5);null==(l=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]])&&(l=-.5);o=this.canvas.mozMeasureText("xx");n[1]+=o*(1+l*s);for(a=0;a<s;a++){var u=n[0]+c*this.canvas.mozMeasureText(i[a]),h=n[1]+a*o;this.canvas.translate(u,h);this.canvas.mozDrawText(i[a]);this.canvas.translate(-u,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),n=this.extent;return[(e.x-this.featureDx)/t+-n.left/t,n.top/t-e.y/t]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,n;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var r=e.xy,i=0|r.x,s=0|r.y,o=this.hitContext.getImageData(i,s,1,1).data;if(255===o[3]){var a=o[2]+256*(o[1]+256*o[0]);if(a){t="OpenLayers_Feature_Vector_"+(a-1+this.hitOverflow);try{n=this.features[t][0]}catch(e){}}}}return n},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var n,r,i,s,o=[],a=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var l in this.features)if(this.features.hasOwnProperty(l)){r=(n=this.features[l][0]).geometry;this.calculateFeatureDx(r.getBounds(),a);i=this.features[l][1];this.drawGeometry(r,i,n.id);i.label&&o.push([n,i])}for(var c=0,u=o.length;c<u;++c){s=o[c];this.drawText(s[0].geometry.getCentroid(),s[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,n=!1,r=!1,i=OpenLayers.Event.element(e);null!=i&&!r&&!t;){if(!t)try{var s;if(i.currentStyle)s=i.currentStyle.overflow;else{s=document.defaultView.getComputedStyle(i,null).getPropertyValue("overflow")}t=s&&"auto"==s||"scroll"==s}catch(e){}if(!n&&!(n=OpenLayers.Element.hasClass(i,"olScrollable")))for(var o=0,a=this.map.layers.length;o<a;o++){var l=this.map.layers[o];if(i==l.div||i==l.pane){n=!0;break}}r=i==this.map.div;i=i.parentNode}if(!t&&r){if(n){var c=0;if(e.wheelDelta){(c=e.wheelDelta)%160==0&&(c*=.75);c/=120}else e.detail&&(c=-e.detail/Math.abs(e.detail));this.delta+=c;window.clearTimeout(this._timeoutId);if(this.interval&&Math.abs(this.delta)<this.maxDelta){var u=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(u)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0;if(t){e.xy=this.map.events.getMousePosition(e);t<0?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1])}},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",t);OpenLayers.Event.observe(window,"mousewheel",t);OpenLayers.Event.observe(document,"mousewheel",t);return!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t);OpenLayers.Event.stopObserving(window,"mousewheel",t);OpenLayers.Event.stopObserving(document,"mousewheel",t);return!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var n={};this.readNode(e,n);if(void 0===n.service){var r=new OpenLayers.Format.OGCExceptionReport;n.error=r.read(t)}return n},readers:{wms:{Service:function(e,t){t.service={};this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},BoundingBox:function(e,t){var n={};n.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var r={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};isNaN(r.x)&&isNaN(r.y)||(n.res=r);return n},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={};this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={};this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={};this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var n=this.getChildValue(e);n&&"none"!=n.toLowerCase()&&(t.fees=n)},AccessConstraints:function(e,t){var n=this.getChildValue(e);n&&"none"!=n.toLowerCase()&&(t.accessConstraints=n)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]};this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={};this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]};this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={};this.readChildNodes(e,t.get);t.href||(t.href=t.get.href)},Post:function(e,t){t.post={};this.readChildNodes(e,t.post);t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]};this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]};this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]};this.readChildNodes(e,t.exception)},Layer:function(e,t){var n,r;if(t.capability){r=t.capability;n=t}else r=t;var i=e.getAttributeNode("queryable"),s=i&&i.specified?e.getAttribute("queryable"):null,o=(i=e.getAttributeNode("cascaded"))&&i.specified?e.getAttribute("cascaded"):null,a=(i=e.getAttributeNode("opaque"))&&i.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),c=e.getAttribute("fixedWidth"),u=e.getAttribute("fixedHeight"),h=n||{},p=OpenLayers.Util.extend,d={nestedLayers:[],styles:n?[].concat(n.styles):[],srs:n?p({},h.srs):{},metadataURLs:[],bbox:n?p({},h.bbox):{},llbbox:h.llbbox,dimensions:n?p({},h.dimensions):{},authorityURLs:n?p({},h.authorityURLs):{},identifiers:{},keywords:[],queryable:s&&""!==s?"1"===s||"true"===s:h.queryable||!1,cascaded:null!==o?parseInt(o):h.cascaded||0,opaque:a?"1"===a||"true"===a:h.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:h.noSubsets||!1,fixedWidth:null!=c?parseInt(c):h.fixedWidth||0,fixedHeight:null!=u?parseInt(u):h.fixedHeight||0,minScale:h.minScale,maxScale:h.maxScale,attribution:h.attribution};t.nestedLayers.push(d);d.capability=r;this.readChildNodes(e,d);delete d.capability;if(d.name){var f=d.name.split(":"),y=r.request,m=y.getfeatureinfo;f.length>0&&(d.prefix=f[0]);r.layers.push(d);void 0===d.formats&&(d.formats=y.getmap.formats);void 0===d.infoFormats&&m&&(d.infoFormats=m.formats)}},Attribution:function(e,t){t.attribution={};this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")};this.readChildNodes(e,t.logo)},Style:function(e,t){var n={};t.styles.push(n);this.readChildNodes(e,n)},LegendURL:function(e,t){var n={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=n;this.readChildNodes(e,n)},MetadataURL:function(e,t){var n={type:e.getAttribute("type")};t.metadataURLs.push(n);this.readChildNodes(e,n)},DataURL:function(e,t){t.dataURL={};this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={};this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var n=e.getAttribute("name"),r={};this.readChildNodes(e,r);t.authorityURLs[n]=r.href},Identifier:function(e,t){var n=e.getAttribute("authority");t.identifiers[n]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var n=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);n.srs=e.getAttribute("CRS");t.bbox[n.srs]=n},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[];this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var n={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),default:e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[n.name]=n},Keyword:function(e,t){var n={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(n)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]);t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature"));t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var n={};this.readChildNodes(e,n);t.outer=n.components[0]},innerBoundaryIs:function(e,t){var n={};this.readChildNodes(e,n);t.inner.push(n.components[0])},Box:function(e,t){var n={};this.readChildNodes(e,n);t.components||(t.components=[]);var r=n.points[0],i=n.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,i.x,i.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var n=this.writeNode(t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[e],t);return t},coordinates:function(e){for(var t,n=e.length,r=new Array(n),i=0;i<n;++i){t=e[i];this.xy?r[i]=t.x+","+t.y:r[i]=t.y+","+t.x;void 0!=t.z&&(r[i]+=","+t.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==n?r[0]:r.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",e.components,t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var n=1;n<e.components.length;++n)this.writeNode("innerBoundaryIs",e.components[n],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",e,t);return t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",e.components,t);return t},Box:function(e){var t=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t);this.srsName&&t.setAttribute("srsName",this.srsName);return t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLike:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,n);var r=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),s=e.getAttribute("escape");n.value2regex(r,i,s);t.filters.push(n)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var n=this.writeNode("gml:Box",e.value,t);e.projection&&n.setAttribute("srsName",e.projection);return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var n=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,n);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,n);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value);e.projection&&r.setAttribute("srsName",e.projection);n.appendChild(r)}return n},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,n){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},InsertResult:function(e,t){var n={fids:[]};this.readChildNodes(e,n);t.insertIds=t.insertIds.concat(n.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){var t=(e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e)).featurePrefix,n=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});e.srsNameInQuery&&e.srsName&&n.setAttribute("srsName",e.srsName);e.featureNS&&n.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var r=0,i=e.propertyNames.length;r<i;r++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[r]},n);if(e.filter){this.setFilterProperty(e.filter);this.writeNode("ogc:Filter",e.filter,n)}return n}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var n,r=-1,i=this.order.length;i-r>1;){n=parseInt((r+i)/2);this.compare(this,e,OpenLayers.Util.getElement(this.order[n]))>0?r=n:i=n}this.order.splice(i,0,t);this.indices[t]=this.getZIndex(e);return this.getNextElement(i)},remove:function(e){var t=e.id,n=OpenLayers.Util.indexOf(this.order,t);if(n>=0){this.order.splice(n,1);delete this.indices[t];if(this.order.length>0){var r=this.order[this.order.length-1];this.maxZIndex=this.indices[r]}else this.maxZIndex=0}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;if(null==t){t=this.maxZIndex;e._style.graphicZIndex=t}else t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var n=OpenLayers.Util.getElement(this.order[t]);void 0==n&&(n=this.getNextElement(t));return n}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,n){var r=e.getZIndex(t),i=0;if(n){i=r-e.getZIndex(n)}return i},Z_ORDER_DRAWING_ORDER:function(e,t,n){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n);n&&0==r&&(r=1);return r},Z_ORDER_Y_ORDER:function(e,t,n){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n);if(n&&0===r){var i=n._boundsBottom-t._boundsBottom;r=0===i?1:i}return r}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var n=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),r=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i,s=e.getWidth()/this.map.getExtent().getWidth(),o=(e=e.scale(1/s),this.map.getMaxExtent());o.right>e.left&&o.right<e.right?i=!0:o.left>e.left&&o.left<e.right&&(i=!1);if(i!==this.rightOfDateLine||t){n=!1;this.xOffset=!0===i?o.getWidth()/r:0}this.rightOfDateLine=i}return n},getNodeType:function(e,t){},drawGeometry:function(e,t,n){var r=e.CLASS_NAME,i=!0;if("OpenLayers.Geometry.Collection"==r||"OpenLayers.Geometry.MultiPoint"==r||"OpenLayers.Geometry.MultiLineString"==r||"OpenLayers.Geometry.MultiPolygon"==r){for(var s=0,o=e.components.length;s<o;s++)i=this.drawGeometry(e.components[s],t,n)&&i;return i}i=!1;var a=!1;if("none"!=t.display){t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,n):a=!0;i=this.redrawNode(e.id,e,t,n)}if(0==i){if(l=document.getElementById(e.id)){l._style.backgroundGraphic&&(a=!0);l.parentNode.removeChild(l)}}if(a){var l;(l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX))&&l.parentNode.removeChild(l)}return i},redrawNode:function(e,t,n,r){n=this.applyDefaultSymbolizer(n);var i=this.nodeFactory(e,this.getNodeType(t,n));i._featureId=r;i._boundsBottom=t.getBounds().bottom;i._geometryClass=t.CLASS_NAME;i._style=n;var s=this.drawGeometryNode(i,t,n);if(!1===s)return!1;i=s.node;if(this.indexer){var o=this.indexer.insert(i);o?this.vectorRoot.insertBefore(i,o):this.vectorRoot.appendChild(i)}else i.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(i);this.postDraw(i);return s.complete},redrawBackgroundNode:function(e,t,n,r){var i=OpenLayers.Util.extend({},n);i.externalGraphic=i.backgroundGraphic;i.graphicXOffset=i.backgroundXOffset;i.graphicYOffset=i.backgroundYOffset;i.graphicZIndex=i.backgroundGraphicZIndex;i.graphicWidth=i.backgroundWidth||i.graphicWidth;i.graphicHeight=i.backgroundHeight||i.graphicHeight;i.backgroundGraphic=null;i.backgroundXOffset=null;i.backgroundYOffset=null;i.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,n){var r,i={isFilled:void 0===(n=n||e._style).fill||n.fill,isStroked:void 0===n.stroke?!!n.strokeWidth:n.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":if(!1===n.graphic){i.isFilled=!1;i.isStroked=!1}r=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1;r=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":r=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":r=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":r=this.drawRectangle(e,t)}e._options=i;return 0!=r&&{node:this.setStyle(e,n,i,t),complete:r}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var n=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);n&&this.textRoot.removeChild(n)},getFeatureIdFromEvent:function(e){var t=e.target,n=t&&t.correspondingUseElement;return(n||(t||e.srcElement))._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var n=0,r=e.components.length;n<r;n++)this.eraseGeometry(e.components[n],t);else{var i=OpenLayers.Util.getElement(e.id);if(i&&i.parentNode){if(i.geometry){i.geometry.destroy();i.geometry=null}i.parentNode.removeChild(i);this.indexer&&this.indexer.remove(i);if(i._style.backgroundGraphic){var s=e.id+this.BACKGROUND_ID_SUFFIX,o=OpenLayers.Util.getElement(s);o&&o.parentNode&&o.parentNode.removeChild(o)}}}},nodeFactory:function(e,t){var n=OpenLayers.Util.getElement(e);if(n){if(!this.nodeTypeCompare(n,t)){n.parentNode.removeChild(n);n=this.nodeFactory(e,t)}}else n=this.createNode(t,e);return n},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root);t.parentNode.removeChild(t);e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e;this.active=!1},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(e){this.layer=e},activate:function(){if(!this.active){this.active=!0;return!0}return!1},deactivate:function(){if(this.active){this.active=!1;return!0}return!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.layer.events.on({refresh:this.load,scope:this});1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})}return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter});t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e));t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var n=e.features;if(n&&n.length>0){var r=t.projection,i=t.map.getProjectionObject();if(!i.equals(r))for(var s,o=0,a=n.length;o<a;++o)(s=n[o].geometry)&&s.transform(r,i);t.addFeatures(n)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{};OpenLayers.Util.extend(this,e);this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null;this.format=null},read:function(e){(e=e||{}).filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,n){return OpenLayers.Function.bind(function(){e.apply(this,[t,n])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)};OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var n,r,i=e.params.LAYERS,s=(OpenLayers.Util.isArray(i)?i[0]:i).split(":");s.length>1&&(r=s[0]);n=s.pop();var o={url:e.url,featureType:n,featurePrefix:r,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,o))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,n=this.markers.length;t<n;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(t||!this.drawn){for(var r=0,i=this.markers.length;r<i;r++)this.drawMarker(this.markers[r]);this.drawn=!0}},addMarker:function(e){this.markers.push(e);this.opacity<1&&e.setOpacity(this.opacity);if(this.map&&this.map.getExtent()){e.map=this.map;this.drawMarker(e)}},removeMarker:function(e){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,e);e.erase()}},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var n=e.draw(t);this.div.appendChild(n)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0){e=new OpenLayers.Bounds;for(var t=0,n=this.markers.length;t<n;t++){var r=this.markers[t];e.extend(r.lonlat)}}return e},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var n=0!==e.indexOf("http"),r=!n&&e.match(this.URL_SPLIT_REGEX);if(r){var i=window.location;n=r[1]==i.protocol&&r[3]==i.hostname;var s=r[4],o=i.port;(80!=s&&""!=s||"80"!=o&&""!=o)&&(n=n&&s==o)}n||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e));return e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});(e=e||{}).headers=e.headers||{};(e=OpenLayers.Util.applyDefaults(e,t)).headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var n,r=!1;for(n in e.headers)e.headers.hasOwnProperty(n)&&"x-requested-with"===n.toLowerCase()&&(r=!0);!1===r&&(e.headers["X-Requested-With"]="XMLHttpRequest");var i=new OpenLayers.Request.XMLHttpRequest,s=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));s=OpenLayers.Request.makeSameOrigin(s,e.proxy);i.open(e.method,s,e.async,e.user,e.password);for(var o in e.headers)i.setRequestHeader(o,e.headers[o]);var a=this.events,l=this;i.onreadystatechange=function(){if(i.readyState==OpenLayers.Request.XMLHttpRequest.DONE){!1!==a.triggerEvent("complete",{request:i,config:e,requestUrl:s})&&l.runCallbacks({request:i,config:e,requestUrl:s})}};!1===e.async?i.send(e.data):window.setTimeout(function(){0!==i.readyState&&i.send(e.data)},0);return i},runCallbacks:function(e){var t,n,r=e.request,i=e.config,s=i.scope?OpenLayers.Function.bind(i.callback,i.scope):i.callback;i.success&&(t=i.scope?OpenLayers.Function.bind(i.success,i.scope):i.success);i.failure&&(n=i.scope?OpenLayers.Function.bind(i.failure,i.scope):i.failure);"file:"==OpenLayers.Util.createUrlObject(i.url).protocol&&r.responseText&&(r.status=200);s(r);if(!r.status||r.status>=200&&r.status<300){this.events.triggerEvent("success",e);t&&t(r)}if(r.status&&(r.status<200||r.status>=300)){this.events.triggerEvent("failure",e);n&&n(r)}},GET:function(e){e=OpenLayers.Util.extend(e,{method:"GET"});return OpenLayers.Request.issue(e)},POST:function(e){(e=OpenLayers.Util.extend(e,{method:"POST"})).headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},PUT:function(e){(e=OpenLayers.Util.extend(e,{method:"PUT"})).headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},DELETE:function(e){e=OpenLayers.Util.extend(e,{method:"DELETE"});return OpenLayers.Request.issue(e)},HEAD:function(e){e=OpenLayers.Util.extend(e,{method:"HEAD"});return OpenLayers.Request.issue(e)},OPTIONS:function(e){e=OpenLayers.Util.extend(e,{method:"OPTIONS"});return OpenLayers.Request.issue(e)}});!function(){var e=window.XMLHttpRequest,t=!!window.controllers,n=window.document.all&&!window.opera,r=n&&window.navigator.userAgent.match(/MSIE 7.0/);function i(){this._object=e&&!r?new e:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function s(){return new i}s.prototype=i.prototype;t&&e.wrapped&&(s.wrapped=e.wrapped);s.UNSENT=0;s.OPENED=1;s.HEADERS_RECEIVED=2;s.LOADING=3;s.DONE=4;s.prototype.readyState=s.UNSENT;s.prototype.responseText="";s.prototype.responseXML=null;s.prototype.status=0;s.prototype.statusText="";s.prototype.priority="NORMAL";s.prototype.onreadystatechange=null;s.onreadystatechange=null;s.onopen=null;s.onsend=null;s.onabort=null;s.prototype.open=function(e,r,i,c,u){delete this._headers;arguments.length<3&&(i=!0);this._async=i;var h,p=this,d=this.readyState;if(n&&i){h=function(){if(d!=s.DONE){l(p);p.abort()}};window.attachEvent("onunload",h)}s.onopen&&s.onopen.apply(this,arguments);arguments.length>4?this._object.open(e,r,i,c,u):arguments.length>3?this._object.open(e,r,i,c):this._object.open(e,r,i);this.readyState=s.OPENED;o(this);this._object.onreadystatechange=function(){if(!t||i){p.readyState=p._object.readyState;a(p);if(p._aborted)p.readyState=s.UNSENT;else{if(p.readyState==s.DONE){delete p._data;l(p);n&&i&&window.detachEvent("onunload",h)}d!=p.readyState&&o(p);d=p.readyState}}}};s.prototype.send=function(e){s.onsend&&s.onsend.apply(this,arguments);arguments.length||(e=null);if(e&&e.nodeType){e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=e;!function(e){e._object.send(e._data);if(t&&!e._async){e.readyState=s.OPENED;a(e);for(;e.readyState<s.DONE;){e.readyState++;o(e);if(e._aborted)return}}}(this)};s.prototype.abort=function(){s.onabort&&s.onabort.apply(this,arguments);this.readyState>s.UNSENT&&(this._aborted=!0);this._object.abort();l(this);this.readyState=s.UNSENT;delete this._data};s.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};s.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)};s.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return this._object.setRequestHeader(e,t)};s.prototype.addEventListener=function(e,t,n){for(var r,i=0;r=this._listeners[i];i++)if(r[0]==e&&r[1]==t&&r[2]==n)return;this._listeners.push([e,t,n])};s.prototype.removeEventListener=function(e,t,n){for(var r,i=0;(r=this._listeners[i])&&(r[0]!=e||r[1]!=t||r[2]!=n);i++);r&&this._listeners.splice(i,1)};s.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var n,r=0;n=this._listeners[r];r++)n[0]!=t.type||n[2]||(n[1].handleEvent||n[1]).apply(this,[t])};s.prototype.toString=function(){return"[object XMLHttpRequest]"};s.toString=function(){return"[XMLHttpRequest]"};function o(e){s.onreadystatechange&&s.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=function(e){var t=e.responseXML,r=e.responseText;if(n&&r&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){(t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1;t.validateOnParse=!1;t.loadXML(r)}return t&&(n&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}(e._object)}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function l(e){e._object.onreadystatechange=new window.Function}window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]);e.__func=this;e.__func(t[0],t[1],t[2],t[3],t[4]);delete e.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=s}();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[];this.styles={};this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var n=["Link","NetworkLink","Style","StyleMap","Placemark"],r=0,i=n.length;r<i;++r){var s=n[r],o=this.getElementsByTagNameNS(e,"*",s);if(0!=o.length)switch(s.toLowerCase()){case"link":case"networklink":this.parseLinks(o,t);break;case"style":this.extractStyles&&this.parseStyles(o,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(o,t);break;case"placemark":this.parseFeatures(o,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var n=OpenLayers.Util.extend({},t);n.depth++;for(var r=0,i=e.length;r<i;r++){var s=this.parseProperty(e[r],"*","href");if(s&&!this.fetched[s]){this.fetched[s]=!0;var o=this.fetchLink(s);o&&this.parseData(o,n)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});if(t)return t.responseText},parseStyles:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=this.parseStyle(e[n]);if(i){var s=(t.styleBaseUrl||"")+"#"+i.id;this.styles[s]=i}}},parseKmlColor:function(e){var t=null;if(e){var n=e.match(this.regExes.kmlColor);n&&(t={color:"#"+n[4]+n[3]+n[2],opacity:parseInt(n[1],16)/255})}return t},parseStyle:function(e){for(var t,n,r={},i=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],s=0,o=i.length;s<o;++s){t=i[s];if(n=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var a=this.parseProperty(n,"*","color");if(w=this.parseKmlColor(a)){r.strokeColor=w.color;r.strokeOpacity=w.opacity}(c=this.parseProperty(n,"*","width"))&&(r.strokeWidth=c);break;case"polystyle":a=this.parseProperty(n,"*","color");if(w=this.parseKmlColor(a)){r.fillOpacity=w.opacity;r.fillColor=w.color}"0"==this.parseProperty(n,"*","fill")&&(r.fillColor="none");"0"==this.parseProperty(n,"*","outline")&&(r.strokeWidth="0");break;case"iconstyle":var l=parseFloat(this.parseProperty(n,"*","scale")||1),c=32*l,u=32*l,h=this.getElementsByTagNameNS(n,"*","Icon")[0];if(h){var p=this.parseProperty(h,"*","href");if(p){var d=this.parseProperty(h,"*","w"),f=this.parseProperty(h,"*","h");if(OpenLayers.String.startsWith(p,"http://maps.google.com/mapfiles/kml")&&!d&&!f){d=64;f=64;l/=2}d=d||f;f=f||d;d&&(c=parseInt(d)*l);f&&(u=parseInt(f)*l);var y=p.match(this.regExes.kmlIconPalette);if(y){var m=y[1],g=y[2],C=this.parseProperty(h,"*","x");p="http://maps.google.com/mapfiles/kml/pal"+m+"/icon"+(8*((T=this.parseProperty(h,"*","y"))?7-T/32:7)+(C?C/32:0))+g}r.graphicOpacity=1;r.externalGraphic=p}}var v=this.getElementsByTagNameNS(n,"*","hotSpot")[0];if(v){C=parseFloat(v.getAttribute("x"));var T=parseFloat(v.getAttribute("y")),L=v.getAttribute("xunits");"pixels"==L?r.graphicXOffset=-C*l:"insetPixels"==L?r.graphicXOffset=C*l-c:"fraction"==L&&(r.graphicXOffset=-c*C);var S=v.getAttribute("yunits");"pixels"==S?r.graphicYOffset=T*l-u+1:"insetPixels"==S?r.graphicYOffset=-T*l+1:"fraction"==S&&(r.graphicYOffset=-u*(1-T)+1)}r.graphicWidth=c;r.graphicHeight=u;break;case"balloonstyle":var b=OpenLayers.Util.getXmlNodeValue(n);b&&(r.balloonStyle=b.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var w;a=this.parseProperty(n,"*","color");if(w=this.parseKmlColor(a)){r.fontColor=w.color;r.fontOpacity=w.opacity}}}!r.strokeColor&&r.fillColor&&(r.strokeColor=r.fillColor);var E=e.getAttribute("id");E&&r&&(r.id=E);return r},parseStyleMaps:function(e,t){for(var n=0,r=e.length;n<r;n++)for(var i=e[n],s=this.getElementsByTagNameNS(i,"*","Pair"),o=i.getAttribute("id"),a=0,l=s.length;a<l;a++){var c=s[a],u=this.parseProperty(c,"*","key"),h=this.parseProperty(c,"*","styleUrl");h&&"normal"==u&&(this.styles[(t.styleBaseUrl||"")+"#"+o]=this.styles[(t.styleBaseUrl||"")+h])}},parseFeatures:function(e,t){for(var n=[],r=0,i=e.length;r<i;r++){var s=e[r],o=this.parseFeature.apply(this,[s]);if(!o)throw"Bad Placemark: "+r;this.extractStyles&&o.attributes&&o.attributes.styleUrl&&(o.style=this.getStyle(o.attributes.styleUrl,t));if(this.extractStyles){var a=this.getElementsByTagNameNS(s,"*","Style")[0];if(a){var l=this.parseStyle(a);l&&(o.style=OpenLayers.Util.extend(o.style,l))}}if(this.extractTracks){var c=this.getElementsByTagNameNS(s,this.namespaces.gx,"Track");if(c&&c.length>0){var u=c[0],h={features:[],feature:o};this.readNode(u,h);h.features.length>0&&n.push.apply(n,h.features)}}else n.push(o)}this.features=this.features.concat(n)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var n=e.nodeName.split(":").pop();t.attributes[n].push(this.getChildValue(e))}},gx:{Track:function(e,t){var n={whens:[],points:[],angles:[]};if(this.trackAttributes){n.attributes={};for(var r=0,i=this.trackAttributes.length;r<i;++r){h=this.trackAttributes[r];n.attributes[h]=[];h in this.readers.kml||(this.readers.kml[h]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(e,n);if(n.whens.length!==n.points.length)throw new Error("gx:Track with unequal number of when ("+n.whens.length+") and gx:coord ("+n.points.length+") elements.");var s,o,a,l=n.angles.length>0;if(l&&n.whens.length!==n.angles.length)throw new Error("gx:Track with unequal number of when ("+n.whens.length+") and gx:angles ("+n.angles.length+") elements.");for(r=0,i=n.whens.length;r<i;++r){(s=t.feature.clone()).fid=t.feature.fid||t.feature.id;o=n.points[r];s.geometry=o;"z"in o&&(s.attributes.altitude=o.z);this.internalProjection&&this.externalProjection&&s.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var c=0,u=this.trackAttributes.length;c<u;++c){var h=this.trackAttributes[c];s.attributes[h]=n.attributes[h][r]}s.attributes.when=n.whens[r];s.attributes.trackId=t.feature.id;if(l){a=n.angles[r];s.attributes.heading=parseFloat(a[0]);s.attributes.tilt=parseFloat(a[1]);s.attributes.roll=parseFloat(a[2])}t.features.push(s)}},coord:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/),r=new OpenLayers.Geometry.Point(n[0],n[1]);n.length>2&&(r.z=parseFloat(n[2]));t.points.push(r)},angles:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(n)}}},parseFeature:function(e){for(var t,n,r,i,s=["MultiGeometry","Polygon","LineString","Point"],o=0,a=s.length;o<a;++o){t=s[o];this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns;if((n=this.getElementsByTagNameNS(e,this.internalns,t)).length>0){var l;if(!(l=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=l.apply(this,[n[0]]);this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}}this.extractAttributes&&(i=this.parseAttributes(e));var c=new OpenLayers.Feature.Vector(r,i),u=e.getAttribute("id")||e.getAttribute("name");null!=u&&(c.fid=u);return c},getStyle:function(e,t){var n=OpenLayers.Util.removeTail(e),r=OpenLayers.Util.extend({},t);r.depth++;r.styleBaseUrl=n;if(!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&r.depth<=this.maxDepth&&!this.fetched[n]){var i=this.fetchLink(n);i&&this.parseData(i,r)}return OpenLayers.Util.extend({},this.styles[e])},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=[];if(t.length>0){var r=t[0].firstChild.nodeValue;n=(r=r.replace(this.regExes.removeSpace,"")).split(",")}if(!(n.length>1))throw"Bad coordinate string: "+r;2==n.length&&(n[2]=null);return new OpenLayers.Geometry.Point(n[0],n[1],n[2])},linestring:function(e,t){var n=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),r=null;if(n.length>0){for(var i,s=this.getChildValue(n[0]),o=(s=(s=s.replace(this.regExes.trimSpace,"")).replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),a=o.length,l=new Array(a),c=0;c<a;++c){if(!((i=o[c].split(",")).length>1))throw"Bad LineString point coordinates: "+o[c];2==i.length&&(i[2]=null);l[c]=new OpenLayers.Geometry.Point(i[0],i[1],i[2])}if(!a)throw"Bad LineString coordinates: "+s;r=t?new OpenLayers.Geometry.LinearRing(l):new OpenLayers.Geometry.LineString(l)}return r},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),n=t.length,r=new Array(n);if(n>0)for(var i,s=0,o=t.length;s<o;++s){if(!(i=this.parseGeometry.linestring.apply(this,[t[s],!0])))throw"Bad LinearRing geometry: "+s;r[s]=i}return new OpenLayers.Geometry.Polygon(r)},multigeometry:function(e){for(var t,n=[],r=e.childNodes,i=0,s=r.length;i<s;++i)if(1==(t=r[i]).nodeType){var o,a=t.prefix?t.nodeName.split(":")[1]:t.nodeName;(o=this.parseGeometry[a.toLowerCase()])&&n.push(o.apply(this,[t]))}return new OpenLayers.Geometry.Collection(n)}},parseAttributes:function(e){var t,n,r={},i=e.getElementsByTagName("ExtendedData");i.length&&(r=this.parseExtendedData(i[0]));for(var s=e.childNodes,o=0,a=s.length;o<a;++o)if(1==(t=s[o]).nodeType&&(n=t.childNodes).length>=1&&n.length<=3){var l;switch(n.length){case 1:l=n[0];break;case 2:var c=n[0],u=n[1];l=3==c.nodeType||4==c.nodeType?c:u;break;case 3:default:l=n[1]}if(3==l.nodeType||4==l.nodeType){var h=t.prefix?t.nodeName.split(":")[1]:t.nodeName,p=OpenLayers.Util.getXmlNodeValue(l);if(p){p=p.replace(this.regExes.trimSpace,"");r[h]=p}}}return r},parseExtendedData:function(e){var t,n,r,i,s={},o=e.getElementsByTagName("Data");for(t=0,n=o.length;t<n;t++){i=(r=o[t]).getAttribute("name");var a={},l=r.getElementsByTagName("value");l.length&&(a.value=this.getChildValue(l[0]));if(this.kvpAttributes)s[i]=a.value;else{var c=r.getElementsByTagName("displayName");c.length&&(a.displayName=this.getChildValue(c[0]));s[i]=a}}var u=e.getElementsByTagName("SimpleData");for(t=0,n=u.length;t<n;t++){a={};i=(r=u[t]).getAttribute("name");a.value=this.getChildValue(r);if(this.kvpAttributes)s[i]=a.value;else{a.displayName=i;s[i]=a}}return s},parseProperty:function(e,t,n){var r,i=this.getElementsByTagNameNS(e,t,n);try{r=OpenLayers.Util.getXmlNodeValue(i[0])}catch(e){r=null}return r},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),n=this.createFolderXML(),r=0,i=e.length;r<i;++r)n.appendChild(this.createPlacemarkXML(e[r]));t.appendChild(n);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),n=this.createTextNode(this.foldersName);t.appendChild(n);e.appendChild(t)}if(this.foldersDesc){var r=this.createElementNS(this.kmlns,"description"),i=this.createTextNode(this.foldersDesc);r.appendChild(i);e.appendChild(r)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),n=e.style&&e.style.label?e.style.label:e.id,r=e.attributes.name||n;t.appendChild(this.createTextNode(r));var i=this.createElementNS(this.kmlns,"description"),s=e.attributes.description||this.placemarksDesc;i.appendChild(this.createTextNode(s));var o=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&o.setAttribute("id",e.fid);o.appendChild(t);o.appendChild(i);var a=this.buildGeometryNode(e.geometry);o.appendChild(a);if(e.attributes){var l=this.buildExtendedData(e.attributes);l&&o.appendChild(l)}return o},buildGeometryNode:function(e){var t=e.CLASS_NAME,n=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[n.toLowerCase()],i=null;r&&(i=r.apply(this,[e]));return i},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,n,r,i=this.createElementNS(this.kmlns,"Polygon"),s=e.components,o=0,a=s.length;o<a;++o){r=0==o?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.kmlns,r);n=this.buildGeometry.linearring.apply(this,[s[o]]);t.appendChild(n);i.appendChild(t)}return i},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,n=this.createElementNS(this.kmlns,"MultiGeometry"),r=0,i=e.components.length;r<i;++r)(t=this.buildGeometryNode.apply(this,[e.components[r]]))&&n.appendChild(t);return n}},buildCoordinatesNode:function(e){var t,n=this.createElementNS(this.kmlns,"coordinates"),r=e.components;if(r){for(var i,s=r.length,o=new Array(s),a=0;a<s;++a){i=r[a];o[a]=this.buildCoordinates(i)}t=o.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);n.appendChild(l);return n},buildCoordinates:function(e){this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);return e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var n in e)if(e[n]&&"name"!=n&&"description"!=n&&"styleUrl"!=n){var r=this.createElementNS(this.kmlns,"Data");r.setAttribute("name",n);var i=this.createElementNS(this.kmlns,"value");if("object"==typeof e[n]){e[n].value&&i.appendChild(this.createTextNode(e[n].value));if(e[n].displayName){var s=this.createElementNS(this.kmlns,"displayName");s.appendChild(this.getXMLDoc().createCDATASection(e[n].displayName));r.appendChild(s)}}else i.appendChild(this.createTextNode(e[n]));r.appendChild(i);t.appendChild(r)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]};this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]};this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]};this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]};this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var n={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=n},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var n=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);n.srs=e.getAttribute("SRS");t.bbox[n.srs]=n},ScaleHint:function(e,t){var n=e.getAttribute("min"),r=e.getAttribute("max"),i=Math.pow(2,.5),s=OpenLayers.INCHES_PER_UNIT.m;0!=n&&(t.maxScale=parseFloat((n/i*s*OpenLayers.DOTS_PER_INCH).toPrecision(13)));r!=Number.POSITIVE_INFINITY&&(t.minScale=parseFloat((r/i*s*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var n={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[n.name]=n},Extent:function(e,t){var n=e.getAttribute("name").toLowerCase();if(n in t.dimensions){var r=t.dimensions[n];r.nearestVal="1"===e.getAttribute("nearestValue");r.multipleVal="1"===e.getAttribute("multipleValues");r.current="1"===e.getAttribute("current");r.default=e.getAttribute("default")||"";var i=this.getChildValue(e);r.values=i.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var n=this.getChildValue(e).split(/ +/),r=0,i=n.length;r<i;r++)t.srs[n[r]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]);e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),n=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:n});return t},setFeatureType:function(e){this.featureType=e;this.format.featureType=e},setGeometryName:function(e){this.geometryName=e;this.format.geometryName=e},handleRead:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);if(t.callback){var n=e.priv;if(n.status>=200&&n.status<300){var r=this.parseResponse(n,t.readOptions);if(r&&!1!==r.success){t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,r):e.features=r;e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=r}}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var n=e.responseXML;n&&n.documentElement||(n=e.responseText);if(!n||n.length<=0)return null;var r=null!==this.readFormat?this.readFormat.read(n):this.format.read(n,t);if(!this.featureNS){var i=this.readFormat||this.format;this.featureNS=i.featureNS;i.autoConfig=!1;this.geometryName||this.setGeometryName(i.geometryName)}return r},commit:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});n.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,n,t)});return n},handleCommit:function(e,t){if(t.callback){var n=e.priv,r=n.responseXML;r&&r.documentElement||(r=n.responseText);var i=this.format.read(r)||{};e.insertIds=i.insertIds||[];if(i.success)e.code=OpenLayers.Protocol.Response.SUCCESS;else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=i}t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);new OpenLayers.Protocol.Response({requestType:"commit"});var n=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),r=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var i=this.format.writeNode("ogc:Filter",e);r.appendChild(i);n.appendChild(r);var s=OpenLayers.Format.XML.prototype.write.apply(this.format,[n]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:s})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={};this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={};this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});this.writeNode("ows:MinimumValue",e.minValue,t);this.writeNode("ows:MaximumValue",e.maxValue,t);return t},MinimumValue:function(e){return this.createElementNSPlus("ows:MinimumValue",{value:e})},MaximumValue:function(e){return this.createElementNSPlus("ows:MaximumValue",{value:e})},Value:function(e){return this.createElementNSPlus("ows:Value",{value:e})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,n,r=(new Date).getTime(),i=0,s=this.points.length;i<s&&!(r-(n=this.points[i]).tick>this.delay);i++)t=n;if(t){var o=(new Date).getTime()-t.tick,a=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=a/o;if(!(0==l||l<this.threshold)){var c=Math.asin((e.y-t.xy.y)/a);t.xy.x<=e.x&&(c=Math.PI-c);return{speed:l,theta:c}}}},move:function(e,t){var n=e.speed,r=Math.cos(e.theta),i=-Math.sin(e.theta),s=(new Date).getTime(),o=0,a=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var e=(new Date).getTime()-s,l=-this.deceleration*Math.pow(e,2)/2+n*e,c=l*r,u=l*i,h={end:!1};if(-this.deceleration*e+n<=0){OpenLayers.Animation.stop(this.timerId);this.timerId=null;h.end=!0}h.x=c-o;h.y=u-a;o=c;a=u;t(h.x,h.y,h.end)}},this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return e},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t,n=e.features;e.features=[];for(var r=0,i=n.length;r<i;++r){t=n[r];this.filter.evaluate(t)?e.features.push(t):this.cache.push(t)}}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=!0;this.layer.removeFeatures(this.cache.slice());this.caching=!1}if(t.length>0){var n={features:t};this.handleAdd(n);if(n.features.length>0){this.caching=!0;this.layer.addFeatures(n.features);this.caching=!1}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(!0===this.documentDrag){var r=this;this._docMove=function(e){r.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})};this._docUp=function(e){r.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;this.dragging=!1;if(this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))){this.started=!0;this.start=e.xy;this.last=e.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(e);this.callback("down",[e.xy]);OpenLayers.Event.preventDefault(e);this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True);document.onselectstart=OpenLayers.Function.False;t=!this.stopDown}else{this.started=!1;this.start=null;this.last=null}return t},dragmove:function(e){this.lastMoveEvt=e;if(this.started&&!this.timeoutId&&(e.xy.x!=this.last.x||e.xy.y!=this.last.y)){if(!0===this.documentDrag&&this.documentEvents)if(e.element===document){this.adjustXY(e);this.setEvent(e)}else this.removeDocumentEvents();this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval));this.dragging=!0;this.move(e);this.callback("move",[e.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=e.xy}return!0},dragend:function(e){if(this.started){if(!0===this.documentDrag&&this.documentEvents){this.adjustXY(e);this.removeDocumentEvents()}var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(e);this.callback("up",[e.xy]);t&&this.callback("done",[e.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){this.startTouch();return this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){e.xy=this.last;return this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(e);this.callback("out",[]);t&&this.callback("done",[e.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.dragging=!1;this.start=null;this.last=null;e=!0;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0];e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,n=this.dragHandler.start.y,r=Math.abs(t-e.x),i=Math.abs(n-e.y),s=this.getBoxOffsets();this.zoomBox.style.width=r+s.width+1+"px";this.zoomBox.style.height=i+s.height+1+"px";this.zoomBox.style.left=(e.x<t?t-r-s.left:t-s.left)+"px";this.zoomBox.style.top=(e.y<n?n-i-s.top:n-s.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var n=this.dragHandler.start,r=Math.min(n.y,e.y),i=Math.max(n.y,e.y),s=Math.min(n.x,e.x),o=Math.max(n.x,e.x);t=new OpenLayers.Bounds(s,i,o,r)}else t=this.dragHandler.start.clone();this.removeBox();this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox();return!0}return!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute";e.style.border="1px solid black";e.style.width="3px";document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:n,right:r,top:i,bottom:s,width:!1===t?n+r:0,height:!1===t?i+s:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,n=e.getCenterPixel();if(this.out){var r=e.right-e.left,i=e.bottom-e.top,s=Math.min(this.map.size.h/i,this.map.size.w/r),o=this.map.getExtent(),a=this.map.getLonLatFromPixel(n),l=a.lon-o.getWidth()/2*s,c=a.lon+o.getWidth()/2*s,u=a.lat-o.getHeight()/2*s,h=a.lat+o.getHeight()/2*s;t=new OpenLayers.Bounds(l,u,c,h)}else{var p=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),d=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(p.lon,p.lat,d.lon,d.lat)}var f=this.map.getZoom(),y=this.map.getSize(),m={x:y.w/2,y:y.h/2},g=this.map.getZoomForExtent(t),C=this.map.getResolution(),v=this.map.getResolutionForZoom(g);if(C==v)this.map.setCenter(this.map.getLonLatFromPixel(n));else{var T={x:(C*n.x-v*m.x)/(C-v),y:(C*n.y-v*m.y)/(C-v)};this.map.zoomTo(g,T)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e);this.panned=!0;this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;this.kinetic&&(t=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1});if(t){var n=this;this.kinetic.move(t,function(e,t,r){n.map.pan(e,t,{dragging:!r,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){this.startTouch();this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},touchmove:function(e){this.last=this.getEventInfo(e);return!0},touchend:function(e){if(this.down){e.xy=this.last.xy;e.lastTouches=this.last.touches;this.handleSingle(e);this.down=null}return!0},mousedown:function(e){this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},mouseup:function(e){var t=!0;this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e));return t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId){this.clearTimer();this.callback("dblrightclick",[e]);return!this.stopDouble}var t=this.double?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),n=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(n,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null;e&&this.callback("rightclick",[e])},click:function(e){this.last||(this.last=this.getEventInfo(e));this.handleSingle(e);return!this.stopSingle},dblclick:function(e){this.handleDouble(e);return!this.stopDouble},handleDouble:function(e){if(this.passesDblclickTolerance(e)){this.double&&this.callback("dblclick",[e]);this.clearTimer()}},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId){if(this.last.touches&&1===this.last.touches.length){this.double&&OpenLayers.Event.preventDefault(e);this.handleDouble(e)}this.last.touches&&2===this.last.touches.length||this.clearTimer()}else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length)for(var n=0,r=this.down.touches.length;n<r;++n)if(this.getTouchDistance(this.down.touches[n],this.last.touches[n])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=!0;this.down&&this.first&&(t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}if(null!=this.rightclickTimerId){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(e){this.timerId=null;e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var n,r=e.touches.length;t=new Array(r);for(var i=0;i<r;i++){n=e.touches[i];t[i]={clientX:n.olClientX,clientY:n.olClientY}}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};this.handlers.click=new OpenLayers.Handler.Click(this,e,{double:!0,stopDouble:!0});this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();var t=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(t,this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var n=this.map.getZoom(),r=n+t;r=Math.max(r,0);(r=Math.min(r,this.map.getNumZoomLevels()))!==n&&this.map.zoomTo(r,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,n,r){var i=[];n=OpenLayers.Util.upperCaseObject(n);parseFloat(n.VERSION)>=1.3&&!n.EXCEPTIONS&&(n.EXCEPTIONS="INIMAGE");i.push(e,t,n,r);OpenLayers.Layer.Grid.prototype.initialize.apply(this,i);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){null!=r&&r.isBaseLayer||(this.isBaseLayer=!1);"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));return e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),n={},r=this.reverseAxisOrder();n.BBOX=this.encodeBBOX?e.toBBOX(null,r):e.toArray(r);n.WIDTH=t.w;n.HEIGHT=t.h;return this.getFullRequestString(n)},mergeNewParams:function(e){var t=[OpenLayers.Util.upperCaseObject(e)];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,t)},getFullRequestString:function(e,t){var n=this.map.getProjectionObject(),r=this.projection&&this.projection.equals(n)?this.projection.getCode():n.getCode(),i="none"==r?null:r;parseFloat(this.params.VERSION)>=1.3?this.params.CRS=i:this.params.SRS=i;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style.default),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style.delete)};if(e instanceof OpenLayers.Style){this.styles.default=e;this.styles.select=e;this.styles.temporary=e;this.styles.delete=e}else if("object"==typeof e)for(var n in e)if(e[n]instanceof OpenLayers.Style)this.styles[n]=e[n];else{if("object"!=typeof e[n]){this.styles.default=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles.delete=new OpenLayers.Style(e);break}this.styles[n]=new OpenLayers.Style(e[n])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector);this.styles[t]||(t="default");e.renderIntent=t;var n={};this.extendDefault&&"default"!=t&&(n=this.styles.default.createSymbolizer(e));return OpenLayers.Util.extend(n,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,n,r){var i=[];for(var s in n)i.push(new OpenLayers.Rule({symbolizer:n[s],context:r,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:s})}));this.styles[e].addRules(i)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var n=0,r=this.strategies.length;n<r;n++)this.strategies[n].setLayer(this)},destroy:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;t<n;t++)(e=this.strategies[t]).autoDestroy&&e.destroy();this.strategies=null}if(this.protocol){this.protocol.autoDestroy&&this.protocol.destroy();this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;this.renderer&&this.renderer.destroy();this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions()));e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,n=t.length,r=new Array(n),i=0;i<n;++i)r[i]=t[i].clone();e.features=r;return e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var n=this.renderers[e],r="function"==typeof n?n:OpenLayers.Renderer[n];if(r&&r.prototype.supported()){this.renderer=new r(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio;t.h=t.h*this.ratio;this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;t<n;t++)(e=this.strategies[t]).autoActivate&&e.activate()}},removeMap:function(e){this.drawn=!1;if(this.strategies){var t,n,r;for(n=0,r=this.strategies.length;n<r;n++)(t=this.strategies[n]).autoActivate&&t.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio;e.h=e.h*this.ratio;this.renderer.setSize(e)},moveTo:function(e,t,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var r=!0;if(!n){this.renderer.root.style.visibility="hidden";var i=this.map.getSize(),s=i.w,o=i.h,a=s/2*this.ratio-s/2,l=o/2*this.ratio-o/2;a+=this.map.layerContainerOriginPx.x;a=-Math.round(a);l+=this.map.layerContainerOriginPx.y;l=-Math.round(l);this.div.style.left=a+"px";this.div.style.top=l+"px";var c=this.map.getExtent().scale(this.ratio);r=this.renderer.setExtent(c,t);this.renderer.root.style.visibility="visible";!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft);if(!t&&r)for(var u in this.unrenderedFeatures){var h=this.unrenderedFeatures[u];this.drawFeature(h)}}if(!this.drawn||t||!r){this.drawn=!0;u=0;for(var p=this.features.length;u<p;u++){this.renderer.locked=u!==p-1;h=this.features[u];this.drawFeature(h)}}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var n=!t||!t.silent;if(n){var r={features:e};if(!1===this.events.triggerEvent("beforefeaturesadded",r))return;e=r.features}for(var i=[],s=0,o=e.length;s<o;s++){s!=e.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var a=e[s];if(this.geometryType&&!(a.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);a.layer=this;!a.style&&this.style&&(a.style=OpenLayers.Util.extend({},this.style));if(n){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:a}))continue;this.preFeatureInsert(a)}i.push(a);this.features.push(a);this.drawFeature(a);if(n){this.events.triggerEvent("featureadded",{feature:a});this.onFeatureInsert(a)}}n&&this.events.triggerEvent("featuresadded",{features:i})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]);e===this.selectedFeatures&&(e=e.slice());var n=!t||!t.silent;n&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var r=e.length-1;r>=0;r--){0!=r&&e[r-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var i=e[r];delete this.unrenderedFeatures[i.id];n&&this.events.triggerEvent("beforefeatureremoved",{feature:i});this.features=OpenLayers.Util.removeItem(this.features,i);i.layer=null;i.geometry&&this.renderer.eraseFeatures(i);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,i)&&OpenLayers.Util.removeItem(this.selectedFeatures,i);n&&this.events.triggerEvent("featureremoved",{feature:i})}n&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t,n=!e||!e.silent,r=this.features;n&&this.events.triggerEvent("beforefeaturesremoved",{features:r});for(var i=r.length-1;i>=0;i--){t=r[i];n&&this.events.triggerEvent("beforefeatureremoved",{feature:t});t.layer=null;n&&this.events.triggerEvent("featureremoved",{feature:t})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];n&&this.events.triggerEvent("featuresremoved",{features:r})},destroyFeatures:function(e,t){void 0==e&&(e=this.features);if(e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var n=t||e.renderIntent;(t=e.style||this.style)||(t=this.styleMap.createSymbolizer(e,n))}var r=this.renderer.drawFeature(e,t);!1===r||null===r?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,n=this.renderer.getFeatureIdFromEvent(e);n&&(t="string"==typeof n?this.getFeatureById(n):n);return t},getFeatureBy:function(e,t){for(var n=null,r=0,i=this.features.length;r<i;++r)if(this.features[r][e]==t){n=this.features[r];break}return n},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var n,r,i=this.features.length,s=[];for(n=0;n<i;n++)(r=this.features[n])&&r.attributes&&r.attributes[e]===t&&s.push(r);return s},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var n=null,r=0,i=t.length;r<i;r++)if(n=t[r].geometry){null===e&&(e=new OpenLayers.Bounds);e.extend(n.getBounds())}return e},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){if(this.supported()){OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}}},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,n){var r=e+(n?0:this.translationParameters.x),i=t+(n?0:this.translationParameters.y);return r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL&&i>=-this.MAX_PIXEL&&i<=this.MAX_PIXEL},setExtent:function(e,t){var n=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),i=-e.left/r,s=e.top/r;if(t){this.left=i;this.top=s;var o="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",o);this.translate(this.xOffset,0);return!0}var a=this.translate(i-this.left+this.xOffset,s-this.top);a||this.setExtent(e,!0);return n&&a},translate:function(e,t){if(this.inValidRange(e,t,!0)){var n="";(e||t)&&(n="translate("+e+","+t+")");this.root.setAttributeNS(null,"transform",n);this.translationParameters={x:e,y:t};return!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":n=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":n="rect";break;case"OpenLayers.Geometry.LineString":n="polyline";break;case"OpenLayers.Geometry.LinearRing":n="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="path"}return n},setStyle:function(e,t,n){t=t||e._style;n=n||e._options;var r=t.title||t.graphicTitle;if(r){e.setAttributeNS(null,"title",r);var i=e.getElementsByTagName("title");if(i.length>0)i[0].firstChild.textContent=r;else{var s=this.nodeFactory(null,"title");s.textContent=r;e.appendChild(s)}}var o,a=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&a){e.style.visibility="";if(!1===t.graphic)e.style.visibility="hidden";else if(t.externalGraphic){o=this.getPosition(e);t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var c=t.graphicWidth||t.graphicHeight,u=t.graphicHeight||t.graphicWidth;c=c||2*t.pointRadius;u=u||2*t.pointRadius;var h=void 0!=t.graphicXOffset?t.graphicXOffset:-.5*c,p=void 0!=t.graphicYOffset?t.graphicYOffset:-.5*u,d=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(o.x+h).toFixed());e.setAttributeNS(null,"y",(o.y+p).toFixed());e.setAttributeNS(null,"width",c);e.setAttributeNS(null,"height",u);e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic);e.setAttributeNS(null,"style","opacity: "+d);e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var f=3*t.pointRadius,y=2*f,m=this.importSymbol(t.graphicName);o=this.getPosition(e);l=3*this.symbolMetrics[m.id][0]/y;var g=e.parentNode,C=e.nextSibling;g&&g.removeChild(e);e.firstChild&&e.removeChild(e.firstChild);e.appendChild(m.firstChild.cloneNode(!0));e.setAttributeNS(null,"viewBox",m.getAttributeNS(null,"viewBox"));e.setAttributeNS(null,"width",y);e.setAttributeNS(null,"height",y);e.setAttributeNS(null,"x",o.x-f);e.setAttributeNS(null,"y",o.y-f);C?g.insertBefore(e,C):g&&g.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var v=t.rotation;if((void 0!==v||void 0!==e._rotation)&&o){e._rotation=v;v|=0;if("svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+v+" "+o.x+" "+o.y+")");else{var T=this.symbolMetrics[m.id];e.firstChild.setAttributeNS(null,"transform","rotate("+v+" "+T[1]+" "+T[2]+")")}}}if(n.isFilled){e.setAttributeNS(null,"fill",t.fillColor);e.setAttributeNS(null,"fill-opacity",t.fillOpacity)}else e.setAttributeNS(null,"fill","none");if(n.isStroked){e.setAttributeNS(null,"stroke",t.strokeColor);e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity);e.setAttributeNS(null,"stroke-width",t.strokeWidth*l);e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round");e.setAttributeNS(null,"stroke-linejoin","round");t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))}else e.setAttributeNS(null,"stroke","none");t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents);null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor);return e},dashStyle:function(e,t){var n=e.strokeWidth*t,r=e.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[1,4*n].join();case"dash":return[4*n,4*n].join();case"dashdot":return[4*n,4*n,1,4*n].join();case"longdash":return[8*n,4*n].join();case"longdashdot":return[8*n,4*n,1,4*n].join();default:return OpenLayers.String.trim(r).replace(/\s+/g,",")}},createNode:function(e,t){var n=document.createElementNS(this.xmlns,e);t&&n.setAttributeNS(null,"id",t);return n},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");e.style.display="block";return e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(e);return e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){var r=this.getResolution(),i=(t.x-this.featureDx)/r+this.left,s=this.top-t.y/r;if(this.inValidRange(i,s)){e.setAttributeNS(null,"cx",i);e.setAttributeNS(null,"cy",s);e.setAttributeNS(null,"r",n);return e}return!1},drawLineString:function(e,t){var n=this.getComponentsString(t.components);if(n.path){e.setAttributeNS(null,"points",n.path);return n.complete?e:null}return!1},drawLinearRing:function(e,t){var n=this.getComponentsString(t.components);if(n.path){e.setAttributeNS(null,"points",n.path);return n.complete?e:null}return!1},drawPolygon:function(e,t){for(var n,r,i="",s=!0,o=!0,a=0,l=t.components.length;a<l;a++){i+=" M";if(r=(n=this.getComponentsString(t.components[a].components," ")).path){i+=" "+r;o=n.complete&&o}else s=!1}i+=" z";if(s){e.setAttributeNS(null,"d",i);e.setAttributeNS(null,"fill-rule","evenodd");return o?e:null}return!1},drawRectangle:function(e,t){var n=this.getResolution(),r=(t.x-this.featureDx)/n+this.left,i=this.top-t.y/n;if(this.inValidRange(r,i)){e.setAttributeNS(null,"x",r);e.setAttributeNS(null,"y",i);e.setAttributeNS(null,"width",t.width/n);e.setAttributeNS(null,"height",t.height/n);return e}return!1},drawText:function(e,t,n){var r=!!t.labelOutlineWidth;if(r){var i=OpenLayers.Util.extend({},t);i.fontColor=i.labelOutlineColor;i.fontStrokeColor=i.labelOutlineColor;i.fontStrokeWidth=t.labelOutlineWidth;t.labelOutlineOpacity&&(i.fontOpacity=t.labelOutlineOpacity);delete i.labelOutlineWidth;this.drawText(e,i,n)}var s=this.getResolution(),o=(n.x-this.featureDx)/s+this.left,a=n.y/s-this.top,l=r?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,c=this.nodeFactory(e+l,"text");c.setAttributeNS(null,"x",o);c.setAttributeNS(null,"y",-a);t.fontColor&&c.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&c.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&c.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&c.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&c.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&c.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&c.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&c.setAttributeNS(null,"font-style",t.fontStyle);if(!0===t.labelSelect){c.setAttributeNS(null,"pointer-events","visible");c._featureId=e}else c.setAttributeNS(null,"pointer-events","none");var u=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;c.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[0]]||"middle");!0===OpenLayers.IS_GECKO&&c.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[1]]||"central");for(var h=t.label.split("\n"),p=h.length;c.childNodes.length>p;)c.removeChild(c.lastChild);for(var d=0;d<p;d++){var f=this.nodeFactory(e+l+"_tspan_"+d,"tspan");if(!0===t.labelSelect){f._featureId=e;f._geometry=n;f._geometryClass=n.CLASS_NAME}!1===OpenLayers.IS_GECKO&&f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[u[1]]||"-35%");f.setAttribute("x",o);if(0==d){var y=OpenLayers.Renderer.SVG.LABEL_VFACTOR[u[1]];null==y&&(y=-.5);f.setAttribute("dy",y*(p-1)+"em")}else f.setAttribute("dy","1em");f.textContent=""===h[d]?" ":h[d];f.parentNode||c.appendChild(f)}c.parentNode||this.textRoot.appendChild(c)},getComponentsString:function(e,t){for(var n,r,i=[],s=!0,o=e.length,a=[],l=0;l<o;l++){r=e[l];i.push(r);if(n=this.getShortString(r))a.push(n);else{l>0&&this.getShortString(e[l-1])&&a.push(this.clipLine(e[l],e[l-1]));l<o-1&&this.getShortString(e[l+1])&&a.push(this.clipLine(e[l],e[l+1]));s=!1}}return{path:a.join(t||","),complete:s}},clipLine:function(e,t){if(t.equals(e))return"";var n,r=this.getResolution(),i=this.MAX_PIXEL-this.translationParameters.x,s=this.MAX_PIXEL-this.translationParameters.y,o=(t.x-this.featureDx)/r+this.left,a=this.top-t.y/r,l=(e.x-this.featureDx)/r+this.left,c=this.top-e.y/r;if(l<-i||l>i){n=(c-a)/(l-o);c=a+((l=l<0?-i:i)-o)*n}if(c<-s||c>s){n=(l-o)/(c-a);l=o+((c=c<0?-s:s)-a)*n}return l+","+c},getShortString:function(e){var t=this.getResolution(),n=(e.x-this.featureDx)/t+this.left,r=this.top-e.y/t;return!!this.inValidRange(n,r)&&n+","+r},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,n=document.getElementById(t);if(null!=n)return n;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");var i=this.nodeFactory(t,"symbol"),s=this.nodeFactory(null,"polygon");i.appendChild(s);for(var o,a,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),c=[],u=0;u<r.length;u+=2){o=r[u];a=r[u+1];l.left=Math.min(l.left,o);l.bottom=Math.min(l.bottom,a);l.right=Math.max(l.right,o);l.top=Math.max(l.top,a);c.push(o,",",a)}s.setAttributeNS(null,"points",c.join(" "));var h=l.getWidth(),p=l.getHeight(),d=[l.left-h,l.bottom-p,3*h,3*p];i.setAttributeNS(null,"viewBox",d.join(" "));this.symbolMetrics[t]=[Math.max(h,p),l.getCenterLonLat().lon,l.getCenterLonLat().lat];this.defs.appendChild(i);return i},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var n=e.target;t=n.parentNode&&n!=this.rendererRoot?n.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)};OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop);""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible";this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(e){var t=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,t),r=parseInt(e/n);return(r>5?5:r>2?2:1)*n},update:function(){var e=this.map.getResolution();if(e){var t,n,r=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,s=this.maxWidth*e*i[r],o=1;if(!0===this.geodesic){s*=o=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth/(s/i.km)}if(s>1e5){t=this.topOutUnits;n=this.bottomOutUnits}else{t=this.topInUnits;n=this.bottomInUnits}var a=s/i[t],l=s/i[n],c=this.getBarLen(a),u=this.getBarLen(l),h=(a=c/i[r]*i[t])/e/o,p=(l=u/i[r]*i[n])/e/o;if("visible"==this.eBottom.style.visibility){this.eBottom.style.width=Math.round(p)+"px";this.eBottom.innerHTML=u+" "+n}if("visible"==this.eTop.style.visibility){this.eTop.style.width=Math.round(h)+"px";this.eTop.innerHTML=c+" "+t}}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,n,r){this.url=e;this.size=t||{w:20,h:20};this.offset=n||{x:-this.size.w/2,y:-this.size.h/2};this.calculateOffset=r;var i=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(i)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e);this.draw()},setUrl:function(e){null!=e&&(this.url=e);this.draw()},draw:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(e);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e);if(null!=this.imageDiv)if(null==this.px)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var n=t||OpenLayers.Marker.defaultIcon();if(null==this.icon)this.icon=n;else{this.icon.url=n.url;this.icon.size=n.size;this.icon.offset=n.offset;this.icon.calculateOffset=n.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(null!=this.icon){this.icon.destroy();this.icon=null}},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e);this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var e=!1;if(this.map){e=this.map.getExtent().containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify),read:function(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if("function"==typeof filter){function walk(e,t){if(t&&"object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(t[n]=walk(n,t[n]));return filter(e,t)}object=walk("",object)}}}catch(e){}this.keepData&&(this.data=object);return object},write:function(e,t){this.pretty=!!t;var n=null,r=typeof e;if(this.serialize[r])try{n=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[r].apply(this,[e])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return n},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t,n,r,i=["{"];this.level+=1;var s=!1;for(t in e)if(e.hasOwnProperty(t)){n=OpenLayers.Format.JSON.prototype.write.apply(this,[t,this.pretty]);r=OpenLayers.Format.JSON.prototype.write.apply(this,[e[t],this.pretty]);if(null!=n&&null!=r){s&&i.push(",");i.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),r);s=!0}}this.level-=1;i.push(this.writeNewline(),this.writeIndent(),"}");return i.join("")},array:function(e){var t,n=["["];this.level+=1;for(var r=0,i=e.length;r<i;++r)if(null!=(t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]))){r>0&&n.push(",");n.push(this.writeNewline(),this.writeIndent(),t)}this.level-=1;n.push(this.writeNewline(),this.writeIndent(),"]");return n.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,n){var r=t[n];if(r)return r;r=n.charCodeAt();return"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16)})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,n){t=t||"FeatureCollection";var r=null,i=null;if(i="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,n]):e){if("string"!=typeof i.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(i,t))switch(t){case"Geometry":try{r=this.parseGeometry(i)}catch(e){OpenLayers.Console.error(e)}break;case"Feature":try{(r=this.parseFeature(i)).type="Feature"}catch(e){OpenLayers.Console.error(e)}break;case"FeatureCollection":r=[];switch(i.type){case"Feature":try{r.push(this.parseFeature(i))}catch(e){r=null;OpenLayers.Console.error(e)}break;case"FeatureCollection":for(var s=0,o=i.features.length;s<o;++s)try{r.push(this.parseFeature(i.features[s]))}catch(e){r=null;OpenLayers.Console.error(e)}break;default:try{var a=this.parseGeometry(i);r.push(new OpenLayers.Feature.Vector(a))}catch(e){r=null;OpenLayers.Console.error(e)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return r},isValidType:function(e,t){var n=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):n=!0;break;case"FeatureCollection":n=!0;break;default:e.type==t?n=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return n},parseFeature:function(e){var t,n,r,i;r=e.properties?e.properties:{};i=e.geometry&&e.geometry.bbox||e.bbox;try{n=this.parseGeometry(e.geometry)}catch(e){throw e}t=new OpenLayers.Feature.Vector(n,r);i&&(t.bounds=OpenLayers.Bounds.fromArray(i));e.id&&(t.fid=e.id);return t},parseGeometry:function(e){if(null==e)return null;var t,n=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var r=e.geometries.length,i=new Array(r),s=0;s<r;++s)i[s]=this.parseGeometry.apply(this,[e.geometries[s]]);t=new OpenLayers.Geometry.Collection(i);n=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}this.internalProjection&&this.externalProjection&&!n&&t.transform(this.externalProjection,this.internalProjection);return t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],n=null,r=0,i=e.length;r<i;++r){try{n=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],n=null,r=0,i=e.length;r<i;++r){try{n=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],n=null,r=0,i=e.length;r<i;++r){try{n=this.parseCoords.linestring.apply(this,[e[r]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,n,r=[],i=0,s=e.length;i<s;++i){try{n=this.parseCoords.linestring.apply(this,[e[i]])}catch(e){throw e}t=new OpenLayers.Geometry.LinearRing(n.components);r.push(t)}return new OpenLayers.Geometry.Polygon(r)},multipolygon:function(e){for(var t=[],n=null,r=0,i=e.length;r<i;++r){try{n=this.parseCoords.polygon.apply(this,[e[r]])}catch(e){throw e}t.push(n)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var n={type:null};if(OpenLayers.Util.isArray(e)){n.type="FeatureCollection";var r=e.length;n.features=new Array(r);for(var i=0;i<r;++i){var s=e[i];if(!s instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+s}n.features[i]=this.extract.feature.apply(this,[s])}}else if(0==e.CLASS_NAME.indexOf("OpenLayers.Geometry"))n=this.extract.geometry.apply(this,[e]);else if(e instanceof OpenLayers.Feature.Vector){n=this.extract.feature.apply(this,[e]);e.layer&&e.layer.projection&&(n.crs=this.createCRSObject(e))}return OpenLayers.Format.JSON.prototype.write.apply(this,[n,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),n={};if(t.match(/epsg:/i)){var r=parseInt(t.substring(t.indexOf(":")+1));n=4326==r?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+r}}}return n},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),n={type:"Feature",properties:e.attributes,geometry:t};null!=e.fid&&(n.id=e.fid);return n},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME.split(".")[2],n=this.extract[t.toLowerCase()].apply(this,[e]);return"Collection"==t?{type:"GeometryCollection",geometries:n}:{type:t,coordinates:n}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],n=0,r=e.components.length;n<r;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},linestring:function(e){for(var t=[],n=0,r=e.components.length;n<r;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},multilinestring:function(e){for(var t=[],n=0,r=e.components.length;n<r;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},polygon:function(e){for(var t=[],n=0,r=e.components.length;n<r;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},multipolygon:function(e){for(var t=[],n=0,r=e.components.length;n<r;++n)t.push(this.extract.polygon.apply(this,[e.components[n]]));return t},collection:function(e){for(var t=e.components.length,n=new Array(t),r=0;r<t;++r)n[r]=this.extract.geometry.apply(this,[e.components[r]]);return n}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,n,r,i,s){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=e;this.lonlat=t;this.contentSize=null!=n?n:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=r&&(this.contentHTML=r);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var o=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(o,null,null,null,"relative",null,"hidden");e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);i&&this.addCloseBox(s);this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(e){null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);if(!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME){this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");if("hidden"!=e){this.contentDiv._oldOverflow=e;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;if(e){this.contentDiv.style.overflow=e;this.contentDiv._oldOverflow=null}})}this.moveTo(e);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),n=t.left+t.right,r=t.top+t.bottom;this.fixPadding();n+=this.padding.left+this.padding.right;r+=this.padding.top+this.padding.bottom;if(this.closeDiv){n+=parseInt(this.closeDiv.style.width)+t.right}this.size.w+=n;this.size.h+=r;if("msie"==OpenLayers.BROWSER_NAME){this.contentSize.w+=t.left+t.right;this.contentSize.h+=t.bottom+t.top}if(null!=this.div){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(null!=this.contentDiv){this.contentDiv.style.width=e.w+"px";this.contentDiv.style.height=e.h+"px"}},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,n=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),r=this.getSafeContentSize(n),i=null;if(r.equals(n))i=n;else{var s={w:r.w<n.w?r.w:null,h:r.h<n.h?r.h:null};if(s.w&&s.h)i=r;else{var o=OpenLayers.Util.getRenderedDimensions(e,s,{displayClass:this.contentDisplayClass,containerElement:t});if("hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&o.equals(r)){var a=OpenLayers.Util.getScrollbarWidth();s.w?o.h+=a:o.w+=a}i=this.getSafeContentSize(o)}}this.setSize(i)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e);if(null!=this.div){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+100*this.opacity+")"}},setBorder:function(e){void 0!=e&&(this.border=e);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e);if(null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){for(var e=function(){if(null!==this.popup.id){this.popup.updateSize();this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView();OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad)}},t=this.contentDiv.getElementsByTagName("img"),n=0,r=t.length;n<r;n++){var i=t[n];if(0==i.width||0==i.height){var s={popup:this,img:i};i._onImgLoad=OpenLayers.Function.bind(e,s);OpenLayers.Event.observe(i,"load",i._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),n=this.getContentDivPadding(),r=n.left+n.right,i=n.top+n.bottom;this.fixPadding();r+=this.padding.left+this.padding.right;i+=this.padding.top+this.padding.bottom;if(this.closeDiv){r+=parseInt(this.closeDiv.style.width)+n.right}if(this.minSize){t.w=Math.max(t.w,this.minSize.w-r);t.h=Math.max(t.h,this.minSize.h-i)}if(this.maxSize){t.w=Math.min(t.w,this.maxSize.w-r);t.h=Math.min(t.h,this.maxSize.h-i)}if(this.map&&this.map.size){var s=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var a=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":s=a.x;o=this.map.size.h-a.y;break;case"tl":s=this.map.size.w-a.x;o=this.map.size.h-a.y;break;case"bl":s=this.map.size.w-a.x;o=a.y;break;case"br":s=a.x;o=a.y;break;default:s=a.x;o=this.map.size.h-a.y}}var l=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-i-o,c=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-r-s;t.w=Math.min(t.w,c);t.h=Math.min(t.h,l)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;if(!e){if(null==this.div.parentNode){this.div.style.display="none";document.body.appendChild(this.div)}e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=e;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px";this.closeDiv.style.top=t.top+"px";this.groupDiv.appendChild(this.closeDiv);var n=e||function(e){this.hide();OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(n,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(n,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),n=t.clone();t.x<this.map.paddingForPopups.left?n.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(n.x=e.w-this.map.paddingForPopups.right-this.size.w);t.y<this.map.paddingForPopups.top?n.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(n.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var r=t.x-n.x,i=t.y-n.y;this.map.pan(r,i)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(e){OpenLayers.Event.stop(e,!0)},scope:this})},onmousedown:function(e){this.mousedown=!0;OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){if(this.mousedown){this.mousedown=!1;OpenLayers.Event.stop(e,!0)}},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,n,r,i,s,o){var a=[e,t,n,r,s,o];OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=null!=i?i:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e));this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),n=this.map.getExtent().determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(n)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),n=this.size||this.contentSize,r="t"==this.relativePosition.charAt(0);t.y+=r?-n.h:this.anchor.size.h;var i="l"==this.relativePosition.charAt(1);t.x+=i?-n.w:this.anchor.size.w;return t},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,n,r,i,s,o){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(e){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;s&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image);t.image=null;t.div&&this.groupDiv.removeChild(t.div);t.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px";this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return t=t.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var n=this.positionBlocks[e],r=0;r<n.blocks.length;r++){var i={};this.blocks.push(i);var s=this.id+"_FrameDecorationDiv_"+r;i.div=OpenLayers.Util.createDiv(s,null,null,null,"absolute",null,"hidden",null);var o=this.id+"_FrameDecorationImg_"+r,a=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;i.image=a(o,null,this.imageSize,this.imageSrc,"absolute",null,null,null);i.div.appendChild(i.image);this.groupDiv.appendChild(i.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var n=e.blocks[t],r=this.blocks[t],i=n.anchor.left,s=n.anchor.bottom,o=n.anchor.right,a=n.anchor.top,l=isNaN(n.size.w)?this.size.w-(o+i):n.size.w,c=isNaN(n.size.h)?this.size.h-(s+a):n.size.h;r.div.style.width=(l<0?0:l)+"px";r.div.style.height=(c<0?0:c)+"px";r.div.style.left=null!=i?i+"px":"";r.div.style.bottom=null!=s?s+"px":"";r.div.style.right=null!=o?o+"px":"";r.div.style.top=null!=a?a+"px":"";r.image.style.left=n.position.x+"px";r.image.style.top=n.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var n,r=e.contents,i=(r.layers,0),s=r.layers.length;i<s;++i)if(r.layers[i].identifier===t.layer){n=r.layers[i];break}if(!n)throw new Error("Layer not found");var o,a,l=t.format;!l&&n.formats&&n.formats.length&&(l=n.formats[0]);t.matrixSet?o=r.tileMatrixSets[t.matrixSet]:n.tileMatrixSetLinks.length>=1&&(o=r.tileMatrixSets[n.tileMatrixSetLinks[0].tileMatrixSet]);if(!o)throw new Error("matrixSet not found");for(i=0,s=n.styles.length;i<s&&!(a=n.styles[i]).isDefault;++i);var c=t.requestEncoding;if(!c){c="KVP";if(e.operationsMetadata.GetTile.dcp.http){var u=e.operationsMetadata.GetTile.dcp.http;if(u.get[0].constraints){var h=u.get[0].constraints.GetEncoding.allowedValues;h.KVP||!h.REST&&!h.RESTful||(c="REST")}}}var p=[],d=t.params||{};delete t.params;for(var f=0,y=n.dimensions.length;f<y;f++){var m=n.dimensions[f];p.push(m.identifier);d.hasOwnProperty(m.identifier)||(d[m.identifier]=m.default)}var g,C=t.projection||o.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),v=t.units||("EPSG:4326"===C?"degrees":"m"),T=[];for(var L in o.matrixIds)o.matrixIds.hasOwnProperty(L)&&T.push(28e-5*o.matrixIds[L].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[v]);if("REST"===c&&n.resourceUrls){g=[];n.resourceUrls;for(var S,b=0,w=n.resourceUrls.length;b<w;++b)(S=n.resourceUrls[b]).format===l&&"tile"===S.resourceType&&g.push(S.template)}else{var E,O=e.operationsMetadata.GetTile.dcp.http.get;g=[];for(i=0,s=O.length;i<s;i++)(!(E=O[i].constraints)||E&&E.GetEncoding.allowedValues[c])&&g.push(O[i].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:g,requestEncoding:c,name:n.title,style:a.identifier,format:l,matrixIds:o.matrixIds,matrixSet:o.identifier,projection:C,units:v,resolutions:!1===t.isBaseLayer?void 0:T,serverResolutions:T,tileFullExtent:o.bounds,dimensions:p,params:d}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var n={done:this.measureComplete,point:this.measurePartial};this.immediate&&(n.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(n,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(e){this.immediate=e;this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var n=this.active;n&&this.deactivate();this.handler=new e(this,this.callbacks,t);n&&this.activate()},measureComplete:function(e){this.cancelDelay();this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay();t=t.clone();this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,n){if(n&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();this.measure(t.geometry,"measurepartial")}},cancelDelay:function(){if(null!==this.delayedTrigger){window.clearTimeout(this.delayedTrigger);this.delayedTrigger=null}},measure:function(e,t){var n,r;if(e.CLASS_NAME.indexOf("LineString")>-1){n=this.getBestLength(e);r=1}else{n=this.getBestArea(e);r=2}this.events.triggerEvent(t,{measure:n[0],units:n[1],order:r,geometry:e})},getBestArea:function(e){for(var t,n,r=this.displaySystemUnits[this.displaySystem],i=0,s=r.length;i<s;++i){t=r[i];if((n=this.getArea(e,t))>1)break}return[n,t]},getArea:function(e,t){var n,r;if(this.geodesic){n=e.getGeodesicArea(this.map.getProjectionObject());r="m"}else{n=e.getArea();r=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){var s=OpenLayers.INCHES_PER_UNIT[r];n*=Math.pow(s/i,2)}return n},getBestLength:function(e){for(var t,n,r=this.displaySystemUnits[this.displaySystem],i=0,s=r.length;i<s;++i){t=r[i];if((n=this.getLength(e,t))>1)break}return[n,t]},getLength:function(e,t){var n,r;if(this.geodesic){n=e.getGeodesicLength(this.map.getProjectionObject());r="m"}else{n=e.getLength();r=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){n*=OpenLayers.INCHES_PER_UNIT[r]/i}return n},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t);t.version=this.version;return t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={};t.contents.layers=[];t.contents.tileMatrixSets={};this.readChildNodes(e,t.contents)},Layer:function(e,t){var n={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(e,n);t.layers.push(n)},Style:function(e,t){var n={};n.isDefault="true"===e.getAttribute("isDefault");this.readChildNodes(e,n);t.styles.push(n)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var n={};this.readChildNodes(e,n);t.tileMatrixSetLinks.push(n)},TileMatrixSet:function(e,t){if(t.layers){var n={matrixIds:[]};this.readChildNodes(e,n);t.tileMatrixSets[n.identifier]=n}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var n={supportedCRS:t.supportedCRS};this.readChildNodes(e,n);t.matrixIds.push(n)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var n,r=this.getChildValue(e).split(" ");if(t.supportedCRS){var i=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");n=!!this.yx[i]}t.topLeftCorner=n?new OpenLayers.LonLat(r[1],r[0]):new OpenLayers.LonLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var n=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[n]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:n};t.resourceUrls.push(r)},WSDL:function(e,t){t.wsdl={};t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={};t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},LegendURL:function(e,t){t.legend={};t.legend.href=e.getAttribute("xlink:href");t.legend.format=e.getAttribute("format")},Dimension:function(e,t){var n={values:[]};this.readChildNodes(e,n);t.dimensions.push(n)},Default:function(e,t){t.default=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,n,r,i,s,o){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(e)){this.started=!0;this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1};this.callback("start",[e,this.start]);t=!this.stopDown}else{if(this.started)return!1;this.started=!1;this.start=null;this.last=null}OpenLayers.Event.preventDefault(e);return t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]);this.last=t;OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){if(this.started&&!OpenLayers.Event.isMultiTouch(e)){this.started=!1;this.pinching=!1;this.callback("done",[e,this.start,this.last]);this.start=null;this.last=null;return!1}return!0},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.pinching=!1;this.start=null;this.last=null;e=!0}return e},getDistance:function(e){var t=e[0],n=e[1];return Math.sqrt(Math.pow(t.olClientX-n.olClientX,2)+Math.pow(t.olClientY-n.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),n=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:n}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){if(this.passesTolerance(e.xy)){this.clearTimer();this.callback("move",[e]);this.px=e.xy;e=OpenLayers.Util.extend({},e);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)}return!this.stopMove},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[e])}return!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2))<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions);this.previous=new OpenLayers.Control.Button(t);var n={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(n,this.nextOptions);this.next=new OpenLayers.Control.Button(n);this.clear()},onPreviousChange:function(e,t){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e,t){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e;this.next.setMap(e);this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();if(void 0!=t){this.nextStack.unshift(e);this.previousStack.unshift(t);this.restoring=!0;this.restore(t);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else this.previousStack.unshift(e);return t},nextTrigger:function(){var e=this.nextStack.shift();if(void 0!=e){this.previousStack.unshift(e);this.restoring=!0;this.restore(e);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return e},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,n;if(this.map.getProjectionObject()==e.projection){n=this.map.getZoomForResolution(e.resolution);t=e.center}else{(t=e.center.clone()).transform(e.projection,this.map.getProjectionObject());var r=e.units,i=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,s=r&&i?OpenLayers.INCHES_PER_UNIT[r]/OpenLayers.INCHES_PER_UNIT[i]:1;n=this.map.getZoomForResolution(s*e.resolution)}this.map.setCenter(t,n)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t);this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0;0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear();e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this});return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})}return e},cacheFeatures:function(e){var t=!0;if(!this.clustering){this.clearCache();this.features=e.features;this.cluster();t=!1}return t},clearCache:function(){this.clustering||(this.features=null)},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var n,r,i,s=[],o=0;o<this.features.length;++o)if((n=this.features[o]).geometry){r=!1;for(var a=s.length-1;a>=0;--a){i=s[a];if(this.shouldCluster(i,n)){this.addToCluster(i,n);r=!0;break}}r||s.push(this.createCluster(this.features[o]))}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(s.length>0){if(this.threshold>1){var l,c=s.slice();s=[];o=0;for(var u=c.length;o<u;++o)(l=c[o]).attributes.count<this.threshold?Array.prototype.push.apply(s,l.cluster):s.push(l)}this.clustering=!0;this.layer.addFeatures(s);this.clustering=!1}this.clusters=s}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var n=e.geometry.getBounds().getCenterLonLat(),r=t.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(n.lon-r.lon,2)+Math.pow(n.lat-r.lat,2))/this.resolution<=this.distance},addToCluster:function(e,t){e.cluster.push(t);e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});n.cluster=[e];return n},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){if(this.mapDiv){this.handlers.click&&this.handlers.click.destroy();this.handlers.drag&&this.handlers.drag.destroy();this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(!this.map.baseLayer){this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}var e=this.map.baseLayer.clone();this.layers=[e]}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1e3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,n=this.handlers.drag.last.y-e.y;if(0!=t||0!=n){var r=this.rectPxBounds.top,i=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),a=Math.max(0,r-n);a=Math.min(a,this.ovmap.size.h-this.hComp-s);var l=Math.max(0,i-t);l=Math.min(l,this.ovmap.size.w-this.wComp-o);this.setRectPxBounds(new OpenLayers.Bounds(l,a+s,l+o,a))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),n=e.xy.x-t.x,r=e.xy.y-t.y,i=this.rectPxBounds.top,s=this.rectPxBounds.left,o=Math.abs(this.rectPxBounds.getHeight()),a=this.rectPxBounds.getWidth(),l=Math.max(0,i+r);l=Math.min(l,this.ovmap.size.h-o);var c=Math.max(0,s+n);c=Math.min(c,this.ovmap.size.w-a);this.setRectPxBounds(new OpenLayers.Bounds(c,l+o,c+a,l));this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="";this.showToggle(!1);null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none";this.showToggle(!0);null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none");this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap();!this.autoPan&&this.isSuitableOverview()||this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),n=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(n=n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var r=this.ovmap.getResolution()/this.map.getResolution();return r>this.minRatio&&r<=this.maxRatio&&this.ovmap.getExtent().containsBounds(n)},updateOverview:function(){var e,t=this.map.getResolution(),n=this.ovmap.getResolution(),r=n/t;r>this.maxRatio?n=this.minRatio*t:r<=this.minRatio&&(n=this.maxRatio*t);this.ovmap.getProjection()!=this.map.getProjection()?(e=this.map.center.clone()).transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):e=this.map.center;this.ovmap.setCenter(e,this.ovmap.getZoomForResolution(n*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,e);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=this.wComp?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=this.hComp?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,double:!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,n=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&n?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[n]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),n=Math.max(e.left,0),r=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),i=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),s=Math.max(i-n,0),o=Math.max(r-t,0);if(s<this.minRectSize||o<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var a=n+s/2-this.minRectSize/2,l=t+o/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px";this.extentRectangle.style.left=Math.round(a)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(t)+"px";this.extentRectangle.style.left=Math.round(n)+"px";this.extentRectangle.style.height=Math.round(o)+"px";this.extentRectangle.style.width=Math.round(s)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(n),Math.round(r),Math.round(i),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),n=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),r=null;t&&n&&(r=new OpenLayers.Bounds(t.x,t.y,n.x,n.y));return r},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),n=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,n.lon,n.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,n=this.ovmap.getResolution(),r=this.ovmap.getExtent().getCenterLonLat(),i=e.x-t.w/2,s=e.y-t.h/2;return{lon:r.lon+i*n,lat:r.lat-s*n}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),n=this.ovmap.getExtent();if(n)return{x:Math.round(1/t*(e.lon-n.left)),y:Math.round(1/t*(n.top-e.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),n=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],r=0,i=n.length;r<i;r++)t.addRule("olv\\:"+n[r],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var n=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),i=e.left/r|0,s=e.top/r-this.size.h|0;if(t||!this.offset){this.offset={x:i,y:s};i=0;s=0}else{i-=this.offset.x;s-=this.offset.y}var o=i-this.xOffset+" "+s;this.root.coordorigin=o;for(var a,l=[this.root,this.vectorRoot,this.textRoot],c=0,u=l.length;c<u;++c){a=l[c];var h=this.size.w+" "+this.size.h;a.coordsize=h}this.root.style.flip="y";return n},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,n=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],r=this.size.w+"px",i=this.size.h+"px",s=0,o=n.length;s<o;++s){(t=n[s]).style.width=r;t.style.height=i}},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":n=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":n="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="olv:shape"}return n},setStyle:function(e,t,n,r){t=t||e._style;n=n||e._options;var i=t.fillColor,s=t.title||t.graphicTitle;s&&(e.title=s);if("OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){n.isFilled=!0;var o=t.graphicWidth||t.graphicHeight,a=t.graphicHeight||t.graphicWidth;o=o||2*t.pointRadius;a=a||2*t.pointRadius;var l=this.getResolution(),c=void 0!=t.graphicXOffset?t.graphicXOffset:-.5*o,u=void 0!=t.graphicYOffset?t.graphicYOffset:-.5*a;e.style.left=((r.x-this.featureDx)/l-this.offset.x+c|0)+"px";e.style.top=(r.y/l-this.offset.y-(u+a)|0)+"px";e.style.width=o+"px";e.style.height=a+"px";e.style.flip="y";i="none";n.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var h=this.importSymbol(t.graphicName);e.path=h.path;e.coordorigin=h.left+","+h.bottom;var p=h.size;e.coordsize=p+","+p;this.drawCircle(e,r,t.pointRadius);e.style.flip="y"}else this.drawCircle(e,r,t.pointRadius);n.isFilled?e.fillcolor=i:e.filled="false";var d=e.getElementsByTagName("fill"),f=0==d.length?null:d[0];if(n.isFilled){f||(f=this.createNode("olv:fill",e.id+"_fill"));f.opacity=t.fillOpacity;if("OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic){t.graphicOpacity&&(f.opacity=t.graphicOpacity);f.src=t.externalGraphic;f.type="frame";t.graphicWidth&&t.graphicHeight||(f.aspect="atmost")}f.parentNode!=e&&e.appendChild(f)}else f&&e.removeChild(f);var y=t.rotation;if(void 0!==y||void 0!==e._rotation){e._rotation=y;if(t.externalGraphic){this.graphicRotate(e,c,u,t);f.opacity=0}else"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=y||0)}var m=e.getElementsByTagName("stroke"),g=0==m.length?null:m[0];if(n.isStroked){if(!g){g=this.createNode("olv:stroke",e.id+"_stroke");e.appendChild(g)}g.on=!0;g.color=t.strokeColor;g.weight=t.strokeWidth+"px";g.opacity=t.strokeOpacity;g.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round";t.strokeDashstyle&&(g.dashstyle=this.dashStyle(t))}else{e.stroked=!1;g&&(g.on=!1)}"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor);return e},graphicRotate:function(e,t,n,r){var i,s,o=(r=r||e._style).rotation||0;if(r.graphicWidth&&r.graphicHeight){s=Math.max(r.graphicWidth,r.graphicHeight);i=r.graphicWidth/r.graphicHeight;var a=Math.round(r.graphicWidth||s*i),l=Math.round(r.graphicHeight||s);e.style.width=a+"px";e.style.height=l+"px";var c=document.getElementById(e.id+"_image");if(!c){c=this.createNode("olv:imagedata",e.id+"_image");e.appendChild(c)}c.style.width=a+"px";c.style.height=l+"px";c.src=r.externalGraphic;c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var u=o*Math.PI/180,h=Math.sin(u),p=Math.cos(u),d="progid:DXImageTransform.Microsoft.Matrix(M11="+p+",M12="+-h+",M21="+h+",M22="+p+",SizingMethod='auto expand')\n",f=r.graphicOpacity||r.fillOpacity;f&&1!=f&&(d+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+f+")\n");e.style.filter=d;var y=new OpenLayers.Geometry.Point(-t,-n),m=new OpenLayers.Bounds(0,0,a,l).toGeometry();m.rotate(r.rotation,y);var g=m.getBounds();e.style.left=Math.round(parseInt(e.style.left)+g.left)+"px";e.style.top=Math.round(parseInt(e.style.top)-g.bottom)+"px"}else{var C=new Image;C.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==C.readyState||"interactive"==C.readyState){i=C.width/C.height;s=Math.max(2*r.pointRadius,r.graphicWidth||0,r.graphicHeight||0);t*=i;r.graphicWidth=s*i;r.graphicHeight=s;this.graphicRotate(e,t,n,r)}},this);C.src=r.externalGraphic}},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,n=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t);"none"==n&&e.strokecolor!=n&&(e.strokecolor=n)},setNodeDimension:function(e,t){var n=t.getBounds();if(n){var r=this.getResolution(),i=new OpenLayers.Bounds((n.left-this.featureDx)/r-this.offset.x|0,n.bottom/r-this.offset.y|0,(n.right-this.featureDx)/r-this.offset.x|0,n.top/r-this.offset.y|0);e.style.left=i.left+"px";e.style.top=i.top+"px";e.style.width=i.getWidth()+"px";e.style.height=i.getHeight()+"px";e.coordorigin=i.left+" "+i.top;e.coordsize=i.getWidth()+" "+i.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var n=t.split(/[ ,]/);return 2==n.length?1*n[0]>=2*n[1]?"longdash":1==n[0]||1==n[1]?"dot":"dash":4==n.length?1*n[0]>=2*n[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var n=document.createElement(e);t&&(n.id=t);n.unselectable="on";n.onselectstart=OpenLayers.Function.False;return n},nodeTypeCompare:function(e,t){var n=t,r=n.indexOf(":");-1!=r&&(n=n.substr(r+1));var i=e.nodeName;-1!=(r=i.indexOf(":"))&&(i=i.substr(r+1));return n==i},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){if(!isNaN(t.x)&&!isNaN(t.y)){var r=this.getResolution();e.style.left=((t.x-this.featureDx)/r-this.offset.x|0)-n+"px";e.style.top=(t.y/r-this.offset.y|0)-n+"px";var i=2*n;e.style.width=i+"px";e.style.height=i+"px";return e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,n){this.setNodeDimension(e,t);for(var r,i,s,o=this.getResolution(),a=t.components.length,l=new Array(a),c=0;c<a;c++){i=((r=t.components[c]).x-this.featureDx)/o-this.offset.x|0;s=r.y/o-this.offset.y|0;l[c]=" "+i+","+s+" l "}var u=n?" x e":" e";e.path="m"+l.join("")+u;return e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var n,r,i,s,o,a,l,c,u,h,p=this.getResolution(),d=[];for(n=0,r=t.components.length;n<r;n++){d.push("m");i=t.components[n].components;s=0===n;o=null;a=null;for(l=0,c=i.length;l<c;l++){h=" "+(((u=i[l]).x-this.featureDx)/p-this.offset.x|0)+","+(u.y/p-this.offset.y|0);d.push(h);0==l&&d.push(" l");s||(o?o!=h&&(a?a!=h&&(s=!0):a=h):o=h)}d.push(s?" x ":" ")}d.push("e");e.path=d.join("");return e},drawRectangle:function(e,t){var n=this.getResolution();e.style.left=((t.x-this.featureDx)/n-this.offset.x|0)+"px";e.style.top=(t.y/n-this.offset.y|0)+"px";e.style.width=(t.width/n|0)+"px";e.style.height=(t.height/n|0)+"px";return e},drawText:function(e,t,n){var r=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),i=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),s=this.getResolution();r.style.left=((n.x-this.featureDx)/s-this.offset.x|0)+"px";r.style.top=(n.y/s-this.offset.y|0)+"px";r.style.flip="y";i.innerText=t.label;"inherit"!=t.cursor&&null!=t.cursor&&(i.style.cursor=t.cursor);t.fontColor&&(i.style.color=t.fontColor);t.fontOpacity&&(i.style.filter="alpha(opacity="+100*t.fontOpacity+")");t.fontFamily&&(i.style.fontFamily=t.fontFamily);t.fontSize&&(i.style.fontSize=t.fontSize);t.fontWeight&&(i.style.fontWeight=t.fontWeight);t.fontStyle&&(i.style.fontStyle=t.fontStyle);if(!0===t.labelSelect){r._featureId=e;i._featureId=e;i._geometry=n;i._geometryClass=n.CLASS_NAME}i.style.whiteSpace="nowrap";i.inset="1px,0px,0px,0px";if(!r.parentNode){r.appendChild(i);this.textRoot.appendChild(r)}var o=t.labelAlign||"cm";1==o.length&&(o+="m");var a=i.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[o.substr(0,1)],l=i.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[o.substr(1,1)];r.style.left=parseInt(r.style.left)-a-1+"px";r.style.top=parseInt(r.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id));t&&t.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,n=this.symbolCache[t];if(n)return n;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");for(var i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),s=["m"],o=0;o<r.length;o+=2){var a=r[o],l=r[o+1];i.left=Math.min(i.left,a);i.bottom=Math.min(i.bottom,l);i.right=Math.max(i.right,a);i.top=Math.max(i.top,l);s.push(a);s.push(l);0==o&&s.push("l")}s.push("x e");var c=s.join(" "),u=(i.getWidth()-i.getHeight())/2;if(u>0){i.bottom=i.bottom-u;i.top=i.top+u}else{i.left=i.left+u;i.right=i.right-u}n={path:c,size:i.getWidth(),left:i.left,bottom:i.bottom};this.symbolCache[t]=n;return n},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){e=e||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,n){return t.write(e,n)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);(e=e||{}).params=OpenLayers.Util.applyDefaults(e.params,this.options.params);(e=OpenLayers.Util.applyDefaults(e,this.options)).filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,n=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded";n.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,n,e),data:OpenLayers.Util.getParameterString(e.params),headers:r})}else n.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,n,e),params:e.params,headers:e.headers});return n},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});n.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,n,t),headers:t.headers,data:this.format.write(e)});return n},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){var n=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),i=this.updateWithPOST?"POST":"PUT";r.priv=OpenLayers.Request[i]({url:n,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)});return r},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){var n=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),i=this.deleteWithPOST?"POST":"DELETE",s={url:n,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};this.deleteWithPOST&&(s.data=this.format.write(e));r.priv=OpenLayers.Request[i](s);return r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var n=e.priv;if(t.callback){if(n.status>=200&&n.status<300){"delete"!=e.requestType&&(e.features=this.parseFeatures(n));e.code=OpenLayers.Protocol.Response.SUCCESS}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText);return!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=[],r=0,i={};i[OpenLayers.State.INSERT]=[];i[OpenLayers.State.UPDATE]=[];i[OpenLayers.State.DELETE]=[];for(var s,o,a=[],l=0,c=e.length;l<c;++l)if(o=i[(s=e[l]).state]){o.push(s);a.push(s)}var u=(i[OpenLayers.State.INSERT].length>0?1:0)+i[OpenLayers.State.UPDATE].length+i[OpenLayers.State.DELETE].length,h=!0,p=new OpenLayers.Protocol.Response({reqFeatures:a});function d(e){this.callUserCallback(e,t);h=h&&e.success();if(++r>=u&&t.callback){p.code=h?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;t.callback.apply(t.scope,[p])}}var f=i[OpenLayers.State.INSERT];f.length>0&&n.push(this.create(f,OpenLayers.Util.applyDefaults({callback:function(e){for(var t=e.features?e.features.length:0,n=new Array(t),r=0;r<t;++r)n[r]=e.features[r].fid;p.insertIds=n;d.apply(this,[e])},scope:this},t.create)));for(l=(f=i[OpenLayers.State.UPDATE]).length-1;l>=0;--l)n.push(this.update(f[l],OpenLayers.Util.applyDefaults({callback:d,scope:this},t.update)));for(l=(f=i[OpenLayers.State.DELETE]).length-1;l>=0;--l)n.push(this.delete(f[l],OpenLayers.Util.applyDefaults({callback:d,scope:this},t.delete)));return n},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var n=t[e.requestType];n&&n.callback&&n.callback.call(n.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,n,r){OpenLayers.Handler.prototype.initialize.apply(this,[e,n,r]);this.layer=t},touchstart:function(e){this.startTouch();return!!OpenLayers.Event.isMultiTouch(e)||this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy);return!this.handle(e)||!this.stopDown},mouseup:function(e){this.up=e.xy;return!this.handle(e)||!this.stopUp},click:function(e){return!this.handle(e)||!this.stopClick},mousemove:function(e){if(!this.callbacks.over&&!this.callbacks.out)return!0;this.handle(e);return!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,n=!1,r=!!this.feature,i="click"==t||"dblclick"==t||"touchstart"==t;this.feature=this.layer.getFeatureFromEvent(e);this.feature&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);if(this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var s=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(r&&s){this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]);this.triggerCallback(t,"in",[this.feature])}else r&&!i||this.triggerCallback(t,"in",[this.feature]);this.lastFeature=this.feature;n=!0}else{this.lastFeature&&(r&&s||i)&&this.triggerCallback(t,"out",[this.lastFeature]);this.feature=null}}else this.lastFeature&&(r||i)&&this.triggerCallback(t,"out",[this.lastFeature]);return n},triggerCallback:function(e,t,n){var r=this.EVENTMAP[e][t];if(r)if("click"==e&&this.up&&this.down){Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(r,n);this.up=this.down=null}else this.callback(r,n)},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(e,t){},onDrag:function(e,t){},onComplete:function(e,t){},onEnter:function(e){},onLeave:function(e){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);this.layer=e;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){if(this.handlers.feature.touch&&!this.over&&this.overFeature(e)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=!1}},clickoutFeature:function(e){if(this.handlers.feature.touch&&this.over){this.outFeature(e);this.handlers.drag.stopDown=!0}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;if(this.handlers.drag.dragging)this.feature.id==e.id?this.over=!0:this.over=!1;else{this.feature=e;this.handlers.drag.activate();t=!0;this.over=!0;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(e)}return t},downFeature:function(e){this.lastPixel=e;this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y));this.layer.drawFeature(this.feature);this.lastPixel=e;this.onDrag(this.feature,e)},upFeature:function(e){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){if(this.handlers.drag.dragging)this.feature.id==e.id&&(this.over=!1);else{this.over=!1;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(e);this.feature=null}},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(e){this.handlers.drag.setMap(e);this.handlers.feature.setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var n=e.documentElement;if(n){var r=this["read_"+n.nodeName];t=r?r.call(this,n):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],n=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(n)for(var r=0,i=n.length;r<i;++r){var s=n[r],o=s.nodeName;s.prefix&&(o=o.split(":")[1]);o=o.replace(this.layerIdentifier,"");var a=this.getSiblingNodesByTagCriteria(s,this.featureIdentifier);if(a)for(var l=0;l<a.length;l++){var c=a[l],u=this.parseGeometry(c),h=this.parseAttributes(c),p=new OpenLayers.Feature.Vector(u.geometry,h,null);p.bounds=u.bounds;p.type=o;t.push(p)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"*","FIELDS"),r=0,i=n.length;r<i;r++){var s,o=n[r],a={},l=o.attributes.length;if(l>0)for(s=0;s<l;s++){var c=o.attributes[s];a[c.nodeName]=c.nodeValue}else{var u=o.childNodes;for(s=0,l=u.length;s<l;++s){var h=u[s];3!=h.nodeType&&(a[h.getAttribute("name")]=h.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(null,a,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var n,r,i,s,o,a=[];if(e&&e.hasChildNodes()){i=(n=e.childNodes).length;for(var l=0;l<i;l++){o=n[l];for(;o&&1!=o.nodeType;){o=o.nextSibling;l++}(r=o?o.nodeName:"").length>0&&r.indexOf(t)>-1?a.push(o):(s=this.getSiblingNodesByTagCriteria(o,t)).length>0&&(0==a.length?a=s:a.push(s))}}return a},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var n=e.childNodes,r=n.length,i=0;i<r;++i){var s=n[i];if(1==s.nodeType){var o=s.childNodes,a=s.prefix?s.nodeName.split(":")[1]:s.nodeName;if(0==o.length)t[a]=null;else if(1==o.length){var l=o[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[a]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,n=this.gmlFormat.parseFeature(e),r=null;if(n){t=n.geometry&&n.geometry.clone();r=n.bounds&&n.bounds.clone();n.destroy()}return{geometry:t,bounds:r}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){(e=e||{}).handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));!0===this.drillDown&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,n=this.layers||this.map.layers,r=[],i=n.length-1;i>=0;--i)if((e=n[i])instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;!1!==this.drillDown||this.url||(this.url=t);(!0===this.drillDown||this.urlMatches(t))&&r.push(e)}return r},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var n=0,r=this.layerUrls.length;n<r;++n)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[n],e)){t=!0;break}return t},buildWMSOptions:function(e,t,n,r){for(var i=[],s=[],o=0,a=t.length;o<a;o++)if(null!=t[o].params.LAYERS){i=i.concat(t[o].params.LAYERS);s=s.concat(this.getStyleNames(t[o]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var h=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:r,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(n.x),j:parseInt(n.y)}:{srs:c,x:parseInt(n.x),y:parseInt(n.y)});0!=i.length&&(h=OpenLayers.Util.extend({layers:i,query_layers:i,styles:s},h));OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(h),callback:function(t){this.handleResponse(n,t,e)},scope:this}},getStyleNames:function(e){return e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){if(0!=(i=this.findLayers()).length){t=t||{};if(!1===this.drillDown){var n=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),r=OpenLayers.Request.GET(n);!0===t.hover&&(this.hoverRequest=r)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var i,s={},o=0,a=i.length;o<a;o++){var l=i[o];if((c=OpenLayers.Util.isArray(l.url)?l.url[0]:l.url)in s)s[c].push(l);else{this._numRequests++;s[c]=[l]}}for(var c in s){i=s[c];n=this.buildWMSOptions(c,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(n)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,n){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:n,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,n){var r=t.responseXML;r&&r.documentElement||(r=t.responseText);var i=this.format.read(r);if(!1===this.drillDown)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;"object"===this.output?this._features=(this._features||[]).concat({url:n,features:i}):this._features=(this._features||[]).concat(i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var n=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.pinchOrigin=n;this.currentCenter=n},pinchMove:function(e,t){var n=t.scale,r=this.map.layerContainerOriginPx,i=this.pinchOrigin,s=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy,o=Math.round(r.x+s.x-i.x+(n-1)*(r.x-i.x)),a=Math.round(r.y+s.y-i.y+(n-1)*(r.y-i.y));this.map.applyTransform(o,a,n);this.currentCenter=s},pinchDone:function(e,t,n){this.map.applyTransform();var r=this.map.getZoomForResolution(this.map.getResolution()/n.scale,!0);if(r!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var i=this.map.getResolutionForZoom(r),s=this.map.getLonLatFromPixel(this.pinchOrigin),o=this.currentCenter,a=this.map.getSize();s.lon+=i*(a.w/2-o.x);s.lat-=i*(a.h/2-o.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(s,r)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});var Proj4js={defaultDatum:"WGS84",transform:function(e,t,n){if(!e.readyToUse){this.reportError("Proj4js initialization for:"+e.srsCode+" not yet complete");return n}if(!t.readyToUse){this.reportError("Proj4js initialization for:"+t.srsCode+" not yet complete");return n}if(e.datum&&t.datum&&((e.datum.datum_type==Proj4js.common.PJD_3PARAM||e.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=t.datumCode||(t.datum.datum_type==Proj4js.common.PJD_3PARAM||t.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=e.datumCode)){var r=Proj4js.WGS84;this.transform(e,r,n);e=r}"enu"!=e.axis&&this.adjust_axis(e,!1,n);if("longlat"==e.projName){n.x*=Proj4js.common.D2R;n.y*=Proj4js.common.D2R}else{if(e.to_meter){n.x*=e.to_meter;n.y*=e.to_meter}e.inverse(n)}e.from_greenwich&&(n.x+=e.from_greenwich);n=this.datum_transform(e.datum,t.datum,n);t.from_greenwich&&(n.x-=t.from_greenwich);if("longlat"==t.projName){n.x*=Proj4js.common.R2D;n.y*=Proj4js.common.R2D}else{t.forward(n);if(t.to_meter){n.x/=t.to_meter;n.y/=t.to_meter}}"enu"!=t.axis&&this.adjust_axis(t,!0,n);return n},datum_transform:function(e,t,n){if(e.compare_datums(t))return n;if(e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM)return n;if(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM){e.geodetic_to_geocentric(n);e.datum_type!=Proj4js.common.PJD_3PARAM&&e.datum_type!=Proj4js.common.PJD_7PARAM||e.geocentric_to_wgs84(n);t.datum_type!=Proj4js.common.PJD_3PARAM&&t.datum_type!=Proj4js.common.PJD_7PARAM||t.geocentric_from_wgs84(n);t.geocentric_to_geodetic(n)}return n},adjust_axis:function(e,t,n){for(var r,i,s=n.x,o=n.y,a=n.z||0,l=0;l<3;l++)if(!t||2!=l||void 0!==n.z){if(0==l){r=s;i="x"}else if(1==l){r=o;i="y"}else{r=a;i="z"}switch(e.axis[l]){case"e":n[i]=r;break;case"w":n[i]=-r;break;case"n":n[i]=r;break;case"s":n[i]=-r;break;case"u":void 0!==n[i]&&(n.z=r);break;case"d":void 0!==n[i]&&(n.z=-r);break;default:alert("ERROR: unknow axis ("+e.axis[l]+") - check definition of "+e.projName);return null}}return n},reportError:function(e){},extend:function(e,t){e=e||{};if(t)for(var n in t){var r=t[n];void 0!==r&&(e[n]=r)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},n={},r=0;r<arguments.length;++r){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];Proj4js.extend(n,e)}t.prototype=n;return t},bind:function(e,t){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var r=n.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},scriptName:"proj4js-combined.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,n=document.getElementsByTagName("script"),r=0;r<n.length;r++){var i=n[r].getAttribute("src");if(i){var s=i.lastIndexOf(e);if(s>-1&&s+t==i.length){this.libPath=i.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,n,r){var i=document.createElement("script");i.defer=!1;i.type="text/javascript";i.id=e;i.src=e;i.onload=t;i.onerror=n;i.loadCheck=r;/MSIE/.test(navigator.userAgent)&&(i.onreadystatechange=this.checkReadyState);document.getElementsByTagName("head")[0].appendChild(i)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},QRCode;Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(e,t){this.srsCodeInput=e;this.queue=[];t&&this.queue.push(t);if(e.indexOf("GEOGCS")>=0||e.indexOf("GEOCCS")>=0||e.indexOf("PROJCS")>=0||e.indexOf("LOCAL_CS")>=0){this.parseWKT(e);this.deriveConstants();this.loadProjCode(this.projName)}else{if(0==e.indexOf("urn:")){var n=e.split(":");"ogc"!=n[1]&&"x-ogc"!=n[1]||"def"!=n[2]||"crs"!=n[3]||(e=n[4]+":"+n[n.length-1])}else if(0==e.indexOf("http://")){var r=e.split("#");r[0].match(/epsg.org/)?e="EPSG:"+r[1]:r[0].match(/RIG.xml/)&&(e="IGNF:"+r[1])}this.srsCode=e.toUpperCase();if(0==this.srsCode.indexOf("EPSG")){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("IGNF")){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("CRS")){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}this.loadProjDefinition()}},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])this.defsLoaded();else{var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))}},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){return!!Proj4js.defs[this.srsCode]},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])this.initTransforms();else{var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))}},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return!!Proj4js.Proj[e]},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=!0;if(this.queue)for(var e;e=this.queue.shift();)e.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(e){var t=e.match(this.wktRE);if(t){var n,r=t[1],i=t[2].split(",");n=(n=(n="TOWGS84"==r.toUpperCase()?r:i.shift()).replace(/^\"/,"")).replace(/\"$/,"");for(var s=new Array,o=0,a="",l=0;l<i.length;++l){for(var c=i[l],u=0;u<c.length;++u){"["==c.charAt(u)&&++o;"]"==c.charAt(u)&&--o}a+=c;if(0===o){s.push(a);a=""}else a+=","}switch(r){case"LOCAL_CS":this.projName="identity";this.localCS=!0;this.srsCode=n;break;case"GEOGCS":this.projName="longlat";this.geocsCode=n;this.srsCode||(this.srsCode=n);break;case"PROJCS":this.srsCode=n;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[n];break;case"DATUM":this.datumName=n;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=n;this.a=parseFloat(s.shift());this.rf=parseFloat(s.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(s.shift());break;case"UNIT":this.units=n;this.unitsPerMeter=parseFloat(s.shift());break;case"PARAMETER":var h=n.toLowerCase(),p=parseFloat(s.shift());switch(h){case"false_easting":this.x0=p;break;case"false_northing":this.y0=p;break;case"scale_factor":this.k0=p;break;case"central_meridian":this.long0=p*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=p*Proj4js.common.D2R}break;case"TOWGS84":this.datum_params=s;break;case"AXIS":h=n.toLowerCase();switch(p=s.shift()){case"EAST":p="e";break;case"WEST":p="w";break;case"NORTH":p="n";break;case"SOUTH":p="s";break;case"UP":p="u";break;case"DOWN":p="d";break;case"OTHER":default:p=" "}this.axis||(this.axis="enu");switch(h){case"x":this.axis=p+this.axis.substr(1,2);break;case"y":this.axis=this.axis.substr(0,1)+p+this.axis.substr(2,1);break;case"z":this.axis=this.axis.substr(0,2)+p}}for(l=0;l<s.length;++l)this.parseWKT(s[l])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var n=this.defData.split("+"),r=0;r<n.length;r++){var i=n[r].split("=");e=i[0].toLowerCase();t=i[1];switch(e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t,10);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t);this.from_greenwich*=Proj4js.common.D2R;break;case"axis":3==(t=t.replace(/\s/gi,"")).length&&-1!="ewnsud".indexOf(t.substr(0,1))&&-1!="ewnsud".indexOf(t.substr(1,1))&&-1!="ewnsud".indexOf(t.substr(2,1))&&(this.axis=t)}}this.deriveConstants()}},deriveConstants:function(){"@null"==this.nagrids&&(this.datumCode="none");if(this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];if(e){this.datum_params=e.towgs84?e.towgs84.split(","):null;this.ellps=e.ellipse;this.datumName=e.datumName?e.datumName:this.datumCode}}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a);if(0===this.rf||Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=!0;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;this.k0||(this.k0=1);this.axis||(this.axis="enu");this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3875":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs["EPSG:3785"]=Proj4js.defs["EPSG:3875"];Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3875"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,n){var r=e*t;return n/Math.sqrt(1-r*r)},tsfnz:function(e,t,n){var r=e*n,i=.5*e;r=Math.pow((1-r)/(1+r),i);return Math.tan(.5*(this.HALF_PI-t))/r},phi2z:function(e,t){for(var n,r,i=.5*e,s=this.HALF_PI-2*Math.atan(t),o=0;o<=15;o++){n=e*Math.sin(s);s+=r=this.HALF_PI-2*Math.atan(t*Math.pow((1-n)/(1+n),i))-s;if(Math.abs(r)<=1e-10)return s}alert("phi2z has NoConvergence");return-9999},qsfnz:function(e,t){var n;return e>1e-7?(1-e*e)*(t/(1-(n=e*t)*n)-.5/e*Math.log((1-n)/(1+n))):2*t},asinz:function(e){Math.abs(e)>1&&(e=e>1?1:-1);return Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,n,r,i){return e*i-t*Math.sin(2*i)+n*Math.sin(4*i)-r*Math.sin(6*i)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return e<0?-1:1},adjust_lon:function(e){return e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI},adjust_lat:function(e){return e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI},latiso:function(e,t,n){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var r=e*n;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-r)/(1+r))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var n=this.fL(1,t),r=0,i=0;do{r=n;i=e*Math.sin(r);n=this.fL(Math.exp(e*Math.log((1+i)/(1-i))/2),t)}while(Math.abs(n-r)>1e-12);return n},sinh:function(e){var t=Math.exp(e);return t=(t-1/t)/2},cosh:function(e){var t=Math.exp(e);return t=(t+1/t)/2},tanh:function(e){var t=Math.exp(e);return t=(t-1/t)/(t+1/t)},asinh:function(e){return(e>=0?1:-1)*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,n){var r=t*n;return e/Math.sqrt(1-r*r)},pj_enfn:function(e){var t=new Array;t[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08)));t[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var n=e*e;t[2]=n*(this.C44-e*(this.C46+e*this.C48));n*=e;t[3]=n*(this.C66-e*this.C68);t[4]=n*e*this.C88;return t},pj_mlfn:function(e,t,n,r){n*=t;t*=t;return r[0]*e-n*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))},pj_inv_mlfn:function(e,t,n){for(var r=1/(1-t),i=e,s=Proj4js.common.MAX_ITER;s;--s){var o=Math.sin(i),a=1-t*o*o;i-=a=(this.pj_mlfn(i,o,Math.cos(i),n)-e)*(a*Math.sqrt(a))*r;if(Math.abs(a)<Proj4js.common.EPSLN)return i}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return i},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875};Proj4js.datum=Proj4js.Class({initialize:function(e){this.datum_type=Proj4js.common.PJD_WGS84;e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM);if(e&&e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);0==e.datum_params[0]&&0==e.datum_params[1]&&0==e.datum_params[2]||(this.datum_type=Proj4js.common.PJD_3PARAM);if(e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])){this.datum_type=Proj4js.common.PJD_7PARAM;e.datum_params[3]*=Proj4js.common.SEC_TO_RAD;e.datum_params[4]*=Proj4js.common.SEC_TO_RAD;e.datum_params[5]*=Proj4js.common.SEC_TO_RAD;e.datum_params[6]=e.datum_params[6]/1e6+1}}if(e){this.a=e.a;this.b=e.b;this.es=e.es;this.ep2=e.ep2;this.datum_params=e.datum_params}},compare_datums:function(e){if(this.datum_type!=e.datum_type)return!1;if(this.a!=e.a||Math.abs(this.es-e.es)>5e-11)return!1;if(this.datum_type==Proj4js.common.PJD_3PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2];if(this.datum_type==Proj4js.common.PJD_7PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6];if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT||e.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented.");return!1}return!0},geodetic_to_geocentric:function(e){var t,n,r,i,s,o,a,l=e.x,c=e.y,u=e.z?e.z:0;if(c<-Proj4js.common.HALF_PI&&c>-1.001*Proj4js.common.HALF_PI)c=-Proj4js.common.HALF_PI;else if(c>Proj4js.common.HALF_PI&&c<1.001*Proj4js.common.HALF_PI)c=Proj4js.common.HALF_PI;else if(c<-Proj4js.common.HALF_PI||c>Proj4js.common.HALF_PI){Proj4js.reportError("geocent:lat out of range:"+c);return null}l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI);s=Math.sin(c);a=Math.cos(c);o=s*s;t=((i=this.a/Math.sqrt(1-this.es*o))+u)*a*Math.cos(l);n=(i+u)*a*Math.sin(l);r=(i*(1-this.es)+u)*s;e.x=t;e.y=n;e.z=r;return 0},geocentric_to_geodetic:function(e){var t,n,r,i,s,o,a,l,c,u,h,p,d,f,y,m,g=e.x,C=e.y,v=e.z?e.z:0;!1;t=Math.sqrt(g*g+C*C);n=Math.sqrt(g*g+C*C+v*v);if(t/this.a<1e-12){!0;f=0;if(n/this.a<1e-12){y=Proj4js.common.HALF_PI;m=-this.b;return}}else f=Math.atan2(C,g);r=v/n;i=t/n;s=1/Math.sqrt(1-this.es*(2-this.es)*i*i);l=i*(1-this.es)*s;c=r*s;d=0;do{d++;m=t*l+v*c-(a=this.a/Math.sqrt(1-this.es*c*c))*(1-this.es*c*c);o=this.es*a/(a+m);p=(h=r*(s=1/Math.sqrt(1-o*(2-o)*i*i)))*l-(u=i*(1-o)*s)*c;l=u;c=h}while(p*p>1e-24&&d<30);y=Math.atan(h/Math.abs(u));e.x=f;e.y=y;e.z=m;return e},geocentric_to_geodetic_noniter:function(e){var t,n,r,i,s,o,a,l,c,u,h,p,d,f,y,m,g,C=e.x,v=e.y,T=e.z?e.z:0;C=parseFloat(C);v=parseFloat(v);T=parseFloat(T);g=!1;if(0!=C)t=Math.atan2(v,C);else if(v>0)t=Proj4js.common.HALF_PI;else if(v<0)t=-Proj4js.common.HALF_PI;else{g=!0;t=0;if(T>0)n=Proj4js.common.HALF_PI;else{if(!(T<0)){n=Proj4js.common.HALF_PI;r=-this.b;return}n=-Proj4js.common.HALF_PI}}s=C*C+v*v;i=Math.sqrt(s);o=T*Proj4js.common.AD_C;p=i/(l=Math.sqrt(o*o+s));h=(u=o/l)*u*u;a=T+this.b*this.ep2*h;m=i-this.a*this.es*p*p*p;d=a/(c=Math.sqrt(a*a+m*m));f=m/c;y=this.a/Math.sqrt(1-this.es*d*d);r=f>=Proj4js.common.COS_67P5?i/f-y:f<=-Proj4js.common.COS_67P5?i/-f-y:T/d+y*(this.es-1);0==g&&(n=Math.atan(d/f));e.x=t;e.y=n;e.z=r;return e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x+=this.datum_params[0];e.y+=this.datum_params[1];e.z+=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],i=this.datum_params[3],s=this.datum_params[4],o=this.datum_params[5],a=this.datum_params[6],l=a*(e.x-o*e.y+s*e.z)+t,c=a*(o*e.x+e.y-i*e.z)+n,u=a*(-s*e.x+i*e.y+e.z)+r;e.x=l;e.y=c;e.z=u}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x-=this.datum_params[0];e.y-=this.datum_params[1];e.z-=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],i=this.datum_params[3],s=this.datum_params[4],o=this.datum_params[5],a=this.datum_params[6],l=(e.x-t)/a,c=(e.y-n)/a,u=(e.z-r)/a;e.x=l+o*c-s*u;e.y=-o*l+c+i*u;e.z=s*l-i*c+u}}});Proj4js.Point=Proj4js.Class({initialize:function(e,t,n){if("object"==typeof e){this.x=e[0];this.y=e[1];this.z=e[2]||0}else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0]);this.y=parseFloat(r[1]);this.z=parseFloat(r[2])||0}else{this.x=e;this.y=t;this.z=n||0}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Mercator_1SP:"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"};Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("aeaInitEqualLatitudes");else{this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con;this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0}},forward:function(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n);this.cos_phi=Math.cos(n);var r=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,s=this.ns0*Proj4js.common.adjust_lon(t-this.long0),o=i*Math.sin(s)+this.x0,a=this.rh-i*Math.cos(s)+this.y0;e.x=o;e.y=a;return e},inverse:function(e){var t,n,r,i,s,o;e.x-=this.x0;e.y=this.rh-e.y+this.y0;if(this.ns0>=0){t=Math.sqrt(e.x*e.x+e.y*e.y);r=1}else{t=-Math.sqrt(e.x*e.x+e.y*e.y);r=-1}i=0;0!=t&&(i=Math.atan2(r*e.x,r*e.y));r=t*this.ns0/this.a;n=(this.c-r*r)/this.ns0;if(this.e3>=1e-10){r=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;o=Math.abs(Math.abs(r)-Math.abs(n))>1e-10?this.phi1z(this.e3,n):n>=0?.5*Proj4js.common.PI:-.5*Proj4js.common.PI}else o=this.phi1z(this.e3,n);s=Proj4js.common.adjust_lon(i/this.ns0+this.long0);e.x=s;e.y=o;return e},phi1z:function(e,t){var n,r,i,s,o,a=Proj4js.common.asinz(.5*t);if(e<Proj4js.common.EPSLN)return a;for(var l=e*e,c=1;c<=25;c++){n=Math.sin(a);r=Math.cos(a);a+=o=.5*(s=1-(i=e*n)*i)*s/r*(t/(1-l)-n/s+.5/e*Math.log((1-i)/(1+i)));if(Math.abs(o)<=1e-7)return a}Proj4js.reportError("aea:phi1z:Convergence error");return null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(this.rc){this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;this.title||(this.title="Oblique Stereographic Alternative")}else Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(e){var t,n,r,i;e.x=Proj4js.common.adjust_lon(e.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[e]);t=Math.sin(e.y);n=Math.cos(e.y);r=Math.cos(e.x);i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*r);e.x=i*n*Math.sin(e.x);e.y=i*(this.cosc0*t-this.sinc0*n*r);e.x=this.a*e.x+this.x0;e.y=this.a*e.y+this.y0;return e},inverse:function(e){var t,n,r,i,s;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(s=Math.sqrt(e.x*e.x+e.y*e.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o);n=Math.cos(o);i=Math.asin(n*this.sinc0+e.y*t*this.cosc0/s);r=Math.atan2(e.x*t,s*this.cosc0*n-e.y*this.sinc0*t)}else{i=this.phic0;r=0}e.x=r;e.y=i;Proj4js.Proj.gauss.inverse.apply(this,[e]);e.x=Proj4js.common.adjust_lon(e.x+this.long0);return e}};function phi4z(e,t,n,r,i,s,o,a,l){var c,u,h,p,d,f;l=s;for(f=1;f<=15;f++){c=Math.sin(l);a=Math.tan(l)*Math.sqrt(1-e*c*c);l+=d=(2*(h=t*l-n*(u=Math.sin(2*l))+r*Math.sin(4*l)-i*Math.sin(6*l))+a*(h*h+o)-2*s*(a*h+1))/(e*u*(h*h+o-2*s*h)/(2*a)+(2*(s-h)*(a*(p=t-2*n*Math.cos(2*l)+4*r*Math.cos(4*l)-6*i*Math.cos(6*l))-2/u)-2*p));if(Math.abs(d)<=1e-10)return l}Proj4js.reportError("phi4z: No convergence");return null}function e4fn(e){var t,n;t=1+e;n=1-e;return Math.sqrt(Math.pow(t,t)*Math.pow(n,n))}Proj4js.Proj.poly={init:function(){0==this.lat0&&(this.lat0=90);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,r,i,s,o,a,l=e.x,c=e.y;r=Proj4js.common.adjust_lon(l-this.long0);if(Math.abs(c)<=1e-7){o=this.x0+this.a*r;a=this.y0-this.a*this.ml0}else{t=Math.sin(c);n=Math.cos(c);i=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,c);s=Proj4js.common.msfnz(this.e,t,n);r=t;o=this.x0+this.a*s*Math.sin(r)/t;a=this.y0+this.a*(i-this.ml0+s*(1-Math.cos(r))/t)}e.x=o;e.y=a;return e},inverse:function(e){var t,n,r,i,s,o;e.x-=this.x0;e.y-=this.y0;t=this.ml0+e.y/this.a;i=0;if(Math.abs(t)<=1e-7){s=e.x/this.a+this.long0;o=0}else{n=t*t+e.x/this.a*(e.x/this.a);if(1!=(i=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,n,r,o)))return i;s=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*r/this.a)/Math.sin(o)+this.long0)}e.x=s;e.y=o;return e}};Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r*Math.cos(this.lat0),s=this.y0+this.a*n;this.t1=i;this.t2=Math.cos(this.lat0);e.x=i;e.y=s;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var n=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=n;e.y=t}};Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,n,r=e.x,i=e.y;if(i*Proj4js.common.R2D>90&&i*Proj4js.common.R2D<-90&&r*Proj4js.common.R2D>180&&r*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+r+" : "+i);return null}if(Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}if(this.sphere){t=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(r-this.long0);n=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*i))}else{var s=Math.sin(i),o=Proj4js.common.tsfnz(this.e,i,s);t=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(r-this.long0);n=this.y0-this.a*this.k0*Math.log(o)}e.x=t;e.y=n;return e},inverse:function(e){var t,n,r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)n=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-i/this.a*this.k0));else{var s=Math.exp(-i/(this.a*this.k0));if(-9999==(n=Proj4js.common.phi2z(this.e,s))){Proj4js.reportError("merc:inverse: lat = -9999");return null}}t=Proj4js.common.adjust_lon(this.long0+r/(this.a*this.k0));e.x=t;e.y=n;return e}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(0!=this.mode){Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes");this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1):this.ns=this.sinphi}else this.ns=this.sinphi;this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,n),i=this.a*(this.g-r),s=this.ns*Proj4js.common.adjust_lon(t-this.long0),o=this.x0+i*Math.sin(s),a=this.y0+this.rh-i*Math.cos(s);e.x=o;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y=this.rh-e.y+this.y0;var t,n;if(this.ns>=0){n=Math.sqrt(e.x*e.x+e.y*e.y);t=1}else{n=-Math.sqrt(e.x*e.x+e.y*e.y);t=-1}var r=0;0!=n&&(r=Math.atan2(t*e.x,t*e.y));var i=this.g-n/this.a,s=this.phi3z(i,this.e0,this.e1,this.e2,this.e3),o=Proj4js.common.adjust_lon(this.long0+r/this.ns);e.x=o;e.y=s;return e},phi3z:function(e,t,n,r,i){var s,o;s=e;for(var a=0;a<15;a++){s+=o=(e+n*Math.sin(2*s)-r*Math.sin(4*s)+i*Math.sin(6*s))/t-s;if(Math.abs(o)<=1e-10)return s}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,r,i=e.x,s=e.y,o=Proj4js.common.adjust_lon(i-this.long0),a=Math.sin(s),l=Math.cos(s);if(this.sphere){var c=l*Math.sin(o);if(Math.abs(Math.abs(c)-1)<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return 93}n=.5*this.a*this.k0*Math.log((1+c)/(1-c));t=Math.acos(l*Math.cos(o)/Math.sqrt(1-c*c));s<0&&(t=-t);r=this.a*this.k0*(t-this.lat0)}else{var u=l*o,h=Math.pow(u,2),p=this.ep2*Math.pow(l,2),d=Math.tan(s),f=Math.pow(d,2);t=1-this.es*Math.pow(a,2);var y=this.a/Math.sqrt(t),m=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,s);n=this.k0*y*u*(1+h/6*(1-f+p+h/20*(5-18*f+Math.pow(f,2)+72*p-58*this.ep2)))+this.x0;r=this.k0*(m-this.ml0+y*d*(h*(.5+h/24*(5-f+9*p+4*Math.pow(p,2)+h/30*(61-58*f+Math.pow(f,2)+600*p-330*this.ep2)))))+this.y0}e.x=n;e.y=r;return e},inverse:function(e){var t,n,r,i,s,o;if(this.sphere){var a=Math.exp(e.x/(this.a*this.k0)),l=.5*(a-1/a),c=this.lat0+e.y/(this.a*this.k0),u=Math.cos(c);t=Math.sqrt((1-u*u)/(1+l*l));s=Proj4js.common.asinz(t);c<0&&(s=-s);o=0==l&&0==u?this.long0:Proj4js.common.adjust_lon(Math.atan2(l,u)+this.long0)}else{var h=e.x-this.x0,p=e.y-this.y0;n=t=(this.ml0+p/this.k0)/this.a;for(i=0;;i++){n+=r=(t+this.e1*Math.sin(2*n)-this.e2*Math.sin(4*n)+this.e3*Math.sin(6*n))/this.e0-n;if(Math.abs(r)<=Proj4js.common.EPSLN)break;if(i>=6){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return 95}}if(Math.abs(n)<Proj4js.common.HALF_PI){var d=Math.sin(n),f=Math.cos(n),y=Math.tan(n),m=this.ep2*Math.pow(f,2),g=Math.pow(m,2),C=Math.pow(y,2),v=Math.pow(C,2);t=1-this.es*Math.pow(d,2);var T=this.a/Math.sqrt(t),L=T*(1-this.es)/t,S=h/(T*this.k0),b=Math.pow(S,2);s=n-T*y*b/L*(.5-b/24*(5+3*C+10*m-4*g-9*this.ep2-b/30*(61+90*C+298*m+45*v-252*this.ep2-3*g)));o=Proj4js.common.adjust_lon(this.long0+S*(1-b/6*(1+2*C+m-b/20*(5-2*m+28*C-3*g+8*this.ep2+24*v)))/f)}else{s=Proj4js.common.HALF_PI*Proj4js.common.sign(p);o=this.long0}}e.x=o;e.y=s;return e}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),n=Math.asin(t/this.rs),r=Math.sin(n);this.cp=Proj4js.common.latiso(0,n,r)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t);this.xs=this.x0;this.ys=this.y0-this.n2*n;this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,n=e.y,r=this.rs*(t-this.lc),i=this.cp+this.rs*Proj4js.common.latiso(this.e,n,Math.sin(n)),s=Math.asin(Math.sin(r)/Proj4js.common.cosh(i)),o=Proj4js.common.latiso(0,s,Math.sin(s));e.x=this.xs+this.n2*o;e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(i)/Math.cos(r));return e},inverse:function(e){var t=e.x,n=e.y,r=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((n-this.ys)/this.n2)),i=Math.asin(Math.sin((n-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),s=Proj4js.common.latiso(0,i,Math.sin(i));e.x=this.lc+r/this.rs;e.y=Proj4js.common.invlatiso(this.e,(s-this.cp)/this.rs);return e}};Proj4js.Proj.ortho={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,n,r,i,s,o=e.x,a=e.y;r=Proj4js.common.adjust_lon(o-this.long0);t=Math.sin(a);n=Math.cos(a);i=Math.cos(r);s=this.sin_p14*t+this.cos_p14*n*i;1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN)var l=1*this.a*n*Math.sin(r),c=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*i);else Proj4js.reportError("orthoFwdPointError");e.x=l;e.y=c;return e},inverse:function(e){var t,n,r,i,s,o,a;e.x-=this.x0;e.y-=this.y0;(t=Math.sqrt(e.x*e.x+e.y*e.y))>this.a+1e-7&&Proj4js.reportError("orthoInvDataError");n=Proj4js.common.asinz(t/this.a);r=Math.sin(n);i=Math.cos(n);o=this.long0;Math.abs(t)<=Proj4js.common.EPSLN&&(a=this.lat0);a=Proj4js.common.asinz(i*this.sin_p14+e.y*r*this.cos_p14/t);s=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(s)<=Proj4js.common.EPSLN&&(o=this.lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y)));s=i-this.sin_p14*Math.sin(a);e.x=o;e.y=a;return e}};Proj4js.Proj.krovak={init:function(){this.a=6377397.155;this.es=.006674372230614;this.e=Math.sqrt(this.es);this.lat0||(this.lat0=.863937979737193);this.long0||(this.long0=.4334234309119251);this.k0||(this.k0=.9999);this.s45=.785398163397448;this.s90=2*this.s45;this.fi0=this.lat0;this.e2=this.es;this.e=Math.sqrt(this.e2);this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2));this.uq=1.04216856380474;this.u0=Math.asin(Math.sin(this.fi0)/this.alfa);this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2);this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g;this.k1=this.k0;this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2));this.s0=1.37008346281555;this.n=Math.sin(this.s0);this.ro0=this.k1*this.n0/Math.tan(this.s0);this.ad=this.s90-this.uq},forward:function(e){var t,n,r,i,s,o,a,l=e.x,c=e.y,u=Proj4js.common.adjust_lon(l-this.long0);t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2);n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45);r=-u*this.alfa;i=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(r));s=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(i));o=this.n*s;a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n);e.y=a*Math.cos(o)/1;e.x=a*Math.sin(o)/1;if(this.czech){e.y*=-1;e.x*=-1}return e},inverse:function(e){var t,n,r,i,s,o,a,l=e.x;e.x=e.y;e.y=l;if(this.czech){e.y*=-1;e.x*=-1}s=Math.sqrt(e.x*e.x+e.y*e.y);i=Math.atan2(e.y,e.x)/Math.sin(this.s0);r=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45);t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i));n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t));e.x=this.long0-n/this.alfa;o=t;a=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45);Math.abs(o-e.y)<1e-10&&(a=1);o=e.y;c+=1}while(0==a&&c<15);if(c>=15){Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}return e}};Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,r=1/this.rf,i=2*r-Math.pow(r,2),s=this.e=Math.sqrt(i);this.R=this.k0*n*Math.sqrt(1-i)/(1-i*Math.pow(t,2));this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4));this.b0=Math.asin(t/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*s/2*Math.log((1+s*t)/(1-s*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+n)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),s=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));e.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0;e.x=this.R*o+this.x0;return e},inverse:function(e){for(var t=e.x-this.x0,n=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),o=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),a=this.lambda0+o/this.alpha,l=0,c=s,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20){Proj4js.reportError("omercFwdInfinity");return}l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2));u=c;c=2*Math.atan(Math.exp(l))-Math.PI/2}e.x=a;e.y=c;return e}};Proj4js.Proj.stere={ssfn_:function(e,t,n){t*=n;return Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*n)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:this.mode=e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;this.phits=Math.abs(this.phits);if(this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN)this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));else{e=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e);e*=this.e;this.akm1/=Math.sqrt(1-e*e)}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0);t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI;e*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e);this.sinX1=Math.sin(t);this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var n,r,i=e.y;if(this.sphere){var s,o,a,l;s=Math.sin(i);o=Math.cos(i);a=Math.cos(t);l=Math.sin(t);switch(this.mode){case this.EQUIT:(r=1+o*a)<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Equit");n=(r=this.akm1/r)*o*l;r*=s;break;case this.OBLIQ:(r=1+this.sinph0*s+this.cosph0*o*a)<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Obliq");n=(r=this.akm1/r)*o*l;r*=this.cosph0*s-this.sinph0*o*a;break;case this.N_POLE:a=-a;i=-i;case this.S_POLE:Math.abs(i-Proj4js.common.HALF_PI)<this.TOL&&Proj4js.reportError("stere:forward:S_POLE");n=l*(r=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*i));r*=a}}else{a=Math.cos(t);l=Math.sin(t);s=Math.sin(i);var c,u;if(this.mode==this.OBLIQ||this.mode==this.EQUIT){var h=2*Math.atan(this.ssfn_(i,s,this.e));c=Math.sin(h-Proj4js.common.HALF_PI);u=Math.cos(h)}switch(this.mode){case this.OBLIQ:r=(p=this.akm1/(this.cosX1*(1+this.sinX1*c+this.cosX1*u*a)))*(this.cosX1*c-this.sinX1*u*a);n=p*u;break;case this.EQUIT:var p;r=(p=2*this.akm1/(1+u*a))*c;n=p*u;break;case this.S_POLE:i=-i;a=-a;s=-s;case this.N_POLE:r=-(n=this.akm1*Proj4js.common.tsfnz(this.e,i,s))*a}n*=l}e.x=n*this.a+this.x0;e.y=r*this.a+this.y0;return e},inverse:function(e){var t,n,r,i,s,o,a=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,c=0,u=0,h=0,p=0;if(this.sphere){var d,f,y,m;f=Math.sqrt(a*a+l*l);d=2*Math.atan(f/this.akm1);y=Math.sin(d);m=Math.cos(d);t=0;switch(this.mode){case this.EQUIT:n=Math.abs(f)<=Proj4js.common.EPSLN?0:Math.asin(l*y/f);0==m&&0==a||(t=Math.atan2(a*y,m*f));break;case this.OBLIQ:n=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(m*this.sinph0+l*y*this.cosph0/f);0==(d=m-this.sinph0*Math.sin(n))&&0==a||(t=Math.atan2(a*y*this.cosph0,d*f));break;case this.N_POLE:l=-l;case this.S_POLE:n=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-m:m);t=0==a&&0==l?0:Math.atan2(a,l)}e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=n}else{s=Math.sqrt(a*a+l*l);switch(this.mode){case this.OBLIQ:case this.EQUIT:c=2*Math.atan2(s*this.cosX1,this.akm1);r=Math.cos(c);i=Math.sin(c);u=0==s?Math.asin(r*this.sinX1):Math.asin(r*this.sinX1+l*i*this.cosX1/s);c=Math.tan(.5*(Proj4js.common.HALF_PI+u));a*=i;l=s*this.cosX1*r-l*this.sinX1*i;p=Proj4js.common.HALF_PI;h=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:c=-s/this.akm1;u=Proj4js.common.HALF_PI-2*Math.atan(c);p=-Proj4js.common.HALF_PI;h=-.5*this.e}for(o=this.NITER;o--;u=n){i=this.e*Math.sin(u);n=2*Math.atan(c*Math.pow((1+i)/(1-i),h))-p;if(Math.abs(u-n)<this.CONV){this.mode==this.S_POLE&&(n=-n);t=0==a&&0==l?0:Math.atan2(a,l);e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=n;return e}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array;this.A[1]=.6399175073;this.A[2]=-.1358797613;this.A[3]=.063294409;this.A[4]=-.02526853;this.A[5]=.0117879;this.A[6]=-.0055161;this.A[7]=.0026906;this.A[8]=-.001333;this.A[9]=67e-5;this.A[10]=-34e-5;this.B_re=new Array;this.B_im=new Array;this.B_re[1]=.7557853228;this.B_im[1]=0;this.B_re[2]=.249204646;this.B_im[2]=.003371507;this.B_re[3]=-.001541739;this.B_im[3]=.04105856;this.B_re[4]=-.10162907;this.B_im[4]=.01727609;this.B_re[5]=-.26623489;this.B_im[5]=-.36249218;this.B_re[6]=-.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array;this.C_im=new Array;this.C_re[1]=1.3231270439;this.C_im[1]=0;this.C_re[2]=-.577245789;this.C_im[2]=-.007809598;this.C_re[3]=.508307513;this.C_im[3]=-.112208952;this.C_re[4]=-.15094762;this.C_im[4]=.18200602;this.C_re[5]=1.01418179;this.C_im[5]=1.64497696;this.C_re[6]=1.9660549;this.C_im[6]=2.5127645;this.D=new Array;this.D[1]=1.5627014243;this.D[2]=.5185406398;this.D[3]=-.03333098;this.D[4]=-.1052906;this.D[5]=-.0368594;this.D[6]=.007317;this.D[7]=.0122;this.D[8]=.00394;this.D[9]=-.0013},forward:function(e){for(var t=e.x,n=e.y-this.lat0,r=t-this.long0,i=n/Proj4js.common.SEC_TO_RAD*1e-5,s=r,o=1,a=0,l=1;l<=10;l++){o*=i;a+=this.A[l]*o}var c,u=a,h=s,p=1,d=0,f=0,y=0;for(l=1;l<=6;l++){c=d*u+p*h;p=p*u-d*h;d=c;f=f+this.B_re[l]*p-this.B_im[l]*d;y=y+this.B_im[l]*p+this.B_re[l]*d}e.x=y*this.a+this.x0;e.y=f*this.a+this.y0;return e},inverse:function(e){for(var t,n=e.x,r=e.y,i=n-this.x0,s=(r-this.y0)/this.a,o=i/this.a,a=1,l=0,c=0,u=0,h=1;h<=6;h++){t=l*s+a*o;a=a*s-l*o;l=t;c=c+this.C_re[h]*a-this.C_im[h]*l;u=u+this.C_im[h]*a+this.C_re[h]*l}for(var p=0;p<this.iterations;p++){var d,f=c,y=u,m=s,g=o;for(h=2;h<=6;h++){d=y*c+f*u;f=f*c-y*u;y=d;m+=(h-1)*(this.B_re[h]*f-this.B_im[h]*y);g+=(h-1)*(this.B_im[h]*f+this.B_re[h]*y)}f=1;y=0;var C=this.B_re[1],v=this.B_im[1];for(h=2;h<=6;h++){d=y*c+f*u;f=f*c-y*u;y=d;C+=h*(this.B_re[h]*f-this.B_im[h]*y);v+=h*(this.B_im[h]*f+this.B_re[h]*y)}var T=C*C+v*v;c=(m*C+g*v)/T;u=(g*C-m*v)/T}var L=c,S=u,b=1,w=0;for(h=1;h<=9;h++){b*=L;w+=this.D[h]*b}var E=this.lat0+w*Proj4js.common.SEC_TO_RAD*1e5,O=this.long0+S;e.x=O;e.y=E;return e}};Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r,s=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+n/2.5))*1.25;e.x=i;e.y=s;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);e.x=t;e.y=n;return e}};Proj4js.Proj.gnom={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1e3*this.a;this.rc=1},forward:function(e){var t,n,r,i,s,o,a,l=e.x,c=e.y;r=Proj4js.common.adjust_lon(l-this.long0);t=Math.sin(c);n=Math.cos(c);i=Math.cos(r);s=this.sin_p14*t+this.cos_p14*n*i;1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN){o=this.x0+1*this.a*n*Math.sin(r)/s;a=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*n*i)/s}else{Proj4js.reportError("orthoFwdPointError");o=this.x0+this.infinity_dist*n*Math.sin(r);a=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*i)}e.x=o;e.y=a;return e},inverse:function(e){var t,n,r,i,s,o;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(t=Math.sqrt(e.x*e.x+e.y*e.y)){i=Math.atan2(t,this.rc);n=Math.sin(i);r=Math.cos(i);o=Proj4js.common.asinz(r*this.sin_p14+e.y*n*this.cos_p14/t);s=Math.atan2(e.x*n,t*this.cos_p14*r-e.y*this.sin_p14*n);s=Proj4js.common.adjust_lon(this.long0+s)}else{o=this.phic0;s=0}e.x=s;e.y=o;return e}};Proj4js.Proj.sinu={init:function(){if(this.sphere){this.n=1;this.m=0;this.es=0;this.C_y=Math.sqrt((this.m+1)/this.n);this.C_x=this.C_y/(this.m+1)}else this.en=Proj4js.common.pj_enfn(this.es)},forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){if(this.m)for(var s=this.n*Math.sin(i),o=Proj4js.common.MAX_ITER;o;--o){var a=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));i-=a;if(Math.abs(a)<Proj4js.common.EPSLN)break}else i=1!=this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*r*(this.m+Math.cos(i));n=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);n=this.a*Proj4js.common.pj_mlfn(i,l,c,this.en);t=this.a*r*c/Math.sqrt(1-this.es*l*l)}e.x=t;e.y=n;return e},inverse:function(e){var t,n,r;e.x-=this.x0;e.y-=this.y0;t=e.y/this.a;if(this.sphere){e.y/=this.C_y;t=this.m?Math.asin((this.m*e.y+Math.sin(e.y))/this.n):1!=this.n?Math.asin(Math.sin(e.y)/this.n):e.y;r=e.x/(this.C_x*(this.m+Math.cos(e.y)))}else{t=Proj4js.common.pj_inv_mlfn(e.y/this.a,this.es,this.en);var i=Math.abs(t);if(i<Proj4js.common.HALF_PI){i=Math.sin(t);n=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t));r=Proj4js.common.adjust_lon(n)}else i-Proj4js.common.EPSLN<Proj4js.common.HALF_PI&&(r=this.long0)}e.x=r;e.y=t;return e}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,n,r=e.x,i=e.y,s=Proj4js.common.adjust_lon(r-this.long0);if(Math.abs(i)<=Proj4js.common.EPSLN){t=this.x0+this.R*s;n=this.y0}var o=Proj4js.common.asinz(2*Math.abs(i/Proj4js.common.PI));if(Math.abs(s)<=Proj4js.common.EPSLN||Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){t=this.x0;n=i>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*o):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*o)}var a=.5*Math.abs(Proj4js.common.PI/s-s/Proj4js.common.PI),l=a*a,c=Math.sin(o),u=Math.cos(o),h=u/(c+u-1),p=h*h,d=h*(2/c-1),f=d*d,y=Proj4js.common.PI*this.R*(a*(h-f)+Math.sqrt(l*(h-f)*(h-f)-(f+l)*(p-f)))/(f+l);s<0&&(y=-y);t=this.x0+y;y=Math.abs(y/(Proj4js.common.PI*this.R));n=i>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-y*y-2*a*y):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-y*y-2*a*y);e.x=t;e.y=n;return e},inverse:function(e){var t,n,r,i,s,o,a,l,c,u,h,p;e.x-=this.x0;e.y-=this.y0;h=Proj4js.common.PI*this.R;s=(r=e.x/h)*r+(i=e.y/h)*i;h=3*(i*i/(l=-2*(o=-Math.abs(i)*(1+s))+1+2*i*i+s*s)+(2*(a=o-2*i*i+r*r)*a*a/l/l/l-9*o*a/l/l)/27)/(c=(o-a*a/3/l)/l)/(u=2*Math.sqrt(-c/3));Math.abs(h)>1&&(h=h>=0?1:-1);p=Math.acos(h)/3;n=e.y>=0?(-u*Math.cos(p+Proj4js.common.PI/3)-a/3/l)*Proj4js.common.PI:-(-u*Math.cos(p+Proj4js.common.PI/3)-a/3/l)*Proj4js.common.PI;Math.abs(r)<Proj4js.common.EPSLN&&(t=this.long0);t=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(s-1+Math.sqrt(1+2*(r*r-i*i)+s*s))/2/r);e.x=t;e.y=n;return e}};Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);e.x=i;e.y=s;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts));e.x=t;e.y=n;return e}};Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0);this.lat_ts||(this.lat_ts=0);this.title||(this.title="Equidistant Cylindrical (Plate Carre)");this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=Proj4js.common.adjust_lat(n-this.lat0);e.x=this.x0+this.a*r*this.rc;e.y=this.y0+this.a*i;return e},inverse:function(e){var t=e.x,n=e.y;e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc));e.y=Proj4js.common.adjust_lat(this.lat0+(n-this.y0)/this.a);return e}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=Proj4js.common.pj_enfn(this.es);this.m0=Proj4js.common.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en)}},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){t=Math.asin(Math.cos(i)*Math.sin(r));n=Math.atan2(Math.tan(i),Math.cos(r))-this.phi0}else{this.n=Math.sin(i);this.c=Math.cos(i);n=Proj4js.common.pj_mlfn(i,this.n,this.c,this.en);this.n=1/Math.sqrt(1-this.es*this.n*this.n);this.tn=Math.tan(i);this.t=this.tn*this.tn;this.a1=r*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2));n-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)}e.x=this.a*t+this.x0;e.y=this.a*n+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,n,r=e.x/this.a,i=e.y/this.a;if(this.sphere){this.dd=i+this.lat0;t=Math.asin(Math.sin(this.dd)*Math.cos(r));n=Math.atan2(Math.tan(r),Math.cos(this.dd))}else{var s=Proj4js.common.pj_inv_mlfn(this.m0+i,this.es,this.en);this.tn=Math.tan(s);this.t=this.tn*this.tn;this.n=Math.sin(s);this.r=1/(1-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1-this.es)*this.n;this.dd=r/this.n;this.d2=this.dd*this.dd;t=s-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3);n=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(s)}e.x=Proj4js.common.adjust_lon(this.long0+n);e.y=t;return e}};Proj4js.Proj.gauss={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t;this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e);this.C=Math.sqrt(1+this.es*t*t/(1-this.es));this.phic0=Math.asin(e/this.C);this.ratexp=.5*this.C*this.e;this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*e,this.ratexp))},forward:function(e){var t=e.x,n=e.y;e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(n),this.ratexp))-Proj4js.common.HALF_PI;e.x=this.C*t;return e},inverse:function(e){for(var t=e.x/this.C,n=e.y,r=Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI)/this.K,1/this.C),i=Proj4js.common.MAX_ITER;i>0;--i){n=2*Math.atan(r*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(n-e.y)<1e-14)break;e.y=n}if(!i){Proj4js.reportError("gauss:inverse:convergence failed");return null}e.x=t;e.y=n;return e}};Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0);if(!this.lon1){this.lon1=0;this.mode=1}this.lon2||(this.lon2=0);this.lat2||(this.lat2=0);var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-t);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);this.d*this.d-1>0?this.lat0>=0?this.f=this.d+Math.sqrt(this.d*this.d-1):this.f=this.d-Math.sqrt(this.d*this.d-1):this.f=this.d;this.el=this.f*Math.pow(this.ts,this.bl)}if(0!=this.mode){this.g=.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if(this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.lat0>=0?this.u=this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):this.u=-this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else Proj4js.reportError("omerc:Init:DataError")}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI);this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI);this.dlon=this.lon1-this.lon2;this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1);this.con<=Proj4js.common.EPSLN||Math.abs(this.con-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError");this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.lat0>=0?this.u=this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):this.u=-this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}},forward:function(e){var t,n,r,i,s,o,a,l,c,u,h,p=e.x,d=e.y;t=Math.sin(d);u=Proj4js.common.adjust_lon(p-this.longc);o=Math.sin(this.bl*u);if(Math.abs(Math.abs(d)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){h=Proj4js.common.tsfnz(this.e,d,t);n=.5*((i=this.el/Math.pow(h,this.bl))+1/i);a=((c=.5*(i-1/i))*this.singam-o*this.cosgam)/n;r=Math.cos(this.bl*u);if(Math.abs(r)<1e-7)s=this.al*this.bl*u;else{s=this.al*Math.atan((c*this.cosgam+o*this.singam)/r)/this.bl;r<0&&(s+=Proj4js.common.PI*this.al/this.bl)}}else{a=d>=0?this.singam:-this.singam;s=this.al*d/this.bl}Math.abs(Math.abs(a)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity");l=.5*this.al*Math.log((1-a)/(1+a))/this.bl;s-=this.u;var f=this.x0+l*this.cosaz+s*this.sinaz,y=this.y0+s*this.cosaz-l*this.sinaz;e.x=f;e.y=y;return e},inverse:function(e){var t,n,r,i,s,o,a,l,c,u,h,p;e.x-=this.x0;e.y-=this.y0;0;i=e.x*this.cosaz-e.y*this.sinaz;s=e.y*this.cosaz+e.x*this.sinaz;s+=this.u;a=.5*((o=Math.exp(-this.bl*i/this.al))-1/o);n=.5*(o+1/o);u=((c=Math.sin(this.bl*s/this.al))*this.cosgam+a*this.singam)/n;if(Math.abs(Math.abs(u)-1)<=Proj4js.common.EPSLN){h=this.longc;p=u>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI}else{r=1/this.bl;l=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),r);p=Proj4js.common.phi2z(this.e,l);t=this.longc-Math.atan2(a*this.cosgam-c*this.singam,r)/this.bl;h=Proj4js.common.adjust_lon(t)}e.x=h;e.y=p;return e}};Proj4js.Proj.lcc={init:function(){this.lat2||(this.lat2=this.lat0);this.k0||(this.k0=1);if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("lcc:init: Equal Latitudes");else{var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),r=Proj4js.common.msfnz(this.e,t,n),i=Proj4js.common.tsfnz(this.e,this.lat1,t),s=Math.sin(this.lat2),o=Math.cos(this.lat2),a=Proj4js.common.msfnz(this.e,s,o),l=Proj4js.common.tsfnz(this.e,this.lat2,s),c=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?this.ns=Math.log(r/a)/Math.log(i/l):this.ns=t;this.f0=r/(this.ns*Math.pow(i,this.ns));this.rh=this.a*this.f0*Math.pow(c,this.ns);this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,n=e.y;if(!(n<=90&&n>=-90&&t<=180&&t>=-180)){Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+n);return null}var r,i,s=Math.abs(Math.abs(n)-Proj4js.common.HALF_PI);if(s>Proj4js.common.EPSLN){r=Proj4js.common.tsfnz(this.e,n,Math.sin(n));i=this.a*this.f0*Math.pow(r,this.ns)}else{if((s=n*this.ns)<=0){Proj4js.reportError("lcc:forward: No Projection");return null}i=0}var o=this.ns*Proj4js.common.adjust_lon(t-this.long0);e.x=this.k0*(i*Math.sin(o))+this.x0;e.y=this.k0*(this.rh-i*Math.cos(o))+this.y0;return e},inverse:function(e){var t,n,r,i,s,o=(e.x-this.x0)/this.k0,a=this.rh-(e.y-this.y0)/this.k0;if(this.ns>0){t=Math.sqrt(o*o+a*a);n=1}else{t=-Math.sqrt(o*o+a*a);n=-1}var l=0;0!=t&&(l=Math.atan2(n*o,n*a));if(0!=t||this.ns>0){n=1/this.ns;r=Math.pow(t/(this.a*this.f0),n);if(-9999==(i=Proj4js.common.phi2z(this.e,r)))return null}else i=-Proj4js.common.HALF_PI;s=Proj4js.common.adjust_lon(l/this.ns+this.long0);e.x=s;e.y=i;return e}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.mode=this.EQUIT:this.mode=this.OBLIQ;if(this.es>0){var t;this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp);t=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd}}else if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0)}},forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){var s;l=Math.sin(i);s=Math.cos(i);o=Math.cos(r);switch(this.mode){case this.OBLIQ:case this.EQUIT:if((n=this.mode==this.EQUIT?1+s*o:1+this.sinph0*l+this.cosph0*s*o)<=Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:y less than eps");return null}t=(n=Math.sqrt(2/n))*s*Math.sin(r);n*=this.mode==this.EQUIT?l:this.cosph0*l-this.sinph0*s*o;break;case this.N_POLE:o=-o;case this.S_POLE:if(Math.abs(i+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:phi < eps");return null}n=Proj4js.common.FORTPI-.5*i;t=(n=2*(this.mode==this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(r);n*=o}}else{var o,a,l,c,u=0,h=0,p=0;o=Math.cos(r);a=Math.sin(r);l=Math.sin(i);c=Proj4js.common.qsfnz(this.e,l);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){u=c/this.qp;h=Math.sqrt(1-u*u)}switch(this.mode){case this.OBLIQ:p=1+this.sinb1*u+this.cosb1*h*o;break;case this.EQUIT:p=1+h*o;break;case this.N_POLE:p=Proj4js.common.HALF_PI+i;c=this.qp-c;break;case this.S_POLE:p=i-Proj4js.common.HALF_PI;c=this.qp+c}if(Math.abs(p)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:b < eps");return null}switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p);n=this.mode==this.OBLIQ?this.ymf*p*(this.cosb1*u-this.sinb1*h*o):(p=Math.sqrt(2/(1+h*o)))*u*this.ymf;t=this.xmf*p*h*a;break;case this.N_POLE:case this.S_POLE:if(c>=0){t=(p=Math.sqrt(c))*a;n=o*(this.mode==this.S_POLE?p:-p)}else t=n=0}}e.x=this.a*t+this.x0;e.y=this.a*n+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,n,r=e.x/this.a,i=e.y/this.a;if(this.sphere){var s,o=0,a=0;if((n=.5*(s=Math.sqrt(r*r+i*i)))>1){Proj4js.reportError("laea:Inv:DataError");return null}n=2*Math.asin(n);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){a=Math.sin(n);o=Math.cos(n)}switch(this.mode){case this.EQUIT:n=Math.abs(s)<=Proj4js.common.EPSLN?0:Math.asin(i*a/s);r*=a;i=o*s;break;case this.OBLIQ:n=Math.abs(s)<=Proj4js.common.EPSLN?this.phi0:Math.asin(o*this.sinph0+i*a*this.cosph0/s);r*=a*this.cosph0;i=(o-Math.sin(n)*this.sinph0)*s;break;case this.N_POLE:i=-i;n=Proj4js.common.HALF_PI-n;break;case this.S_POLE:n-=Proj4js.common.HALF_PI}t=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(r,i):0}else{var l,c,u,h,p=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:r/=this.dd;i*=this.dd;if((h=Math.sqrt(r*r+i*i))<Proj4js.common.EPSLN){e.x=0;e.y=this.phi0;return e}c=2*Math.asin(.5*h/this.rq);l=Math.cos(c);r*=c=Math.sin(c);if(this.mode==this.OBLIQ){p=l*this.sinb1+i*c*this.cosb1/h;u=this.qp*p;i=h*this.cosb1*l-i*this.sinb1*c}else{p=i*c/h;u=this.qp*p;i=h*l}break;case this.N_POLE:i=-i;case this.S_POLE:if(!(u=r*r+i*i)){e.x=0;e.y=this.phi0;return e}p=1-u/this.qp;this.mode==this.S_POLE&&(p=-p)}t=Math.atan2(r,i);n=this.authlat(Math.asin(p),this.apa)}e.x=Proj4js.common.adjust_lon(this.long0+t);e.y=n;return e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,n=new Array;n[0]=e*this.P00;t=e*e;n[0]+=t*this.P01;n[1]=t*this.P10;t*=e;n[0]+=t*this.P02;n[1]+=t*this.P11;n[2]=t*this.P20;return n},authlat:function(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,n=e.x,r=(e.y,Math.sin(e.y)),i=Math.cos(e.y),s=Proj4js.common.adjust_lon(n-this.long0),o=Math.cos(s),a=this.sin_p12*r+this.cos_p12*i*o;if(Math.abs(Math.abs(a)-1)<Proj4js.common.EPSLN){t=1;if(a<0){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var l=Math.acos(a);t=l/Math.sin(l)}e.x=this.x0+this.a*t*i*Math.sin(s);e.y=this.y0+this.a*t*(this.cos_p12*r-this.sin_p12*i*o);return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(!(t>2*Proj4js.common.HALF_PI*this.a)){var n,r=t/this.a,i=Math.sin(r),s=Math.cos(r),o=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)n=this.lat0;else{n=Proj4js.common.asinz(s*this.sin_p12+e.y*i*this.cos_p12/t);var a=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(a)<=Proj4js.common.EPSLN)o=this.lat0>=0?Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x,-e.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-e.x,e.y));else{a=s-this.sin_p12*Math.sin(n);if(Math.abs(a)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN);else{Math.atan2(e.x*i*this.cos_p12,a*t);o=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*i*this.cos_p12,a*t))}}}e.x=o;e.y=n;return e}Proj4js.reportError("aeqdInvDataError")}};Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=n,s=Proj4js.common.PI*Math.sin(n),o=0;;o++){var a=-(i+Math.sin(i)-s)/(1+Math.cos(i));i+=a;if(Math.abs(a)<Proj4js.common.EPSLN)break;o>=50&&Proj4js.reportError("moll:Fwd:IterationError")}i/=2;Proj4js.common.PI/2-Math.abs(n)<Proj4js.common.EPSLN&&(r=0);var l=.900316316158*this.a*r*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;e.x=l;e.y=c;return e},inverse:function(e){e.x-=this.x0;var t=e.y/(1.4142135623731*this.a);Math.abs(t)>.999999999999&&(t=.999999999999);var n=Math.asin(t),r=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(n)));r<-Proj4js.common.PI&&(r=-Proj4js.common.PI);r>Proj4js.common.PI&&(r=Proj4js.common.PI);t=(2*n+Math.sin(2*n))/Proj4js.common.PI;Math.abs(t)>1&&(t=1);var i=Math.asin(t);e.x=r;e.y=i;return e}};Proj4js.defs["EPSG:25830"]="+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs";Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};!function(e,t){var n,r,i=typeof t,s=e.location,o=e.document,a=o.documentElement,l=e.jQuery,c=e.$,u={},h=[],p=h.concat,d=h.push,f=h.slice,y=h.indexOf,m=u.toString,g=u.hasOwnProperty,C="1.10.2".trim,v=function(e,t){return new v.fn.init(e,t,r)},T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,L=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,b=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,w=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^[\],:{}\s]*$/,O=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,x=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,P=/^-ms-/,_=/-([\da-z])/gi,N=function(e,t){return t.toUpperCase()},M=function(e){if(o.addEventListener||"load"===e.type||"complete"===o.readyState){I();v.ready()}},I=function(){if(o.addEventListener){o.removeEventListener("DOMContentLoaded",M,!1);e.removeEventListener("load",M,!1)}else{o.detachEvent("onreadystatechange",M);e.detachEvent("onload",M)}};v.fn=v.prototype={jquery:"1.10.2",constructor:v,init:function(e,n,r){var i,s;if(!e)return this;if("string"==typeof e){if(!(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:b.exec(e))||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){n=n instanceof v?n[0]:n;v.merge(this,v.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0));if(w.test(i[1])&&v.isPlainObject(n))for(i in n)v.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if((s=o.getElementById(i[2]))&&s.parentNode){if(s.id!==i[2])return r.find(e);this.length=1;this[0]=s}this.context=o;this.selector=e;return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(v.isFunction(e))return r.ready(e);if(e.selector!==t){this.selector=e.selector;this.context=e.context}return v.makeArray(e,this)},selector:"",length:0,toArray:function(){return f.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=v.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return v.each(this,e,t)},ready:function(e){v.ready.promise().done(e);return this},slice:function(){return this.pushStack(f.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice};v.fn.init.prototype=v.fn;v.extend=v.fn.extend=function(){var e,n,r,i,s,o,a=arguments[0]||{},l=1,c=arguments.length,u=!1;if("boolean"==typeof a){u=a;a=arguments[1]||{};l=2}"object"==typeof a||v.isFunction(a)||(a={});if(c===l){a=this;--l}for(;l<c;l++)if(null!=(s=arguments[l]))for(i in s){e=a[i];if(a!==(r=s[i]))if(u&&r&&(v.isPlainObject(r)||(n=v.isArray(r)))){if(n){n=!1;o=e&&v.isArray(e)?e:[]}else o=e&&v.isPlainObject(e)?e:{};a[i]=v.extend(u,o,r)}else r!==t&&(a[i]=r)}return a};v.extend({expando:"jQuery"+("1.10.2"+Math.random()).replace(/\D/g,""),noConflict:function(t){e.$===v&&(e.$=c);t&&e.jQuery===v&&(e.jQuery=l);return v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(!0===e?!--v.readyWait:!v.isReady){if(!o.body)return setTimeout(v.ready);v.isReady=!0;if(!(!0!==e&&--v.readyWait>0)){n.resolveWith(o,[v]);v.fn.trigger&&v(o).trigger("ready").off("ready")}}},isFunction:function(e){return"function"===v.type(e)},isArray:Array.isArray||function(e){return"array"===v.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?u[m.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==v.type(e)||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(v.support.ownLast)for(n in e)return g.call(e,n);for(n in e);return n===t||g.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;if("boolean"==typeof t){n=t;t=!1}t=t||o;var r=w.exec(e),i=!n&&[];if(r)return[t.createElement(r[1])];r=v.buildFragment([e],t,i);i&&v(i).remove();return v.merge([],r.childNodes)},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(null===t)return t;if("string"==typeof t&&(t=v.trim(t))&&E.test(t.replace(A,"@").replace(x,"]").replace(O,"")))return new Function("return "+t)();v.error("Invalid JSON: "+t)},parseXML:function(n){var r;if(!n||"string"!=typeof n)return null;try{if(e.DOMParser)r=(new DOMParser).parseFromString(n,"text/xml");else{(r=new ActiveXObject("Microsoft.XMLDOM")).async="false";r.loadXML(n)}}catch(e){r=t}r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||v.error("Invalid XML: "+n);return r},noop:function(){},globalEval:function(t){t&&v.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(P,"ms-").replace(_,N)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r=0,i=e.length,s=k(e);if(n){if(s)for(;r<i&&!1!==t.apply(e[r],n);r++);else for(r in e)if(!1===t.apply(e[r],n))break}else if(s)for(;r<i&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:C&&!C.call("\ufeff\xa0")?function(e){return null==e?"":C.call(e)}:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];null!=e&&(k(Object(e))?v.merge(n,"string"==typeof e?[e]:e):d.call(n,e));return n},inArray:function(e,t,n){var r;if(t){if(y)return y.call(t,e,n);r=t.length;n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof r)for(;s<r;s++)e[i++]=n[s];else for(;n[s]!==t;)e[i++]=n[s++];e.length=i;return e},grep:function(e,t,n){var r=[],i=0,s=e.length;n=!!n;for(;i<s;i++)n!==!!t(e[i],i)&&r.push(e[i]);return r},map:function(e,t,n){var r,i=0,s=e.length,o=[];if(k(e))for(;i<s;i++)null!=(r=t(e[i],i,n))&&(o[o.length]=r);else for(i in e)null!=(r=t(e[i],i,n))&&(o[o.length]=r);return p.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;if("string"==typeof n){s=e[n];n=e;e=s}if(!v.isFunction(e))return t;r=f.call(arguments,2);(i=function(){return e.apply(n||this,r.concat(f.call(arguments)))}).guid=e.guid=e.guid||v.guid++;return i},access:function(e,n,r,i,s,o,a){var l=0,c=e.length,u=null==r;if("object"===v.type(r)){s=!0;for(l in r)v.access(e,n,l,r[l],!0,o,a)}else if(i!==t){s=!0;v.isFunction(i)||(a=!0);if(u)if(a){n.call(e,i);n=null}else{u=n;n=function(e,t,n){return u.call(v(e),n)}}if(n)for(;l<c;l++)n(e[l],r,a?i:i.call(e[l],l,n(e[l],r)))}return s?e:u?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,s,o={};for(s in t){o[s]=e.style[s];e.style[s]=t[s]}i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}});v.ready.promise=function(t){if(!n){n=v.Deferred();if("complete"===o.readyState)setTimeout(v.ready);else if(o.addEventListener){o.addEventListener("DOMContentLoaded",M,!1);e.addEventListener("load",M,!1)}else{o.attachEvent("onreadystatechange",M);e.attachEvent("onload",M);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(e){}r&&r.doScroll&&function e(){if(!v.isReady){try{r.doScroll("left")}catch(t){return setTimeout(e,50)}I();v.ready()}}()}}return n.promise(t)};v.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});function k(e){var t=e.length,n=v.type(e);return!v.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}r=v(o);!function(e,t){var n,r,i,s,o,a,l,c,u,h,p,d,f,y,m,g,C,T="sizzle"+-new Date,L=e.document,S=0,b=0,w=se(),E=se(),O=se(),A=!1,x=function(e,t){if(e===t){A=!0;return 0}return 0},P=1<<31,_={}.hasOwnProperty,N=[],M=N.pop,I=N.push,k=N.push,R=N.slice,D=N.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",U=j.replace("w","w#"),G="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+U+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+G.replace(3,8)+")*)|.*)\\)|)",H=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),W=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),V=new RegExp(B+"*[+~]"),$=new RegExp("="+B+"*([^\\]'\"]*)"+B+"*\\]","g"),Y=new RegExp(q),X=new RegExp("^"+U+"$"),K={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+G),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,ee=/^h\d$/i,te=/'|\\/g,ne=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),re=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{k.apply(N=R.call(L.childNodes),L.childNodes);N[L.childNodes.length].nodeType}catch(e){k={apply:N.length?function(e,t){I.apply(e,R.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function ie(e,t,n,i){var o,a,c,u,d,m,g,v,S,b;(t?t.ownerDocument||t:L)!==p&&h(t);t=t||p;n=n||[];if(!e||"string"!=typeof e)return n;if(1!==(u=t.nodeType)&&9!==u)return[];if(f&&!i){if(o=Q.exec(e))if(c=o[1]){if(9===u){if(!(a=t.getElementById(c))||!a.parentNode)return n;if(a.id===c){n.push(a);return n}}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(c))&&C(t,a)&&a.id===c){n.push(a);return n}}else{if(o[2]){k.apply(n,t.getElementsByTagName(e));return n}if((c=o[3])&&r.getElementsByClassName&&t.getElementsByClassName){k.apply(n,t.getElementsByClassName(c));return n}}if(r.qsa&&(!y||!y.test(e))){v=g=T;S=t;b=9===u&&e;if(1===u&&"object"!==t.nodeName.toLowerCase()){m=fe(e);(g=t.getAttribute("id"))?v=g.replace(te,"\\$&"):t.setAttribute("id",v);v="[id='"+v+"'] ";d=m.length;for(;d--;)m[d]=v+ye(m[d]);S=V.test(e)&&t.parentNode||t;b=m.join(",")}if(b)try{k.apply(n,S.querySelectorAll(b));return n}catch(e){}finally{g||t.removeAttribute("id")}}}return function(e,t,n,i){var o,a,c,u,h,p=fe(e);if(!i&&1===p.length){if((a=p[0]=p[0].slice(0)).length>2&&"ID"===(c=a[0]).type&&r.getById&&9===t.nodeType&&f&&s.relative[a[1].type]){if(!(t=(s.find.ID(c.matches[0].replace(ne,re),t)||[])[0]))return n;e=e.slice(a.shift().value.length)}o=K.needsContext.test(e)?0:a.length;for(;o--;){c=a[o];if(s.relative[u=c.type])break;if((h=s.find[u])&&(i=h(c.matches[0].replace(ne,re),V.test(a[0].type)&&t.parentNode||t))){a.splice(o,1);if(!(e=i.length&&ye(a))){k.apply(n,i);return n}break}}}l(e,p)(i,t,!f,n,V.test(e));return n}(e.replace(H,"$1"),t,n,i)}function se(){var e=[];return function t(n,r){e.push(n+=" ")>s.cacheLength&&delete t[e.shift()];return t[n]=r}}function oe(e){e[T]=!0;return e}function ae(e){var t=p.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function le(e,t){for(var n=e.split("|"),r=e.length;r--;)s.attrHandle[n[r]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||P)-(~e.sourceIndex||P);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pe(e){return oe(function(t){t=+t;return oe(function(n,r){for(var i,s=e([],n.length,t),o=s.length;o--;)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}a=ie.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName};r=ie.support={};h=ie.setDocument=function(e){var t=e?e.ownerDocument||e:L,n=t.defaultView;if(t===p||9!==t.nodeType||!t.documentElement)return p;p=t;d=t.documentElement;f=!a(t);n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){h()});r.attributes=ae(function(e){e.className="i";return!e.getAttribute("className")});r.getElementsByTagName=ae(function(e){e.appendChild(t.createComment(""));return!e.getElementsByTagName("*").length});r.getElementsByClassName=ae(function(e){e.innerHTML="<div class='a'></div><div class='a i'></div>";e.firstChild.className="i";return 2===e.getElementsByClassName("i").length});r.getById=ae(function(e){d.appendChild(e).id=T;return!t.getElementsByName||!t.getElementsByName(T).length});if(r.getById){s.find.ID=function(e,t){if(void 0!==t.getElementById&&f){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}};s.filter.ID=function(e){var t=e.replace(ne,re);return function(e){return e.getAttribute("id")===t}}}else{delete s.find.ID;s.filter.ID=function(e){var t=e.replace(ne,re);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}}s.find.TAG=r.getElementsByTagName?function(e,t){if(void 0!==t.getElementsByTagName)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[i++];)1===n.nodeType&&r.push(n);return r}return s};s.find.CLASS=r.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&f)return t.getElementsByClassName(e)};m=[];y=[];if(r.qsa=J.test(t.querySelectorAll)){ae(function(e){e.innerHTML="<select><option selected=''></option></select>";e.querySelectorAll("[selected]").length||y.push("\\["+B+"*(?:value|"+F+")");e.querySelectorAll(":checked").length||y.push(":checked")});ae(function(e){var n=t.createElement("input");n.setAttribute("type","hidden");e.appendChild(n).setAttribute("t","");e.querySelectorAll("[t^='']").length&&y.push("[*^$]="+B+"*(?:''|\"\")");e.querySelectorAll(":enabled").length||y.push(":enabled",":disabled");e.querySelectorAll("*,:x");y.push(",.*:")})}(r.matchesSelector=J.test(g=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ae(function(e){r.disconnectedMatch=g.call(e,"div");g.call(e,"[s!='']:x");m.push("!=",q)});y=y.length&&new RegExp(y.join("|"));m=m.length&&new RegExp(m.join("|"));C=J.test(d.contains)||d.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};x=d.compareDocumentPosition?function(e,n){if(e===n){A=!0;return 0}var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);return i?1&i||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||C(L,e)?-1:n===t||C(L,n)?1:u?D.call(u,e)-D.call(u,n):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,a=[e],l=[n];if(e===n){A=!0;return 0}if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:u?D.call(u,e)-D.call(u,n):0;if(s===o)return ce(e,n);r=e;for(;r=r.parentNode;)a.unshift(r);r=n;for(;r=r.parentNode;)l.unshift(r);for(;a[i]===l[i];)i++;return i?ce(a[i],l[i]):a[i]===L?-1:l[i]===L?1:0};return t};ie.matches=function(e,t){return ie(e,null,null,t)};ie.matchesSelector=function(e,t){(e.ownerDocument||e)!==p&&h(e);t=t.replace($,"='$1']");if(r.matchesSelector&&f&&(!m||!m.test(t))&&(!y||!y.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return ie(t,p,null,[e]).length>0};ie.contains=function(e,t){(e.ownerDocument||e)!==p&&h(e);return C(e,t)};ie.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var n=s.attrHandle[t.toLowerCase()],i=n&&_.call(s.attrHandle,t.toLowerCase())?n(e,t,!f):void 0;return void 0===i?r.attributes||!f?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null:i};ie.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};ie.uniqueSort=function(e){var t,n=[],i=0,s=0;A=!r.detectDuplicates;u=!r.sortStable&&e.slice(0);e.sort(x);if(A){for(;t=e[s++];)t===e[s]&&(i=n.push(s));for(;i--;)e.splice(n[i],1)}return e};o=ie.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n};(s=ie.selectors={cacheLength:50,createPseudo:oe,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(ne,re);e[3]=(e[4]||e[5]||"").replace(ne,re);"~="===e[2]&&(e[3]=" "+e[3]+" ");return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if("nth"===e[1].slice(0,3)){e[3]||ie.error(e[0]);e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3]));e[5]=+(e[7]+e[8]||"odd"===e[3])}else e[3]&&ie.error(e[0]);return e},PSEUDO:function(e){var t,n=!e[5]&&e[2];if(K.CHILD.test(e[0]))return null;if(e[3]&&void 0!==e[4])e[2]=e[4];else if(n&&Y.test(n)&&(t=fe(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)){e[0]=e[0].slice(0,t);e[2]=n.slice(0,t)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(ne,re).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&w(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ie.attr(r,e);if(null==i)return"!="===t;if(!t)return!0;i+="";return"="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-")}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var c,u,h,p,d,f,y=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=a&&t.nodeName.toLowerCase(),C=!l&&!a;if(m){if(s){for(;y;){h=t;for(;h=h[y];)if(a?h.nodeName.toLowerCase()===g:1===h.nodeType)return!1;f=y="only"===e&&!f&&"nextSibling"}return!0}f=[o?m.firstChild:m.lastChild];if(o&&C){d=(c=(u=m[T]||(m[T]={}))[e]||[])[0]===S&&c[1];p=c[0]===S&&c[2];h=d&&m.childNodes[d];for(;h=++d&&h&&h[y]||(p=d=0)||f.pop();)if(1===h.nodeType&&++p&&h===t){u[e]=[S,d,p];break}}else if(C&&(c=(t[T]||(t[T]={}))[e])&&c[0]===S)p=c[1];else for(;h=++d&&h&&h[y]||(p=d=0)||f.pop();)if((a?h.nodeName.toLowerCase()===g:1===h.nodeType)&&++p){C&&((h[T]||(h[T]={}))[e]=[S,p]);if(h===t)break}return(p-=i)===r||p%r==0&&p/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||ie.error("unsupported pseudo: "+e);if(r[T])return r(t);if(r.length>1){n=[e,e,"",t];return s.setFilters.hasOwnProperty(e.toLowerCase())?oe(function(e,n){for(var i,s=r(e,t),o=s.length;o--;)e[i=D.call(e,s[o])]=!(n[i]=s[o])}):function(e){return r(e,0,n)}}return r}},pseudos:{not:oe(function(e){var t=[],n=[],r=l(e.replace(H,"$1"));return r[T]?oe(function(e,t,n,i){for(var s,o=r(e,null,i,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))}):function(e,i,s){t[0]=e;r(t,null,s,n);return!n.pop()}}),has:oe(function(e){return function(t){return ie(e,t).length>0}}),contains:oe(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:oe(function(e){X.test(e||"")||ie.error("unsupported lang: "+e);e=e.replace(ne,re).toLowerCase();return function(t){var n;do{if(n=f?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return ee.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pe(function(){return[0]}),last:pe(function(e,t){return[t-1]}),eq:pe(function(e,t,n){return[n<0?n+t:n]}),even:pe(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:pe(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:pe(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:pe(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ue(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=he(n);function de(){}de.prototype=s.filters=s.pseudos;s.setFilters=new de;function fe(e,t){var n,r,i,o,a,l,c,u=E[e+" "];if(u)return t?0:u.slice(0);a=e;l=[];c=s.preFilter;for(;a;){if(!n||(r=W.exec(a))){r&&(a=a.slice(r[0].length)||a);l.push(i=[])}n=!1;if(r=z.exec(a)){n=r.shift();i.push({value:n,type:r[0].replace(H," ")});a=a.slice(n.length)}for(o in s.filter)if((r=K[o].exec(a))&&(!c[o]||(r=c[o](r)))){n=r.shift();i.push({value:n,type:o,matches:r});a=a.slice(n.length)}if(!n)break}return t?a.length:a?ie.error(e):E(e,l).slice(0)}function ye(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function me(e,t,n){var r=t.dir,s=n&&"parentNode"===r,o=b++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||s)return e(t,n,i)}:function(t,n,a){var l,c,u,h=S+" "+o;if(a){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if((c=(u=t[T]||(t[T]={}))[r])&&c[0]===h){if(!0===(l=c[1])||l===i)return!0===l}else{(c=u[r]=[h])[1]=e(t,n,a)||i;if(!0===c[1])return!0}}}function ge(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Ce(e,t,n,r,i){for(var s,o=[],a=0,l=e.length,c=null!=t;a<l;a++)if((s=e[a])&&(!n||n(s,r,i))){o.push(s);c&&t.push(a)}return o}function ve(e,t,n,r,i,s){r&&!r[T]&&(r=ve(r));i&&!i[T]&&(i=ve(i,s));return oe(function(s,o,a,l){var c,u,h,p=[],d=[],f=o.length,y=s||function(e,t,n){for(var r=0,i=t.length;r<i;r++)ie(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?y:Ce(y,p,e,a,l),g=n?i||(s?e:f||r)?[]:o:m;n&&n(m,g,a,l);if(r){c=Ce(g,d);r(c,[],a,l);u=c.length;for(;u--;)(h=c[u])&&(g[d[u]]=!(m[d[u]]=h))}if(s){if(i||e){if(i){c=[];u=g.length;for(;u--;)(h=g[u])&&c.push(m[u]=h);i(null,g=[],c,l)}u=g.length;for(;u--;)(h=g[u])&&(c=i?D.call(s,h):p[u])>-1&&(s[c]=!(o[c]=h))}}else{g=Ce(g===o?g.splice(f,g.length):g);i?i(null,o,g,l):k.apply(o,g)}})}function Te(e){for(var t,n,r,i=e.length,o=s.relative[e[0].type],a=o||s.relative[" "],l=o?1:0,u=me(function(e){return e===t},a,!0),h=me(function(e){return D.call(t,e)>-1},a,!0),p=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?u(e,n,r):h(e,n,r))}];l<i;l++)if(n=s.relative[e[l].type])p=[me(ge(p),n)];else{if((n=s.filter[e[l].type].apply(null,e[l].matches))[T]){r=++l;for(;r<i&&!s.relative[e[r].type];r++);return ve(l>1&&ge(p),l>1&&ye(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(H,"$1"),n,l<r&&Te(e.slice(l,r)),r<i&&Te(e=e.slice(r)),r<i&&ye(e))}p.push(n)}return ge(p)}l=ie.compile=function(e,t){var n,r=[],o=[],a=O[e+" "];if(!a){t||(t=fe(e));n=t.length;for(;n--;)(a=Te(t[n]))[T]?r.push(a):o.push(a);a=O(e,function(e,t){var n=0,r=t.length>0,o=e.length>0,a=function(a,l,u,h,d){var f,y,m,g=[],C=0,v="0",T=a&&[],L=null!=d,b=c,w=a||o&&s.find.TAG("*",d&&l.parentNode||l),E=S+=null==b?1:Math.random()||.1;if(L){c=l!==p&&l;i=n}for(;null!=(f=w[v]);v++){if(o&&f){y=0;for(;m=e[y++];)if(m(f,l,u)){h.push(f);break}if(L){S=E;i=++n}}if(r){(f=!m&&f)&&C--;a&&T.push(f)}}C+=v;if(r&&v!==C){y=0;for(;m=t[y++];)m(T,g,l,u);if(a){if(C>0)for(;v--;)T[v]||g[v]||(g[v]=M.call(h));g=Ce(g)}k.apply(h,g);L&&!a&&g.length>0&&C+t.length>1&&ie.uniqueSort(h)}if(L){S=E;c=b}return T};return r?oe(a):a}(o,r))}return a};r.sortStable=T.split("").sort(x).join("")===T;r.detectDuplicates=A;h();r.sortDetached=ae(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))});ae(function(e){e.innerHTML="<a href='#'></a>";return"#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)});r.attributes&&ae(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return""===e.firstChild.getAttribute("value")})||le("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue});ae(function(e){return null==e.getAttribute("disabled")})||le(F,function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.specified?r.value:!0===e[t]?t.toLowerCase():null});v.find=ie;v.expr=ie.selectors;v.expr[":"]=v.expr.pseudos;v.unique=ie.uniqueSort;v.text=ie.getText;v.isXMLDoc=ie.isXML;v.contains=ie.contains}(e);var R={};v.Callbacks=function(e){var n,r,i,s,o,a,l=[],c=!(e="string"==typeof e?R[e]||function(e){var t=R[e]={};v.each(e.match(L)||[],function(e,n){t[n]=!0});return t}(e):v.extend({},e)).once&&[],u=function(t){r=e.memory&&t;i=!0;o=a||0;a=0;s=l.length;n=!0;for(;l&&o<s;o++)if(!1===l[o].apply(t[0],t[1])&&e.stopOnFalse){r=!1;break}n=!1;l&&(c?c.length&&u(c.shift()):r?l=[]:h.disable())},h={add:function(){if(l){var t=l.length;!function t(n){v.each(n,function(n,r){var i=v.type(r);"function"===i?e.unique&&h.has(r)||l.push(r):r&&r.length&&"string"!==i&&t(r)})}(arguments);if(n)s=l.length;else if(r){a=t;u(r)}}return this},remove:function(){l&&v.each(arguments,function(e,t){for(var r;(r=v.inArray(t,l,r))>-1;){l.splice(r,1);if(n){r<=s&&s--;r<=o&&o--}}});return this},has:function(e){return e?v.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){l=[];s=0;return this},disable:function(){l=c=r=t;return this},disabled:function(){return!l},lock:function(){c=t;r||h.disable();return this},locked:function(){return!c},fireWith:function(e,t){if(l&&(!i||c)){t=[e,(t=t||[]).slice?t.slice():t];n?c.push(t):u(t)}return this},fire:function(){h.fireWith(this,arguments);return this},fired:function(){return!!i}};return h};v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){i.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,s){var o=s[0],a=v.isFunction(e[t])&&e[t];i[s[1]](function(){var e=a&&a.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,a?[e]:arguments)})});e=null}).promise()},promise:function(e){return null!=e?v.extend(e,r):r}},i={};r.pipe=r.then;v.each(t,function(e,s){var o=s[2],a=s[3];r[s[1]]=o.add;a&&o.add(function(){n=a},t[1^e][2].disable,t[2][2].lock);i[s[0]]=function(){i[s[0]+"With"](this===i?r:this,arguments);return this};i[s[0]+"With"]=o.fireWith});r.promise(i);e&&e.call(i,i);return i},when:function(e){var t,n,r,i=0,s=f.call(arguments),o=s.length,a=1!==o||e&&v.isFunction(e.promise)?o:0,l=1===a?e:v.Deferred(),c=function(e,n,r){return function(i){n[e]=this;r[e]=arguments.length>1?f.call(arguments):i;r===t?l.notifyWith(n,r):--a||l.resolveWith(n,r)}};if(o>1){t=new Array(o);n=new Array(o);r=new Array(o);for(;i<o;i++)s[i]&&v.isFunction(s[i].promise)?s[i].promise().done(c(i,r,s)).fail(l.reject).progress(c(i,n,t)):--a}a||l.resolveWith(r,s);return l.promise()}});v.support=function(t){var n,r,s,a,l,c,u,h,p,d=o.createElement("div");d.setAttribute("className","t");d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";n=d.getElementsByTagName("*")||[];if(!(r=d.getElementsByTagName("a")[0])||!r.style||!n.length)return t;c=(a=o.createElement("select")).appendChild(o.createElement("option"));s=d.getElementsByTagName("input")[0];r.style.cssText="top:1px;float:left;opacity:.5";t.getSetAttribute="t"!==d.className;t.leadingWhitespace=3===d.firstChild.nodeType;t.tbody=!d.getElementsByTagName("tbody").length;t.htmlSerialize=!!d.getElementsByTagName("link").length;t.style=/top/.test(r.getAttribute("style"));t.hrefNormalized="/a"===r.getAttribute("href");t.opacity=/^0.5/.test(r.style.opacity);t.cssFloat=!!r.style.cssFloat;t.checkOn=!!s.value;t.optSelected=c.selected;t.enctype=!!o.createElement("form").enctype;t.html5Clone="<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML;t.inlineBlockNeedsLayout=!1;t.shrinkWrapBlocks=!1;t.pixelPosition=!1;t.deleteExpando=!0;t.noCloneEvent=!0;t.reliableMarginRight=!0;t.boxSizingReliable=!0;s.checked=!0;t.noCloneChecked=s.cloneNode(!0).checked;a.disabled=!0;t.optDisabled=!c.disabled;try{delete d.test}catch(e){t.deleteExpando=!1}(s=o.createElement("input")).setAttribute("value","");t.input=""===s.getAttribute("value");s.value="t";s.setAttribute("type","radio");t.radioValue="t"===s.value;s.setAttribute("checked","t");s.setAttribute("name","t");(l=o.createDocumentFragment()).appendChild(s);t.appendChecked=s.checked;t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked;if(d.attachEvent){d.attachEvent("onclick",function(){t.noCloneEvent=!1});d.cloneNode(!0).click()}for(p in{submit:!0,change:!0,focusin:!0}){d.setAttribute(u="on"+p,"t");t[p+"Bubbles"]=u in e||!1===d.attributes[u].expando}d.style.backgroundClip="content-box";d.cloneNode(!0).style.backgroundClip="";t.clearCloneStyle="content-box"===d.style.backgroundClip;for(p in v(t))break;t.ownLast="0"!==p;v(function(){var n,r,s,a="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",l=o.getElementsByTagName("body")[0];if(l){(n=o.createElement("div")).style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";l.appendChild(n).appendChild(d);d.innerHTML="<table><tr><td></td><td>t</td></tr></table>";(s=d.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none";h=0===s[0].offsetHeight;s[0].style.display="";s[1].style.display="none";t.reliableHiddenOffsets=h&&0===s[0].offsetHeight;d.innerHTML="";d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";v.swap(l,null!=l.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===d.offsetWidth});if(e.getComputedStyle){t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top;t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width;(r=d.appendChild(o.createElement("div"))).style.cssText=d.style.cssText=a;r.style.marginRight=r.style.width="0";d.style.width="1px";t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)}if(typeof d.style.zoom!==i){d.innerHTML="";d.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1";t.inlineBlockNeedsLayout=3===d.offsetWidth;d.style.display="block";d.innerHTML="<div></div>";d.firstChild.style.width="5px";t.shrinkWrapBlocks=3!==d.offsetWidth;t.inlineBlockNeedsLayout&&(l.style.zoom=1)}l.removeChild(n);n=d=s=r=null}});n=a=l=c=r=s=null;return t}({});var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;function B(e,n,r,i){if(v.acceptData(e)){var s,o,a=v.expando,l=e.nodeType,c=l?v.cache:e,u=l?e[a]:e[a]&&a;if(u&&c[u]&&(i||c[u].data)||r!==t||"string"!=typeof n){u||(u=l?e[a]=h.pop()||v.guid++:a);c[u]||(c[u]=l?{}:{toJSON:v.noop});"object"!=typeof n&&"function"!=typeof n||(i?c[u]=v.extend(c[u],n):c[u].data=v.extend(c[u].data,n));o=c[u];if(!i){o.data||(o.data={});o=o.data}r!==t&&(o[v.camelCase(n)]=r);"string"==typeof n?null==(s=o[n])&&(s=o[v.camelCase(n)]):s=o;return s}}}function j(e,t,n){if(v.acceptData(e)){var r,i,s=e.nodeType,o=s?v.cache:e,a=s?e[v.expando]:v.expando;if(o[a]){if(t&&(r=n?o[a]:o[a].data)){i=(t=v.isArray(t)?t.concat(v.map(t,v.camelCase)):t in r?[t]:(t=v.camelCase(t))in r?[t]:t.split(" ")).length;for(;i--;)delete r[t[i]];if(n?!G(r):!v.isEmptyObject(r))return}if(!n){delete o[a].data;if(!G(o[a]))return}s?v.cleanData([e],!0):v.support.deleteExpando||o!=o.window?delete o[a]:o[a]=null}}}v.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return!!(e=e.nodeType?v.cache[e[v.expando]]:e[v.expando])&&!G(e)},data:function(e,t,n){return B(e,t,n)},removeData:function(e,t){return j(e,t)},_data:function(e,t,n){return B(e,t,n,!0)},_removeData:function(e,t){return j(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}});v.fn.extend({data:function(e,n){var r,i,s=null,o=0,a=this[0];if(e===t){if(this.length){s=v.data(a);if(1===a.nodeType&&!v._data(a,"parsedAttrs")){r=a.attributes;for(;o<r.length;o++)0===(i=r[o].name).indexOf("data-")&&U(a,i=v.camelCase(i.slice(5)),s[i]);v._data(a,"parsedAttrs",!0)}}return s}return"object"==typeof e?this.each(function(){v.data(this,e)}):arguments.length>1?this.each(function(){v.data(this,e,n)}):a?U(a,e,v.data(a,e)):null},removeData:function(e){return this.each(function(){v.removeData(this,e)})}});function U(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(F,"-$1").toLowerCase();if("string"==typeof(r=e.getAttribute(i))){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r)}catch(e){}v.data(e,n,r)}else r=t}return r}function G(e){var t;for(t in e)if(("data"!==t||!v.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}v.extend({queue:function(e,t,n){var r;if(e){t=(t||"fx")+"queue";r=v._data(e,t);n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n));return r||[]}},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t);if("inprogress"===i){i=n.shift();r--}if(i){"fx"===t&&n.unshift("inprogress");delete s.stop;i.call(e,function(){v.dequeue(e,t)},s)}!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v._removeData(e,t+"queue");v._removeData(e,n)})})}});v.fn.extend({queue:function(e,n){var r=2;if("string"!=typeof e){n=e;e="fx";r--}return arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e);"fx"===e&&"inprogress"!==t[0]&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){e=v.fx&&v.fx.speeds[e]||e;t=t||"fx";return this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,a=this.length,l=function(){--i||s.resolveWith(o,[o])};if("string"!=typeof e){n=e;e=t}e=e||"fx";for(;a--;)if((r=v._data(o[a],e+"queueHooks"))&&r.empty){i++;r.empty.add(l)}l();return s.promise(n)}});var q,H,W=/[\t\r\n\f]/g,z=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,$=/^(?:a|area)$/i,Y=/^(?:checked|selected)$/i,X=v.support.getSetAttribute,K=v.support.input;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){e=v.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(e){}})},addClass:function(e){var t,n,r,i,s,o=0,a=this.length,l="string"==typeof e&&e;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(l){t=(e||"").match(L)||[];for(;o<a;o++)if(r=1===(n=this[o]).nodeType&&(n.className?(" "+n.className+" ").replace(W," "):" ")){s=0;for(;i=t[s++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=v.trim(r)}}return this},removeClass:function(e){var t,n,r,i,s,o=0,a=this.length,l=0===arguments.length||"string"==typeof e&&e;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(l){t=(e||"").match(L)||[];for(;o<a;o++)if(r=1===(n=this[o]).nodeType&&(n.className?(" "+n.className+" ").replace(W," "):"")){s=0;for(;i=t[s++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?v.trim(r):""}}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var t,r=0,s=v(this),o=e.match(L)||[];t=o[r++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else if(n===i||"boolean"===n){this.className&&v._data(this,"__className__",this.className);this.className=this.className||!1===e?"":v._data(this,"__className__")||""}})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;n<r;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(W," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length)return s?(r=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()])&&"get"in r&&(n=r.get(s,"value"))!==t?n:"string"==typeof(n=s.value)?n.replace(z,""):null==n?"":n:void 0;i=v.isFunction(e);return this.each(function(n){var s;if(1===this.nodeType){null==(s=i?e.call(this,n,v(this).val()):e)?s="":"number"==typeof s?s+="":v.isArray(s)&&(s=v.map(s,function(e){return null==e?"":e+""}));(r=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&r.set(this,s,"value")!==t||(this.value=s)}})}});v.extend({valHooks:{option:{get:function(e){var t=v.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||i<0,o=s?null:[],a=s?i+1:r.length,l=i<0?a:s?i:0;l<a;l++)if(((n=r[l]).selected||l===i)&&(v.support.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}return o},set:function(e,t){for(var n,r,i=e.options,s=v.makeArray(t),o=i.length;o--;)((r=i[o]).selected=v.inArray(v(r).val(),s)>=0)&&(n=!0);n||(e.selectedIndex=-1);return s}}},attr:function(e,n,r){var s,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a){if(typeof e.getAttribute===i)return v.prop(e,n,r);if(1!==a||!v.isXMLDoc(e)){n=n.toLowerCase();s=v.attrHooks[n]||(v.expr.match.bool.test(n)?H:q)}if(r===t)return s&&"get"in s&&null!==(o=s.get(e,n))?o:null==(o=v.find.attr(e,n))?t:o;if(null!==r){if(s&&"set"in s&&(o=s.set(e,r,n))!==t)return o;e.setAttribute(n,r+"");return r}v.removeAttr(e,n)}},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(L);if(s&&1===e.nodeType)for(;n=s[i++];){r=v.propFix[n]||n;v.expr.match.bool.test(n)?K&&X||!Y.test(n)?e[r]=!1:e[v.camelCase("default-"+n)]=e[r]=!1:v.attr(e,n,"");e.removeAttribute(X?n:r)}},attrHooks:{type:{set:function(e,t){if(!v.support.radioValue&&"radio"===t&&v.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);n&&(e.value=n);return t}}}},propFix:{for:"htmlFor",class:"className"},prop:function(e,n,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o){if(1!==o||!v.isXMLDoc(e)){n=v.propFix[n]||n;s=v.propHooks[n]}return r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&null!==(i=s.get(e,n))?i:e[n]}},propHooks:{tabIndex:{get:function(e){var t=v.find.attr(e,"tabindex");return t?parseInt(t,10):V.test(e.nodeName)||$.test(e.nodeName)&&e.href?0:-1}}}});H={set:function(e,t,n){!1===t?v.removeAttr(e,n):K&&X||!Y.test(n)?e.setAttribute(!X&&v.propFix[n]||n,n):e[v.camelCase("default-"+n)]=e[n]=!0;return n}};v.each(v.expr.match.bool.source.match(/\w+/g),function(e,n){var r=v.expr.attrHandle[n]||v.find.attr;v.expr.attrHandle[n]=K&&X||!Y.test(n)?function(e,n,i){var s=v.expr.attrHandle[n],o=i?t:(v.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;v.expr.attrHandle[n]=s;return o}:function(e,n,r){return r?t:e[v.camelCase("default-"+n)]?n.toLowerCase():null}});K&&X||(v.attrHooks.value={set:function(e,t,n){if(!v.nodeName(e,"input"))return q&&q.set(e,t,n);e.defaultValue=t}});if(!X){q={set:function(e,n,r){var i=e.getAttributeNode(r);i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r));i.value=n+="";return"value"===r||n===e.getAttribute(r)?n:t}};v.expr.attrHandle.id=v.expr.attrHandle.name=v.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null};v.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:q.set};v.attrHooks.contenteditable={set:function(e,t,n){q.set(e,""!==t&&t,n)}};v.each(["width","height"],function(e,t){v.attrHooks[t]={set:function(e,n){if(""===n){e.setAttribute(t,"auto");return n}}}})}v.support.hrefNormalized||v.each(["href","src"],function(e,t){v.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}});v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}});v.support.optSelected||(v.propHooks.selected={get:function(e){var t=e.parentNode;if(t){t.selectedIndex;t.parentNode&&t.parentNode.selectedIndex}return null}});v.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){v.propFix[this.toLowerCase()]=this});v.support.enctype||(v.propFix.enctype="encoding");v.each(["radio","checkbox"],function(){v.valHooks[this]={set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}};v.support.checkOn||(v.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var J=/^(?:input|select|textarea)$/i,Q=/^key/,Z=/^(?:mouse|contextmenu)|click/,ee=/^(?:focusinfocus|focusoutblur)$/,te=/^([^.]*)(?:\.(.+)|)$/;function ne(){return!0}function re(){return!1}function ie(){try{return o.activeElement}catch(e){}}v.event={global:{},add:function(e,n,r,s,o){var a,l,c,u,h,p,d,f,y,m,g,C=v._data(e);if(C){if(r.handler){r=(u=r).handler;o=u.selector}r.guid||(r.guid=v.guid++);(l=C.events)||(l=C.events={});(p=C.handle)||((p=C.handle=function(e){return typeof v===i||e&&v.event.triggered===e.type?t:v.event.dispatch.apply(p.elem,arguments)}).elem=e);c=(n=(n||"").match(L)||[""]).length;for(;c--;){y=g=(a=te.exec(n[c])||[])[1];m=(a[2]||"").split(".").sort();if(y){h=v.event.special[y]||{};y=(o?h.delegateType:h.bindType)||y;h=v.event.special[y]||{};d=v.extend({type:y,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&v.expr.match.needsContext.test(o),namespace:m.join(".")},u);if(!(f=l[y])){(f=l[y]=[]).delegateCount=0;h.setup&&!1!==h.setup.call(e,s,m,p)||(e.addEventListener?e.addEventListener(y,p,!1):e.attachEvent&&e.attachEvent("on"+y,p))}if(h.add){h.add.call(e,d);d.handler.guid||(d.handler.guid=r.guid)}o?f.splice(f.delegateCount++,0,d):f.push(d);v.event.global[y]=!0}}e=null}},remove:function(e,t,n,r,i){var s,o,a,l,c,u,h,p,d,f,y,m=v.hasData(e)&&v._data(e);if(m&&(u=m.events)){c=(t=(t||"").match(L)||[""]).length;for(;c--;){d=y=(a=te.exec(t[c])||[])[1];f=(a[2]||"").split(".").sort();if(d){h=v.event.special[d]||{};p=u[d=(r?h.delegateType:h.bindType)||d]||[];a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)");l=s=p.length;for(;s--;){o=p[s];if((i||y===o.origType)&&(!n||n.guid===o.guid)&&(!a||a.test(o.namespace))&&(!r||r===o.selector||"**"===r&&o.selector)){p.splice(s,1);o.selector&&p.delegateCount--;h.remove&&h.remove.call(e,o)}}if(l&&!p.length){h.teardown&&!1!==h.teardown.call(e,f,m.handle)||v.removeEvent(e,d,m.handle);delete u[d]}}else for(d in u)v.event.remove(e,d+t[c],n,r,!0)}if(v.isEmptyObject(u)){delete m.handle;v._removeData(e,"events")}}},trigger:function(n,r,i,s){var a,l,c,u,h,p,d,f=[i||o],y=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];c=p=i=i||o;if(3!==i.nodeType&&8!==i.nodeType&&!ee.test(y+v.event.triggered)){if(y.indexOf(".")>=0){y=(m=y.split(".")).shift();m.sort()}l=y.indexOf(":")<0&&"on"+y;(n=n[v.expando]?n:new v.Event(y,"object"==typeof n&&n)).isTrigger=s?2:3;n.namespace=m.join(".");n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;n.result=t;n.target||(n.target=i);r=null==r?[n]:v.makeArray(r,[n]);h=v.event.special[y]||{};if(s||!h.trigger||!1!==h.trigger.apply(i,r)){if(!s&&!h.noBubble&&!v.isWindow(i)){u=h.delegateType||y;ee.test(u+y)||(c=c.parentNode);for(;c;c=c.parentNode){f.push(c);p=c}p===(i.ownerDocument||o)&&f.push(p.defaultView||p.parentWindow||e)}d=0;for(;(c=f[d++])&&!n.isPropagationStopped();){n.type=d>1?u:h.bindType||y;(a=(v._data(c,"events")||{})[n.type]&&v._data(c,"handle"))&&a.apply(c,r);(a=l&&c[l])&&v.acceptData(c)&&a.apply&&!1===a.apply(c,r)&&n.preventDefault()}n.type=y;if(!s&&!n.isDefaultPrevented()&&(!h._default||!1===h._default.apply(f.pop(),r))&&v.acceptData(i)&&l&&i[y]&&!v.isWindow(i)){(p=i[l])&&(i[l]=null);v.event.triggered=y;try{i[y]()}catch(e){}v.event.triggered=t;p&&(i[l]=p)}return n.result}}},dispatch:function(e){e=v.event.fix(e);var n,r,i,s,o,a,l=f.call(arguments),c=(v._data(this,"events")||{})[e.type]||[],u=v.event.special[e.type]||{};l[0]=e;e.delegateTarget=this;if(!u.preDispatch||!1!==u.preDispatch.call(this,e)){a=v.event.handlers.call(this,e,c);n=0;for(;(s=a[n++])&&!e.isPropagationStopped();){e.currentTarget=s.elem;o=0;for(;(i=s.handlers[o++])&&!e.isImmediatePropagationStopped();)if(!e.namespace_re||e.namespace_re.test(i.namespace)){e.handleObj=i;e.data=i.data;if((r=((v.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,l))!==t&&!1===(e.result=r)){e.preventDefault();e.stopPropagation()}}}u.postDispatch&&u.postDispatch.call(this,e);return e.result}},handlers:function(e,n){var r,i,s,o,a=[],l=n.delegateCount,c=e.target;if(l&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(!0!==c.disabled||"click"!==e.type)){s=[];for(o=0;o<l;o++){s[r=(i=n[o]).selector+" "]===t&&(s[r]=i.needsContext?v(r,this).index(c)>=0:v.find(r,this,null,[c]).length);s[r]&&s.push(i)}s.length&&a.push({elem:c,handlers:s})}l<n.length&&a.push({elem:this,handlers:n.slice(l)});return a},fix:function(e){if(e[v.expando])return e;var t,n,r,i=e.type,s=e,a=this.fixHooks[i];a||(this.fixHooks[i]=a=Z.test(i)?this.mouseHooks:Q.test(i)?this.keyHooks:{});r=a.props?this.props.concat(a.props):this.props;e=new v.Event(s);t=r.length;for(;t--;)e[n=r[t]]=s[n];e.target||(e.target=s.srcElement||o);3===e.target.nodeType&&(e.target=e.target.parentNode);e.metaKey=!!e.metaKey;return a.filter?a.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,s,a=n.button,l=n.fromElement;if(null==e.pageX&&null!=n.clientX){s=(i=e.target.ownerDocument||o).documentElement;r=i.body;e.pageX=n.clientX+(s&&s.scrollLeft||r&&r.scrollLeft||0)-(s&&s.clientLeft||r&&r.clientLeft||0);e.pageY=n.clientY+(s&&s.scrollTop||r&&r.scrollTop||0)-(s&&s.clientTop||r&&r.clientTop||0)}!e.relatedTarget&&l&&(e.relatedTarget=l===e.target?n.toElement:l);e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0);return e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ie()&&this.focus)try{this.focus();return!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===ie()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if(v.nodeName(this,"input")&&"checkbox"===this.type&&this.click){this.click();return!1}},_default:function(e){return v.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i);i.isDefaultPrevented()&&n.preventDefault()}};v.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;if(e.detachEvent){typeof e[r]===i&&(e[r]=null);e.detachEvent(r,n)}};v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?ne:re}else this.type=e;t&&v.extend(this,t);this.timeStamp=e&&e.timeStamp||v.now();this[v.expando]=!0};v.Event.prototype={isDefaultPrevented:re,isPropagationStopped:re,isImmediatePropagationStopped:re,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ne;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ne;if(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ne;this.stopPropagation()}};v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;if(!r||r!==this&&!v.contains(this,r)){e.type=i.origType;n=i.handler.apply(this,arguments);e.type=t}return n}}});v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;if(r&&!v._data(r,"submitBubbles")){v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0});v._data(r,"submitBubbles",!0)}})},postDispatch:function(e){if(e._submit_bubble){delete e._submit_bubble;this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0)}},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}});v.support.changeBubbles||(v.event.special.change={setup:function(){if(J.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type){v.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)});v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1);v.event.simulate("change",this,e,!0)})}return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(J.test(t.nodeName)&&!v._data(t,"changeBubbles")){v.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||v.event.simulate("change",this.parentNode,e,!0)});v._data(t,"changeBubbles",!0)}})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){v.event.remove(this,"._change");return!J.test(this.nodeName)}});v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){0==n++&&o.addEventListener(e,r,!0)},teardown:function(){0==--n&&o.removeEventListener(e,r,!0)}}});v.fn.extend({on:function(e,n,r,i,s){var o,a;if("object"==typeof e){if("string"!=typeof n){r=r||n;n=t}for(o in e)this.on(o,n,r,e[o],s);return this}if(null==r&&null==i){i=n;r=n=t}else if(null==i)if("string"==typeof n){i=r;r=t}else{i=r;r=n;n=t}if(!1===i)i=re;else if(!i)return this;if(1===s){a=i;(i=function(e){v().off(e);return a.apply(this,arguments)}).guid=a.guid||(a.guid=v.guid++)}return this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj){i=e.handleObj;v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);return this}if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}if(!1===n||"function"==typeof n){r=n;n=t}!1===r&&(r=re);return this.each(function(){v.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return v.event.trigger(e,t,n,!0)}});var se=/^.[^:#\[\.,]*$/,oe=/^(?:parents|prev(?:Until|All))/,ae=v.expr.match.needsContext,le={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(v(e).filter(function(){for(t=0;t<i;t++)if(v.contains(r[t],this))return!0}));for(t=0;t<i;t++)v.find(e,r[t],n);(n=this.pushStack(i>1?v.unique(n):n)).selector=this.selector?this.selector+" "+e:e;return n},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ue(this,e||[],!0))},filter:function(e){return this.pushStack(ue(this,e||[],!1))},is:function(e){return!!ue(this,"string"==typeof e&&ae.test(e)?v(e):e||[],!1).length},closest:function(e,t){for(var n,r=0,i=this.length,s=[],o=ae.test(e)||"string"!=typeof e?v(e,t||this.context):0;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&v.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?v.unique(s):s)},index:function(e){return e?"string"==typeof e?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(v.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function ce(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}v.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return ce(e,"nextSibling")},prev:function(e){return ce(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);"Until"!==e.slice(-5)&&(r=n);r&&"string"==typeof r&&(i=v.filter(r,i));if(this.length>1){le[e]||(i=v.unique(i));oe.test(e)&&(i=i.reverse())}return this.pushStack(i)}});v.extend({filter:function(e,t,n){var r=t[0];n&&(e=":not("+e+")");return 1===t.length&&1===r.nodeType?v.find.matchesSelector(r,e)?[r]:[]:v.find.matches(e,v.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){for(var i=[],s=e[n];s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!v(s).is(r));){1===s.nodeType&&i.push(s);s=s[n]}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ue(e,t,n){if(v.isFunction(t))return v.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return v.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(se.test(t))return v.filter(t,e,n);t=v.filter(t,e)}return v.grep(e,function(e){return v.inArray(e,t)>=0!==n})}function he(e){var t=pe.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}var pe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",de=/ jQuery\d+="(?:null|\d+)"/g,fe=new RegExp("<(?:"+pe+")[\\s/>]","i"),ye=/^\s+/,me=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ge=/<([\w:]+)/,Ce=/<tbody/i,ve=/<|&#?\w+;/,Te=/<(?:script|style|link)/i,Le=/^(?:checkbox|radio)$/i,Se=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/^$|\/(?:java|ecma)script/i,we=/^true\/(.*)/,Ee=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Oe={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:v.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Ae=he(o).appendChild(o.createElement("div"));Oe.optgroup=Oe.option;Oe.tbody=Oe.tfoot=Oe.colgroup=Oe.caption=Oe.thead;Oe.th=Oe.td;v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){xe(this,e).appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?v.filter(e,this):this,i=0;null!=(n=r[i]);i++){t||1!==n.nodeType||v.cleanData(ke(n));if(n.parentNode){t&&v.contains(n.ownerDocument,n)&&Ne(ke(n,"script"));n.parentNode.removeChild(n)}}return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&v.cleanData(ke(e,!1));for(;e.firstChild;)e.removeChild(e.firstChild);e.options&&v.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){e=null!=e&&e;t=null==t?e:t;return this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(de,""):t;if("string"==typeof e&&!Te.test(e)&&(v.support.htmlSerialize||!fe.test(e))&&(v.support.leadingWhitespace||!ye.test(e))&&!Oe[(ge.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(me,"<$1></$2>");try{for(;r<i;r++)if(1===(n=this[r]||{}).nodeType){v.cleanData(ke(n,!1));n.innerHTML=e}n=0}catch(e){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=v.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;this.domManip(arguments,function(n){var r=e[t++],i=e[t++];if(i){r&&r.parentNode!==i&&(r=this.nextSibling);v(this).remove();i.insertBefore(n,r)}},!0);return t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=p.apply([],e);var r,i,s,o,a,l,c=0,u=this.length,h=this,d=u-1,f=e[0],y=v.isFunction(f);if(y||!(u<=1||"string"!=typeof f||v.support.checkClone)&&Se.test(f))return this.each(function(r){var i=h.eq(r);y&&(e[0]=f.call(this,r,i.html()));i.domManip(e,t,n)});if(u){r=(l=v.buildFragment(e,this[0].ownerDocument,!1,!n&&this)).firstChild;1===l.childNodes.length&&(l=r);if(r){s=(o=v.map(ke(l,"script"),Pe)).length;for(;c<u;c++){i=l;if(c!==d){i=v.clone(i,!0,!0);s&&v.merge(o,ke(i,"script"))}t.call(this[c],i,c)}if(s){a=o[o.length-1].ownerDocument;v.map(o,_e);for(c=0;c<s;c++){i=o[c];be.test(i.type||"")&&!v._data(i,"globalEval")&&v.contains(a,i)&&(i.src?v._evalUrl(i.src):v.globalEval((i.text||i.textContent||i.innerHTML||"").replace(Ee,"")))}}l=r=null}}return this}});function xe(e,t){return v.nodeName(e,"table")&&v.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Pe(e){e.type=(null!==v.find.attr(e,"type"))+"/"+e.type;return e}function _e(e){var t=we.exec(e.type);t?e.type=t[1]:e.removeAttribute("type");return e}function Ne(e,t){for(var n,r=0;null!=(n=e[r]);r++)v._data(n,"globalEval",!t||v._data(t[r],"globalEval"))}function Me(e,t){if(1===t.nodeType&&v.hasData(e)){var n,r,i,s=v._data(e),o=v._data(t,s),a=s.events;if(a){delete o.handle;o.events={};for(n in a)for(r=0,i=a[n].length;r<i;r++)v.event.add(t,n,a[n][r])}o.data&&(o.data=v.extend({},o.data))}}function Ie(e,t){var n,r,i;if(1===t.nodeType){n=t.nodeName.toLowerCase();if(!v.support.noCloneEvent&&t[v.expando]){i=v._data(t);for(r in i.events)v.removeEvent(t,r,i.handle);t.removeAttribute(v.expando)}if("script"===n&&t.text!==e.text){Pe(t).text=e.text;_e(t)}else if("object"===n){t.parentNode&&(t.outerHTML=e.outerHTML);v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)}else if("input"===n&&Le.test(e.type)){t.defaultChecked=t.checked=e.checked;t.value!==e.value&&(t.value=e.value)}else"option"===n?t.defaultSelected=t.selected=e.defaultSelected:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}}v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(e){for(var n,r=0,i=[],s=v(e),o=s.length-1;r<=o;r++){n=r===o?this:this.clone(!0);v(s[r])[t](n);d.apply(i,n.get())}return this.pushStack(i)}});function ke(e,n){var r,s,o=0,a=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!a)for(a=[],r=e.childNodes||e;null!=(s=r[o]);o++)!n||v.nodeName(s,n)?a.push(s):v.merge(a,ke(s,n));return n===t||n&&v.nodeName(e,n)?v.merge([e],a):a}function Re(e){Le.test(e.type)&&(e.defaultChecked=e.checked)}v.extend({clone:function(e,t,n){var r,i,s,o,a,l=v.contains(e.ownerDocument,e);if(v.support.html5Clone||v.isXMLDoc(e)||!fe.test("<"+e.nodeName+">"))s=e.cloneNode(!0);else{Ae.innerHTML=e.outerHTML;Ae.removeChild(s=Ae.firstChild)}if(!(v.support.noCloneEvent&&v.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||v.isXMLDoc(e))){r=ke(s);a=ke(e);for(o=0;null!=(i=a[o]);++o)r[o]&&Ie(i,r[o])}if(t)if(n){a=a||ke(e);r=r||ke(s);for(o=0;null!=(i=a[o]);o++)Me(i,r[o])}else Me(e,s);(r=ke(s,"script")).length>0&&Ne(r,!l&&ke(e,"script"));r=a=i=null;return s},buildFragment:function(e,t,n,r){for(var i,s,o,a,l,c,u,h=e.length,p=he(t),d=[],f=0;f<h;f++)if((s=e[f])||0===s)if("object"===v.type(s))v.merge(d,s.nodeType?[s]:s);else if(ve.test(s)){a=a||p.appendChild(t.createElement("div"));l=(ge.exec(s)||["",""])[1].toLowerCase();u=Oe[l]||Oe._default;a.innerHTML=u[1]+s.replace(me,"<$1></$2>")+u[2];i=u[0];for(;i--;)a=a.lastChild;!v.support.leadingWhitespace&&ye.test(s)&&d.push(t.createTextNode(ye.exec(s)[0]));if(!v.support.tbody){i=(s="table"!==l||Ce.test(s)?"<table>"!==u[1]||Ce.test(s)?0:a:a.firstChild)&&s.childNodes.length;for(;i--;)v.nodeName(c=s.childNodes[i],"tbody")&&!c.childNodes.length&&s.removeChild(c)}v.merge(d,a.childNodes);a.textContent="";for(;a.firstChild;)a.removeChild(a.firstChild);a=p.lastChild}else d.push(t.createTextNode(s));a&&p.removeChild(a);v.support.appendChecked||v.grep(ke(d,"input"),Re);f=0;for(;s=d[f++];)if(!r||-1===v.inArray(s,r)){o=v.contains(s.ownerDocument,s);a=ke(p.appendChild(s),"script");o&&Ne(a);if(n){i=0;for(;s=a[i++];)be.test(s.type||"")&&n.push(s)}}a=null;return p},cleanData:function(e,t){for(var n,r,s,o,a=0,l=v.expando,c=v.cache,u=v.support.deleteExpando,p=v.event.special;null!=(n=e[a]);a++)if((t||v.acceptData(n))&&(o=(s=n[l])&&c[s])){if(o.events)for(r in o.events)p[r]?v.event.remove(n,r):v.removeEvent(n,r,o.handle);if(c[s]){delete c[s];u?delete n[l]:typeof n.removeAttribute!==i?n.removeAttribute(l):n[l]=null;h.push(s)}}},_evalUrl:function(e){return v.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}});v.fn.extend({wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()}});var De,Fe,Be,je=/alpha\([^)]*\)/i,Ue=/opacity\s*=\s*([^)]*)/,Ge=/^(top|right|bottom|left)$/,qe=/^(none|table(?!-c[ea]).+)/,He=/^margin/,We=new RegExp("^("+T+")(.*)$","i"),ze=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Ve=new RegExp("^([+-])=("+T+")","i"),$e={BODY:"block"},Ye={position:"absolute",visibility:"hidden",display:"block"},Xe={letterSpacing:0,fontWeight:400},Ke=["Top","Right","Bottom","Left"],Je=["Webkit","O","Moz","ms"];function Qe(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Je.length;i--;)if((t=Je[i]+n)in e)return t;return r}function Ze(e,t){e=t||e;return"none"===v.css(e,"display")||!v.contains(e.ownerDocument,e)}function et(e,t){for(var n,r,i,s=[],o=0,a=e.length;o<a;o++)if((r=e[o]).style){s[o]=v._data(r,"olddisplay");n=r.style.display;if(t){s[o]||"none"!==n||(r.style.display="");""===r.style.display&&Ze(r)&&(s[o]=v._data(r,"olddisplay",it(r.nodeName)))}else if(!s[o]){i=Ze(r);(n&&"none"!==n||!i)&&v._data(r,"olddisplay",i?n:v.css(r,"display"))}}for(o=0;o<a;o++)(r=e[o]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){var i,s,o={},a=0;if(v.isArray(n)){s=Fe(e);i=n.length;for(;a<i;a++)o[n[a]]=v.css(e,n[a],!1,s);return o}return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return et(this,!0)},hide:function(){return et(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ze(this)?v(this).show():v(this).hide()})}});v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,a,l=v.camelCase(n),c=e.style;n=v.cssProps[l]||(v.cssProps[l]=Qe(c,l));a=v.cssHooks[n]||v.cssHooks[l];if(r===t)return a&&"get"in a&&(s=a.get(e,!1,i))!==t?s:c[n];if("string"===(o=typeof r)&&(s=Ve.exec(r))){r=(s[1]+1)*s[2]+parseFloat(v.css(e,n));o="number"}if(!(null==r||"number"===o&&isNaN(r))){"number"!==o||v.cssNumber[l]||(r+="px");v.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(c[n]="inherit");if(!(a&&"set"in a&&(r=a.set(e,r,i))===t))try{c[n]=r}catch(e){}}}},css:function(e,n,r,i){var s,o,a,l=v.camelCase(n);n=v.cssProps[l]||(v.cssProps[l]=Qe(e.style,l));(a=v.cssHooks[n]||v.cssHooks[l])&&"get"in a&&(o=a.get(e,!0,r));o===t&&(o=Be(e,n,i));"normal"===o&&n in Xe&&(o=Xe[n]);if(""===r||r){s=parseFloat(o);return!0===r||v.isNumeric(s)?s||0:o}return o}});if(e.getComputedStyle){Fe=function(t){return e.getComputedStyle(t,null)};Be=function(e,n,r){var i,s,o,a=r||Fe(e),l=a?a.getPropertyValue(n)||a[n]:t,c=e.style;if(a){""!==l||v.contains(e.ownerDocument,e)||(l=v.style(e,n));if(ze.test(l)&&He.test(n)){i=c.width;s=c.minWidth;o=c.maxWidth;c.minWidth=c.maxWidth=c.width=l;l=a.width;c.width=i;c.minWidth=s;c.maxWidth=o}}return l}}else if(o.documentElement.currentStyle){Fe=function(e){return e.currentStyle};Be=function(e,n,r){var i,s,o,a=r||Fe(e),l=a?a[n]:t,c=e.style;null==l&&c&&c[n]&&(l=c[n]);if(ze.test(l)&&!Ge.test(n)){i=c.left;(o=(s=e.runtimeStyle)&&s.left)&&(s.left=e.currentStyle.left);c.left="fontSize"===n?"1em":l;l=c.pixelLeft+"px";c.left=i;o&&(s.left=o)}return""===l?"auto":l}}function tt(e,t,n){var r=We.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function nt(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;s<4;s+=2){"margin"===n&&(o+=v.css(e,n+Ke[s],!0,i));if(r){"content"===n&&(o-=v.css(e,"padding"+Ke[s],!0,i));"margin"!==n&&(o-=v.css(e,"border"+Ke[s]+"Width",!0,i))}else{o+=v.css(e,"padding"+Ke[s],!0,i);"padding"!==n&&(o+=v.css(e,"border"+Ke[s]+"Width",!0,i))}}return o}function rt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=Fe(e),o=v.support.boxSizing&&"border-box"===v.css(e,"boxSizing",!1,s);if(i<=0||null==i){((i=Be(e,t,s))<0||null==i)&&(i=e.style[t]);if(ze.test(i))return i;r=o&&(v.support.boxSizingReliable||i===e.style[t]);i=parseFloat(i)||0}return i+nt(e,t,n||(o?"border":"content"),r,s)+"px"}function it(e){var t=o,n=$e[e];if(!n){if("none"===(n=st(e,t))||!n){(t=((De=(De||v("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement))[0].contentWindow||De[0].contentDocument).document).write("<!doctype html><html><body>");t.close();n=st(e,t);De.detach()}$e[e]=n}return n}function st(e,t){var n=v(t.createElement(e)).appendTo(t.body),r=v.css(n[0],"display");n.remove();return r}v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return 0===e.offsetWidth&&qe.test(v.css(e,"display"))?v.swap(e,Ye,function(){return rt(e,t,r)}):rt(e,t,r)},set:function(e,n,r){var i=r&&Fe(e);return tt(0,n,r?nt(e,t,r,v.support.boxSizing&&"border-box"===v.css(e,"boxSizing",!1,i),i):0)}}});v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return Ue.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||""===t)&&""===v.trim(s.replace(je,""))&&n.removeAttribute){n.removeAttribute("filter");if(""===t||r&&!r.filter)return}n.filter=je.test(s)?s.replace(je,i):s+" "+i}});v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){if(t)return v.swap(e,{display:"inline-block"},Be,[e,"marginRight"])}});!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){n=Be(e,t);return ze.test(n)?v(e).position()[t]+"px":n}}}})});if(v.expr&&v.expr.filters){v.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!v.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||v.css(e,"display"))};v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}}v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+Ke[r]+t]=s[r]||s[r-2]||s[0];return i}};He.test(e)||(v.cssHooks[e+t].set=tt)});var ot=/%20/g,at=/\[\]$/,lt=/\r?\n/g,ct=/^(?:submit|button|image|reset|file)$/i,ut=/^(?:input|select|textarea|keygen)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=v.prop(this,"elements");return e?v.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!v(this).is(":disabled")&&ut.test(this.nodeName)&&!ct.test(e)&&(this.checked||!Le.test(e))}).map(function(e,t){var n=v(this).val();return null==n?null:v.isArray(n)?v.map(n,function(e){return{name:t.name,value:e.replace(lt,"\r\n")}}):{name:t.name,value:n.replace(lt,"\r\n")}}).get()}});v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():null==t?"":t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)ht(r,e[r],n,s);return i.join("&").replace(ot,"+")};function ht(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||at.test(e)?r(e,i):ht(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==v.type(t))r(e,t);else for(i in t)ht(e+"["+i+"]",t[i],n,r)}v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});v.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var pt,dt,ft=v.now(),yt=/\?/,mt=/#.*$/,gt=/([?&])_=[^&]*/,Ct=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,vt=/^(?:GET|HEAD)$/,Tt=/^\/\//,Lt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,St=v.fn.load,bt={},wt={},Et="*/".concat("*");try{dt=s.href}catch(e){(dt=o.createElement("a")).href="";dt=dt.href}pt=Lt.exec(dt.toLowerCase())||[];function Ot(e){return function(t,n){if("string"!=typeof t){n=t;t="*"}var r,i=0,s=t.toLowerCase().match(L)||[];if(v.isFunction(n))for(;r=s[i++];)if("+"===r[0]){r=r.slice(1)||"*";(e[r]=e[r]||[]).unshift(n)}else(e[r]=e[r]||[]).push(n)}}function At(e,t,n,r){var i={},s=e===wt;function o(a){var l;i[a]=!0;v.each(e[a]||[],function(e,a){var c=a(t,n,r);if("string"==typeof c&&!s&&!i[c]){t.dataTypes.unshift(c);o(c);return!1}if(s)return!(l=c)});return l}return o(t.dataTypes[0])||!i["*"]&&o("*")}function xt(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);r&&v.extend(!0,e,r);return e}v.fn.load=function(e,n,r){if("string"!=typeof e&&St)return St.apply(this,arguments);var i,s,o,a=this,l=e.indexOf(" ");if(l>=0){i=e.slice(l,e.length);e=e.slice(0,l)}if(v.isFunction(n)){r=n;n=t}else n&&"object"==typeof n&&(o="POST");a.length>0&&v.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments;a.html(i?v("<div>").append(v.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){a.each(r,s||[e.responseText,t,e])});return this};v.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){v.fn[t]=function(e){return this.on(t,e)}});v.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:dt,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(pt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Et,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?xt(xt(e,v.ajaxSettings),t):xt(v.ajaxSettings,e)},ajaxPrefilter:Ot(bt),ajaxTransport:Ot(wt),ajax:function(e,n){if("object"==typeof e){n=e;e=t}n=n||{};var r,i,s,o,a,l,c,u,h=v.ajaxSetup({},n),p=h.context||h,d=h.context&&(p.nodeType||p.jquery)?v(p):v.event,f=v.Deferred(),y=v.Callbacks("once memory"),m=h.statusCode||{},g={},C={},T=0,S="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===T){if(!u){u={};for(;t=Ct.exec(o);)u[t[1].toLowerCase()]=t[2]}t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===T?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();if(!T){e=C[n]=C[n]||e;g[e]=t}return this},overrideMimeType:function(e){T||(h.mimeType=e);return this},statusCode:function(e){var t;if(e)if(T<2)for(t in e)m[t]=[m[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||S;c&&c.abort(t);w(0,t);return this}};f.promise(b).complete=y.add;b.success=b.done;b.error=b.fail;h.url=((e||h.url||dt)+"").replace(mt,"").replace(Tt,pt[1]+"//");h.type=n.method||n.type||h.method||h.type;h.dataTypes=v.trim(h.dataType||"*").toLowerCase().match(L)||[""];if(null==h.crossDomain){r=Lt.exec(h.url.toLowerCase());h.crossDomain=!(!r||r[1]===pt[1]&&r[2]===pt[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(pt[3]||("http:"===pt[1]?"80":"443")))}h.data&&h.processData&&"string"!=typeof h.data&&(h.data=v.param(h.data,h.traditional));At(bt,h,n,b);if(2===T)return b;(l=h.global)&&0==v.active++&&v.event.trigger("ajaxStart");h.type=h.type.toUpperCase();h.hasContent=!vt.test(h.type);s=h.url;if(!h.hasContent){if(h.data){s=h.url+=(yt.test(s)?"&":"?")+h.data;delete h.data}!1===h.cache&&(h.url=gt.test(s)?s.replace(gt,"$1_="+ft++):s+(yt.test(s)?"&":"?")+"_="+ft++)}if(h.ifModified){v.lastModified[s]&&b.setRequestHeader("If-Modified-Since",v.lastModified[s]);v.etag[s]&&b.setRequestHeader("If-None-Match",v.etag[s])}(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&b.setRequestHeader("Content-Type",h.contentType);b.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Et+"; q=0.01":""):h.accepts["*"]);for(i in h.headers)b.setRequestHeader(i,h.headers[i]);if(h.beforeSend&&(!1===h.beforeSend.call(p,b,h)||2===T))return b.abort();S="abort";for(i in{success:1,error:1,complete:1})b[i](h[i]);if(c=At(wt,h,n,b)){b.readyState=1;l&&d.trigger("ajaxSend",[b,h]);h.async&&h.timeout>0&&(a=setTimeout(function(){b.abort("timeout")},h.timeout));try{T=1;c.send(g,w)}catch(e){if(!(T<2))throw e;w(-1,e)}}else w(-1,"No Transport");function w(e,n,r,i){var u,g,C,L,S,w=n;if(2!==T){T=2;a&&clearTimeout(a);c=t;o=i||"";b.readyState=e>0?4:0;u=e>=200&&e<300||304===e;r&&(L=function(e,n,r){var i,s,o,a,l=e.contents,c=e.dataTypes;for(;"*"===c[0];){c.shift();s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"))}if(s)for(a in l)if(l[a]&&l[a].test(s)){c.unshift(a);break}if(c[0]in r)o=c[0];else{for(a in r){if(!c[0]||e.converters[a+" "+c[0]]){o=a;break}i||(i=a)}o=o||i}if(o){o!==c[0]&&c.unshift(o);return r[o]}}(h,b,r));L=function(e,t,n,r){var i,s,o,a,l,c={},u=e.dataTypes.slice();if(u[1])for(o in e.converters)c[o.toLowerCase()]=e.converters[o];s=u.shift();for(;s;){e.responseFields[s]&&(n[e.responseFields[s]]=t);!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType));l=s;if(s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=c[l+" "+s]||c["* "+s]))for(i in c)if((a=i.split(" "))[1]===s&&(o=c[l+" "+a[0]]||c["* "+a[0]])){if(!0===o)o=c[i];else if(!0!==c[i]){s=a[0];u.unshift(a[1])}break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+s}}}}return{state:"success",data:t}}(h,L,b,u);if(u){if(h.ifModified){(S=b.getResponseHeader("Last-Modified"))&&(v.lastModified[s]=S);(S=b.getResponseHeader("etag"))&&(v.etag[s]=S)}if(204===e||"HEAD"===h.type)w="nocontent";else if(304===e)w="notmodified";else{w=L.state;g=L.data;u=!(C=L.error)}}else{C=w;if(e||!w){w="error";e<0&&(e=0)}}b.status=e;b.statusText=(n||w)+"";u?f.resolveWith(p,[g,w,b]):f.rejectWith(p,[b,w,C]);b.statusCode(m);m=t;l&&d.trigger(u?"ajaxSuccess":"ajaxError",[b,h,u?g:C]);y.fireWith(p,[b,w]);if(l){d.trigger("ajaxComplete",[b,h]);--v.active||v.event.trigger("ajaxStop")}}}return b},getJSON:function(e,t,n){return v.get(e,t,n,"json")},getScript:function(e,n){return v.get(e,t,n,"script")}});v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){if(v.isFunction(r)){s=s||i;i=r;r=t}return v.ajax({url:e,type:n,dataType:s,data:r,success:i})}});v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){v.globalEval(e);return e}}});v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1);if(e.crossDomain){e.type="GET";e.global=!1}});v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||v("head")[0]||o.documentElement;return{send:function(t,i){(n=o.createElement("script")).async=!0;e.scriptCharset&&(n.charset=e.scriptCharset);n.src=e.url;n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState)){n.onload=n.onreadystatechange=null;n.parentNode&&n.parentNode.removeChild(n);n=null;t||i(200,"success")}};r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Pt=[],_t=/(=)\?(?=&|$)|\?\?/;v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Pt.pop()||v.expando+"_"+ft++;this[e]=!0;return e}});v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,a,l=!1!==n.jsonp&&(_t.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&_t.test(n.data)&&"data");if(l||"jsonp"===n.dataTypes[0]){s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback;l?n[l]=n[l].replace(_t,"$1"+s):!1!==n.jsonp&&(n.url+=(yt.test(n.url)?"&":"?")+n.jsonp+"="+s);n.converters["script json"]=function(){a||v.error(s+" was not called");return a[0]};n.dataTypes[0]="json";o=e[s];e[s]=function(){a=arguments};i.always(function(){e[s]=o;if(n[s]){n.jsonpCallback=r.jsonpCallback;Pt.push(s)}a&&v.isFunction(o)&&o(a[0]);a=o=t});return"script"}});var Nt,Mt,It=0,kt=e.ActiveXObject&&function(){var e;for(e in Nt)Nt[e](t,!0)};function Rt(){try{return new e.XMLHttpRequest}catch(e){}}v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Rt()||function(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:Rt;Mt=v.ajaxSettings.xhr();v.support.cors=!!Mt&&"withCredentials"in Mt;(Mt=v.support.ajax=!!Mt)&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,a,l=n.xhr();n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async);if(n.xhrFields)for(a in n.xhrFields)l[a]=n.xhrFields[a];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType);n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(a in i)l.setRequestHeader(a,i[a])}catch(e){}l.send(n.hasContent&&n.data||null);r=function(e,i){var a,c,u,h;try{if(r&&(i||4===l.readyState)){r=t;if(o){l.onreadystatechange=v.noop;kt&&delete Nt[o]}if(i)4!==l.readyState&&l.abort();else{h={};a=l.status;c=l.getAllResponseHeaders();"string"==typeof l.responseText&&(h.text=l.responseText);try{u=l.statusText}catch(e){u=""}a||!n.isLocal||n.crossDomain?1223===a&&(a=204):a=h.text?200:404}}}catch(e){i||s(-1,e)}h&&s(a,u,h,c)};if(n.async)if(4===l.readyState)setTimeout(r);else{o=++It;if(kt){if(!Nt){Nt={};v(e).unload(kt)}Nt[o]=r}l.onreadystatechange=r}else r()},abort:function(){r&&r(t,!0)}}}});var Dt,Ft,Bt=/^(?:toggle|show|hide)$/,jt=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),Ut=/queueHooks$/,Gt=[function(e,t,n){var r,i,s,o,a,l,c=this,u={},h=e.style,p=e.nodeType&&Ze(e),d=v._data(e,"fxshow");if(!n.queue){if(null==(a=v._queueHooks(e,"fx")).unqueued){a.unqueued=0;l=a.empty.fire;a.empty.fire=function(){a.unqueued||l()}}a.unqueued++;c.always(function(){c.always(function(){a.unqueued--;v.queue(e,"fx").length||a.empty.fire()})})}if(1===e.nodeType&&("height"in t||"width"in t)){n.overflow=[h.overflow,h.overflowX,h.overflowY];"inline"===v.css(e,"display")&&"none"===v.css(e,"float")&&(v.support.inlineBlockNeedsLayout&&"inline"!==it(e.nodeName)?h.zoom=1:h.display="inline-block")}if(n.overflow){h.overflow="hidden";v.support.shrinkWrapBlocks||c.always(function(){h.overflow=n.overflow[0];h.overflowX=n.overflow[1];h.overflowY=n.overflow[2]})}for(r in t){i=t[r];if(Bt.exec(i)){delete t[r];s=s||"toggle"===i;if(i===(p?"hide":"show"))continue;u[r]=d&&d[r]||v.style(e,r)}}if(!v.isEmptyObject(u)){d?"hidden"in d&&(p=d.hidden):d=v._data(e,"fxshow",{});s&&(d.hidden=!p);p?v(e).show():c.done(function(){v(e).hide()});c.done(function(){var t;v._removeData(e,"fxshow");for(t in u)v.style(e,t,u[t])});for(r in u){o=Wt(p?d[r]:0,r,c);if(!(r in d)){d[r]=o.start;if(p){o.end=o.start;o.start="width"===r||"height"===r?1:0}}}}}],qt={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=jt.exec(t),s=i&&i[3]||(v.cssNumber[e]?"":"px"),o=(v.cssNumber[e]||"px"!==s&&+r)&&jt.exec(v.css(n.elem,e)),a=1,l=20;if(o&&o[3]!==s){s=s||o[3];i=i||[];o=+r||1;do{o/=a=a||".5";v.style(n.elem,e,o+s)}while(a!==(a=n.cur()/r)&&1!==a&&--l)}if(i){o=n.start=+o||+r||0;n.unit=s;n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]}return n}]};function Ht(){setTimeout(function(){Dt=t});return Dt=v.now()}function Wt(e,t,n){for(var r,i=(qt[t]||[]).concat(qt["*"]),s=0,o=i.length;s<o;s++)if(r=i[s].call(n,t,e))return r}function zt(e,t,n){var r,i,s=0,o=Gt.length,a=v.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Dt||Ht(),n=Math.max(0,c.startTime+c.duration-t),r=1-(n/c.duration||0),s=0,o=c.tweens.length;s<o;s++)c.tweens[s].run(r);a.notifyWith(e,[c,r,n]);if(r<1&&o)return n;a.resolveWith(e,[c]);return!1},c=a.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Dt||Ht(),duration:n.duration,tweens:[],createTween:function(t,n){var r=v.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);c.tweens.push(r);return r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)c.tweens[n].run(1);t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]);return this}}),u=c.props;!function(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n);i=t[r];s=e[n];if(v.isArray(s)){i=s[1];s=e[n]=s[0]}if(n!==r){e[r]=s;delete e[n]}if((o=v.cssHooks[r])&&"expand"in o){s=o.expand(s);delete e[r];for(n in s)if(!(n in e)){e[n]=s[n];t[n]=i}}else t[r]=i}}(u,c.opts.specialEasing);for(;s<o;s++)if(r=Gt[s].call(c,e,u,c.opts))return r;v.map(u,Wt,c);v.isFunction(c.opts.start)&&c.opts.start.call(e,c);v.fx.timer(v.extend(l,{elem:e,anim:c,queue:c.opts.queue}));return c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}v.Animation=v.extend(zt,{tweener:function(e,t){if(v.isFunction(e)){t=e;e=["*"]}else e=e.split(" ");for(var n,r=0,i=e.length;r<i;r++){n=e[r];qt[n]=qt[n]||[];qt[n].unshift(t)}},prefilter:function(e,t){t?Gt.unshift(e):Gt.push(e)}});function Vt(e,t,n,r,i){return new Vt.prototype.init(e,t,n,r,i)}v.Tween=Vt;Vt.prototype={constructor:Vt,init:function(e,t,n,r,i,s){this.elem=e;this.prop=n;this.easing=i||"swing";this.options=t;this.start=this.now=this.cur();this.end=r;this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Vt.propHooks[this.prop];return e&&e.get?e.get(this):Vt.propHooks._default.get(this)},run:function(e){var t,n=Vt.propHooks[this.prop];this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e;this.now=(this.end-this.start)*t+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);n&&n.set?n.set(this):Vt.propHooks._default.set(this);return this}};Vt.prototype.init.prototype=Vt.prototype;Vt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=v.css(e.elem,e.prop,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[v.cssProps[e.prop]]||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}};Vt.propHooks.scrollTop=Vt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate($t(t,!0),e,r,i)}});v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Ze).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=zt(this,v.extend({},e),s);(i||v._data(this,"finish"))&&t.stop(!0)};o.finish=o;return i||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop;t(r)};if("string"!=typeof e){r=n;n=e;e=t}n&&!1!==e&&this.queue(e||"fx",[]);return this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Ut.test(n)&&i(o[n]);for(n=s.length;n--;)if(s[n].elem===this&&(null==e||s[n].queue===e)){s[n].anim.stop(r);t=!1;s.splice(n,1)}!t&&r||v.dequeue(this,e)})},finish:function(e){!1!==e&&(e=e||"fx");return this.each(function(){var t,n=v._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=v.timers,o=r?r.length:0;n.finish=!0;v.queue(this,e,[]);i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)if(s[t].elem===this&&s[t].queue===e){s[t].anim.stop(!0);s.splice(t,1)}for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function $t(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)r["margin"+(n=Ke[i])]=r["padding"+n]=e;t&&(r.opacity=r.width=e);return r}v.each({slideDown:$t("show"),slideUp:$t("hide"),slideToggle:$t("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}});v.speed=function(e,t,n){var r=e&&"object"==typeof e?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;null!=r.queue&&!0!==r.queue||(r.queue="fx");r.old=r.complete;r.complete=function(){v.isFunction(r.old)&&r.old.call(this);r.queue&&v.dequeue(this,r.queue)};return r};v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};v.timers=[];v.fx=Vt.prototype.init;v.fx.tick=function(){var e,n=v.timers,r=0;Dt=v.now();for(;r<n.length;r++)(e=n[r])()||n[r]!==e||n.splice(r--,1);n.length||v.fx.stop();Dt=t};v.fx.timer=function(e){e()&&v.timers.push(e)&&v.fx.start()};v.fx.interval=13;v.fx.start=function(){Ft||(Ft=setInterval(v.fx.tick,v.fx.interval))};v.fx.stop=function(){clearInterval(Ft);Ft=null};v.fx.speeds={slow:600,fast:200,_default:400};v.fx.step={};v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],a=o&&o.ownerDocument;if(a){n=a.documentElement;if(!v.contains(n,o))return s;typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect());r=Yt(a);return{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}}};v.offset={setOffset:function(e,t,n){var r=v.css(e,"position");"static"===r&&(e.style.position="relative");var i,s,o=v(e),a=o.offset(),l=v.css(e,"top"),c=v.css(e,"left"),u={},h={};if(("absolute"===r||"fixed"===r)&&v.inArray("auto",[l,c])>-1){i=(h=o.position()).top;s=h.left}else{i=parseFloat(l)||0;s=parseFloat(c)||0}v.isFunction(t)&&(t=t.call(e,n,a));null!=t.top&&(u.top=t.top-a.top+i);null!=t.left&&(u.left=t.left-a.left+s);"using"in t?t.using.call(e,u):o.css(u)}};v.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];if("fixed"===v.css(r,"position"))t=r.getBoundingClientRect();else{e=this.offsetParent();t=this.offset();v.nodeName(e[0],"html")||(n=e.offset());n.top+=v.css(e[0],"borderTopWidth",!0);n.left+=v.css(e[0],"borderLeftWidth",!0)}return{top:t.top-n.top-v.css(r,"marginTop",!0),left:t.left-n.left-v.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||a;e&&!v.nodeName(e,"html")&&"static"===v.css(e,"position");)e=e.offsetParent;return e||a})}});v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=Yt(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}});function Yt(e){return v.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),a=r||(!0===i||!0===s?"margin":"border");return v.access(this,function(n,r,i){var s;if(v.isWindow(n))return n.document.documentElement["client"+e];if(9===n.nodeType){s=n.documentElement;return Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])}return i===t?v.css(n,r,a):v.style(n,r,i,a)},n,o?i:t,o,null)}})});v.fn.size=function(){return this.length};v.fn.andSelf=v.fn.addBack;if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=v;else{e.jQuery=e.$=v;"function"==typeof define&&define.amd&&define("jquery",[],function(){return v})}}(window);!function(e){"use strict";e();var t=function(t,r,i){var s=[];if(r)if(i.buildHTML)e(i.target).html(i.buildHTML({results:r}));else{for(var o=0;o<r.length;o++){var a=r[o];e.isPlainObject(a)?s[s.length]='<li><a href="'+i.link+encodeURIComponent(a.id)+'">'+a.label+"</a></li>":s[s.length]='<li><a href="'+i.link+encodeURIComponent(a)+'">'+a+"</a></li>"}e(i.target).html(s.join(""))}null!==i.callback&&e.isFunction(i.callback)&&n(i);t.val().length>0?t.trigger("targetUpdated.autocomplete"):t.trigger("targetCleared.autocomplete")},n=function(t){e("li a",e(t.target)).on("click.autocomplete",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})},r=function(e,t){t.html("").closest("fieldset").removeClass("ui-search-active");e.trigger("targetCleared.autocomplete")},i=function(n){var i,s,o,a,l=e(this),c=l.attr("id"),u=l.data("autocomplete");if(u){var h=u.settings,p=u.openXHR;if((i=l.val()).length<h.minLength)r(l,e(h.target));else if(e.isArray(h.source)){s=h.source.sort().filter(function(t){a=h.matchFromStart?new RegExp("^"+i,"i"):new RegExp(i,"i");o=e.isPlainObject(t)?t.label:t;return a.test(o)});t(l,s,h)}else if("function"==typeof h.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;h.source(i,function(e){t(l,e,h)})}else e.ajax({type:h.method,url:h.source,data:{term:i},beforeSend:function(e){if(h.cancelRequests){if(p[c])p[c].abort();else{h.target.html('<li><a href="#">Searching...</a></li>');h.target.closest("fieldset").addClass("ui-search-active")}p[c]=e}},success:function(e){t(l,e,h)},complete:function(e,t){h.cancelRequests&&(p[c]=null)},dataType:"json"})}},s={init:function(t){var n=this,s={settings:null};s.settings=e.extend({},s.defaults,t);n.data("autocomplete",s);var o=s.settings;return n.off("keyup.autocomplete").on("keyup.autocomplete",i).next(".ui-input-clear").on("click",function(t){r(n,e(o.target))})},update:function(t){var n=this.data("autocomplete");if(n){n.settings=e.extend(n.settings,t);this.data("autocomplete",n)}return this},clear:function(){var t=this.data("autocomplete");t&&r(this,e(t.settings.target));return this},destroy:function(){var t=this.data("autocomplete");if(t){r(this,e(t.settings.target));this.removeData("autocomplete");this.off(".autocomplete")}return this}};e.fn.autocomplete=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:s.init.apply(this,arguments)}}(jQuery);!function(e,t){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,function(e,t){"use strict";var n=Array.prototype.slice,r=e.console,i=void 0===r?function(){}:function(e){r.error(e)};function s(r,s,a){(a=a||t||e.jQuery)&&(s.prototype.option||(s.prototype.option=function(e){a.isPlainObject(e)&&(this.options=a.extend(!0,this.options,e))}),a.fn[r]=function(e){if("string"==typeof e){var t=n.call(arguments,1);return l=t,u="$()."+r+'("'+(o=e)+'")',this.each(function(e,t){var n=a.data(t,r);if(n){var s=n[o];if(s&&"_"!=o.charAt(0)){var h=s.apply(n,l);c=void 0===c?h:c}else i(u+" is not a valid method")}else i(r+" not initialized. Cannot call methods, i.e. "+u)}),void 0!==c?c:this}var o,l,c,u,h;return h=e,this.each(function(e,t){var n=a.data(t,r);n?(n.option(h),n._init()):(n=new s(t,h),a.data(t,r,n))}),this},o(a))}function o(e){!e||e&&e.bridget||(e.bridget=s)}return o(t||e.jQuery),s}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}var t="undefined"==typeof console?function(){}:function(e){console.error(e)},n=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],r=n.length;function i(e){var n=getComputedStyle(e);return n||t("Style returned "+n+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),n}var s,o=!1;return function t(a){if(function(){if(!o){o=!0;var n=document.createElement("div");n.style.width="200px",n.style.padding="1px 2px 3px 4px",n.style.borderStyle="solid",n.style.borderWidth="1px 2px 3px 4px",n.style.boxSizing="border-box";var r=document.body||document.documentElement;r.appendChild(n);var a=i(n);t.isBoxSizeOuter=s=200==e(a.width),r.removeChild(n)}}(),"string"==typeof a&&(a=document.querySelector(a)),a&&"object"==typeof a&&a.nodeType){var l=i(a);if("none"==l.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<r;t++)e[n[t]]=0;return e}();var c={};c.width=a.offsetWidth,c.height=a.offsetHeight;for(var u=c.isBorderBox="border-box"==l.boxSizing,h=0;h<r;h++){var p=n[h],d=l[p],f=parseFloat(d);c[p]=isNaN(f)?0:f}var y=c.paddingLeft+c.paddingRight,m=c.paddingTop+c.paddingBottom,g=c.marginLeft+c.marginRight,C=c.marginTop+c.marginBottom,v=c.borderLeftWidth+c.borderRightWidth,T=c.borderTopWidth+c.borderBottomWidth,L=u&&s,S=e(l.width);!1!==S&&(c.width=S+(L?0:y+v));var b=e(l.height);return!1!==b&&(c.height=b+(L?0:m+T)),c.innerWidth=c.width-(y+v),c.innerHeight=c.height-(m+T),c.outerWidth=c.width+g,c.outerHeight=c.height+C,c}}}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var n=this._events=this._events||{},r=n[e]=n[e]||[];return-1==r.indexOf(t)&&r.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents=this._onceEvents||{};return(n[e]=n[e]||{})[t]=!0,this}},t.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var r=n.indexOf(t);return-1!=r&&n.splice(r,1),this}},t.emitEvent=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){n=n.slice(0),t=t||[];for(var r=this._onceEvents&&this._onceEvents[e],i=0;i<n.length;i++){var s=n[i];r&&r[s]&&(this.off(e,s),delete r[s]),s.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"function"==typeof define&&define.amd?define("unipointer/unipointer",["ev-emitter/ev-emitter"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.Unipointer=t(e,e.EvEmitter)}(window,function(e,t){function n(){}var r=n.prototype=Object.create(t.prototype);r.bindStartEvent=function(e){this._bindStartEvent(e,!0)},r.unbindStartEvent=function(e){this._bindStartEvent(e,!1)},r._bindStartEvent=function(t,n){var r=(n=void 0===n||n)?"addEventListener":"removeEventListener",i="mousedown";e.PointerEvent?i="pointerdown":"ontouchstart"in e&&(i="touchstart"),t[r](i,this)},r.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.getTouch=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.identifier==this.pointerIdentifier)return n}},r.onmousedown=function(e){var t=e.button;t&&0!==t&&1!==t||this._pointerDown(e,e)},r.ontouchstart=function(e){this._pointerDown(e,e.changedTouches[0])},r.onpointerdown=function(e){this._pointerDown(e,e)},r._pointerDown=function(e,t){e.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,this.pointerDown(e,t))},r.pointerDown=function(e,t){this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t])};var i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return r._bindPostStartEvents=function(t){if(t){var n=i[t.type];n.forEach(function(t){e.addEventListener(t,this)},this),this._boundPointerEvents=n}},r._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){e.removeEventListener(t,this)},this),delete this._boundPointerEvents)},r.onmousemove=function(e){this._pointerMove(e,e)},r.onpointermove=function(e){e.pointerId==this.pointerIdentifier&&this._pointerMove(e,e)},r.ontouchmove=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerMove(e,t)},r._pointerMove=function(e,t){this.pointerMove(e,t)},r.pointerMove=function(e,t){this.emitEvent("pointerMove",[e,t])},r.onmouseup=function(e){this._pointerUp(e,e)},r.onpointerup=function(e){e.pointerId==this.pointerIdentifier&&this._pointerUp(e,e)},r.ontouchend=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerUp(e,t)},r._pointerUp=function(e,t){this._pointerDone(),this.pointerUp(e,t)},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t])},r._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},r._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},r.pointerDone=function(){},r.onpointercancel=function(e){e.pointerId==this.pointerIdentifier&&this._pointerCancel(e,e)},r.ontouchcancel=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerCancel(e,t)},r._pointerCancel=function(e,t){this._pointerDone(),this.pointerCancel(e,t)},r.pointerCancel=function(e,t){this.emitEvent("pointerCancel",[e,t])},n.getPointerPoint=function(e){return{x:e.pageX,y:e.pageY}},n}),function(e,t){"function"==typeof define&&define.amd?define("unidragger/unidragger",["unipointer/unipointer"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("unipointer")):e.Unidragger=t(e,e.Unipointer)}(window,function(e,t){function n(){}var r=n.prototype=Object.create(t.prototype);r.bindHandles=function(){this._bindHandles(!0)},r.unbindHandles=function(){this._bindHandles(!1)},r._bindHandles=function(t){for(var n=(t=void 0===t||t)?"addEventListener":"removeEventListener",r=t?this._touchActionValue:"",i=0;i<this.handles.length;i++){var s=this.handles[i];this._bindStartEvent(s,t),s[n]("click",this),e.PointerEvent&&(s.style.touchAction=r)}},r._touchActionValue="none",r.pointerDown=function(e,t){this.okayPointerDown(e)&&(this.pointerDownPointer=t,e.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t]))};var i={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},s={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return r.okayPointerDown=function(e){var t=i[e.target.nodeName],n=s[e.target.type],r=!t||n;return r||this._pointerReset(),r},r.pointerDownBlur=function(){var e=document.activeElement;e&&e.blur&&e!=document.body&&e.blur()},r.pointerMove=function(e,t){var n=this._dragPointerMove(e,t);this.emitEvent("pointerMove",[e,t,n]),this._dragMove(e,t,n)},r._dragPointerMove=function(e,t){var n={x:t.pageX-this.pointerDownPointer.pageX,y:t.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this._dragStart(e,t),n},r.hasDragStarted=function(e){return 3<Math.abs(e.x)||3<Math.abs(e.y)},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t]),this._dragPointerUp(e,t)},r._dragPointerUp=function(e,t){this.isDragging?this._dragEnd(e,t):this._staticClick(e,t)},r._dragStart=function(e,t){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(e,t)},r.dragStart=function(e,t){this.emitEvent("dragStart",[e,t])},r._dragMove=function(e,t,n){this.isDragging&&this.dragMove(e,t,n)},r.dragMove=function(e,t,n){e.preventDefault(),this.emitEvent("dragMove",[e,t,n])},r._dragEnd=function(e,t){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(e,t)},r.dragEnd=function(e,t){this.emitEvent("dragEnd",[e,t])},r.onclick=function(e){this.isPreventingClicks&&e.preventDefault()},r._staticClick=function(e,t){this.isIgnoringMouseUp&&"mouseup"==e.type||(this.staticClick(e,t),"mouseup"!=e.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},r.staticClick=function(e,t){this.emitEvent("staticClick",[e,t])},n.getPointerPoint=t.getPointerPoint,n}),function(e,t){"function"==typeof define&&define.amd?define(["get-size/get-size","unidragger/unidragger"],function(n,r){return t(e,n,r)}):"object"==typeof module&&module.exports?module.exports=t(e,require("get-size"),require("unidragger")):e.Draggabilly=t(e,e.getSize,e.Unidragger)}(window,function(e,t,n){function r(e,t){for(var n in t)e[n]=t[n];return e}var i=e.jQuery;function s(e,t){this.element="string"==typeof e?document.querySelector(e):e,i&&(this.$element=i(this.element)),this.options=r({},this.constructor.defaults),this.option(t),this._create()}var o=s.prototype=Object.create(n.prototype);s.defaults={},o.option=function(e){r(this.options,e)};var a={relative:!0,absolute:!0,fixed:!0};function l(e,t,n){return n=n||"round",t?Math[n](e/t)*t:e}return o._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=r({},this.position);var e=getComputedStyle(this.element);a[e.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},o.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},o.dispatchEvent=function(e,t,n){var r=[t].concat(n);this.emitEvent(e,r),this.dispatchJQueryEvent(e,t,n)},o.dispatchJQueryEvent=function(t,n,r){var i=e.jQuery;if(i&&this.$element){var s=i.Event(n);s.type=t,this.$element.trigger(s,r)}},o._getPosition=function(){var e=getComputedStyle(this.element),t=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=isNaN(t)?0:t,this.position.y=isNaN(n)?0:n,this._addTransformPosition(e)},o._getPositionCoord=function(e,n){if(-1!=e.indexOf("%")){var r=t(this.element.parentNode);return r?parseFloat(e)/100*r[n]:0}return parseInt(e,10)},o._addTransformPosition=function(e){var t=e.transform;if(0===t.indexOf("matrix")){var n=t.split(","),r=0===t.indexOf("matrix3d")?12:4,i=parseInt(n[r],10),s=parseInt(n[r+1],10);this.position.x+=i,this.position.y+=s}},o.onPointerDown=function(e,t){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",e,[t])},o.dragStart=function(e,t){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",e,[t]),this.animate())},o.measureContainment=function(){var e=this.getContainer();if(e){var n=t(this.element),r=t(e),i=this.element.getBoundingClientRect(),s=e.getBoundingClientRect(),o=r.borderLeftWidth+r.borderRightWidth,a=r.borderTopWidth+r.borderBottomWidth,l=this.relativeStartPosition={x:i.left-(s.left+r.borderLeftWidth),y:i.top-(s.top+r.borderTopWidth)};this.containSize={width:r.width-o-l.x-n.width,height:r.height-a-l.y-n.height}}},o.getContainer=function(){var e=this.options.containment;if(e)return e instanceof HTMLElement?e:"string"==typeof e?document.querySelector(e):this.element.parentNode},o.onPointerMove=function(e,t,n){this.dispatchJQueryEvent("pointerMove",e,[t,n])},o.dragMove=function(e,t,n){if(this.isEnabled){var r=n.x,i=n.y,s=this.options.grid,o=s&&s[0],a=s&&s[1];r=l(r,o),i=l(i,a),r=this.containDrag("x",r,o),i=this.containDrag("y",i,a),r="y"==this.options.axis?0:r,i="x"==this.options.axis?0:i,this.position.x=this.startPosition.x+r,this.position.y=this.startPosition.y+i,this.dragPoint.x=r,this.dragPoint.y=i,this.dispatchEvent("dragMove",e,[t,n])}},o.containDrag=function(e,t,n){if(!this.options.containment)return t;var r="x"==e?"width":"height",i=l(-this.relativeStartPosition[e],n,"ceil"),s=this.containSize[r];return s=l(s,n,"floor"),Math.max(i,Math.min(s,t))},o.onPointerUp=function(e,t){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",e,[t])},o.dragEnd=function(e,t){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",e,[t]))},o.animate=function(){if(this.isDragging){this.positionDrag();var e=this;requestAnimationFrame(function(){e.animate()})}},o.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},o.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},o.staticClick=function(e,t){this.dispatchEvent("staticClick",e,[t])},o.setPosition=function(e,t){this.position.x=e,this.position.y=t,this.setLeftTop()},o.enable=function(){this.isEnabled=!0},o.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},o.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},o._init=function(){},i&&i.bridget&&i.bridget("draggabilly",s),s});!function(e){"use strict";"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&void 0!==module.exports?module.exports=e():window.Sortable=e()}(function(){"use strict";if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,n,r,i,s,o,a,l,c,u,h,p,d,f,y,m,g,C,v,T,L,S,b,w,E=[],O=!1,A=!1,x=!1,P=[],_=!1,N=!1,M=/\s+/g,I="Sortable"+(new Date).getTime(),k=window,R=k.document,D=k.parseInt,F=k.setTimeout,B=k.jQuery||k.Zepto,j=k.Polymer,U={capture:!1,passive:!1},G=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),q=!!navigator.userAgent.match(/Edge/i),H=q||G?"cssFloat":"float",W="draggable"in R.createElement("div"),z=function(){if(G)return!1;var e=R.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),V=!1,$=!1,Y=Math.abs,X=Math.min,K=[],J=function(e,t){var n=fe(e),r=D(n.width),i=Le(e,0,t),s=Le(e,1,t),o=i&&fe(i),a=s&&fe(s),l=o&&D(o.marginLeft)+D(o.marginRight)+Ne(i).width,c=a&&D(a.marginLeft)+D(a.marginRight)+Ne(s).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if(i&&"none"!==o.float){var u="left"===o.float?"left":"right";return!s||"both"!==a.clear&&a.clear!==u?"horizontal":"vertical"}return i&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||r<=l&&"none"===n[H]||s&&"none"===n[H]&&r<l+c)?"vertical":"horizontal"},Q=function(e,t){if(!e||!e.getBoundingClientRect)return k;var n=e,r=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=fe(n);if(n.clientWidth<n.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!n||!n.getBoundingClientRect||n===R.body)return k;if(r||t)return n;r=!0}}}while(n=n.parentNode);return k},Z=Oe(function(e,t,n,r){if(t.scroll){var i=n?n[I]:window,s=t.scrollSensitivity,o=t.scrollSpeed,u=e.clientX,h=e.clientY,p=(window.innerWidth,window.innerHeight,!1);l!==n&&(ee(),a=t.scroll,c=t.scrollFn,!0===a&&(a=Q(n,!0),l=a));var d=0,f=a;do{var y,m,g,v,T,L,S,b,w,A=f,x=Ne(A),P=x.top,_=x.bottom,N=x.left,M=x.right,D=x.width,F=x.height;if(w=A!==k?(y=A.scrollWidth,m=A.scrollHeight,g=fe(A),L=D<y&&("auto"===g.overflowX||"scroll"===g.overflowX),S=F<m&&("auto"===g.overflowY||"scroll"===g.overflowY),b=A.scrollLeft,A.scrollTop):(y=R.documentElement.scrollWidth,m=R.documentElement.scrollHeight,g=fe(R.documentElement),L=D<y&&("auto"===g.overflowX||"scroll"===g.overflowX||"visible"===g.overflowX),S=F<m&&("auto"===g.overflowY||"scroll"===g.overflowY||"visible"===g.overflowY),b=R.documentElement.scrollLeft,R.documentElement.scrollTop),v=L&&(Y(M-u)<=s&&b+D<y)-(Y(N-u)<=s&&!!b),T=S&&(Y(_-h)<=s&&w+F<m)-(Y(P-h)<=s&&!!w),!E[d])for(var B=0;B<=d;B++)E[B]||(E[B]={});E[d].vx==v&&E[d].vy==T&&E[d].el===A||(E[d].el=A,E[d].vx=v,E[d].vy=T,clearInterval(E[d].pid),!A||0==v&&0==T||(p=!0,E[d].pid=setInterval(function(){r&&0===this.layer&&ce.active._emulateDragOver(!0);var t=E[this.layer].vy?E[this.layer].vy*o:0,n=E[this.layer].vx?E[this.layer].vx*o:0;"function"==typeof c&&"continue"!==c.call(i,n,t,e,C,E[this.layer].el)||(E[this.layer].el===k?k.scrollTo(k.pageXOffset+n,k.pageYOffset+t):(E[this.layer].el.scrollTop+=t,E[this.layer].el.scrollLeft+=n))}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&f!==k&&(f=Q(f,!1)));O=p}},30),ee=function(){E.forEach(function(e){clearInterval(e.pid)}),E=[]},te=function(e){function t(e,n){return function(r,i,s,o){var a=r.options.group.name&&i.options.group.name&&r.options.group.name===i.options.group.name;if(null==e&&(n||a))return!0;if(null==e||!1===e)return!1;if(n&&"clone"===e)return e;if("function"==typeof e)return t(e(r,i,s,o),n)(r,i,s,o);var l=(n?r:i).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var n={},r=e.group;r&&"object"==typeof r||(r={name:r}),n.name=r.name,n.checkPull=t(r.pull,!0),n.checkPut=t(r.put),n.revertClone=r.revertClone,e.group=n},ne=function(t){e&&e.parentNode&&e.parentNode[I]&&e.parentNode[I]._computeIsAligned(t)},re=function(e,t){for(var n=t;!n[I];)n=n.parentNode;return e===n},ie=function(e,t,n){for(var r=e.parentNode;r&&!r[I];)r=r.parentNode;r&&r[I][n](Ae(t,{artificialBubble:!0}))},se=function(){!z&&n&&fe(n,"display","none")},oe=function(){!z&&n&&fe(n,"display","")};R.addEventListener("click",function(e){if(x)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),x=!1},!0);var ae,le=function(t){if(t=t.touches?t.touches[0]:t,e){var n=function(e,t){for(var n=0;n<P.length;n++)if(!P[n].children.length){var r=Ne(P[n]),i=P[n][I].options.emptyInsertThreshold,s=e>=r.left-i&&e<=r.right+i,o=t>=r.top-i&&t<=r.bottom+i;if(s&&o)return P[n]}}(t.clientX,t.clientY);n&&n[I]._onDragOver({clientX:t.clientX,clientY:t.clientY,target:n,rootEl:n})}};function ce(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(e);this.el=e,this.options=t=Ae({},t),e[I]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return J(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:D(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ce.supportPointer&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var r in n)!(r in t)&&(t[r]=n[r]);for(var i in te(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&W,t.supportPointer?he(e,"pointerdown",this._onTapStart):(he(e,"mousedown",this._onTapStart),he(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(he(e,"dragover",this),he(e,"dragenter",this)),P.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[])}function ue(e,t,n,r){if(e){n=n||R;do{if(null!=t&&(">"===t[0]&&e.parentNode===n&&Ee(e,t.substring(1))||Ee(e,t))||r&&e===n)return e;if(e===n)break}while(e=(i=e).host&&i!==R&&i.host.nodeType?i.host:i.parentNode)}var i;return null}function he(e,t,n){e.addEventListener(t,n,U)}function pe(e,t,n){e.removeEventListener(t,n,U)}function de(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(M," ").replace(" "+t+" "," ");e.className=(r+(n?" "+t:"")).replace(M," ")}}function fe(e,t,n){var r=e&&e.style;if(r){if(void 0===n)return R.defaultView&&R.defaultView.getComputedStyle?n=R.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in r||-1!==t.indexOf("webkit")||(t="-webkit-"+t),r[t]=n+("string"==typeof n?"":"px")}}function ye(e){var t="";do{var n=fe(e,"transform");n&&"none"!==n&&(t=n+" "+t)}while(e=e.parentNode);return window.DOMMatrix?new DOMMatrix(t):window.WebKitCSSMatrix?new WebKitCSSMatrix(t):window.CSSMatrix?new CSSMatrix(t):void 0}function me(e,t,n){if(e){var r=e.getElementsByTagName(t),i=0,s=r.length;if(n)for(;i<s;i++)n(r[i],i);return r}return[]}function ge(e,t,n,i,s,o,a,l,c){var u,h=(e=e||t[I]).options,p="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||G||q?(u=R.createEvent("Event")).initEvent(n,!0,!0):u=new CustomEvent(n,{bubbles:!0,cancelable:!0}),u.to=s||t,u.from=o||t,u.item=i||t,u.clone=r,u.oldIndex=a,u.newIndex=l,u.originalEvent=c,t&&t.dispatchEvent(u),h[p]&&h[p].call(e,u)}function Ce(e,t,n,r,i,s,o,a){var l,c,u=e[I],h=u.options.onMove;return!window.CustomEvent||G||q?(l=R.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=n,l.draggedRect=r,l.related=i||t,l.relatedRect=s||Ne(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),h&&(c=h.call(u,l,o)),c}function ve(e){e.draggable=!1}function Te(){V=!1}function Le(t,r,i){for(var s=0,o=0,a=t.children;o<a.length;){if("none"!==a[o].style.display&&a[o]!==n&&a[o]!==e&&ue(a[o],i.draggable,t,!1)){if(s===r)return a[o];s++}o++}return null}function Se(e){for(var t=e.lastElementChild;(t===n||"none"===t.style.display)&&(t=t.previousElementSibling););return t||null}function be(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,r=0;n--;)r+=t.charCodeAt(n);return r.toString(36)}function we(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&e!==r&&n++;return n}function Ee(e,t){if(e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}function Oe(e,t){return function(){if(!ae){var n=arguments,r=this;ae=F(function(){1===n.length?e.call(r,n[0]):e.apply(r,n),ae=void 0},t)}}}function Ae(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function xe(e){return j&&j.dom?j.dom(e).cloneNode(!0):B?B(e).clone(!0)[0]:e.cloneNode(!0)}function Pe(e){return F(e,0)}function _e(e){return clearTimeout(e)}function Ne(e,t,n){if(e.getBoundingClientRect||e===k){var r,i,s,o,a,l,c;if(c=e!==k?(i=(r=e.getBoundingClientRect()).top,s=r.left,o=r.bottom,a=r.right,l=r.height,r.width):(s=i=0,o=window.innerHeight,a=window.innerWidth,l=window.innerHeight,window.innerWidth),n&&e!==k){if(t=t||e.parentNode,!G)do{if(t&&t.getBoundingClientRect&&"none"!==fe(t,"transform")){var u=t.getBoundingClientRect();i-=u.top+D(fe(t,"border-top-width")),s-=u.left+D(fe(t,"border-left-width")),o=i+r.height,a=s+r.width;break}}while(t=t.parentNode);var h=ye(e),p=h&&h.a,d=h&&h.d;h&&(o=(i/=d)+(l/=d),a=(s/=p)+(c/=p))}return{top:i,left:s,bottom:o,right:a,width:c,height:l}}}return he(R,"dragover",le),he(R,"mousemove",le),he(R,"touchmove",le),ce.prototype={constructor:ce,_computeIsAligned:function(t){var r;if(n&&!z?(se(),r=R.elementFromPoint(t.clientX,t.clientY),oe()):r=t.target,r=ue(r,this.options.draggable,this.el,!1),!$&&e&&e.parentNode===this.el){for(var i,s,o,a,l,c,u,h,p=this.el.children,d=0;d<p.length;d++)ue(p[d],this.options.draggable,this.el,!1)&&p[d]!==r&&(p[d].sortableMouseAligned=(i=t.clientX,s=t.clientY,o=p[d],a=this._getDirection(t,null),this.options,l=Ne(o),c="vertical"===a?l.left:l.top,u="vertical"===a?l.right:l.bottom,c<(h="vertical"===a?i:s)&&h<u));ue(r,this.options.draggable,this.el,!0)||(T=null),$=!0,F(function(){$=!1},30)}},_getDirection:function(t,n){return"function"==typeof this.options.direction?this.options.direction.call(this,t,n,e):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n,r=this,i=this.el,s=this.options,a=s.preventOnFilter,l=t.type,c=t.touches&&t.touches[0],u=(c||t).target,h=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||u,p=s.filter;if(function(e){K.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var r=t[n];r.checked&&K.push(r)}}(i),(!G||t.artificialBubble||re(i,u))&&!e&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||s.disabled||h.isContentEditable))if(u=ue(u,s.draggable,i,!1)){if(o!==u){if(n=we(u,s.draggable),"function"==typeof p){if(p.call(this,t,u,this))return ge(r,h,"filter",u,i,i,n),void(a&&t.cancelable&&t.preventDefault())}else if(p&&(p=p.split(",").some(function(e){if(e=ue(h,e.trim(),i,!1))return ge(r,e,"filter",u,i,i,n),!0})))return void(a&&t.cancelable&&t.preventDefault());s.handle&&!ue(h,s.handle,i,!1)||this._prepareDragStart(t,c,u,n)}}else G&&ie(i,t,"_onTapStart")}},_handleAutoScroll:function(t,n){if(e&&this.options.scroll){var r=t.clientX,i=t.clientY,s=R.elementFromPoint(r,i),o=this;if(n||q||G){Z(t,o.options,s,n);var a=Q(s,!0);!O||f&&r===y&&i===m||(f&&clearInterval(f),f=setInterval(function(){if(e){var s=Q(R.elementFromPoint(r,i),!0);s!==a&&(a=s,ee(),Z(t,o.options,a,n))}},10),y=r,m=i)}else{if(!o.options.bubbleScroll||Q(s,!0)===window)return void ee();Z(t,o.options,Q(s,!1),!1)}}},_prepareDragStart:function(n,r,a,l){var c,h=this,d=h.el,f=h.options,y=d.ownerDocument;a&&!e&&a.parentNode===d&&(i=d,t=(e=a).parentNode,s=e.nextSibling,o=a,p=f.group,u=l,g={target:e,clientX:(r||n).clientX,clientY:(r||n).clientY},this._lastX=(r||n).clientX,this._lastY=(r||n).clientY,e.style["will-change"]="all",e.style.transition="",e.style.transform="",c=function(){h._disableDelayedDrag(),e.draggable=h.nativeDraggable,h._triggerDragStart(n,r),ge(h,i,"choose",e,i,i,u),de(e,f.chosenClass,!0)},f.ignore.split(",").forEach(function(t){me(e,t.trim(),ve)}),f.supportPointer?he(y,"pointerup",h._onDrop):(he(y,"mouseup",h._onDrop),he(y,"touchend",h._onDrop),he(y,"touchcancel",h._onDrop)),f.delay?(he(y,"mouseup",h._disableDelayedDrag),he(y,"touchend",h._disableDelayedDrag),he(y,"touchcancel",h._disableDelayedDrag),he(y,"mousemove",h._delayedDragTouchMoveHandler),he(y,"touchmove",h._delayedDragTouchMoveHandler),f.supportPointer&&he(y,"pointermove",h._delayedDragTouchMoveHandler),h._dragStartTimer=F(c,f.delay)):c())},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;X(Y(t.clientX-this._lastX),Y(t.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),pe(e,"mouseup",this._disableDelayedDrag),pe(e,"touchend",this._disableDelayedDrag),pe(e,"touchcancel",this._disableDelayedDrag),pe(e,"mousemove",this._delayedDragTouchMoveHandler),pe(e,"touchmove",this._delayedDragTouchMoveHandler),pe(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||("touch"==t.pointerType?t:null),!this.nativeDraggable||n?this.options.supportPointer?he(R,"pointermove",this._onTouchMove):he(R,n?"touchmove":"mousemove",this._onTouchMove):(he(e,"dragend",this),he(i,"dragstart",this._onDragStart));try{R.selection?Pe(function(){R.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t){if(A=!1,i&&e){this.nativeDraggable&&(he(R,"dragover",this._handleAutoScroll),he(R,"dragover",ne));var n=this.options;!t&&de(e,n.dragClass,!1),de(e,n.ghostClass,!0),fe(e,"transform",""),ce.active=this,t&&this._appendGhost(),ge(this,i,"start",e,i,i,u)}else this._nulling()},_emulateDragOver:function(t){if(C){if(this._lastX===C.clientX&&this._lastY===C.clientY&&!t)return;this._lastX=C.clientX,this._lastY=C.clientY,se();for(var n=R.elementFromPoint(C.clientX,C.clientY),r=n;n&&n.shadowRoot;)r=n=n.shadowRoot.elementFromPoint(C.clientX,C.clientY);if(r)do{if(r[I]&&r[I]._onDragOver({clientX:C.clientX,clientY:C.clientY,target:n,rootEl:r})&&!this.options.dragoverBubble)break;n=r}while(r=r.parentNode);e.parentNode[I]._computeIsAligned(C),oe()}},_onTouchMove:function(e){if(g){var t=this.options,r=t.fallbackTolerance,i=t.fallbackOffset,s=e.touches?e.touches[0]:e,o=n&&ye(n),a=n&&o&&o.a,l=n&&o&&o.d,c=(s.clientX-g.clientX+i.x)/(a||1),u=(s.clientY-g.clientY+i.y)/(l||1),h=e.touches?"translate3d("+c+"px,"+u+"px,0)":"translate("+c+"px,"+u+"px)";if(!ce.active&&!A){if(r&&X(Y(s.clientX-this._lastX),Y(s.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}this._handleAutoScroll(s,!0),v=!0,C=s,fe(n,"webkitTransform",h),fe(n,"mozTransform",h),fe(n,"msTransform",h),fe(n,"transform",h),e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!n){var t=Ne(e,this.options.fallbackOnBody?R.body:i,!0),r=(fe(e),this.options);de(n=e.cloneNode(!0),r.ghostClass,!1),de(n,r.fallbackClass,!0),de(n,r.dragClass,!0),fe(n,"box-sizing","border-box"),fe(n,"margin",0),fe(n,"top",t.top),fe(n,"left",t.left),fe(n,"width",t.width),fe(n,"height",t.height),fe(n,"opacity","0.8"),fe(n,"position","fixed"),fe(n,"zIndex","100000"),fe(n,"pointerEvents","none"),r.fallbackOnBody&&R.body.appendChild(n)||i.appendChild(n)}},_onDragStart:function(t,n){var s=this,o=t.dataTransfer,a=s.options;(r=xe(e)).draggable=!1,r.style["will-change"]="",this._hideClone(),de(r,s.options.chosenClass,!1),s._cloneId=Pe(function(){s.options.removeCloneOnHide||i.insertBefore(r,e),ge(s,i,"clone",e)}),!n&&de(e,a.dragClass,!0),n?(x=!0,s._loopId=setInterval(s._emulateDragOver,50)):(pe(R,"mouseup",s._onDrop),pe(R,"touchend",s._onDrop),pe(R,"touchcancel",s._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(s,o,e)),he(R,"drop",s),fe(e,"transform","translateZ(0)")),A=!0,s._dragStartId=Pe(s._dragStarted.bind(s,n)),he(R,"selectstart",s)},_onDragOver:function(r){var o,a,l,c=this.el,h=r.target,f=this.options,y=f.group,m=ce.active,g=p===y,C=f.sort,E=this;if(!V&&(!G||r.rootEl||r.artificialBubble||re(c,h))){if(void 0!==r.preventDefault&&r.cancelable&&r.preventDefault(),v=!0,h=ue(h,f.draggable,c,!0),ue(r.target,null,e,!0)||h.animated)return be();if(h!==e&&(x=!1),m&&!f.disabled&&(g?C||(l=!i.contains(e)):d===this||(this.lastPutMode=p.checkPull(this,m,e,r))&&y.checkPut(this,m,e,r))){var A=this._getDirection(r,h);if(o=Ne(e),l)return this._hideClone(),t=i,s?i.insertBefore(e,s):i.appendChild(e),be();if(0===c.children.length||c.children[0]===n||(le=r,he=A,pe=Ne(Se(c)),fe="vertical"===he?le.clientY:le.clientX,ye="vertical"===he?le.clientX:le.clientY,me="vertical"===he?pe.bottom:pe.right,ve="vertical"===he?pe.left:pe.top,Le="vertical"===he?pe.right:pe.bottom,("vertical"===he?Le+10<ye||ye<=Le&&me<fe&&ve<=ye:me<fe&&ve<ye||fe<=me&&Le+10<ye)&&!e.animated)){if(0!==c.children.length&&c.children[0]!==n&&c===r.target&&(h=Se(c)),h&&(a=Ne(h)),g?m._hideClone():m._showClone(this),!1!==Ce(i,c,e,o,h,a,r,!!h))return c.appendChild(e),t=c,w=null,Ee(),this._animate(o,e),h&&this._animate(a,h),be()}else if(h&&h!==e&&h.parentNode===c){var P,M=0,D=h.sortableMouseAligned,B=e.parentNode!==c,j=function(e,t){for(var n=Q(n,!0),r=Ne(e)[t];n;){var i=Ne(n)[t];if(!("top"===t||"left"===t?i<=r:r<=i))return!0;if(n===k)break;n=Q(n,!1)}return!1}(h,"vertical"===A?"top":"left");if(T!==h&&(S=null,P=Ne(h)["vertical"===A?"top":"left"],_=!1),X=h,K=A,J=($=e)===e&&w||Ne($),Z=X===e&&w||Ne(X),ee="vertical"===K?J.left:J.top,te="vertical"===K?J.right:J.bottom,ne="vertical"===K?J.width:J.height,se="vertical"===K?Z.left:Z.top,oe="vertical"===K?Z.right:Z.bottom,ae="vertical"===K?Z.width:Z.height,S=(ee===se||te===oe||ee+ne/2===se+ae/2)&&D||B||j||f.invertSwap||"insert"===S||"swap"===S?("swap"!==S&&(N=f.invertSwap||B||O||j),M=function(t,n,r,i,s,o,a){var l=Ne(n),c="vertical"===r?t.clientY:t.clientX,u="vertical"===r?l.height:l.width,h="vertical"===r?l.top:l.left,p="vertical"===r?l.bottom:l.right,d=Ne(e),f=!1;if(!o)if(a&&b<u*i)if(!_&&(1===L?h+u*s/2<c:c<p-u*s/2)&&(_=!0),_)f=!0;else{"vertical"===r?d.top:d.left,"vertical"===r?d.bottom:d.right;if(1===L?c<h+b:p-b<c)return-1*L}else if(h+u*(1-i)/2<c&&c<p-u*(1-i)/2)return h+u/2<c?-1:1;return(f=f||o)&&(c<h+u*s/2||p-u*s/2<c)?h+u/2<c?1:-1:0}(r,h,A,f.swapThreshold,null==f.invertedSwapThreshold?f.swapThreshold:f.invertedSwapThreshold,N,T===h),"swap"):(W=h,M=we(e,(z=f).draggable)<we(W,z.draggable)?1:-1,"insert"),0===M)return be();w=null,L=M,a=Ne(T=h);var U=h.nextElementSibling,q=!1,H=Ce(i,c,e,o,h,a,r,q=1===M);if(!1!==H)return 1!==H&&-1!==H||(q=1===H),V=!0,F(Te,30),g?m._hideClone():m._showClone(this),q&&!U?c.appendChild(e):h.parentNode.insertBefore(e,q?U:h),t=e.parentNode,void 0===P||N||(b=Y(P-Ne(h)["vertical"===A?"top":"left"])),Ee(),!B&&this._animate(a,h),this._animate(o,e),be()}if(c.contains(e))return be()}var W,z,$,X,K,J,Z,ee,te,ne,se,oe,ae,le,he,pe,fe,ye,me,ve,Le;return G&&!r.rootEl&&ie(c,r,"_onDragOver"),!1}function be(){return m&&(de(e,d?d.options.ghostClass:m.options.ghostClass,!1),de(e,f.ghostClass,!0)),d!==E&&E!==ce.active?d=E:E===ce.active&&(d=null),(h===e&&!e.animated||h===c&&!h.animated)&&(T=null),f.dragoverBubble||r.rootEl||h===R||(E._handleAutoScroll(r),e.parentNode[I]._computeIsAligned(r)),!f.dragoverBubble&&r.stopPropagation&&r.stopPropagation(),!0}function Ee(){ge(E,i,"change",h,c,i,u,we(e,f.draggable),r)}},_animate:function(t,n){var r=this.options.animation;if(r){var i=Ne(n);if(n===e&&(w=i),1===t.nodeType&&(t=Ne(t)),t.left+t.width/2!==i.left+i.width/2||t.top+t.height/2!==i.top+i.height/2){var s=ye(this.el),o=s&&s.a,a=s&&s.d;fe(n,"transition","none"),fe(n,"transform","translate3d("+(t.left-i.left)/(o||1)+"px,"+(t.top-i.top)/(a||1)+"px,0)"),n.offsetWidth,fe(n,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),fe(n,"transform","translate3d(0,0,0)")}"number"==typeof n.animated&&clearTimeout(n.animated),n.animated=F(function(){fe(n,"transition",""),fe(n,"transform",""),n.animated=!1},r)}},_offUpEvents:function(){var e=this.el.ownerDocument;pe(R,"touchmove",this._onTouchMove),pe(R,"pointermove",this._onTouchMove),pe(e,"mouseup",this._onDrop),pe(e,"touchend",this._onDrop),pe(e,"pointerup",this._onDrop),pe(e,"touchcancel",this._onDrop),pe(R,"selectstart",this)},_onDrop:function(o){var a=this.el,l=this.options;_=N=O=A=!1,clearInterval(this._loopId),clearInterval(f),ee(),clearTimeout(ae),ae=void 0,clearTimeout(this._dragStartTimer),_e(this._cloneId),_e(this._dragStartId),pe(R,"mousemove",this._onTouchMove),this.nativeDraggable&&(pe(R,"drop",this),pe(a,"dragstart",this._onDragStart),pe(R,"dragover",this._handleAutoScroll),pe(R,"dragover",ne)),this._offUpEvents(),o&&(v&&(o.cancelable&&o.preventDefault(),!l.dropBubble&&o.stopPropagation()),n&&n.parentNode&&n.parentNode.removeChild(n),(i===t||d&&"clone"!==d.lastPutMode)&&r&&r.parentNode&&r.parentNode.removeChild(r),e&&(this.nativeDraggable&&pe(e,"dragend",this),ve(e),e.style["will-change"]="",de(e,d?d.options.ghostClass:this.options.ghostClass,!1),de(e,this.options.chosenClass,!1),ge(this,i,"unchoose",e,t,i,u,null,o),i!==t?(0<=(h=we(e,l.draggable))&&(ge(null,t,"add",e,t,i,u,h,o),ge(this,i,"remove",e,t,i,u,h,o),ge(null,t,"sort",e,t,i,u,h,o),ge(this,i,"sort",e,t,i,u,h,o)),d&&d.save()):e.nextSibling!==s&&0<=(h=we(e,l.draggable))&&(ge(this,i,"update",e,t,i,u,h,o),ge(this,i,"sort",e,t,i,u,h,o)),ce.active&&(null!=h&&-1!==h||(h=u),ge(this,i,"end",e,t,i,u,h,o),this.save()))),this._nulling()},_nulling:function(){i=e=t=n=s=r=o=a=l=E.length=f=y=m=g=C=v=h=u=T=L=w=d=p=ce.active=null,K.forEach(function(e){e.checked=!0}),K.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":e&&(this._onDragOver(t),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none");e.cancelable&&e.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,r=0,i=n.length,s=this.options;r<i;r++)ue(e=n[r],s.draggable,this.el,!1)&&t.push(e.getAttribute(s.dataIdAttr)||be(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,r){var i=n.children[r];ue(i,this.options.draggable,n,!1)&&(t[e]=i)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ue(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];n[e]=t,"group"===e&&te(n)},destroy:function(){var e=this.el;e[I]=null,pe(e,"mousedown",this._onTapStart),pe(e,"touchstart",this._onTapStart),pe(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(pe(e,"dragover",this),pe(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),P.splice(P.indexOf(this.el),1),this.el=e=null},_hideClone:function(){r.cloneHidden||(fe(r,"display","none"),r.cloneHidden=!0,r.parentNode&&this.options.removeCloneOnHide&&r.parentNode.removeChild(r))},_showClone:function(t){"clone"===t.lastPutMode?r.cloneHidden&&(i.contains(e)&&!this.options.group.revertClone?i.insertBefore(r,e):s?i.insertBefore(r,s):i.appendChild(r),this.options.group.revertClone&&this._animate(e,r),fe(r,"display",""),r.cloneHidden=!1):this._hideClone()}},he(R,"touchmove",function(e){(ce.active||A)&&e.cancelable&&e.preventDefault()}),ce.utils={on:he,off:pe,css:fe,find:me,is:function(e,t){return!!ue(e,t,e,!1)},extend:Ae,throttle:Oe,closest:ue,toggleClass:de,clone:xe,index:we,nextTick:Pe,cancelNextTick:_e,detectDirection:J,getChild:Le},ce.create=function(e,t){return new ce(e,t)},ce.version="1.8.2",ce});!function(){function e(e){this.mode=a.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],n=0,r=this.data.length;r>n;n++){var i=this.data.charCodeAt(n);i>65536?(t[0]=240|(1835008&i)>>>18,t[1]=128|(258048&i)>>>12,t[2]=128|(4032&i)>>>6,t[3]=128|63&i):i>2048?(t[0]=224|(61440&i)>>>12,t[1]=128|(4032&i)>>>6,t[2]=128|63&i):i>128?(t[0]=192|(1984&i)>>>6,t[1]=128|63&i):t[0]=i,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function r(e,t){this.totalCount=e,this.dataCount=t}function i(){this.buffer=[],this.length=0}function s(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function o(e,t){for(var n=1,r=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),i=0,s=d.length;s>=i;i++){var o=0;switch(t){case l.L:o=d[i][0];break;case l.M:o=d[i][1];break;case l.Q:o=d[i][2];break;case l.H:o=d[i][3]}if(o>=r)break;n++}if(n>d.length)throw new Error("Too long data");return n}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;n>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+n][t+r]=n>=0&&6>=n&&(0==r||6==r)||r>=0&&6>=r&&(0==n||6==n)||n>=2&&4>=n&&r>=2&&4>=r)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=u.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n);this.make();for(var i=0;i<this.modules.length;i++)for(var s=1*i,o=0;o<this.modules[i].length;o++){var a=1*o;this.modules[i][o]&&(r.beginFill(0,100),r.moveTo(a,s),r.lineTo(a+1,s),r.lineTo(a+1,s+1),r.lineTo(a,s+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=u.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i])for(var s=-2;2>=s;s++)for(var o=-2;2>=o;o++)this.modules[r+s][i+o]=-2==s||2==s||-2==o||2==o||0==s&&0==o}},setupTypeNumber:function(e){for(var t=u.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!e&&1==(1&t>>n);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;18>n;n++){r=!e&&1==(1&t>>n);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=u.getBCHTypeInfo(n),i=0;15>i;i++){var s=!e&&1==(1&r>>i);6>i?this.modules[i][8]=s:8>i?this.modules[i+1][8]=s:this.modules[this.moduleCount-15+i][8]=s}for(i=0;15>i;i++){s=!e&&1==(1&r>>i);8>i?this.modules[8][this.moduleCount-i-1]=s:9>i?this.modules[8][15-i-1+1]=s:this.modules[8][15-i-1]=s}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,s=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var a=0;2>a;a++)if(null==this.modules[r][o-a]){var l=!1;s<e.length&&(l=1==(1&e[s]>>>i));u.getMask(t,r,o-a)&&(l=!l),this.modules[r][o-a]=l,-1==--i&&(s++,i=7)}if(0>(r+=n)||this.moduleCount<=r){r-=n,n=-n;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,n,s){for(var o=r.getRSBlocks(e,n),a=new i,l=0;l<s.length;l++){var c=s[l];a.put(c.mode,4),a.put(c.getLength(),u.getLengthInBits(c.mode,e)),c.write(a)}var h=0;for(l=0;l<o.length;l++)h+=o[l].dataCount;if(a.getLengthInBits()>8*h)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*h+")");for(a.getLengthInBits()+4<=8*h&&a.put(0,4);0!=a.getLengthInBits()%8;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*h)&&(a.put(t.PAD0,8),!(a.getLengthInBits()>=8*h));)a.put(t.PAD1,8);return t.createBytes(a,o)},t.createBytes=function(e,t){for(var r=0,i=0,s=0,o=new Array(t.length),a=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,h=t[l].totalCount-c;i=Math.max(i,c),s=Math.max(s,h),o[l]=new Array(c);for(var p=0;p<o[l].length;p++)o[l][p]=255&e.buffer[p+r];r+=c;var d=u.getErrorCorrectPolynomial(h),f=new n(o[l],d.getLength()-1).mod(d);a[l]=new Array(d.getLength()-1);for(p=0;p<a[l].length;p++){var y=p+f.getLength()-a[l].length;a[l][p]=y>=0?f.get(y):0}}var m=0;for(p=0;p<t.length;p++)m+=t[p].totalCount;var g=new Array(m),C=0;for(p=0;i>p;p++)for(l=0;l<t.length;l++)p<o[l].length&&(g[C++]=o[l][p]);for(p=0;s>p;p++)for(l=0;l<t.length;l++)p<a[l].length&&(g[C++]=a[l][p]);return g};for(var a={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case c.PATTERN000:return 0==(t+n)%2;case c.PATTERN001:return 0==t%2;case c.PATTERN010:return 0==n%3;case c.PATTERN011:return 0==(t+n)%3;case c.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(n/3))%2;case c.PATTERN101:return 0==t*n%2+t*n%3;case c.PATTERN110:return 0==(t*n%2+t*n%3)%2;case c.PATTERN111:return 0==(t*n%3+(t+n)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new n([1],0),r=0;e>r;r++)t=t.multiply(new n([1,h.gexp(r)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case a.MODE_NUMBER:return 10;case a.MODE_ALPHA_NUM:return 9;case a.MODE_8BIT_BYTE:case a.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case a.MODE_NUMBER:return 12;case a.MODE_ALPHA_NUM:return 11;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case a.MODE_NUMBER:return 14;case a.MODE_ALPHA_NUM:return 13;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;t>r;r++)for(var i=0;t>i;i++){for(var s=0,o=e.isDark(r,i),a=-1;1>=a;a++)if(!(0>r+a||r+a>=t))for(var l=-1;1>=l;l++)0>i+l||i+l>=t||(0!=a||0!=l)&&o==e.isDark(r+a,i+l)&&s++;s>5&&(n+=3+s-5)}for(r=0;t-1>r;r++)for(i=0;t-1>i;i++){var c=0;e.isDark(r,i)&&c++,e.isDark(r+1,i)&&c++,e.isDark(r,i+1)&&c++,e.isDark(r+1,i+1)&&c++,(0==c||4==c)&&(n+=3)}for(r=0;t>r;r++)for(i=0;t-6>i;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(i=0;t>i;i++)for(r=0;t-6>r;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);var u=0;for(i=0;t>i;i++)for(r=0;t>r;r++)e.isDark(r,i)&&u++;return n+10*(Math.abs(100*u/t/t-50)/5)}},h={glog:function(e){if(1>e)throw new Error("glog("+e+")");return h.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return h.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;8>p;p++)h.EXP_TABLE[p]=1<<p;for(p=8;256>p;p++)h.EXP_TABLE[p]=h.EXP_TABLE[p-4]^h.EXP_TABLE[p-5]^h.EXP_TABLE[p-6]^h.EXP_TABLE[p-8];for(p=0;255>p;p++)h.LOG_TABLE[h.EXP_TABLE[p]]=p;n.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var i=0;i<e.getLength();i++)t[r+i]^=h.gexp(h.glog(this.get(r))+h.glog(e.get(i)));return new n(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=h.glog(this.get(0))-h.glog(e.get(0)),r=new Array(this.getLength()),i=0;i<this.getLength();i++)r[i]=this.get(i);for(i=0;i<e.getLength();i++)r[i]^=h.gexp(h.glog(e.get(i))+t);return new n(r,0).mod(e)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(e,t){var n=r.getRsBlockTable(e,t);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var i=n.length/3,s=[],o=0;i>o;o++)for(var a=n[3*o+0],l=n[3*o+1],c=n[3*o+2],u=0;a>u;u++)s.push(new r(l,c));return s},r.getRsBlockTable=function(e,t){switch(t){case l.L:return r.RS_BLOCK_TABLE[4*(e-1)+0];case l.M:return r.RS_BLOCK_TABLE[4*(e-1)+1];case l.Q:return r.RS_BLOCK_TABLE[4*(e-1)+2];case l.H:return r.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},i.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var n=0;t>n;n++)this.putBit(1==(1&e>>>t-n-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var d=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],f=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n}var n=this._htOption,r=this._el,i=e.getModuleCount();Math.floor(n.width/i),Math.floor(n.height/i),this.clear();var s=t("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:n.colorLight});s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(s),s.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var o=0;i>o;o++)for(var a=0;i>a;a++)if(e.isDark(o,a)){var l=t("use",{x:String(o),y:String(a)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),s.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),y="svg"===document.documentElement.tagName.toLowerCase()?f:"undefined"!=typeof CanvasRenderingContext2D?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var t=1/window.devicePixelRatio,n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,r,i,s,o,a,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*t;else void 0===c&&(arguments[1]*=t,arguments[2]*=t,arguments[3]*=t,arguments[4]*=t);n.apply(this,arguments)}}var r=function(e,t){this._bIsPainted=!1,this._android=s(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return r.prototype.draw=function(e){var t=this._elImage,n=this._oContext,r=this._htOption,i=e.getModuleCount(),s=r.width/i,o=r.height/i,a=Math.round(s),l=Math.round(o);t.style.display="none",this.clear();for(var c=0;i>c;c++)for(var u=0;i>u;u++){var h=e.isDark(c,u),p=u*s,d=c*o;n.strokeStyle=h?r.colorDark:r.colorLight,n.lineWidth=1,n.fillStyle=h?r.colorDark:r.colorLight,n.fillRect(p,d,s,o),n.strokeRect(Math.floor(p)+.5,Math.floor(d)+.5,a,l),n.strokeRect(Math.ceil(p)-.5,Math.ceil(d)-.5,a,l)}this._bIsPainted=!0},r.prototype.makeImage=function(){this._bIsPainted&&function(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var r=document.createElement("img"),i=function(){n._bSupportDataURI=!1,n._fFail&&_fFail.call(n)};return r.onabort=i,r.onerror=i,r.onload=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)},void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===n._bSupportDataURI&&n._fSuccess?n._fSuccess.call(n):!1===n._bSupportDataURI&&n._fFail&&n._fFail.call(n)}.call(this,e)},r.prototype.isPainted=function(){return this._bIsPainted},r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},r.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},r}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,n=this._el,r=e.getModuleCount(),i=Math.floor(t.width/r),s=Math.floor(t.height/r),o=['<table style="border:0;border-collapse:collapse;">'],a=0;r>a;a++){o.push("<tr>");for(var l=0;r>l;l++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+s+"px;background-color:"+(e.isDark(a,l)?t.colorDark:t.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),n.innerHTML=o.join("");var c=n.childNodes[0],u=(t.width-c.offsetWidth)/2,h=(t.height-c.offsetHeight)/2;u>0&&h>0&&(c.style.margin=h+"px "+u+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();(QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._android=s(),this._el=e,this._oQRCode=null,this._oDrawing=new y(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new t(o(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();(void 0!==define&&define.amd?define:function(e,t){var n,r=t();if(void 0!==exports)for(n in r)exports[n]=r[n];else window.jsonpack=r})([],function(){var e=-4,t=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]})},n=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]})},r=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},i=function(e){return parseInt(e,36)},s=Array.prototype.indexOf||function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1};return{JSON:JSON,pack:function(n,i){var o,a,l;(o=(i=i||{}).verbose||!1)&&console.log("Normalize the JSON Object");n="string"==typeof n?this.JSON.parse(n):n;o&&console.log("Creating a empty dictionary");a={strings:[],integers:[],floats:[]};o&&console.log("Creating the AST");var c=function n(i){var l,c,u,h,p;if(o&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(i)),l=typeof i,null===i)return{type:"null",index:-3};if(void 0===i)return{type:"undefined",index:-5};if(i instanceof Array){u=["@"];for(c in i)i.hasOwnProperty(c)&&u.push(n(i[c]));return u}if("object"===l){u=["$"];for(h in i)i.hasOwnProperty(h)&&(u.push(n(h)),u.push(n(i[h])));return u}if(""===i)return{type:"empty",index:e};if("string"===l)return-1==(p=s.call(a.strings,i))&&(a.strings.push(t(i)),p=a.strings.length-1),{type:"strings",index:p};if("number"===l&&i%1==0)return-1==(p=s.call(a.integers,i))&&(a.integers.push(r(i)),p=a.integers.length-1),{type:"integers",index:p};if("number"===l)return-1==(p=s.call(a.floats,i))&&(a.floats.push(i),p=a.floats.length-1),{type:"floats",index:p};if("boolean"===l)return{type:"boolean",index:i?-1:-2};throw new Error("Unexpected argument of type "+typeof i)}(n),u=a.strings.length,h=a.integers.length;a.floats.length;return o&&console.log("Parsing the dictionary"),l=a.strings.join("|"),l+="^"+a.integers.join("|"),l+="^"+a.floats.join("|"),o&&console.log("Parsing the structure"),l+="^"+function t(n){var i,s,a,l;if(o&&console.log("Calling a recursiveParser with "+this.JSON.stringify(n)),n instanceof Array){i=n.shift();for(s in n)n.hasOwnProperty(s)&&(i+=t(n[s])+"|");return("|"===i[i.length-1]?i.slice(0,-1):i)+"]"}if(a=n.type,l=n.index,"strings"===a)return r(l);if("integers"===a)return r(u+l);if("floats"===a)return r(u+h+l);if("boolean"===a)return n.index;if("null"===a)return-3;if("undefined"===a)return-5;if("empty"===a)return e;throw new TypeError("The item is alien!")}(c),o&&console.log("Ending parser"),i.debug?{dictionary:a,ast:c,packed:l}:l},unpack:function(t,r){var s,o,a,l,c,u,h,p;if(r=r||{},s=t.split("^"),r.verbose&&console.log("Building dictionary"),o=[],""!==(a=s[0]))for(a=a.split("|"),r.verbose&&console.log("Parse the strings dictionary"),c=0,l=a.length;c<l;c++)o.push(n(a[c]));if(""!==(a=s[1]))for(a=a.split("|"),r.verbose&&console.log("Parse the integers dictionary"),c=0,l=a.length;c<l;c++)o.push(i(a[c]));if(""!==(a=s[2]))for(a=a.split("|"),r.verbose&&console.log("Parse the floats dictionary"),c=0,l=a.length;c<l;c++)o.push(parseFloat(a[c]));a=null;r.verbose&&console.log("Tokenizing the structure");var d="",f=[],y=s[3].length;for(c=0;c<y;c++)"|"===(u=s[3].charAt(c))||"$"===u||"@"===u||"]"===u?(d&&(f.push(i(d)),d=""),"|"!==u&&f.push(u)):d+=u;return h=f.length,p=0,r.verbose&&console.log("Starting recursive parser"),function t(){var n,i,s,a=f[p++];if(r.verbose&&console.log("Reading collection type "+("$"===a?"object":"Array")),"@"===a){for(n=[];p<h;p++){if(s=f[p],r.verbose&&console.log("Read "+s+" symbol"),"]"===s)return n;if("@"===s||"$"===s)n.push(t());else switch(s){case-1:n.push(!0);break;case-2:n.push(!1);break;case-3:n.push(null);break;case-5:n.push(void 0);break;case e:n.push("");break;default:n.push(o[s])}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(n)),n}if("$"===a){for(n={};p<h;p++){if("]"===(i=f[p]))return n;if(i=i===e?"":o[i],"@"===(s=f[++p])||"$"===s)n[i]=t();else switch(s){case-1:n[i]=!0;break;case-2:n[i]=!1;break;case-3:n[i]=null;break;case-5:n[i]=void 0;break;case e:n[i]="";break;default:n[i]=o[s]}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(n)),n}throw new TypeError("Bad token "+a+" isn't a type")}()}}});!function(e,t){"use strict";var n="model",r="name",i="type",s="vendor",o="version",a="mobile",l="tablet",c={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},u={rgx:function(e,t){for(var n,r,i,s,o,a,l=0;l<t.length&&!o;){var c=t[l],u=t[l+1];n=r=0;for(;n<c.length&&!o;)if(o=c[n++].exec(e))for(i=0;i<u.length;i++){a=o[++r];"object"==typeof(s=u[i])&&s.length>0?2==s.length?"function"==typeof s[1]?this[s[0]]=s[1].call(this,a):this[s[0]]=s[1]:3==s.length?"function"!=typeof s[1]||s[1].exec&&s[1].test?this[s[0]]=a?a.replace(s[1],s[2]):void 0:this[s[0]]=a?s[1].call(this,a,s[2]):void 0:4==s.length&&(this[s[0]]=a?s[3].call(this,a.replace(s[1],s[2])):void 0):this[s]=a||void 0}l+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(c.has(t[n][r],e))return"?"===n?void 0:n}else if(c.has(t[n],e))return"?"===n?void 0:n;return e}},h={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[r,o],[/(opios)[\/\s]+([\w\.]+)/i],[[r,"Opera Mini"],o],[/\s(opr)\/([\w\.]+)/i],[[r,"Opera"],o],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[r,o],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[r,"IE"],o],[/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i],[[r,"Edge"],o],[/(yabrowser)\/([\w\.]+)/i],[[r,"Yandex"],o],[/(puffin)\/([\w\.]+)/i],[[r,"Puffin"],o],[/(focus)\/([\w\.]+)/i],[[r,"Firefox Focus"],o],[/(opt)\/([\w\.]+)/i],[[r,"Opera Touch"],o],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[r,"UCBrowser"],o],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],o],[/(micromessenger)\/([\w\.]+)/i],[[r,"WeChat"],o],[/(brave)\/([\w\.]+)/i],[[r,"Brave"],o],[/(qqbrowserlite)\/([\w\.]+)/i],[r,o],[/(QQ)\/([\d\.]+)/i],[r,o],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[r,o],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[r,o],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[r,o],[/(MetaSr)[\/\s]?([\w\.]+)/i],[r],[/(LBBROWSER)/i],[r],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[o,[r,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[o,[r,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[r,o],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[o,[r,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[r,/(.+)/,"$1 WebView"],o],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[r,/(.+(?:g|us))(.+)/,"$1 $2"],o],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[o,[r,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[r,o],[/(dolfin)\/([\w\.]+)/i],[[r,"Dolphin"],o],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[r,"Chrome"],o],[/(coast)\/([\w\.]+)/i],[[r,"Opera Coast"],o],[/fxios\/([\w\.-]+)/i],[o,[r,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[o,[r,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[o,r],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[r,"GSA"],o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[r,[o,u.str,h.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[r,o],[/(navigator|netscape)\/([\w\.-]+)/i],[[r,"Netscape"],o],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[r,o]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",c.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",c.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",c.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[n,s,[i,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[n,[s,"Apple"],[i,l]],[/(apple\s{0,1}tv)/i],[[n,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,n,[i,l]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[n,[s,"Amazon"],[i,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[n,u.str,h.device.amazon.model],[s,"Amazon"],[i,a]],[/android.+aft([bms])\sbuild/i],[n,[s,"Amazon"],[i,"smarttv"]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[n,s,[i,a]],[/\((ip[honed|\s\w*]+);/i],[n,[s,"Apple"],[i,a]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,n,[i,a]],[/\(bb10;\s(\w+)/i],[n,[s,"BlackBerry"],[i,a]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[n,[s,"Asus"],[i,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[n,"Xperia Tablet"],[i,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[n,[s,"Sony"],[i,a]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,n,[i,"console"]],[/android.+;\s(shield)\sbuild/i],[n,[s,"Nvidia"],[i,"console"]],[/(playstation\s[34portablevi]+)/i],[n,[s,"Sony"],[i,"console"]],[/(sprint\s(\w+))/i],[[s,u.str,h.device.sprint.vendor],[n,u.str,h.device.sprint.model],[i,a]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,n,[i,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[s,[n,/_/g," "],[i,a]],[/(nexus\s9)/i],[n,[s,"HTC"],[i,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[n,[s,"Huawei"],[i,a]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,n,[i,a]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[n,[s,"Microsoft"],[i,"console"]],[/(kin\.[onetw]{3})/i],[[n,/\./g," "],[s,"Microsoft"],[i,a]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[n,[s,"Motorola"],[i,a]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[n,[s,"Motorola"],[i,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,c.trim],[n,c.trim],[i,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[n,/^/,"SmartTV"],[s,"Samsung"],[i,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[n,[s,"Sharp"],[i,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],n,[i,l]],[/smart-tv.+(samsung)/i],[s,[i,"smarttv"],n],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[s,"Samsung"],n,[i,a]],[/sie-(\w*)/i],[n,[s,"Siemens"],[i,a]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[s,"Nokia"],n,[i,a]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[n,[s,"Acer"],[i,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[n,[s,"LG"],[i,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],n,[i,l]],[/(lg) netcast\.tv/i],[s,n,[i,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[n,[s,"LG"],[i,a]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[n,[s,"Lenovo"],[i,l]],[/linux;.+((jolla));/i],[s,n,[i,a]],[/((pebble))app\/[\d\.]+\s/i],[s,n,[i,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[s,n,[i,a]],[/crkey/i],[[n,"Chromecast"],[s,"Google"]],[/android.+;\s(glass)\s\d/i],[n,[s,"Google"],[i,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[n,[s,"Google"],[i,l]],[/android.+;\s(pixel( [23])?( xl)?)\s/i],[n,[s,"Google"],[i,a]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[n,/_/g," "],[s,"Xiaomi"],[i,a]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[n,/_/g," "],[s,"Xiaomi"],[i,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[n,[s,"Meizu"],[i,l]],[/(mz)-([\w-]{2,})/i],[[s,"Meizu"],n,[i,a]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[n,[s,"OnePlus"],[i,a]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[n,[s,"RCA"],[i,l]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[n,[s,"Dell"],[i,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[n,[s,"Verizon"],[i,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[s,"Barnes & Noble"],n,[i,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[n,[s,"NuVision"],[i,l]],[/android.+;\s(k88)\sbuild/i],[n,[s,"ZTE"],[i,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[n,[s,"Swiss"],[i,a]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[n,[s,"Swiss"],[i,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[n,[s,"Zeki"],[i,l]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[s,"Dragon Touch"],n,[i,l]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[n,[s,"Insignia"],[i,l]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[n,[s,"NextBook"],[i,l]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[s,"Voice"],n,[i,a]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[s,"LvTel"],n,[i,a]],[/android.+;\s(PH-1)\s/i],[n,[s,"Essential"],[i,a]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[n,[s,"Envizen"],[i,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[s,n,[i,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[n,[s,"MachSpeed"],[i,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[s,n,[i,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[n,[s,"Rotor"],[i,l]],[/android.+(KS(.+))\s+build/i],[n,[s,"Amazon"],[i,l]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[s,n,[i,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,c.lowerize],s,n],[/(android[\w\.\s\-]{0,9});.+build/i],[n,[s,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[o,[r,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,o],[/rv\:([\w\.]{1,9}).+(gecko)/i],[o,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,o],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[o,u.str,h.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[o,u.str,h.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],o],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[r,o],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[r,"Symbian"],o],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],o],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[r,o],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],o],[/(sunos)\s?([\w\.\d]*)/i],[[r,"Solaris"],o],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[r,o],[/(haiku)\s(\w+)/i],[r,o],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[o,/_/g,"."],[r,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[r,"Mac OS"],[o,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[r,o]]},d=function(t,n){if("object"==typeof t){n=t;t=void 0}if(!(this instanceof d))return new d(t,n).getResult();var r=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),i=n?c.extend(p,n):p;this.getBrowser=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,i.browser);e.major=c.major(e.version);return e};this.getCPU=function(){var e={architecture:void 0};u.rgx.call(e,r,i.cpu);return e};this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};u.rgx.call(e,r,i.device);return e};this.getEngine=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,i.engine);return e};this.getOS=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,i.os);return e};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return r};this.setUA=function(e){r=e;return this};return this};d.VERSION="0.7.19";d.BROWSER={NAME:r,MAJOR:"major",VERSION:o};d.CPU={ARCHITECTURE:"architecture"};d.DEVICE={MODEL:n,VENDOR:s,TYPE:i,CONSOLE:"console",MOBILE:a,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"};d.ENGINE={NAME:r,VERSION:o};d.OS={NAME:r,VERSION:o};if(void 0!==exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=d);exports.UAParser=d}else"function"==typeof define&&define.amd?define(function(){return d}):e&&(e.UAParser=d);var f=e&&(e.jQuery||e.Zepto);if(void 0!==f&&!f.ua){var y=new d;f.ua=y.getResult();f.ua.get=function(){return y.getUA()};f.ua.set=function(e){y.setUA(e);var t=y.getResult();for(var n in t)f.ua[n]=t[n]}}}("object"==typeof window?window:this);var TC=TC||{};TC.tool=TC.tool||{};TC.tool.Proxification=function(e,t){this.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}};if(void 0===e)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");this.proxy="function"==typeof e?e:function(t){var n=e;"http"!=t.substr(0,4)&&(n+=window.location.protocol);return n+=encodeURIComponent(t)};t=t||{};this._location=t.location||window.location;this.preventMixedContent=void 0===t.allowedMixedContent||!t.allowedMixedContent};!function(){window.fetch||function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{new Blob;return!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=a(e);t=l(t);var n=this.map[e];this.map[e]=n?n+","+t:t};u.prototype.delete=function(e){delete this.map[a(e)]};u.prototype.get=function(e){e=a(e);return this.has(e)?this.map[e]:null};u.prototype.has=function(e){return this.map.hasOwnProperty(a(e))};u.prototype.set=function(e,t){this.map[a(e)]=l(t)};u.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)};u.prototype.keys=function(){var e=[];this.forEach(function(t,n){e.push(n)});return c(e)};u.prototype.values=function(){var e=[];this.forEach(function(t){e.push(t)});return c(e)};u.prototype.entries=function(){var e=[];this.forEach(function(t,n){e.push([n,t])});return c(e)};t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})};y.call(m.prototype);y.call(C.prototype);C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})};C.error=function(){var e=new C(null,{status:0,statusText:""});e.type="error";return e};var o=[301,302,303,307,308];C.redirect=function(e,t){if(-1===o.indexOf(t))throw new RangeError("Invalid status code");return new C(null,{status:t,headers:{location:e}})};e.Headers=u;e.Request=m;e.Response=C;e.fetch=function(e,n){return new Promise(function(r,i){var s=new m(e,n);n=n||{};var o=new XMLHttpRequest;o.onload=function(){if(0===o.status)return new C(null,{status:o.status});var e={status:o.status,statusText:o.statusText,headers:function(e){var t=new u;e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}});return t}(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;r(new C(t,e))};o.onerror=function(){i(new TypeError("Network request failed"))};o.ontimeout=function(){i(new TypeError("Network request failed"))};o.open(s.method,s.url,!n.sync);"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1);!n.sync&&"responseType"in o&&t.blob&&(o.responseType="blob");s.headers.forEach(function(e,t){o.setRequestHeader(t,e)});o.send(void 0===s._bodyInit?null:s._bodyInit)})};e.fetch.polyfill=!0}function a(e){"string"!=typeof e&&(e=String(e));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){"string"!=typeof e&&(e=String(e));return e}function c(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};t.iterable&&(n[Symbol.iterator]=function(){return n});return n}function u(e){this.map={};e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise(function(t,n){e.onload=function(){t(e.result)};e.onerror=function(){n(e.error)}})}function d(e){var t=new FileReader,n=p(t);t.readAsArrayBuffer(e);return n}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e));return t.buffer}function y(){this.bodyUsed=!1;this._initBody=function(e){this._bodyInit=e;if(e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e)){this._bodyArrayBuffer=f(e.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};if(t.blob){this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))};this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(d)}}this.text=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,n=p(t);t.readAsText(e);return n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};t.formData&&(this.formData=function(){return this.text().then(g)});this.json=function(){return this.text().then(JSON.parse)};return this}function m(e,t){var n,r,i=(t=t||{}).body;if(e instanceof m){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url;this.credentials=e.credentials;t.headers||(this.headers=new u(e.headers));this.method=e.method;this.mode=e.mode;if(!i&&null!=e._bodyInit){i=e._bodyInit;e.bodyUsed=!0}}else this.url=String(e);this.credentials=t.credentials||this.credentials||"omit";!t.headers&&this.headers||(this.headers=new u(t.headers));this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),s.indexOf(r)>-1?r:n);this.mode=t.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function g(e){var t=new FormData;e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}});return t}function C(e,t){t||(t={});this.type="default";this.status=void 0===t.status?200:t.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in t?t.statusText:"OK";this.headers=new u(t.headers);this.url=t.url||"";this._initBody(e)}}("undefined"!=typeof self?self:this);var e=function(e){var t=document.createElement("a");t.href=e;if(!t.origin){if(!t.protocol||!t.hostname){var n=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);t.protocol=n[1];if(n[4].indexOf(":")>-1){var r=n[4].split(":");t.hostname=r[0];t.port=r[1]}else t.hostname=n[4]}t.origin=(0===t.protocol.length?window.location.protocol:t.protocol)+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t};var t=TC.tool.Proxification.prototype;t.cacheHost=new function(){var t=function(t){var n=e(t);return n?n.origin:null};this._hosts=[];this._hostsImage=[];this.is=function(e,n){var r=t(e);return null!==this.get(r,n)};this.get=function(e,t){if(0===this.getList(t).length)return null;var n=this.getList(t).filter(function(n){return n.key===e&&t.exportable==n.exportable});return 0===n.length?null:n[0]};this.getList=function(e){return e.forImage?this._hostsImage:this._hosts};this.addKey=function(e,n){var r={key:t(e),action:null};n.exportable&&(r.exportable=n.exportable);this.getList(n).push(r);return this.getList(n)[this.getList(n).length-1]};this.removeKey=function(e,n){t(e);for(var r=0;r<this.getList(n).length;r++)if(this.getList(n)[r].key&&n.exportable==this.getList(n)[r].exportable){this.getList(n).splice(r,1);break}};this.getAction=function(e,n){n=n||{};var r=t(e);return this.get(r,n)._actionPromise}};t._isServiceWorker=function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)};t._isSameOrigin=function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(this.Consts.url.SPLIT_REGEX);if(n){var r=n[1];t=(r==this._location.protocol||void 0==r)&&n[3]==this._location.hostname;var i=n[4],s=this._location.port;(80!=i&&""!==i||"80"!=s&&""!==s)&&(t=t&&i==s)}return t};t._isSameProtocol=function(e){var t=/^(https?:\/\/)/i,n=e.match(t);if(n&&n.length>1){var r=self._location.match(t);if(r&&r.length>1)return n[0].trim()===r[0].trim()}return!1};t._isSecureURL=function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)};var n=function(t,n){var r=e(t);return t.replace(r.protocol,n)},r=function(e){return n(e,"https:")},i=function(e){return n(e,"http:")},s=function(e,t,n,s){var a=this;e=r(e);a._image.getImgTag(e,t).then(function(e){n(e,a._actionHTTPS)},function(r){r===a._image.ErrorType.PROTOCOL?s(r):o.call(a,i(e),t,n,s)})},o=function(e,t,n,r){var i=this;t.sameOrigin=i._isSameOrigin(i._actionProxy.call(i,e));i._image.getImgTagByAction(e,t,i._actionProxy.bind(i)).then(function(e){n(e,i._actionProxy)},function(e){r(e)})};t._actionDirect=function(e){return e};t._actionHTTP=function(e){return n(e,"http:")};t._actionHTTPS=function(e){return n(e,"https:")};t._actionProxy=function(e){return this.proxy(e)};t._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected"},checkHttpStatus:function(e){const t=this;return fetch(e,{credentials:"omit"}).then(function(e){return{status:e.status,statusText:e.statusText}}).catch(function(e){return t.ErrorType.UNEXPECTED})},getImgTag:function(e,n){return new Promise(function(t,r){var i=this,s=document.createElement("img");if(n.exportable&&!n.sameOrigin){s.dataset.checkCORSHeaders=!0;s.crossOrigin="anonymous"}s.onload=function(){console.log("Load OK: "+s.src);s.onload=s.onerror=void 0;if(n.exportable&&!n.sameOrigin){try{var e=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d");t.height=e.height;t.width=e.width;n.drawImage(e,0,0);return t}(s);result=e.toDataURL("image/png");t(s)}catch(e){18===e.code?r(i.ErrorType.CORS):t(s)}}else t(s)};s.onerror=function(t){console.log("Load crossOrigin ERROR: "+s.src);if(s.dataset.checkCORSHeaders){s.crossOrigin=null;s.onerror=void 0;s.onerror=function(e){console.log("Load ERROR: "+s.src);i.checkHttpStatus(s.src).then(function(e){n.ignoreProxification?r(i.ErrorType.PROTOCOL):400===e.status?r(i.ErrorType.PROTOCOL):r(e)}).catch(r);s.onload=s.onerror=void 0};s.src=e}else{console.log("Load ERROR: "+s.src);s.onload=s.onerror=void 0;i.checkHttpStatus(s.src).then(function(e){n.ignoreProxification?r(i.ErrorType.PROTOCOL):400===e.status?r(i.ErrorType.PROTOCOL):r(e)}).catch(r)}};try{s.src=e}catch(e){console.log("Load ERROR: "+s.src);r(i.ErrorType.UNEXPECTED)}}.bind(t._image))},getImgTagByAction:function(e,n,r){return new Promise(function(t,i){var s=this,o=document.createElement("img");n.sameOrigin||n.exportable&&(o.crossOrigin="anonymous");o.onload=function(){o.onload=o.onerror=void 0;t(o)};o.onerror=function(e){console.log("Load ERROR: "+o.src);o.onload=o.onerror=void 0;s.checkHttpStatus(o.src).then(function(e){n.ignoreProxification?i(s.ErrorType.PROTOCOL):400===e.status?i(s.ErrorType.PROTOCOL):i(e)}).catch(i)};o.src=r(e)}.bind(t._image))}};t._fetch={Headers:{CONTENTTYPE:"content-type"},ErrorType:{CORS:"cors",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(e){if(!e.ok)throw Error(e.statusText);return e},validateContentType:function(e,t){const n=this;if(!e)return t;var r=t.headers.get(n._fetch.Headers.CONTENTTYPE);if(r&&-1===r.indexOf(e))throw Error(n._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return t}};t.fetchImage=function(e,t){var n=this;(t=t||{}).forImage=!0;return new Promise(function(a,l){if(n.cacheHost.is(e,t))n.cacheHost.getAction(e,t).then(function(r){t.sameOrigin=n._isSameOrigin(r.action(e));n._image.getImgTagByAction(e,t,r.action).then(function(e){a(e)},function(e){l(e)})});else{var c=n.cacheHost.addKey(e,t);c._actionPromise=new Promise(function(u,h){const p=function(e,r){c.action=r.bind(n);c.exportable=t.exportable;u({action:c.action});a(e)},d=function(r){if(200==r.status){n.cacheHost.removeKey(e,t);l(r)}else{n.cacheHost.removeKey(e,t);l(r)}};!function(t){if(n._isSameOrigin(e)){t.sameOrigin=!0;n._image.getImgTag(e,t).then(function(e){p(e,n._actionDirect)},d)}else n._isSecureURL(e)?n._image.getImgTag(e,t).then(function(e){p(e,n._actionDirect)},function(s){t.exportable&&s===n._image.ErrorType.CORS||n._isServiceWorker()||n._isSecureURL(n._location)&&n.preventMixedContent?s===n._image.ErrorType.PROTOCOL&&t.ignoreProxification?d(s):o.call(n,e,t,p,d):function(e,t,n,s){var a=this;e=i(e);a._image.getImgTag(e,t).then(function(e){n(e,a._actionHTTP)},function(i){i===a._image.ErrorType.PROTOCOL?s(i):o.call(a,r(e),t,n,s)})}.call(n,e,t,p,d)}):n._isServiceWorker()||n._isSecureURL(n._location)&&n.preventMixedContent?s.call(n,e,t,p,d):n._image.getImgTag(e,t).then(function(e){p(e,n._actionDirect)},function(r){t.exportable&&r===n._image.ErrorType.CORS||!n._isSecureURL(n._location)?r===n._image.ErrorType.PROTOCOL&&t.ignoreProxification?d(r):o.call(n,e,t,p,d):s.call(n,e,t,p,d)})}(t)})}})};t.fetchRetry=function(e,t,n){const r=this;var i=fetch;t.sync&&(i=r.fetchSync);return i(e,t).catch(function(i){if(1===n)throw i;return r.fetchRetry(e,t,n-1)})};t.fetchSync=function(e,t){var n=this;return new Promise(function(r,i){"Symbol"in n&&Symbol;var s="FileReader"in n&&"Blob"in n&&function(){try{new Blob;return!0}catch(e){return!1}}();if("ArrayBuffer"in n){var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];ArrayBuffer.isView}var a=new Request(e,t),l=new XMLHttpRequest;l.onload=function(){var e={status:l.status,statusText:l.statusText,headers:function(e){var t=new Headers;e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}});return t}(l.getAllResponseHeaders()||"")};e.url="responseURL"in l?l.responseURL:e.headers.get("X-Request-URL");var t="response"in l?l.response:l.responseText;r(new Response(t,e))};l.onerror=function(){i(new TypeError("Network request failed"))};l.ontimeout=function(){i(new TypeError("Network request failed"))};l.open(a.method,a.url,!1);"include"===a.credentials?l.withCredentials=!t.sync:"omit"===a.credentials&&(l.withCredentials=!1);!t.sync&&"responseType"in l&&s&&(l.responseType="blob");a.headers.forEach(function(e,t){l.setRequestHeader(t,e)});l.send(void 0===a._bodyInit?null:a._bodyInit)})};t.fetchXML=function(e,t){(t=t||{}).responseType="xml";return this.fetch(e,t)};t.fetchJSON=function(e,t){(t=t||{}).responseType=TC.Consts.mimeType.JSON;return this.fetch(e,t)};t.fetchBlob=function(e,t){(t=t||{}).responseType="blob";return this.fetch(e,t)};t.fetchImageAsBlob=function(e,t){(t=t||{}).responseType="image";return this.fetch(e,t)};t.fetch=function(t,n){const r=this;if((n=n||{}).type){n.method=n.type;delete n.type}if(n.data){n.body=n.data;delete n.data}if(n.contentType){n.headers=new Headers;n.headers.append("Content-Type",n.contentType);delete n.contentType}n.responseType||(n.responseType="");var i=function(e,t,n,s){return(t.retryAttempts?r.fetchRetry(n[0].call(r,e),t,t.retryAttempts):fetch(n[0].call(r,e),t)).then(r._fetch.validateResponse).then(r._fetch.validateContentType.bind(r,t.responseType)).then(function(e){s&&(s.action=n[0].bind(r));const i=e.headers.get(r._fetch.Headers.CONTENTTYPE),o=function(t){return e.blob().then(function(e){const n=new FileReader;return new Promise(function(r,i){n.addEventListener("error",function(){n.abort();i(new DOMException("Problem decoding"))});n.addEventListener("loadend",function(){r(n.result)});n.readAsText(e,t)})})};switch(!0){case t.responseType.indexOf("xml")>-1:case t.responseType.indexOf("text/xml")>-1:case t.responseType.indexOf(TC.Consts.mimeType.XML)>-1:return(a=/charset=([^;]*)/i.exec(i))&&2===a.length&&"UTF-8"!==a[1]?o(a[1]).then(function(e){return(new window.DOMParser).parseFromString(e,"text/xml")}):e.text().then(function(e){return(new window.DOMParser).parseFromString(e,"text/xml")});case t.responseType.indexOf("arraybuffer")>-1:return e.arrayBuffer();case t.responseType.indexOf("image")>-1:case t.responseType.indexOf("blob")>-1:return e.blob().then(function(e){return new Blob([e],{type:i})});case t.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+t.responseType);case t.responseType.indexOf(TC.Consts.mimeType.JSON)>-1:return e.json();case""==t.responseType:case t.responseType.indexOf("text")>-1:default:var a;return(a=/charset=([^;]*)/i.exec(i))&&2===a.length&&"UTF-8"!==a[1]?o(a[1]).then(function(e){return""==t.responseType?{responseText:e,contentType:i}:e}):e.text().then(function(e){return""==t.responseType?{responseText:e,contentType:i}:e})}}).catch(function(r){if(1===n.length){console.log("request failed",r);return Promise.reject(new Error(r.message))}n.shift();return i(e,t,n,s)})};if(r.cacheHost.is(t,n))return r.cacheHost.getAction(t,n).then(function(e){return i(t,n,[e.action])}).catch(function(e){return Promise.reject(new Error(e))});var s=r.cacheHost.addKey(t,n);return new Promise(function(o,a){s._actionPromise=new Promise(function(l,c){t=e(t).href;const u=function(e){l({action:s.action});o(e)},h=function(e){r.cacheHost.removeKey(t,n);c(e);a(e)};r._isSameOrigin(t)?i(t,n,[r._actionDirect,r._actionProxy],s).then(u).catch(h):r._isSecureURL(t)?r._isServiceWorker()?i(t,n,[r._actionDirect,r._actionProxy],s).then(u).catch(h):i(t,n,[r._actionDirect,r._actionHTTP,r._actionProxy],s).then(u).catch(h):r._isServiceWorker()?i(t,n,[r._actionHTTPS,r._actionProxy],s).then(u).catch(h):i(t,n,r._isSecureURL(r._location)?[r._actionDirect,r._actionHTTPS,r._actionProxy]:[r._actionDirect,r._actionProxy],s).then(u).catch(h)})})}}();var TC=TC||{};TC.inherit=function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;e._super=t.prototype};!function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(e){t.prototype=new t("").constructor.prototype;return t;function t(e,t){t||(t={});var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail);return n}}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);const e=function(e,t,n){const r=this;e.split(" ").forEach(function(e){r.$events.addEventListener(e,function(e,t){const n=function(e){const n={type:e.type,target:this,currentTarget:this};e.detail&&Object.keys(e.detail).forEach(function(t){t in n||(n[t]=e.detail[t])});return t.call(this,n)}.bind(this);(this._listeners[e]=this._listeners[e]||new Map).set(t,n);return n}.call(r,e,t),n)});return r};TC.EventTarget=function(){const e=this;e._listeners={};e.$events=document.createDocumentFragment();const t=["addEventListener","dispatchEvent","removeEventListener"];t.forEach(function(t){this[t]=e.$events[t].bind(e.$events)},e);t.push("on");t.push("one");t.push("off");t.push("trigger");t.forEach(function(t){e.$events[t]=e[t].bind(e)},e)};const t=TC.EventTarget.prototype;t.on=function(t,n){return e.call(this,t,n)};navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0?t.one=function(e,t){const n=this,r=function(i){n.off(e,r);t.call(this,i)};n.on(e,r);return n}:t.one=function(t,n){return e.call(this,t,n,{once:!0})};t.off=function(e,t){const n=this,r=e.split(" ");t?r.forEach(function(e){const r=n._listeners[e];r&&r.has(t)&&n.$events.removeEventListener(e,r.get(t))}):r.forEach(function(e){const t=n._listeners[e];if(t){t.forEach(function(t){n.$events.removeEventListener(e,t)});t.clear()}});return n};t.trigger=function(e,t){if(window.$&&$.Event&&e instanceof $.Event){t={};Object.keys(e).forEach(function(n){"type"!==n&&(t[n]=e[n])});e=e.type}var n;t&&(n={detail:t});const r=new CustomEvent(e,n);this.dispatchEvent(r)};TC.EventTarget._onBySelectorMap=new WeakMap;TC.EventTarget.listenerBySelector=function(e,t){return function(n){const r=this,i=n.type;var s=TC.EventTarget._onBySelectorMap.get(r);if(!s){s={};TC.EventTarget._onBySelectorMap.set(r,s)}var o=s[i];o||(s[i]=o={});o[e]||(o[e]=t);if(!n._listenerBySelectorCalled)for(var a,l=!1,c=n.target;c&&c!==r;){for(e in o)if(c.matches&&c.matches(e)){l=!0;a=o[e].call(r,n);n._listenerBySelectorCalled=!0}if(l)return a;c=c.parentNode}}};var n=null,r=null;const i=function(e){const t=this;var i=s.call(t);if(t.replaceCurrent){window.history.replaceState(i,null,null);delete t.replaceCurrent}else{t.lastEventType=e.type;var o=function(){r=n;(n=TC.Util.utf8ToBase64(i))!==r&&window.history.pushState(i,null,window.location.href.split("#").shift()+"#"+n)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE:case e.type==TC.Consts.event.LAYERORDER:case e.type==TC.Consts.event.ZOOM:o();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&o()}}},s=function(e){const t=this;var n={};t.crs!==t.options.crs&&(n.crs=t.crs);for(var r=t.getExtent(),i=0;i<r.length;i++)Math.abs(r[i])>180&&(r[i]=Math.floor(1e3*r[i])/1e3);n.ext=r;var s,o,a=[];t.baseLayers&&(a=t.baseLayers.filter(function(e){return e.isRaster()&&e.fallbackLayer}).map(function(e){return{baseLayer:e,fallbackLayerID:e.fallbackLayer.id}}).filter(function(e){return e.fallbackLayerID===(t.baseLayer?t.baseLayer.id:t.baseLayers[0].id)}));a.length>0?n.base=a[0].baseLayer.id:n.base=(t.baseLayer||t.baseLayers[0]).id;n.layers=[];for(i=0;i<t.workLayers.length;i++)if("WMS"==(s=t.workLayers[i]).type&&!s.options.stateless&&s.layerNames&&s.layerNames.length){o={u:TC.Util.isOnCapabilities(s.url),n:$.isArray(s.names)?s.names.join(","):s.names,o:s.getOpacity(),v:s.getVisibility(),h:s.options.hideTitle,ur:s.unremovable,t:s.title};n.layers.push(o)}t.on3DView&&t.view3D.cameraControls&&(n.vw3=t.view3D.cameraControls.getCameraState());window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);e&&$.extend(n,e);return jsonpack.pack(n)},o=function(e){const t=this,n=[];t.loadingctrl||(t.loadingCtrl=t.getControlsByClass("TC.control.LoadingIndicator")[0]);t.hasWait||(t.hasWait=t.loadingCtrl&&t.loadingCtrl.addWait());return new Promise(function(r,i){var s,o=function(){t.loadingCtrl&&t.loadingCtrl.removeWait(t.hasWait);delete t.hasWait;r()};if("string"==typeof e)try{s=jsonpack.unpack(e)}catch(n){try{s=JSON.parse(e)}catch(e){TC.error(TC.Util.getLocaleString(t.options.locale,"mapStateNotValid"))}}else s=e;if(s){if(s.crs&&s.crs!==t.crs||void 0===s.crs&&t.crs!==t.options.crs)n.push(t.setProjection({crs:s.crs||t.options.crs,oldCrs:t.crs,extent:s.ext,baseLayer:t.getLayer(s.base)}));else{if(s.base!=t.getBaseLayer().id){t.getLayer(s.base)&&t.setBaseLayer(s.base);const e=t.baseLayers.filter(function(e){return e.options.fallbackLayer===s.base})[0];if(e){const r=t.addLayer(e.getFallbackLayer());n.push(r);r.then(function(e){t.setBaseLayer(e)})}}s.ext&&n.push(t.setExtent(s.ext,{animate:!1}))}(function(){const e=this;e.workLayers.filter(function(e){return!(e instanceof TC.layer.Vector)}).forEach(function(t){t.unremovable&&(t.unremovable=!1);e.removeLayer(t)})}).call(t);s.layers=s.layers||s.capas||[];if(s.layers.length>0)for(var a=0;a<s.layers.length;a++){var l=s.layers[a],c=!1;for(j=0;j<t.options.workLayers.length;j++){var u=$.extend({},t.options.workLayers[j],{map:t});if(l.u===u.url&&u.layerNames.indexOf(l.n)>=0){c=!0;u.renderOptions={opacity:l.o,hide:!l.v};u.unremovable=l.ur;u.title=l.t;n.push(t.addLayer(u).then(function(e){e.setVisibility(this.v);e.setOpacity(this.o,!0)}.bind(l)))}}c||n.push(t.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:l.n?l.n.split(","):"",unremovable:l.ur,title:l.t,renderOptions:{opacity:l.o,hide:!l.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(this.o,!0);e.setVisibility(this.v)}.bind(l)))}Promise.all(n).then(function(){o()}).catch(function(){o()})}})},a=function(e){return function(t,n,r,i){return n.id===e?r:t}},l=function(e){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(t){return t.id===e})[0]};TC.Map=TC.Map||function(e,t){const n=this;TC.EventTarget.call(n);TC.Map._instances.push(n);n.isReady=!1;n.isLoaded=!1;n.controls=[];n.activeControl=null;n.layers=[];n.baseLayers=[];n.workLayers=[];n.baseLayer=null;n.vectors=null;var u=0;n.div=TC.Util.getDiv(e);n._$div=$(n.div);n.div.classList.add(TC.Consts.classes.LOADING);$(n.div).data("map",n);n.div.classList.add(TC.Consts.classes.MAP);n._markerPromises=[];n._layerBuffer={layers:[],contains:function(e){return this.layers.some(function(t){return t.id===e})},getIndex:function(e){return this.layers.reduce(a(e),-1)},add:function(e,t,n){var r;const i={id:e,pending:!0,isRaster:t,isBase:n};if(t){r=this.getRasterIndex();this.layers.splice(r,0,i)}else{r=this.layers.length;this.layers[r]=i}},remove:function(e){this.layers.splice(this.getIndex(e),1)},getMapLayers:function(){return this.layers.filter(function(e){return!1===e.pending}).map(function(e){return e.mapLayer})},resolve:function(e,t,n){const r=this.layers[this.getIndex(t.id)];r.mapLayer=t;r.pending=!1;e.layers=this.getMapLayers();if(n){0===e.baseLayers.length&&(e.baseLayers=new Array(e.options.baseLayers.length));if((i=e.options.baseLayers.map(function(e){return e.id}).indexOf(t.id))<0){var i;(i=e.baseLayers.map(function(e){return e.type}).indexOf(TC.Consts.layerType.VECTOR))<0?e.baseLayers.push(t):e.baseLayers.splice(i,0,t)}else e.baseLayers.splice(i,1,t)}else e.workLayers=e.layers.filter(function(e){return!e.isBase})},reject:function(e,t,n){const r=this.layers[this.getIndex(t.id)];r.mapLayer=t;r.pending=!1;r.rejected=!0;var i=e.options.baseLayers.map(function(e){return e.id}).indexOf(t.id);e.baseLayers.splice(i,1)},getResolvedWorkLayerIndex:function(e,t){return this.layers.filter(function(e){return e.id===t||!e.isBase&&!1===e.pending}).reduce(a(t),-1)},getResolvedVisibleLayerIndex:function(e,t){var n=this.getResolvedWorkLayerIndex(e,t);e.baseLayer&&(n+=1);return n},getRasterIndex:function(){return this.layers.reduce((e="isRaster",function(t,n,r){return n[e]?r:t}),-1)+1;var e},checkMapLoad:function(e){const t=this;if(e.options.baseLayers.concat(e.options.workLayers).every(function(e){return t.contains(e.id||e)})&&!this.layers.some(function(e){return!0===e.pending})){const t=function(){if(!e.isLoaded){const t=function(){e.options.stateful&&function(){const e=this;var t=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");e.replaceCurrent=!0;i.call(e);const n=i.bind(e);e.on(t,n);var r;e.on(TC.Consts.event.LAYEROPACITY,function(t){clearTimeout(r);r=setTimeout(function(){i.call(e,t)},500)});window.addEventListener("popstate",function(r){var i;i=e.loadingCtrl&&e.loadingCtrl.addWait();setTimeout(function(){if(r){e.off(t,n);var s=r.state;"[object Object]"===Object.prototype.toString.call(s)&&(s=e.checkLocation());o.call(e,s).then(function(){setTimeout(function(){e.on(t,n)},200);e.loadingCtrl&&e.loadingCtrl.removeWait(i)})}},4)})}.call(e);e.isLoaded=!0;e.trigger(TC.Consts.event.MAPLOAD);Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12&&e.options.warningIE||e.div.classList.remove(TC.Consts.classes.LOADING)};if(e.state&&e.state.vw3){if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12){e.toast(TC.Util.getLocaleString(e.options.locale,"threed.not.supported"),{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});t()}else if(!e.div.classList.contains(TC.Consts.classes.THREED)){e.div.classList.add(TC.Consts.classes.THREED);TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:e,state:e.state.vw3,callback:function(){t();e.getControlsByClass(TC.control.ThreeD)[0].button.removeAttribute("disabled")}})})}}else t()}};if(e.baseLayer)t();else{var n=[];e.state&&e.state.base&&(n=TC.Cfg.availableBaseLayers.filter(function(t){return t.id===e.state.base}));if(n.length>0){n[0].isBase=!0;e.addLayer(n[0]).then(function(e){t()})}else{const n=e.baseLayers.filter(function(e){return!e.mustReproject}).filter(function(e){return e.wrap&&e.wrap.layer});if(n.length>0){e.wrap.setBaseLayer(n[0].wrap.layer);e.baseLayer=n[0]}t()}}}}};if(!TC.ready){TC.Cfg=$.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(t&&t.controls&&t.controls.search&&t.controls.search.allowedSearchTypes)for(var d in TC.Cfg.controls.search.allowedSearchTypes)t.controls.search.allowedSearchTypes.hasOwnProperty(d)||(t.controls.search.allowedSearchTypes[d]=!1);t=t||{};h.call(n,t);var f=function(){TC.loadJS(n.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){n.options.stateful&&(n.state=n.checkLocation());n.options.layout&&n.trigger(TC.Consts.event.LAYOUTLOAD,{map:n});t&&void 0!==t.workLayers&&(n.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(n.options.baseLayers=t.baseLayers);if(n.options.zoomToFeatures){n.on(TC.Consts.event.FEATURESADD,function e(t){clearTimeout(n._zoomToFeaturesTimeout);n._zoomToFeaturesTimeout=setTimeout(function(){n.zoomToFeatures(t.layer.features,{animate:!1});n.off(TC.Consts.event.FEATURESADD,e)},100)})}n.on(TC.Consts.event.LAYERADD,function e(t){if(t.layer.isBase&&(t.layer===n.baseLayer||n.baseLayer&&t.layer.fallbackLayer&&t.layer.fallbackLayer.id===n.baseLayer.id)){void 0!==n.state&&(n.state.crs?n.loaded(function(){n.setProjection({crs:n.state.crs,extent:n.state.ext})}):n.setExtent(n.state.ext,{animate:!1}));n.off(TC.Consts.event.LAYERADD,e)}});n.crs=n.options.crs;n.initialExtent=n.options.initialExtent;n.maxExtent=n.options.maxExtent;Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12&&n.options.warningIE&&function(){const e=TC.isDebug?TC.apiLocation+"TC/templates/WarningIE.html":function(){dust.register("warningIE",e);function e(e,t){return e.w('<div class="tc-warningIE"><span>').h("i18n",t,{},{$key:"warningIE"}).w('</span><button class="tc-button tc-hidden" title="').h("i18n",t,{},{$key:"warningIEContinue"}).w('">').h("i18n",t,{},{$key:"warningIEContinue"}).w("</button></div>")}e.__dustBody=!0;return e};TC.Util.getRenderedHtml("warningIE",e,null,function(e){var t=document.createElement("template");t.innerHTML=e.trim();n.div.appendChild(t.content?t.content.firstChild:t.firstChild);n.loaded(function(){const e=document.querySelector(".tc-warningIE > button");e.classList.remove(TC.Consts.classes.HIDDEN);const t=function(r){e.removeEventListener("click",t);n.div.removeChild(document.querySelector(".tc-warningIE"));n.div.classList.remove(TC.Consts.classes.LOADING)};e.addEventListener("click",t)})})}();n.wrap=new TC.wrap.Map(n);TC.loadJS(!(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ]),[TC.url.proj4js],function(){TC.loadJSInOrder(!(TC.isLegacy?window[TC.Consts.OLNS_LEGACY]:window[TC.Consts.OLNS]),[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:n.options.crs,callback:function(){n.wrap.setMap();const e=[];for(var t in n.options.controls){var r=n.options.controls[t];if(r){"string"==typeof(r="boolean"==typeof r?{}:$.extend(!0,{},r)).div&&(r.div=n.div.querySelector("#"+r.div)||r.div);e.push(n.addControl(t,r))}}n.on(TC.Consts.event.BEFORELAYERUPDATE,y);n.on(TC.Consts.event.LAYERUPDATE,m);var i,s;for(i=0;i<n.options.baseLayers.length;i++){"string"==typeof(s=n.options.baseLayers[i])&&(s=l.call(n,s));n.addLayer($.extend({},s,{isBase:!0,map:n}))}var o=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};n.options.workLayers.map(function(e){return $.extend({},e,{map:n})}).filter(function(e){return!n.state||!n.state.layers||!n.state.layers.some(function(t){const n=t.u===e.url&&e.layerNames.indexOf(t.n)>=0;n&&(t.id=e.id);return n})}).forEach(function(e){n.addLayer(e).then(o)});n.state&&n.state.layers&&n.state.layers.forEach(function(e){n.addLayer({id:e.id||TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:e.n?e.n.split(","):"",unremovable:e.ur,title:e.t,renderOptions:{opacity:e.o,hide:!e.v}}).then(function(t){t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)});var n=t.wrap.getRootLayerNode();t.title=e.t||n.Title||n.title;this.o<1&&t.setOpacity(this.o);this.v||t.setVisibility(this.v)}.bind(e))});Promise.all(e).then(function(){n.isReady=!0;n.trigger(TC.Consts.event.MAPREADY)});C(n.div)}})})});n.on(TC.Consts.event.FEATURECLICK,function(e){n.activeControl&&n.activeControl.isExclusive()||(n.on3DView?e.feature.showResultsPanel():e.feature.showPopup())});n.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;for(var t=!0,r=0,i=n.workLayers.length;r<i;r++)if(!n.workLayers[r]._noFeatureClicked){t=!1;break}if(t){n.workLayers.forEach(function(e){delete e._noFeatureClicked});n.getControlsByClass(TC.control.Popup).forEach(function(e){e.hide()})}})})};p.getMapState=function(e){var t=s.call(this,e);return TC.Util.utf8ToBase64(t)};p.getPreviousMapState=function(){return r};p.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(r){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(e){TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValidForIE"),TC.Consts.msgErrorMode.TOAST);if(t){var r=!1;if(!t.hasOwnProperty("ext")){r=!0;t.ext=n.options.initialExtent}if(!t.hasOwnProperty("base")){r=!0;t.base=n.options.defaultBaseLayer}if(t.hasOwnProperty("layers"))for(var i=t.layers.length-1;i>=0;i--)if(t.layers[i]&&t.layers[i].hasOwnProperty("u")&&t.layers[i].hasOwnProperty("n")){if(!t.layers[i].hasOwnProperty("o")||!t.layers[i].hasOwnProperty("v")||!t.layers[i].hasOwnProperty("h")){r=!0;jQuery.extend(t.layers[i],{o:t.layers[i].o||1,v:t.layers[i].v||!0,h:t.layers[i].h||!1})}}else{r=!0;t.layers.length=t.layers.length-1}else{r=!0;t.layers=[]}t.hasOwnProperty("vw3")&&(t.vw3?(!t.vw3.cp||t.vw3.cp&&3!=t.vw3.cp.length||!t.vw3.chpr||t.vw3.chpr&&3!=t.vw3.chpr.length||!t.vw3.bcpd)&&(r=!0):r=!0);r&&TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return t}TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var y=function(e){if(u<=0){u=0;n.trigger(TC.Consts.event.BEFOREUPDATE)}u+=1},m=function(e){if((u-=1)<=0){u=0;n.trigger(TC.Consts.event.UPDATE)}};const g=function(e){var t={};return new Promise(function(n,r){if("string"==typeof e){var i=e,s=/^(https?:)?\/\//i.test(i);const r=function(e,t,n){return new Promise(function(r,l){var c=[i+"/"+n,a+i+"/"+n,a+"layout/responsive/"+n];s&&c.unshift(i+"/"+n);!function n(i){(s=c[i],a=t,new Promise(function(e,t){TC.ajax({method:"HEAD",url:s}).then(function(t){e({resource:a,found:!0,url:s})}).catch(function(t){e({resource:a,found:404!==t.status,url:s})})})).then(function(t){t.found?r(o(e,t)):i===c.length-1?r(e):n(++i)});var s,a}(0)})};var o=function(e,t){if(!(t.resource in e)){var n=t.found?t.url:a+i+"/"+l[t.resource];e[t.resource]=n}return e},a=TC.apiLocation+"TC/",l={script:"script.js",style:"style.css",markup:"markup.html",config:"config.json",i18n:"resources"};Object.keys(l).length;Promise.all(Object.keys(l).map(function(e){return r(t,e,l[e])})).then(function(){n(t)})}else n(e)})};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,n){var r;if(e)r=new Promise(function(e,r){TC.ajax({url:t+n+".json",method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(t){TC.i18n[n]=TC.i18n[n]||{};$.extend(TC.i18n[n],t);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(n,TC.i18n[n]);e()})}).catch(function(e){r(e instanceof Error?e:Error(e))})});else{dust.i18n.add(n,TC.i18n[n]);r=Promise.resolve()}return r};var v=[],T=n.options.locale;v.push(new Promise(function(e,t){TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(T){dust.i18n.setLanguages([T]);v.push(TC.i18n.loadResources(!TC.i18n[T],TC.apiLocation+"TC/resources/",T))}e()})}));Promise.all(v).finally(function(){const e=TC.Util.getParameterByName(TC.Cfg.layoutURLParamName)||n.options.layout;e?g(e).then(function(e){n.trigger(TC.Consts.event.BEFORELAYOUTLOAD,{map:n});var r;"string"==typeof e?r={href:$.trim(e)}:(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("ie8Style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(r=$.extend({},e));if(r.href)r.href+=r.href.match(/\/$/)?"":"/";else for(var i in r){const e=r[i];if(e){r.href=e.substr(0,e.lastIndexOf("/")+1);break}}r.config=r.config||r.href+"config.json";r.markup=r.markup||r.href+"markup.html";r.style=r.style||r.href+"style.css";r.ie8Style=r.ie8Style||r.href+"ie8.css";r.script=r.script||r.href+"script.js";r.i18n=r.i18n||r.href+"resources";r.i18n&&(r.i18n+=r.i18n.match(/\/$/)?"":"/");n.layout=r;const s=[],o=new Promise(function(e,i){if(r.config){const i=TC.ajax({url:r.config,method:"GET",responseType:TC.Consts.mimeType.JSON});i.then(function(r){e(r.i18n);h.call(n,r,t)}).catch(function(t){TC.error(t);e(!1)});s.push(i)}else e(!1)});s.push(o);if(r.style){n.div.classList.add("tc-lo");TC.loadCSS(r.style)}!Modernizr.canvas&&r.ie8Style&&TC.loadCSS(r.ie8Style);r.markup&&s.push(new Promise(function(e,t){TC.ajax({url:r.markup,method:"GET",responseType:"text"}).then(function(t){o.then(function(i){if(i&&T)TC.i18n.loadResources(!0,r.i18n,T).finally(function(){t=t.replace(/(?:\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\})/g,function(e,t,n){return TC.Util.getLocaleString(T,t||n)});n.div.lastElementChild?n.div.lastElementChild.insertAdjacentHTML("afterend",t):n.div.innerHTML=t;e()});else{n.div.lastElementChild?n.div.lastElementChild.insertAdjacentHTML("afterend",t):n.div.innerHTML=t;e()}})}).catch(function(e){t(Error(e))})}));Promise.all(s).finally(function(){TC.loadJS(r.script,r.script,function(){C(n.div);f()})})}):f()});n.on(TC.Consts.event.UPDATEPARAMS,function(e){c(e.layer)});n.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<n.workLayers.length;e++)c(n.workLayers[e])});var L=TC.error;TC.error=function(e,t,r){TC.isDebug&&console.trace&&console.trace();if(t){var i=function(e,t,r){switch(t){case TC.Consts.msgErrorMode.TOAST:if(!n.toast){console.warn("No existe el objeto Toast");return}n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(r?{msg:r,errorMsg:e}:e,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(e)}};if($.isArray(t))for(var s=0;s<t.length;s++)i(e,t[s],r);else i(e,t,r)}else{L(e);n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};TC.Map._instances=[];TC.Map.get=function(e){for(var t=0,n=TC.Map._instances.length;t<n;t++){const n=TC.Map._instances[t];if(n.div===e)return n}};TC.inherit(TC.Map,TC.EventTarget);var c=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},u=function(e,t){var n=$.map(e,function(e){var n={};e&&(n[t]=e[t]);return n});"availableBaseLayers"===t&&console.log("layerOptions",n);var r={};r[t]=TC.Cfg[t];n.unshift(r);if("baseLayers"===t&&n[1].baseLayers){r=n[1];for(var i=0;i<r.baseLayers.length;i++)"object"==typeof r.baseLayers[i]&&$.extend(r.baseLayers[i],l.call(this,r.baseLayers[i].id))}else{n.unshift(!0);r=$.extend.apply(this,n);"availableBaseLayers"===t&&console.log("layerOption",r)}return r[t]};var h=function(){const e=this.options=$.extend.apply(this,$.merge([!0,{},TC.Cfg],arguments));e.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(e){return e.availableBaseLayers||[]}));e.baseLayers=u.call(this,arguments,"baseLayers");e.workLayers=u.call(this,arguments,"workLayers");Array.prototype.slice.call(arguments).filter(function(e){return e.controls}).map(function(e){return e.controls}).length>0&&(e.controls=function(e){e.controlContainer&&Object.keys(e).filter(function(t){return Object.keys(e.controlContainer.controls).indexOf(t)>-1}).forEach(function(t){delete e[t]});return e}(e.controls));return e},p=TC.Map.prototype,d=function(e,t){var n,r='Layer "'+t.title+'" ("'+t.names+'"): ';n=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";r+=TC.Util.getLocaleString(e.options.locale,n);TC.error(r);e.trigger(TC.Consts.event.LAYERERROR,{layer:t,reason:n})};p.getCRS=function(){const e=this;return e.on3DView?e.view3D.crs:e.crs};p.addLayer=function(e,t){const n=this,r=new Promise(function(t,r){const s=v(e);"object"!=typeof e||e.id||(e.id=TC.getUID());n._layerBuffer.add(e.id||e,s,e.isBase);var o,a,c;if(s){a=!TC.layer||!TC.layer.Raster;c=TC.apiLocation+"TC/layer/Raster"}else{a=!TC.layer||!TC.layer.Vector;c=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(a,[c],function(){if("string"==typeof e)o=new TC.layer.Raster($.extend({},l.call(n,e),{map:n}));else if(e instanceof TC.Layer)(o=e).map=n;else{e.map=n;o=e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e)}Promise.all([n.wrap.getMap(),o.wrap.getLayer()]).then(function(){n.trigger(TC.Consts.event.BEFORELAYERADD,{layer:o});var s;v(o)&&(s=n.wrap.indexOfFirstVector());-1===s&&(s=n.wrap.getLayerCount());const a=n.state&&n.state.crs?n.state.crs:n.getCRS(),l=o.isCompatible(a);if(o.isBase){if(!l)if(!o.type===TC.Consts.layerType.WMTS)o.mustReproject=!0;else{const e=o.wrap.getCompatibleMatrixSets(a)[0];e?o.wrap.setMatrixSet(e):o.mustReproject=!0}n.state?o.isDefault=n.state.base===o.id||n.state.base===o.options.fallbackLayer:"string"==typeof n.options.defaultBaseLayer?o.isDefault=n.options.defaultBaseLayer===o.id:"number"==typeof n.options.defaultBaseLayer&&(o.isDefault=n.options.defaultBaseLayer===n.baseLayers.length);if(o.isDefault){var c;if(o.mustReproject&&!o.type===TC.Consts.layerType.WMTS||o.mustReproject&&o.type===TC.Consts.layerType.WMTS&&!o.wrap.getCompatibleMatrixSets(a)[0])if(o.options.fallbackLayer&&o.getFallbackLayer)n.addLayer(o.getFallbackLayer()).then(function(e){n.wrap.setBaseLayer(e.wrap.layer);n.baseLayer=e.wrap.parent;i(c);t(o)});else{d(n,o);r(e)}else{c=null===n.baseLayer;o.wrap.getLayer().then(function(e){n.wrap.setBaseLayer(e);n.baseLayer=o;i(c);t(o)})}}else t(o)}else if(l)o.wrap.getLayer().then(function(e){t(o)});else{d(n,o);r(e)}},function(t){r(e)})})});r.then(function(e){n._layerBuffer.resolve(n,e,e.isBase);e.isBase||n.wrap.insertLayer(e.wrap.layer,n._layerBuffer.getResolvedVisibleLayerIndex(n,e.id));n.trigger(TC.Consts.event.LAYERADD,{layer:e});n._layerBuffer.checkMapLoad(n);$.isFunction(t)&&t(e)}).catch(function(e){n._layerBuffer.reject(n,e,e.isBase);n._layerBuffer.checkMapLoad(n)});const i=function(e){if(e){var t={projection:n.wrap.map.getView().getProjection(),extent:n.initialExtent},r=n.baseLayer.getResolutions();if(r&&r.length)t.resolutions=r;else{t.minZoom=n.wrap.map.getView().getMinZoom();t.maxZoom=n.wrap.map.getView().getMaxZoom();var i=n.baseLayer.wrap.layer.getMinResolution();0!==i&&(t.minResolution=i);var s=n.baseLayer.wrap.layer.getMaxResolution();s!==Number.POSITIVE_INFINITY&&(t.maxResolution=s)}n.wrap.map.setView(new ol.View(t));n.wrap.map.getView().fit(n.initialExtent)}};return r};p.removeLayer=function(e){const t=this;return new Promise(function(n,r){if(e.unremovable)return r("Unremovable");e.wrap.getLayer().then(function(r){for(var i=0;i<t.layers.length;i++)t.layers[i]===e&&t.layers.splice(i,1);if(e.isBase){for(i=0;i<t.baseLayers.length;i++)if(t.baseLayers[i]===e){t.baseLayers.splice(i,1);t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(i=0;i<t.workLayers.length;i++)if(t.workLayers[i]===e){t.workLayers.splice(i,1);break}e===t.vectors&&(t.vectors=null)}t.wrap.removeLayer(r);t._layerBuffer.remove(e.id);t.trigger(TC.Consts.event.LAYERREMOVE,{layer:e});t._layerBuffer.checkMapLoad(t);n(e)})})};p.insertLayer=function(e,t,n){for(var r=this,i=-1,s=0;s<r.layers.length;s++)if(e===r.layers[s]){i=s;break}var o=[];o.push(e.wrap.getLayer());var a=r.layers[t];a&&o.push(a.wrap.getLayer());Promise.all(o).then(function(s){const o=s[0],a=s[1];var l=-1;if((l=a?r.wrap.getLayerIndex(a):r.wrap.getLayerCount())>=0){e.map=r;r.wrap.insertLayer(o,l);i>-1&&r.layers.splice(i,1);r.layers.splice(t,0,e);r.workLayers=r.layers.filter(function(e){return!e.isBase});r.trigger(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t})}$.isFunction(n)&&n()})};p.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.layer,t)};p.putLayerOnTop=function(e){var t=this.wrap.getLayerCount();this.setLayerIndex(e,t-1)};p.setBaseLayer=function(e,t){var n=this,r=null,i=!1;if("string"==typeof e){var s;for(s=0;s<n.layers.length;s++)if(n.layers[s].id===e){e=n.layers[s];i=!0;break}if(!i&&(e=l.call(n,e))){e=n.addLayer($.extend(!0,{},e,{isDefault:!0,map:n}));i=!0}}else{if($.inArray(e,n.layers)<0){e.isDefault=!0;e.map=n;n.addLayer(e)}i=!0}if(i)if(e.isCompatible(n.getCRS())||e.fallbackLayer&&(!e.fallbackLayer||e.fallbackLayer.isCompatible(n.getCRS()))){n.trigger(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:n.getBaseLayer(),newLayer:e});r=e;n.wrap.getMap().then(function(r){e.wrap.getLayer().then(function(r){n.wrap.setBaseLayer(r).then(function(){n.baseLayer=e;n.trigger(TC.Consts.event.BASELAYERCHANGE,{layer:e});$.isFunction(t)&&t()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return r};p.setView=function(e){this.view=e;this.trigger(TC.Consts.event.VIEWCHANGE,{view:e})};p.ready=function(e){$.isFunction(e)&&(this.isReady?e():this.one(TC.Consts.event.MAPREADY,e))};p.loaded=function(e){$.isFunction(e)&&(this.isLoaded?e():this.one(TC.Consts.event.MAPLOAD,e))};p.getLayerTree=function(){var e={baseLayers:[],workLayers:[]};this.baseLayer&&(e.baseLayers[0]=this.baseLayer.getTree());for(var t=0;t<this.workLayers.length;t++){var n=this.workLayers[t].getTree();n&&e.workLayers.unshift(n)}return e};p.addControl=function(e,t){const n=this;return new Promise(function(r,i){const s=function(e){n.controls.push(e);return Promise.resolve(e.register(n)).then(function(t){e.div.parentElement||n.div.appendChild(e.div);n.trigger(TC.Consts.event.CONTROLADD,{control:e});return t}).catch(function(e){i(e instanceof Error?e:Error(e))})};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e],function(){s(new TC.control[e](null,t)).then(function(e){r(e)})})}else s(e).then(function(e){r(e)})})};p.getControlsByClass=function(e){var t=[],n=e;if("string"==typeof e){n=window;for(var r=e.split("."),i=0;i<r.length&&(n=n[r[i]]);i++);}if($.isFunction(n))for(i=0;i<this.controls.length;i++){var s=this.controls[i];s instanceof n&&t.push(s)}return t};p.getControlById=function(e){const t=this;for(var n=0,r=t.controls.length;n<r;n++){const r=t.controls[n];if(r.id===e)return r}return null};p.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null};p.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};p.setExtent=function(e,t){return this.wrap.setExtent(e,t)};p.getExtent=function(){return this.wrap.getExtent()};p.setCenter=function(e,t){return this.wrap.setCenter(e,t)};p.getCenter=function(){return this.wrap.getCenter()};p.setRotation=function(e){this.wrap.setRotation(e)};p.getRotation=function(){return this.wrap.getRotation()};p.getViewHTML=function(){return this.wrap.getViewport()};p.getCompatibleCRS=function(e){const t=((e=e||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(e){return e.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})}),n=t.slice(1);return t[0].filter(function(e){return n.every(function(t){return t.indexOf(e)>=0})})};p.loadProjections=function(e){e=e||{};return new Promise(function(t,n){const r=e.crsList||[];Promise.all(r.map(function(e){return TC.getProjectionData({crs:TC.Util.getCRSCode(e)})})).then(function(n){var r=n.filter(function(e){return"ok"===e.status&&e.number_result>0}).map(function(e){const t=e.results[0],n="EPSG:"+t.code;TC.loadProjDef({crs:n,def:t.def,name:t.name});return{code:n,name:t.name,proj4:t.proj4,unit:t.unit}});e.orderBy&&(r=r.sort(TC.Util.getSorterByProperty(e.orderBy)));t(r)},function(e){n(e)})})};p.setProjection=function(e){const t=this;e=e||{};return new Promise(function(n,r){var i;if(e.crs){e.baseLayer?i=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(i=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(i=t.baseLayer.getFallbackLayer()));i||(i=t.baseLayer);const s=function(){TC.loadProjDef({crs:e.crs,callback:function(){const s=function(i){const o=function(){const o=$.extend({},e,{oldCrs:t.crs}),a=function(e){e.setProjection(o)};if(i.isCompatible(e.crs)||i.wrap.getCompatibleMatrixSets(e.crs).length>0){i.setProjection(o);t.wrap.setProjection($.extend({},e,{baseLayer:i}));t.crs=e.crs;t.baseLayers.filter(function(e){return e!==i}).forEach(a);t.workLayers.forEach(a);const r=function(){t.trigger(TC.Consts.event.PROJECTIONCHANGE,{crs:e.crs});n()};i&&i!==t.baseLayer?t.setBaseLayer(i,r):r()}else i.fallbackLayer?s(i.fallbackLayer):r()};i.type===TC.Consts.layerType.WMS||i.type===TC.Consts.layerType.WTMS?i.getCapabilitiesPromise().then(o):o()};s(i)}})};t.baseLayers.indexOf(i)<0?t.addLayer(i).then(s):s()}})};p.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};p.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};p.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};p.zoomToFeatures=function(e,t){if(e.length>0){var n=[1/0,1/0,-1/0,-1/0],r=t||{},i=r.pointBoundsRadius||this.options.pointBoundsRadius;i/=this.getMetersPerUnit();var s=r.extentMargin;"number"!=typeof s&&(s=this.options.extentMargin);for(var o=0;o<e.length;o++){var a=e[o].getBounds();if(a){n[0]=Math.min(n[0],a[0]);n[1]=Math.min(n[1],a[1]);n[2]=Math.max(n[2],a[2]);n[3]=Math.max(n[3],a[3])}}if(n[2]-n[0]==0){n[0]=n[0]-i;n[2]=n[2]+i}if(n[3]-n[1]==0){n[1]=n[1]-i;n[3]=n[3]+i}if(this.options.extentMargin){var l=(n[2]-n[0])*s/2,c=(n[3]-n[1])*s/2;n[0]=n[0]-l;n[1]=n[1]-c;n[2]=n[2]+l;n[3]=n[3]+c}if(this.options.maxExtent){n[0]=Math.max(n[0],this.options.maxExtent[0]);n[1]=Math.max(n[1],this.options.maxExtent[1]);n[2]=Math.min(n[2],this.options.maxExtent[2]);n[3]=Math.min(n[3],this.options.maxExtent[3])}this.wrap.setExtent(n,r);this.trigger(TC.Consts.event.ZOOMTO,{extent:n})}};p.zoomToMarkers=function(e){var t=this;Promise.all(t._markerPromises).then(function(){for(var n=[],r=0;r<t.workLayers.length;r++){var i=t.workLayers[r];if(i.type===TC.Consts.layerType.VECTOR)for(var s=0;s<i.features.length;s++){var o=i.features[s];o instanceof TC.feature.Marker&&(n[n.length]=o)}}t.zoomToFeatures(n,e);t._markerPromises=[]})};p.getLayer=function(e){var t=null;if("string"==typeof e){for(var n=0;n<this.layers.length;n++)if(this.layers[n].id===e){t=this.layers[n];break}}else TC.Layer&&e instanceof TC.Layer&&(t=e);return t};var f=function(e){var t;if(e.vectors)t=Promise.resolve(e.vectors);else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;t.then(function(t){e.vectors=t})}return t};p.addPoint=function(e,t){if(t&&t.layer){var n=this.getLayer(t.layer);n&&n.addPoint(e,t)}else f(this).then(function(n){n.addPoint(e,t)})};p.addMarker=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r&&n._markerPromises.push(r.addMarker(e,t))}else n._markerPromises.push(new Promise(function(r,i){f(n).then(function(n){n.addMarker(e,t).then(function(e){r(e)})})}))};p.addPolyline=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolyline(e,t)}else f(this).then(function(n){n.addPolyline(e,t)})};p.addPolygon=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolygon(e,t)}else f(this).then(function(n){n.addPolygon(e,t)})};p.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};p.getResolutions=function(){return this.wrap.getResolutions()};p.getResolution=function(){return this.wrap.getResolution()};p.setResolution=function(e){this.wrap.setResolution(e)};p.exportFeatures=function(e,t){t=t||{};var n=this.getLoadingIndicator(),r=n&&n.addWait();const i=t.format===TC.Consts.format.GPX?Number.NaN:0;e.forEach(function(t,n){var r=t.getCoords({pointArray:!0});if(r.some(function(e){return null===e[2]})){e[n]=t=t.clone();(r=t.getCoords({pointArray:!0})).forEach(function(e){null===e[2]&&(e[2]=i)})}});const s=this.wrap.exportFeatures(e,t),o=TC.Consts.mimeType[t.format],a=t.format||"";TC.Util.downloadFile((t.fileName||TC.getUID())+"."+a.toLowerCase(),o,s);n&&n.removeWait(r)};var y={},m=function(){const e=this;var t=e;do{t=t.parentElement}while(t&&!t.matches(".tc-toast-container"));const n=e.innerHTML;e.classList.add(TC.Consts.classes.HIDDEN);void 0!==y[n]&&(y[n]=void 0);setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e);t&&!t.querySelector(".tc-toast")&&t.parentElement&&t.parentElement.removeChild(t)},1e3)};p.toastHide=function(e){var t=y[e];if(t){clearTimeout(t.timeout);t.toast&&t.toast.parentElement&&t.toast.parentElement.removeChild(t.toast);t.toast=null}};p.toast=function(e,t){const n=this;var r=t||{},i=r.duration||TC.Cfg.toastDuration,s=y[e];if(s){clearTimeout(s.timeout);s.toast&&s.toast.parentElement&&s.toast.parentElement.removeChild(s.toast);s.toast=null}var o=n.div.querySelector(".tc-toast-container");if(!o){(o=document.createElement("div")).classList.add("tc-toast-container");(r.container?r.container:n.div).appendChild(o)}const a=document.createElement("div"),l=document.createElement("span");a.classList.add("tc-toast");a.appendChild(l);const c=document.createElement("p");c.innerHTML=e;a.appendChild(c);a.addEventListener(TC.Consts.event.CLICK,m);o.appendChild(a);s=y[e]={toast:a};var u="";switch(r.type){case TC.Consts.msgType.INFO:u=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:u=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:u=TC.Consts.classes.ERROR}u.length&&s.toast.classList.add(u);s.timeout=setTimeout(function(){m.call(s.toast)},i)};var g=!1,C=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.getBoundingClientRect.height===t+(Modernizr.mq("only screen and (orientation : landscape)")?20:0)&&(g=!0)}var n=function(){Modernizr.mq("only screen and (orientation : landscape)")?e.classList.add(TC.Consts.classes.IPAD_IOS7_FIX):e.classList.remove(TC.Consts.classes.IPAD_IOS7_FIX)};if(g){n();window.addEventListener("resize",n)}else window.removeEventListener("resize",n)},v=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS};p.exportImage=function(){var e=null,t="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",n=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(n&&this.options.crossOrigin)try{e=n.toDataURL()}catch(e){TC.error(t+": "+e.message)}else TC.error(t);return e}}();var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,n){return codes[e]}).filter(function(e,t,n){return 0===t?e!==codes[f]:e!==n[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,n){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var r=e.apply(this,arguments);r=r.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1"));return r};var t={},s={},o=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],a=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(e,t,n){return n<t.length-1?e.hasOwnProperty(t[n])?l(e[t[n]],t,++n):null:e[t[n]]};const c=new WeakMap,u=new WeakMap;var h={isPlainObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isFunction:function(e){return"function"==typeof e},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],n=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[n])return e}else for(var r in TC.capabilities)if(r.replace(TC.Util.regex.PROTOCOL,"")==n)return r;for(r in TC.capabilities){var i=l(TC.capabilities[r],o,0)||l(TC.capabilities[r],a,0);if(i&&t&&e==i)return i;if(i&&e.replace(TC.Util.regex.PROTOCOL,"")==i.replace(TC.Util.regex.PROTOCOL,""))return i}return e},reqGetMapOnCapabilities:function(e){var t,n,r=2!=arguments.length||arguments[1];r||e.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(n=l(t,o,0)||l(t,a,0))?r?n.split("?")[0]:n.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(e){var t=window,n=e.split(".");for(i=0;i<n.length-1;i++)if(void 0==(t=t[n[i]]))return;return t[n[n.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(n){var r=window.location,i=n[1];t=(i==r.protocol||void 0==i)&&n[3]==r.hostname;var s=n[4],o=r.port;(80!=s&&""!==s||"80"!=o&&""!==o)&&(t=t&&s==o)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t);if("string"===r){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var n=document.getElementsByTagName("script");t=n[n.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var n="";if(e)if(void 0!==t[e])n=t[e];else{const i=document.createElement("div");i.style.display="none";i.classList.add(e);document.body.appendChild(i);var r=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(i,null).backgroundImage);r&&r.length>1&&(n=r[r.length-1]);i.parentElement.removeChild(i);t[e]=n}return n},getPointIconUrl:function e(t){var n=null;if(t.url)n=t.url;else{var r;if("string"==typeof t.cssClass)r=t.cssClass;else{var i=t.classes||TC.Cfg.styles.marker.classes;r=i[0];if(t.group){if(void 0===s[t.group]){var o=0;for(var a in s)o++;o%=i.length;s[t.group]=i[o]}r=s[t.group]}}n=TC.Util.getBackgroundUrlFromCss(r)}n||t===TC.Cfg.styles.point||""===t.cssClass||(n=e(TC.Cfg.styles.point));return n},addArrayToTree:function e(t,n,r){var i=null,s=!1,o=t[r=r||0];if(o){for(var a,l=0,c=n.children.length;l<c;l++)if((a=n.children[l]).name===o){s=!0;var u=e(t,a,r+1);u&&(i=u);break}if(!s){a={name:o,title:o,uid:"/"+t.slice(0,r+1).join("/"),children:[]};n.children.push(a);i=a}}return i},parseCoords:function(e){var t=null,n=function(e){var t=e,n={};n.type=TC.Consts.GEOGRAPHIC;var r=t.indexOf("\xb0");n.value=parseFloat(t.substr(0,r));if((r=(t=t.substr(r+1)).indexOf("'"))>=0){var i=parseFloat(t.substr(0,r))/60;n.value>=0?n.value+=i:n.value-=i;if((r=(t=t.substr(r+1)).indexOf("'"))>=0){i=parseFloat(t.substr(0,r).replace(",","."))/3600;n.value>=0?n.value+=i:n.value-=i}}return n},r=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return n(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return n(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var r={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(r.value=-r.value);return r}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},i=(e=$.trim(e).toUpperCase()).split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:1!==i.length&&3!==i.length||(i=e.split(" "));if(2===i.length){var s=r(i[0]),o=r(i[1]);null!==s&&null!==o&&(t=[s,o])}return t},reproject:function(e,t,n){var r,i=!0,s=!0,o=!0;if($.isArray(e[0]))if($.isArray(e[0][0])){if(!$.isArray(e[0][0][0])){o=!1;e=[e]}}else{s=!1;e=[[e]]}else{i=!1;s=!1;o=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:n,sync:!0});var a=new Proj4js.Proj(t),l=new Proj4js.Proj(n);r=new Array(e.length);e.forEach(function(e,t){const n=r[t]=[];e.forEach(function(e,t){const r=n[t]=[];e.forEach(function(e,t){var n=Proj4js.transform(a,l,{x:e[0],y:e[1]});r[t]=[n.x,n.y];e.length>2&&(r[t][2]=e[2])})})});i?s?o||(r=r[0]):r=r[0][0]:r=r[0][0][0];return r},getMetersPerDegree:function(e){var t=void 0;if($.isArray(e)&&e.length>=4){var n=this.degToRad(e[3]-e[1]),r=Math.sin(n/2),i=r*r;t=6370997*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var n=e.trim().match(/^.+[:#](\d{4,6})$/);n&&(t=n[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var n=this.getCRSCode(e),r=this.getCRSCode(t);return null!==n&&null!==r&&n===r},getLocaleString:function(e,t,n){var r=t;if(TC.i18n&&TC.i18n[e]){var i=TC.i18n[e][t];if(i){r=i;if(n)for(var s in n)r=r.replace("{"+s+"}",n[s])}}return r},getSimpleMimeType:function(e){var t="";if(e){var n=e.indexOf(";");n>0&&(e=e.substring(0,n));t=e}return t},getQueryStringParams:function(e){var t;if(e){var n=e.indexOf("?");if(n>=0){var r=(t=e.substr(n)).indexOf("#");r>=0&&(t=t.substr(0,r))}else t="?"}else t=location.search;var i=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete i[""];return i},getParamString:function(e){const t=[];for(var n in e)t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]);return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var n=e.length;n;){e[n]=e[n-1];n--}e[0]=t},storage:{getCookie:function(e){return TC.cookie(e)},setCookie:function(e,t,n){return TC.cookie(e,t,n)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){return!!function(){var e,t="(hover: hover)",n=!Modernizr.touch;"matchMedia"in window?(e=window.matchMedia(t)).media===t&&(n=e.matches):console.log("no dispone de matchMedia");return n}()}return!(Modernizr.mq("(pointer:coarse)")||!Modernizr.mq("(pointer:fine)"))||!Modernizr.mq("(pointer:none)")&&(!Modernizr.touch||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var n=t.indexOf(":"),r=t.substr(n+1),i=e.getElementsByTagNameNS("*",r),s=0;s<i.length;s++)if(i[s].nodeName==t)return i},addURLParameters:function(e,t){if(!t)return e;var n=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),r=e.split("?");if(r.length>=2){var i=r[1].split(/[&;]/g);i.push(n);return e=r[0]+"?"+i.join("&")}if((r=e.split("#")).length>=2){r.shift();return e=r[0]+"?"+n+"#"+r.join("#")}return e=e+"?"+n},removeURLParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var r=encodeURIComponent(t.toLowerCase())+"=",i=n[1].toLowerCase().split(/[&;]/g),s=i.length;s-- >0;)-1!==i[s].lastIndexOf(r,0)&&i.splice(s,1);return e=n[0]+"?"+i.join("&")}return e},showModal:function(e,t){t=t||{};e.hidden=!1;$(e).fadeIn(250,function(){window.$&&e instanceof $&&(e=e.get(0));const n=e.querySelectorAll(".tc-modal-close");if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=u.get(n[r]);if(i)u.delete(n[r]);else{i=function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,e.target)};u.set(n[r],i)}u.set(n[r],i);n[r].addEventListener("click",i);$.isFunction(t.openCallback)&&t.openCallback()}})},closeModal:function(e,t){const n=function(e){e.style.display="none";e.querySelector(".tc-modal-window").removeAttribute("style")};var r;if(t){r=t;for(;r&&!r.matches(".tc-modal");)r=r.parentElement;n(r)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(e){n(e)});e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t){const n=function(t){e.addEventListener("mousedown",t.start);e.addEventListener("touchstart",t.start);e.addEventListener("mouseup",t.end);e.addEventListener("touchend",t.end)};if("disable"===t){const t=c.get(e);if(t){e.removeEventListener("mousedown",t.start);e.removeEventListener("touchstart",t.start);e.removeEventListener("mouseup",t.end);e.removeEventListener("touchend",t.end)}return}if("enable"===t){const t=c.get(e);t&&n(t);return}const r=(t=t||{}).minDistance||30,i=t.maxCrossDistance||30,s=t.maxAllowedTime||1e3;var o={x:-1,y:-1},a={x:-1,y:-1},l=0;const u={start:function(n){if(function(n){if(t.noSwipe)for(var r=n.target;r&&r!==e;){if(r.matches&&r.matches(t.noSwipe))return!1;r=r.parentNode}return!0}(n)){n="changedTouches"in n?n.changedTouches[0]:n;o.x=n.pageX;o.y=n.pageY;l=(new Date).getTime()}},end:function(n){if(l){n="changedTouches"in n?n.changedTouches[0]:n;a.x=n.pageX;a.y=n.pageY;if((new Date).getTime()-l<=s){const n=t[function(e,t){const n=t.x-e.x,s=t.y-e.y,o=Math.abs(n),a=Math.abs(s);return o>a&&o>r&&a<=i?n<0?"left":"right":a>o&&a>r&&o<=i?s<0?"up":"down":"none"}(o,a)];n&&n.call(e)}l=0}}};c.set(e,u);n(u)},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en-US",n=(e=e||{}).cookieName||"SITNA.language",r=e.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,s=TC.Util.getParameterByName(r)||TC.Util.storage.getCookie(n)||i,o=s.indexOf("-");o>=0&&(s=s.substr(0,o));var a=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(n,s,{expires:a});switch(s){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[/\\?%*:|"<>]/g,"-")},downloadBlob:function(e,t){var n=document.createElement("a");if(void 0!==n.download){var r=URL.createObjectURL(t);n.setAttribute("href",r);n.setAttribute("download",TC.Util.getValidFilename(e));n.style.visibility="hidden";document.body.appendChild(n);n.click();document.body.removeChild(n)}},downloadFile:function(e,t,n){var r=new Blob([n],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(r,e):TC.Util.downloadBlob(e,r)},downloadDataURI:function(e,t,n){for(var r=atob(n.split(",")[1]),i=[],s=0;s<r.length;s++)i.push(r.charCodeAt(s));var o=new Blob([new Uint8Array(i)],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(o,e):TC.Util.downloadBlob(e,o)},shortenUrl:function(e){return TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}})},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){$.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const n=t.toString(16);return e+"00".substring(0,2-n.length)+n},"#"));return e},operation:function(e,t,n,r){for(var i=[],s=0;s<e.length;s++){for(var o=e[s],a=!1,l=0;l<t.length;l++)if(n(o,t[l])){a=!0;break}a===r&&i.push(o)}return i},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,n){return this.operation(e,t,n,!0)},inFirstOnly:function(e,t,n){return this.operation(e,t,n,!1)},inSecondOnly:function(e,t,n){return this.inFirstOnly(t,e,n)},toDataUrl:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},r=n.type,i=n.encoderOptions,s=e.getContext("2d");if(!s)return"";var o=e.width,a=e.height,l=s.getImageData(0,0,o,a),c=s.globalCompositeOperation;if(t){s.globalCompositeOperation="destination-over";s.fillStyle=t;s.fillRect(0,0,o,a)}var u=e.toDataURL(r,i);if(t){s.clearRect(0,0,o,a);s.putImageData(l,0,0);s.globalCompositeOperation=c}return u},imgToDataUrl:function(e,t){var n=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d");t.height=e.height;t.width=e.width;n.drawImage(e,0,0);return t};return new Promise(function(r,i){var s=new Image;s.crossOrigin="anonymous";s.onload=function(){var i,o=n(s);try{i=TC.Util.toDataUrl(o,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:i,canvas:o})}catch(t){s.src=TC.proxify(e)}};s.onerror=function(o){var a=new XMLHttpRequest;a.open("GET",TC.proxify(e),!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.responseType="arraybuffer";a.onload=function(e){if(200===this.status){for(var i=new Uint8Array(this.response),o=i.length,l=new Array(o);o--;)l[o]=String.fromCharCode(i[o]);var c=l.join(""),u=a.getResponseHeader("content-type");if(0===u.indexOf("image")){s.src="data:"+u+";base64,"+window.btoa(c);s.onload=function(){var e=n(s);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:dataURL,canvas:e})}}}};a.onreadystatechange=function(){4===a.readyState&&200!==a.status&&i()};a.send()};s.src=e;if(s.complete||void 0===s.complete){s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";s.src=e}})},imgTagToDataUrl:function(e,t){var n=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d");t.height=e.height;t.width=e.width;n.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(n,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:n}}catch(e){return null}},addToCanvas:function(e,t,n,r){var i=TC.Util.cloneCanvas(e),s=i.getContext("2d");return new Promise(function(e,o){var a=new Image;t.crossOrigin="anonymous";a.src=t;a.onload=function(){r?s.drawImage(a,n.x||0,n.y||0,r.width,r.height):s.drawImage(a,n.x||0,n.y||0);e(i)}})},cloneCanvas:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width;t.height=e.height;n.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,n,r){var i=Math.min(n/e,r/t);return{width:e*i,height:t*i}},getFormattedDate:function(e,t){function n(e){return e<10?"0"+e:e}var r=new Date(e);return[r.getFullYear(),n(r.getMonth()+1),n(r.getDate())].concat(t?["_",n(r.getHours()),n(r.getMinutes()),n(r.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var n=function(e,t){const n=document.createDocumentFragment();var r=document.createElement("form");r.classList.add("tc-ctl-download-form");r.setAttribute("method","post");r.setAttribute("enctype","text/plain");r.setAttribute("action",!1!==TC.Util.detectIE()&&TC.Util.detectIE()<=11?TC.proxify(e):e);const i=document.createElement("input");i.classList.add("tc-ctl-download-query");i.setAttribute("name",t.substring(0,t.indexOf("=")));r.appendChild(i);n.appendChild(r);const s=document.querySelectorAll("iframe");for(var o,a=0,l=s.length;a<l;a++){const t=s[a];if(t.dataset.downloadUrl===e){o=t;break}}if(!o){(o=document.createElement("iframe")).style.visibility="hidden";o.style.display="none";o.dataset.downloadUrl=e;document.body.appendChild(o)}const c=o.contentDocument;c.open();c.write(r.outerHTML);c.close();c.querySelector("input").value=t.substring(t.indexOf("=")+1);return r=c.querySelector("form")},r=[];if($.isArray(e))for(var i=e,s=0;s<i.length;s++)r.push(n(i[s].url,i[s].data));else r.push(n(e,t));r.forEach(function(e){e.submit()});setTimeout(function(){document.querySelectorAll(".tc-ctl-download-form").forEach(function(e){e.parentElement.removeChild(e)})},1e3)},WFSQueryBuilder:function(e,t,n,r,i){$.isArray(e)||(e=[e]);var s='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(n.version){case"1.0.0":case"1.1.0":s+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":s+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var o in n)"string"==typeof n[o]&&o.indexOf("gml")<0&&n[o].indexOf("wfs")<0&&(s+=o+'="'+n[o]+'" ');var a="<wfs:GetFeature "+s.format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+r+'"'})+">",l="",c="<wfs:Query typeName"+("2.0.0"===n.version?"s":"")+'="{typeName}">{filter}</wfs:Query>';$.each(e,function(e,r){l+=c.format({typeName:r,filter:t?t.getText(n.version):""})});return a+=l+"</wfs:GetFeature>"},WFSFilterBuilder:function(e,t){var n="";if(jQuery.isPlainObject(e))n='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case $.isArray(e):var r="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:n+="<ogc:Filter><ogc:BBOX>"+r+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:n+="<fes:Filter><fes:BBOX>"+r+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:n+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,"2.0")+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:n+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,"3.2")+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return n},writeGMLGeometry:function(e,t){var n=function(e){var n;if(0===t.indexOf("3")){n=e.toString();for(;n.indexOf(",")>=0;)n=n.replace(","," ")}else{n=e;jQuery.each(n,function(e,t){return t.join(",")}).join(" ")}return n};switch(t){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"><gml:posList>'+n(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"><gml:exterior><gml:LinearRing><gml:posList>'+n(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString><gml:coordinates>"+n(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+n(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var n=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!n&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var i=r[1];n=(i==t.protocol||void 0==i)&&r[3]==t.hostname;var s=r[4],o=t.port;(80!=s&&""!==s||"80"!=o&&""!==o)&&(n=n&&s==o)}return n},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var n=/^(https?:\/\/)/i,r=e.match(n);if(r&&r.length>1){var i=t.match(n);if(i&&i.length>1)return r[0].trim()===i[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,n){return t[e]>n[e]?1:t[e]<n[e]?-1:0}},getSoundexDifference:function(e,t){for(var n=0,r=0;r<e.length;r++)e.charAt(r)==t.charAt(r)&&n++;return n},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href},getRenderedHtml:function(e,t,n,r){return new Promise(function(i,s){var o=function(){dust.cache[e]&&dust.render(e,n,function(e,t){if(e){TC.error(e);s(Error(e))}else{$.isFunction(r)&&r(t);i(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])o();else if("string"==typeof t)TC.ajax({url:t,method:"GET",responseType:"text"}).then(function(t){var n=dust.compile(t,e);dust.loadSource(n);o()}).catch(function(e){console.log("Error fetching template: "+e)});else if($.isFunction(t)){t();o()}})})},explodeGeometry:function(e){const t=e.origin,n=function(e,r,i){if($.isArray(e))e.forEach(n);else{0===r&&(i[0]=e+t[0]);1===r&&(i[1]=e+t[1])}};e.geom.forEach(n);return e.geom},cloneMappingFunction:function(e){return $.isArray(e)?e.map(TC.Util.cloneMappingFunction):e},compactGeometry:function(e,t){const n=[Number.MAX_VALUE,Number.MAX_VALUE],r=e.map(TC.Util.cloneMappingFunction),i=function(e,t){$.isArray(e)?e.forEach(i):0===t&&e<n[0]?n[0]=e:1===t&&e<n[1]&&(n[1]=e)};r.forEach(i);const s=function(e){return Math.round(e*t)/t};n[0]=s(n[0]);n[1]=s(n[1]);const o=function(e,t,r){if($.isArray(e))e.forEach(o);else{0===t&&(r[0]=s(e-n[0]));1===t&&(r[1]=s(e-n[1]))}};r.forEach(o);return{origin:n,geom:r}}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};var p=function(e,t,n){return n(e.getBoundingClientRect(),t.getBoundingClientRect())};HTMLElement.prototype.colliding=function(e){return p(this,e,function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)})};HTMLElement.prototype.containing=function(e){p(this,e,function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)})};HTMLElement.prototype.inside=function(e){return p(this,e,function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right})};return h});loadjs=function(){var e=function(){},t={},n={},r={};function i(e,t){if(e){var i=r[e];n[e]=t;if(i)for(;i.length;){i[0](e,t);i.splice(0,1)}}}function s(t,n){t.call&&(t={success:t});n.length?(t.error||e)(n):(t.success||e)(t)}function o(t,n,r,i){var s,a,l=document,c=r.async,u=(r.numRetries||0)+1,h=r.before||e,p=t.replace(/^(css|img)!/,"");i=i||0;if(/(^css!|\.css$)/.test(t)){(a=l.createElement("link")).rel="stylesheet";a.href=p;if((s="hideFocus"in a)&&a.relList){s=0;a.rel="preload";a.as="style"}}else if(/(^img!|\.(png|gif|jpg|svg)$)/.test(t))(a=l.createElement("img")).src=p;else{(a=l.createElement("script")).src=t;a.async=void 0===c||c}a.onload=a.onerror=a.onbeforeload=function(e){var l=e.type[0];if(s)try{a.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((i+=1)<u)return o(t,n,r,i)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";n(t,l,e.defaultPrevented)};!1!==h(t,a)&&l.head.appendChild(a)}function a(e,n,r){var a,l;n&&n.trim&&(a=n);l=(a?r:n)||{};if(a){if(a in t)throw"LoadJS";t[a]=!0}function c(t,n){!function(e,t,n){var r,i,s=(e=e.push?e:[e]).length,a=s,l=[];r=function(e,n,r){"e"==n&&l.push(e);if("b"==n){if(!r)return;l.push(e)}--s||t(l)};for(i=0;i<a;i++)o(e[i],r,n)}(e,function(e){s(l,e);t&&s({success:t,error:n},e);i(a,e)},l)}if(l.returnPromise)return new Promise(c);c()}a.ready=function(e,t){!function(e,t){var i,s,o,a=[],l=(e=e.push?e:[e]).length,c=l;i=function(e,n){n.length&&a.push(e);--c||t(a)};for(;l--;){s=e[l];(o=n[s])?i(s,o):(r[s]=r[s]||[]).push(i)}}(e,function(e){s(t,e)});return a};a.done=function(e){i(e,[])};a.reset=function(){t={};n={};r={}};a.isDefined=function(e){return e in t};return a}();var TC=TC||{};TC.version="1.6.0";!function(){if(!TC.apiLocation){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var n=e.getAttribute("src");TC.apiLocation=n.substr(0,n.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS_LEGACY="OpenLayers";TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ_LEGACY="Proj4js";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,MODERNIZR:"lib/modernizr.js",JQUERY_LEGACY:TC.apiLocation+"lib/jquery/jquery.1.10.2.js",JQUERY:"//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.js",OL_LEGACY:"lib/OpenLayers/OpenLayers.sitna.js",OL:"lib/ol/build/ol-custom.js",OL_CONNECTOR_LEGACY:"TC/ol/ol2.js",OL_CONNECTOR:"TC/ol/ol.js",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",PROJ4JS_LEGACY:"lib/proj4js/legacy/proj4js-compressed.js",PROJ4JS:"lib/proj4js/proj4-src.js",EPSG:"https://epsg.io/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js",UA_PARSER:"lib/ua-parser/ua-parser.min.js",HASH:"lib/jshash/md5-min.js",URL_POLYFILL:"lib/polyfill/url.js",PROMISE_POLYFILL:"lib/polyfill/promise/polyfill.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-threed"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_FR_CARTO:"ign-fr-cartes",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNCARTO:"ign-fr-cartes-dyn",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"};TC.Consts.logicalOperator={AND:"and",OR:"or"};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.WFSErrors={GetFeatureNotAvailable:"GetFeatureNotAvailable",LayersNotAvailable:"LayersNotAvailable",NoLayers:"NoLayers",NoValidLayers:"noValidLayers",QueryNotAvailable:"QueryNotAvailable",CapabilitiesParseError:"CapabilitiesParseError",NumMaxFeatures:"NumMaxFeatures",GetCapabilities:"GetCapabilities",Indeterminate:"Indeterminate",NoFeatures:"NoFeatures"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.view={DEFAULT:0,THREED:1,PRINTING:2};TC.Consts.units={DEGREES:"degrees",METERS:"m"};TC.Consts.MARKER="marker";TC.Defaults=function(){var e={};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,layoutURLParamName:"layout",titleURLParamName:"title",locale:"es-ES",view:TC.Consts.view.DEFAULT,screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:TC.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto m\xe1xima actualidad",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"mapaTopografico",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:TC.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IGN_ES_CARTO,type:TC.Consts.layerType.WMTS,title:"Cartograf\xeda raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_grey_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/mdt",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_grey_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:TC.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mdt",layerNames:"relieve",thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_FR_CARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNCARTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNCARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"HR.ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.OSM,title:"OSM",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:TC.Consts.layer.OSM},{id:TC.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_DARK,title:"CARTO dark",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!0,featureInfo:!0,featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(t){var n=t.features.length,r=e[n];if(!r){r=2+Math.round(5*Math.sqrt(n));e[n]=r}return r},label:"${features.length}",fontColor:"#fff",fontSize:9}},selection:{point:{fillColor:"#0000ff",fillOpacity:.5,strokeColor:"#0000ff",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},line:{strokeColor:"#0000ff",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#0000ff",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=new Array(n),i=arguments.length>=2?arguments[1]:void 0,s=0;s<n;s++)s in t&&(r[s]=e.call(i,t[s],s,t));return r});TC.proxify=function(e){var t=e=$.trim(e);if(TC.Cfg.proxy){var n=!1;if(TC.Cfg.proxyExceptions)for(var r=0;r<TC.Cfg.proxyExceptions.length;r++)if(e.indexOf(TC.Cfg.proxyExceptions[r])>-1){n=!0;break}if(!n&&!TC.Util.isSameOrigin(e))if("function"==typeof TC.Cfg.proxy)t=TC.Cfg.proxy(e);else{t=TC.Cfg.proxy;"http"!=e.substr(0,4)&&(t+=window.location.protocol);t+=encodeURIComponent(e)}}return t};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);var e=function(e){var t=$("."+TC.Consts.classes.MAP).data("map");TC.error(TC.Util.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+e)};TC.syncLoadJS=function(t){var n=function(e,t){var n,r=new XMLHttpRequest;r.open("GET",e,!1);r.onreadystatechange=function(e){if(4===r.readyState)if(404===r.status){n=!1;t(!0)}else if(200!==r.status){t();n=!1}else n=r.responseText};try{r.send(null)}catch(e){n=!1;t()}return n};/(\.js|\/)$/i.test(t)||(t+=TC.isDebug?".js":".min.js");var r=n(t,function(r){if(r){e(t);return!1}return n(t,function(){e(t)})});if(r){var i=document.createElement("script");i.type="text/javascript";i.text=r;(function(){var e,t=document,n=t.getElementsByTagName("head");if(0===n.length){e=t.createElement("head");t.documentElement.insertBefore(e,document.body)}else e=n[0];return e})().appendChild(i)}};window.Modernizr||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.MODERNIZR);Modernizr.touch=Modernizr.touchevents;TC.isLegacy=!0;window.jQuery||(Modernizr.canvas&&!TC.isLegacy?TC.syncLoadJS(TC.Consts.url.JQUERY):TC.syncLoadJS(TC.Consts.url.JQUERY_LEGACY));"Promise"in window||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.PROMISE_POLYFILL);window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);"finally"in Promise.prototype||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return value})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})});if("$"in window){$._oldWhen=$.when;$.when=function(){const e=new Array(arguments.length);for(var t=0;t<arguments.length;t++){const n=e[t]=arguments[t];if(n instanceof Promise){const r=$.Deferred();n.then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)});e[t]=r}}return $._oldWhen.apply(this,e)}}TC.ajax=function(e){return new Promise(function(t,n){const r=(e=e||{}).method||"GET";var i;if(e.data)if("string"==typeof e.data)i=e.data;else if("object"==typeof e.data){const t=[];for(var s in e.data)t[t.length]=s+"="+e.data[s].toString();i=t.join("&")}var o=e.url;"GET"===r&&(o=o+"?"+i);const a=new XMLHttpRequest;a.open(r,e.url);e.contentType||"boolean"==typeof e.contentType?e.contentType&&a.setRequestHeader("Content-Type",e.contentType+"; charset=UTF-8"):a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");a.onreadystatechange=function(r){if(4===a.readyState)if(200!==a.status)n({status:a.status,msg:a.statusText,url:e.url});else{var i;try{switch(e.responseType){case TC.Consts.mimeType.JSON:i=JSON.parse(a.responseText);break;case TC.Consts.mimeType.XML:i=(new DOMParser).parseFromString(a.responseText,"application/xml");break;default:i=a.responseText}t(i)}catch(e){n(e)}}};try{a.send("POST"===r?i:null)}catch(e){n(Error(e))}})};document.addEventListener("DOMContentLoaded",function(){var e,t="Unknown library",n="OpenLayers 2",r="OpenLayers 4";if(TC.Control){e="Compiled";TC.isLegacy?window.OpenLayers&&(t=n):window.ol&&(t=r)}else{e="On demand";t=TC.isLegacy?n:r}TC.version=TC.version+" ("+e+"; "+t+"; @ "+TC.apiLocation+")"});TC.loadJSInOrder=function(e,t,n){TC.loadJS(e,t,n,!0)};const t=function(e,t){TC.Util.isSameOrigin(e)||(t.crossOrigin="anonymous")};TC.loadJS=function(n,r,i,s,o){arguments.length<4&&(s=!1);var a=$.isArray(r)?r:[r];a=a.map(function(e){return/\.js$/i.test(e)||0!==e.indexOf(TC.apiLocation)?e:e+(TC.isDebug?".js":".min.js")});if(Modernizr.canvas)if(n){var l="";const n=function(e){return e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if((a=a instanceof Array?a:[a]).length>1){var c=a.slice(0).filter(function(e,t){if(loadjs.isDefined(n(e))){a.splice(t,1);loadjs.ready(n(e),i);return!1}return!0});1===c.length?l=n(c[0]):c.length>0&&(l=c.reduce(function(e,t){return n(e)+"_"+n(t)}))}else l=n(a[0]);if(l.length>0)if(loadjs.isDefined(l))loadjs.ready(l,i);else{var u={async:!s,numRetries:1};o||TC.Util.detectIE()||(u.before=t);loadjs(a,l,u);loadjs.ready(l,{success:function(){i()},error:function(t){e(t)}})}}else i();else{if(n)for(var h=0;h<a.length;h++)TC.syncLoadJS(a[h]);i&&i()}};TC.loadCSS=function(t){const n=t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();loadjs.isDefined(n)?loadjs.ready(n,{}):loadjs(t,n,{error:function(t){e(t)},numRetries:1})};var n={};TC.getProjectionData=function(e){return new Promise(function(t,r){var i=(e=e||{}).crs.substr(e.crs.indexOf(":")+1);parseInt(i)===Number.NaN&&(i=e.crs.substr(e.crs.lastIndexOf("/")+1));var s=n[i];if(s)t(s);else{var o=TC.Consts.url.EPSG+"?format=json&q="+i;new TC.tool.Proxification(TC.proxify).fetchJSON(o,e).then(function(e){n[i]=e;t(e)}).catch(function(e){r(Error(e))})}})};TC.loadProjDef=function(e){const t=(e=e||{}).crs;var n;if(TC.isLegacy){window[TC.Consts.PROJ4JSOBJ_LEGACY]||TC.syncLoadJS(TC.url.proj4js);n=function(e){return Proj4js.defs[e]}}else{window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);n=function(e){return proj4.defs(e)}}window.Proj4js||(window.Proj4js={Proj:function(e){return proj4(Proj4js.defs[e])},defs:proj4.defs,transform:proj4});const r=function(e,t){Proj4js.defs[e]=t;TC.isLegacy||proj4.defs(e,t)},i=function(e,i,s){const o="EPSG:"+e,a="urn:ogc:def:crs:EPSG::"+e,l="http://www.opengis.net/gml/srs/epsg.xml#"+e;var c;if("object"==typeof i){c=$.extend({},i);i=$.extend({},i);c.axis&&delete c.axis}else"string"==typeof i&&(c=i.replace("+axis=neu",""));r(o,i);r(a,i);r(l,c);if(0===t.indexOf("http")){r(t,c);n(t).name=s}n(o).name=s;n(l).name=s};var s=t.lastIndexOf("#");s<0&&(s=t.lastIndexOf("/"));s<0&&(s=t.lastIndexOf(":"));var o=t.substr(s+1),a=n(t);if(a){i(o,a,e.name);$.isFunction(e.callback)&&e.callback()}else if(e.def){i(o,e.def,e.name);$.isFunction(e.callback)&&e.callback()}else TC.getProjectionData(e).then(function(t){(function(e){var t="ok"===e.status&&1===e.number_result;if(t){var n=e.results[0];i(n.code,n.proj4,n.name)}return t})(t)&&$.isFunction(e.callback)&&e.callback()})};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES]};if(TC.isLegacy){TC.url.ol=TC.apiLocation+TC.Consts.url.OL_LEGACY;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR_LEGACY;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS_LEGACY}else{TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS}TC.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"});TC.Cfg=$.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.alert=function(e){alert(e)};TC.prompt=function(e,t,n){var r=prompt(e,t);$.isFunction(n)&&n(r)};TC.confirm=function(e,t,n){confirm(e)?$.isFunction(t)&&t():$.isFunction(n)&&n()};TC.error=function(e){window.console&&console.error(e)};TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");TC.wrap={Map:function(e){var t=this;t.parent=e;t.map=null;t.getMap=function(){return t._promise}},Layer:function(e){var t=this;t.parent=e;t.layer=null;TC.EventTarget.call(t);t.getLayer=function(){return t.layer?Promise.resolve(t.layer):t._promise};t.setLayer=function(e){t.layer=e}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(e){this.parent=e},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},NavBarHome:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},Modify:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)},ResultsPanel:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};TC.inherit(TC.wrap.Layer,TC.EventTarget);TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBarHome,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.inherit(TC.wrap.control.ResultsPanel,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.loadJS(!Modernizr.urlparser,TC.apiLocation+TC.Consts.url.URL_POLYFILL,function(){});var r={};TC.getUID=function(e){var t=r[e=e||""];t||(t=r[e]=1);var n=e+t;r[e]=t+1;return n};const i=/\+/g;function s(e){return e}function o(e){return decodeURIComponent(e.replace(i," "))}TC.cookie=function(e,t,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(t))||null===t)){n=$.extend({},n);null===t&&(n.expires=-1);if("number"==typeof n.expires){var r=n.expires,i=n.expires=new Date;i.setDate(i.getDate()+r)}t=String(t);return document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?";expires="+n.expires.toUTCString():"",n.path?";path="+n.path:"",n.domain?";domain="+n.domain:"",n.secure?";secure":""].join("")}for(var a,l=(n=t||{}).raw?s:o,c=document.cookie.split("; "),u=0;a=c[u]&&c[u].split("=");u++)if(l(a.shift())===e)return l(a.join("="));return null}}()}document.addEventListener("DOMContentLoaded",function(){TC.browser=TC.Util.getBrowser();TC.loadJS(!TC.Cfg.acceptedBrowserVersions,TC.apiLocation+"TC/config/browser-versions.js",function(e){var t=!0,n=TC.Cfg.acceptedBrowserVersions.filter(function(e){return e.name.toLowerCase()===TC.browser.name.toLowerCase()});if(n.length>0&&n[0].expired)TC.Cfg.loggingErrorsEnabled=!1;else{n.length>0&&!isNaN(n[0].version)&&TC.browser.version<n[0].version&&(t=!1);if(TC.Cfg.oldBrowserAlert&&!t){TC.Cfg.loggingErrorsEnabled=!1;var r=$("."+TC.Consts.classes.MAP).data("map");TC.i18n.loadResources(!TC.i18n[r.options.locale],TC.apiLocation+"TC/resources/",r.options.locale).then(function(){TC.error(TC.Util.getLocaleString(r.options.locale,"outdatedBrowser"),TC.Consts.msgErrorMode.TOAST)})}}});/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;const e=(n=0,function(e){t=t||TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));var r,i,s,o="",a=-1,l=-1;if("unhandledrejection"===e.type){r=e.reason.message;s=!e.reason.stack||e.reason.stack.indexOf(TC.apiLocation)>0;i=e.reason}else{r=e.message;o=e.filename;a=e.lineno;l=e.colno;i=e.error;s=o.indexOf(TC.apiLocation)>0}if((TC.Cfg.notifyApplicationErrors||s)&&n<TC.Cfg.maxErrorCount&&TC.Cfg.loggingErrorsEnabled){var c=s?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:r,url:o,lineNumber:a,column:l,appUrl:location.href,prevState:t.getPreviousMapState(),userAgent:navigator.userAgent},i);n++;TC.isDebug||TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale).then(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"genericError")+(t.options.contactEmail||"webmaster@itracasa.es"),{type:TC.Consts.msgType.ERROR})})}return!1});var t,n;window.addEventListener("error",e,!1);window.addEventListener("unhandledrejection",e,!1)});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){return i(t[o][1][e]||e)},u,u.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){(function(e){"use strict";function n(){c=!0;for(var e,t,n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}c=!1}var r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(n),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),r=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var l=new e.MessageChannel;l.port1.onmessage=n,r=function(){l.port2.postMessage(0)}}var c,u=[];t.exports=function(e){1!==u.push(e)||c||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";function r(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,e!==r&&l(this,e)}function s(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function o(e,t,n){u(function(){var r;try{r=t(n)}catch(t){return h.reject(e,t)}r===e?h.reject(e,new TypeError("Cannot resolve promise with itself")):h.resolve(e,r)})}function a(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function n(t){i||(i=!0,h.reject(e,t))}function r(t){i||(i=!0,h.resolve(e,t))}var i=!1,s=c(function(){t(r,n)});"error"===s.status&&n(s.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}var u=e(1),h={},p=["REJECTED"],d=["FULFILLED"],f=["PENDING"];t.exports=n=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===p)return this;var n=new this.constructor(r);this.state!==f?o(n,this.state===d?e:t,this.outcome):this.queue.push(new s(n,e,t));return n},s.prototype.callFulfilled=function(e){h.resolve(this.promise,e)},s.prototype.otherCallFulfilled=function(e){o(this.promise,this.onFulfilled,e)},s.prototype.callRejected=function(e){h.reject(this.promise,e)},s.prototype.otherCallRejected=function(e){o(this.promise,this.onRejected,e)},h.resolve=function(e,t){var n=c(a,t);if("error"===n.status)return h.reject(e,n.value);var r=n.value;if(r)l(e,r);else{e.state=d,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},h.reject=function(e,t){e.state=p,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},n.resolve=function(e){return e instanceof this?e:h.resolve(new this(r),e)},n.reject=function(e){var t=new this(r);return h.reject(t,e)},n.all=function(e){function t(e,t){n.resolve(e).then(function(e){o[t]=e,++a!==i||s||(s=!0,h.resolve(c,o))},function(e){s||(s=!0,h.reject(c,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,s=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,l=-1,c=new this(r);++l<i;)t(e[l],l);return c},n.race=function(e){function t(e){n.resolve(e).then(function(e){s||(s=!0,h.resolve(a,e))},function(e){s||(s=!0,h.reject(a,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,s=!1;if(!i)return this.resolve([]);for(var o=-1,a=new this(r);++o<i;)t(e[o]);return a}},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}function i(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function s(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function o(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function a(e){return"boolean"==typeof S?w.resolve(S):function(e){return new w(function(t){var n=e.transaction(E,x),i=r([""]);n.objectStore(E).put(i,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return S=e})}function l(e){var t=b[e.name],n={};n.promise=new w(function(e){n.resolve=e}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function c(e,t){return new w(function(n,r){if(e.db){if(!t)return n(e.db);l(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=L.open.apply(L,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(E)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){n(s.result),function(e){var t=b[e.name].deferredOperations.pop();t&&t.resolve()}(e)}})}function u(e){return r([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(atob(e.data))],{type:e.type})}function h(e){return e&&e.__local_forage_encoded_blob}function p(e){var t=this,n=t._initReady().then(function(){var e=b[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return s(n,e,e),n}function d(e){l(e);for(var t=b[e.name].forages,n=0;n<t.length;n++)t[n]._dbInfo.db&&(t[n]._dbInfo.db.close(),t[n]._dbInfo.db=null);return c(e,!1).then(function(e){for(var n=0;n<t.length;n++)t[n]._dbInfo.db=e}).catch(function(t){throw function(e,t){var n=b[e.name].deferredOperations.pop();n&&n.reject(t)}(e,t),t})}function f(e,t,n){try{var r=e.db.transaction(e.storeName,t);n(null,r)}catch(r){if(!e.db||"InvalidStateError"===r.name)return d(e).then(function(){var r=e.db.transaction(e.storeName,t);n(null,r)});n(r)}}function y(e){var t,n,r,i,s,o=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var c=new ArrayBuffer(o),u=new Uint8Array(c);for(t=0;t<a;t+=4)n=_.indexOf(e[t]),r=_.indexOf(e[t+1]),i=_.indexOf(e[t+2]),s=_.indexOf(e[t+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&s;return c}function m(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=_[n[t]>>2],r+=_[(3&n[t])<<4|n[t+1]>>4],r+=_[(15&n[t+1])<<2|n[t+2]>>6],r+=_[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function g(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function C(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function v(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(J(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var S,b,w=Promise,E="local-forage-detect-blob-support",O=Object.prototype.toString,A="readonly",x="readwrite",P={_driver:"asyncStorage",_initStorage:function(e){function t(){return w.resolve()}var n=this,r={db:null};if(e)for(var i in e)r[i]=e[i];b||(b={});var s=b[r.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},b[r.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=p);for(var o=[],a=0;a<s.forages.length;a++){var l=s.forages[a];l!==n&&o.push(l._initReady().catch(t))}var u=s.forages.slice(0);return w.all(o).then(function(){return r.db=s.db,c(r,!1)}).then(function(e){return r.db=e,function(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}(r,n._defaultConfig.version)?function(e){return c(e,!0)}(r):e}).then(function(e){r.db=s.db=e,n._dbInfo=r;for(var t=0;t<u.length;t++){var i=u[t];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!L)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new w(function(t,r){n.ready().then(function(){f(n._dbInfo,A,function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;h(r)&&(r=u(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},getItem:function(e,t){var n=this;e=o(e);var r=new w(function(t,r){n.ready().then(function(){f(n._dbInfo,A,function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),h(e)&&(e=u(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},setItem:function(e,t,n){var r=this;e=o(e);var s=new w(function(n,i){var s;r.ready().then(function(){return s=r._dbInfo,"[object Blob]"===O.call(t)?a(s.db).then(function(e){return e?t:function(e){return new w(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}(t)}):t}).then(function(t){f(r._dbInfo,x,function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var l=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return i(s,n),s},removeItem:function(e,t){var n=this;e=o(e);var r=new w(function(t,r){n.ready().then(function(){f(n._dbInfo,x,function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},clear:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){f(t._dbInfo,x,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return i(n,e),n},length:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){f(t._dbInfo,A,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return i(n,e),n},key:function(e,t){var n=this,r=new w(function(t,r){e<0?t(null):n.ready().then(function(){f(n._dbInfo,A,function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,l=o.openCursor();l.onsuccess=function(){var n=l.result;n?0===e?t(n.key):a?t(n.key):(a=!0,n.advance(e)):t(null)},l.onerror=function(){r(l.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},keys:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){f(t._dbInfo,A,function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return i(n,e),n}},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N="~~local_forage_type~",M=/^~~local_forage_type~([^~]+)~/,I="__lfsc__:",k=I.length,R="arbf",D="blob",F="si08",B="ui08",j="uic8",U="si16",G="si32",q="ur16",H="ui32",W="fl32",z="fl64",V=k+R.length,$=Object.prototype.toString,Y={serialize:function(e,t){var n="";if(e&&(n=$.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===$.call(e.buffer))){var r,i=I;e instanceof ArrayBuffer?(r=e,i+=R):(r=e.buffer,"[object Int8Array]"===n?i+=F:"[object Uint8Array]"===n?i+=B:"[object Uint8ClampedArray]"===n?i+=j:"[object Int16Array]"===n?i+=U:"[object Uint16Array]"===n?i+=q:"[object Int32Array]"===n?i+=G:"[object Uint32Array]"===n?i+=H:"[object Float32Array]"===n?i+=W:"[object Float64Array]"===n?i+=z:t(new Error("Failed to get type for BinaryArray"))),t(i+m(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=N+e.type+"~"+m(this.result);t(I+D+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,k)!==I)return JSON.parse(e);var t,n=e.substring(V),i=e.substring(k,V);if(i===D&&M.test(n)){var s=n.match(M);t=s[1],n=n.substring(s[0].length)}var o=y(n);switch(i){case R:return o;case D:return r([o],{type:t});case F:return new Int8Array(o);case B:return new Uint8Array(o);case j:return new Uint8ClampedArray(o);case U:return new Int16Array(o);case q:return new Uint16Array(o);case G:return new Int32Array(o);case H:return new Uint32Array(o);case W:return new Float32Array(o);case z:return new Float64Array(o);default:throw new Error("Unkown type: "+i)}},stringToBuffer:y,bufferToString:m},X={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new w(function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=n,e()},function(e,t){r(t)})})});return n.serializer=Y,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new w(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName,[],function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var l=s.item(a),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,a+1)))return void t(c)}t()},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},getItem:function(e,t){var n=this;e=o(e);var r=new w(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},setItem:function(e,t,n){return function e(t,n,r,s){var a=this;t=o(t);var l=new w(function(i,o){a.ready().then(function(){void 0===n&&(n=null);var l=n,c=a._dbInfo;c.serializer.serialize(n,function(n,u){u?o(u):c.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[t,n],function(){i(l)},function(e,t){o(t)})},function(n){if(n.code===n.QUOTA_ERR){if(s>0)return void i(e.apply(a,[t,l,r,s-1]));o(n)}})})}).catch(o)});return i(l,r),l}.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=o(e);var r=new w(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},clear:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return i(n,e),n},length:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})}).catch(n)});return i(n,e),n},key:function(e,t){var n=this,r=new w(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},keys:function(e){var t=this,n=new w(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})}).catch(n)});return i(n,e),n}},K={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=t.name+"/",t.storeName!==this._defaultConfig.storeName&&(t.keyPrefix+=t.storeName+"/"),g()?(this._dbInfo=t,t.serializer=Y,w.resolve()):w.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var l=localStorage.key(a);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),o++)))return c}}});return i(r,t),r},getItem:function(e,t){var n=this;e=o(e);var r=n.ready().then(function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return i(r,t),r},setItem:function(e,t,n){var r=this;e=o(e);var s=r.ready().then(function(){void 0===t&&(t=null);var n=t;return new w(function(i,s){var o=r._dbInfo;o.serializer.serialize(t,function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}})})});return i(s,n),s},removeItem:function(e,t){var n=this;e=o(e);var r=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return i(r,t),r},clear:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}});return i(n,e),n},length:function(e){var t=this.keys().then(function(e){return e.length});return i(t,e),t},key:function(e,t){var n=this,r=n.ready().then(function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return i(r,t),r},keys:function(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r});return i(n,e),n}},J=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Q={},Z={},ee={INDEXEDDB:P,WEBSQL:X,LOCALSTORAGE:K},te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],ne={description:"",driver:[ee.INDEXEDDB._driver,ee.WEBSQL._driver,ee.LOCALSTORAGE._driver].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},re=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n in ee)if(ee.hasOwnProperty(n)){var r=ee[n],i=r._driver;this[n]=i,Q[i]||this.defineDriver(r)}this._defaultConfig=v({},ne),this._config=v({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":T(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new w(function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=te.concat("_initStorage"),o=0,a=s.length;o<a;o++){var l=s[o];if(!l||!e[l]||"function"!=typeof e[l])return void n(i)}var c=function(n){Q[r]&&console.info("Redefining LocalForage driver: "+r),Q[r]=e,Z[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(c,n):c(!!e._support):c(!0)}catch(e){n(e)}});return s(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Q[e]?w.resolve(Q[e]):w.reject(new Error("Driver not found."));return s(r,t,n),r},e.prototype.getSerializer=function(e){var t=w.resolve(Y);return s(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return s(n,e,e),n},e.prototype.setDriver=function(e,t,n){function r(){o._config.driver=o.driver()}function i(e){return o._extend(e),r(),o._ready=o._initStorage(o._config),o._ready}var o=this;J(e)||(e=[e]);var a=this._getSupportedDrivers(e),l=null!==this._driverSet?this._driverSet.catch(function(){return w.resolve()}):w.resolve();return this._driverSet=l.then(function(){var e=a[0];return o._dbInfo=null,o._ready=null,o.getDriver(e).then(function(e){o._driver=e._driver,r(),o._wrapLibraryMethodsWithReady(),o._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var s=e[t];return t++,o._dbInfo=null,o._ready=null,o.getDriver(s).then(i).catch(n)}r();var a=new Error("No available storage method found.");return o._driverSet=w.reject(a),o._driverSet}()}}(a)})}).catch(function(){r();var e=new Error("No available storage method found.");return o._driverSet=w.reject(e),o._driverSet}),s(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Z[e]},e.prototype._extend=function(e){v(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)C(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=re},{3:3}]},{},[4])(4)});TC.Layer=function(e){this.options=e||{};$.extend(this,this.options);this.id=this.options.id||TC.getUID();this.map=this.options.map;this.type=this.options.type||TC.Consts.layerType.WMS;this.customLegend=this.options.customLegend;var t=this.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;this.options.format=this.options.format||t;void 0===this.options.hideTree&&(this.options.hideTree=!0);void 0===this.options.hideTitle&&(this.options.hideTitle=!1);this._cache={visibilityStates:{}};this.tree=null;this.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(e){this.wrap.setVisibility(e)};TC.Layer.prototype.getVisibility=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.getVisibility()));return e};TC.Layer.prototype.getOpacity=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.layer.getOpacity()));return e};TC.Layer.prototype.setOpacity=function(e,t){var n=this;this.wrap.getLayer().then(function(r){r.setOpacity(e);n.opacity=e;n.map&&!t&&n.map.trigger(TC.Consts.event.LAYEROPACITY,{layer:n,opacity:e})})};TC.Layer.prototype.isCompatible=function(e){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var e=!0;switch(this.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:e=!1}return e};TC.Layer.prototype.isVisibleByScale=function(e){return!0};TC.Layer.prototype.isVisibleByName=function(e){return!0};TC.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}};TC.Layer.prototype.findNode=function e(t,n){var r=null;if(n.uid==t)r=n;else for(var i=0;i<n.children.length;i++){var s=e(t,n.children[i]);if(s){r=s;break}}return r};TC.Layer.prototype.setNodeVisibility=function(e,t){this.setVisibility(t)};TC.Layer.prototype.getNodeVisibility=function(e){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.Layer.prototype.setProjection=function(){};TC.control=TC.control||{};TC.Control=function(){TC.EventTarget.call(this);this.map=null;this.isActive=!1;this.isDisabled=!1;var e=arguments.length;this.options=$.extend({},e>1?arguments[1]:arguments[0]);this.id=this.options.id||TC.getUID(this.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");this.div=TC.Util.getDiv(this.options.div?this.options.div:arguments[0]);this._$div=$(this.div);this.div.classList.add(TC.Control.prototype.CLASS);this.div.classList.add(this.CLASS);this.template=this.options.template||this.template;this.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const e=TC.Control.prototype;e.CLASS="tc-ctl";e.template="";e.show=function(){this.div.style.display=""};e.hide=function(){this.div.style.display="none"};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(null,function(){t.addUIEventListeners();"function"==typeof e&&e()}))};e._set1stRenderPromise=function(e){const t=this;t._firstRender||(t._firstRender=e);return e};const t=function(e,t,n){return new Promise(function(r,i){const s=[],o=[];for(var a in n){var l=n[a];if("string"==typeof l)if(dust.cache[e.CLASS])dust.render(e.CLASS,t,function(t,n){e.div.innerHTML=n;t&&TC.error(t)});else{var c=TC.ajax({url:l,method:"GET",responseType:"text"});s.push(c);o.push(a)}else $.isFunction(l)&&l()}0===s.length?r():Promise.all(s).then(function(e){e.forEach(function(e,t){const n=dust.compile(e,o[t]);dust.loadSource(n)});r()}).catch(function(e){console.error("Error fetching templates: "+e);i(e instanceof Error?e:Error(e))})})};e.renderData=function(e,n){const r=this;return new Promise(function(i,s){r.map&&r.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:e});r.isDisabled?r.div.classList.add(TC.Consts.classes.DISABLED):r.div.classList.remove(TC.Consts.classes.DISABLED);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var o;if("object"==typeof r.template)o=t(r,e,r.template);else{var a={};r.template&&(a[r.CLASS]=r.template);o=t(r,e,a)}o.then(function(){dust.cache[r.CLASS]&&dust.render(r.CLASS,e,function(e,t){r.div.innerHTML=t;if(e){s(Error(e));TC.error(e)}});r.trigger(TC.Consts.event.CONTROLRENDER);$.isFunction(n)&&n();i()}).catch(function(e){s(Error(e))})})})};e.getRenderedHtml=function(e,t,n){const r=this;return new Promise(function(i,s){var o=function(){dust.cache[e]&&dust.render(e,t,function(e,t){if(e){TC.error(e);s(Error(e))}else{$.isFunction(n)&&n(t);i(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])o();else{var t=r.template[e];if("string"==typeof t)TC.ajax({url:t,method:"GET",responseType:"text"}).then(function(t){var n=dust.compile(t,e);dust.loadSource(n);o()}).catch(function(e){console.log("Error fetching template: "+e)});else if($.isFunction(t)){t();o()}}})})};e.register=function(e){const t=this;return new Promise(function(n,r){t.map=e;Promise.resolve(t.render()).then(function(){t.options.active&&t.activate();n(t)})})};e.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};e.deactivate=function(e){0==arguments.length&&(e=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!e){var t=this.map.getDefaultControl();t==this?t=null:this.map.previousActiveControl==this?t=null:t||(t=this.map.previousActiveControl);t&&t.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};e.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};e.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};e.renderPromise=function(){const e=this;return e._firstRender||new Promise(function(t,n){e.one(TC.Consts.event.CONTROLRENDER,function(){t(e)})})};e.addUIEventListener=function(e,t,n){(e?this.div.querySelectorAll(e):[this.div]).forEach(function(e){e.addEventListener(t,n)})};e.addUIEventListeners=function(){};e.isExclusive=function(){return!1};e.getLocaleString=function(e,t){var n=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(n,e,t)};e.getUID=function(){return TC.getUID(this.id+"-")};e.exportState=function(){return this.exportsState?{}:null};e.importState=function(e){}}();TC.feature=TC.feature||{};TC.Feature=function(e,t){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if($.isArray(e))this.geometry=e;else if(this.wrap.isNative(e)){this.wrap.feature=e;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();this.folders=e._folders;this.data=this.wrap.getData()}var n=this.options=$.extend(!0,{},t);this.id=this.id||n.id||TC.getUID();this.data=n.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===n.showsPopup?this.showsPopup=!0:this.showsPopup=n.showsPopup;this.layer=n.layer||null;this._selected=!1;n.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var e=[];this.folders?e=this.folders:this.options.group&&(e=[this.options.group]);return e};TC.Feature.prototype.setVisibility=function(e){var t=this;if(!e&&t.showsPopup&&t.layer){var n=t.layer.map.getControlsByClass(TC.control.Popup).filter(function(e){return e.currentFeature===t});n.length>0&&n[0].hide()}if(e&&t._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!e&&t._visibilityState===TC.Consts.visibility.VISIBLE){t._visibilityState=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;t.layer.wrap.setFeatureVisibility(t,e)}};TC.Feature.prototype.setId=function(e){this.id=e;this.wrap.setId(e)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(e){this.wrap.setStyle(e)};TC.Feature.prototype.toggleSelectedStyle=function(e){this.wrap.toggleSelectedStyle(e)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const e=function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},t=function(t){return e(t)?[t]:t.reduce(n,[])},n=function(n,r){e(r)?n[n.length]=r:n=n.concat(t(r));return n};return t(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const e=this.getCoordsArray()[0];return e?e.length:0};TC.Feature.prototype.setCoords=function(e){this.geometry=e;return this.wrap.setGeometry(e)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(e){this.data=$.extend(this.data,e);this.wrap.setData(e)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(e){var t=null,n=(e=e||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),r=this.getData();if("object"==typeof r){var i=this.wrap.getTemplate();if(i)t=i.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(e,t){return r[t]});else{var s=[];const e=[];var o=TC.Util.getLocaleString(n,"open");for(var a in r){const t=r[a],i=a.match(/^h(\d)_/i);if(i)e[i[1]]=t;else if("string"==typeof t||"number"==typeof t||void 0===t){s[s.length]="<tr><th>";s[s.length]=a;s[s.length]="</th><td>";if(TC.Util.isURL(t)){s[s.length]='<a href="';s[s.length]=t;s[s.length]='" target="_blank">';s[s.length]=o;s[s.length]="</a>"}else s[s.length]=void 0!==t?TC.Util.formatNumber(t,n):"&mdash;";s[s.length]="</td></tr>"}}const i=e.map(function(e,t){if(e)return"<h"+t+">"+e+"</h"+t+">"}).filter(function(e){return e});i.length&&(s=i.concat(s));if(s.length>0){s.unshift('<table class="tc-attr">');s[s.length]="</table>";t=s.join("")}}}else"string"==typeof r&&(t=r);if(!t){t=this.title;this.group&&(t+=" "+this.group)}t||(t=TC.Util.getLocaleString(n,"noData"));return t};TC.Feature.prototype.clone=function(){var e=this.wrap.cloneFeature();e._wrap=this.wrap;return new this.constructor(e,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(e){const t=this,n=t.layer&&t.layer.map||e&&e.map;if(n){var r,i=e||t.popup;if(!i)for(var s=n.getControlsByClass("TC.control.Popup"),o=0,a=s.length;o<a;o++){var l=s[o];if(!l.caller){i=l;break}}if(i){i.currentFeature=t;r=Promise.resolve(i)}else r=n.addControl("popup");r.then(function(e){e.currentFeature=t;n.getControlsByClass(TC.control.Popup).forEach(function(e){e.isVisible()&&e.hide()});t.wrap.showPopup(e);const r=e.contentDiv.querySelector("table.tc-attr"),i=e.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(r&&i.length){const e=r.getBoundingClientRect().width+"px";i.forEach(function(t){t.style.maxWidth=e})}n.trigger(TC.Consts.event.POPUP,{control:e});e.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(e){const t=this,n=t.layer&&t.layer.map||e&&e.map;if(n){var r,i=e;if(!i)for(var s=n.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.options.content}),o=0,a=s.length;o<a;o++){var l=s[o];if(!l.caller){i=l;break}}if(i){i.currentFeature=t;r=Promise.resolve(i)}else{var c={content:"table"},u=n.getControlsByClass("TC.control.ControlContainer")[0];if(u){c.side=u.SIDE.RIGHT;r=u.addControl("resultsPanel",c)}else{c.div=document.createElement("div");n.div.appendChild(c.div);r=n.addControl("resultsPanel",c)}}r.then(function(e){e.currentFeature=t;0===n.getControlsByClass(TC.control.ControlContainer).length&&n.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return"table"===e.options.content}).forEach(function(e){e.close()});n.getControlsByClass("TC.control.ResultsPanel").forEach(function(e){e.currentFeature&&e.close()});e.div.querySelector(".tc-ctl-print-btn")&&e.div.querySelector(".tc-ctl-print-btn").remove();e.menuDiv.innerHTML="";e.open(t.getInfo({locale:n.options.locale}),e.getInfoContainer());var r=function(t){n.off(TC.Consts.event.VIEWCHANGE,r);e.close()};n.on(TC.Consts.event.VIEWCHANGE,r)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var e=this.options.selection||{};this.setStyle($.extend({},TC.Cfg.styles.selection[this.STYLETYPE],e[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){this._selected=!1;this.setStyle(this.options);if(this.layer){var e=$.inArray(this,this.layer.selectedFeatures);e>=0&&this.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(e,t){return this.wrap.toGML(e,t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.point,t);this.wrap.createPoint(e,n)}};TC.inherit(TC.feature.Point,TC.Feature);TC.feature.Point.prototype.STYLETYPE=TC.Consts.geom.POINT;TC.feature.Point.prototype.CLASSNAME="TC.feature.Point";TC.feature.Point.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[t]:t};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createCircle(e,n)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var e=TC.feature.Circle.prototype;e.STYLETYPE=TC.Consts.geom.POLYGON;e.CLASSNAME="TC.feature.Circle";e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(e,t){TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{var n=this.options=$.extend(!0,this.options,TC.Cfg.styles.marker,t),r=this.layer&&this.layer.map?this.layer.map.options.locale:TC.Cfg.locale;this.title=n.title||TC.i18n[r][TC.Consts.MARKER];this.wrap.createMarker(e,n)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createMultiPolygon(e,n)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature.MultiPolygon.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],[].concat.apply([],t)):t};TC.feature.MultiPolygon.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createMultiPolyline(e,n)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE="line";TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature.MultiPolyline.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],t):t};TC.feature.MultiPolyline.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createPolygon(e,n)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature.Polygon.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],t):t};TC.feature.Polygon.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature.Polygon.prototype.getArea=function(e){return this.wrap.getArea(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(e,t){var n;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{n=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createPolyline(e,n)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE="line";TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.feature.Polyline.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.filter={};TC.filter.Filter=function(e){this.tagName_=e;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(e){if(e!=this){e._defaultNSURL=this._defaultNSURL;e._defaultPrefixNS=this._defaultPrefixNS}return e instanceof TC.filter.LogicalNary?e.write():e instanceof TC.filter.ComparisonBinary?e.write():e instanceof TC.filter.Comparison?e.write():e instanceof TC.filter.Spatial?e.write():(TC.filter.Function,e.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(e){return e.reduce(function(e,t,n){return(e instanceof TC.filter.Filter?e.writeInnerCondition_(e):e)+t.writeInnerCondition_(t)})};TC.filter.Filter.prototype.getText=function(e){if(e&&parseFloat(e,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,t))};TC.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,t))};TC.filter.not=function(e){return new TC.filter.Not(e)};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(e,t,n){return new TC.filter.EqualTo(e,t,n)};TC.filter.notEqualTo=function(e,t,n){return new TC.filter.NotEqualTo(e,t,n)};TC.filter.lessThan=function(e,t){return new TC.filter.LessThan(e,t)};TC.filter.lessThanOrEqualTo=function(e,t){return new TC.filter.LessThanOrEqualTo(e,t)};TC.filter.greaterThan=function(e,t){return new TC.filter.GreaterThan(e,t)};TC.filter.greaterThanOrEqualTo=function(e,t){return new TC.filter.GreaterThanOrEqualTo(e,t)};TC.filter.isNull=function(e){return new TC.filter.IsNull(e)};TC.filter.between=function(e,t,n){return new TC.filter.IsBetween(e,t,n)};TC.filter.function=function(e,t){return new TC.filter.Function(e,t)};TC.filter.like=function(e,t,n,r,i,s){return new TC.filter.IsLike(e,t,n,r,i,s)};TC.filter.LogicalNary=function(e,t){TC.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(e){this.condition=e;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Bbox=function(e,t,n){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=n};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(e,t){TC.filter.Filter.call(this,e);this.propertyName=t};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var e="";this.lowerBoundary&&this.upperBoundary&&(e="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(e="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(e=$.isArray(this.params)?this.params.reduce(function(e,t,n){var r=function(e){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:e})};return(n>0?e:r(e))+r(t)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:e,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(e,t,n,r){TC.filter.Comparison.call(this,e,t);this.expression=n;this.matchCase=r};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(e,t,n){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,n)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(e,t,n){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,n)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(e,t,n,r,i,s){TC.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==n?n:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=s};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(e){TC.filter.Comparison.call(this,"PropertyIsNull",e)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(e,t,n){TC.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=n};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(e,t){TC.filter.Filter.call(this,e);this.params=t};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var e="";if(this.params){var t=function(e,t){if("string"==typeof e)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:t,value:e});if("object"==typeof e){var n="";for(var r in e)n+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:t,value:e[r],key:r});return n}};if($.isArray(this.params)){var n=this._defaultPrefixNS;e=this.params.reduce(function(e,r,i){var s=function(e){return t(e,n)};return(i>1?e:s(e))+s(r)})}else e=t(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:e})};TC.filter.Spatial=function(e,t,n,r){TC.filter.Filter.call(this,e);this.geometryName=t;this.geometry=n;this.srsName=r};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.srsName),fieldTitle:this._fieldTitle})};TC.filter.Bbox=function(e,t,n){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=n};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var e="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:e})};TC.filter.Intersects=function(e,t,n){TC.filter.Spatial.call(this,"Intersects",e,t,n)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(e,t,n){TC.filter.Spatial.call(this,"Within",e,t,n)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t="tcLayer",n="tcImg";e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?$.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();"function"==typeof e&&e()}):Promise.reject())};e.register=function(e){const t=this;return new Promise(function(n,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){for(var r=0,i=e.layers.length;r<i;r++)t.updateLayerTree(e.layers[r]);e.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){const n=e.layer;var r=n.names;!function e(t){var n=!1;if(t)if($.inArray(t.name,r)>=0)n=!0;else for(var i=0;i<t.children.length;i++)if(e(t.children[i])){n=!0;break}return n}(t.layerTrees[n.id])&&0!==r.length?t.updateLayerTree(n):t.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){const n=e.layer;t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(n)>-1){t.updateLayerTree(n);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)}).on(TC.Consts.event.LAYERERROR,function(e){t.onErrorLayer(e.layer)});n(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,n,r,i){const s=this;if(n>=0&&n!==r){var o,a;const n=s.getLayerUIElements();for(var l=(i=i||s.map.workLayers).length-1;l>=0;l--){const r=i[l];a=o;for(var c=0,u=n.length;c<u;c++){const e=n[c];if($(e).data(t)===r){o=e;break}}if(r===e){a?a.insertAdjacentElement("afterend",o):o.parentElement.firstChild.insertAdjacentElement("beforebegin",o);break}}}};e.removeLayer=function(e){const n=this,r=n.getLayerUIElements();for(var i=0,s=r.length;i<s;i++){const n=r[i];if($(n).data(t)===e){n.parentElement.removeChild(n);break}}0===n.getLayerUIElements().length&&n.div.querySelector("."+n.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};e.onErrorLayer=function(e){};e.getLayerUIElements=function(){return this.div.querySelector("ul").children};e.styleLegendImage=function(e,t){if(!e.getAttribute("src")){var r=$(e).data(n);const c=new TC.tool.Proxification(TC.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then(function(t){e.src=t}).catch(function(e){TC.error(e)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const u=e.parentElement;var i=u.style.color,s=i.indexOf("("),o=i.indexOf(")");if(s>=0&&o>s){color=i.substr(0,o).substr(s+1).split(",");i="0x";for(var a=0;a<3;a++){var l=parseInt(color[a]).toString(16);i+=1===l.length?"0"+l:l}}else i.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+u.style.fontFamily+";fontSize:"+parseInt(u.style.fontSize)+";fontColor:"+i+";fontAntiAliasing:true";t.params&&t.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:t.params.sld_body}));c.fetchImage(r).then(function(e){$(e).data(n,e.src)}).catch(function(e){TC.error(e)})}c.fetchImage(r).then(function(t){e.src=t.src}).catch(function(e){TC.error(e.statusText)})}}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapInfo=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.MapInfo,TC.Control);!function(){var e=TC.control.MapInfo.prototype;e.CLASS="tc-ctl-mi";e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.QR_MAX_URL_LENGTH=150;t.SHORTEN_URL_LENGTH=32715;t.exportsState=!1;t.includeControls=void 0===t.options.includeControls||t.options.includeControls;e.ready(function(){const n=e.state&&e.state.ctl;if(n&&!e._controlStatesLoaded){t.importControlStates(n);e._controlStatesLoaded=!0}});return n};e.exportControlStates=function(){const e=this;return e.map?e.map.controls.map(function(e){return e.exportState()}).filter(function(e){if(e)for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}):[]};e.importControlStates=function(e){const t=this;t.map&&e.forEach(function(e){const n=t.map.getControlById(e.id);n&&t.map.loaded(function(){n.importState(e)})})};e.exportState=function(){const e=this;if(e.exportsState){const n={};if(e.featureToShare||e.sharedFeaturesLayer){var t;n.id=e.id;if(e.featureToShare){const n=e.featureToShare.clone();n.showsPopup=!0;t=e.featureToShare.layer.exportState({features:[n]})}else t=e.sharedFeaturesLayer.exportState();n.features=t.features;t.crs&&(n.crs=t.crs)}return n}return null};e.importState=function(e){const t=this;t.map&&e.features.length&&t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then(function(n){t.sharedFeaturesLayer=n;n.importState({features:e.features,crs:e.crs}).then(function(){t.map.zoomToFeatures(n.features)})})};e.manageMaxLengthExceed=function(){throw"Falta implementaci\xf3n del m\xe9todo manageMaxLengthExceed"};e.generateLink=function(){var e=window.location.href,t=e.indexOf("#");t>0&&(e=e.substring(0,t));if(this.extraParams){var n=TC.Util.getQueryStringParams(e);$.extend(n,this.extraParams);var r=e.indexOf("?");r>=0&&(e=e.substring(0,r));e=e.concat("?",$.param(n))}TC.Util.getParameterByName("lang").length>0&&(e=e.indexOf("&")>-1?e.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):e.replace("?lang="+TC.Util.getParameterByName("lang"),""));const i=this.includeControls?this.exportControlStates():[];this.exportsState&&(this.featureToShare||this.sharedFeaturesLayer)&&i.push(this.exportState());const s=i.length?{ctl:i}:void 0;var o=this.map.getMapState(s),a=e.concat("#",o);this.manageMaxLengthExceed({browser:a.length>TC.Consts.URL_MAX_LENGTH,qr:a.length>this.SHORTEN_URL_LENGTH});return a};e.shortenedLink=function(){const e=this;var t;return new Promise(function(n,r){var i=function(){var t=e.generateLink(),n=t.indexOf("?"),r=t.indexOf("#");n>0&&(t=n<r?t.replace(t.substring(n,r),""):t.replace(t.substring(n,t.length-1),""));return t}();if(i.length>e.QR_MAX_URL_LENGTH&&i.length<e.SHORTEN_URL_LENGTH){t=e.map.getLoadingIndicator().addWait();(function(e){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");var t=new FormData;t.append("url",e);return new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:t}).then(function(e){return e}).catch(function(e){return null})})(i).then(function(r){if(r&&r.responseText){e.map.getLoadingIndicator().removeWait(t);n(r.responseText.replace("http://","https://"))}else onerror()},onerror)}else{i.length>=e.SHORTEN_URL_LENGTH&&function(){e.map.toast(e.getLocaleString("urlTooLongForShortener"),{type:TC.Consts.msgType.ERROR});e.map.getLoadingIndicator().removeWait(t);n("")}();n("")}})};e.makeQRCode=function(e,t,n){const r=this;return new Promise(function(i,s){TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){r.shortenedLink().then(function(r){if((r=r||"").length>0){var s={text:r};if(t&&n){s.width=t;s.height=n}new MutationObserver(function(e,t){var n=e.filter(function(e){return"attributes"===e.type}).filter(function(e){return e.attributeName.indexOf("src")>-1});if(n.length>0){t.disconnect();i(n[0].target.src)}}).observe(e,{attributes:!0,childList:!0,subtree:!0});new QRCode(e,s)}else i()})})})};e.drawScaleBarIntoCanvas=function(e){var t,n=this.map.getControlsByClass(TC.control.ScaleBar);if(0==n.length)return null;var r=(t=(e=e||{}).canvas?e.canvas:document.createElement("CANVAS")).getContext("2d");r.save();var i,s,o=document.getElementsByClassName("ol-scale-line-inner").item(0),a=$.extend({},o.getBoundingClientRect()),l=o.textContent;r.beginPath();r.strokeStyle=window.getComputedStyle(o).borderColor;if(a.width>a.height){i=a.width;s=a.height}else{i=a.height;s=a.width}if(e.setSize){t.width=i;t.height=s}a.left=void 0!=e.left?e.left:15;a.top=void 0!=e.top?e.top:15;r.moveTo(a.left,a.top);r.lineTo(a.left,a.top+s);r.lineTo(a.left+i,a.top+s);r.lineTo(a.left+i,a.top);r.stroke();r.measureText(l);var c={x:a.left+i/2,y:a.top+s/2};e.fill&&function(t,r,i){var s=document.getElementsByClassName(n[0].CLASS).item(0),o=$.extend({},s.getBoundingClientRect());o.left=(e.left||15)-2;o.top=e.top||15;o.top--;t.globalAlpha=.5;t.fillStyle=window.getComputedStyle(s).backgroundColor;r+=4;i+=4;t.fillRect(o.left,o.top,r,i)}(r,i,s);r.globalAlpha=1;r.fillStyle=void 0!=e.textColor?e.textColor:window.getComputedStyle(o).color;r.font=void 0!=e.font?e.font:window.getComputedStyle(o).fontSize+" "+window.getComputedStyle(o).fontFamily;r.textAlign="center";r.textBaseline="middle";r.fillText(l,c.x,c.y);return t};e.registerListeners=function(){const e=this;if(!e.registeredListeners){e.map.on(TC.Consts.event.LAYERADD,e.generateLink.bind(e)).on(TC.Consts.event.LAYERREMOVE,e.generateLink.bind(e)).on(TC.Consts.event.FEATUREADD,e.generateLink.bind(e)).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,e.generateLink.bind(e));e.registeredListeners=!0}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var e=TC.control.TOC.prototype;e.CLASS="tc-ctl-toc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/TOC.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(t.get(["workLayers"],!1),t,{block:n},{}).w("</ul></div>")}t.__dustBody=!0;function n(e,t){return e.p("tc-ctl-toc-wlbranch",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:s},{}).w("</ul></li>")}t.__dustBody=!0;function n(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function i(e,t){return e.w(" checked")}i.__dustBody=!0;function s(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}s.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('">').x(t.get(["children"],!1),t,{block:i},{}).w('<input type="checkbox" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:s},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:o},{}).w("</ul></li>")}t.__dustBody=!0;function n(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function i(e,t){return e.w('<button class="tc-ctl-toc-collapse-btn"></button>')}i.__dustBody=!0;function s(e,t){return e.w(" checked")}s.__dustBody=!0;function o(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t}}var t="tcLayer",n="tcLayerUid";e.register=function(e){const t=this,n=TC.control.MapContents.prototype.register.call(t,e);e.on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){t.onExternalServiceAdded.call(t,e,this)});return n};e.onExternalServiceAdded=function(e,t){const n=this;if(e&&e.layer){e.layer.map=t;t.addLayer(e.layer).then(function(t){n.updateLayerTree(e.layer)})}};e.addUIEventListeners=function(){var e=this;e.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(r){const i=r.target;for(var s=i;s&&!s.matches("ul."+e.CLASS+"-wl");)s=s.parentElement;const o=[];for(var a=0,l=s.children.length;a<l;a++){child=s.children[a];"LI"===child.tagName&&o.push(child)}for(a=0,l=o.length;a<l;a++){const e=o[a];if(e.contains(i)){const r=$(e).data(t);var c=i;do{c=c.parentElement}while(c&&"LI"!==c.tagName);const s=$(c).data(n);r.setNodeVisibility(s,i.checked);break}}r.stopPropagation()}));e.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+e.CLASS+"-collapse-btn",function(t){t.target.blur();const n=t.target.parentElement;if(!n.classList.contains(e.CLASS+"-leaf")){n.classList.contains(TC.Consts.classes.COLLAPSED)?n.classList.remove(TC.Consts.classes.COLLAPSED):n.classList.add(TC.Consts.classes.COLLAPSED);const e=n.querySelector("ul");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED);t.stopPropagation()}}))};e.update=function(){var e=function(e){for(var t=0,n=e.children.length;t<n;t++){const n=e.children[t];if(n.matches("input[type=checkbox]"))return n}return null};this.getLayerUIElements().forEach(function(r){var i=$(r).data(t);if(i){e(r).checked=i.getVisibility();i.tree=null;r.querySelectorAll("li").forEach(function(t){const r=e(t);var s=$(t).data(n);switch(i.getNodeVisibility(s)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:r.checked=!0;r.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:r.checked=!1;r.indeterminate=!0;break;default:r.checked=!1;r.indeterminate=!1}})}});this.updateScale()};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(r){var i=$(r).data(t);r.querySelectorAll("li").forEach(function(t,r){var s=$(r);s.toggleClass(e.CLASS+"-node-notvisible",!i.isVisibleByScale(s.data(n)))})})};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r.div.querySelector("."+r.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var i=r.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(i,r.layerTrees[e.id],function(i,s){const o=(new DOMParser).parseFromString(s,"text/html").body.firstChild,a=$(o).data(n),l=r.div.querySelector("."+r.CLASS+'-wl li[data-tc-layer-uid="'+a+'"]');if(l){l.innerHTML=o.innerHTML;l.setAttribute("class",o.getAttribute("class"));$(l).data(t)||$(l).data(t,e)}else{$(o).data(t,e);const n=r.div.querySelector("."+r.CLASS+"-wl");n.insertBefore(o,n.firstChild)}i&&TC.error(i)});var s="ul."+r.CLASS+"-wl",o="ul."+r.CLASS+"-branch",a="li."+r.CLASS+"-node",l="li."+r.CLASS+"-leaf";r.div.querySelectorAll(s+" "+o+" "+o+","+s+" "+o+" "+a).forEach(function(e){e.matches(l)||e.classList.add(TC.Consts.classes.COLLAPSED)});r.update()})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var n=this;n.getLayerUIElements().forEach(function(r){if($(r).data(t)===e){var i=!e.getVisibility();r.querySelectorAll("input[type=checkbox]").forEach(function(e){e.matches("."+n.CLASS+"-branch-cb")?e.checked=!i:e.disabled=i})}})};e.updateLayerOrder=function(e,t,n){};e.render=function(e){const t=this;return TC.Control.prototype.render.call(t,function(){var n=t.options.controls||[];if(n.length>0){var r=n[0],i=document.createElement("div");t.div.appendChild(i);t.map.addControl(r.name,$.extend({div:i},r.options))}$.isFunction(e)&&e()})};e.getLayerUIElements=function(){const e=[],t=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var n=0,r=t.length;n<r;n++){child=t[n];"LI"===child.tagName&&(e[e.length]=child)}return e}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(e){TC.control.TOC.apply(this,arguments);this.layers=[];this.queries=this.options.queries};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var e=TC.control.WorkLayerManager.prototype;e.CLASS="tc-ctl-wlm";e.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/WorkLayerManager.html";e.template[e.CLASS+"-elm"]=TC.apiLocation+"TC/templates/WorkLayerManagerElement.html";e.template[e.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipSingle.html";e.template[e.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroup.html";e.template[e.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroupNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="').h("i18n",t,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-wlm-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><div class="tc-ctl-wlm-content tc-hidden"><form><ul>').s(t.get(["workLayers"],!1),t,{block:n},{}).w("</ul></form></div>")}t.__dustBody=!0;function n(e,t){return e.p("tc-ctl-wlm-elm",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t};e.template[e.CLASS+"-elm"]=function(){dust.register(e.CLASS+"-elm",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-elm" tabindex="-1"><div class="tc-ctl-wlm-lyr">').x(t.get(["path"],!1),t,{block:n},{}).w('</div><div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="').s(t.get(["path"],!1),t,{else:r,block:i},{}).w('">').s(t.get(["path"],!1),t,{else:o,block:a},{}).w('</div><div class="tc-ctl-wlm-buttons"><div class="tc-ctl-wlm-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(t.get(["opacity"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(t.get(["hide"],!1),t,{block:c},{}).w(' title="').h("i18n",t,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-wlm-info tc-hidden">').x(t.get(["abstract"],!1),t,{block:u},{}).x(t.get(["customLegend"],!1),t,{else:h,block:f},{}).x(t.get(["metadata"],!1),t,{block:y},{}).w('</div><div class="tc-ctl-wlm-dd ').x(t.get(["hide"],!1),t,{block:g},{}).w('" title="').h("i18n",t,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-wlm-del ').x(t.get(["unremovable"],!1),t,{block:C},{}).w(" ").nx(t.get(["hide"],!1),t,{block:v},{}).w('" ').nx(t.get(["unremovable"],!1),t,{block:T},{}).w("></div></li>")}t.__dustBody=!0;function n(e,t){return e.f(t.get(["title"],!1),t,"h")}n.__dustBody=!0;function r(e,t){return e.f(t.get(["title"],!1),t,"h")}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:s},{})}i.__dustBody=!0;function s(e,t){return e.w(" &bull; ")}s.__dustBody=!0;function o(e,t){return e.f(t.get(["title"],!1),t,"h")}o.__dustBody=!0;function a(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:l},{})}a.__dustBody=!0;function l(e,t){return e.w(" &bull; ")}l.__dustBody=!0;function c(e,t){return e.w('checked="checked"')}c.__dustBody=!0;function u(e,t){return e.w('<div class="tc-ctl-wlm-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div><pre>").f(t.get(["abstract"],!1),t,"h",["s"]).w("</pre></div></div>")}u.__dustBody=!0;function h(e,t){return e.x(t.get(["legend"],!1),t,{block:p},{})}h.__dustBody=!0;function p(e,t){return e.w('<div class="tc-ctl-wlm-legend" data-tc-layer-name="').f(t.get(["layerNames"],!1),t,"h").w('"><h4>').h("i18n",t,{},{$key:"content"}).w("</h4>").s(t.get(["legend"],!1),t,{block:d},{}).w("</div>")}p.__dustBody=!0;function d(e,t){return e.w("<div><p>").f(t.get(["title"],!1),t,"h").w('</p><img data-tc-img="').f(t.get(["src"],!1),t,"h").w('" /></div>')}d.__dustBody=!0;function f(e,t){return e.w('<ul class="tc-ctl-wlm-custom-legend">').f(t.get(["customLegend"],!1),t,"h",["s"]).w("</ul>")}f.__dustBody=!0;function y(e,t){return e.w('<div class="tc-ctl-wlm-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:m},{}).w("</ul></div>")}y.__dustBody=!0;function m(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}m.__dustBody=!0;function g(e,t){return e.w("tc-hidden")}g.__dustBody=!0;function C(e,t){return e.w("disabled")}C.__dustBody=!0;function v(e,t){return e.w("tc-hidden")}v.__dustBody=!0;function T(e,t){return e.w('title="').h("i18n",t,{},{$key:"removeLayerFromMap"}).w('"')}T.__dustBody=!0;return t};e.template[e.CLASS+"-type-sgl"]=function(){dust.register(e.CLASS+"-type-sgl",t);function t(e,t){return e.h("i18n",t,{},{$key:"singleLayer"})}t.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp"]=function(){dust.register(e.CLASS+"-type-grp",t);function t(e,t){return e.w("<div>").h("i18n",t,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(t.get(["Layer"],!1),t,{block:n},{}).w("</ul>")}t.__dustBody=!0;function n(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp-node"]=function(){dust.register(e.CLASS+"-type-grp-node",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-tip-grp-elm"><span>').f(t.get(["Title"],!1),t,"h").w("</span><ul>").s(t.get(["Layer"],!1),t,{block:n},{}).w("</ul></li>")}t.__dustBody=!0;function n(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t}}const t="tcLayer",n=function(e,n){return e.getLayerUIElements().filter(function(e){return $(e).data(t)===n})[0]};var r=function(e){return $.grep(e.map.workLayers,function(e){return!e.stealth}).length};const i=function(e){return!e.layers.some(function(e){return e.unremovable})},s=function(e,n,r,i,s){const o=e.getLayerUIElements();var a;if(i>r)a=o[i-1];else{if(!(i<r))return;a=o[i+1]}const l=$(n).data(t),c=$(a).data(t);for(var u=-1,h=0;h<e.map.layers.length;h++)if(c===e.map.layers[h]){u=h;break}u>=1&&u<e.map.layers.length&&e.map.insertLayer(l,u,s)};e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?$.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){n.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){n.updateLayerTree(e)});const t=n.div.querySelector("ul");n._sortable=Sortable.create(t,{handle:"."+n.CLASS+"-dd",animation:150,onSort:function(e){s(n,e.item,e.oldIndex,e.newIndex)}});t.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const r=function(e,r){const i=n._sortable.toArray(),o=i[e];i[e]=i[r];i[r]=o;n._sortable.sort(i);s(n,t,e,r)},i=n.getLayerUIElements(),o=i.indexOf(t);switch(!0){case/Up$/.test(e.key):if(o>0){r(o,o-1);t.focus();e.stopPropagation()}break;case/Down$/.test(e.key):if(o<i.length-1){r(o,o+1);t.focus();e.stopPropagation()}break;case/Enter$/.test(e.key):t.blur();e.stopPropagation()}}));"function"==typeof e&&e()})}):Promise.reject())};e.register=function(t){const r=this;return new Promise(function(i,s){TC.control.TOC.prototype.register.call(r,t).then(function(){t.on(TC.Consts.event.LAYEROPACITY,function(e){const t=n(r,e.layer);t&&(t.querySelector("input[type=range]").value=Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(e){var n=e.fileName;if(e.features&&e.features.length>0){var i="."+TC.Consts.format.GPX.toLowerCase();if(e.fileName.toLowerCase().indexOf(i)===e.fileName.length-i.length)return;t.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==n){if(r.map&&r.map.layout&&r.map.layout.accordion&&r.div.classList.contains(TC.Consts.classes.COLLAPSED))for(var t=0;t<r.map.controls.length;t++)r.map.controls[t]!==r&&r.map.controls[t].div.classList.add(TC.Consts.classes.COLLAPSED);r.map.trigger(TC.Consts.event.TOOLSOPEN);r.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});if(r.queries){TC.control.WFSQuery||TC.syncLoadJS(TC.apiLocation+"TC/Control/WFSQuery");e.queryControl=new TC.control.WFSQuery(null,r.queries instanceof Object?r.queries:null);r.map.addControl(e.queryControl)}i(r)})})};e.onExternalServiceAdded=function(e,t){};e.addUIEventListeners=function(){const e=this;e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("input[type=checkbox]",function(n){const r=n.target;var i=r;do{i=i.parentElement}while(i&&!i.matches("li."+e.CLASS+"-elm"));$(i).data(t).setVisibility(r.checked);n.stopPropagation()}));const n=function(e){const n=e.target;var r=n;do{r=r.parentElement}while(r&&"LI"!==r.tagName);$(r).data(t).setOpacity(n.value/100)};e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",n));e.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",n));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del:not(.disabled)",function(n){var r=n.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const i=$(r).data(t);e.map.removeLayer(i)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",function(n){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){e.getLayerUIElements().map(function(e){return $(e).data(t)}).forEach(function(t){e.map.removeLayer(t)})})}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-btn-info",function(n){const r=n.target;var i=r;do{i=i.parentElement}while(i&&"LI"!==i.tagName);const s=i.querySelector("."+e.CLASS+"-info"),o=$(i).data(t);s.querySelectorAll("."+e.CLASS+"-legend img").forEach(function(t){e.styleLegendImage(t,o)});s.classList.contains(TC.Consts.classes.HIDDEN)?s.classList.remove(TC.Consts.classes.HIDDEN):s.classList.add(TC.Consts.classes.HIDDEN);if(i.querySelector('input[type="checkbox"]').checked){const t=i.querySelector("."+e.CLASS+"-dd");s.classList.contains(TC.Consts.classes.HIDDEN)?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}r.classList.contains(TC.Consts.classes.CHECKED)?r.classList.remove(TC.Consts.classes.CHECKED):r.classList.add(TC.Consts.classes.CHECKED)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-btn-query",function(n){if(n.target.classList.contains("tc-unavailable")||n.target.classList.contains("tc-loading"))return;var r=n.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const i=$(r).data(t);e.queryControl.renderModalDialog(i)}))};e.updateLayerVisibility=function(e){const t=this,r=n(t,e);if(r){const n=e.getVisibility();r.querySelector('input[type="checkbox"]').checked=n;const i=r.querySelector("."+t.CLASS+"-del"),s=r.querySelector("."+t.CLASS+"-info"),o=r.querySelector("."+t.CLASS+"-dd");if(n){i.classList.add(TC.Consts.classes.HIDDEN);s.classList.contains(TC.Consts.classes.HIDDEN)&&o.classList.remove(TC.Consts.classes.HIDDEN)}else{i.classList.remove(TC.Consts.classes.HIDDEN);s.classList.contains(TC.Consts.classes.HIDDEN)&&o.classList.add(TC.Consts.classes.HIDDEN)}}};e.updateLayerTree=function(e){var n=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(n,e);for(var s=!1,a=0,l=n.layers.length;a<l;a++)if(e===n.layers[a]){s=!0;break}if(!s){var c=n.CLASS+"-elm";n.layers.push(e);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r,i=e.title||e.wrap.getServiceTitle(),s={title:e.options.hideTitle?"":i,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable},a=e.isRaster();if(a){s.layerNames=e.layerNames;var l=e.getPath();l.shift();s.path=l;var u=e.names[0],h=e.wrap.getInfo(u);s.legend=h.legend;s.abstract=h.abstract;var p,d=h.hasOwnProperty("abstract")||h.hasOwnProperty("legend")||h.hasOwnProperty("metadata");if(e.tree&&e.tree.children&&e.tree.children.length&&e.tree.children[0].children&&e.tree.children[0].children.length)p=null;else if(p=h.metadata)for(var f=0,y=p.length;f<y;f++){var m=p[f];m.formatDescription=n.getLocaleString(TC.Util.getSimpleMimeType(m.format))||n.getLocaleString("viewMetadata")}s.metadata=p;n.queries&&(r=o(e))}(function(e){return new Promise(function(t,n){e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().then(function(e){t(e)}).catch(function(e){TC.error(e)}):t()})})(e).then(function(i){i&&(legend.src=i);dust.render(c,s,function(i,s){const o=(new DOMParser).parseFromString(s,"text/html").body.firstChild;var l,c=!1;if(a&&!(c=e.names.length>1))for(var h=e.wrap.getAllLayerNodes(),p=0;p<h.length;p++){var f=h[p];if(e.wrap.getName(f)===u){l=f;e.wrap.getLayerNodes(f).length>0&&(c=!0);break}}const y=o.querySelector("."+n.CLASS+"-type"),m=c?n.CLASS+"-type-grp":n.CLASS+"-type-sgl";y.classList.add(m);d||o.querySelector("."+n.CLASS+"-btn-info").classList.add(TC.Consts.classes.HIDDEN);if(l){e.wrap.normalizeLayerNode(l);dust.render(m,l,function(e,t){var r;y.addEventListener("mouseover",function(e){const i=n.map.div,s=y.getBoundingClientRect();(r=document.createElement("div")).classList.add(n.CLASS+"-tip");r.innerHTML=t;r.style.top=s.top-i.offsetTop+"px";r.style.right=i.offsetWidth-(s.left-i.offsetLeft)+"px";i.appendChild(r)});y.addEventListener("mouseout",function(e){r.parentElement.removeChild(r)})})}const g=n.div.querySelector("ul");$(o).data(t,e);const C=n.getLayerUIElements(),v=n.map.workLayers.filter(function(e){return!e.stealth}),T=v.indexOf(e);for(var L=!1,S=(p=0,C.length);p<S;p++){const e=C[p],n=$(e).data(t);if(v.indexOf(n)<T){e.insertAdjacentElement("beforebegin",o);L=!0;break}}L||g.appendChild(o);r&&r(o);n.updateScale()})})});var u=r(n);const s=n.div.querySelector("."+n.CLASS+"-n"),a=n.div.querySelector("."+n.CLASS+"-empty"),l=n.div.querySelector("."+n.CLASS+"-content");s.textContent=u;if(u>0){s.classList.add(TC.Consts.classes.VISIBLE);a.classList.add(TC.Consts.classes.HIDDEN);l.classList.remove(TC.Consts.classes.HIDDEN)}else{s.classList.remove(TC.Consts.classes.VISIBLE);a.classList.remove(TC.Consts.classes.HIDDEN);l.classList.add(TC.Consts.classes.HIDDEN)}const h=n.div.querySelector("."+n.CLASS+"-del-all");i(n)?h.classList.remove(TC.Consts.classes.HIDDEN):h.classList.add(TC.Consts.classes.HIDDEN)}}};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(n){var r=$(n).data(t);if(r.names){for(var i=!1,s=0;s<r.names.length;s++)if(r.isVisibleByScale(r.names[s])){i=!0;break}const t=e.CLASS+"-elm-notvisible";i?n.classList.remove(t):n.classList.add(t)}})};e.updateLayerOrder=function(e,t,r){const i=this;i.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){const t=n(i,e);t&&t.parentElement.firstChild.insertAdjacentElement("beforebegin",t)})};e.removeLayer=function(e){var n=this.layers.indexOf(e);n>=0&&this.layers.splice(n,1);this.getLayerUIElements().forEach(function(n){$(n).data(t)===e&&n.parentElement.removeChild(n)});const s=this.div.querySelector("."+this.CLASS+"-content"),o=this.div.querySelector("."+this.CLASS+"-empty"),a=this.div.querySelector("."+this.CLASS+"-n");var l=r(this);a.textContent=l;if(l>0){s.classList.remove(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.VISIBLE)}else{i(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);s.classList.add(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.VISIBLE)}};e.getLayerUIElements=function(){const e=this,t=[],n=e.div.querySelector("ul").children;for(var r=0,i=n.length;r<i;r++){child=n[r];child.matches("li."+e.CLASS+"-elm")&&(t[t.length]=child)}return t};const o=function(t){var n,r=null,i=new Promise(function(e,t){r=e});i.then(function(t){(n=document.createElement("div")).classList.add(e.CLASS+"-btn-query");n.classList.add(TC.Consts.classes.LOADING);n.setAttribute("title",e.getLocaleString("query.tooltipMagnifBtn"));t.querySelector("."+e.CLASS+"-btn-info").insertAdjacentElement("afterend",n)});var s=t.getWFSCapabilitiesPromise();const o=function(){if(n){n.classList.remove(TC.Consts.classes.LOADING);n.classList.add("tc-unavailable")}console.log("El servicio "+(t.title||t.tree.title)+" no tiene disponible el WFS")};Promise.all([s,i]).then(function(){var e=arguments[0][0];if(n){n.classList.remove(TC.Consts.classes.LOADING);var r=t.getDisgregatedLayerNames();if(1===r.length&&!e.FeatureTypes.hasOwnProperty(r[0].substring(r[0].indexOf(":")+1))){n.classList.add("tc-unavailable");console.log("El servicio WFS de "+(t.title||t.tree.title)+" no dispone de la capa "+r[0])}}}).catch(o);s.catch(o);return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){TC.Control.apply(this,arguments);this.options&&this.options.callback&&(this.callback=this.options.callback);this.wrap=new TC.wrap.control.Click(this)};TC.inherit(TC.control.Click,TC.Control);!function(){var e=TC.control.Click.prototype;e.CLASS="tc-ctl-click";e.register=function(e){this.wrap.register(e);return TC.Control.prototype.register.call(this,e)};e.activate=function(){TC.Control.prototype.activate.call(this);this.wrap.activate()};e.deactivate=function(){this.wrap.deactivate();TC.Control.prototype.deactivate.call(this)};e.callback=function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);const e=this._classSelector="."+this.CLASS;this._selectors={LIST_ITEM:"ul"+e+"-features li"};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=Math.pow(2,53)-1,r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)},function(e){var n=Object(e);if(null==e)throw new TypeError("Array.from requiere un objeto array-like - not null or undefined");var i,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!t(s))throw new TypeError("Array.from: si hay mapFn, el segundo argumento debe ser una funci\xf3n");arguments.length>2&&(i=arguments[2])}for(var o,a=r(n.length),l=t(this)?Object(new this(a)):new Array(a),c=0;c<a;){o=n[c];l[c]=s?void 0===i?s(o,c):s.call(i,o,c):o;c+=1}l.length=a;return l}));var e,t,n,r,i=function(e){return e.info.services?e.info.services.reduce(function(e,t){return e+t.layers.reduce(function(e,t){return e+1},0)},0):0};TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var s=TC.control.FeatureInfoCommons.prototype;s.CLASS="tc-ctl-finfo";s.TITLE_SEPARATOR=" \u2022 ";TC.isDebug?s.template=TC.apiLocation+"TC/templates/FeatureInfo.html":s.template=function(){dust.register(s.CLASS,e);function e(e,n){return e.x(n.get(["elevation"],!1),n,{block:t},{}).w('<ul class="tc-ctl-finfo-services">').s(n.get(["services"],!1),n,{else:i,block:a},{}).w("</ul>").x(n.get(["featureCount"],!1),n,{block:N},{})}e.__dustBody=!0;function t(e,t){return e.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(t.get(["crs"],!1),t,"h").w("</span></span> ").x(t.get(["isGeo"],!1),t,{else:n,block:r},{}).w(' <span class="tc-ctl-finfo-coords-pair">').h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.get(["elevation"],!1),t,"h").w(" m</span></span></div>")}t.__dustBody=!0;function n(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w("</span></span> ")}n.__dustBody=!0;function r(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w("</span></span> ")}r.__dustBody=!0;function i(e,t){return e.nx(t.get(["elevation"],!1),t,{block:o},{})}i.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}o.__dustBody=!0;function a(e,t){return e.w("<li><h3>").x(t.get(["title"],!1),t,{else:l,block:h},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:p,block:_},{}).w("</div></li>")}a.__dustBody=!0;function l(e,t){return e.x(t.getPath(!1,["layers","0","title"]),t,{else:c,block:u},{})}l.__dustBody=!0;function c(e,t){return e.f(t.getPath(!1,["layer","name"]),t,"h")}c.__dustBody=!0;function u(e,t){return e.f(t.getPath(!1,["layers","0","title"]),t,"h")}u.__dustBody=!0;function h(e,t){return e.f(t.get(["title"],!1),t,"h")}h.__dustBody=!0;function p(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:d,block:f},{}).w("</ul>")}p.__dustBody=!0;function d(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}d.__dustBody=!0;function f(e,t){return e.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w("</span> ").s(t.get(["path"],!1),t,{block:y},{}).w('</h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:g,block:C},{}).w("</ul></div></li>")}f.__dustBody=!0;function y(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:m},{})}y.__dustBody=!0;function m(e,t){return e.w(" &bull; ")}m.__dustBody=!0;function g(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}g.__dustBody=!0;function C(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:v,block:w},{}).w("</li>")}C.__dustBody=!0;function v(e,t){return e.x(t.get(["error"],!1),t,{else:T,block:b},{})}v.__dustBody=!0;function T(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:L},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:S},{}).w("</tbody></table>")}T.__dustBody=!0;function L(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToShowOnMap"}).w('"')}L.__dustBody=!0;function S(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}S.__dustBody=!0;function b(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}b.__dustBody=!0;function w(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:E,block:O},{key:t.get(["rawFormat"],!1),value:"text/html"})}w.__dustBody=!0;function E(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}E.__dustBody=!0;function O(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:A},{})}O.__dustBody=!0;function A(e,t){return e.h("ne",t,{else:x,block:P},{key:t.get(["expandUrl"],!1),value:""})}A.__dustBody=!0;function x(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe>')}x.__dustBody=!0;function P(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}P.__dustBody=!0;function _(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}_.__dustBody=!0;function N(e,t){return e.h("gt",t,{block:M},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}N.__dustBody=!0;function M(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}M.__dustBody=!0;return e};s.register=function(e){const t=this,n=TC.control.Click.prototype.register.call(t,e);t._createLayers();e.loaded(function(){const n=e.getControlsByClass("TC.control.Share")[0];n&&t.loadSharedFeature(n.loadParamFeature())});t.displayMode=t.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;t.setDisplayMode(t.displayMode);e.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.getDisplayControl()&&t.resultsLayer){if(t.highlightedFeature){t.resultsLayer.removeFeature(t.highlightedFeature);t.highlightedFeature=null}t.querying||t.filterLayer.clearFeatures()}}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){t.highlightedFeature=null}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){const n=e.control;n.currentFeature!==t.filterFeature&&(t.highlightedFeature=n.currentFeature);e.control.currentFeature&&e.control.currentFeature.layer&&t.filterLayer&&t.resultsLayer&&[t.filterLayer.id,t.resultsLayer.id].indexOf(e.control.currentFeature.layer.id)>-1&&t._decorateDisplay(n)}).on(TC.Consts.event.DRAWCHART,function(e){setTimeout(function(){t.highlightedFeature=e.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(t.info&&t.info.services){const r={};t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS}).forEach(function(e){const t=r[e.url]||[];r[e.url]=t.concat(e.getDisgregatedLayerNames())});for(var e=0,n=t.info.services.length;e<n;e++){const n=t.info.services[e],i=r[n.mapLayers[0].url]||[];if(!n.layers.reduce(function(e,t){return e.concat(t.name)},[]).every(function(e){return i.indexOf(e)>=0})){t.downplayFeatures();t.info=null;t.closeResults();break}}}}).on(TC.Consts.event.VIEWCHANGE,function(e){t.closeResults()});return n};s.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};s.responseCallback=function(e){const t=this;t.querying=!1;t.filterFeature&&(t.info={services:e.services});if(e.featureCount){t._addSourceAttributes();t.lastFeatureCount=e.featureCount;t.map.trigger(TC.Consts.event.FEATUREINFO,$.extend({control:t},e))}else{t.lastFeatureCount=0;t.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:t});t.closeResults()}};s.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.responseCallback({})};s.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};s.setDisplayMode=function(e){var t=this;t.displayMode=e;var n=t.map;switch(e){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!t.resultsPanel){var r=n.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.options.content})[0];if(r){t.resultsPanel=r;r.caller=t}else{n.on(TC.Consts.event.CONTROLADD,function e(r){const i=r.control;if(TC.control.ResultsPanel&&i instanceof TC.control.ResultsPanel){t.resultsPanel=i;i.caller=t;n.off(TC.Consts.event.CONTROLADD,e)}})}}break;default:t.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;t.popup||n.addControl("popup",{closeButton:!0,draggable:t.options.draggable}).then(function(e){t.popup=e;e.caller=t;n.on(TC.Consts.event.POPUP,function(e){t.onShowPopup(e)});n.on(TC.Consts.event.POPUPHIDE,function(n){n.control===e&&t._resetSize()})})}};s.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};s.getDisplayTarget=function(e){if((e=e||{}).control)switch(!0){case TC.control.Popup&&e.control instanceof TC.control.Popup:return e.control.getContainerElement();case TC.control.ResultsPanel&&e.control instanceof TC.control.ResultsPanel:return e.control.getTableContainer();default:return null}switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getTableContainer();default:return this.popup.getContainerElement()}};s.getMenuTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};s.displayResults=function(){var e=this;const t=e.div.cloneNode(!0);t.classList.remove(TC.Consts.classes.HIDDEN);e.filterFeature.data=t.outerHTML;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(e.resultsPanel){if(0===e.map.getControlsByClass(TC.control.ControlContainer).length)e.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(e){e.isVisible()&&e.close()});else{e.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t!==e.resultsPanel&&t.currentFeature&&t.close()})}e.resultsPanel.currentFeature=e.filterFeature;e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer());e.displayResultsCallback()}break;default:e.popup&&e.filterFeature.showPopup(e.popup)}};const o=function(e){return Array.from(e.parentElement.childNodes).indexOf(e)},a=function(e,t){var n=e;do{n=n.parentElement}while(n&&n.tagName!==t);return n};s.getFeatureElement=function(e){const t=this;var n;t.getDisplayTarget().querySelectorAll(t._selectors.LIST_ITEM).forEach(function(r){const i=r,s=a(r,"LI"),l=a(s,"LI");t.getFeature(o(l),o(s),o(i))===e&&(n=i)});return n};s.getNextFeatureElement=function(e){const t=this.getDisplayTarget().querySelectorAll("ul."+this.CLASS+"-features > li"),n=t.length;for(var r=0;r<n;r++)if(t[r].matches("."+TC.Consts.classes.CHECKED))return t[(r+e+n)%n];return null};s.getFeaturePath=function(e){const t=this;if(t.info&&t.info.services)for(var n=0,r=t.info.services.length;n<r;n++){const r=t.info.services[n];for(var i=0,s=r.layers.length;i<s;i++){const t=r.layers[i];for(var o=0,a=t.features.length;o<a;o++)if(t.features[o]===e)return{service:r.title||r.mapLayers.reduce(function(e,t){return e||t.title},""),layer:t.path}}}return null};s.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};s.displayResultsCallback=function(){var e=this;const t=e.getDisplayTarget().querySelector("."+e.CLASS);var n,r="click";t.addEventListener(r,TC.EventTarget.listenerBySelector(e._selectors.LIST_ITEM,function(t){e.highlightFeature(t.target)}));r=TC.Consts.event.CLICK;n="."+e.CLASS+"-btn-next";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.highlightFeature(e.getNextFeatureElement(1),1);return!1}));n="."+e.CLASS+"-btn-prev";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.highlightFeature(e.getNextFeatureElement(-1),-1);return!1}));n="ul."+e.CLASS+"-layers h4";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(n){const r=a(n.target,"LI");if(r.classList.contains(TC.Consts.classes.CHECKED))t.querySelector(".tc-ctl-finfo-btn-next")&&"none"===t.querySelector(".tc-ctl-finfo-btn-next").style.display&&i(e)>1&&e.downplayFeatures();else{e.highlightFeature(r.querySelector(e._selectors.LIST_ITEM));e.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&e.popup.fitToView(!0)}}));n="."+e.CLASS+"-del-btn";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.downplayFeatures();e.closeResults()}));if(e.info)if(e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)){e.getFeatureElement(e.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);e.highlightFeature(e.info.defaultFeature)}else t.querySelector(e._selectors.LIST_ITEM)&&e.highlightFeature(t.querySelector(e._selectors.LIST_ITEM));t.querySelectorAll("table").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){const n=this.parentElement;if(!n.classList.contains(TC.Consts.classes.DISABLED)){if(n.classList.contains(TC.Consts.classes.CHECKED)){if(e.resultsLayer.features[0]&&window.getSelection()&&0===window.getSelection().toString().trim().length){e.map.on(TC.Consts.event.ZOOM,function t(){e._zooming=!1;e.map.off(TC.Consts.event.ZOOM,t)});e._zooming=!0;e.map.zoomToFeatures([e.resultsLayer.features[0]],{animate:!0})}}else e.highlightFeature(n);t.stopPropagation()}})});t.querySelectorAll("table a").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation()})});if(Modernizr.touch&&e.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&t.querySelector("."+e.CLASS+"-btn-prev")&&"none"!==t.querySelector("."+e.CLASS+"-btn-prev").style.display){e.resultsPanel&&TC.Util.swipe(e.resultsPanel.div,"disable");i(e)>1&&TC.Util.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}})}};s.onShowPopup=function(e){this.map;if(e.control===this.popup){this.displayResultsCallback();this._fitSize()}};s.loadSharedFeature=function(e){};s.insertLinks=function(){const e=this.getLocaleString("open"),t=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(n){const r=n.textContent;TC.Util.isURL(r)&&(n.innerHTML='<a href="'+r+'" target="_blank" title="'+t+'">'+e+"</a>")})};s.highlightFeature=function(e,t){const n=this;var r;if(!n._zooming){var i;if(e instanceof TC.Feature){r=e;i=n.getFeatureElement(r)}else{i=e;for(;i&&"LI"!==i.tagName;)i=i.parentElement}const u=a(i,"LI"),h=a(u,"LI"),p=o(h),d=o(u),f=o(i);r=r||n.getFeature(p,d,f);n.downplayFeatures({exception:r});i.classList.add(TC.Consts.classes.CHECKED);u.classList.add(TC.Consts.classes.CHECKED);h.classList.add(TC.Consts.classes.CHECKED);if(t>0){i.classList.add(TC.Consts.classes.FROMLEFT);u.classList.add(TC.Consts.classes.FROMLEFT);h.classList.add(TC.Consts.classes.FROMLEFT)}else if(t<0){i.classList.add(TC.Consts.classes.FROMRIGHT);u.classList.add(TC.Consts.classes.FROMRIGHT);h.classList.add(TC.Consts.classes.FROMRIGHT)}i.querySelector("table")&&i.querySelector("table").setAttribute("title",n.getLocaleString("clickToCenter"));n.highlightedFeature=r;n.getDisplayTarget().querySelector("."+n.CLASS+"-counter-current")&&(n.getDisplayTarget().querySelector("."+n.CLASS+"-counter-current").innerHTML=n.getFeatureIndex(p,d,f)+1);var s=n.resultsLayer.features.slice();if(s.filter(function(e){return r&&r.id===e.id}).length>0)return;for(var l=0;l<s.length;l++){var c=s[l];c!==n.filterFeature&&n.resultsLayer.removeFeature(c)}r&&r.geometry?n.resultsLayer.addFeature(r):i.classList.add(TC.Consts.classes.DISABLED)}};s.downplayFeatures=function(e){const t=this;e=e||{};t.highlightedFeature!==e.exception&&(t.highlightedFeature=null);const n=e.exception?t.getFeatureElement(e.exception):void 0;var r,i;if(n){r=a(n,"LI");i=a(r,"LI")}t.resultsLayer.clearFeatures();const s=t.getDisplayTarget();Array.from(s.querySelectorAll("ul."+t.CLASS+"-services li")).filter(function(e){return e!==n&&e!==r&&e!==i}).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.classList.remove(TC.Consts.classes.DISABLED);e.classList.remove(TC.Consts.classes.FROMLEFT);e.classList.remove(TC.Consts.classes.FROMRIGHT)});s.querySelectorAll("."+t.CLASS+"-features table").forEach(function(e){e.setAttribute("title",t.getLocaleString("clickToShowOnMap"))})};s._fitSize=function(){const e=this.getDisplayTarget();var t=0;e.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(e){t=Math.max(t,e.offsetLeft+e.offsetWidth)});t&&(e.style.width=t+50+"px")};s._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};s.getFeature=function(e,t,n){var r;const i=this.info;i&&i.services&&(r=i.services[e])&&(r=r.layers[t])&&(r=r.features[n]);return r};s.getFeatureIndex=function(e,t,n){var r=-1;const i=this.info;if(i)for(var s=0;s<=e;s++)for(var o=i.services[s],a=s===e?t:o.layers.length-1,l=0;l<=a;l++)for(var c=o.layers[l],u=l===t?n:c.features.length-1,h=0;h<=u;h++)r+=1;return r};s.beforeRequest=function(e){var t=this;t.querying=!0;t.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:e.xy,control:t});t.closeResults();if(t.map&&t.resultsLayer){t.lastFeatureCount=null;t.resultsLayer.features.forEach(function(e){t.resultsLayer.removeFeature(e)});t.info=null}};s.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};s.deactivate=function(e){this.popup&&this.popup.hide();this.resultsLayer.clearFeatures();this.filterLayer.clearFeatures();this.wrap&&this.wrap.deactivate();TC.Control.prototype.deactivate.call(this,e)};s.exportState=function(){const e=this;return e.exportsState&&e.resultsLayer?{id:e.id,layer:e.resultsLayer.exportState()}:null};s.importState=function(e){const t=this;t._layersPromise.then(function(){t.resultsLayer.importState(e.layer)})};s._createLayers=function(){const e=this;var t,n;t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};n=e.options.filterLayer?e.options.filterLayer:{id:e.getUID(),title:e.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:e.lineColor,strokeWidth:2},polygon:{strokeColor:e.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};const r=e.map;e._layersPromise=new Promise(function(i,s){r.loaded(function(){Promise.all([r.addLayer(t),r.addLayer(n)]).then(function(t){e.resultsLayer=t[0];e.filterLayer=t[1];i()})})});return e._layersPromise};s._decorateDisplay=function(e){const t=this,n=t.getDisplayTarget({control:e});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!n.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var r=t.getLocaleString("feature");if(e===t.getDisplayControl())if(TC.feature.Point&&t.filterFeature instanceof TC.feature.Point){const e=t.filterFeature.geometry;r=t.getLocaleString("featuresAt",{crs:t.map.crs,x:TC.Util.formatNumber(e[0],t.map.locale),y:TC.Util.formatNumber(e[1],t.map.locale)})}else r=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(r=e.currentFeature.id);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&new TC.control.Print({target:n,title:r})}})};s._addSourceAttributes=function(){const e=this,t="h3_"+e.getLocaleString("service"),n="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach(function(r){r.layers.forEach(function(r){r.features.forEach(function(r){if(r instanceof TC.Feature){const i=e.getFeaturePath(r);if(i){const s={};s[t]=i.service;i.layer&&(s[n]=i.layer.join(e.TITLE_SEPARATOR));const o=$.extend(s,r.getData());r.clearData();r.setData(o)}}})})})}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Scale.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:n,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}t.__dustBody=!0;function n(e,t){return e.f(t.get(["scale"],!1),t,"h")}n.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){const n=t.div.querySelector("span");n.textContent="1:"+t.format(n.textContent.substr(2));t.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){t.setScreenSize()});$.isFunction(e)&&e()}))};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);var r=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);r&&(TC.Cfg.screenSize=r);t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree;t.update()})});return n};e.update=function(){this.render()};e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){if(t){TC.Cfg.screenSize=parseFloat(t);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);e.update()}})};e.getScale=function(e){var t=0,n=!e&&this.map?this.map.wrap.getResolution():e;if(n){t=n*this.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(t*=window.devicePixelRatio)}if(this.map&&this.map.wrap.isGeo()){if(!this.metersPerDegree){var r=this.map.getExtent();r&&(this.metersPerDegree=TC.Util.getMetersPerDegree(r))}this.metersPerDegree&&(t*=this.metersPerDegree)}return t};e.getDpi=function(e){this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e;return this.dpi};e.format=function(e){for(var t=new Number(e).toFixed(0),n=[];t.length>3;){var r=t.length-3;n.unshift(t.substr(r));t=t.substr(0,r)}t&&n.unshift(t);return n.join(".")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){TC.Control.apply(this,arguments);this.serviceWorkerEnabled=!1};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t._swPromise=new Promise(function(e,n){navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(n){t.serviceWorkerEnabled=!0;n.installing?e(n.installing):n.waiting?e(n.waiting):n.active&&e(n.active);console.log(n.scope,"register")},function(e){t.serviceWorkerEnabled=!1;n();console.error("Could not register service worker: "+e)}):n(new Error("Browser does not support service workers"))});return n};e.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var t=function(e,t,n,r,i){navigator.serviceWorker.addEventListener("message",function s(o){if(o.data.name===n){o.data.action===r&&o.data.event===i?e(n):"error"===o.data.event&&t();navigator.serviceWorker.removeEventListener("message",s)}})};e.createCache=function(e,n){var r=this;return new Promise(function(i,s){r.getServiceWorker().then(function(r){var o=n||{};t(i,s,e,"create","cached");r.postMessage({action:"create",name:e,list:o.urlList||[],silent:o.silent})},function(){i(!1)})})};e.deleteCache=function(e,n){var r=this;return new Promise(function(i,s){r.getServiceWorker().then(function(r){var o=n||{};t(i,s,e,"delete","deleted");r.postMessage({action:"delete",name:e,silent:o.silent})},function(){i(!1)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);e.drawControls=[];e.persistentDrawControls=!1;e.NOMEASURE="-";e.exportsState=!0;this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._len=e.div.querySelector(".tc-ctl-meas-val-len");e._area=e.div.querySelector(".tc-ctl-meas-val-area");e._peri=e.div.querySelector(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Measure.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}t.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);t.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var n=this;n&&"LABEL"!==n.tagName;)n=n.parentElement;var r=n.querySelector("input[type=radio][name=mode]"),i=r.value;r.checked=!0;t.setMode(i,!0)})});$.isFunction(e)&&e()})}))};e.register=function(e){const t=this;return new Promise(function(n,r){TC.Control.prototype.register.call(t,e).then(function(){t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.trigger(TC.Consts.event.DRAWEND)});const i=t.getUID(),s=t.getUID(),o=t.getUID();t.layerPromise=e.addLayer({id:i,title:t.getLocaleString("measure"),stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}});Promise.all([t.layerPromise,t.renderPromise()]).then(function(i){const a=i[0];t.layer=a;t.layer.map.putLayerOnTop(t.layer);t._drawLinesPromise=e.addControl("draw",{id:s,div:t.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});t._drawPolygonsPromise=e.addControl("draw",{id:o,div:t.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});Promise.all([t._drawLinesPromise,t._drawPolygonsPromise]).then(function(e){t.drawLines=e[0];t.drawPolygons=e[1];e.forEach(function(e){e.containerControl=t;t.drawControls.push(e);e.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(e){t.showMeasures(e)}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)});e.exportsState=!1});n(t);t.setMode(t.options.mode)}).catch(r)}).catch(r)})})};e.displayMode=function(e){const t=this,n=[];t.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(e){n.push(e)});switch(e){case TC.Consts.geom.POLYLINE:t._activeMode=n.filter(function(e){return e.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:t._activeMode=n.filter(function(e){return e.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:t._activeMode=null}const r=n.filter(function(e){return e!==t._activeMode});if(e){const n=t.div.querySelector("input[type=radio][name=mode][value="+e+"]");n.checked=!0;n.classList.add(TC.Consts.classes.CHECKED);n.nextSibling.classList.add(TC.Consts.classes.CHECKED)}else t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.checked=!1;e.classList.remove(TC.Consts.classes.CHECKED);e.nextSibling.classList.remove(TC.Consts.classes.CHECKED)});if(t._activeMode){t._activeMode.classList.remove(TC.Consts.classes.HIDDEN);t._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}r.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});return t};e.setMode=function(e){const t=this;t.mode=e;t.displayMode(e);var n;switch(e){case TC.Consts.geom.POLYLINE:t.drawLines.activate();n=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:t.drawPolygons.activate();n=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach(function(e){e.isActive&&e.cancel()});n=TC.Consts.event.CONTROLDEACTIVATE;break;default:n=TC.Consts.event.CONTROLACTIVATE}t.resetValues();n&&t.map&&t.map.trigger(n,{control:t});return t};e.cancel=function(){this.setMode(null,!1);return this};e.showMeasures=function(e){const t=this;var n,r=(e=e||{}).units;const i=t.map.options.locale||TC.Cfg.locale;if(e.area){var s=e.area;if(s>1e4){s/=1e6;r="km"}n="m"===r?0:3;t._area.innerHTML=TC.Util.formatNumber(s.toFixed(n),i)+" "+r+"&sup2;"}if(e.perimeter){var o=e.perimeter;if(o>1e3){o/=1e3;r="km"}n="m"===r?0:3;t._peri.innerHTML=TC.Util.formatNumber(o.toFixed(n),i)+" "+r}if(e.length){var a=e.length;if(a>1e3){a/=1e3;r="km"}n="m"===r?0:3;t._len.innerHTML=TC.Util.formatNumber(a.toFixed(n),i)+" "+r}return t};e.resetValues=function(){const e=this;if(e._len){e._len.textContent=e.NOMEASURE;e._area.textContent=e.NOMEASURE;e._peri.textContent=e.NOMEASURE}return e};e.getDrawLines=function(){};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.layerPromise.then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const e=this;TC.Control.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+e._cssClasses.LOAD_CRS_BUTTON+")",function(t){const n=t.target.dataset.crsCode;n&&e.setProjection({crs:n,allowFallbackLayer:!0})}));e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+e._cssClasses.LOAD_CRS_BUTTON,function(t){e.loadFallbackProjections()}))};TC.inherit(TC.control.ProjectionSelector,TC.Control);const e=TC.control.ProjectionSelector.prototype;e.CLASS="tc-ctl-projs";e.render=function(e){const t=this,n=TC.Control.prototype.render.call(t,e);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e});return n};e.getAvailableCRS=function(e){return this.map.getCompatibleCRS({includeFallbacks:!0})};e.showProjectionChangeDialog=function(e){const t=this,n=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG),r=n.querySelector(".tc-modal-body");r.classList.add(TC.Consts.classes.LOADING);const i=r.querySelector("ul."+t._cssClasses.CRS_LIST);i.innerHTML="";const s=t.map.baseLayer.firstOption||t.map.baseLayer,o=s.getFallbackLayer(),a=s.getCompatibleCRS(),l=function(){t.map.loadProjections({crsList:t.getAvailableCRS(e),orderBy:"name"}).then(function(e){var s=!1;e.forEach(function(e){if(TC.Util.CRSCodesEqual(t.map.crs,e.code)){n.querySelector("."+t._cssClasses.CURRENT_CRS_NAME).textContent=e.name;n.querySelector("."+t._cssClasses.CURRENT_CRS_CODE).textContent=e.code}else{const t=document.createElement("button");t.textContent=e.name+" ("+e.code+")";t.dataset.crsCode=e.code;const n=document.createElement("li");n.appendChild(t);if(0===a.filter(function(t){return TC.Util.CRSCodesEqual(t,e.code)}).length){s=!0;n.classList.add(TC.Consts.classes.HIDDEN);t.classList.add(TC.Consts.classes.WARNING)}i.appendChild(n)}});if(s){const e=document.createElement("li"),n=document.createElement("button");n.classList.add(t._cssClasses.LOAD_CRS_BUTTON);n.innerHTML=t.getLocaleString("showOnTheFlyProjections");e.appendChild(n);i.appendChild(e)}if(0===i.querySelectorAll("li").length){const e=document.createElement("li");e.innerHTML=t.getLocaleString("thereAreNoCompatibleCRS");i.appendChild(e)}const o=i.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");n.querySelectorAll("."+t._cssClasses.CHANGE).forEach(function(e){e.style.display=o.length>1?"":"none"});n.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=o.length>1?"none":""});n.querySelector("ul."+t._cssClasses.CRS_LIST).style.display=o.length>0||s?"":"none";r.classList.remove(TC.Consts.classes.LOADING)})};o?o.getCapabilitiesPromise().then(l):l();TC.Util.showModal(n,e)};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e)}})};e.loadFallbackProjections=function(){const e=this,t=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li");t.forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(e){e.style.display=t.length>1?"":"none"});e._dialogDiv.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=t.length>1?"none":""})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Container=function(){TC.Control.apply(this,arguments);this.controlOptions=this.options.controls||[];this.ctlCount=this.controlOptions instanceof Array?this.controlOptions.length:Object.keys(this.controlOptions).length;this.defaultSelection=this.options.defaultSelection};TC.inherit(TC.control.Container,TC.Control);!function(){var e=TC.control.Container.prototype;e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.uids=new Array(t.ctlCount);t.uids.forEach(function(e,n,r){r[n]=t.getUID()});return new Promise(function(e,r){Promise.all([n,t.renderPromise()]).then(function(){t.onRenderPromise();e()})})};e.onRenderPromise=function(){};e.render=function(e){};e.getControl=function(e){var t=this._ctlPromises[e];return t||new Promise(function(e,t){t()})}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.TabContainer=function(){TC.control.Container.apply(this,arguments);var e=this._classSelector="."+this.CLASS;this._selectors={TAB:e+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:e+"-elm"}};TC.inherit(TC.control.TabContainer,TC.control.Container);!function(){var e=TC.control.TabContainer.prototype;e.CLASS="tc-ctl-tctr";TC.isDebug?e.template=TC.apiLocation+"TC/templates/TabContainer.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").f(t.get(["title"],!1),t,"h").w('</h2><div class="tc-ctl-tctr-select"><form>').s(t.get(["controls"],!1),t,{block:n},{}).w("</form></div>").s(t.get(["controls"],!1),t,{block:r},{})}t.__dustBody=!0;function n(e,t){return e.w('<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-').f(t.get(["$idx"],!1),t,"h").w('" style="width:calc(100%/').f(t.get(["$len"],!1),t,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(t.get(["$idx"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label>")}n.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-').f(t.get(["$idx"],!1),t,"h").w(' tc-hidden"></div>')}r.__dustBody=!0;return t};e.onRenderPromise=function(){const e=this;e.title=e.title||e.getLocaleString(e.options.title||"moreControls");e.div.querySelector("h2").innerHTML=e.title;for(var t=new Array(e.ctlCount),n=0,r=e.controlOptions.length;n<r;n++){var i=e.controlOptions[n];t[n]=e.map.addControl(i.name,$.extend({id:e.uids[n],div:e.div.querySelector("."+e.CLASS+"-elm-"+n)},i.options))}var s=function(t,n){t.renderPromise().then(function(){const r=e.getLocaleString(e.controlOptions[n].title)||t.div.querySelector("h2").innerHTML;var i=t.div;do{i=i.parentElement}while(i&&!i.matches(e._classSelector));i.querySelector(e._selectors.TAB+"-"+n+" span").innerHTML=r})};Promise.all(t).then(function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n];i.containerControl=e;s(i,n)}})};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({title:t.title,controls:t.controlOptions},function(){var e=function(e){for(var n=this;n&&!n.matches(t._selectors.TAB);)n=n.parentElement;var r,i=[];const s=n.querySelector(t._selectors.RADIOBUTTON),o=s.value,a=t.div.querySelectorAll(t._selectors.ELEMENT);if(t._oldValue===o&&t.options.deselectable){setTimeout(function(){s.checked=!1},0);t._oldValue=null;r=null;i=a}else{a.forEach(function(e){e.matches(t._selectors.ELEMENT+"-"+o)?r=e:i.push(e)});t._oldValue=o}r&&r.classList.remove(TC.Consts.classes.HIDDEN);i.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});s.checked=!0};t.div.querySelectorAll("span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,e)});"number"==typeof t.defaultSelection&&e.call(t.div.querySelectorAll(t._selectors.RADIOBUTTON)[t.defaultSelection])}))}}();window.OpenLayers||TC.syncLoadJS(TC.url.ol);!function(){OpenLayers._getScriptLocation=function(){var e=OpenLayers._getScriptLocation();e||(e=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/")+1));return function(){return e}}();OpenLayers.CustomTheme=TC.apiLocation+"OpenLayers/theme/tcsa/style.css";OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{fillColor:TC.Cfg.styles.polygon.fillColor,fillOpacity:TC.Cfg.styles.polygon.fillOpacity,strokeColor:TC.Cfg.styles.line.strokeColor,strokeWidth:TC.Cfg.styles.line.strokeWidth});OpenLayers.Format.XML.prototype._write=OpenLayers.Format.XML.prototype.write;OpenLayers.Format.XML.prototype.write=function(){var e=OpenLayers.Format.XML.prototype._write.apply(this,arguments);return e=e.replace(new RegExp('xmlns:NS\\d+="" NS\\d+:',"g"),"")};OpenLayers.Control.PanZoom.prototype.onButtonClick=function(e){switch(e.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToExtent(this.map.options.extent)}};OpenLayers.Control.OverviewMap.prototype._updateOverview=OpenLayers.Control.OverviewMap.prototype.updateOverview;OpenLayers.Control.OverviewMap.prototype.updateOverview=function(){(this.active||null===this.active)&&this._updateOverview()};OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var n=e.documentElement;if(n){var r=this["read_"+n.nodeName];t=r?r.call(this,n):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],n=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(n)for(var r=0,i=n.length;r<i;++r){var s=n[r],o=s.nodeName;s.prefix&&(o=o.split(":")[1]);o=o.replace(this.layerIdentifier,"");var a=this.getSiblingNodesByTagCriteria(s,this.featureIdentifier);if(a)for(var l=0;l<a.length;l++){var c=a[l],u=this.parseGeometry(c),h=this.parseAttributes(c),p=new OpenLayers.Feature.Vector(u.geometry,h,null);p.bounds=u.bounds;p.type=o;t.push(p)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"*","FIELDS"),r=0,i=n.length;r<i;r++){var s,o=n[r],a={},l=o.attributes.length;if(l>0)for(s=0;s<l;s++){var c=o.attributes[s];a[c.nodeName]=c.nodeValue}else{var u=o.childNodes;for(s=0,l=u.length;s<l;++s){var h=u[s];3!=h.nodeType&&(a[h.getAttribute("name")]=h.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(null,a,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var n,r,i,s,o,a=[];if(e&&e.hasChildNodes()){i=(n=e.childNodes).length;for(var l=0;l<i;l++){o=n[l];for(;o&&1!=o.nodeType;){o=o.nextSibling;l++}(r=o?o.nodeName:"").length>0&&r.indexOf(t)>-1?a.push(o):(s=this.getSiblingNodesByTagCriteria(o,t)).length>0&&(0==a.length?a=s:a.push(s))}}return a},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var n=e.childNodes,r=n.length,i=0;i<r;++i){var s=n[i];if(1==s.nodeType){var o=s.childNodes,a=s.prefix?s.nodeName.split(":")[1]:s.nodeName;if(0==o.length)t[a]=null;else if(1==o.length){var l=o[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[a]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,n=this.gmlFormat.parseFeature(e),r=null;if(n){t=n.geometry&&n.geometry.clone();r=n.bounds&&n.bounds.clone();n.destroy()}return{geometry:t,bounds:r}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Format.GML.prototype._oldParseFeature=OpenLayers.Format.GML.prototype.parseFeature;OpenLayers.Format.GML.prototype.parseFeature=function(e){this.externalProjection=null;for(var t,n,r=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],i=0;i<r.length;++i){t=r[i];if((n=this.getElementsByTagNameNS(e,this.gmlns,t)).length>0){var s=n[0].getAttribute("srsName");if(s){TC.loadProjDef({crs:s,sync:!0});this.externalProjection=new OpenLayers.Projection("EPSG:"+s.substr(s.lastIndexOf("#")+1))}break}}return this._oldParseFeature(e)};OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){(e=e||{}).handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));!0===this.drillDown&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,n=this.layers||this.map.layers,r=[],i=n.length-1;i>=0;--i)if((e=n[i])instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;!1!==this.drillDown||this.url||(this.url=t);(!0===this.drillDown||this.urlMatches(t))&&r.push(e)}return r},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var n=0,r=this.layerUrls.length;n<r;++n)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[n],e)){t=!0;break}return t},buildWMSOptions:function(e,t,n,r){for(var i=[],s=[],o=0,a=t.length;o<a;o++)if(null!=t[o].params.LAYERS){i=i.concat(t[o].params.LAYERS);s=s.concat(this.getStyleNames(t[o]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var h=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:r,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(n.x),j:parseInt(n.y)}:{srs:c,x:parseInt(n.x),y:parseInt(n.y)});0!=i.length&&(h=OpenLayers.Util.extend({layers:i,query_layers:i,styles:s},h));OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(h),callback:function(t){this.handleResponse(n,t,e)},scope:this}},getStyleNames:function(e){return e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){if(0!=(i=this.findLayers()).length){t=t||{};if(!1===this.drillDown){var n=this.buildWMSOptions(this.url,i,e,i[0].params.FORMAT),r=OpenLayers.Request.GET(n);!0===t.hover&&(this.hoverRequest=r)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var i,s={},o=0,a=i.length;o<a;o++){var l=i[o];if((c=OpenLayers.Util.isArray(l.url)?l.url[0]:l.url)in s)s[c].push(l);else{this._numRequests++;s[c]=[l]}}for(var c in s){i=s[c];n=this.buildWMSOptions(c,i,e,i[0].params.FORMAT);OpenLayers.Request.GET(n)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,n){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:n,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,n){var r=t.responseXML;r&&r.documentElement||(r=t.responseText);var i=this.format.read(r);if(!1===this.drillDown)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;"object"===this.output?this._features=(this._features||[]).concat({url:n,features:i}):this._features=(this._features||[]).concat(i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse=OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse;OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"]=function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"http://www.esri.com/wms","FeatureInfoCollection"),r=0;r<n.length;r++)for(var i=n[r],s=this.getElementsByTagNameNS(i,"http://www.esri.com/wms","FeatureInfo"),o=0;o<s.length;o++){for(var a=s[o],l=this.getElementsByTagNameNS(a,"http://www.esri.com/wms","FieldName"),c=this.getElementsByTagNameNS(a,"http://www.esri.com/wms","FieldValue"),u={},h=0;h<l.length;h++){var p=l[h],d=c[h],f=void 0===p.textContent?"text":"textContent";u[p[f]]=d[f]}var y=new OpenLayers.Feature.Vector(null,u,null);y.type=i.getAttribute("layername");t.push(y)}return t};OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse=function(e){return"http://www.esri.com/wms"===e.namespaceURI?OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"].call(this,e):OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse.call(this,e)};!function(){var e=!!window.controllers,t=window.document.all&&!window.opera;t&&window.navigator.userAgent.match(/MSIE 7.0/);function n(e){OpenLayers.Request.XMLHttpRequest.onreadystatechange&&OpenLayers.Request.XMLHttpRequest.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function r(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=fGetDocument(e._object)}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function i(e){e._object.onreadystatechange=new window.Function}OpenLayers.Request.XMLHttpRequest.prototype.open=function(s,o,a,l,c){(function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(this.URL_SPLIT_REGEX);if(n){var r=window.location;t=n[1]==r.protocol&&n[3]==r.hostname;var i=n[4],s=r.port;(80!=i&&""!=i||"80"!=s&&""!=s)&&(t=t&&i==s)}return t})(o)||"withCredentials"in this._object||!window.XDomainRequest||(this._object=new window.XDomainRequest);delete this._headers;arguments.length<3&&(a=!0);this._async=a;var u,h=this,p=this.readyState;if(t&&a){u=function(){if(p!=OpenLayers.Request.XMLHttpRequest.DONE){i(h);h.abort()}};window.attachEvent("onunload",u)}OpenLayers.Request.XMLHttpRequest.onopen&&OpenLayers.Request.XMLHttpRequest.onopen.apply(this,arguments);arguments.length>4?this._object.open(s,o,a,l,c):arguments.length>3?this._object.open(s,o,a,l):this._object.open(s,o,a);this.readyState=OpenLayers.Request.XMLHttpRequest.OPENED;n(this);"withCredentials"in this._object||"onreadystatechange"in this._object?this._object.onreadystatechange=function(){if(!e||a){h.readyState=h._object.readyState;r(h);if(h._aborted)h.readyState=OpenLayers.Request.XMLHttpRequest.UNSENT;else{if(h.readyState==OpenLayers.Request.XMLHttpRequest.DONE){delete h._data;i(h);t&&a&&window.detachEvent("onunload",u)}p!=h.readyState&&n(h);p=h.readyState}}}:this._object.onload=function(){if(!e||a){h.readyState=OpenLayers.Request.XMLHttpRequest.DONE;h._object.status=200;h._object.statusText="OK";r(h);delete h._data;t&&a&&window.detachEvent("onunload",u);h.onreadystatechange()}}};OpenLayers.Request.XMLHttpRequest.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return"setRequestHeader"in this._object?this._object.setRequestHeader(e,t):void this._object}}();OpenLayers.Format.KML.prototype._getNodeText=function(e){var t="";void 0!==e.textContent?t=e.textContent:void 0!==e.innerHTML?t=e.innerHTML:void 0!==e.text&&(t=e.text);return t};OpenLayers.Format.KML.prototype._getFolderHierarchy=function(e){var t=[],n=e;if(n.parentNode)do{if("folder"==(n=n.parentNode).nodeName.toLowerCase()){var r;n.childNodes&&n.childNodes.length&&n.childNodes.length>0&&("name"==n.childNodes[0].nodeName?r=this._getNodeText(n.childNodes[0]):n.childNodes.length>1&&(r=this._getNodeText(n.childNodes[1])));r&&t.push(r)}}while(null!==n.parentNode&&"document"!==n.parentNode.nodeName.toLowerCase());t.reverse();this._folderTree||(this._folderTree={children:[]});TC.Util.addArrayToTree(t,this._folderTree);return t};OpenLayers.Format.KML.prototype.parserTimeout=0;OpenLayers.Format.KML.prototype.parseFeatures=function(e,t){for(var n,r,i=[],s=new Date,o=0,a=e.length;o<a;o++){if(this.parserTimeout>0&&o%10==0&&o>0){n=new Date;if((r=parseInt(n.getTime()-s.getTime()))>this.parserTimeout)throw"El archivo KML es demasiado complejo para este navegador."+r+"ms, "+o+" features"}var l=e[o],c=this.parseFeature.apply(this,[l]);if(!c)throw"Bad Placemark: "+o;this.extractStyles&&c.attributes&&c.attributes.styleUrl&&(c.style=this.getStyle(c.attributes.styleUrl,t));if(this.extractStyles){var u=this.getElementsByTagNameNS(l,"*","Style")[0];if(u){var h=this.parseStyle(u);h&&(c.style=OpenLayers.Util.extend(c.style,h))}}this.parseFolders&&(c._folders=this._getFolderHierarchy(l));if(this.extractTracks){var p=this.getElementsByTagNameNS(l,this.namespaces.gx,"Track");if(p&&p.length>0){var d=p[0],f={features:[],feature:c};this.readNode(d,f);f.features.length>0&&i.push.apply(i,f.features)}}else i.push(c)}this.features=this.features.concat(i)};OpenLayers.Format.KML.prototype._read=OpenLayers.Format.KML.prototype.read;OpenLayers.Format.KML.prototype.read=function(e){var t=this.getChildEl(e.documentElement,"Document");if(t){var n=this.getChildEl(t,"name");n&&(this._documentName=this._getNodeText(n))}return this._read.call(this,e)};OpenLayers.Popup.Anchored.prototype.calculateRelativePosition=function(){return"tr"};OpenLayers.Control.PanZoomBar.prototype._draw=OpenLayers.Control.PanZoomBar.prototype.draw;OpenLayers.Control.PanZoomBar.prototype.draw=function(e){var t=OpenLayers.Control.PanZoomBar.prototype._draw.call(this,e);this.div.removeAttribute("style");this.div.classList.add("tc-ctl-nav");const n=this.buttons[0];var r=n.getBoundingClientRect().height;n.removeAttribute("style");n.classList.add("tc-ctl-nav-btn");n.classList.add("tc-ctl-nav-btn-zoomin");const i=this.zoombarDiv;r=i.style.height;i.removeAttribute("style");i.classList.add("tc-ctl-nav-bar");i.style.height=r;const s=this.slider;r=s.style.height;s.removeAttribute("style");s.classList.add("tc-ctl-nav-slider");s.style.height=r;const o=this.buttons[1];o.removeAttribute("style");o.classList.add("tc-ctl-nav-btn");o.classList.add("tc-ctl-nav-btn-zoomout");const a=this.buttons[2];a.removeAttribute("style");a.classList.add("tc-ctl-nav-btn");a.classList.add("tc-ctl-nav-btn-home");return t};TC.wrap.Map.prototype.setMap=function(){var e,t=this,n=t.parent.options;n.proxy&&(OpenLayers.ProxyHost=n.proxy);t.map=new OpenLayers.Map(t.parent.div,{projection:n.crs,extent:n.initialExtent,maxExtent:n.maxExtent?n.maxExtent:null,restrictedExtent:n.maxExtent?n.maxExtent:null,controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0},pinchZoomOptions:{autoActivate:!0},zoomWheelEnabled:n.mouseWheelZoom})],theme:OpenLayers.CustomTheme});t.map.events.register("zoomstart",t.parent,function(){t.parent.trigger(TC.Consts.event.BEFOREZOOM)});t.map.events.register("zoomend",t.parent,function(){t.parent.trigger(TC.Consts.event.ZOOM)});t.map.events.register("featureclick",t.parent,function(e){e.feature&&e.feature._wrap&&t.parent.trigger(TC.Consts.event.FEATURECLICK,{feature:e.feature._wrap.parent})});t.map.events.register("nofeatureclick",t.parent,function(e){for(var n=0;n<t.parent.workLayers.length;n++){var r=t.parent.workLayers[n];r.wrap.layer===e.layer&&t.parent.trigger(TC.Consts.event.NOFEATURECLICK,{layer:r})}});t.parent.div.addEventListener("resize",function(){clearTimeout(e);e=setTimeout(function(){t.map.updateSize()},200)});t._promise=Promise.resolve(t.map)};TC.wrap.Map.prototype.getMetersPerUnit=function(){TC.error("TC.wrap.Map.prototype.getMetersPerUnit no est\xe1 soportada con OpenLayers 2")};TC.wrap.Map.prototype.setProjection=function(e){TC.error("TC.wrap.Map.prototype.setProjection no est\xe1 soportada con OpenLayers 2")};TC.wrap.Map.prototype.insertLayer=function(e,t){for(var n=!1,r=0;r<this.map.layers.length;r++)if(this.map.layers[r]===e){n=!0;break}n||this.map.addLayer(e);this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getNumLayers()};TC.wrap.Map.prototype.indexOfFirstVector=function(){for(var e=-1,t=0,n=this.map.layers.length;t<n;t++)if(this.map.layers[t]instanceof OpenLayers.Layer.Vector){e=t;break}return e};TC.wrap.Map.prototype.getLayerIndex=function(e){return this.map.getLayerIndex(e)};TC.wrap.Map.prototype.setLayerIndex=function(e,t){this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.setBaseLayer=function(e){const t=this;return new Promise(function(n,r){t.map.addLayer(e);t.map.setBaseLayer(e);t.parent.baseLayer&&t.map.removeLayer(t.parent.baseLayer.wrap.layer);n()})};TC.wrap.Map.prototype.setExtent=function(e){this.map.updateSize();this.map.zoomToExtent(e)};TC.wrap.Map.prototype.getExtent=function(){var e=null,t=this.map.getExtent();t&&(e=[t.left,t.bottom,t.right,t.top]);return e};TC.wrap.Map.prototype.setCenter=function(e){this.map.panTo(e)};TC.wrap.Map.prototype.getResolution=function(){return this.map.getResolution()};TC.wrap.Map.prototype.setResolution=function(e){this.getMap().then(function(t){t.zoomTo(t.getZoomForResolution(e))})};TC.wrap.Map.prototype.getResolutions=function(){var e=[];if(this.map.resolutions)e=this.map.resolutions;else{this.map.baseLayer&&(e=this.map.baseLayer.resolutions);if(!e)for(var t=0;t<this.map.layers.length&&!e;t++)e=this.map.layers[t].resolutions}return e};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){var t=this.map.getLonLatFromPixel({x:e[0],y:e[1]});return[t.lon,t.lat]};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){var t=this.map.getPixelFromLonLat({lon:e[0],lat:e[1]});return[t.x,t.y]};TC.wrap.Map.prototype.getViewport=function(e){const t=this;(e||{}).synchronous?result=t.map.getViewport():result=new Promise(function(e,n){t.getMap().then(function(e){result.resolve(e.getViewport())})});return result};TC.wrap.Map.prototype.isNative=function(e){return e instanceof OpenLayers.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this.map.getProjectionObject();null===e&&(e=new OpenLayers.Projection(this.map.projection));var t=e.getUnits();return"degrees"===t||!t};TC.wrap.Map.prototype.addPopup=function(e){e.popupDiv=document.createElement("div");return Promise.resolve()};TC.wrap.Map.prototype.hidePopup=function(e){var t=this.parent;e&&t.wrap.getMap().then(function(n){if(e.wrap.popup&&t.popup===e){n.removePopup(e.wrap.popup);e.wrap.popup.destroy();delete e.wrap.popup;t.popup=null}})};TC.wrap.Map.prototype.exportFeatures=function(e,t){TC.error("TC.wrap.Map.prototype.exportFeatures no implementado en OpenLayers 2")};TC.wrap.Map.prototype.enableDragAndDrop=function(e){TC.error("TC.wrap.Map.prototype.enableDragAndDrop no implementado en OpenLayers 2")};TC.wrap.Map.prototype.loadFiles=function(e){TC.error("TC.wrap.Map.prototype.loadFiles no implementado en OpenLayers 2")};TC.wrap.Layer.prototype.getVisibility=function(){var e=!1;this.layer&&(e=this.layer.getVisibility());return e};TC.wrap.Layer.prototype.setVisibility=function(e){this.getLayer().then(function(t){t.setVisibility(e)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof OpenLayers.Layer};TC.wrap.Layer.prototype.setProjection=function(e){};TC.wrap.Layer.prototype.WmsParser=OpenLayers.Format.WMSCapabilities;TC.wrap.Layer.prototype.WmtsParser=OpenLayers.Format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.events.register("loadstart",t.parent.map,function(){t.parent.state=TC.Layer.state.LOADING;t.parent.map&&t.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:t.parent})});e.events.register("loadend",t.parent.map,function(){t.parent.state=TC.Layer.state.IDLE;t.parent.map&&t.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:t.parent})});e.events.register("visibilitychanged",t.parent.map,function(){t.parent.map&&t.parent.map.trigger(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent})})};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:e=this.parent.capabilities.capability.request.getmap.href;break;case TC.Consts.layerType.WMTS:e=this.parent.capabilities.operationsMetadata.GetTile.dcp.http.get[0].url}return e};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request.getfeatureinfo&&(e=t.capability.request.getfeatureinfo.formats);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/vnd.ogc.gml","application/json","application/vnd.esri.wms_featureinfo_xml","application/vnd.esri.wms_raw_xml","application/vnd.ogc.wms_xml","text/xml","text/html","text/plain"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this.parent.capabilities;if(t&&t.contents)for(var n=0;n<t.contents.layers.length;n++)for(var r=t.contents.layers[n],i=0;i<r.tileMatrixSetLinks.length;i++)if(this.parent.options.matrixSet===r.tileMatrixSetLinks[i].tileMatrixSet){e=r;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,n=this.parent.capabilities;n&&n.contents&&n.contents.tileMatrixSets[e]&&(t=_layer.capabilities.contents.tileMatrixSets[_layer.options.matrixSet].matrixIds);return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[];e.scaleDenominator?t=[e.scaleDenominator,e.scaleDenominator]:(e.minScale||e.maxScale)&&(t=[e.minScale,e.maxScale]);if(!t.length&&!this.getName(e)){for(var n=this.getLayerNodes(e),r=-1/0,i=1/0,s=0,o=n.length;s<o;s++){var a=this.getScaleDenominators(n[s]);a[0]>r&&(r=a[0]);a[1]<i&&(i=a[1])}r>-1/0&&i<1/0&&(t=[r,i])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(e){var t={};if(e)if(e.serviceProvider){t.name=e.serviceProvider.providerName.trim();t.site=e.serviceProvider.providerSite;t.site.href&&t.site.href.trim().length>0&&(t.site=t.site.href)}else e.serviceIdentification?t.name=e.serviceIdentification.title.trim():t.name=e.service.title.trim();return t};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t={},n=this.parent.capabilities;if(n&&n.capability)for(var r=function(e,t){var n=e.prefix.length&&0!==t.indexOf(e.prefix)?e.prefix+":"+t:t;return e.name===n},i=0;i<n.capability.layers.length;i++){var s=n.capability.layers[i];if(r(s,e)){s.title&&(t.title=s.title);s.abstract&&(t.abstract=s.abstract);s.styles.length&&(t.legend=s.styles[0].legend.href);if(s.metadataURLs.length){t.metadata=[];for(var o=0;o<s.metadataURLs.length;o++){var a=s.metadataURLs[o];t.metadata.push({format:a.format,type:a.type,url:a.href})}}t.queryable=s.queryable;break}}return t};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request&&t.capability.request.getmap?e=TC.Consts.layerType.WMS:t.operationsMetadata&&t.operationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.capability&&t.service?e=t.service.title:t.serviceIdentification&&(e=t.serviceIdentification.title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;this.getServiceType()===TC.Consts.layerType.WMS&&(e=this.parent.capabilities.capability.nestedLayers[0]);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var n=e.name;if(n&&t){var r=n.indexOf(":");r>=0&&(n=n.substr(r+1))}return n};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.nestedLayers;$.isArray(t)||(t=[]);return t};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){e.Layer=e.nestedLayers;if(e.Layer)for(var t=0;t<e.Layer.length;t++)TC.wrap.layer.Raster.prototype.normalizeLayerNode(e.Layer[t]);e.Title=e.title;e.Abstract=e.abstract;return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return{Capability:{Exception:cap.capability.exception,Layer:cap.capability.nestedLayers[0]},Service:cap.service,version:cap.version}};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this.parent.capabilities;switch(this.getServiceType()){case TC.Consts.layerType.WMS:return e.capability.layers;case TC.Consts.layerType.WMTS:return e.contents.layers;default:return[]}};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},n=e.styles;if(n&&n.length){var r=n[0].legend||{};t.src=r.href}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=!1,n=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.capability&&n.capabilities.capability.layers)if(0===n.names.length)t=!0;else for(var r=n.names.slice(0),i=0;i<n.capabilities.capability.layers.length;i++){var s=n.capabilities.capability.layers[i],o=$.inArray(this.getName(s),r);if(o>=0){r.splice(o,1);if(!(t=s.srs[e])||!r.length)break}}break;case TC.Consts.layerType.WMTS:var a=n.capabilities&&n.capabilities.contents&&n.capabilities.contents.tileMatrixSets[n.options.matrixSet]&&n.capabilities.contents.tileMatrixSets[n.options.matrixSet].supportedCRS,l=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");t=a&&(l.test(a)||a===e)}return t};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){return[]};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],n=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.capability&&n.capabilities.capability.layers)for(var r=0;r<n.capabilities.capability.layers.length;r++){var i=n.capabilities.capability.layers[r],s=this.getName(i);i.srs[e]&&s&&(t[t.length]=s)}break;case TC.Consts.layerType.WMTS:var o=n.capabilities&&n.capabilities.contents&&n.capabilities.contents.tileMatrixSets;if(o){var a=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");for(var l in o){var c=o[l].supportedCRS;c&&(a.test(c)||c===e)&&(t[t.length]=l)}}}return t};TC.wrap.layer.Raster.prototype.createWMSLayer=function(e,t,n){var r=new OpenLayers.Layer.WMS(n&&n.id?n.id:t.LAYERS,e,t,{isBaseLayer:1==(n&&n.isBase),singleTile:!0,transitionEffect:"resize",projection:this.parent.crs,units:"m",ratio:TC.Cfg.imageRatio});r._wrap=this;t.LAYERS.length||r.setVisibility(!1);this.addCommonEvents(r);r._originalGetURL=r.getURL;r._noGetURL=function(){return TC.Consts.BLANK_IMAGE};r.getURL=r.params.LAYERS.length>0?r._originalGetURL:r._noGetURL;return r};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(e){var t=(new OpenLayers.Format.WMTSCapabilities).createLayer(this.parent.capabilities,{isBaseLayer:1==(e&&e.isBase),name:e&&e.id?e.id:TC.Consts.layerType.WMTS,matrixSet:e.matrixSet,layer:e.layerNames,requestEncoding:e.encoding===TC.Consts.WMTSEncoding.RESTFUL?"REST":"KVP"});t._wrap=self;this.addCommonEvents(t);return t};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.params};TC.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getURL=e.LAYERS.length>0?this.layer._originalGetURL:this.layer._noGetURL;this.layer.mergeNewParams(e)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(e){};TC.wrap.layer.Raster.prototype.getResolutions=function(){return[]};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(){return[]};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){};TC.wrap.Geometry={getNearest:function(e,t){var n=new OpenLayers.Geometry.LineString($.map(t,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])})).distanceTo(new OpenLayers.Geometry.Point(e[0],e[1]),{details:!0});return[n.x0,n.y0]}};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=this,t=null,n=$.extend({},TC.Cfg,e.parent.options),r=OpenLayers.Feature.Vector.style.default,i=function(e,t){var i=OpenLayers.Style.prototype.getSymbolizerPrefix(t.geometry).toLowerCase();return n.styles[i]&&n.styles[i][e]||r[e]},s={strokeColor:"${getStrokeColor}",strokeWidth:"${getStrokeWidth}",strokeOpacity:"${getStrokeOpacity}",fillColor:"${getFillColor}",fillOpacity:"${getFillOpacity}",strokeLinecap:"${getStrokeLinecap}",strokeDashstyle:"${getStrokeDashstyle}"},o={getStrokeColor:function(e){return i("strokeColor",e)},getStrokeWidth:function(e){return i("strokeWidth",e)},getStrokeOpacity:function(e){return i("strokeOpacity",e)},getStrokeLinecap:function(e){return i("strokeLinecap",e)},getStrokeDashstyle:function(e){return i("strokeDashstyle",e)},getFillColor:function(e){return i("fillColor",e)},getFillOpacity:function(e){return i("fillOpacity",e)}},a=function(e){var t=e;if($.isFunction(e)){var n="f"+TC.getUID();o[n]=e;t="${"+n+"}"}return t};if(n.styles.point){s.pointRadius=a(n.styles.point.radius);s.graphic=n.styles.point.graphic;s.label=a(n.styles.point.label);s.fontColor=a(n.styles.point.fontColor);s.fontSize=a(n.styles.point.fontSize);s.fontWeight=a(n.styles.point.fontWeight);s.angle=a(n.styles.point.angle)}var l={styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style($.extend({},r,s),{context:o})}),projection:TC.Cfg.crs};n.isLabeling&&(l.renderers=[OpenLayers.Class(OpenLayers.Renderer.SVG,{drawText:function(e,t,n){var r=!!t.labelOutlineWidth;if(r){var i=OpenLayers.Util.extend({},t);i.fontColor=a(i.labelOutlineColor);i.fontStrokeColor=a(i.labelOutlineColor);i.fontStrokeWidth=a(t.labelOutlineWidth);t.labelOutlineOpacity&&(i.fontOpacity=a(t.labelOutlineOpacity));delete i.labelOutlineWidth;this.drawText(e,i,n)}var s=this.getResolution(),o=(n.x-this.featureDx)/s+this.left,l=n.y/s-this.top,c=r?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+c,"text");u.setAttributeNS(null,"x",o);u.setAttributeNS(null,"y",-l);if(t.angle||0==t.angle){var h="rotate(-"+t.angle+","+o+","+-l+")";u.setAttributeNS(null,"transform",h)}t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle);if(!0===t.labelSelect){u.setAttributeNS(null,"pointer-events","visible");u._featureId=e}else u.setAttributeNS(null,"pointer-events","none");var p=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[p[0]]||"middle");!0===OpenLayers.IS_GECKO&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[p[1]]||"central");for(var d=t.label.split("\n"),f=d.length;u.childNodes.length>f;)u.removeChild(u.lastChild);for(var y=0;y<f;y++){var m=this.nodeFactory(e+c+"_tspan_"+y,"tspan");if(!0===t.labelSelect){m._featureId=e;m._geometry=n;m._geometryClass=n.CLASS_NAME}!1===OpenLayers.IS_GECKO&&m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[p[1]]||"-35%");m.setAttribute("x",o);if(0==y){var g=OpenLayers.Renderer.SVG.LABEL_VFACTOR[p[1]];null==g&&(g=-.5);m.setAttribute("dy",g*(f-1)+"em")}else m.setAttribute("dy","1em");m.textContent=""===d[y]?" ":d[y];m.parentNode||u.appendChild(m)}u.parentNode||this.textRoot.appendChild(u)},CLASS_NAME:"OpenLayers.Control.CustomSVG"})]);var c=new OpenLayers.Strategy.Fixed;if(e.parent.type===TC.Consts.layerType.KML){l.strategies=[c];l.protocol=new OpenLayers.Protocol.HTTP({url:TC.proxify(n.url),format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,parseFolders:!0,internalProjection:new OpenLayers.Projection(TC.Cfg.crs),externalProjection:new OpenLayers.Projection("EPSG:4326")})})}else if(n.type===TC.Consts.layerType.WFS){var u={};if(n.properties)for(var h=0;h<n.properties.length;h++){var p=n.properties[h];p.name&&p.type?u[p.name]={value:p.value||"",type:p.type,ignoreHyphens:p.ignoreHyphens}:u[p]=""}l.strategies=[c];l.protocol=new OpenLayers.Protocol.WFS({url:n.url,version:n.version,featureType:n.featureType,geometryName:n.geometryName,featurePrefix:n.namespace,outputFormat:n.outputFormat,srsName:TC.Cfg.crs});l.filter=function(e){var t,n=[];for(var r in e){var i,s,o,a=e[r];if(a.type){i=a.type;s=a.value;var l=new OpenLayers.Filter.Comparison({type:i,property:r,value:s});if(a.ignoreHyphens){l=[l,new OpenLayers.Filter.Comparison({type:i,property:r,value:s.replace(/-/g,"")})];o=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:l})}else o=l}else{i=OpenLayers.Filter.Comparison.EQUAL_TO;s=a;o=new OpenLayers.Filter.Comparison({type:i,property:r,value:s})}n.push(o)}switch(n.length){case 0:t=null;break;case 1:t=n[0];break;default:t=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:n})}return t}(u)}if(n.cluster){$.isArray(l.strategies)||(l.strategies=[]);l.strategies.push(new OpenLayers.Strategy.Cluster({distance:n.cluster.distance}))}(t=new OpenLayers.Layer.Vector("Vectors",l))._wrap=e;this.addCommonEvents(t);t.events.register("beforefeaturesadded",null,function(){e.parent.map.trigger(TC.Consts.event.BEFOREFEATURESADD,{layer:e.parent})});t.events.register("featuresadded",null,function(t){for(var n=[],r=[],i=[],s=0;s<t.features.length;s++){var o=t.features[s];o._wrap||(o.geometry instanceof OpenLayers.Geometry.Point?n[n.length]=o:o.geometry instanceof OpenLayers.Geometry.LineString||o.geometry instanceof OpenLayers.Geometry.MultiLineString?r[r.length]=o:(o.geometry instanceof OpenLayers.Geometry.Polygon||o.geometry instanceof OpenLayers.Geometry.MultiPolygon)&&(i[i.length]=o))}var a=[];n.length>0&&a.push(e.parent.addMarkers(n));r.length>0&&a.push(e.parent.addPolylines(r));i.length>0&&a.push(e.parent.addPolygons(i));Promise.all(a).then(function(){var t=[];if(arguments.length)for(var n=0;n<arguments[0].length;n++){var r=t[n]=arguments[0][n];$.isArray(r.wrap.feature.cluster)&&(r.features=$.map(r.wrap.feature.cluster,function(e){return new r.constructor(e)}))}e.parent.map.trigger(TC.Consts.event.FEATURESADD,{layer:e.parent,features:t})})});t.events.register("featureremoved",null,function(t){var n=t.feature;if(n._wrap){var r=$.inArray(n._wrap.parent,e.parent.features);if(r>-1){e.parent.features.splice(r,1);e.parent.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:e.parent,feature:n._wrap.parent})}}});t.events.register("featuresadded",null,function(){e.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:e.parent})});t.events.register("featuresremoved",null,function(){e.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:e.parent})});if(e.parent.type===TC.Consts.layerType.KML){t.events.register("added",null,function(){c.activate()});if(!e.parent.options.title){t.events.register("loadend",null,function n(){t.protocol.format._documentName&&(e.parent.title=t.protocol.format._documentName);t.events.unregister("loadend",null,n)})}}return t};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return null};TC.wrap.layer.Vector.prototype.import=function(e){TC.error("TC.wrap.layer.Vector.prototype.import no est\xe1 soportada con OpenLayers 2")};TC.wrap.layer.Vector.prototype.addFeatures=function(e){this.getLayer().then(function(t){t.addFeatures(e)})};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.layer;if(e instanceof OpenLayers.Layer){if(e.strategies)for(var t=0;t<e.strategies.length;t++){var n=e.strategies[t];n instanceof OpenLayers.Strategy.Filter&&n.setFilter(n.filter)}return e.features}return[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.layer;if(t instanceof OpenLayers.Layer){if(t.strategies)for(var n=0;n<t.strategies.length;n++){var r=t.strategies[n];r instanceof OpenLayers.Strategy.Filter&&r.setFilter(r.filter)}return t.getFeatureById(e)}return null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){this.getLayer().then(function(t){t.removeFeatures([e.wrap.feature])})};TC.wrap.layer.Vector.prototype.clearFeatures=function(){this.getLayer().then(function(e){e.removeAllFeatures()})};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var n=this;if($.inArray(e,n.parent.features)>=0){t?delete e.wrap.feature.style.display:e.wrap.feature.style.display="none";n._redrawTimeout&&clearTimeout(n._redrawTimeout);n._redrawTimeout=setTimeout(function(){n.getLayer().then(function(e){e.redraw();n.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:n.parent})});delete n._redrawTimeout},100)}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){var n=[0,0,0,1];if("string"==typeof e){var r=4===e.length?1:2;n[0]=parseInt(e.substr(1,r),16);n[1]=parseInt(e.substr(1+r,r),16);n[2]=parseInt(e.substr(1+2*r,r),16);if(1===r){n[0]=17*n[0];n[1]=17*n[1];n[2]=17*n[2]}void 0!==t&&(n[3]=t)}return n};TC.wrap.layer.Vector.prototype.findFeature=function(e){this.getLayer().then(function(t){var n=t.filter;if(n){if(n.filters&&n.filters.length<=e.length)for(var r=0;r<n.filters.length;r++){var i=n.filters[r];if(i.type===OpenLayers.Filter.Logical.OR){i.filters[0].value=e[r];i.filters[1].value=e[r].replace("-","")}else i.value=e[r]}else n.value=e[0];t.removeAllFeatures();t.setVisibility(!0);t.strategies[0].active||t.strategies[0].activate();t.refresh()}})};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,t,n){TC.error('"sendTransaction" no est\xe1 soportado por la versi\xf3n OpenLayers 2 de la API SITNA');return Promise.reject()};TC.wrap.layer.Vector.prototype.setDraggable=function(e,t,n){var r=this;Promise.all([r.parent.map.wrap.getMap(),r.getLayer()]).then(function(i){var s=i[0],o=i[1];if(e){if(!r._ctl){var a={};$.isFunction(t)&&(a.onComplete=function(e,n){t.call(this,e._wrap.parent,[n.x,n.y])});$.isFunction(n)&&(a.onStart=function(e,t){n.call(this,e._wrap.parent,[t.x,t.y])});r._ctl=new OpenLayers.Control.DragFeature(o,a);s.addControl(r._ctl)}r._ctl.activate()}else r._ctl&&r._ctl.deactivate()})};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._ctl=new OpenLayers.Control;e.wrap.getMap().then(function(n){t._ctl.handler=new OpenLayers.Handler.Click(this,{click:function(e){var r=n.getLonLatFromPixel(e.xy);t.parent.callback([r.lon,r.lat],[e.xy.x,e.xy.y])}},{single:!0,double:!1,pixelTolerance:e.options.pixelTolerance,stopSingle:!1,stopDouble:!1});n.addControl(t._ctl)})};TC.wrap.control.Click.prototype.activate=function(){this._ctl.activate()};TC.wrap.control.Click.prototype.deactivate=function(){this._ctl.deactivate()};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.draw():this.ctl=new OpenLayers.Control.ScaleLine({div:this.parent.div,bottomInUnits:"",bottomOutUnits:""})};TC.wrap.control.NavBar.prototype.register=function(e){var t=this;e.wrap.getMap().then(function(e){t.zsCtl=new OpenLayers.Control.PanZoomBar({panIcons:!1,zoomWorldIcon:!0});e.addControl(t.zsCtl);e.events.register("changebaselayer",null,function(){t.zsCtl.moveZoomBar()})})};TC.wrap.control.NavBar.prototype.refresh=function(){};TC.wrap.control.Coordinates.prototype.register=function(e){const t=this;return new Promise(function(n,r){e.wrap.getMap().then(function(r){var i=r.getProjectionObject();null===i&&(i=new OpenLayers.Projection(r.projection));t.parent.crs=i.getCode();t.parent.units=i.getUnits();t.parent.isGeo=e.wrap.isGeo();n()})})};TC.wrap.control.Coordinates.prototype.onMouseMove=function(e){var t=this;t.parent.map.wrap.getMap().then(function(n){var r=n.getLonLatFromPixel(n.events.getMousePosition(e.originalEvent));if(r){t.parent.isGeo?t.parent.latLon=[r.lat,r.lon]:t.parent.xy=[r.lon,r.lat];t.parent.update.apply(t.parent,arguments)}})};TC.wrap.control.Geolocation.prototype.register=function(e){};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");t=$.map(this.parser.read(e),function(e){return new TC.Feature(null,{id:e.fid,data:e.data})})}return t};TC.wrap.parser={WFS:function(e){this.parser=new OpenLayers.Format.GML(e)},JSON:function(e){this.parser=new OpenLayers.Format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.Search.prototype.addEvents=function(){var e=this;e.parent.layer.wrap.getLayer().then(function(t){var n=e.parent.layer.map,r=n.wrap.isGeo()?n.options.pointBoundsRadius/TC.Util.getMetersPerDegree(n.getExtent()):n.options.pointBoundsRadius;t.events.register("featuresadded",t,function(t){for(var n=t.features[0].geometry.getBounds(),i=1;i<t.features.length;i++)n.extend(t.features[i].geometry.getBounds());if(n.left===n.right){n.left-=r;n.right+=r}if(n.top===n.bottom){n.bottom-=r;n.top+=r}e.parent.layer.map.setExtent(n)})})};TC.wrap.control.NavBar.prototype.getInitialExtent=function(){return[]};TC.wrap.control.NavBar.prototype.setInitialExtent=function(e){};TC.wrap.control.OverviewMap.prototype.register=function(e){var t=this,n=function(){const e=t.parent.div.getBoundingClientRect();var n=new OpenLayers.Size(e.width,e.height);0===n.w&&(n.w=100);0===n.h&&(n.h=100);return n},r=n();t.parent.layer.wrap.getLayer().then(function(i){t.ovMap=new OpenLayers.Control.OverviewMap({div:t.parent.div,size:r,layers:[i],minRatio:24,maxRatio:48,autoPan:!0,theme:OpenLayers.CustomTheme,mapOptions:{projection:e.crs,displayProjection:e.crs,baseLayer:i,maxExtent:e.maxExtent,minRatio:24,maxRatio:48,minRectSize:30,theme:OpenLayers.CustomTheme},maximized:!0});const s=t.parent.div.querySelector("."+t.parent.CLASS+"-load");i.events.register("loadstart",t.parent.layer,function(){s.classList.remove(TC.Consts.classes.HIDDEN);s.classList.add(TC.Consts.classes.VISIBLE)});i.events.register("loadend",t.parent.layer,function(){s.classList.remove(TC.Consts.classes.VISIBLE);s.classList.add(TC.Consts.classes.HIDDEN)});e.wrap.getMap().then(function(e){e.addControl(t.ovMap);t.parent.isLoaded=!0;t.parent.trigger(TC.Consts.event.MAPLOAD);e.events.register("updatesize",t.parent,function(){n();if(t.ovMap.ovmap){const e=t.ovMap.ovmap.div;e.style.width=t.parent.div.style.width;e.style.height=t.parent.div.style.height;t.ovMap.ovmap.updateSize();t.ovMap.updateRectToMap()}})})})};TC.wrap.control.OverviewMap.prototype.reset=function(){TC.error("TC.wrap.control.OverviewMap.prototype.reset no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){TC.error("TC.wrap.control.OverviewMap.prototype.get3DCameraLayer no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){TC.error("TC.wrap.control.OverviewMap.prototype.draw3DCamera no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.enable=function(){this.ovMap.activate();this.ovMap.update()};TC.wrap.control.OverviewMap.prototype.disable=function(){this.ovMap.deactivate()};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;t._map=e;e.wrap.getMap().then(function(n){TC.wrap.control.Click.prototype.register.call(t,e);for(var r=[],i=function(e){var t=!1;TC.layer.Raster&&e instanceof TC.layer.Raster&&!e.isBase&&e.wrap.getInfoFormats()&&(t=!0);return t},s=0;s<e.workLayers.length;s++){var o=e.workLayers[s];i(o)&&r.push(o.wrap.layer)}t._gfi=new OpenLayers.Control.WMSGetFeatureInfo({layers:r,autoActivate:!1,drillDown:!0,maxFeatures:1e3,queryVisible:!0,output:"object",formatOptions:{internalProjection:n.projection}});e.options.pixelTolerance&&(t._gfi.vendorParams={radius:e.options.pixelTolerance,buffer:e.options.pixelTolerance});n.addControl(t._gfi);e.on(TC.Consts.event.LAYERADD,function(e){i(e.layer)&&t._gfi.layers.push(e.layer.wrap.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){var n=$.inArray(e.layer.wrap.layer,t._gfi.layers);n>=0&&t._gfi.layers.splice(n,1)});var a={};t._gfi.events.register("beforegetfeatureinfo",t.parent,function(n){for(var r=0;r<n.object.layers.length;r++)for(var i=0;i<e.workLayers.length;i++)e.workLayers[i].wrap.layer===n.object.layers[r]&&(a[n.object.layers[r].url]=e.workLayers[i]);e.wrap.map.getLonLatFromPixel(n.xy);t.parent.beforeRequest({xy:[n.xy.x,n.xy.y]})});t._gfi.events.register("getfeatureinfo",t.parent,function(n){for(var r,i=0,s=[],o=[],l=[],c=0;c<n.features.length;c++){var u=n.features[c];r={layers:[],text:n.text,mapLayers:[]};var h=a[u.url];if(h){r.mapLayers.push(h);delete a[u.url]}for(var p=0;p<u.features.length;p++){for(var d=u.features[p],f=d.fid?d.fid.substr(0,d.fid.lastIndexOf(".")):d.type||"",y=r.mapLayers.length?r.mapLayers[0].wrap.getInfo(f).title||f:"[Sin t\xedtulo]",m=null,g=0;g<r.layers.length;g++)if(r.layers[g].name===f){m=r.layers[g];break}if(!m){m={name:f,title:y,features:[]};r.layers.push(m)}s.push(TC.wrap.Feature.createFeature(d));o.push(m.features);i+=1}if(!u.features.length){contentType=n.request.getResponseHeader("Content-Type");if(0===contentType.indexOf("text/")){m={name:f,title:y,features:[]};r.layers.push(m);m.features.push({rawUrl:n.request._object.responseURL,rawContent:n.text});i+=1}}l.push(r)}Promise.all(s).then(function(r){for(var s=0;s<r.length;s++){var a=r[s];a.attributes=[];for(var c in a.data)a.attributes.push({name:c,value:a.data[c]});o[s].push(a)}var u=e.wrap.map.getLonLatFromPixel(n.xy);t.parent.responseCallback({coords:[u.lon,u.lat],resolution:t._gfi._resolution,services:l,featureCount:i})})});t._gfi.events.register("exception",t.parent,function(e){t.parent.responseError({status:e.request.status,message:e.request.responseText})})})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,t){if(this._map&&this._gfi.layers.length>0){var n=map.wrap.map.getPixelFromLonLat({lon:e[0],lat:e[1]});this._gfi._resolution=t;this._gfi.getInfoForClick({xy:{x:n[0],y:n[1]}})}};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.wrap.control.Popup.prototype.fitToView=function(){var e=this;setTimeout(function(){e.popup.updateSize()},100)};TC.wrap.control.Popup.prototype.setDragged=function(e){};TC.wrap.Feature.prototype.getLegend=function(){var e={},t=this.feature.style;if(t.externalGraphic){e.src=t.externalGraphic;e.width=t.graphicWidth;e.height=t.graphicHeight}else{t.strokeColor&&(e.strokeColor=t.strokeColor);t.strokeWidth&&(e.strokeWidth=t.strokeWidth);t.fillColor&&(e.fillColor=t.fillColor);t.pointRadius&&(e.height=e.width=2*t.pointRadius)}return e};TC.wrap.Feature.prototype.createPoint=function(e,t){if($.isArray(e)){var n={pointRadius:t.radius||(t.height+t.width)/4};if(t.fillColor){n.fillColor=t.fillColor;n.fillOpacity=t.fillOpacity}else n.fill=!1;if(t.strokeColor){n.strokeColor=t.strokeColor;n.strokeWidth=t.strokeWidth}else n.stroke=!1;this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,n)}else if(this.isNative(e)){this.feature=e;this.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){this.parent.options.radius=e.style.pointRadius;this.parent.options.fillColor=e.style.fillColor;this.parent.options.fillOpacity=e.style.fillOpacity;this.parent.options.strokeColor=e.style.strokeColor}}t&&t.id&&(this.feature.id=t.id);this.feature._wrap=this};TC.wrap.Feature.prototype.createMarker=function(e,t){if(TC.Util.getPointIconUrl(t)){if($.isArray(e)){var n={externalGraphic:TC.Util.getPointIconUrl(t),graphicWidth:t.width,graphicHeight:t.height,graphicXOffset:-Math.round(t.anchor[0]*t.width),graphicYOffset:-Math.round(t.anchor[1]*t.height)};this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,n)}else if(this.isNative(e)){this.feature=e;this.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){this.parent.options.url=e.style.externalGraphic;this.parent.options.width=e.style.graphicWidth;this.parent.options.height=e.style.graphicHeight;this.parent.options.anchor=[-e.style.graphicXOffset/e.style.graphicWidth,-e.style.graphicYOffset/e.style.graphicHeight]}}t&&t.id&&(this.feature.id=t.id);this.feature._wrap=this}else this.createPoint(e,t)};TC.wrap.Feature.prototype.createPolyline=function(e,t){if($.isArray(e)){var n=$.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])});this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(n),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth})}else if(this.isNative(e)){this.feature=e;for(var r=this.parent.geometry=e.geometry.getVertices(),i=0;i<r.length;i++)r[i]=[r[i].x,r[i].y];if(e.style){this.parent.options.strokeColor=e.style.strokeColor;this.parent.options.strokeWidth=e.style.strokeWidth}}this.feature._wrap=this};TC.wrap.Feature.prototype.createPolygon=function(e,t){if($.isArray(e)){var n,r=function(e){return new OpenLayers.Geometry.LinearRing($.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])}))};if(e.length>0&&$.isArray(e[0])&&e[0].length>0&&$.isArray(e[0][0])){n=new Array(e.length);for(var i=0,s=e.length;i<s;i++)n[i]=r(e[i])}else n=[r(e)];this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(n),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,fillColor:t.fillColor,fillOpacity:t.fillOpacity})}else if(this.isNative(e)){this.feature=e;if(e.geometry){var o=this.parent.geometry=e.geometry.getVertices();for(i=0;i<o.length;i++)o[i]=[o[i].x,o[i].y]}if(e.style){this.parent.options.strokeColor=e.style.strokeColor;this.parent.options.strokeWidth=e.style.strokeWidth;this.parent.options.fillColor=e.style.fillColor;this.parent.options.fillOpacity=e.style.fillOpacity}}this.feature._wrap=this};TC.wrap.Feature.prototype.createCircle=function(e,t){};TC.wrap.Feature.createFeature=function(e){return new Promise(function(t,n){var r={id:e.fid,data:e.attributes};e.geometry instanceof OpenLayers.Geometry.Point?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t(new TC.feature.Point(e,r))}):e.geometry instanceof OpenLayers.Geometry.LineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polyline,[TC.apiLocation+"TC/feature/Polyline"],function(){t(new TC.feature.Polyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiLineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolyline,[TC.apiLocation+"TC/feature/MultiPolyline"],function(){t(new TC.feature.MultiPolyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.Polygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polygon,[TC.apiLocation+"TC/feature/Polygon"],function(){t(new TC.feature.Polygon(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiPolygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolygon,[TC.apiLocation+"TC/feature/MultiPolygon"],function(){t(new TC.feature.MultiPolygon(e,r))}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){t(new TC.Feature(e,r))})})};TC.wrap.Feature.prototype.cloneFeature=function(){return new this.feature.constructor(this.feature.geometry.clone(),this.feature.attributes,this.feature.style)};TC.wrap.Feature.prototype.getStyle=function(){var e=this.feature.style,t={};if(e.fillColor){t.fillColor=e.fillColor;t.fillOpacity=e.fillOpacity}if(e.strokeColor){t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth}if(e.externalGraphic){t.url=e.externalGraphic;t.anchor=[e.graphicXOffset/e.graphicWidth,e.graphicYOffset/e.graphicHeight]}if(e.label){t.label=e.label;t.labelOffset=[e.labelXOffset,e.labelYOffset];t.fontColor=e.fontColor;t.labelOutlineColor=e.labelOutlineColor;t.labelOutlineWidth=e.labelOutlineWidth;t.fontSize=e.fontSize}return t};TC.wrap.Feature.prototype.getGeometry=function(){var e;if(this.feature&&this.feature.geometry){var t=function(e){return[e.x,e.y]},n=function(e){for(var n=e.getVertices(),r=0,i=n.length;r<i;r++)n[r]=t(n[r]);return n},r=function(e){for(var t=new Array(e.components.length),r=0,i=e.components.length;r<i;r++)t[r]=n(e.components[r]);return t},i=this.feature.geometry;i instanceof OpenLayers.Geometry.Point?e=t(i):i instanceof OpenLayers.Geometry.LineString?e=n(i):i instanceof OpenLayers.Geometry.MultiLineString?e=n(i.components[0]):i instanceof OpenLayers.Geometry.Polygon?e=r(i):i instanceof OpenLayers.Geometry.MultiPolygon&&(e=r(i.components[0]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){var t=!1;if(this.feature&&this.feature.geometry){var n=this.feature.geometry;if(n instanceof OpenLayers.Geometry.Point&&$.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]){n.move(e[0]-n.x,e[1]-n.y);t=!0}}return t};TC.wrap.Feature.prototype.getId=function(){var e;this.feature&&(e=this.feature.fid);return e};TC.wrap.Feature.prototype.setId=function(e){this.feature&&(this.feature.fid=e)};const e=function(e){return e.map(function(e){return{x:e[0],y:e[1]}})},t=function(e){return e.map(function(e){return[e.x,e.y]})};TC.wrap.Feature.prototype.getLength=function(n){const r=this;n=n||{};const i=r.feature.geometry;var s;if(i instanceof OpenLayers.Geometry.Polygon){s=t(i.getVertices());n.crs&&(s=TC.Util.reproject(s,r.parent.map.crs,n.crs));return new OpenLayers.Geometry.LinearRing(e(s)).getLength()}if(i instanceof OpenLayers.Geometry.LineString){s=t(i.getVertices());n.crs&&(s=TC.Util.reproject(s,r.parent.map.crs,n.crs));return new OpenLayers.Geometry.LineString(e(s)).getLength()}};TC.wrap.Feature.prototype.getArea=function(n){const r=this;n=n||{};const i=r.feature.geometry;var s;if(i instanceof OpenLayers.Geometry.Polygon){s=t(i.getVertices());n.crs&&(s=TC.Util.reproject(s,r.parent.map.crs,n.crs));return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e(s))]).getArea()}};TC.wrap.Feature.prototype.setStyle=function(e){var t=this.feature.style||new OpenLayers.Style;e instanceof OpenLayers.Style||(e=new OpenLayers.Style(e));e=e.createLiterals(OpenLayers.Util.extend({},e.defaultStyle),this.feature);if(this.feature.geometry instanceof OpenLayers.Geometry.Point){t.externalGraphic=e.url;t.graphicWidth=e.width;t.graphicHeight=e.height;e.anchor&&e.width&&(t.graphicXOffset=-Math.round(e.anchor[0]*e.width));e.anchor&&e.height&&(t.graphicYOffset=-Math.round(e.anchor[1]*e.height));t.graphic=e.graphic;e.label&&(t.label=e.label.toCamelCase());e.angle&&(t.angle=e.angle);t.fontColor=e.fontColor;t.labelOutlineColor=e.labelOutlineColor;t.labelOutlineWidth=e.labelOutlineWidth}else if(this.feature.geometry.components&&this.feature.geometry.components instanceof Array&&this.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.LineString).CLASS_NAME||!this.feature.geometry.components&&this.feature.geometry instanceof new OpenLayers.Geometry.LineString){t.stroke=!0;t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth}else if(this.feature.geometry.components&&this.feature.geometry.components instanceof Array&&this.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.Polygon).CLASS_NAME||!this.feature.geometry.components&&this.feature.geometry instanceof new OpenLayers.Geometry.Polygon){t.stroke=!0;t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth;t.fillColor=e.fillColor;t.fillOpacity=e.fillOpacity}this.feature.layer&&this.feature.layer.drawFeature(this.feature,t)};TC.wrap.Feature.prototype.toggleSelectedStyle=function(e){};TC.wrap.Feature.prototype.getInnerPoint=function(e){var t=this.feature,n=t.geometry.getCentroid(!0);if(!result.intersects(t.geometry)){var r=t.geometry.distanceTo(result,{details:!0});n=new OpenLayers.Geometry.Point(r.x0,r.y0)}return[n.x,n.y]};TC.wrap.Feature.prototype.showPopup=function(e){var t=this;t.feature;Modernizr.canvas&&-1===OpenLayers.Popup.Anchored.prototype.displayClass.indexOf(TC.control.Popup.prototype.CLASS)&&(OpenLayers.Popup.Anchored.prototype.displayClass=OpenLayers.Popup.Anchored.prototype.displayClass+" "+TC.control.Popup.prototype.CLASS+" "+TC.Consts.classes.VISIBLE);var n=Modernizr.canvas?OpenLayers.Popup.Anchored:OpenLayers.Popup.FramedCloud;t._innerCentroid||(t._innerCentroid=t.getInnerPoint());e.currentFeature=t.parent;var r=e.map;r&&r.wrap.getMap().then(function(i){if(r.popup){i.removePopup(r.popup.wrap.popup);r.popup.wrap.popup.destroy();delete r.popup.wrap.popup;r.popup=null}var s=t.parent.getInfo();if(s){var o=t.parent.options,a=null;Modernizr.canvas&&o.anchor&&o.height&&(a={size:new OpenLayers.Size(0,o.height),offset:new OpenLayers.Pixel(0,-o.height*o.anchor[1])});var l=new n(null,new OpenLayers.LonLat(t._innerCentroid[0],t._innerCentroid[1]),null,s,a,e.options.closeButton,function(t){this.hide();OpenLayers.Event.stop(t);r.trigger(TC.Consts.event.POPUPHIDE,{control:e})});l.autoSize=!0;l.panMapIfOutOfView=!0;l.keepInMap=!0;l.maxSize=new OpenLayers.Size(i.size.w/2,i.size.h/2);e.popupDiv=l.div;e.wrap.popup=l;r.popup=e;i.addPopup(l);e.trigger(TC.Consts.event.CONTROLRENDER);if(Modernizr.canvas){e.popupDiv.style.overflow="";e.popupDiv.style.border="";e.popupDiv.style.width="";e.popupDiv.style.height="";const t=l.contentDiv;t.style.position="";l.updateSize();t.style.width="";const n=l.groupDiv.querySelector(".olPopupCloseBox");if(n){n.removeAttribute("style");n.classList.add(e.CLASS+"-close");n.setAttribute("title",e.getLocaleString("close"));t.style.marginRight=n.getBoundingClientRect().width+"px"}}}})};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof OpenLayers.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[];this.feature&&this.feature._folders&&(e=this.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null;if(this.feature&&this.feature.geometry){var t=this.feature.geometry.getBounds();e=[t.left,t.bottom,t.right,t.top]}return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null;this.feature.style&&(e=this.feature.style.balloonStyle)&&(e=e.replace(/\$\{(\w+)\}/g,"$$[$1]"));return e};TC.wrap.Feature.prototype.getData=function(){var e=$.extend({},this.feature.attributes);for(var t in e)e[t].value&&(e[t]=e[t].value);return e};TC.wrap.Feature.prototype.setData=function(e){const t=this.feature.attributes;for(var n in e)t[n].value?t[n].value=e[n]:t[n]=e[n]};TC.wrap.Feature.prototype.clearData=function(){this.feature.attributes={}};TC.wrap.control.Draw.prototype.activate=function(e){var t=this,n=e===TC.Consts.geom.POLYGON?OpenLayers.Handler.Polygon:OpenLayers.Handler.Path;t.parent.map&&t.parent.map.wrap.getMap().then(function(r){if(t.control){t.control.deactivate();r.removeControl(t.control)}if(e){var i=function(e){var n="measurepartial"===e.type?TC.Consts.event.MEASUREPARTIAL:TC.Consts.event.MEASURE,r={units:e.units};if(1===e.order)r.length=e.measure;else if(2===e.order){r.area=e.measure;r.perimeter=t.control.getLength(e.geometry,e.units)}t.parent.measure&&t.parent.trigger(n,r);t.parent.trigger(TC.Consts.event.DRAWEND,{feature:new TC.feature.Polygon(e.geometry.components)})};t.control=new OpenLayers.Control.Measure(n,{geodesic:!0,persist:!0,immediate:!0});t.control.handler.callbacks.point=function(e){t.parent.trigger(TC.Consts.event.POINT,{point:[e.x,e.y]})};t.parent.measure?t.control.events.on({measure:i,measurepartial:i}):t.control.events.on({measure:i});r.addControl(t.control);t.control.activate()}})};TC.wrap.control.Draw.prototype.deactivate=function(){this.control&&this.control.deactivate()};TC.wrap.control.Draw.prototype.undo=function(){var e=!1;this.control&&this.control.handler&&(e=this.control.handler.undo());return e};TC.wrap.control.Draw.prototype.redo=function(){var e=!1;this.control&&this.control.handler&&(e=this.control.handler.redo());return e};TC.wrap.control.Draw.prototype.end=function(){if(this.control&&this.control.handler){this.control.handler.finishGeometry();this.control.handler.layer&&this.control.handler.layer.redraw()}};TC.wrap.control.Draw.prototype.setStyle=function(){TC.error("TC.wrap.control.Draw.prototype.setStyle no implementado en OpenLayers 2")};TC.wrap.control.CacheBuilder.prototype.getRequestSchema=function(e){return{}};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){return""}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const e=this;TC.Control.apply(e,arguments);e.apiAttribution="";e.mainDataAttribution=null;e.dataAttributions=[];e.options.dataAttributions&&(e.dataAttributions=e.options.dataAttributions instanceof Array?e.options.dataAttributions:[e.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var e=TC.control.Attribution.prototype;e.CLASS="tc-ctl-attrib";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Attribution.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<div><span>&copy; ").f(t.get(["api"],!1),t,"h",["s"]).w("</span>").x(t.get(["mainData"],!1),t,{block:n},{}).x(t.get(["otherData"],!1),t,{block:o},{}).w('<div class="tc-ctl-attrib-other ').x(t.get(["isCollapsed"],!1),t,{block:a},{}).w('">').s(t.get(["otherData"],!1),t,{block:l},{}).w("</div></div>")}t.__dustBody=!0;function n(e,t){return e.w(" - ").h("i18n",t,{},{$key:"data"}).w(":").x(t.getPath(!1,["mainData","site"]),t,{else:r,block:s},{})}n.__dustBody=!0;function r(e,t){return e.x(t.getPath(!1,["mainData","name"]),t,{block:i},{})}r.__dustBody=!0;function i(e,t){return e.w("<span> &copy; ").f(t.getPath(!1,["mainData","name"]),t,"h").w("</span>")}i.__dustBody=!0;function s(e,t){return e.w('<span> &copy; <a href="').f(t.getPath(!1,["mainData","site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["mainData","name"]),t,"h").w("</a></span>")}s.__dustBody=!0;function o(e,t){return e.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",t,{},{$key:"others"}).w("...</span>")}o.__dustBody=!0;function a(e,t){return e.w(" tc-collapsed ")}a.__dustBody=!0;function l(e,t){return e.x(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,{else:c,block:u},{}).h("sep",t,{block:h},{})}l.__dustBody=!0;function c(e,t){return e.w("<span>&copy; ").f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</span>")}c.__dustBody=!0;function u(e,t){return e.w('<span>&copy; <a href="').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</a></span>")}u.__dustBody=!0;function h(e,t){return e.w(", ")}h.__dustBody=!0;return t};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var r=function(e){if(e){var n=e.getAttribution();if(n)if(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))t.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var r=!1,i=0;i<t.dataAttributions.length;i++)if(n.name===t.dataAttributions[i].name){r=!0;break}r||t.dataAttributions.push(n)}}},i=function(e){if(e){if(!(e instanceof TC.Layer)||function(){if(e.map.workLayers.length>0){for(var t=e.map.workLayers.slice().reverse(),n=0;n<t.length;n++)if(t[n].url==e.url&&t[n].getVisibility())return!1;return!0}return!0}()){var n=e.getAttribution();if(n){var r=t.dataAttributions.reduce(function(e,t,r){return t.name===n.name?r:e},-1);const e=function(e){return(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))&&(/IDENA/.test(e)||/Tracasa Instrumental/.test(e))||n.name===e};if(t.map.baseLayer&&t.map.baseLayer.wrap.getAttribution()&&e(t.map.baseLayer.wrap.getAttribution().name))return;if(t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).some(function(t){var n=t.wrap.getAttribution();return n&&e(n.name)}))return;r>-1?t.dataAttributions.splice(r,1):(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))&&(t.mainDataAttribution=null)}}}};t.render();e.loaded(function(){if(e.baseLayer.wrap.getAttribution){r(e.baseLayer.wrap);t.render()}});e.on(TC.Consts.event.LAYERADD,function(e){const n=e.layer;if(!n.isBase&&n.wrap.getAttribution){r(n.wrap);t.render()}});e.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(e){const n=e.type,s=e.newLayer,o=e.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(n)>-1&&(t.ignoreLayer=s);o&&o.wrap.getAttribution&&i(o.wrap);s&&s.wrap.getAttribution&&r(s.wrap);t.render()});e.on(TC.Consts.event.LAYERREMOVE,function(e){const n=e.layer;if(n.wrap.getAttribution){i(n.wrap);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERADD,function(e){const n=e.terrainProvider;if(n.getAttribution){r(n);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(e){const n=e.terrainProvider;if(n.getAttribution){i(n);t.render()}});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){const n=e.layer;if(t.ignoreLayer!==n&&n.wrap.getAttribution){n.getVisibility()?r(n.wrap):i(n.wrap);t.render()}});return n};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({api:t.apiAttribution,mainData:t.mainDataAttribution,otherData:t.dataAttributions,isCollapsed:!t.div.querySelector("."+t.CLASS+"-other")||t.div.querySelector("."+t.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const n=t.div.querySelector("."+t.CLASS+"-cmd");n&&n.addEventListener(TC.Consts.event.CLICK,function(){t.toggleOtherAttributions()});"function"==typeof e&&e()}))};e.toggleOtherAttributions=function(){const e=this.div.querySelector("."+this.CLASS+"-other");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(.tc-modal-close)",function(n){if(n.target.classList.contains(e._cssClasses.LOAD_CRS_BUTTON)){e.loadFallbackProjections();return}TC.Util.closeModal();const r=n.target,i=r.dataset.crsCode,s=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog");s.classList.add(TC.Consts.classes.HIDDEN);const o=e.getLayer(s.dataset.layerId);if(o)if(i)TC.loadProjDef({crs:i,callback:function(){e.map.setProjection({crs:i,baseLayer:o})}});else{const n=$(r).data(t.FALLBACK_LAYER);n&&e.map.setBaseLayer(n)}}))};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";var t={FALLBACK_LAYER:"tcFallbackLayer"};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/BasemapSelectorDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(t.get(["baseLayers"],!1),t,{block:n},{}).s(t.get(["dialogMore"],!1),t,{block:r},{}).w("</ul></form></div>")}t.__dustBody=!0;function n(e,t){return e.p("tc-ctl-bms-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;function r(e,t){return e.w('<li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="').h("i18n",t,{},{$key:"moreBackgroundMaps"}).w('"><input type="radio" name="bms" value="moreLayers"><span></span></label></li>')}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('" ><label').x(t.get(["legend"],!1),t,{block:n},{}).x(t.get(["thumbnail"],!1),t,{block:r},{}).w('><input type="radio" name="bms" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["mustReproject"],!1),t,{block:i},{}).w("><span>").f(t.get(["title"],!1),t,"h").w("</span></label></li>")}t.__dustBody=!0;function n(e,t){return e.w(' style="background-image: url(').f(t.getPath(!1,["legend","src"]),t,"h").w(')"')}n.__dustBody=!0;function r(e,t){return e.w(' style="background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"')}r.__dustBody=!0;function i(e,t){return e.w(' class="tc-disabled"')}i.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"backgroundMaps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w('</button></div></div></div><div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"baseLayerNotCompatible"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"baseLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-bms-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}const n=function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},r=function(e,t){const r=this;var i=!0,s=e.target,o=r.getLayer(n(s,"li").dataset.layerId);if(r.options.dialogMore&&n(s,"."+r.CLASS+"-more-dialog")){const e=r.div.querySelectorAll("input[type=radio]");for(var a=0,l=e.length;a<l;a++){const t=r.getLayer(n(e[a],"li").dataset.layerId);if(t)switch(!0){case t.id===o.id:o=t}}}if(o!=r.map.getBaseLayer())if(o.mustReproject)if(r.map.on3DView){if(!o.getFallbackLayer()){r._currentSelection.checked=!0;e.stopPropagation();return}if(o.getFallbackLayer()){const e=o.getFallbackLayer();e&&e._capabilitiesPromise.then(function(){e.isCompatible(r.map.getCRS())&&r.map.setBaseLayer(o)});i=!0}}else{r._currentSelection&&(r._currentSelection.checked=!0);const e={layer:o},t=o.getFallbackLayer();t?t._capabilitiesPromise.then(function(){t.isCompatible(r.map.getCRS())&&(e.fallbackLayer=t);r.showProjectionChangeDialog(e)}):r.showProjectionChangeDialog(e);i=!1}else{(o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WMTS&&o.getProjection()!==r.map.crs)&&o.setProjection({crs:r.map.crs});r.map.setBaseLayer(o)}this._currentSelection&&(this._currentSelection.checked=!0);t&&t(i)};e.register=function(e){const t=this,n=TC.control.MapContents.prototype.register.call(t,e);t.options.dialogMore&&e.on(TC.Consts.event.VIEWCHANGE,function(){t._getMoreBaseLayers()});e.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(e){t.update(t.div,e.layer)});t.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){"moreLayers"===e.target.value?t.showMoreLayersDialog():r.call(t,e);e.stopPropagation()}));return n};e.render=function(e){const t=this,n=TC.control.MapContents.prototype.render.call(t,e,t.options);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;if(t.options.dialogMore){t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog").addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){r.call(t,e,function(e){e&&TC.Util.closeModal()});e.stopPropagation()}))}});return n};e.update=function(e,t){const n=this;(e=e||n.div).querySelector("ul."+n.CLASS+"-branch").querySelectorAll("li").forEach(function(e){const r=n.getLayer(e.dataset.layerId);if(r){const i=t||n.map.baseLayer,s=e.querySelector("input[type=radio]"),o=i&&(i===r||i.id===r.id||r.getFallbackLayer&&(i===r.getFallbackLayer()||r.getFallbackLayer()&&i.id===r.getFallbackLayer().id));if(n.map.on3DView&&r.mustReproject&&r.fallbackLayer&&r.getFallbackLayer)r.getFallbackLayer().getCapabilitiesPromise().then(function(){var t=!r.getFallbackLayer().isCompatible(n.map.getCRS());s.checked=o;if(t){s.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",n.map.on3DView?n.getLocaleString("notAvailableTo3D"):n.getLocaleString("reprojectionNeeded"))}else{s.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}});else{s.checked=o;if(r.mustReproject){s.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",n.map.on3DView?n.getLocaleString("notAvailableTo3D"):n.getLocaleString("reprojectionNeeded"))}else{s.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}}o&&(n._currentSelection=s)}});n.updateScale()};e.updateLayerTree=function(e){const t=this;if(e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);var n=t.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n,t.layerTrees[e.id],function(n,r){const i=(new DOMParser).parseFromString(r,"text/html").body.firstChild;var s=i.dataset.tcLayerUid;const o=t.div.querySelector("."+t.CLASS+"-branch"),a=o.querySelector('li[data-tc-layer-uid="'+s+'"]');if(a)a.innerHTML=i.innerHTML;else{i.dataset.layerId=e.id;var l=t.map.baseLayers.filter(function(e){return!e.stealth}).map(function(e){return e.id}).indexOf(e.id);const n=o.querySelectorAll("li");l<0||l>=n.length?o.appendChild(i):o.insertBefore(i,n[l])}n&&TC.error(n)});t.update()})}};e.updateLayerOrder=function(e,t,n){};e.removeLayer=function(e){const t=this;if(e.isBase){const i=t.div.querySelector("."+t.CLASS+"-branch").querySelectorAll("li");for(var n=0,r=i.length;n<r;n++){const t=i[n];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}}};e.onErrorLayer=function(e){const t=this;e.isBase&&!e.options.stealth&&t.map.toast(t.getLocaleString("baseLayerNotAvailable",{mapName:e.title}),{type:TC.Consts.msgType.ERROR})};e.loadFallbackProjections=function(){const e=this;e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li").forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)})};e.showProjectionChangeDialog=function(e){const n=this,r=(e=e||{}).layer,i=n._dialogDiv.querySelector("."+n.CLASS+"-crs-dialog"),s=i.querySelector(".tc-modal-body");s.classList.add(TC.Consts.classes.LOADING);const o=r.getCompatibleCRS();i.classList.remove(TC.Consts.classes.HIDDEN);i.dataset.layerId=r.id;const a=i.querySelector("ul."+n.CLASS+"-crs-list");a.innerHTML="";n.map.loadProjections({crsList:n.map.getCompatibleCRS({layers:n.map.workLayers.concat(r),includeFallbacks:!0}),orderBy:"name"}).then(function(r){var i=!1;const l=document.createDocumentFragment();r.forEach(function(r){const s=document.createElement("li"),a=document.createElement("button");if(0===o.filter(function(e){return TC.Util.CRSCodesEqual(e,r.code)}).length){i=!0;a.innerHTML=r.name+" ("+r.code+")";$(a).data(t.FALLBACK_LAYER,e.layer.fallbackLayer);a.dataset.crsCode=r.code;a.classList.add(TC.Consts.classes.WARNING);s.classList.add(TC.Consts.classes.HIDDEN)}else{a.innerHTML=n.getLocaleString("changeMapToCrs",{crs:r.name+" ("+r.code+")"});a.dataset.crsCode=r.code}s.appendChild(a);l.appendChild(s)});if(e.fallbackLayer){const r=document.createElement("li"),i=document.createElement("button");i.innerHTML=n.getLocaleString("reprojectOnTheFly");$(i).data(t.FALLBACK_LAYER,e.fallbackLayer);r.appendChild(i);l.appendChild(r)}if(i){const e=document.createElement("li"),t=document.createElement("button");t.classList.add(n._cssClasses.LOAD_CRS_BUTTON);t.innerHTML=n.getLocaleString("showOnTheFlyProjections");e.appendChild(t);l.appendChild(e)}a.appendChild(l);s.classList.remove(TC.Consts.classes.LOADING)});i.querySelector("."+n.CLASS+"-name").innerHTML=r.title||r.name;TC.Util.showModal(i)};e.showMoreLayersDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");e.map.on3DView?t.classList.add(TC.Consts.classes.THREED):t.classList.remove(TC.Consts.classes.THREED);const n=t.querySelector(".tc-modal-body");n.innerHTML="";n.classList.add(TC.Consts.classes.LOADING);t.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,{closeCallback:function(){this._currentSelection.checked=!0;this.update()}.bind(e)});t.querySelector(".tc-modal-window").classList.add(e.CLASS+"-more-dialog");e._getMoreBaseLayers().then(function(){e.getRenderedHtml(e.CLASS,{baseLayers:e._moreBaseLayers},function(t){n.innerHTML=t;n.classList.remove(TC.Consts.classes.LOADING);n.querySelectorAll("li").forEach(function(t,n){t.dataset.layerId=e._moreBaseLayers[n].id});e.update(n)})})};e.getLayer=function(e){return this.map&&(this.map.getLayer(e)||this._moreBaseLayers&&this._moreBaseLayers.filter(function(t){return t.id===e})[0])};const i=function(e){return new Promise(function(t,n){Promise.all([e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then(function(){t()})})};e._getMoreBaseLayers=function(){const e=this;if(e._moreBaseLayers||e._moreBaseLayersPromise){if(e._moreBaseLayers)return new Promise(function(t,n){Promise.all(e._moreBaseLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).map(function(t){return e.map.on3DView?i(t):t.getCapabilitiesPromise()})).then(function(){e._moreBaseLayers=e._moreBaseLayers.map(function(t){if(t.type===TC.Consts.layerType.WMTS){var n=t.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];t.mustReproject=!n}else t.type===TC.Consts.layerType.WMS&&(t.mustReproject=!t.isCompatible(e.map.getCRS()));if(e.map.on3DView&&t.mustReproject&&t.getFallbackLayer&&t.getFallbackLayer()){t.mustReproject=!t.getFallbackLayer().isCompatible(e.map.getCRS());return t}return t});t(e._moreBaseLayers)})})}else e._moreBaseLayersPromise=new Promise(function(t,n){var r=TC.Cfg.availableBaseLayers.filter(function(e){return-1==TC.Cfg.availableBaseLayers.filter(function(e){return e.fallbackLayer}).map(function(e){return e.fallbackLayer}).indexOf(e.id)}).map(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(e):e.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(e):void 0});Promise.all(r).then(function(n){e._moreBaseLayers=new Array(n.length);var r=n.length;const s=function(){e._moreBaseLayers=e._moreBaseLayers.filter(function(e){return null!==e});t(e._moreBaseLayers)},o=function(t){const n=this;n.map=e.map;n.isBase=n.options.isBase=!0;if(n.type===TC.Consts.layerType.WMTS){var i=n.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];n.mustReproject=!i}else n.type===TC.Consts.layerType.WMS&&(n.mustReproject=!n.isCompatible(e.map.getCRS()));e.map.on3DView&&n.mustReproject&&n.getFallbackLayer&&n.getFallbackLayer()&&(n.mustReproject=!n.getFallbackLayer().isCompatible(e.map.getCRS()));e._moreBaseLayers.splice(t,1,n);0===--r&&s()};n.forEach(function(t,n){if(t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS){(e.map.on3DView?i(t):t.getCapabilitiesPromise()).then(o.bind(t,n),function(t){e._moreBaseLayers.splice(n,1,null);0===--r&&s()})}else o.call(t,n)})})});return e._moreBaseLayersPromise}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(e,t){TC.Util.getQueryStringParams(t);for(var n=0,r=TC._appCacheBuilders.length;n<r;n++){var i=TC._appCacheBuilders[n];switch(e.type){case"cached":i.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t});break;case"obsolete":i.trigger(TC.Consts.event.MAPCACHEDELETE,{url:t});break;case"checking":break;case"progress":i.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:t,loaded:e.loaded,total:e.total});break;case"error":i.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:e.reason,status:e.status});break;case"noupdate":case"updateready":i.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:"already_exists",status:e.status})}}});var t,n=function(){return new Promise(function(e,t){var n=document.documentElement.getAttribute("manifest");n?TC.ajax({url:n,method:"GET",responseType:"text"}).then(function(t){TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var n=hex_md5(t),r=t.indexOf("NETWORK:");r>=0&&(t=t.substr(0,r));(r=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,r));(r=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,r));var i=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});i.shift();e({hash:n,urls:i})})}).catch(function(){t()}):t()})};if(e){const n=(t=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater,function(e){t&&parent.TC._appCacheUpdater(e,location.href)});e.addEventListener("cached",n,!1);e.addEventListener("error",n,!1);e.addEventListener("noupdate",n,!1);e.addEventListener("obsolete",n,!1);e.addEventListener("progress",n,!1);e.addEventListener("updateready",n,!1)}TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var n=0,r=localStorage.length;n<r;n++){var s=localStorage.key(n);if(0===s.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)&&s!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var o=localStorage.getItem(s).split(" "),a=i(o.shift()),l={name:o.join(" "),extent:a,url:decodeURIComponent(s.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(l)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(t){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var c=$.extend({},r>1?arguments[1]:arguments[0]);e._dialogDiv=TC.Util.getDiv(c.dialogDiv);e._$dialogDiv=$(e._dialogDiv);c.dialogDiv||document.body.appendChild(e._dialogDiv);e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var u=history.pushState;history.pushState=function(t){var n;n=u.apply(history,arguments);if(e._offlinePanelDiv){var r=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),i=TC.Util.getQueryStringParams();delete i[e.MAP_DEFINITION_PARAM_NAME];delete i[e.MAP_EXTENT_PARAM_NAME];delete i[e.SERVICE_WORKER_FLAG];var s=$.param(i);s.length&&(s="?"+s);var o=r+s+location.hash;e._offlinePanelDiv.querySelector(e._selectors.EXIT).setAttribute("href",o)}return n};var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},p=function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.remove(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI);switch(h.type){case 1:case 2:case void 0:t.classList.add(TC.Consts.classes.CONNECTION_WIFI);break;default:t.classList.add(TC.Consts.classes.CONNECTION_MOBILE)}}};h.addEventListener&&h.addEventListener("typechange",p);window.addEventListener("online",p);window.addEventListener("offline",function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var r=TC.control.CacheBuilder.prototype;r.CLASS="tc-ctl-cbuild";r.MAP_DEFINITION_PARAM_NAME="map-def";r.MAP_EXTENT_PARAM_NAME="map-extent";r.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";r.ROOT_CACHE_NAME="root";r.COOKIE_KEY_PREFIX="TC.offline.map.";r.CACHE_REQUEST_PATH="offline";r.SERVICE_WORKER_FLAG="sw";r._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};r._actions={CREATE:"create",DELETE:"delete"};r.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";r.template={};if(TC.isDebug){r.template[r.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";r.template[r.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";r.template[r.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";r.template[r.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";r.template[r.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{r.template[r.CLASS]=function(){dust.register(r.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",r,{},{$key:"cb.filter.plhr"}).w('"').x(r.get(["storedMaps"],!1),r,{else:t,block:n},{}).w(' maxlength="200" /> <ul id="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(r.get(["storedMaps"],!1),r,{block:i},{}).w("><span>").h("i18n",r,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",r,{},{$key:"noMatches"}).w("</span></li>").s(r.get(["storedMaps"],!1),r,{block:s},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",r,{},{$key:"newofflinemap"}).w('">').h("i18n",r,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",r,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function t(e,t){return e.w(" disabled")}t.__dustBody=!0;function n(e,t){return e}n.__dustBody=!0;function i(e,t){return e.w(" hidden")}i.__dustBody=!0;function s(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}s.__dustBody=!0;return e};r.template[r.CLASS+"-map-node"]=function(){dust.register(r.CLASS+"-map-node",e);function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-bl-node"]=function(){dust.register(r.CLASS+"-bl-node",e);function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-dialog"]=function(){dust.register(r.CLASS+"-dialog",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w('</h4><p class="tc-ctl-cbuild-bl-panel-txt">').h("i18n",t,{},{$key:"selectAtLeastOne"}).w('</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-off-panel"]=function(){dust.register(r.CLASS+"-off-panel",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e}}const i=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},s=function(e,t){t.querySelector("span").classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.TEXTBOX).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.SAVEBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.remove(TC.Consts.classes.HIDDEN)};var o=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},a=function(e,t){var n=t||{};const r=e._dialogDiv.querySelector(e._classSelector+"-res"),i=e._dialogDiv.querySelector(e._selectors.RNGMAXRES);var s,o,a,l=e.getResolutions();if(l.length){if(e.minResolution){if(void 0===n.rangeValue)for(var c=0,u=l.length;c<u;c++)if(e.minResolution>=l[c]){i.value=c;break}}else void 0===n.rangeValue&&(i.value=Math.floor(l.length/2));i.setAttribute("max",l.length-1);o=parseInt(i.value);var h=Math.floor(1e3*new Number(l[o]))/1e3;s=e.getLocaleString("metersPerPixel",{value:h.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});a=100*(o+1)/(l.length+1)+"%";i.disabled=!1;e.minResolution=l[i.value]}else{o=0;s="";i.value=0;a="0";e.minResolution=0;i.disabled=!0}r.style.left=a;r.innerHTML=s};const l=function(e){e._dialogDiv.querySelectorAll(e._classSelector+"-bl-node input[type=checkbox]").forEach(function(t,n){if(t.checked){var r=e.requestSchemas.filter(function(e){return e.layerId===t.value})[0];if(r){var i=function(e,t){for(var n=null,r=0,i=e.tileMatrixLimits.length;r<i&&!((n=e.tileMatrixLimits[r]).res<=t);r++);return n}(r,e.minResolution);if(i){var s=r.url;if(s.indexOf("{TileMatrix}")<0){var o=s.indexOf("?");o>=0&&(s=s.substr(0,o));for(var a=0,l=e.baseLayers.length;a<l;a++){var c=e.baseLayers[a];if(c.id===r.layerId){s=s+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}for(;t&&"LABEL"!==t.tagName;)t=t.parentElement;if(t){t.style.backgroundSize="auto";t.style.backgroundPosition="left bottom";t.style.backgroundImage="url("+s.replace("{TileMatrix}",i.mId).replace("{TileRow}",i.rt).replace("{TileCol}",i.cl)+")"}}}}})},c=function(e,t){return t<1?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:o(t)})},u=function(e){var t="";e.tileCount=0;for(var n=0,r=e.requestSchemas.length;n<r;n++)for(var i=e.requestSchemas[n],s=0,a=i.tileMatrixLimits.length;s<a;s++){var l=i.tileMatrixLimits[s];e.tileCount+=(l.cr-l.cl+1)*(l.rb-l.rt+1);if(l.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:o(e.tileCount)})+" ("+c(e,e.estimatedMapSize)+")"}e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML=t},h=function(e,t){var n=t.indexOf("#");n>=0&&(t=t.substr(0,n));const r=e.div.querySelectorAll(e._selectors.LISTITEM);for(var i=0,s=r.length;i<s;i++){const e=r[i],n=e.querySelector("a");if(n&&n.getAttribute("href")===t)return e}return null},p=function(e,t){const n=document.createElement("iframe");n.style.display="none";n.setAttribute("src",t);e.div.appendChild(n)},d=function(e,t){const n=e.div.querySelector('iframe[src="'+t+'"]');n&&n.parentElement.removeChild(n)};var f=function(e,t){var n=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);n=!0}return n};const y=function(e,t){const n=e.findStoredMap({url:t});if(n){if(function(e,t){var n=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));n=!0}return n}(e,t)){const t=function(e,t){const n=e.div.querySelectorAll(e._selectors.LISTITEM);for(var r=0,i=n.length;r<i;r++){const e=n[r],i=e.querySelector("a");if(i&&i.innerHTML===t)return e}return null}(e,n.name);t&&t.parentElement.removeChild(t)}var r=$.inArray(n,e.storedMaps);e.storedMaps.splice(r,1);if(!e.storedMaps.length){e.div.querySelector(e._selectors.SEARCH).disabled=!0;e.div.querySelector(e._selectors.EMPTYLIST).removeAttribute("hidden")}return n.name}return null};r.render=function(e){const t=this;return t._set1stRenderPromise(new Promise(function(n,r){var o={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(o,function(){t._dialogDiv.querySelector(t._selectors.OKBTN).addEventListener(TC.Consts.event.CLICK,function(){t.generateCache()});t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener("input",function(){t._updateReadyState()});t.div.querySelector(t._selectors.NEWBTN).addEventListener(TC.Consts.event.CLICK,function(){t.setEditState()});t.div.querySelector(t._classSelector+"-btn-cancel-draw").addEventListener(TC.Consts.event.CLICK,function(){t.setReadyState()});t.div.querySelector(t._classSelector+"-btn-cancel-dl").addEventListener(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});const n=t.div.querySelector(t._selectors.LIST);n.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.DELETEBTN,function(e){t.startDeleteMap(e.target.parentElement.querySelector("a").innerHTML)}));n.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.EDITBTN,function(e){!function(e,t){t.querySelector("span").classList.add(TC.Consts.classes.HIDDEN);const n=t.querySelector(e._selectors.TEXTBOX);n.classList.remove(TC.Consts.classes.HIDDEN);n.value=t.querySelector("span a").innerHTML;n.focus();t.querySelector(e._selectors.SAVEBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.add(TC.Consts.classes.HIDDEN)}(t,e.target.parentElement)}));n.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.CANCELBTN,function(e){const n=e.target.parentElement;n.querySelector(t._selectors.TEXTBOX).value=n.querySelector("a").innerHTML;s(t,n)}));n.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.SAVEBTN,function(e){const n=e.target.parentElement;s(t,n);const r=n.querySelector("a"),i=(r.innerHTML,n.querySelector(t._selectors.TEXTBOX).value),o=t.findStoredMap({url:r.getAttribute("href")});if(o){o.name=i;r.innerHTML=i;r.setAttribute("title",i);f(t,o)}}));n.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.VIEWBTN,function(e){const n=e.target;var r=!n.classList.contains(TC.Consts.classes.ACTIVE);const s=t.div.querySelector(t._selectors.VIEWBTN);s.classList.remove(TC.Consts.classes.ACTIVE);s.parentElement.classList.remove(TC.Consts.classes.ACTIVE);const o=n.parentElement.querySelector("a").innerHTML;if(o){var a=t.findStoredMap({name:o});if(a){var l=i(a.extent);t.layer.clearFeatures();if(r){t.layer.addPolygon([[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});n.classList.add(TC.Consts.classes.ACTIVE);n.parentElement.classList.add(TC.Consts.classes.ACTIVE);n.setAttribute("title",t.getLocaleString("removeMapExtent"))}}}}));const r=t.div.querySelector(t._selectors.SEARCH),o=function(){!function(e){e=e.toLowerCase();const n=t.div.querySelectorAll(t._selectors.LISTITEM);n.forEach(function(e){e.style.display="none"});const r=[];n.forEach(function(e){e.matches("li:not([class]),li."+TC.Consts.classes.ACTIVE)&&r.push(e)});if(0===e.length){r.forEach(function(e){e.style.removeProperty("display")});t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="visible"}else{t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="hidden";var i=new RegExp(e,"i");r.forEach(function(e){e.style.display=i.test(e.querySelector("a").textContent)?"":"none"});r.some(function(e){return!e.hidden})||n.forEach(function(e){e.matches('[class^="tc-ctl-cbuild-map-not"]')&&e.style.removeProperty("display")})}}(this.value.toLowerCase().trim())};r.addEventListener("keyup",o);r.addEventListener("search",o);t._dialogDiv.querySelector(t._selectors.BLLIST).addEventListener("change",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){t.baseLayers.length=0;t._dialogDiv.querySelectorAll(t._selectors.BLLIST+" input[type=checkbox]").forEach(function(e){if(e.checked)for(var n=e.value,r=0,i=t.map.baseLayers.length;r<i;r++){var s=t.map.baseLayers[r];if(s.id===n&&s.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=s;break}}});t.updateRequestSchemas();a(t);l(t);t._updateReadyState();u(t)}));const c=t._dialogDiv.querySelector(t._selectors.RNGMAXRES),p=function(e){a(t,{rangeValue:e.target.value});l(t);u(t)};c.addEventListener("input",p);c.addEventListener("change",p);const d=h(t,location.href);d&&d.classList.add(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()}).then(function(){n()}).catch(function(e){r(e instanceof Error?e:Error(e))})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var n=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=n;return n}},!0)}))};r.register=function(e){var t=this;const r=TC.control.SWCacheClient.prototype.register.call(t,e);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":t.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total});break;case"cached":t.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name});break;case"deleted":t.trigger(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name});break;case"error":e.data.action===t._actions.CREATE&&TC.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});n().then(function(e){const n=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var r;window.localStorage&&(r=localStorage.getItem(n));if(r!==e.hash){t.cacheUrlList(e.urls);t.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){const i=!r;window.localStorage&&localStorage.setItem(n,e.hash);i||TC.confirm(t.getLocaleString("newAppVersionAvailable"),function(){location.reload()})})}})}if(t.mapIsOffline){e.div.classList.add(TC.Consts.classes.OFFLINE);t._offlinePanelDiv=TC.Util.getDiv(t.options.offlinePanelDiv);t.options.offlinePanelDiv||e.div.appendChild(t._offlinePanelDiv);t.getRenderedHtml(t.CLASS+"-off-panel",null,function(e){t._offlinePanelDiv.innerHTML=e;if(!navigator.onLine){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);e.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);e.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}t._offlinePanelDiv.querySelector(t._selectors.EXIT).addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}const s=t.getUID(),o=t.getUID();t.layerPromise=e.addLayer({id:o,type:TC.Consts.layerType.VECTOR,stealth:!0,styles:{line:e.options.styles.line}});t.layer=null;Promise.all([t.layerPromise,t.renderPromise(),e.addControl("draw",{id:s,div:t.div.querySelector(t._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1})]).then(function(n){const r=t.layer=n[0],i=t.boxDraw=n[2];i.setLayer(r);i.on(TC.Consts.event.DRAWSTART,function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var n=e.feature.geometry[0],r=n[0],i=n[2],s=Math.min(r[0],i[0]),o=Math.max(r[0],i[0]),a=Math.min(r[1],i[1]),c=Math.max(r[1],i[1]);t.setExtent([s,a,o,c]);const h=t._dialogDiv.querySelectorAll("input[type=checkbox]");h.forEach(function(e){for(var n=0,r=t.map.baseLayers.length;n<r;n++){var i=t.map.baseLayers[n];if(e.value===i.id){for(var s=e;s&&"LI"!==s.tagName;)s=s.parentElement;var o=i.getResolutions(),a=t.wrap.getRequestSchemas({extent:t.extent,layers:[i]})[0].tileMatrixLimits;if(a.length&&o[o.length-1]==a[a.length-1].res)s.classList.remove(TC.Consts.classes.HIDDEN);else{e.checked=!1;s.classList.add(TC.Consts.classes.HIDDEN)}break}}});var p;const d=t._dialogDiv.querySelectorAll(t._selectors.BLLISTITEM);for(var f=0,y=d.length;f<y;f++)if(d[f].matches("."+TC.Consts.classes.HIDDEN)){p="selectAtLeastOne";break}p||(p="cb.noMapsAtSelectedExtent");t._dialogDiv.querySelector(t._selectors.BLLISTTEXT).innerHTML=t.getLocaleString(p);l(t);u(t);TC.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-dialog"),{openCallback:function(){h.forEach(function(e){e.disabled=!1});var e;if(Date.prototype.toLocaleString){var n={};n.year=n.month=n.day=n.hour=n.minute=n.second="numeric";e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),n)}else e=(new Date).toString();t._dialogDiv.querySelector(t._selectors.NAMETB).value=e;t._updateReadyState()},closeCallback:function(){h.forEach(function(e){e.disabled=!0});t.layer.clearFeatures()}})});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){i===e.control&&t._state===t._states.EDITING&&t.setReadyState()})});var a=function(e){var n=!1;const r=t._dialogDiv.querySelector(t._selectors.BLLIST),i=function(){return!!r.querySelector('li[data-tc-layer-uid="'+e.id+'"]')};var s=e.type===TC.Consts.layerType.WMTS&&!e.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(s=s&&TC.Util.isSameOrigin(e.url));if(s&&!i()){n=!0;t.getRenderedHtml(t.CLASS+"-bl-node",e,function(e){if(!i()){const t=new DOMParser;r.appendChild(t.parseFromString(e,"text/html").body.firstChild)}})}return n};e.on(TC.Consts.event.LAYERADD,function(e){t.renderPromise().then(function(){a(e.layer)})}).on(TC.Consts.event.LAYERREMOVE,function(e){t.renderPromise().then(function(){const n=e.layer;if(n.type===TC.Consts.layerType.WMTS){const e=t._dialogDiv.querySelector(t._selectors.BLLIST).querySelector('li[data-tc-layer-uid="'+n.id+'"]');e.parentElement.removeChild(e)}})});var c=TC.Util.getQueryStringParams(),p=c[t.MAP_DEFINITION_PARAM_NAME],m=c[t.MAP_EXTENT_PARAM_NAME];e.ready(function(){if(t.mapIsOffline){var n,r,i=[];for(n=0,r=t.offlineControls.length;n<r;n++){var s=t.offlineControls[n];s=s.substr(0,1).toUpperCase()+s.substr(1);i=i.concat(e.getControlsByClass("TC.control."+s))}for(n=0,r=e.controls.length;n<r;n++){var o=e.controls[n];i.indexOf(o)<0&&o.disable()}document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})}});e.loaded(function(){t.layerPromise.then(function(t){e.putLayerOnTop(t)});t.renderPromise().then(function(){t.div.querySelector(t._selectors.NEWBTN).disabled=!1;for(var n=0,r=e.baseLayers.length;n<r;n++)a(e.baseLayers[n])});if(t.mapIsOffline){var n=JSON.parse(window.atob(decodeURIComponent(p))),r=[],s=$.grep(e.baseLayers,function(e){var t=!1;if(e.type===TC.Consts.layerType.WMTS)for(var i=0,s=n.layers.length;i<s;i++){var o=n.layers[i];if((0===e.url.indexOf("//")?location.protocol+e.url:e.url)===n.url[o.urlIdx]&&e.layerNames===o.id&&e.matrixSet===n.tms[o.tmsIdx]){t=!0;break}}t||e.type!==TC.Consts.layerType.VECTOR&&(r[r.length]=e);return t})[0];s&&e.setBaseLayer(s);for(var o=0,l=r.length;o<l;o++)e.removeLayer(r[o]);e.setExtent(i(m))}});t.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(n){t.isDownloading=!1;const r=function(e){const t=e.indexOf("#");return t>=0?e.substr(0,t):e}(n.url),i=h(t,r);if(i&&!t.serviceWorkerEnabled){i.classList.remove(TC.Consts.classes.DISABLED);TC.alert(t.getLocaleString("cb.delete.error"))}else if(t.currentMap&&r===t.currentMap.url){!function(e){const t=e.currentMap;if(f(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){const n=new DOMParser;e.div.querySelector(e._selectors.LIST).appendChild(n.parseFromString(t,"text/html").body.firstChild);e.div.querySelector(e._selectors.EMPTYLIST).setAttribute("hidden","hidden");e.div.querySelector(e._selectors.SEARCH).disabled=!1});e.storedMaps.push(t)}}(t);e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))}t.currentMap=null;d(t,n.url);t.setReadyState()}).on(TC.Consts.event.MAPCACHEDELETE,function(n){t.isDownloading=!1;var r=y(t,n.url)||t.currentMap&&t.currentMap.name;d(t,n.url);t.currentMap=null;if(r){document.cookie=t.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";e.toast(t.getLocaleString("mapDeleted",{mapName:r}))}t.setReadyState()}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var n=e.total;!n&&t.requestSchemas&&(n=t.requestSchemas[0].tileCount);var r=e.loaded;if(r)t._loadedCount=r;else{t._loadedCount+=1;r=t._loadedCount}t.showDownloadProgress(r,n)}).on(TC.Consts.event.MAPCACHEERROR,function(e){t.isDownloading=!1;d(t,e.url);t.setReadyState();var n=t.getLocaleString("cb.mapCreation.error"),r=!0;switch(e.reason){case"quota":n+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":n+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&y(t,e.url);r=!1;break;case"already_exists":n+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(r)if(TC.Util.detectIE()){TC.error(n);TC.alert(t.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(n);t.currentMap=null});return r};r.setExtent=function(e){if($.isArray(e)&&e.length>=4){this.extent=e;this.updateRequestSchemas()}};r._updateReadyState=function(){this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!this.extent||0===this._dialogDiv.querySelector(this._selectors.NAMETB).value.length||this._dialogDiv.querySelector(this._selectors.RNGMAXRES).disabled};r.setReadyState=function(){const e=this;e._state=e._states.READY;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.remove(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()};r.setEditState=function(){this._state=this._states.EDITING;this.showDownloadProgress(0,1);this.div.querySelector(this._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.DRAWING).classList.remove(TC.Consts.classes.HIDDEN);this.map.toast(this.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!0;this.div.querySelector(this._selectors.NEWBTN).disabled=!0;this._dialogDiv.querySelector(this._selectors.NAMETB).value="";this.boxDraw.activate()};r.generateCache=function(){const e=this,t={mapName:e._dialogDiv.querySelector(e._selectors.NAMETB).value};if(e.findStoredMap({name:t.mapName}))TC.alert(e.getLocaleString("cb.mapNameAlreadyExists.error",t));else{var r=function(){e.div.querySelector(e._classSelector+"-name").innerHTML=t.mapName;e.map.toast(e.getLocaleString("downloadingMap",{mapName:t.mapName}));!function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.remove(TC.Consts.classes.HIDDEN);e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!0;e.layer.clearFeatures();e.boxDraw.cancel()}(e);e.requestCache(t)},i=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(i.queryUsageAndQuota)i.queryUsageAndQuota(function(n,i){var s=(i-n)/1048576;e.estimatedMapSize<s?r():TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:t.mapName,mapSize:c(e,e.estimatedMapSize),availableStorage:c(e,Math.round(s))}),r)},function(e){TC.error(e)});else{var s=TC.Util.detectIE();if(s){var a=s<12?1e3:2e3,l=0,u=function(){var n=e.tileCount+l;n>a?TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:t.mapName,resourceCount:o(n),maxResourceCount:o(a)}),r):r()};n().then(function(e){l=e.urls.length;u()}).catch(u)}else r()}}};r.cacheUrlList=function(e,t){var n=t||{};this.createCache(n.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:e,silent:n.silent})};r.requestCache=function(e){var t=this,n=e||{};if(t.map){var r=n.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:r});if(t.requestSchemas){for(var i=function(e,n,r){var i=e.res>=t.minResolution;!i&&n>0&&(i=r[n-1].res>t.minResolution);return i},s=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},o=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(i)}}),a=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=o.length;l<c;l++){var u=o[l],h=(N=u.tileMatrixLimits[u.tileMatrixLimits.length-1]).res*N.tSize;a[0]=Math.min(a[0],N.origin[0]+h*N.cl);a[1]=Math.min(a[1],N.origin[1]-h*(N.rb+1));a[2]=Math.max(a[2],N.origin[0]+h*(N.cr+1));a[3]=Math.max(a[3],N.origin[1]-h*N.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(s)}var d=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),f={bBox:a=a.map(function(e,t){return(t<3?Math.ceil:Math.floor)(e*d)/d}),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};for(l=0,c=t.baseLayers.length;l<c;l++){var y=t.baseLayers[l],g=0===y.url.indexOf("//")?location.protocol+y.url:y.url,C=$.inArray(g,f.url);C<0&&(C=f.url.push(g)-1);var v=$.inArray(y.matrixSet,f.tms);v<0&&(v=f.tms.push(y.matrixSet)-1);var T=y.format.substr(y.format.indexOf("/")+1),L=$.inArray(T,f.format);L<0&&(L=f.format.push(T)-1);f.layers[l]={urlIdx:C,id:y.layerNames,tmsIdx:v,formatIdx:L}}var S=TC.Util.getQueryStringParams(),b=S[t.MAP_EXTENT_PARAM_NAME]=a.toString();S[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(f));t.serviceWorkerEnabled&&(S[t.SERVICE_WORKER_FLAG]=1);var w=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(S);t.currentMap={name:n.mapName,extent:b,url:w};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(l=0,c=o.length;l<c;l++){for(var E=o[l],O=null,A=0,x=t.baseLayers.length;A<x;A++){var P=t.baseLayers[A];if(P.id===E.layerId){O=t.wrap.getGetTilePattern(P);break}}if(O){urlList=[];var _=0;for(k=0,lenk=E.tileMatrixLimits.length;k<lenk;k++){var N;for(P=(N=E.tileMatrixLimits[k]).cl;P<=N.cr;P++)for(m=N.rt;m<=N.rb;m++)urlList[_++]=O.replace("{TileMatrix}",N.mId).replace("{TileCol}",P).replace("{TileRow}",m)}urlList.push(w);t.cacheUrlList(urlList,{name:w})}}else p(t,w)}}};r.cancelCacheRequest=function(){var e=this;if(e.currentMap){d(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;e.setReadyState()};r.deleteMap=function(e){var t=this,n=t.findStoredMap({name:e});if(n){var r=TC.Util.getQueryStringParams(n.url);t.deleteCache(n.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(r[t.MAP_DEFINITION_PARAM_NAME]));p(t,n.url)}})}};r.startDeleteMap=function(e){const t=this;if(navigator.onLine){if(e){var n=t.getLocaleString("cb.delete.confirm",{mapName:e});t.serviceWorkerEnabled||(n=n+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(n))if(navigator.onLine){!function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.add(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.boxDraw.cancel()}(t);t.deleteMap(e)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))};r.findStoredMap=function(e){return $.grep(this.storedMaps,function(t){var n=!0;e.name&&e.name!==t.name&&(n=!1);n&&e.url&&e.url!==t.url&&(n=!1);return n})[0]};r.showDownloadProgress=function(e,t){const n=this,r=n._classSelector,i=n.div.querySelector(r+"-progress-count");if(t){var s=Math.min(Math.round(100*e/t),100)+"%";n.div.querySelector(r+"-progress-ratio").style.width=s;i.innerHTML=s}else{n.div.querySelector(r+"-progress-bar").classList.add(TC.Consts.classes.HIDDEN);i.innerHTML=n.getLocaleString("xFiles",{quantity:e})}};r.updateRequestSchemas=function(e){var t=e||{};t.extent=t.extent||this.extent;t.layers=t.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(t);return this.requestSchemas};r.getResolutions=function(){for(var e=[],t=function(e){return e.res},n=this.requestSchemas.map(function(e){return e.tileMatrixLimits.map(t)}),r=Number.POSITIVE_INFINITY,i=0,s=0,o=n.length;s<o;s++){var a=n[s];r=Math.min(r,a[0]);i=Math.max(i,a[a.length-1])}for(s=0,o=n.length;s<o;s++)e=e.concat(n[s].filter(function(t){return t<=r&&t>=i&&e.indexOf(t)<0}));e.sort(function(e,t){return t-e});return e}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.ControlContainer=function(){TC.control.Container.apply(this,arguments);this._classSelector="."+this.CLASS};TC.inherit(TC.control.ControlContainer,TC.control.Container);!function(){var e=TC.control.ControlContainer.prototype;e.CLASS="tc-ctl-cctr";e.SIDE={LEFT:"left",RIGHT:"right"};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ControlContainer.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/ControlContainerNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.write('<ul class="tc-ctl-cctr-left">').section(t.get("controls"),t,{block:n},null).write('</ul><ul class="tc-ctl-cctr-right">').section(t.get("controls"),t,{block:i},null).write("</ul>")}function n(e,t){return e.helper("eq",t,{block:r},{key:t.get("side"),value:"left"})}function r(e,t){return e.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(t.get("index"),t,"h").write('"><div></div></li>')}function i(e,t){return e.helper("eq",t,{block:s},{key:t.get("side"),value:"right"})}function s(e,t){return e.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(t.get("index"),t,"h").write('"><div></div></li>')}return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(t.get(["index"],!1),t,"h").w('"><div></div></li>')}t.__dustBody=!0;return t}}e.onRenderPromise=function(){const e=this;var t=new Array(e.ctlCount);Object.keys(e.controlOptions).forEach(function(n,r){var i=e.controlOptions[n];t[r]=e.map.addControl(n,$.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r).querySelector("div")},i.options))});Promise.all(t).then(function(){for(var t=0,n=arguments.length;t<n;t++){arguments[t].containerControl=e}})};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({controls:Object.keys(t.controlOptions).map(function(e,n){return $.extend(t.controlOptions[e],{index:n})})}))};e.addControl=function(e,t){const n=this;t.side=t.side||n.SIDE.LEFT;return new Promise(function(r,i){n.getRenderedHtml(n.CLASS+"-node",{index:++n.ctlCount},function(i){var s=document.createElement("template");s.innerHTML=i.trim();n.div.querySelector("ul."+n.CLASS+"-"+t.side).appendChild(s.content?s.content.firstChild:s.firstChild);n.map.addControl(e,$.extend({id:n.getUID(),div:n.div.querySelector("."+n.CLASS+"-elm-"+n.ctlCount).querySelector("div")},t)).then(function(e){r(e)})})})};e.addElement=function(e){e.side=e.side||this.SIDE.LEFT;var t=document.createElement("li");t.setAttribute("class",this.CLASS+"-elm "+this.CLASS+"-elm-"+this.ctlCount+++" ");this.div.querySelector("ul."+this.CLASS+"-"+e.side).appendChild(t);var n=t.appendChild(e.htmlElement);n.setAttribute("class",n.getAttribute("class")+" tc-ctl");return n}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);$.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var e=TC.control.Coordinates.prototype;e.CLASS="tc-ctl-coords";var t;e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Coordinates.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CoordinatesDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(t.get(["crs"],!1),t,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",t,{},{$key:"changeCRS"}).w('">').f(t.get(["crs"],!1),t,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(t.get(["isGeo"],!1),t,{else:n,block:i},{}).w("</div>").x(t.get(["showGeo"],!1),t,{block:o},{}).w('<span class="close"></span>')}t.__dustBody=!0;function n(e,t){return e.w('x: <span class="tc-ctl-coords-x">').f(t.get(["x"],!1),t,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(t.get(["y"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:r},{})}n.__dustBody=!0;function r(e,t){return e.w('z: <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}r.__dustBody=!0;function i(e,t){return e.h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:s},{})}i.__dustBody=!0;function s(e,t){return e.h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}s.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-coords-alt"><div class="tc-ctl-coords-xy">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:a},{}).w("</div></div>")}o.__dustBody=!0;function a(e,t){return e.h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}a.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",t,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",t,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",t,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.register=function(e){var t=this;const n=TC.control.ProjectionSelector.prototype.register.call(t,e);t.crs=t.map.crs;t.clear();e.on(TC.Consts.event.VIEWCHANGE,function(e){const n=e.view;if(n===TC.Consts.view.PRINTING)return;const r=function(e){t.isPointerOver(e)||t.clear()};if(n===TC.Consts.view.THREED){t.isGeo=!0;t.units=TC.Consts.units.DEGREES;t.crs=t.map.view3D.crs;t.map.view3D.container.addEventListener("mouseout",r);t.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(e){if(e){if(TC.Util.detectMobile()){t.clear();t.coordsToClick({coordinate:[e.lon,e.lat,e.ele],cssClass:t._cssClasses.THREEDMARKER})}t.latLon=[e.lat,e.lon];if(e.ele>0){var n=TC.Util.getMapLocale(t.map);t.latLon.push(e.ele.toLocaleString(n)+"m")}t.update()}else t.clear()})}else if(n===TC.Consts.view.DEFAULT){t.isGeo=t.map.wrap.isGeo();t.units=TC.Consts.units.METERS;t.crs=t.map.crs;t.map.view3D&&t.map.view3D.container.removeEventListener("mouseout",r)}if(t.map.view3D){t.geoCrs=t.map.view3D.crs;t.render()}});e.loaded(function(){t.wrap.register(e).then(function(){t.render(function(){t.clear()})});TC.Util.detectMobile()&&t.renderPromise().then(function(){t.getLayer();t.activateCoords()});e.on(TC.Consts.event.PROJECTIONCHANGE,function(n){if(!e.on3DView){t.isGeo=e.wrap.isGeo();t.crs=n.crs;t.render()}});t.map.wrap.getViewport().then(function(e){t.renderPromise().then(function(){e.addEventListener(TC.Consts.event.MOUSEMOVE,function(e){t.map.on3DView||t.onMouseMove(e)});e.addEventListener(TC.Consts.event.MOUSELEAVE,function(e){t.onMouseLeave(e)})})})});return n};e.render=function(e){const t=this;return t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo},function(){t.div.querySelector("button."+t._cssClasses.CRS).addEventListener(TC.Consts.event.CLICK,function(e){t.showProjectionChangeDialog()});$.isFunction(e)&&e()})}))};e.onMouseMove=function(e){this.wrap.onMouseMove(e)};e.onMouseLeave=function(e){const t=this;setTimeout(function(){if(!t.isPointerOver(e)){t.div.style.visibility="hidden";t.clear()}},200)};e.isPointerOver=function(e){var t=this.div.getBoundingClientRect();return t.left<=e.clientX&&t.left+t.width>=e.clientX&&t.top<=e.clientY&&t.top+t.height>=e.clientY};e.formatCoord=function(e,t){var n;n=e.toFixed(t);t<=3&&(n=n.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));return n=n.replace(".",",").replace(/\|/g,".")};e.update=function(){const e=this;!e.isGeo&&e.options.showGeo&&(e.latLon=TC.Util.reproject(e.xy,e.crs,e.geoCrs).reverse());if(!e.isGeo){e.x=e.formatCoord(e.xy[0],TC.Consts.METER_PRECISION);e.y=e.formatCoord(e.xy[1],TC.Consts.METER_PRECISION)}if(e.isGeo||e.options.showGeo){e.lat=e.formatCoord(e.latLon[0],TC.Consts.DEGREE_PRECISION);e.lon=e.formatCoord(e.latLon[1],TC.Consts.DEGREE_PRECISION)}e.render(function(){const t=e.div.querySelector("span.close");if(TC.Util.detectMobile()){t.addEventListener("click",function(){e.div.classList.add(TC.Consts.classes.HIDDEN);e.clear()});t.style.display=""}else{e.div.classList.remove(TC.Consts.classes.HIDDEN);e.div.style.visibility="visible";t.style.display="none"}})};e.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(e){e.clearFeatures()})};e.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};e.activateCoords=function(){this.wrap.coordsActivate()};e.getCoords=function(){var e=this.map.getControlsByClass(TC.control.Popup);if(e&&e.length>0&&e[0].isVisible())this.coordsToPopup(e[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};e.coordsToPopup=function(e){e&&this.updateCoordsCtrl(e.wrap.popup.getPosition())};e.updateCoordsCtrl=function(e){if(e){if(!this.isGeo){this.x=e[0];this.y=e[1];this.xy=[this.x,this.y];e.length>2&&this.xy.push(e[2])}if(this.isGeo||this.options.showGeo){this.lat=e[0];this.lon=e[1];this.latLon=[this.lat,this.lon];e.length>2&&this.latLon.push(e[2])}this.update()}};e.coordsToClick=function(e){var n=this;if(!n.map.div.classList.contains("tc-ctl-sv-active "+TC.Consts.classes.COLLAPSED)){var r=n.div.getBoundingClientRect();if(r.left<=e.clientX&&e.clientX<=r.right&&r.top<=e.clientY&&e.clientY<=r.bottom){n.div.classList.add(TC.Consts.classes.HIDDEN);n.clear();return}$(n.div).stop(!0,!0);t&&clearTimeout(t);n.updateCoordsCtrl(e.coordinate);n.map.on3DView||n.coordsMarkerAdd(e.coordinate,e.cssClass);n.div.classList.remove(TC.Consts.classes.HIDDEN);n.div.style.visibility="visible";n.div.style.opacity="0.7";t=setTimeout(function(){$(n.div).animate({opacity:0},3e3,"linear",function(){n.clear()})},5e3)}};e.coordsMarkerAdd=function(e,t){var n=this;n.currentCoordsMarker?n.currentCoordsMarker.setCoords(e):n.getLayer().then(function(r){r.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:t||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(e){n.currentCoordsMarker=e})})};e.getLayer=function(){const e=this;return new Promise(function(t,n){void 0==e.layer?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"}).then(function(n){e.layer=n;e.layer.map.putLayerOnTop(e.layer);t(e.layer)}):t(e.layer)})}}();TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.DataLoader=function(){TC.control.TabContainer.apply(this,arguments);this.controlOptions=[{name:"externalWMS",title:"addWMS",options:{suggestions:this.options.wmsSuggestions}},{name:"fileImport",options:{enableDragAndDrop:this.options.enableDragAndDrop}}];this.defaultSelection=0};TC.inherit(TC.control.DataLoader,TC.control.TabContainer);TC.control.DataLoader.prototype.register=function(e){this.title=this.getLocaleString("addMaps");return TC.control.TabContainer.prototype.register.call(this,e)};TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");TC.control.Download=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this._hiddenElms=[];var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv)};TC.inherit(TC.control.Download,TC.control.MapInfo);!function(){var e=TC.control.Download.prototype;e.CLASS="tc-ctl-download";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Download.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"download"}).w(' </h2><div class="tc-ctl-tctr tc-ctl-tctr-select"><form><label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",t,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",t,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-collapsed"><div><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format-image" class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr" class="tc-ctl-download-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-ctl-download-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w('</p></div></div></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-collapsed"><div><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",t,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",t,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",t,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",t,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",t,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",t,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",t,{},{$key:"noData"}).w(": </strong>").h("i18n",t,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg"><strong>').h("i18n",t,{},{$key:"noValidService"}).w(": </strong>").h("i18n",t,{},{$key:"noValidService.instructions"}).w("</p></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadData"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",t,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",t,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,function(){const n=".tc-ctl-tctr";t._selectors={TAB:n+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:n+"-elm"};const r=function(e){for(var n=this;n&&!n.matches(t._selectors.TAB);)n=n.parentElement;if(n){const e=n.querySelector(t._selectors.RADIOBUTTON),r=e.value,i=t.div.querySelectorAll(t._selectors.ELEMENT);if(t._oldValue===r&&t.options.deselectable){setTimeout(function(){e.checked=!1},0);t._oldValue=null;t._activeElm=null;i.forEach(function(e){t._hiddenElms.push(e)})}else{i.forEach(function(e){e.matches(t._selectors.ELEMENT+"-"+r)?t._activeElm=e:t._hiddenElms.push(e)});t._oldValue=r}t._hiddenElms.forEach(function(e){e.classList.add(TC.Consts.classes.COLLAPSED)});t._activeElm&&t._activeElm.classList.remove(TC.Consts.classes.COLLAPSED);e.checked=!0}};t.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,r)});e&&e()})})};e.register=function(e){var t=this;const n=TC.control.MapInfo.prototype.register.call(t,e);t.map.mustBeExportable=!0;var r=function(e,n){const r=t.div.querySelector(".alert-warning:not(."+t.CLASS+"-alert)");var i;switch(e.key){case TC.Consts.WFSErrors.NumMaxFeatures:i=r.querySelector("#zoom-msg").innerHTML.format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoLayers:i=t.getLocaleString("noLayersLoaded");break;case TC.Consts.WFSErrors.GetCapabilities:i=r.querySelector("#novalid-msg").innerHTML.format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoFeatures:i=r.querySelector("#noFeatures-msg").innerHTML;break;case TC.Consts.WFSErrors.Indeterminate:i=t.getLocaleString("wfs.IndeterminateError");t.map.toast(i,{type:TC.Consts.msgType.ERROR});TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:e.params.err,descripcion:e.params.errorThrown,serviceName:e.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);t.map.getLoadingIndicator().removeWait(n);return;default:i=t.getLocaleString("wfs."+e.key,e.params)}t.map.toast(i,{type:TC.Consts.msgType.WARNING});t.map.getLoadingIndicator().removeWait(n)};t.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-btn",function(){var e=t.map.getLoadingIndicator().addWait(),n="";t._activeElm&&(n=t._activeElm.querySelector("select").value);if(n.indexOf("image")>-1)new Promise(function(n,r){var i=t.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],s=TC.Util.cloneCanvas(i);t.map.getControlsByClass(TC.control.ScaleBar)&&t.drawScaleBarIntoCanvas({canvas:s,fill:!0});if(t._activeElm.querySelector("#"+t.CLASS+"-image-qr:checked")){const r="qrcode";var o=document.getElementById(r);if(o)o.innerHTML="";else{(o=document.createElement("div")).setAttribute("id",r);document.body.appendChild(o)}o.style.top="-200px";o.style.left="-200px";o.style.position="absolute";t.makeQRCode(o,87,87).then(function(r){if(r){var i=s.getContext("2d");i.fillStyle="#ffffff";i.fillRect(s.width-91,s.height-91,91,91);TC.Util.addToCanvas(s,r,{x:s.width-88,y:s.height-88}).then(function(e){n(e)})}else{TC.error(t.getLocaleString("dl.export.map.error")+": QR");t.map.getLoadingIndicator().removeWait(e)}})}else n(s)}).then(function(r){try{const e=r.toDataURL(n);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+n.split("/")[1],n,e)}catch(e){TC.error(t.getLocaleString("dl.export.map.error")+": "+e.message)}t.map.getLoadingIndicator().removeWait(e)});else{var i=t.map.getExtent(),s=TC.Util.reproject(i.slice(0,2),t.map.crs,TC.Defaults.crs),o=TC.Util.reproject(i.slice(2),t.map.crs,TC.Defaults.crs),a=TC.WFSGetFeatureBuilder(t.map,new TC.filter.bbox([s[0],s[1],o[0],o[1]]),n,!0);Promise.all(a).then(function(n){var i=$.grep(n,function(e){return null!=e});if(0!==i.length){for(var s=[],o=0;o<i.length;o++)if(i[o].errors&&i[o].errors.length)for(var a=0;a<i[o].errors.length;a++){var l=i[o].errors[a];r(l,e)}else{var c=i[o].data,u=i[o].url;c&&u&&s.push({url:u+"?download=zip",data:c})}TC.Util.downloadFileForm(s);t.map.getLoadingIndicator().removeWait(e)}else r({key:TC.Consts.WFSErrors.NoLayers},e)})}}));t.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-help",function(e){e.stopPropagation();TC.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-help-dialog"))}));t.div.addEventListener("change",TC.EventTarget.listenerBySelector("#"+t.CLASS+"-image-qr",function(e){e.target.checked?t.generateLink():t.div.querySelector("."+t.CLASS+"-alert").classList.add(TC.Consts.classes.HIDDEN)}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){t.generateLink();t.registerListeners()}));return n};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");document.getElementById(this.CLASS+"-image-qr").checked?e.qr?t.classList.remove(TC.Consts.classes.HIDDEN):e.qr||t.classList.add(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change";!function(){TC.control.Draw=function(){var e=this;TC.Control.apply(e,arguments);if(!Modernizr.inputtypes.color&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}e._classSelector="."+e.CLASS;e._pointClass=e.CLASS+"-point";e._lineClass=e.CLASS+"-line";e._polygonClass=e.CLASS+"-polygon";e.history=[];e.historyIndex=0;e.exportsState=!0;e.on(TC.Consts.event.DRAWSTART,function(t){e.resetValues()}).on(TC.Consts.event.POINT,function(n){e.layer&&!e.persistent&&e.layer.features&&e.layer.features.length>0&&e.layer.clearFeatures();e.history.length=e.historyIndex;e.history[e.historyIndex++]=n.point;t(e)}).on(TC.Consts.event.DRAWEND,function(t){n(e);t.feature.setId(TC.getUID(e.getLocaleString("sketch")+"."));e.callBack&&e.callBack(t.feature)});e._layerPromise=null};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var t=function(e){e._endBtn.disabled=0===e.historyIndex||e.mode===TC.Consts.geom.POLYGON&&e.historyIndex<3||e.mode===TC.Consts.geom.POLYLINE&&e.historyIndex<2;e._redoBtn.disabled=e.history.length===e.historyIndex;e._undoBtn.disabled=0===e.historyIndex},n=function(e){e.resetValues();e._endBtn.disabled=!0;e._cancelBtn.disabled=!1};TC.isDebug?e.template=TC.apiLocation+"TC/templates/Draw.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-draw-tools"><button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(t.get(["tooltip"],!1),t,"h").w('">').h("i18n",t,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",t,{},{$key:"undo"}).w('">').h("i18n",t,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",t,{},{$key:"redo"}).w('">').h("i18n",t,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="').h("i18n",t,{},{$key:"end"}).w('">').h("i18n",t,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",t,{},{$key:"cancel"}).w('">').h("i18n",t,{},{$key:"cancel"}).w("</button></div>").x(t.get(["styleTools"],!1),t,{block:n},{})}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-draw-style">').h("i18n",t,{},{$key:"strokeColor"}).w('<input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="').f(t.get(["strokeColor"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"selectColor"}).w('" />').h("i18n",t,{},{$key:"strokeWidth"}).w('<div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:').f(t.get(["strokeWidth"],!1),t,"h").w('px;"> </div><input type="number" class="tc-ctl-draw-str-w tc-textbox" value="').f(t.get(["strokeWidth"],!1),t,"h").w('" min="1" max="15" /></div>')}n.__dustBody=!0;return t};e.render=function(e){var t,n,r,i=this;switch(i.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t=i.getLocaleString("drawLine");i.div.classList.add(i._lineClass);n=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t=i.getLocaleString("drawPolygon");i.div.classList.add(i._polygonClass);n=TC.Cfg.styles.polygon.strokeColor;r=TC.Cfg.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t=i.getLocaleString("drawPoint");i.div.classList.add(i._pointClass);n=TC.Cfg.styles.point.strokeColor;r=TC.Cfg.styles.point.strokeWidth;break;default:t=i.getLocaleString("draw");n=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth}const s={tooltip:t,strokeColor:function(e){const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return t&&t.length?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e}(n),strokeWidth:r,styleTools:i.options.styleTools};return i._set1stRenderPromise(i.renderData(s,function(){if(!Modernizr.inputtypes.color){const e=i.div.querySelector("input[type=color]");if(e){e.style.backgroundColor=e.value;e.style.color="transparent";const t=new CP(e,"click",document.body);e.onclick=function(e){e.preventDefault()};e.onfocus=function(e){this.blur()};e.onchange=function(e){this.style.backgroundColor=this.value};i.map.loaded(function(){t.on("change",function(e){i.setStrokeColor("#"+e)})})}}i.reset=!0;i.callBack=null;i.measure=!1;i._cancelClick=!1;i.mode=i.options.mode||TC.Consts.geom.POLYLINE;i.options.measure&&(i.measure=i.options.measure);$.isFunction(i.options.callback)&&(i.callBack=i.options.callback);void 0===i.options.persistent?i.persistent=!0:i.persistent=i.options.persistent;i.wrap=new TC.wrap.control.Draw(i);i._newBtn=i.div.querySelector(i._classSelector+"-btn-new");i._newBtn.addEventListener(TC.Consts.event.CLICK,function(){i.new()});i._cancelBtn=i.div.querySelector(i._classSelector+"-btn-cancel");i._cancelBtn.addEventListener(TC.Consts.event.CLICK,function(){i.cancel()});i._endBtn=i.div.querySelector(i._classSelector+"-btn-end");i._endBtn.addEventListener(TC.Consts.event.CLICK,function(){i.end()});i._undoBtn=i.div.querySelector(i._classSelector+"-btn-undo");i._undoBtn.addEventListener(TC.Consts.event.CLICK,function(){i.undo()});i._redoBtn=i.div.querySelector(i._classSelector+"-btn-redo");i._redoBtn.addEventListener(TC.Consts.event.CLICK,function(){i.redo()});if(i.options.styleTools){i._strokeColorPicker=i.div.querySelector(i._classSelector+"-str-c");i._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE,function(e){i.setStrokeColor(e.target.value)});i._strokeWidthSelector=i.div.querySelector(i._classSelector+"-str-w");i._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE,function(e){i.setStrokeWidth(e.target.value)});i._strokeWidthWatch=i.div.querySelector(i._classSelector+"-str-w-watch")}$.isFunction(e)&&e()}))};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.end()});const r=function(){t.styles={};$.extend(!0,t.styles,t.options.styles||t.layer.options.styles)};t._layerPromise=new Promise(function(n,i){e.loaded(function(){if(t.options.layer){t.setLayer(t.options.layer);n(t.layer);r()}else if(!1===t.options.layer){t.setLayer(null);n(null)}else e.addLayer({id:t.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}}).then(function(i){e.putLayerOnTop(i);t.setLayer(i);n(t.layer);r()})})});return n};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._cancelBtn.disabled=!1;this.setMode(this.mode,!0);return this};e.undo=function(){var e=this.wrap.undo();if(e){this.historyIndex--;t(this);this.historyIndex<=0&&this.resetValues();this.trigger(TC.Consts.event.DRAWUNDO)}return e};e.redo=function(){var e=this.wrap.redo();if(e){this.historyIndex++;t(this);this.trigger(TC.Consts.event.DRAWREDO)}return e};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();n(this);this._cancelBtn.disabled=!0;this.trigger(TC.Consts.event.DRAWCANCEL,{ctrl:this});return this};e.activate=function(){this._newBtn.classList.add(TC.Consts.classes.ACTIVE);this._cancelBtn.disabled=!1;TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this.div.classList.remove(this._pointClass);this.div.classList.remove(this._lineClass);this.div.classList.remove(this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this.div.classList.add(this._pointClass);break;case TC.Consts.geom.POLYLINE:this.div.classList.add(this._lineClass);break;case TC.Consts.geom.POLYGON:this.div.classList.add(this._polygonClass)}};e.deactivate=function(){this._newBtn&&this._newBtn.classList.remove(TC.Consts.classes.ACTIVE);this._cancelBtn&&(this._cancelBtn.disabled=!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();e.resetValues();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(e,t){const n=this;e&&(n.mode=e);if(t&&e){n.layer&&n.layer.map.putLayerOnTop(n.layer);n.activate()}else n.deactivate();return n};e.setStyle=function(e){const t=this;if(e)$.extend(t.style,e);else switch(t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e={line:t.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e={polygon:t.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:e={point:t.styles.point};break;default:e={}}t.isActive&&t.wrap.setStyle(e)};e.getModeStyle=function(e){const t=this;switch(e=e||t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return t.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return t.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return t.styles.point;default:return null}};e.setStrokeColorWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeColor);const n=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);n&&n.length&&(e="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]);t._strokeColorPicker.value=e;if(!Modernizr.inputtypes.color){const n=t._strokeColorPicker;n.style.backgroundColor=e;n.blur()}}return t};e.setStrokeColor=function(e){const t=this,n=t.getModeStyle();n&&(n.strokeColor=e);t.isActive&&t.setStyle();t.setStrokeColorWatch(e);t.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:e});return t};e.setStrokeWidthWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeWidth);if((e=parseInt(e,10))!==Number.NaN){t._strokeWidthSelector.value=e;t._strokeWidthWatch.style.borderBottomWidth=e+"px"}}return t};e.setStrokeWidth=function(e){const t=this;if((e=parseInt(e,10))!==Number.NaN){const n=t.getModeStyle();n&&(n.strokeWidth=e);t.isActive&&t.setStyle();t.setStrokeWidthWatch(e);t.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:e})}return t};e.getLayer=function(){return this._layerPromise};e.setLayer=function(e){this.map&&(this.layer="string"==typeof e?this.map.getLayer(e):e)};e.resetValues=function(){this.history.length=0;this.historyIndex=0;t(this);return this};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.getLayer().then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var e=this;TC.control.Measure.apply(e,arguments);e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]"};e.persistentDrawControls=!0;e.renderPromise().then(function(){e._1stCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-1-t");e._2ndCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-2-t");e._1stCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-1-v");e._2ndCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-2-v");e._elevationText=e.div.querySelector(".tc-ctl-meas-val-coord-ele-t");e._elevationValue=e.div.querySelector(".tc-ctl-meas-val-coord-ele-v")});if(e.options.displayElevation){e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var e=TC.control.DrawMeasureModify.prototype;e.CLASS="tc-ctl-dmm";var t="tcValue";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const n=[],r=function(e){return n.filter(function(t){return t.feature===e})[0]},i=function(e){const t=n.reduce(function(t,n,r){return n.feature===e?r:t},-1);t>=0&&n.splice(t,1)};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",t,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",t,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",t,{},{$key:"deleteAll"}).w('">').h("i18n",t,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w("...</button></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadSketch"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:n},{}).w('<div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-dmm-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox" checked /><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:r},{})}n.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}r.__dustBody=!0;return t}}e.render=function(e){const t=this,n=t._set1stRenderPromise(TC.control.Measure.prototype.render.call(t,function(){t._clearBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");t._clearBtn.addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteAll.confirm"),function(){t.clear()})});t._downloadBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");t._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.showSketchDownloadDialog()});t._elevProfileBtn=t.div.querySelector(".tc-ctl-meas-prof-btn");t._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.elevationProfileActive?t.deactivateElevationProfile():t.activateElevationProfile()});t.options.displayElevation||(t._elevProfileBtn.style.display="none");$.isFunction(e)&&e()})),r={checkboxId:t.getUID(),elevation:t.options.displayElevation};t.getRenderedHtml(t.CLASS+"-dialog",r,function(e){const n=function(e){TC.Util.closeModal();const n={fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:e},r=t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked;if(r){const e="1"===t._dialogDiv.querySelector("input[type=radio][name=ip-coords]:checked").value,r=t.map.getLoadingIndicator(),i=r&&r.addWait(),s={crs:t.map.crs,features:t.layer.features.map(function(t){return t.getGeometryStride()>=3&&(!e||TC.feature.Point&&t instanceof TC.feature.Point)?null:t.clone()}),maxCoordQuantity:t.options.displayElevation.maxCoordQuantity,sampleNumber:0};e&&(s.resolution=parseFloat(t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m input[type=number]").value)||t.options.displayElevation.resolution);t.elevation.setGeometry(s).then(function(e){e.forEach(function(n,r){n||(e[r]=t.layer.features[r])});t.map.exportFeatures(e,n)}).catch(function(e){e!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(t.getLocaleString("elevation.error")):TC.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){r&&r.removeWait(i)})}else{var i;i=t.options.displayElevation&&!r?t.layer.features.map(function(e){var t=e.clone();if(t.getGeometryStride()>2){t.getCoordsArray().forEach(function(e){e.length=2});t.setCoords(t.geometry)}return t}):t.layer.features;t.map.exportFeatures(i,n)}};t._dialogDiv.innerHTML=e;t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(t._selectors.ELEVATION_CHECKBOX,function(e){t.showSketchDownloadDialog()}));t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio][name=ip-coords]",function(e){const n=t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m");"0"===e.target.value?n.classList.add(TC.Consts.classes.HIDDEN):n.classList.remove(TC.Consts.classes.HIDDEN)}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){const r=e.target.dataset.format;r===TC.Consts.format.GPX&&t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon})?TC.confirm(t.getLocaleString("gpxNotCompatible.confirm"),function(){n(r)}):n(r)}))});return n};e.register=function(e){const t=this;return new Promise(function(s,o){TC.control.Measure.prototype.register.call(t,e).then(function(){const o=t.getUID(),a=t.getUID();Promise.all([t.layerPromise,t.renderPromise()]).then(function(l){const c=l[0];c.title=t.getLocaleString("sketch");t._modifyPromise=e.addControl("modify",{id:a,div:t.div.querySelector("."+t.CLASS+"-mod"),layer:c});t._modifyPromise.then(function(n){t.modify=n;n.on(TC.Consts.event.FEATURESSELECT,function(e){t.resultsPanelChart&&!e.features.some(function(e){return t.resultsPanelChart.currentFeature===e})&&t.resultsPanelChart.setCurrentFeature(null);const n=e.features[e.features.length-1];if(n){t.showMeasures(t.getFeatureMeasureData(n));const e=n._originalStyle||n.getStyle();switch(!0){case TC.feature.Polygon&&n instanceof TC.feature.Polygon:t.displayMode(TC.Consts.geom.POLYGON);t.drawPolygons.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);break;case TC.feature.Polyline&&n instanceof TC.feature.Polyline:t.displayMode(TC.Consts.geom.POLYLINE);t.drawLines.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);const i=r(n);if(i){t.resultsPanelChart.setCurrentFeature(n);t.renderElevationChart(i.data)}break;case TC.feature.Point&&n instanceof TC.feature.Point:t.displayMode(TC.Consts.geom.POINT);t.drawPoints.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth)}t.modify.setFontColorWatch(e.fontColor).setFontSizeWatch(e.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(e){t.modify.getSelectedFeatures().length||t.resetDrawWatches();t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(e){if(e.layer===t.layer){i(e.feature);const n=function(e){const n=t.getFeatureMeasureData(e);t.showMeasures(n);t.setFeatureMeasureData(e)};n(e.feature);t.options.displayElevation&&TC.feature.Point&&e.feature instanceof TC.feature.Point&&t.elevation.setGeometry({features:[e.feature],crs:t.map.crs}).then(function(e){n(e[0])});t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e.feature&&t.hide()})}});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){const n=e.control;if(n===t.modify){t.resetDrawWatches();t.resetElevationProfile();if(t.resultsPanelChart){t.resultsPanelChart.setCurrentFeature(null);t.resultsPanelChart.close()}}else if(n===t.drawLines){t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}}).on(TC.Consts.event.FEATURECLICK,function(n){const i=n.feature;if(!(e.activeControl instanceof TC.control.Draw||e.activeControl instanceof TC.control.Modify)&&TC.feature.Polyline&&i instanceof TC.feature.Polyline&&t.layer.features.indexOf(i)>=0){if(t.elevationProfileActive){t.resultsPanelChart&&t.resultsPanelChart.setCurrentFeature(i);e.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===i&&e.hide()})}const n=r(i);t.resultsPanelChart&&t.resultsPanelChart.isMinimized()&&t.resultsPanelChart.maximize();n?t.renderElevationChart(n.data):t.displayElevationProfile(i.geometry)}})});t._drawLinesPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resultsPanelChart&&t.resultsPanelChart.currentFeature&&t.resultsPanelChart.setCurrentFeature(null);t.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){t.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(e){t.resultsPanelChart&&(t.resultsPanelChart.currentFeature=e.feature)}).on(TC.Consts.event.POINT,function(e){const n=this.history.slice(0,this.historyIndex),r=n[n.length-1];r[0]===e.point[0]&&r[1]===e.point[1]||n.push(e.point);t.displayElevationProfile(n)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPolygonsPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPointsPromise=e.addControl("draw",{id:o,div:t.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:t.persistentDrawControls,styleTools:!0,layer:t.layer});t._drawPointsPromise.then(function(n){n.containerControl=t;t.drawControls.push(n);t.drawPoints=n;t.resetValues();n.on(TC.Consts.event.DRAWEND,function(n){const r=function(n){t.showMeasures({coords:n.geometry,units:e.wrap.isGeo()?"degrees":"m"});t.setFeatureMeasureData(n)};r(n.feature);t.options.displayElevation&&t.elevation.setGeometry({features:[n.feature],crs:t.map.crs}).then(function(e){r(e[0])})}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)});n.exportsState=!1});t.setMode(t.options.mode);e.on(TC.Consts.event.FEATUREADD,function(e){const n=e.layer,r=e.feature;if(n===t.layer){t.setFeatureMeasureData(r);t._modifyPromise.then(function(e){e.displayLabelText(r.getStyle().label)});t._clearBtn.disabled=!1;t._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const r=e.layer,s=e.feature;if(r===t.layer)if(0===t.layer.features.length){t._clearBtn.disabled=!0;t._downloadBtn.disabled=!0;t.resetValues();n.length=0}else s&&i(s)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){const t=e.control;t.setCurrentFeature&&t.setCurrentFeature(null)});s(t)})}).catch(function(e){o(e)})})};e.displayMode=function(e){const t=this;e===TC.Consts.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt"));t.modify&&t.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(t,e)};e.setMode=function(e){const t=this;e===TC.Consts.geom.POINT&&t.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(t,e)};e.setFeatureMeasureData=function(e){const n=this,r={};switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:const i=n._1stCoordText.innerHTML,s=n._2ndCoordText.innerHTML,o=n._elevationText.innerHTML;if(n._1stCoordValue.textContent.trim().length>0&&n._2ndCoordValue.textContent.trim().length>0){r.CRS=n.map.crs;r[i.substr(0,i.indexOf(":"))]=$(n._1stCoordValue).data(t);r[s.substr(0,s.indexOf(":"))]=$(n._2ndCoordValue).data(t);o&&(r[n.getLocaleString("ele")]=$(n._elevationValue).data(t));e.setData(r)}break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:if(n._len.innerHTML.trim()!==n.NOMEASURE){r[n.getLocaleString("2dLength")]=n._len.innerHTML;e.setData(r)}break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:if(n._area.innerHTML.trim()!==n.NOMEASURE&&n._peri.innerHTML.trim()!==n.NOMEASURE){r[n.getLocaleString("area")]=n._area.innerHTML;r[n.getLocaleString("2dPerimeter")]=n._peri.innerHTML;e.setData(r)}}return n};e.getFeatureMeasureData=function(e){const t=this,n={units:"m"},i={};t.map.wrap.isGeo()&&(i.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:n.area=e.getArea(i);n.perimeter=e.getLength(i);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:n.length=e.getLength(i);const s=r(e);s?t.renderElevationChart(s.data):t.displayElevationProfile(e.geometry);break;case TC.feature.Point&&e instanceof TC.feature.Point:n.coords=e.geometry}return n};e.showMeasures=function(e){const n=this;TC.control.Measure.prototype.showMeasures.call(n,e);(e=e||{}).units;const r=n.map.options.locale||TC.Cfg.locale;if(e.coords){var i,s,o;if("m"===e.units){i=TC.Consts.METER_PRECISION;s=e.coords[0];o=e.coords[1];n._1stCoordText.innerHTML="x: ";n._2ndCoordText.innerHTML="y: "}else{i=TC.Consts.DEGREE_PRECISION;s=e.coords[1];o=e.coords[0];n._1stCoordText.innerHTML="lat: ";n._2ndCoordText.innerHTML="lon: "}const a=Math.pow(10,i),l=function(e){return Math.round(e*a)/a};n._1stCoordValue.innerHTML=TC.Util.formatNumber(s.toFixed(i),r);$(n._1stCoordValue).data(t,l(s));n._2ndCoordValue.innerHTML=TC.Util.formatNumber(o.toFixed(i),r);$(n._2ndCoordValue).data(t,l(o));if(e.coords.length>2){const i=Math.round(e.coords[2]);n._elevationText.innerHTML=n.getLocaleString("ele").toLowerCase()+": ";n._elevationValue.innerHTML=TC.Util.formatNumber(i.toFixed(TC.Consts.METER_PRECISION),r)+" m";$(n._elevationValue).data(t,i)}else{n._elevationText.innerHTML="";n._elevationValue.innerHTML="";$(n._elevationValue).data(t,null)}}return n};e.resetValues=function(){const e=this;TC.control.Measure.prototype.resetValues.call(e);if(e._1stCoordText){e._1stCoordText.innerHTML=e.NOMEASURE;e._2ndCoordText.innerHTML="";e._1stCoordValue.innerHTML="";$(e._1stCoordValue).data(t,null);e._2ndCoordValue.innerHTML="";$(e._2ndCoordValue).data(t,null);e._elevationText.innerHTML="";e._elevationValue.innerHTML="";$(e._elevationValue).data(t,null)}return e};e.resetDrawWatches=function(){this.drawControls.forEach(function(e){e.setStrokeColorWatch().setStrokeWidthWatch()})};e.clear=function(){const e=this;e.resetValues();e.layer.clearFeatures();e.modify.isActive&&e.modify.deactivate();if(e.options.displayElevation){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}e._clearBtn.disabled=!0;e._downloadBtn.disabled=!0;return e};e.showSketchDownloadDialog=function(e){const t=this._dialogDiv.querySelector("."+this.CLASS+"-dialog"),n=($(t),this.layer.features.some(function(e){return TC.feature.Point&&e instanceof TC.feature.Point||TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint})),r=this.layer.features.some(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline}),i=this.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon}),s=t.querySelector("."+this.CLASS+"-dialog-ip");this._dialogDiv.querySelector(this._selectors.ELEVATION_CHECKBOX).checked&&(r||i)?s.classList.remove(TC.Consts.classes.HIDDEN):s.classList.add(TC.Consts.classes.HIDDEN);const o=t.querySelector("button[data-format=GPX]");r||n?o.classList.remove(TC.Consts.classes.HIDDEN):o.classList.add(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,e);return this};e.onStyleChange=function(e){const t=this;var n;switch(e.target.mode){case TC.Consts.geom.POLYGON:n=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:n=TC.feature.Polyline;break;case TC.Consts.geom.POINT:n=TC.feature.Point}n&&t.modify.getSelectedFeatures().forEach(function(t){if(t instanceof n){const n={};n[e.property]=e.value;t.setStyle(n)}})};e.displayElevationProfile=function(e){const t=this;1===e.length&&(e=e.slice()).push(e[0]);const i=t.map.getLoadingIndicator(),s=i&&i.addWait();t.elevation.getElevation({crs:t.map.crs,coordinates:e}).then(function(o){i&&i.removeWait(s);var a=0,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const u=o.map(function(e,t,n){const r=0===t?e:n[t-1],i=e[0]-r[0],s=e[1]-r[1];a+=Math.sqrt(i*i+s*s);var o=e[2];if("number"==typeof o){l=Math.max(o,l);c=Math.min(o,c)}return[a,o]});t.elevationProfileData={x:u.map(function(e){return e[0]}),ele:u.map(function(e){return e[1]}),coords:o};const h={coords:o};"object"==typeof t.options.displayElevation&&(h.hillDeltaThreshold=t.options.displayElevation.hillDeltaThreshold);$.extend(t.elevationProfileData,TC.tool.Elevation.getElevationGain(h));const p=t.layer.features.filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline}).filter(function(t){for(var n=0,r=t.geometry.length;n<r;n++){const r=e[n],i=t.geometry[n];if(!r||r[0]!==i[0]||r[1]!==i[1])return!1}return!0})[0];p&&function(e,t){var i=r(e);if(!i){i={feature:e};n.push(i)}i.data=t}(p,t.elevationProfileData);t.resultsPanelChart?t.renderElevationChart():t.createChartPanel().then(function(e){t.resultsPanelChart.renderPromise().then(function(){t.renderElevationChart()})})},function(e){t.resetElevationProfile();i&&i.removeWait(s)})};e.createChartPanel=function(){const t=this,n={id:t.getUID(),content:"chart",titles:{main:t.getLocaleString("geo.trk.chart.chpe"),max:t.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:t,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};return new Promise(function(e,r){var i;const s=function(e){n.side=e.SIDE.RIGHT;i=e.addControl("resultsPanel",n)};if(t.options.displayElevation.displayOn){var o=t.map.getControlsByClass("TC.control."+t.options.displayElevation.displayOn[0].toUpperCase()+t.options.displayElevation.displayOn.substring(1))[0];o?s(o):t.map.addControl(t.options.displayElevation.displayOn).then(s)}else{n.div=document.createElement("div");t.map.div.appendChild(n.div);i=t.map.addControl("resultsPanel",n)}i.then(function(n){n.caller=t;t.resultsPanelChart=n;t._decorateChartPanel();e(n)})})};e._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1);t.currentFeature=e;e&&e.toggleSelectedStyle(!0)}};e.renderElevationChart=function(e){const t=this;t.elevationProfileData=e||t.elevationProfileData;if(t.resultsPanelChart&&t.elevationProfileActive){t.resultsPanelChart.openChart(t.elevationProfileData);t.resultsPanelChart.isMinimized()||t.resultsPanelChart.show()}};e.getElevationTooltip=function(e){this.resultsPanelChart.wrap.showElevationMarker({data:e,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};e.activateElevationProfile=function(){const e=this;e.elevationProfileActive=!0;e._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("deactivateElevationProfile"));var t=!1;if(e.drawLines.historyIndex>1){e.displayElevationProfile(e.drawLines.history.slice(0,e.drawLines.historyIndex));t=!0}else{const n=e.modify.getActiveFeatures().filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline});if(n.length){const r=n[n.length-1];e.displayElevationProfile(r.geometry);t=!0}}t||e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.show()};e.deactivateElevationProfile=function(){const e=this;e.elevationProfileActive=!1;e._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("activateElevationProfile"));e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()};e.resetElevationProfile=function(){const e=this;if(e.options.displayElevation&&e.resultsPanelChart){e.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};e.resultsPanelChart.openChart(e.elevationProfileData)}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var e=0,t=function(e,t){return new Promise(function(n,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var i,s;switch(!0){case t instanceof TC.feature.Polygon:s=TC.Consts.geom.POLYGON;break;case t instanceof TC.feature.Polyline:s=TC.Consts.geom.POLYLINE;break;case t instanceof TC.feature.Point:s=TC.Consts.geom.POINT;break;case t instanceof TC.feature.MultiPolygon:s=TC.Consts.geom.MULTIPOLYGON;break;case t instanceof TC.feature.MultiPolyline:s=TC.Consts.geom.MULTIPOLYLINE}i={id:t.id||t.provId,attributes:t.data,type:s,geometry:t.geometry};localforage.setItem(e,i).then(function(){n({feature:t})}).catch(function(e){r({feature:t,error:e})})})})},n=function(e){return new Promise(function(t,n){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(e).then(function(){t(e)}).catch(function(e){n(Error(e))})})})},r=function(e){return new Promise(function(t,n){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e).then(function(n){t({key:e,feature:n})}).catch(function(e){n(e)})})})},i=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+(t||e.layer.id)},s=function(e,t){return i(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},o=function(e,t){return i(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},a=function(e,t){return i(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},l=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t},c=function(e,t){e._deleteBtn.disabled=0===t.length;e._joinBtn.disabled=t.length<2;e._splitBtn.disabled=0===t.filter(l).length},u=function(e,t){e._saveBtn.disabled=t;e._discardBtn.disabled=t;self.checkedOut=!t},h=function(e,t){void 0!==t?u(e,!t):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var t=i(e);localforage.keys().then(function(n){if(n){for(var r=!0,i=0,s=n.length;i<s;i++)if(0===n[i].indexOf(t)){r=!1;break}u(e,r)}})})},p=function(e,t){return new Promise(function(n,r){var i=e._changesLayers[t.id];if(i)n(i);else{i=e._changesLayers[t.id]=new TC.layer.Vector({id:TC.getUID(),title:t.title+" - cambios pendientes",stealth:!0,styles:e.getChangesLayerStyle(t)});var s=e.map.layers.indexOf(t);e.map.insertLayer(i,s+1,function(){n(i)})}})};TC.control.Edit=function(){var r=this;TC.control.SWCacheClient.apply(this,arguments);r._classSelector="."+r.CLASS;r.wrap=new TC.wrap.control.Edit(r);r.layer=null;r.checkedOut=!1;r.callback=arguments[2]&&$.isFunction(arguments[2])?arguments[2]:r.options.callback?r.options.callback:null;r.multi=!!r.options.multi&&r.options.multi;r.eraseActionConfirmTxt=r.options.eraseText?r.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";r.cancelActionConfirmTxt=r.options.cancelText?r.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";r.styles=r.options.styles;r.features={};r.attributeEditor=null;r.pointDraw=null;r.lineDraw=null;r.polygonDraw=null;r.snapping="boolean"!=typeof r.options.snapping||r.options.snapping;r._changesLayers={};r._showsChanges="boolean"!=typeof r.options.showChanges||r.options.showChanges;$.isFunction(r.options.getChangesLayerStyleFunction)&&(r.getChangesLayerStyleFunction=r.getChangesLayerStyle);r.on(TC.Consts.event.FEATUREADD,function(n){var i=n.feature;i.provId="NewFeature."+e++;var o=r._changesLayers[r.layer.id];r.features[r.layer.id].added.push(i);o.addFeature(i);t(s(r)+i.provId,i).then(function(){h(r,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(e){var i=e.feature,l=i.provId||i.id,c=function(){h(r);TC.toast("Eliminaci\xf3n guardada")},u=function(){TC.error("Fallo al guardar eliminaci\xf3n")},p=r._changesLayers[r.layer.id],d=r.features[r.layer.id],f=d.added.indexOf(i);if(f<0){var y=a(r);if((f=d.modified.indexOf(i))<0){if((f=d.removed.indexOf(i))<0){d.removed.push(i);p.addFeature(i);t(y+i.id,i).then(c,u)}}else{d.modified.splice(f,1);d.removed.push(i);n(o(r)+i.id).then(function(){c();t(y+i.id,i).then(c,u)},u)}}else{p.removeFeature(i);d.added.splice(f,1);n(s(r)+l).then(c,u)}}).on(TC.Consts.event.FEATUREMODIFY,function(e){var n=e.feature,i=n.provId||n.id,a=function(){h(r,!0);TC.toast("Modificaci\xf3n guardada")},l=function(){TC.error("Fallo al guardar modificaci\xf3n")},c=r._changesLayers[r.layer.id],u=r.features[r.layer.id],p=u.added.indexOf(n);if(p<0){if((p=u.modified.indexOf(n))<0){c.addFeature(n);u.modified.push(n)}t(o(r)+i,n).then(a,l)}else t(s(r)+i,n).then(a,l)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(e){if(r.serviceWorkerEnabled&&navigator.onLine){var t=r.layer.wrap.getGetFeatureUrl(),n=r.layer.wrap.getDescribeFeatureTypeUrl();t&&n&&r.createCache(r.LOCAL_STORAGE_KEY_PREFIX+r.layer.id,{urlList:[t,n]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(e){}).on(TC.Consts.event.FEATURESSELECT,function(e){var t=r.getSelectedFeatures();c(r,t);t.length&&t[0].showPopup(r.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(e){c(r,r.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var d=TC.control.Edit.prototype;d.CLASS="tc-ctl-edit";d.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";d.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";d.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";d.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";d.template={};if(TC.isDebug){d.template[d.CLASS]=TC.apiLocation+"TC/templates/Edit.html";d.template[d.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{d.template[d.CLASS]=function(){dust.register(d.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"featureEdit"}).w('</h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",r,{},{$key:"selectLayerToEdit"}).w("</option>").s(r.get(["layers"],!1),r,{block:t},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(r.get(["showChanges"],!1),r,{block:n},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",r,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",r,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",r,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",r,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",r,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",r,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",r,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",r,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",r,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",r,{},{$key:"delete"}).w('">').h("i18n",r,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",r,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",r,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",r,{},{$key:"splitGeometry"}).w('">').h("i18n",r,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",r,{},{$key:"syncChanges"}).w('">').h("i18n",r,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",r,{},{$key:"discardChanges"}).w('">').h("i18n",r,{},{$key:"discardChanges"}).w("</button></div>")}e.__dustBody=!0;function t(e,t){return e.w('<option value="').f(t.get(["id"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}t.__dustBody=!0;function n(e,t){return e.w(" checked")}n.__dustBody=!0;return e};d.template[d.CLASS+"-attr"]=function(){dust.register(d.CLASS+"-attr",t);var e={inputText:P,inputNumber:_,inputCheckbox:N,inputDate:I,inputTime:k,inputDatetime:R};function t(t,r){r=r.shiftBlocks(e);return t.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",r,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(r.get(["data"],!1),r,{block:n},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",r,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}t.__dustBody=!0;function n(t,n){n=n.shiftBlocks(e);return t.w("<tr><th>").f(n.get(["name"],!1),n,"h").w("</th><td>").x(n.get(["readOnly"],!1),n,{else:r,block:D},{}).w("</td></tr>")}n.__dustBody=!0;function r(t,n){n=n.shiftBlocks(e);return t.x(n.get(["availableValues"],!1),n,{block:i},{}).h("select",n,{block:o},{key:n.get(["type"],!1)})}r.__dustBody=!0;function i(t,n){n=n.shiftBlocks(e);return t.w('<select class="tc-combo" name="').f(n.get(["name"],!1),n,"h").w('"><option value=""></option>').s(n.get(["availableValues"],!1),n,{block:s},{}).w("</select>")}i.__dustBody=!0;function s(t,n){n=n.shiftBlocks(e);return t.w('<option value="').f(n.getPath(!0,[]),n,"h").w('">').f(n.getPath(!0,[]),n,"h").w("</option>")}s.__dustBody=!0;function o(t,n){n=n.shiftBlocks(e);return t.h("none",n,{block:a},{}).h("eq",n,{block:l},{value:"int"}).h("eq",n,{block:c},{value:"integer"}).h("eq",n,{block:u},{value:"double"}).h("eq",n,{block:h},{value:"boolean"}).h("eq",n,{block:p},{value:"date"}).h("eq",n,{block:f},{value:"time"}).h("eq",n,{block:y},{value:"dateTime"}).h("eq",n,{block:m},{value:"byte"}).h("eq",n,{block:g},{value:"long"}).h("eq",n,{block:C},{value:"negativeInteger"}).h("eq",n,{block:v},{value:"nonNegativeInteger"}).h("eq",n,{block:T},{value:"nonPositiveInteger"}).h("eq",n,{block:L},{value:"positiveInteger"}).h("eq",n,{block:S},{value:"short"}).h("eq",n,{block:b},{value:"unsignedLong"}).h("eq",n,{block:w},{value:"unsignedInt"}).h("eq",n,{block:E},{value:"unsignedShort"}).h("eq",n,{block:O},{value:"unsignedByte"}).h("eq",n,{block:A},{value:"float"}).h("eq",n,{block:x},{value:"decimal"})}o.__dustBody=!0;function a(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputText"),n,{},{})}a.__dustBody=!0;function l(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}l.__dustBody=!0;function c(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}c.__dustBody=!0;function u(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}u.__dustBody=!0;function h(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputCheckbox"),n,{},{})}h.__dustBody=!0;function p(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputDate"),n,{},{})}p.__dustBody=!0;function f(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputTime"),n,{},{})}f.__dustBody=!0;function y(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputDatetime"),n,{},{})}y.__dustBody=!0;function m(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}m.__dustBody=!0;function g(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}g.__dustBody=!0;function C(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}C.__dustBody=!0;function v(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}v.__dustBody=!0;function T(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}T.__dustBody=!0;function L(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}L.__dustBody=!0;function S(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}S.__dustBody=!0;function b(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}b.__dustBody=!0;function w(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}w.__dustBody=!0;function E(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}E.__dustBody=!0;function O(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}O.__dustBody=!0;function A(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}A.__dustBody=!0;function x(t,n){n=n.shiftBlocks(e);return t.b(n.getBlock("inputNumber"),n,{},{})}x.__dustBody=!0;function P(t,n){n=n.shiftBlocks(e);return t.w('<input type="text" class="tc-textbox" name="').f(n.get(["name"],!1),n,"h").w('" value="').f(n.get(["value"],!1),n,"h").w('" />')}P.__dustBody=!0;function _(t,n){n=n.shiftBlocks(e);return t.w('<input type="number" class="tc-textbox" name="').f(n.get(["name"],!1),n,"h").w('" value="').f(n.get(["value"],!1),n,"h").w('" />')}_.__dustBody=!0;function N(t,n){n=n.shiftBlocks(e);return t.w('<input type="checkbox" name="').f(n.get(["name"],!1),n,"h").w('"').x(n.get(["value"],!1),n,{block:M},{}).w("/>")}N.__dustBody=!0;function M(t,n){n=n.shiftBlocks(e);return t.w(" checked")}M.__dustBody=!0;function I(t,n){n=n.shiftBlocks(e);return t.w('<input type="date" class="tc-textbox" name="').f(n.get(["name"],!1),n,"h").w('" value="').f(n.get(["value"],!1),n,"h").w('" />')}I.__dustBody=!0;function k(t,n){n=n.shiftBlocks(e);return t.w('<input type="time" class="tc-textbox" name="').f(n.get(["name"],!1),n,"h").w('" value="').f(n.get(["value"],!1),n,"h").w('" />')}k.__dustBody=!0;function R(t,n){n=n.shiftBlocks(e);return t.w('<input type="datetime" class="tc-textbox" name="').f(n.get(["name"],!1),n,"h").w('" value="').f(n.get(["value"],!1),n,"h").w('" />')}R.__dustBody=!0;function D(t,n){n=n.shiftBlocks(e);return t.f(n.get(["value"],!1),n,"h")}D.__dustBody=!0;return t}}d.register=function(t){var n=this;const l=TC.control.SWCacheClient.prototype.register.call(n,t),c=n.getUID(),u=n.getUID(),h=n.getUID();t.addControl("popup",{closeButton:!0}).then(function(e){n.attributeEditor=e});t.on(TC.Consts.event.LAYERUPDATE,function(t){const l=t.layer;if(l.type===TC.Consts.layerType.WFS&&!l.options.stealth){var c=n.features[l.id]=n.features[l.id]||{added:[],modified:[],removed:[]};p(n,l).then(function(t){n.layer!==l&&t.setVisibility(!1);var u=i(n,l.id),h=s(n,l.id),p=o(n,l.id),d=a(n,l.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(n){if(n)for(var i=0,s=n.length;i<s;i++){var o=n[i];0===o.indexOf(u)&&r(o).then(function(n){var r,i=n.key;if(0===i.indexOf(d)){r=i.substr(d.length);var s=l.getFeatureById(r);l.removeFeature(s);t.addFeature(s);c.removed.push(s)}else if(0===i.indexOf(p)){r=i.substr(p.length);if(s=l.getFeatureById(r)){t.addFeature(s);c.modified.push(s);s.wrap.setGeometry(n.feature.geometry);s.setData(n.feature.attributes)}}else if(0===i.indexOf(h)){r=i.substr(h.length);var o,a=parseInt(r.substr(r.lastIndexOf(".")+1));e=Math.max(e,a+1);switch(n.feature.type){case TC.Consts.geom.POINT:o=l.addPoint(n.feature.geometry);break;case TC.Consts.geom.POLYLINE:o=l.addPolyline(n.feature.geometry);break;case TC.Consts.geom.POLYGON:o=l.addPolygon(n.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:o=l.addMultiPolyline(n.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:o=l.addMultiPolygon(n.feature.geometry)}o.then(function(e){t.addFeature(e);c.added.push(e);e.provId=r;e.setData(n.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(e){const t=e.layer;if(t.type===TC.Consts.layerType.WFS&&!t.options.stealth){n.features[t.id]=n.features[t.id]||{added:[],modified:[],removed:[]};const e=document.createElement("option");e.setAttribute("value",t.id);e.innerHTML=t.title||t.id;n._layerSelect.appendChild(e)}}).on(TC.Consts.event.LAYERREMOVE,function(e){const t=e.layer;if(t.type===TC.Consts.layerType.WFS&&!t.options.stealth){var r=n._layerSelect.querySelector("option[value="+t.id+"]");r.selected&&n.setLayer(null);r.parentElement.removeChild(r)}}).on(TC.Consts.event.POPUP,function(e){if(e.control===n.attributeEditor){for(var t=e.control.currentFeature,r=n.attributes.slice(),i={},s=n._joinedFeatureAttributes||[],o=0,a=r.length;o<a;o++){var l=t.getData()||{},c=r[o];c.value=l[c.name];"id"===c.name&&(c.readOnly=!0);c.availableValues=[];for(var u=0,h=s.length;u<h;u++){var p=s[u][c.name];void 0!==p&&""!==p&&(c.availableValues[c.availableValues.length]=p)}i[c.name]=c.type}r.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});n.getRenderedHtml(n.CLASS+"-attr",{data:r},function(e){const r=n.attributeEditor.contentDiv;r.innerHTML=e;const s=r.querySelectorAll("input"),o=r.querySelectorAll("select");s.forEach(function(e){e.addEventListener("input",function(e){const t=e.target;for(var n=0,r=o.length;n<r;n++){const r=o[n];if(r.matches("[name="+e.target.getAttribute("name")+"]")&&r.value!==t.value){r.value="";break}}})});o.forEach(function(e){e.addEventListener("change",function(e){const t=e.target;for(var n=0,r=s.length;n<r;n++){const e=s[n];if(e.matches("[name="+t.getAttribute("name")+"]")){e.value=t.value;break}}})});r.querySelector("."+n.CLASS+"-btn-attr-ok").addEventListener("click",function(){var e={};s.forEach(function(t){var n=t.getAttribute("name"),r=t.value;switch(i[n]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":r=parseInt(r);Number.isNaN(r)||(e[n]=r);break;case"double":case"float":case"decimal":r=parseFloat(r);Number.isNaN(r)||(e[n]=r);break;case"date":case"time":case"dateTime":e[n]=new Date(r);break;case"boolean":e[n]=!!r;break;case void 0:break;default:e[n]=r}});t.setData(e);n.trigger(TC.Consts.event.FEATUREMODIFY,{feature:t,layer:n.layer});n.attributeEditor.hide()});r.querySelector("."+n.CLASS+"-btn-attr-cancel").addEventListener("click",function(){n.attributeEditor.hide()})})}});t.loaded(function(){if(n.options.layer)n.setLayer(n.options.layer);else{var e=t.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WFS&&!e.options.stealth});1===e.length?n.setLayer(e[0].id):n.setLayer(null)}n.showChanges(n._showsChanges);n.renderPromise().then(function(){Promise.all([t.addControl("draw",{id:c,div:n.div.querySelector("."+n.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),t.addControl("draw",{id:u,div:n.div.querySelector("."+n.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),t.addControl("draw",{id:h,div:n.div.querySelector("."+n.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(e){n.pointDraw=e[0];n.lineDraw=e[1];n.polygonDraw=e[2];var t=function(e){var t,r=e.feature;switch(n.geometryType){case TC.Consts.geom.POINT:t=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:t=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:t=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:t=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:t=TC.feature.MultiPolygon}t&&(r=new t(r.geometry,{geometryName:n.layer.options.geometryName}));n.layer.addFeature(r);n.trigger(TC.Consts.event.FEATUREADD,{feature:r})},r=function(){n.cancel()};n.pointDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);n.lineDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);n.polygonDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);n.options.modes&&$.isArray(n.options.modes)&&1==n.options.modes.length&&n.setMode(n.options.modes[0],null)})})});return l};d.render=function(e){var t=this,n=[];if(t.map)for(var r=0,i=t.map.workLayers.length;r<i;r++){var s=t.map.workLayers[r];s.type!==TC.Consts.layerType.WFS||s.options.stealth||n.push({id:s.id,title:s.title||s.id})}return t._set1stRenderPromise(TC.Control.prototype.renderData.call(t,{layers:n,showChanges:t.showChanges},function(){t._layerDiv=t.div.querySelector(t._classSelector+"-layer");t._layerSelect=t._layerDiv.querySelector(t._classSelector+"-layer-sel");t._layerSelect.addEventListener("change",function(e){t.setLayer(t._layerSelect.value)});t._layerDiv.querySelector("#"+t.CLASS+"-view-changes-cb").addEventListener("change",function(e){t.showChanges(e.target.checked)});t._cancelBtn=t.div.querySelector(t._classSelector+"-btn-cancel");t._cancelBtn.addEventListener("click",function(){t.cancel()});t._deleteBtn=t.div.querySelector(t._classSelector+"-btn-delete");t._deleteBtn.addEventListener("click",function(){TC.confirm(t.eraseActionConfirmTxt,function(){t.deleteFeatures(t.getSelectedFeatures())})});t._joinBtn=t.div.querySelector(t._classSelector+"-btn-join");t._joinBtn.addEventListener("click",function(){t.joinFeatures(t.getSelectedFeatures())});t._splitBtn=t.div.querySelector(t._classSelector+"-btn-split");t._splitBtn.addEventListener("click",function(){t.splitFeatures(t.getSelectedFeatures())});t._saveBtn=t.div.querySelector(t._classSelector+"-btn-save");t._saveBtn.addEventListener("click",function(){t.applyEdits()});t._discardBtn=t.div.querySelector(t._classSelector+"-btn-discard");t._discardBtn.addEventListener("click",function(){t.discardEdits()});if(t.options.modes&&$.isArray(t.options.modes)&&t.options.modes.length>0){for(var n in TC.Consts.editMode)if("string"==typeof n&&t.options.modes.indexOf(TC.Consts.editMode[n])<0){const e=t.div.querySelector("label"+t._classSelector+"-btn-"+TC.Consts.editMode[n]);e.parentElement.removeChild(e);const r=t.div.querySelector("div"+t._classSelector+"-"+TC.Consts.editMode[n]);r.parentElement.removeChild(r)}if(1===t.options.modes.length){var r=t.options.modes[0];t.div.querySelector("label"+t._classSelector+"-btn-"+r).style.display="none"}}t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.addEventListener("change",function(){var e=this.value,n=t.mode===e?void 0:e;t.setMode(n)})});$.isFunction(e)&&e()}))};d.setLayer=function(e){var t=this;t.layer=map.getLayer(e);t.setMode(null);if(t.layer){p(t,t.layer).then(function(e){for(var n in t._changesLayers){var r=t._changesLayers[n];r.setVisibility(t._showsChanges&&r===e)}});t.layer.describeFeatureType().then(function(e){t.attributes=e.filter(function(e){switch(e.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":t.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":t.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":t.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":t.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var n=0,r=t.attributes.length;n<r;n++){var i=t.attributes[n];i.type=i.type.substr(i.type.indexOf(":")+1)}t.renderPromise().then(function(){h(t);t.div.querySelector(t._classSelector+"-layer-sel").value=t.layer.id;const e=t.div.querySelectorAll("input[type=radio][name=mode]");var n;switch(t.geometryType){case TC.Consts.geom.POINT:n="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:n="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:n="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:n="[value]"}e.forEach(function(e){e.disabled=!e.matches(n)})})})}else{t.renderPromise().then(function(){h(t,!1);t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.disabled=!0;e.checked=!1})});t.layer=null}};d.setMode=function(e){var t=this;t.mode=e;!function(e){e._deleteBtn.disabled=!0;e._joinBtn.disabled=!0;e._splitBtn.disabled=!0}(t);var n,r,i=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};switch(e){case TC.Consts.editMode.SELECT:n=t.div.querySelector(t._classSelector+"-select");r=t.div.querySelectorAll(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.activate();break;case TC.Consts.editMode.ADDPOINT:n=t.div.querySelector(t._classSelector+"-point");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-line,"+t._classSelector+"-polygon");i(t.pointDraw);break;case TC.Consts.editMode.ADDLINE:n=t.div.querySelector(t._classSelector+"-line");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-polygon");i(t.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:n=t.div.querySelector(t._classSelector+"-polygon");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line");i(t.polygonDraw);break;default:n=null;r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.isActive&&t.deactivate();t.pointDraw&&t.pointDraw.isActive&&t.pointDraw.deactivate();t.lineDraw&&t.lineDraw.isActive&&t.lineDraw.deactivate();t.polygonDraw&&t.polygonDraw.isActive&&t.polygonDraw.deactivate()}if(e){const n=t.div.querySelector("input[type=radio][name=mode][value="+e+"]");n.checked=!0;n.classList.add(TC.Consts.classes.CHECKED);n.nextSibling.classList.add(TC.Consts.classes.CHECKED)}else t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.checked=!1;e.classList.remove(TC.Consts.classes.CHECKED);e.nextSibling.classList.remove(TC.Consts.classes.CHECKED)});n&&n.classList.remove(TC.Consts.classes.HIDDEN);r.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})};d.showChanges=function(e){this._showsChanges=e;for(var t in this._changesLayers){this._changesLayers[t].setVisibility(e&&this.layer&&t===this.layer.id)}};d.cancel=function(){this.options.modes&&$.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};d.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};d.activate=function(e){TC.Control.prototype.activate.call(this);var t=e||{};this._cancelBtn.disabled=!1;this.wrap.activate(t.mode?t.mode:this.mode);TC.Control.prototype.activate.call(this)};d.deactivate=function(){TC.Control.prototype.deactivate.call(this);this.wrap.cancel(!0);this._cancelBtn.disabled=!0;this.wrap.deactivate()};d.isExclusive=function(){return!0};d.joinFeatures=function(e){var t=this;if(t.geometryType===TC.Consts.geom.MULTIPOLYLINE||t.geometryType===TC.Consts.geom.MULTIPOLYGON||t.geometryType===TC.Consts.geom.MULTIPOINT){t._joinedFeatureAttributes=[];if(e.length>1){for(var n=e.map(function(e){t._joinedFeatureAttributes[t._joinedFeatureAttributes.length]=e.getData();return e.geometry}).reduce(function(e,t){return e.concat(t)}),r=new e[0].constructor(n),i=0,s=e.length;i<s;i++){var o=e[i];t.layer.removeFeature(o);t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:o})}t.layer.addFeature(r).then(function(e){t.setSelectedFeatures([r]);t.trigger(TC.Consts.event.FEATUREADD,{feature:e});e.showPopup(t.attributeEditor)})}c(t,[r])}};d.splitFeatures=function(e){for(var t=this,n=e.filter(l),r=n.map(function(e){return e.geometry}),i=[],s=0,o=n.length;s<o;s++)for(var a=(f=n[s]).getData(),u=r[s],h=0,p=u.length;h<p;h++)i[i.length]=new f.constructor([u[h]],{data:a});s=0;for(var d=n.length;s<d;s++){var f=n[s];t.layer.removeFeature(f);t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:f})}var y=new Array(i.length);for(s=0,d=i.length;s<d;s++){(y[s]=t.layer.addFeature(i[s])).then(function(e){t.trigger(TC.Consts.event.FEATUREADD,{feature:e})})}Promise.all(y).then(function(){t.setSelectedFeatures(i)});c(t,i)};d.deleteFeatures=function(e){this.wrap.deleteFeatures(e);0===this.layer.features.length&&(this._deleteBtn.disabled=!0)};d.applyEdits=function(){var e=this;if(e.layer){var t=e.features[e.layer.id];e.layer.applyEdits(t.added,t.modified,t.removed).then(function(){e.discardEdits();e.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(e){TC.error("Error ["+e.code+"] al guardar cambios: "+e.reason)})}};d.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=i(e);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(n){if(n){for(var r=0,i=n.length;r<i;r++){var s=n[r];0===s.indexOf(t)&&localforage.removeItem(s)}if(e.layer){var o=e.features[e.layer.id];o.added.length=0;o.modified.length=0;o.removed.length=0;e.setSelectedFeatures([]);e.attributeEditor.hide();e._changesLayers[e.layer.id].clearFeatures();e.deleteCache(t).then(function(){e.layer.refresh()})}h(e,!1)}})})};d.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};d.setSelectedFeatures=function(e){return this.wrap.setSelectedFeatures(e)};d.getLayer=function(){return this.layer};d.getChangesLayerStyle=function(e){var t=function(t){for(var n,r=e.wrap.getRGBA(t),i=0;i<3;i++)r[i]=255-r[i];4===(n=(65536*r[0]+256*r[1]+r[2]).toString(16)).length?n="00"+n:5===n.length&&(n="0"+n);return"#"+n},n=[1,3],r=$.extend(!0,{},e.options.styles);if(r.point){r.point.strokeColor=t(r.point.strokeColor);r.point.lineDash=n}if(r.line){r.line.strokeColor=t(r.line.strokeColor);r.line.lineDash=n}if(r.polygon){r.polygon.strokeColor=t(r.polygon.strokeColor);r.polygon.lineDash=n}return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection="boolean"!=typeof this.options.allowReprojection||this.options.allowReprojection}};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){const t=e[0];t.disabled=!0;t.classList.add("tc-ctl-xwms-option-selected")}};e.register=function(e){if(TC.isLegacy){console.warn("El control ExternalWMS no soporta modo legacy");return}const t=this,n=TC.Control.prototype.register.call(t,e);t.div.addEventListener("change",TC.EventTarget.listenerBySelector("select",function(e){if(""!==e.target.value){var n=e.target.value;0===n.indexOf("//")&&(n=location.protocol+n);t.div.querySelector("input").value=n;e.target.value=""}}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector('button[name="agregar"]',function(e){var n=t.div.querySelector("input").value.trim();if(n)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(n))if(t._addedUrls.some(function(e){return e.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")}))TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{var r=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var i=TC.Util.getQueryStringParams(n);/https?:\/\/|\/\//i.test(n)||(n="//"+n);var s=["version","service","request"],o=function(e,t){for(var n=0;n<t.length;n++)e=TC.Util.removeURLParameter(e,t[n]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e}(n,Object.keys(i));for(var a in i)s.indexOf(a.toLowerCase())>=0&&delete i[a];const e=t.div.querySelector("button");e.disabled=!0;for(var l={id:"xwms"+ ++t.count,type:"WMS",url:o,hideTree:!1,queryParams:i},c=0;c<t.options.suggestions.length;c++){var u=$.grep(t.options.suggestions[c].items,function(e,t){return e.url===n});if(u.length>0&&u[0].layerNames){l.layerNames=u[0].layerNames;break}}var h=new TC.layer.Raster(l);h.getCapabilitiesPromise().then(function(i){if(void 0!==i.Capability){var s=i.Capability.Layer;if(s.CRS&&-1==s.CRS.indexOf(t.map.crs)&&!t.allowReprojection){TC.alert(t.getLocaleString("serviceSrsNotCompatible"));r.hide();e.disabled=!1;return}t.map.trigger(TC.Consts.event.EXTERNALSERVICEADDED,{layer:h});t.div.querySelector("input").value="";const o=[];t.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")&&o.push(e)});t.markServicesAsSelected(o);t._addedUrls.push(n);r.hide();e.disabled=!1}else{TC.alert(t.getLocaleString("noLayersFoundInService"));r.hide();e.disabled=!1}},function(n){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+n);r.hide();e.disabled=!1})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))}));e.on(TC.Consts.event.LAYERADD,function(e){const n=e.layer;if(n&&!n.isBase){var r=n.url;if(r){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];0===t.div.querySelectorAll("select option").length&&r&&-1===t.pending_markServicesAsSelected.indexOf(r)&&t.pending_markServicesAsSelected.push(r);const e=[];t.div.querySelectorAll("select option").forEach(function(t){t.value.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")&&e.push(t)});t.markServicesAsSelected(e);t._addedUrls.push(r)}}});return n};e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/ExternalWMS.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.x(t.get(["title"],!1),t,{block:n},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(t.get(["suggestions"],!1),t,{block:r},{}).w('</select><input type="url" class="tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",t,{},{$key:"addService"}).w("</button></div></div>")}t.__dustBody=!0;function n(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"addMaps"}).w("</h2>")}n.__dustBody=!0;function r(e,t){return e.x(t.get(["group"],!1),t,{block:i},{}).s(t.get(["items"],!1),t,{block:s},{}).x(t.get(["group"],!1),t,{block:o},{})}r.__dustBody=!0;function i(e,t){return e.w('<optgroup label="').f(t.get(["group"],!1),t,"h").w('">')}i.__dustBody=!0;function s(e,t){return e.w('<option value="').f(t.get(["url"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w("</option>")}s.__dustBody=!0;function o(e,t){return e.w("\t</optgroup>")}o.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(t.options,function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];t.pending_markServicesAsSelected.forEach(function(e){const n=[];t.div.querySelectorAll("select option").forEach(function(t){TC.Util.addProtocol(t.value)===TC.Util.addProtocol(e)&&n.push(t)});t.markServicesAsSelected(n);t._addedUrls.push(e)});t.pending_markServicesAsSelected=[]}))}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.FeatureInfo(e);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";e.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.FeatureInfo.prototype,t=function e(t,n){var r;if($.isArray(t))for(var i=0,s=(r=t.slice()).length;i<s;i++)r[i]=e(r[i]);else r="number"==typeof t?Math.round(t.toFixed(n)):t;return r};e.register=function(e){const t=TC.control.FeatureInfoCommons.prototype.register.call(this,e);document.createElement("div").appendChild(this.div);return t};e.callback=function(e,t){var n=this;if(n.elevation){n.querying=!0;n.elevationRequest=n.elevation.getElevation({crs:n.map.crs,coordinates:e})}if(n.map&&n.filterLayer){var r=n.getLocaleString("featureInfo"),i=$.extend({},n.map.options.styles.marker,n.markerStyle,{title:r,set:r,showsPopup:!1});n.filterLayer.clearFeatures();n.filterLayer.addMarker(e,i).then(function(t){n.map.putLayerOnTop(n.filterLayer);n.filterFeature=t;for(var r=!1,i=0;i<n.map.workLayers.length;i++){var s=n.map.workLayers[i];if(s.type===TC.Consts.layerType.WMS&&s.getVisibility()&&s.names.length>0){r=!0;break}}var o=n.map.getResolution();r?n.wrap.getFeatureInfo(e,o):setTimeout(function(){n.responseCallback({coords:e})})})}};e.responseCallback=function(e){var n=this;const r=function(r){TC.control.FeatureInfoCommons.prototype.responseCallback.call(n,e);if(n.filterFeature){var i=e.services;if(i)for(var s=0;s<i.length;s++){for(var o=i[s],a=0;a<o.layers.length;a++)if(!o.layers[a].features.length){o.layers.splice(a,1);a-=1}if(!o.layers.length){i.splice(s,1);s-=1}}n.info.defaultFeature=e.defaultFeature;var l=n.map.options.locale||TC.Cfg.locale;e.isGeo=n.map.wrap.isGeo();if(r.length){const t=r[0][2];e.elevation=null===t?null:TC.Util.formatNumber(Math.round(t),l)}if(e.coords){e.crs=n.map.crs;e.coords=e.coords.map(function(t){return TC.Util.formatNumber(t.toFixed(e.isGeo?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),l)})}if(i&&i.length||null!==e.elevation)n.renderData(e,function(){n.insertLinks();if(n.sharedFeatureInfo){n.div.querySelectorAll("ul."+n.CLASS+"-services li").forEach(function(e){e.classList.add(TC.Consts.classes.CHECKED)});for(var e,r=n.sharedFeatureInfo,i=0,s=n.info.services.length;i<s;i++){var o=n.info.services[i];if(o.mapLayers.some(function(e){return e.url===r.s})){for(var a=0,l=o.layers.length;a<l;a++){var c=o.layers[a];if(c.name===r.l){for(var u=0,h=c.features.length;u<h;u++){var p=c.features[u];if(p.id===r.f){e=p;var d=hex_md5(JSON.stringify({data:p.getData(),geometry:t(p.geometry,TC.Consts.DEGREE_PRECISION)}));r.h!==d&&TC.alert(n.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}if(e){n.highlightedFeature=e;n.map.addLayer({id:n.getUID(),type:TC.Consts.layerType.VECTOR,title:n.getLocaleString("foi"),stealth:!0}).then(function(t){n.sharedFeatureLayer=t;n.filterLayer.clearFeatures();t.addFeature(e);n.map.zoomToFeatures([e])})}delete n.sharedFeatureInfo}else n.displayResults()});else{n.resultsLayer.clearFeatures();n.filterLayer.clearFeatures()}}};n.elevationRequest?n.elevationRequest.then(r):r([])};e.loadSharedFeature=function(e){const t=this;if(e){if(0===jQuery.grep(t.map.workLayers,function(t,n){return t.type===TC.Consts.layerType.WMS&&t.url===e.s&&t.getDisgregatedLayerNames().indexOf(e.l)>=0}).length){TC.error(t.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST);return}t.sharedFeatureInfo=e;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){const n=[-100,-100];t.beforeRequest({xy:n});t.filterLayer.clearFeatures();t.filterLayer.addMarker(n).then(function(n){t.filterFeature=n;t.wrap.getFeatureInfo(e.xy,e.r,{serviceUrl:e.s,layerName:e.l,featureId:e.f})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.control.FeatureTools=function(){const e=this;TC.Control.apply(e,arguments);e.layer=null;e.exportsState=!0;const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:t+"-dialog-ip-m"};e.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)});e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv)};TC.inherit(TC.control.FeatureTools,TC.Control);!function(){var e=TC.control.FeatureTools.prototype;e.CLASS="tc-ctl-ftools";e.TITLE_SEPARATOR=" \u2022 ";e.FILE_TITLE_SEPARATOR="__";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureTools.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureToolsDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ftools"><button class="tc-ctl-ftools-dl-btn" title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w('</button><button class="tc-ctl-ftools-share-btn" title="').h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"share"}).w('</button><button class="tc-ctl-ftools-zoom-btn" title="').h("i18n",t,{},{$key:"zoomToFeature"}).w('">').h("i18n",t,{},{$key:"zoomToFeature"}).w('</button><button class="tc-ctl-ftools-del-btn" title="').h("i18n",t,{},{$key:"deleteFeature"}).w('">').h("i18n",t,{},{$key:"deleteFeature"}).w("</button></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-ftools-dialog tc-ctl-ftools-dl-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w(" - ").h("i18n",t,{},{$key:"download"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:n},{}).w('<div class="tc-ctl-ftools-dialog-dl"><div><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div></div><div class="tc-ctl-ftools-dialog tc-ctl-ftools-share-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w(" - ").h("i18n",t,{},{$key:"share"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-ftools-share-dialog-ctl"></div></div></div></div>')}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-ftools-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox"><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:r},{})}n.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-ftools-dialog-ip tc-hidden"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="finfo-ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="finfo-ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-ftools-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}r.__dustBody=!0;return t}}e.register=function(e){const t=this;e.on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){t.currentDisplay=e.control;if(t.currentDisplay.caller||!t.currentDisplay.caller&&t.currentDisplay.currentFeature){t.highlightedFeature=t.currentDisplay.caller||!t.currentDisplay.currentFeature?t.currentDisplay.caller.highlightedFeature:t.currentDisplay.currentFeature;t.highlightedFeature&&(t.highlightedFeature.showsPopup=!0);t.addUI(t.currentDisplay)}}).on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){t.currentDisplay=null}).on(TC.Consts.event.FEATUREADD,function(e){const n=e.feature;if(t.currentDisplay&&t.currentDisplay.caller&&n===t.currentDisplay.caller.highlightedFeature){t.highlightedFeature=n;t.highlightedFeature.showsPopup=!0}}).on(TC.Consts.event.FEATUREREMOVE,function(n){const r=n.feature;if(r===t.highlightedFeature){const n=r.clone();n.showsPopup=!0;e.getControlsByClass("TC.control.Popup").concat(e.getControlsByClass("TC.control.ResultsPanel")).forEach(function(e){e.currentFeature===t.highlightedFeature&&(e.currentFeature=n)});t.getHighlightLayer().then(function(e){e.addFeature(n)})}});return new Promise(function(n,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){t.map.addControl("share",{id:t.getUID(),div:t._dialogDiv.querySelector(".tc-modal-body ."+t.CLASS+"-share-dialog-ctl"),includeControls:!1}).then(function(e){t._shareCtl=e;n(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})})};e.render=function(e){const n=this;return n._set1stRenderPromise(n.getRenderedHtml(n.CLASS+"-dialog",{checkboxId:n.getUID(),elevation:n.options.displayElevation},function(r){n._dialogDiv.innerHTML=r;n._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){TC.Util.closeModal();const r=n.map.getLoadingIndicator(),i=r&&r.addWait(),s={};if(n._dialogDiv.querySelector(n._selectors.ELEVATION_CHECKBOX)&&n._dialogDiv.querySelector(n._selectors.ELEVATION_CHECKBOX).checked){const e="1"===n._dialogDiv.querySelector(n._selectors.INTERPOLATION_RADIO+":checked").value;s.elevation={resolution:e?parseFloat(n._dialogDiv.querySelector(n._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||n.options.displayElevation.resolution:0}}t(n,s).then(function(t){n.map.exportFeatures([t],{fileName:n._getFeatureFilename(t),format:e.target.dataset.format})},function(e){e!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(n.getLocaleString("elevation.error")):TC.alert(n.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){r&&r.removeWait(i)})}));n._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(n._selectors.ELEVATION_CHECKBOX,function(e){n.showDownloadDialog()}));n._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(n._selectors.INTERPOLATION_RADIO,function(e){const t=n._dialogDiv.querySelector(n._selectors.INTERPOLATION_DISTANCE);"0"===e.target.value?t.classList.add(TC.Consts.classes.HIDDEN):t.classList.remove(TC.Consts.classes.HIDDEN)}));n.trigger(TC.Consts.event.CONTROLRENDER);$.isFunction(e)&&e()}))};e.addUI=function(e){const t=this,n=e.getMenuElement(),r=function(){return n&&!n.querySelector("."+t.CLASS)};r()?t.getRenderedHtml(t.CLASS,null,function(i){if(r()){const r=(new DOMParser).parseFromString(i,"text/html").body.firstChild;n.appendChild(r);t.updateUI(e);if(!t.map.options.stateful){const e=r.querySelector("."+t.CLASS+"-share-btn");e.parentElement.removeChild(e)}t._setToolButtonHandlers(r);t._decorateDisplay(e.getContainerElement())}}):t.updateUI(e)};e._decorateDisplay=function(e){const t=this;if(t.highlightedFeature){if(e.querySelector("table.tc-attr")){e.querySelector("table.tc-attr").addEventListener(TC.Consts.event.CLICK,function(e){t.zoomToCurrentFeature()});e.querySelector("table.tc-attr").classList.add(t.CLASS+"-zoom");e.querySelector("table.tc-attr").setAttribute("title",t.getLocaleString("clickToCenter"))}TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){var n="";if(t.highlightedFeature){n=t.highlightedFeature.id;!0===t.highlightedFeature.showsPopup&&new TC.control.Print({target:e,title:n})}})}};e.updateUI=function(e){const t=this,n=e.getMenuElement().querySelector("."+t.CLASS);n.classList.remove(TC.Consts.classes.ACTIVE);clearTimeout(t._uiUpdateTimeout);t._uiUpdateTimeout=setTimeout(function(){const e=t.getCurrentFeature();e&&e.showsPopup?n.classList.add(TC.Consts.classes.ACTIVE):n.classList.remove(TC.Consts.classes.ACTIVE)},100)};e._setToolButtonHandlers=function(e){const t=this;e.querySelector("."+t.CLASS+"-dl-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.showDownloadDialog()});t.map.options.stateful&&e.querySelector("."+t.CLASS+"-share-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.showShareDialog()});e.querySelector("."+t.CLASS+"-zoom-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.zoomToCurrentFeature()});e.querySelector("."+t.CLASS+"-del-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.removeCurrentFeature()})};e.getHighlightLayer=function(){const e=this;return new Promise(function(t,n){e.layer?t(e.layer):e.map.addLayer({id:e.getUID(),title:e.CLASS+": Highlighted features layer",type:TC.Consts.layerType.VECTOR,stealth:!0}).then(function(n){e.layer||(e.layer=n);t(e.layer)})})};e.showDownloadDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-dialog"),n=e.getCurrentFeature(),r=(TC.feature.Point&&n instanceof TC.feature.Point||TC.feature.MultiPoint&&TC.feature.MultiPoint,TC.feature.Polyline&&n instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&n instanceof TC.feature.MultiPolyline),i=TC.feature.Polygon&&n instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&n instanceof TC.feature.MultiPolygon,s=t.querySelector("."+e.CLASS+"-dialog-ip");s&&(e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX)&&!e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX).checked||!r&&!i?s.classList.add(TC.Consts.classes.HIDDEN):s.classList.remove(TC.Consts.classes.HIDDEN));const o=t.querySelector("button[data-format=GPX]");i?o.classList.add(TC.Consts.classes.HIDDEN):o.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(e._dialogDiv.querySelector("."+e.CLASS+"-dl-dialog"))};e.showShareDialog=function(){const e=this;TC.Util.showModal(e._dialogDiv.querySelector("."+e.CLASS+"-share-dialog"),{openCallback:function(){e.onShowShareDialog()},closeCallback:function(){e._shareCtl.featureToShare=null}})};e.getCurrentFeature=function(){return this.currentDisplay&&(this.currentDisplay.caller&&this.currentDisplay.caller.highlightedFeature||this.currentDisplay.currentFeature)};e.zoomToCurrentFeature=function(){const e=this;e.map&&e.map.zoomToFeatures([e.getCurrentFeature()],{animate:!0})};e.removeCurrentFeature=function(){const e=this,t=e.getCurrentFeature(),n=function(){e.highlightedFeature=null;t&&t.layer&&t.layer.removeFeature(t)},r=function(){e.currentDisplay&&(e.currentDisplay.close?e.currentDisplay.close():e.currentDisplay.hide())};if(e.currentDisplay&&e.currentDisplay.caller&&e.currentDisplay.caller.highlightedFeature===t||t.layer===e.layer){n();r()}else TC.confirm(e.getLocaleString("deleteFeature.confirm"),function(){n();r()})};const t=function(e,t){t=t||{};return new Promise(function(n,r){const i=e.getCurrentFeature();if(i){const o=i.clone();o.setId(i.id);o.layer=i.layer;if(t.elevation){var s=!0;!t.elevation.resolution&&o.getGeometryStride()>2&&(s=!1);if(s){const i={crs:e.map.crs,features:[o],maxCoordQuantity:e.options.displayElevation&&e.options.displayElevation.maxCoordQuantity,resolution:t.elevation.resolution,sampleNumber:0};e.elevation.setGeometry(i).then(function(e){n(e[0])},function(e){r(Error(e))})}else n(o)}else{const e=o.getCoordsArray(),t=e[0];if(t&&t.length>2){e.forEach(function(e){e.length=2});o.setCoords(o.geometry)}n(o)}}else n(null)})};e.onShowShareDialog=function(){const e=this._shareCtl;e.extraParams=null;t(this).then(function(t){e.featureToShare=t;const n=e.div,r=e.generateLink();n.querySelector(".tc-url input[type=text]").value=r;n.querySelector(".tc-iframe input[type=text]").value=e.generateIframe(r)})};e.getFeatureTitle=function(e){var t="";e&&(t=e.id);return t};e._getFeatureFilename=function(e){return(this.getFeatureTitle(e).toString().replace(new RegExp(this.TITLE_SEPARATOR,"g"),this.FILE_TITLE_SEPARATOR)||this.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){const t=this;e.layer&&t.getHighlightLayer().then(function(t){t.importState(e.layer)})}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){TC.Control.apply(this,arguments);$.isArray(this.options.formats)?this.formats=this.options.formats:this.formats=[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];this.layers=[];this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[];this.exportsState=!0};TC.inherit(TC.control.FileImport,TC.Control);!function(){var e=TC.control.FileImport.prototype;e.CLASS="tc-ctl-file";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FileImport.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",t,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(t.get(["formats"],!1),t,{block:n},{}).w('" />').h("i18n",t,{},{$key:"openFile"}).w("</label></div></div>")}t.__dustBody=!0;function n(e,t){return e.w(".").f(t.getPath(!0,[]),t,"h").h("sep",t,{block:r},{})}n.__dustBody=!0;function r(e,t){return e.w(",")}r.__dustBody=!0;return t};e.register=function(e){var t=this;const n=TC.Control.prototype.register.call(t,e);t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options);e.on(TC.Consts.event.FEATURESIMPORT,function(n){const r=n.fileName,i=n.dropTarget,s=n.features;var o="."+TC.Consts.format.GPX.toLowerCase();r.toLowerCase().indexOf(o)===r.length-o.length||i!==t.map.div&&i!==t||e.addLayer({id:t.getUID(),title:r,type:TC.Consts.layerType.VECTOR}).then(function(n){t.layers.push(n);const r=function(e,t){return e.concat(t)};for(var i=function(e){var n=e.geometry;if(n){var i;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:i=[n];break;case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:case TC.feature.Polyline&&e instanceof TC.feature.Polyline:i=n;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:case TC.feature.Polygon&&e instanceof TC.feature.Polygon:i=n.reduce(r);break;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:i=n.reduce(r).reduce(r)}i.every(function(e){return Math.abs(e[0])<=180&&Math.abs(e[1])<=90})&&e.setCoords(TC.Util.reproject(n,"EPSG:4326",t.map.crs))}return e},o=0,a=s.length;o<a;o++){var l=i(s[o]);n.addFeature(l)}setTimeout(function(){e.zoomToFeatures(n.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(e){var n,r=e.file.name;n=".kmz"===r.toLowerCase().substr(r.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(t.getLocaleString(n,{fileName:r}),TC.Consts.msgErrorMode.TOAST);var i=new FileReader;i.onload=function(e){TC.error("Nombre del archivo: "+r+" \n Contenido del archivo: \n\n"+e.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};i.readAsText(e.file)}).on(TC.Consts.event.FEATUREREMOVE,function(e){const n=e.layer;t.layers.indexOf(n)>=0&&(n.features.length||t.map.removeLayer(n))}).on(TC.Consts.event.LAYERREMOVE,function(e){const n=t.layers.indexOf(e.layer);n>=0&&t.layers.splice(n,1)});return n};e.render=function(){const e=this;return e._set1stRenderPromise(e.renderData({formats:e.formats},function(){const t=e.div.querySelector("input[type=file]");t.addEventListener(TC.Consts.event.CLICK,function(e){const t=document.createElement("form"),n=this.parentElement;n.insertBefore(t,this);t.appendChild(this);t.reset();t.insertAdjacentElement("afterend",this);n.removeChild(t)});t.addEventListener("change",function(t){if(e.map){console.log("salta el change");e.map.wrap.loadFiles(t.target.files,{control:e})}})}))};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,layers:e.layers.map(function(e){return{title:e.title,state:e.exportState()}})}:null};e.importState=function(e){const t=this;if(t.map){const n=[];e.layers.forEach(function(e){n.push(t.map.addLayer({id:t.getUID(),title:e.title,type:TC.Consts.layerType.VECTOR}))});Promise.all(n).then(function(n){for(var r=0,i=n.length;r<i;r++){const i=n[r];i.importState(e.layers[r].state);t.layers.push(i)}})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){TC.Control.apply(this,arguments);this.fullScreenElement=document.documentElement};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var e=TC.control.FullScreen.prototype;e.CLASS="tc-ctl-fscreen";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FullScreen.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",t,{},{$key:"fscreen.tip"}).w('"></button>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);n.then(function(){const e=t.div.querySelector("."+t.CLASS+"-btn");if(t.enabledFullScreen()){e.addEventListener(TC.Consts.event.CLICK,function(){t.toggleFullScreen()});const n=function(){t.isFullScreen()?e.classList.add(TC.Consts.classes.ACTIVE):e.classList.remove(TC.Consts.classes.ACTIVE);e.setAttribute("title",t.isFullScreen()?t.getLocaleString("fscreen.tip.return"):t.getLocaleString("fscreen.tip"))};document.addEventListener("fullscreenchange",n);document.addEventListener("mozfullscreenchange",n);document.addEventListener("webkitfullscreenchange",n);document.addEventListener("MSFullscreenChange",n)}else t.disable()});return n};e.requestFullScreen=function(){var e=this.fullScreenElement;document.documentElement.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()};e.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};e.isFullScreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.toggleFullScreen=function(){this.isFullScreen()?this.cancelFullScreen():this.requestFullScreen()};e.enabledFullScreen=function(){var e=this.fullScreenElement,t=document.documentElement.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;return t&&"function"==typeof t}}();Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,n=0;n<t;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)};!function(){for(var e=0,t=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),r=0,i=t.length;r<i&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!n){var s=window.requestAnimationFrame,o=+new Date;window.requestAnimationFrame=function(e,t){s(function(t){return e(t<1e12?t:t-o)},t)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(e){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv);this.delta=500;this.walkingSpeed=5e3;this.gapHill=this.options.gapHill||20;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var e=TC.control.Geolocation.prototype;e.CLASS="tc-ctl-geolocation";e.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:300,MEDIUM_WIDTH:310,MAX_WIDTH:445};e.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";e.template[e.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";e.template[e.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";e.template[e.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div> \x3c!-- img se insertan en el div del mapa--\x3e <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;"></div> <div class="tc-ctl-geolocation-track-panel-block" ><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",t,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",t,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" checked value="tracks" /><span>').h("i18n",t,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",t,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",t,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",t,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",t,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",t,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",t,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",t,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel"> <div class="tc-alert alert-warning tc-hidden" ><p id="panel-msg">').h("i18n",t,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",t,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",t,{},{$key:"geo.trk.render"}).w('">').h("i18n",t,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",t,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",t,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",t,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><div class="tc-ctl-geolocation-track-center tc-hidden"><button title="').h("i18n",t,{},{$key:"geo.trk.center"}).w('"></button></div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-node"]=function(){dust.register(e.CLASS+"-track-node",t);function t(e,t){return e.w('<li data-id="').f(t.get(["id"],!1),t,"h").w('" data-uid="').f(t.get(["uid"],!1),t,"h").w('"><span class="tc-draw tc-selectable" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",t,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",t,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",t,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",t,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",t,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",t,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",t,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",t,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-snapping-node"]=function(){dust.register(e.CLASS+"-track-snapping-node",t);function t(e,t){return e.w("<ul>").x(t.get(["n"],!1),t,{block:n},{}).w("<li> <span>").x(t.get(["isGeo"],!1),t,{else:r,block:i},{}).w(":</span> ").f(t.get(["x"],!1),t,"h").w("</li><li> <span>").x(t.get(["isGeo"],!1),t,{else:s,block:o},{}).w(":</span> ").f(t.get(["y"],!1),t,"h").w(" </li>").x(t.get(["z"],!1),t,{block:a},{}).x(t.get(["m"],!1),t,{block:c},{}).w("</ul>")}t.__dustBody=!0;function n(e,t){return e.w("<li><span>").h("i18n",t,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(t.get(["n"],!1),t,"h").w("</li>")}n.__dustBody=!0;function r(e,t){return e.w("X")}r.__dustBody=!0;function i(e,t){return e.h("i18n",t,{},{$key:"lon"})}i.__dustBody=!0;function s(e,t){return e.w("Y")}s.__dustBody=!0;function o(e,t){return e.h("i18n",t,{},{$key:"lat"})}o.__dustBody=!0;function a(e,t){return e.h("ne",t,{block:l},{key:t.get(["z"],!1),value:0})}a.__dustBody=!0;function l(e,t){return e.w("<li> <span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" </li>")}l.__dustBody=!0;function c(e,t){return e.w("<li> ").f(t.get(["m"],!1),t,"h").w(" </li>")}c.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.gps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",t,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",t,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",t,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",t,{},{$key:"ok"}).w(" </button></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-tracking-toast"]=function(){dust.register(e.CLASS+"-tracking-toast",t);function t(e,t){return e.w('<table class="tc-ctl-geolocation-info-tracking"><tr><th>').x(t.get(["isGeo"],!1),t,{else:n,block:r},{}).w(":</th><td> ").f(t.get(["x"],!1),t,"h").w(" </td>").x(t.get(["accuracy"],!1),t,{block:i},{}).w("</tr><tr><th>").x(t.get(["isGeo"],!1),t,{else:s,block:o},{}).w(":</th><td> ").f(t.get(["y"],!1),t,"h").w(" </td>").x(t.get(["speed"],!1),t,{block:a},{}).w("</tr><tr>").x(t.get(["z"],!1),t,{block:l},{}).x(t.get(["mdt"],!1),t,{block:h},{}).w("</tr> </table>")}t.__dustBody=!0;function n(e,t){return e.w("X")}n.__dustBody=!0;function r(e,t){return e.h("i18n",t,{},{$key:"lon"})}r.__dustBody=!0;function i(e,t){return e.w("<th>").h("i18n",t,{},{$key:"geo.trk.accuracy"}).w(":</th><td> ").f(t.get(["accuracy"],!1),t,"h").w(" m </td>")}i.__dustBody=!0;function s(e,t){return e.w("Y")}s.__dustBody=!0;function o(e,t){return e.h("i18n",t,{},{$key:"lat"})}o.__dustBody=!0;function a(e,t){return e.w("<th>").h("i18n",t,{},{$key:"geo.trk.speed"}).w(":</th><td>").f(t.get(["speed"],!1),t,"h").w(" km/h</td>")}a.__dustBody=!0;function l(e,t){return e.w("<th>").x(t.get(["isGeo"],!1),t,{else:c,block:u},{}).w(":</th><td> ").f(t.get(["z"],!1),t,"h").w(" m </td>")}l.__dustBody=!0;function c(e,t){return e.w("Z")}c.__dustBody=!0;function u(e,t){return e.h("i18n",t,{},{$key:"ele"})}u.__dustBody=!0;function h(e,t){return e.w('<th title="').h("i18n",t,{},{$key:" mdt.title"}).w('">').h("i18n",t,{},{$key:"ele"}).w(" (").h("i18n",t,{},{$key:"mdt"}).w("):</th><td>").f(t.get(["mdt"],!1),t,"h").w(" m </td>")}h.__dustBody=!0;return t}}e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.wrap=new TC.wrap.control.Geolocation(t);t.wrap.register(e);e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"}).then(function(e){t.layerGPS=e});e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(e){t.layerTracking=e});e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(e){var t=e.getData().name;return t&&(t+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}}}}).then(function(e){t.layerTrack=e});e.on(TC.Consts.event.FEATURESIMPORT,function(e){const t=this,n=e.fileName,r=e.dropTarget;var i="."+TC.Consts.format.KML.toLowerCase(),s="."+TC.Consts.format.GPX.toLowerCase();if(n.toLowerCase().indexOf(s)===n.length-s.length||n.toLowerCase().indexOf(i)===n.length-i.length&&r===t){t.clear(t.Const.Layers.TRACK);t.importTrack(e);/.kml$/g.test(n.toLowerCase())&&t.layerTrack&&t.layerTrack.styles&&t.layerTrack.features.forEach(function(e){e instanceof TC.feature.Point&&t.layerTrack.styles.point?e.setStyle(t.layerTrack.styles.point):e instanceof TC.feature.Polyline&&t.layerTrack.styles.line&&e.setStyle(t.layerTrack.styles.line)})}}.bind(t));return n};e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,e)})};e.importTrack=function(e){var t=this;if(t.isDisabled)/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(e.fileName&&e.features&&e.features.length>0){var n=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;const s=[];for(var r=0,i=e.features.length;r<i;r++)s.push(t.layerTrack.addFeature(e.features[r]));Promise.all(s).then(function(){t.wrap.processImportedFeatures({wait:n,notReproject:e.notReproject});if(t.layerTrack){t.map&&t.map.layout&&t.map.layout.accordion&&t.div.classList.contains(TC.Consts.classes.COLLAPSED)&&t.map.controls.filter(function(e){return e!==t&&!e.containerControl}).forEach(function(e){e.div.classList.add(TC.Consts.classes.COLLAPSED)});t.div.classList.remove(TC.Consts.classes.COLLAPSED);t.div.querySelector("."+t.CLASS+"-btn-tracks > span").click();e.isShared||t.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};e.prepareFeaturesToShare=function(e){const t=this;return new Promise(function(n,r){if(e){var i=t.availableTracks.filter(function(t){return t.uid.toString()===e.toString()})[0].data,s=Math.pow(10,TC.Consts.DEGREE_PRECISION+1),o=(new ol.format.GeoJSON).readFeatures(i);const r=new Array(o.length);o.forEach(function(e,t){r[t]=TC.wrap.Feature.createFeature(e)});Promise.all(r).then(function(e){t.featuresToShare=e.map(function(e){const t={};switch(!0){case TC.feature.Marker&&e instanceof TC.feature.Marker:t.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&e instanceof TC.feature.Point:t.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:t.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:t.type=TC.Consts.geom.MULTIPOLYLINE}t.id=e.id;t.geom=TC.Util.compactGeometry(e.geometry,s);t.data=e.getData();return t});n()})}else n()})};var t=!0;e.renderData=function(o,a){const l=this;var c=l.Const.Selector;return TC.Control.prototype.renderData.call(l,o,function(){const o=l.div.querySelectorAll(l._classSelector+"-panel");l.div.querySelectorAll("."+l.CLASS+"-select span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var t=e.target;t&&"LABEL"!==t.tagName;)t=t.parentElement;const n=t.querySelector("input[type=radio][name=mode]").value;o.forEach(function(e){e.matches("."+l.CLASS+"-"+n)?e.classList.remove(TC.Consts.classes.HIDDEN):e.classList.add(TC.Consts.classes.HIDDEN)})})});l.track={activateButton:l.div.querySelector(l._classSelector+"-track-ui-activate"),deactivateButton:l.div.querySelector(l._classSelector+"-track-ui-deactivate"),trackSearch:l.div.querySelector(l._classSelector+"-track-available-srch"),trackImportFile:l.div.querySelector(l._classSelector+"-track-import"),trackSave:l.div.querySelector(l._classSelector+"-track-save"),trackAdd:l.div.querySelector(l._classSelector+"-track-add-wpt"),trackContinue:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-continue"),trackRenew:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-new"),trackClose:l._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-ok")};l.track.trackList=l.div.querySelector(l._classSelector+"-track-available-lst");l.track.trackToolPanelOpened=l.div.querySelector("#tc-ctl-geolocation-track-panel-opened");l.div.querySelector("."+e.CLASS+"-track-panel-help").addEventListener("click",function(){s.call(l)});l.track.trackName=l.div.querySelector(l._classSelector+"-track-title");l.track.trackWPT=l.div.querySelector(l._classSelector+"-track-waypoint");TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&(l.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.trackImportFile.disabled=!1;l.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(e){const t=document.createElement("form"),n=this.parentElement;n.insertBefore(t,this);t.appendChild(this);t.reset();t.insertAdjacentElement("afterend",this);n.removeChild(t)});l.track.trackImportFile.addEventListener("change",function(e){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,n);l.map.wrap.loadFiles(e.target.files,{control:l})}}})}else console.log("no es posible la importaci\xf3n");l.track.activateButton.addEventListener("click",function(){l.activateTracking();r.call(l)});l.track.deactivateButton.addEventListener("click",function(){l.deactivateTracking();i.call(l)});var h=function(e){e=e.toLowerCase();const t=Array.from(l.track.trackList.querySelectorAll("li"));t.forEach(function(e){e.style.display="none"});const n=t.filter(function(e){return e.matches("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK)}),r=l.div.querySelector(l._classSelector+"-track-search-icon");if(0===e.length){n.forEach(function(e){e.style.display=""});r.style.visibility="visible"}else{r.style.visibility="hidden";var i=new RegExp(e,"i");n.forEach(function(e){e.style.display=i.test(e.querySelector("span").textContent)?"":"none"});n.some(function(e){return""===e.style.display})||t.forEach(function(e){e.matches('[class^="tc-ctl-geolocation-track-not"]')&&(e.style.display="")})}};const p=function(){h(this.value.toLowerCase().trim())};l.track.trackSearch.addEventListener("keyup",p);l.track.trackSearch.addEventListener("search",p);try{if(l.track.trackSearch.querySelector("::-ms-clear")){l.track.trackSearch.addEventListener("mouseup",function(e){""!==l.track.trackSearch.value&&setTimeout(function(){var e=l.track.trackSearch.value;""===e&&h(e)},1)})}}catch(e){}l.track.trackSave.addEventListener("click",l.saveTrack.bind(l));l.track.trackAdd.addEventListener("click",l.addWaypoint.bind(l));const d=l.div.querySelector(l._classSelector+"-track-available-lst");var f=function(e,t){"LI"!==t.tagName&&(t=t.parentElement);const n=t.querySelector("input"),r=t.querySelector("span");if(e){n.classList.remove(TC.Consts.classes.HIDDEN);n.focus();n.value=r.textContent;r.classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EDIT).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.DELETE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.DRAW).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_GPX).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_KML).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.SAVE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{n.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EDIT).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.DELETE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.DRAW).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_GPX).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_KML).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.SAVE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(e,t){if(t){var n=[c.SIMULATE,c.EDIT,c.DELETE,c.EXPORT_GPX,c.EXPORT_KML],r=[c.STOP,c.PAUSE,c.BACKWARD,c.FORWARD,c.SPEED],i="LI"===t.tagName?t:t.parentNode;n.forEach(function(t){i.querySelector(t).hidden=e});r.forEach(function(t){i.querySelector(t).hidden=!e})}};d.addEventListener("click",TC.EventTarget.listenerBySelector(c.SIMULATE,function(e){var t=l.getLoadingIndicator().addWait();e.target.parentElement.querySelector(c.SPEED).textContent="x 1";g(l,e.target).then(function(){l.getLoadingIndicator().removeWait(t)})}));d.addEventListener("click",TC.EventTarget.listenerBySelector(c.DRAW,function(e){var t=l.getLoadingIndicator().addWait();m(l,e.target).then(function(){l.getLoadingIndicator().removeWait(t)})}));l.on(l.Const.Event.IMPORTEDTRACK,function(e){if(l.isDisabled)l.map.toast(l.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const t=l.track.trackList.querySelector('li[data-id="'+e.index+'"]');m(l,t.querySelector(c.DRAW));$(l.track.trackList).animate({scrollTop:e.index*t.offsetHeight},"slow")}});const y=function(e,t){e.track.trackList.querySelectorAll("li[data-id]").forEach(function(n){if(n.dataset.id!==t){const t=n.querySelector(c.SIMULATE),r=n.querySelector(c.PAUSE);t.classList.remove(e.Const.Classes.SIMULATIONACTIVATED);t.setAttribute("title",e.getLocaleString("tr.lst.simulate"));r.classList.remove("play");r.setAttribute("title",e.getLocaleString("tr.lst.pause"));e.uiSimulate(!1,n);f(!1,n)}});e.clear(e.Const.Layers.TRACK)};var m=function(e,t){return new Promise(function(n,r){const i=t.parentElement;setTimeout(function(){if(i.classList.contains(e.Const.Classes.SELECTEDTRACK)){e.uiSimulate(!1,t);e.clear(e.Const.Layers.TRACK);t.setAttribute("title",t.textContent)}else if(e.getSelectedTrack()){y(e,i.dataset.id);e.drawTrack(i)}else e.drawTrack(i);i.classList.contains(e.Const.Classes.SELECTEDTRACK)?e.prepareFeaturesToShare(i.dataset.uid).then(function(){n()}):n()},0)})},g=function(e,t){return new Promise(function(n,r){setTimeout(function(){const r=t.parentElement;y(e,r.dataset.id);e.uiSimulate(!1,e.getSelectedTrack());e.uiSimulate(!0,t);e.simulate_paused=!1;e.simulateTrack(r);n()},0)})};d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EDIT,function(e){f(!0,e.target)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.DELETE,function(e){l.removeTrack(e.target.parentElement)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.SAVE,function(e){if(0===e.target.parentElement.querySelector("input").value.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName(e.target.parentElement.dataset.id,e.target.parentElement.querySelector("input").value);f(!1,e.target)}}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.CANCEL,function(e){f(!1,e.target)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EXPORT_GPX+","+l._classSelector+" "+c.EXPORT_KML,function(e){const t=e.target.parentElement;var n=Array.from(e.target.classList).filter(function(e){return 0===e.indexOf("tc-btn-export-")})[0].replace("tc-btn-export-","").toUpperCase();l.export(n,t).then(function(e){if(e){var r=t.querySelector("span").textContent,i=new RegExp(l.Const.SupportedFileExtensions.join("|"),"gi"),s=r.replace(i,"");TC.Util.downloadFile(s+"."+n.toLowerCase(),l.Const.MimeMap[n],e)}else TC.alert(l.getLocaleString("geo.error.export"))})}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.STOP,function(e){l.uiSimulate(!1,e.target);l.wrap.simulateTrackEnd();const t=e.target.parentElement.querySelector(c.PAUSE);t.classList.remove("play");t.setAttribute("title",l.getLocaleString("tr.lst.pause"));e.target.parentElement.querySelector(c.SPEED).textContent="x 1";l.simulate_speed=1}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.PAUSE,function(e){l.simulate_paused=!e.target.classList.contains("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);e.target.setAttribute("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));l.simulate_paused?e.target.classList.add("play"):e.target.classList.remove("play")}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.BACKWARD,function(e){1==l.simulate_speed?l.simulate_speed=.5:l.simulate_speed=l.simulate_speed/2;e.target.parentElement.querySelector(l._classSelector+" "+c.FORWARD).disabled=!1;e.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;.000244140625==l.simulate_speed&&(e.target.disabled=!0)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.FORWARD,function(e){l.simulate_speed=l.simulate_speed/.5;e.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;e.target.parentElement.querySelector(l._classSelector+" "+c.BACKWARD).disabled=!1;4096==l.simulate_speed&&(e.target.disabled=!0)}));l.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();u.call(l)});l.track.trackRenew.addEventListener("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.trackClose.addEventListener("click",function(){i.call(l)});l.track.trackAdvertisementOK.addEventListener("click",function(){const e=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(e.length>0){new Promise(function(e,t){window.localforage?e():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){e()})}).then(function(){localforage.setItem(e[0].getAttribute("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=document.querySelector("#tc-ctl-geolocation-track-render");l.track.renderTrack.addEventListener("change",function(){l.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&l.layerTracking.setVisibility(this.checked);t=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()});$.isFunction(a)&&a()})};e.activate=function(){};e.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var n=function(){this.map.off(TC.Consts.event.LAYERERROR,n);this.clearFileInput(this.track.trackImportFile);TC.alert(this.getLocaleString("geo.trk.upload.error3"))},r=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},i=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},s=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};e.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};e.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};e.setFormatInfoNewPosition=function(e){var t={},n=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var r=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(e.position,this.map.crs,this.map.view3D.crs):e.position;t.x=r[0].toLocaleString(n);t.y=r[1].toLocaleString(n);t.mdt=Math.round(this.map.view3D.getHeightFromMDT(r)).toLocaleString(n);t.isGeo=!0}else{t.x=Math.round(e.position[0]).toLocaleString(n);t.y=Math.round(e.position[1]).toLocaleString(n)}t.z=Math.round(e.altitude).toLocaleString(n);t.accuracy=Math.round(e.accuracy).toLocaleString(n);t.speed=e.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1});return t};e.renderInfoNewPosition=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",t.setFormatInfoNewPosition(e.pd),function(e){if(t.track.infoPanel)"boolean"==typeof t.track.infoPanel||t.track.infoPanel.isMinimized()||t.track.infoPanel.renderPromise().then(function(){t.track.infoPanel.getTableContainer().innerHTML=e;t.track.infoPanel.isVisible()||t.track.infoPanel.doVisible()});else{t.track.infoPanel=!0;var n,r={content:"table",titles:{main:t.getLocaleString("geo.mylocation"),max:t.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const s=function(e){r.side=e.SIDE.RIGHT;n=e.addControl("resultsPanel",r)};if(t.options.displayOn){var i=t.map.getControlsByClass("TC.control."+t.options.displayOn[0].toUpperCase()+t.options.displayOn.substring(1))[0];i?s(i):t.map.addControl(t.options.displayOn).then(s)}else{r.div=document.createElement("div");t.map.div.appendChild(r.div);n=t.map.addControl("resultsPanel",r)}n.then(function(n){n.caller=t;t.map.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.content&&e!==n}).forEach(function(e){e.close()});t.track.infoPanel=n;n.renderPromise().then(function(){n.open(e)})})}})};var o,a,l,c=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},u=function(){var e=this;e.activate();r.call(e);c.call(e);e.on(e.Const.Event.POSITIONCHANGE,function(t){e.currentPoint=t.pd;e.renderInfoNewPosition(t);e.track.trackName.disabled=!1;e.track.trackSave.disabled=!1;e.track.trackWPT.disabled=!1;e.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking).features)});e.on(e.Const.Event.STATEUPDATED,function(e){});e.clear(e.Const.Layers.TRACKING);m.call(e,e.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);e.wrap.setTracking(!0)},h=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();y.apply(this)},p=function(){var e=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();document[e]||h.apply(this);console.log("video is: "+this.videoScreenOn.paused)},d=function(){l||(l=p.bind(this));o||(o=function(){f.apply(this)}.bind(this));a||(a=h.bind(this));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",o,!1);window.addEventListener("pageshow",a,!1)}else{window.addEventListener("blur",o,!1);window.addEventListener("focus",a,!1)}},f=function(){var e=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);e&&e.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e))},y=function(){var e=this;localforage.getItem(e.Const.LocalStorageKey.TRACKINGTEMP).then(function(t){null!==t&&"null"!==t&&t.length>0&&TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,t)})},m=function(e){var t=this;new Promise(function(e,t){window.localforage?e():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){e()})}).then(function(){localforage.getItem(e).then(function(n){if(null==n){const n=t._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),r=n.querySelector('input[type="checkbox"]');r.setAttribute("name",e);r.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop");n.querySelector("h3").textContent=e==t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title");TC.Util.showModal(t._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});t.map.toast(TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};e._askTracking=function(e){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){$.isFunction(e)&&e()}});return!0};e.activateTracking=function(){var e=this,t=!0;e.isActive||e.activate();e.clear(e.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TEST,e.Const.LocalStorageKey.TEST)}catch(n){n.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(e.getLocaleString("geo.error.trackinglocalstorage")):TC.error(n);t=!1}if(t){(function(){if(!this.videoScreenOn){var e={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var t=document.createElement("source");t.src=e.WebM;t.type="video/webm";this.videoScreenOn.appendChild(t);var n=document.createElement("source");n.src=e.MP4;n.type="video/mp4";this.videoScreenOn.appendChild(n)}this.videoScreenOn.play()}).apply(e);d.apply(e);e.sessionTracking=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);if(e.sessionTracking){e._askTracking(function(){i.call(e)})||e.track.trackRenew.click()}else u.call(e)}else i.call(e)};e.deactivateTracking=function(){var e=this,n=function(){e.track.infoPanel.close();f.apply(e);e.wrap.setTracking(!1);delete e.geopositionTracking;t||e.div.querySelector(e._classSelector+"-track-render").querySelector("label").click();(function(){this.videoScreenOn&&this.videoScreenOn.pause()}).apply(e);(function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",o,!1);window.removeEventListener("pageshow",a,!1)}else{window.removeEventListener("blur",o,!1);window.removeEventListener("focus",a,!1)}}).apply(e);e.off(e.Const.Event.POSITIONCHANGE);e.off(e.Const.Event.STATEUPDATED);i.call(e);e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.clear(e.Const.Layers.TRACKING);e.clear(e.Const.Layers.GPS);return!0};if(e.wrap.hasCoordinates()){e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return n()}return n()};e.getStoredTracks=function(){const e=this;return new Promise(function(t,n){var r=[];localforage.keys().then(function(n){if(0==(n=n.filter(function(t){return 0!==t.indexOf(e.Const.LocalStorageKey.TRACKINGTEMP)&&0===t.indexOf(e.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(t)})).length){e.availableTracks=r;t(r)}const i=new Array(n.length);n.forEach(function(e,t){i[t]=new Promise(function(t,n){localforage.getItem(e,function(e,n){t(n)})})});Promise.all(i).then(function(n){if(n&&n.length){n.forEach(function(e){(e=JSON.parse(e))instanceof Array?r=r.concat(e):r.push(e)});var i=r.length>1?g(r):r;e.availableTracks=i;t(i)}})})})};var g=function(e){var t=[];for(var n in e)if(e[n]&&"object"==typeof e[n]){t.push(e[n]);t.sort(function(e,t){return"string"==typeof e.name&&$.isFunction(e.name.localeCompare)?e.name.localeCompare(t.name):0})}return t};e.setStoredTracks=function(e){const t=this;return new Promise(function(n,r){const i=[];e.forEach(function(e){i.push(new Promise(function(n,r){localforage.setItem(t.Const.LocalStorageKey.TRACKING+"#"+e.uid,JSON.stringify(e),function(e,t){n(t)})}))});Promise.all(i).then(function(){t.getStoredTracks().then(function(){t.bindTracks();n()})})})};e.getAvailableTracks=function(){const e=this;return new Promise(function(t,n){e.availableTracks?t(e.availableTracks):e.getStoredTracks().then(function(e){t(e)})})};e.bindTracks=function(){var e=this;e.track.trackList.querySelectorAll("li").forEach(function(e){e.style.display="none"});e.getAvailableTracks().then(function(t){if(C(t)){e.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(e){e.style.display=""});e.track.trackSearch.disabled=!0}else{const s=e.getSelectedTrack();var n;s&&(n=s.dataset.uid);e.track.trackList.querySelectorAll("li[data-id]").forEach(function(t){e.track.trackList.removeChild(t)});for(var r=0;r<t.length;r++){var i=t[r];"object"==typeof i&&e.getRenderedHtml(e.CLASS+"-track-node",{id:r,uid:i.uid,name:i.name?i.name.trim():""},function(t){const n=(new DOMParser).parseFromString(t,"text/html").body.firstChild;e.track.trackList.appendChild(n)})}n&&e.setSelectedTrack(e.track.trackList.querySelector('li[data-uid="'+n+'"]'));e.track.trackSearch.disabled=!1}})};e.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);const e=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();this.miDiv=document.createElement("div");this.miDiv.classList.add("miDiv");this.miDiv.style.width=e.width+"px";this.miDiv.style.height=e.height+"px";this.miProgressDiv=document.createElement("div");this.miProgressDiv.classList.add("miProgressDiv");this.miProgressDiv.classList.add(this.CLASS+"-track-elevation-chart-progress");this.miProgressDiv.classList.add(TC.Consts.classes.HIDDEN);this.miProgressDiv.style.width="0%";this.miProgressDiv.style.height=e.height+"px";this.miProgressTextDiv=document.createElement("div");this.miProgressTextDiv.classList.add("miProgressTextDiv");this.miProgressTextDiv.classList.add("tc-ctl-geolocation-track-elevation-chart-progress");this.miProgressTextDiv.classList.add("text");this.miProgressTextDiv.style.width=e.width+"px";this.miProgressTextDiv.style.height=e.height+"px";this.miDiv.style.top=e.top+"px";this.miDiv.style.left=e.left+"px";this.miDiv.style.bottom=e.bottom+"px";this.miDiv.style.right=e.right+"px";this.miDiv.style.position="absolute";this.miDiv.style.zIndex=10008;this.miDiv.style.display="none";this.miProgressDiv.appendChild(this.miProgressTextDiv);this.miDiv.appendChild(this.miProgressDiv);document.body.appendChild(this.miDiv)};e.chartProgressClear=function(){const e=this;if(e.miDiv){e.miDiv.parentElement.removeChild(e.miDiv);e.miDiv=null;e.miProgressDiv=null;e.miProgressTextDiv=null}};e.chartSetProgress=function(e,t,n,r){if(this.miDiv){"none"===this.miDiv.style.display&&(this.miDiv.style.display="");this.miProgressDiv.classList.remove(TC.Consts.classes.HIDDEN);var i=e.d,s=(i+Math.hypot(e.p[0]-t[0],e.p[1]-t[1]))/n*100;this.miProgressDiv.style.width=s+"%";var o,a,l=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,c=parseInt(t[2].toFixed(0)).toLocaleString(l);if(i/1e3<1){o=Math.round(i/1e3*1e3);a=" m"}else{o=Math.round(i/1e3*100)/100;a=" km"}o=o.toLocaleString(l);this.miProgressTextDiv.innerHTML="<div><span>"+c+" m</span><br><span>"+o+a+"</span></div>"+(r?"<br><span>"+r.toString+"</span>":"")}};e._getTime=function(e,t){var n=t-e,r={},i=Math.floor(n/1e3/60/60/24);n-=1e3*i*60*60*24;var s=Math.floor(n/1e3/60/60);n-=1e3*s*60*60;r.h=s+24*i;var o=Math.floor(n/1e3/60);n-=1e3*o*60;r.m=o;r.s=Math.floor(n/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};e.simulateTrack=function(e){var t=this;t.simulate_speed=1;t.drawTrack(e,!1).then(function(){t.wrap.simulateTrack()})};e.drawTrack=function(e,t){var n=this;c.call(n);return new Promise(function(t,r){n.setSelectedTrack(e);n.drawTrackingData(e).then(function(){n.elevationTrack(e);n.activate();t()})})};e.elevationTrack=function(t,n){var r=this;if(n){r.wrap.simulateTrackEnd();r.uiSimulate(!1,t)}else{if(!r.onResize){r.onResize=r.elevationTrack.bind(r,t,!0);window.addEventListener("resize",r.onResize,!1)}r.chart={coordinates:[]};r.track.elevationChart&&(r.track.elevationChart=r.track.elevationChart.destroy());(function(e){return new Promise(function(t,n){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){r.getTrackingData(e).then(function(e){var n=e.data;if(n){var i,s;i=[];s=[];var o,a,l,c=!0,u={},h={},p=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZ||l.getLayout()==ol.geom.GeometryLayout.XYZM){var e=0;if(r.map.crs!==r.map.options.utmCrs){line=new ol.geom.LineString(TC.Util.reproject(l.getCoordinates(),r.map.crs,r.map.options.utmCrs));e=line.getLength()}else e=l.getLength();return parseFloat((e/1e3).toFixed(2))}return null},d=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZM||l.getLayout()==ol.geom.GeometryLayout.XYM){var e=l.getLastCoordinate()[3]-l.getFirstCoordinate()[3];return{s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}return null},f=function(e){if(r.chart.coordinates.length>0){var t=0;r.chart.coordinates.forEach(function(n,i,s){var o=0===i?n:s[i-1];if(r.map.crs!==r.map.options.utmCrs){n=TC.Util.reproject(n,r.map.crs,r.map.options.utmCrs);o=TC.Util.reproject(o,r.map.crs,r.map.options.utmCrs)}const a=n[0]-o[0],l=n[1]-o[1];t+=Math.sqrt(a*a+l*l);e.push(parseFloat(t.toFixed(2)))})}},y=function(e){for(var n=0;n<r.chart.coordinates.length;n++){if(!(r.chart.coordinates[n].length>2)){t(null);return}var i=Math.round(10*r.chart.coordinates[n][2])/10;c&&i>0&&(c=!1);e.push(i);0==n&&(o=a=i);o=Math.min(o,i);a=Math.max(a,i)}};(new ol.format.GeoJSON).readFeatures(n).filter(function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()}).forEach(function(t){switch((l=t.getGeometry()).getType().toLowerCase()){case"linestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ){h=d();p();u=TC.tool.Elevation.getElevationGain({coords:l.getCoordinates(),hillDeltaThreshold:r.gapHill});r.chart.coordinates=r.chart.coordinates.concat(l.getCoordinates());f(i);y(s)}break;case"multilinestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ)for(var n,o=l.getLineStrings(),a=0;a<o.length;a++){p(o[a]);o[a].getLayout()==ol.geom.GeometryLayout.XYZM&&(n+=o[a].getLastCoordinate()[3]-o[a].getFirstCoordinate()[3]);r.chart.coordinates=r.chart.coordinates.concat(o[a].getCoordinates());n&&(h=d());f(i);y(s)}break;default:return null}});s instanceof Array&&0==s.length&&(c=!0);r.chartData=c?null:$.extend({},{time:h,ele:s,x:i,miny:o,maxy:a},u);t(r.chartData)}else t(null)})})})})(t).then(function(t){TC.Util.getMapLocale(r.map);if(null!=t){t.time&&(t.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));t.coords=r.chart.coordinates;r.hasElevation=!0}else{r.hasElevation=!1;t={msg:r.getLocaleString("geo.trk.chart.chpe.empty")}}t.minHeight=r.CHART_SIZE.MIN_HEIGHT;t.maxHeight=r.CHART_SIZE.MAX_HEIGHT;t.minWidth=r.CHART_SIZE.MIN_WIDTH;t.mediumWidth=r.CHART_SIZE.MEDIUM_WIDTH;t.maxWidth=r.CHART_SIZE.MAX_WIDTH;r.map.one(TC.Consts.event.DRAWCHART,function(e){r.chartProgressInit()});if(r.resultsPanelChart){r.resultsPanelChart.open();r.map.trigger(r.Const.Event.DRAWTRACK,{data:t})}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");var n,i={content:"chart",titles:{main:r.getLocaleString("geo.trk.chart.chpe"),max:r.getLocaleString("geo.trk.chart.chpe")},openOn:r.Const.Event.DRAWTRACK,closeOn:r.Const.Event.CLEARTRACK,chart:{ctx:r,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};const o=function(e){i.side=e.SIDE.RIGHT;n=e.addControl("resultsPanel",i)};if(r.options.displayOn){var s=r.map.getControlsByClass("TC.control."+r.options.displayOn[0].toUpperCase()+r.options.displayOn.substring(1))[0];s?o(s):r.map.addControl(r.options.displayOn).then(o)}else{i.div=document.createElement("div");r.map.div.appendChild(i.div);n=r.map.addControl("resultsPanel",i)}n.then(function(e){e.caller=r;r.resultsPanelChart=e;e.renderPromise().then(function(){e.activateSnapping=function(e){r.layerTrack&&!r.layerTrack.getVisibility()&&0==r.layerTrack.getOpacity()&&r.wrap.deactivateSnapping.call(r.wrap)};e.deactivateSnapping=function(e){r.layerTrack&&r.layerTrack.getVisibility()&&r.layerTrack.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)};e.div.addEventListener("mouseover",e.deactivateSnapping);e.div.addEventListener("mouseout",e.activateSnapping);r.map.on(TC.Consts.event.RESULTSPANELMIN,function(){r.miDiv&&(r.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELMAX,function(){r.miDiv&&(r.miDiv.style.display="")}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){r.miDiv&&(r.miDiv.style.display="none")});r.map.trigger(r.Const.Event.DRAWTRACK,{data:t})})})}})}};e.clear=function(e){var t=this;if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}if(e==t.Const.Layers.TRACK){t.layerTrack.clearFeatures();t.resultsPanelChart&&t.resultsPanelChart.close();delete t.chartData;t.wrap.simulateTrackEnd();t.wrap.clear();t.track.trackList.querySelectorAll("li").forEach(function(e){e.classList.remove(t.Const.Classes.SELECTEDTRACK)});t.map.trigger(t.Const.Event.CLEARTRACK);t.featuresToShare=[]}else{t.layerTracking.clearFeatures();t.layerGPS.clearFeatures()}};e.saveTrack=function(e){const t=this;return new Promise(function(n,r){var i=e.message||t.getLocaleString("geo.trk.save.alert"),s=function(s){var o;o=t.getLoadingIndicator().addWait();var a=e.importedFileName||t.track.trackName.value.trim(),l=t.availableTracks;l||(l=[]);var u=t.wrap.formattedToStorage(s,!0,e.notReproject),h=function(e){t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.getLoadingIndicator().removeWait(e);c.call(t)},p={name:a,data:u.features,layout:u.layout,crs:t.storageCRS};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var e=hex_md5(JSON.stringify(p)),s=l.map(function(t){var n=JSON.parse(JSON.stringify(t));delete n.uid;if(e===hex_md5(JSON.stringify(n)))return t.uid;{const s=new ol.format.GeoJSON;var r=s.readFeatures(n.data),i=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);r.forEach(function(e){var t=TC.Util.explodeGeometry(TC.Util.compactGeometry(e.getGeometry().getCoordinates(),i));e.getGeometry().setCoordinates(t)});n.data=s.writeFeatures(r);return e===hex_md5(JSON.stringify(n))?t.uid:null}}).filter(function(e){return null!==e});const a=function(e){return t.getStoredTracks().then(function(){t.bindTracks();for(var n,r=0;r<t.availableTracks.length;r++)if(t.availableTracks[r].uid===e){n=r;break}return n})};if(0===s.length){p.uid=Date.now()+Math.random();l.push(p);l=g(l);try{t.setStoredTracks(l).then(function(){t.map.toast(i,{duration:3e3});h(o);a(p.uid).then(function(e){n(e)})})}catch(e){TC.alert(t.getLocaleString("geo.error.savelocalstorage")+": "+e.message);h(o);r()}}else{console.log("Ya existe un track con ese mismo hash");h(o);a(s[0]).then(function(e){n(e)})}})};if(t.importedFileName)s(t.layerTrack);else if(0==t.track.trackName.value.trim().length){t.track.trackName.value=(new Date).toLocaleString();s(t.layerTracking)}else s(t.layerTracking)})};e.addWaypoint=function(){var e=this.track.trackWPT.value.trim();e||(e=(new Date).toLocaleString());var t=this.getLoadingIndicator().addWait();c.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:e,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(t)};e.editTrackName=function(e,t){var n=this;n.getAvailableTracks().then(function(r){if(r&&r[e]){r[e].name=t;n.setStoredTracks(r)}})};e.removeTrack=function(e){var t=this;t.getAvailableTracks().then(function(n){if(n){var r=e.dataset.id;if(n[r]){var i=n[r].uid;TC.confirm(t.getLocaleString("geo.trk.delete.alert"),function(){const e=t.getSelectedTrack();e&&e.dataset.id===r&&t.clear(t.Const.Layers.TRACK);localforage.removeItem(t.Const.LocalStorageKey.TRACKING+"#"+i).then(function(){t.getStoredTracks().then(function(){t.bindTracks()})}).catch(function(e){console.log(e)})},function(){})}}})};e.setSelectedTrack=function(e){var t=this;t.isActive||t.activate();t.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(e){e.setAttribute("title",e.textContent)});t.track.trackList.querySelectorAll("li").forEach(function(e){e.classList.remove(t.Const.Classes.SELECTEDTRACK)});e.classList.add(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",t.getLocaleString("tr.lst.clear")+" "+e.querySelector("span").textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"))};e.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};e.clearSelectedTrack=function(){const e=this,t=e.getSelectedTrack();if(t){if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}t.classList.remove(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",t.textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"))}};e.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};e.drawTrackingData=function(e){const t=this;return new Promise(function(n,r){t.wrap.clear();t.getTrackingData(e).then(function(e){e.data;e.data&&t.wrap.drawTrackingData(e).then(function(){var e=t.layerTrack.features;if(e&&e.length>0){var r=e.filter(function(e){e.showsPopup=!1;return!!(TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)||e instanceof TC.feature.Polyline}).map(function(e){return TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?e.geometry[0]:e instanceof TC.feature.Polyline?e.geometry:void 0})[0];if(r){var i=r[0],s=r[r.length-1];i&&i!==s&&t.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});s&&t.layerTrack.addMarker(s.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}t.layerTrack.setVisibility(!0);n()})})})};e.getTrackingData=function(e){const t=this;return new Promise(function(n,r){t.getAvailableTracks().then(function(r){if(r){const s=e.dataset.id;if(r[s]){var i=r[s].data;i=t.wrap.formattedFromStorage(i);n({data:i,layout:r[s].layout})}}else n()})})};e.export=function(e,t){return this.wrap.export(e,t)};e.getElevationTooltip=function(e){this.wrap.showElevationMarker(e);return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};e.clearFileInput=function(e){const t=document.createElement("form"),n=e.parentElement;n.insertBefore(t,e);t.appendChild(e);t.reset();t.insertAdjacentElement("afterend",e);n.removeChild(t)};e.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};e.onGeolocateError=function(e){var t;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(e){navigator.geolocation.clearWatch(e)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(e.code){case e.PERMISSION_DENIED:t=this.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:t=this.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:t=this.getLocaleString("geo.error.timeout");break;default:t=this.getLocaleString("geo.error.default")}this.map.toast(t,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var C=function(e){return!e||0===e.length};e.exportState=function(){const e=this;if(e.exportsState){const n={};if(e.layerTrack){var t=e.layerTrack.features;if(t.length>0&&e.featuresToShare&&e.featuresToShare.length>0)n.features=e.featuresToShare;else{const r=e.layerTrack.exportState({features:t});n.features=r.features}n.id=e.id;const r=e.getSelectedTrack();r&&(n.trackName=r.querySelector("span").innerHTML);return n}}return null};e.importState=function(e){const t=this;if(t.map&&e.features&&e.features.length){t.enable();if(e.features.length>0){const n=new Array(e.features.length);e.features.forEach(function(e,t){const r={data:e.data,id:e.id,showsPopup:e.showsPopup};var i=TC.Util.explodeGeometry(e.geom);switch(e.type){case TC.Consts.geom.POLYLINE:n[t]=new TC.feature.Polyline(i,r);break;case TC.Consts.geom.MULTIPOLYLINE:n[t]=new TC.feature.MultiPolyline(i,r);break;case TC.Consts.geom.MARKER:n[t]=new TC.feature.Marker(i,r);break;case TC.Consts.geom.POINT:n[t]=new TC.feature.Point(i,r)}});Promise.all(n).then(function(n){var r={features:n,fileName:e.trackName,notReproject:!0,isShared:!0};t.availableTracks?t.importTrack(r):t.getStoredTracks().then(function(){t.importTrack(r)})})}}}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");!function(){TC.control.GeometryFeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.GeometryFeatureInfo(this);this.lineColor=this.options.lineColor?this.options.lineColor:"#c00";this._isDrawing=!1;this._isSearching=!1;this._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.GeometryFeatureInfo.prototype;e.register=function(e){const t=this,n=TC.control.FeatureInfoCommons.prototype.register.call(t,e);t.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){t.wrap.cancelDraw()});return n};e.callback=function(e,t){var n=this;if(!n._drawToken){n.closeResults();for(var r=!1,i=0;i<n.map.workLayers.length;i++){var s=n.map.workLayers[i];if(s.type===TC.Consts.layerType.WMS&&s.getVisibility()&&s.names.length>0){r=!0;break}}if(r){n.closeResults();n.wrap.beginDraw({geometryType:n.geometryType,xy:e,layer:n.filterLayer,callback:function(e){n.wrap.getFeaturesByGeometry(e)}})}}};e.responseCallback=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(t,e);if(t.filterFeature){for(var n=e.services,r=0;r<n.length;r++){var i=n[r];if(i.hasLimits){delete i.layers;i.hasLimits=i.hasLimits}else{for(var s=0;s<i.layers.length;s++)if(!i.layers[s].features.length){i.layers.splice(s,1);s-=1}if(!i.layers.length){n.splice(r,1);r-=1}}}n.length?t.renderData(e,function(){t.insertLinks();t.displayResults()}):t.resultsLayer.clearFeatures()}}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";e.template[e.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";e.template[e.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/LayerCatalogDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"availableLayers"}).x(t.get(["enableSearch"],!1),t,{block:n},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",t,{},{$key:"textToSearchInLayers"}).w('"></input></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(t.get(["layerTrees"],!1),t,{else:i,block:s},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",t,t.rebase(t.getPath(!0,[])),{}).w("</div>")}t.__dustBody=!0;function n(e,t){return e.x(t.get(["layerTrees"],!1),t,{block:r},{})}n.__dustBody=!0;function r(e,t){return e.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",t,{},{$key:"searchLayersbytext"}).w('"></button>')}r.__dustBody=!0;function i(e,t){return e.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",t,{},{$key:"loadingLayerTree"}).w("...</span></div>")}i.__dustBody=!0;function s(e,t){return e.w('<ul class="tc-ctl-lcat-branch">').s(t.get(["layerTrees"],!1),t,{block:o},{}).w("</ul>")}s.__dustBody=!0;function o(e,t){return e.p("tc-ctl-lcat-branch",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><button class="tc-ctl-lcat-collapse-btn"></button><span>').f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:i},{}).w("</ul></li>")}t.__dustBody=!0;function n(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}n.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}r.__dustBody=!0;function i(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}i.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["isVisible"],!1),t,{block:n},{})}t.__dustBody=!0;function n(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('">').x(t.get(["children"],!1),t,{block:s},{}).w('<span data-tooltip="').x(t.get(["name"],!1),t,{block:o},{}).w('">').f(t.get(["title"],!1),t,"h").w("</span>").x(t.get(["name"],!1),t,{block:a},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:l},{}).w("</ul></li>")}n.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}r.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}i.__dustBody=!0;function s(e,t){return e.w('<button class="tc-ctl-lcat-collapse-btn"></button>')}s.__dustBody=!0;function o(e,t){return e.h("i18n",t,{},{$key:"clickToAddToMap"})}o.__dustBody=!0;function a(e,t){return e.w('<button title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('" class="tc-ctl-lcat-btn-info"></button>')}a.__dustBody=!0;function l(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}l.__dustBody=!0;return t};e.template[e.CLASS+"-info"]=function(){dust.register(e.CLASS+"-info",t);function t(e,t){return e.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",t,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(t.get(["title"],!1),t,"h").w("</h3>").x(t.get(["abstract"],!1),t,{block:n},{}).x(t.get(["metadata"],!1),t,{block:r},{})}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div><pre>").f(t.get(["abstract"],!1),t,"h",["s"]).w("</pre></div></div>")}n.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:i},{}).w("</ul></div>")}r.__dustBody=!0;function i(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h",["s"]).w("</a></li>")}i.__dustBody=!0;return t};e.template[e.CLASS+"-results"]=function(){dust.register(e.CLASS+"-results",t);function t(e,t){return e.s(t.get(["servicesFound"],!1),t,{else:n,block:r},{})}t.__dustBody=!0;function n(e,t){return e.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",t,{},{$key:"noMatches"}).w("</h5></li>")}n.__dustBody=!0;function r(e,t){return e.h("gt",t,{block:i},{key:t.get(["servicesLooked"],!1),value:1}).s(t.get(["founds"],!1),t,{block:o},{}).h("gt",t,{block:c},{key:t.get(["servicesLooked"],!1),value:1})}r.__dustBody=!0;function i(e,t){return e.w('<li class="tc-ctl-lcat-search-group ').x(t.getPath(!1,["service","isCollapsed"]),t,{block:s},{}).w('" data-tc-service-index="').f(t.getPath(!1,["service","index"]),t,"h").w('"><h5>').f(t.getPath(!1,["service","title"]),t,"h").w("</h5><ul>")}i.__dustBody=!0;function s(e,t){return e.w("tc-collapsed")}s.__dustBody=!0;function o(e,t){return e.w('<li data-tc-layer-name="').f(t.get(["Name"],!1),t,"h").w('" ').x(t.get(["alreadyAdded"],!1),t,{else:a,block:l},{}).w('><h5 class="tc-selectable">').f(t.get(["Title"],!1),t,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></button></li>')}o.__dustBody=!0;function a(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"clickToAddToMap"}).w('" ')}a.__dustBody=!0;function l(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}l.__dustBody=!0;function c(e,t){return e.w("</ul></li>")}c.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}var t="tcLayer",n="tcLayerName",r="tcLayerInfo",i="tcServiceIndex";const s=function(e,t){e.showProjectionChangeDialog({layer:t,closeCallback:function(){e.getLayerNodes(t).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.querySelector("span").setAttribute(o,e.getLocaleString("clickToAddToMap"))})}})};var o="data-tooltip";e.register=function(e){const n=this,r=TC.control.ProjectionSelector.prototype.register.call(n,e),i=function(e,t){if($.isArray(n.options.layers)){for(var r=0;r<n.options.layers.length;r++){var i=n.options.layers[r];if(!i.type||i.type===TC.Consts.layerType.WMS){i.id||(i.id=TC.getUID());$.isPlainObject(i)&&(i=new TC.layer.Raster(i));n.layers.push(i)}}n.render(function(){e()})}else e()};n._readyPromise=new Promise(function(t,n){const r=function(n){if(n.layer===e.baseLayer){i(t);e.off(TC.Consts.event.LAYERUPDATE,r)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,r):i(t)})});var s=function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);n.textInput&&n.textInput.dispatchEvent(e)}else n.textInput&&n.textInput.fireEvent("keyup")};var a=n.getLocaleString("layerAlreadyAdded"),l=n.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){n.getLayerNodes(e.layer).forEach(function(e){e.classList.add(TC.Consts.classes.LOADING);e.querySelector("span").removeAttribute(o)})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){const t=e.layer;t.isBase||t.type!==TC.Consts.layerType.WMS||n.loaded().then(function(){const e=function(){n.getLayerNodes(t).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(o,a)});s()};if(n.getLayerRootNode(t))e();else{for(var r=!1,i=0,l=n.layers.length;i<l;i++){var c=n.layers[i];if(c.type===t.type&&c.options.url===t.options.url){r=!0;break}}r||n.addLayer(new TC.layer.Raster({url:t.options.url,type:t.type,layerNames:[],title:t.title||t.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){e()})}})}).on(TC.Consts.event.LAYERERROR,function(e){const t=e.reason;t&&TC.alert(n.getLocaleString(t,{url:e.layer.url}));n.getLayerNodes(e.layer).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING)})}).on(TC.Consts.event.LAYERREMOVE,function(e){const r=e.layer;n.getLayerNodes(r).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(o,l)});(function(e){const r=[];if(!e.isBase){var i=e.options.url;n.list&&n.list.querySelectorAll("li").forEach(function(n){var s=$(n).data(t);if(s&&s.type===e.type&&s.options.url===i)for(var o=0;o<e.names.length;o++)n.dataset.tcLayerName===e.names[o]&&r.push(n)})}return r})(r).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.setAttribute(o,l)});!function(e){var t=n.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(t)for(var r=t.layers,i=0;i<r.length;i++){var s=r[i];s!==e&&n.getLayerNodes(s).forEach(function(e){e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(o,a)})}}(r);s()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){n.addLayer(e.layer);n.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(e){n.update()});return r};const a=function(e){e.target.blur();e.stopPropagation();const t=e.target.parentElement;if("LI"===t.tagName&&!t.classList.contains(self.CLASS+"-leaf")){t.classList.contains(TC.Consts.classes.COLLAPSED)?t.classList.remove(TC.Consts.classes.COLLAPSED):t.classList.add(TC.Consts.classes.COLLAPSED);const e=t.querySelector("ul");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED)}};e.render=function(e){const l=this;return l._set1stRenderPromise(new Promise(function(c,u){const h=$.map(l.layers,function(e){return e.wrap.getLayer()});Promise.all(h).then(function(){var h=$.map(l.layers,function(e){var t=e.getTree();!function t(n){for(var r=!1,i=0;i<n.children.length;i++)t(n.children[i])&&(r=!0);n.hasOwnProperty("isVisible")&&(n.isVisible=!e.names||!e.names.length||r||n.isVisible);return n.isVisible}(t);return t});l.renderData({layerTrees:h,enableSearch:l.options.enableSearch},function(){const c=l.getLocaleString("layerAlreadyAdded");l.div.querySelectorAll("li > button."+l.CLASS+"-collapse-btn").forEach(function(e){e.addEventListener("click",a)});l.div.querySelectorAll("span").forEach(function(e){e.addEventListener("click",function(e){!function(e,r){const i=e.target.parentNode;if(!i.classList.contains(TC.Consts.classes.LOADING)&&!i.classList.contains(TC.Consts.classes.CHECKED)){e.preventDefault;var s,a=$(i).data(n);a=void 0!==a?a.toString():"";for(var l=0,c=r._roots.length;l<c;l++){const e=r._roots[l];if(e.contains(i)){s=$(e).data(t);break}}s||(s=$(i).data(t));if(s&&a){var u=1;/iPad/i.test(navigator.userAgent)?u=10:TC.Util.detectFirefox()&&(u=250);s.title||(s.title=s.getTree().title);i.classList.add(TC.Consts.classes.LOADING);i.querySelector("span").setAttribute(o,"");(h=i,new Promise(function(e,t){setTimeout(function(){h.offsetHeight=h.offsetHeight;h.offsetWidth=h.offsetWidth;e()},u)})).then(function(){r.addLayerToMap(s,a)});e.stopPropagation()}}var h}(e,l)})});l._roots=l.div.querySelectorAll(l._selectors.LAYER_ROOT);l._roots.forEach(function(e,i){var s=l.layers[i];$(e).data(t,s);var a={};e.querySelectorAll("."+l.CLASS+"-btn-info").forEach(function(e){const t=e.parentElement.querySelector("span"),i=$(e.parentElement).data(n).toString();if(i){t.classList.add(TC.Consts.classes.SELECTABLE);var u=s.wrap.getInfo(i);if(u.hasOwnProperty("abstract")||u.hasOwnProperty("legend")||u.hasOwnProperty("metadata")){if(u.metadata)for(var h=0,p=u.metadata.length;h<p;h++){var d=u.metadata[h];d.formatDescription=a[d.format]=a[d.format]||l.getLocaleString(TC.Util.getSimpleMimeType(d.format))||l.getLocaleString("viewMetadata")}$(e).data(r,u);e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation();const t=this;if(t.classList.contains(TC.Consts.classes.CHECKED)){t.classList.remove(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{l.showLayerInfo(s,i);t.classList.add(TC.Consts.classes.CHECKED)}})}else e.parentElement.removeChild(e);if(s.compatibleLayers&&s.compatibleLayers.indexOf(i)<0){t.classList.add(TC.Consts.classes.INCOMPATIBLE);t.setAttribute("title",l.getLocaleString("reprojectionNeeded"))}if(l.map)for(h=0,p=l.map.workLayers.length;h<p;h++){var f=l.map.workLayers[h];if(f.type===TC.Consts.layerType.WMS&&f.url===s.url&&1===f.names.length&&f.names[0]===i){t.parentElement.classList.add(TC.Consts.classes.CHECKED);t.setAttribute(o,c)}}}else{t.setAttribute(o,"");e.parentElement.removeChild(e)}})});l.getRenderedHtml(l.CLASS+"-dialog",null,function(e){l._dialogDiv.innerHTML=e});l.textInput=l.div.querySelector("."+l.CLASS+"-input");l.list=l.div.querySelector("."+l.CLASS+"-search ul");l.textInput.addEventListener("mouseup",function(e){""!==l.textInput.value&&setTimeout(function(){""===l.textInput.value&&(l.list.innerHTML="")},1)});var u=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(l.textInput,{link:"#",target:l.list,minLength:0,source:function(e,t){u=[];l._roots.forEach(function(e){e.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(e){u.push($(e).data(n).toString())})});if((e=e.trim()).length<3)l.list.innerHTML="";else if(e.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var n=[],r=0;r<l.layers.length;r++){var i=l.layers[r].searchSubLayers(e);i.length&&n.push({service:{index:r,title:l.layers[r].title||l.layers[r].id},founds:i})}t({servicesFound:n,servicesLooked:l.layers.length})},TC._search.interval)}},callback:function(e){l.textInput.value=e.target.text||e.target.innerText;TC._search.lastPattern=l.textInput.value;l.goToResult(unescape(e.target.hash).substring(1));TC.UI.autocomplete.call(l.textInput,"clear")},buildHTML:function(e){if(e.results&&e.results.servicesFound.length>0)for(var t=l.map.getLayerTree().workLayers,n=0;n<e.results.servicesFound.length;n++){for(var r=e.results.servicesFound[n].founds,i=0;i<r.length;i++){delete r[i].alreadyAdded;for(var s=0;s<t.length;s++)if(u.indexOf(r[i].Name)>=0){r[i].alreadyAdded=!0;break}if(!r[i].Name){r.splice(i,1);i--}}e.results.servicesFound[n].founds.length?l.div.querySelectorAll(".tc-ctl-lcat-search-group")[n]&&(e.results.servicesFound[n].service.isCollapsed=l.div.querySelectorAll(".tc-ctl-lcat-search-group")[n].classList.contains(TC.Consts.classes.COLLAPSED)):e.results.servicesFound.splice(n,1)}var o="";dust.render(l.CLASS+"-results",e.results,function(e,t){o=t});return o}})});if(!l.searchInit){l.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2 button",function(e){const t=l.div.classList.contains(TC.Consts.classes.COLLAPSED);l.div.classList.remove(TC.Consts.classes.COLLAPSED);const n=l.div.querySelector("."+l.CLASS+"-search"),r=l.div.querySelector("."+l.CLASS+"-tree"),i=l.div.querySelector("."+l.CLASS+"-info");if(n.classList.contains(TC.Consts.classes.HIDDEN)||t){n.classList.remove(TC.Consts.classes.HIDDEN);r.classList.add(TC.Consts.classes.HIDDEN);l.textInput.focus();e.target.classList.add(l.CLASS+"-btn-tree");e.target.setAttribute("title",l.getLocaleString("viewAvailableLayersTree"));e.target.classList.remove(l.CLASS+"-btn-search");0===l.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&i.classList.add(TC.Consts.classes.HIDDEN)}else{n.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);e.target.classList.add(l.CLASS+"-btn-search");e.target.setAttribute("title",l.getLocaleString("searchLayersByText"));e.target.classList.remove(l.CLASS+"-btn-tree");l.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&i.classList.remove(TC.Consts.classes.HIDDEN)}}));l.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+l.CLASS+"-search button."+l.CLASS+"-search-btn-info",function(e){e.stopPropagation();const t=e.target;if(t.classList.contains(TC.Consts.classes.CHECKED)){t.classList.remove(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{const e=t.parentElement;var r=e;do{r=r.parentElement}while(r&&"LI"!==r.tagName);l.showLayerInfo(l.layers.length>1?l.layers[$(r).data(i)]:l.layers[0],$(e).data(n));t.classList.add(TC.Consts.classes.CHECKED)}}));const e="."+l.CLASS+" li";l.div.addEventListener("click",TC.EventTarget.listenerBySelector(e,function(r){r.stopPropagation();for(var a=r.target;a&&!a.matches(e);)a=a.parentElement;if(!a.classList.contains(l.CLASS+"-no-results"))if(a.classList.contains(l.CLASS+"-search-group"))a.classList.contains(TC.Consts.classes.COLLAPSED)?a.classList.remove(TC.Consts.classes.COLLAPSED):a.classList.add(TC.Consts.classes.COLLAPSED);else{var u=$(a).data(n);if(u){u=u.toString();if(!a.classList.contains(TC.Consts.classes.CHECKED)){var h=a;do{h=h.parentElement}while(h&&!h.matches("li."+l.CLASS+"-search-group"));const e=h?$(h).data(i):0,n=l.layers[e].options.url,r=l.layers[e].title,p=new TC.layer.Raster({id:l.getUID(),url:n,title:r,hideTitle:l.layers[e].hideTitle||l.layers[e].options.hideTitle,hideTree:!1,layerNames:[u]});if(p.isCompatible(l.map.crs)){l.map.addLayer(p,function(e){$(a).data(t,e);e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});a.classList.add(TC.Consts.classes.CHECKED);a.setAttribute(o,c)}else s(l,p)}}}}));l.searchInit=!0}$.isFunction(e)&&e()}).then(function(){c()}).catch(function(e){u(e)})})}))};e.getLayerRootNode=function(e){const n=this;var r=null;if(!e.isBase){var i=e.options.url;n._roots&&n._roots.forEach(function(n){var s=$(n).data(t);s&&s.type===e.type&&s.options.url===i&&(r=n)})}return r};e.getLayerNodes=function(e){const t=[],n=this.getLayerRootNode(e);if(n)for(var r=0;r<e.names.length;r++){const i=n.querySelector('li[data-tc-layer-name="'+e.names[r]+'"]');if(i){t[t.length]=i;i.querySelectorAll("li").forEach(function(e){t[t.length]=e})}}return t};e.showLayerInfo=function(e,i){const s=this;var o=null,a=s.div.querySelector("."+s.CLASS+"-info");const l=function(e,t){var r=!1;$(a).data(n);if(t){r=!0;$(a).data(n,e);a.classList.remove(TC.Consts.classes.HIDDEN);dust.render(s.CLASS+"-info",t,function(e,t){a.innerHTML=t;e&&TC.error(e);a.querySelector("."+s.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){s.hideLayerInfo()})})}return r};s.div.querySelectorAll("."+s.CLASS+"-btn-info, ."+s.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});for(var c=0,u=s._roots.length;c<u;c++){const a=s._roots[c];if($(a).data(t)===e){const e=a.querySelectorAll("."+s.CLASS+"-btn-info");for(var h=0,p=e.length;h<p;h++){const t=e[h];var d=$(t.parentElement).data(n).toString();if(d===i){const e=$(t).data(r),n=(l(d,e),s.div.querySelector('li [data-tc-layer-name="'+d+'"] > button.'+s.CLASS+"-btn-info"));l(d,e)?n.classList.add(TC.Consts.classes.CHECKED):n.classList.remove(TC.Consts.classes.CHECKED);o=e;break}}break}}return o};e.update=function(){const e=this;e.layers.forEach(function(t){t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);const r=e.getLayerRootNode(t);r&&r.querySelectorAll("li[data-tc-layer-name]").forEach(function(r){const i=$(r).data(n),s=r.querySelector("span."+TC.Consts.classes.SELECTABLE);if(t.compatibleLayers.indexOf(i)<0){s.classList.add(TC.Consts.classes.INCOMPATIBLE);s.setAttribute("title",e.getLocaleString("reprojectionNeeded"))}else{s.classList.remove(TC.Consts.classes.INCOMPATIBLE);s.removeAttribute("title")}})})})};e.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){const t=this;return new Promise(function(n,r){var i=[];t.options.layers&&t.options.layers.length&&(i=$.grep(t.options.layers,function(t){var n=TC.Util.reqGetMapOnCapabilities(t.url);return n&&n.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==i.length&&(i=$.grep(t.layers,function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==i.length){t.layers.push(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);e.title=e.title||e.wrap.getServiceTitle();t.render(function(){n()})})}else n()})};e.addLayerToMap=function(e,t){const n=this,r=$.extend({},e.options);r.id=n.getUID();r.layerNames=[t];r.title=e.title;const i=new TC.layer.Raster(r);i.isCompatible(n.map.crs)?n.map.addLayer(r).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})}):s(n,i)};e.loaded=function(){return this._readyPromise};e.getAvailableCRS=function(e){e=e||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,e.layer),includeFallbacks:!0})};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e).then(function(){t._layerToAdd&&t.map.addLayer(t._layerToAdd);TC.Util.closeModal()})}})};e.showProjectionChangeDialog=function(e){this._layerToAdd=e.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,e)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{else:n,block:r},{}).w("</ul></div>")}t.__dustBody=!0;function n(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}n.__dustBody=!0;function r(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["customLegend"],!1),t,{else:n,block:p},{})}t.__dustBody=!0;function n(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:s},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:h},{}).w("</ul></li>")}n.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}r.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function s(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{else:o,block:c},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}s.__dustBody=!0;function o(e,t){return e.x(t.getPath(!1,["legend","width"]),t,{block:a},{})}o.__dustBody=!0;function a(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:l},{}).w('"></div>')}a.__dustBody=!0;function l(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}l.__dustBody=!0;function c(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:u},{}).w(" />")}c.__dustBody=!0;function u(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;" ')}u.__dustBody=!0;function h(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}h.__dustBody=!0;function p(e,t){return e.f(t.get(["customLegend"],!1),t,"h",["s"])}p.__dustBody=!0;return t}}var t="tcLayer",n="tcLayerUid";e.register=function(e){const t=this;e.on(TC.Consts.event.VIEWCHANGE,function(n){const r=n.view,i=t.loadGraphics.bind(t);r===TC.Consts.view.THREED?e.on(TC.Consts.event.LAYERADD,i):r===TC.Consts.view.DEFAULT&&e.off(TC.Consts.event.LAYERADD,i)});return TC.control.MapContents.prototype.register.call(t,e)};e.loadGraphics=function(){var e=this;e.getLayerUIElements().forEach(function(n){var r=$(n).data(t);r&&n.querySelectorAll("li."+e.CLASS+"-node-visible").forEach(function(t){const n=t.querySelector("img");n&&void 0!==n.getAttribute("src")&&0===n.getAttribute("src").length&&e.styleLegendImage(n,r)})})};e.updateScale=function(){var e=this,r=e.CLASS+"-node-inscale",i=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach(function(s){var o=$(s).data(t);if(o){var a=!1;s.querySelectorAll("li").forEach(function(t){if(t.classList.contains(e.CLASS+"-node-visible")){var s=$(t).data(n);if(o.isVisibleByScale(s)){a=!0;t.classList.remove(i);t.classList.add(r);const n=t.querySelector("img");n&&e.styleLegendImage(n,o)}else{t.classList.add(i);t.classList.remove(r)}}});if(a){s.classList.remove(i);s.classList.add(r)}else{s.classList.remove(r);s.classList.add(i)}}})};e.update=function(){var e=this;e.getLayerUIElements().forEach(function(r){var i=$(r).data(t);if(i){i.getTree();r.querySelectorAll("li").forEach(function(t){var r=$(t).data(n),s=e.CLASS+"-node-visible",o=e.CLASS+"-node-notvisible",a=e.CLASS+"-node-hasvisible";switch(i._cache.visibilityStates[r]){case TC.Consts.visibility.NOT_VISIBLE:t.classList.remove(s);t.classList.remove(a);t.classList.add(o);break;case TC.Consts.visibility.HAS_VISIBLE:t.classList.remove(s);t.classList.remove(o);t.classList.add(a);break;default:t.classList.remove(o);t.classList.remove(a);t.classList.add(s)}});e.updateLayerVisibility(i)}});e.updateScale()};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){if(e.hideTree||e.options.hideTree){e.tree=null;e.hideTree=e.options.hideTree=!1;e._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(r,e);r.div.querySelector("."+r.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r.CLASS+"-node",r.layerTrees[e.id],function(i,s){const o=(new DOMParser).parseFromString(s,"text/html").body.firstChild,a=$(o).data(n),l=r.div.querySelector("ul."+r.CLASS+"-branch"),c=l.querySelectorAll('li[data-tc-layer-uid="'+a+'"]');if(1===c.length){const e=c[0];e.innerHTML=o.innerHTML;e.setAttribute("class",o.getAttribute("class"))}else{$(o).data(t,e);l.insertBefore(o,l.firstChild)}i&&TC.error(i)});r.update()})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var n=this;n.getLayerUIElements().forEach(function(r){$(r).data(t)===e&&(e.getVisibility()?r.classList.remove(n.CLASS+"-node-notvisible"):r.classList.add(n.CLASS+"-node-notvisible"))})};e.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYLINE};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.LineFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.control.WorkLayerManager||TC.syncLoadJS(TC.apiLocation+"TC/control/WorkLayerManager");TC.control.ListTOC=TC.control.WorkLayerManager;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){const e=this;TC.Control.apply(e,arguments);e._waits={};window.addEventListener("error",function(){e.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var e=TC.control.LoadingIndicator.prototype;e.CLASS="tc-ctl-load";TC.isDebug?e.template=TC.apiLocation+"TC/templates/LoadingIndicator.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}t.__dustBody=!0;return t};e.startWait=function(e){const t=this,n=e.layer.id;void 0===t._waits[n]&&(t._waits[n]=0);t._waits[n]=t._waits[n]+1;t.show();t.map.trigger(TC.Consts.event.STARTLOADING)};e.stopWait=function(e){const t=this,n=e.layer.id;var r=t._waits[n];r>0&&(r=t._waits[n]=r-1);r||delete t._waits[n];var i=0;for(var s in t._waits)i++;if(!i){t.hide();t.map.trigger(TC.Consts.event.STOPLOADING)}};e.reset=function(e){this._waits={};this.hide();this.map.trigger(TC.Consts.event.STOPLOADING)};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(e){t.startWait(e)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(e){t.stopWait(e)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(){t.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(){t.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(e,n,r,i,s){t.reset();return!1});$(document).ajaxError(function(e,n,r){t.reset()})}return n};e.addWait=function(e){const t=e||TC.getUID();this.startWait({layer:{id:t}});return t};e.removeWait=function(e){this.stopWait({layer:{id:e}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featuresselect.tc";TC.Consts.event.FEATURESUNSELECT="featuresunselect.tc";TC.Consts.event.CHANGE="change";!function(){TC.control.Modify=function(){TC.Control.apply(this,arguments);if(!Modernizr.inputtypes.color&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}this.styles=$.extend(!0,TC.Cfg.styles.selection,this.options.styles);this.styles.text=this.styles.text||{fontSize:this.styles.line.fontSize,fontColor:this.styles.line.fontColor,labelOutlineColor:this.styles.line.labelOutlineColor,labelOutlineWidth:this.styles.line.labelOutlineWidth};this._classSelector="."+this.CLASS;this.wrap=new TC.wrap.control.Modify(this)};TC.inherit(TC.control.Modify,TC.Control);var e=TC.control.Modify.prototype;e.CLASS="tc-ctl-mod";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Modify.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="').h("i18n",t,{},{$key:"select"}).w('">').h("i18n",t,{},{$key:"select"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="').h("i18n",t,{},{$key:"deleteSelection"}).w('">').h("i18n",t,{},{$key:"deleteSelection"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="').h("i18n",t,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",t,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="').h("i18n",t,{},{$key:"splitGeometry"}).w('">').h("i18n",t,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="').h("i18n",t,{},{$key:"addText"}).w('">').h("i18n",t,{},{$key:"addText"}).w('</button><div class="tc-ctl-mod-style tc-hidden"><input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeTextForSketch"}).w('" style="font-size:').f(t.get(["fontSize"],!1),t,"h").w("pt;font-color:").f(t.get(["fontColor"],!1),t,"h").w(";text-shadow: 0 0 ").f(t.get(["labelOutlineWidth"],!1),t,"h").w("px ").f(t.get(["labelOutlineColor"],!1),t,"h").w(';" />').h("i18n",t,{},{$key:"textColor"}).w('<input type="color" class="tc-ctl-mod-fnt-c" value="').f(t.get(["fontColor"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"fontSize"}).w('<input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="').f(t.get(["fontSize"],!1),t,"h").w('" min="7" max="20" /></div>')}t.__dustBody=!0;return t};const t=function(e,t){e._deleteBtn.disabled=0===t.length;e._joinBtn.disabled=t.length<2;e._splitBtn.disabled=0===t.filter(n).length;e.displayLabelText()},n=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t};e.register=function(e){const n=this,r=TC.Control.prototype.register.call(n,e);if(n.options.layer){n.setLayer(n.options.layer);e.on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){Promise.all([n.getLayer(),n.renderPromise()]).then(function(t){const r=t[0];if(e.layer===r){n._selectBtn.disabled=!1;n._textBtn.disabled=!1}})}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const r=e.layer,i=e.feature;Promise.all([n.getLayer(),n.renderPromise()]).then(function(e){if(r===e[0]){i?n.unselectFeatures([i]):n.unselectFeatures();t(n,n.getSelectedFeatures());if(0===n.layer.features.length){n._selectBtn.disabled=!0;n.setTextMode(!1);n._textBtn.disabled=!0}}})});const r=function(){const e=n.getSelectedFeatures();t(n,e);n.layer.features.filter(function(t){return e.indexOf(t)<0}).forEach(function(e){e.toggleSelectedStyle(!1)});e.forEach(function(e){e.toggleSelectedStyle(!0)})};n.on(TC.Consts.event.FEATURESSELECT,r).on(TC.Consts.event.FEATURESUNSELECT,r)}return r};e.render=function(e){const t=this,n=function(){t._selectBtn=t.div.querySelector("."+t.CLASS+"-btn-select");t._selectBtn.addEventListener(TC.Consts.event.CLICK,function(e){e.target.disabled||(t.isActive?t.deactivate():t.activate())});t._deleteBtn=t.div.querySelector("."+t.CLASS+"-btn-delete");t._deleteBtn.addEventListener(TC.Consts.event.CLICK,function(){t.deleteSelectedFeatures()});t._textBtn=t.div.querySelector("."+t.CLASS+"-btn-text");t._textBtn.addEventListener(TC.Consts.event.CLICK,function(){t.setTextMode(!t.textActive)});t._joinBtn=t.div.querySelector("."+t.CLASS+"-btn-join");t._splitBtn=t.div.querySelector("."+t.CLASS+"-btn-split");t._textInput=t.div.querySelector("input."+t.CLASS+"-txt");t._textInput.addEventListener("input",function(e){t.labelFeatures(e.target.value)});t._styleSection=t.div.querySelector("."+t.CLASS+"-style");t._fontColorPicker=t.div.querySelector(t._classSelector+"-fnt-c");t._fontColorPicker.addEventListener(TC.Consts.event.CHANGE,function(e){t.setFontColor(e.target.value)});t._fontSizeSelector=t.div.querySelector("."+t.CLASS+"-fnt-s");t._fontSizeSelector.addEventListener(TC.Consts.event.CHANGE,function(e){t.setFontSize(e.target.value)});$.isFunction(e)&&e()},r={fontSize:t.styles.text.fontSize,fontColor:t.styles.text.fontColor,labelOutlineColor:t.styles.text.labelOutlineColor,labelOutlineWidth:t.styles.text.labelOutlineWidth};return Modernizr.inputtypes.color?t._set1stRenderPromise(t.renderData(r,n)):t._set1stRenderPromise(t.renderData(r,function(){const e=t.div.querySelector("input[type=color]");e.style.backgroundColor=e.value;e.style.color="transparent";const r=new CP(e,"click",document.body);e.onclick=function(e){e.preventDefault()};e.onfocus=function(e){this.blur()};e.onchange=function(e){this.style.backgroundColor=this.value};t.map.loaded(function(){r.on("change",function(e){t.setFontColor("#"+e)})});n()}))};e.activate=function(){this._selectBtn.classList.add(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode)};e.deactivate=function(){const e=this;TC.Control.prototype.deactivate.call(e);e._selectBtn&&t(e,[]);e.wrap&&e.wrap.deactivate();if(e._selectBtn){e._selectBtn.classList.remove(TC.Consts.classes.ACTIVE);e.layer.features.forEach(function(e){e.toggleSelectedStyle(!1)})}};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();return this};e.setMode=function(e,t){const n=this;e&&(n.mode=e);if(t&&e){n.layer&&n.layer.map.putLayerOnTop(n.layer);n.activate()}else n.deactivate();return n};e.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?Promise.resolve(null):this.layer?Promise.resolve(this.layer):this._layerPromise};e.setLayer=function(e){var t=this;t.map&&(t._layerPromise=new Promise(function(n,r){if("string"==typeof e)t.map.loaded(function(){t.layer=t.map.getLayer(e);n(t.layer)});else{t.layer=e;n(t.layer)}}))};e.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};e.setSelectedFeatures=function(e){const t=this.wrap.setSelectedFeatures(e);this.displayLabelText();return t};e.getActiveFeatures=function(){const e=this,t=e.getSelectedFeatures();!t.length&&e.layer.features.length&&t.push(e.layer.features[e.layer.features.length-1]);return t};e.unselectFeatures=function(e){e=e||[];this.wrap.unselectFeatures(e.map(function(e){return e.wrap.feature}));return this};e.deleteSelectedFeatures=function(){const e=this,t=e.getSelectedFeatures();e.wrap.unselectFeatures(t);t.forEach(function(t){e.layer.removeFeature(t)});return e};e.styleFunction=function(e,t){var n;const r=this.map.options.styles.selection;switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:n=$.extend({},r.polygon);break;case TC.feature.Point&&e instanceof TC.feature.Point:case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:n=$.extend({},r.point);break;default:n=$.extend({},r.line)}const i=e.getStyle();if(i.label){n.label=i.label;n.fontSize=i.fontSize;n.fontColor=i.fontColor;n.labelOutlineColor=i.labelOutlineColor;n.labelOutlineWidth=i.labelOutlineWidth}return n};e.setTextMode=function(e){const t=this;t.textActive=e;if(e){t._textBtn.classList.add(TC.Consts.classes.ACTIVE);t._textBtn.classList.add(e)}else{t._textBtn.classList.remove(TC.Consts.classes.ACTIVE);t._textBtn.classList.remove(e)}e?t._styleSection.classList.remove(TC.Consts.classes.HIDDEN):t._styleSection.classList.add(TC.Consts.classes.HIDDEN);t.displayLabelText();return t};e.setFontColorWatch=function(e,t){const n=this;void 0===e&&(e=n.styles.text.fontColor);e=TC.Util.colorArrayToString(e);t=t||n.getLabelOutlineColor(e);n.renderPromise().then(function(){n._fontColorPicker.value=e;n._textInput.style.color=e;n._textInput.style.textShadow="0 0 "+n.styles.text.labelOutlineWidth+"px "+t;if(!Modernizr.inputtypes.color){n._fontColorPicker.style.backgroundColor=e;n._fontColorPicker.blur()}});return n};e.setFontColor=function(e){const t=this;t.styles.text.fontColor=e;t.styles.text.labelOutlineColor=t.getLabelOutlineColor(e);t.setFontColorWatch(e,t.styles.text.labelOutlineColor);t.getActiveFeatures().forEach(function(n){const r=n.getStyle();r.fontColor=e;r.labelOutlineColor=t.styles.text.labelOutlineColor;n.setStyle(r)});return t};e.setFontSizeWatch=function(e){const t=this;void 0===e&&(e=t.styles.text.fontSize);const n=parseInt(e);n!==Number.NaN&&t.renderPromise().then(function(){t._fontSizeSelector.value=n;t._textInput.style.fontSize=n+"pt"});return t};e.setFontSize=function(e){const t=this,n=parseInt(e);if(n!==Number.NaN){t.styles.text.fontSize=n;t.setFontSizeWatch(n);t.getActiveFeatures().forEach(function(e){const t=e.getStyle();t.fontSize=n;e.setStyle(t)})}return t};e.getLabelOutlineColor=function(e){if(e){const t=(e=TC.Util.colorArrayToString(e)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const n=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(n&&n.length){return(parseInt(n[1],16)+parseInt(n[2],16)+parseInt(n[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"};e.displayLabelText=function(){const e=this,t=e.getSelectedFeatures();var n,r,i;if(e.isActive&&t.length){const e=t[t.length-1].getStyle();n=e.label;i=e.fontColor;r=e.fontSize}else{n="";i=e.styles.text.fontColor;r=e.styles.text.fontSize}e.renderPromise().then(function(){e.setFontSizeWatch(r).setFontColorWatch(i)._textInput.value=n});return e};e.labelFeatures=function(e){const t=this,n=t.getActiveFeatures();if(n.length){const r=n[0].getStyle();n.forEach(function(n){const i=$.extend({},t.styles.text,r);r.label=e;r.labelOffset=i.labelOffset;r.fontColor=i.fontColor;r.fontSize=i.fontSize;r.labelOutlineColor=i.labelOutlineColor;r.labelOutlineWidth=i.labelOutlineWidth;n.setStyle(r)})}return t}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){this.lineColor=null;TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.fInfoCtrl=null;this.lineFInfoCtrl=null;this.polygonFInfoCtrl=null;this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";TC.isDebug?e.template=TC.apiLocation+"TC/templates/MultiFeatureInfo.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",t,{},{$key:"selection"}).w("</span>").x(t.get(["pointSelectValue"],!1),t,{block:n},{}).x(t.get(["lineSelectValue"],!1),t,{block:r},{}).x(t.get(["polygonSelectValue"],!1),t,{block:i},{}).w("</form></div>")}t.__dustBody=!0;function n(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",t,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["pointSelectValue"],!1),t,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPoint"}).w("</span></label>")}n.__dustBody=!0;function r(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",t,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["lineSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byLine"}).w("</span></label>")}r.__dustBody=!0;function i(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",t,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["polygonSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPrecinct"}).w("</span></label>")}i.__dustBody=!0;return t};const t=function(e,t){if(!0===e){e={};return $.extend(e,t)}return e};e.register=function(e){const n=this;return new Promise(function(r,i){const s=[TC.Control.prototype.register.call(n,e)];n.modes[TC.Consts.geom.POINT]&&s.push(e.addControl("featureInfo",t(n.modes[TC.Consts.geom.POINT],{displayMode:n.options.displayMode})).then(function(e){n.fInfoCtrl=e;return e}));n.modes[TC.Consts.geom.POLYLINE]&&s.push(e.addControl("lineFeatureInfo",t(n.modes[TC.Consts.geom.POLYLINE],{displayMode:n.options.displayMode,lineColor:n.lineColor})).then(function(e){n.lineFInfoCtrl=e;return e}));n.modes[TC.Consts.geom.POLYGON]&&s.push(e.addControl("polygonFeatureInfo",t(n.modes[TC.Consts.geom.POLYGON],{displayMode:n.options.displayMode,lineColor:n.lineColor})).then(function(e){n.polygonFInfoCtrl=e;return e}));Promise.all(s).then(function(){if(n.fInfoCtrl){n.fInfoCtrl.activate();n.lastCtrlActive=n.fInfoCtrl}r(n)})})};e.render=function(e){const t=this;t.lineColor=t.options.lineColor?t.options.lineColor:"#c00";var n={};t.modes[TC.Consts.geom.POINT]&&(n.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(n.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(n.polygonSelectValue=TC.Consts.geom.POLYGON);return TC.Control.prototype.renderData.call(t,n,function(){var n=function(){switch(this.value){case TC.Consts.geom.POLYLINE:console.log("seleccion por l\xednea");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.polygonFInfoCtrl||t.lineFInfoCtrl.activate();t.lastCtrlActive=t.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:console.log("seleccion por pol\xedgono");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.polygonFInfoCtrl.activate();t.lastCtrlActive=t.polygonFInfoCtrl;break;default:console.log("seleccion por punto");t.map.activeControl!==t.polygonFInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}};t.div.querySelectorAll("input[type=radio]").forEach(function(e){e.addEventListener("change",n)});$.isFunction(e)&&e()})};e.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};e.deactivate=function(){this.lastCtrlActive.deactivate(!1)};TC.Map.prototype.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.MultiFeatureInfo");return e&&e.length?e[0].lastCtrlActive:(e=this.getControlsByClass("TC.control.FeatureInfo"))&&e.length?e[0]:null}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var e=TC.control.NavBar.prototype;e.CLASS="tc-ctl-nav";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBar(this));return this._set1stRenderPromise(Promise.resolve())};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.wrap.register(e);(void 0===t.options.home||t.options.home)&&e.addControl("navBarHome");e.loaded(function(){t.wrap.refresh()});return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBarHome=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBarHome,TC.Control);!function(){var e=TC.control.NavBarHome.prototype;e.CLASS="tc-ctl-nav-home";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBarHome(this));return Promise.resolve()};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.wrap.register(e);e.on(TC.Consts.event.PROJECTIONCHANGE,function(n){const r=n.crs;var i=TC.Util.reproject([e.options.initialExtent[0],e.options.initialExtent[1]],e.options.crs,r),s=TC.Util.reproject([e.options.initialExtent[2],e.options.initialExtent[3]],e.options.crs,r);t.wrap.setInitialExtent([i[0],i[1],s[0],s[1]])});return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.isLoaded=!1;this.layer=null};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";TC.isDebug?e.template=TC.apiLocation+"TC/templates/OverviewMap.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,n=function(t){return function(t){var n,r=function(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r];if((i.id||i)===e){n=i;break}}return n};if("string"==typeof t){var i=r(t,e.options.availableBaseLayers);$.isPlainObject(i)||(i=r(t,e.options.baseLayers));$.isPlainObject(i)&&(n=new TC.layer.Raster(i))}else n=t instanceof TC.Layer?t:t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t);return n}(t)};return new Promise(function(r,i){TC.Control.prototype.register.call(t,e).then(function(i){t.wrap=new TC.wrap.control.OverviewMap(t);e.loaded(function(){t.defaultLayer=n(t.options.layer);t.layer=n(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.options.availableBaseLayers[0]);t.wrap.register(e);!function(n){const r={};t.layer.getCapabilitiesPromise().then(function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(r.layer=t.layer.getFallbackLayer());t.wrap.reset(r)})}(e.crs);e.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(e){const t=this;if(t.map.baseLayer.type===TC.Consts.layerType.WMS||t.map.baseLayer.type===TC.Consts.layerType.WMTS||t.options.layer){var r=t.map.baseLayer.overviewMapLayer||t.options.layer;if(t.layer.id!==r){var i=n(r);t.wrap.reset({layer:i}).then(function(e){t.layer=e})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(e.type)>-1&&t.wrap.reset({layer:t.layer}).then(function(e){t.layer=e})}}.bind(t))});r(i)}).catch(function(e){i(e)})})};e.loaded=function(e){$.isFunction(e)&&(this.isLoaded&&this.map&&this.map.isLoaded?e():this.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};e.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYGON};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.PolygonFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var e=TC.control.Popup.prototype;e.CLASS="tc-ctl-popup";e.render=function(){const e=this;return e._set1stRenderPromise(new Promise(function(t,n){e.map.wrap.addPopup(e).then(function(){e.trigger(TC.Consts.event.CONTROLRENDER);t()},function(e){n(e instanceof Error?e:Error(e))})}))};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);return new Promise(function(r,i){Promise.all([n,t.renderPromise()]).then(function(){e.on(TC.Consts.event.VIEWCHANGE,function(){e.view===TC.Consts.view.PRINTING&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.LAYERREMOVE,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.UPDATE,function(){t.currentFeature&&t.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||t.isVisible()&&t.hide()});e.on(TC.Consts.event.FEATUREREMOVE,function(e){t.currentFeature===e.feature&&t.isVisible()&&t.hide()});r(t)}).catch(function(e){i(e instanceof Error?e:Error(e))})})};e.fitToView=function(e){var t=this;e?setTimeout(function(){t.wrap.fitToView()},1e3):t.wrap.fitToView()};e.hide=function(){if(this.map){this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.trigger(TC.Consts.event.POPUPHIDE,{control:this})}};e.getContainerElement=function(){return this.contentDiv||null};e.getMenuElement=function(){return this.menuDiv||null};e.setDragged=function(e){const t=this;t.dragged=e;t.popupDiv&&(e?t.popupDiv.classList.add(TC.Consts.classes.DRAGGED):t.popupDiv.classList.remove(TC.Consts.classes.DRAGGED));t.wrap.setDragged(e)};e.setDragging=function(e){const t=this;if(e){t.setDragged(!0);t.popupDiv.classList.add(TC.Consts.classes.DRAG)}else t.popupDiv.classList.remove(TC.Consts.classes.DRAG)};e.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(e){var t=this,n=e||{};t.ready=!1;t.title=n.title||TC.Util.getLocaleString(TC.Cfg.locale,"printPage");t.cssUrl=n.cssUrl||TC.apiLocation+"TC/css/print.css";if(n.target){const e=n.target;if(!e.querySelector("."+t.CLASS+"-btn")){for(var r in t.template)dust.cache[r]||t.template[r]();e.classList.add(TC.Consts.classes.PRINTABLE);var i=function(n){var r=open(null,t.CLASS),i=e.innerHTML;dust.render(t.CLASS+"-page",{title:t.title,content:i,cssUrl:t.cssUrl},function(e,t){r.document.write(t);r.document.close();r.focus();e&&TC.error(e)})};dust.render(t.CLASS,null,function(n,r){e.firstChild?e.firstChild.insertAdjacentHTML("beforebegin",r):e.innerHTML=r;e.querySelector("."+t.CLASS+"-btn").addEventListener("click",i)})}}};!function(){var e=TC.control.Print.prototype;e.CLASS="tc-ctl-print";e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<a class="tc-ctl-print-btn" title="').h("i18n",t,{},{$key:"printThisWindow"}).w('">').h("i18n",t,{},{$key:"print"}).w("</a>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-page"]=function(){dust.register(e.CLASS+"-page",t);function t(e,t){return e.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(t.get(["title"],!1),t,"h").w('</title><link rel="stylesheet" href="').f(t.get(["cssUrl"],!1),t,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(t.get(["title"],!1),t,"h").w("</h1>").f(t.get(["content"],!1),t,"h",["s"]).w("</body></html>")}t.__dustBody=!0;return t}}();TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.PrintMap=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintMap,TC.control.MapInfo);!function(){var e=TC.control.PrintMap.prototype;e.CLASS="tc-ctl-printMap";const t="portrait",n="landscape",r="A4",i="A3";var s={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},o={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},a={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},l={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}};const c=function(e,c){switch(e){case t:switch(c){case r:return s;case i:return a}break;case n:switch(c){case r:return o;case i:return l}break;default:return s}},u=function(e){return e.layoutPDF.content[0].columns[0]},h=function(e){return e.layoutPDF.content[0].columns[2]},p={sideLength:85};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/PrintMap.html";e.template[e.CLASS+"-view"]=TC.apiLocation+"TC/templates/PrintMapView.html";e.template[e.CLASS+"-tools"]=TC.apiLocation+"TC/templates/PrintMapTools.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",t,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",t,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",t,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt tc-ctl-printMap-cnt-btn"><input id="tc-ctl-printMap-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-printMap-image-qr" class="tc-ctl-printMap-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"printMap"}).w('">').h("i18n",t,{},{$key:"print"}).w('</button></div><div class="tc-group tc-ctl-printMap-cnt"><div class="tc-ctl-printMap-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w("</p></div></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-view"]=function(){dust.register(e.CLASS+"-view",t);function t(e,t){return e.w('<div class="tc-ctl-printMap-view"> </div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-tools"]=function(){dust.register(e.CLASS+"-tools",t);function t(e,t){return e.w('<div class="tc-ctl-printMap-tools"><div class="tc-ctl-printMap-btn-pdf" title="').h("i18n",t,{},{$key:"printpdf"}).w('"></div><div class="tc-ctl-printMap-btn-close" title="').h("i18n",t,{},{$key:"close"}).w('"></div></div> ')}t.__dustBody=!0;return t}}const d=function(){return this.map.workLayers.some(function(e){return e.type===TC.Consts.layerType.WMS&&e.getVisibility()})};e.register=function(e){const n=this,r=TC.control.MapInfo.prototype.register.call(n,e);n.map.mustBeExportable=!0;const i=function(){c(n.orientation||t,n.format.toString().toUpperCase()||"A4").reset()};n.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+n.CLASS+"-btn",function(){n.map.setView(TC.Consts.view.PRINTING);var e=document.querySelector("."+n.CLASS+"-qrcode");if(document.querySelector("#"+n.CLASS+"-image-qr").checked){if(!e){(e=document.createElement("div")).classList.add(n.CLASS+"-qrcode");n.map.div.appendChild(e)}e.innerHTML="";n.makeQRCode(e,p.sideLength,p.sideLength)}else e&&(e.innerHTML="");const r="."+n.CLASS+"-btn";n.map.on(TC.Consts.event.STARTLOADING,function(){const e=n.div.querySelector(r);e.classList.add("disabled");e.disabled=!0});n.map.on(TC.Consts.event.STOPLOADING,function(){const e=n.div.querySelector(r);e.classList.remove("disabled");e.disabled=!1});d.call(n)&&n.map.on(TC.Consts.event.ZOOM,i);const s=function(e){if(e){n.map.div.classList.add(e);var t=n.map.div.getBoundingClientRect();Number.isInteger(t.width)||(n.map.div.style.width=Math.round(t.width)+"px");Number.isInteger(t.height)||(n.map.div.style.height=Math.round(t.height)+"px");n.map.toast(n.getLocaleString("print.advice.title")+": "+n.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3})}n.map.wrap.map.updateSize()},o=function(){c(n.orientation||t,n.format.toString().toUpperCase()||"A4").reset();d.call(n)&&n.map.off(TC.Consts.event.ZOOM,i);n.map.toastHide(n.getLocaleString("print.advice.title")+": "+n.getLocaleString("print.advice.desc"));n.map.div.classList.remove(n.currentFormat);n.map.div.classList.remove(n.CLASS+"-printing");n.map.div.style.removeProperty("width");n.map.div.style.removeProperty("height");s();n.map.setView(TC.Consts.view.DEFAULT);n._viewDiv.classList.add(TC.Consts.classes.HIDDEN)};if(!n._viewDiv){n._viewDiv=TC.Util.getDiv();document.body.appendChild(n._viewDiv);n.getRenderedHtml(n.CLASS+"-view",null,function(e){n._viewDiv.innerHTML=e});n.getRenderedHtml(n.CLASS+"-tools",null,function(e){n.map.div.lastElementChild.insertAdjacentHTML("afterend",e);n.map.div.querySelector("."+n.CLASS+"-btn-close").addEventListener("click",o);n.map.div.querySelector("."+n.CLASS+"-btn-pdf").addEventListener("click",n.createPdf.bind(n))})}n.orientation=n.div.querySelector("#print-design").value;n.format=n.div.querySelector("#print-size").value;n.currentFormat=n.CLASS+"-"+n.orientation+"-"+n.format;n._viewDiv.classList.remove(TC.Consts.classes.HIDDEN);n.map.div.classList.add(n.CLASS+"-printing");s(n.currentFormat)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("#"+n.CLASS+"-image-qr",function(e){n.generateLink()}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){n.generateLink();n.registerListeners()}));return r};e.createPdf=function(){var e=this,n=e.map.getControlsByClass(TC.control.LoadingIndicator)[0],r=n.addWait();TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){const i=e.map.div.querySelectorAll(".ol-viewport");for(var s=0,o=i.length;s<o;s++){const t=i[s];if(!t.parentElement.classList.contains("ol-overviewmap-map")){e.canvas=t.querySelector("canvas");break}}var a=c(e.orientation||t,e.format.toString().toUpperCase()||"A4"),l=a.layoutPDF;const d=function(t){var i=window.location.host+"_",s=e.div.querySelector("."+e.CLASS+"-title").value.trim();if(s)i+=s;else{i+=TC.Util.getFormattedDate((new Date).toString(),!0)}try{pdfMake.createPdf(t).download(i.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(t){e.map.toast(e.getLocaleString("print.error"),{type:TC.Consts.msgType.ERROR});TC.error(t.message+"  "+t.stack,TC.Consts.msgErrorMode.EMAIL)}n.removeWait(r)},f=function(t){TC.error(e.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},y=function(){var t=[],n=[],r=function(e,t,n){if(t.isVisibleByScale(e.name)){var r,i;t.options&&t.options.params&&t.options.params.base64LegendSrc?i=t.options.params.base64LegendSrc:e.legend&&(r=e.legend.src);result.push({src:r,title:e.title,level:n,srcBase64:i})}},i=function(e,t,n,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)i(e[s],t,n,r);else if(e&&e.hasOwnProperty("children")&&e.children.length>0){e.title&&e.name&&result.push({header:e.title,level:r});i(e.children,t,n,++r)}if(e&&e.hasOwnProperty("children")&&0==e.children.length){t.apply(this,[e,n,r]);r--}};e.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS&&e.getVisibility()}).forEach(function(e){result=[];var t=e.options.hideTree;e.tree=null;e.options.hideTree=!0;i(e.getTree(),r,e,0);e.options.hideTree=t;result.length>0&&n.push({title:e.title,layers:result})});return new Promise(function(e,r){Promise.all(function(){for(var e=[],t=0;t<n.length;t++)for(var r=n[t].layers,i=0;i<r.length;i++)!function(r,i){var s=n[t].layers[i],o=s.src||s.srcBase64;if(o){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");e.push(new Promise(function(e,t){new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!0}).fetchImage(o,{exportable:!0}).then(function(t){if(t.complete){var n=TC.Util.imgTagToDataUrl(t,"image/png");s.image={base64:n.base64,canvas:n.canvas}}else f(o);e()},function(e){f(o);t()})}))}}(0,i);return e}()).then(function(){n.map(function(e,t){return{groupIndex:t,height:e.layers.filter(function(e){return e.image&&e.image.canvas}).reduce(function(e,t,n,r){return e+r[n].image.canvas.height},0)}}).sort(function(e,t){return e.height>t.height?1:e.height<t.height?-1:0}).forEach(function(e,r){!function(e,n){var r=[[{text:e.title,colSpan:2,alignment:"left",fontSize:11,margin:[0,n>0?10:0,0,5]},{}]];const i=(r=r.concat(e.layers.filter(function(t){return t.hasOwnProperty("header")&&t.header.trim().toLowerCase()!==e.title.trim().toLowerCase()}).map(function(e){return[{text:e.header.trim(),colSpan:2,alignment:"left",margin:[10*e.level,0,0,3]},{}]}))).length;var s=null,o=null;e.layers.forEach(function(e,t){if(e.header){s=e;o&&(o=null)}else{o||(o=1);var n;s&&(n=r.map(function(e){return e[0].text}).indexOf(s.header)+o++);if(e.image){var i=e.image.canvas.width/2,a=i*e.image.canvas.height/e.image.canvas.width,l=[{text:e.title,fontSize:9,width:"auto",margin:[10*e.level,0,0,2]},{image:e.image.base64,width:i,height:a,margin:[10*e.level,0,0,2]}];n?r.splice(n,0,l):r.push(l)}else{l=[{text:e.title,fontSize:9,colSpan:2,margin:[10*e.level,0,0,2]},{}];n?r.splice(n,0,l):r.push(l)}}});t.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:i,body:r}})}(n[e.groupIndex],r)});e(t)},function(){r([])})})},m=[function(){const t=function(){var e=u(a);delete e.image;e.text="";return e};return e.options.logo?TC.Util.imgToDataUrl(e.options.logo,"image/png").then(function(e){const t=e.canvas,n=e.dataUrl;TC.Util.calculateAspectRatioFit(t.width,t.height,a.logoWidth,a.logoHeight);var r=u(a);r.image=n;return r},function(){f(e.options.logo);return t()}):t()},function(){var t=function(e){return e.layoutPDF.content[0].columns[1]}(a);t.text=e.div.querySelector("."+e.CLASS+"-title").value.trim();return t},function(){const t=function(){var e=h(a);delete e.image;e.text="";e.width="auto";return e};var n=e.map.getControlsByClass(TC.control.ScaleBar)[0];if(n){var r=document.getElementsByClassName("ol-scale-line-inner"),i=r[0].getBoundingClientRect();if(i){var s=getComputedStyle(r[0],null),o=parseInt(s.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(s.getPropertyValue("border-right-width").replace("px",""))||0,c=h(a);c.table={widths:[.75*((i.width>i.height?i.width:i.height)-o-l)],body:[[{border:[!0,!1,!0,!0],text:n.getText(),fontSize:10,alignment:"center"}]]};c.layout={paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}};return c}t()}else t()},function(){if(document.querySelector("#"+e.CLASS+"-image-qr").checked){const t=document.querySelector("."+e.CLASS+"-qrcode");t.innerHTML="";return e.makeQRCode(t,p.sideLength,p.sideLength).then(function(t){if(t)return TC.Util.addToCanvas(e.canvas,t,{x:e.canvas.width-p.sideLength,y:e.canvas.height-p.sideLength},{width:p.sideLength,height:p.sideLength}).then(function(e){return e});TC.error(e.getLocaleString("print.qr.error"));return e.canvas})}return e.canvas}];Promise.all(m.map(function(e){return e()})).then(function(t){t[2].table&&(a.layoutPDF.content[0].columns[1].width=a.layoutPDF.pageSize.width-(a.layoutPDF.pageMargins[0]+a.layoutPDF.pageMargins[2])-a.layoutPDF.content[0].columns[0].width-(a.layoutPDF.content[0].columns[2].table.widths[0]+2));var n=function(e){return e.layoutPDF.content[1].table.body[0][0]}(a),r=t[3]||e.canvas;n.image=r.toDataURL();if(e.options.legend&&e.options.legend.visible&&function(){return this.map.workLayers.some(function(e){if(e.type===TC.Consts.layerType.WMS&&e.getVisibility()){for(var t=0;t<e.names.length;t++)if(e.isVisibleByScale(e.names[t]))return!0;return!1}return!1})}.call(e)&&2==l.content.length){const t=e.div.querySelector("."+e.CLASS+"-title").value.trim();l.content.push({pageBreak:"before",pageOrientation:e.options.legend.orientation||"portrait",text:t.length>0?t:"",fontSize:14,margin:[0,20,0,10]});y().then(function(e){l.content=l.content.concat(e);d(l)})}else d(l)})})};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");document.querySelector("#"+this.CLASS+"-image-qr").checked&&e.qr?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa",SHOW_IN:"showIn",SHOW_OUT:"showOut"};this.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};this.content=this.contentType.TABLE;$.isEmptyObject(this.options)&&(this.options={content:"table"});this.options;this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.template={};ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};if(TC.isDebug){ctlProto.template[ctlProto.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";ctlProto.template[ctlProto.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";ctlProto.template[ctlProto.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{ctlProto.template[ctlProto.CLASS]=function(){dust.register(ctlProto.CLASS,e);function e(e,t){return e.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><span class="prpanel-title-text"></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="').h("i18n",t,{},{$key:"export.excel"}).w('"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="tc-ctl-p-results-menu"></div><div class="prpanel-body list-group tc-ctl-p-results-info"></div><div class="prpanel-body list-group tc-ctl-p-results-table"></div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"expand"}).w('" data-no-cb><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}e.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-table"]=function(){dust.register(ctlProto.CLASS+"-table",e);function e(e,r){return e.w('<table class="table" style="display:none;"><thead>').s(r.get(["columns"],!1),r,{block:t},{}).w("</thead><tbody>").s(r.get(["results"],!1),r,{block:n},{}).w("</tbody></table>")}e.__dustBody=!0;function t(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}t.__dustBody=!0;function n(e,t){return e.w("<tr>").h("iterate",t,{block:r},{on:t.getPath(!0,[])}).w("</tr>")}n.__dustBody=!0;function r(e,t){return e.w("<td>").f(t.get(["value"],!1),t,"h").w("</td>")}r.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-chart"]=function(){dust.register(ctlProto.CLASS+"-chart",e);function e(e,r){return e.w('<div class="tc-track-chart">').x(r.get(["msg"],!1),r,{else:t,block:n},{}).w("</div>")}e.__dustBody=!0;function t(e,t){return e.w('<span id="elevationGain" >').h("i18n",t,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(t.get(["upHill"],!1),t,"h").w("m, -").f(t.get(["downHill"],!1),t,"h").w('m</span><div class="tc-chart"></div>')}t.__dustBody=!0;function n(e,t){return e.f(t.get(["msg"],!1),t,"h")}n.__dustBody=!0;return e}}const isElementVisible=function(e){const t=getComputedStyle(e);return e&&!e.hidden&&"none"!==t.display&&"hidden"!==t.visibility};ctlProto.isVisible=function(){const e=this.div.querySelector(".prsidebar-body"),t=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)||isElementVisible(t)};ctlProto.isMinimized=function(){const e=this.div.querySelector(".prsidebar-body"),t=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)&&!isElementVisible(e)};const manageClassList=function(e,t,n){const r=this.div.querySelector("."+e);if(r){r.classList.add(t);r.classList.remove(n)}};ctlProto.show=function(e){const t=this.div.querySelector("."+e);t&&"none"===t.style.display&&(t.style.display="");manageClassList.call(this,e,this.classes.SHOW_IN,this.classes.SHOW_OUT)};ctlProto.hide=function(e){manageClassList.call(this,e,this.classes.SHOW_OUT,this.classes.SHOW_IN);const t=this.div.querySelector("."+e);t&&(t.style.display="none")};ctlProto.doVisible=function(){this.div.classList.remove(TC.Consts.classes.HIDDEN);this.show("prsidebar-body")};ctlProto.render=function(e){const t=this;t.div.classList.add(TC.Consts.classes.HIDDEN);return TC.Control.prototype.render.call(t,function(){t.mainTitleElm=t.div.querySelector(".prpanel-title-text");t.minimizeButton=t.div.querySelector(".prcollapsed-slide-submenu-min");t.minimizeButton.addEventListener("click",function(){t.minimize()});t.closeButton=t.div.querySelector(".prcollapsed-slide-submenu-close");t.closeButton.addEventListener("click",function(){t.close()});t.maximizeButton=t.div.querySelector(".prcollapsed-max");t.maximizeButton.addEventListener("click",function(){t.maximize()});if(t.save){t.saveButton=t.div.querySelector(".prcollapsed-slide-submenu-csv");t.saveButton.addEventListener("click",function(){t.exportToExcel()});t.saveButton.removeAttribute("hidden")}if(t.content){t.content=t.content;if(t.options.titles){if(t.options.titles.main){t.mainTitleElm.setAttribute("title",t.options.titles.main);t.mainTitleElm.innerHTML=t.options.titles.main}t.options.titles.max&&t.maximizeButton.setAttribute("title",t.options.titles.max)}else{t.mainTitleElm.setAttribute("title",t.getLocaleString("rsp.title"));t.mainTitleElm.innerHTML=t.getLocaleString("rsp.title")}}t.div.querySelector(t.content.collapsedClass).classList.add(t.classes.FA);t.infoDiv=t.div.querySelector("."+t.CLASS+"-info");t.tableDiv=t.div.querySelector("."+t.CLASS+"-table");t.menuDiv=t.div.querySelector("."+t.CLASS+"-menu");Modernizr.touch&&TC.Util.swipe(t.div,{left:function(){t.minimize()}});e&&"function"==typeof e&&e.call()})};ctlProto.minimize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);if(!isElementVisible(t)){t.classList.add(e.classes.FA);t.hidden=!1;e.hide("prsidebar-body");e.show("prcollapsed-max");e.map.trigger(TC.Consts.event.RESULTSPANELMIN,{control:e})}};ctlProto.maximize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);if(isElementVisible(t)){t.hidden=!0;e.show("prsidebar-body");e.hide("prcollapsed-max");e.map.trigger(TC.Consts.event.RESULTSPANELMAX,{control:e})}};ctlProto.close=function(){const e=this;e.div.classList.add(TC.Consts.classes.HIDDEN);e.chart&&e.chart.chart&&(e.chart.chart=e.chart.chart.destroy());const t=e.div.querySelector(".prsidebar-body");if(t){t.style.display="none";e.div.querySelector(".prcollapsed-max").style.display="none";const n=e.div.querySelector(e.content.collapsedClass);n.hidden=!0;n.classList.remove(e.classes.FA);e.map.trigger(TC.Consts.event.RESULTSPANELCLOSE,{control:e})}};ctlProto.openChart=function(e){const t=this;t.div.classList.remove(TC.Consts.classes.HIDDEN);t.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return e!==t}).filter(function(e){return"chart"===e.options.content}).forEach(function(e){e.close()});if(e)if(e.msg)t.map.toast(e.msg);else{t.elevationProfileCoordinates=e.coords;t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+ctlProto.CLASS+"-chart")})}else t.map.toast(options.msg);t.map.getLoadingIndicator().hide()};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data,div=options.div;var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(ctlProto.CLASS+"-chart",{upHill:data.upHill.toLocaleString(locale),downHill:data.downHill.toLocaleString(locale)},function(out){div.innerHTML=out;div.style.display="";if(self.options.titles){if(self.options.titles.main){const e=self.div.querySelector(".prpanel-title-text");e.setAttribute("title",self.options.titles.main);e.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var chartOptions=$.extend({bindto:div.querySelector(".tc-chart"),padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){$.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.trigger(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(e,t){var n=this,r=n.config,i=n.d3.svg.line(),s=n.generateGetLinePoints(e,t),o=t?n.getSubYScale:n.getYScale,a=function(e){return(t?n.subxx:n.xx).call(n,e)},l=function(e,t){return r.data_groups.length>0?s(e,t)[0][1]:o.call(n,e.id)(e.value)};i=r.axis_rotated?i.x(l).y(a):i.x(a).y(l);r.line_connectNull||(i=i.defined(function(e){return null!=e.value}));return function(e){var s,a=r.line_connectNull?n.filterRemoveNull(e.values):e.values,l=t?n.x:n.subX,c=o.call(n,e.id),u=0,h=0;if(n.isLineType(e))if(r.data_regions[e.id])s=n.lineWithRegions(a,l,c,r.data_regions[e.id]);else{n.isStepType(e)&&(a=n.convertValuesToStep(a));s=i.interpolate("linear")(a)}else{if(a[0]){u=l(a[0].x);h=c(a[0].value)}s=r.axis_rotated?"M "+h+" "+u:"M "+u+" "+h}return s||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(e,t){var n=this,r=n.config,i=n.d3.svg.area(),s=n.generateGetAreaPoints(e,t),o=t?n.getSubYScale:n.getYScale,a=function(e){return(t?n.subxx:n.xx).call(n,e)},l=function(e,t){return r.data_groups.length>0?s(e,t)[0][1]:o.call(n,e.id)(0)},c=function(e,t){return r.data_groups.length>0?s(e,t)[1][1]:o.call(n,e.id)(e.value)};i=r.axis_rotated?i.x0(l).x1(c).y(a):i.x(a).y0(l).y1(c);r.line_connectNull||(i=i.defined(function(e){return null!==e.value}));return function(e){var t,s=r.line_connectNull?n.filterRemoveNull(e.values):e.values,o=0,a=0;if(n.isAreaType(e)){n.isStepType(e)&&(s=n.convertValuesToStep(s));t=i.interpolate("linear")(s)}else{if(s[0]){o=n.x(s[0].x);a=n.getYScale(e.id)(s[0].value)}t=r.axis_rotated?"M "+a+" "+o:"M "+o+" "+a}return t||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};const closeOpenedTableResultsPanel=function(){const e=this;e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return t!==e&&t.isVisible()}).filter(function(t){return t.options.content!==e.contentType.CHART}).forEach(function(e){e.close()})};ctlProto.openTable=function(){var e=this;e.div.classList.remove(TC.Consts.classes.HIDDEN);if(n=arguments[0]){var t;n.css&&(t=n.css);var n,r=n.callback,i=n.columns;if((n=n.data)&&n.length>0){if(!i){i=[];for(var s in n[0])i.push(s)}e.tableData={columns:i,results:n,css:t,callback:r};e.getRenderedHtml(e.CLASS+"-table",e.tableData).then(function(t){const n=e.div.querySelector("."+e.CLASS+"-table"),r=n.parentElement;r.removeChild(n);n.innerHTML=t;r.appendChild(n);e.tableData.callback&&e.tableData.callback(n);closeOpenedTableResultsPanel.call(e);e.map.trigger(TC.Consts.event.DRAWTABLE,{control:e})});e.div.querySelector("."+e.CLASS+"-chart").style.display="none";e.div.querySelector("."+e.CLASS+"-info").style.display="none";e.show("prsidebar-body")}}e.map.getLoadingIndicator().hide()};ctlProto.open=function(e,t){const n=this;n.div.classList.remove(TC.Consts.classes.HIDDEN);const r=t||n.div.querySelector("."+n.CLASS+"-table");n.requestIsRendered=window.requestAnimationFrame(function(){var e=r.getBoundingClientRect();if(e&&e.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.trigger(TC.Consts.event.DRAWTABLE,{control:n})}}.bind(n));n.div.querySelector("."+n.CLASS+"-chart").style.display="none";const i=n.div.querySelector("."+n.CLASS+"-table");i.style.display="none";n.div.querySelector("."+n.CLASS+"-info").style.display="none";if(e)if(t){n.getTableContainer=function(){return t};t.innerHTML=e;t.style.display=""}else{i.innerHTML=e;i.style.display=""}const s=n.div.querySelector(".prcollapsed-max");if(n.options.titles){if(n.options.titles.main){const e=n.div.querySelector(".prpanel-title-text");e.setAttribute("title",n.options.titles.main);e.innerHTML=n.options.titles.main}n.options.titles.max&&s.setAttribute("title",n.options.titles.max)}n.options.classes&&n.options.classes.collapsed&&s.querySelector("i.fa-list-alt").classList.add(n.options.classes.collapsed);const o=n.div.querySelector(n.content.collapsedClass);isElementVisible(o)&&n.maximize();n.show("prsidebar-body");n.hide("prcollapsed-max");n.map.getLoadingIndicator().hide()};ctlProto.createChartOptions=function(e){const t=this;var n={};const r=(e=e||{}).locale||TC.Util.getMapLocale(t.map);e.chartType;if(null!=e.ele){const o=function(){const n=document.documentElement.clientWidth/100*40;return{height:n>445?e.maxHeight||t.CHART_SIZE.MAX_HEIGHT:e.minHeight||t.CHART_SIZE.MIN_HEIGHT,width:n>445?e.maxWidth||t.CHART_SIZE.MAX_WIDTH:n>310?e.mediumWidth||t.CHART_SIZE.MEDIUM_WIDTH:e.minWidth||t.CHART_SIZE.MIN_WIDTH}};var i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.ele.forEach(function(e){if("number"==typeof e){i=Math.max(e,i);s=Math.min(e,s)}});const a="grad"+TC.getUID();n={data:{x:"x",columns:[["x"].concat(e.x),["ele"].concat(e.ele)],types:{ele:"area-spline"},colors:{ele:"url(#"+a+")"}},size:o(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(e){var t,n;if((e/=1e3)<1){t=Math.round(1e3*e);n=" m"}else{t=Math.round(100*e)/100;n=" km"}return(t=t.toLocaleString(r))+n}}},y:{padding:{top:0,bottom:0},max:i,min:s,tick:{count:2,format:function(e){return(parseInt(e.toFixed(0))||0).toLocaleString(r)+"m"}}}},onresize:function(){this.api.resize(o())}};e.time&&(n.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));n._onrendered=function(){const e=this.svg[0][0];var n=e.getElementsByTagName("defs")[0],r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"linearGradient");i.setAttributeNS(null,"id",a);i.setAttributeNS(null,"x1","0%");i.setAttributeNS(null,"x2","0%");i.setAttributeNS(null,"y1","0%");i.setAttributeNS(null,"y2","100%");i.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const s=document.createElementNS(r,"stop");s.setAttributeNS(null,"offset","0%");s.setAttributeNS(null,"stop-color","red");s.setAttributeNS(null,"stop-opacity","0.7");i.appendChild(s);const o=document.createElementNS(r,"stop");o.setAttributeNS(null,"offset","50%");o.setAttributeNS(null,"stop-color","orange");o.setAttributeNS(null,"stop-opacity","0.9");i.appendChild(o);const l=document.createElementNS(r,"stop");l.setAttributeNS(null,"offset","100%");l.setAttributeNS(null,"stop-color","green");l.setAttributeNS(null,"stop-opacity","1");i.appendChild(l);n.appendChild(i);const c=d3.select(".c3-brush").node();c&&c.parentNode.removeChild(c);d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(e){d3.event.stopPropagation();const n=t.elevationProfileCoordinates[e.index].slice(0,2);n&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t.map.zoomToFeatures([new TC.feature.Point(n)])})});var u=d3.select(".c3-axis.c3-axis-x").select("path").attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(u)){u=u.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(u)){u=u.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}}const h=e.getBoundingClientRect(),p={width:h.width,height:h.height};var d=function(){var e=d3.scale.ordinal().rangeRoundBands([0,p.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(e,t){e.each(function(){e.each(function(e,t){if(0!=t){d3text=d3.select(this);if(1===d3text.node().childNodes.length){var n=d3text.select("tspan").node().cloneNode(),r=d3text.text().split(" ");d3text.select("tspan").text(r[0]);n.textContent=r[1];var i=n.getAttribute("dy");i=(i=i?parseFloat(n.getAttribute("dy")):.71)+.18+"em";n.setAttribute("dy",i);d3text.node().appendChild(n)}}})})},e.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&d();else{if(t.elevationChartLabelsRAF){window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0}t.elevationChartLabelsRAF=requestAnimationFrame(function e(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())t.elevationChartLabelsRAF=requestAnimationFrame(e);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)t.elevationChartLabelsRAF=requestAnimationFrame(e);else{window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&d()}})}if(!t.isMinimized()){t.show("prsidebar-body");t.hide("prcollapsed-max")}t.div.querySelector("."+t.CLASS+"-table").style.display="";t.div.querySelector("."+t.CLASS+"-info").style.display=""}}else n={msg:t.getLocaleString("geo.trk.chart.chpe.empty")};return n};const getTime=function(e,t){var n=t-e,r={},i=Math.floor(n/1e3/60/60/24);n-=1e3*i*60*60*24;var s=Math.floor(n/1e3/60/60);n-=1e3*s*60*60;r.h=s+24*i;var o=Math.floor(n/1e3/60);n-=1e3*o*60;r.m=o;r.s=Math.floor(n/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(e){const t=this.elevationProfileCoordinates;var n=e[0].x;n/=1e3;const r=t[e[0].index];var i;4==t[0].length&&t[0][3]>0&&(i=getTime(t[0][3],r[3]));const s=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,o=parseInt(e[0].value.toFixed(0)).toLocaleString(s);var a,l;if(n<1){a=Math.round(1e3*n);l=" m"}else{a=Math.round(100*n)/100;l=" km"}return'<div class="track-elevation-tooltip"><div><span>'+o+" m </span><br><span>"+(a=a.toLocaleString(s))+l+" </span></div>"+(i?"<span>"+i.toString+"</span><div/>":"")};ctlProto.getTableContainer=function(){return this.tableDiv};ctlProto.getInfoContainer=function(){return this.infoDiv};ctlProto.getMenuElement=function(){return this.menuDiv};ctlProto.getContainerElement=function(){return this.div||null};ctlProto.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.wrap.register(e);t.openOn&&t.map.one(t.openOn,function(e,n){t.content.fnOpen.call(t,e.data)});t.closeOn&&t.map.one(t.closeOn,function(e,n){t.close()});t.options.openOn&&t.map.on(t.options.openOn,function(e,n){t.content.fnOpen.call(t,e.data)});t.options.closeOn&&t.map.on(t.options.closeOn,function(e,n){t.close()});return n};ctlProto.exportToExcel=function(){var e=this,t=[e.tableData.columns];$.each(e.tableData.results,function(e,n){var r=[];for(var i in n)n.hasOwnProperty(i)&&"Id"!==i&&"Geom"!==i&&r.push(n[i]);t.push(r)});var n=function(n){var r=e.save.fileName?e.save.fileName:"resultados.xls",i=e.options.titles&&e.options.titles.main?e.options.titles.main:null;n.Save(r,t,i)};TC.Util.ExcelExport?n(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/TC.Util.ExcelExport",function(){n(new TC.Util.ExcelExport)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var e=TC.control.ScaleBar.prototype;e.CLASS="tc-ctl-sb";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.ScaleBar(this));this.wrap.render();return this._set1stRenderPromise(Promise.resolve())};e.register=function(e){const t=this;return new Promise(function(n,r){Promise.all([TC.Control.prototype.register.call(t,e),e.wrap.getMap()]).then(function(e){e[1].addControl(t.wrap.ctl);n(t)})})};e.getText=function(){return this.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";TC.isDebug?e.template=TC.apiLocation+"TC/templates/ScaleSelector.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:n},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}t.__dustBody=!0;function n(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:r},{key:i,value:s}).w(">1:").h("math",t,{},{key:o,method:"round"}).w("</option>\n")}n.__dustBody=!0;function r(e,t){return e.w(' selected="true"')}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!0,[]),t,"h")}i.__dustBody=!0;function s(e,t){return e.f(t.get(["scale"],!1),t,"h")}s.__dustBody=!0;function o(e,t){return e.f(t.getPath(!0,[]),t,"h")}o.__dustBody=!0;return t};e.render=function(e){var t=this;return t._set1stRenderPromise(new Promise(function(n,r){if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var i=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t.div.querySelectorAll("option").forEach(function(e){e.textContent="1:"+t.format(e.textContent.substr(2))});t.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){t.setScreenSize()});t.div.querySelector("select").addEventListener("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e();n()}).catch(function(e){r(e instanceof Error?e:Error(e))})};t.scales?i():t.map.wrap.getMap().then(i)}else r(Error("ScaleSelector no registrado"))}))};e.setScale=function(e){var t=.0254*e/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(t/=window.devicePixelRatio);this.metersPerDegree&&(t/=this.metersPerDegree);this.map.wrap.setResolution(t);return t}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(e,t,n){var r=this;r.parent=n;r._featureTypes=[];$.extend(r,t);r.typeName=e;r._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};r.getFeatureTypes=function(e){if(e)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var t=this.featureType instanceof Array?this.featureType:[this.featureType],n=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=t.concat(n)}return this._featureTypes};r.isFeatureOfThisType=function(e){return this.getFeatureTypes().indexOf(e)>-1};r.getStyleByFeatureType=function(e){return this.getFeatureTypes().indexOf(e)>-1?this.styles[this.getFeatureTypes().indexOf(e)]:null};var i=function(e,t,n){var r=function(e,t,n){if(t){if(e.hasOwnProperty(t)&&e[t].hasOwnProperty(n))return e[t][n]}else for(var t in e)if(e[t].hasOwnProperty(n))return e[t][n]};if(n){return r(this.getStyleByFeatureType(n),t,e)}for(var i=0;i<this.styles.length;i++){var s=r(this.styles[i],t,e);if(s)return s}};r.getSuggestionListHead=function(){var e,t,n,r=this;if("function"==typeof r.suggestionListHead){e=r.suggestionListHead();t=e.label;n=[{color:e.color,title:e.label}]}else{e=r.suggestionListHead;t=r.parent.getLocaleString(e.label);if("string"==typeof e.color)n=[{color:i.call(r,e.color),title:t}];else if(e.color instanceof Array){var s=r.getFeatureTypes();e.color.length===s.length?n=e.color.map(function(e,n){return{color:i.call(r,e[s[n]].color.css,e[s[n]].color.geomType,s[n]),title:r.parent.getLocaleString(e[s[n]].title)||t}}):r._throwConfigError()}else"object"==typeof e.color&&(n=[{color:i.call(r,e.color.css,e.color.geomType),title:t}])}if(t&&n){var o='<li header><span class="header">'+t+"</span>";return o+=n.map(function(e){if(e.color)return'<span class="header-color" title="'+e.title+'" style="color: '+e.color+';"></span>'}).join("")+"</li>"}r._throwConfigError()};r.getSuggestionListElements=function(e){var t=this,n=[],r=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(isNaN(e)&&isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},i=function(e){for(var t=[],n=0;n<e.length;n++)-1==jQuery.inArray(e[n],t)&&t.push(e[n]);return t};t.parseFeatures(e).forEach(function(e){var s=[],o=[],a="",l=t.outputProperties,c=t.dataIdProperty,u=t.outputFormatLabel,h=e.id.split(".").slice(0,1).shift();if(!(t.outputProperties instanceof Array)){l=t.outputProperties[h];c=t.dataIdProperty[h];u=u[h]}for(var p=0;p<l.length;p++)s.push(e.data[l[p]]);for(p=0;p<c.length;p++)o.push(e.data[c[p]]);for(var d={},f=0;f<t.outputProperties.length;f++)d[t.outputProperties[f]]=s[f];s instanceof Array&&u&&i(s).length>1?a=u.tcFormat(s):s instanceof Array&&1==i(s).length&&(a=s[0]);var y=a.toCamelCase();(function(e){for(var t=0;t<n.length;t++){var i=0,s=[];for(var o in e){s.push(r(e[o],n[t].properties[o]));i++}if(s.filter(function(e){return e}).length===i)return!0}return!1})(d)||n.push({text:y,label:y,id:o.join("#"),dataRole:t.typeName,dataLayer:h,properties:d})});return n};r.parseFeatures=function(e){return(r.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:r.featurePrefix,featureType:r.featureType})).read(e)};r.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};r.filter=function(e){const t=function(t,n){var r=[];if(n!=e.parent.rootCfg.active.root)if(-1!==n.indexOf("#")||e.parent.rootCfg.active.limit)for(var i=n.split("#"),s=0;s<e.parent.rootCfg.active.dataIdProperty.length;s++){0==s&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[s],i.length>s?i[s]:i[0]));s==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}else{var o=e.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(t,r){return e.filter.getFilterNode(t,e.parent._LIKE_PATTERN+n+e.parent._LIKE_PATTERN)});if(o.length>1){r.push("<ogc:And>");(r=r.concat(o)).push("</ogc:And>")}else r=r.concat(o)}else{for(var a=0;a<e.parent.rootCfg.active.root.length;a++){i=e.parent.rootCfg.active.root[a];0==a&&e.parent.rootCfg.active.root.length>1&&r.push("<ogc:Or>");for(s=0;s<e.parent.rootCfg.active.dataIdProperty.length;s++){0==s&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[s],i.length>s?i[s]:i[0]));s==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}}e.parent.rootCfg.active.root.length>1&&r.push("</ogc:Or>")}return t.concat(r)};return{getPropertyValue:function(t,n){return e.getSearchTypeByRole(t)[n]},getIsLikeNode:function(t,n){var r=/([\-\"\.\xba\(\)\/])/g;r.test(n)&&(n=n.replace(r,"\\$1"));return n.toString().indexOf(e.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+n.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+n.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+n.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(t,n){var r=/([\-\"\xba\(\)\/])/g;r.test(n)&&(n=n.replace(r,"\\$1"));if(n.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var i=n;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+t+"</ogc:PropertyName> <ogc:Literal>(?i)"+(i=(i=(i=(i=(i=i.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+n.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,n){var r,i=e.filter.getIsLikeNode;if(e.filterByMatch){i=e.filter.getFunctionStrMatches;var s=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");n=n.replace(s,e.parent._MATCH_PATTERN)}if(t instanceof Array||"string"==typeof t){if(t instanceof Array&&t.length>1){r="<ogc:Or>";for(l=0;l<t.length;l++)r+=i(t[l].trim(),n);return r+"</ogc:Or>"}return i(t instanceof Array&&1===t.length?t[0].trim():t.trim(),n)}var o=[];for(var a in t)if(t[a]instanceof Array&&t[a].length>1){r="<Or>";for(var l=0;l<t[a].length;l++)r+=i(t[a][l].trim(),n);r+="</Or>";o.push('(<Filter xmlns="http://www.opengis.net/ogc">'+r+"</Filter>)")}else{var c=t[a];t[a]instanceof Array&&1==t[a].length&&(c=t[a][0]);o.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+i(c.trim(),n)+"</Or></Filter>)")}return o.join("")},getFilter:function(n){var r={multiL:!1,f:""};switch(!0){case e.typeName===TC.Consts.searchType.NUMBER:s=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(n.t)&&!/(\<|\>|\<\>)/gi.exec(n.s)){e.parent.rootCfg.active?s=t(s,n.t):s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN));s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s+e.parent._LIKE_PATTERN))}else{(i=/(\<|\>|\<\>)/gi.exec(n.t))?s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t.substring(0,n.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?s=t(s,n.t):s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(n.s))?s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s.substring(0,n.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s+e.parent._LIKE_PATTERN))}s.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,n.p+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+s.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.STREET:s=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(n.t)&&!/(\<|\>|\<\>)/gi.exec(n.s)){e.parent.rootCfg.active?s=t(s,n.t):s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN));s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s+e.parent._LIKE_PATTERN))}else{var i;(i=/(\<|\>|\<\>)/gi.exec(n.t))?s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t.substring(0,n.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?s=t(s,n.t):s.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(n.s))?s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s.substring(0,n.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s+e.parent._LIKE_PATTERN))}r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+s.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.LOCALITY:r.f=e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN);r.multiL=!0;break;case e.queryProperties.hasOwnProperty("secondQueryWord"):var s;(s=[]).push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN));s.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+n.s+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+s.join("")+"</ogc:And></ogc:Filter>";break;default:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+n.t+e.parent._LIKE_PATTERN)+"</ogc:Filter>"}return r},getParams:function(t){var n=e.filter.getFilter(t),r={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},i=e.getFeatureTypes(!0);if(i instanceof Array){for(var s=[],o=0;o<i.length;o++)s.push(e.featurePrefix?e.featurePrefix+":"+i[o].trim():i[o].trim());r.TYPENAME=s.join(",")}else r.TYPENAME=e.featurePrefix?e.featurePrefix+":"+i.trim():i.trim();var a=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var n in e){var r=e[n][0];e[n].length>1&&(r=e[n].join(","));t.push(r)}return t}},l=a(e.outputProperties),c=a(e.dataIdProperty);if(l instanceof Array&&c instanceof Array){r.PROPERTYNAME="";for(o=0;o<l.length;o++)r.PROPERTYNAME+="("+l[o]+","+c[o]+")"}else r.PROPERTYNAME=l+","+c;r.FILTER=n.f;return $.param(r)},getGoToFilter:function(t){var n=[],r=t.split("#"),i=e.dataIdProperty,s=e.getFeatureTypes();if(i&&s)if(t.indexOf("#")>-1&&s instanceof Array&&s.length>1)for(var o=0;o<s.length;o++)for(var a=0;a<i[s[o]].length;a++)n.push({name:i[s[o]][a],value:r[a]});else if(-1==t.indexOf("#")&&s instanceof Array){var l=i;for(o=0;o<s.length;o++)if(!n.hasOwnProperty(s[o])){l instanceof Object&&i.hasOwnProperty(s[o])&&(l=i[s[o]]);for(a=0;a<l.length;a++)a<r.length&&n.push({name:l[a],value:r[a]})}}else{i instanceof Object&&i.hasOwnProperty(s)&&(i=i[s]);for(o=0;o<i.length;o++)n.push({name:i[o],value:r[o]})}return e.filter.transformFilter(n)},transformFilter:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}}}(r)};TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);e.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e.options&&e.options.url&&(e.url=e.options.url);e._LIKE_PATTERN="*";e._MATCH_PATTERN=".*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="Mun";e.POL="Pol";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:e.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:e.getRoad,goTo:e.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};e.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:e.getPK,goTo:e.goToPK,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};e.rootCfg={};e.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise(function(t,n){if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(e){return["CMUNICIPIO"].map(function(t,n){return t+"="+e[n]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");TC.ajax({url:e.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+$.param(r),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(n){if(n.totalFeatures>0){e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=n.features.map(function(t){return{id:["CMUNICIPIO"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).catch(function(){t([])})}else t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)})}};e.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise(function(t,n){if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.LOCALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.LOCALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(e){return["CMUNICIPIO","CENTIDAD"].map(function(t,n){return t+"="+e[n]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");TC.ajax({url:e.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+$.param(r),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(n){if(n.totalFeatures>0){e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=n.features.map(function(t){return{id:["CMUNICIPIO","CENTIDAD"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).catch(function(){t([])})}else t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)})}};e.allowedSearchTypes=[];if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes){if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){if(e.availableSearchTypes[t].renderFeatureType&&e.availableSearchTypes[t].renderFeatureType.length>0&&e.options.allowedSearchTypes[t].featureType&&!e.options.allowedSearchTypes[t].renderFeatureType){delete e.availableSearchTypes[t].renderFeatureType;e.availableSearchTypes[t].styles=e.availableSearchTypes[t].styles.slice(0,e.availableSearchTypes[t].styles.length-1)}$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(e.options.allowedSearchTypes[t].root&&t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.MUNICIPALITY||t!=TC.Consts.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.LOCALITY){e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType];e.rootCfg.active.root=e.options.allowedSearchTypes[t].root;e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty}}e.options.allowedSearchTypes[t]?e.addAllowedSearchType(t,e.availableSearchTypes[t]?e.availableSearchTypes[t]:e.options.allowedSearchTypes[t],e):delete e.options.allowedSearchTypes[t]}e.rootCfg.active&&e.rootCfg.active.getRootLabel();e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Search.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list tc-hidden"></ul></div>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t._search={data:[]};t.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function n(n,r,i){var s=t.getSearchTypeByFeature(i);if(s){var o=s.getStyleByFeatureType(e(i));if(o&&o.hasOwnProperty(r))return o[r][n]}return TC.Cfg.styles[r][n]}return function(t,r,i,s){!TC.Feature||s instanceof TC.Feature||this.map.trigger(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:s.geom});var o=n(r,t,e(s.id));if(i){if(o instanceof Array){var a=o.map(function(e){return s.getData().hasOwnProperty(e)?s.getData()[e]:""}),l=this.getSearchTypeByFeature(e(s.id));return l?l.outputFormatLabel.tcFormat(a):a.join(" ")}return s.getData().hasOwnProperty(o)?s.getData()[o]:""}return o}}();var r=t.layerStyleFN;t.layerPromise=e.addLayer({id:t.getUID(),title:"B\xfasquedas",stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:r.bind(t,"polygon","fillColor",!1),fillOpacity:r.bind(t,"polygon","fillOpacity",!1),strokeColor:r.bind(t,"polygon","strokeColor",!1),strokeOpacity:r.bind(t,"polygon","strokeOpacity",!1),strokeWidth:r.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:r.bind(t,"line","strokeColor",!1),strokeOpacity:r.bind(t,"line","strokeOpacity",!1),strokeWidth:r.bind(t,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:r.bind(t,"point","radius",!1),height:r.bind(t,"point","height",!1),width:r.bind(t,"point","width",!1),fillColor:r.bind(t,"point","fillColor",!1),fillOpacity:r.bind(t,"point","fillOpacity",!1),strokeColor:r.bind(t,"point","strokeColor",!1),strokeWidth:r.bind(t,"point","strokeWidth",!1),fontSize:r.bind(t,"point","fontSize",!1),fontColor:r.bind(t,"point","fontColor",!1),labelOutlineColor:r.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:r.bind(t,"point","labelOutlineWidth",!1),label:r.bind(t,"point","label",!0),angle:r.bind(t,"point","angle",!0)}}}).then(function(e){t.layer=e;return e});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"];return n};e.renderData=function(e,t){var n=this;n._search=n._search||{};var r=function(){n.search(n.textInput.value,function(e){if(1===e.length){n.textInput.value=e[0].label;n._goToResult(e[0].id,n.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));n.resultsList.classList.add(TC.Consts.classes.HIDDEN)}else 0===e.length&&n.resultsList.classList.add(TC.Consts.classes.HIDDEN)})};return TC.Control.prototype.renderData.call(n,e,function(){var e=function(){n.textInput.value=n.resultsList.label||n.resultsList.querySelector("li:not([header]) > a > span").textContent;n.lastPattern=n.textInput.value;n._goToResult(n.resultsList.id||unescape(n.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),n.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));n.resultsList.classList.add(TC.Consts.classes.HIDDEN)};n.textInput=n.div.querySelector("input.tc-ctl-search-txt");n.options&&n.options.placeHolder&&n.textInput.setAttribute("placeHolder",n.options.placeHolder.trim());n.resultsList=n.div.querySelector(".tc-ctl-search-list");n.$list=$(n.resultsList);n.button=n.div.querySelector(".tc-ctl-search-btn");n.button.addEventListener(TC.Consts.event.CLICK,function(){n.getLayer().then(function(t){n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?e():n.textInput.dispatchEvent(new Event("keyup")))})});if(n.options.instructions){n.textInput.setAttribute("title",n.options.instructions.trim());n.button.setAttribute("title",n.options.instructions.trim())}n.resultsList.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("a.tc-ctl-search-li-empty",function(){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.textInput.focus()}));try{if(n.textInput.classList.contains("::-ms-clear")){n.textInput.addEventListener("mouseup",function(e){""!==n.textInput.value&&setTimeout(function(){if(""===n.textInput.value){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}},1)})}}catch(e){}n.textInput.addEventListener("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();n.lastPattern="";1===n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?e():r();return!1}});n.textInput.addEventListener("search",function(){if(0===n.textInput.value.length){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}});n.textInput.addEventListener("input",function(){if(0===n.textInput.value.length){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}});n.textInput.addEventListener("targetCleared.autocomplete",function(){n.resultsList.classList.add(TC.Consts.classes.HIDDEN)});n.textInput.addEventListener("targetUpdated.autocomplete",function(){n.resultsList.querySelectorAll("li").length>0&&n.resultsList.classList.remove(TC.Consts.classes.HIDDEN)});n.lastPattern="";n.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){var e;TC.UI.autocomplete.call(n.textInput,{link:"#",target:n.resultsList,minLength:2,ctx:n,source:function(t,r){n.lastpress=performance.now();e||(e=requestAnimationFrame(function t(){var i=n.textInput.value.trim();if(i.length>0&&(!n.lastPattern||i!=n.lastPattern)&&performance.now()-n.lastpress>n.interval){window.cancelAnimationFrame(e);e=void 0;n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.lastPattern=i;n.search(i,r)}else e=requestAnimationFrame(t)}))},callback:function(e){var t=e.target;"a"!==e.target.tagName.toLowerCase()&&(t=function(e,t){const n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;for(;e;){if(n.call(e,t))return e;e=e.parentElement}return null}(e.target,"a"));if(t.querySelector("span[hidden]")){n.textInput.value=t.querySelector("span[hidden]").textContent;n.lastPattern=n.textInput.value;n._goToResult(unescape(t.getAttribute("href")).substring(1),t.parentNode.getAttribute("dataRole"));TC.UI.autocomplete.call(n.textInput,"clear")}},buildHTML:function(e){var t=[],r=[],i=/[^a-zA-Z]/g,s=/[^0-9]/g;function o(e,t){var n=parseInt(e,10),r=parseInt(t,10);if(isNaN(n)&&isNaN(r)){var o=e.replace(i,""),a=t.replace(i,"");if(o===a){var l=parseInt(e.replace(s,""),10),c=parseInt(t.replace(s,""),10);return l===c?0:l>c?1:-1}return o>a?1:-1}return isNaN(n)?1:isNaN(r)?-1:n>r?1:-1}var a=e.results.sort(function(e,t){return this.ctx.getSearchTypeByRole(e.dataRole).searchWeight&&this.ctx.getSearchTypeByRole(t.dataRole).searchWeight?(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:o(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:o(e.label,t.label)}.bind(this));n.rootCfg.active&&(a=a.sort(function(e,t){const n=function(){var n,r,i=this.rootCfg.active.root[0]instanceof Array?this.rootCfg.active.root[0].join("-"):this.rootCfg.active.root[0];if(e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0){n=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-");r=this.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-")}else{n=e.id;r=t.id}return n!==i&&r===i?1:n===i&&r!==i?-1:o(e.label,t.label)}.bind(this);return this.getSearchTypeByRole(e.dataRole).searchWeight&&this.getSearchTypeByRole(t.dataRole).searchWeight?(this.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:n():n()}.bind(n)));for(var l=0;l<a.length;l++){var c=a[l];if(-1==r.indexOf(c.dataRole)){var u=this.ctx.getSearchTypeByRole(c.dataRole);t[t.length]=u.getSuggestionListHead();r.push(c.dataRole)}const e=function(){c.label;var e=[];0===this.ctx.lastPattern.trim().length&&n.textInput.value.trim().length>0&&(this.ctx.lastPattern=n.textInput.value.trim());var t=this.ctx.lastPattern,r=[],i=",";-1==(t=n.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(n.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(n.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(i)&&(i=" ");r=t.trim().split(i);if(c.label.indexOf(this.ctx.LAT_LABEL)>-1&&c.label.indexOf(this.ctx.LON_LABEL)>-1||c.label.indexOf(this.ctx.UTMX_LABEL)>-1&&c.label.indexOf(this.ctx.UTMY_LABEL)>-1){r=this.ctx.lastPattern.split(" ");for(var s=0;s<r.length;s++)","==r[s].trim().slice(-1)&&(r[s]=r[s].slice(0,-1))}for(var o=0;o<r.length;o++)if(r[o].trim().length>0){e.push("("+r[o].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(u=/((\<)|(\>)|(\<\>))/gi.exec(r[o].trim()))for(var a=r[o].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),l=0;l<a.length;l++)a[l].trim().length>0&&e.push("("+a[l].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(c.dataRole==TC.Consts.searchType.ROAD||c.dataRole==TC.Consts.searchType.ROADPK){var u;if(u=n.getSearchTypeByRole(c.dataRole).getPattern().exec(this.ctx.lastPattern)){e=[];u[2]&&u[3]&&u[4]?e.push("("+u[2]+"-"+u[3]+"-"+u[4]+")"):u[2]&&u[3]?e.push("("+u[2]+"-"+u[3]+")"):u[3]&&u[4]?e.push("("+u[3]+"-"+u[4]+")"):(u[2]||u[3])&&e.push("("+(u[2]||u[3])+")");u[5]&&e.push("(?:"+n.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}else u&&u[5]&&(e=[]).push("(?:"+n.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}var h="("+e.join("|")+")";h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=h.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var p=new RegExp(h,"gi"),d=c.label;return c.dataRole!==TC.Consts.searchType.ROAD||c.dataRole!==TC.Consts.searchType.ROADPK?d.replace(p,function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"}):d.replace(p,"<b>$1</b>")}.bind(this);t[t.length]='<li dataRole="'+c.dataRole+'"><a href="#'+encodeURIComponent(c.id)+'"><span hidden>'+c.label+"</span>"+e()+"</a></li>"}return t.join("")}});const t=function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){n.textInput==document.activeElement&&n.resultsList.querySelector("li:not([header]) a")?n.resultsList.querySelector("li:not([header]) a").focus():n.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?n.textInput.focus():function(e,t){var n=e.nextElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){n.textInput==document.activeElement?n.resultsList.querySelector("li:not([header]):last-child a").focus():document.activeElement==n.resultsList.querySelector("li:not([header]) a")?n.resultsList.querySelector("li:not([header]):last-child a").focus():function(e,t){var n=e.previousElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()};n.textInput.addEventListener("keydown",t);n.resultsList.addEventListener("keydown",t)});$.isFunction(t)&&t()})};e.addAllowedSearchType=function(e,t){this.allowedSearchTypes.push(new SearchType(e,t,this))};e.getSearchTypeByRole=function(e){return this.allowedSearchTypes.filter(function(t){return t.typeName==e})[0]};e.getSearchTypeByFeature=function(e){var t=this.allowedSearchTypes.filter(function(t){return t.isFeatureOfThisType(e)});return t.length>0?t[0]:null};e.getElementOnSuggestionList=function(e,t){const n=this;for(var r=0;r<n._search.data.length;r++)if(n._search.data[r].id==e&&(!t||t&&n._search.data[r].dataRole===t))return n._search.data[r]};e.getLayer=function(){return this.layerPromise};e.getFeatures=function(){return this.layer.features};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){var n=t.features.slice();t.clearFeatures();e.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:t,feature:n});for(var r=0;r<e.WFS_TYPE_ATTRS.length;r++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[r])&&delete t[e.WFS_TYPE_ATTRS[r]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};e._municipalitiesPromise=new Promise(function(t,n){if(TC.cache.search.municipalities)t(TC.cache.search.municipalities);else{var r=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(r.municipality&&r.municipality.featureType&&r.municipality.labelProperty&&r.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+r.typeName+". Error en el objeto municipality");var i={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:r.municipality.featureType,VERSION:r.version,PROPERTYNAME:r.municipality.labelProperty+","+r.municipality.idProperty,OUTPUTFORMAT:r.outputFormat};r.featurePrefix&&(i.TYPENAME=r.featurePrefix+":"+i.TYPENAME);var s=r.url+"?"+$.param(i);TC.ajax({url:s,method:"GET",responseType:"text"}).then(function(e){var n=(r.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:r.municipality.featurePrefix,featureType:r.municipality.featureType})).read(e);TC.cache.search.municipalities=[];for(var i=0;i<n.length;i++){var s=n[i];TC.cache.search.municipalities.push({label:s.data[r.municipality.labelProperty],id:s.data[r.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0});t(TC.cache.search.municipalities)}).catch(function(){t()})}});return e._municipalitiesPromise};e.getCoordinates=function(e){const t=this;return new Promise(function(n,r){var i=e.match(new RegExp("^"+$.trim(t.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));i&&(e=i[1]+" "+i[2]);(i=e.match(new RegExp("^"+$.trim(t.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=i[1]+" "+i[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){if((i=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e))&&(i[1].indexOf(",")>-1||i[3].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[3]=i[3].replace(",",".");e=i[1]+" "+i[3]}if(!i||i&&(i[1].indexOf(",")>-1?i[1].replace(",","."):i[1])<=180&&(i[3].indexOf(",")>-1?i[3].replace(",","."):i[3])<=90){if((i=new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e))&&(i[1].indexOf(",")>-1||i[2].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[2]=i[2].replace(",",".");e=i[1]+" "+i[2]}e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var s=TC.Util.parseCoords(e);if(s){var o=s[0].value,a=s[1].value,l=s[0].type===TC.Consts.UTM?t.UTMX:t.LAT,c=s[1].type===TC.Consts.UTM?t.UTMY:t.LON,u=l+o+c+a,h=t.getPoint(u);if(h&&!t.insideLimit(h)){o=s[1].value;a=s[0].value;u=(l=s[1].type===TC.Consts.UTM?t.UTMX:t.LAT)+o+(c=s[0].type===TC.Consts.UTM?t.UTMY:t.LON)+a;h=t.getPoint(u)}if(h){t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(u)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo");n([{id:u,label:t.getLabel(u),dataRole:TC.Consts.searchType.COORDINATES}])}else n([])}else n([])}else n([])}else n([])})};e.getCadastralRef=function(e){const t=this;return new Promise(function(n,r){var i=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));i&&(e=i[1]+", "+i[2]+", "+i[3]);var s=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(s=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(s)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?t.getMunicipalities().then(function(e){var r=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(s);if(r){var i=new RegExp($.trim(r[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),o=[];const s=function(e,n,r,i){var s=[];s.push[t.MUN]=e;s.push[t.POL]=r;s.push[t.PAR]=i;return{id:t.MUN+e+t.POL+r+t.PAR+i,label:t.getLabel(t.MUN+n+t.POL+r+t.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL,properties:s}};if((o=$.grep(e,function(e){e=e.label||e.id||e;return i.test(e)||i.test(t.removePunctuation(e))})).length>0)for(var a=0;a<o.length;a++)o[a]=s(o[a].id,o[a].label,$.trim(r[2]),$.trim(r[3]));if(/^[0-9]*$/g.test(r[1])){if(r[1].trim()===t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var l=e.filter(function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];l&&n([s(l.id,l.label,$.trim(r[2]),$.trim(r[3]))])}o.push(s($.trim(r[1]),$.trim(r[1]),$.trim(r[2]),$.trim(r[3])))}n(o)}}):n([])})};e.stringPatternsValidators={tsp:function(e,r,i,s){var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(o&&o[1]&&o[2]){var a=function(){return t((o[3]||o[4]||o[5]||o[6]).trim())};if(/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim())){r.push({t:o[1].trim(),s:o[2].trim(),p:a()});r.push({t:o[2].trim(),s:o[1].trim(),p:a()})}else/^([^0-9]+)$/i.test(o[1].trim())?r.push({t:o[1].trim(),s:o[2].trim(),p:a()}):r.push({s:o[1].trim(),t:o[2].trim(),p:a()});n.call(this,r,i,s);return!0}return!1},spt:function(e,r,i,s){var o=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(o&&o[6]&&o[1]){var a=function(){return t((o[2]||o[3]||o[4]||o[5]).trim())};if(/^([^0-9]+)$/i.test(o[6].trim())&&/^([^0-9]+)$/i.test(o[1].trim())){r.push({t:o[6].trim(),s:o[1].trim(),p:a()});r.push({t:o[1].trim(),s:o[6].trim(),p:a()})}else/^([^0-9]+)$/i.test(o[6].trim())?r.push({t:o[6].trim(),s:o[1].trim(),p:a()}):r.push({s:o[6].trim(),t:o[1].trim(),p:a()});n.call(this,r,i,s);return!0}return!1},tnsp:function(e,r,i,s){var o=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(o&&o[1]&&o[2]){r.push({t:o[2].trim(),s:o[1].trim(),p:t((o[3]||o[4]||o[5]||o[6]).trim())});n.call(this,r,i,s);return!0}return!1},ts:function(e,t,r,i){var s=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!s&&/^[^0-9]*$/i.test(e.trim())){var o=e.split(",").reverse();s=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(o.join(","))}if(s&&s[1]&&s[2]){if(/^([^0-9]+)$/i.test(s[1].trim())&&/^([^0-9]+)$/i.test(s[2].trim())){t.push({t:s[1].trim(),s:s[2].trim()});t.push({s:s[1].trim(),t:s[2].trim()});n.call(this,t,r,i)}else{var a=function(e){for(var t=e.split(" ").reverse(),n=[],r=0;r<t.length;r++)if(1==t[r].length){n.push(t[r]);t[r]=""}return n.length>0?t.reverse().join(" ").trim()+self._LIKE_PATTERN+n.reverse().join(self._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(s[1].trim())?t.push({t:s[1].trim(),s:a(s[2].trim())}):t.push({s:a(s[1].trim()),t:s[2].trim()});n.call(this,t,r,i,!0)}return!0}return!1},st:function(e,r,i,s){var o=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!o){var a=e.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(o){for(var l={},c=(a=e.split(",").reverse(),0);c<a.length;c++)if(/^([^0-9\,]+)$/i.test(a[c].trim()))l.t=a[c].trim();else if(/(\s*\d+)/i.test(a[c].trim()))if(-1==a[c].trim().indexOf(" "))l.s=a[c].trim();else{for(var u=a[c].trim().split(" ").reverse(),h=function(e){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())){l.p=t(e.trim());return!0}return!1},p=0,d=u[p].trim();p<u.length&&!h(d);)++p<u.length&&(d+=u[p]);if(l.p){for(var f=u,y=0;y<f.length;y++){for(var m=!1,g=0;g<f[y].split("").length;g++)l.p.indexOf(f[y][g])>-1&&(m=!0);if(m){f[y];f[y]="";if(l.p==t(d))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(u.reverse().join(" ").trim())){for(var C=[],v=u.reverse(),T=0;T<v.length;T++)if(1==v[T].trim().length){C.push(v[T].trim());v[T]=""}l.s=C.length>0?v.reverse().join(" ").trim()+self._LIKE_PATTERN+C.reverse().join(self._LIKE_PATTERN):v.reverse().join(" ").trim()}r.push({t:l.t,s:l.s+" "+l.p})}else l.s=a[c].trim()}r.push(l);n.call(this,r,i,s);return!0}return!1},s_or_t:function(e,t,n,r){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(i&&i[1]){if(n){t.push({t:i[1].trim()});t.push({t:n,s:i[1].trim()})}else t.push({t:i[1].trim()});return!0}return!1},sp:function(e,n,r,i){var s=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(s&&s[1]&&s[2]){r?n.push({t:r,s:s[1].trim(),p:t(s[2].trim())}):n.push({t:s[1].trim(),s:s[2].trim()});return!0}return!1},snp:function(e,n,r,i){var s=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(s&&s[1]&&s[2]&&r){n.push({t:r,s:s[1].trim(),p:t(s[2].trim())});return!0}return!1}};const t=function(e){for(var t=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],n=[function(e){var t=[],n=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(n){for(var r=1;r<n.length;r++)n[r].trim().length>0&&t.push(n[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){var t=[],n=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(n){for(var r=1;r<n.length;r++)n[r].trim().length>0&&t.push(n[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return e}],r=0;r<n.length&&!t[r].call(self,e);)r++;return r<n.length?n[r].call(self,e):e},n=function(e,t,n,r){const i=this;if(t)for(var s=e.length;s--;)if(r)e.push($.extend({},e[s],{t:t}));else if(e[s].t){var o=i.rootCfg.active.rootLabel.filter(function(t){return t.label.indexOf(i.removePunctuation(e[s].t).toLowerCase())>-1}.bind(i));1==o.length?e[s].t=o[0].id:o.length>1?o.map(function(t){var n=$.extend({},e[s]);n.t=t.id;e.push(n)}):0==o.length&&n&&e.splice(s,1)}},r=function(e,t){const n=this,r=n.rootCfg.active&&n.rootCfg.active.root||"",i=n.rootCfg.active&&n.rootCfg.active.limit||!1;var s=[];","==(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1));if(function(){for(var e=[function(e){return e.length>=3},function(e){return!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)}],r=0;r<e.length;r++)if(!e[r].call(n,t))return!1;return!0}()){var o=[];if(0===(o=e.map(function(e){return n.getSearchTypeByRole(e)}).filter(function(e){return e.stringPatternToCheck}).map(function(e){return e.stringPatternToCheck})).length){o=[n.stringPatternsValidators.tsp,n.stringPatternsValidators.spt,n.stringPatternsValidators.tnsp,n.stringPatternsValidators.ts,n.stringPatternsValidators.st];o=r&&t.split(",").length<3?[n.stringPatternsValidators.sp,n.stringPatternsValidators.snp,n.stringPatternsValidators.s_or_t].concat(o):o.concat([n.stringPatternsValidators.sp,n.stringPatternsValidators.snp,n.stringPatternsValidators.s_or_t])}var a=0;try{for(;a<o.length&&!o[a].call(n,t,s,r,i);)a++}catch(e){TC.error("Error seg\xfan el patr\xf3n: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return s}return null},i=function(e,t,n,r){const i=this;if(r){var s=[];i._search.data=s;i.request||(i.request=[]);r.forEach(function(t,n){e.filter(function(e){var n=i.getSearchTypeByRole(e);return Object.keys(n.queryProperties).length===Object.keys(t).length}).map(function(e){var n=i.getSearchTypeByRole(e);i.request.push(function(e,t,n){this.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+this.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';this.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));return TC.ajax({url:e.url,method:"POST",responseType:"text",data:e.filter.getParams(n)}).then(t).catch(function(e){"abort"!==e.statusText&&alert("error")})}.call(i,n,function(e){s=s.concat(n.getSuggestionListElements(e))},t))})});Promise.all(i.request).then(function(){t(s)})}else t([])};e.getStringPattern=function(e,t){const n=this;return new Promise(function(s,o){t=function(e){e=this.removePunctuation(e);return(e=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(n,t);var a=/(.*)\((.*)\)/.exec(t);if(a&&a.length>2){var l=r.call(n,e,a[1]),c=r.call(n,e,a[1]+","+a[2]);c=(c||[]).concat(l||[]);i.call(n,e,s,o,c)}else{l=r.call(n,e,t);i.call(n,e,s,o,l)}})};e.getRoad=function(e){const t=this;return new Promise(function(n,r){if((e=e.trim()).length<2)n([]);else{var i=t.getSearchTypeByRole(TC.Consts.searchType.ROAD),s=i.getPattern().exec(e);if(s&&s[3]){var o=s[2]?s[2].trim()+"-"+s[3].trim():s[3].trim();s[4]&&s[4].length>0&&(o=o+"-"+s[4].trim());t.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:i.url+"?"+i.filter.getParams({t:o}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var n=i.outputProperties;if(!t.some(function(t){return t.text==e.properties[n[0]]})){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(t){return e.properties[t]})),s=i.outputProperties.map(function(t){return e.properties[t]}).join("-");t.push({id:i.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:r,text:s,dataLayer:e.id.split(".")[0],dataRole:i.typeName})}});n(t)}else n([])}).catch(function(e){n([])})}else n([])}})};e.getPK=function(e){var t=this;return new Promise(function(n,r){if((e=e.trim()).length<3)n([]);else{var i=t.getSearchTypeByRole(TC.Consts.searchType.ROADPK),s=i.getPattern().exec(e);if(s&&s[3]&&s[5]){var o=s[2]?s[2].trim()+"-"+s[3].trim():s[3].trim();s[4]&&s[4].length>0&&(o=o+"-"+s[4].trim());t.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:i.url+"?"+i.filter.getParams({t:o,s:s[5].trim()}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var n=i.outputProperties;if(!t.some(function(t){return t.label==e.properties[n[0]]})){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(t){return e.properties[t]}));t.push({id:i.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:r,text:r,dataLayer:e.id.split(".")[0],dataRole:i.typeName})}});n(t)}else n([])}).catch(function(e){n([])})}else n([])}})};e.search=function(e,t){var n=this,r=[];if(n.request){for(var i=0;i<n.request.length;i++)console.log("new criteria: search promise/s aborted");n.request=[]}if((e=$.trim(e)).length>0){e=e.toLowerCase();var s=[];n.allowedSearchTypes.forEach(function(t){t.parser?(i=t.parser,s.push(new Promise(function(t,s){i.call(n,e).then(function(e){r=r.concat(e);t(r)})}))):console.log("Falta implementaci\xf3n del m\xe9todo parser");var i});Promise.all(s).then(function(){r&&(n._search.data=r=r.sort(function(e,t){var n,r=/(\d+)/,i="";if(r.test(e.label)&&r.test(t.label)){n=e.label.match(r)[1];i=t.label.match(r)[1]}else{n=e.label;i=t.label}return n>i?1:n<i?-1:0}.bind(n)));t&&t(r);if(0===r.length){n.cleanMap();if(!n.layer||n.layer&&0===n.layer.features.length){n.resultsList.innerHTML='<li><a title="'+n.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+n.EMPTY_RESULTS_LABEL+"</a></li>";n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"))}}n.lastPattern=""})}else n.cleanMap()};e._goToResult=function(e,t){var n=this,r=null;return new Promise(function(i,s){n.loading||(n.loading=n.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var o;o=n.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){n.textInput.blur();n.map.trigger(TC.Consts.event.TOOLSCLOSE)}n.cleanMap();var a=!1,l=!0;n.allowedSearchTypes.forEach(function(i){if(l)if(n.availableSearchTypes[i.typeName]){var s=t||n.getElementOnSuggestionList.call(n,e).dataRole;if(s){var o=n.getSearchTypeByRole(s);if(n.availableSearchTypes[s]&&o&&o.goTo)null!==(r=o.goTo.call(n,e,s))&&(l=!1);else if(!n.availableSearchTypes[s]&&o&&o.goTo){a=!0;null!==(r=o.goTo.call(n,e,s))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(i.goTo){a=!0;null!==(r=i.goTo.call(n,e))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});n.loading.removeWait(o);if(r){n.getLayer().then(function(e){switch(!0){case r.params.type==TC.Consts.layerType.VECTOR:for(var t=0;t<n.WFS_TYPE_ATTRS.length;t++)e.hasOwnProperty(n.WFS_TYPE_ATTRS[t])&&delete e[n.WFS_TYPE_ATTRS[t]];break;case r.params.type==TC.Consts.layerType.WFS:for(t=0;t<n.WFS_TYPE_ATTRS.length;t++)e[n.WFS_TYPE_ATTRS[t]]=r.params[n.WFS_TYPE_ATTRS[t]];o=n.loading.addWait()}e.type=r.params.type;n.map.on(TC.Consts.event.FEATURESADD,function(e){e.layer===n.layer&&function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)e[t].showsPopup!=this.queryableFeatures&&(e[t].showsPopup=this.queryableFeatures)}.call(n,e.features)});e.refresh().then(function(){n.map.one(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer==e){n.map.one(TC.Consts.event.FEATURESADD,function(t){if(t.layer==e){if(!t.layer.features||0==t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);var i=t.layer.wrap.layer.getSource().getExtent(),s=t.layer.map.options.pointBoundsRadius;if(i[2]-i[0]==0){i[0]=i[0]-s;i[2]=i[2]+s}if(i[3]-i[1]==0){i[1]=i[1]-s;i[3]=i[3]+s}t.layer.map.setExtent(i);n.map.trigger(TC.Consts.event.ZOOMTO,{extent:i,layer:t.layer})}else if(t.layer.features&&t.layer.features.length>0){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.layer.map.zoomToFeatures(t.layer.features);n.map.trigger(TC.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features})}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){n.resultsList.inner=r.emptyResultHTML;n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));n.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}n.loading.removeWait(o)}});if(t.layer.features&&t.layer.features.length>0){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.layer.map.zoomToFeatures(n.layer.features);n.map.trigger(TC.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features});n.loading.removeWait(o)}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){n.resultsList.innerHTML=r.emptyResultHTML;n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));t.newData&&t.newData.features&&t.newData.features.length>0||n.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);n.loading.removeWait(o)}}})})});i(r)}else{s();a||n.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}})};e.goToResult=function(e,t){if(this.getSearchTypeByRole(t))return this._goToResult(e,t);if(this.availableSearchTypes[t]){this.addAllowedSearchType(t,this.availableSearchTypes[t],this);return this._goToResult(e,t)}alert("No se reconoce el tipo de b\xfasqueda: "+t)};e.goToCoordinates=function(e){var t={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){t.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};t.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(e){var t=this;wait=t.loading.addWait();var n,r,i=t.getPoint(e);if(i){n=t.getLabel(e);r=t.layer.addMarker(i,$.extend({},t.map.options.styles.point,{title:n,group:n}))}else{var s=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=t.LAT+s[2]+t.LON+s[1];if(i=t.getPoint(e)){n=t.getLabel(e);r=t.layer.addMarker(i,$.extend({},t.map.options.styles.point,{title:n,group:n}));t.textInput.value=n}}r.then(function(e){t.map.trigger(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]});t.map.zoomToFeatures([e]);t.loading.removeWait(wait)})}).call(this,e);return t}return null};e.goToCadastralRef=function(e){var t={},n=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(n.test(e)){var r=n.exec(e);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var i=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);t.params={type:TC.Consts.layerType.WFS,url:i.url,version:i.version,geometryName:i.geometryName,featurePrefix:i.featurePrefix,featureType:i.featureType,properties:new TC.filter.and(new TC.filter.equalTo(i.queryProperties.firstQueryWord,$.trim(r[1])),new TC.filter.equalTo(i.queryProperties.secondQueryWord,$.trim(r[2])),new TC.filter.equalTo(i.queryProperties.thirdQueryWord,$.trim(r[3]))),outputFormat:i.outputFormat,styles:i.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t}return null};e.goToRoad=function(e){var t={},n=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);t.params={type:TC.Consts.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToPK=function(e){var t={},n=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);t.params={type:TC.Consts.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToStringPattern=function(e,t){var n={},r=this.getSearchTypeByRole(t);n.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(e),outputFormat:r.outputFormat,styles:r.styles};return n};e.getPoint=function(e){var t,n=this.map.wrap.isGeo(),r=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(r&&3===r.length){t=[parseFloat(r[1]),parseFloat(r[2])];n&&(t=TC.Util.reproject(t,this.map.options.utmCrs,this.map.crs))}else{if((r=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!n)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}if((r=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!n)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}}return t};e.insideLimit=function(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)};e.getPattern=function(){return this.textInput.value};e.getLabel=function(e){var t=e,n=TC.Util.getMapLocale(this.map);if(e.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(i=(t=t.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(i[1],parseFloat(i[1]).toLocaleString(n))).replace(i[3],parseFloat(i[3]).toLocaleString(n)));var r=1.1.toLocaleString(n).substring(1,2);if(i=t.match(new RegExp("^"+$.trim(this.UTMX_LABEL)+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL)+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(i[1]))||(t=t.replace(i[1],i[1].replace(".",r)));Number.isInteger(parseFloat(i[2]))||(t=t.replace(i[2],i[2].replace(".",r)))}}else if(e.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(i=(t=t.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(i[1],parseFloat(i[1]).toLocaleString(n))).replace(i[3],parseFloat(i[3]).toLocaleString(n)))}else if(e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var i=e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));t=this.MUN_LABEL+i[2]+", "+this.POL_LABEL+i[4]+", "+this.PAR_LABEL+i[6]}return t};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),n={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},r=0,i=e.length;r<i;r++)t[r]=n[e.charAt(r)]||e.charAt(r);return t.join("")};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,searchText:e.textInput.value,layer:e.layer.exportState({exportStyles:!1})}:null};e.importState=function(e){const t=this;t.textInput.value=e.searchText;t.layer.importState(e.layer).then(function(){t.layer.features.forEach(function(e){e.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],n=this.split(e),r=0;r<n.length;r++)n[r].trim().length>0&&t.push(n[r].trim());return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(t)for(var n=0;n<t.length;n++)/[-;:.<>\{\}\[\]\/\s()]/g.test(t[n])&&(e=e.replace(t[n],t[n].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var n=0;n<this.length;n++)if(this[n][e]==t)return this[n]}});String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length);t-=e.length;var r=n.indexOf(e,t);return-1!==r&&r===t});TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.SelectContainer=TC.control.TabContainer;TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.MAILTO_MAX_LENGTH=256;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.FEATURE_PARAM="showfeature";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,function(){if(TC.Util.detectChrome()||TC.Util.detectIE()>=10||TC.Util.detectFirefox()>=41){t.div.querySelectorAll("button").forEach(function(e){e.classList.remove("hide")});t.div.querySelectorAll("input[type=text]").forEach(function(e){delete e.dataset.dataOriginalTitle})}TC.Util.detectMobile()||t.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const n=t.div.querySelectorAll("."+t.CLASS+"-url-box");t.div.querySelectorAll("span:not(.tc-beta)").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var t=this;t&&"LABEL"!==t.tagName;)t=t.parentElement;const r=t.querySelector("input[type=radio][name=format]").value;n.forEach(function(e){e.matches(".tc-"+r)?e.classList.remove(TC.Consts.classes.HIDDEN):e.classList.add(TC.Consts.classes.HIDDEN)})})});$.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");e.browser?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN);const n=this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert");e.qr?n.classList.remove(TC.Consts.classes.HIDDEN):n.classList.add(TC.Consts.classes.HIDDEN)};e.generateIframe=function(e){var t=e||this.generateLink();if(t)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+t+'"></iframe>'};e.loadParamFeature=function(){const e=this;var t=null,n=TC.Util.getParameterByName(e.FEATURE_PARAM);if(n){var r;try{r=JSON.parse(decodeURIComponent(escape(window.atob(n))))}catch(t){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}r&&e.map&&(r.geom?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then(function(t){e.paramFeatureLayer=t;t.importState({features:[r]}).then(function(){e.map.zoomToFeatures(t.features)})}):t=r)}return t};e.register=function(t){const n=this,r=TC.control.MapInfo.prototype.register.call(n,t);n.exportsState=!0;n.MOBILEFAV=n.getLocaleString("mobileBookmarks.instructions");n.NAVALERT=n.getLocaleString("bookmarks.instructions");var i=function(e){const t=e.parentElement.querySelector("input[type=text]");t.value=t.classList.contains("tc-url")?n.generateLink():n.generateIframe();t.select()};n.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){const t=n.generateLink();n.registerListeners();n.div.querySelector(".tc-url input[type=text]").value=t;n.div.querySelector(".tc-iframe input[type=text]").value=n.generateIframe(t)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(e){const t=e.target;i(t);document.execCommand("copy");t.textContent=n.getLocaleString("copied");setTimeout(function(){t.textContent=n.getLocaleString("copy");!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(e){i(e.target)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",function(e){e.preventDefault();var r=n.generateLink();if(r){const e=encodeURIComponent(r+"\n");e.length>n.MAILTO_MAX_LENGTH&&t.toast(n.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+e}}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(e){e.preventDefault();const t=n._dialogDiv.querySelector(".qrcode");t.innerHTML="";n._dialogDiv.querySelector("."+n.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?n.makeQRCode(t,256,256).then(function(e){e&&TC.Util.showModal(n._$dialogDiv.get(0).querySelector(n._classSelector+"-qr-dialog"))}):TC.Util.showModal(n._$dialogDiv.get(0).querySelector(n._classSelector+"-qr-dialog"))}));const s=function(e,t,r){if(t&&t.trim().length>0)e.location.href=r(t);else{TC.error(n.getLocaleString("urlTooLongForShortener"));e.close()}};n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(e){e.preventDefault();const t=window.open();n.shortenedLink().then(function(e){s(t,e,function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)})});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(e){e.preventDefault();const t=window.open();n.shortenedLink().then(function(e){s(t,e,function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&amp;url="+encodeURIComponent(e)})});return!1}));TC.Util.detectMobile()&&n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(e){e.preventDefault();n.shortenedLink().then(function(e){var t="whatsapp://send?text=";location.href=void 0!==e?t+encodeURIComponent(e):t+encodeURIComponent(n.generateLink())});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",function(t){t.preventDefault();var r=n.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,r,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(r,i);else{window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1}));return r};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Share.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w(' </h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url" title="').h("i18n",t,{},{$key:"shareLink"}).w('"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe" title="').h("i18n",t,{},{$key:"embedMap"}).w('"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p></div> </div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div> <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w('</p></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){this._sv=null;this._mapActiveControl=null;TC.Control.apply(this,arguments);this.options.googleMapsKey&&(e+="&key="+this.options.googleMapsKey);this.viewDiv=null;this._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var t=TC.control.StreetView.prototype;t.CLASS="tc-ctl-sv";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn" title="').h("i18n",t,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){dust.register(t.CLASS+"-view",e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",t,{},{$key:"closeStreetView"}).w('"></div>')}e.__dustBody=!0;return e}}const n=function(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1);this.map.div.querySelector("canvas").dispatchEvent(e)};var r=function(e){const t=e.viewDiv,r=["webkitTransitionEnd","msTransitionEnd","oTransitionEnd","transitionend"],i=function(){TC.Util.detectSafari()||r.forEach(function(e){t.removeEventListener(e,i)});n.call(e)};TC.Util.detectSafari()?setTimeout(function(){n.call(e)},500):r.forEach(function(e){t.addEventListener(e,i)});e.layer.clearFeatures();e.div.querySelector("."+e.CLASS+"-btn").classList.remove(TC.Consts.classes.CHECKED);e.div.querySelector("."+e.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);e.map.div.classList.remove(e.CLASS+"-active");e._startLonLat=null};t.register=function(e){const t=this;if(!t.viewDiv){t.viewDiv=TC.Util.getDiv(t.options.viewDiv);t.viewDiv.classList.add(t.CLASS+"-view");t.viewDiv.classList.add(TC.Consts.classes.HIDDEN);t.options.viewDiv||e.div.insertAdjacentElement("beforebegin",t.viewDiv)}const n=TC.Control.prototype.register.call(t,e);t.layer=null;for(var i=t.getUID(),s=0;s<e.workLayers.length;s++){var o=e.workLayers[s];if(o.type===TC.Consts.layerType.VECTOR&&o.id===i){t.layer=o;break}}t.layer||e.loaded(function(){e.addLayer({id:i,stealth:!0,type:TC.Consts.layerType.VECTOR}).then(function(e){t.layer=e})});t.renderPromise().then(function(){TC.loadJS(!window.Draggabilly,[TC.apiLocation+"lib/draggabilly/draggabilly.pkgd.min.js"],function(){const e=new Draggabilly(t.div.querySelector("."+t.CLASS+"-drag"),{containment:t.map.div});e.on("dragStart",function(e){!function(e){e.div.querySelector("."+e.CLASS+"-btn").classList.add(TC.Consts.classes.CHECKED);e.map.div.classList.add(e.CLASS+"-active")}(t)});e.on("dragEnd",function(n){!function(e){var t=!1;const n=e.div.querySelector("."+e.CLASS+"-btn"),i=e.div.querySelector("."+e.CLASS+"-drag");var s=n.getBoundingClientRect(),o=i.getBoundingClientRect();i.classList.add(TC.Consts.classes.HIDDEN);if(o.top<s.top||o.top>s.bottom||o.left<s.left||o.left>s.right){t=!0;for(var a=e.map.getExtent(),l=[a[2],a[3]],c=(new Array(16),0);c<16;c++)e.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=e.map.div.getBoundingClientRect(),h=(o.left*window.devicePixelRatio+o.right*window.devicePixelRatio)/2-u.left*window.devicePixelRatio,p=o.bottom*window.devicePixelRatio-u.top*window.devicePixelRatio,d=e.map.wrap.getCoordinateFromPixel([h,p]);e.callback(d)}else r(e)}(t);e.setPosition(0,0)})});const e=t.viewDiv;e.querySelector("."+t.CLASS+"-btn-close").addEventListener(TC.Consts.event.CLICK,function(n){const i=t.map.div,s=function(){i.classList.remove(TC.Consts.classes.COLLAPSED);const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1);i.dispatchEvent(e)},o=function(t){if("width"===t.propertyName||"height"===t.propertyName){e.removeEventListener("transitionend",o);s()}};e.removeEventListener("transitionend",o);e.addEventListener("transitionend",o);setTimeout(s,1e3);e.classList.add(TC.Consts.classes.HIDDEN);e.classList.remove(TC.Consts.classes.VISIBLE);t.div.querySelector("."+t.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);r(t);t._sv.setVisible(!1);n.stopPropagation();const a=document.body.querySelector("header");a&&(a.style.display="");t._previousActiveControl&&t._previousActiveControl.activate()})},function(e,t,n){TC.error("Error de renderizado StreetView")});return n};t.render=function(){const e=this;return e._set1stRenderPromise(new Promise(function(t,n){e.renderData(null,function(){if(dust.cache[e.CLASS+"-view"])dust.render(e.CLASS+"-view",null,function(n,r){setTimeout(function(){e.viewDiv.innerHTML=r;n&&TC.error(n);t(e)},300)});else{TC.error("No hay dust.cache para StreetView");t(e)}})}))};var i=0;t.callback=function(t){var s=this,o=function(e){if(s._sv){var t=e.getBounds();lonLat=TC.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],s.map.crs,"EPSG:4326");s._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},a=function(e){if(s._sv){var t=e.getBounds();s._startLonLat=[(t[0]+t[2])/2,(t[1]+t[3])/2]}},l=s.map.getLoadingIndicator();l&&(i=l.addWait(i));const c=s.map.div;var u=function(e,n){s.layer.clearFeatures();var r,i;if(e){var l=e.getPosition();r=TC.Util.reproject([l.lng(),l.lat()],"EPSG:4326",s.map.crs);i=e.getPov().heading}else{r=t;i=0}s.map.addMarker(r,{cssClass:"tc-marker-sv-"+(Math.round(16*i/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:s.layer,showsPopup:!1});Promise.all(s.map._markerPromises).then(function(){s.layer.wrap.setDraggable(!0,o,a)});if(n){var u=function(){s.map.setCenter(r)};c.classList.contains(TC.Consts.classes.COLLAPSED)?u():setTimeout(u,1200)}};TC.loadJS(!window.google||!google.maps,e,function(){if(window.google){u();const h=s.viewDiv;var e=TC.Util.reproject(t,s.map.crs,"EPSG:4326"),o=h.classList.contains(TC.Consts.classes.VISIBLE),a={position:new google.maps.LatLng(e[1],e[0]),pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(s._sv)s._sv.setOptions(a);else{s._sv=new google.maps.StreetViewPanorama(h,a);google.maps.event.addListener(s._sv,"position_changed",function(){u(s._sv,h.classList.contains(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(s._sv,"pov_changed",function(){if(s.layer.features&&s.layer.features.length>0){var e=s.layer.features[0];delete e.options.url;e.options.cssClass="tc-marker-sv-"+(Math.round(16*s._sv.getPov().heading/360)+16)%16;e.setStyle(e.options);s.layer.refresh()}});google.maps.event.addListener(s._sv,"status_changed",function(){var e=s._sv.getStatus();l&&l.removeWait(i);if(e===google.maps.StreetViewStatus.OK){c.classList.add(TC.Consts.classes.COLLAPSED);const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1);c.dispatchEvent(e);const t=function(){google.maps.event.trigger(s._sv,"resize");n.call(s)};const r=function(e){if(("width"===e.propertyName||"height"===e.propertyName)&&!o){o=!0;h.removeEventListener("transitionend",r);t()}};h.removeEventListener("transitionend",r);h.addEventListener("transitionend",r);setTimeout(t,1e3);if(!h.classList.contains(TC.Consts.classes.VISIBLE)){s._sv.setVisible(!0);u(s._sv,!0);if(s.map.activeControl){s._previousActiveControl=s.map.activeControl;s.map.activeControl.deactivate(!0)}setTimeout(function(){h.style.left="";h.style.top="";h.classList.remove(TC.Consts.classes.HIDDEN);h.classList.add(TC.Consts.classes.VISIBLE)},200);const e=document.body.querySelector("header");e&&(e.style.display="none")}}else{TC.alert(e===google.maps.StreetViewStatus.ZERO_RESULTS?s.getLocaleString("noStreetView"):s.getLocaleString("streetViewUnknownError"));if(s._startLonLat)s.callback(s._startLonLat);else{s.layer.wrap.setDraggable(!1);r(s)}}})}u(s._sv)}else r(s)},!1,!0)}}();TC.control=TC.control||{};!function(){TC.control.ThreeD=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ThreeD,TC.Control);var e=TC.control.ThreeD.prototype;e.CLASS="tc-ctl-threed";e.classes={BETA:"tc-beta-button",BTNACTIVE:"active"};e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",t,{},{$key:"threed.tip"}).w('"></button>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.VIEWCHANGE,function(e){e.view==TC.Consts.view.THREED&&t.activate()});return n};e.renderData=function(e,t){const n=this;return TC.Control.prototype.renderData.call(n,e,function(){n.button=n.div.querySelector("."+n.CLASS+"-btn");if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12){n.button.setAttribute("title",n.getLocaleString("threed.not.supported"));n.button.classList.remove(n.classes.BETA)}n.button.addEventListener(TC.Consts.event.CLICK,function(){if("disabled"!==n.button.getAttribute("disabled"))if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12)n.map.toast(n.getLocaleString("threed.not.supported"),{type:TC.Consts.msgType.ERROR});else if(n.map.on3DView){n.button.setAttribute("disabled","disabled");TC.view.ThreeD.unapply({callback:function(){n.button.setAttribute("title",n.getLocaleString("threed.tip"));n.button.classList.remove(n.classes.BTNACTIVE);n.button.removeAttribute("disabled")}})}else n.activate()});$.isFunction(t)&&t()})};e.activate=function(){var e=this;e.button.setAttribute("disabled","disabled");e.browserSupportWebGL.call(e);const t=function(){e.button.removeAttribute("disabled")};e.map.view3D?e.map.on3DView||TC.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:t}):TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:t})});!function(){e.button.setAttribute("title",e.getLocaleString("threed.two.tip"));e.button.classList.remove(e.classes.BETA);e.button.classList.add(e.classes.BTNACTIVE)}()};e.deactivate=function(){TC.Control.prototype.deactivate.call(this)};e.browserSupportWebGL=function(){var e=!1;if(window.WebGLRenderingContext){var t=document.createElement("canvas"),n={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var r=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)||t.getContext("webkit-3d",n)||t.getContext("moz-webgl",n);if(r)e=!0;else{n.failIfMajorPerformanceCaveat=!1;if(r=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)||t.getContext("webkit-3d",n)||t.getContext("moz-webgl",n)){e="slow";this.isSlower=!0}else e=!1}}catch(e){console.log(E)}if("slow"===e||!e){var i="slow"===e?"threed.slowSupport.supported":"threed.not.supported";this.map.toast(this.getLocaleString(i),{type:TC.Consts.msgType.WARNING,duration:1e4})}return e}e=!1}}();TC.control=TC.control||{};HTMLElement.prototype.appendHTML||(HTMLElement.prototype.appendHTML=function(e){var t=document.createElement("div");t.innerHTML=e;if(t.childNodes.length>1)for(var n=0;n<t.childNodes.length;n++)this.appendChild(t.childNodes[n]);t.childNodes.length>0&&this.appendChild(t.firstChild);return null});Document.prototype.createHTMLElement||(Document.prototype.createHTMLElement=function(e){var t=document.createElement("div");t.innerHTML=e;return t.childNodes.length>0?t.firstChild:null});HTMLElement.prototype.empty||(HTMLElement.prototype.empty=function(){for(;this.children.length;)this.removeChild(this.children[0])});"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},writable:!0,configurable:!0});TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.WFSQuery=function(e){TC.Control.apply(this,arguments);this.styles=this.options.styles;this.highLightStyles=this.options.highLightStyles};TC.inherit(TC.control.WFSQuery,TC.Control);!function(){var e=TC.control.WFSQuery.prototype,t=null,n=null,r=null,i=null,s=(TC.Consts.logicalOperator.AND,null),o=null,a=null,l={eq:TC.filter.equalTo,not:TC.filter.notEqualTo,gt:TC.filter.greaterThan,lt:TC.filter.lessThan,ge:TC.filter.greaterThanOrEqualTo,le:TC.filter.lessThanOrEqualTo,like:TC.filter.like,contains:TC.filter.like,start:TC.filter.like,end:TC.filter.like,bw:TC.filter.between},c=null,u=null,h=null,p=null,d=null,f=null,y=function(){return null},m=function(){return null},g=null;e.CLASS="tc-ctl-wfsquery";e.template={};if(TC.isDebug){e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/WFSQueryDialog.html";e.template[e.CLASS+"-form"]=TC.apiLocation+"TC/templates/WFSQueryForm.html";e.template[e.CLASS+"-filter"]=TC.apiLocation+"TC/templates/WFSQueryfilter.html"}else{e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-wfsquery-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window tc-ctl-wfsquery-modal-window" ><div class="tc-modal-header"><h3>').f(t.get(["layerName"],!1),t,"h").w('</h3><div title="').h("i18n",t,{},{$key:"query.tooltipCloseDialogBtn"}).w('" class="tc-modal-close"></div></div><div class="tc-modal-body">').h("gt",t,{block:n},{key:t.getPath(!1,["layers","length"]),value:1}).w('<div class="tc-modal-form"></div><div class="tc-ctl-wfsquery-message tc-hidden"></div> </div><div class="tc-modal-footer"><button type="button" title="').h("i18n",t,{},{$key:"query.tooltipSendQueryBtn"}).w('" class="tc-button tc-ctl-wlm-btn-launch">').h("i18n",t,{},{$key:"query.sendQueryBtnText"}).w('</button><button type="button" title="').h("i18n",t,{},{$key:"query.cancelQueryTooltip"}).w('" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"query.cancelQueryButton"}).w("</button></div></div></div>")}t.__dustBody=!0;function n(e,t){return e.w(' <div><select class="tc-combo" name="availableLayers"><option value="">').h("i18n",t,{},{$key:"query.chooseALayerCombo"}).w("</option>").s(t.get(["layers"],!1),t,{block:r},{}).w("</select></div> ")}n.__dustBody=!0;function r(e,t){return e.w('<option value="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}r.__dustBody=!0;return t};e.template[e.CLASS+"-form"]=function(){dust.register(e.CLASS+"-form",t);function t(e,t){return e.w("<div>").h("countif",t,{else:n,block:r},{key:t.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w('</div><div class="tc-ctl-wfsquery-operacion tc-hidden"><div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden"><input type="radio" id="cond_1" name="codicion" value="eq" /><label for="cond_1" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_2" name="codicion" value="not" /><label for="cond_2" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_3" name="codicion" value="gt" /><label for="cond_3" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_4" name="codicion" value="lt" /><label for="cond_4" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_5" name="codicion" value="ge" /><label for="cond_5" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_6" name="codicion" value="le" /><label for="cond_6" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden"><input type="radio" id="cond_8" name="codicion" value="eq" /><label for="cond_8" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_9" name="codicion" value="contains" /><label for="cond_9" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.containsBtn"}).w('</label><input type="radio" id="cond_10" name="codicion" value="start" /><label for="cond_10" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.startsByBtn"}).w('</label><input type="radio" id="cond_11" name="codicion" value="end" /><label for="cond_11" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.endsByBtn"}).w('</label></div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden"><input type="radio" id="cond_12" name="codicion" value="bw" /><label for="cond_12" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_13" name="codicion" value="nbw" /><label for="cond_13" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_14" name="codicion" value="gt" /><label for="cond_14" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_15" name="codicion" value="lt" /><label for="cond_15" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_16" name="codicion" value="ge" /><label for="cond_16" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_17" name="codicion" value="le" /><label for="cond_17" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery-where tc-hidden"><input type="search" placeholder="').h("i18n",t,{},{$key:"query.searchFieldPhd"}).w('" class="tc-textbox" /><button type="button" title="').h("i18n",t,{},{$key:"query.tooltipAddCondBtn"}).w('" class="tc-button">').h("i18n",t,{},{$key:"query.textAddCondBtn"}).w('</button><ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul><div class="tc-ctl-wfsquery-key"><label>').h("i18n",t,{},{$key:"query.logicalOpLbl"}).w('</label></div><div class="tc-ctl-wfsquery-value"><input type="radio" id="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" checked name="log_op" value="AND" /><label for="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",t,{},{$key:"query.logicalOpAndLbl"}).w('</label><input type="radio" id="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" name="log_op" value="OR" /><label for="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",t,{},{$key:"query.logicalOpOrLbl"}).w('</label></div><div class="tc-ctl-wfsquery-whereList"></div></div></div>')}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-wfsquery-message tc-msg-warning">').h("i18n",t,{},{$key:"query.noAttributes"}).w("</div>")}n.__dustBody=!0;function r(e,t){return e.w('<select class="tc-combo" id="attributes" name="attributes"><option value="">').h("i18n",t,{},{$key:"query.chooseAttrCombo"}).w("</option>").h("iterate",t,{block:i},{on:t.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w("</select>")}r.__dustBody=!0;function i(e,t){return e.w('<option value="').f(t.get(["key"],!1),t,"h").w('">').f(t.get(["key"],!1),t,"h").w("</option>")}i.__dustBody=!0;return t};e.template[e.CLASS+"-filter"]=function(){dust.register(e.CLASS+"-filter",t);function t(e,t){return e.s(t.get(["conditions"],!1),t,{block:n},{})}t.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-wfsquery-where-cond">').f(t.get(["field"],!1),t,"h").w("&nbsp;").f(t.get(["opText"],!1),t,"h").w("&nbsp;").x(t.get(["isString"],!1),t,{block:r},{}).f(t.get(["valueToShow"],!1),t,"h",["numberSeparator"]).x(t.get(["isString"],!1),t,{block:i},{}).w('</div><div class="tc-ctl-wfsquery-del-cond" title="').h("i18n",t,{},{$key:"query.tooltipRemoveCond"}).w('"></div>\t')}n.__dustBody=!0;function r(e,t){return e.w("&quot;")}r.__dustBody=!0;function i(e,t){return e.w("&quot;")}i.__dustBody=!0;return t}}var C=function(e){var t=document.createElement("input");t.setAttribute("type",e);return t.type==e},v=function(e){var n=e[0],r=e[1],i=e[2];h=i;d=i.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"];f=i.Operations.GetFeature.CountDefault?i.Operations.GetFeature.CountDefault.DefaultValue:null;var s=n.getDisgregatedLayerNames();if((s=s.filter(function(e){return i.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))})).length>1){t.classList.remove("tc-loading");r.getElementsByClassName("tc-combo")[0].addEventListener("change",function(){if(this.value){r.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",r).classList.add(TC.Consts.classes.HIDDEN);p=this.options[this.selectedIndex].text;t.classList.add("tc-loading");T(this.value,i).then(function(e){E(e,r)},function(){var e=r.getElementsByClassName("tc-modal-body")[0];e.classList.remove("tc-loading");e.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>");e.empty()})}else{var e=r.getElementsByClassName("tc-modal-form")[0];e.empty();for(var n=0;n<e.children.length;n++)e.removeChild(e.children[n]);A()}})}else{if(i.FeatureTypes[s[0].substring(s[0].indexOf(":")+1)]){p=i.FeatureTypes[s[0].substring(s[0].indexOf(":")+1)].Title;T(s[0],i).then(function(e){E(e,r)},function(){var e=r.getElementsByClassName("tc-modal-body")[0];e.classList.remove("tc-loading");e.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>");e.empty()})}else{var o=r.getElementsByClassName("tc-modal-body")[0];o.classList.remove("tc-loading");o.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>")}}},T=function(e,t){u=e;return new Promise(function(n,r){if(t.Operations.DescribeFeatureType){var i=t.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"]+"?REQUEST=DescribeFeatureType&TYPENAME="+e+"&OUTPUTFORMAT="+t.Operations.DescribeFeatureType.outputFormat;TC.ajax({url:i,method:"GET",responseType:"application/xml"}).then(function(t){var i=xml2json(t),s=i[e.substring(e.indexOf(":")+1)];if(s){var o=s.type;n(i[o.substring(o.indexOf(":")+1)].complexContent.extension.sequence)}else r()}).catch(function(e){TC.error(e)})}else TC.error("No est\xe1 habilitado DescribeFeatureType en este servicio",TC.Consts.msgErrorMode.TOAST)})},L=null,S=null,b=function(e){if(C("date"))e.type="date";else{e.type="search";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){L=new IMask(e,{mask:Date,pattern:a&&"es-ES"!==a?"eu-ES"===a?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(e){var t=e.getDate(),n=e.getMonth()+1,r=e.getFullYear();t<10&&(t="0"+t);n<10&&(n="0"+n);switch(a){case"eu-ES":return[r,n,t].join("/");case"en-US":return[n,t,r].join("/");case"es-ES":default:return[t,n,r].join("/")}},parse:function(e){switch(a){case"eu-ES":return new Date(e.split("/")[1]+"/"+e.split("/")[2]+"/"+e.split("/")[0]);case"en-US":return new Date(e);case"es-ES":default:return new Date(e.split("/")[1]+"/"+e.split("/")[0]+"/"+e.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})}},w=function(){if(L){var e=L.el.input;L.destroy();L=null;e.value="";e.type="search"}},E=function(n,r){A();_internalGetDataTypes=function(){return n};e.getRenderedHtml(e.CLASS+"-form",{attributes:n},function(i){var s=r.getElementsByClassName("tc-modal-form")[0];s.empty();s.appendHTML(i);t.classList.remove("tc-loading");TC.loadJS(!0,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){console.log("autocomplete loaded")});var o=null,c=s.getElementsByClassName("tc-combo");if(0==c.length)r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled");c[0].addEventListener("change",function(){var t=s.querySelector(".tc-ctl-wfsquery-where .tc-textbox");t.dataset.autocomplete&&TC.UI.autocomplete.call(t,"clear");if(n[this.value]){o=n[this.value].type;s.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.remove("tc-hidden");TC.UI.autocomplete.call(t,"clear");!function(){if(S){var e=S.el.input;S.destroy();S=null;e.value="";e.type="search"}}();t.type="search";switch(!0){case o.indexOf("int")>=0:case o.indexOf("float")>=0:case o.indexOf("double")>=0:case o.indexOf("long")>=0:case o.indexOf("decimal")>=0:s.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.remove("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===s.querySelectorAll("tc-ctl-wfsquery-numeric input:checked").length&&(s.querySelector(".tc-ctl-wfsquery-numeric :first-child").checked=!0);w();if(C("number"))if(TC.Util.detectIE()){t.type="text";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){S=new IMask(t,{mask:Number,scale:o.indexOf("int")>=0||o.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:a&&"en-US"===a?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:a&&"en-US"===a?".":","})})}else{t.type="number";o.indexOf("int")>=0||o.indexOf("long")>=0?t.step="1":t.step="0.0001"}break;case o.indexOf("dateTime")>=0:s.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.remove("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===s.querySelectorAll("tc-ctl-wfsquery-date input:checked").length&&(s.querySelector(".tc-ctl-wfsquery-date :first-child").checked=!0);b(t);break;case o.indexOf("string")>=0:s.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.remove("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===s.querySelectorAll("tc-ctl-wfsquery-text input:checked").length&&(s.querySelector(".tc-ctl-wfsquery-text :first-child").checked=!0);w();F(t,this.value,s.getElementsByClassName(e.CLASS+"-list tc-ctl-search-list")[0])}}else{s.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.add("tc-hidden");s.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.add("tc-hidden")}});s.querySelector(".tc-ctl-wfsquery-where  input[type='radio']").addEventListener("change",function(){"OR"===this.value?TC.Consts.logicalOperator.OR:TC.Consts.logicalOperator.AND;s.getElementsByClassName("tc-ctl-wfsquery-whereList-op")[0].innerHTML=this.nextElementSibling.innerHTML});s.querySelector(".tc-button").addEventListener("click",function(){var e=s.querySelector("input.tc-textbox");TC.UI.autocomplete.call(e,"clear");S&&S.masked.remove();if(x(s)){var t,n,r=s.querySelector(".tc-combo").value,i=s.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked'),c=i.value,u=i.nextElementSibling.innerText,h=(t=e,S?S.unmaskedValue:L?L.unmaskedValue.substring(4)+"-"+L.unmaskedValue.substring(2,4)+"-"+L.unmaskedValue.substring(0,2):t.value),p=function(e){if(S)return S.value;if(L)return L.value;if("date"===e.type)return new Date(e.value).toLocaleDateString(a);if("number"===e.type){var t=1.1.toLocaleString(a).substring(1,2);return e.value.replace(".",t)}return e.value}(e);s.querySelector('.tc-ctl-wfsquery-where  input[type="radio"]:checked').nextElementSibling.innerText;h=h.replace("<","&lt;").replace(">","&gt;");(n=o.indexOf("dateTime")>=0?"nbw"!==c?new l[c](r,h+"T00:00:00Z",h+"T23:59:59Z"):new TC.filter.not(TC.filter.between(r,h+"T00:00:00Z",h+"T23:59:59Z")):new l[c](r,("end"===c||"contains"===c?"*":"")+h+("start"===c||"contains"===c?"*":""))).matchCase=!1;whereObjList.push(n);switch(!0){case o.indexOf("int")>=0:p=parseInt(h,10);break;case o.indexOf("float")>=0:case o.indexOf("double")>=0:case o.indexOf("long")>=0:case o.indexOf("decimal")>=0:p=parseFloat(h,10)}whereFilterList.push({field:r,opText:u,isString:o.indexOf("string")>=0,valueToShow:p});O(s);e.value=""}})}})},O=function(t){dust.filters.numberSeparator||(dust.filters.numberSeparator=function(e){return e.toLocaleString(a)});t.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].empty();e.getRenderedHtml(e.CLASS+"-filter",{conditions:whereFilterList},function(e){t.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].innerHTML=e;for(var n=t.getElementsByClassName("tc-ctl-wfsquery-del-cond"),r=0;r<n.length;r++)n[r].addEventListener("click",function(){var e=Array.prototype.indexOf.call(n,this);whereObjList.splice(e,1);whereFilterList.splice(e,1);O(t)})})},A=function(){whereObjList=[];whereFilterList=[]},x=function(e){var t,n=e.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');if(L&&!L.masked.isComplete){!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&D("Fecha "+str+" inv\xe1lida",TC.Consts.msgType.ERROR);return!1}if(0==n.length){D(g("query.msgNoCondition"));return!1}if(e.querySelectorAll("input[type='date']").length&&!e.querySelector("input[type='date']").checkValidity()){D(g("query.msgNoValidDate"));return!1}if(e.querySelectorAll("input[type='number']").length&&null!=(t=e.querySelector("input[type='number']"))&&!t.checkValidity()){"1"===t.step?D(g("query.msgNoValidNumberMustInt")):D(g("query.msgNoValidNumber"));return!1}if(""===e.querySelector("input.tc-textbox").value.trim()){D(g("query.msgNoValueCondition"));return!1}return!0},P=function(){if(R()){n.getElementsByClassName("tc-modal-body")[0].classList.add("tc-loading");var e=function(){var e=N();I(p);if(i){i.setVisibility(!1);i.clearFeatures();c.off(TC.Consts.event.LAYERUPDATE,M);c.on(TC.Consts.event.LAYERUPDATE,M);i.url=d;i.featurePrefix=u.substring(0,u.indexOf(":"));i.featureType=u.substring(u.indexOf(":")+1);i.maxFeatures=f;i.properties=e;i.setVisibility(!0);i.refresh()}else{_({id:"WFSQueryResults",type:TC.Consts.layerType.WFS,url:d,version:"1.1.0",stealth:!0,geometryName:"the_geom",featurePrefix:u.substring(0,u.indexOf(":")),featureType:u.substring(u.indexOf(":")+1),maxFeatures:f,properties:e,outputFormat:TC.Consts.format.JSON,styles:y()});c.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===r){Modernizr.touch&&TC.Util.swipe(e.control.div,"enable");i.clearFeatures();i.setVisibility(!1);c.off(TC.Consts.event.LAYERUPDATE,M)}})}};f?j().then(e,function(e){n.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");if("NumMaxFeatures"===e.err)D(g("query.msgTooManyResults",{limit:e.limit}),TC.Consts.msgType.WARNING);else if("Empty"===e.err)D(g("query.msgNoResults"),TC.Consts.msgType.INFO);else{console.error(e.errorThrown);D(g("query.errorUndefined"),TC.Consts.msgType.ERROR)}}):e()}else D(g("query.msgNoQueryFilter"))},_=function(e){c.addLayer(e).then(function(e){i=e;e.map.on(TC.Consts.event.LAYERUPDATE,M)})},N=function(){if(whereObjList.length>1){var e=document.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;return TC.filter[TC.Consts.logicalOperator[e]].apply(null,whereObjList)}return 0===whereObjList.length?null:whereObjList[0]},M=function(e){if(e.layer==i){var t=e.layer.features;if(t.length>0){c.zoomToFeatures(t);k(t.length>1?t.reduce(function(e,t,n){return(e instanceof Array?e:[e.data]).concat([t.data])}):[t[0].data],i,p)}else{n.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");D("No hay resultados",TC.Consts.msgType.INFO);e.layer.map.off(TC.Consts.event.LAYERUPDATE,M)}}},I=function(e){var t=e;new Promise(function(e,t){TC.control.ResultsPanel?e(TC.control.ResultsPanel):TC.loadJS(!0,TC.apiLocation+"TC/control/ResultsPanel",function(){e(TC.control.ResultsPanel)})}).then(function(e){if(r){r.options.save.fileName=t+".xls";r.options.titles.max=r.getLocaleString("geo.trk.chart.exp")}else{var n=function(e){r=e;delete dust.cache[r.CLASS+"-table"];if(!TC.isDebug){r.template[r.CLASS+"-table"]=dust.register(r.CLASS+"-table",t);function t(e,t){return e.w('<table class="table"><thead>').s(t.get(["columns"],!1),t,{block:n},{}).w("</thead><tbody>").s(t.get(["results"],!1),t,{block:i},{}).w("</tbody></table>")}t.__dustBody=!0;function n(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}n.__dustBody=!0;function i(e,t){return e.w('<tr title="').h("i18n",t,{},{$key:"zoomToFeature"}).w('" data-id="').f(t.get(["Id"],!1),t,"h").w('" data-index="').f(t.get(["$idx"],!1),t,"h").w('" class="tc-selectable">').h("iterate",t,{block:s},{on:t.getPath(!0,[])}).w("</tr>")}i.__dustBody=!0;function s(e,t){return e.h("select",t,{block:o},{key:t.get(["key"],!1)})}s.__dustBody=!0;function o(e,t){return e.w('<td class="').f(t.get(["key"],!1),t,"h",["removeAccents","downcase"]).w('">').h("startsWith",t,{else:a,block:l},{key:t.get(["value"],!1),value:"http"}).w("</td>")}o.__dustBody=!0;function a(e,t){return e.f(t.get(["value"],!1),t,"h",["numberSeparator"])}a.__dustBody=!0;function l(e,t){return e.w('<a href="').f(t.get(["value"],!1),t,"h").w('" target="_blank" title="').h("i18n",t,{},{$key:"query.linkOpenAtNewTab"}).w('">').h("i18n",t,{},{$key:"query.linkText"}).w("</a>")}l.__dustBody=!0;return t}r.template[r.CLASS+"-table"]=TC.apiLocation+"TC/templates/WFSQueryResultsTable.html";r.options.titles.max=r.getLocaleString("geo.trk.chart.exp")},i=c.getControlsByClass(TC.control.ControlContainer);0==i.length?c.addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:t+".xls"}}).then(n):i[0].addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:t+".xls"},side:"right"}).then(n)}})},k=function(e,t,i){r.div.querySelector(".prpanel-title-text").innerText=r.getLocaleString(e.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.length,layerName:i});r.div.classList.add("tc-ctl-wfsquery-results");n.parentElement.removeChild(n);r.openTable({data:e,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},callback:function(n){r.maximize();console.log("render del panel de resultados");var i=n.getElementsByTagName("tr"),s=_internalGetDataTypes(),o=1;for(var a in e[0]){if(s.hasOwnProperty(a)&&(s[a].type.indexOf("int")>=0||s[a].type.indexOf("float")>=0||s[a].type.indexOf("double")>=0||s[a].type.indexOf("long")>=0||s[a].type.indexOf("decimal")>=0))for(var l=n.querySelectorAll("td:nth-child("+o+")"),c=0;c<l.length;c++)l[c].classList.add("tc-numeric");o++}for(a=0;a<i.length;a++){i[a].addEventListener("click",function(e){e.stopPropagation();var n=this.dataset.index;void 0!=n&&t.map.zoomToFeatures([t.features[n]])});i[a].addEventListener("mouseenter",function(){var e=this.dataset.index;if(void 0!=e){var n=t.features[e];n&&n.geometry&&U(n);for(var r=0;r<this.children.length;r++){var i=this.children[r];i.offsetWidth<i.scrollWidth&&(i.title=i.innerText)}}});i[a].addEventListener("mouseleave",function(){var e=this.dataset.index;if(void 0!=e){var n=t.features[e];n&&n.geometry&&G(n)}})}Modernizr.touch&&TC.Util.swipe(r.div,"disable");var u=document.getElementById("tools-panel")||document.body.querySelector(".tools-panel");u&&r.div.getElementsByClassName("prpanel-group")[0].colliding(u)&&u.classList.add("right-collapsed")}})},R=function(){return whereObjList.length>0},D=function(e,n){var r=t.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(s)clearTimeout(s);else{r.innerHTML=e;switch(n){case TC.Consts.msgType.INFO:r.classList.add("tc-msg-info");break;case TC.Consts.msgType.WARNING:r.classList.add("tc-msg-warning");break;case TC.Consts.msgType.ERROR:default:r.classList.add("tc-msg-error")}r.classList.remove(TC.Consts.classes.HIDDEN)}s=setTimeout(function(){s=null;r.classList.add(TC.Consts.classes.HIDDEN)},3e3)},F=function(e,t,n){TC.UI.autocomplete.call(e,{minLength:3,target:n,source:function(e,n){var r,i,s=this;s.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+g("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';s.target.classList.remove("tc-hidden");(r=t,i=e,new Promise(function(e,t){var n=Object.assign({},h);n.version="1.1.0";switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"start":i+="*";break;case"contains":case"eq":i="*"+i+"*";break;case"end":i="*"+i}o&&(o=null);(o=TC.ajax({url:d+"?"+Date.now(),data:TC.Util.WFSQueryBuilder([u],TC.filter.like(r,i,void 0,void 0,void 0,!1),n,"JSON",!1),contentType:"application/xml",responseType:"application/json",method:"POST"})).then(function(n){if(n.features&&n.features.length>0){var i;1===n.features.length&&(i=[n.features[0].properties[r]]);n.features.length>1&&(i=n.features.reduce(function(e,t){return e&&e instanceof Array?e.indexOf(t.properties[r])<0?e.concat(t.properties[r]):e:e.properties[r]===t.properties[r]?[e.properties[r]]:[e.properties[r],t.properties[r]]}));e(i)}else t(null)})})).then(n).catch(function(){s.target.classList.add("tc-hidden")})},callback:function(t){e.value=t.currentTarget.dataset.value;this.target.classList.add("tc-hidden")},buildHTML:function(t){var n=e.value;this.target.style.maxHeight="";return t.results.length>1?t.results.reduce(function(e,t,r){return(r>1?e:B(e,n))+B(t,n)}):B(t.results[0],n)}});e.addEventListener("targetCleared.autocomplete",function(){n.classList.add("tc-hidden")});e.addEventListener("keypress",function(t){13==t.which&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("search",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("input",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")})},B=function(e,t){t=new RegExp(t,"gi");return'<li><a href="#" data-value="'+e+'">'+e.replace(t,"<b>$&</b>")+"</a></li>"},j=function(){return new Promise(function(e,t){var n=N(),r=Object.assign({},h);r.version="1.1.0";TC.ajax({url:d,data:TC.Util.WFSQueryBuilder([u],n,r,null,!0),contentType:"application/xml",method:"POST"}).then(function(){var n=xml2json((new DOMParser).parseFromString(arguments[0],"application/xml"));if(n.Exception)t({err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText});else{var r=parseInt(n.numberMatched||n.numberOfFeatures,10);isNaN(r)||r>=parseInt(f,10)?t({err:"NumMaxFeatures",limit:f}):isNaN(r)||0!==r?e():t({err:"Empty"})}},function(e,n,r){t({err:n,errorThrown:r})})})},U=function(e){var t=function(e,t){var n;t instanceof TC.feature.Point?n=e.addPoint(t.getCoords()):t instanceof TC.feature.Polyline?n=e.addPolyline(t.getCoords()):t instanceof TC.feature.Polygon?n=e.addPolygon(t.getCoords()):t instanceof TC.feature.MultiPolygon?n=e.addMultiPolygon(t.getCoords()):t instanceof TC.feature.MultiPolyline&&(n=e.addMultiPolyline(t.getCoords()));return n};if(e.layer){var n=e.layer.map.getLayer("WFSQueryResultsHighlight");n?t(n,e):e.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:TC.Consts.layerType.VECTOR,stealth:!0,styles:m()},function(n){t(n,e)})}},G=function(e){var t=e.layer.map.getLayer("WFSQueryResultsHighlight");t&&t.clearFeatures()};e.render=function(e){return TC.Control.prototype.render.call(this,e)};e.register=function(e){const t=this;c=e;return new Promise(function(e){dust.helpers.countif=function(e,t,n,r){r=r||{};var i=n.block,s=n.else,o=r.key||t.current(),a=null!=r.excludedKeys?r.excludedKeys.split(","):null,l=0;for(var c in o)(null==a||a.indexOf(c)<0)&&l++;l>0?e=e.render(i,t):s&&(e=e.render(s,t));return e};TC.Control.prototype.register.call(t,c).then(function(){y=function(){var e=$.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#ffffff",fillOpacity:0,strokeColor:"#ff0000",strokeWidth:2},polyline:{strokeColor:"#ff0000",strokeWidth:2},point:{strokeColor:"#ff0000"}});return t.styles?Object.assign(e,t.styles):e};m=function(){var e=$.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#0099FF",fillOpacity:0,strokeColor:"#0099FF",strokeWidth:4},polyline:{strokeColor:"#0099FF",strokeWidth:4},point:{strokeColor:"#0099FF"}});return t.highLightStyles?Object.assign(e,t.highLightStyles):e};a=c.options.locale;g=function(e,t){return TC.Util.getLocaleString(a,e,t)};e()})})};e.renderModalDialog=function(r){var i=r.getPath(),s=new Promise(function(s,o){r.getWFSCapabilitiesPromise().then(function(o){!function(r,i,s,o){var a=[];r.getDisgregatedLayerNames().forEach(function(e,t){var n=r.getPath(e);s.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))&&a.push({name:e,title:n[n.length-1]})});a.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0});e.getRenderedHtml(e.CLASS+"-dialog",{layerName:g("query.titleDialog",{layerName:i}),layers:a},function(e){var r=document.createHTMLElement(e);document.body.appendChild(r);(t=r.getElementsByClassName("tc-modal-body")[0]).classList.add("tc-loading");TC.Util.showModal(r,{closeCallback:function(){r.parentElement.removeChild(r)}});if(TC.Util.detectIE()){var i=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:i=.8;case document.body.clientWidth>1140:i=.7}t.style.maxHeight=document.body.clientHeight*i-t.nextElementSibling.clientHeight-t.previousElementSibling.clientHeight}n=r;r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",function(){P()});o&&o(r)})}(r,i[i.length-1],o,function(e){s(e)})})});Promise.all([r,s,r.getWFSCapabilitiesPromise()]).then(v)}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var e={};const t=!TC.isLegacy&&window.hasOwnProperty("Worker"),n=new Promise(function(e,n){if(t){var r=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?e(r):TC.ajax({url:r,method:"GET",responseType:"text"}).then(function(t){var n=new Blob([t],{type:"text/javascript"}),r=window.URL.createObjectURL(n);e(r)},function(e){n(Error(e))})}}),r=function(e,t){const n="No se pudo obtener el documento de capacidades del servicio "+e.url+": ["+t+"]";TC.error(n);e.map&&e.map.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"});e.wrap.setLayer(null);return n},i=function(e){const i=e.url;return new Promise(function(o,a){var l;const c={};if(e.type===TC.Consts.layerType.WMTS)if(e.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var u="/1.0.0/WMTSCapabilities.xml";const e=i.indexOf(u);if(e<0||e<i.length-u.length){"/"===i[i.length-1]&&(u=u.substr(1));l=i+u}else l=i}else{l=i;c.SERVICE="WMTS";c.VERSION="1.0.0";c.REQUEST="GetCapabilities"}else{l=i;c.SERVICE="WMS";c.VERSION="1.3.0";c.REQUEST="GetCapabilities"}l=l+"?"+$.param($.extend(c,e.queryParams));e.toolProxification.fetch(l,{retryAttempts:2}).then(function(i){(function(e,r){var i;if(r.documentElement){const t=r.getElementsByTagName("ServiceException")[0];if(t)i={error:t.textContent};else{var o=e.type===TC.Consts.layerType.WMTS?new e.wrap.WmtsParser:new e.wrap.WmsParser;i=o.read(r);if(e.type===TC.Consts.layerType.WMTS&&i.Contents&&i.Contents.Layer){const e=r.getElementsByTagName("Layer");for(var a=0,l=e.length;a<l;a++){const t=e[a];var c=TC.Util.getElementByNodeName(t,"ows:Identifier")[0].firstChild.data,u=i.Contents.Layer.filter(function(e){return e.Identifier==c});if(u.length){u=u[0];for(var h=0;h<u.TileMatrixSetLink.length;h++){var p=u.TileMatrixSetLink[h];matrixId=p.TileMatrixSet;xmlLink=t.getElementsByTagName("TileMatrixSetLink").each(function(e,t){return $(t).find("TileMatrixSet:first").text()==matrixId});if(xmlLink.length){xmlLink=xmlLink[0];p.TileMatrixSetLimits=[];const e=xmlLink.getElementsByTagName("TileMatrixLimits");for(var d=0,f=e.length;d<f;d++){const t=e[d];p.TileMatrixSetLimits.push({TileMatrix:t.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(t.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(t.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(t.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(t.getElementsByTagName("MaxTileCol")[0].textContent)})}}}}}}}s(e,i);return Promise.resolve(i)}return new Promise(function(o,a){t&&"string"==typeof r?n.then(function(t){var n=new Worker(t);n.onmessage=function(t){if("success"===t.data.state){i=t.data.capabilities;s(e,i)}else a((i={error:"Web worker error"}).error);o(i);n.terminate()};n.postMessage({type:e.type,text:r})}):o(i=r)})})(e,i.responseText).then(function(t){t.error?a(Error(r(e,t.error))):o(t)}).catch(function(e){a(Error(e))})}).catch(function(t){a(Error(r(e,t)))})})},s=function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var n=e.CAPABILITIES_STORE_KEY_PREFIX+e.options.url,r=function(){t.hasOwnProperty("error")||e.getCapabilitiesPromise().then(function(){localforage.setItem(n,t).then(function(){}).catch(function(e){console.log(e)})})};e.map?e.map.loaded(r):r()})},o=function e(t,n){var r=$.inArray(n.name,t.availableNames);if(-1===r)for(var i=0,s=n.children.length;i<s&&-1===(r=e(t,n.children[i]));i++);return r},a=function e(t,n,r){var i=!1;r.count=r.count+1;if(t.name===n)i=!0;else for(var s=t.children.length-1;s>=0;s--)if(e(t.children[s],n,r)){i=!0;break}return i};TC.layer.Raster=function(){var t=this;TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");this.toolProxification=new TC.tool.Proxification(TC.proxify);this._capabilitiesPromise=null;TC.Layer.apply(t,arguments);t.wrap=new TC.wrap.layer.Raster(t);t.transparent=!1!==t.options.transparent;t.url=t.options.url;t.capabilities=TC.capabilities[t.url];t.params=t.options.params;if("string"==typeof t.options.layerNames)t.names=t.availableNames=t.options.layerNames.split(",");else{t.names=[];t.availableNames=[];if($.isArray(t.options.layerNames))for(var n=0;n<t.options.layerNames.length;n++){if("string"==typeof(l=t.options.layerNames[n])){t.names.push(l);t.availableNames.push(l)}else if(l.hasOwnProperty("name")){t.availableNames.push(l.name);(void 0===l.isVisible||l.isVisible)&&t.names.push(l.name)}}else{var r=t.options.params?t.options.params.sld_body:null;if(r){var s=$.parseXML(r),o=TC.Util.getElementByNodeName(s,"sld:NamedLayer");if(o&&o.length>0){var a=TC.Util.getElementByNodeName(o[0],"sld:Name");if(a&&a.length>0){var l=a[0].textContent;t.names.push(l);t.availableNames.push(l)}}}}}t.ignorePrefixes=void 0===t.options.ignorePrefixes||t.options.ignorePrefixes;t._capabilitiesNodes={};t.wrap._promise=new Promise(function(n,r){var s=function(){var e,r;if(!t.wrap.layer){switch(t.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:e=(r=t).wrap.createWMTSLayer(r.options);break;default:e=function(e){var t=$.isArray(e.names)?e.names.join(","):e.names,n=e.options.format,r=e.options,i={LAYERS:t,FORMAT:n,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&$.extend(i,e.params);e.queryParams&&$.extend(i,e.queryParams);var s=e.getPreferredInfoFormat();null!==s&&(i.INFO_FORMAT=s);return e.wrap.createWMSLayer(e.getGetMapUrl(),i,r)}(t)}t.wrap.setLayer(e);n(e)}};const o=function(e){t.capabilities=t.capabilities||e;var n=t.getGetMapUrl();TC.capabilities[t.options.url]=TC.capabilities[t.options.url]||e;TC.capabilities[n]=TC.capabilities[n]||e;s()};if(t.capabilities){o(t.capabilities);t._capabilitiesPromise=Promise.resolve(t.capabilities);return}const a=e[t.url];e[t.url]=t._capabilitiesPromise=a||new Promise(function(e,n){var r=!1,s=!1;const o=i(t),a=(l=t,new Promise(function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(l.CAPABILITIES_STORE_KEY_PREFIX+l.url).then(function(n){n?e(n):t("Capabilities not in storage")}).catch(function(){t("Undefined storage error")})})}));var l;o.then(function(t){e(t)}).catch(function(e){r=!0;s&&n(Error(e))});a.then(function(t){e(t)}).catch(function(e){s=!0;r&&n(Error(e))})});t.getCapabilitiesPromise().then(function(e){o(e)}).catch(function(e){r(Error(e))})});t._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==t.type&&t.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);var l=TC.layer.Raster.prototype;l.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i;l.capabilitiesState_={PENDING:0,DONE:1};l.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";l.getByProxy_=function(e){return TC.proxify(e)};l.getBySSL_=function(e){return e.replace(this.PROTOCOL_REGEX,"https://")};l.getByUrl_=function(e){return e};l.setVisibility=function(e){this.tree=null;this._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(this,e)};var c=function e(t,n,r){var i=!1,s=t.wrap.getLayerNodes(r);if(s.length){for(var o=0,a=s.length;o<a;o++)e(t,n,s[o])&&(i=!0);var l,c,u=$.map(s,function(e){return t.wrap.getName(e)}).reverse(),h=!1;c=l=$.inArray(u[0],n);if(l<0)h=!0;else for(o=1,a=u.length;o<a;o++)if(u[o]!=n[++l]){h=!0;break}if(!h){var p=t.wrap.getName(r);if(p&&u.length>1){n.splice(c,u.length,p);i=!0}}}return i},u=function(e,t){for(var n=[],r=t.slice(),i=e.wrap.getRootLayerNode(),s=0,o=r.length;s<o;s++)n=n.concat(h(e,r[s],i));return n},h=function e(t,n,r,i){for(var s=[],o=t.wrap.getName(r),a=t.compareNames(n,o),l=!1,c=t.wrap.getLayerNodes(r),u=0;u<c.length;u++){var h=e(t,n,c[u],i||a);h.length?s=s.concat(h):l=!0}c.length&&!l||(i||a)&&(s=[o]);return s},p=function(e){return $.extend({aggregate:!0,lazy:!1},e)},d=function(e,t,n){var r,i,s=[];r=t||[];i=n||[];for(var o=(e||[]).concat(r),a=0;a<o.length;a++)$.inArray(o[a],o)===a&&-1===$.inArray(o[a],i)&&(s[s.length]=o[a]);return s},f=function(e,t){var n="string"==typeof t?t.split(","):t;if(e.capabilities){var r=e.getTree();n.sort(function(e,t){var n={count:0},i={count:0};a(r,e,n);a(r,t,i);return n.count-i.count})}return n},y=function(e,t,n,r){return $.grep(n,function(n){return e.compareNames(t,n,r)}).length>0};l.getLimitedMatrixSet=function(){return function(e){var t=e.layerNames,n=e.matrixSet,r=e.capabilities,i=[],s=r.Contents.TileMatrixSet.filter(function(e){return e.Identifier==n});if(s.length){s=s[0];var o=r.Contents.Layer.filter(function(e){return e.Identifier==t})[0];if(o.TileMatrixSetLink&&o.TileMatrixSetLink.length&&o.TileMatrixSetLink[0].TileMatrixSetLimits){for(var a,l=o.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){a=l[c];var u=s.TileMatrix.filter(function(e){return e.Identifier==a.TileMatrix});if(u.length){var h=$.extend({matrixIndex:s.TileMatrix.indexOf(u[0])},u[0],a);i.push(h)}}return i}return s.TileMatrix}return null}(this)};l.setLayerNames=function(e,t){var n=this;return new Promise(function(r,i){n.wrap.getLayer().then(function(){var i=$.isArray(e)?e:e.split(",");n.names=i;var s=p(t);s.aggregate&&(i=function(e,t){if(e.type!==TC.Consts.layerType.WMS)return t;var n=t.slice();c(e,n,e.wrap.getRootLayerNode());return n}(n,i));n._disgregatedLayerNames=null;var o={LAYERS:i.join(","),TRANSPARENT:!0};i.length||n.setVisibility(!1);if(s.lazy){var a=n._newParams||n.wrap.getParams();n._newParams=$.extend(a,o)}else{n.map&&n.map.trigger(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:n});n.tree=null;n._cache.visibilityStates={};n.wrap.setParams(o);!s.reset&&n.map||(n.availableNames=n.names);n.map&&n.map.trigger(TC.Consts.event.UPDATEPARAMS,{layer:n})}r(n.names)})})};l.addLayerNames=function(e,t){const n=this;return new Promise(function(r,i){n.wrap.getLayer().then(function(){var i=p(t),s=$.isArray(e)?e:e.split(","),o=n.wrap.getParams().LAYERS;if(i.aggregate){s=u(n,s);o=n.getDisgregatedLayerNames()}n.setLayerNames(f(n,d(o,s,null)),t).then(function(e){r(e)})})})};l.removeLayerNames=function(e,t){const n=this;return new Promise(function(r,i){n.wrap.getLayer().then(function(){var i=p(t),s=$.isArray(e)?e:e.split(","),o=n.wrap.getParams().LAYERS;if(i.aggregate){s=u(n,s);o=n.getDisgregatedLayerNames()}n.setLayerNames(f(n,d(o,null,s)),t).then(function(e){r(e)})})})};l.toggleLayerNames=function(e,t){const n=this;return new Promise(function(r,i){n.wrap.getLayer().then(function(){var i=p(t),s=$.isArray(e)?e:e.split(","),o=n.wrap.getParams().LAYERS;if(i.aggregate){s=u(n,s);o=n.getDisgregatedLayerNames()}for(var a=[],l=[],c=0;c<s.length;c++){var h=s[c];$.inArray(h,o)<0?a[a.length]=h:l[l.length]=h}var d=[];a.length>0&&d.push(n.addLayerNames(a,i));l.length>0&&d.push(n.removeLayerNames(l,i));Promise.all(d).then(function(e){const t=e[0],n=e[1];r(t?n?t.concat(n):t:[])})})})};l.getDisgregatedLayerNames=function(){var e=this.wrap.layer;if(this.wrap.isNative(e)&&this.type===TC.Consts.layerType.WMS){if(!this._disgregatedLayerNames){var t=this.wrap.getParams().LAYERS;t=$.isArray(t)?t:t.split(",");this._disgregatedLayerNames=u(this,t)}}else this._disgregatedLayerNames=this.names;return this._disgregatedLayerNames.slice()};l.isValidFromNames=function(){for(var e=!0,t=0,n=this.names.length;t<n;t++)if(!this.getLayerNodeByName(this.names[t])){e=!1;break}return e};l.isCompatible=function(e){var t=!1;switch(this.type){case TC.Consts.layerType.WMTS:t=this.wrap.isCompatible(e)||this.wrap.getCompatibleMatrixSets(e).length>0;break;case TC.Consts.layerType.WMS:t=this.wrap.isCompatible(e)}return t};l.getCompatibleCRS=function(e){const t=this;e=e||{};var n=t.wrap.getCompatibleCRS();if(e.includeFallback&&t.fallbackLayer){const e=t.getFallbackLayer();e instanceof TC.Layer&&(n=n.concat(e.wrap.getCompatibleCRS()))}e.normalized&&(n=n.map(function(e){return TC.Util.getCRSCode(e)}).filter(function(e){return null!==e}).reduce(function(e,t){e.indexOf(t)<0&&(e[e.length]=t);return e},[]).map(function(e){return"EPSG:"+e}));return n};l.getProjection=function(){switch(this.type){case TC.Consts.layerType.WMTS:return this.wrap.layer.getSource().getProjection().getCode();case TC.Consts.layerType.WMS:return this.map.crs}};l.setProjection=function(e){if((e=e||{}).crs)switch(this.type){case TC.Consts.layerType.WMTS:var t=this.wrap.getCompatibleMatrixSets(e.crs)[0];if(t){this.matrixSet=t;this.wrap.setMatrixSet(t)}else this.wrap.setProjection(e);this.mustReproject=!t;break;case TC.Consts.layerType.WMS:this.wrap.setProjection(e);this.mustReproject=!this.isCompatible(e.crs)}};l.isVisibleByScale=function(e,t){var n,r,i,s=this,o=function(){return s.map.wrap.getResolution()*s.map.getMetersPerUnit()/28e-5};switch(s.type){case TC.Consts.layerType.WMTS:n=!1;var a=s.wrap.getTileMatrix(s.options.matrixSet);if(a){r=o();for(i=0;i<a.length;i++){if((h=s.wrap.getScaleDenominators(a[i]))[0]===r){n=!0;break}}}break;case TC.Consts.layerType.WMS:n=!0;var l=s.wrap.getAllLayerNodes();if(l.length>0){r=o();var c;if("number"==typeof e)c=s._capabilitiesNodes[e];else for(i=0;i<l.length;i++){var u=l[i];if(s.compareNames(s.wrap.getName(u),e,t)){c=u;break}}if(c){var h=s.wrap.getScaleDenominators(c);if(!(n=!(parseFloat(h[1])>r||parseFloat(h[0])<r))&&c.Layer&&c.Layer.length>0)return c.Layer.some(function(e){var t=s.wrap.getScaleDenominators(e);return!(parseFloat(t[1])>r||parseFloat(t[0])<r)})}}break;default:n=!0}return n};l.isVisibleByName=function(e,t){var n=this,r=!1;switch(n.type){case TC.Consts.layerType.WMTS:if(n.wrap.getWMTSLayer()){r=!0;break}break;case TC.Consts.layerType.WMS:var i=function e(r,i){var s=null,o=n.wrap.getName(i);if(n.compareNames(o,r,t))s=[o];else for(var a=n.wrap.getLayerNodes(i),l=0;l<a.length;l++){var c=e(r,a[l]);if(c){TC.Util.fastUnshift(c,o);s=c;break}}return s},s=function(e){return i(e,n.wrap.getRootLayerNode())}(e);if(s)for(var o=0;o<s.length;o++)if(y(n,s[o],n.names)){r=!0;break}break;default:r=!0}return r};l.getTree=function(){var e=this,t=e.tree;if(!t){var n,r=function t(r,i,s){var o;for(var a in e._capabilitiesNodes)if(e._capabilitiesNodes[a]===r){o=a;break}if(!o){o=TC.getUID();e._capabilitiesNodes[o]=r}var l,c,u={name:e.wrap.getName(r),title:r.title||r.Title,uid:o,children:[]};s&&(n=u);y(e,u.name,e.availableNames)&&(i=!0);if(e.options.isBase){u.name=e.names.join(",");u.title=e.title||u.title;u.isBase=e.isDefault;e.options.thumbnail&&(u.legend={src:e.options.thumbnail})}else{u.isVisible=u===n?e.getVisibility():e.isVisibleByName(u.name);var h,p=e.wrap.getLayerNodes(r);for(h=0;h<p.length;h++){var d=t(p[h],i);d&&(l=u,c=d,e.options.inverseTree?TC.Util.fastUnshift(l.children,c):l.children[l.children.length]=c)}u.legend=e.wrap.getLegend(r);if(!i&&!s){n.children=n.children.concat(u.children);u=null}}return u};switch(e.type){case TC.Consts.layerType.WMTS:t=r(e.wrap.getWMTSLayer(),!e.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(e.capabilities){t=r(e.wrap.getRootLayerNode(),!e.options.hideTree,!0);var i=e._cache.visibilityStates;!function e(t){var n=TC.Consts.visibility.NOT_VISIBLE;if(t){if(void 0!==i[t.uid])n=i[t.uid];else{if(t.children)for(var r=!1,s=!1,o=0,a=t.children.length;o<a;o++){switch(e(t.children[o])){case TC.Consts.visibility.VISIBLE:r=!0;break;case TC.Consts.visibility.NOT_VISIBLE:s=!0;break;case TC.Consts.visibility.HAS_VISIBLE:r=!0;s=!0}r&&(n=s?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}t.isVisible&&(n=TC.Consts.visibility.VISIBLE);i[t.uid]=n}t.visibilityState=n}return n}(t);e.options.hideTree&&function e(t,n){n.children.sort(function(e,n){return o(t,n)-o(t,e)});for(var r=0,i=n.children.length;r<i;r++)e(t,n.children[r])}(e,t)}}t||(t={name:e.name,title:e.title});t.title=e.title||t.title;t.customLegend=e.customLegend||t.customLegend;e.tree=t}return t};l.setNodeVisibility=function(e,t){var n=this;n.tree||(n.tree=n.getTree());var r=n.findNode(e,n.tree);if(r===n.tree)t&&0===n.names.length?n.addLayerNames(n.availableNames).then(function(){n.setVisibility(!0)}):n.setVisibility(t);else{var i=function e(t){var n=[];if(t.name)n[0]=t.name;else for(var r=0;r<t.children.length;r++)n=n.concat(e(t.children[r]));return n}(r);t?n.addLayerNames(i):n.removeLayerNames(i)}};l.getNodeVisibility=function(e){this.tree||(this.tree=this.getTree());return this._cache.visibilityStates[e]};l.getNodePath=function(e,t){var n=this,r=[];if(n.type===TC.Consts.layerType.WMS&&n.capabilities){e=e||n.names[0];r=function r(i){var s=[],o=n.wrap.getName(i);if(n.compareNames(o,e,t))s.push(i);else for(var a=n.wrap.getLayerNodes(i),l=0;l<a.length;l++){var c=r(a[l]);if(c.length){s=c;TC.Util.fastUnshift(s,i);break}}return s}(n.wrap.getRootLayerNode())}return r};l.getPath=function(e,t){return $.map(this.getNodePath(e,t),function(e){return e.title||e.Title})};l.getLayerNodeByName=function(e){for(var t=null,n=this.wrap.getServiceType()===TC.Consts.layerType.WMTS?this.wrap.getIdentifier:this.wrap.getName,r=this.wrap.getAllLayerNodes(),i=0,s=r.length;i<s;i++)if(this.compareNames(n(r[i]),e)){t=r[i];break}return t};l.getChildrenLayers=function(e){var t=[],n=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var r=0;r<e.Layer.length;r++){t[t.length]=e.Layer[r];n(e.Layer[r],t)}};n(e,t);return t};l.compareNames=function(e,t,n){var r=e===t,i=void 0!==n?n:this.ignorePrefixes;if(!r&&i&&e&&t){var s=e.indexOf(":"),o=t.indexOf(":");s>=0&&o<0?r=e.substr(s+1)===t:o>=0&&s<0&&(r=e===t.substr(o+1))}return r};l.getCapabilitiesPromise=function(){return this._capabilitiesPromise};l.getResolutions=function(){return this.wrap.getResolutions()};l.searchSubLayers=function(e){this.patternFn||(this.patternFn=function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/[^a-z\d\xe1\xe9\xed\xf3\xfa\xfc\xf1]/gi,"\\$&")).replace(/(a|\xe1)/gi,"(a|\xe1)")).replace(/(e|\xe9)/gi,"(e|\xe9)")).replace(/(i|\xed)/gi,"(i|\xed)")).replace(/(o|\xf3)/gi,"(o|\xf3)")).replace(/(u|\xfa|\xfc)/gi,"(u|\xfa|\xfc)")).replace(/n/gi,"(n|\xf1)")});if(e&&e.length&&e.length>=3){var t=this,n=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)n=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){n=[];for(var r=0;r<t.availableNames.length;r++){var i=t.getLayerNodeByName(t.availableNames[r]);if(i){n[n.length]=i;n=n.concat(t.getChildrenLayers(i))}}}else n=t.wrap.getAllLayerNodes();var s=this.patternFn(e),o=new RegExp(s,"i"),a=n.map(function(e,n){delete e.tcScore;e.tcPosition=n;t.wrap.normalizeLayerNode(e);var r=e.Title.trim(),i=o.exec(r),s=i?i.index:-1,a=-1;if(e.Abstract){var l=e.Abstract.trim(),c=o.exec(l);a=c?c.index:-1}i&&r==i[0]?e.tcScore=20:0==s?e.tcScore=15:s>-1?e.tcScore=10:0==a?e.tcScore=5:a>-1&&(e.tcScore=1);return e.tcScore?e:null}).filter(function(e){return null!=e}).sort(function(e,t){if(t.tcScore===e.tcScore){var n=TC.Util.replaceAccent(e.Title),r=TC.Util.replaceAccent(t.Title);return n<r?-1:n>r?1:0}return t.tcScore-e.tcScore});this.lastPattern=e;this.lastMatches=a;return a}return[]};l.getGetMapUrl=function(){return function(e){var t=e;if(e){var n=e.match(/\??SERVICE=\w+&/i);n&&(t=t.replace(n[0],""))}return t}(this.wrap.getGetMapUrl())};l.getPreferredInfoFormat=function(){var e=null,t=this.wrap.getInfoFormats();if(t)for(var n=0;n<TC.wrap.layer.Raster.infoFormatPreference.length;n++){var r=TC.wrap.layer.Raster.infoFormatPreference[n];if($.inArray(r,t)>=0){e=r;break}}return e};l.getLegendGraphicImage=function(){const e=this;return new Promise(function(t,n){if(e.options.params.base64LegendSrc)return t(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var r=e.names[0],i=e.wrap.getInfo(r),s=new XMLHttpRequest,o=i.legend[0].src.split("?"),a=o[1].split("&"),l=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",c=0;c<a.length;c++){var u=a[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+a[c])}e.options.params.env&&(l+="&"+e.options.params.env);s.open("POST",o[0],!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(n){if(200===this.status){for(var r=new Uint8Array(this.response),i=r.length,o=new Array(i);i--;)o[i]=String.fromCharCode(r[i]);var a=o.join(""),l=s.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(a);e.options.params.base64LegendSrc=c;t(c)}}};s.send(l)}else n(Error("Funci\xf3n window.btoa no soportada por el navegador"))})};l.getUrl=function(e){return e};l.getWebGLUrl=function(e,t){const n=this;return new Promise(function(t,r){var i=!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(n.url))?n.getBySSL_(e):e;if(n.ignoreProxification)t(i);else{const e={exportable:!0,ignoreProxification:n.ignoreProxification};n.toolProxification.fetchImage(i,e).then(function(){n.toolProxification.cacheHost.getAction(i,e).then(function(e){e&&e.action&&t(e.action.call(n.toolProxification,i))})}).catch(function(e){r(Error(e))})}})};l.getFeatureUrl=function(e){var t=this;return t.toolProxification.cacheHost.getAction(e).then(function(n){return n.action.call(t.toolProxification,e)})};l.getSiblingLoadedLayer=function(e){var t=this;if(t.map){return t.map.baseLayers.slice(0).concat(t.map.workLayers.slice(0)).filter(function(n){return(n.type===TC.Consts.layerType.WMS||n.type===TC.Consts.layerType.WMTS)&&(n.capabilities===t.capabilities||n.url===t.url)&&(!e||!$.isFunction(e)||e(n))})[0]||null}return null};l.getImageLoad=function(e,t,n){const r=this;if(r.names&&r.names.length>0){const n=function(t){var n=e.getImage();TC.Util.isSameOrigin(t.src)||(!r.map||r.map&&r.map.mustBeExportable)&&(n.crossOrigin=null!==t.crossOrigin?t.crossOrigin:"anonymous");n.setAttribute("src",t.src);m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})},y=function(t){m.call(r).trigger(TC.Consts.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}});n({src:TC.Consts.BLANK_IMAGE})};if(r.type===TC.Consts.layerType.WMTS){var i,s,o;if("KVP"!=r.encoding){var a=t.replace("."+r.format.split("/")[1],"");i=(l=a.split("/").slice(a.split("/").length-3).map(function(e){return parseInt(e)}))[0];s=l[1];o=l[2]}else{var l;if((l=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(t))&&4==l.length){i=(l=l.slice(1).map(function(e){return parseInt(e)}))[0];s=l[2];o=l[1]}}if(i&&s&&o){var c=r.wrap.getWMTSLayer();if(c){var u=c.TileMatrixSetLink.filter(function(e){return e.TileMatrixSet===r.matrixSet});if(u.length>0&&u[0].TileMatrixSetLimits.length>0){var h=u[0].TileMatrixSetLimits.sort(function(e,t){return parseInt(e.TileMatrix)>parseInt(t.TileMatrix)?1:parseInt(e.TileMatrix)<parseInt(t.TileMatrix)?-1:0})[i];if(h&&r.map&&r.map.on3DView&&!(h.MinTileRow<=s&&h.MaxTileRow>=s&&h.MinTileCol<=o&&h.MaxTileCol>=o)){console.log("Prevenimos petici\xf3n fuera de matrix set, cargamos imagen en blanco");n({src:TC.Consts.BLANK_IMAGE});return}}}}}m.call(r).trigger(TC.Consts.event.BEFORETILELOAD,{tile:e});var p="";if("POST"===r.options.method){var d=t.split("?");p=d[1].split("&").filter(function(e){const t=e.split("=");return t.length>1&&t[1].trim().length>0&&"layers"!==t[0].trim().toLowerCase()}).join("&");r.toolProxification.fetchImageAsBlob(d[0],{type:"POST",data:p,contentType:"application/x-www-form-urlencoded"}).then(function(t){const r=URL.createObjectURL(t);e.getImage().onload=function(e){URL.revokeObjectURL(r)};n({src:r})}).catch(y)}else if(r.ignoreProxification){n({src:t});var f=e.getImage();TC.Util.isSameOrigin(t)||(!r.map||r.map&&r.map.mustBeExportable)&&(f.crossOrigin="anonymous");f.onload=function(){m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})};f.onerror=function(t){f.src=TC.Consts.BLANK_IMAGE;m.call(r).trigger(TC.Consts.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})};f.src=r.names.length?t:TC.Consts.BLANK_IMAGE}else r.toolProxification.fetchImage(t,{exportable:!r.map||r.map&&r.map.mustBeExportable}).then(function(e){n(e)}).catch(y)}else m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})};var m=function(){const e=this;return e.wrap&&e.wrap.$events?e.wrap.$events:null};l.getWFSCapabilitiesPromise=function(){const e=this;void 0===WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser");var t=this.options.url.replace(/service=wms/i,"service=wfs").replace(/\/wms(\/|\?|\b)/i,"$'/wfs/"),n=!TC.Util.isSecureURL(t)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(t))?e.getBySSL_(t):t,r=t.substring(t.indexOf("://")<0?0:t.indexOf("://")+3);if(TC.WFScapabilities[r])return TC.WFScapabilities[r]instanceof Promise?TC.WFScapabilities[r]:new Promise(function(e,t){setTimeout(function(){e(TC.WFScapabilities[r])},100)});TC.WFScapabilities[r]=new Promise(function(t,i){var s={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"},o=e.getUrl(n+"?"+TC.Util.getParamString(s));e.toolProxification.fetch(o,{retryAttempts:2}).then(function(e){var n,s;const o=e.responseText&&(e.responseText.ownerDocument||e.responseText).documentElement;var a=(s=!!o&&"HTML"!==o.nodeName?e.responseText:(new DOMParser).parseFromString(e.responseText,"text/xml")).getElementsByTagName("ServiceException")[0];a||(a=s.getElementsByTagName("ExceptionText")[0]);if(a)i(Error(a.innerHTML));else{try{n=WFSCapabilities.Parse(s)}catch(e){i(e instanceof Error?e:Error(e));return}if(n.Operations){var l=n.Operations.GetCapabilities.DCP&&n.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||n.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[l]=n;TC.WFScapabilities[r]=n;t(n)}else i(null)}}).catch(function(e){i(e instanceof Error?e:Error(e))})});return TC.WFScapabilities[r]};l.getFallbackLayer=function(){const e=this;if(e.fallbackLayer instanceof TC.Layer)return e.fallbackLayer;if(e.options.fallbackLayer){var t=e.options.fallbackLayer;if("string"==typeof t){(e.map?e.map.options.availableBaseLayers:TC.Cfg.availableBaseLayers).forEach(function(t){if(e.options.fallbackLayer===t.id){e.fallbackLayer=new TC.layer.Raster($.extend({},t,{isBase:!0,stealth:!0,map:e.map}));e.fallbackLayer.firstOption=e}})}else if(t instanceof TC.Layer){e.fallbackLayer=t;e.fallbackLayer.firstOption=e}else{e.fallbackLayer=new TC.layer.Raster($.extend({},t,{id:TC.getUID(),isBase:!0,stealth:!0,title:layer.title,map:e.map}));e.fallbackLayer.firstOption=e}return e.fallbackLayer}return null}}();var esriParser={parse:function(e){var t=[],n=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===n.documentElement.tagName)for(var r=n.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,s=r.length;i<s;i++)for(var o=r[i],a=o.getAttribute("layername"),l=o.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var h=l[c].getElementsByTagName("Field"),p={},d=0,f=h.length;d<f;d++){var y=h[d];p[getElementText(y.getElementsByTagName("FieldName")[0])]=getElementText(y.getElementsByTagName("FieldValue")[0])}var m=new ol.Feature(p);m.setId(a+"."+TC.getUID());t[t.length]=m}return t}};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.layer.Vector=function(){TC.Layer.apply(this,arguments);this.type=this.options.type||TC.Consts.layerType.VECTOR;this.features=[];this.selectedFeatures=[];const e=function(e){var t=(e=e||"").indexOf("?");t>=0?e=e.substr(0,t):(t=e.indexOf("#"))>=0&&(e=e.substr(0,t));return e.substr(e.lastIndexOf(".")).toLowerCase()}(this.url),t=function(e){switch(e){case TC.Consts.mimeType.KML:return TC.Consts.format.KML;case TC.Consts.mimeType.GPX:return TC.Consts.format.GPX;case TC.Consts.mimeType.JSON:case TC.Consts.mimeType.GEOJSON:return TC.Consts.format.GEOJSON;case TC.Consts.mimeType.GML:return TC.Consts.format.GML;default:return null}}(this.options.format)||function(e){switch(e){case".kml":return TC.Consts.format.KML;case".gpx":return TC.Consts.format.GPX;case".json":case".geojson":return TC.Consts.format.GEOJSON;case".gml":return TC.Consts.format.GML;case".wkt":return TC.Consts.format.WKT;case".topojson":return TC.Consts.format.TOPOJSON;default:return null}}(e);if(t||this.type===TC.Consts.layerType.KML){t===TC.Consts.format.KML&&(this.type=TC.Consts.layerType.KML);this.title=this.options.title||function(t){for(var n=t=t||"",r=new RegExp("([^/]+"+e+")","i"),i=0;i<3;i++){t=decodeURIComponent(t);var s=r.exec(t);if(s.length>1){n=s[1];break}}return n}(this.url)}this.wrap=new TC.wrap.layer.Vector(this);var n=this.wrap.createVectorLayer();this.wrap.setLayer(n);this.wrap._promise=Promise.resolve(n)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){var e=null;if(!this.options.stealth){(e={}).children=[];for(var t=0;t<this.features.length;t++){var n=this.features[t].getPath();if(n.length){var r=TC.Util.addArrayToTree(n,e);r&&(r.legend=this.features[t].getLegend())}}e.name=this.name||e.name;e.customLegend=this.options.customLegend;e.title=this.title||e.title;e.uid=this.id}return e};var t=function(e,t,n,r){return new Promise(function(i,s){t.call(e,[n],r).then(function(t){i(t[0]);e.map&&e.map.trigger(TC.Consts.event.FEATUREADD,{layer:e,feature:t[0]})})})},n=function(e,t,n,r,i){var s=e.options.styles&&e.options.styles[r]||TC.Cfg.styles[r],o=$.extend(!0,{},s,i);return new Promise(function(r,i){var s;const a=function(){s=s||TC.feature[n];for(var i=new Array(t.length),a=[],l=0,c=t.length;l<c;l++){var u,h=t[l];const r=TC.wrap.Feature.prototype.isNative(h);if(h instanceof s||"TC.feature."+n===h.CLASSNAME)u=h;else{o.layer=e;r&&(u=h._wrap&&h._wrap.parent);u||(u=new s(h,o))}u.layer=e;i[l]=u;e.features[e.features.length]=u;r||(a[a.length]=u.wrap.feature);u.options.showPopup&&u.showPopup()}a.length&&e.wrap.addFeatures(a);r(i)};if(n)TC.loadJS(!TC.feature||TC.feature&&!TC.feature[n],[TC.apiLocation+"TC/feature/"+n],a);else{s=TC.Feature;a()}})};e.addPoint=function(e,n){return t(this,this.addPoints,e,n)};e.addPoints=function(e,t){return n(this,e,"Point",TC.Consts.geom.POINT,t)};e.addMarker=function(e,n){return t(this,this.addMarkers,e,n)};e.addMarkers=function(e,t){return n(this,e,"Marker","marker",t)};e.addPolyline=function(e,n){return t(this,this.addPolylines,e,n)};e.addPolylines=function(e,t){return n(this,e,"Polyline",TC.Consts.geom.POLYLINE,t)};e.addMultiPolyline=function(e,n){return t(this,this.addMultiPolylines,e,n)};e.addMultiPolylines=function(e,t){return n(this,e,"MultiPolyline",TC.Consts.geom.POLYLINE,t)};e.addPolygon=function(e,n){return t(this,this.addPolygons,e,n)};e.addPolygons=function(e,t){return n(this,e,"Polygon",TC.Consts.geom.POLYGON,t)};e.addMultiPolygon=function(e,n){return t(this,this.addMultiPolygons,e,n)};e.addMultiPolygons=function(e,t){return n(this,e,"MultiPolygon",TC.Consts.geom.POLYGON,t)};e.addCircle=function(e,n){return t(this,this.addCircles,e,n)};e.addCircles=function(e,t){return n(this,e,"Circle",TC.Consts.geom.POLYGON,t)};e.addFeature=function(e){const t=this;var r;TC.feature&&(r=TC.feature.Point&&e instanceof TC.feature.Point||"TC.feature.Point"===e.CLASSNAME?t.addPoint(e):TC.feature.Polyline&&e instanceof TC.feature.Polyline||"TC.feature.Polyline"===e.CLASSNAME?t.addPolyline(e):TC.feature.Polygon&&e instanceof TC.feature.Polygon||"TC.feature.Polygon"===e.CLASSNAME?t.addPolygon(e):TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||"TC.feature.MultiPolygon"===e.CLASSNAME?t.addMultiPolygon(e):TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline||"TC.feature.MultiPolyline"===e.CLASSNAME?t.addMultiPolyline(e):TC.feature.Circle&&e instanceof TC.feature.Circle||"TC.feature.Circle"===e.CLASSNAME?t.addCircle(e):n(t,[e]));return r};e.removeFeature=function(e){const t=this;if(e.layer&&t.features.indexOf(e)>=0){if(t.map){t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e&&t.hide()});t.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.isVisible()&&t.currentFeature===e&&t.close()})}t.wrap.removeFeature(e);e.layer=null}};e.getFeatureById=function(e){var t=null,n=this.wrap.getFeatureById(e);n&&(t=n._wrap.parent);return t};e.clearFeatures=function(){var e=this;if(e.features&&e.wrap){if(e.map){e.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&e.features.indexOf(t.currentFeature)>=0&&t.hide()})}e.features.length=0;e.wrap.clearFeatures()}};e.describeFeatureType=function(e,t){const n=this;new Promise(function(e,t){TC.ajax({url:n.wrap.getDescribeFeatureTypeUrl(),method:"GET",responseType:TC.Consts.mimeType.XML}).then(function(n){var r="http://www.w3.org/2001/XMLSchema",i=n.getElementsByTagNameNS(r,"complexType")[0];if(i){for(var s=i.getElementsByTagNameNS(r,"element"),o=new Array(s.length),a=0,l=s.length;a<l;a++){var c=s[a];o[a]={name:c.getAttribute("name"),type:c.getAttribute("type"),nillable:"true"===c.getAttribute("nillable"),minOccurs:parseInt(c.getAttribute("minOccurs")),maxOccurs:parseInt(c.getAttribute("maxOccurs"))}}e(o)}else{var u=n.getElementsByTagName("Exception")[0];u&&t(u.getElementsByTagName("ExceptionText")[0].innerHTML)}}).catch(function(e,n,r){t(Error(r))})}).then(function(t){$.isFunction(e)&&e(t)},function(e){$.isFunction(t)&&t(e)})};e.import=function(e){this.wrap.import(e)};e.setNodeVisibility=function(e,t){this.state=TC.Layer.state.LOADING;this.map.trigger(TC.Consts.event.BEFOREUPDATE);this.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:this});this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)this.setVisibility(t);else{this._cache.visibilityStates[e]=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var n,r,i=!1;for(n=0;n<this.features.length;n++)if((r=this.features[n]).id==e){i=!0;r.setVisibility(t);break}if(!i)for(n=0;n<this.features.length;n++){void 0===(r=this.features[n])._path&&(r._path="/"+r.getPath().join("/"));r._path===e&&r.setVisibility(t)}}this.state=TC.Layer.state.IDLE;this.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:this});this.map.trigger(TC.Consts.event.UPDATE)};e.getNodeVisibility=function(e){var t=TC.Layer.prototype.getNodeVisibility.call(this,e);this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)t=this.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var n=this._cache.visibilityStates[e];void 0!==n&&(t=n)}return t};e.setModifiable=function(e){this.wrap.setModifiable(e)};e.applyEdits=function(e,t,n){return this.wrap.sendTransaction(e,t,n)};e.refresh=function(){return this.wrap.reloadSource()};e.getFeaturesInCurrentExtent=function(e){var t=this.map.getExtent();return this.getFeaturesInExtent(t,e)};e.getFeaturesInExtent=function(e,t){return this.wrap.getFeaturesInExtent(e,t)};e.setProjection=function(e){const t=this;t.wrap.setProjection(e);if(e.crs&&e.oldCrs){t.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:t});t.features.forEach(function(t){t.wrap.setGeometry(TC.Util.reproject(t.geometry,e.oldCrs,e.crs));t.geometry=t.wrap.getGeometry()});t.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:t})}};e.exportState=function(e){const t=this;e=e||{};const n={id:t.id};t.map&&t.map.crs!==t.map.options.crs&&(n.crs=t.map.crs);var r=Math.pow(10,(t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)+1);const i=e.features||t.features;n.features=i.map(function(n){const i={};var s;switch(!0){case TC.feature.Marker&&n instanceof TC.feature.Marker:i.type=TC.Consts.geom.POINT;s=t.options.styles&&t.options.styles.marker;break;case TC.feature.Point&&n instanceof TC.feature.Point:i.type=TC.Consts.geom.POINT;s=t.options.styles&&t.options.styles.point;break;case TC.feature.Polyline&&n instanceof TC.feature.Polyline:i.type=TC.Consts.geom.POLYLINE;s=t.options.styles&&t.options.styles.line;break;case TC.feature.MultiPolyline&&n instanceof TC.feature.MultiPolyline:i.type=TC.Consts.geom.MULTIPOLYLINE;s=t.options.styles&&t.options.styles.line;break;case TC.feature.Polygon&&n instanceof TC.feature.Polygon:i.type=TC.Consts.geom.POLYGON;s=t.options.styles&&t.options.styles.polygon;break;case TC.feature.MultiPolygon&&n instanceof TC.feature.MultiPolygon:i.type=TC.Consts.geom.MULTIPOLYGON;s=t.options.styles&&t.options.styles.polygon;break;case TC.feature.Circle&&n instanceof TC.feature.Circle:i.type=TC.Consts.geom.CIRCLE;s=t.options.styles&&t.options.styles.polygon}i.id=n.id;i.geom=TC.Util.compactGeometry(n.geometry,r);i.data=n.getData();i.showsPopup=n.showsPopup;if(void 0===e.exportStyles||e.exportStyles){s=$.extend({},s);for(var o in s){var a=s[o];$.isFunction(a)&&(s[o]=a(n))}i.style=$.extend(s,n.getStyle())}return i});return n};e.importState=function(e){const t=this;return new Promise(function(n,r){const i=new Array(e.features.length);e.features.forEach(function(n,r){const s=$.extend(n.style,{data:n.data,id:n.id,showsPopup:n.showsPopup});var o;switch(n.type){case TC.Consts.geom.POLYGON:o=t.addPolygon;break;case TC.Consts.geom.MULTIPOLYGON:o=t.addMultiPolygon;break;case TC.Consts.geom.POLYLINE:o=t.addPolyline;break;case TC.Consts.geom.MULTIPOLYLINE:o=t.addMultiPolyline;break;case TC.Consts.geom.CIRCLE:o=t.addCircle;break;case TC.Consts.geom.POINT:o=n.style&&(n.style.url||n.style.className)?t.addMarker:t.addPoint}if(o){var a=TC.Util.explodeGeometry(n.geom);e.crs&&t.map.crs!==e.crs?i[r]=new Promise(function(e,n){t.map.one(TC.Consts.event.PROJECTIONCHANGE,function(r){o.call(t,a,s).then(function(){e()},function(){n()})})}):i[r]=o.call(t,a,s)}});Promise.all(i).then(function(){n()},function(e){r(e instanceof Error?e:Error(e))})})}}();function xml2json(e){var t={toObj:function(e){var n={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)"name"!==e.attributes[r].nodeName&&(n[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString());if(e.firstChild){for(var i=0,s=0,o=!1,a=e.firstChild;a;a=a.nextSibling)1==a.nodeType?o=!0:3==a.nodeType&&a.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==a.nodeType&&s++;if(o)if(2>i&&2>s){t.removeWhite(e);for(a=e.firstChild;a;a=a.nextSibling){var l=t.removePrefix(a.nodeName);if(3==a.nodeType)n["#text"]=t.escape(a.nodeValue);else if(4==a.nodeType)n["#cdata"]=t.escape(a.nodeValue);else if(n[l])n[l]instanceof Array?n[l][n[l].length]=t.toObj(a):n[l]=[n[l],t.toObj(a)];else{var c=null;a.attributes.getNamedItem("name")&&(c=a.attributes.getNamedItem("name").nodeValue),n[c||l]=t.toObj(a)}}}else e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(i)e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(s)if(s>1)n=t.escape(t.innerXml(e));else for(a=e.firstChild;a;a=a.nextSibling)n["#cdata"]=t.escape(a.nodeValue)}e.attributes.length||e.firstChild||(n=null)}else 9==e.nodeType?n=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return n},toJson:function(e,n,r){var i=n?'"'+n+'"':"";if(e instanceof Array){for(var s=0,o=e.length;o>s;s++)e[s]=t.toJson(e[s],"",r+"\t");i+=(n?":[":"[")+(e.length>1?"\n"+r+"\t"+e.join(",\n"+r+"\t")+"\n"+r:e.join(""))+"]"}else if(null==e)i+=(n&&":")+"null";else if("object"==typeof e){var a=[];for(var l in e)a[a.length]=t.toJson(e[l],l,r+"\t");i+=(n?":{":"{")+(a.length>1?"\n"+r+"\t"+a.join(",\n"+r+"\t")+"\n"+r:a.join(""))+"}"}else i+="string"==typeof e?(n&&":")+'"'+e.toString()+'"':(n&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var n=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=n(i);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},r=e.firstChild;r;r=r.nextSibling)t+=n(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var r=n.nextSibling;e.removeChild(n),n=r}else 1==n.nodeType?(t.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}var WFSCapabilities=function(){var e="1.0.0",t="1.1.0",n="2.0.0",r=function(r,i){switch(i){case e:var s=r.Capability.Request;if(s.GetFeature){var o=[];for(var a in s.GetFeature.ResultFormat)o.push(a.toLowerCase());s.GetFeature.outputFormat=o,delete s.GetFeature.ResultFormat,s.GetFeature.Operations=r.FeatureTypeList.Operations}return s;case t:return{};case n:var l={};for(var a in r.OperationsMetadata){var c={};c[a]=r.OperationsMetadata[a];for(var u in c[a])c[a][u]&&c[a][u].hasOwnProperty("AllowedValues")&&(c[a][u]=c[a][u].AllowedValues.Value);$.extend(l,c)}return l}return null},i=function(r,i){switch(i){case e:for(var s={},o=0;o<r.FeatureTypeList.FeatureType.length;o++){s[(a=r.FeatureTypeList.FeatureType[o].Name).substring(a.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[o]}return s;case t:return{};case n:for(s={},o=0;o<r.FeatureTypeList.FeatureType.length;o++){var a;s[(a=r.FeatureTypeList.FeatureType[o].Name).substring(a.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[o]}return s}return null},s=function(r,i){switch(i){case e:return r.Filter_Capabilities;case t:return{};case n:return r.Filter_Capabilities}return null},o=function(r,i){switch(i){case e:var s={};for(var o in r)"string"==typeof r[o]&&(s[o]=r[o]);return s;case t:return{};case n:s={};for(var o in r)"string"==typeof r[o]&&(s[o]=r[o]);return s}return{}};return{Promises:function(e){var t=(e=e).substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[t])return Promise.resolve(TC.capabilities[t]);var n={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return new Promise(function(r,i){TC.ajax({url:TC.proxify(e)+"?"+$.param(n),method:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),n=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[n]=e,TC.capabilities[t]=e,r(WFSCapabilities.Parse(arguments[0]))})})},Parse:function(){var a,l,c,u,h=xml2json(arguments[0]);switch(h.version){case e:a=e;break;case t:a=t;break;case n:a=n}l=r(h,a),c=i(h,a),u=s(h,a);var p=o(h,a),d={Operations:l,FeatureTypes:c,Filters:u};return $.extend(d,p),d}}}(),TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Geometry=t()}(TC,function(){const e={isPoint:function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(t){return $.isArray(t)&&(0===t.length||e.isPoint(t[0]))},isRingCollection:function(t){return $.isArray(t)&&(0===t.length||e.isRing(t[0]))},isMultiRingCollection:function(t){return $.isArray(t)&&(0===t.length||e.isRingCollection(t[0]))},getNearest:function(e,t){return TC.wrap.Geometry.getNearest(e,t)},isInside:function t(n,r){var i=!1;if(e.isPoint(n))if(e.isPoint(r))i=n[0]===r[0]&&n[1]===r[1];else if(e.isRing(r))for(var s=0,o=r.length-1;s<r.length;o=s++){var a=r[s][0],l=r[s][1],c=r[o][0],u=r[o][1];l>n[1]!=u>n[1]&&n[0]<(c-a)*(n[1]-l)/(u-l)+a&&(i=!i)}else if(e.isRingCollection(r)&&r.length>0){if(t(n,r[0])){var h=!1;for(s=1;s<r.length;s++)if(t(n,r[s])){h=!0;break}h||(i=!0)}}else if(e.isMultiRingCollection(r)&&r.length>0){s=0;for(var p=r.length;s<p;s++)if(t(n,r[s])){i=!0;break}}return i}};return e});var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var n=e.getAttribute("src");TC.apiLocation=n.substr(0,n.lastIndexOf("/")+1);var r=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),i=new XMLHttpRequest;i.open("GET",r,!1);i.send(null);var s=document.getElementsByTagName("head")[0];(e=document.createElement("script")).type="text/javascript";e.text=i.responseText;s.appendChild(e)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(e,t){var n=this;TC.Cfg.controls.search.allowedSearchTypes=$.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(t&&t.controls&&t.controls.search){var r=Object.keys(t.controls.search),i=$.extend(t.controls.search,{allowedSearchTypes:{}});r.forEach(function(e){if("boolean"==typeof t.controls.search[e]||$.isPlainObject(t.controls.search[e])){if(t.controls.search[e])switch(!0){case"postalAddress"===e:i.allowedSearchTypes[TC.Consts.searchType.NUMBER]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"cadastralParcel"===e:i.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"town"===e:i.allowedSearchTypes[TC.Consts.searchType.URBAN]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;default:i.allowedSearchTypes[e]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{}}delete i[e]}});t.controls.search=i}var s,o,a=new TC.Map(e,t);n.addLayer=function(e,t){a.addLayer(e,t)};n.setBaseLayer=function(e,t){a.setBaseLayer(e,t)};n.addMarker=function(e,t){a.addMarker(e,t)};n.zoomToMarkers=function(e){a.zoomToMarkers(e)};n.loaded=function(e){a.loaded(e)};a.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(s=new TC.control.Search).register(a);s.getLayer().then(function(e){o=e})});if(!a.activeControl){var e=a.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});n.getQueryableData=function(e,t){var n=s.availableSearchTypes[e];if(n.queryableData)t&&t(n.queryableData);else{var r={request:"GetFeature",service:"WFS",typename:n.featurePrefix+":"+n.featureType,version:n.version,propertyname:(n.dataIdProperty instanceof Array?n.dataIdProperty:[n.dataIdProperty]).concat(n.outputProperties instanceof Array?n.outputProperties:[n.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},i=n.url+"?"+$.param(r);TC.ajax({url:i,responseType:TC.Consts.mimeType.JSON}).then(function(e){n.queryableData=[];if(e.features)for(var r=e.features,i=0;i<r.length;i++){var o=r[i];e={id:[]};n.dataIdProperty instanceof Array||(n.dataIdProperty=[n.dataIdProperty]);for(var a=0;a<n.dataIdProperty.length;a++)o.properties.hasOwnProperty(n.dataIdProperty[a])&&e.id.push(o.properties[n.dataIdProperty[a]]);e.id=n.idPropertiesIdentifier?e.id.join(n.idPropertiesIdentifier):e.id.join("");e.label=[];n.outputProperties instanceof Array||(n.outputProperties=[n.outputProperties]);for(var l=0;l<n.outputProperties.length;l++)o.properties.hasOwnProperty(n.outputProperties[l])&&e.label.push(o.properties[n.outputProperties[l]]);var c=e.label instanceof Array&&e.label.join("").trim().length>0||!(e.label instanceof Array)&&e.label.trim().length>0;e.label=n.outputFormatLabel?n.outputFormatLabel.tcFormat(e.label):e.label.join("-");c&&n.queryableData.push(e)}n.queryableData=n.queryableData.sort(function(e,t){return n.idPropertiesIdentifier&&-1==e.id.indexOf(n.idPropertiesIdentifier)?s.removePunctuation(e.label)<s.removePunctuation(t.label)?-1:s.removePunctuation(e.label)>s.removePunctuation(t.label)?1:0:s.removePunctuation(e.label.split(" ")[0])<s.removePunctuation(t.label.split(" ")[0])?-1:s.removePunctuation(e.label.split(" ")[0])>s.removePunctuation(t.label.split(" ")[0])?1:0});n.queryableData=n.queryableData.filter(function(e,t,n){return t<1||e.id!==n[t-1].id&&e.label!==n[t-1].label});t&&t(n.queryableData)})}};n.getMunicipalities=function(e){n.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};n.getUrbanAreas=function(e){n.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};n.getCommonwealths=function(e){n.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};n.getCouncils=function(e){n.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};n.searchCommonwealth=function(e,t){n.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};n.searchCouncil=function(e,t){n.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};n.searchUrbanArea=function(e,t){n.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};n.searchMunicipality=function(e,t){n.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};n.searchTyped=function(e,t,r){var i=TC.getUID(),l=s.availableSearchTypes[e];t instanceof Array&&l.goToIdFormat&&(t=l.goToIdFormat.tcFormat(t));s._search.data=s._search.data||[];s._search.data.push({dataLayer:l.featureType,dataRole:e,id:t,label:"",text:""});n.removeSearch();if(s.availableSearchTypes[e]&&!s.getSearchTypeByRole(e)){s.availableSearchTypes[e].goTo||(s.availableSearchTypes[e].goTo=function(e){var t=function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var t=[];l.idPropertiesIdentifier&&(e=e.split(l.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var n=0;n<l.dataIdProperty.length;n++)t.push(new TC.filter.equalTo(l.dataIdProperty[n],$.trim(e[n])));return t=t.length>1?new TC.filter.and(t):t[0]}(e);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:t,outputFormat:this.outputFormat,styles:this.styles}}}.bind(l));s.addAllowedSearchType(e,s.availableSearchTypes[e],s)}a.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){a.toast(s.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});r&&r(null)});a.one(TC.Consts.event.FEATURESADD,function(t){t.layer==o&&t.layer.features&&t.layer.features.length>0&&a.zoomToFeatures(t.layer.features);n.search={layer:t.layer,type:e};r&&r(t.layer.id!==i?t.layer.id:i)});s.goToResult(t,e)};n.searchFeature=function(e,t,r,i){var o=TC.getUID(),l=s.featurePrefix;n.removeSearch();e=(e||"").trim();t=(t||"").trim();r=(r||"").trim();if(0==e.length||0==t.length||0==r.length){a.toast(s.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(null)}else{if(e.indexOf(":")>-1){l=e.split(":")[0];e=e.split(":")[1]}var c,u={id:o,type:SITNA.Consts.layerType.WFS,url:s.url,version:s.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:e,maxFeatures:1,properties:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}([{name:t,value:r,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};a.addLayer(u).then(function(e){c=e;n.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});a.on(TC.Consts.event.FEATURESADD,function(e){const t=e.layer;if(t==c&&t.features&&t.features.length>0){for(var n=0;n<t.features.length;n++)t.features[n].showsPopup!=s.queryableFeatures&&(t.features[n].showsPopup=s.queryableFeatures);a.zoomToFeatures(t.features)}});a.on(TC.Consts.event.LAYERUPDATE,function(e){const t=e.layer,n=e.newData;t==c&&n&&n.features&&0==n.features.length&&a.toast(s.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(t==c&&n&&n.features&&0==n.features.length?null:o)})}};n.removeSearch=function(e){if(n.search)if(s.availableSearchTypes[n.search.type]&&s.availableSearchTypes[n.search.type].hasOwnProperty("goTo")){for(var t=0;t<n.search.layer.features.length;t++)n.search.layer.removeFeature(n.search.layer.features[t]);n.search=null}else a.removeLayer(n.search.layer).then(function(){n.search=null});e&&e()};n.exportImage=function(){return a.exportImage()};n.search=null};
//# sourceMappingURL=maps/sitna.ol2.min.js.map
