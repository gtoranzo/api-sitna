var TC=TC||{};TC.inherit=function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;e._super=t.prototype};!function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(e){t.prototype=new t("").constructor.prototype;return t;function t(e,t){t||(t={});var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail);return n}}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);const e=function(e,t,n){const r=this;e.split(" ").forEach(function(e){r.$events.addEventListener(e,function(e,t){const n=function(e){const n={type:e.type,target:this,currentTarget:this};e.detail&&Object.keys(e.detail).forEach(function(t){t in n||(n[t]=e.detail[t])});return t.call(this,n)}.bind(this);(this._listeners[e]=this._listeners[e]||new Map).set(t,n);return n}.call(r,e,t),n)});return r};TC.EventTarget=function(){const e=this;e._listeners={};e.$events=document.createDocumentFragment();const t=["addEventListener","dispatchEvent","removeEventListener"];t.forEach(function(t){this[t]=e.$events[t].bind(e.$events)},e);t.push("on");t.push("one");t.push("off");t.push("trigger");t.forEach(function(t){e.$events[t]=e[t].bind(e)},e)};const t=TC.EventTarget.prototype;t.on=function(t,n){return e.call(this,t,n)};navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0?t.one=function(e,t){const n=this,r=function(o){n.off(e,r);t.call(this,o)};n.on(e,r);return n}:t.one=function(t,n){return e.call(this,t,n,{once:!0})};t.off=function(e,t){const n=this,r=e.split(" ");t?r.forEach(function(e){const r=n._listeners[e];r&&r.has(t)&&n.$events.removeEventListener(e,r.get(t))}):r.forEach(function(e){const t=n._listeners[e];if(t){t.forEach(function(t){n.$events.removeEventListener(e,t)});t.clear()}});return n};t.trigger=function(e,t){if(window.$&&$.Event&&e instanceof $.Event){t={};Object.keys(e).forEach(function(n){"type"!==n&&(t[n]=e[n])});e=e.type}var n;t&&(n={detail:t});const r=new CustomEvent(e,n);this.dispatchEvent(r)};TC.EventTarget._onBySelectorMap=new WeakMap;TC.EventTarget.listenerBySelector=function(e,t){return function(n){const r=this,o=n.type;var a=TC.EventTarget._onBySelectorMap.get(r);if(!a){a={};TC.EventTarget._onBySelectorMap.set(r,a)}var s=a[o];s||(a[o]=s={});s[e]||(s[e]=t);if(!n._listenerBySelectorCalled)for(var i,l=!1,c=n.target;c&&c!==r;){for(e in s)if(c.matches&&c.matches(e)){l=!0;i=s[e].call(r,n);n._listenerBySelectorCalled=!0}if(l)return i;c=c.parentNode}}};var n=null,r=null;const o=function(e){const t=this;var o=a.call(t);if(t.replaceCurrent){window.history.replaceState(o,null,null);delete t.replaceCurrent}else{t.lastEventType=e.type;var s=function(){r=n;(n=TC.Util.utf8ToBase64(o))!==r&&window.history.pushState(o,null,window.location.href.split("#").shift()+"#"+n)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE:case e.type==TC.Consts.event.LAYERORDER:case e.type==TC.Consts.event.ZOOM:s();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&s()}}},a=function(e){const t=this;var n={};t.crs!==t.options.crs&&(n.crs=t.crs);for(var r=t.getExtent(),o=0;o<r.length;o++)Math.abs(r[o])>180&&(r[o]=Math.floor(1e3*r[o])/1e3);n.ext=r;var a,s,i=[];t.baseLayers&&(i=t.baseLayers.filter(function(e){return e.isRaster()&&e.fallbackLayer}).map(function(e){return{baseLayer:e,fallbackLayerID:e.fallbackLayer.id}}).filter(function(e){return e.fallbackLayerID===(t.baseLayer?t.baseLayer.id:t.baseLayers[0].id)}));i.length>0?n.base=i[0].baseLayer.id:n.base=(t.baseLayer||t.baseLayers[0]).id;n.layers=[];for(o=0;o<t.workLayers.length;o++)if("WMS"==(a=t.workLayers[o]).type&&!a.options.stateless&&a.layerNames&&a.layerNames.length){s={u:TC.Util.isOnCapabilities(a.url),n:Array.isArray(a.names)?a.names.join(","):a.names,o:a.getOpacity(),v:a.getVisibility(),h:a.options.hideTitle,ur:a.unremovable,t:a.title};n.layers.push(s)}t.on3DView&&t.view3D.cameraControls&&(n.vw3=t.view3D.cameraControls.getCameraState());window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);e&&TC.Util.extend(n,e);return jsonpack.pack(n)},s=function(e){const t=this,n=[];if(!e)return Promise.resolve();t.loadingctrl||(t.loadingCtrl=t.getControlsByClass("TC.control.LoadingIndicator")[0]);t.hasWait||(t.hasWait=t.loadingCtrl&&t.loadingCtrl.addWait());return new Promise(function(r,o){var a,s=function(){t.loadingCtrl&&t.loadingCtrl.removeWait(t.hasWait);delete t.hasWait;r()};if("string"==typeof e)try{a=jsonpack.unpack(e)}catch(n){try{a=JSON.parse(e)}catch(e){TC.error(TC.Util.getLocaleString(t.options.locale,"mapStateNotValid"))}}else a=e;if(a){if(a.crs&&a.crs!==t.crs||void 0===a.crs&&t.crs!==t.options.crs)n.push(t.setProjection({crs:a.crs||t.options.crs,oldCrs:t.crs,extent:a.ext,baseLayer:t.getLayer(a.base)}));else{if(a.base!=t.getBaseLayer().id){t.getLayer(a.base)&&t.setBaseLayer(a.base);const e=t.baseLayers.filter(function(e){return e.options.fallbackLayer===a.base})[0];if(e){const r=t.addLayer(e.getFallbackLayer());n.push(r);r.then(function(e){t.setBaseLayer(e)})}}a.ext&&n.push(t.setExtent(a.ext,{animate:!1}))}(function(){const e=this;e.workLayers.filter(function(e){return!(e instanceof TC.layer.Vector)}).forEach(function(t){t.unremovable&&(t.unremovable=!1);e.removeLayer(t)})}).call(t);a.layers=a.layers||a.capas||[];if(a.layers.length>0)for(var i=0;i<a.layers.length;i++){var l=a.layers[i],c=!1;for(j=0;j<t.options.workLayers.length;j++){var u=TC.Util.extend({},t.options.workLayers[j],{map:t});if(l.u===u.url&&u.layerNames.indexOf(l.n)>=0){c=!0;u.renderOptions={opacity:l.o,hide:!l.v};u.unremovable=l.ur;u.title=l.t;n.push(t.addLayer(u).then(function(e){e.setVisibility(this.v);e.setOpacity(this.o,!0)}.bind(l)))}}c||n.push(t.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:l.n?l.n.split(","):"",unremovable:l.ur,title:l.t,renderOptions:{opacity:l.o,hide:!l.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(this.o,!0);e.setVisibility(this.v)}.bind(l)))}Promise.all(n).then(function(){s()}).catch(function(){s()})}else s()})},i=function(e,t){return function(n,r,o){return r[e]===t?o:n}},l=function(e){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(t){return t.id===e})[0]};TC.Map=TC.Map||function(e,t){const n=this;TC.EventTarget.call(n);TC.Map._instances.push(n);n.isReady=!1;n.isLoaded=!1;n.controls=[];n.activeControl=null;n.layers=[];n.baseLayers=[];n.workLayers=[];n.baseLayer=null;n.vectors=null;var u=0;n.div=TC.Util.getDiv(e);TC._jQueryIsLoaded&&(n._$div=$(n.div));n.div.classList.add(TC.Consts.classes.LOADING,TC.Consts.classes.MAP);n._markerPromises=[];n._layerBuffer={layers:[],contains:function(e){return this.layers.some(function(t){return t.id===e})},getIndex:function(e){return this.layers.reduce(i("id",e),-1)},add:function(e,t,n){const r={id:e,pending:!0,zIndex:t,isBase:n};this.layers.splice(this.getIndexForZIndex(t),0,r)},remove:function(e){this.layers.splice(this.getIndex(e),1)},getMapLayers:function(){return this.layers.filter(e=>!1===e.pending).filter(e=>!e.rejected).map(e=>e.mapLayer)},resolve:function(e,t,n){const r=this.layers[this.getIndex(t.id)];r.mapLayer=t;r.pending=!1;e.layers=this.getMapLayers();if(n){0===e.baseLayers.length&&(e.baseLayers=new Array(e.options.baseLayers.length));if((o=e.options.baseLayers.map(function(e){return e.id}).indexOf(t.id))<0){var o;(o=e.baseLayers.map(function(e){return e.type}).indexOf(TC.Consts.layerType.VECTOR))<0?e.baseLayers.push(t):e.baseLayers.splice(o,0,t)}else e.baseLayers.splice(o,1,t)}else e.workLayers=e.layers.filter(function(e){return!e.isBase})},reject:function(e,t){const n=this.layers[this.getIndex(t.layerId)];n.mapLayer=null;n.pending=!1;n.rejected=!0;var r=e.options.baseLayers.map(e=>e.id).indexOf(t.layerId);r>=0&&e.baseLayers.splice(r,1)},getResolvedWorkLayerIndex:function(e,t){return this.layers.filter(function(e){return e.id===t||!e.isBase&&!1===e.pending}).reduce(i("id",t),-1)},getResolvedVisibleLayerIndex:function(e,t){var n=this.getResolvedWorkLayerIndex(e,t);e.baseLayer&&(n+=1);return n},getIndexForZIndex:function(e){return this.layers.reduce(function(e){return function(t,n,r){return n.zIndex<=e?r:t}}(e),-1)+1},checkMapLoad:function(e){const t=this;if(e.options.baseLayers.concat(e.options.workLayers).every(function(e){return t.contains(e.id||e)})&&!this.layers.some(function(e){return!0===e.pending})){const t=function(){if(!e.isLoaded){const t=function(){e.options.stateful&&function(){const e=this;var t=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");e.replaceCurrent=!0;o.call(e);const n=o.bind(e);e.on(t,n);var r;e.on(TC.Consts.event.LAYEROPACITY,function(t){clearTimeout(r);r=setTimeout(function(){o.call(e,t)},500)});window.addEventListener("popstate",function(r){var o;o=e.loadingCtrl&&e.loadingCtrl.addWait();setTimeout(function(){if(r){e.off(t,n);var a=r.state;"[object Object]"===Object.prototype.toString.call(a)&&(a=e.checkLocation());s.call(e,a).then(function(){setTimeout(function(){e.on(t,n)},200);e.loadingCtrl&&e.loadingCtrl.removeWait(o)})}},4)})}.call(e);e.isLoaded=!0;e.div.classList.remove(TC.Consts.classes.LOADING);e.trigger(TC.Consts.event.MAPLOAD)};if(e.state&&e.state.vw3){if(!e.div.classList.contains(TC.Consts.classes.THREED)){e.div.classList.add(TC.Consts.classes.THREED);TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:e,state:e.state.vw3,callback:function(){t();e.getControlsByClass(TC.control.ThreeD)[0].button.removeAttribute("disabled")}})})}}else t()}};if(e.baseLayer)t();else{var n=[];e.state&&e.state.base&&(n=TC.Cfg.availableBaseLayers.filter(function(t){return t.id===e.state.base}));if(n.length>0){n[0].isBase=!0;e.addLayer(n[0]).then(function(e){t()})}else{const n=e.baseLayers.filter(function(e){return!e.mustReproject}).filter(function(e){return e.wrap&&e.wrap.layer});if(n.length>0){e.wrap.setBaseLayer(n[0].wrap.layer);e.baseLayer=n[0]}t()}}}}};n._layerBuffer.layers=[];if(!TC.ready){TC.Cfg=TC.Util.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(t&&t.controls&&t.controls.search&&t.controls.search.allowedSearchTypes)for(var p in TC.Cfg.controls.search.allowedSearchTypes)t.controls.search.allowedSearchTypes.hasOwnProperty(p)||(t.controls.search.allowedSearchTypes[p]=!1);t=t||{};f.call(n,t);var C=function(){TC.loadJS(n.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){n.options.stateful&&(n.state=n.checkLocation());n.options.layout&&n.trigger(TC.Consts.event.LAYOUTLOAD,{map:n});t&&void 0!==t.workLayers&&(n.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(n.options.baseLayers=t.baseLayers);if(n.options.zoomToFeatures){n.on(TC.Consts.event.FEATURESADD,function e(t){clearTimeout(n._zoomToFeaturesTimeout);n._zoomToFeaturesTimeout=setTimeout(function(){n.zoomToFeatures(t.layer.features,{animate:!1});n.off(TC.Consts.event.FEATURESADD,e)},100)})}n.on(TC.Consts.event.LAYERADD,function e(t){if(t.layer.isBase&&(t.layer===n.baseLayer||n.baseLayer&&t.layer.fallbackLayer&&t.layer.fallbackLayer.id===n.baseLayer.id)){void 0!==n.state&&(n.state.crs?n.loaded(function(){n.setProjection({crs:n.state.crs,extent:n.state.ext})}):n.setExtent(n.state.ext,{animate:!1}));n.off(TC.Consts.event.LAYERADD,e)}});n.options.elevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const e="boolean"==typeof n.options.elevation?{}:n.options.elevation;n.elevation=new TC.tool.Elevation(e)});n.crs=n.options.crs;n.initialExtent=n.options.initialExtent;n.maxExtent=n.options.maxExtent;n.wrap=new TC.wrap.Map(n);TC.loadJS(!window[TC.Consts.PROJ4JSOBJ],[TC.url.proj4js],function(){TC.loadJSInOrder(!window[TC.Consts.OLNS],[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:n.options.crs,callback:function(){n.wrap.setMap();const e=[];for(var t in n.options.controls){var r=n.options.controls[t];if(r){"string"==typeof(r="boolean"==typeof r?{}:TC.Util.extend(!0,{},r)).div&&(r.div=n.div.querySelector("#"+r.div)||r.div);e.push(n.addControl(t,r))}}n.on(TC.Consts.event.BEFORELAYERUPDATE,d);n.on(TC.Consts.event.LAYERUPDATE,h);var o,a;for(o=0;o<n.options.baseLayers.length;o++){"string"==typeof(a=n.options.baseLayers[o])&&(a=l.call(n,a));n.addLayer(TC.Util.extend({},a,{isBase:!0,map:n}))}var s=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};n.options.workLayers.map(function(e){return TC.Util.extend({},e,{map:n})}).filter(function(e){return!n.state||!n.state.layers||!n.state.layers.some(function(t){const n=t.u===e.url&&e.layerNames.indexOf(t.n)>=0;n&&(t.id=e.id);return n})}).forEach(function(e){n.addLayer(e).then(s)});n.state&&n.state.layers&&n.state.layers.forEach(function(e){n.addLayer({id:e.id||TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:e.n?e.n.split(","):"",unremovable:e.ur,title:e.t,renderOptions:{opacity:e.o,hide:!e.v}}).then(function(t){var n=t.wrap.getRootLayerNode();t.title=e.t||n.Title||n.title;this.o<1&&t.setOpacity(this.o);this.v||t.setVisibility(this.v)}.bind(e))});Promise.all(e).finally(function(){n.isReady=!0;n.trigger(TC.Consts.event.MAPREADY)});g(n.div)}})})});n.on(TC.Consts.event.FEATURECLICK,function(e){n.activeControl&&n.activeControl.isExclusive()||(n.on3DView?e.feature.showResultsPanel():e.feature.showPopup())});n.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;for(var t=!0,r=0,o=n.workLayers.length;r<o;r++)if(!n.workLayers[r]._noFeatureClicked){t=!1;break}if(t){n.workLayers.forEach(function(e){delete e._noFeatureClicked});n.getControlsByClass(TC.control.Popup).forEach(function(e){e.isVisible()&&e.hide()})}})})};y.getMapState=function(e){var t=a.call(this,e);return TC.Util.utf8ToBase64(t)};y.getPreviousMapState=function(){return r};y.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(r){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(e){TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValidForEdge"),TC.Consts.msgErrorMode.TOAST);if(t){var r=!1;if(!t.hasOwnProperty("ext")){r=!0;t.ext=n.options.initialExtent}if(!t.hasOwnProperty("base")){r=!0;t.base=n.options.defaultBaseLayer}if(t.hasOwnProperty("layers"))for(var o=t.layers.length-1;o>=0;o--)if(t.layers[o]&&t.layers[o].hasOwnProperty("u")&&t.layers[o].hasOwnProperty("n")){if(!t.layers[o].hasOwnProperty("o")||!t.layers[o].hasOwnProperty("v")||!t.layers[o].hasOwnProperty("h")){r=!0;TC.Util.extend(t.layers[o],{o:t.layers[o].o||1,v:t.layers[o].v||!0,h:t.layers[o].h||!1})}}else{r=!0;t.layers.length=t.layers.length-1}else{r=!0;t.layers=[]}t.hasOwnProperty("vw3")&&(t.vw3?(!t.vw3.cp||t.vw3.cp&&3!=t.vw3.cp.length||!t.vw3.chpr||t.vw3.chpr&&3!=t.vw3.chpr.length||!t.vw3.bcpd)&&(r=!0):r=!0);r&&TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return t}TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var d=function(e){if(u<=0){u=0;n.trigger(TC.Consts.event.BEFOREUPDATE)}u+=1},h=function(e){if((u-=1)<=0){u=0;n.trigger(TC.Consts.event.UPDATE)}};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,n){var r;if(e)r=new Promise(function(e,r){TC.ajax({url:t+n+".json",method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(t){const r=t.data;TC.i18n[n]=TC.i18n[n]||{};TC.Util.extend(TC.i18n[n],r);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(n,TC.i18n[n]);e()})}).catch(function(e){r(e)})});else{dust.i18n.add(n,TC.i18n[n]);r=Promise.resolve()}return r};var T=[],L=n.options.locale;T.push(new Promise(function(e,t){TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(L){dust.i18n.setLanguages([L]);T.push(TC.i18n.loadResources(!TC.i18n[L],TC.apiLocation+"TC/resources/",L))}e()})}));Promise.all(T).finally(function(){if(n.options.layout){var e=n.options.layout;n.trigger(TC.Consts.event.BEFORELAYOUTLOAD,{map:n});var r={},o=!1;if("string"==typeof e){var a=e.trim();a+=a.match(/\/$/)?"":"/";r.config=a+"config.json";r.markup=a+"markup.html";r.style=a+"style.css";r.script=a+"script.js";r.i18n=a+"resources";o=!0}else(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(r=TC.Util.extend({},e));r.i18n&&(r.i18n+=r.i18n.match(/\/$/)?"":"/");n.layout=r;const s=[],i=function(e,t){this.status=e;this.url=t},l=function(e){if(!o||404!=e.status){const t=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.error(TC.Util.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e.url}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+e.url)}},c=new Promise(function(e,o){r.config?s.push(fetch(r.config).then(function(e){if(!e.ok)throw new i(e.status,r.config);return e.json()}).then(function(r){e(r.i18n);f.call(n,r,t)}).catch(function(t){l(t);e(!1)})):e(!1)});s.push(c);if(r.style){n.div.classList.add("tc-lo");fetch(r.style,{method:navigator.onLine?"HEAD":"GET"}).then(function(e){if(!e.ok)throw new i(e.status,r.style);return e}).then(function(){var e=document.createElement("link");e.rel="stylesheet";e.href=r.style;document.head.appendChild(e)}).catch(function(e){l(e)})}r.markup&&s.push(new Promise(function(e,t){fetch(r.markup).then(function(e){if(!e.ok)throw new i(e.status,r.markup);return e.text()}).then(function(t){c.then(function(o){if(o&&L&&r.i18n)TC.i18n.loadResources(!0,r.i18n,L).finally(function(){t=t.replace(/\{\{i18n "([^\}\{]+)"\}\}|\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\}/g,function(e,t,n,r){return TC.Util.getLocaleString(L,t||n||r)});n.div.insertAdjacentHTML("beforeend",t);e()});else{n.div.insertAdjacentHTML("beforeend",t);e()}})}).catch(function(e){l(e);t(Error(e))})}));Promise.all(s).finally(function(){r.script?fetch(r.script).then(function(e){if(!e.ok)throw new i(e.status,r.script);return e.blob()}).then(function(e){var t=URL.createObjectURL(e),r=document.createElement("script");r.src=t;r.onload=function(){g(n.div);C()};document.head.appendChild(r)}).catch(function(e){l(e);C()}):C()})}else C()});n.on(TC.Consts.event.UPDATEPARAMS,function(e){c(e.layer)});n.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<n.workLayers.length;e++)c(n.workLayers[e])});var v=TC.error;TC.error=function(e,t,r){TC.isDebug&&console.trace&&console.trace();if(t){var o=function(e,t,r){switch(t){case TC.Consts.msgErrorMode.TOAST:if(!n.toast){console.warn("No existe el objeto Toast");return}n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(r?{msg:r,errorMsg:e}:e,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(e)}};if(Array.isArray(t))for(var a=0;a<t.length;a++)o(e,t[a],r);else o(e,t,r)}else{v(e);n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};TC.Map._instances=[];TC.Map.get=function(e){for(var t=0,n=TC.Map._instances.length;t<n;t++){const n=TC.Map._instances[t];if(n.div===e)return n}};TC.inherit(TC.Map,TC.EventTarget);var c=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},u=function(e,t){var n=Array.prototype.slice.call(e).map(function(e){var n={};e&&(n[t]=e[t]);return n});"availableBaseLayers"===t&&console.log("layerOptions",n);var r={};r[t]=TC.Cfg[t];n.unshift(r);if("baseLayers"===t&&n[1].baseLayers){r=n[1];for(var o=0;o<r.baseLayers.length;o++)"object"==typeof r.baseLayers[o]&&TC.Util.extend(r.baseLayers[o],l.call(this,r.baseLayers[o].id))}else{n.unshift(!0);r=TC.Util.extend.apply(this,n);"availableBaseLayers"===t&&console.log("layerOption",r)}return r[t]};const f=function(){const e=[!0,{},TC.Cfg].concat(Array.prototype.slice.call(arguments)),t=this.options=TC.Util.extend.apply(this,e);t.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(e){return e.availableBaseLayers||[]}));t.baseLayers=u.call(this,arguments,"baseLayers");t.workLayers=u.call(this,arguments,"workLayers");const n=Array.prototype.slice.call(arguments).filter(e=>e.controls).map(e=>e.controls);n.length>0&&(t.controls=TC.Util.extend(t.controls,function(e){e.controlContainer&&(Array.isArray(e.controlContainer.controls)?e.controlContainer.controls.forEach(t=>{Object.keys(t).filter(e=>"position"!==e).forEach(n=>{if(void 0!==e[n]){"boolean"==typeof t[n]&&(t[n]={});TC.Util.extend(t[n],e[n]);delete e[n]}})}):Object.keys(e).filter(function(t){return Object.keys(e.controlContainer.controls).indexOf(t)>-1}).forEach(function(t){const n=e.controlContainer.controls[t];"boolean"==typeof n.options&&(n.options={});TC.Util.extend(n.options,e[t]);delete e[t]}));return e}(TC.Util.extend(n[0],n[1]))));return t};var y=TC.Map.prototype,p=function(e,t){var n,r='Layer "'+t.title+'" ("'+t.names+'"): ';n=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";r+=TC.Util.getLocaleString(e.options.locale,n);TC.error(r);e.trigger(TC.Consts.event.LAYERERROR,{layer:t,reason:n})};y.getCRS=function(){const e=this;return e.on3DView?e.view3D.crs:e.crs};y.addLayer=function(e,t){const n=this,r=new Promise(function(t,r){const a=L(e);"object"!=typeof e||e.id||(e.id=TC.getUID());let s=e.options?e.options.zIndex:e.zIndex;"number"!=typeof s&&(s=a?0:1);n._layerBuffer.add(e.id||e,s,e.isBase);if(n.getLayer(e.id)){const t=Error(`Layer "${e.id}" already exists`);t.layerId=e.id;r(t)}else{var i,c,u;if(a){c=!TC.layer||!TC.layer.Raster;u=TC.apiLocation+"TC/layer/Raster"}else{c=!TC.layer||!TC.layer.Vector;u=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(c,[u],function(){if("string"==typeof e)i=new TC.layer.Raster(TC.Util.extend({},l.call(n,e),{map:n}));else if(e instanceof TC.Layer)(i=e).map=n;else{e.map=n;i=e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e)}Promise.all([n.wrap.getMap(),i.wrap.getLayer()]).then(function(){n.trigger(TC.Consts.event.BEFORELAYERADD,{layer:i});var a;if(L(i)){!function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){const n=this;if(!n._tileloaderror){const r=e.getPath(),o=r.length?r[r.length-1]:e.title;e.map.toast(TC.Util.getLocaleString(e.map.options.locale,"tileload.error",{name:o,error:t.error.text}),{type:TC.Consts.msgType.ERROR});n._tileloaderror=!0;const a=function(e){if(e.tile.src&&e.tile.src!==TC.Consts.BLANK_IMAGE){delete n._tileloaderror;n.$events.off(TC.Consts.event.TILELOAD,a)}};n.$events.on(TC.Consts.event.TILELOAD,a)}})}(i);a=n.wrap.indexOfFirstVector()}-1===a&&(a=n.wrap.getLayerCount());const s=n.state&&n.state.crs?n.state.crs:n.getCRS();TC.loadProjDef({crs:s,callback:function(){const a=i.isCompatible(s);if(i.isBase){if(!a)if(!i.type===TC.Consts.layerType.WMTS)i.mustReproject=!0;else{const e=i.wrap.getCompatibleMatrixSets(s)[0];e?i.wrap.setMatrixSet(e):i.mustReproject=!0}n.state?i.isDefault=n.state.base===i.id||n.state.base===i.options.fallbackLayer:"string"==typeof n.options.defaultBaseLayer?i.isDefault=n.options.defaultBaseLayer===i.id:"number"==typeof n.options.defaultBaseLayer&&(i.isDefault=n.options.defaultBaseLayer===n.baseLayers.length);if(i.isDefault){var l;if(i.mustReproject&&!i.type===TC.Consts.layerType.WMTS||i.mustReproject&&i.type===TC.Consts.layerType.WMTS&&!i.wrap.getCompatibleMatrixSets(s)[0])if(i.options.fallbackLayer&&i.getFallbackLayer)n.addLayer(i.getFallbackLayer()).then(function(e){n.wrap.setBaseLayer(e.wrap.layer);n.baseLayer=e.wrap.parent;o(l);t(i)});else{p(n,i);const t=Error("Layer "+i.id+" incompatible with CRS");t.layerId=e.id;r(t)}else{l=null===n.baseLayer;i.wrap.getLayer().then(function(e){n.wrap.setBaseLayer(e);n.baseLayer=i;o(l);t(i)})}}else t(i)}else if(a)i.wrap.getLayer().then(function(e){t(i)});else{p(n,i);if(i.isValidFromNames()){const t=Error("Layer "+i.id+" incompatible with CRS");t.layerId=e.id;r(t)}else t(i)}}})},function(t){t.layerId=e.id;r(t)})})}});r.then(function(e){n._layerBuffer.resolve(n,e,e.isBase);e.isBase||n.wrap.insertLayer(e.wrap.layer,n._layerBuffer.getResolvedVisibleLayerIndex(n,e.id));n.trigger(TC.Consts.event.LAYERADD,{layer:e});n._layerBuffer.checkMapLoad(n);TC.Util.isFunction(t)&&t(e)}).catch(function(e){n._layerBuffer.reject(n,e);n._layerBuffer.checkMapLoad(n)});const o=function(e){if(e){var t={projection:n.wrap.map.getView().getProjection(),extent:n.initialExtent},r=n.baseLayer.getResolutions();if(r&&r.length)t.resolutions=r;else{t.minZoom=n.wrap.map.getView().getMinZoom();t.maxZoom=n.wrap.map.getView().getMaxZoom();var o=n.baseLayer.wrap.layer.getMinResolution();0!==o&&(t.minResolution=o);var a=n.baseLayer.wrap.layer.getMaxResolution();a!==Number.POSITIVE_INFINITY&&(t.maxResolution=a)}n.wrap.map.setView(new ol.View(t));n.wrap.map.getView().fit(n.initialExtent)}};return r};y.removeLayer=function(e){const t=this;return new Promise(function(n,r){if(e.unremovable)return r("Unremovable");let o=!1;for(var a=0;a<t.layers.length;a++)if(t.layers[a]===e){t.layers.splice(a,1);o=!0;break}if(o){if(e.isBase){for(a=0;a<t.baseLayers.length;a++)if(t.baseLayers[a]===e){t.baseLayers.splice(a,1);t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(a=0;a<t.workLayers.length;a++)if(t.workLayers[a]===e){t.workLayers.splice(a,1);break}e===t.vectors&&(t.vectors=null)}e.wrap.getLayer().then(function(r){t.wrap.removeLayer(r);t._layerBuffer.remove(e.id);t.trigger(TC.Consts.event.LAYERREMOVE,{layer:e});t._layerBuffer.checkMapLoad(t);n(e)})}else r(new Error(`Layer ${e.id} not found in map`))})};y.insertLayer=function(e,t,n){for(var r=this,o=-1,a=0;a<r.layers.length;a++)if(e===r.layers[a]){o=a;break}var s=[];s.push(e.wrap.getLayer());var i=r.layers[t];i&&s.push(i.wrap.getLayer());Promise.all(s).then(function(a){const s=a[0],i=a[1];var l=-1;if((l=i?r.wrap.getLayerIndex(i):r.wrap.getLayerCount())>=0){e.map=r;r.wrap.insertLayer(s,l);o>-1&&r.layers.splice(o,1);r.layers.splice(t,0,e);r.workLayers=r.layers.filter(function(e){return!e.isBase});r.trigger(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:o,newIndex:t})}TC.Util.isFunction(n)&&n()})};y.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.layer,t)};y.putLayerOnTop=function(e){var t=this.wrap.getLayerCount();this.setLayerIndex(e,t-1)};y.setBaseLayer=function(e,t){var n=this,r=null,o=!1;if("string"==typeof e){var a;for(a=0;a<n.layers.length;a++)if(n.layers[a].id===e){e=n.layers[a];o=!0;break}if(!o&&(e=l.call(n,e))){e=n.addLayer(TC.Util.extend(!0,{},e,{isDefault:!0,map:n}));o=!0}}else{if(n.layers.indexOf(e)<0){e.isDefault=!0;e.map=n;n.addLayer(e)}o=!0}if(o)if(e.isCompatible(n.getCRS())||e.fallbackLayer&&(!e.fallbackLayer||e.fallbackLayer.isCompatible(n.getCRS()))){n.trigger(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:n.getBaseLayer(),newLayer:e});r=e;n.wrap.getMap().then(function(r){e.wrap.getLayer().then(function(r){n.wrap.setBaseLayer(r).then(function(){n.baseLayer=e;n.trigger(TC.Consts.event.BASELAYERCHANGE,{layer:e});TC.Util.isFunction(t)&&t()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return r};y.setView=function(e){this.view=e;this.trigger(TC.Consts.event.VIEWCHANGE,{view:e})};y.ready=function(e){TC.Util.isFunction(e)&&(this.isReady?e():this.one(TC.Consts.event.MAPREADY,e))};y.loaded=function(e){TC.Util.isFunction(e)&&(this.isLoaded?e():this.one(TC.Consts.event.MAPLOAD,e))};y.getLayerTree=function(){var e={baseLayers:[],workLayers:[]};this.baseLayer&&(e.baseLayers[0]=this.baseLayer.getTree());for(var t=0;t<this.workLayers.length;t++){var n=this.workLayers[t].getTree();n&&e.workLayers.unshift(n)}return e};y.addControl=function(e,t){const n=this;return new Promise(function(r,o){const a=function(e){n.controls.push(e);return Promise.resolve(e.register(n)).then(function(t){e.div.parentElement||n.div.appendChild(e.div);n.trigger(TC.Consts.event.CONTROLADD,{control:e});return t}).catch(function(e){o(e instanceof Error?e:Error(e))})};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e],function(){a(new TC.control[e](null,t)).then(function(e){r(e)})})}else a(e).then(function(e){r(e)})})};y.getControlsByClass=function(e){var t=[],n=e;if("string"==typeof e){n=window;for(var r=e.split("."),o=0;o<r.length&&(n=n[r[o]]);o++);}if(TC.Util.isFunction(n))for(o=0;o<this.controls.length;o++){var a=this.controls[o];a instanceof n&&t.push(a)}return t};y.getControlById=function(e){const t=this;for(var n=0,r=t.controls.length;n<r;n++){const r=t.controls[n];if(r.id===e)return r}return null};y.getDefaultControl=function(){const e=this;var t;e.options.defaultActiveControl&&(t=e.getControlsByClass("TC.control."+e.options.defaultActiveControl.substr(0,1).toUpperCase()+e.options.defaultActiveControl.substr(1))[0]);t||(t=(t=e.getControlsByClass("TC.control.MultiFeatureInfo")[0])?t.lastCtrlActive:e.getControlsByClass("TC.control.FeatureInfo")[0]);return t};y.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};y.setExtent=function(e,t){return this.wrap.setExtent(e,t)};y.getExtent=function(){return this.wrap.getExtent()};y.setCenter=function(e,t){return this.wrap.setCenter(e,t)};y.getCenter=function(){return this.wrap.getCenter()};y.setRotation=function(e){this.wrap.setRotation(e)};y.getRotation=function(){return this.wrap.getRotation()};y.getViewHTML=function(){return this.wrap.getViewport()};y.getCompatibleCRS=function(e){const t=((e=e||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(e){return e.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})}),n=t.slice(1);return t[0].filter(function(e){return n.every(function(t){return t.indexOf(e)>=0})})};y.loadProjections=function(e){e=e||{};return new Promise(function(t,n){const r=e.crsList||[];Promise.all(r.map(function(e){return TC.getProjectionData({crs:TC.Util.getCRSCode(e)})})).then(function(n){var r=n.filter(function(e){return"ok"===e.status&&e.number_result>0}).map(function(e){const t=e.results[0],n="EPSG:"+t.code;TC.loadProjDef({crs:n,def:t.def,name:t.name});return{code:n,name:t.name,proj4:t.proj4,unit:t.unit}});e.orderBy&&(r=r.sort(TC.Util.getSorterByProperty(e.orderBy)));t(r)},function(e){n(e)})})};y.setProjection=function(e){const t=this;e=e||{};return new Promise(function(n,r){var o;if(e.crs){e.baseLayer?o=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(o=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(o=t.baseLayer.getFallbackLayer()));o||(o=t.baseLayer);const a=function(){TC.loadProjDef({crs:e.crs,callback:function(){const a=t.crs,s=function(o){const i=function(){const i=TC.Util.extend({},e,{oldCrs:t.crs}),l=function(e){e.setProjection(i)};if(o.isCompatible(e.crs)||o.wrap.getCompatibleMatrixSets(e.crs).length>0){o.setProjection(i);t.wrap.setProjection(TC.Util.extend({},e,{baseLayer:o}));t.crs=e.crs;t.baseLayers.filter(function(e){return e!==o}).forEach(l);t.workLayers.forEach(l);const r=function(){t.trigger(TC.Consts.event.PROJECTIONCHANGE,{oldCrs:a,newCrs:e.crs});n()};o&&o!==t.baseLayer?t.setBaseLayer(o,r):r()}else o.fallbackLayer?s(o.fallbackLayer):r(Error("Layer has no fallback"))};o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WMTS?o.getCapabilitiesPromise().then(i):i()};s(o)}})};t.baseLayers.indexOf(o)<0?t.addLayer(o).then(a):a()}})};y.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};y.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};y.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};y.zoomToFeatures=function(e,t){if(e.length>0){var n=[1/0,1/0,-1/0,-1/0],r=t||{},o=r.pointBoundsRadius||this.options.pointBoundsRadius;o/=this.getMetersPerUnit();var a=r.extentMargin;"number"!=typeof a&&(a=this.options.extentMargin);for(var s=0;s<e.length;s++){var i=e[s].getBounds();if(i){n[0]=Math.min(n[0],i[0]);n[1]=Math.min(n[1],i[1]);n[2]=Math.max(n[2],i[2]);n[3]=Math.max(n[3],i[3])}}if(n[2]-n[0]==0){n[0]=n[0]-o;n[2]=n[2]+o}if(n[3]-n[1]==0){n[1]=n[1]-o;n[3]=n[3]+o}if(this.options.extentMargin){var l=(n[2]-n[0])*a/2,c=(n[3]-n[1])*a/2;n[0]=n[0]-l;n[1]=n[1]-c;n[2]=n[2]+l;n[3]=n[3]+c}if(this.options.maxExtent){n[0]=Math.max(n[0],this.options.maxExtent[0]);n[1]=Math.max(n[1],this.options.maxExtent[1]);n[2]=Math.min(n[2],this.options.maxExtent[2]);n[3]=Math.min(n[3],this.options.maxExtent[3])}this.wrap.setExtent(n,r);this.trigger(TC.Consts.event.ZOOMTO,{extent:n})}};y.zoomToMarkers=function(e){var t=this;Promise.all(t._markerPromises).then(function(){for(var n=[],r=0;r<t.workLayers.length;r++){var o=t.workLayers[r];if(o.type===TC.Consts.layerType.VECTOR)for(var a=0;a<o.features.length;a++){var s=o.features[a];s instanceof TC.feature.Marker&&(n[n.length]=s)}}t.zoomToFeatures(n,e);t._markerPromises=[]})};y.getLayer=function(e){const t=this;var n=null;if("string"==typeof e){for(var r=0;r<t.layers.length;r++)if(t.layers[r].id===e){n=t.layers[r];break}}else TC.Layer&&e instanceof TC.Layer&&e.map===t&&(n=e);return n};var C=function(e){var t;if(e.vectors)t=Promise.resolve(e.vectors);else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;t.then(function(t){e.vectors=t})}return t};y.addPoint=function(e,t){if(t&&t.layer){var n=this.getLayer(t.layer);if(!n)throw new Error('Layer "'+t.layer+'" not found');n.addPoint(e,t)}else C(this).then(function(n){n.addPoint(e,t)})};y.addMarker=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r?n._markerPromises.push(r.addMarker(e,t)):n._markerPromises.push(Promise.reject(new Error('Layer "'+t.layer+'" not found')))}else n._markerPromises.push(new Promise(function(r,o){C(n).then(function(n){n.addMarker(e,t).then(function(e){r(e)})})}))};y.addPolyline=function(e,t){if(t&&t.layer){if(!this.getLayer(t.layer))throw new Error('Layer "'+t.layer+'" not found');t.layer.addPolyline(e,t)}else C(this).then(function(n){n.addPolyline(e,t)})};y.addPolygon=function(e,t){if(t&&t.layer){if(!this.getLayer(t.layer))throw new Error('Layer "'+t.layer+'" not found');t.layer.addPolygon(e,t)}else C(this).then(function(n){n.addPolygon(e,t)})};y.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};y.getResolutions=function(){return this.wrap.getResolutions()};y.getResolution=function(){return this.wrap.getResolution()};y.setResolution=function(e){this.wrap.setResolution(e)};y.exportFeatures=async function(e,t){t=t||{};var n=this.getLoadingIndicator(),r=n&&n.addWait();const o=t.format===TC.Consts.format.GPX?Number.NaN:0;e.forEach(function(t,n){const r=t.getData();for(let e in r)if(/&(\w+|#\d{2,4});/g.test(e)){const n=r[e],o={},a=document.createElement("div");a.innerHTML=e;o[a.innerText]=n;t.unsetData(e);t.setData(o)}var a=t.getCoords({pointArray:!0});if(a.some(function(e){return null===e[2]})){e[n]=t=t.clone();(a=t.getCoords({pointArray:!0})).forEach(function(e){null===e[2]&&(e[2]=o)})}});const a=this.wrap.exportFeatures(e,t),s=TC.Consts.mimeType[t.format],i=t.format||"";if(i===TC.Consts.format.KMZ){var l=new JSZip,c=t.fileName||TC.getUID();l.file(c+".kml",a);l.generateAsync({type:"blob",mimeType:s}).then(function(e){filename=c+".kmz";TC.Util.downloadBlob(filename,e);n&&n.removeWait(r)})}else{TC.Util.downloadFile((t.fileName||TC.getUID())+"."+i.toLowerCase(),s,a);n&&n.removeWait(r)}};var d={},h=function(){const e=this;var t=e;do{t=t.parentElement}while(t&&!t.matches(".tc-toast-container"));const n=e.innerHTML;e.classList.add(TC.Consts.classes.HIDDEN);void 0!==d[n]&&(d[n]=void 0);setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e);t&&!t.querySelector(".tc-toast")&&t.parentElement&&t.parentElement.removeChild(t)},1e3)};y.toastHide=function(e){var t=d[e];if(t){clearTimeout(t.timeout);t.toast&&t.toast.parentElement&&t.toast.parentElement.removeChild(t.toast);t.toast=null}};y.toast=function(e,t){const n=this;var r=t||{},o=r.duration||TC.Cfg.toastDuration,a=d[e];if(a){clearTimeout(a.timeout);a.toast&&a.toast.parentElement&&a.toast.parentElement.removeChild(a.toast);a.toast=null}var s=n.div.querySelector(".tc-toast-container");if(!s){(s=document.createElement("div")).classList.add("tc-toast-container");(r.container?r.container:n.div).appendChild(s)}const i=document.createElement("div"),l=document.createElement("span");i.classList.add("tc-toast");i.appendChild(l);const c=document.createElement("p");c.innerHTML=e;i.appendChild(c);i.addEventListener(TC.Consts.event.CLICK,h);s.appendChild(i);a=d[e]={toast:i};var u="";switch(r.type){case TC.Consts.msgType.INFO:u=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:u=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:u=TC.Consts.classes.ERROR}u.length&&a.toast.classList.add(u);a.timeout=setTimeout(function(){h.call(a.toast)},o)};var T=!1,g=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.getBoundingClientRect.height===t+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(T=!0)}var n=function(){e.classList.toggle(TC.Consts.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};if(T){n();window.addEventListener("resize",n)}else window.removeEventListener("resize",n)},L=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS};y.exportImage=function(){var e=null,t="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",n=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(n&&this.options.crossOrigin)try{e=n.toDataURL()}catch(e){TC.error(t+": "+e.message)}else TC.error(t);return e}}();
//# sourceMappingURL=maps/Map.min.js.map