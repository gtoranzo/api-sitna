TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);e.drawControls=[];e.persistentDrawControls=!1;e.NOMEASURE="-";e.exportsState=!0;this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._len=e.div.querySelector(".tc-ctl-meas-val-len");e._area=e.div.querySelector(".tc-ctl-meas-val-area");e._peri=e.div.querySelector(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.control.Measure.units={m:{peso:0,abbr:"m&sup2;"},dam:{peso:1,abbr:"dam&sup2;"},hm:{peso:2,abbr:"hm&sup2;"},ha:{peso:2,abbr:"ha"},km:{peso:3,abbr:"km&sup2;"}};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}t.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(`.${TC.control.Measure.prototype.CLASS}-select span`).forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var o=this;o&&"LABEL"!==o.tagName;)o=o.parentElement;var n=o.querySelector("input[type=radio][name=mode]"),s=n.value;n.checked=!0;t.setMode(s,!0)})});TC.Util.isFunction(e)&&e()})}))};e.register=function(e){const t=this;return new Promise(function(o,n){TC.Control.prototype.register.call(t,e).then(function(){t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.trigger(TC.Consts.event.DRAWEND)});const s=t.getUID(),r=t.getUID(),a=t.getUID();t.units=t.options.units?t.options.units:"km";t.layerPromise=e.addLayer({id:s,title:t.getLocaleString("measure"),owner:t,stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}});t.units=t.options.units?t.options.units:"km";Promise.all([t.layerPromise,t.renderPromise()]).then(function(s){const i=s[0];t.layer=i;t.layer.map.putLayerOnTop(t.layer);t._lineDrawControlPromise=e.addControl("draw",{id:r,div:t.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});t._polygonDrawControlPromise=e.addControl("draw",{id:a,div:t.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});Promise.all([t._lineDrawControlPromise,t._polygonDrawControlPromise]).then(function(e){t.lineDrawControl=e[0];t.polygonDrawControl=e[1];e.forEach(function(e){e.containerControl=t;t.drawControls.push(e);e.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(e){t.showMeasures(e)}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)});e.exportsState=!1});o(t);t.setMode(t.options.mode)}).catch(n)}).catch(n)})})};e.displayMode=function(e){const t=this,o=[];t.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(e){o.push(e)});switch(e){case TC.Consts.geom.POLYLINE:t._activeMode=o.filter(function(e){return e.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:t._activeMode=o.filter(function(e){return e.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:t._activeMode=null}const n=o.filter(function(e){return e!==t._activeMode});if(e){t.div.querySelector("input[type=radio][name=mode][value="+e+"]").checked=!0}else t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.checked=!1});if(t._activeMode){t._activeMode.classList.remove(TC.Consts.classes.HIDDEN);t._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}n.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});return t};e.setMode=function(e){const t=this;t.mode=e;t.displayMode(e);var o;switch(e){case TC.Consts.geom.POLYLINE:t.lineDrawControl.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:t.polygonDrawControl.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach(function(e){e.isActive&&e.cancel()});o=TC.Consts.event.CONTROLDEACTIVATE;break;default:o=TC.Consts.event.CONTROLACTIVATE}t.resetValues();o&&t.map&&t.map.trigger(o,{control:t});return t};e.cancel=function(){this.setMode(null,!1);return this};e.showMeasures=function(e){const t=this;var o,n=(e=e||{}).units;const s=t.map.options.locale||TC.Cfg.locale;if(e.area){var r=e.area;let o=[];(t.units instanceof Array?t.units:t.units.split(",")).forEach(function(e){const t=TC.control.Measure.units[e.trim()].peso-TC.control.Measure.units.m.peso;if(r>Math.pow(100,t-1)){let n="m"===e?0:3;o.push(TC.Util.formatNumber((r/Math.pow(100,t)).toFixed(n),s)+" "+TC.control.Measure.units[e].abbr)}});t._area.innerHTML=o.join("/")}if(e.perimeter){var a=e.perimeter;if(a>1e3){a/=1e3;n="km"}o="m"===n?0:3;t._peri.innerHTML=TC.Util.formatNumber(a.toFixed(o),s)+" "+n}if(e.length){var i=e.length;if(i>1e3){i/=1e3;n="km"}o="m"===n?0:3;t._len.innerHTML=TC.Util.formatNumber(i.toFixed(o),s)+" "+n}return t};e.resetValues=function(){const e=this;if(e._len){e._len.textContent=e.NOMEASURE;e._area.textContent=e.NOMEASURE;e._peri.textContent=e.NOMEASURE}return e};e.getDrawLines=function(){};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.layerPromise.then(function(t){t.importState(e.layer)})}}();
//# sourceMappingURL=../maps/control/Measure.min.js.map