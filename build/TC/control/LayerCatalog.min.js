TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var t=TC.control.LayerCatalog.prototype;t.CLASS="tc-ctl-lcat";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";t.template[t.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";t.template[t.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";t.template[t.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/LayerCatalogDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"availableLayers"}).x(e.get(["enableSearch"],!1),e,{block:s},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",e,{},{$key:"textToSearchInLayers"}).w('"></input></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(e.get(["layerTrees"],!1),e,{else:n,block:o},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",e,e.rebase(e.getPath(!0,[])),{}).w("</div>")}e.__dustBody=!0;function s(t,e){return t.x(e.get(["layerTrees"],!1),e,{block:a},{})}s.__dustBody=!0;function a(t,e){return t.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",e,{},{$key:"searchLayersbytext"}).w('"></button>')}a.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",e,{},{$key:"loadingLayerTree"}).w("...</span></div>")}n.__dustBody=!0;function o(t,e){return t.w('<ul class="tc-ctl-lcat-branch">').s(e.get(["layerTrees"],!1),e,{block:r},{}).w("</ul>")}o.__dustBody=!0;function r(t,e){return t.p("tc-ctl-lcat-branch",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:s,block:a},{}).w(' data-tc-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-tc-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-lcat-collapse-btn"></button><span>').f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:n},{}).w("</ul></li>")}e.__dustBody=!0;function s(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}s.__dustBody=!0;function a(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}a.__dustBody=!0;function n(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}n.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.x(e.get(["isVisible"],!1),e,{block:s},{})}e.__dustBody=!0;function s(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:a,block:n},{}).w(' data-tc-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-tc-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:o},{}).w('<span data-tooltip="').x(e.get(["name"],!1),e,{block:r},{}).w('">').f(e.get(["title"],!1),e,"h").w("</span>").x(e.get(["name"],!1),e,{block:l},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:c},{}).w("</ul></li>")}s.__dustBody=!0;function a(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}a.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}n.__dustBody=!0;function o(t,e){return t.w('<button class="tc-ctl-lcat-collapse-btn"></button>')}o.__dustBody=!0;function r(t,e){return t.h("i18n",e,{},{$key:"clickToAddToMap"})}r.__dustBody=!0;function l(t,e){return t.w('<button title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('" class="tc-ctl-lcat-btn-info"></button>')}l.__dustBody=!0;function c(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}c.__dustBody=!0;return e};t.template[t.CLASS+"-info"]=function(){dust.register(t.CLASS+"-info",e);function e(t,e){return t.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",e,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(e.get(["title"],!1),e,"h").w("</h3>").x(e.get(["abstract"],!1),e,{block:s},{}).x(e.get(["metadata"],!1),e,{block:a},{})}e.__dustBody=!0;function s(t,e){return t.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",e,{},{$key:"abstract"}).w("</h4><div><pre>").f(e.get(["abstract"],!1),e,"h",["s"]).w("</pre></div></div>")}s.__dustBody=!0;function a(t,e){return t.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",e,{},{$key:"metadata"}).w("</h4><ul>").s(e.get(["metadata"],!1),e,{block:n},{}).w("</ul></div>")}a.__dustBody=!0;function n(t,e){return t.w('<li><a href="').f(e.get(["url"],!1),e,"h",["s"]).w('" type="').f(e.get(["format"],!1),e,"h").w('" title="').f(e.get(["formatDescription"],!1),e,"h").w('" target="_blank">').f(e.get(["formatDescription"],!1),e,"h",["s"]).w("</a></li>")}n.__dustBody=!0;return e};t.template[t.CLASS+"-results"]=function(){dust.register(t.CLASS+"-results",e);function e(t,e){return t.s(e.get(["servicesFound"],!1),e,{else:s,block:a},{})}e.__dustBody=!0;function s(t,e){return t.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",e,{},{$key:"noMatches"}).w("</h5></li>")}s.__dustBody=!0;function a(t,e){return t.h("gt",e,{block:n},{key:e.get(["servicesLooked"],!1),value:1}).s(e.get(["founds"],!1),e,{block:r},{}).h("gt",e,{block:i},{key:e.get(["servicesLooked"],!1),value:1})}a.__dustBody=!0;function n(t,e){return t.w('<li class="tc-ctl-lcat-search-group ').x(e.getPath(!1,["service","isCollapsed"]),e,{block:o},{}).w('" data-tc-service-index="').f(e.getPath(!1,["service","index"]),e,"h").w('"><h5>').f(e.getPath(!1,["service","title"]),e,"h").w("</h5><ul>")}n.__dustBody=!0;function o(t,e){return t.w("tc-collapsed")}o.__dustBody=!0;function r(t,e){return t.w('<li data-tc-layer-name="').f(e.get(["Name"],!1),e,"h").w('" ').x(e.get(["alreadyAdded"],!1),e,{else:l,block:c},{}).w('><h5 class="tc-selectable">').f(e.get(["Title"],!1),e,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('"></button></li>')}r.__dustBody=!0;function l(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"clickToAddToMap"}).w('" ')}l.__dustBody=!0;function c(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}c.__dustBody=!0;function i(t,e){return t.w("</ul></li>")}i.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}var e="tcLayer",s="tcLayerName",a="tcLayerInfo",n="tcServiceIndex";const o=function(t,e){t.showProjectionChangeDialog({layer:e,closeCallback:function(){t.getLayerNodes(e).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.querySelector("span").setAttribute(r,t.getLocaleString("clickToAddToMap"))})}})};var r="data-tooltip";t.register=function(t){const s=this,a=TC.control.ProjectionSelector.prototype.register.call(s,t),n=function(t,e){if($.isArray(s.options.layers)){for(var a=0;a<s.options.layers.length;a++){var n=s.options.layers[a];if(!n.type||n.type===TC.Consts.layerType.WMS){n.id||(n.id=TC.getUID());$.isPlainObject(n)&&(n=new TC.layer.Raster(n));s.layers.push(n)}}s.render(function(){t()})}else t()};s._readyPromise=new Promise(function(e,s){const a=function(s){if(s.layer===t.baseLayer){n(e);t.off(TC.Consts.event.LAYERUPDATE,a)}};t.loaded(function(){t.baseLayer.state&&t.baseLayer.state!==TC.Layer.state.IDLE?t.on(TC.Consts.event.LAYERUPDATE,a):n(e)})});var o=function(){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("keyup",!1,!0);s.textInput&&s.textInput.dispatchEvent(t)}else s.textInput&&s.textInput.fireEvent("keyup")};var l=s.getLocaleString("layerAlreadyAdded"),c=s.getLocaleString("clickToAddToMap");t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(t){s.getLayerNodes(t.layer).forEach(function(t){t.classList.add(TC.Consts.classes.LOADING);t.querySelector("span").removeAttribute(r)})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(t){const e=t.layer;e.isBase||e.type!==TC.Consts.layerType.WMS||s.loaded().then(function(){const t=function(){s.getLayerNodes(e).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").setAttribute(r,l)});o()};if(s.getLayerRootNode(e))t();else{for(var a=!1,n=0,c=s.layers.length;n<c;n++){var i=s.layers[n];if(i.type===e.type&&i.options.url===e.options.url){a=!0;break}}a||s.addLayer(new TC.layer.Raster({url:e.options.url,type:e.type,layerNames:[],title:e.title||e.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){t()})}})}).on(TC.Consts.event.LAYERERROR,function(t){const e=t.reason;e&&TC.alert(s.getLocaleString(e,{url:t.layer.url}));s.getLayerNodes(t.layer).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING)})}).on(TC.Consts.event.LAYERREMOVE,function(t){const a=t.layer;s.getLayerNodes(a).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.querySelector("span").setAttribute(r,c)});(function(t){const a=[];if(!t.isBase){var n=t.options.url;s.list&&s.list.querySelectorAll("li").forEach(function(s){var o=$(s).data(e);if(o&&o.type===t.type&&o.options.url===n)for(var r=0;r<t.names.length;r++)s.dataset.tcLayerName===t.names[r]&&a.push(s)})}return a})(a).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.setAttribute(r,c)});!function(t){var e=s.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(e)for(var a=e.layers,n=0;n<a.length;n++){var o=a[n];o!==t&&s.getLayerNodes(o).forEach(function(t){t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").setAttribute(r,l)})}}(a);o()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){if(t&&t.layer){s.addLayer(t.layer);s.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(t){s.update()});return a};const l=function(t){t.target.blur();t.stopPropagation();const e=t.target.parentElement;if("LI"===e.tagName&&!e.classList.contains(self.CLASS+"-leaf")){e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED);const t=e.querySelector("ul");t.classList.contains(TC.Consts.classes.COLLAPSED)?t.classList.remove(TC.Consts.classes.COLLAPSED):t.classList.add(TC.Consts.classes.COLLAPSED)}};t.render=function(t){const c=this;return c._set1stRenderPromise(new Promise(function(i,u){const d=$.map(c.layers,function(t){return t.wrap.getLayer()});Promise.all(d).then(function(){var d=$.map(c.layers,function(t){var e=t.getTree();!function e(s){for(var a=!1,n=0;n<s.children.length;n++)e(s.children[n])&&(a=!0);s.hasOwnProperty("isVisible")&&(s.isVisible=!t.names||!t.names.length||a||s.isVisible);return s.isVisible}(e);return e});c.renderData({layerTrees:d,enableSearch:c.options.enableSearch},function(){const i=c.getLocaleString("layerAlreadyAdded");c.div.querySelectorAll("li > button."+c.CLASS+"-collapse-btn").forEach(function(t){t.addEventListener("click",l)});c.div.querySelectorAll("span").forEach(function(t){t.addEventListener("click",function(t){!function(t,a){const n=t.target.parentNode;if(!n.classList.contains(TC.Consts.classes.LOADING)&&!n.classList.contains(TC.Consts.classes.CHECKED)){t.preventDefault;var o,l=$(n).data(s);l=void 0!==l?l.toString():"";for(var c=0,i=a._roots.length;c<i;c++){const t=a._roots[c];if(t.contains(n)){o=$(t).data(e);break}}o||(o=$(n).data(e));if(o&&l){var u=1;/iPad/i.test(navigator.userAgent)?u=10:TC.Util.detectFirefox()&&(u=250);o.title||(o.title=o.getTree().title);n.classList.add(TC.Consts.classes.LOADING);n.querySelector("span").setAttribute(r,"");(d=n,new Promise(function(t,e){setTimeout(function(){d.offsetHeight=d.offsetHeight;d.offsetWidth=d.offsetWidth;t()},u)})).then(function(){a.addLayerToMap(o,l)});t.stopPropagation()}}var d}(t,c)})});c._roots=c.div.querySelectorAll(c._selectors.LAYER_ROOT);c._roots.forEach(function(t,n){var o=c.layers[n];$(t).data(e,o);var l={};t.querySelectorAll("."+c.CLASS+"-btn-info").forEach(function(t){const e=t.parentElement.querySelector("span"),n=$(t.parentElement).data(s).toString();if(n){e.classList.add(TC.Consts.classes.SELECTABLE);var u=o.wrap.getInfo(n);if(u.hasOwnProperty("abstract")||u.hasOwnProperty("legend")||u.hasOwnProperty("metadata")){if(u.metadata)for(var d=0,C=u.metadata.length;d<C;d++){var f=u.metadata[d];f.formatDescription=l[f.format]=l[f.format]||c.getLocaleString(TC.Util.getSimpleMimeType(f.format))||c.getLocaleString("viewMetadata")}$(t).data(a,u);t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation();const e=this;if(e.classList.contains(TC.Consts.classes.CHECKED)){e.classList.remove(TC.Consts.classes.CHECKED);c.hideLayerInfo()}else{c.showLayerInfo(o,n);e.classList.add(TC.Consts.classes.CHECKED)}})}else t.parentElement.removeChild(t);if(o.compatibleLayers&&o.compatibleLayers.indexOf(n)<0){e.classList.add(TC.Consts.classes.INCOMPATIBLE);e.setAttribute("title",c.getLocaleString("reprojectionNeeded"))}if(c.map)for(d=0,C=c.map.workLayers.length;d<C;d++){var L=c.map.workLayers[d];if(L.type===TC.Consts.layerType.WMS&&L.url===o.url&&1===L.names.length&&L.names[0]===n){e.parentElement.classList.add(TC.Consts.classes.CHECKED);e.setAttribute(r,i)}}}else{e.setAttribute(r,"");t.parentElement.removeChild(t)}})});c.getRenderedHtml(c.CLASS+"-dialog",null,function(t){c._dialogDiv.innerHTML=t});c.textInput=c.div.querySelector("."+c.CLASS+"-input");c.list=c.div.querySelector("."+c.CLASS+"-search ul");c.textInput.addEventListener("mouseup",function(t){""!==c.textInput.value&&setTimeout(function(){""===c.textInput.value&&(c.list.innerHTML="")},1)});var u=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(c.textInput,{link:"#",target:c.list,minLength:0,source:function(t,e){u=[];c._roots.forEach(function(t){t.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(t){u.push($(t).data(s).toString())})});if((t=t.trim()).length<3)c.list.innerHTML="";else if(t.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var s=[],a=0;a<c.layers.length;a++){var n=c.layers[a].searchSubLayers(t);n.length&&s.push({service:{index:a,title:c.layers[a].title||c.layers[a].id},founds:n})}e({servicesFound:s,servicesLooked:c.layers.length})},TC._search.interval)}},callback:function(t){c.textInput.value=t.target.text||t.target.innerText;TC._search.lastPattern=c.textInput.value;c.goToResult(unescape(t.target.hash).substring(1));TC.UI.autocomplete.call(c.textInput,"clear")},buildHTML:function(t){if(t.results&&t.results.servicesFound.length>0)for(var e=c.map.getLayerTree().workLayers,s=0;s<t.results.servicesFound.length;s++){for(var a=t.results.servicesFound[s].founds,n=0;n<a.length;n++){delete a[n].alreadyAdded;for(var o=0;o<e.length;o++)if(u.indexOf(a[n].Name)>=0){a[n].alreadyAdded=!0;break}if(!a[n].Name){a.splice(n,1);n--}}t.results.servicesFound[s].founds.length?c.div.querySelectorAll(".tc-ctl-lcat-search-group")[s]&&(t.results.servicesFound[s].service.isCollapsed=c.div.querySelectorAll(".tc-ctl-lcat-search-group")[s].classList.contains(TC.Consts.classes.COLLAPSED)):t.results.servicesFound.splice(s,1)}var r="";dust.render(c.CLASS+"-results",t.results,function(t,e){r=e});return r}})});if(!c.searchInit){c.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2 button",function(t){const e=c.div.classList.contains(TC.Consts.classes.COLLAPSED);c.div.classList.remove(TC.Consts.classes.COLLAPSED);const s=c.div.querySelector("."+c.CLASS+"-search"),a=c.div.querySelector("."+c.CLASS+"-tree"),n=c.div.querySelector("."+c.CLASS+"-info");if(s.classList.contains(TC.Consts.classes.HIDDEN)||e){s.classList.remove(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.HIDDEN);c.textInput.focus();t.target.classList.add(c.CLASS+"-btn-tree");t.target.setAttribute("title",c.getLocaleString("viewAvailableLayersTree"));t.target.classList.remove(c.CLASS+"-btn-search");0===c.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&n.classList.add(TC.Consts.classes.HIDDEN)}else{s.classList.add(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.HIDDEN);t.target.classList.add(c.CLASS+"-btn-search");t.target.setAttribute("title",c.getLocaleString("searchLayersByText"));t.target.classList.remove(c.CLASS+"-btn-tree");c.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&n.classList.remove(TC.Consts.classes.HIDDEN)}}));c.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+c.CLASS+"-search button."+c.CLASS+"-search-btn-info",function(t){t.stopPropagation();const e=t.target;if(e.classList.contains(TC.Consts.classes.CHECKED)){e.classList.remove(TC.Consts.classes.CHECKED);c.hideLayerInfo()}else{const t=e.parentElement;var a=t;do{a=a.parentElement}while(a&&"LI"!==a.tagName);c.showLayerInfo(c.layers.length>1?c.layers[$(a).data(n)]:c.layers[0],$(t).data(s));e.classList.add(TC.Consts.classes.CHECKED)}}));const t="."+c.CLASS+" li";c.div.addEventListener("click",TC.EventTarget.listenerBySelector(t,function(a){a.stopPropagation();for(var l=a.target;l&&!l.matches(t);)l=l.parentElement;if(!l.classList.contains(c.CLASS+"-no-results"))if(l.classList.contains(c.CLASS+"-search-group"))l.classList.contains(TC.Consts.classes.COLLAPSED)?l.classList.remove(TC.Consts.classes.COLLAPSED):l.classList.add(TC.Consts.classes.COLLAPSED);else{var u=$(l).data(s);if(u){u=u.toString();if(!l.classList.contains(TC.Consts.classes.CHECKED)){var d=l;do{d=d.parentElement}while(d&&!d.matches("li."+c.CLASS+"-search-group"));const t=d?$(d).data(n):0,s=c.layers[t].options.url,a=c.layers[t].title,C=new TC.layer.Raster({id:c.getUID(),url:s,title:a,hideTitle:c.layers[t].hideTitle||c.layers[t].options.hideTitle,hideTree:!1,layerNames:[u]});if(C.isCompatible(c.map.crs)){c.map.addLayer(C,function(t){$(l).data(e,t);t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)})});l.classList.add(TC.Consts.classes.CHECKED);l.setAttribute(r,i)}else o(c,C)}}}}));c.searchInit=!0}$.isFunction(t)&&t()}).then(function(){i()}).catch(function(t){u(t)})})}))};t.getLayerRootNode=function(t){const s=this;var a=null;if(!t.isBase){var n=t.options.url;s._roots&&s._roots.forEach(function(s){var o=$(s).data(e);o&&o.type===t.type&&o.options.url===n&&(a=s)})}return a};t.getLayerNodes=function(t){const e=[],s=this.getLayerRootNode(t);if(s)for(var a=0;a<t.names.length;a++){const n=s.querySelector('li[data-tc-layer-name="'+t.names[a]+'"]');if(n){e[e.length]=n;n.querySelectorAll("li").forEach(function(t){e[e.length]=t})}}return e};t.showLayerInfo=function(t,n){const o=this;var r=null,l=o.div.querySelector("."+o.CLASS+"-info");const c=function(t,e){var a=!1;$(l).data(s);if(e){a=!0;$(l).data(s,t);l.classList.remove(TC.Consts.classes.HIDDEN);dust.render(o.CLASS+"-info",e,function(t,e){l.innerHTML=e;t&&TC.error(t);l.querySelector("."+o.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){o.hideLayerInfo()})})}return a};o.div.querySelectorAll("."+o.CLASS+"-btn-info, ."+o.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});for(var i=0,u=o._roots.length;i<u;i++){const l=o._roots[i];if($(l).data(e)===t){const t=l.querySelectorAll("."+o.CLASS+"-btn-info");for(var d=0,C=t.length;d<C;d++){const e=t[d];var f=$(e.parentElement).data(s).toString();if(f===n){const t=$(e).data(a),s=(c(f,t),o.div.querySelector('li [data-tc-layer-name="'+f+'"] > button.'+o.CLASS+"-btn-info"));c(f,t)?s.classList.add(TC.Consts.classes.CHECKED):s.classList.remove(TC.Consts.classes.CHECKED);r=t;break}}break}}return r};t.update=function(){const t=this;t.layers.forEach(function(e){e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);const a=t.getLayerRootNode(e);a&&a.querySelectorAll("li[data-tc-layer-name]").forEach(function(a){const n=$(a).data(s),o=a.querySelector("span."+TC.Consts.classes.SELECTABLE);if(e.compatibleLayers.indexOf(n)<0){o.classList.add(TC.Consts.classes.INCOMPATIBLE);o.setAttribute("title",t.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.INCOMPATIBLE);o.removeAttribute("title")}})})})};t.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};t.addLayer=function(t){const e=this;return new Promise(function(s,a){var n=[];e.options.layers&&e.options.layers.length&&(n=$.grep(e.options.layers,function(e){var s=TC.Util.reqGetMapOnCapabilities(e.url);return s&&s.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));0==n.length&&(n=$.grep(e.layers,function(e){return e.url.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));if(0==n.length){e.layers.push(t);t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);t.title=t.title||t.wrap.getServiceTitle();e.render(function(){s()})})}else s()})};t.addLayerToMap=function(t,e){const s=this,a=$.extend({},t.options);a.id=s.getUID();a.layerNames=[e];a.title=t.title;const n=new TC.layer.Raster(a);n.isCompatible(s.map.crs)?s.map.addLayer(a).then(function(t){t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)})}):o(s,n)};t.loaded=function(){return this._readyPromise};t.getAvailableCRS=function(t){t=t||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,t.layer),includeFallbacks:!0})};t.setProjection=function(t){const e=this;t=t||{};TC.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t).then(function(){e._layerToAdd&&e.map.addLayer(e._layerToAdd);TC.Util.closeModal()})}})};t.showProjectionChangeDialog=function(t){this._layerToAdd=t.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,t)}}();
//# sourceMappingURL=../maps/Control/LayerCatalog.min.js.map
