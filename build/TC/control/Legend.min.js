TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{else:n,block:s},{}).w("</ul></div>")}t.__dustBody=!0;function n(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}n.__dustBody=!0;function s(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}s.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["customLegend"],!1),t,{else:n,block:g},{})}t.__dustBody=!0;function n(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:s,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:l},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:u},{}).w("</ul></li>")}n.__dustBody=!0;function s(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}s.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function l(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{else:o,block:c},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}l.__dustBody=!0;function o(e,t){return e.x(t.getPath(!1,["legend","width"]),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:a},{}).w('"></div>')}r.__dustBody=!0;function a(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}a.__dustBody=!0;function c(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:d},{}).w(" />")}c.__dustBody=!0;function d(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;" ')}d.__dustBody=!0;function u(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}u.__dustBody=!0;function g(e,t){return e.f(t.get(["customLegend"],!1),t,"h",["s"])}g.__dustBody=!0;return t}}var t="tcLayer",n="tcLayerUid";e.register=function(e){const t=this;e.on(TC.Consts.event.VIEWCHANGE,function(n){const s=n.view,i=t.loadGraphics.bind(t);s===TC.Consts.view.THREED?e.on(TC.Consts.event.LAYERADD,i):s===TC.Consts.view.DEFAULT&&e.off(TC.Consts.event.LAYERADD,i)});return TC.control.MapContents.prototype.register.call(t,e)};e.loadGraphics=function(){var e=this;e.getLayerUIElements().forEach(function(n){var s=$(n).data(t);s&&n.querySelectorAll("li."+e.CLASS+"-node-visible").forEach(function(t){const n=t.querySelector("img");n&&void 0!==n.getAttribute("src")&&0===n.getAttribute("src").length&&e.styleLegendImage(n,s)})})};e.updateScale=function(){var e=this,s=e.CLASS+"-node-inscale",i=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach(function(l){var o=$(l).data(t);if(o){var r=!1;l.querySelectorAll("li").forEach(function(t){if(t.classList.contains(e.CLASS+"-node-visible")){var l=$(t).data(n);if(o.isVisibleByScale(l)){r=!0;t.classList.remove(i);t.classList.add(s);const n=t.querySelector("img");n&&e.styleLegendImage(n,o)}else{t.classList.add(i);t.classList.remove(s)}}});if(r){l.classList.remove(i);l.classList.add(s)}else{l.classList.remove(s);l.classList.add(i)}}})};e.update=function(){var e=this;e.getLayerUIElements().forEach(function(s){var i=$(s).data(t);if(i){i.getTree();s.querySelectorAll("li").forEach(function(t){var s=$(t).data(n),l=e.CLASS+"-node-visible",o=e.CLASS+"-node-notvisible",r=e.CLASS+"-node-hasvisible";switch(i._cache.visibilityStates[s]){case TC.Consts.visibility.NOT_VISIBLE:t.classList.remove(l);t.classList.remove(r);t.classList.add(o);break;case TC.Consts.visibility.HAS_VISIBLE:t.classList.remove(l);t.classList.remove(o);t.classList.add(r);break;default:t.classList.remove(o);t.classList.remove(r);t.classList.add(l)}});e.updateLayerVisibility(i)}});e.updateScale()};e.updateLayerTree=function(e){var s=this;if(!e.isBase&&!e.options.stealth){if(e.hideTree||e.options.hideTree){e.tree=null;e.hideTree=e.options.hideTree=!1;e._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(s,e);s.div.querySelector("."+s.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(s.CLASS+"-node",s.layerTrees[e.id],function(i,l){const o=(new DOMParser).parseFromString(l,"text/html").body.firstChild,r=$(o).data(n),a=s.div.querySelector("ul."+s.CLASS+"-branch"),c=a.querySelectorAll('li[data-tc-layer-uid="'+r+'"]');if(1===c.length){const e=c[0];e.innerHTML=o.innerHTML;e.setAttribute("class",o.getAttribute("class"))}else{$(o).data(t,e);a.insertBefore(o,a.firstChild)}i&&TC.error(i)});s.update()})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var n=this;n.getLayerUIElements().forEach(function(s){$(s).data(t)===e&&(e.getVisibility()?s.classList.remove(n.CLASS+"-node-notvisible"):s.classList.add(n.CLASS+"-node-notvisible"))})};e.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();
//# sourceMappingURL=../maps/control/Legend.min.js.map
