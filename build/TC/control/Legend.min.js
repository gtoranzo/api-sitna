TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{else:n,block:s},{}).w("</ul></div>")}t.__dustBody=!0;function n(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}n.__dustBody=!0;function s(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}s.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["customLegend"],!1),t,{else:n,block:g},{})}t.__dustBody=!0;function n(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:s,block:i},{}).w(' data-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:l},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:u},{}).w("</ul></li>")}n.__dustBody=!0;function s(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}s.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function l(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{else:o,block:a},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}l.__dustBody=!0;function o(e,t){return e.x(t.getPath(!1,["legend","width"]),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:c},{}).w('"></div>')}r.__dustBody=!0;function c(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}c.__dustBody=!0;function a(e,t){return e.w('<img src="" data-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:d},{}).w(" />")}a.__dustBody=!0;function d(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;" ')}d.__dustBody=!0;function u(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}u.__dustBody=!0;function g(e,t){return e.f(t.get(["customLegend"],!1),t,"h",["s"])}g.__dustBody=!0;return t};e.register=function(e){const t=this;e.on(TC.Consts.event.VIEWCHANGE,function(n){const s=n.view,i=t.loadGraphics.bind(t);s===TC.Consts.view.THREED?e.on(TC.Consts.event.LAYERADD,i):s===TC.Consts.view.DEFAULT&&e.off(TC.Consts.event.LAYERADD,i)});return TC.control.MapContents.prototype.register.call(t,e)};e.loadGraphics=function(){const e=this;e.getLayerUIElements().forEach(function(t){const n=e.map.getLayer(t.dataset.layerId);n&&t.querySelectorAll("li."+e.CLASS+"-node-visible").forEach(function(t){const s=t.querySelector("img");s&&void 0!==s.getAttribute("src")&&0===s.getAttribute("src").length&&e.styleLegendImage(s,n)})})};e.updateScale=function(){const e=this,t=e.CLASS+"-node-inscale",n=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach(function(s){const i=e.map.getLayer(s.dataset.layerId);if(i){let l=!1;const o=s.querySelectorAll("li");o.forEach(function(s){if(s.classList.contains(e.CLASS+"-node-visible")){const o=s.dataset.layerUid;if(i.isVisibleByScale(o)){l=!0;s.classList.remove(n);s.classList.add(t);const o=s.querySelector("img");o&&e.styleLegendImage(o,i)}else{s.classList.add(n);s.classList.remove(t)}}});l=l||!o.length;if(!o.length){const t=s.querySelector("img");t&&e.styleLegendImage(t)}s.classList.toggle(t,l);s.classList.toggle(n,!l)}})};e.update=function(){const e=this;e.getLayerUIElements().forEach(function(t){const n=e.map.getLayer(t.dataset.layerId);if(n){n.getTree();t.querySelectorAll("li").forEach(function(t){const s=t.dataset.layerUid;var i=e.CLASS+"-node-visible",l=e.CLASS+"-node-notvisible",o=e.CLASS+"-node-hasvisible";switch(n._cache.visibilityStates[s]){case TC.Consts.visibility.NOT_VISIBLE:t.classList.remove(i,o);t.classList.add(l);break;case TC.Consts.visibility.HAS_VISIBLE:t.classList.remove(i,l);t.classList.add(o);break;default:t.classList.remove(l,o);t.classList.add(i)}});e.updateLayerVisibility(n)}});e.updateScale()};e.updateLayerTree=function(e){var t=this;if(!e.isBase&&!e.options.stealth){if(e.hideTree||e.options.hideTree){e.tree=null;e.hideTree=e.options.hideTree=!1;e._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(t,e);t.div.querySelector("."+t.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);t.getRenderedHtml(t.CLASS+"-node",t.layerTrees[e.id]).then(function(n){const s=(new DOMParser).parseFromString(n,"text/html").body.firstChild,i=s.dataset.layerUid,l=t.div.querySelector("ul."+t.CLASS+"-branch"),o=l.querySelectorAll('li[data-layer-uid="'+i+'"]');if(1===o.length){const e=o[0];e.innerHTML=s.innerHTML;e.setAttribute("class",s.getAttribute("class"))}else{s.dataset.layerId=e.id;l.insertBefore(s,l.firstChild)}t.update()}).catch(function(e){TC.error(e)})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var t=this;t.getLayerUIElements().forEach(function(n){n.dataset.layerId===e.id&&n.classList.toggle(t.CLASS+"-node-notvisible",!e.getVisibility())})};e.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();
//# sourceMappingURL=../maps/control/Legend.min.js.map