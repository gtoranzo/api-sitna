TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));t.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.MAILTO_MAX_LENGTH=256;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.FEATURE_PARAM="showfeature";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){t.div.querySelectorAll("button").forEach(function(e){e.classList.remove("hide")});t.div.querySelectorAll("input[type=text]").forEach(function(e){delete e.dataset.dataOriginalTitle})}TC.Util.detectMobile()||t.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const a=t.div.querySelectorAll("."+t.CLASS+"-url-box");t.div.querySelectorAll("span:not(.tc-beta)").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var t=this;t&&"LABEL"!==t.tagName;)t=t.parentElement;const n=t.querySelector("input[type=radio][name=format]").value;a.forEach(function(e){e.classList.toggle(TC.Consts.classes.HIDDEN,!e.matches(".tc-"+n))})})});TC.Util.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.manageMaxLengthExceed=function(e){this.div.querySelector("."+this.CLASS+"-alert").classList.toggle(TC.Consts.classes.HIDDEN,!e.browser);this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert").classList.toggle(TC.Consts.classes.HIDDEN,!e.qr)};e.generateIframe=function(e){var t=e||this.generateLink();if(t)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+t+'"></iframe>'};e.loadParamFeature=function(){const e=this;var t=null,a=TC.Util.getParameterByName(e.FEATURE_PARAM);if(a){var n;try{n=JSON.parse(decodeURIComponent(escape(window.atob(a))))}catch(t){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}n&&e.map&&(n.geom?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),owner:e,stealth:!0}).then(function(t){e.paramFeatureLayer=t;t.importState({features:[n]}).then(function(){e.map.zoomToFeatures(t.features)})}):t=n)}return t};e.register=function(t){const a=this,n=TC.control.MapInfo.prototype.register.call(a,t);a.exportsState=!0;a.MOBILEFAV=a.getLocaleString("mobileBookmarks.instructions");a.NAVALERT=a.getLocaleString("bookmarks.instructions");var o=function(e){const t=e.parentElement.querySelector("input[type=text]");t.value=t.classList.contains("tc-url")?a.generateLink():a.generateIframe();t.select()};a.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){const t=a.generateLink();a.registerListeners();a.div.querySelector(".tc-url input[type=text]").value=t;a.div.querySelector(".tc-iframe input[type=text]").value=a.generateIframe(t)}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(e){const t=e.target;o(t);document.execCommand("copy");t.textContent=a.getLocaleString("copied");setTimeout(function(){t.textContent=a.getLocaleString("copy");!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(e){o(e.target)}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",function(e){e.preventDefault();var n=a.generateLink();if(n){const e=encodeURIComponent(n+"\n");e.length>a.MAILTO_MAX_LENGTH&&t.toast(a.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+e}}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(e){e.preventDefault();const t=a._dialogDiv.querySelector(".qrcode");t.innerHTML="";a._dialogDiv.querySelector("."+a.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?a.makeQRCode(t,256,256).then(function(e){e&&TC.Util.showModal(a._dialogDiv.querySelector(a._classSelector+"-qr-dialog"))}):TC.Util.showModal(a._dialogDiv.querySelector(a._classSelector+"-qr-dialog"))}));const i=function(e,t,n){if(t&&t.trim().length>0)e.location.href=n(t);else{TC.error(a.getLocaleString("urlTooLongForShortener"));e.close()}};a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(e){e.preventDefault();const t=window.open();a.shortenedLink().then(function(e){i(t,e,function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)})});return!1}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(e){e.preventDefault();const t=window.open();a.shortenedLink().then(function(e){i(t,e,function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&amp;url="+encodeURIComponent(e)})});return!1}));TC.Util.detectMobile()&&a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(e){e.preventDefault();a.shortenedLink().then(function(e){var t="whatsapp://send?text=";location.href=void 0!==e?t+encodeURIComponent(e):t+encodeURIComponent(a.generateLink())});return!1}));a.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",function(t){t.preventDefault();var n=a.generateLink(),o=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(o,n,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(n,o);else{window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1}));return n};e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w(' </h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url" title="').h("i18n",t,{},{$key:"shareLink"}).w('"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe" title="').h("i18n",t,{},{$key:"embedMap"}).w('"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p></div>    </div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div>      <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w('</p></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}();
//# sourceMappingURL=../maps/control/Share.min.js.map