TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t="tcLayer",n="tcImg";e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?$.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();"function"==typeof e&&e()}):Promise.reject())};e.register=function(e){const t=this;return new Promise(function(n,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){for(var r=0,o=e.layers.length;r<o;r++)t.updateLayerTree(e.layers[r]);e.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){const n=e.layer;var r=n.names;!function e(t){var n=!1;if(t)if($.inArray(t.name,r)>=0)n=!0;else for(var o=0;o<t.children.length;o++)if(e(t.children[o])){n=!0;break}return n}(t.layerTrees[n.id])&&0!==r.length?t.updateLayerTree(n):t.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){const n=e.layer;t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(n)>-1){t.updateLayerTree(n);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)}).on(TC.Consts.event.LAYERERROR,function(e){t.onErrorLayer(e.layer)});n(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,n,r,o){const a=this;if(n>=0&&n!==r){var i,s;const n=a.getLayerUIElements();for(var c=(o=o||a.map.workLayers).length-1;c>=0;c--){const r=o[c];s=i;for(var l=0,f=n.length;l<f;l++){const e=n[l];if($(e).data(t)===r){i=e;break}}if(r===e){s?s.insertAdjacentElement("afterend",i):i.parentElement.firstChild.insertAdjacentElement("beforebegin",i);break}}}};e.removeLayer=function(e){const n=this,r=n.getLayerUIElements();for(var o=0,a=r.length;o<a;o++){const n=r[o];if($(n).data(t)===e){n.parentElement.removeChild(n);break}}0===n.getLayerUIElements().length&&n.div.querySelector("."+n.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};e.onErrorLayer=function(e){};e.getLayerUIElements=function(){return this.div.querySelector("ul").children};e.styleLegendImage=function(e,t){if(!e.getAttribute("src")){var r=$(e).data(n);const l=new TC.tool.Proxification(TC.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then(function(t){e.src=t}).catch(function(e){TC.error(e)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const f=e.parentElement;var o=f.style.color,a=o.indexOf("("),i=o.indexOf(")");if(a>=0&&i>a){color=o.substr(0,i).substr(a+1).split(",");o="0x";for(var s=0;s<3;s++){var c=parseInt(color[s]).toString(16);o+=1===c.length?"0"+c:c}}else o.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+f.style.fontFamily+";fontSize:"+parseInt(f.style.fontSize)+";fontColor:"+o+";fontAntiAliasing:true";t.params&&t.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:t.params.sld_body}));l.fetchImage(r).then(function(e){$(e).data(n,e.src)}).catch(function(e){TC.error(e)})}l.fetchImage(r).then(function(t){e.src=t.src}).catch(function(e){TC.error(e.statusText)})}}}}();
//# sourceMappingURL=../maps/control/MapContents.min.js.map
