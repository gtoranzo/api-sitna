TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.featureInfoControl=null;this.lineFeatureInfoControl=null;this.polygonFeatureInfoControl=null;this.featureInfoControls=[];this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",t,{},{$key:"selectionBy"}).w("</span>").x(t.get(["pointSelectValue"],!1),t,{block:o},{}).x(t.get(["lineSelectValue"],!1),t,{block:n},{}).x(t.get(["polygonSelectValue"],!1),t,{block:s},{}).w('<button class="tc-ctl-m-finfo-btn-remove" disabled title="').h("i18n",t,{},{$key:"deleteFeatures"}).w('"></button></form></div>')}t.__dustBody=!0;function o(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",t,{},{$key:" selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["pointSelectValue"],!1),t,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPoint"}).w("</span></label>")}o.__dustBody=!0;function n(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",t,{},{$key:" selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["lineSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byLine"}).w("</span></label>")}n.__dustBody=!0;function s(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",t,{},{$key:" selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["polygonSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPrecinct"}).w("</span></label>")}s.__dustBody=!0;return t};const t=function(e,t){if(e){!0===e&&(e={});return TC.Util.extend(!0,e,t)}return e};e.register=function(e){const o=this;o.div.querySelectorAll("input[type=radio]").forEach(function(e){e.checked=!1});return new Promise(function(n,s){const l=[TC.Control.prototype.register.call(o,e)],r=o.options.styles||{};o.modes[TC.Consts.geom.POINT]&&l.push(e.addControl("featureInfo",t(o.modes[TC.Consts.geom.POINT],{displayMode:o.options.displayMode})).then(function(e){o.featureInfoControl=e;o.featureInfoControls.push(e);return e}));o.modes[TC.Consts.geom.POLYLINE]&&l.push(e.addControl("lineFeatureInfo",t(o.modes[TC.Consts.geom.POLYLINE],{displayMode:o.options.displayMode,style:r.line})).then(function(e){o.lineFeatureInfoControl=e;o.featureInfoControls.push(e);return e}));o.modes[TC.Consts.geom.POLYGON]&&l.push(e.addControl("polygonFeatureInfo",t(o.modes[TC.Consts.geom.POLYGON],{displayMode:o.options.displayMode,style:r.polygon})).then(function(e){o.polygonFeatureInfoControl=e;o.featureInfoControls.push(e);return e}));e.on(`${TC.Consts.event.LAYERADD} ${TC.Consts.event.LAYERREMOVE} ${TC.Consts.event.LAYERVISIBILITY}`,function(e){o.updateUI()});e.on(`${TC.Consts.event.CONTROLACTIVATE} ${TC.Consts.event.CONTROLDEACTIVATE}`,function(e){e.control!==o.featureInfoControl&&e.control!==o.lineFeatureInfoControl&&e.control!==o.polygonFeatureInfoControl||o.updateUI()});Promise.all(l).then(function(){if(o.featureInfoControl){o.featureInfoControl.activate();o.lastCtrlActive=o.featureInfoControl}o.updateUI();n(o)})})};e.render=function(e){const t=this;var o={};t.modes[TC.Consts.geom.POINT]&&(o.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(o.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(o.polygonSelectValue=TC.Consts.geom.POLYGON);return t._set1stRenderPromise(t.renderData(o,function(){var o=function(){switch(this.value){case TC.Consts.geom.POLYLINE:t.lineFeatureInfoControl.activate();t.lastCtrlActive=t.lineFeatureInfoControl;break;case TC.Consts.geom.POLYGON:t.polygonFeatureInfoControl.activate();t.lastCtrlActive=t.polygonFeatureInfoControl;break;default:t.featureInfoControl.activate();t.lastCtrlActive=t.featureInfoControl}};t.div.querySelectorAll("input[type=radio]").forEach(function(e){e.addEventListener("change",o)});t.div.querySelector(`.${t.CLASS}-btn-remove`).addEventListener(TC.Consts.event.CLICK,function(e){e.preventDefault();t.featureInfoControls.forEach(e=>{e.info=null;e._infoHistory={};e.resultsLayer.features.slice().forEach(t=>e.downplayFeature(t));e.filterLayer.features.slice().forEach(e=>e.layer.removeFeature(e))})});t.map.on(TC.Consts.event.FEATUREREMOVE,function(e){t.featureInfoControls.some(t=>t.resultsLayer===e.layer||t.filterLayer===e.layer)&&t.updateUI()}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){t.featureInfoControls.some(t=>t.resultsLayer===e.layer||t.filterLayer===e.layer)&&t.updateUI()});TC.Util.isFunction(e)&&e()}))};e.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};e.deactivate=function(){this.lastCtrlActive.deactivate(!1)};e.updateUI=function(){const e=this;e.renderPromise().then(function(){const t=e.map.workLayers.some(e=>e.type===TC.Consts.layerType.WMS&&e.getVisibility());e.div.querySelectorAll("input").forEach(function(e){e.disabled=!t});if(e.featureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POINT}]`);t&&(t.checked=e.featureInfoControl.isActive)}if(e.lineFeatureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POLYLINE}]`);t&&(t.checked=e.lineFeatureInfoControl.isActive)}if(e.polygonFeatureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POLYGON}]`);t&&(t.checked=e.polygonFeatureInfoControl.isActive)}const o=e.div.querySelector(`.${e.CLASS}-btn-remove`);o.classList.toggle(TC.Consts.classes.HIDDEN,!e.featureInfoControls.some(e=>e.options.persistentHighlights));o.disabled=e.featureInfoControls.every(e=>e.resultsLayer&&0===e.resultsLayer.features.length&&e.filterLayer&&0===e.filterLayer.features.length);const n=e.div.style.display;e.div.style.display="none";n?e.div.style.display=n:e.div.style.removeProperty("display")})}}();
//# sourceMappingURL=../maps/control/MultiFeatureInfo.min.js.map