TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const e=this;TC.Control.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);window.$&&(e._$dialogDiv=$(e._dialogDiv));e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+e._cssClasses.LOAD_CRS_BUTTON+")",function(t){const s=t.target.dataset.crsCode;s&&e.setProjection({crs:s,allowFallbackLayer:!0})}));e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+e._cssClasses.LOAD_CRS_BUTTON,function(t){e.loadFallbackProjections()}))};TC.inherit(TC.control.ProjectionSelector,TC.Control);const e=TC.control.ProjectionSelector.prototype;e.CLASS="tc-ctl-projs";e.render=function(e){const t=this,s=TC.Control.prototype.render.call(t,e);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e});return s};e.getAvailableCRS=function(e){return this.map.getCompatibleCRS(TC.Util.extend(e||{},{includeFallbacks:!0}))};e.showProjectionChangeDialog=function(e){const t=this,s=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG),o=s.querySelector(".tc-modal-body");o.classList.add(TC.Consts.classes.LOADING);const l=o.querySelector("ul."+t._cssClasses.CRS_LIST);l.innerHTML="";const n=t.map.baseLayer.firstOption||t.map.baseLayer,c=n.isRaster()?n.getFallbackLayer():null,a=function(){var c=[],a=[];e=e||{};if(n.isRaster()){a=n.getCompatibleCRS();c=t.getAvailableCRS(TC.Util.extend(e,{}))}else{a=t.map.baseLayers.filter(e=>e.isRaster()).map(e=>e.getCompatibleCRS({normalized:!0,includeFallback:!0})).reduce((e,t,s,o)=>e.concat(t.filter(t=>e.indexOf(t)<0)));const s=(e.layer?t.map.workLayers.concat(e.layer):t.map.workLayers).filter(function(e){return e.isRaster()}).map(function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:!0})});c=a.filter(e=>s.every(t=>t.indexOf(e)>-1))}t.map.loadProjections({crsList:c,orderBy:"name"}).then(function(e){var n=!1,c=s.querySelector("."+t._cssClasses.CURRENT_CRS_NAME),i=s.querySelector("."+t._cssClasses.CURRENT_CRS_CODE);e.forEach(function(e){if(c&&i&&TC.Util.CRSCodesEqual(t.map.crs,e.code)){c.textContent=e.name;i.textContent=e.code}else{const t=document.createElement("button");t.textContent=e.name+" ("+e.code+")";t.dataset.crsCode=e.code;const s=document.createElement("li");s.appendChild(t);if(0===a.filter(function(t){return TC.Util.CRSCodesEqual(t,e.code)}).length){n=!0;s.classList.add(TC.Consts.classes.HIDDEN);t.classList.add(TC.Consts.classes.WARNING)}l.appendChild(s)}});if(n){const e=document.createElement("li"),s=document.createElement("button");s.classList.add(t._cssClasses.LOAD_CRS_BUTTON);s.innerHTML=t.getLocaleString("showOnTheFlyProjections");e.appendChild(s);l.appendChild(e)}if(0===l.querySelectorAll("li").length){const e=document.createElement("li");e.innerHTML=t.getLocaleString("thereAreNoCompatibleCRS");l.appendChild(e)}const r=l.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");s.querySelectorAll("."+t._cssClasses.CHANGE).forEach(function(e){e.style.display=r.length>1?"":"none"});s.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=r.length>1?"none":""});s.querySelector("ul."+t._cssClasses.CRS_LIST).style.display=r.length>0||n?"":"none";o.classList.remove(TC.Consts.classes.LOADING)})};c?c.getCapabilitiesPromise().then(a):a();TC.Util.showModal(s,e)};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e)}})};e.loadFallbackProjections=function(){const e=this,t=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li");t.forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(e){e.style.display=t.length>1?"":"none"});e._dialogDiv.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=t.length>1?"none":""})}}();
//# sourceMappingURL=../maps/control/ProjectionSelector.min.js.map