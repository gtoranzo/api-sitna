TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);TC.Util.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var t=TC.control.Coordinates.prototype;t.CLASS="tc-ctl-coords";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Coordinates.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CoordinatesDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,s);function s(t,s){return t.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(s.get(["crs"],!1),s,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",s,{},{$key:"changeCRS"}).w('">').f(s.get(["crs"],!1),s,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(s.get(["isGeo"],!1),s,{else:o,block:n},{}).w("</div>").x(s.get(["showGeo"],!1),s,{block:c},{}).w('<span class="close"></span>')}s.__dustBody=!0;function o(t,s){return t.w('x: <span class="tc-ctl-coords-x">').f(s.get(["x"],!1),s,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(s.get(["y"],!1),s,"h").w("</span> ").x(s.get(["ele"],!1),s,{block:e},{})}o.__dustBody=!0;function e(t,s){return t.w('z: <span class="tc-ctl-coords-elevation">').f(s.get(["ele"],!1),s,"h").w("</span> ")}e.__dustBody=!0;function n(t,s){return t.h("i18n",s,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(s.get(["lat"],!1),s,"h").w("</span> ").h("i18n",s,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(s.get(["lon"],!1),s,"h").w("</span> ").x(s.get(["ele"],!1),s,{block:i},{})}n.__dustBody=!0;function i(t,s){return t.h("i18n",s,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(s.get(["ele"],!1),s,"h").w("</span> ")}i.__dustBody=!0;function c(t,s){return t.w('<div class="tc-ctl-coords-alt"><div class="tc-ctl-coords-xy">').h("i18n",s,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(s.get(["lat"],!1),s,"h").w("</span> ").h("i18n",s,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(s.get(["lon"],!1),s,"h").w("</span> ").x(s.get(["ele"],!1),s,{block:r},{}).w("</div></div>")}c.__dustBody=!0;function r(t,s){return t.h("i18n",s,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(s.get(["ele"],!1),s,"h").w("</span> ")}r.__dustBody=!0;return s};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",s);function s(t,s){return t.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",s,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",s,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",s,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",s,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",s,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",s,{},{$key:"close"}).w("</button></div></div></div>")}s.__dustBody=!0;return s}}t.register=function(t){var s=this;const o=TC.control.ProjectionSelector.prototype.register.call(s,t);s.crs=s.map.crs;s.clear();t.on(TC.Consts.event.VIEWCHANGE,function(t){const o=t.view;if(o===TC.Consts.view.PRINTING)return;const e=function(t){s.isPointerOver(t)||s.clear()};if(o===TC.Consts.view.THREED){s.isGeo=!0;s.units=TC.Consts.units.DEGREES;s.crs=s.map.view3D.crs;s.map.view3D.container.addEventListener("mouseout",e);s.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(t){if(t){if(TC.Util.detectMobile()){s.clear();s.coordsToClick({coordinate:[t.lon,t.lat,t.ele],cssClass:s._cssClasses.THREEDMARKER})}s.latLon=[t.lat,t.lon];if(t.ele>0){var o=TC.Util.getMapLocale(s.map);s.latLon.push(t.ele.toLocaleString(o)+"m")}s.update()}else s.clear()})}else if(o===TC.Consts.view.DEFAULT){s.isGeo=s.map.wrap.isGeo();s.units=TC.Consts.units.METERS;s.crs=s.map.crs;s.map.view3D&&s.map.view3D.container.removeEventListener("mouseout",e)}if(s.map.view3D){s.geoCrs=s.map.view3D.crs;s.render()}});t.loaded(function(){s.wrap.register(t).then(function(){s.render(function(){s.clear()})});TC.Util.detectMobile()&&s.renderPromise().then(function(){s.getLayer();s.activateCoords()});t.on(TC.Consts.event.PROJECTIONCHANGE,function(o){if(!t.on3DView){s.isGeo=t.wrap.isGeo();s.crs=o.crs;s.render()}});s.map.wrap.getViewport().then(function(t){s.renderPromise().then(function(){t.addEventListener(TC.Consts.event.MOUSEMOVE,function(t){s.map.on3DView||s.onMouseMove(t)});t.addEventListener(TC.Consts.event.MOUSELEAVE,function(t){s.onMouseLeave(t)})})})});return o};t.render=function(t){const s=this;return s._set1stRenderPromise(s.getRenderedHtml(s.CLASS+"-dialog",null,function(t){s._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.renderData.call(s,{x:s.x,y:s.y,lat:s.lat,lon:s.lon,ele:s.isGeo&&s.latLon.length>2?s.latLon[2]:!s.isGeo&&s.xy.length>2?s.xy[2]:null,crs:s.crs,geoCrs:s.geoCrs,isGeo:s.isGeo,showGeo:!s.isGeo&&s.options.showGeo},function(){s.div.querySelector("button."+s._cssClasses.CRS).addEventListener(TC.Consts.event.CLICK,function(t){s.showProjectionChangeDialog()});TC.Util.isFunction(t)&&t()})}))};t.onMouseMove=function(t){this.wrap.onMouseMove(t)};t.onMouseLeave=function(t){const s=this;setTimeout(function(){if(!s.isPointerOver(t)){s.div.style.visibility="hidden";s.clear()}},200)};t.isPointerOver=function(t){var s=this.div.getBoundingClientRect();return s.left<=t.clientX&&s.left+s.width>=t.clientX&&s.top<=t.clientY&&s.top+s.height>=t.clientY};t.formatCoord=function(t,s){var o;o=t.toFixed(s);s<=3&&(o=o.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));return o=o.replace(".",",").replace(/\|/g,".")};t.update=function(){const t=this;!t.isGeo&&t.options.showGeo&&(t.latLon=TC.Util.reproject(t.xy,t.crs,t.geoCrs).reverse());if(!t.isGeo){t.x=t.formatCoord(t.xy[0],TC.Consts.METER_PRECISION);t.y=t.formatCoord(t.xy[1],TC.Consts.METER_PRECISION)}if(t.isGeo||t.options.showGeo){t.lat=t.formatCoord(t.latLon[0],TC.Consts.DEGREE_PRECISION);t.lon=t.formatCoord(t.latLon[1],TC.Consts.DEGREE_PRECISION)}t.render(function(){const s=t.div.querySelector("span.close");if(TC.Util.detectMobile()){s.addEventListener("click",function(){t.div.classList.add(TC.Consts.classes.HIDDEN);t.clear()});s.style.display=""}else{t.div.classList.remove(TC.Consts.classes.HIDDEN);t.div.style.visibility="visible";s.style.display="none"}})};t.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(t){t.clearFeatures()})};t.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};t.activateCoords=function(){this.wrap.coordsActivate()};t.getCoords=function(){var t=this.map.getControlsByClass(TC.control.Popup);if(t&&t.length>0&&t[0].isVisible())this.coordsToPopup(t[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};t.coordsToPopup=function(t){t&&this.updateCoordsCtrl(t.wrap.popup.getPosition())};t.updateCoordsCtrl=function(t){if(t){if(!this.isGeo){this.x=t[0];this.y=t[1];this.xy=[this.x,this.y];t.length>2&&this.xy.push(t[2])}if(this.isGeo||this.options.showGeo){this.lat=t[0];this.lon=t[1];this.latLon=[this.lat,this.lon];t.length>2&&this.latLon.push(t[2])}this.update()}};t.coordsToClick=function(t){var s=this;if(!s.map.div.classList.contains("tc-ctl-sv-active "+TC.Consts.classes.COLLAPSED)){var o=s.div.getBoundingClientRect();if(o.left<=t.clientX&&t.clientX<=o.right&&o.top<=t.clientY&&t.clientY<=o.bottom){s.div.classList.add(TC.Consts.classes.HIDDEN);s.clear();return}s.div.classList.remove("tc-fading");setTimeout(function(){s.div.classList.add("tc-fading")},10);s.updateCoordsCtrl(t.coordinate);s.map.on3DView||s.coordsMarkerAdd(t.coordinate,t.cssClass);s.div.classList.remove(TC.Consts.classes.HIDDEN)}};t.coordsMarkerAdd=function(t,s){var o=this;o.currentCoordsMarker?o.currentCoordsMarker.setCoords(t):o.getLayer().then(function(e){e.addMarker(t,{title:"Coord",showsPopup:!1,cssClass:s||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(t){o.currentCoordsMarker=t})})};t.getLayer=function(){const t=this;return new Promise(function(s,o){null==t.layer?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"}).then(function(o){t.layer=o;t.layer.map.putLayerOnTop(t.layer);s(t.layer)}):s(t.layer)})}}();
//# sourceMappingURL=../maps/control/Coordinates.min.js.map