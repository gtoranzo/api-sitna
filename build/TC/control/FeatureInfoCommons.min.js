TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);const e=this._classSelector="."+this.CLASS;this._selectors={LIST_ITEM:"ul"+e+"-features li"};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var e=TC.control.FeatureInfoCommons.prototype;e.CLASS="tc-ctl-finfo";e.TITLE_SEPARATOR=" \u2022 ";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FeatureInfo.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.x(t.get(["displayElevation"],!1),t,{block:s},{}).w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{else:r,block:a},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:I},{})}t.__dustBody=!0;function s(e,t){return e.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(t.get(["crs"],!1),t,"h").w("</span></span> ").x(t.get(["isGeo"],!1),t,{else:n,block:o},{}).w(' <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-elev">').h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val"></span></span></div>')}s.__dustBody=!0;function n(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w("</span></span> ")}n.__dustBody=!0;function o(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w("</span></span> ")}o.__dustBody=!0;function r(e,t){return e.nx(t.get(["displayElevation"],!1),t,{block:l},{})}r.__dustBody=!0;function l(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}l.__dustBody=!0;function a(e,t){return e.w("<li><h3>").x(t.get(["title"],!1),t,{else:i,block:f},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:d,block:b},{}).w("</div></li>")}a.__dustBody=!0;function i(e,t){return e.x(t.getPath(!1,["layers","0","title"]),t,{else:c,block:u},{})}i.__dustBody=!0;function c(e,t){return e.f(t.getPath(!1,["layer","name"]),t,"h")}c.__dustBody=!0;function u(e,t){return e.f(t.getPath(!1,["layers","0","title"]),t,"h")}u.__dustBody=!0;function f(e,t){return e.f(t.get(["title"],!1),t,"h")}f.__dustBody=!0;function d(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:C,block:p},{}).w("</ul>")}d.__dustBody=!0;function C(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}C.__dustBody=!0;function p(e,t){return e.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w("</span> ").s(t.get(["path"],!1),t,{block:h},{}).w('</h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:g,block:T},{}).w("</ul></div></li>")}p.__dustBody=!0;function h(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:y},{})}h.__dustBody=!0;function y(e,t){return e.w(" &bull; ")}y.__dustBody=!0;function g(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}g.__dustBody=!0;function T(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:L,block:F},{}).w("</li>")}T.__dustBody=!0;function L(e,t){return e.x(t.get(["error"],!1),t,{else:v,block:m},{})}L.__dustBody=!0;function v(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:S},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:E},{}).w("</tbody></table>")}v.__dustBody=!0;function S(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToShowOnMap"}).w('"')}S.__dustBody=!0;function E(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}E.__dustBody=!0;function m(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}m.__dustBody=!0;function F(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:P,block:w},{key:t.get(["rawFormat"],!1),value:"text/html"})}F.__dustBody=!0;function P(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}P.__dustBody=!0;function w(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:_},{})}w.__dustBody=!0;function _(e,t){return e.h("ne",t,{else:A,block:R},{key:t.get(["expandUrl"],!1),value:""})}_.__dustBody=!0;function A(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe>')}A.__dustBody=!0;function R(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}R.__dustBody=!0;function b(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}b.__dustBody=!0;function I(e,t){return e.h("gt",t,{block:k},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}I.__dustBody=!0;function k(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}k.__dustBody=!0;return t};e.register=function(e){const t=this,s=TC.control.Click.prototype.register.call(t,e);t._createLayers();e.loaded(function(){const s=e.getControlsByClass("TC.control.Share")[0];s&&t.loadSharedFeature(s.loadParamFeature())});t.displayMode=t.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;t.setDisplayMode(t.displayMode);e.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.getDisplayControl()&&t.resultsLayer){if(t.highlightedFeature){t.resultsLayer.removeFeature(t.highlightedFeature);t.highlightedFeature=null}!t.querying&&e.feature&&t.filterLayer.removeFeature(e.feature)}}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){t.highlightedFeature=null}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){const s=e.control;s.currentFeature!==t.filterFeature&&(t.highlightedFeature=s.currentFeature);e.control.currentFeature&&e.control.currentFeature.layer&&t.filterLayer&&t.resultsLayer&&[t.filterLayer.id,t.resultsLayer.id].indexOf(e.control.currentFeature.layer.id)>-1&&t._decorateDisplay(s)}).on(TC.Consts.event.DRAWCHART,function(e){setTimeout(function(){t.highlightedFeature=e.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(t.info&&t.info.services){const n={};t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS}).forEach(function(e){const t=n[e.url]||[];n[e.url]=t.concat(e.getDisgregatedLayerNames())});for(var e=0,s=t.info.services.length;e<s;e++){const s=t.info.services[e],o=n[s.mapLayers[0].url]||[];if(!s.layers.reduce(function(e,t){return e.concat(t.name)},[]).every(function(e){return o.indexOf(e)>=0})){t.downplayFeatures();t.info=null;t.closeResults();break}}}}).on(TC.Consts.event.VIEWCHANGE,function(e){t.closeResults()});return s};e.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};e.responseCallback=function(e){const t=this;t.querying=!1;t.filterFeature&&(t.info={services:e.services});if(e.featureCount){t._addSourceAttributes();t.lastFeatureCount=e.featureCount;t.map.trigger(TC.Consts.event.FEATUREINFO,TC.Util.extend({control:t},e))}else{t.lastFeatureCount=0;t.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:t});t.closeResults()}};e.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.responseCallback({})};e.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};e.setDisplayMode=function(e){var t=this;t.displayMode=e;var s=t.map;switch(e){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!t.resultsPanel){var n=s.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.options.content})[0];if(n){t.resultsPanel=n;n.caller=t}else{s.on(TC.Consts.event.CONTROLADD,function e(n){const o=n.control;if(TC.control.ResultsPanel&&o instanceof TC.control.ResultsPanel){t.resultsPanel=o;o.caller=t;s.off(TC.Consts.event.CONTROLADD,e)}})}}break;default:t.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;t.popup||s.addControl("popup",{closeButton:!0,draggable:t.options.draggable}).then(function(e){t.popup=e;e.caller=t;s.on(TC.Consts.event.POPUP,function(e){t.onShowPopup(e)});s.on(TC.Consts.event.POPUPHIDE,function(s){s.control===e&&t._resetSize()})})}};e.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};e.getDisplayTarget=function(e){if((e=e||{}).control)switch(!0){case TC.control.Popup&&e.control instanceof TC.control.Popup:return e.control.getContainerElement();case TC.control.ResultsPanel&&e.control instanceof TC.control.ResultsPanel:return e.control.getTableContainer();default:return null}switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getTableContainer();default:return this.popup.getContainerElement()}};e.getMenuTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};e.displayResults=function(){var e=this;const t=e.div.cloneNode(!0);t.classList.remove(TC.Consts.classes.HIDDEN);e.filterFeature.data=t.outerHTML;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(e.resultsPanel){if(0===e.map.getControlsByClass(TC.control.ControlContainer).length)e.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(e){e.isVisible()&&e.close()});else{e.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t!==e.resultsPanel&&t.currentFeature&&t.close()})}e.resultsPanel.currentFeature=e.filterFeature;e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer());e.displayResultsCallback()}break;default:e.popup&&e.filterFeature.showPopup(e.popup)}};const t=function(e){return Array.from(e.parentElement.childNodes).indexOf(e)},s=function(e,t){var s=e;do{s=s.parentElement}while(s&&s.tagName!==t);return s};e.getFeatureElement=function(e){const n=this;var o;n.getDisplayTarget().querySelectorAll(n._selectors.LIST_ITEM).forEach(function(r){const l=r,a=s(r,"LI"),i=s(a,"LI");n.getFeature(t(i),t(a),t(l))===e&&(o=l)});return o};e.getNextFeatureElement=function(e){const t=this.getDisplayTarget().querySelectorAll("ul."+this.CLASS+"-features > li"),s=t.length;for(var n=0;n<s;n++)if(t[n].matches("."+TC.Consts.classes.CHECKED))return t[(n+e+s)%s];return null};e.getFeaturePath=function(e){const t=this;if(t.info&&t.info.services)for(var s=0,n=t.info.services.length;s<n;s++){const n=t.info.services[s];for(var o=0,r=n.layers.length;o<r;o++){const t=n.layers[o];for(var l=0,a=t.features.length;l<a;l++)if(t.features[l]===e)return{service:n.title||n.mapLayers.reduce(function(e,t){return e||t.title},""),layer:t.path}}}return null};e.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};e.displayResultsCallback=function(){var e=this;const t=e.getDisplayTarget().querySelector("."+e.CLASS);var n,o,r="click";t.addEventListener(r,TC.EventTarget.listenerBySelector(e._selectors.LIST_ITEM,function(t){e.highlightFeature(t.target)}));r=TC.Consts.event.CLICK;n="."+e.CLASS+"-btn-next";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.highlightFeature(e.getNextFeatureElement(1),1);return!1}));n="."+e.CLASS+"-btn-prev";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.highlightFeature(e.getNextFeatureElement(-1),-1);return!1}));n="ul."+e.CLASS+"-layers h4";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(n){const o=s(n.target,"LI");if(o.classList.contains(TC.Consts.classes.CHECKED)){const s=t.querySelector(".tc-ctl-finfo-layers li:not(.tc-checked)");s&&"none"!==getComputedStyle(s).display&&e.downplayFeatures()}else{e.highlightFeature(o.querySelector(e._selectors.LIST_ITEM));e.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&e.popup.fitToView(!0)}}));n="."+e.CLASS+"-del-btn";t.addEventListener(r,TC.EventTarget.listenerBySelector(n,function(t){e.downplayFeatures();e.closeResults()}));if(e.info)if(e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)){e.getFeatureElement(e.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);e.highlightFeature(e.info.defaultFeature)}else t.querySelector(e._selectors.LIST_ITEM)&&e.highlightFeature(t.querySelector(e._selectors.LIST_ITEM));t.querySelectorAll("table").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){const s=this.parentElement;if(!s.classList.contains(TC.Consts.classes.DISABLED)){if(s.classList.contains(TC.Consts.classes.CHECKED)){if(e.resultsLayer.features[0]&&window.getSelection()&&0===window.getSelection().toString().trim().length){e.map.on(TC.Consts.event.ZOOM,function t(){e._zooming=!1;e.map.off(TC.Consts.event.ZOOM,t)});e._zooming=!0;e.map.zoomToFeatures([e.resultsLayer.features[0]],{animate:!0})}}else e.highlightFeature(s);t.stopPropagation()}})});t.querySelectorAll("table a").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation()})});if(TC.browserFeatures.touch()&&e.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&"none"!==t.querySelector("."+e.CLASS+"-btn-prev").style.display){e.resultsPanel&&TC.Util.swipe(e.resultsPanel.div,"disable");((o=e).info.services?o.info.services.reduce(function(e,t){return e+t.layers.reduce(function(e,t){return e+1},0)},0):0)>1&&TC.Util.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}})}};e.onShowPopup=function(e){const t=this;if(e.control===t.popup){t.displayResultsCallback();t._fitSize()}};e.loadSharedFeature=function(e){};e.insertLinks=function(){const e=this.getLocaleString("open"),t=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(s){const n=s.textContent;TC.Util.isURL(n)&&(s.innerHTML='<a href="'+n+'" target="_blank" title="'+t+'">'+e+"</a>")})};e.highlightFeature=function(e,n){const o=this;var r;if(!o._zooming){var l;if(e instanceof TC.Feature){r=e;l=o.getFeatureElement(r)}else{l=e;for(;l&&"LI"!==l.tagName;)l=l.parentElement}const u=s(l,"LI"),f=s(u,"LI"),d=t(f),C=t(u),p=t(l);r=r||o.getFeature(d,C,p);o.downplayFeatures({exception:r});l.classList.add(TC.Consts.classes.CHECKED);u.classList.add(TC.Consts.classes.CHECKED);f.classList.add(TC.Consts.classes.CHECKED);if(n>0){l.classList.add(TC.Consts.classes.FROMLEFT);u.classList.add(TC.Consts.classes.FROMLEFT);f.classList.add(TC.Consts.classes.FROMLEFT)}else if(n<0){l.classList.add(TC.Consts.classes.FROMRIGHT);u.classList.add(TC.Consts.classes.FROMRIGHT);f.classList.add(TC.Consts.classes.FROMRIGHT)}l.querySelector("table")&&l.querySelector("table").setAttribute("title",o.getLocaleString("clickToCenter"));o.highlightedFeature=r;o.getDisplayTarget().querySelector("."+o.CLASS+"-counter-current")&&(o.getDisplayTarget().querySelector("."+o.CLASS+"-counter-current").innerHTML=o.getFeatureIndex(d,C,p)+1);var a=o.resultsLayer.features.slice();if(a.filter(function(e){return r&&r.id===e.id}).length>0)return;for(var i=0;i<a.length;i++){var c=a[i];c!==o.filterFeature&&o.resultsLayer.removeFeature(c)}r&&r.geometry?o.resultsLayer.addFeature(r):l.classList.add(TC.Consts.classes.DISABLED)}};e.downplayFeatures=function(e){const t=this;e=e||{};t.highlightedFeature!==e.exception&&(t.highlightedFeature=null);const n=e.exception?t.getFeatureElement(e.exception):void 0;var o,r;if(n){o=s(n,"LI");r=s(o,"LI")}t.resultsLayer.clearFeatures();const l=t.getDisplayTarget();Array.from(l.querySelectorAll("ul."+t.CLASS+"-services li")).filter(function(e){return e!==n&&e!==o&&e!==r}).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED,TC.Consts.classes.DISABLED,TC.Consts.classes.FROMLEFT,TC.Consts.classes.FROMRIGHT)});l.querySelectorAll("."+t.CLASS+"-features table").forEach(function(e){e.setAttribute("title",t.getLocaleString("clickToShowOnMap"))})};e._fitSize=function(){const e=this.getDisplayTarget();var t=0;e.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(e){t=Math.max(t,e.offsetLeft+e.offsetWidth)});t&&(e.style.width=t+50+"px")};e._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};e.getFeature=function(e,t,s){var n;const o=this.info;o&&o.services&&(n=o.services[e])&&(n=n.layers[t])&&(n=n.features[s]);return n};e.getFeatureIndex=function(e,t,s){var n=-1;const o=this.info;if(o)for(var r=0;r<=e;r++)for(var l=o.services[r],a=r===e?t:l.layers.length-1,i=0;i<=a;i++)for(var c=l.layers[i],u=i===t?s:c.features.length-1,f=0;f<=u;f++)n+=1;return n};e.beforeRequest=function(e){var t=this;t.querying=!0;t.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:e.xy,control:t});t.closeResults();if(t.map&&t.resultsLayer){t.lastFeatureCount=null;t.resultsLayer.features.forEach(function(e){t.resultsLayer.removeFeature(e)});t.info=null}};e.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};e.deactivate=function(e){this.popup&&this.popup.hide();this.resultsLayer.clearFeatures();this.filterLayer.clearFeatures();this.filterFeature=null;this.wrap&&this.wrap.deactivate();TC.Control.prototype.deactivate.call(this,e)};e.exportState=function(){const e=this;return e.exportsState&&e.resultsLayer?{id:e.id,layer:e.resultsLayer.exportState()}:null};e.importState=function(e){const t=this;t._layersPromise.then(function(){t.resultsLayer.importState(e.layer)})};e._createLayers=function(){const e=this;var t,s;t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};s=e.options.filterLayer?e.options.filterLayer:{id:e.getUID(),title:e.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:e.lineColor,strokeWidth:2},polygon:{strokeColor:e.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};const n=e.map;e._layersPromise=new Promise(function(o,r){n.loaded(function(){Promise.all([n.addLayer(t),n.addLayer(s)]).then(function(t){e.resultsLayer=t[0];e.filterLayer=t[1];o()})})});return e._layersPromise};e._decorateDisplay=function(e){const t=this,s=t.getDisplayTarget({control:e});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!s.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var n=t.getLocaleString("feature");if(e===t.getDisplayControl())if(TC.feature.Point&&t.filterFeature instanceof TC.feature.Point){const e=t.filterFeature.geometry;n=t.getLocaleString("featuresAt",{crs:t.map.crs,x:TC.Util.formatNumber(e[0],t.map.locale),y:TC.Util.formatNumber(e[1],t.map.locale)})}else n=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(n=e.currentFeature.id);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&new TC.control.Print({target:s,title:n})}})};e._addSourceAttributes=function(){const e=this,t="h3_"+e.getLocaleString("service"),s="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach(function(n){n.layers.forEach(function(n){n.features.forEach(function(n){if(n instanceof TC.Feature){const o=e.getFeaturePath(n);if(o){const r={};r[t]=o.service;o.layer&&(r[s]=o.layer.join(e.TITLE_SEPARATOR));const l=TC.Util.extend(r,n.getData());n.clearData();n.setData(l)}}})})})}}();
//# sourceMappingURL=../maps/control/FeatureInfoCommons.min.js.map