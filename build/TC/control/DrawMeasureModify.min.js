TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var e=this;TC.control.Measure.apply(e,arguments);e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]"};e.persistentDrawControls=!0;e.renderPromise().then(function(){e._1stCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-1-t");e._2ndCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-2-t");e._1stCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-1-v");e._2ndCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-2-v");e._elevationText=e.div.querySelector(".tc-ctl-meas-val-coord-ele-t");e._elevationValue=e.div.querySelector(".tc-ctl-meas-val-coord-ele-v")});if(e.options.displayElevation){e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var e=TC.control.DrawMeasureModify.prototype;e.CLASS="tc-ctl-dmm";var t="tcValue";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const o=[],n=function(e){return o.filter(function(t){return t.feature===e})[0]},a=function(e){const t=o.reduce(function(t,o,n){return o.feature===e?n:t},-1);t>=0&&o.splice(t,1)};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",t,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",t,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",t,{},{$key:"deleteAll"}).w('">').h("i18n",t,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w("...</button></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadSketch"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:o},{}).w('<div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-dmm-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox" checked /><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:n},{})}o.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;return t}}e.render=function(e){const t=this,o=t._set1stRenderPromise(TC.control.Measure.prototype.render.call(t,function(){t._clearBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");t._clearBtn.addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteAll.confirm"),function(){t.clear()})});t._downloadBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");t._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.showSketchDownloadDialog()});t._elevProfileBtn=t.div.querySelector(".tc-ctl-meas-prof-btn");t._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.elevationProfileActive?t.deactivateElevationProfile():t.activateElevationProfile()});t.options.displayElevation||(t._elevProfileBtn.style.display="none");$.isFunction(e)&&e()})),n={checkboxId:t.getUID(),elevation:t.options.displayElevation};t.getRenderedHtml(t.CLASS+"-dialog",n,function(e){const o=function(e){TC.Util.closeModal();const o={fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:e},n=t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked;if(n){const e="1"===t._dialogDiv.querySelector("input[type=radio][name=ip-coords]:checked").value,n=t.map.getLoadingIndicator(),a=n&&n.addWait(),l={crs:t.map.crs,features:t.layer.features.map(function(t){return t.getGeometryStride()>=3&&(!e||TC.feature.Point&&t instanceof TC.feature.Point)?null:t.clone()}),maxCoordQuantity:t.options.displayElevation.maxCoordQuantity,sampleNumber:0};e&&(l.resolution=parseFloat(t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m input[type=number]").value)||t.options.displayElevation.resolution);t.elevation.setGeometry(l).then(function(e){e.forEach(function(o,n){o||(e[n]=t.layer.features[n])});t.map.exportFeatures(e,o)}).catch(function(e){e!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(t.getLocaleString("elevation.error")):TC.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){n&&n.removeWait(a)})}else{var a;a=t.options.displayElevation&&!n?t.layer.features.map(function(e){var t=e.clone();if(t.getGeometryStride()>2){t.getCoordsArray().forEach(function(e){e.length=2});t.setCoords(t.geometry)}return t}):t.layer.features;t.map.exportFeatures(a,o)}};t._dialogDiv.innerHTML=e;t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(t._selectors.ELEVATION_CHECKBOX,function(e){t.showSketchDownloadDialog()}));t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio][name=ip-coords]",function(e){const o=t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m");"0"===e.target.value?o.classList.add(TC.Consts.classes.HIDDEN):o.classList.remove(TC.Consts.classes.HIDDEN)}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){const n=e.target.dataset.format;n===TC.Consts.format.GPX&&t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon})?TC.confirm(t.getLocaleString("gpxNotCompatible.confirm"),function(){o(n)}):o(n)}))});return o};e.register=function(e){const t=this;return new Promise(function(l,r){TC.control.Measure.prototype.register.call(t,e).then(function(){const r=t.getUID(),s=t.getUID();Promise.all([t.layerPromise,t.renderPromise()]).then(function(i){const c=i[0];c.title=t.getLocaleString("sketch");t._modifyPromise=e.addControl("modify",{id:s,div:t.div.querySelector("."+t.CLASS+"-mod"),layer:c});t._modifyPromise.then(function(o){t.modify=o;o.on(TC.Consts.event.FEATURESSELECT,function(e){t.resultsPanelChart&&!e.features.some(function(e){return t.resultsPanelChart.currentFeature===e})&&t.resultsPanelChart.setCurrentFeature(null);const o=e.features[e.features.length-1];if(o){t.showMeasures(t.getFeatureMeasureData(o));const e=o._originalStyle||o.getStyle();switch(!0){case TC.feature.Polygon&&o instanceof TC.feature.Polygon:t.displayMode(TC.Consts.geom.POLYGON);t.drawPolygons.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);break;case TC.feature.Polyline&&o instanceof TC.feature.Polyline:t.displayMode(TC.Consts.geom.POLYLINE);t.drawLines.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);const a=n(o);if(a){t.resultsPanelChart.setCurrentFeature(o);t.renderElevationChart(a.data)}break;case TC.feature.Point&&o instanceof TC.feature.Point:t.displayMode(TC.Consts.geom.POINT);t.drawPoints.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth)}t.modify.setFontColorWatch(e.fontColor).setFontSizeWatch(e.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(e){t.modify.getSelectedFeatures().length||t.resetDrawWatches();t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(e){if(e.layer===t.layer){a(e.feature);const o=function(e){const o=t.getFeatureMeasureData(e);t.showMeasures(o);t.setFeatureMeasureData(e)};o(e.feature);t.options.displayElevation&&TC.feature.Point&&e.feature instanceof TC.feature.Point&&t.elevation.setGeometry({features:[e.feature],crs:t.map.crs}).then(function(e){o(e[0])});t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e.feature&&t.hide()})}});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){const o=e.control;if(o===t.modify){t.resetDrawWatches();t.resetElevationProfile();if(t.resultsPanelChart){t.resultsPanelChart.setCurrentFeature(null);t.resultsPanelChart.close()}}else if(o===t.drawLines){t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}}).on(TC.Consts.event.FEATURECLICK,function(o){const a=o.feature;if(!(e.activeControl instanceof TC.control.Draw||e.activeControl instanceof TC.control.Modify)&&TC.feature.Polyline&&a instanceof TC.feature.Polyline&&t.layer.features.indexOf(a)>=0){if(t.elevationProfileActive){t.resultsPanelChart&&t.resultsPanelChart.setCurrentFeature(a);e.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===a&&e.hide()})}const o=n(a);t.resultsPanelChart&&t.resultsPanelChart.isMinimized()&&t.resultsPanelChart.maximize();o?t.renderElevationChart(o.data):t.displayElevationProfile(a.geometry)}})});t._drawLinesPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resultsPanelChart&&t.resultsPanelChart.currentFeature&&t.resultsPanelChart.setCurrentFeature(null);t.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){t.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(e){t.resultsPanelChart&&(t.resultsPanelChart.currentFeature=e.feature)}).on(TC.Consts.event.POINT,function(e){const o=this.history.slice(0,this.historyIndex),n=o[o.length-1];n[0]===e.point[0]&&n[1]===e.point[1]||o.push(e.point);t.displayElevationProfile(o)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPolygonsPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPointsPromise=e.addControl("draw",{id:r,div:t.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:t.persistentDrawControls,styleTools:!0,layer:t.layer});t._drawPointsPromise.then(function(o){o.containerControl=t;t.drawControls.push(o);t.drawPoints=o;t.resetValues();o.on(TC.Consts.event.DRAWEND,function(o){const n=function(o){t.showMeasures({coords:o.geometry,units:e.wrap.isGeo()?"degrees":"m"});t.setFeatureMeasureData(o)};n(o.feature);t.options.displayElevation&&t.elevation.setGeometry({features:[o.feature],crs:t.map.crs}).then(function(e){n(e[0])})}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)});o.exportsState=!1});t.setMode(t.options.mode);e.on(TC.Consts.event.FEATUREADD,function(e){const o=e.layer,n=e.feature;if(o===t.layer){t.setFeatureMeasureData(n);t._modifyPromise.then(function(e){e.displayLabelText(n.getStyle().label)});t._clearBtn.disabled=!1;t._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const n=e.layer,l=e.feature;if(n===t.layer)if(0===t.layer.features.length){t._clearBtn.disabled=!0;t._downloadBtn.disabled=!0;t.resetValues();o.length=0}else l&&a(l)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){const t=e.control;t.setCurrentFeature&&t.setCurrentFeature(null)});l(t)})}).catch(function(e){r(e)})})};e.displayMode=function(e){const t=this;e===TC.Consts.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt"));t.modify&&t.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(t,e)};e.setMode=function(e){const t=this;e===TC.Consts.geom.POINT&&t.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(t,e)};e.setFeatureMeasureData=function(e){const o=this,n={};switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:const a=o._1stCoordText.innerHTML,l=o._2ndCoordText.innerHTML,r=o._elevationText.innerHTML;if(o._1stCoordValue.textContent.trim().length>0&&o._2ndCoordValue.textContent.trim().length>0){n.CRS=o.map.crs;n[a.substr(0,a.indexOf(":"))]=$(o._1stCoordValue).data(t);n[l.substr(0,l.indexOf(":"))]=$(o._2ndCoordValue).data(t);r&&(n[o.getLocaleString("ele")]=$(o._elevationValue).data(t));e.setData(n)}break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:if(o._len.innerHTML.trim()!==o.NOMEASURE){n[o.getLocaleString("2dLength")]=o._len.innerHTML;e.setData(n)}break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:if(o._area.innerHTML.trim()!==o.NOMEASURE&&o._peri.innerHTML.trim()!==o.NOMEASURE){n[o.getLocaleString("area")]=o._area.innerHTML;n[o.getLocaleString("2dPerimeter")]=o._peri.innerHTML;e.setData(n)}}return o};e.getFeatureMeasureData=function(e){const t=this,o={units:"m"},a={};t.map.wrap.isGeo()&&(a.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:o.area=e.getArea(a);o.perimeter=e.getLength(a);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:o.length=e.getLength(a);const l=n(e);l?t.renderElevationChart(l.data):t.displayElevationProfile(e.geometry);break;case TC.feature.Point&&e instanceof TC.feature.Point:o.coords=e.geometry}return o};e.showMeasures=function(e){const o=this;TC.control.Measure.prototype.showMeasures.call(o,e);(e=e||{}).units;const n=o.map.options.locale||TC.Cfg.locale;if(e.coords){var a,l,r;if("m"===e.units){a=TC.Consts.METER_PRECISION;l=e.coords[0];r=e.coords[1];o._1stCoordText.innerHTML="x: ";o._2ndCoordText.innerHTML="y: "}else{a=TC.Consts.DEGREE_PRECISION;l=e.coords[1];r=e.coords[0];o._1stCoordText.innerHTML="lat: ";o._2ndCoordText.innerHTML="lon: "}const s=Math.pow(10,a),i=function(e){return Math.round(e*s)/s};o._1stCoordValue.innerHTML=TC.Util.formatNumber(l.toFixed(a),n);$(o._1stCoordValue).data(t,i(l));o._2ndCoordValue.innerHTML=TC.Util.formatNumber(r.toFixed(a),n);$(o._2ndCoordValue).data(t,i(r));if(e.coords.length>2){const a=Math.round(e.coords[2]);o._elevationText.innerHTML=o.getLocaleString("ele").toLowerCase()+": ";o._elevationValue.innerHTML=TC.Util.formatNumber(a.toFixed(TC.Consts.METER_PRECISION),n)+" m";$(o._elevationValue).data(t,a)}else{o._elevationText.innerHTML="";o._elevationValue.innerHTML="";$(o._elevationValue).data(t,null)}}return o};e.resetValues=function(){const e=this;TC.control.Measure.prototype.resetValues.call(e);if(e._1stCoordText){e._1stCoordText.innerHTML=e.NOMEASURE;e._2ndCoordText.innerHTML="";e._1stCoordValue.innerHTML="";$(e._1stCoordValue).data(t,null);e._2ndCoordValue.innerHTML="";$(e._2ndCoordValue).data(t,null);e._elevationText.innerHTML="";e._elevationValue.innerHTML="";$(e._elevationValue).data(t,null)}return e};e.resetDrawWatches=function(){this.drawControls.forEach(function(e){e.setStrokeColorWatch().setStrokeWidthWatch()})};e.clear=function(){const e=this;e.resetValues();e.layer.clearFeatures();e.modify.isActive&&e.modify.deactivate();if(e.options.displayElevation){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}e._clearBtn.disabled=!0;e._downloadBtn.disabled=!0;return e};e.showSketchDownloadDialog=function(e){const t=this._dialogDiv.querySelector("."+this.CLASS+"-dialog"),o=($(t),this.layer.features.some(function(e){return TC.feature.Point&&e instanceof TC.feature.Point||TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint})),n=this.layer.features.some(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline}),a=this.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon}),l=t.querySelector("."+this.CLASS+"-dialog-ip");this._dialogDiv.querySelector(this._selectors.ELEVATION_CHECKBOX).checked&&(n||a)?l.classList.remove(TC.Consts.classes.HIDDEN):l.classList.add(TC.Consts.classes.HIDDEN);const r=t.querySelector("button[data-format=GPX]");n||o?r.classList.remove(TC.Consts.classes.HIDDEN):r.classList.add(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,e);return this};e.onStyleChange=function(e){const t=this;var o;switch(e.target.mode){case TC.Consts.geom.POLYGON:o=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:o=TC.feature.Polyline;break;case TC.Consts.geom.POINT:o=TC.feature.Point}o&&t.modify.getSelectedFeatures().forEach(function(t){if(t instanceof o){const o={};o[e.property]=e.value;t.setStyle(o)}})};e.displayElevationProfile=function(e){const t=this;1===e.length&&(e=e.slice()).push(e[0]);const a=t.map.getLoadingIndicator(),l=a&&a.addWait();t.elevation.getElevation({crs:t.map.crs,coordinates:e}).then(function(r){a&&a.removeWait(l);var s=0,i=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const d=r.map(function(e,t,o){const n=0===t?e:o[t-1],a=e[0]-n[0],l=e[1]-n[1];s+=Math.sqrt(a*a+l*l);var r=e[2];if("number"==typeof r){i=Math.max(r,i);c=Math.min(r,c)}return[s,r]});t.elevationProfileData={x:d.map(function(e){return e[0]}),ele:d.map(function(e){return e[1]}),coords:r};const u={coords:r};"object"==typeof t.options.displayElevation&&(u.hillDeltaThreshold=t.options.displayElevation.hillDeltaThreshold);$.extend(t.elevationProfileData,TC.tool.Elevation.getElevationGain(u));const C=t.layer.features.filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline}).filter(function(t){for(var o=0,n=t.geometry.length;o<n;o++){const n=e[o],a=t.geometry[o];if(!n||n[0]!==a[0]||n[1]!==a[1])return!1}return!0})[0];C&&function(e,t){var a=n(e);if(!a){a={feature:e};o.push(a)}a.data=t}(C,t.elevationProfileData);t.resultsPanelChart?t.renderElevationChart():t.createChartPanel().then(function(e){t.resultsPanelChart.renderPromise().then(function(){t.renderElevationChart()})})},function(e){t.resetElevationProfile();a&&a.removeWait(l)})};e.createChartPanel=function(){const t=this,o={id:t.getUID(),content:"chart",titles:{main:t.getLocaleString("geo.trk.chart.chpe"),max:t.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:t,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};return new Promise(function(e,n){var a;const l=function(e){o.side=e.SIDE.RIGHT;a=e.addControl("resultsPanel",o)};if(t.options.displayElevation.displayOn){var r=t.map.getControlsByClass("TC.control."+t.options.displayElevation.displayOn[0].toUpperCase()+t.options.displayElevation.displayOn.substring(1))[0];r?l(r):t.map.addControl(t.options.displayElevation.displayOn).then(l)}else{o.div=document.createElement("div");t.map.div.appendChild(o.div);a=t.map.addControl("resultsPanel",o)}a.then(function(o){o.caller=t;t.resultsPanelChart=o;t._decorateChartPanel();e(o)})})};e._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1);t.currentFeature=e;e&&e.toggleSelectedStyle(!0)}};e.renderElevationChart=function(e){const t=this;t.elevationProfileData=e||t.elevationProfileData;if(t.resultsPanelChart&&t.elevationProfileActive){t.resultsPanelChart.openChart(t.elevationProfileData);t.resultsPanelChart.isMinimized()||t.resultsPanelChart.show()}};e.getElevationTooltip=function(e){this.resultsPanelChart.wrap.showElevationMarker({data:e,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};e.activateElevationProfile=function(){const e=this;e.elevationProfileActive=!0;e._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("deactivateElevationProfile"));var t=!1;if(e.drawLines.historyIndex>1){e.displayElevationProfile(e.drawLines.history.slice(0,e.drawLines.historyIndex));t=!0}else{const o=e.modify.getActiveFeatures().filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline});if(o.length){const n=o[o.length-1];e.displayElevationProfile(n.geometry);t=!0}}t||e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.show()};e.deactivateElevationProfile=function(){const e=this;e.elevationProfileActive=!1;e._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("activateElevationProfile"));e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()};e.resetElevationProfile=function(){const e=this;if(e.options.displayElevation&&e.resultsPanelChart){e.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};e.resultsPanelChart.openChart(e.elevationProfileData)}}}();
//# sourceMappingURL=../maps/Control/DrawMeasureModify.min.js.map
