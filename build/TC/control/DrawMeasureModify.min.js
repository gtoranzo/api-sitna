TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var e=this;TC.control.Measure.apply(e,arguments);e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);window.$&&(e._$dialogDiv=$(e._dialogDiv));e.options.dialogDiv||document.body.appendChild(e._dialogDiv);const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]"};e.persistentDrawControls=!0;e.renderPromise().then(function(){e._1stCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-1-t");e._2ndCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-2-t");e._1stCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-1-v");e._2ndCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-2-v");e._elevationText=e.div.querySelector(".tc-ctl-meas-val-coord-ele-t");e._elevationValue=e.div.querySelector(".tc-ctl-meas-val-coord-ele-v")});if(e.options.displayElevation){e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var e=TC.control.DrawMeasureModify.prototype;e.CLASS="tc-ctl-dmm";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const t=[],o=function(e){return t.filter(function(t){return t.feature===e})[0]},n=function(e){const o=t.reduce(function(t,o,n){return o.feature===e?n:t},-1);o>=0&&t.splice(o,1)};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",t,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",t,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",t,{},{$key:"deleteAll"}).w('">').h("i18n",t,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w("...</button></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadSketch"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:o},{}).w('<div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-dmm-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox" checked /><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:n},{})}o.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;return t}}e.render=function(e){const t=this,o=t._set1stRenderPromise(TC.control.Measure.prototype.render.call(t,function(){t._clearBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");t._clearBtn.addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteAll.confirm"),function(){t.clear()})});t._downloadBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");t._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.showSketchDownloadDialog()});t._elevProfileBtn=t.div.querySelector(".tc-ctl-meas-prof-btn");t._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.elevationProfileActive?t.deactivateElevationProfile():t.activateElevationProfile()});t.options.displayElevation||(t._elevProfileBtn.style.display="none");TC.Util.isFunction(e)&&e()})),n={checkboxId:t.getUID(),elevation:t.options.displayElevation};t.getRenderedHtml(t.CLASS+"-dialog",n,function(e){const o=function(e){TC.Util.closeModal();const o={fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:e},n=!!t.options.displayElevation&&t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked;if(n){const e="1"===t._dialogDiv.querySelector("input[type=radio][name=ip-coords]:checked").value,n=t.map.getLoadingIndicator(),a=n&&n.addWait(),l={crs:t.map.crs,features:t.layer.features.map(function(t){return t.getGeometryStride()>=3&&(!e||TC.feature.Point&&t instanceof TC.feature.Point)?null:t.clone()}),maxCoordQuantity:t.options.displayElevation.maxCoordQuantity,sampleNumber:0};e&&(l.resolution=parseFloat(t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m input[type=number]").value)||t.options.displayElevation.resolution);t.elevation.setGeometry(l).then(function(e){e.forEach(function(o,n){o||(e[n]=t.layer.features[n])});t.map.exportFeatures(e,o)}).catch(function(e){e.message!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(t.getLocaleString("elevation.error")):TC.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){n&&n.removeWait(a)})}else{var a;a=t.options.displayElevation&&!n?t.layer.features.map(function(e){var t=e.clone();if(t.getGeometryStride()>2){t.getCoordsArray().forEach(function(e){e.length=2});t.setCoords(t.geometry)}return t}):t.layer.features;t.map.exportFeatures(a,o)}};t._dialogDiv.innerHTML=e;t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(t._selectors.ELEVATION_CHECKBOX,function(e){t.showSketchDownloadDialog()}));t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio][name=ip-coords]",function(e){t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m").classList.toggle(TC.Consts.classes.HIDDEN,"0"===e.target.value)}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){const n=e.target.dataset.format;n===TC.Consts.format.GPX&&t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon})?TC.confirm(t.getLocaleString("gpxNotCompatible.confirm"),function(){o(n)}):o(n)}))});return o};e.register=function(e){const a=this;return new Promise(function(l,r){TC.control.Measure.prototype.register.call(a,e).then(function(){const r=a.getUID(),s=a.getUID();Promise.all([a.layerPromise,a.renderPromise()]).then(function(i){const c=i[0];c.title=a.getLocaleString("sketch");a._modifyPromise=e.addControl("modify",{id:s,div:a.div.querySelector("."+a.CLASS+"-mod"),layer:c});a._modifyPromise.then(function(t){a.modify=t;t.on(TC.Consts.event.FEATURESSELECT,function(e){a.resultsPanelChart&&!e.features.some(function(e){return a.resultsPanelChart.currentFeature===e})&&a.resultsPanelChart.setCurrentFeature(null);const t=e.features[e.features.length-1];if(t){a.showMeasures(a.getFeatureMeasureData(t));const e=t._originalStyle||t.getStyle();switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:a.displayMode(TC.Consts.geom.POLYGON);a.drawPolygons.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:a.displayMode(TC.Consts.geom.POLYLINE);a.drawLines.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);const n=o(t);if(n){a.resultsPanelChart.setCurrentFeature(t);a.renderElevationChart(n.data)}break;case TC.feature.Point&&t instanceof TC.feature.Point:a.displayMode(TC.Consts.geom.POINT);a.drawPoints.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth)}a.modify.setFontColorWatch(e.fontColor).setFontSizeWatch(e.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(e){a.modify.getSelectedFeatures().length||a.resetDrawWatches();a.resetElevationProfile();a.resultsPanelChart&&a.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(e){if(e.layer===a.layer){n(e.feature);const t=function(e){const t=a.getFeatureMeasureData(e);a.showMeasures(t);a.setFeatureMeasureData(e)};t(e.feature);a.options.displayElevation&&TC.feature.Point&&e.feature instanceof TC.feature.Point&&a.elevation.setGeometry({features:[e.feature],crs:a.map.crs}).then(function(e){t(e[0])});a.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e.feature&&t.hide()})}});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){const t=e.control;if(t===a.modify){a.resetDrawWatches();a.resetElevationProfile();if(a.resultsPanelChart){a.resultsPanelChart.setCurrentFeature(null);a.resultsPanelChart.close()}}else if(t===a.drawLines){a.resetElevationProfile();a.resultsPanelChart&&a.resultsPanelChart.close()}}).on(TC.Consts.event.FEATURECLICK,function(t){const n=t.feature;if(!(e.activeControl instanceof TC.control.Draw||e.activeControl instanceof TC.control.Modify)&&TC.feature.Polyline&&n instanceof TC.feature.Polyline&&a.layer.features.indexOf(n)>=0){if(a.elevationProfileActive){a.resultsPanelChart&&a.resultsPanelChart.setCurrentFeature(n);e.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===n&&e.hide()})}const t=o(n);a.resultsPanelChart&&a.resultsPanelChart.isMinimized()&&a.resultsPanelChart.maximize();t?a.renderElevationChart(t.data):a.displayElevationProfile(n.geometry)}})});a._drawLinesPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){a.resultsPanelChart&&a.resultsPanelChart.currentFeature&&a.resultsPanelChart.setCurrentFeature(null);a.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){a.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(e){a.resultsPanelChart&&(a.resultsPanelChart.currentFeature=e.feature)}).on(TC.Consts.event.POINT,function(e){const t=this.history.slice(0,this.historyIndex),o=t[t.length-1];o[0]===e.point[0]&&o[1]===e.point[1]||t.push(e.point);a.displayElevationProfile(t)}).on(TC.Consts.event.STYLECHANGE,function(e){a.onStyleChange(e)})});a._drawPolygonsPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){a.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(e){a.onStyleChange(e)})});a._drawPointsPromise=e.addControl("draw",{id:r,div:a.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:a.persistentDrawControls,styleTools:!0,layer:a.layer});a._drawPointsPromise.then(function(t){t.containerControl=a;a.drawControls.push(t);a.drawPoints=t;a.resetValues();t.on(TC.Consts.event.DRAWEND,function(t){const o=function(t){a.showMeasures({coords:t.geometry,units:e.wrap.isGeo()?"degrees":"m"});a.setFeatureMeasureData(t)};o(t.feature);a.options.displayElevation&&a.elevation.setGeometry({features:[t.feature],crs:a.map.crs}).then(function(e){o(e[0])})}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){a.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(e){a.onStyleChange(e)});t.exportsState=!1});a.setMode(a.options.mode);e.on(TC.Consts.event.FEATUREADD,function(e){const t=e.layer,o=e.feature;if(t===a.layer){a.setFeatureMeasureData(o);a._modifyPromise.then(function(e){e.displayLabelText(o.getStyle().label)});a._clearBtn.disabled=!1;a._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const o=e.layer,l=e.feature;if(o===a.layer)if(0===a.layer.features.length){a._clearBtn.disabled=!0;a._downloadBtn.disabled=!0;a.resetValues();t.length=0}else l&&n(l)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){const t=e.control;t.setCurrentFeature&&t.setCurrentFeature(null)});l(a)})}).catch(function(e){r(e)})})};e.displayMode=function(e){const t=this;e===TC.Consts.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt"));t.modify&&t.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(t,e)};e.setMode=function(e){const t=this;e===TC.Consts.geom.POINT&&t.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(t,e)};e.setFeatureMeasureData=function(e){const t=this,o={};switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:const n=t._1stCoordText.innerHTML,a=t._2ndCoordText.innerHTML,l=t._elevationText.innerHTML;if(t._1stCoordValue.textContent.trim().length>0&&t._2ndCoordValue.textContent.trim().length>0){o.CRS=t.map.crs;o[n.substr(0,n.indexOf(":"))]=parseFloat(t._1stCoordValue.dataset.value);o[a.substr(0,a.indexOf(":"))]=parseFloat(t._2ndCoordValue.dataset.value);l&&(o[t.getLocaleString("ele")]=parseFloat(t._elevationValue.dataset.value));e.setData(o)}break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:if(t._len.innerHTML.trim()!==t.NOMEASURE){o[t.getLocaleString("2dLength")]=t._len.innerHTML;e.setData(o)}break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:if(t._area.innerHTML.trim()!==t.NOMEASURE&&t._peri.innerHTML.trim()!==t.NOMEASURE){o[t.getLocaleString("area")]=t._area.innerHTML;o[t.getLocaleString("2dPerimeter")]=t._peri.innerHTML;e.setData(o)}}return t};e.getFeatureMeasureData=function(e){const t=this,n={units:"m"},a={};t.map.wrap.isGeo()&&(a.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:n.area=e.getArea(a);n.perimeter=e.getLength(a);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:n.length=e.getLength(a);const l=o(e);l?t.renderElevationChart(l.data):t.displayElevationProfile(e.geometry);break;case TC.feature.Point&&e instanceof TC.feature.Point:n.coords=e.geometry}return n};e.showMeasures=function(e){const t=this;TC.control.Measure.prototype.showMeasures.call(t,e);(e=e||{}).units;const o=t.map.options.locale||TC.Cfg.locale;if(e.coords){var n,a,l;if("m"===e.units){n=TC.Consts.METER_PRECISION;a=e.coords[0];l=e.coords[1];t._1stCoordText.innerHTML="x: ";t._2ndCoordText.innerHTML="y: "}else{n=TC.Consts.DEGREE_PRECISION;a=e.coords[1];l=e.coords[0];t._1stCoordText.innerHTML="lat: ";t._2ndCoordText.innerHTML="lon: "}const r=Math.pow(10,n),s=function(e){return Math.round(e*r)/r};t._1stCoordValue.innerHTML=TC.Util.formatNumber(a.toFixed(n),o);t._1stCoordValue.dataset.value=s(a);t._2ndCoordValue.innerHTML=TC.Util.formatNumber(l.toFixed(n),o);t._2ndCoordValue.dataset.value=s(l);if(e.coords.length>2){const n=Math.round(e.coords[2]);t._elevationText.innerHTML=t.getLocaleString("ele").toLowerCase()+": ";t._elevationValue.innerHTML=TC.Util.formatNumber(n.toFixed(TC.Consts.METER_PRECISION),o)+" m";t._elevationValue.dataset.value=n}else{t._elevationText.innerHTML="";t._elevationValue.innerHTML="";t._elevationValue.dataset.value=""}}return t};e.resetValues=function(){const e=this;TC.control.Measure.prototype.resetValues.call(e);if(e._1stCoordText){e._1stCoordText.innerHTML=e.NOMEASURE;e._2ndCoordText.innerHTML="";e._1stCoordValue.innerHTML="";e._1stCoordValue.dataset.value="";e._2ndCoordValue.innerHTML="";e._2ndCoordValue.dataset.value="";e._elevationText.innerHTML="";e._elevationValue.innerHTML="";e._elevationValue.dataset.value=""}return e};e.resetDrawWatches=function(){this.drawControls.forEach(function(e){e.setStrokeColorWatch().setStrokeWidthWatch()})};e.clear=function(){const e=this;e.resetValues();e.layer.clearFeatures();e.modify.isActive&&e.modify.deactivate();if(e.options.displayElevation){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}e._clearBtn.disabled=!0;e._downloadBtn.disabled=!0;return e};e.showSketchDownloadDialog=function(e){const t=this,o=t._dialogDiv.querySelector("."+t.CLASS+"-dialog"),n=t.layer.features.some(function(e){return TC.feature.Point&&e instanceof TC.feature.Point||TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint}),a=t.layer.features.some(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline}),l=t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon});if(t.options.displayElevation){o.querySelector("."+t.CLASS+"-dialog-ip").classList.toggle(TC.Consts.classes.HIDDEN,!t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked||!a&&!l)}o.querySelector("button[data-format=GPX]").classList.toggle(TC.Consts.classes.HIDDEN,!(a||n));TC.Util.showModal(o,e);return t};e.onStyleChange=function(e){const t=this;var o;switch(e.target.mode){case TC.Consts.geom.POLYGON:o=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:o=TC.feature.Polyline;break;case TC.Consts.geom.POINT:o=TC.feature.Point}o&&t.modify.getSelectedFeatures().forEach(function(t){if(t instanceof o){const o={};o[e.property]=e.value;t.setStyle(o)}})};e.displayElevationProfile=function(e){const n=this;1===e.length&&(e=e.slice()).push(e[0]);const a=n.map.getLoadingIndicator(),l=a&&a.addWait();n.elevation.getElevation({crs:n.map.crs,coordinates:e}).then(function(r){a&&a.removeWait(l);var s=0,i=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const d=r.map(function(e,t,o){const n=0===t?e:o[t-1],a=e[0]-n[0],l=e[1]-n[1];s+=Math.sqrt(a*a+l*l);var r=e[2];if("number"==typeof r){i=Math.max(r,i);c=Math.min(r,c)}return[s,r]});n.elevationProfileData={x:d.map(function(e){return e[0]}),ele:d.map(function(e){return e[1]}),coords:r};const u={coords:r};"object"==typeof n.options.displayElevation&&(u.hillDeltaThreshold=n.options.displayElevation.hillDeltaThreshold);TC.Util.extend(n.elevationProfileData,TC.tool.Elevation.getElevationGain(u));const C=n.layer.features.filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline}).filter(function(t){for(var o=0,n=t.geometry.length;o<n;o++){const n=e[o],a=t.geometry[o];if(!n||n[0]!==a[0]||n[1]!==a[1])return!1}return!0})[0];C&&function(e,n){var a=o(e);if(!a){a={feature:e};t.push(a)}a.data=n}(C,n.elevationProfileData);n.resultsPanelChart?n.renderElevationChart():n.createChartPanel().then(function(e){n.resultsPanelChart.renderPromise().then(function(){n.renderElevationChart()})})},function(e){n.resetElevationProfile();a&&a.removeWait(l)})};e.createChartPanel=function(){const t=this,o={id:t.getUID(),content:"chart",titles:{main:t.getLocaleString("geo.trk.chart.chpe"),max:t.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:t,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};return new Promise(function(e,n){var a;const l=function(e){o.side=e.SIDE.RIGHT;a=e.addControl("resultsPanel",o)};if(t.options.displayElevation.displayOn){var r=t.map.getControlsByClass("TC.control."+t.options.displayElevation.displayOn[0].toUpperCase()+t.options.displayElevation.displayOn.substring(1))[0];r?l(r):t.map.addControl(t.options.displayElevation.displayOn).then(l)}else{o.div=document.createElement("div");t.map.div.appendChild(o.div);a=t.map.addControl("resultsPanel",o)}a.then(function(o){o.caller=t;t.resultsPanelChart=o;t._decorateChartPanel();e(o)})})};e._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1);t.currentFeature=e;e&&e.toggleSelectedStyle(!0)}};e.renderElevationChart=function(e){const t=this;t.elevationProfileData=e||t.elevationProfileData;if(t.resultsPanelChart&&t.elevationProfileActive){t.resultsPanelChart.openChart(t.elevationProfileData);t.resultsPanelChart.isMinimized()||t.resultsPanelChart.show()}};e.getElevationTooltip=function(e){this.resultsPanelChart.wrap.showElevationMarker({data:e,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};e.activateElevationProfile=function(){const e=this;e.elevationProfileActive=!0;e._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("deactivateElevationProfile"));var t=!1;if(e.drawLines.historyIndex>1){e.displayElevationProfile(e.drawLines.history.slice(0,e.drawLines.historyIndex));t=!0}else{const o=e.modify.getActiveFeatures().filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline});if(o.length){const n=o[o.length-1];e.displayElevationProfile(n.geometry);t=!0}}t||e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.show()};e.deactivateElevationProfile=function(){const e=this;e.elevationProfileActive=!1;e._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("activateElevationProfile"));e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()};e.resetElevationProfile=function(){const e=this;if(e.options.displayElevation&&e.resultsPanelChart){e.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};e.resultsPanelChart.openChart(e.elevationProfileData)}}}();
//# sourceMappingURL=../maps/control/DrawMeasureModify.min.js.map