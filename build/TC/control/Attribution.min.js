TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const t=this;TC.Control.apply(t,arguments);t.apiAttribution="";t.mainDataAttribution=null;t.dataAttributions=[];t.options.dataAttributions&&(t.dataAttributions=t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Attribution.html":t.template=function(){dust.register(t.CLASS,n);function n(t,n){return t.w("<div><span>&copy; ").f(n.get(["api"],!1),n,"h",["s"]).w("</span>").x(n.get(["mainData"],!1),n,{block:e},{}).x(n.get(["otherData"],!1),n,{block:o},{}).w('<div class="tc-ctl-attrib-other ').x(n.get(["isCollapsed"],!1),n,{block:s},{}).w('">').s(n.get(["otherData"],!1),n,{block:u},{}).w("</div></div>")}n.__dustBody=!0;function e(t,n){return t.w(" - ").h("i18n",n,{},{$key:"data"}).w(":").x(n.getPath(!1,["mainData","site"]),n,{else:a,block:i},{})}e.__dustBody=!0;function a(t,n){return t.x(n.getPath(!1,["mainData","name"]),n,{block:r},{})}a.__dustBody=!0;function r(t,n){return t.w("<span> &copy; ").f(n.getPath(!1,["mainData","name"]),n,"h").w("</span>")}r.__dustBody=!0;function i(t,n){return t.w('<span> &copy; <a href="').f(n.getPath(!1,["mainData","site"]),n,"h").w('" target="_blank">').f(n.getPath(!1,["mainData","name"]),n,"h").w("</a></span>")}i.__dustBody=!0;function o(t,n){return t.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",n,{},{$key:"others"}).w("...</span>")}o.__dustBody=!0;function s(t,n){return t.w(" tc-collapsed ")}s.__dustBody=!0;function u(t,n){return t.x(n.getPath(!1,["otherData",n.get(["$idx"],!1),"site"]),n,{else:c,block:l},{}).h("sep",n,{block:d},{})}u.__dustBody=!0;function c(t,n){return t.w("<span>&copy; ").f(n.getPath(!1,["otherData",n.get(["$idx"],!1),"name"]),n,"h").w("</span>")}c.__dustBody=!0;function l(t,n){return t.w('<span>&copy; <a href="').f(n.getPath(!1,["otherData",n.get(["$idx"],!1),"site"]),n,"h").w('" target="_blank">').f(n.getPath(!1,["otherData",n.get(["$idx"],!1),"name"]),n,"h").w("</a></span>")}l.__dustBody=!0;function d(t,n){return t.w(", ")}d.__dustBody=!0;return n};t.register=function(t){const n=this,e=TC.Control.prototype.register.call(n,t);n.apiAttribution=n.map.options.attribution||n.apiAttribution;var a=function(t){if(t){var e=t.getAttribution();if(e)if(/IDENA/.test(e.name)||/Tracasa Instrumental/.test(e.name))n.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var a=!1,r=0;r<n.dataAttributions.length;r++)if(e.name===n.dataAttributions[r].name){a=!0;break}a||n.dataAttributions.push(e)}}},r=function(t){if(t){if(!(t instanceof TC.Layer)||function(){if(t.map.workLayers.length>0){for(var n=t.map.workLayers.slice().reverse(),e=0;e<n.length;e++)if(n[e].url==t.url&&n[e].getVisibility())return!1;return!0}return!0}()){var e=t.getAttribution();if(e){var a=n.dataAttributions.reduce(function(t,n,a){return n.name===e.name?a:t},-1);const t=function(t){return(/IDENA/.test(e.name)||/Tracasa Instrumental/.test(e.name))&&(/IDENA/.test(t)||/Tracasa Instrumental/.test(t))||e.name===t};if(n.map.baseLayer&&n.map.baseLayer.wrap.getAttribution()&&t(n.map.baseLayer.wrap.getAttribution().name))return;if(n.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).some(function(n){var e=n.wrap.getAttribution();return e&&t(e.name)}))return;a>-1?n.dataAttributions.splice(a,1):(/IDENA/.test(e.name)||/Tracasa Instrumental/.test(e.name))&&(n.mainDataAttribution=null)}}}};n.render();t.loaded(function(){if(t.baseLayer.wrap.getAttribution){a(t.baseLayer.wrap);n.render()}});t.on(TC.Consts.event.LAYERADD,function(t){const e=t.layer;if(!e.isBase&&e.wrap.getAttribution){a(e.wrap);n.render()}});t.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(t){const e=t.type,i=t.newLayer,o=t.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(e)>-1&&(n.ignoreLayer=i);o&&o.wrap.getAttribution&&r(o.wrap);i&&i.wrap.getAttribution&&a(i.wrap);n.render()});t.on(TC.Consts.event.LAYERREMOVE,function(t){const e=t.layer;if(e.wrap.getAttribution){r(e.wrap);n.render()}});t.on(TC.Consts.event.TERRAINPROVIDERADD,function(t){const e=t.terrainProvider;if(e.getAttribution){a(e);n.render()}});t.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(t){const e=t.terrainProvider;if(e.getAttribution){r(e);n.render()}});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){const e=t.layer;if(n.ignoreLayer!==e&&e.wrap.getAttribution){e.getVisibility()?a(e.wrap):r(e.wrap);n.render()}});return e};t.render=function(t){const n=this;return n._set1stRenderPromise(n.renderData({api:n.apiAttribution,mainData:n.mainDataAttribution,otherData:n.dataAttributions,isCollapsed:!n.div.querySelector("."+n.CLASS+"-other")||n.div.querySelector("."+n.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const e=n.div.querySelector("."+n.CLASS+"-cmd");e&&e.addEventListener(TC.Consts.event.CLICK,function(){n.toggleOtherAttributions()});"function"==typeof t&&t()}))};t.toggleOtherAttributions=function(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(TC.Consts.classes.COLLAPSED)}}();
//# sourceMappingURL=../maps/control/Attribution.min.js.map