TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var t=TC.control.TOC.prototype;t.CLASS="tc-ctl-toc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/TOC.html";t.template[t.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(e.get(["workLayers"],!1),e,{block:n},{}).w("</ul></div>")}e.__dustBody=!0;function n(t,e){return t.p("tc-ctl-toc-wlbranch",e,e.rebase(e.getPath(!0,[])),{})}n.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:c},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:a},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:o},{}).w("</ul></li>")}e.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function c(t,e){return t.w('class="tc-ctl-toc-node"')}c.__dustBody=!0;function a(t,e){return t.w(" checked")}a.__dustBody=!0;function o(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:c},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:a},{}).w('<input type="checkbox" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:o},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:r},{}).w("</ul></li>")}e.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function c(t,e){return t.w('class="tc-ctl-toc-node"')}c.__dustBody=!0;function a(t,e){return t.w('<button class="tc-ctl-toc-collapse-btn"></button>')}a.__dustBody=!0;function o(t,e){return t.w(" checked")}o.__dustBody=!0;function r(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e}}t.register=function(t){const e=this,n=TC.control.MapContents.prototype.register.call(e,t);t.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){e.onExternalServiceAdded(t)});return n};t.onExternalServiceAdded=function(t){const e=this;if(t&&t.layer){t.layer.map=e.map;e.map.addLayer(t.layer).then(function(n){e.updateLayerTree(t.layer)})}};t.addUIEventListeners=function(){const t=this;t.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const n=e.target;for(var c=n;c&&!c.matches("ul."+t.CLASS+"-wl");)c=c.parentElement;const a=[];for(var o=0,r=c.children.length;o<r;o++){child=c.children[o];"LI"===child.tagName&&a.push(child)}for(o=0,r=a.length;o<r;o++){const e=a[o];if(e.contains(n)){const c=t.map.getLayer(e.dataset.layerId);var l=n;do{l=l.parentElement}while(l&&"LI"!==l.tagName);const a=l.dataset.layerUid;c.setNodeVisibility(a,n.checked);break}}e.stopPropagation()}));t.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",function(e){e.target.blur();const n=e.target.parentElement;if(!n.classList.contains(t.CLASS+"-leaf")){n.classList.toggle(TC.Consts.classes.COLLAPSED);n.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED);e.stopPropagation()}}))};t.update=function(){var t=this,e=function(t){for(var e=0,n=t.children.length;e<n;e++){const n=t.children[e];if(n.matches("input[type=checkbox]"))return n}return null};t.getLayerUIElements().forEach(function(n){const c=t.map.getLayer(n.dataset.layerId);if(c){e(n).checked=c.getVisibility();c.tree=null;n.querySelectorAll("li").forEach(function(t){const n=e(t),a=t.dataset.layerUid;switch(c.getNodeVisibility(a)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:n.checked=!0;n.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:n.checked=!1;n.indeterminate=!0;break;default:n.checked=!1;n.indeterminate=!1}})}});t.updateScale()};t.updateScale=function(){const t=this;t.getLayerUIElements().forEach(function(e){const n=t.map.getLayer(e.dataset.layerId);e.querySelectorAll("li").forEach(function(e){const c=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!n.isVisibleByScale(c))})})};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var n=e.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n,e.layerTrees[t.id],function(n,c){const a=(new DOMParser).parseFromString(c,"text/html").body.firstChild,o=a.dataset.layerUid,r=e.div.querySelector("."+e.CLASS+'-wl li[data-layer-uid="'+o+'"]');if(r){r.innerHTML=a.innerHTML;r.setAttribute("class",a.getAttribute("class"));r.dataset.layerId||(r.dataset.layerId=t.id)}else{a.dataset.layerId=t.id;const n=e.div.querySelector("."+e.CLASS+"-wl");n.insertBefore(a,n.firstChild)}n&&TC.error(n)});var c="ul."+e.CLASS+"-wl",a="ul."+e.CLASS+"-branch",o="li."+e.CLASS+"-node",r="li."+e.CLASS+"-leaf";e.div.querySelectorAll(c+" "+a+" "+a+","+c+" "+a+" "+o).forEach(function(t){t.matches(r)||t.classList.add(TC.Consts.classes.COLLAPSED)});e.update()})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(n){if(n.dataset.layerId===t.id){var c=!t.getVisibility();n.querySelectorAll("input[type=checkbox]").forEach(function(t){t.matches("."+e.CLASS+"-branch-cb")?t.checked=!c:t.disabled=c})}})};t.updateLayerOrder=function(t,e,n){};t.render=function(t){const e=this;return TC.Control.prototype.render.call(e,function(){var n=e.options.controls||[];if(n.length>0){var c=n[0],a=document.createElement("div");e.div.appendChild(a);e.map.addControl(c.name,TC.Util.extend({div:a},c.options))}TC.Util.isFunction(t)&&t()})};t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var n=0,c=e.length;n<c;n++){child=e[n];"LI"===child.tagName&&(t[t.length]=child)}return t}}();
//# sourceMappingURL=../maps/control/TOC.min.js.map