TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var t=TC.control.TOC.prototype;t.CLASS="tc-ctl-toc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/TOC.html";t.template[t.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(e.get(["workLayers"],!1),e,{block:n},{}).w("</ul></div>")}e.__dustBody=!0;function n(t,e){return t.p("tc-ctl-toc-wlbranch",e,e.rebase(e.getPath(!0,[])),{})}n.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:c},{}).w(' data-tc-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-tc-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:a},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:o},{}).w("</ul></li>")}e.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function c(t,e){return t.w('class="tc-ctl-toc-node"')}c.__dustBody=!0;function a(t,e){return t.w(" checked")}a.__dustBody=!0;function o(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:c},{}).w(' data-tc-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-tc-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:a},{}).w('<input type="checkbox" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:o},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:s},{}).w("</ul></li>")}e.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}n.__dustBody=!0;function c(t,e){return t.w('class="tc-ctl-toc-node"')}c.__dustBody=!0;function a(t,e){return t.w('<button class="tc-ctl-toc-collapse-btn"></button>')}a.__dustBody=!0;function o(t,e){return t.w(" checked")}o.__dustBody=!0;function s(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}s.__dustBody=!0;return e}}var e="tcLayer",n="tcLayerUid";t.register=function(t){const e=this,n=TC.control.MapContents.prototype.register.call(e,t);t.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){e.onExternalServiceAdded.call(e,t,this)});return n};t.onExternalServiceAdded=function(t,e){const n=this;if(t&&t.layer){t.layer.map=e;e.addLayer(t.layer).then(function(e){n.updateLayerTree(t.layer)})}};t.addUIEventListeners=function(){var t=this;t.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(c){const a=c.target;for(var o=a;o&&!o.matches("ul."+t.CLASS+"-wl");)o=o.parentElement;const s=[];for(var r=0,l=o.children.length;r<l;r++){child=o.children[r];"LI"===child.tagName&&s.push(child)}for(r=0,l=s.length;r<l;r++){const t=s[r];if(t.contains(a)){const c=$(t).data(e);var i=a;do{i=i.parentElement}while(i&&"LI"!==i.tagName);const o=$(i).data(n);c.setNodeVisibility(o,a.checked);break}}c.stopPropagation()}));t.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",function(e){e.target.blur();const n=e.target.parentElement;if(!n.classList.contains(t.CLASS+"-leaf")){n.classList.contains(TC.Consts.classes.COLLAPSED)?n.classList.remove(TC.Consts.classes.COLLAPSED):n.classList.add(TC.Consts.classes.COLLAPSED);const t=n.querySelector("ul");t.classList.contains(TC.Consts.classes.COLLAPSED)?t.classList.remove(TC.Consts.classes.COLLAPSED):t.classList.add(TC.Consts.classes.COLLAPSED);e.stopPropagation()}}))};t.update=function(){var t=function(t){for(var e=0,n=t.children.length;e<n;e++){const n=t.children[e];if(n.matches("input[type=checkbox]"))return n}return null};this.getLayerUIElements().forEach(function(c){var a=$(c).data(e);if(a){t(c).checked=a.getVisibility();a.tree=null;c.querySelectorAll("li").forEach(function(e){const c=t(e);var o=$(e).data(n);switch(a.getNodeVisibility(o)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:c.checked=!0;c.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:c.checked=!1;c.indeterminate=!0;break;default:c.checked=!1;c.indeterminate=!1}})}});this.updateScale()};t.updateScale=function(){var t=this;t.getLayerUIElements().forEach(function(c){var a=$(c).data(e);c.querySelectorAll("li").forEach(function(e,c){var o=$(c);o.toggleClass(t.CLASS+"-node-notvisible",!a.isVisibleByScale(o.data(n)))})})};t.updateLayerTree=function(t){var c=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(c,t);c.div.querySelector("."+c.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var a=c.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(a,c.layerTrees[t.id],function(a,o){const s=(new DOMParser).parseFromString(o,"text/html").body.firstChild,r=$(s).data(n),l=c.div.querySelector("."+c.CLASS+'-wl li[data-tc-layer-uid="'+r+'"]');if(l){l.innerHTML=s.innerHTML;l.setAttribute("class",s.getAttribute("class"));$(l).data(e)||$(l).data(e,t)}else{$(s).data(e,t);const n=c.div.querySelector("."+c.CLASS+"-wl");n.insertBefore(s,n.firstChild)}a&&TC.error(a)});var o="ul."+c.CLASS+"-wl",s="ul."+c.CLASS+"-branch",r="li."+c.CLASS+"-node",l="li."+c.CLASS+"-leaf";c.div.querySelectorAll(o+" "+s+" "+s+","+o+" "+s+" "+r).forEach(function(t){t.matches(l)||t.classList.add(TC.Consts.classes.COLLAPSED)});c.update()})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var n=this;n.getLayerUIElements().forEach(function(c){if($(c).data(e)===t){var a=!t.getVisibility();c.querySelectorAll("input[type=checkbox]").forEach(function(t){t.matches("."+n.CLASS+"-branch-cb")?t.checked=!a:t.disabled=a})}})};t.updateLayerOrder=function(t,e,n){};t.render=function(t){const e=this;return TC.Control.prototype.render.call(e,function(){var n=e.options.controls||[];if(n.length>0){var c=n[0],a=document.createElement("div");e.div.appendChild(a);e.map.addControl(c.name,$.extend({div:a},c.options))}$.isFunction(t)&&t()})};t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var n=0,c=e.length;n<c;n++){child=e[n];"LI"===child.tagName&&(t[t.length]=child)}return t}}();
//# sourceMappingURL=../maps/control/TOC.min.js.map
