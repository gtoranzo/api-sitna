TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FeatureDownloadDialog=function(){TC.Control.apply(this,arguments);this.title=this.options.title;this.cssClass=this.options.cssClass||"";this._selectors={ELEVATION_CHECKBOX:"."+this.CLASS+"-elev input[type=checkbox]",INTERPOLATION_PANEL:"."+this.CLASS+"-ip",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:"."+this.CLASS+"-ip-m"}};TC.inherit(TC.control.FeatureDownloadDialog,TC.Control);!function(){const t=TC.control.FeatureDownloadDialog.prototype;t.CLASS="tc-ctl-dwn-dialog";var e,o=["KML","GML","GeoJSON","WKT","GPX"],n=!1,l=null;t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-dwn-dialog tc-modal ').f(e.get(["cssClass"],!1),e,"h").w('"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').f(e.get(["title"],!1),e,"h").w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(e.get(["elevation"],!1),e,{block:o},{}).w('<div class="tc-ctl-dwn-dialog-dl"><div>').s(e.get(["formats"],!1),e,{block:l},{}).w("</div></div></div></div></div>")}e.__dustBody=!0;function o(t,e){return t.w('<div class="tc-ctl-dwn-dialog-elev"><input id="').f(e.get(["checkboxId"],!1),e,"h").w('" type="checkbox"><label for="').f(e.get(["checkboxId"],!1),e,"h").w('" class="tc-ctl-dwn-dialog-elev-label">').h("i18n",e,{},{$key:"includeElevations"}).w("</label></div>").x(e.get(["resolution"],!1),e,{block:n},{})}o.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-dwn-dialog-ip tc-hidden"><h4>').h("i18n",e,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="finfo-ip-coords" value="0" checked /><span>').h("i18n",e,{},{$key:"no"}).w('</span></label><label><input type="radio" name="finfo-ip-coords" value="1" /><span>').h("i18n",e,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dwn-dialog-ip-m tc-hidden">').h("i18n",e,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(e.get(["resolution"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;function l(t,e){return t.h("select",e,{block:a},{key:e.getPath(!0,[])})}l.__dustBody=!0;function a(t,e){return t.h("eq",e,{block:r},{value:"KML"}).h("eq",e,{block:i},{value:"KMZ"}).h("eq",e,{block:s},{value:"GML"}).h("eq",e,{block:c},{value:"GeoJSON"}).h("eq",e,{block:u},{value:"WKT"}).h("eq",e,{block:d},{value:"GPX"})}a.__dustBody=!0;function r(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-kml" data-format="KML" title="KML">KML</button>')}r.__dustBody=!0;function i(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-kmz" data-format="KMZ" title="KMZ">KMZ</button>')}i.__dustBody=!0;function s(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-gml" data-format="GML" title="GML">GML</button>')}s.__dustBody=!0;function c(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button>')}c.__dustBody=!0;function u(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-wkt" data-format="WKT" title="WKT">WKT</button>')}u.__dustBody=!0;function d(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-gpx" data-format="GPX" title="GPX">GPX</button>')}d.__dustBody=!0;return e};t.render=function(t){return TC.Control.prototype.render.call(this,t)};t.open=function(a,r){const i=this;t.getRenderedHtml(t.CLASS,Object.assign({},{cssClass:i.cssClass,checkboxId:i.getUID(),elevation:r.elevation,formats:o.filter(function(t){return(r&&r.excludedFormats&&r.excludedFormats.indexOf(t)<0)|!r|!r.excludedFormats})},r),function(t){var o=document.createElement("template");o.innerHTML=t;var s=o.content?o.content.firstChild:o.firstChild;document.body.appendChild(s);var c=s.getElementsByClassName("tc-modal-body")[0];c.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(t){var o=e&&n?parseFloat(c.querySelector(i._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||(i.options.elevation||i.map.elevation.options).resolution:0;const l=async t=>{var n=!1;s!==TC.Consts.format.GEOJSON&&r.format!==TC.Consts.format.WKT&&(t instanceof Array?t:[t]).some(function(t){for(var e in t.getData())if(t.data[e]instanceof Object)return!0;return!1})&&await TC.confirm(i.getLocaleString("dl.export.complexAttr").format(s),null,function(){n=!0});if(n)return;const l=i.map.getLoadingIndicator(),a=l&&l.addWait();TC.Util.closeModal();(function(t,e){const o=this;e=e||{};const n=Array.isArray(t)?t:[t];return new Promise(function(t,l){if(!e.displayElevation){t(n.map(function(t){if(t.getGeometryStride()>2){const e=t.clone();e.getCoordsArray().forEach(t=>t.length=2);e.setCoords(e.geometry);return e}return t}));return}let a=e.elevation&&e.elevation.resolution,r=a?n.map(t=>t.clone()):n.map(t=>t.getGeometryStride()>2?null:t.clone());if(a||r.some(t=>null!==t)){const a={crs:o.map.crs,features:r,maxCoordQuantity:e.elevation&&e.elevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:e.elevation.sampleNumber||0};(o.map.elevation||new TC.tool.Elevation("boolean"==typeof o.options.elevation?{}:o.options.elevation)).setGeometry(a).then(function(e){e.forEach((t,o)=>{t||(e[o]=n[o])});t(e)},function(t){l(t instanceof Error?t:Error(t))})}else t(n)})}).apply(i,[t,{displayElevation:e,elevation:e?Object.assign({},r.elevation||i.map.elevation.options,{resolution:o}):null}]).then(function(t){let e=r?r.fileName||r.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0):r.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0);i.map.exportFeatures(t,{fileName:e,format:s})},function(e){i.open(t,r);TC.tool.Elevation&&e.message===TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.alert(i.getLocaleString("tooManyCoordinatesForElevation.warning")):TC.error(i.getLocaleString("elevation.error"))}).finally(function(){l&&l.removeWait(a)})},s=t.target.dataset.format;s===TC.Consts.format.GPX&&(a instanceof Array?a:[a]).some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon})?TC.confirm(i.getLocaleString("gpxNotCompatible.confirm"),function(){l((a instanceof Array?a:[a]).filter(t=>TC.feature.Polygon&&!(t instanceof TC.feature.Polygon)))}):l(a)}));const u=(a instanceof Array?a:[a]).some(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline}),d=(a instanceof Array?a:[a]).some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon});if(r.elevation){c.querySelector(i._selectors.ELEVATION_CHECKBOX).checked=1==e;e&&(u||d)&&r.elevation.resolution&&c.querySelector(i._selectors.INTERPOLATION_PANEL).classList.remove(TC.Consts.classes.HIDDEN);if(c.querySelector(i._selectors.INTERPOLATION_PANEL)){c.querySelectorAll(i._selectors.INTERPOLATION_RADIO)[n?1:0].checked=!0;if(n){c.querySelector(i._selectors.INTERPOLATION_DISTANCE).classList.remove(TC.Consts.classes.HIDDEN);c.querySelector(i._selectors.INTERPOLATION_DISTANCE+" input").value=l||c.querySelector(i._selectors.INTERPOLATION_DISTANCE+" input").value}}}c.addEventListener("change",TC.EventTarget.listenerBySelector(i._selectors.ELEVATION_CHECKBOX,function(t){var o=c.querySelector(i._selectors.INTERPOLATION_PANEL);o&&o.classList.toggle(TC.Consts.classes.HIDDEN,e||!(u||d));e=!e}));c.addEventListener("change",TC.EventTarget.listenerBySelector(i._selectors.INTERPOLATION_RADIO,function(t){c.querySelector(i._selectors.INTERPOLATION_DISTANCE).classList.toggle(TC.Consts.classes.HIDDEN);(n=!n)&&(c.querySelector(i._selectors.INTERPOLATION_DISTANCE+" input").value=l||c.querySelector(i._selectors.INTERPOLATION_DISTANCE+" input").value)}));c.addEventListener("change",TC.EventTarget.listenerBySelector(i._selectors.INTERPOLATION_DISTANCE,function(t){l=t.target.value}));TC.Util.showModal(s,{closeCallback:function(){s.parentElement.removeChild(s)}})})}}();
//# sourceMappingURL=../maps/control/FeatureDownloadDialog.min.js.map