TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(e,t){TC.Util.getQueryStringParams(t);for(var s=0,a=TC._appCacheBuilders.length;s<a;s++){var n=TC._appCacheBuilders[s];switch(e.type){case"cached":n.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t});break;case"obsolete":n.trigger(TC.Consts.event.MAPCACHEDELETE,{url:t});break;case"checking":break;case"progress":n.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:t,loaded:e.loaded,total:e.total});break;case"error":n.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:e.reason,status:e.status});break;case"noupdate":case"updateready":n.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:"already_exists",status:e.status})}}});var t,s=function(){return new Promise(function(e,t){var s=document.documentElement.getAttribute("manifest");s?TC.ajax({url:s,method:"GET",responseType:"text"}).then(function(t){TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var s=hex_md5(t),a=t.indexOf("NETWORK:");a>=0&&(t=t.substr(0,a));(a=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,a));(a=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,a));var n=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});n.shift();e({hash:s,urls:n})})}).catch(function(){t()}):t()})};if(e){const s=(t=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater,function(e){t&&parent.TC._appCacheUpdater(e,location.href)});e.addEventListener("cached",s,!1);e.addEventListener("error",s,!1);e.addEventListener("noupdate",s,!1);e.addEventListener("obsolete",s,!1);e.addEventListener("progress",s,!1);e.addEventListener("updateready",s,!1)}TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var s=0,a=localStorage.length;s<a;s++){var r=localStorage.key(s);if(0===r.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)&&r!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var o=localStorage.getItem(r).split(" "),l=n(o.shift()),i={name:o.join(" "),extent:l,url:decodeURIComponent(r.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(i)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(t){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var c=$.extend({},a>1?arguments[1]:arguments[0]);e._dialogDiv=TC.Util.getDiv(c.dialogDiv);e._$dialogDiv=$(e._dialogDiv);c.dialogDiv||document.body.appendChild(e._dialogDiv);e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var d=history.pushState;history.pushState=function(t){var s;s=d.apply(history,arguments);if(e._offlinePanelDiv){var a=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),n=TC.Util.getQueryStringParams();delete n[e.MAP_DEFINITION_PARAM_NAME];delete n[e.MAP_EXTENT_PARAM_NAME];delete n[e.SERVICE_WORKER_FLAG];var r=$.param(n);r.length&&(r="?"+r);var o=a+r+location.hash;e._offlinePanelDiv.querySelector(e._selectors.EXIT).setAttribute("href",o)}return s};var u=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},C=function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.remove(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI);switch(u.type){case 1:case 2:case void 0:t.classList.add(TC.Consts.classes.CONNECTION_WIFI);break;default:t.classList.add(TC.Consts.classes.CONNECTION_MOBILE)}}};u.addEventListener&&u.addEventListener("typechange",C);window.addEventListener("online",C);window.addEventListener("offline",function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var a=TC.control.CacheBuilder.prototype;a.CLASS="tc-ctl-cbuild";a.MAP_DEFINITION_PARAM_NAME="map-def";a.MAP_EXTENT_PARAM_NAME="map-extent";a.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";a.ROOT_CACHE_NAME="root";a.COOKIE_KEY_PREFIX="TC.offline.map.";a.CACHE_REQUEST_PATH="offline";a.SERVICE_WORKER_FLAG="sw";a._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};a._actions={CREATE:"create",DELETE:"delete"};a.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";a.template={};if(TC.isDebug){a.template[a.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";a.template[a.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";a.template[a.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";a.template[a.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";a.template[a.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{a.template[a.CLASS]=function(){dust.register(a.CLASS,e);function e(e,a){return e.w("<h2>").h("i18n",a,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",a,{},{$key:"cb.filter.plhr"}).w('"').x(a.get(["storedMaps"],!1),a,{else:t,block:s},{}).w(' maxlength="200" /> <ul id="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(a.get(["storedMaps"],!1),a,{block:n},{}).w("><span>").h("i18n",a,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",a,{},{$key:"noMatches"}).w("</span></li>").s(a.get(["storedMaps"],!1),a,{block:r},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",a,{},{$key:"newofflinemap"}).w('">').h("i18n",a,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",a,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function t(e,t){return e.w(" disabled")}t.__dustBody=!0;function s(e,t){return e}s.__dustBody=!0;function n(e,t){return e.w(" hidden")}n.__dustBody=!0;function r(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}r.__dustBody=!0;return e};a.template[a.CLASS+"-map-node"]=function(){dust.register(a.CLASS+"-map-node",e);function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};a.template[a.CLASS+"-bl-node"]=function(){dust.register(a.CLASS+"-bl-node",e);function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}e.__dustBody=!0;return e};a.template[a.CLASS+"-dialog"]=function(){dust.register(a.CLASS+"-dialog",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w('</h4><p class="tc-ctl-cbuild-bl-panel-txt">').h("i18n",t,{},{$key:"selectAtLeastOne"}).w('</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};a.template[a.CLASS+"-off-panel"]=function(){dust.register(a.CLASS+"-off-panel",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e}}const n=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},r=function(e,t){t.querySelector("span").classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.TEXTBOX).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.SAVEBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.remove(TC.Consts.classes.HIDDEN)};var o=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},l=function(e,t){var s=t||{};const a=e._dialogDiv.querySelector(e._classSelector+"-res"),n=e._dialogDiv.querySelector(e._selectors.RNGMAXRES);var r,o,l,i=e.getResolutions();if(i.length){if(e.minResolution){if(void 0===s.rangeValue)for(var c=0,d=i.length;c<d;c++)if(e.minResolution>=i[c]){n.value=c;break}}else void 0===s.rangeValue&&(n.value=Math.floor(i.length/2));n.setAttribute("max",i.length-1);o=parseInt(n.value);var u=Math.floor(1e3*new Number(i[o]))/1e3;r=e.getLocaleString("metersPerPixel",{value:u.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});l=100*(o+1)/(i.length+1)+"%";n.disabled=!1;e.minResolution=i[n.value]}else{o=0;r="";n.value=0;l="0";e.minResolution=0;n.disabled=!0}a.style.left=l;a.innerHTML=r};const i=function(e){e._dialogDiv.querySelectorAll(e._classSelector+"-bl-node input[type=checkbox]").forEach(function(t,s){if(t.checked){var a=e.requestSchemas.filter(function(e){return e.layerId===t.value})[0];if(a){var n=function(e,t){for(var s=null,a=0,n=e.tileMatrixLimits.length;a<n&&!((s=e.tileMatrixLimits[a]).res<=t);a++);return s}(a,e.minResolution);if(n){var r=a.url;if(r.indexOf("{TileMatrix}")<0){var o=r.indexOf("?");o>=0&&(r=r.substr(0,o));for(var l=0,i=e.baseLayers.length;l<i;l++){var c=e.baseLayers[l];if(c.id===a.layerId){r=r+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}for(;t&&"LABEL"!==t.tagName;)t=t.parentElement;if(t){t.style.backgroundSize="auto";t.style.backgroundPosition="left bottom";t.style.backgroundImage="url("+r.replace("{TileMatrix}",n.mId).replace("{TileRow}",n.rt).replace("{TileCol}",n.cl)+")"}}}}})},c=function(e,t){return t<1?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:o(t)})},d=function(e){var t="";e.tileCount=0;for(var s=0,a=e.requestSchemas.length;s<a;s++)for(var n=e.requestSchemas[s],r=0,l=n.tileMatrixLimits.length;r<l;r++){var i=n.tileMatrixLimits[r];e.tileCount+=(i.cr-i.cl+1)*(i.rb-i.rt+1);if(i.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:o(e.tileCount)})+" ("+c(e,e.estimatedMapSize)+")"}e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML=t},u=function(e,t){var s=t.indexOf("#");s>=0&&(t=t.substr(0,s));const a=e.div.querySelectorAll(e._selectors.LISTITEM);for(var n=0,r=a.length;n<r;n++){const e=a[n],s=e.querySelector("a");if(s&&s.getAttribute("href")===t)return e}return null},C=function(e,t){const s=document.createElement("iframe");s.style.display="none";s.setAttribute("src",t);e.div.appendChild(s)},T=function(e,t){const s=e.div.querySelector('iframe[src="'+t+'"]');s&&s.parentElement.removeChild(s)};var f=function(e,t){var s=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);s=!0}return s};const E=function(e,t){const s=e.findStoredMap({url:t});if(s){if(function(e,t){var s=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));s=!0}return s}(e,t)){const t=function(e,t){const s=e.div.querySelectorAll(e._selectors.LISTITEM);for(var a=0,n=s.length;a<n;a++){const e=s[a],n=e.querySelector("a");if(n&&n.innerHTML===t)return e}return null}(e,s.name);t&&t.parentElement.removeChild(t)}var a=$.inArray(s,e.storedMaps);e.storedMaps.splice(a,1);if(!e.storedMaps.length){e.div.querySelector(e._selectors.SEARCH).disabled=!0;e.div.querySelector(e._selectors.EMPTYLIST).removeAttribute("hidden")}return s.name}return null};a.render=function(e){const t=this;return t._set1stRenderPromise(new Promise(function(s,a){var o={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(o,function(){t._dialogDiv.querySelector(t._selectors.OKBTN).addEventListener(TC.Consts.event.CLICK,function(){t.generateCache()});t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener("input",function(){t._updateReadyState()});t.div.querySelector(t._selectors.NEWBTN).addEventListener(TC.Consts.event.CLICK,function(){t.setEditState()});t.div.querySelector(t._classSelector+"-btn-cancel-draw").addEventListener(TC.Consts.event.CLICK,function(){t.setReadyState()});t.div.querySelector(t._classSelector+"-btn-cancel-dl").addEventListener(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});const s=t.div.querySelector(t._selectors.LIST);s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.DELETEBTN,function(e){t.startDeleteMap(e.target.parentElement.querySelector("a").innerHTML)}));s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.EDITBTN,function(e){!function(e,t){t.querySelector("span").classList.add(TC.Consts.classes.HIDDEN);const s=t.querySelector(e._selectors.TEXTBOX);s.classList.remove(TC.Consts.classes.HIDDEN);s.value=t.querySelector("span a").innerHTML;s.focus();t.querySelector(e._selectors.SAVEBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.add(TC.Consts.classes.HIDDEN)}(t,e.target.parentElement)}));s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.CANCELBTN,function(e){const s=e.target.parentElement;s.querySelector(t._selectors.TEXTBOX).value=s.querySelector("a").innerHTML;r(t,s)}));s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.SAVEBTN,function(e){const s=e.target.parentElement;r(t,s);const a=s.querySelector("a"),n=(a.innerHTML,s.querySelector(t._selectors.TEXTBOX).value),o=t.findStoredMap({url:a.getAttribute("href")});if(o){o.name=n;a.innerHTML=n;a.setAttribute("title",n);f(t,o)}}));s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.VIEWBTN,function(e){const s=e.target;var a=!s.classList.contains(TC.Consts.classes.ACTIVE);const r=t.div.querySelector(t._selectors.VIEWBTN);r.classList.remove(TC.Consts.classes.ACTIVE);r.parentElement.classList.remove(TC.Consts.classes.ACTIVE);const o=s.parentElement.querySelector("a").innerHTML;if(o){var l=t.findStoredMap({name:o});if(l){var i=n(l.extent);t.layer.clearFeatures();if(a){t.layer.addPolygon([[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});s.classList.add(TC.Consts.classes.ACTIVE);s.parentElement.classList.add(TC.Consts.classes.ACTIVE);s.setAttribute("title",t.getLocaleString("removeMapExtent"))}}}}));const a=t.div.querySelector(t._selectors.SEARCH),o=function(){!function(e){e=e.toLowerCase();const s=t.div.querySelectorAll(t._selectors.LISTITEM);s.forEach(function(e){e.style.display="none"});const a=[];s.forEach(function(e){e.matches("li:not([class]),li."+TC.Consts.classes.ACTIVE)&&a.push(e)});if(0===e.length){a.forEach(function(e){e.style.removeProperty("display")});t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="visible"}else{t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="hidden";var n=new RegExp(e,"i");a.forEach(function(e){e.style.display=n.test(e.querySelector("a").textContent)?"":"none"});a.some(function(e){return!e.hidden})||s.forEach(function(e){e.matches('[class^="tc-ctl-cbuild-map-not"]')&&e.style.removeProperty("display")})}}(this.value.toLowerCase().trim())};a.addEventListener("keyup",o);a.addEventListener("search",o);t._dialogDiv.querySelector(t._selectors.BLLIST).addEventListener("change",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){t.baseLayers.length=0;t._dialogDiv.querySelectorAll(t._selectors.BLLIST+" input[type=checkbox]").forEach(function(e){if(e.checked)for(var s=e.value,a=0,n=t.map.baseLayers.length;a<n;a++){var r=t.map.baseLayers[a];if(r.id===s&&r.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=r;break}}});t.updateRequestSchemas();l(t);i(t);t._updateReadyState();d(t)}));const c=t._dialogDiv.querySelector(t._selectors.RNGMAXRES),C=function(e){l(t,{rangeValue:e.target.value});i(t);d(t)};c.addEventListener("input",C);c.addEventListener("change",C);const T=u(t,location.href);T&&T.classList.add(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()}).then(function(){s()}).catch(function(e){a(e instanceof Error?e:Error(e))})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var s=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=s;return s}},!0)}))};a.register=function(e){var t=this;const a=TC.control.SWCacheClient.prototype.register.call(t,e);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":t.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total});break;case"cached":t.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name});break;case"deleted":t.trigger(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name});break;case"error":e.data.action===t._actions.CREATE&&TC.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});s().then(function(e){const s=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var a;window.localStorage&&(a=localStorage.getItem(s));if(a!==e.hash){t.cacheUrlList(e.urls);t.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){const n=!a;window.localStorage&&localStorage.setItem(s,e.hash);n||TC.confirm(t.getLocaleString("newAppVersionAvailable"),function(){location.reload()})})}})}if(t.mapIsOffline){e.div.classList.add(TC.Consts.classes.OFFLINE);t._offlinePanelDiv=TC.Util.getDiv(t.options.offlinePanelDiv);t.options.offlinePanelDiv||e.div.appendChild(t._offlinePanelDiv);t.getRenderedHtml(t.CLASS+"-off-panel",null,function(e){t._offlinePanelDiv.innerHTML=e;if(!navigator.onLine){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);e.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);e.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}t._offlinePanelDiv.querySelector(t._selectors.EXIT).addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}const r=t.getUID(),o=t.getUID();t.layerPromise=e.addLayer({id:o,type:TC.Consts.layerType.VECTOR,stealth:!0,styles:{line:e.options.styles.line}});t.layer=null;Promise.all([t.layerPromise,t.renderPromise(),e.addControl("draw",{id:r,div:t.div.querySelector(t._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1})]).then(function(s){const a=t.layer=s[0],n=t.boxDraw=s[2];n.setLayer(a);n.on(TC.Consts.event.DRAWSTART,function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var s=e.feature.geometry[0],a=s[0],n=s[2],r=Math.min(a[0],n[0]),o=Math.max(a[0],n[0]),l=Math.min(a[1],n[1]),c=Math.max(a[1],n[1]);t.setExtent([r,l,o,c]);const u=t._dialogDiv.querySelectorAll("input[type=checkbox]");u.forEach(function(e){for(var s=0,a=t.map.baseLayers.length;s<a;s++){var n=t.map.baseLayers[s];if(e.value===n.id){for(var r=e;r&&"LI"!==r.tagName;)r=r.parentElement;var o=n.getResolutions(),l=t.wrap.getRequestSchemas({extent:t.extent,layers:[n]})[0].tileMatrixLimits;if(l.length&&o[o.length-1]==l[l.length-1].res)r.classList.remove(TC.Consts.classes.HIDDEN);else{e.checked=!1;r.classList.add(TC.Consts.classes.HIDDEN)}break}}});var C;const T=t._dialogDiv.querySelectorAll(t._selectors.BLLISTITEM);for(var f=0,E=T.length;f<E;f++)if(T[f].matches("."+TC.Consts.classes.HIDDEN)){C="selectAtLeastOne";break}C||(C="cb.noMapsAtSelectedExtent");t._dialogDiv.querySelector(t._selectors.BLLISTTEXT).innerHTML=t.getLocaleString(C);i(t);d(t);TC.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-dialog"),{openCallback:function(){u.forEach(function(e){e.disabled=!1});var e;if(Date.prototype.toLocaleString){var s={};s.year=s.month=s.day=s.hour=s.minute=s.second="numeric";e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),s)}else e=(new Date).toString();t._dialogDiv.querySelector(t._selectors.NAMETB).value=e;t._updateReadyState()},closeCallback:function(){u.forEach(function(e){e.disabled=!0});t.layer.clearFeatures()}})});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){n===e.control&&t._state===t._states.EDITING&&t.setReadyState()})});var l=function(e){var s=!1;const a=t._dialogDiv.querySelector(t._selectors.BLLIST),n=function(){return!!a.querySelector('li[data-tc-layer-uid="'+e.id+'"]')};var r=e.type===TC.Consts.layerType.WMTS&&!e.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(r=r&&TC.Util.isSameOrigin(e.url));if(r&&!n()){s=!0;t.getRenderedHtml(t.CLASS+"-bl-node",e,function(e){if(!n()){const t=new DOMParser;a.appendChild(t.parseFromString(e,"text/html").body.firstChild)}})}return s};e.on(TC.Consts.event.LAYERADD,function(e){t.renderPromise().then(function(){l(e.layer)})}).on(TC.Consts.event.LAYERREMOVE,function(e){t.renderPromise().then(function(){const s=e.layer;if(s.type===TC.Consts.layerType.WMTS){const e=t._dialogDiv.querySelector(t._selectors.BLLIST).querySelector('li[data-tc-layer-uid="'+s.id+'"]');e.parentElement.removeChild(e)}})});var c=TC.Util.getQueryStringParams(),C=c[t.MAP_DEFINITION_PARAM_NAME],p=c[t.MAP_EXTENT_PARAM_NAME];e.ready(function(){if(t.mapIsOffline){var s,a,n=[];for(s=0,a=t.offlineControls.length;s<a;s++){var r=t.offlineControls[s];r=r.substr(0,1).toUpperCase()+r.substr(1);n=n.concat(e.getControlsByClass("TC.control."+r))}for(s=0,a=e.controls.length;s<a;s++){var o=e.controls[s];n.indexOf(o)<0&&o.disable()}document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})}});e.loaded(function(){t.layerPromise.then(function(t){e.putLayerOnTop(t)});t.renderPromise().then(function(){t.div.querySelector(t._selectors.NEWBTN).disabled=!1;for(var s=0,a=e.baseLayers.length;s<a;s++)l(e.baseLayers[s])});if(t.mapIsOffline){var s=JSON.parse(window.atob(decodeURIComponent(C))),a=[],r=$.grep(e.baseLayers,function(e){var t=!1;if(e.type===TC.Consts.layerType.WMTS)for(var n=0,r=s.layers.length;n<r;n++){var o=s.layers[n];if((0===e.url.indexOf("//")?location.protocol+e.url:e.url)===s.url[o.urlIdx]&&e.layerNames===o.id&&e.matrixSet===s.tms[o.tmsIdx]){t=!0;break}}t||e.type!==TC.Consts.layerType.VECTOR&&(a[a.length]=e);return t})[0];r&&e.setBaseLayer(r);for(var o=0,i=a.length;o<i;o++)e.removeLayer(a[o]);e.setExtent(n(p))}});t.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(s){t.isDownloading=!1;const a=function(e){const t=e.indexOf("#");return t>=0?e.substr(0,t):e}(s.url),n=u(t,a);if(n&&!t.serviceWorkerEnabled){n.classList.remove(TC.Consts.classes.DISABLED);TC.alert(t.getLocaleString("cb.delete.error"))}else if(t.currentMap&&a===t.currentMap.url){!function(e){const t=e.currentMap;if(f(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){const s=new DOMParser;e.div.querySelector(e._selectors.LIST).appendChild(s.parseFromString(t,"text/html").body.firstChild);e.div.querySelector(e._selectors.EMPTYLIST).setAttribute("hidden","hidden");e.div.querySelector(e._selectors.SEARCH).disabled=!1});e.storedMaps.push(t)}}(t);e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))}t.currentMap=null;T(t,s.url);t.setReadyState()}).on(TC.Consts.event.MAPCACHEDELETE,function(s){t.isDownloading=!1;var a=E(t,s.url)||t.currentMap&&t.currentMap.name;T(t,s.url);t.currentMap=null;if(a){document.cookie=t.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";e.toast(t.getLocaleString("mapDeleted",{mapName:a}))}t.setReadyState()}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var s=e.total;!s&&t.requestSchemas&&(s=t.requestSchemas[0].tileCount);var a=e.loaded;if(a)t._loadedCount=a;else{t._loadedCount+=1;a=t._loadedCount}t.showDownloadProgress(a,s)}).on(TC.Consts.event.MAPCACHEERROR,function(e){t.isDownloading=!1;T(t,e.url);t.setReadyState();var s=t.getLocaleString("cb.mapCreation.error"),a=!0;switch(e.reason){case"quota":s+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":s+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&E(t,e.url);a=!1;break;case"already_exists":s+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(a)if(TC.Util.detectIE()){TC.error(s);TC.alert(t.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(s);t.currentMap=null});return a};a.setExtent=function(e){if($.isArray(e)&&e.length>=4){this.extent=e;this.updateRequestSchemas()}};a._updateReadyState=function(){this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!this.extent||0===this._dialogDiv.querySelector(this._selectors.NAMETB).value.length||this._dialogDiv.querySelector(this._selectors.RNGMAXRES).disabled};a.setReadyState=function(){const e=this;e._state=e._states.READY;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.remove(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()};a.setEditState=function(){this._state=this._states.EDITING;this.showDownloadProgress(0,1);this.div.querySelector(this._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.DRAWING).classList.remove(TC.Consts.classes.HIDDEN);this.map.toast(this.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!0;this.div.querySelector(this._selectors.NEWBTN).disabled=!0;this._dialogDiv.querySelector(this._selectors.NAMETB).value="";this.boxDraw.activate()};a.generateCache=function(){const e=this,t={mapName:e._dialogDiv.querySelector(e._selectors.NAMETB).value};if(e.findStoredMap({name:t.mapName}))TC.alert(e.getLocaleString("cb.mapNameAlreadyExists.error",t));else{var a=function(){e.div.querySelector(e._classSelector+"-name").innerHTML=t.mapName;e.map.toast(e.getLocaleString("downloadingMap",{mapName:t.mapName}));!function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.remove(TC.Consts.classes.HIDDEN);e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!0;e.layer.clearFeatures();e.boxDraw.cancel()}(e);e.requestCache(t)},n=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(n.queryUsageAndQuota)n.queryUsageAndQuota(function(s,n){var r=(n-s)/1048576;e.estimatedMapSize<r?a():TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:t.mapName,mapSize:c(e,e.estimatedMapSize),availableStorage:c(e,Math.round(r))}),a)},function(e){TC.error(e)});else{var r=TC.Util.detectIE();if(r){var l=r<12?1e3:2e3,i=0,d=function(){var s=e.tileCount+i;s>l?TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:t.mapName,resourceCount:o(s),maxResourceCount:o(l)}),a):a()};s().then(function(e){i=e.urls.length;d()}).catch(d)}else a()}}};a.cacheUrlList=function(e,t){var s=t||{};this.createCache(s.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:e,silent:s.silent})};a.requestCache=function(e){var t=this,s=e||{};if(t.map){var a=s.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:a});if(t.requestSchemas){for(var n=function(e,s,a){var n=e.res>=t.minResolution;!n&&s>0&&(n=a[s-1].res>t.minResolution);return n},r=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},o=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(n)}}),l=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],i=0,c=o.length;i<c;i++){var d=o[i],u=(O=d.tileMatrixLimits[d.tileMatrixLimits.length-1]).res*O.tSize;l[0]=Math.min(l[0],O.origin[0]+u*O.cl);l[1]=Math.min(l[1],O.origin[1]-u*(O.rb+1));l[2]=Math.max(l[2],O.origin[0]+u*(O.cr+1));l[3]=Math.max(l[3],O.origin[1]-u*O.rt);d.tileMatrixLimits=d.tileMatrixLimits.map(r)}var T=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),f={bBox:l=l.map(function(e,t){return(t<3?Math.ceil:Math.floor)(e*T)/T}),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};for(i=0,c=t.baseLayers.length;i<c;i++){var E=t.baseLayers[i],p=0===E.url.indexOf("//")?location.protocol+E.url:E.url,v=$.inArray(p,f.url);v<0&&(v=f.url.push(p)-1);var h=$.inArray(E.matrixSet,f.tms);h<0&&(h=f.tms.push(E.matrixSet)-1);var S=E.format.substr(E.format.indexOf("/")+1),g=$.inArray(S,f.format);g<0&&(g=f.format.push(S)-1);f.layers[i]={urlIdx:v,id:E.layerNames,tmsIdx:h,formatIdx:g}}var L=TC.Util.getQueryStringParams(),y=L[t.MAP_EXTENT_PARAM_NAME]=l.toString();L[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(f));t.serviceWorkerEnabled&&(L[t.SERVICE_WORKER_FLAG]=1);var _=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(L);t.currentMap={name:s.mapName,extent:y,url:_};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(i=0,c=o.length;i<c;i++){for(var b=o[i],I=null,N=0,A=t.baseLayers.length;N<A;N++){var D=t.baseLayers[N];if(D.id===b.layerId){I=t.wrap.getGetTilePattern(D);break}}if(I){urlList=[];var M=0;for(k=0,lenk=b.tileMatrixLimits.length;k<lenk;k++){var O;for(D=(O=b.tileMatrixLimits[k]).cl;D<=O.cr;D++)for(m=O.rt;m<=O.rb;m++)urlList[M++]=I.replace("{TileMatrix}",O.mId).replace("{TileCol}",D).replace("{TileRow}",m)}urlList.push(_);t.cacheUrlList(urlList,{name:_})}}else C(t,_)}}};a.cancelCacheRequest=function(){var e=this;if(e.currentMap){T(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;e.setReadyState()};a.deleteMap=function(e){var t=this,s=t.findStoredMap({name:e});if(s){var a=TC.Util.getQueryStringParams(s.url);t.deleteCache(s.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(a[t.MAP_DEFINITION_PARAM_NAME]));C(t,s.url)}})}};a.startDeleteMap=function(e){const t=this;if(navigator.onLine){if(e){var s=t.getLocaleString("cb.delete.confirm",{mapName:e});t.serviceWorkerEnabled||(s=s+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(s))if(navigator.onLine){!function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.add(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.boxDraw.cancel()}(t);t.deleteMap(e)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))};a.findStoredMap=function(e){return $.grep(this.storedMaps,function(t){var s=!0;e.name&&e.name!==t.name&&(s=!1);s&&e.url&&e.url!==t.url&&(s=!1);return s})[0]};a.showDownloadProgress=function(e,t){const s=this,a=s._classSelector,n=s.div.querySelector(a+"-progress-count");if(t){var r=Math.min(Math.round(100*e/t),100)+"%";s.div.querySelector(a+"-progress-ratio").style.width=r;n.innerHTML=r}else{s.div.querySelector(a+"-progress-bar").classList.add(TC.Consts.classes.HIDDEN);n.innerHTML=s.getLocaleString("xFiles",{quantity:e})}};a.updateRequestSchemas=function(e){var t=e||{};t.extent=t.extent||this.extent;t.layers=t.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(t);return this.requestSchemas};a.getResolutions=function(){for(var e=[],t=function(e){return e.res},s=this.requestSchemas.map(function(e){return e.tileMatrixLimits.map(t)}),a=Number.POSITIVE_INFINITY,n=0,r=0,o=s.length;r<o;r++){var l=s[r];a=Math.min(a,l[0]);n=Math.max(n,l[l.length-1])}for(r=0,o=s.length;r<o;r++)e=e.concat(s[r].filter(function(t){return t<=a&&t>=n&&e.indexOf(t)<0}));e.sort(function(e,t){return t-e});return e}}();
//# sourceMappingURL=../maps/Control/CacheBuilder.min.js.map
