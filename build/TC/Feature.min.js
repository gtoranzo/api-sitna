TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if($.isArray(t))this.geometry=t;else if(this.wrap.isNative(t)){this.wrap.feature=t;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();this.folders=t._folders;this.data=this.wrap.getData()}var r=this.options=$.extend(!0,{},e);this.id=this.id||r.id||TC.getUID();this.data=r.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===r.showsPopup?this.showsPopup=!0:this.showsPopup=r.showsPopup;this.layer=r.layer||null;this._selected=!1;r.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var r=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});r.length>0&&r[0].hide()}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){this.wrap.toggleSelectedStyle(t)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return $.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(r,[])},r=function(r,o){t(o)?r[r.length]=o:r=r.concat(e(o));return r};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=$.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,r=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),o=this.getData();if("object"==typeof o){var i=this.wrap.getTemplate();if(i)e=i.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return o[e]});else{var n=[];const t=[];var s=TC.Util.getLocaleString(r,"open");for(var a in o){const e=o[a],i=a.match(/^h(\d)_/i);if(i)t[i[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e){n[n.length]="<tr><th>";n[n.length]=a;n[n.length]="</th><td>";if(TC.Util.isURL(e)){n[n.length]='<a href="';n[n.length]=e;n[n.length]='" target="_blank">';n[n.length]=s;n[n.length]="</a>"}else n[n.length]=void 0!==e?TC.Util.formatNumber(e,r):"&mdash;";n[n.length]="</td></tr>"}}const i=t.map(function(t,e){if(t)return"<h"+e+">"+t+"</h"+e+">"}).filter(function(t){return t});i.length&&(n=i.concat(n));if(n.length>0){n.unshift('<table class="tc-attr">');n[n.length]="</table>";e=n.join("")}}}else"string"==typeof o&&(e=o);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(r,"noData"));return e};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var o,i=t||e.popup;if(!i)for(var n=r.getControlsByClass("TC.control.Popup"),s=0,a=n.length;s<a;s++){var l=n[s];if(!l.caller){i=l;break}}if(i){i.currentFeature=e;o=Promise.resolve(i)}else o=r.addControl("popup");o.then(function(t){t.currentFeature=e;r.getControlsByClass(TC.control.Popup).forEach(function(t){t.isVisible()&&t.hide()});e.wrap.showPopup(t);const o=t.contentDiv.querySelector("table.tc-attr"),i=t.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(o&&i.length){const t=o.getBoundingClientRect().width+"px";i.forEach(function(e){e.style.maxWidth=t})}r.trigger(TC.Consts.event.POPUP,{control:t});t.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var o,i=t;if(!i)for(var n=r.getControlsByClass("TC.control.ResultsPanel").filter(function(t){return"table"===t.options.content}),s=0,a=n.length;s<a;s++){var l=n[s];if(!l.caller){i=l;break}}if(i){i.currentFeature=e;o=Promise.resolve(i)}else{var u={content:"table"},p=r.getControlsByClass("TC.control.ControlContainer")[0];if(p){u.side=p.SIDE.RIGHT;o=p.addControl("resultsPanel",u)}else{u.div=document.createElement("div");r.div.appendChild(u.div);o=r.addControl("resultsPanel",u)}}o.then(function(t){t.currentFeature=e;0===r.getControlsByClass(TC.control.ControlContainer).length&&r.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});r.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&t.close()});t.div.querySelector(".tc-ctl-print-btn")&&t.div.querySelector(".tc-ctl-print-btn").remove();t.menuDiv.innerHTML="";t.open(e.getInfo({locale:r.options.locale}),t.getInfoContainer());var o=function(e){r.off(TC.Consts.event.VIEWCHANGE,o);t.close()};r.on(TC.Consts.event.VIEWCHANGE,o)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle($.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){this._selected=!1;this.setStyle(this.options);if(this.layer){var t=$.inArray(this,this.layer.selectedFeatures);t>=0&&this.layer.selectedFeatures.splice(t,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};
//# sourceMappingURL=maps/Feature.min.js.map
