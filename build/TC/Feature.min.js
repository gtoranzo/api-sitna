TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if(this.wrap.isNative(t)){this.wrap.feature=t;t._wrap=this.wrap;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();t._folders&&(this.folders=t._folders);this.data=this.wrap.getData()}var o=this.options=TC.Util.extend(!0,{},e);this.id=this.id||o.id||TC.getUID();this.data=o.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===o.showsPopup?this.showsPopup=!0:this.showsPopup=o.showsPopup;this.layer=o.layer||null;this._selected=!1;o.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var o=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});if(o.length>0){const t=o[0];t.isVisible()&&t.hide()}}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){const e=this;if(e._hasSelectedStyle!=t){e._hasSelectedStyle=t;e.wrap.toggleSelectedStyle(t)}};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(o,[])},o=function(o,r){t(r)?o[o.length]=r:o=o.concat(e(r));return o};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach(function(o,r){if(Array.isArray(o))e(o);else if(null===o)t[r]=0;else if("number"!=typeof o){console.log("Warning: coordinate does not have number type");t[r]=parseFloat(o)}})};Array.isArray(t)&&e(t);this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=TC.Util.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.unsetData=function(t){delete this.data[t];this.wrap.unsetData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,o=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),r=this.getData();if("object"==typeof r){var n=this.wrap.getTemplate();if(n)e=n.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return r[e]});else{var i=[];const t=[],n=TC.Util.getLocaleString(o,"open"),s=TC.Util.getLocaleString(o,"linkInNewWindow"),a=function(t){var e=[];if(TC.Util.isURL(t)){e[e.length]='<a href="';e[e.length]=t;e[e.length]='" target="_blank" title="';e[e.length]=s;e[e.length]='">';e[e.length]=n;e[e.length]="</a>"}else e[e.length]=void 0!==t?"number"==typeof t?TC.Util.formatNumber(t,o):t:"&mdash;";return e},h=function(t){var e=[];if(t instanceof Array){e[e.length]='<div class="complexAttr">';var r="complexAttr_"+TC.getUID();e[e.length]='<input type="checkbox" id="'+r+'" />';e[e.length]="<div>";e[e.length]='<label for="'+r+'" title="" class="plus"></label>';e[e.length]='<label for="'+r+'" title="" class="title">'+t.length+" "+TC.Util.getLocaleString(o,"featureInfo.complexData.array")+"</label><br/>";e[e.length]='<table class="complexAttr"><tbody>';for(var n=0;n<t.length;n++){e[e.length]="<tr><td>";(e=e.concat(h(t[n])))[e.length]="</td></tr>"}e[e.length]="</tbody></table></div></div>"}else if(t instanceof Object){e[e.length]='<table class="complexAttr"><tbody>';for(var n in t){e[e.length]="<tr>";if(t[n]&&t[n]instanceof Array){e[e.length]='<th style="display:none">'+n+"</th><td>";e[e.length]='<label for="'+r+'" class="title">'+n+"</label><br/>";(e=e.concat(h(t[n])))[e.length]="</div></td>"}else if(t[n]&&t[n]instanceof Object){r="complexAttr_"+TC.getUID();e[e.length]='<th style="display:none">'+n+"</th><td>";e[e.length]='<input type="checkbox" id="'+r+'" /><div>';e[e.length]='<label for="'+r+'" title="" class="plus"></label>';e[e.length]='<label for="'+r+'" title="" class="title">'+n+"</label><br/>";(e=e.concat(h(t[n])))[e.length]="</div></td>"}else{e[e.length]='<th class="key">'+n+"</th>";e[e.length]='<td class="value">';(e=e.concat(h(t[n])))[e.length]="</td>"}e[e.length]="</tr>"}e[e.length]="</tbody></table>"}else e=e.concat(a(t));return e};for(var l in r){const e=r[l],o=l.match(/^h(\d)_/i);if(o)t[o[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e){i[i.length]="<tr><th>";i[i.length]=l;i[i.length]="</th><td>";(i=i.concat(a(e)))[i.length]="</td></tr>"}else{i[i.length]="<tr><th>";i[i.length]=l;i[i.length]="</th><td>";(i=i.concat(h(e)))[i.length]="</td></tr>"}}const c=t.map(function(t,e){if(t)return"<h"+e+">"+t+"</h"+e+">"}).filter(function(t){return t});c.length&&(i=c.concat(i));if(i.length>0){i.unshift('<table class="tc-attr">');i[i.length]="</table>";e=i.join("")}}}else"string"==typeof r&&(e=r);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(o,"noData"));return e};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){const e=this,o=e.layer&&e.layer.map||t&&t.map;if(o){var r,n=t||e.popup;if(!n)for(var i=o.getControlsByClass("TC.control.Popup"),l=0,s=i.length;l<s;l++){var a=i[l];if(!a.caller){n=a;break}}if(n){n.currentFeature=e;r=Promise.resolve(n)}else r=o.addControl("popup");r.then(function(t){t.currentFeature=e;o.getControlsByClass(TC.control.Popup).filter(e=>e!==t&&e.isVisible()).forEach(t=>t.hide());e.wrap.showPopup(t);const r=t.contentDiv.querySelector("table.tc-attr"),n=t.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(r&&n.length){const t=r.getBoundingClientRect().width+"px";n.forEach(function(e){e.style.maxWidth=t})}o.trigger(TC.Consts.event.POPUP,{control:t});t.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(t){const e=this,o=e.layer&&e.layer.map||t&&t.map;if(o){var r,n={content:"table",titles:{main:TC.Util.getLocaleString(o.options.locale,"rsp.title"),max:TC.Util.getLocaleString(o.options.locale,"rsp.title")}},i=o.getControlsByClass("TC.control.ControlContainer")[0];if(i){n.position=i.POSITION.RIGHT;r=i.addControl("resultsPanel",n)}else{n.div=document.createElement("div");o.div.appendChild(n.div);r=o.addControl("resultsPanel",n)}r.then(function(t){t.currentFeature=e;0===o.getControlsByClass(TC.control.ControlContainer).length&&o.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});o.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&!t.chart&&t.close()});t.menuDiv.innerHTML="";t.open(e.getInfo({locale:o.options.locale}),t.getInfoContainer());var r=function(e){o.off(TC.Consts.event.VIEWCHANGE,r);t.close()};o.on(TC.Consts.event.VIEWCHANGE,r)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle(TC.Util.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){const t=this;t._selected=!1;t.setStyle(t.options);if(t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};
//# sourceMappingURL=maps/Feature.min.js.map