var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,n){return codes[e]}).filter(function(e,t,n){return 0===t?e!==codes[f]:e!==n[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,n){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var r=e.apply(this,arguments);r=r.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1"));return r};var t={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],c=function(e,t,n){return n<t.length-1?e.hasOwnProperty(t[n])?c(e[t[n]],t,++n):null:e[t[n]]};const l=new WeakMap,u=new WeakMap,g={}.hasOwnProperty;var d={isPlainObject:function(e){return"object"==typeof e&&!e.nodeType&&e.window!==e&&!(e.constructor&&!g.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isFunction:function(e){return"function"==typeof e},extend:function(){var e,t=arguments[0]||{},n=1,r=!1;if("boolean"==typeof t){r=t;t=arguments[n]||{};n++}"object"==typeof t||d.isFunction(t)||(t={});for(var o=arguments.length;n<o;n++){const o=arguments[n];if(null!=o)for(var i in o){const n=t[i],a=o[i];if(t===a)continue;const s=Array.isArray(a);if(r&&a&&(d.isPlainObject(a)||s)){e=s?n&&Array.isArray(n)?n:[]:n&&d.isPlainObject(n)?n:{};t[i]=d.extend(r,e,a)}else void 0!==a&&(t[i]=a)}}return t},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],n=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[n])return e}else for(var r in TC.capabilities)if(r.replace(TC.Util.regex.PROTOCOL,"")==n)return r;for(r in TC.capabilities){var o=c(TC.capabilities[r],a,0)||c(TC.capabilities[r],s,0);if(o&&t&&e==o)return o;if(o&&e.replace(TC.Util.regex.PROTOCOL,"")==o.replace(TC.Util.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t,n,r=2!=arguments.length||arguments[1];r||e.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(n=c(t,a,0)||c(t,s,0))?r?n.split("?")[0]:n.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(e){var t=window,n=e.split(".");for(i=0;i<n.length-1;i++)if(null==(t=t[n[i]]))return;return t[n[n.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(n){var r=window.location,o=n[1];t=(o==r.protocol||null==o)&&n[3]==r.hostname;var i=n[4],a=r.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(t=t&&i==a)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t);if("string"===r){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var n=document.getElementsByTagName("script");t=n[n.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var n="";if(e)if(void 0!==t[e])n=t[e];else{const o=document.createElement("div");o.style.display="none";o.classList.add(e);document.body.appendChild(o);var r=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(o,null).backgroundImage);r&&r.length>1&&(n=r[r.length-1]);o.parentElement.removeChild(o);t[e]=n}return n},getPointIconUrl:function e(t){var n=null;if(t.url)n=t.url;else{var r;if("string"==typeof t.cssClass)r=t.cssClass;else{var i=t.classes||TC.Cfg.styles.marker.classes;r=i[0];if(t.group){if(void 0===o[t.group]){var a=0;for(var s in o)a++;a%=i.length;o[t.group]=i[a]}r=o[t.group]}}n=TC.Util.getBackgroundUrlFromCss(r)}n||t===TC.Cfg.styles.point||""===t.cssClass||(n=e(TC.Cfg.styles.point));return n},addArrayToTree:function e(t,n,r){var o=null,i=!1,a=t[r=r||0];if(a){for(var s,c=0,l=n.children.length;c<l;c++)if((s=n.children[c]).name===a){i=!0;var u=e(t,s,r+1);u&&(o=u);break}if(!i){s={name:a,title:a,uid:"/"+t.slice(0,r+1).join("/"),children:[]};n.children.push(s);o=s}}return o},parseCoords:function(e){var t=null,n=function(e){var t=e,n={};n.type=TC.Consts.GEOGRAPHIC;var r=t.indexOf("\xb0");n.value=parseFloat(t.substr(0,r));if((r=(t=t.substr(r+1)).indexOf("'"))>=0){var o=parseFloat(t.substr(0,r))/60;n.value>=0?n.value+=o:n.value-=o;if((r=(t=t.substr(r+1)).indexOf("'"))>=0){o=parseFloat(t.substr(0,r).replace(",","."))/3600;n.value>=0?n.value+=o:n.value-=o}}return n},r=function(e){var t=e.trim();if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return n(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return n(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var r={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(r.value=-r.value);return r}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},o=(e=e.trim().toUpperCase()).split(",");4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:1!==o.length&&3!==o.length||(o=e.split(" "));if(2===o.length){var i=r(o[0]),a=r(o[1]);null!==i&&null!==a&&(t=[i,a])}return t},reproject:function(e,t,n){var r,o=!0,i=!0,a=!0;if(Array.isArray(e[0]))if(Array.isArray(e[0][0])){if(!Array.isArray(e[0][0][0])){a=!1;e=[e]}}else{i=!1;e=[[e]]}else{o=!1;i=!1;a=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:n,sync:!0});var s=proj4(proj4.defs[t]),c=proj4(proj4.defs[n]);r=new Array(e.length);e.forEach(function(e,t){const n=r[t]=[];e.forEach(function(e,t){const r=n[t]=[];e.forEach(function(e,t){var n=proj4(s,c,{x:e[0],y:e[1]});r[t]=[n.x,n.y];e.length>2&&(r[t][2]=e[2])})})});o?i?a||(r=r[0]):r=r[0][0]:r=r[0][0][0];return r},getMetersPerDegree:function(e){var t=void 0;if(Array.isArray(e)&&e.length>=4){var n=this.degToRad(e[3]-e[1]),r=Math.sin(n/2),o=r*r;t=6370997*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var n=e.trim().match(/^.+[:#](\d{4,6})$/);n&&(t=n[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var n=this.getCRSCode(e),r=this.getCRSCode(t);return null!==n&&null!==r&&n===r},getLocaleString:function(e,t,n){var r=t;if(TC.i18n&&TC.i18n[e]){var o=TC.i18n[e][t];if(o){r=o;if(n)for(var i in n)r=r.replace("{"+i+"}",n[i])}}return r},getSimpleMimeType:function(e){var t="";if(e){var n=e.indexOf(";");n>0&&(e=e.substring(0,n));t=e}return t},getQueryStringParams:function(e){var t;if(e){var n=e.indexOf("?");if(n>=0){var r=(t=e.substr(n)).indexOf("#");r>=0&&(t=t.substr(0,r))}else t="?"}else t=location.search;var o=t.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete o[""];return o},getParamString:function(e){const t=[];for(var n in e)t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]);return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var n=e.length;n;){e[n]=e[n-1];n--}e[0]=t},storage:{getCookie:function(e){return TC.cookie(e)},setCookie:function(e,t,n){return TC.cookie(e,t,n)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const e=matchMedia("(pointer:coarse)").matches,t=matchMedia("(pointer:fine)").matches;if(e&&t)return!0;if(e&&!t){return!!function(){var e,t="(hover: hover)",n=!TC.browserFeatures.touch();(e=window.matchMedia(t)).media===t&&(n=e.matches);return n}()}return!(e||!t)||!matchMedia("(pointer:none)").matches&&(!TC.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var n=t.indexOf(":"),r=t.substr(n+1),o=e.getElementsByTagNameNS("*",r),i=0;i<o.length;i++)if(o[i].nodeName==t)return o},addURLParameters:function(e,t){if(!t)return e;var n=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),r=e.split("?");if(r.length>=2){var o=r[1].split(/[&;]/g);o.push(n);return e=r[0]+"?"+o.join("&")}if((r=e.split("#")).length>=2){r.shift();return e=r[0]+"?"+n+"#"+r.join("#")}return e=e+"?"+n},removeURLParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var r=encodeURIComponent(t.toLowerCase())+"=",o=n[1].toLowerCase().split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(r,0)&&o.splice(i,1);return e=n[0]+"?"+o.join("&")}return e},showModal:function(e,t){t=t||{};e.hidden=!1;window.$&&e instanceof $&&(e=e.get(0));e.classList.add(TC.Consts.classes.VISIBLE);const n=e.querySelectorAll(".tc-modal-close");if(n&&n.length>0)for(var r=0;r<n.length;r++){var o=u.get(n[r]);if(o)u.delete(n[r]);else{o=function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,e.target)};u.set(n[r],o)}u.set(n[r],o);n[r].addEventListener("click",o);d.isFunction(t.openCallback)&&t.openCallback()}},closeModal:function(e,t){const n=function(e){e.classList.remove(TC.Consts.classes.VISIBLE)};var r;if(t){r=t;for(;r&&!r.matches(".tc-modal");)r=r.parentElement;n(r)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(e){n(e)});e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t){const n=function(t){e.addEventListener("mousedown",t.start);e.addEventListener("touchstart",t.start);e.addEventListener("mouseup",t.end);e.addEventListener("touchend",t.end)};if("disable"===t){const t=l.get(e);if(t){e.removeEventListener("mousedown",t.start);e.removeEventListener("touchstart",t.start);e.removeEventListener("mouseup",t.end);e.removeEventListener("touchend",t.end)}return}if("enable"===t){const t=l.get(e);t&&n(t);return}const r=(t=t||{}).minDistance||30,o=t.maxCrossDistance||30,i=t.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},c=0;const u={start:function(n){if(function(n){if(t.noSwipe)for(var r=n.target;r&&r!==e;){if(r.matches&&r.matches(t.noSwipe))return!1;r=r.parentNode}return!0}(n)){n="changedTouches"in n?n.changedTouches[0]:n;a.x=n.pageX;a.y=n.pageY;c=(new Date).getTime()}},end:function(n){if(c){n="changedTouches"in n?n.changedTouches[0]:n;s.x=n.pageX;s.y=n.pageY;if((new Date).getTime()-c<=i){const n=t[function(e,t){const n=t.x-e.x,i=t.y-e.y,a=Math.abs(n),s=Math.abs(i);return a>s&&a>r&&s<=o?n<0?"left":"right":s>a&&s>r&&a<=o?i<0?"up":"down":"none"}(a,s)];n&&n.call(e)}c=0}}};l.set(e,u);n(u)},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en-US",n=(e=e||{}).cookieName||"SITNA.language",r=e.paramName||"lang",o=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,i=TC.Util.getParameterByName(r)||TC.Util.storage.getCookie(n)||o,a=i.indexOf("-");a>=0&&(i=i.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(n,i,{expires:s});switch(i){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[\/\\?%*:|"<>]/g,"-")},downloadBlob:function(e,t){var n=document.createElement("a");if(void 0!==n.download){var r=URL.createObjectURL(t);n.setAttribute("href",r);n.setAttribute("download",TC.Util.getValidFilename(e));n.style.visibility="hidden";document.body.appendChild(n);n.click();document.body.removeChild(n)}},downloadFile:function(e,t,n){var r=new Blob([n],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(r,e):TC.Util.downloadBlob(e,r)},downloadDataURI:function(e,t,n){for(var r=atob(n.split(",")[1]),o=[],i=0;i<r.length;i++)o.push(r.charCodeAt(i));var a=new Blob([new Uint8Array(o)],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(a,e):TC.Util.downloadBlob(e,a)},shortenUrl:function(e){return new Promise(function(t,n){TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}}).then(function(e){t(e.data)}).catch(function(e){n(e)})})},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){Array.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const n=t.toString(16);return e+"00".substring(0,2-n.length)+n},"#"));return e},operation:function(e,t,n,r){for(var o=[],i=0;i<e.length;i++){for(var a=e[i],s=!1,c=0;c<t.length;c++)if(n(a,t[c])){s=!0;break}s===r&&o.push(a)}return o},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,n){return this.operation(e,t,n,!0)},inFirstOnly:function(e,t,n){return this.operation(e,t,n,!1)},inSecondOnly:function(e,t,n){return this.inFirstOnly(t,e,n)},toDataUrl:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},r=n.type,o=n.encoderOptions,i=e.getContext("2d");if(!i)return"";var a=e.width,s=e.height,c=i.getImageData(0,0,a,s),l=i.globalCompositeOperation;if(t){i.globalCompositeOperation="destination-over";i.fillStyle=t;i.fillRect(0,0,a,s)}var u=e.toDataURL(r,o);if(t){i.clearRect(0,0,a,s);i.putImageData(c,0,0);i.globalCompositeOperation=l}return u},imgToDataUrl:function(e,t){var n=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d");t.height=e.height;t.width=e.width;n.drawImage(e,0,0);return t};return new Promise(function(r,o){var i=new Image;i.crossOrigin="anonymous";i.onload=function(){var o,a=n(i);try{o=TC.Util.toDataUrl(a,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:o,canvas:a})}catch(t){i.src=TC.proxify(e)}};i.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(e),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(e){if(200===this.status){for(var o=new Uint8Array(this.response),a=o.length,c=new Array(a);a--;)c[a]=String.fromCharCode(o[a]);var l=c.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){i.src="data:"+u+";base64,"+window.btoa(l);i.onload=function(){var e=n(i);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:dataURL,canvas:e})}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&o()};s.send()};i.src=e;if(i.complete||void 0===i.complete){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.src=e}})},imgTagToDataUrl:function(e,t){var n=function(e){var t=document.createElement("CANVAS"),n=t.getContext("2d");t.height=e.height;t.width=e.width;n.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(n,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:n}}catch(e){return null}},addToCanvas:function(e,t,n,r){var o=TC.Util.cloneCanvas(e),i=o.getContext("2d");return new Promise(function(e,a){var s=new Image;t.crossOrigin="anonymous";s.src=t;s.onload=function(){r?i.drawImage(s,n.x||0,n.y||0,r.width,r.height):i.drawImage(s,n.x||0,n.y||0);e(o)}})},cloneCanvas:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width;t.height=e.height;n.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,n,r){var o=Math.min(n/e,r/t);return{width:e*o,height:t*o}},getFormattedDate:function(e,t){function n(e){return e<10?"0"+e:e}var r=new Date(e);return[r.getFullYear(),n(r.getMonth()+1),n(r.getDate())].concat(t?["_",n(r.getHours()),n(r.getMinutes()),n(r.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var n=function(e,t){new Promise(function(n,r){const o=new XMLHttpRequest;o.responseType="blob";o.open("POST",e);o.setRequestHeader("Content-Type","application/xml; charset=UTF-8");o.onreadystatechange=function(e){if(4===o.readyState)if(200!==o.status)r({status:o.status,msg:o.statusText,url:options.url});else try{const e=o.getResponseHeader("Content-disposition");var t="";if(e){t=e.split("; ")[1].substring(9);"attachment"!==e.split("; ")[0]&&(t=t.substring(0,t.lastIndexOf(".")))}n({data:o.response,contentType:o.getResponseHeader("Content-type"),filename:t})}catch(e){r(e)}};try{o.send(t)}catch(e){r(e)}}).then(function(e){var t="";e.data.type.indexOf("kml")>=0?t=".kml":e.data.type.indexOf("json")>=0?t=".geojson":e.data.type.indexOf("xml")>=0&&(t=".gml");TC.Util.downloadFile((e.filename?e.filename:TC.getUID())+t,e.contentType,e.data)})};if(Array.isArray(e))for(var r=e,o=0;o<r.length;o++)n(r[o].url,r[o].data);else n(e,t)},WFSQueryBuilder:function(e,t,n,r,o,i){Array.isArray(e)||(e=[e]);var a='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(n.version){case"1.0.0":case"1.1.0":a+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":a+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var s in n)"string"==typeof n[s]&&s.indexOf("gml")<0&&n[s].indexOf("wfs")<0&&(a+=s+'="'+n[s]+'" ');var c="<wfs:GetFeature "+a.format({resultType:o?'resultType="hits"':"",format:'outputFormat="'+r+'"'})+">",l="",u="<wfs:Query typeName"+("2.0.0"===n.version?"s":"")+'="{typeName}"'+(i?' srsName="'+i+'"':"")+">{filter}</wfs:Query>";e.forEach(function(e){l+=u.format({typeName:e,filter:t?t.getText(n.version):""})});return c+=l+"</wfs:GetFeature>"},WFSFilterBuilder:function(e,t,n){var r="";if(d.isPlainObject(e))r='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case Array.isArray(e):var o="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:BBOX>"+o+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:BBOX>"+o+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,{version:"2.0",srsName:n})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,{version:"3.2",srsName:n})+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return r},writeGMLGeometry:function(e,t){const n=(t=t||{}).version,r=function(){return t.srsName?' srsName="'+t.srsName+'"':""};var o=function(e){var t;if(0===n.indexOf("3")){t=e.toString();for(;t.indexOf(",")>=0;)t=t.replace(","," ")}else t=e.map(function(e){return e.join(",")}).join(" ");return t};switch(n){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"'+r()+"><gml:posList>"+o(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"'+r()+"><gml:exterior><gml:LinearRing><gml:posList>"+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString"+r()+"><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon"+r()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var n=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!n&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var o=r[1];n=(o==t.protocol||null==o)&&r[3]==t.hostname;var i=r[4],a=t.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(n=n&&i==a)}return n},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var n=/^(https?:\/\/)/i,r=e.match(n);if(r&&r.length>1){var o=t.match(n);if(o&&o.length>1)return r[0].trim()===o[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,n){return t[e]>n[e]?1:t[e]<n[e]?-1:0}},getSoundexDifference:function(e,t){for(var n=0,r=0;r<e.length;r++)e.charAt(r)==t.charAt(r)&&n++;return n},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href},getRenderedHtml:function(e,t,n,r){return new Promise(function(o,i){var a=function(){dust.cache[e]&&dust.render(e,n,function(e,t){if(e){TC.error(e);i(Error(e))}else{d.isFunction(r)&&r(t);o(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])a();else if("string"==typeof t)TC.ajax({url:t,method:"GET",responseType:"text"}).then(function(t){const n=t.data;var r=dust.compile(n,e);dust.loadSource(r);a()}).catch(function(e){console.log("Error fetching template: "+e)});else if(d.isFunction(t)){t();a()}})})},explodeGeometry:function(e){const t=e.origin,n=function(e,r,o){if(Array.isArray(e))e.forEach(n);else{0===r&&(o[0]=e+t[0]);1===r&&(o[1]=e+t[1])}};e.geom.forEach(n);return e.geom},cloneMappingFunction:function(e){return Array.isArray(e)?e.map(TC.Util.cloneMappingFunction):e},compactGeometry:function(e,t){const n=[Number.MAX_VALUE,Number.MAX_VALUE],r=e.map(TC.Util.cloneMappingFunction),o=function(e,t){Array.isArray(e)?e.forEach(o):0===t&&e<n[0]?n[0]=e:1===t&&e<n[1]&&(n[1]=e)};r.forEach(o);const i=function(e){return Math.round(e*t)/t};n[0]=i(n[0]);n[1]=i(n[1]);const a=function(e,t,r){if(Array.isArray(e))e.forEach(a);else{0===t&&(r[0]=i(e-n[0]));1===t&&(r[1]=i(e-n[1]))}};r.forEach(a);return{origin:n,geom:r}}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};var p=function(e,t,n){return n(e.getBoundingClientRect(),t.getBoundingClientRect())};if(this.HTMLElement){HTMLElement.prototype.colliding=function(e){return p(this,e,function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)})};HTMLElement.prototype.containing=function(e){p(this,e,function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)})};HTMLElement.prototype.inside=function(e){return p(this,e,function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right})}}return d});
//# sourceMappingURL=maps/Util.min.js.map