function xml2json(e){var t={toObj:function(e){var n={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)"name"!==e.attributes[r].nodeName&&(n[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString());if(e.firstChild){for(var i=0,a=0,o=!1,s=e.firstChild;s;s=s.nextSibling)1==s.nodeType?o=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==s.nodeType&&a++;if(o)if(2>i&&2>a){t.removeWhite(e);for(s=e.firstChild;s;s=s.nextSibling){var l=t.removePrefix(s.nodeName);if(3==s.nodeType)n["#text"]=t.escape(s.nodeValue);else if(4==s.nodeType)n["#cdata"]=t.escape(s.nodeValue);else if(n[l])n[l]instanceof Array?n[l][n[l].length]=t.toObj(s):n[l]=[n[l],t.toObj(s)];else{var u=null;s.attributes.getNamedItem("name")&&(u=s.attributes.getNamedItem("name").nodeValue),n[u||l]=t.toObj(s)}}}else e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(i)e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(a)if(a>1)n=t.escape(t.innerXml(e));else for(s=e.firstChild;s;s=s.nextSibling)n["#cdata"]=t.escape(s.nodeValue)}e.attributes.length||e.firstChild||(n=null)}else 9==e.nodeType?n=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return n},toJson:function(e,n,r){var i=n?'"'+n+'"':"";if(e instanceof Array){for(var a=0,o=e.length;o>a;a++)e[a]=t.toJson(e[a],"",r+"\t");i+=(n?":[":"[")+(e.length>1?"\n"+r+"\t"+e.join(",\n"+r+"\t")+"\n"+r:e.join(""))+"]"}else if(null==e)i+=(n&&":")+"null";else if("object"==typeof e){var s=[];for(var l in e)s[s.length]=t.toJson(e[l],l,r+"\t");i+=(n?":{":"{")+(s.length>1?"\n"+r+"\t"+s.join(",\n"+r+"\t")+"\n"+r:s.join(""))+"}"}else i+="string"==typeof e?(n&&":")+'"'+e.toString()+'"':(n&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var n=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=n(i);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},r=e.firstChild;r;r=r.nextSibling)t+=n(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var r=n.nextSibling;e.removeChild(n),n=r}else 1==n.nodeType?(t.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}var WFSCapabilities=function(){var e="1.0.0",t="1.1.0",n="2.0.0",r=function(r,i){switch(i){case e:var a=r.Capability.Request;if(a.GetFeature){var o=[];for(var s in a.GetFeature.ResultFormat)o.push(s.toLowerCase());a.GetFeature.outputFormat=o,delete a.GetFeature.ResultFormat,a.GetFeature.Operations=r.FeatureTypeList.Operations}return a;case t:return{};case n:var l={};for(var s in r.OperationsMetadata){var u={};u[s]=r.OperationsMetadata[s];for(var f in u[s])u[s][f]&&u[s][f].hasOwnProperty("AllowedValues")&&(u[s][f]=u[s][f].AllowedValues.Value);$.extend(l,u)}return l}return null},i=function(r,i){switch(i){case e:for(var a={},o=0;o<r.FeatureTypeList.FeatureType.length;o++){a[(s=r.FeatureTypeList.FeatureType[o].Name).substring(s.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[o]}return a;case t:return{};case n:for(a={},o=0;o<r.FeatureTypeList.FeatureType.length;o++){var s;a[(s=r.FeatureTypeList.FeatureType[o].Name).substring(s.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[o]}return a}return null},a=function(r,i){switch(i){case e:return r.Filter_Capabilities;case t:return{};case n:return r.Filter_Capabilities}return null},o=function(r,i){switch(i){case e:var a={};for(var o in r)"string"==typeof r[o]&&(a[o]=r[o]);return a;case t:return{};case n:a={};for(var o in r)"string"==typeof r[o]&&(a[o]=r[o]);return a}return{}};return{Promises:function(e){var t=(e=e).substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[t])return Promise.resolve(TC.capabilities[t]);var n={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return new Promise(function(r,i){TC.ajax({url:TC.proxify(e)+"?"+$.param(n),method:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),n=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[n]=e,TC.capabilities[t]=e,r(WFSCapabilities.Parse(arguments[0]))})})},Parse:function(){var s,l,u,f,p=xml2json(arguments[0]);switch(p.version){case e:s=e;break;case t:s=t;break;case n:s=n}l=r(p,s),u=i(p,s),f=a(p,s);var c=o(p,s),d={Operations:l,FeatureTypes:u,Filters:f};return $.extend(d,c),d}}}();
//# sourceMappingURL=../maps/layer/WFSCapabilitiesParser.min.js.map
