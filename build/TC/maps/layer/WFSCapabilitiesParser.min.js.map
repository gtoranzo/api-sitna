{"version":3,"sources":["layer/WFSCapabilitiesParser.js"],"names":["xml2json","e","n","toObj","t","nodeType","attributes","length","i","nodeName","nodeValue","toString","firstChild","r","o","l","a","nextSibling","match","removeWhite","s","removePrefix","escape","Array","f","getNamedItem","innerXml","documentElement","console","log","textContent","alert","toJson","join","innerHTML","replace","normalize","removeChild","substring","indexOf","WFSCapabilities","Capability","Request","GetFeature","ResultFormat","push","toLowerCase","outputFormat","Operations","FeatureTypeList","OperationsMetadata","u","p","hasOwnProperty","AllowedValues","Value","$","extend","FeatureType","Name","Filter_Capabilities","Promises","TC","capabilities","Promise","resolve","SERVICE","VERSION","REQUEST","x","y","ajax","url","proxify","param","method","then","Parse","arguments","GetCapabilities","DCP","HTTP","Get","DCPType","onlineResource","_","version","FeatureTypes","Filters"],"mappings":"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","sourcesContent":["/*\tThis work is licensed under Creative Commons GNU LGPL License.\r\n\r\n\tLicense: http://creativecommons.org/licenses/LGPL/2.1/\r\n   Version: 0.9\r\n\tAuthor:  Stefan Goessner/2006\r\n\tWeb:     http://goessner.net/ \r\n*/\r\nfunction xml2json(e) { var n = { toObj: function (e) { var t = {}; if (1 == e.nodeType) { if (e.attributes.length) for (var i = 0; i < e.attributes.length; i++) \"name\" !== e.attributes[i].nodeName && (t[e.attributes[i].nodeName] = (e.attributes[i].nodeValue || \"\").toString()); if (e.firstChild) { for (var r = 0, o = 0, l = !1, a = e.firstChild; a; a = a.nextSibling) 1 == a.nodeType ? l = !0 : 3 == a.nodeType && a.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/) ? r++ : 4 == a.nodeType && o++; if (l) if (2 > r && 2 > o) { n.removeWhite(e); for (var a = e.firstChild; a; a = a.nextSibling) { var s = n.removePrefix(a.nodeName); if (3 == a.nodeType) t[\"#text\"] = n.escape(a.nodeValue); else if (4 == a.nodeType) t[\"#cdata\"] = n.escape(a.nodeValue); else if (t[s]) t[s] instanceof Array ? t[s][t[s].length] = n.toObj(a) : t[s] = [t[s], n.toObj(a)]; else { var f = null; a.attributes.getNamedItem(\"name\") && (f = a.attributes.getNamedItem(\"name\").nodeValue), t[f ? f : s] = n.toObj(a) } } } else e.attributes.length ? t[\"#text\"] = n.escape(n.innerXml(e)) : t = n.escape(n.innerXml(e)); else if (r) e.attributes.length ? t[\"#text\"] = n.escape(n.innerXml(e)) : t = n.escape(n.innerXml(e)); else if (o) if (o > 1) t = n.escape(n.innerXml(e)); else for (var a = e.firstChild; a; a = a.nextSibling) t[\"#cdata\"] = n.escape(a.nodeValue) } e.attributes.length || e.firstChild || (t = null) } else 9 == e.nodeType ? t = n.toObj(e.documentElement) : 8 == e.nodeType ? console.log(e.textContent) : alert(\"unhandled node type: \" + e.nodeType); return t }, toJson: function (e, t, i) { var r = t ? '\"' + t + '\"' : \"\"; if (e instanceof Array) { for (var o = 0, l = e.length; l > o; o++) e[o] = n.toJson(e[o], \"\", i + \"\t\"); r += (t ? \":[\" : \"[\") + (e.length > 1 ? \"\\n\" + i + \"\t\" + e.join(\",\\n\" + i + \"\t\") + \"\\n\" + i : e.join(\"\")) + \"]\" } else if (null == e) r += (t && \":\") + \"null\"; else if (\"object\" == typeof e) { var a = []; for (var s in e) a[a.length] = n.toJson(e[s], s, i + \"\t\"); r += (t ? \":{\" : \"{\") + (a.length > 1 ? \"\\n\" + i + \"\t\" + a.join(\",\\n\" + i + \"\t\") + \"\\n\" + i : a.join(\"\")) + \"}\" } else r += \"string\" == typeof e ? (t && \":\") + '\"' + e.toString() + '\"' : (t && \":\") + e.toString(); return r }, innerXml: function (e) { var n = \"\"; if (\"innerHTML\" in e) n = e.innerHTML; else for (var t = function (e) { var n = \"\"; if (1 == e.nodeType) { n += \"<\" + e.nodeName; for (var i = 0; i < e.attributes.length; i++) n += \" \" + e.attributes[i].nodeName + '=\"' + (e.attributes[i].nodeValue || \"\").toString() + '\"'; if (e.firstChild) { n += \">\"; for (var r = e.firstChild; r; r = r.nextSibling) n += t(r); n += \"</\" + e.nodeName + \">\" } else n += \"/>\" } else 3 == e.nodeType ? n += e.nodeValue : 4 == e.nodeType && (n += \"<![CDATA[\" + e.nodeValue + \"]]>\"); return n }, i = e.firstChild; i; i = i.nextSibling) n += t(i); return n }, escape: function (e) { return e.replace(/[\\\\]/g, \"\\\\\\\\\").replace(/[\\\"]/g, '\\\\\"').replace(/[\\n]/g, \"\\\\n\").replace(/[\\r]/g, \"\\\\r\") }, removeWhite: function (e) { e.normalize(); for (var t = e.firstChild; t;) if (3 == t.nodeType) if (t.nodeValue.match(/[^ \\f\\n\\r\\t\\v]/)) t = t.nextSibling; else { var i = t.nextSibling; e.removeChild(t), t = i } else 1 == t.nodeType ? (n.removeWhite(t), t = t.nextSibling) : t = t.nextSibling; return e }, removePrefix: function (e) { return e.substring(e.indexOf(\":\") + 1) } }; return 9 == e.nodeType && (e = e.documentElement), n.toObj(n.removeWhite(e)) }\r\n\r\nvar WFSCapabilities = function () { var e = { V1_0_0: \"1.0.0\", V1_1_0: \"1.1.0\", V2_0_0: \"2.0.0\" }, r = function () { var r, n = [], u = [], p = [], _ = xml2json(arguments[0]); switch (_.version) { case e.V1_0_0: r = e.V1_0_0; break; case e.V1_1_0: r = e.V1_1_0; break; case e.V2_0_0: r = e.V2_0_0 } n = t(_, r), u = a(_, r), p = i(_, r); var o = s(_, r), l = { Operations: n, FeatureTypes: u, Filters: p }; return $.extend(l, o), l }, t = function (r, t) { switch (t) { case e.V1_0_0: var a = r.Capability.Request; if (a.GetFeature) { var i = []; for (var s in a.GetFeature.ResultFormat) i.push(s.toLowerCase()); a.GetFeature.outputFormat = i, delete a.GetFeature.ResultFormat, a.GetFeature.Operations = r.FeatureTypeList.Operations } return a; case e.V1_1_0: return {}; case e.V2_0_0: var n = {}; for (var s in r.OperationsMetadata) { var u = {}; u[s] = r.OperationsMetadata[s]; for (var p in u[s]) u[s][p] && u[s][p].hasOwnProperty(\"AllowedValues\") && (u[s][p] = u[s][p].AllowedValues.Value); $.extend(n, u) } return n } return null }, a = function (r, t) { switch (t) { case e.V1_0_0: for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) { var s = r.FeatureTypeList.FeatureType[i].Name; a[s.substring(s.indexOf(\":\") + 1)] = r.FeatureTypeList.FeatureType[i] } return a; case e.V1_1_0: return {}; case e.V2_0_0: for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) { var s = r.FeatureTypeList.FeatureType[i].Name; a[s.substring(s.indexOf(\":\") + 1)] = r.FeatureTypeList.FeatureType[i] } return a } return null }, i = function (r, t) { switch (t) { case e.V1_0_0: return r.Filter_Capabilities; case e.V1_1_0: return {}; case e.V2_0_0: var a = r.Filter_Capabilities; return a } return null }, s = function (r, t) { switch (t) { case e.V1_0_0: var a = {}; for (var i in r) \"string\" == typeof r[i] && (a[i] = r[i]); return a; case e.V1_1_0: return {}; case e.V2_0_0: var a = {}; for (var i in r) \"string\" == typeof r[i] && (a[i] = r[i]); return a } return {} }, n = function (e) { var e = e, t = e.substring(e.indexOf(\"://\") < 0 ? 0 : e.indexOf(\"://\") + 3); if (TC.capabilities[t]) return Promise.resolve(TC.capabilities[t]); var a = {}; return a.SERVICE = \"WFS\", a.VERSION = \"2.0.0\", a.REQUEST = \"GetCapabilities\", new Promise(function (x, y) { TC.ajax({ url: TC.proxify(e) + \"?\" + $.param(a), method: \"GET\" }).then(function () { var e = WFSCapabilities.Parse(arguments[0]), a = e.Operations.GetCapabilities.DCP && e.Operations.GetCapabilities.DCP.HTTP.Get[\"xlink:href\"] || e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource; TC.capabilities[a] = e, TC.capabilities[t] = e, x(WFSCapabilities.Parse(arguments[0])) }) }) }; return { Promises: n, Parse: r } }();"],"file":"../../layer/WFSCapabilitiesParser.min.js"}