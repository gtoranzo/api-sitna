{"version":3,"sources":["Control/Share.js"],"names":["TC","control","MapInfo","syncLoadJS","apiLocation","Share","options","this","_classSelector","CLASS","Control","apply","arguments","exportsState","opts","_dialogDiv","Util","getDiv","dialogDiv","_$dialogDiv","$","document","body","appendChild","render","inherit","ctlProto","prototype","MAILTO_MAX_LENGTH","IFRAME_WIDTH","IFRAME_HEIGHT","FEATURE_PARAM","MOBILEFAV","NAVALERT","callback","self","getRenderedHtml","html","innerHTML","then","call","detectChrome","detectIE","detectFirefox","div","querySelectorAll","forEach","btn","classList","remove","input","dataset","dataOriginalTitle","detectMobile","querySelector","add","Consts","classes","HIDDEN","span","addEventListener","event","CLICK","e","label","tagName","parentElement","newFormat","value","option","matches","isFunction","getLocation","result","window","location","href","hash","substr","indexOf","manageMaxLengthExceed","maxLengthExceed","browserAlert","browser","qrAlert","qr","generateIframe","url","urlString","generateLink","loadParamFeature","featureToShow","getParameterByName","featureObj","JSON","parse","decodeURIComponent","escape","atob","error","getLocaleString","msgErrorMode","TOAST","map","geom","addLayer","id","getUID","type","layerType","VECTOR","title","stealth","layer","paramFeatureLayer","importState","features","zoomToFeatures","register","selectInputField","elm","contains","select","EventTarget","listenerBySelector","evt","link","registerListeners","copyBtn","target","execCommand","textContent","setTimeout","getSelection","removeAllRanges","addRange","createRange","unselectInputField","stopImmediatePropagation","preventDefault","encodeURIComponent","length","toast","msgType","WARNING","qrContainer","makeQRCode","qrCodeBase64","showModal","get","openSocialMedia","win","process","trim","close","w","open","shortenedLink","waText","undefined","bookmarkURL","bookmarkTitle","alert","sidebar","addPanel","test","navigator","userAgent","opera","print","external","AddFavorite","template","isDebug","dust","body_0","chk","ctx","h","$key","__dustBody"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapInfo) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapInfo');\r\n}\r\n\r\nTC.control.Share = function (options) {\r\n    var self = this;\r\n    self._classSelector = '.' + self.CLASS;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.exportsState = true;\r\n\r\n    var opts = options || {};\r\n    self._dialogDiv = TC.Util.getDiv(opts.dialogDiv);\r\n    self._$dialogDiv = $(self._dialogDiv);\r\n    if (!opts.dialogDiv) {\r\n        document.body.appendChild(self._dialogDiv);\r\n    }\r\n\r\n    self.render();\r\n};\r\n\r\nTC.inherit(TC.control.Share, TC.control.MapInfo);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Share.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-share';\r\n    ctlProto.MAILTO_MAX_LENGTH = 256;\r\n    ctlProto.IFRAME_WIDTH = '600px';\r\n    ctlProto.IFRAME_HEIGHT = '450px';\r\n    ctlProto.FEATURE_PARAM = 'showfeature';\r\n\r\n    ctlProto.MOBILEFAV = 'Siga las instrucciones del navegador del dispositivo móvil para añadir como favorito. Se guardará el estado actual del mapa.';\r\n    ctlProto.NAVALERT = ' +D para guardar en marcadores.';\r\n\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self.getRenderedHtml(self.CLASS + '-dialog', null, function (html) {\r\n            self._dialogDiv.innerHTML = html;\r\n        }).then(function () {\r\n            return TC.Control.prototype.render.call(self, function () {\r\n                //Si el navegador no soporta copiar al portapapeles, ocultamos el botón de copiar\r\n                if (TC.Util.detectChrome() || TC.Util.detectIE() >= 10 || TC.Util.detectFirefox() >= 41) {\r\n                    self.div.querySelectorAll('button').forEach(function (btn) {\r\n                        btn.classList.remove('hide');\r\n                    });\r\n                    self.div.querySelectorAll('input[type=text]').forEach(function (input) {\r\n                        delete input.dataset.dataOriginalTitle;\r\n                    });\r\n                }\r\n\r\n                // Si el SO no es móvil, ocultamos el botón de compartir a WhatsApp\r\n                if (!TC.Util.detectMobile()) {\r\n                    self.div.querySelector(\".share-whatsapp\").classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n\r\n                const options = self.div.querySelectorAll('.' + self.CLASS + '-url-box');\r\n                self.div.querySelectorAll('span:not(.tc-beta)').forEach(function (span) {\r\n                    span.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                        var label = this;\r\n                        while (label && label.tagName !== 'LABEL') {\r\n                            label = label.parentElement;\r\n                        }\r\n                        const newFormat = label.querySelector('input[type=radio][name=format]').value;\r\n\r\n                        options.forEach(function (option) {\r\n                            if (option.matches('.tc-' + newFormat)) {\r\n                                option.classList.remove(TC.Consts.classes.HIDDEN);\r\n                            }\r\n                            else {\r\n                                option.classList.add(TC.Consts.classes.HIDDEN);\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n                if ($.isFunction(callback)) {\r\n                    callback();\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Obtiene una URL \"limpia\" para compartir el mapa.\r\n     */\r\n    ctlProto.getLocation = function () {\r\n        var result = window.location.href;\r\n        if (window.location.hash) {\r\n            result = result.substr(0, result.indexOf(window.location.hash));\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.manageMaxLengthExceed = function (maxLengthExceed) {\r\n        const self = this;\r\n\r\n        const browserAlert = self.div.querySelector('.' + self.CLASS + '-alert');\r\n        if (maxLengthExceed.browser) { //Si la URL sobrepasa el tamaño máximo avisamos que puede fallar en IE\r\n            browserAlert.classList.remove(TC.Consts.classes.HIDDEN);\r\n        } else {\r\n            browserAlert.classList.add(TC.Consts.classes.HIDDEN);\r\n        }\r\n\r\n        const qrAlert = self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert');\r\n        if (maxLengthExceed.qr) {\r\n            qrAlert.classList.remove(TC.Consts.classes.HIDDEN);\r\n        } else {\r\n            qrAlert.classList.add(TC.Consts.classes.HIDDEN);\r\n        }\r\n    };\r\n\r\n    ctlProto.generateIframe = function (url) {\r\n        var self = this;\r\n        var urlString = url || this.generateLink();\r\n        if (urlString) {\r\n            return '<iframe style=\"width:' + self.IFRAME_WIDTH + ';height:' + self.IFRAME_HEIGHT + ';\" src=\"' + urlString + '\"></iframe>';\r\n        }\r\n    }\r\n\r\n    ctlProto.loadParamFeature = function () {\r\n        const self = this;\r\n        var result = null;\r\n        var featureToShow = TC.Util.getParameterByName(self.FEATURE_PARAM);\r\n        if (featureToShow) {\r\n            var featureObj;\r\n            try {\r\n                featureObj = JSON.parse(decodeURIComponent(escape(window.atob(featureToShow))));\r\n            }\r\n            catch (error) {\r\n                TC.error(self.getLocaleString('sharedFeatureNotValid'), TC.Consts.msgErrorMode.TOAST);\r\n            }\r\n            if (featureObj && self.map) {\r\n                if (featureObj.geom) {\r\n                    self.map.addLayer({\r\n                        id: self.getUID(),\r\n                        type: TC.Consts.layerType.VECTOR,\r\n                        title: self.getLocaleString('foi'),\r\n                        stealth: true\r\n                    }).then(function (layer) {\r\n                        self.paramFeatureLayer = layer;\r\n                        layer.importState({ features: [featureObj] }).then(function () {\r\n                            self.map.zoomToFeatures(layer.features);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    result = featureObj;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.control.MapInfo.prototype.register.call(self, map);\r\n\r\n        self.exportsState = true;\r\n\r\n        self.MOBILEFAV = self.getLocaleString('mobileBookmarks.instructions');\r\n        self.NAVALERT = self.getLocaleString('bookmarks.instructions');\r\n\r\n        var selectInputField = function (elm) {\r\n            const input = elm.parentElement.querySelector(\"input[type=text]\");\r\n            input.value = input.classList.contains('tc-url') ? self.generateLink() : self.generateIframe();\r\n            input.select();\r\n        };\r\n\r\n        var unselectInputField = function () {\r\n            document.getSelection().removeAllRanges();\r\n            document.getSelection().addRange(document.createRange());\r\n        };\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('h2', function (evt) {\r\n            const link = self.generateLink();\r\n            self.registerListeners();\r\n            self.div.querySelector('.tc-url input[type=text]').value = link;\r\n            self.div.querySelector('.tc-iframe input[type=text]').value = self.generateIframe(link);\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.tc-ctl-share-url-box button', function (evt) {\r\n            const copyBtn = evt.target;\r\n            selectInputField(copyBtn);\r\n            document.execCommand('copy');\r\n\r\n            copyBtn.textContent = self.getLocaleString('copied');\r\n\r\n\r\n            setTimeout(function () {\r\n                copyBtn.textContent = self.getLocaleString('copy');\r\n                unselectInputField();\r\n            }, 1000);\r\n\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('input[type=text]', function (evt) {\r\n            selectInputField(evt.target);\r\n        }));\r\n\r\n        //Deshabilitar el click de ratón en los enlaces de compartir cuando están deshabilitados\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.ga-share-icon.disabled', function (evt) {\r\n            evt.stopImmediatePropagation();\r\n            evt.preventDefault();\r\n            return false;\r\n        }));\r\n\r\n        //Enviar por e-mail\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('a.share-email', function (evt) {\r\n            evt.preventDefault();\r\n            var url = self.generateLink();\r\n\r\n            if (url) {\r\n                const body = encodeURIComponent(url + \"\\n\");\r\n                if (body.length > self.MAILTO_MAX_LENGTH) {\r\n                    map.toast(self.getLocaleString('urlTooLongForMailto'), { type: TC.Consts.msgType.WARNING });\r\n                }\r\n                window.location.href = 'mailto:?body=' + body;\r\n            }\r\n        }));\r\n\r\n        //Generar código QR        \r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.qr-generator\", function (evt) {\r\n            evt.preventDefault();\r\n            const qrContainer = self._dialogDiv.querySelector(\".qrcode\");\r\n            qrContainer.innerHTML = '';\r\n\r\n            if (self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert').classList.contains(TC.Consts.classes.HIDDEN)) {                \r\n                self.makeQRCode(qrContainer, 256, 256).then(function (qrCodeBase64) {\r\n                    if (qrCodeBase64) {\r\n                        TC.Util.showModal(self._$dialogDiv.get(0).querySelector(self._classSelector + '-qr-dialog'));\r\n                    }\r\n                });\r\n            } else {\r\n                TC.Util.showModal(self._$dialogDiv.get(0).querySelector(self._classSelector + '-qr-dialog'));\r\n            }\r\n        }));\r\n\r\n        \r\n        const openSocialMedia = function (win, url, process) {\r\n            if (url && url.trim().length > 0) {\r\n                win.location.href = process(url);\r\n            } else {\r\n                TC.error(self.getLocaleString('urlTooLongForShortener'));\r\n                win.close();\r\n            }\r\n        };\r\n\r\n        //Compartir en Facebook\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-fb\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    return \"https://www.facebook.com/sharer/sharer.php?u=\" + encodeURIComponent(url)\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Twitter\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-twitter\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    var titulo = encodeURIComponent(window.document.title ? window.document.title : \"Visor API SITNA\");\r\n                    return \"https://twitter.com/intent/tweet?text=\" + titulo + \"&amp;url=\" + encodeURIComponent(url);\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Whatsapp\r\n        if (TC.Util.detectMobile()) {\r\n            self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-whatsapp\", function (evt) {\r\n                evt.preventDefault();\r\n\r\n                self.shortenedLink().then(function (url) {\r\n                    var waText = 'whatsapp://send?text=';\r\n                    if (url !== undefined) {\r\n                        location.href = waText + encodeURIComponent(url);\r\n                    } else {\r\n                        location.href = waText + encodeURIComponent(self.generateLink());\r\n                    }\r\n                });\r\n\r\n                return false;\r\n            }));\r\n        }\r\n\r\n        //Guardar en marcadores\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-star\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            var bookmarkURL = self.generateLink();\r\n            var bookmarkTitle = document.title;\r\n\r\n            if (TC.Util.detectMobile()) {\r\n                // Mobile browsers\r\n                alert(ctlProto.MOBILEFAV);\r\n            } else if (window.sidebar && window.sidebar.addPanel) {\r\n                // Firefox version < 23\r\n                window.sidebar.addPanel(bookmarkTitle, bookmarkURL, '');\r\n            } else if ((window.sidebar && /Firefox/i.test(navigator.userAgent)) || (window.opera && window.print)) {\r\n                // Firefox version >= 23 and Opera Hotlist                \r\n\r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n\r\n            } else if (window.external && ('AddFavorite' in window.external)) {\r\n                // IE Favorite\r\n                window.external.AddFavorite(bookmarkURL, bookmarkTitle);\r\n            } else {\r\n                // Other browsers (mainly WebKit - Chrome/Safari)                \r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n            }\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Cuando se añada o borre una capa, comprobamos de nuevo si la URL cumple los requisitos de longitud para habilitar el control\r\n        //map.on(TC.Consts.event.MAPLOAD, function () {\r\n        //    map.on(TC.Consts.event.LAYERREMOVE + ' ' + TC.Consts.event.LAYERADD, function (e) {\r\n        //        self.generateLink();\r\n        //    });\r\n        //});        \r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.template = {};\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/Share.html\";\r\n        ctlProto.template[ctlProto.CLASS + '-dialog'] = TC.apiLocation + \"TC/templates/ShareDialog.html\";\r\n    } else {\r\n        ctlProto.template[ctlProto.CLASS] = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<h2>\").h(\"i18n\", ctx, {}, { \"$key\": \"share\" }).w(\" </h2><div><div class=\\\"ga-share-icons\\\"><a class=\\\"ga-share-icon share-email\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"sendMapByEmail\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-envelope-alt\\\"></i></a><a class=\\\"ga-share-icon qr-generator\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"createQrCode\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-qrcode\\\"></i></a><a class=\\\"ga-share-icon share-fb\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareMapToFacebook\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-facebook\\\"></i></a><a class=\\\"ga-share-icon share-twitter\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareMapToTwitter\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-twitter\\\"></i></a><a class=\\\"ga-share-icon share-whatsapp\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareMapToWhatsapp\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-whatsapp\\\"></i></a><a class=\\\"ga-share-icon share-star\\\" target=\\\"_blank\\\" data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"addToBookmarks\" }).w(\"\\\"href=\\\"#\\\"><i class=\\\"icon-star\\\"></i></a></div><div class=\\\"tc-ctl-share-select\\\"><form><label class=\\\"tc-ctl-share-btn-url\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareLink\" }).w(\"\\\"><input type=\\\"radio\\\" checked=\\\"checked\\\" name=\\\"format\\\" value=\\\"url\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"shareLink\" }).w(\"</span></label><label class=\\\"tc-ctl-share-btn-iframe\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"embedMap\" }).w(\"\\\"><input type=\\\"radio\\\" name=\\\"format\\\" value=\\\"iframe\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"embedMap\" }).w(\"</span></label></form></div><div class=\\\"tc-ctl-share-url-box tc-group tc-url\\\"><input type=\\\"text\\\" class=\\\"tc-textbox tc-url\\\" readonly data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareLink.tip.1\" }).w(\"\\\" /><button class=\\\"tc-button hide\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"shareLink.tip.2\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"copy\" }).w(\"</button></div><div class=\\\"tc-ctl-share-url-box tc-group tc-iframe tc-hidden\\\"><input type=\\\"text\\\" class=\\\"tc-textbox tc-iframe\\\" readonly data-toggle=\\\"tooltip\\\" data-placement=\\\"top\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"embedMap.tip.1\" }).w(\"\\\" /><button class=\\\"tc-button hide\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"embedMap.tip.2\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"copy\" }).w(\"</button></div><div class=\\\"tc-ctl-share-alert tc-alert alert-warning tc-hidden\\\"><p>\").h(\"i18n\", ctx, {}, { \"$key\": \"tooManyLayersLoaded|s\" }).w(\"</p></div> </div>\"); } body_0.__dustBody = !0; return body_0 };\r\n        ctlProto.template[ctlProto.CLASS + '-dialog'] = function () { dust.register(ctlProto.CLASS + '-dialog', body_0); function body_0(chk, ctx) { return chk.w(\"<div class=\\\"tc-ctl-share-qr-dialog tc-modal\\\"><div class=\\\"tc-modal-background tc-modal-close\\\"></div><div class=\\\"tc-modal-window\\\"><div class=\\\"tc-modal-header\\\"><h3>\").h(\"i18n\", ctx, {}, { \"$key\": \"qrCode\" }).w(\"</h3><div class=\\\"tc-modal-close\\\"></div></div><div class=\\\"tc-modal-body\\\"><div class=\\\"qrcode\\\"></div> <div class=\\\"tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden\\\"><p>\").h(\"i18n\", ctx, {}, { \"$key\": \"qrAdvice|s\" }).w(\"</p></div></div><div class=\\\"tc-modal-footer\\\"><button type=\\\"button\\\" class=\\\"tc-button tc-modal-close\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"close\" }).w(\"</button></div></div></div>\"); } body_0.__dustBody = !0; return body_0 };\r\n    }\r\n})();"],"file":"../../Control/Share.min.js"}