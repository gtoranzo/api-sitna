{"version":3,"sources":["control/Share.js"],"names":["TC","control","MapInfo","syncLoadJS","apiLocation","Share","options","this","_classSelector","CLASS","Control","apply","arguments","exportsState","opts","_dialogDiv","Util","getDiv","dialogDiv","window","$","_$dialogDiv","document","body","appendChild","render","inherit","ctlProto","prototype","MAILTO_MAX_LENGTH","IFRAME_WIDTH","IFRAME_HEIGHT","FEATURE_PARAM","MOBILEFAV","NAVALERT","callback","self","getRenderedHtml","html","innerHTML","then","call","queryCommandSupported","div","querySelectorAll","forEach","btn","classList","remove","input","dataset","dataOriginalTitle","detectMobile","querySelector","add","Consts","classes","HIDDEN","span","addEventListener","event","CLICK","e","label","tagName","parentElement","newFormat","value","option","toggle","matches","isFunction","getLocation","result","location","href","hash","substr","indexOf","manageMaxLengthExceed","maxLengthExceed","browser","qr","generateIframe","url","urlString","generateLink","loadParamFeature","featureToShow","getParameterByName","featureObj","JSON","parse","decodeURIComponent","escape","atob","error","getLocaleString","msgErrorMode","TOAST","map","geom","addLayer","id","getUID","type","layerType","VECTOR","title","owner","stealth","layer","paramFeatureLayer","importState","features","zoomToFeatures","register","selectInputField","elm","contains","select","EventTarget","listenerBySelector","evt","link","registerListeners","copyBtn","target","execCommand","textContent","setTimeout","getSelection","removeAllRanges","addRange","createRange","unselectInputField","stopImmediatePropagation","preventDefault","encodeURIComponent","length","toast","msgType","WARNING","qrContainer","makeQRCode","qrCodeBase64","showModal","openSocialMedia","win","process","trim","close","w","open","shortenedLink","waText","undefined","bookmarkURL","bookmarkTitle","alert","sidebar","addPanel","test","navigator","userAgent","opera","print","external","AddFavorite","template","dust","body_0","chk","ctx","h","$key","__dustBody"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapInfo) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapInfo');\r\n}\r\n\r\nTC.control.Share = function (options) {\r\n    var self = this;\r\n    self._classSelector = '.' + self.CLASS;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.exportsState = true;\r\n\r\n    var opts = options || {};\r\n    self._dialogDiv = TC.Util.getDiv(opts.dialogDiv);\r\n    if (window.$) {\r\n        self._$dialogDiv = $(self._dialogDiv);\r\n    }\r\n    if (!opts.dialogDiv) {\r\n        document.body.appendChild(self._dialogDiv);\r\n    }\r\n\r\n    self.render();\r\n};\r\n\r\nTC.inherit(TC.control.Share, TC.control.MapInfo);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Share.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-share';\r\n    ctlProto.MAILTO_MAX_LENGTH = 256;\r\n    ctlProto.IFRAME_WIDTH = '600px';\r\n    ctlProto.IFRAME_HEIGHT = '450px';\r\n    ctlProto.FEATURE_PARAM = 'showfeature';\r\n\r\n    ctlProto.MOBILEFAV = 'Siga las instrucciones del navegador del dispositivo móvil para añadir como favorito. Se guardará el estado actual del mapa.';\r\n    ctlProto.NAVALERT = ' +D para guardar en marcadores.';\r\n\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self.getRenderedHtml(self.CLASS + '-dialog', null, function (html) {\r\n            self._dialogDiv.innerHTML = html;\r\n        }).then(function () {\r\n            return TC.Control.prototype.render.call(self, function () {\r\n                //Si el navegador no soporta copiar al portapapeles, ocultamos el botón de copiar\r\n                if (document.queryCommandSupported && document.queryCommandSupported('copy')) {\r\n                    self.div.querySelectorAll('button').forEach(function (btn) {\r\n                        btn.classList.remove('hide');\r\n                    });\r\n                    self.div.querySelectorAll('input[type=text]').forEach(function (input) {\r\n                        delete input.dataset.dataOriginalTitle;\r\n                    });\r\n                }\r\n\r\n                // Si el SO no es móvil, ocultamos el botón de compartir a WhatsApp\r\n                if (!TC.Util.detectMobile()) {\r\n                    self.div.querySelector(\".share-whatsapp\").classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n\r\n                const options = self.div.querySelectorAll('.' + self.CLASS + '-url-box');\r\n                self.div.querySelectorAll('span:not(.tc-beta)').forEach(function (span) {\r\n                    span.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                        var label = this;\r\n                        while (label && label.tagName !== 'LABEL') {\r\n                            label = label.parentElement;\r\n                        }\r\n                        const newFormat = label.querySelector('input[type=radio][name=format]').value;\r\n\r\n                        options.forEach(function (option) {\r\n                            option.classList.toggle(TC.Consts.classes.HIDDEN, !option.matches('.tc-' + newFormat));\r\n                        });\r\n                    });\r\n                });\r\n                if (TC.Util.isFunction(callback)) {\r\n                    callback();\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Obtiene una URL \"limpia\" para compartir el mapa.\r\n     */\r\n    ctlProto.getLocation = function () {\r\n        var result = window.location.href;\r\n        if (window.location.hash) {\r\n            result = result.substr(0, result.indexOf(window.location.hash));\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.manageMaxLengthExceed = function (maxLengthExceed) {\r\n        const self = this;\r\n\r\n        const browserAlert = self.div.querySelector('.' + self.CLASS + '-alert');\r\n        //Si la URL sobrepasa el tamaño máximo avisamos que puede fallar en Edge\r\n        browserAlert.classList.toggle(TC.Consts.classes.HIDDEN, !maxLengthExceed.browser);\r\n\r\n        const qrAlert = self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert');\r\n        qrAlert.classList.toggle(TC.Consts.classes.HIDDEN, !maxLengthExceed.qr);\r\n    };\r\n\r\n    ctlProto.generateIframe = function (url) {\r\n        var self = this;\r\n        var urlString = url || this.generateLink();\r\n        if (urlString) {\r\n            return '<iframe style=\"width:' + self.IFRAME_WIDTH + ';height:' + self.IFRAME_HEIGHT + ';\" src=\"' + urlString + '\"></iframe>';\r\n        }\r\n    }\r\n\r\n    ctlProto.loadParamFeature = function () {\r\n        const self = this;\r\n        var result = null;\r\n        var featureToShow = TC.Util.getParameterByName(self.FEATURE_PARAM);\r\n        if (featureToShow) {\r\n            var featureObj;\r\n            try {\r\n                featureObj = JSON.parse(decodeURIComponent(escape(window.atob(featureToShow))));\r\n            }\r\n            catch (error) {\r\n                TC.error(self.getLocaleString('sharedFeatureNotValid'), TC.Consts.msgErrorMode.TOAST);\r\n            }\r\n            if (featureObj && self.map) {\r\n                if (featureObj.geom) {\r\n                    self.map.addLayer({\r\n                        id: self.getUID(),\r\n                        type: TC.Consts.layerType.VECTOR,\r\n                        title: self.getLocaleString('foi'),\r\n                        owner: self,\r\n                        stealth: true\r\n                    }).then(function (layer) {\r\n                        self.paramFeatureLayer = layer;\r\n                        layer.importState({ features: [featureObj] }).then(function () {\r\n                            self.map.zoomToFeatures(layer.features);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    result = featureObj;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.control.MapInfo.prototype.register.call(self, map);\r\n\r\n        self.exportsState = true;\r\n\r\n        self.MOBILEFAV = self.getLocaleString('mobileBookmarks.instructions');\r\n        self.NAVALERT = self.getLocaleString('bookmarks.instructions');\r\n\r\n        var selectInputField = function (elm) {\r\n            const input = elm.parentElement.querySelector(\"input[type=text]\");\r\n            input.value = input.classList.contains('tc-url') ? self.generateLink() : self.generateIframe();\r\n            input.select();\r\n        };\r\n\r\n        var unselectInputField = function () {\r\n            document.getSelection().removeAllRanges();\r\n            document.getSelection().addRange(document.createRange());\r\n        };\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('h2', function (evt) {\r\n            const link = self.generateLink();\r\n            self.registerListeners();\r\n            self.div.querySelector('.tc-url input[type=text]').value = link;\r\n            self.div.querySelector('.tc-iframe input[type=text]').value = self.generateIframe(link);\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.tc-ctl-share-url-box button', function (evt) {\r\n            const copyBtn = evt.target;\r\n            selectInputField(copyBtn);\r\n            document.execCommand('copy');\r\n\r\n            copyBtn.textContent = self.getLocaleString('copied');\r\n\r\n\r\n            setTimeout(function () {\r\n                copyBtn.textContent = self.getLocaleString('copy');\r\n                unselectInputField();\r\n            }, 1000);\r\n\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('input[type=text]', function (evt) {\r\n            selectInputField(evt.target);\r\n        }));\r\n\r\n        //Deshabilitar el click de ratón en los enlaces de compartir cuando están deshabilitados\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.ga-share-icon.disabled', function (evt) {\r\n            evt.stopImmediatePropagation();\r\n            evt.preventDefault();\r\n            return false;\r\n        }));\r\n\r\n        //Enviar por e-mail\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('a.share-email', function (evt) {\r\n            evt.preventDefault();\r\n            var url = self.generateLink();\r\n\r\n            if (url) {\r\n                const body = encodeURIComponent(url + \"\\n\");\r\n                if (body.length > self.MAILTO_MAX_LENGTH) {\r\n                    map.toast(self.getLocaleString('urlTooLongForMailto'), { type: TC.Consts.msgType.WARNING });\r\n                }\r\n                window.location.href = 'mailto:?body=' + body;\r\n            }\r\n        }));\r\n\r\n        //Generar código QR        \r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.qr-generator\", function (evt) {\r\n            evt.preventDefault();\r\n            const qrContainer = self._dialogDiv.querySelector(\".qrcode\");\r\n            qrContainer.innerHTML = '';\r\n\r\n            if (self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert').classList.contains(TC.Consts.classes.HIDDEN)) {                \r\n                self.makeQRCode(qrContainer, 256, 256).then(function (qrCodeBase64) {\r\n                    if (qrCodeBase64) {\r\n                        TC.Util.showModal(self._dialogDiv.querySelector(self._classSelector + '-qr-dialog'));\r\n                    }\r\n                });\r\n            } else {\r\n                TC.Util.showModal(self._dialogDiv.querySelector(self._classSelector + '-qr-dialog'));\r\n            }\r\n        }));\r\n\r\n        \r\n        const openSocialMedia = function (win, url, process) {\r\n            if (url && url.trim().length > 0) {\r\n                win.location.href = process(url);\r\n            } else {\r\n                TC.error(self.getLocaleString('urlTooLongForShortener'));\r\n                win.close();\r\n            }\r\n        };\r\n\r\n        //Compartir en Facebook\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-fb\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    return \"https://www.facebook.com/sharer/sharer.php?u=\" + encodeURIComponent(url)\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Twitter\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-twitter\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    var titulo = encodeURIComponent(window.document.title ? window.document.title : \"Visor API SITNA\");\r\n                    return \"https://twitter.com/intent/tweet?text=\" + titulo + \"&amp;url=\" + encodeURIComponent(url);\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Whatsapp\r\n        if (TC.Util.detectMobile()) {\r\n            self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-whatsapp\", function (evt) {\r\n                evt.preventDefault();\r\n\r\n                self.shortenedLink().then(function (url) {\r\n                    var waText = 'whatsapp://send?text=';\r\n                    if (url !== undefined) {\r\n                        location.href = waText + encodeURIComponent(url);\r\n                    } else {\r\n                        location.href = waText + encodeURIComponent(self.generateLink());\r\n                    }\r\n                });\r\n\r\n                return false;\r\n            }));\r\n        }\r\n\r\n        //Guardar en marcadores\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-star\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            var bookmarkURL = self.generateLink();\r\n            var bookmarkTitle = document.title;\r\n\r\n            if (TC.Util.detectMobile()) {\r\n                // Mobile browsers\r\n                alert(ctlProto.MOBILEFAV);\r\n            } else if (window.sidebar && window.sidebar.addPanel) {\r\n                // Firefox version < 23\r\n                window.sidebar.addPanel(bookmarkTitle, bookmarkURL, '');\r\n            } else if ((window.sidebar && /Firefox/i.test(navigator.userAgent)) || (window.opera && window.print)) {\r\n                // Firefox version >= 23 and Opera Hotlist                \r\n\r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n\r\n            } else if (window.external && ('AddFavorite' in window.external)) {\r\n                // IE Favorite\r\n                window.external.AddFavorite(bookmarkURL, bookmarkTitle);\r\n            } else {\r\n                // Other browsers (mainly WebKit - Chrome/Safari)                \r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n            }\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Cuando se añada o borre una capa, comprobamos de nuevo si la URL cumple los requisitos de longitud para habilitar el control\r\n        //map.on(TC.Consts.event.MAPLOAD, function () {\r\n        //    map.on(TC.Consts.event.LAYERREMOVE + ' ' + TC.Consts.event.LAYERADD, function (e) {\r\n        //        self.generateLink();\r\n        //    });\r\n        //});        \r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/Share.html\";\r\n    ctlProto.template[ctlProto.CLASS + '-dialog'] = TC.apiLocation + \"TC/templates/ShareDialog.html\";\r\n\r\n})();"]}