{"version":3,"sources":["Control/Edit.js"],"names":["TC","control","SWCacheClient","syncLoadJS","apiLocation","Consts","editMode","SELECT","ADDPOINT","ADDLINE","ADDPOLYGON","editStyles","NEW","SELECTED","DEFAULT","event","POINT","BEFOREFEATUREMODIFY","FEATUREMODIFY","FEATURESSELECT","FEATURESUNSELECT","newFeatureIdNumber","storeFeature","key","feature","Promise","resolve","reject","loadJS","window","localforage","url","LOCALFORAGE","obj","geometryType","Polygon","geom","POLYGON","Polyline","POLYLINE","Point","MultiPolygon","MULTIPOLYGON","MultiPolyline","MULTIPOLYLINE","id","provId","attributes","data","type","geometry","setItem","then","catch","error","deleteFeature","removeItem","Error","readFeature","getItem","value","getStoragePrefix","ctl","layerId","LOCAL_STORAGE_KEY_PREFIX","layer","getAddedStoragePrefix","LOCAL_STORAGE_ADDED_KEY_PREFIX","getModifiedStoragePrefix","LOCAL_STORAGE_MODIFIED_KEY_PREFIX","getRemovedStoragePrefix","LOCAL_STORAGE_REMOVED_KEY_PREFIX","complexGeometryFilter","elm","result","length","setFeatureSelectedState","features","_deleteBtn","disabled","_joinBtn","_splitBtn","filter","setSaveButtonsState","_saveBtn","_discardBtn","self","checkedOut","setChangedState","isChanged","storagePrefix","keys","i","len","indexOf","addChangesLayer","changesLayer","_changesLayers","Vector","getUID","title","stealth","styles","getChangesLayerStyle","idx","map","layers","insertLayer","Edit","this","apply","arguments","_classSelector","CLASS","wrap","callback","$","isFunction","options","multi","eraseActionConfirmTxt","eraseText","cancelActionConfirmTxt","cancelText","attributeEditor","pointDraw","lineDraw","polygonDraw","snapping","_showsChanges","showChanges","getChangesLayerStyleFunction","on","FEATUREADD","e","feat","added","push","addFeature","toast","FEATUREREMOVE","fid","storeSuccess","storeFailure","removedStoragePrefix","modified","removed","splice","removeFeature","serviceWorkerEnabled","navigator","onLine","gfUrl","getGetFeatureUrl","dftUrl","getDescribeFeatureTypeUrl","createCache","urlList","CONTROLDEACTIVATE","getSelectedFeatures","showPopup","inherit","ctlProto","prototype","template","isDebug","dust","register","body_0","chk","ctx","w","h","$key","s","get","block","body_1","x","body_2","__dustBody","f","blocks","inputText","body_27","inputNumber","body_28","inputCheckbox","body_29","inputDate","body_31","inputTime","body_32","inputDatetime","body_33","shiftBlocks","else","body_34","body_3","body_5","body_4","getPath","body_6","body_7","body_8","body_9","body_10","body_11","body_12","body_13","body_14","body_15","body_16","body_17","body_18","body_19","body_20","body_21","body_22","body_23","body_24","body_25","body_26","b","getBlock","body_30","call","drawPointsId","drawLinesId","drawPolygonsId","addControl","closeButton","LAYERUPDATE","layerType","WFS","setVisibility","addedStoragePrefix","modifiedStoragePrefix","k","substr","getFeatureById","setGeometry","setData","addPromise","idNumber","parseInt","lastIndexOf","Math","max","addPoint","addPolyline","addPolygon","addMultiPolyline","addMultiPolygon","LAYERADD","option","document","createElement","setAttribute","innerHTML","_layerSelect","appendChild","LAYERREMOVE","querySelector","selected","setLayer","parentElement","removeChild","POPUP","currentFeature","slice","attributeTypes","jfa","_joinedFeatureAttributes","ii","getData","attributeObj","name","readOnly","availableValues","j","jj","val","undefined","sort","a","getRenderedHtml","html","contentDiv","inputs","querySelectorAll","selects","forEach","addEventListener","input","target","select","matches","getAttribute","Number","isNaN","parseFloat","Date","trigger","hide","loaded","wfsLayers","workLayers","renderPromise","all","div","mode","controls","drawendHandler","featConstructor","geometryName","drawcancelHandler","cancel","DRAWEND","DRAWCANCEL","modes","isArray","setMode","render","editLayers","wl","_set1stRenderPromise","Control","renderData","_layerDiv","checked","_cancelBtn","confirm","deleteFeatures","joinFeatures","splitFeatures","applyEdits","discardEdits","m","label","style","display","radio","newMode","getLayer","cl","describeFeatureType","RECTANGLE","attr","rbList","selector","rb","setFeatureSelectReadyState","active","hiddenList","activateDraw","draw","activate","isActive","deactivate","classList","add","classes","CHECKED","nextSibling","remove","HIDDEN","hidden","show","onFeatureClick","activeControl","isExclusive","opts","MULTIPOINT","newGeometry","reduce","concat","newFeature","constructor","setSelectedFeatures","complexFeatures","geometries","newFeatures","newFeatPromises","Array","code","reason","clearFeatures","deleteCache","refresh","getNegativeColor","color","str","rgba","getRGBA","toString","dash","extend","point","strokeColor","lineDash","line","polygon"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.SWCacheClient) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/SWCacheClient');\r\n}\r\n\r\nTC.Consts.editMode = {\r\n    SELECT: 'select',\r\n    ADDPOINT: 'addpoint',\r\n    ADDLINE: 'addline',\r\n    ADDPOLYGON: 'addpolygon'\r\n};\r\nTC.Consts.editStyles = {\r\n    NEW: 'temporary',\r\n    SELECTED: 'select',\r\n    DEFAULT: 'default'\r\n};\r\n\r\nTC.Consts.event.POINT = 'point.tc';\r\nTC.Consts.event.BEFOREFEATUREMODIFY = \"beforefeaturemodify.tc\";\r\nTC.Consts.event.FEATUREMODIFY = \"featuremodify.tc\";\r\nTC.Consts.event.FEATURESSELECT = \"featureselect.tc\";\r\nTC.Consts.event.FEATURESUNSELECT = \"featureunselect.tc\";\r\n\r\n(function () {\r\n    var newFeatureIdNumber = 0;\r\n    var getNewFeatureId = function () {\r\n        return \"NewFeature.\" + newFeatureIdNumber++;\r\n    };\r\n\r\n    var storeFeature = function (key, feature) {\r\n        return new Promise(function (resolve, reject) {\r\n            TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                var obj;\r\n                var geometryType;\r\n                switch (true) {\r\n                    case feature instanceof TC.feature.Polygon:\r\n                        geometryType = TC.Consts.geom.POLYGON;\r\n                        break;\r\n                    case feature instanceof TC.feature.Polyline:\r\n                        geometryType = TC.Consts.geom.POLYLINE;\r\n                        break;\r\n                    case feature instanceof TC.feature.Point:\r\n                        geometryType = TC.Consts.geom.POINT;\r\n                        break;\r\n                    case feature instanceof TC.feature.MultiPolygon:\r\n                        geometryType = TC.Consts.geom.MULTIPOLYGON;\r\n                        break;\r\n                    case feature instanceof TC.feature.MultiPolyline:\r\n                        geometryType = TC.Consts.geom.MULTIPOLYLINE;\r\n                        break;\r\n                }\r\n                obj = {\r\n                    id: feature.id || feature.provId,\r\n                    attributes: feature.data,\r\n                    type: geometryType,\r\n                    geometry: feature.geometry,\r\n                }\r\n                localforage.setItem(key, obj)\r\n                    .then(function () {\r\n                        resolve({ feature: feature });\r\n                    })\r\n                    .catch(function (error) {\r\n                        reject({ feature: feature, error: error });\r\n                    });\r\n            });\r\n        });\r\n    };\r\n\r\n    var deleteFeature = function (key) {\r\n        return new Promise(function (resolve, reject) {\r\n            TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                localforage.removeItem(key)\r\n                    .then(function () {\r\n                        resolve(key);\r\n                    })\r\n                    .catch(function (error) {\r\n                        reject(Error(error));\r\n                    });\r\n            });\r\n        });\r\n    };\r\n\r\n    var readFeature = function (key) {\r\n        return new Promise(function (resolve, reject) {\r\n            TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                localforage.getItem(key)\r\n                    .then(function (value) {\r\n                        resolve({\r\n                            key: key,\r\n                            feature: value\r\n                        });\r\n                    })\r\n                    .catch(function (error) {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        });\r\n    };\r\n\r\n    var getStoragePrefix = function (ctl, layerId) {\r\n        return ctl.LOCAL_STORAGE_KEY_PREFIX + (layerId || ctl.layer.id);\r\n    };\r\n\r\n    var getAddedStoragePrefix = function (ctl, layerId) {\r\n        return getStoragePrefix(ctl, layerId) + ctl.LOCAL_STORAGE_ADDED_KEY_PREFIX;\r\n    };\r\n\r\n    var getModifiedStoragePrefix = function (ctl, layerId) {\r\n        return getStoragePrefix(ctl, layerId) + ctl.LOCAL_STORAGE_MODIFIED_KEY_PREFIX;\r\n    };\r\n\r\n    var getRemovedStoragePrefix = function (ctl, layerId) {\r\n        return getStoragePrefix(ctl, layerId) + ctl.LOCAL_STORAGE_REMOVED_KEY_PREFIX;\r\n    };\r\n\r\n    var setFeatureSelectReadyState = function (ctl) {\r\n        ctl._deleteBtn.disabled = true;\r\n        ctl._joinBtn.disabled = true;\r\n        ctl._splitBtn.disabled = true;\r\n    }\r\n\r\n    var complexGeometryFilter = function (elm) {\r\n        var result = false;\r\n        if ((TC.feature.MultiPolygon && elm instanceof TC.feature.MultiPolygon) ||\r\n            (TC.feature.MultiPolyline && elm instanceof TC.feature.MultiPolyline)) {\r\n            if (elm.geometry.length > 1) {\r\n                result = true;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    var setFeatureSelectedState = function (ctl, features) {\r\n        ctl._deleteBtn.disabled = features.length === 0;\r\n        ctl._joinBtn.disabled = features.length < 2;\r\n        ctl._splitBtn.disabled = features.filter(complexGeometryFilter).length === 0;\r\n    }\r\n\r\n    var setSaveButtonsState = function (ctl, disabled) {\r\n        ctl._saveBtn.disabled = disabled;\r\n        ctl._discardBtn.disabled = disabled;\r\n        self.checkedOut = !disabled;\r\n    };\r\n\r\n    var setChangedState = function (ctl, isChanged) {\r\n        if (typeof isChanged !== 'undefined') {\r\n            setSaveButtonsState(ctl, !isChanged);\r\n        }\r\n        else {\r\n            TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                var storagePrefix = getStoragePrefix(ctl);\r\n                localforage.keys().then(function (keys) {\r\n                    if (keys) {\r\n                        var disabled = true;\r\n                        for (var i = 0, len = keys.length; i < len; i++) {\r\n                            if (keys[i].indexOf(storagePrefix) === 0) {\r\n                                disabled = false;\r\n                                break;\r\n                            }\r\n                        }\r\n                        setSaveButtonsState(ctl, disabled);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    var addChangesLayer = function (ctl, layer) {\r\n        return new Promise(function (resolve, reject) {\r\n            var changesLayer = ctl._changesLayers[layer.id];\r\n            if (changesLayer) {\r\n                resolve(changesLayer);\r\n            }\r\n            else {\r\n                changesLayer = ctl._changesLayers[layer.id] = new TC.layer.Vector({\r\n                    id: TC.getUID(),\r\n                    title: layer.title + ' - cambios pendientes',\r\n                    stealth: true,\r\n                    styles: ctl.getChangesLayerStyle(layer)\r\n                });\r\n                var idx = ctl.map.layers.indexOf(layer);\r\n                ctl.map.insertLayer(changesLayer, idx + 1, function () {\r\n                    resolve(changesLayer);\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    /* Creamos el constructor, llamando al constructor del padre */\r\n    TC.control.Edit = function () {\r\n        var self = this;\r\n\r\n        TC.control.SWCacheClient.apply(this, arguments);\r\n\r\n        self._classSelector = '.' + self.CLASS;\r\n\r\n        self.wrap = new TC.wrap.control.Edit(self);\r\n        self.layer = null;\r\n        self.checkedOut = false;\r\n        //self.feature = self.options.feature ? self.options.feature : null;\r\n        self.callback = (arguments[2] && $.isFunction(arguments[2])) ? arguments[2] : (self.options.callback ? self.options.callback : null);\r\n        self.multi = self.options.multi ? self.options.multi : false;\r\n        self.eraseActionConfirmTxt = self.options.eraseText ? self.options.eraseText : \"¿Está seguro de eliminar esta(s) geometría(s)?\";\r\n        self.cancelActionConfirmTxt = self.options.cancelText ? self.options.eraseText : \"Si continua todos los cambios se perderán. ¿Desea continuar?\";\r\n        self.styles = self.options.styles;\r\n        self.features = {};\r\n        self.attributeEditor = null;\r\n        self.pointDraw = null;\r\n        self.lineDraw = null;\r\n        self.polygonDraw = null;\r\n        self.snapping = (typeof self.options.snapping === 'boolean') ? self.options.snapping : true;\r\n        self._changesLayers = {};\r\n        self._showsChanges = (typeof self.options.showChanges === 'boolean') ? self.options.showChanges : true;\r\n        if ($.isFunction(self.options.getChangesLayerStyleFunction)) {\r\n            self.getChangesLayerStyleFunction = self.getChangesLayerStyle;\r\n        }\r\n\r\n        self\r\n            .on(TC.Consts.event.FEATUREADD, function (e) {\r\n                var feat = e.feature;\r\n                feat.provId = getNewFeatureId();\r\n                var changesLayer = self._changesLayers[self.layer.id];\r\n                self.features[self.layer.id].added.push(feat);\r\n                changesLayer.addFeature(feat);\r\n                storeFeature(getAddedStoragePrefix(self) + feat.provId, feat).then(function () {\r\n                    setChangedState(self, true);\r\n                    TC.toast(\"Adición guardada\");\r\n                }, function () {\r\n                    TC.error(\"Fallo al guardar adición\");\r\n                });\r\n            })\r\n            .on(TC.Consts.event.FEATUREREMOVE, function (e) {\r\n                var feat = e.feature;\r\n                var fid = feat.provId || feat.id;\r\n                var storeSuccess = function () {\r\n                    setChangedState(self);\r\n                    TC.toast(\"Eliminación guardada\");\r\n                };\r\n                var storeFailure = function () {\r\n                    TC.error(\"Fallo al guardar eliminación\");\r\n                };\r\n                var changesLayer = self._changesLayers[self.layer.id];\r\n                var features = self.features[self.layer.id];\r\n                var idx = features.added.indexOf(feat);\r\n                if (idx < 0) {\r\n                    var removedStoragePrefix = getRemovedStoragePrefix(self);\r\n                    idx = features.modified.indexOf(feat);\r\n                    if (idx < 0) {\r\n                        idx = features.removed.indexOf(feat);\r\n                        if (idx < 0) {\r\n                            features.removed.push(feat);\r\n                            changesLayer.addFeature(feat);\r\n                            storeFeature(removedStoragePrefix + feat.id, feat).then(storeSuccess, storeFailure);\r\n                        }\r\n                    }\r\n                    else {\r\n                        features.modified.splice(idx, 1);\r\n                        features.removed.push(feat);\r\n                        deleteFeature(getModifiedStoragePrefix(self) + feat.id).then(function () {\r\n                            storeSuccess();\r\n                            storeFeature(removedStoragePrefix + feat.id, feat).then(storeSuccess, storeFailure);\r\n                        }, storeFailure);\r\n                    }\r\n                }\r\n                else {\r\n                    changesLayer.removeFeature(feat);\r\n                    features.added.splice(idx, 1);\r\n                    deleteFeature(getAddedStoragePrefix(self) + fid).then(storeSuccess, storeFailure);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.FEATUREMODIFY, function (e) {\r\n                var feat = e.feature;\r\n                var fid = feat.provId || feat.id;\r\n                var storeSuccess = function () {\r\n                    setChangedState(self, true);\r\n                    TC.toast(\"Modificación guardada\");\r\n                };\r\n                var storeFailure = function () {\r\n                    TC.error(\"Fallo al guardar modificación\");\r\n                };\r\n                var changesLayer = self._changesLayers[self.layer.id];\r\n                var features = self.features[self.layer.id];\r\n                var idx = features.added.indexOf(feat);\r\n                if (idx < 0) {\r\n                    idx = features.modified.indexOf(feat);\r\n                    if (idx < 0) {\r\n                        changesLayer.addFeature(feat);\r\n                        features.modified.push(feat);\r\n                    }\r\n                    storeFeature(getModifiedStoragePrefix(self) + fid, feat).then(storeSuccess, storeFailure);\r\n                }\r\n                else {\r\n                    storeFeature(getAddedStoragePrefix(self) + fid, feat).then(storeSuccess, storeFailure);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.FEATUREADD + ' ' + TC.Consts.event.FEATUREREMOVE + ' ' + TC.Consts.event.FEATUREMODIFY, function (e) {\r\n                if (self.serviceWorkerEnabled && navigator.onLine) {\r\n                    var gfUrl = self.layer.wrap.getGetFeatureUrl();\r\n                    var dftUrl = self.layer.wrap.getDescribeFeatureTypeUrl();\r\n                    if (gfUrl && dftUrl) {\r\n                        self.createCache(self.LOCAL_STORAGE_KEY_PREFIX + self.layer.id, {\r\n                            urlList: [gfUrl, dftUrl]\r\n                        });\r\n                    }\r\n                }\r\n            })\r\n            //.on(TC.Consts.event.MEASURE + ' ' + TC.Consts.event.MEASUREPARTIAL, function (e) {\r\n            //    var precision = e.units === 'm' ? 0 : 3;\r\n            //    if (e.area) {\r\n            //        self._$area.html(e.area.toFixed(precision).replace('.', ',') + ' ' + e.units + '&sup2;');\r\n            //    }\r\n            //    if (e.perimeter) {\r\n            //        self._$peri.html(e.perimeter.toFixed(precision).replace('.', ',') + ' ' + e.units);\r\n            //    }\r\n            //    if (e.length) {\r\n            //        self._$len.html(e.length.toFixed(precision).replace('.', ',') + ' ' + e.units);\r\n            //    }\r\n            //})\r\n            //.on(TC.Consts.event.MEASURE, function (e) {\r\n            //    self._pointHistoryIdx = 0;\r\n            //    self.history.length = self._pointHistoryIdx;\r\n            //    self._$undoBtn.prop('disabled', true);\r\n            //    self._$redoBtn.prop('disabled', true);\r\n            //})\r\n            .on(TC.Consts.event.CONTROLDEACTIVATE, function (e) {\r\n                //self._$area.html('-');\r\n                //self._$peri.html('-');\r\n                //self._$len.html('-');\r\n            })\r\n            .on(TC.Consts.event.FEATURESSELECT, function (e) {\r\n                \r\n                var features = self.getSelectedFeatures();\r\n                setFeatureSelectedState(self, features);\r\n                if (features.length) {\r\n                    features[0].showPopup(self.attributeEditor);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.FEATURESUNSELECT, function (e) {\r\n                setFeatureSelectedState(self, self.getSelectedFeatures());\r\n            });\r\n            //.on(TC.Consts.event.EDITIONSAVE, function (e) {\r\n            //    if (self.callback)\r\n            //        self.callback(e.added, e.removed, e.modified);\r\n            //});\r\n    };\r\n\r\n    TC.inherit(TC.control.Edit, TC.control.SWCacheClient);\r\n\r\n    var ctlProto = TC.control.Edit.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-edit';\r\n    ctlProto.LOCAL_STORAGE_KEY_PREFIX = \"TC.offline.edit.\";\r\n    ctlProto.LOCAL_STORAGE_ADDED_KEY_PREFIX = \".added.\";\r\n    ctlProto.LOCAL_STORAGE_MODIFIED_KEY_PREFIX = \".modified.\";\r\n    ctlProto.LOCAL_STORAGE_REMOVED_KEY_PREFIX = \".removed.\";\r\n\r\n    ctlProto.template = {};\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/Edit.html\";\r\n        ctlProto.template[ctlProto.CLASS + '-attr'] = TC.apiLocation + \"TC/templates/EditAttributes.html\";\r\n    } else {\r\n        ctlProto.template[ctlProto.CLASS] = function () {\r\n            dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<h2>\").h(\"i18n\", ctx, {}, { \"$key\": \"featureEdit\" }).w(\"</h2><div class=\\\"tc-ctl-edit-layer\\\"><select class=\\\"tc-combo tc-ctl-edit-layer-sel\\\"><option value=\\\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"selectLayerToEdit\" }).w(\"</option>\").s(ctx.get([\"layers\"], false), ctx, { \"block\": body_1 }, {}).w(\"</select><input type=\\\"checkbox\\\" id=\\\"tc-ctl-edit-view-changes-cb\\\"\").x(ctx.get([\"showChanges\"], false), ctx, { \"block\": body_2 }, {}).w(\" /><label class=\\\"tc-ctl-edit-view-changes\\\" for=\\\"tc-ctl-edit-view-changes-cb\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"highlightUnsyncedChanges\" }).w(\"</label></div><div class=\\\"tc-ctl-edit-mode\\\"><form><label class=\\\"tc-ctl-edit-btn-select\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"select\" }).w(\"\\\"><input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"select\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"select\" }).w(\"</span></label><label class=\\\"tc-ctl-edit-btn-point\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"newPoint\" }).w(\"\\\"><input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"addpoint\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"newPoint\" }).w(\"</span></label><label class=\\\"tc-ctl-edit-btn-line\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"newLine\" }).w(\"\\\"><input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"addline\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"newLine\" }).w(\"</span></label><label class=\\\"tc-ctl-edit-btn-polygon\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"newPolygon\" }).w(\"\\\"><input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"addpolygon\\\" /><span>\").h(\"i18n\", ctx, {}, { \"$key\": \"newPolygon\" }).w(\"</span></label></form></div><div class=\\\"tc-ctl-edit-select tc-hidden\\\"><button class=\\\"tc-ctl-btn tc-ctl-edit-btn-delete\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"delete\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"delete\" }).w(\"</button><button class=\\\"tc-ctl-btn tc-ctl-edit-btn-join\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"joinGeometries.tooltip\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"joinGeometries\" }).w(\"</button><button class=\\\"tc-ctl-btn tc-ctl-edit-btn-split\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"splitGeometry\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"splitGeometry\" }).w(\"</button><button class=\\\"tc-ctl-btn tc-ctl-edit-btn-cancel\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"cancel\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"cancel\" }).w(\"</button></div><div class=\\\"tc-ctl-edit-point tc-hidden\\\"></div><div class=\\\"tc-ctl-edit-line tc-hidden\\\"></div><div class=\\\"tc-ctl-edit-polygon tc-hidden\\\"></div><div class=\\\"tc-ctl-edit-save\\\"><button class=\\\"tc-button tc-icon-button tc-ctl-edit-btn-save\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"syncChanges\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"syncChanges\" }).w(\"</button><button class=\\\"tc-button tc-icon-button tc-ctl-edit-btn-discard\\\" disabled title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"discardChanges\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"discardChanges\" }).w(\"</button></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<option value=\\\"\").f(ctx.get([\"id\"], false), ctx, \"h\").w(\"\\\">\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</option>\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\" checked\"); } body_2.__dustBody = !0; return body_0\r\n        };\r\n        ctlProto.template[ctlProto.CLASS + '-attr'] = function () {\r\n            dust.register(ctlProto.CLASS + '-attr', body_0); var blocks = { \"inputText\": body_27, \"inputNumber\": body_28, \"inputCheckbox\": body_29, \"inputDate\": body_31, \"inputTime\": body_32, \"inputDatetime\": body_33 }; function body_0(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<div class=\\\"tc-ctl-edit-attr\\\"><h3>\").h(\"i18n\", ctx, {}, { \"$key\": \"attributeEdit\" }).w(\"</h3><div class=\\\"tc-ctl-edit-attr-body\\\"><table><tbody>\").s(ctx.get([\"data\"], false), ctx, { \"block\": body_1 }, {}).w(\"</tbody></table></div><div class=\\\"tc-ctl-edit-attr-footer\\\"><button class=\\\"tc-button tc-ctl-edit-btn-attr-ok\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"ok\" }).w(\"</button><button class=\\\"tc-button tc-ctl-edit-btn-attr-cancel\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"cancel\" }).w(\"</button></div></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<tr><th>\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"</th><td>\").x(ctx.get([\"readOnly\"], false), ctx, { \"else\": body_2, \"block\": body_34 }, {}).w(\"</td></tr>\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.x(ctx.get([\"availableValues\"], false), ctx, { \"block\": body_3 }, {}).h(\"select\", ctx, { \"block\": body_5 }, { \"key\": ctx.get([\"type\"], false) }); } body_2.__dustBody = !0; function body_3(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<select class=\\\"tc-combo\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\"><option value=\\\"\\\"></option>\").s(ctx.get([\"availableValues\"], false), ctx, { \"block\": body_4 }, {}).w(\"</select>\"); } body_3.__dustBody = !0; function body_4(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<option value=\\\"\").f(ctx.getPath(true, []), ctx, \"h\").w(\"\\\">\").f(ctx.getPath(true, []), ctx, \"h\").w(\"</option>\"); } body_4.__dustBody = !0; function body_5(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.h(\"none\", ctx, { \"block\": body_6 }, {}).h(\"eq\", ctx, { \"block\": body_7 }, { \"value\": \"int\" }).h(\"eq\", ctx, { \"block\": body_8 }, { \"value\": \"integer\" }).h(\"eq\", ctx, { \"block\": body_9 }, { \"value\": \"double\" }).h(\"eq\", ctx, { \"block\": body_10 }, { \"value\": \"boolean\" }).h(\"eq\", ctx, { \"block\": body_11 }, { \"value\": \"date\" }).h(\"eq\", ctx, { \"block\": body_12 }, { \"value\": \"time\" }).h(\"eq\", ctx, { \"block\": body_13 }, { \"value\": \"dateTime\" }).h(\"eq\", ctx, { \"block\": body_14 }, { \"value\": \"byte\" }).h(\"eq\", ctx, { \"block\": body_15 }, { \"value\": \"long\" }).h(\"eq\", ctx, { \"block\": body_16 }, { \"value\": \"negativeInteger\" }).h(\"eq\", ctx, { \"block\": body_17 }, { \"value\": \"nonNegativeInteger\" }).h(\"eq\", ctx, { \"block\": body_18 }, { \"value\": \"nonPositiveInteger\" }).h(\"eq\", ctx, { \"block\": body_19 }, { \"value\": \"positiveInteger\" }).h(\"eq\", ctx, { \"block\": body_20 }, { \"value\": \"short\" }).h(\"eq\", ctx, { \"block\": body_21 }, { \"value\": \"unsignedLong\" }).h(\"eq\", ctx, { \"block\": body_22 }, { \"value\": \"unsignedInt\" }).h(\"eq\", ctx, { \"block\": body_23 }, { \"value\": \"unsignedShort\" }).h(\"eq\", ctx, { \"block\": body_24 }, { \"value\": \"unsignedByte\" }).h(\"eq\", ctx, { \"block\": body_25 }, { \"value\": \"float\" }).h(\"eq\", ctx, { \"block\": body_26 }, { \"value\": \"decimal\" }); } body_5.__dustBody = !0; function body_6(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputText\"), ctx, {}, {}); } body_6.__dustBody = !0; function body_7(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_7.__dustBody = !0; function body_8(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_8.__dustBody = !0; function body_9(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_9.__dustBody = !0; function body_10(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputCheckbox\"), ctx, {}, {}); } body_10.__dustBody = !0; function body_11(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputDate\"), ctx, {}, {}); } body_11.__dustBody = !0; function body_12(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputTime\"), ctx, {}, {}); } body_12.__dustBody = !0; function body_13(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputDatetime\"), ctx, {}, {}); } body_13.__dustBody = !0; function body_14(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_14.__dustBody = !0; function body_15(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_15.__dustBody = !0; function body_16(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_16.__dustBody = !0; function body_17(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_17.__dustBody = !0; function body_18(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_18.__dustBody = !0; function body_19(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_19.__dustBody = !0; function body_20(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_20.__dustBody = !0; function body_21(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_21.__dustBody = !0; function body_22(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_22.__dustBody = !0; function body_23(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_23.__dustBody = !0; function body_24(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_24.__dustBody = !0; function body_25(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_25.__dustBody = !0; function body_26(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.b(ctx.getBlock(\"inputNumber\"), ctx, {}, {}); } body_26.__dustBody = !0; function body_27(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"text\\\" class=\\\"tc-textbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\" value=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" />\"); } body_27.__dustBody = !0; function body_28(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"number\\\" class=\\\"tc-textbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\" value=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" />\"); } body_28.__dustBody = !0; function body_29(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"checkbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\"\").x(ctx.get([\"value\"], false), ctx, { \"block\": body_30 }, {}).w(\"/>\"); } body_29.__dustBody = !0; function body_30(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\" checked\"); } body_30.__dustBody = !0; function body_31(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"date\\\" class=\\\"tc-textbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\" value=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" />\"); } body_31.__dustBody = !0; function body_32(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"time\\\" class=\\\"tc-textbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\" value=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" />\"); } body_32.__dustBody = !0; function body_33(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.w(\"<input type=\\\"datetime\\\" class=\\\"tc-textbox\\\" name=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\" value=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" />\"); } body_33.__dustBody = !0; function body_34(chk, ctx) { ctx = ctx.shiftBlocks(blocks); return chk.f(ctx.get([\"value\"], false), ctx, \"h\"); } body_34.__dustBody = !0; return body_0\r\n        };\r\n    }\r\n\r\n    /* Extendemos el método register. \r\n       La lógica del control suele definirse aquí. */\r\n    ctlProto.register = function (map) {\r\n        var self = this;\r\n        const result = TC.control.SWCacheClient.prototype.register.call(self, map);\r\n\r\n        const drawPointsId = self.getUID();\r\n        const drawLinesId = self.getUID();\r\n        const drawPolygonsId = self.getUID();\r\n\r\n        map.addControl('popup', { closeButton: true }).then(function (ctl) {\r\n            self.attributeEditor = ctl;\r\n        });\r\n\r\n        map\r\n            .on(TC.Consts.event.LAYERUPDATE, function (e) {\r\n                const layer = e.layer;\r\n                if (layer.type === TC.Consts.layerType.WFS && !layer.options.stealth) {\r\n                    var features = self.features[layer.id] = self.features[layer.id] || {\r\n                        added: [],\r\n                        modified: [],\r\n                        removed: []\r\n                    };\r\n                    addChangesLayer(self, layer).then(function (changesLayer) {\r\n                        if (self.layer !== layer) {\r\n                            changesLayer.setVisibility(false);\r\n                        }\r\n                        var storagePrefix = getStoragePrefix(self, layer.id);\r\n                        var addedStoragePrefix = getAddedStoragePrefix(self, layer.id);\r\n                        var modifiedStoragePrefix = getModifiedStoragePrefix(self, layer.id);\r\n                        var removedStoragePrefix = getRemovedStoragePrefix(self, layer.id);\r\n                        TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                            //var li = map.getLoadingIndicator();\r\n                            var uid = TC.getUID();\r\n                            localforage.keys().then(function (keys) {\r\n                                if (keys) {\r\n                                    for (var i = 0, len = keys.length; i < len; i++) {\r\n                                        var key = keys[i];\r\n                                        if (key.indexOf(storagePrefix) === 0) {\r\n                                            //li && li.addWait(uid);\r\n                                            readFeature(key).then(function (obj) {\r\n                                                var id;\r\n                                                var k = obj.key;\r\n                                                if (k.indexOf(removedStoragePrefix) === 0) {\r\n                                                    id = k.substr(removedStoragePrefix.length);\r\n                                                    var feature = layer.getFeatureById(id);\r\n                                                    layer.removeFeature(feature);\r\n                                                    changesLayer.addFeature(feature);\r\n                                                    features.removed.push(feature);\r\n                                                    //li && li.removeWait(uid);\r\n                                                }\r\n                                                else if (k.indexOf(modifiedStoragePrefix) === 0) {\r\n                                                    id = k.substr(modifiedStoragePrefix.length);\r\n                                                    var feature = layer.getFeatureById(id);\r\n                                                    if (feature) {\r\n                                                        changesLayer.addFeature(feature);\r\n                                                        features.modified.push(feature);\r\n                                                        feature.wrap.setGeometry(obj.feature.geometry);\r\n                                                        feature.setData(obj.feature.attributes);\r\n                                                        //li && li.removeWait(uid);\r\n                                                    }\r\n                                                }\r\n                                                else if (k.indexOf(addedStoragePrefix) === 0) {\r\n                                                    id = k.substr(addedStoragePrefix.length);\r\n                                                    var idNumber = parseInt(id.substr(id.lastIndexOf('.') + 1));\r\n                                                    newFeatureIdNumber = Math.max(newFeatureIdNumber, idNumber + 1);\r\n                                                    var addPromise;\r\n                                                    switch (obj.feature.type) {\r\n                                                        case TC.Consts.geom.POINT:\r\n                                                            addPromise = layer.addPoint(obj.feature.geometry);\r\n                                                            break;\r\n                                                        case TC.Consts.geom.POLYLINE:\r\n                                                            addPromise = layer.addPolyline(obj.feature.geometry);\r\n                                                            break;\r\n                                                        case TC.Consts.geom.POLYGON:\r\n                                                            addPromise = layer.addPolygon(obj.feature.geometry);\r\n                                                            break;\r\n                                                        case TC.Consts.geom.MULTIPOLYLINE:\r\n                                                            addPromise = layer.addMultiPolyline(obj.feature.geometry);\r\n                                                            break;\r\n                                                        case TC.Consts.geom.MULTIPOLYGON:\r\n                                                            addPromise = layer.addMultiPolygon(obj.feature.geometry);\r\n                                                            break;\r\n                                                        default:\r\n                                                            break;\r\n                                                    };\r\n                                                    addPromise.then(function (feat) {\r\n                                                        //feat.setStyle($.extend({}, layer.styles.line, layer.styles.polygon));\r\n                                                        changesLayer.addFeature(feat);\r\n                                                        features.added.push(feat);\r\n                                                        feat.provId = id;\r\n                                                        feat.setData(obj.feature.attributes);\r\n                                                        //li && li.removeWait(uid);\r\n                                                    });\r\n                                                }\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                    });\r\n                    //map.off(TC.Consts.event.LAYERUPDATE, layerUpdateHandler);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.LAYERADD, function (e) {\r\n                const layer = e.layer;\r\n                if (layer.type === TC.Consts.layerType.WFS && !layer.options.stealth) {\r\n                    self.features[layer.id] = self.features[layer.id] || {\r\n                        added: [],\r\n                        modified: [],\r\n                        removed: []\r\n                    };\r\n                    const option = document.createElement('option');\r\n                    option.setAttribute('value', layer.id);\r\n                    option.innerHTML = layer.title || layer.id;\r\n                    self._layerSelect.appendChild(option);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.LAYERREMOVE, function (e) {\r\n                const layer = e.layer;\r\n                if (layer.type === TC.Consts.layerType.WFS && !layer.options.stealth) {\r\n                    var option = self._layerSelect.querySelector('option[value=' + layer.id + ']');\r\n                    if (option.selected) {\r\n                        self.setLayer(null);\r\n                    }\r\n                    option.parentElement.removeChild(option);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.POPUP, function (e) {\r\n                if (e.control === self.attributeEditor) {\r\n                    var feature = e.control.currentFeature;\r\n                    var attributes = self.attributes.slice();\r\n                    var attributeTypes = {};\r\n                    var jfa = self._joinedFeatureAttributes || [];\r\n                    for (var i = 0, ii = attributes.length; i < ii; i++) {\r\n                        var attr\r\n                        var data = feature.getData() || {};\r\n                        var attributeObj = attributes[i];\r\n                        attributeObj.value = data[attributeObj.name];\r\n                        if (attributeObj.name === 'id') {\r\n                            attributeObj.readOnly = true;\r\n                        }\r\n                        attributeObj.availableValues = [];\r\n                        for (var j = 0, jj = jfa.length; j < jj; j++) {\r\n                            var val = jfa[j][attributeObj.name];\r\n                            if (val !== undefined && val !== '') {\r\n                                attributeObj.availableValues[attributeObj.availableValues.length] = val;\r\n                            }\r\n                        }\r\n                        attributeTypes[attributeObj.name] = attributeObj.type;\r\n                    }\r\n                    attributes.sort(function (a, b) {\r\n                        if (a.readOnly ? !b.readOnly : b.readOnly) { //XOR\r\n                            return !a.readOnly - !b.readOnly; // Primero readOnly\r\n                        }\r\n                        if (a.name > b.name) {\r\n                            return 1;\r\n                        }\r\n                        if (a.name < b.name) {\r\n                            return -1;\r\n                        }\r\n                        return 0;\r\n                    });\r\n                    self.getRenderedHtml(self.CLASS + '-attr', { data: attributes }, function (html) {\r\n                        const contentDiv = self.attributeEditor.contentDiv;\r\n                        contentDiv.innerHTML = html;\r\n                        const inputs = contentDiv.querySelectorAll('input');\r\n                        const selects = contentDiv.querySelectorAll('select');\r\n                        inputs.forEach(function (elm) {\r\n                            elm.addEventListener('input', function (e) {\r\n                                const input = e.target;\r\n                                for (var i = 0, len = selects.length; i < len; i++) {\r\n                                    const select = selects[i];\r\n                                    if (select.matches('[name=' + e.target.getAttribute('name') + ']') && select.value !== input.value) {\r\n                                        select.value = '';\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                        selects.forEach(function (elm) {\r\n                            elm.addEventListener('change', function (e) {\r\n                                const select = e.target;\r\n                                for (var i = 0, len = inputs.length; i < len; i++) {\r\n                                    const input = inputs[i];\r\n                                    if (input.matches('[name=' + select.getAttribute('name') + ']')) {\r\n                                        input.value = select.value;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            });\r\n                        });\r\n                        contentDiv.querySelector('.' + self.CLASS + '-btn-attr-ok').addEventListener('click', function () {\r\n                            var data = {};\r\n                            inputs.forEach(function (input) {\r\n                                var name = input.getAttribute('name');\r\n                                var value = input.value;\r\n                                switch (attributeTypes[name]) {\r\n                                    case 'int':\r\n                                    case 'integer':\r\n                                    case 'byte':\r\n                                    case 'long':\r\n                                    case 'negativeInteger':\r\n                                    case 'nonNegativeInteger':\r\n                                    case 'nonPositiveInteger':\r\n                                    case 'positiveInteger':\r\n                                    case 'short':\r\n                                    case 'unsignedLong':\r\n                                    case 'unsignedInt':\r\n                                    case 'unsignedShort':\r\n                                    case 'unsignedByte':\r\n                                        value = parseInt(value);\r\n                                        if (!Number.isNaN(value)) {\r\n                                            data[name] = value;\r\n                                        }\r\n                                        break;\r\n                                    case 'double':\r\n                                    case 'float':\r\n                                    case 'decimal':\r\n                                        value = parseFloat(value);\r\n                                        if (!Number.isNaN(value)) {\r\n                                            data[name] = value;\r\n                                        }\r\n                                        break;\r\n                                    case 'date':\r\n                                    case 'time':\r\n                                    case 'dateTime':\r\n                                        data[name] = new Date(value);\r\n                                        break;\r\n                                    case 'boolean':\r\n                                        data[name] = !!value;\r\n                                        break;\r\n                                    case undefined:\r\n                                        break;\r\n                                    default:\r\n                                        data[name] = value;\r\n                                        break;\r\n                                }\r\n                            });\r\n                            feature.setData(data);\r\n                            self.trigger(TC.Consts.event.FEATUREMODIFY, { feature: feature, layer: self.layer });\r\n                            self.attributeEditor.hide();\r\n                        });\r\n                        contentDiv.querySelector('.' + self.CLASS + '-btn-attr-cancel').addEventListener('click', function () {\r\n                            self.attributeEditor.hide();\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n\r\n\r\n\r\n        map.loaded(function () {\r\n            if (self.options.layer) {\r\n                self.setLayer(self.options.layer);\r\n            }\r\n            else {\r\n                var wfsLayers = map.workLayers.filter(function (elm) {\r\n                    return elm.type === TC.Consts.layerType.WFS && !elm.options.stealth;\r\n                });\r\n                if (wfsLayers.length === 1) {\r\n                    self.setLayer(wfsLayers[0].id);\r\n                }\r\n                else {\r\n                    self.setLayer(null);\r\n                }\r\n            }\r\n\r\n            self.showChanges(self._showsChanges);\r\n\r\n            self.renderPromise().then(function () {\r\n                var DRAW = 'draw';\r\n                Promise.all([\r\n                    map.addControl(DRAW, {\r\n                        id: drawPointsId,\r\n                        div: self.div.querySelector('.' + self.CLASS + '-point'),\r\n                        mode: TC.Consts.geom.POINT,\r\n                        layer: false\r\n                    }),\r\n                    map.addControl(DRAW, {\r\n                        id: drawLinesId,\r\n                        div: self.div.querySelector('.' + self.CLASS + '-line'),\r\n                        mode: TC.Consts.geom.POLYLINE,\r\n                        layer: false\r\n                    }),\r\n                    map.addControl(DRAW, {\r\n                        id: drawPolygonsId,\r\n                        div: self.div.querySelector('.' + self.CLASS + '-polygon'),\r\n                        mode: TC.Consts.geom.POLYGON,\r\n                        layer: false\r\n                    })\r\n                ]).then (function (controls) {\r\n                    self.pointDraw = controls[0];\r\n                    self.lineDraw = controls[1];\r\n                    self.polygonDraw = controls[2];\r\n\r\n                    var drawendHandler = function (e) {\r\n                        //var styleObj = {};\r\n                        var feature = e.feature;\r\n                        var featConstructor;\r\n                        switch (self.geometryType) {\r\n                            case TC.Consts.geom.POINT:\r\n                                featConstructor = TC.feature.Point;\r\n                                //$.extend(styleObj, self.layer.styles.point);\r\n                                break;\r\n                            case TC.Consts.geom.POLYLINE:\r\n                                featConstructor = TC.feature.Polyline;\r\n                                //$.extend(styleObj, self.layer.styles.line);\r\n                                break;\r\n                            case TC.Consts.geom.POLYGON:\r\n                                featConstructor = TC.feature.Polygon;\r\n                                //$.extend(styleObj, self.layer.styles.line, self.layer.styles.polygon);\r\n                                break;\r\n                            case TC.Consts.geom.MULTIPOLYLINE:\r\n                                featConstructor = TC.feature.MultiPolyline;\r\n                                //$.extend(styleObj, self.layer.styles.line);\r\n                                break;\r\n                            case TC.Consts.geom.MULTIPOLYGON:\r\n                                featConstructor = TC.feature.MultiPolygon;\r\n                                //$.extend(styleObj, self.layer.styles.line, self.layer.styles.polygon);\r\n                                break;\r\n                            default:\r\n                                //$.extend(styleObj, self.layer.styles.line, self.layer.styles.polygon);\r\n                                break;\r\n                        }\r\n                        if (featConstructor) {\r\n                            feature = new featConstructor(feature.geometry, { geometryName: self.layer.options.geometryName });\r\n                        }\r\n                        //feature.setStyle(styleObj);\r\n                        self.layer.addFeature(feature);\r\n                        self.trigger(TC.Consts.event.FEATUREADD, { feature: feature });\r\n                    };\r\n                    var drawcancelHandler = function () {\r\n                        self.cancel();\r\n                    };\r\n                    self.pointDraw\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    self.lineDraw\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    self.polygonDraw\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    if (self.options.modes && $.isArray(self.options.modes) && self.options.modes.length == 1) {\r\n                        self.setMode(self.options.modes[0], null);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n        //self.miEvent = map.on(TC.Consts.event.FEATURESADD + \".HasFeatures\", function (e) {\r\n        //    if (e.layer == self.layer) {\r\n        //        self.miEvent = map.off(TC.Consts.event.FEATURESADD + \".HasFeatures\");\r\n        //    }\r\n        //});\r\n\r\n        //if (!self.layer || self.layer.features.length==0)\r\n        //self._$resetBtn.prop('disabled', true);\r\n        //self._deleteBtn.disabled = true;\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        var self = this;\r\n        var editLayers = [];\r\n        if (self.map) {\r\n            for (var i = 0, len = self.map.workLayers.length; i < len; i++) {\r\n                var wl = self.map.workLayers[i];\r\n                if (wl.type === TC.Consts.layerType.WFS && !wl.options.stealth) {\r\n                    editLayers.push({\r\n                        id: wl.id,\r\n                        title: wl.title || wl.id\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        return self._set1stRenderPromise(TC.Control.prototype.renderData.call(self, { layers: editLayers, showChanges: self.showChanges }, function () {\r\n\r\n            self._layerDiv = self.div.querySelector(self._classSelector + '-layer');\r\n            self._layerSelect = self._layerDiv.querySelector(self._classSelector + '-layer-sel');\r\n            self._layerSelect.addEventListener('change', function (e) {\r\n                self.setLayer(self._layerSelect.value);\r\n            });\r\n\r\n            self._layerDiv.querySelector('#' + self.CLASS + '-view-changes-cb').addEventListener('change', function (e) {\r\n                self.showChanges(e.target.checked);\r\n            });\r\n\r\n            //self._$len = self._$div.find(self._classSelector + '-val-len');\r\n            //self._$area = self._$div.find(self._classSelector + '-val-area');\r\n            //self._$peri = self._$div.find(self._classSelector + '-val-peri');\r\n\r\n            self._cancelBtn = self.div.querySelector(self._classSelector + '-btn-cancel');\r\n            self._cancelBtn.addEventListener('click', function () {\r\n                self.cancel();\r\n            });\r\n\r\n            self._deleteBtn = self.div.querySelector(self._classSelector + '-btn-delete');\r\n            self._deleteBtn.addEventListener('click', function () {\r\n                TC.confirm(self.eraseActionConfirmTxt, function () {\r\n                    self.deleteFeatures(self.getSelectedFeatures());\r\n                });\r\n            });\r\n            self._joinBtn = self.div.querySelector(self._classSelector + '-btn-join');\r\n            self._joinBtn.addEventListener('click', function () {\r\n                self.joinFeatures(self.getSelectedFeatures());\r\n            });\r\n            self._splitBtn = self.div.querySelector(self._classSelector + '-btn-split');\r\n            self._splitBtn.addEventListener('click', function () {\r\n                self.splitFeatures(self.getSelectedFeatures());\r\n            });\r\n            self._saveBtn = self.div.querySelector(self._classSelector + '-btn-save');\r\n            self._saveBtn.addEventListener('click', function () {\r\n                self.applyEdits();\r\n            });\r\n            self._discardBtn = self.div.querySelector(self._classSelector + '-btn-discard');\r\n            self._discardBtn.addEventListener('click', function () {\r\n                self.discardEdits();\r\n            });\r\n            //control de renderizado enfunción del modo de edicion        \r\n            if (self.options.modes && $.isArray(self.options.modes) && self.options.modes.length > 0) {\r\n                for (var m in TC.Consts.editMode)\r\n                    if (typeof m === 'string' && self.options.modes.indexOf(TC.Consts.editMode[m]) < 0) {\r\n                        const label = self.div.querySelector(\"label\" + self._classSelector + \"-btn-\" + TC.Consts.editMode[m]);\r\n                        label.parentElement.removeChild(label);\r\n                        const div = self.div.querySelector(\"div\" + self._classSelector + \"-\" + TC.Consts.editMode[m]);\r\n                        div.parentElement.removeChild(div);\r\n                    }\r\n                if (self.options.modes.length === 1) {\r\n                    var mode = self.options.modes[0];\r\n                    self.div.querySelector(\"label\" + self._classSelector + \"-btn-\" + mode).style.display = 'none';\r\n                }\r\n\r\n\r\n            }\r\n            self.div.querySelectorAll('input[type=radio][name=mode]').forEach(function (radio) {\r\n                radio.addEventListener('change', function () {\r\n                    var newMode = this.value;\r\n                    var mode = self.mode === newMode ? undefined : newMode;\r\n                    self.setMode(mode);\r\n                });\r\n            });\r\n\r\n            if ($.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.setLayer = function (layer) {\r\n        var self = this;\r\n        self.layer = map.getLayer(layer);\r\n        self.setMode(null);\r\n        var rbSelector = 'input[type=radio][name=mode]';\r\n        if (self.layer) {\r\n            addChangesLayer(self, self.layer).then(function (changesLayer) {\r\n                for (var key in self._changesLayers) {\r\n                    var cl = self._changesLayers[key];\r\n                    cl.setVisibility(self._showsChanges && cl === changesLayer);\r\n                }\r\n            });\r\n\r\n            self.layer.describeFeatureType().then(function (attributes) {\r\n                // recogemos los atributos no geométricos y definimos la geometría\r\n                self.attributes = attributes.filter(function (elm) {\r\n                    switch (elm.type) {\r\n                        case 'gml:LinearRingPropertyType':\r\n                        case 'gml:PolygonPropertyType':\r\n                            self.geometryType = TC.Consts.geom.POLYGON;\r\n                            return false;\r\n                        case 'gml:MultiPolygonPropertyType':\r\n                        case 'gml:MultiSurfacePropertyType':\r\n                            self.geometryType = TC.Consts.geom.MULTIPOLYGON;\r\n                            return false;\r\n                        case 'gml:LineStringPropertyType':\r\n                            self.geometryType = TC.Consts.geom.POLYLINE;\r\n                            return false;\r\n                        case 'gml:MultiLineStringPropertyType':\r\n                            self.geometryType = TC.Consts.geom.MULTIPOLYLINE;\r\n                            return false;\r\n                        case 'gml:PointPropertyType':\r\n                        case 'gml:MultiPointPropertyType':\r\n                            self.geometryType = TC.Consts.geom.POINT;\r\n                            return false;\r\n                        case 'gml:BoxPropertyType':\r\n                            self.geometryType = TC.Consts.geom.RECTANGLE;\r\n                            return false;\r\n                        case 'gml:GeometryCollectionPropertyType':\r\n                        case 'gml:GeometryAssociationType':\r\n                            return false;\r\n                        default:\r\n                            return true;\r\n                    }\r\n                });\r\n                for (var i = 0, len = self.attributes.length; i < len; i++) {\r\n                    var attr = self.attributes[i];\r\n                    attr.type = attr.type.substr(attr.type.indexOf(':') + 1);\r\n                }\r\n                self.renderPromise().then(function () {\r\n                    setChangedState(self);\r\n                    self.div.querySelector(self._classSelector + '-layer-sel').value = self.layer.id;\r\n\r\n                    const rbList = self.div.querySelectorAll(rbSelector);\r\n                    var selector;\r\n                    switch (self.geometryType) {\r\n                        case TC.Consts.geom.POINT:\r\n                            selector = '[value=select],[value=' + TC.Consts.editMode.ADDPOINT + ']';\r\n                            break;\r\n                        case TC.Consts.geom.POLYLINE:\r\n                        case TC.Consts.geom.MULTIPOLYLINE:\r\n                            selector = '[value=select],[value=' + TC.Consts.editMode.ADDLINE + ']';\r\n                            break;\r\n                        case TC.Consts.geom.POLYGON:\r\n                        case TC.Consts.geom.MULTIPOLYGON:\r\n                            selector = '[value=select],[value=' + TC.Consts.editMode.ADDPOLYGON + ']';\r\n                            break;\r\n                        default:\r\n                            selector = '[value]'\r\n                            break;\r\n                    }\r\n                    rbList.forEach(function (rb) {\r\n                        rb.disabled = !rb.matches(selector);\r\n                    });\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            self.renderPromise().then(function () {\r\n                setChangedState(self, false);\r\n                const rbList = self.div.querySelectorAll(rbSelector);\r\n                rbList.forEach(function (rb) {\r\n                    rb.disabled = true;\r\n                    rb.checked = false;\r\n                });\r\n            });\r\n            self.layer = null;\r\n        }\r\n    };\r\n\r\n    ctlProto.setMode = function (mode) {\r\n        var self = this;\r\n        self.mode = mode;\r\n        setFeatureSelectReadyState(self);\r\n\r\n        var activateDraw = function (draw) {\r\n            if (draw) {\r\n                if (self.snapping) {\r\n                    draw.snapping = self.layer;\r\n                }\r\n                draw.activate();\r\n            }\r\n        };\r\n\r\n        var active;\r\n        var hiddenList;\r\n        switch (mode) {\r\n            case TC.Consts.editMode.SELECT:\r\n                active = self.div.querySelector(self._classSelector + '-select');\r\n                hiddenList = self.div.querySelectorAll(self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-polygon');\r\n                self.activate();\r\n                break;\r\n            case TC.Consts.editMode.ADDPOINT:\r\n                active = self.div.querySelector(self._classSelector + '-point');\r\n                hiddenList = self.div.querySelectorAll(self._classSelector + '-select,' + self._classSelector + '-line,' + self._classSelector + '-polygon');\r\n                activateDraw(self.pointDraw);\r\n                break;\r\n            case TC.Consts.editMode.ADDLINE:\r\n                active = self.div.querySelector(self._classSelector + '-line');\r\n                hiddenList = self.div.querySelectorAll(self._classSelector + '-select,' + self._classSelector + '-point,' + self._classSelector + '-polygon');\r\n                activateDraw(self.lineDraw);\r\n                break;\r\n            case TC.Consts.editMode.ADDPOLYGON:\r\n                active = self.div.querySelector(self._classSelector + '-polygon');\r\n                hiddenList = self.div.querySelectorAll(self._classSelector + '-select,' + self._classSelector + '-point,' + self._classSelector + '-line');\r\n                activateDraw(self.polygonDraw);\r\n                break;\r\n            default:\r\n                active = null;\r\n                hiddenList = self.div.querySelectorAll(self._classSelector + '-select,' + self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-polygon');\r\n                if (self.isActive) {\r\n                    self.deactivate();\r\n                }\r\n                if (self.pointDraw && self.pointDraw.isActive) {\r\n                    self.pointDraw.deactivate();\r\n                }\r\n                if (self.lineDraw && self.lineDraw.isActive) {\r\n                    self.lineDraw.deactivate();\r\n                }\r\n                if (self.polygonDraw && self.polygonDraw.isActive) {\r\n                    self.polygonDraw.deactivate();\r\n                }\r\n                break;\r\n        }\r\n\r\n        // Class TC.Consts.classes.CHECKED is for IE8 support\r\n        var radio;\r\n        if (mode) {\r\n            const radio = self.div.querySelector('input[type=radio][name=mode][value=' + mode + ']');\r\n            radio.checked = true;\r\n            radio.classList.add(TC.Consts.classes.CHECKED);\r\n            radio.nextSibling.classList.add(TC.Consts.classes.CHECKED);\r\n        }\r\n        else {\r\n            self.div.querySelectorAll('input[type=radio][name=mode]').forEach(function (radio) {\r\n                radio.checked = false;\r\n                radio.classList.remove(TC.Consts.classes.CHECKED);\r\n                radio.nextSibling.classList.remove(TC.Consts.classes.CHECKED);\r\n            });\r\n        }\r\n        if (active) {\r\n            active.classList.remove(TC.Consts.classes.HIDDEN);\r\n        }\r\n        hiddenList.forEach(function (hidden) {\r\n            hidden.classList.add(TC.Consts.classes.HIDDEN);\r\n        });\r\n    };\r\n\r\n    ctlProto.showChanges = function (show) {\r\n        var self = this;\r\n        self._showsChanges = show;\r\n        for (var key in self._changesLayers) {\r\n            var cl = self._changesLayers[key];\r\n            cl.setVisibility(show && self.layer && key === self.layer.id);\r\n        }\r\n    };\r\n\r\n    ctlProto.cancel = function () {\r\n        var self = this;\r\n        if (self.options.modes && $.isArray(self.options.modes) && self.options.modes.length == 1) {\r\n            self.setMode(self.options.modes[0], null);\r\n        }\r\n        else {\r\n            self.setMode(null, false);\r\n        }\r\n        self.wrap.cancel(true, self.cancelActionConfirmTxt);\r\n    };\r\n\r\n    ctlProto.onFeatureClick = function (e) {\r\n        if (!self.activeControl || !self.activeControl.isExclusive()) {\r\n            e.feature.show();\r\n        }\r\n    };\r\n    \r\n    ctlProto.activate = function (options) {\r\n        //window.meas.deactivate();\r\n        var self = this;\r\n        TC.Control.prototype.activate.call(self);\r\n        var opts = options || {};\r\n        self._cancelBtn.disabled = false;\r\n        self.wrap.activate(opts.mode ? opts.mode : self.mode);\r\n        TC.Control.prototype.activate.call(self);\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        var self = this;\r\n        TC.Control.prototype.deactivate.call(self);\r\n        //self.features = {\r\n        //    added: []\r\n        //    , removed: []\r\n        //};\r\n        self.wrap.cancel(true);\r\n        self._cancelBtn.disabled = true;\r\n        self.wrap.deactivate();\r\n    };\r\n\r\n    ctlProto.isExclusive = function () {\r\n        return true;\r\n    };\r\n\r\n    ctlProto.joinFeatures = function (features) {\r\n        var self = this;\r\n        if (self.geometryType === TC.Consts.geom.MULTIPOLYLINE ||\r\n            self.geometryType === TC.Consts.geom.MULTIPOLYGON ||\r\n            self.geometryType === TC.Consts.geom.MULTIPOINT) {\r\n            self._joinedFeatureAttributes = [];\r\n            if (features.length > 1) {\r\n                var geometries = features.map(function (elm) {\r\n                    self._joinedFeatureAttributes[self._joinedFeatureAttributes.length] = elm.getData();\r\n                    return elm.geometry;\r\n                });\r\n                var newGeometry = geometries.reduce(function (a, b) {\r\n                    return a.concat(b);\r\n                });\r\n                var newFeature = new features[0].constructor(newGeometry);\r\n                for (var i = 0, len = features.length; i < len; i++) {\r\n                    var feature = features[i];\r\n                    self.layer.removeFeature(feature);\r\n                    self.trigger(TC.Consts.event.FEATUREREMOVE, { feature: feature });\r\n                }\r\n                self.layer.addFeature(newFeature).then(function (feat) {\r\n                    self.setSelectedFeatures([newFeature]);\r\n                    self.trigger(TC.Consts.event.FEATUREADD, { feature: feat });\r\n                    feat.showPopup(self.attributeEditor);\r\n                });\r\n            }\r\n            setFeatureSelectedState(self, [newFeature]);\r\n        }\r\n    };\r\n\r\n    ctlProto.splitFeatures = function (features) {\r\n        var self = this;\r\n        var complexFeatures = features.filter(complexGeometryFilter);\r\n        var geometries = complexFeatures.map(function (elm) {\r\n            return elm.geometry;\r\n        });\r\n        var newFeatures = [];\r\n        for (var i = 0, ii = complexFeatures.length; i < ii; i++) {\r\n            var feature = complexFeatures[i];\r\n            var data = feature.getData();\r\n            var geometry = geometries[i];\r\n            for (var j = 0, jj = geometry.length; j < jj; j++) {\r\n                newFeatures[newFeatures.length] = new feature.constructor([geometry[j]], { data: data });\r\n            }\r\n        }\r\n        for (var i = 0, len = complexFeatures.length; i < len; i++) {\r\n            var feature = complexFeatures[i];\r\n            self.layer.removeFeature(feature);\r\n            self.trigger(TC.Consts.event.FEATUREREMOVE, { feature: feature });\r\n        }\r\n        var newFeatPromises = new Array(newFeatures.length);\r\n        for (var i = 0, len = newFeatures.length; i < len; i++) {\r\n            const promise = newFeatPromises[i] = self.layer.addFeature(newFeatures[i]);\r\n            promise.then(function (feat) {\r\n                self.trigger(TC.Consts.event.FEATUREADD, { feature: feat });\r\n            });\r\n        }\r\n        Promise.all(newFeatPromises).then(function() {\r\n            self.setSelectedFeatures(newFeatures);\r\n        });\r\n        setFeatureSelectedState(self, newFeatures);\r\n    };\r\n\r\n    ctlProto.deleteFeatures = function (features) {\r\n        var self = this;\r\n        self.wrap.deleteFeatures(features);\r\n        if (self.layer.features.length === 0) {\r\n            self._deleteBtn.disabled = true;\r\n        }\r\n    };\r\n\r\n    ctlProto.applyEdits = function () {\r\n        var self = this;\r\n        if (self.layer) {\r\n            var features = self.features[self.layer.id];\r\n            self.layer.applyEdits(features.added, features.modified, features.removed).then(function () {\r\n                // Las acciones a realizar a partir de este punto son las mismas que al descartar una edición\r\n                self.discardEdits();\r\n                self.map.toast('Cambios sincronizados con éxito con el servidor');\r\n            },\r\n            function (obj) {\r\n                TC.error(\"Error [\" + obj.code + \"] al guardar cambios: \" + obj.reason);\r\n            });\r\n        }\r\n    };\r\n\r\n    ctlProto.discardEdits = function () {\r\n        var self = this;\r\n        self._joinedFeatureAttributes = [];\r\n        var storagePrefix = getStoragePrefix(self);\r\n        TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n            localforage.keys().then(function (keys) {\r\n                if (keys) {\r\n                    for (var i = 0, len = keys.length; i < len; i++) {\r\n                        var key = keys[i];\r\n                        if (key.indexOf(storagePrefix) === 0) {\r\n                            localforage.removeItem(key);\r\n                        }\r\n                    }\r\n                    if (self.layer) {\r\n                        var features = self.features[self.layer.id];\r\n                        features.added.length = 0;\r\n                        features.modified.length = 0;\r\n                        features.removed.length = 0;\r\n                        self.setSelectedFeatures([]);\r\n                        self.attributeEditor.hide();\r\n                        var changesLayer = self._changesLayers[self.layer.id];\r\n                        changesLayer.clearFeatures();\r\n                        self.deleteCache(storagePrefix).then(function () {\r\n                            self.layer.refresh();\r\n                        });\r\n                    }\r\n                    setChangedState(self, false);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    //ctlProto.setFeature = function (feature) {\r\n    //    var self = this;\r\n    //    self.feature = feature;\r\n    //}\r\n\r\n    ctlProto.getSelectedFeatures = function () {\r\n        return this.wrap.getSelectedFeatures();\r\n    };\r\n\r\n    ctlProto.setSelectedFeatures = function (features) {\r\n        return this.wrap.setSelectedFeatures(features);\r\n    };\r\n\r\n    ctlProto.getLayer = function () {\r\n        var self = this;\r\n        return self.layer;\r\n    };\r\n\r\n    ctlProto.getChangesLayerStyle = function (layer) {\r\n        var getNegativeColor = function (color) {\r\n            var str;\r\n            var rgba = layer.wrap.getRGBA(color);\r\n            for (var i = 0; i < 3; i++) {\r\n                rgba[i] = 255 - rgba[i];\r\n            }\r\n            str = (rgba[0] * 65536 + rgba[1] * 256 + rgba[2]).toString(16);\r\n            if (str.length === 4) {\r\n                str = '00' + str;\r\n            }\r\n            else if (str.length === 5) {\r\n                str = '0' + str;\r\n            }\r\n            return '#' + str;\r\n        };\r\n\r\n        var dash = [1, 3];\r\n        var result = $.extend(true, {}, layer.options.styles);\r\n        if (result.point) {\r\n            result.point.strokeColor = getNegativeColor(result.point.strokeColor);\r\n            result.point.lineDash = dash;\r\n        }\r\n        if (result.line) {\r\n            result.line.strokeColor = getNegativeColor(result.line.strokeColor);\r\n            result.line.lineDash = dash;\r\n        }\r\n        if (result.polygon) {\r\n            result.polygon.strokeColor = getNegativeColor(result.polygon.strokeColor);\r\n            result.polygon.lineDash = dash;\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n})();"],"file":"../../Control/Edit.min.js"}