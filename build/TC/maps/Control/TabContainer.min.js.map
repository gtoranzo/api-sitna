{"version":3,"sources":["control/TabContainer.js"],"names":["TC","control","Container","syncLoadJS","apiLocation","TabContainer","apply","this","arguments","cs","_classSelector","CLASS","_selectors","TAB","RADIOBUTTON","ELEMENT","inherit","ctlProto","prototype","template","dust","register","body_0","chk","ctx","w","f","get","s","block","body_1","body_2","__dustBody","onRenderPromise","self","title","getLocaleString","options","div","querySelector","innerHTML","bufferPromises","Array","ctlCount","i","len","controlOptions","length","ctl","ctlName","ctlOptions","undefined","console","log","Object","keys","filter","key","map","addControl","Util","extend","id","uids","writeTitle","idx","renderPromise","then","parent","parentElement","matches","Promise","all","controls","containerControl","render","callback","_set1stRenderPromise","renderData","clickHandler","e","closest","active","hidden","checkbox","newValue","value","elms","querySelectorAll","_oldValue","deselectable","setTimeout","checked","forEach","elm","push","classList","contains","Consts","classes","COLLAPSED","remove","MutationObserver","mutations","mutation","target","observe","attributes","HIDDEN","add","span","addEventListener","event","CLICK","defaultSelection","call"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.Container) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control/Container');\r\n}\r\n\r\nTC.control.TabContainer = function () {\r\n    var self = this;\r\n\r\n    TC.control.Container.apply(self, arguments);\r\n\r\n    var cs = self._classSelector = '.' + self.CLASS;\r\n    self._selectors = {\r\n        TAB: cs + '-tab',\r\n        RADIOBUTTON: 'input[type=radio][name=sctnr-sel]',\r\n        ELEMENT: cs + '-elm'\r\n    };    \r\n};\r\n\r\nTC.inherit(TC.control.TabContainer, TC.control.Container);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.TabContainer.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-tctr';\r\n\r\n    ctlProto.template = TC.apiLocation + \"TC/templates/TabContainer.html\";\r\n\r\n    ctlProto.onRenderPromise = function () {\r\n        const self = this;\r\n\r\n        self.title = self.title || self.getLocaleString(self.options.title || 'moreControls');\r\n        self.div.querySelector('h2').innerHTML = self.title;\r\n\r\n        var bufferPromises = new Array(self.ctlCount);\r\n        for (var i = 0, len = self.controlOptions.length; i < len; i++) {\r\n            var ctl = self.controlOptions[i];\r\n            var ctlName = \"\";\r\n            var ctlOptions = {};\r\n\r\n            // GLS: 20/01/2020 código compatibilidad hacia atrás\r\n            if (ctl[\"name\"] !== undefined && ctl[\"options\"] !== undefined) {\r\n                console.log('Gestionamos config de tabContainer antiguo');\r\n\r\n                ctlName = ctl[\"name\"];\r\n                ctlOptions = ctl[\"options\"];\r\n            } else {\r\n                ctlName = Object.keys(ctl).filter((key) => {\r\n                    return key !== \"title\";\r\n                })[0];\r\n                ctlOptions = ctl[ctlName];\r\n            }\r\n            \r\n            bufferPromises[i] = self.map.addControl(ctlName, TC.Util.extend({\r\n                id: self.uids[i],\r\n                div: self.div.querySelector('.' + self.CLASS + '-elm-' + i)\r\n            }, ctlOptions));\r\n        }\r\n        var writeTitle = function (ctl, idx) {\r\n            ctl.renderPromise().then(function () {\r\n                const title = self.getLocaleString(self.controlOptions[idx].title) || ctl.div.querySelector('h2').innerHTML;\r\n                var parent = ctl.div;\r\n                do {\r\n                    parent = parent.parentElement;\r\n                }\r\n                while (parent && !parent.matches(self._classSelector));\r\n                parent.querySelector(self._selectors.TAB + '-' + idx + ' span').innerHTML = title;\r\n            });\r\n        };\r\n        Promise.all(bufferPromises).then(function (controls) {\r\n            for (var i = 0, len = controls.length; i < len; i++) {\r\n                var ctl = controls[i];\r\n                ctl.containerControl = self;\r\n                writeTitle(ctl, i);                \r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self._set1stRenderPromise(self.renderData({ title: self.title, controls: self.controlOptions }, function () {\r\n\r\n            var clickHandler = function (e) {\r\n                var closest = this;\r\n                while (closest && !closest.matches(self._selectors.TAB)) {\r\n                    closest = closest.parentElement;\r\n                }\r\n                var active, hidden = [];\r\n                const checkbox = closest.querySelector(self._selectors.RADIOBUTTON);\r\n                const newValue = checkbox.value;\r\n                const elms = self.div.querySelectorAll(self._selectors.ELEMENT);\r\n                if (self._oldValue === newValue && self.options.deselectable) {\r\n                    setTimeout(function () {\r\n                        checkbox.checked = false;\r\n                    }, 0);\r\n                    self._oldValue = null;\r\n                    active = null;\r\n                    hidden = elms;\r\n                }\r\n                else {\r\n                    elms.forEach(function (elm) {\r\n                        if (elm.matches(self._selectors.ELEMENT + '-' + newValue)) {\r\n                            active = elm;\r\n                        }\r\n                        else {\r\n                            hidden.push(elm);\r\n                        }\r\n                    });\r\n                    self._oldValue = newValue;\r\n                }\r\n\r\n                if (active && active.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                    active.classList.remove(TC.Consts.classes.COLLAPSED);\r\n\r\n                    // GLS 24/01/2020 necesitamos un mutation observer para poder quitar el tc.collapsed cuando volvamos de  \r\n                    // otro control ya que no hay click porque la pestaña ya está activa.\r\n                    var observerTabElementAddCollapsedClass = new MutationObserver(function (mutations) {                        \r\n                        mutations.forEach(function (mutation) {\r\n                            if (mutation.target.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                                mutation.target.classList.remove(TC.Consts.classes.COLLAPSED);\r\n                            }\r\n                        });\r\n                    });\r\n                    \r\n                    observerTabElementAddCollapsedClass.observe(active, { attributes: true });                    \r\n                }\r\n\r\n                if (active) {\r\n                    active.classList.remove(TC.Consts.classes.HIDDEN);\r\n                }\r\n                hidden.forEach(function (elm) {\r\n                    elm.classList.add(TC.Consts.classes.HIDDEN);\r\n                });\r\n                checkbox.checked = true;\r\n            };\r\n\r\n            self.div.querySelectorAll('span').forEach(function (span) {\r\n                span.addEventListener(TC.Consts.event.CLICK, clickHandler);\r\n            });\r\n\r\n            // GLS: Si en el register de control se llama a render, ¿por qué volvemos a llamarlo aquí?\r\n            //for (var i = 0, len = self._ctlPromises.length; i < len; i++) {\r\n            //    self.getControl(i).then(function (ctl) {\r\n            //        ctl.render();\r\n            //    });\r\n            //}\r\n\r\n            if (typeof self.defaultSelection === 'number') {\r\n                clickHandler.call(self.div.querySelectorAll(self._selectors.RADIOBUTTON)[self.defaultSelection]);\r\n            }\r\n        }));\r\n    };\r\n\r\n})();\r\n"]}