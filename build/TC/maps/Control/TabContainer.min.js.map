{"version":3,"sources":["control/TabContainer.js"],"names":["TC","control","Container","syncLoadJS","apiLocation","TabContainer","apply","this","arguments","cs","_classSelector","CLASS","_selectors","TAB","RADIOBUTTON","ELEMENT","inherit","ctlProto","prototype","isDebug","template","dust","register","body_0","chk","ctx","w","f","get","s","block","body_1","body_2","__dustBody","onRenderPromise","self","title","getLocaleString","options","div","querySelector","innerHTML","bufferPromises","Array","ctlCount","i","len","controlOptions","length","ctl","map","addControl","name","$","extend","id","uids","writeTitle","idx","renderPromise","then","parent","parentElement","matches","Promise","all","controls","containerControl","render","callback","_set1stRenderPromise","renderData","clickHandler","e","closest","active","hidden","checkbox","newValue","value","elms","querySelectorAll","_oldValue","deselectable","setTimeout","checked","forEach","elm","push","classList","remove","Consts","classes","HIDDEN","add","span","addEventListener","event","CLICK","defaultSelection","call"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.Container) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control/Container');\r\n}\r\n\r\nTC.control.TabContainer = function () {\r\n    var self = this;\r\n\r\n    TC.control.Container.apply(self, arguments);\r\n\r\n    var cs = self._classSelector = '.' + self.CLASS;\r\n    self._selectors = {\r\n        TAB: cs + '-tab',\r\n        RADIOBUTTON: 'input[type=radio][name=sctnr-sel]',\r\n        ELEMENT: cs + '-elm'\r\n    };    \r\n};\r\n\r\nTC.inherit(TC.control.TabContainer, TC.control.Container);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.TabContainer.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-tctr';\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template = TC.apiLocation + \"TC/templates/TabContainer.html\";\r\n    }\r\n    else {\r\n        ctlProto.template = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<h2>\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</h2><div class=\\\"tc-ctl-tctr-select\\\"><form>\").s(ctx.get([\"controls\"], false), ctx, { \"block\": body_1 }, {}).w(\"</form></div>\").s(ctx.get([\"controls\"], false), ctx, { \"block\": body_2 }, {}); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<label class=\\\"tc-ctl-tctr-tab tc-ctl-tctr-tab-\").f(ctx.get([\"$idx\"], false), ctx, \"h\").w(\"\\\" style=\\\"width:calc(100%/\").f(ctx.get([\"$len\"], false), ctx, \"h\").w(\" - 1px)\\\"><input type=\\\"radio\\\" name=\\\"sctnr-sel\\\" value=\\\"\").f(ctx.get([\"$idx\"], false), ctx, \"h\").w(\"\\\" /><span>\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</span></label>\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\"<div class=\\\"tc-ctl-tctr-elm tc-ctl-tctr-elm-\").f(ctx.get([\"$idx\"], false), ctx, \"h\").w(\" tc-hidden\\\"></div>\"); } body_2.__dustBody = !0; return body_0 };\r\n    }\r\n\r\n    ctlProto.onRenderPromise = function () {\r\n        const self = this;\r\n\r\n        self.title = self.title || self.getLocaleString(self.options.title || 'moreControls');\r\n        self.div.querySelector('h2').innerHTML = self.title;\r\n\r\n        var bufferPromises = new Array(self.ctlCount);\r\n        for (var i = 0, len = self.controlOptions.length; i < len; i++) {\r\n            var ctl = self.controlOptions[i];\r\n            bufferPromises[i] = self.map.addControl(ctl.name, $.extend({\r\n                id: self.uids[i],\r\n                div: self.div.querySelector('.' + self.CLASS + '-elm-' + i)\r\n            }, ctl.options));\r\n        }\r\n        var writeTitle = function (ctl, idx) {\r\n            ctl.renderPromise().then(function () {\r\n                const title = self.getLocaleString(self.controlOptions[idx].title) || ctl.div.querySelector('h2').innerHTML;\r\n                var parent = ctl.div;\r\n                do {\r\n                    parent = parent.parentElement;\r\n                }\r\n                while (parent && !parent.matches(self._classSelector));\r\n                parent.querySelector(self._selectors.TAB + '-' + idx + ' span').innerHTML = title;\r\n            });\r\n        };\r\n        Promise.all(bufferPromises).then(function (controls) {\r\n            for (var i = 0, len = controls.length; i < len; i++) {\r\n                var ctl = controls[i];\r\n                ctl.containerControl = self;\r\n                writeTitle(ctl, i);                \r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self._set1stRenderPromise(self.renderData({ title: self.title, controls: self.controlOptions }, function () {\r\n\r\n            var clickHandler = function (e) {\r\n                var closest = this;\r\n                while (closest && !closest.matches(self._selectors.TAB)) {\r\n                    closest = closest.parentElement;\r\n                }\r\n                var active, hidden = [];\r\n                const checkbox = closest.querySelector(self._selectors.RADIOBUTTON);\r\n                const newValue = checkbox.value;\r\n                const elms = self.div.querySelectorAll(self._selectors.ELEMENT);\r\n                if (self._oldValue === newValue && self.options.deselectable) {\r\n                    setTimeout(function () {\r\n                        checkbox.checked = false;\r\n                    }, 0);\r\n                    self._oldValue = null;\r\n                    active = null;\r\n                    hidden = elms;\r\n                }\r\n                else {\r\n                    elms.forEach(function (elm) {\r\n                        if (elm.matches(self._selectors.ELEMENT + '-' + newValue)) {\r\n                            active = elm;\r\n                        }\r\n                        else {\r\n                            hidden.push(elm);\r\n                        }\r\n                    });\r\n                    self._oldValue = newValue;\r\n                }\r\n\r\n                if (active) {\r\n                    active.classList.remove(TC.Consts.classes.HIDDEN);\r\n                }\r\n                hidden.forEach(function (elm) {\r\n                    elm.classList.add(TC.Consts.classes.HIDDEN);\r\n                });\r\n                checkbox.checked = true;\r\n            };\r\n\r\n            self.div.querySelectorAll('span').forEach(function (span) {\r\n                span.addEventListener(TC.Consts.event.CLICK, clickHandler);\r\n            });\r\n\r\n            // GLS: Si en el register de control se llama a render, ¿por qué volvemos a llamarlo aquí?\r\n            //for (var i = 0, len = self._ctlPromises.length; i < len; i++) {\r\n            //    self.getControl(i).then(function (ctl) {\r\n            //        ctl.render();\r\n            //    });\r\n            //}\r\n\r\n            if (typeof self.defaultSelection === 'number') {\r\n                clickHandler.call(self.div.querySelectorAll(self._selectors.RADIOBUTTON)[self.defaultSelection]);\r\n            }\r\n        }));\r\n    };\r\n\r\n})();\r\n"],"file":"../../control/TabContainer.min.js"}