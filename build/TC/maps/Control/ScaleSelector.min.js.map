{"version":3,"sources":["control/ScaleSelector.js"],"names":["TC","control","Scale","syncLoadJS","apiLocation","ScaleSelector","apply","this","arguments","scales","inherit","ctlProto","prototype","CLASS","isDebug","template","dust","register","body_0","chk","ctx","w","s","get","block","body_1","f","h","$key","__dustBody","getPath","body_2","key","body_3","value","body_4","body_5","method","render","callback","self","_set1stRenderPromise","Promise","resolve","reject","map","options","resolutions","getScale","wrap","getResolutions","renderData","scale","screenSize","Cfg","div","querySelectorAll","forEach","option","textContent","format","substr","querySelector","addEventListener","Consts","event","CLICK","setScreenSize","setScale","Util","isFunction","catch","err","Error","getMap","then","result","getDpi","window","devicePixelRatio","metersPerDegree","setResolution"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.Scale) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/Scale');\r\n}\r\n\r\nTC.control.ScaleSelector = function () {\r\n    var self = this;\r\n\r\n    TC.control.Scale.apply(self, arguments);\r\n\r\n    self.scales = null;\r\n};\r\n\r\nTC.inherit(TC.control.ScaleSelector, TC.control.Scale);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.ScaleSelector.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-ss';\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template = TC.apiLocation + \"TC/templates/ScaleSelector.html\";\r\n    }\r\n    else {\r\n        ctlProto.template = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<div class=\\\"ol-scale-line ol-unselectable\\\"><nobr><select>\").s(ctx.get([\"scales\"], false), ctx, { \"block\": body_1 }, {}).w(\"</select> <input type=\\\"button\\\" value=\\\"\").f(ctx.get([\"screenSize\"], false), ctx, \"h\").w(\"''\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"estimatedMapSize\" }).w(\"\\\" /></nobr></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<option value=\\\"\").f(ctx.getPath(true, []), ctx, \"h\").w(\"\\\"\").h(\"eq\", ctx, { \"block\": body_2 }, { \"key\": body_3, \"value\": body_4 }).w(\">1:\").h(\"math\", ctx, {}, { \"key\": body_5, \"method\": \"round\" }).w(\"</option>\\n\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\" selected=\\\"true\\\"\"); } body_2.__dustBody = !0; function body_3(chk, ctx) { return chk.f(ctx.getPath(true, []), ctx, \"h\"); } body_3.__dustBody = !0; function body_4(chk, ctx) { return chk.f(ctx.get([\"scale\"], false), ctx, \"h\"); } body_4.__dustBody = !0; function body_5(chk, ctx) { return chk.f(ctx.getPath(true, []), ctx, \"h\"); } body_5.__dustBody = !0; return body_0 };\r\n    }\r\n\r\n    ctlProto.render = function (callback) {\r\n        var self = this;\r\n        return self._set1stRenderPromise(new Promise(function (resolve, reject) {\r\n            if (self.map) {\r\n                if (!self.scales && self.map.options.resolutions) {\r\n                    self.scales = self.map.options.resolutions.map(self.getScale, self);\r\n                }\r\n                var render = function () {\r\n                    self.scales = self.map.wrap.getResolutions().map(self.getScale, self);\r\n                    self.renderData({ scale: self.getScale(), screenSize: TC.Cfg.screenSize, scales: self.scales }, function () {\r\n\r\n                        self.div.querySelectorAll('option').forEach(function (option) {\r\n                            option.textContent = '1:' + self.format(option.textContent.substr(2));\r\n                        });\r\n\r\n                        self.div.querySelector('input[type=\"button\"]').addEventListener(TC.Consts.event.CLICK, function () { self.setScreenSize(); });\r\n\r\n                        self.div.querySelector('select').addEventListener('change', function () {\r\n                            self.setScale(this.value);\r\n                        });\r\n                        if (TC.Util.isFunction(callback)) {\r\n                            callback();\r\n                        }\r\n                        resolve();\r\n                    }).catch(function (err) {\r\n                        reject(err instanceof Error ? err : Error(err));\r\n                    });\r\n                };\r\n                if (self.scales) {\r\n                    render();\r\n                }\r\n                else {\r\n                    self.map.wrap.getMap().then(render);\r\n                }\r\n            }\r\n            else {\r\n                reject(Error('ScaleSelector no registrado'));\r\n            }\r\n        }));\r\n    };\r\n\r\n    /*\r\n    *  setScale: Sets the resolution of the map from a scale denominator and estimated screen DPI\r\n    *  Parameters: number, the scale denominator\r\n    *  Returns: number, the resolution\r\n    */\r\n    ctlProto.setScale = function (scale) {\r\n        var self = this;\r\n        var result = scale * .0254 / self.getDpi(TC.Cfg.screenSize);\r\n        if (window.devicePixelRatio) {\r\n            result = result / window.devicePixelRatio;\r\n        }\r\n        if (self.metersPerDegree) {\r\n            result = result / self.metersPerDegree;\r\n        }\r\n        self.map.wrap.setResolution(result);\r\n        return result;\r\n    };\r\n\r\n})();"]}