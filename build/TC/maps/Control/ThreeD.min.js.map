{"version":3,"sources":["control/ThreeD.js"],"names":["TC","control","ThreeD","Control","apply","this","arguments","inherit","ctlProto","prototype","CLASS","classes","BETA","BTNACTIVE","template","isDebug","apiLocation","dust","register","body_0","chk","ctx","w","h","$key","__dustBody","map","self","result","call","on","Consts","event","VIEWCHANGE","e","view","THREED","activate","renderData","data","callback","button","div","querySelector","Number","isInteger","Util","detectIE","setAttribute","getLocaleString","classList","remove","addEventListener","CLICK","getAttribute","toast","type","msgType","ERROR","on3DView","unapply","removeAttribute","$","isFunction","browserSupportWebGL","removeDisabled","view3D","options","getRenderedHtml","loadJS","add","manageButton","deactivate","window","WebGLRenderingContext","canvas","document","createElement","webglOptions","alpha","stencil","failIfMajorPerformanceCaveat","gl","getContext","isSlower","console","log","E","warning","WARNING","duration"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\n(function () {\r\n\r\n    TC.control.ThreeD = function () {\r\n        var self = this;\r\n\r\n        TC.Control.apply(self, arguments);\r\n    };\r\n\r\n    TC.inherit(TC.control.ThreeD, TC.Control);\r\n\r\n    var ctlProto = TC.control.ThreeD.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-threed';\r\n    ctlProto.classes = {\r\n        BETA: 'tc-beta-button',\r\n        BTNACTIVE: 'active'\r\n    };\r\n\r\n    ctlProto.template = {};\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/ThreeD.html\";\r\n    }\r\n    else {\r\n        ctlProto.template[ctlProto.CLASS] = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<button class=\\\"tc-ctl-threed-btn tc-beta-button\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"threed.tip\" }).w(\"\\\"></button>\"); } body_0.__dustBody = !0; return body_0 };\r\n    }\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        map.on(TC.Consts.event.VIEWCHANGE, function (e) {\r\n            if (e.view == TC.Consts.view.THREED) { // cargamos la vista 3D desde el estado actualizamos el estado del bot√≥n\r\n                self.activate();\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.renderData = function (data, callback) {\r\n        const self = this;\r\n\r\n        return TC.Control.prototype.renderData.call(self, data, function () {\r\n            self.button = self.div.querySelector('.' + self.CLASS + '-btn');\r\n\r\n            if (Number.isInteger(TC.Util.detectIE()) && TC.Util.detectIE() < 12) {\r\n                self.button.setAttribute('title', self.getLocaleString(\"threed.not.supported\"));\r\n                self.button.classList.remove(self.classes.BETA);\r\n            }\r\n\r\n            self.button.addEventListener(TC.Consts.event.CLICK, function () {\r\n\r\n                if (self.button.getAttribute(\"disabled\") === \"disabled\") {\r\n                    return;\r\n                }\r\n\r\n                if (Number.isInteger(TC.Util.detectIE()) && TC.Util.detectIE() < 12) {\r\n                    self.map.toast(self.getLocaleString(\"threed.not.supported\"), { type: TC.Consts.msgType.ERROR });\r\n                } else {\r\n                    if (!self.map.on3DView) {\r\n                        self.activate();\r\n                    } else {\r\n                        self.button.setAttribute(\"disabled\", \"disabled\");\r\n\r\n                        TC.view.ThreeD.unapply({\r\n                            callback: function () {\r\n                                self.button.setAttribute('title', self.getLocaleString(\"threed.tip\"));\r\n\r\n                                self.button.classList.remove(self.classes.BTNACTIVE);\r\n\r\n                                self.button.removeAttribute(\"disabled\");\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            if ($.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.activate = function () {\r\n        var self = this;\r\n\r\n        self.button.setAttribute(\"disabled\", \"disabled\");\r\n\r\n        self.browserSupportWebGL.call(self);\r\n\r\n        const manageButton = function () {\r\n            self.button.setAttribute('title', self.getLocaleString('threed.two.tip'));\r\n            self.button.classList.remove(self.classes.BETA);\r\n\r\n            self.button.classList.add(self.classes.BTNACTIVE);\r\n        };\r\n\r\n        const removeDisabled = function () {\r\n            self.button.removeAttribute(\"disabled\");\r\n        };\r\n\r\n        if (!self.map.view3D) {\r\n            TC.loadJS(\r\n                !TC.view || !TC.view.ThreeD,\r\n                TC.apiLocation + 'TC/view/ThreeD',\r\n                function () {                                                           /* provisional */\r\n                    TC.view.ThreeD.apply({ map: self.map, options: self.options, getRenderedHtml: self.getRenderedHtml, callback: removeDisabled });\r\n                });\r\n        } else if (!self.map.on3DView) {                                               /* provisional */\r\n            TC.view.ThreeD.apply({ map: self.map, options: self.options, getRenderedHtml: self.getRenderedHtml, callback: removeDisabled });\r\n        }\r\n\r\n        manageButton();\r\n\r\n        //TC.Control.prototype.activate.call(self);\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        var self = this;\r\n\r\n        TC.Control.prototype.deactivate.call(self);\r\n    };\r\n\r\n    ctlProto.browserSupportWebGL = function () {\r\n        var self = this;\r\n        var result = false;\r\n\r\n        //Check for webgl support and if not, then fall back to leaflet\r\n        if (!window.WebGLRenderingContext) {\r\n            // Browser has no idea what WebGL is. Suggest they\r\n            // get a new browser by presenting the user with link to\r\n            // http://get.webgl.org\r\n            result = false;\r\n        } else {\r\n            var canvas = document.createElement('canvas');\r\n\r\n            var webglOptions = {\r\n                alpha: false,\r\n                stencil: false,\r\n                failIfMajorPerformanceCaveat: true\r\n            };\r\n\r\n            try {\r\n                var gl = canvas.getContext(\"webgl\", webglOptions) ||\r\n                    canvas.getContext(\"experimental-webgl\", webglOptions) ||\r\n                    canvas.getContext(\"webkit-3d\", webglOptions) ||\r\n                    canvas.getContext(\"moz-webgl\", webglOptions);\r\n                if (!gl) {\r\n                    // We couldn't get a WebGL context without a major performance caveat.  Let's see if we can get one at all.\r\n                    webglOptions.failIfMajorPerformanceCaveat = false;\r\n                    gl = canvas.getContext(\"webgl\", webglOptions) ||\r\n                        canvas.getContext(\"experimental-webgl\", webglOptions) ||\r\n                        canvas.getContext(\"webkit-3d\", webglOptions) ||\r\n                        canvas.getContext(\"moz-webgl\", webglOptions);\r\n                    if (!gl) {\r\n                        // No WebGL at all.\r\n                        result = false;\r\n                    } else {\r\n                        // We can do WebGL, but only with software rendering (or similar).\r\n                        result = 'slow';\r\n                        self.isSlower = true;\r\n                    }\r\n                } else {\r\n                    // WebGL is good to go!\r\n                    result = true;\r\n                }\r\n            } catch (e) {\r\n                console.log(E);\r\n            }\r\n\r\n            if (result === \"slow\" || !result) {\r\n                var warning = result === \"slow\" ? \"threed.slowSupport.supported\" : \"threed.not.supported\";\r\n                self.map.toast(self.getLocaleString(warning), {\r\n                    type: TC.Consts.msgType.WARNING,\r\n                    duration: 10000\r\n                });\r\n            }\r\n\r\n            return result;\r\n        }\r\n    };\r\n\r\n})();"],"file":"../../control/ThreeD.min.js"}