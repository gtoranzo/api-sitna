{"version":3,"sources":["control/WFSQuery.js"],"names":["TC","control","HTMLElement","prototype","appendHTML","html","d","document","createElement","innerHTML","childNodes","length","i","this","appendChild","firstChild","Document","createHTMLElement","empty","children","removeChild","Object","assign","defineProperty","value","target","varArgs","TypeError","to","index","arguments","nextSource","nextKey","hasOwnProperty","call","writable","configurable","Control","syncLoadJS","apiLocation","filter","WFSQuery","options","apply","styles","highLightStyles","inherit","ctlProto","modalBody","modalDialog","ctlResultsPanel","resultLayer","timer","Consts","logicalOperator","AND","autoCompletePromise","locale","filterByOperation","eq","equalTo","not","notEqualTo","gt","greaterThan","lt","lessThan","ge","greaterThanOrEqualTo","le","lessThanOrEqualTo","like","contains","start","end","bw","between","map","_currentLayer","_currentLayerName","_currentLayercapabilities","_currentLayerTitle","_currentLayerURL","_maxRecordCount","_getStyles","_getHighLightStyles","getLocaleString","CLASS","template","isDebug","dust","register","body_0","chk","ctx","w","f","get","h","$key","block","body_1","key","getPath","__dustBody","s","body_2","else","excludedKeys","body_3","on","x","checkInput","type","input","setAttribute","_renderQueryForm","args","layer","dialog","capabilities","Operations","DescribeFeatureType","DCP","HTTP","Get","GetFeature","CountDefault","DefaultValue","layers","getDisgregatedLayerNames","l","FeatureTypes","substring","indexOf","classList","remove","getElementsByClassName","addEventListener","querySelector","add","classes","HIDDEN","selectedIndex","text","_getDescribeFeature","then","data","_manageDescribeFeature","tbody","form","_clear","Title","layerName","Promise","resolve","reject","url","outputFormat","toolProxification","fetchXML","response","obj","xml2json","objLayer","complexContent","extension","sequence","catch","error","msgErrorMode","TOAST","dateInputMask","inputMaskNumber","_createDateMask","txtBox","setTimeout","loadJS","console","log","IMask","mask","Date","pattern","lazy","format","date","day","getDate","month","getMonth","year","getFullYear","join","parse","str","split","blocks","MaskedRange","from","maxLength","m","Y","_destroyDateMask","el","destroy","_internalGetDataTypes","getRenderedHtml","attributes","combo","removeAttribute","valueField","dataset","UI","autocomplete","destroyNumberMask","querySelectorAll","checked","Util","detectIE","Number","scale","signed","thousandsSeparator","padFractionalZeros","normalizeZeros","radix","step","_autocompleteConstructor","OR","nextElementSibling","masked","_validate","field","checkeOp","op","opText","innerText","unmaskedValue","valueToShow","toLocaleDateString","dotOrComma","toLocaleString","replace","_getValueToShow","matchCase","whereObjList","push","parseInt","parseFloat","whereFilterList","isString","_renderFiltersConditions","filters","numberSeparator","conditions","delBtnCollection","Array","splice","number","opcion","isComplete","test","_showMessage","msgType","ERROR","checkValidity","trim","_sendQuery","_validateQuery","_fncLoadVectorLayer","filtro","filterConstructor","_createResultPanel","cacheHost","getAction","action","setVisibility","clearFeatures","off","event","LAYERUPDATE","_featuresUpdate","featurePrefix","featureType","maxFeatures","properties","refresh","_createVectorLayer","id","layerType","WFS","version","stealth","geometryName","JSON","RESULTSPANELCLOSE","e","browserFeatures","touch","swipe","div","_numHits","err","limit","WARNING","INFO","errorThrown","layerOptions","addLayer","condicion","features","zoomToFeatures","_showResultPanel","reduce","vi","va","concat","_layerName","ResultsPanel","save","fileName","titles","max","fncResultPanelAdded","ctl","cache","body_4","body_5","body_6","ccontainer","getControlsByClass","ControlContainer","addControl","content","main","side","layername","numero","parentElement","openTable","css","trClass","tdClass","thClass","callback","tabla","maximize","col","getElementsByTagName","dataTypes","j","tdNumeric","k","stopPropagation","undefined","feat","geometry","_select","td","offsetWidth","scrollWidth","title","_unselect","Message","messageDiv","clearTimeout","property","listCtrl","minLength","source","_self","_capabilities","fetchJSON","now","toString","WFSQueryBuilder","contentType","method","arr","pv","cv","currentTarget","buildHTML","style","maxHeight","results","cp","_highlightText","which","RegExp","getCRS","capabilitiesAsJSON","Exception","exceptionCode","ExceptionText","featFounds","numberMatched","numberOfFeatures","isNaN","xhr","state","message","feature","_addFeature","result","Point","addPoint","getCoords","Polyline","addPolyline","Polygon","addPolygon","MultiPolygon","addMultiPolygon","MultiPolyline","addMultiPolyline","getLayer","VECTOR","render","_map","self","helpers","countif","chunk","context","bodies","params","body","skip","current","_count","_default","extend","Cfg","polygon","fillColor","fillOpacity","strokeColor","strokeWidth","polyline","point","texts","renderModalDialog","path","renderDialogPromise","getWFSCapabilitiesPromise","forEach","name","sort","a","b","modal","showModal","closeCallback","coef","clientWidth","clientHeight","previousElementSibling","_renderModalDialog","all"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\n/*pollyfill*/\r\nif (!HTMLElement.prototype.appendHTML) {\r\n    HTMLElement.prototype.appendHTML = function (html) {\r\n        var d = document.createElement(\"div\");\r\n        d.innerHTML = html;\r\n        if (d.childNodes.length > 1) {\r\n            for (var i = 0; i < d.childNodes.length; i++) {\r\n                this.appendChild(d.childNodes[i]);\r\n            }\r\n        }\r\n        if (d.childNodes.length > 0)\r\n            this.appendChild(d.firstChild);\r\n        return null;\r\n    };\r\n};\r\nif (!Document.prototype.createHTMLElement) {\r\n    Document.prototype.createHTMLElement = function (html) {\r\n        var d = document.createElement(\"div\");\r\n        d.innerHTML = html;\r\n        if (d.childNodes.length > 0)\r\n            return d.firstChild;\r\n        return null;\r\n    };\r\n};\r\nif (!HTMLElement.prototype.empty) {\r\n    HTMLElement.prototype.empty = function () {\r\n        while (this.children.length) {\r\n            this.removeChild(this.children[0]);\r\n        }\r\n    };\r\n};\r\n\r\nif (typeof Object.assign != 'function') {\r\n    // Must be writable: true, enumerable: false, configurable: true\r\n    Object.defineProperty(Object, \"assign\", {\r\n        value: function assign(target, varArgs) { // .length of function is 2\r\n            'use strict';\r\n            if (target == null) { // TypeError if undefined or null\r\n                throw new TypeError('Cannot convert undefined or null to object');\r\n            }\r\n\r\n            var to = Object(target);\r\n\r\n            for (var index = 1; index < arguments.length; index++) {\r\n                var nextSource = arguments[index];\r\n\r\n                if (nextSource != null) { // Skip over if undefined or null\r\n                    for (var nextKey in nextSource) {\r\n                        // Avoid bugs when hasOwnProperty is shadowed\r\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\r\n                            to[nextKey] = nextSource[nextKey];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return to;\r\n        },\r\n        writable: true,\r\n        configurable: true\r\n    });\r\n}\r\n\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nif (!TC.filter) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/filter');\r\n}\r\n\r\nTC.control.WFSQuery = function (options) {\r\n    var self = this;\r\n    TC.Control.apply(this, arguments);\r\n    self.styles = self.options.styles;\r\n    self.highLightStyles = self.options.highLightStyles;\r\n};\r\n\r\nTC.inherit(TC.control.WFSQuery, TC.Control);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.WFSQuery.prototype;\r\n\r\n    var cssClassLoading = \"tc-loading\";\r\n    var modalBody = null;\r\n    var modalDialog = null;\r\n    var ctlResultsPanel = null;\r\n    var resultLayer = null;\r\n    var logicalOperator = TC.Consts.logicalOperator.AND;\r\n    var timer = null;\r\n    var autoCompletePromise = null;\r\n    var locale = null;\r\n\r\n    var filterByOperation = {\r\n        eq: TC.filter.equalTo,\r\n        not: TC.filter.notEqualTo,\r\n        gt: TC.filter.greaterThan,\r\n        lt: TC.filter.lessThan,\r\n        ge: TC.filter.greaterThanOrEqualTo,\r\n        le: TC.filter.lessThanOrEqualTo,\r\n        like: TC.filter.like,\r\n        contains: TC.filter.like,\r\n        start: TC.filter.like,\r\n        end: TC.filter.like,\r\n        bw: TC.filter.between\r\n    }\r\n    var map = null;\r\n    var _currentLayer = null;\r\n    var _currentLayerName = null;\r\n    var _currentLayercapabilities = null;\r\n    var _currentLayerTitle = null;\r\n    var _currentLayerURL = null;\r\n    var _maxRecordCount = null;\r\n    var _getStyles = function () { return null };\r\n    var _getHighLightStyles = function () { return null };\r\n    var getLocaleString=null;\r\n    ctlProto.CLASS = 'tc-ctl-wfsquery';\r\n    ctlProto.template = {};\r\n    if (TC.isDebug) {\r\n        ctlProto.template[ctlProto.CLASS + \"-dialog\"] = TC.apiLocation + \"TC/templates/WFSQueryDialog.html\";\r\n        ctlProto.template[ctlProto.CLASS + \"-form\"] = TC.apiLocation + \"TC/templates/WFSQueryForm.html\";\r\n        ctlProto.template[ctlProto.CLASS + \"-filter\"] = TC.apiLocation + \"TC/templates/WFSQueryfilter.html\";\r\n    }\r\n    else {\r\n        ctlProto.template[ctlProto.CLASS + '-dialog'] = function () {\r\n            dust.register(ctlProto.CLASS + '-dialog', body_0); function body_0(chk, ctx) { return chk.w(\"<div class=\\\"tc-ctl-wfsquery-dialog tc-modal\\\"><div class=\\\"tc-modal-background tc-modal-close\\\"></div><div class=\\\"tc-modal-window tc-ctl-wfsquery-modal-window\\\" ><div class=\\\"tc-modal-header\\\"><h3>\").f(ctx.get([\"layerName\"], false), ctx, \"h\").w(\"</h3><div title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.tooltipCloseDialogBtn\" }).w(\"\\\" class=\\\"tc-modal-close\\\"></div></div><div class=\\\"tc-modal-body\\\">\").h(\"gt\", ctx, { \"block\": body_1 }, { \"key\": ctx.getPath(false, [\"layers\", \"length\"]), \"value\": 1 }).w(\"<div class=\\\"tc-modal-form\\\"></div><div class=\\\"tc-ctl-wfsquery-message tc-hidden\\\"></div> </div><div class=\\\"tc-modal-footer\\\"><button type=\\\"button\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.tooltipSendQueryBtn\" }).w(\"\\\" class=\\\"tc-button tc-ctl-wlm-btn-launch\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.sendQueryBtnText\" }).w(\"</button><button type=\\\"button\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.cancelQueryTooltip\" }).w(\"\\\" class=\\\"tc-button tc-modal-close\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.cancelQueryButton\" }).w(\"</button></div></div></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\" <div><select class=\\\"tc-combo\\\" name=\\\"availableLayers\\\"><option value=\\\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.chooseALayerCombo\" }).w(\"</option>\").s(ctx.get([\"layers\"], false), ctx, { \"block\": body_2 }, {}).w(\"</select></div> \"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\"<option value=\\\"\").f(ctx.get([\"name\"], false), ctx, \"h\").w(\"\\\">\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</option>\"); } body_2.__dustBody = !0; return body_0;\r\n        };\r\n        ctlProto.template[ctlProto.CLASS + '-form'] = function () {\r\n            dust.register(ctlProto.CLASS + '-form', body_0); function body_0(chk, ctx) { return chk.w(\"<div>\").h(\"countif\", ctx, { \"else\": body_1, \"block\": body_2 }, { \"key\": ctx.get([\"attributes\"], false), \"excludedKeys\": \"the_geom,FEATURE\" }).w(\"</div><div class=\\\"tc-ctl-wfsquery-operacion tc-hidden\\\"><div class=\\\"tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden\\\"><input type=\\\"radio\\\" id=\\\"cond_1\\\" name=\\\"codicion\\\" value=\\\"eq\\\" /><label for=\\\"cond_1\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.equalToBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_2\\\" name=\\\"codicion\\\" value=\\\"not\\\" /><label for=\\\"cond_2\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.notEqualToBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_3\\\" name=\\\"codicion\\\" value=\\\"gt\\\" /><label for=\\\"cond_3\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.greatherThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_4\\\" name=\\\"codicion\\\" value=\\\"lt\\\" /><label for=\\\"cond_4\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.lowerThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_5\\\" name=\\\"codicion\\\" value=\\\"ge\\\" /><label for=\\\"cond_5\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.greatherOrEqualThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_6\\\" name=\\\"codicion\\\" value=\\\"le\\\" /><label for=\\\"cond_6\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.lowerOrEqualThanBtn\" }).w(\"</label><!--<input type=\\\"radio\\\" id=\\\"cond_7\\\" name=\\\"codicion\\\" value=\\\"like\\\" /><label for=\\\"cond_7\\\" class=\\\"tc-ctl-wfsquery-cond\\\">es como</label>--></div><div class=\\\"tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden\\\"><input type=\\\"radio\\\" id=\\\"cond_8\\\" name=\\\"codicion\\\" value=\\\"eq\\\" /><label for=\\\"cond_8\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.equalToBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_9\\\" name=\\\"codicion\\\" value=\\\"contains\\\" /><label for=\\\"cond_9\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.containsBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_10\\\" name=\\\"codicion\\\" value=\\\"start\\\" /><label for=\\\"cond_10\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.startsByBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_11\\\" name=\\\"codicion\\\" value=\\\"end\\\" /><label for=\\\"cond_11\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.endsByBtn\" }).w(\"</label></div><div class=\\\"tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden\\\"><input type=\\\"radio\\\" id=\\\"cond_12\\\" name=\\\"codicion\\\" value=\\\"bw\\\" /><label for=\\\"cond_12\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.equalToBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_13\\\" name=\\\"codicion\\\" value=\\\"nbw\\\" /><label for=\\\"cond_13\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.notEqualToBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_14\\\" name=\\\"codicion\\\" value=\\\"gt\\\" /><label for=\\\"cond_14\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.greatherThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_15\\\" name=\\\"codicion\\\" value=\\\"lt\\\" /><label for=\\\"cond_15\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.lowerThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_16\\\" name=\\\"codicion\\\" value=\\\"ge\\\" /><label for=\\\"cond_16\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.greatherOrEqualThanBtn\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"cond_17\\\" name=\\\"codicion\\\" value=\\\"le\\\" /><label for=\\\"cond_17\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-cond\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.lowerOrEqualThanBtn\" }).w(\"</label><!--<input type=\\\"radio\\\" id=\\\"cond_7\\\" name=\\\"codicion\\\" value=\\\"like\\\" /><label for=\\\"cond_7\\\" class=\\\"tc-ctl-wfsquery-cond\\\">es como</label>--></div><div class=\\\"tc-ctl-wfsquery-where tc-hidden\\\"><input type=\\\"search\\\" placeholder=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.searchFieldPhd\" }).w(\"\\\" class=\\\"tc-textbox\\\" /><button type=\\\"button\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.tooltipAddCondBtn\" }).w(\"\\\" class=\\\"tc-button\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.textAddCondBtn\" }).w(\"</button><ul class=\\\"tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden\\\"></ul><div class=\\\"tc-ctl-wfsquery-key\\\"><label>\").h(\"i18n\", ctx, {}, { \"$key\": \"query.logicalOpLbl\" }).w(\"</label></div><div class=\\\"tc-ctl-wfsquery-value\\\"><input type=\\\"radio\\\" id=\\\"log_op_1\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-logOpRadio\\\" checked name=\\\"log_op\\\" value=\\\"AND\\\" /><label for=\\\"log_op_1\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-logOp\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.logicalOpAndLbl\" }).w(\"</label><input type=\\\"radio\\\" id=\\\"log_op_2\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-logOpRadio\\\" name=\\\"log_op\\\" value=\\\"OR\\\" /><label for=\\\"log_op_2\\\" class=\\\"tc-ctl-btn tc-ctl-wfsquery-logOp\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.logicalOpOrLbl\" }).w(\"</label></div><div class=\\\"tc-ctl-wfsquery-whereList\\\"></div></div></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.noAttributes\" }).w(\"</div>\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\"<select class=\\\"tc-combo\\\" id=\\\"attributes\\\" name=\\\"attributes\\\"><option value=\\\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.chooseAttrCombo\" }).w(\"</option>\").h(\"iterate\", ctx, { \"block\": body_3 }, { \"on\": ctx.get([\"attributes\"], false), \"excludedKeys\": \"the_geom,FEATURE\" }).w(\"</select>\"); } body_2.__dustBody = !0; function body_3(chk, ctx) { return chk.w(\"<option value=\\\"\").f(ctx.get([\"key\"], false), ctx, \"h\").w(\"\\\">\").f(ctx.get([\"key\"], false), ctx, \"h\").w(\"</option>\"); } body_3.__dustBody = !0; return body_0\r\n        };\r\n        ctlProto.template[ctlProto.CLASS + '-filter'] = function () {\r\n            dust.register(ctlProto.CLASS + '-filter', body_0); function body_0(chk, ctx) { return chk.s(ctx.get([\"conditions\"], false), ctx, { \"block\": body_1 }, {}); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<div class=\\\"tc-ctl-wfsquery-where-cond\\\">\").f(ctx.get([\"field\"], false), ctx, \"h\").w(\"&nbsp;\").f(ctx.get([\"opText\"], false), ctx, \"h\").w(\"&nbsp;\").x(ctx.get([\"isString\"], false), ctx, { \"block\": body_2 }, {}).f(ctx.get([\"valueToShow\"], false), ctx, \"h\", [\"numberSeparator\"]).x(ctx.get([\"isString\"], false), ctx, { \"block\": body_3 }, {}).w(\"</div><div class=\\\"tc-ctl-wfsquery-del-cond\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.tooltipRemoveCond\" }).w(\"\\\"></div>\\t\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\"&quot;\"); } body_2.__dustBody = !0; function body_3(chk, ctx) { return chk.w(\"&quot;\"); } body_3.__dustBody = !0; return body_0; \r\n        };        \r\n    }\r\n\r\n    var checkInput = function (type) {\r\n        var input = document.createElement(\"input\");\r\n        input.setAttribute(\"type\", type);\r\n        return input.type == type;\r\n    };\r\n\r\n    var _loadDatePolyFill = function () {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof (IMask) !== \"undefined\") {\r\n                setTimeout(function () {\r\n                    resolve();\r\n                }, 10);\r\n            }\r\n            else {\r\n                TC.loadJS(true,\r\n                    [TC.apiLocation + '/lib/polyfill/IMask' + (TC.isDebug ? '' : '.min') + '.js'],\r\n                    function () {\r\n                        console.log(\"Imask loaded\");\r\n                        resolve();\r\n                    });\r\n            }\r\n        });\r\n    };\r\n    var _loadNumberPolyFill = function () {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof (IMask) !== \"undefined\") {\r\n                setTimeout(function () {\r\n                    resolve();\r\n                }, 10);\r\n            }\r\n            else {\r\n                TC.loadJS(true,\r\n                    [TC.apiLocation + '/lib/polyfill/IMask' + (TC.isDebug ? '' : '.min') + '.js'],\r\n                    function () {\r\n                        console.log(\"Imask loaded\");\r\n                        resolve();\r\n                    });\r\n            }\r\n        });\r\n    }\r\n    var _renderModalDialog = function (layer, layerName, capabilities, callback) {        \r\n        var layers = [];\r\n        layer.getDisgregatedLayerNames().forEach(function (value, index) {\r\n            var path = layer.getPath(value);\r\n            //quitamos aquellas que no estén disponibles en el WFS\r\n            if (capabilities.FeatureTypes.hasOwnProperty(value.substring(value.indexOf(\":\") + 1)))\r\n                layers.push({ name: value, title: path[path.length - 1] });\r\n        });\r\n        layers.sort(function (a, b) {\r\n            if (a.title < b.title) return -1;\r\n            if (a.title > b.title) return 1;\r\n            return 0;\r\n        });\r\n\r\n        ctlProto.getRenderedHtml(ctlProto.CLASS + \"-dialog\",\r\n            {\r\n                layerName: getLocaleString(\"query.titleDialog\", { \"layerName\": layerName }),\r\n                layers: layers\r\n            }, function (html) {\r\n                var modal = document.createHTMLElement(html);\r\n                document.body.appendChild(modal);\r\n                modalBody = modal.getElementsByClassName(\"tc-modal-body\")[0]\r\n                modalBody.classList.add(cssClassLoading);\r\n\r\n                TC.Util.showModal(modal, {\r\n                    closeCallback: function () {\r\n                        modal.parentElement.removeChild(modal);\r\n                    }\r\n                });\r\n                //IE me hace la puñeta con los estilos, no me fuciona el calc el el max-height así que lo calculo cada vez que muestro el dialogo\r\n                if (TC.Util.detectIE()) {\r\n                    var coef = 1;\r\n                    switch (true) {\r\n                        case document.body.clientWidth > 768 && document.body.clientWidth < document.body.clientHeight:\r\n                        case document.body.clientWidth > 1024:\r\n                            coef = 0.8;\r\n                        case document.body.clientWidth > 1140:\r\n                            coef = 0.7;\r\n                            break;\r\n                    }\r\n                    modalBody.style.maxHeight = (document.body.clientHeight * coef) - modalBody.nextElementSibling.clientHeight - modalBody.previousElementSibling.clientHeight;\r\n                }\r\n                modalDialog = modal;\r\n                modal.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].addEventListener(\"click\", function () {\r\n                    _sendQuery();\r\n                })\r\n                if (callback) callback(modal);\r\n            });\r\n    }\r\n\r\n    var _renderQueryForm = function (args) {\r\n        var layer = args[0], dialog = args[1], capabilities = args[2];\r\n        _currentLayer = layer;\r\n        _currentLayercapabilities = capabilities;\r\n        _currentLayerURL = capabilities.Operations.DescribeFeatureType.DCP.HTTP.Get[\"xlink:href\"];\r\n        if (capabilities.Operations.GetFeature.CountDefault)\r\n            _maxRecordCount = capabilities.Operations.GetFeature.CountDefault.DefaultValue;\r\n        else\r\n            _maxRecordCount = null;\r\n        //analizamos si es una o varias capas, si es una agrupación la disgregamos \r\n        var layers = layer.getDisgregatedLayerNames();\r\n        //quitamos aquellas que no estén disponibles en el WFS\r\n        layers = layers.filter(function (l) {\r\n            return capabilities.FeatureTypes.hasOwnProperty(l.substring(l.indexOf(\":\") + 1));\r\n        });\r\n        if (layers.length > 1) {\r\n            modalBody.classList.remove(cssClassLoading);\r\n            //bindeamos el onchange de combo\r\n            dialog.getElementsByClassName(\"tc-combo\")[0].addEventListener(\"change\", function () {\r\n                if (!this.value) {\r\n                    var form = dialog.getElementsByClassName(\"tc-modal-form\")[0];\r\n                    form.empty();\r\n                    for (var i = 0; i < form.children.length; i++) form.removeChild(form.children[i]);\r\n                    _clear();\r\n                    return;\r\n                }\r\n                dialog.querySelector(\".tc-modal-body .tc-ctl-wfsquery-message\", dialog).classList.add(TC.Consts.classes.HIDDEN);\r\n                _currentLayerTitle = this.options[this.selectedIndex].text;\r\n                modalBody.classList.add(cssClassLoading);\r\n                _getDescribeFeature( this.value, capabilities).then(function (data) { _manageDescribeFeature(data, dialog); }, function () {\r\n                    var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                    tbody.classList.remove(cssClassLoading);\r\n                    tbody.appendHTML(\"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                    tbody.empty();\r\n                });\r\n            });\r\n        }\r\n        else {\r\n            //comprabamos que la capa existe en el capabilities\r\n            var layerCapabilities = capabilities.FeatureTypes[layers[0].substring(layers[0].indexOf(\":\") + 1)];\r\n            if (layerCapabilities) {\r\n                _currentLayerTitle = capabilities.FeatureTypes[layers[0].substring(layers[0].indexOf(\":\") + 1)].Title;\r\n                _getDescribeFeature( layers[0], capabilities).then(function (data) { _manageDescribeFeature(data, dialog); }, function () {\r\n                    var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                    tbody.classList.remove(cssClassLoading);\r\n                    tbody.appendHTML(\"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                    tbody.empty();\r\n                });\r\n            }\r\n            else {\r\n                var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                tbody.classList.remove(cssClassLoading);\r\n                tbody.appendHTML(\"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                //TC.Util.closeModal();\r\n                //layer.map.toast(\"Mal\", { type: TC.Consts.msgType.WARNING });\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    var _getDescribeFeature = function ( layerName, capabilities) {\r\n        _currentLayerName = layerName;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!capabilities.Operations.DescribeFeatureType) {\r\n                TC.error(\"No está habilitado DescribeFeatureType en este servicio\", TC.Consts.msgErrorMode.TOAST);\r\n                return;\r\n            }\r\n            var url = capabilities.Operations.DescribeFeatureType.DCP.HTTP.Get[\"xlink:href\"] + \"?REQUEST=DescribeFeatureType&TYPENAME=\" + layerName + \"&OUTPUTFORMAT=\" + capabilities.Operations.DescribeFeatureType.outputFormat\r\n\r\n\r\n            _currentLayer.toolProxification.fetchXML(url)\r\n                .then(function (response) {\r\n                    var obj = xml2json(response);\r\n                    var objLayer = obj[layerName.substring(layerName.indexOf(\":\") + 1)];\r\n                    if (objLayer) {\r\n                        var type = objLayer.type\r\n                        resolve(obj[type.substring(type.indexOf(\":\") + 1)].complexContent.extension.sequence);\r\n                    }\r\n                    else {\r\n                        reject();\r\n                    }\r\n                }).catch(function (error) {\r\n                    TC.error(error);\r\n                });\r\n        });\r\n    }\r\n    var _getValue = function (input) {\r\n        if (inputMaskNumber) {\r\n            return inputMaskNumber.unmaskedValue;\r\n\r\n        } else if (dateInputMask) {\r\n            //si es texto con mascara de fecha convertierto la fecha de dd/mm/yyyy a yyyy-mm-dd\r\n            return dateInputMask.unmaskedValue.substring(4) + \"-\" + dateInputMask.unmaskedValue.substring(2, 4) + \"-\" + dateInputMask.unmaskedValue.substring(0, 2)\r\n        }\r\n        return input.value;//en el resto de los casos la devuelvo tal cual\r\n\r\n    }\r\n    var _getValueToShow = function (input) {\r\n        if (inputMaskNumber) {\r\n            return inputMaskNumber.value;\r\n        }\r\n        else if (dateInputMask) {\r\n            //si es de tipo date devolvemos la fecha en formato dd/mm/yyyy\r\n            return dateInputMask.value;\r\n        }\r\n        else if (input.type === \"date\") {\r\n            return new Date(input.value).toLocaleDateString(locale)\r\n        }\r\n        else if (input.type === \"number\") {\r\n            var dotOrComma = 1.1.toLocaleString(locale).substring(1, 2);\r\n            return input.value.replace(\".\", dotOrComma);\r\n        }\r\n        return input.value;//en el resto de los casos la devuelvo tal cual\r\n\r\n    }\r\n    var dateInputMask = null;\r\n    var inputMaskNumber = null;\r\n    var _createDateMask = function (txtBox) {\r\n        if (checkInput(\"date\"))\r\n            txtBox.type = \"date\";\r\n        else {\r\n            txtBox.type = \"search\";\r\n            _loadDatePolyFill().then(function () {\r\n                //construir el polyfill\r\n                dateInputMask = new IMask(txtBox, {\r\n                    mask: Date,\r\n                    pattern: ((!locale || locale === \"es-ES\") ? 'd/`m/`Y' : (locale === \"eu-ES\" ? 'Y/`m/`d' : 'm/`d/`Y')),\r\n                    lazy: false,\r\n                    format: function (date) {\r\n                        var day = date.getDate();\r\n                        var month = date.getMonth() + 1;\r\n                        var year = date.getFullYear();\r\n                        if (day < 10) day = \"0\" + day;\r\n                        if (month < 10) month = \"0\" + month;\r\n                        switch (locale) {\r\n                            case \"eu-ES\":\r\n                                return [year, month, day].join('/');\r\n                                break;\r\n                            case \"en-US\":\r\n                                return [month, day, year].join('/');\r\n                                break;\r\n                            case \"es-ES\":\r\n                            default:\r\n                                return [day, month, year].join('/');\r\n                                break;\r\n                        }\r\n\r\n                    },\r\n                    // define str -> date convertion\r\n                    parse: function (str) {\r\n                        switch (locale) {\r\n                            case \"eu-ES\":\r\n                                return new Date(str.split('/')[1] + \"/\" + str.split('/')[2] + \"/\" + str.split('/')[0])\r\n                                break;\r\n                            case \"en-US\":\r\n                                return new Date(str)\r\n                                break;\r\n                            case \"es-ES\":\r\n                            default:\r\n                                return new Date(str.split('/')[1] + \"/\" + str.split('/')[0] + \"/\" + str.split('/')[2])\r\n                                break;\r\n                        }\r\n\r\n                    },\r\n                    blocks: {\r\n                        d: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1,\r\n                            to: 31,\r\n                            maxLength: 2,\r\n                        },\r\n                        m: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1,\r\n                            to: 12,\r\n                            maxLength: 2,\r\n                        },\r\n                        Y: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1900,\r\n                            to: 9999,\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n    var _destroyDateMask = function () {\r\n        if (dateInputMask) {\r\n            var input = dateInputMask.el.input;\r\n            dateInputMask.destroy();\r\n            dateInputMask = null;\r\n            input.value = \"\";\r\n            input.type = \"search\";\r\n        }\r\n    };\r\n    var destroyNumberMask = function () {\r\n        if (inputMaskNumber) {\r\n            var input = inputMaskNumber.el.input;\r\n            inputMaskNumber.destroy();\r\n            inputMaskNumber = null;\r\n            input.value = \"\";\r\n            input.type = \"search\";\r\n        }\r\n    };\r\n    var _getDataTypes = function () {\r\n        return _internalGetDataTypes();\r\n    }\r\n    var _manageDescribeFeature = function (data, dialog) {\r\n        _clear();\r\n        _internalGetDataTypes = function () {\r\n            return data;\r\n        };\r\n        ctlProto.getRenderedHtml(ctlProto.CLASS + \"-form\",\r\n            {\r\n                attributes: data\r\n            }, function (html) {\r\n                var form = dialog.getElementsByClassName(\"tc-modal-form\")[0];\r\n                form.empty();\r\n                form.appendHTML(html);\r\n                modalBody.classList.remove(cssClassLoading);\r\n                TC.loadJS(\r\n                    true,\r\n                    [TC.apiLocation + 'TC/ui/autocomplete.js'],\r\n                    function () {\r\n                        console.log(\"autocomplete loaded\");\r\n                    });\r\n                var type = null;\r\n                var combo = form.getElementsByClassName(\"tc-combo\");\r\n                if (combo.length == 0)\r\n                    dialog.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].setAttribute(\"disabled\", \"\");\r\n                else {\r\n                    dialog.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].removeAttribute(\"disabled\");\r\n                    combo[0].addEventListener(\"change\", function () {\r\n                        var valueField = form.querySelector(\".tc-ctl-wfsquery-where .tc-textbox\");\r\n                        if (valueField.dataset[\"autocomplete\"])\r\n                            TC.UI.autocomplete.call(valueField, \"clear\");\r\n                        if (!data[this.value]) {\r\n                            form.getElementsByClassName(\"tc-ctl-wfsquery-numeric\")[0].classList.add(\"tc-hidden\");\r\n                            form.getElementsByClassName(\"tc-ctl-wfsquery-date\")[0].classList.add(\"tc-hidden\");\r\n                            form.getElementsByClassName(\"tc-ctl-wfsquery-text\")[0].classList.add(\"tc-hidden\");\r\n                            form.getElementsByClassName(\"tc-ctl-wfsquery-where\")[0].classList.add(\"tc-hidden\");\r\n                            form.getElementsByClassName(\"tc-ctl-wfsquery-operacion\")[0].classList.add(\"tc-hidden\");\r\n                            return;\r\n                        }\r\n                        type = data[this.value].type;\r\n                        form.getElementsByClassName(\"tc-ctl-wfsquery-operacion\")[0].classList.remove(\"tc-hidden\");\r\n                        TC.UI.autocomplete.call(valueField, \"clear\");\r\n                        //$(valueField).unbind(\"keydown\");\r\n                        destroyNumberMask();\r\n                        valueField.type = \"search\";\r\n                        switch (true) {\r\n                            case type.indexOf(\"int\") >= 0:\r\n                            case type.indexOf(\"float\") >= 0:\r\n                            case type.indexOf(\"double\") >= 0:\r\n                            case type.indexOf(\"long\") >= 0:\r\n                            case type.indexOf(\"decimal\") >= 0:\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-numeric\")[0].classList.remove(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-text\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-date\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-where\")[0].classList.remove(\"tc-hidden\");\r\n\r\n                                if (form.querySelectorAll(\"tc-ctl-wfsquery-numeric input:checked\").length === 0)\r\n                                    form.querySelector(\".tc-ctl-wfsquery-numeric :first-child\").checked = true;                                \r\n                                _destroyDateMask();\r\n                                \r\n                                if (checkInput(\"number\")) {\r\n                                    if (TC.Util.detectIE()) {\r\n                                        valueField.type = \"text\";\r\n                                        _loadNumberPolyFill().then(function () {\r\n                                            inputMaskNumber = new IMask(valueField, {\r\n                                                mask: Number,  // enable number mask\r\n                                                scale: (type.indexOf(\"int\") >= 0 || type.indexOf(\"long\") >= 0) ? 0 : 2,  // digits after point, 0 for integers\r\n                                                signed: false,  // disallow negative\r\n                                                thousandsSeparator: (locale && locale === \"en-US\") ? ',' : '.',  // any single char\r\n                                                padFractionalZeros: false,  // if true, then pads zeros at end to the length of scale\r\n                                                normalizeZeros: true,  // appends or removes zeros at ends\r\n                                                radix: (locale && locale === \"en-US\") ? '.' : ',',  // fractional delimiter\r\n                                            })\r\n                                        });\r\n                                    }\r\n                                    else {\r\n                                        valueField.type = \"number\";\r\n                                        if (type.indexOf(\"int\") >= 0 || type.indexOf(\"long\") >= 0)\r\n                                            valueField.step = \"1\";\r\n                                        else\r\n                                            valueField.step = \"0.0001\";\r\n                                    }                                        \r\n                                }\r\n                                break\r\n                            case type.indexOf(\"dateTime\") >= 0:\r\n\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-numeric\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-text\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-date\")[0].classList.remove(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-where\")[0].classList.remove(\"tc-hidden\");\r\n\r\n                                if (form.querySelectorAll(\"tc-ctl-wfsquery-date input:checked\").length === 0)\r\n                                    form.querySelector(\".tc-ctl-wfsquery-date :first-child\").checked = true;\r\n                                _createDateMask(valueField);\r\n                                break;\r\n                            case type.indexOf(\"string\") >= 0:\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-numeric\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-text\")[0].classList.remove(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-date\")[0].classList.add(\"tc-hidden\");\r\n                                form.getElementsByClassName(\"tc-ctl-wfsquery-where\")[0].classList.remove(\"tc-hidden\");\r\n\r\n                                if (form.querySelectorAll(\"tc-ctl-wfsquery-text input:checked\").length === 0)\r\n                                    form.querySelector(\".tc-ctl-wfsquery-text :first-child\").checked = true;\r\n                                _destroyDateMask();                                \r\n                                _autocompleteConstructor(valueField, this.value, form.getElementsByClassName(ctlProto.CLASS + \"-list tc-ctl-search-list\")[0]);\r\n                                break;\r\n                        }\r\n                    });\r\n                    form.querySelector(\".tc-ctl-wfsquery-where  input[type='radio']\").addEventListener(\"change\", function () {\r\n                        logicalOperator = this.value === \"OR\" ? TC.Consts.logicalOperator.OR : TC.Consts.logicalOperator.AND\r\n                        //reemplazar en la lista\r\n                        form.getElementsByClassName(\"tc-ctl-wfsquery-whereList-op\")[0].innerHTML = this.nextElementSibling.innerHTML;\r\n                    });\r\n                    \r\n                    form.querySelector(\".tc-button\").addEventListener(\"click\", function () {\r\n                        var valueField = form.querySelector('input.tc-textbox');\r\n                        TC.UI.autocomplete.call(valueField, \"clear\");\r\n                        if (inputMaskNumber)\r\n                            inputMaskNumber.masked.remove();\r\n                        if (!_validate(form)) {\r\n                            return;\r\n                        }\r\n                        var field = form.querySelector('.tc-combo').value;\r\n                        var checkeOp = form.querySelector('.tc-ctl-wfsquery input[type=\"radio\"]:checked');\r\n                        var op = checkeOp.value;\r\n                        var opText = checkeOp.nextElementSibling.innerText;\r\n\r\n                        var value = _getValue(valueField);\r\n                        var valueToShow = _getValueToShow(valueField);\r\n                        var logOp = form.querySelector('.tc-ctl-wfsquery-where  input[type=\"radio\"]:checked').nextElementSibling.innerText;\r\n                                               \r\n                        //reemplazo < y > por y &lt;&gt;\r\n                        value = value.replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\");\r\n                        //escapo los caracteres no alfamericos                    \r\n                        //value = value.replace(/[^a-z\\dáéíóúü]/gi, '!' + '$&');\r\n                        //se añade asterisco al principio y/o final del valor para las busquedas: \"empieza por\", \"termina en\" o \"contiene\"\r\n                        var f;\r\n                        if (type.indexOf(\"dateTime\") >= 0) {\r\n                            if (op !== \"nbw\")\r\n                                f = new filterByOperation[op](field, value + \"T00:00:00Z\", value + \"T23:59:59Z\");\r\n                            else//el not bettween es un caso es especial por que concatena un filtro not y otro between\r\n                            {\r\n                                f = new TC.filter.not(TC.filter.between(field, value + \"T00:00:00Z\", value + \"T23:59:59Z\"));\r\n                            }\r\n                        }\r\n                        else\r\n                            f = new filterByOperation[op](\r\n                                field,\r\n                                (((op === \"end\" || op === \"contains\") ? '*' : '') + value + ((op === \"start\" || op === \"contains\") ? '*' : '')));\r\n                        f.matchCase = false;\r\n                        whereObjList.push(f);\r\n                        switch (true) {\r\n                            case type.indexOf(\"int\") >= 0:\r\n                                valueToShow = parseInt(value,10)\r\n                                break;\r\n                            case type.indexOf(\"float\") >= 0:\r\n                            case type.indexOf(\"double\") >= 0:\r\n                            case type.indexOf(\"long\") >= 0:\r\n                            case type.indexOf(\"decimal\") >= 0:\r\n                                valueToShow = parseFloat(value, 10)\r\n                                break;\r\n                        }\r\n                        whereFilterList.push({\r\n                            \"field\": field,\r\n                            \"opText\": opText,\r\n                            \"isString\": type.indexOf(\"string\")>=0,\r\n                            \"valueToShow\": valueToShow\r\n                        });\r\n                        \r\n                        _renderFiltersConditions(form);\r\n                        valueField.value = \"\";\r\n                    });\r\n                }\r\n            });\r\n    };\r\n    var _renderFiltersConditions = function (form) {\r\n\r\n        if (!dust.filters.numberSeparator)\r\n            dust.filters.numberSeparator = function (value) {\r\n                return value.toLocaleString(locale);\r\n            };\r\n\r\n        var whereDiv = form.getElementsByClassName(\"tc-ctl-wfsquery-whereList\")[0];\r\n        whereDiv.empty();\r\n        ctlProto.getRenderedHtml(ctlProto.CLASS + \"-filter\", {\r\n            conditions: whereFilterList\r\n        }, function (html) {\r\n            form.getElementsByClassName(\"tc-ctl-wfsquery-whereList\")[0].innerHTML = html;\r\n            var delBtnCollection = form.getElementsByClassName(\"tc-ctl-wfsquery-del-cond\");\r\n            for (var i = 0; i < delBtnCollection.length; i++) {\r\n                delBtnCollection[i].addEventListener(\"click\", function () {\r\n                    var index = Array.prototype.indexOf.call(delBtnCollection, this);\r\n                    whereObjList.splice(index, 1);\r\n                    whereFilterList.splice(index, 1);\r\n                    _renderFiltersConditions(form);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    var _clear = function () {\r\n        whereObjList = [];\r\n        whereFilterList = [];\r\n    };\r\n    var _validate = function (form) {\r\n        var opcion = form.querySelector('.tc-ctl-wfsquery input[type=\"radio\"]:checked');\r\n\r\n        if (dateInputMask && !dateInputMask.masked.isComplete) {\r\n            if (/^(?=\\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\\x20|$))|(?:2[0-8]|1\\d|0?[1-9]))([-.\\/])(?:1[012]|0?[1-9])\\1(?:1[6-9]|[2-9]\\d)?\\d\\d(?:(?=\\x20\\d)\\x20|$))?(((0?[1-9]|1[012])(:[0-5]\\d){0,2}(\\x20[AP]M))|([01]\\d|2[0-3])(:[0-5]\\d){1,2})?$/.test(str) === false)\r\n                _showMessage(\"Fecha \" + str + \" inválida\", TC.Consts.msgType.ERROR);\r\n            return false;\r\n        }\r\n        if (opcion.length == 0) {\r\n            _showMessage(getLocaleString(\"query.msgNoCondition\"));\r\n            return false;\r\n        }\r\n        if (form.querySelectorAll('input[type=\\'date\\']').length && !form.querySelector('input[type=\\'date\\']').checkValidity()) {\r\n            _showMessage(getLocaleString(\"query.msgNoValidDate\"));\r\n            return false;\r\n        }\r\n        var number\r\n        if (form.querySelectorAll('input[type=\\'number\\']').length && ((number = form.querySelector('input[type=\\'number\\']')) != null) && !number.checkValidity()) {\r\n            if (number.step === \"1\")\r\n                _showMessage(getLocaleString(\"query.msgNoValidNumberMustInt\"));\r\n            else\r\n                _showMessage(getLocaleString(\"query.msgNoValidNumber\"));\r\n            return false;\r\n        }\r\n        if (form.querySelector('input.tc-textbox').value.trim() === \"\") {\r\n            _showMessage(getLocaleString(\"query.msgNoValueCondition\"));\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n    var _sendQuery = function () {\r\n\r\n        if (!_validateQuery()) {\r\n            _showMessage(getLocaleString(\"query.msgNoQueryFilter\"));\r\n            return;\r\n        }\r\n        modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.add(cssClassLoading);\r\n        var _fncLoadVectorLayer = function () {\r\n            var filtro = filterConstructor();\r\n\r\n            _createResultPanel(_currentLayerTitle);\r\n\r\n            _currentLayer.toolProxification.cacheHost.getAction(_currentLayerURL).then(function (cacheHost) {\r\n                const url = cacheHost.action(_currentLayerURL);\r\n\r\n                if (!resultLayer) {\r\n                    _createVectorLayer({\r\n                        id: \"WFSQueryResults\",\r\n                        type: TC.Consts.layerType.WFS,\r\n                        url: url,\r\n                        version: \"1.1.0\",\r\n                        stealth: true,\r\n                        geometryName: \"the_geom\",\r\n                        featurePrefix: _currentLayerName.substring(0, _currentLayerName.indexOf(\":\")),\r\n                        featureType: _currentLayerName.substring(_currentLayerName.indexOf(\":\") + 1),\r\n                        maxFeatures: _maxRecordCount,\r\n                        properties: filtro,\r\n                        outputFormat: TC.Consts.format.JSON,\r\n                        styles: _getStyles()\r\n                    });\r\n                    map.on(TC.Consts.event.RESULTSPANELCLOSE, function (e) {\r\n                        if (e.control !== ctlResultsPanel)\r\n                            return;\r\n                        if (TC.browserFeatures.touch()) {\r\n                            TC.Util.swipe(e.control.div, \"enable\");\r\n                        }\r\n                        resultLayer.clearFeatures();\r\n                        resultLayer.setVisibility(false);\r\n                        map.off(TC.Consts.event.LAYERUPDATE, _featuresUpdate);\r\n                    });\r\n                }\r\n                else {\r\n                    resultLayer.setVisibility(false);\r\n                    resultLayer.clearFeatures();\r\n                    //borro el evento featureUpdate por si hago una búsqueda sin cerra el panel previamente\r\n                    map.off(TC.Consts.event.LAYERUPDATE, _featuresUpdate);\r\n                    map.on(TC.Consts.event.LAYERUPDATE, _featuresUpdate);\r\n                    resultLayer.url = url;\r\n                    resultLayer.featurePrefix = _currentLayerName.substring(0, _currentLayerName.indexOf(\":\"));\r\n                    resultLayer.featureType = _currentLayerName.substring(_currentLayerName.indexOf(\":\") + 1);\r\n                    resultLayer.maxFeatures = _maxRecordCount;\r\n                    resultLayer.properties = filtro;\r\n                    resultLayer.setVisibility(true);\r\n                    resultLayer.refresh();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (_maxRecordCount)\r\n            _numHits(map).then(_fncLoadVectorLayer, function (error) {\r\n                modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.remove(cssClassLoading)\r\n                if (error.err === \"NumMaxFeatures\") {\r\n                    _showMessage(getLocaleString(\"query.msgTooManyResults\", { limit: error.limit }), TC.Consts.msgType.WARNING)\r\n                }\r\n                else if (error.err === \"Empty\") {\r\n                    _showMessage(getLocaleString(\"query.msgNoResults\"), TC.Consts.msgType.INFO);\r\n                }\r\n                else {\r\n                    console.error(error.errorThrown)\r\n                    _showMessage(getLocaleString(\"query.errorUndefined\"), TC.Consts.msgType.ERROR);\r\n                }\r\n\r\n            });\r\n        else\r\n            _fncLoadVectorLayer();\r\n        //si está disponible el atributo CountDefault compruebo que no se sobrepasa la longitud\r\n\r\n    }\r\n    var _createVectorLayer = function (layerOptions) {\r\n        map.addLayer(layerOptions).then(function (layer) {\r\n            resultLayer = layer;\r\n            layer.map.on(TC.Consts.event.LAYERUPDATE, _featuresUpdate);\r\n        });\r\n    };\r\n    var filterConstructor = function () {\r\n        if (whereObjList.length > 1) {\r\n            var condicion = document.querySelector(\".tc-ctl-wfsquery-logOpRadio:checked\").value;\r\n            return TC.filter[TC.Consts.logicalOperator[condicion]].apply(null, whereObjList);\r\n        }\r\n        else if (whereObjList.length === 0)\r\n            return null\r\n        else\r\n            return whereObjList[0];\r\n    }\r\n    var _featuresUpdate = function (e) {\r\n        if (e.layer == resultLayer) {\r\n            var features = e.layer.features;\r\n            if (features.length > 0) {\r\n                map.zoomToFeatures(features);\r\n                _showResultPanel(\r\n                    (features.length > 1 ?\r\n                        features.reduce(function (vi, va, index) {\r\n                            return (vi instanceof Array ? vi : [vi.data]).concat([va.data])\r\n                        })\r\n                        :\r\n                        [features[0].data])\r\n                    , resultLayer, _currentLayerTitle);\r\n            }\r\n            else {\r\n                modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.remove(cssClassLoading);\r\n                _showMessage(\"No hay resultados\", TC.Consts.msgType.INFO);\r\n            }\r\n            e.layer.map.off(TC.Consts.event.LAYERUPDATE, _featuresUpdate);\r\n        }\r\n    };\r\n    var _createResultPanel = function (layerName) {\r\n        var _layerName = layerName;\r\n        new Promise(function (resolve, reject) {\r\n            if (!TC.control.ResultsPanel) {\r\n                TC.loadJS(true, TC.apiLocation + 'TC/control/ResultsPanel', function () {\r\n                    resolve(TC.control.ResultsPanel);\r\n                });\r\n            }\r\n            else\r\n                resolve(TC.control.ResultsPanel);\r\n        }).then(function (ResultsPanel) {\r\n            if (!ctlResultsPanel) {\r\n                var fncResultPanelAdded = function (ctl) {\r\n                    ctlResultsPanel = ctl;\r\n                    delete dust.cache[ctlResultsPanel.CLASS + \"-table\"];\r\n                    if (TC.isDebug) {\r\n                        ctlResultsPanel.template[ctlResultsPanel.CLASS + \"-table\"] = TC.apiLocation + \"TC/templates/WFSQueryResultsTable.html\";\r\n                    }\r\n                    else {\r\n                        ctlResultsPanel.template[ctlResultsPanel.CLASS + \"-table\"] = dust.register(ctlResultsPanel.CLASS + \"-table\", body_0); function body_0(chk, ctx) { return chk.w(\"<table class=\\\"table\\\"><thead>\").s(ctx.get([\"columns\"], false), ctx, { \"block\": body_1 }, {}).w(\"</thead><tbody>\").s(ctx.get([\"results\"], false), ctx, { \"block\": body_2 }, {}).w(\"</tbody></table>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\"<th>\").f(ctx.getPath(true, []), ctx, \"h\").w(\"</th>\"); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.w(\"<tr title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"zoomToFeature\" }).w(\"\\\" data-id=\\\"\").f(ctx.get([\"Id\"], false), ctx, \"h\").w(\"\\\" data-index=\\\"\").f(ctx.get([\"$idx\"], false), ctx, \"h\").w(\"\\\" class=\\\"tc-selectable\\\">\").h(\"iterate\", ctx, { \"block\": body_3 }, { \"on\": ctx.getPath(true, []) }).w(\"</tr>\"); } body_2.__dustBody = !0; function body_3(chk, ctx) { return chk.h(\"select\", ctx, { \"block\": body_4 }, { \"key\": ctx.get([\"key\"], false) }); } body_3.__dustBody = !0; function body_4(chk, ctx) { return chk.w(\"<td class=\\\"\").f(ctx.get([\"key\"], false), ctx, \"h\", [\"removeAccents\", \"downcase\"]).w(\"\\\">\").h(\"startsWith\", ctx, { \"else\": body_5, \"block\": body_6 }, { \"key\": ctx.get([\"value\"], false), \"value\": \"http\" }).w(\"</td>\"); } body_4.__dustBody = !0; function body_5(chk, ctx) { return chk.f(ctx.get([\"value\"], false), ctx, \"h\", [\"numberSeparator\"]); } body_5.__dustBody = !0; function body_6(chk, ctx) { return chk.w(\"<a href=\\\"\").f(ctx.get([\"value\"], false), ctx, \"h\").w(\"\\\" target=\\\"_blank\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"query.linkOpenAtNewTab\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"query.linkText\" }).w(\"</a>\"); } body_6.__dustBody = !0; return body_0\r\n                    }\r\n                    ctlResultsPanel.options.titles.max = ctlResultsPanel.getLocaleString('geo.trk.chart.exp');                    \r\n                }\r\n                var ccontainer = map.getControlsByClass(TC.control.ControlContainer);\r\n                if (ccontainer.length == 0) {\r\n                    map.addControl(\"ResultsPanel\",\r\n                        {\r\n                            \"content\": \"table\",\r\n                            \"titles\": {\r\n                                \"main\": \"\",\r\n                                \"max\": \"\"\r\n                            },\r\n                            \"save\": {\r\n                                \"fileName\": _layerName + \".xls\"\r\n                            }\r\n                        }).then(fncResultPanelAdded);\r\n                }\r\n                else {\r\n                    ccontainer[0].addControl(\"ResultsPanel\", {\r\n                        \"content\": \"table\",\r\n                        \"titles\": {\r\n                            \"main\": \"\",\r\n                            \"max\": \"\"\r\n                        },\r\n                        \"save\": {\r\n                            \"fileName\": _layerName + \".xls\"\r\n                        }, \"side\": \"right\"\r\n                    }).then(fncResultPanelAdded);\r\n                }\r\n            }\r\n            else {\r\n                ctlResultsPanel.options.save.fileName = _layerName + \".xls\";\r\n                ctlResultsPanel.options.titles.max = ctlResultsPanel.getLocaleString('geo.trk.chart.exp');\r\n            }\r\n        });\r\n    };\r\n    var _showResultPanel = function (data, layer, layername) {\r\n\r\n        //map.$events.trigger(TC.Consts.event.SEARCHDONE, { data: data } );\r\n\r\n        var truthTest = function (name, test) {\r\n            return function (chunk, context, bodies, params) {\r\n                return filter(chunk, context, bodies, params, name, test);\r\n            };\r\n        }        \r\n        \r\n        //en funcion del número de elementos cargo un título en singular o plural\r\n\r\n        ctlResultsPanel.div.querySelector(\".prpanel-title-text\").innerText = ctlResultsPanel.getLocaleString(data.length > 1 ? 'query.titleResultPaneMany' : 'query.titleResultPanelOne', { \"numero\": data.length, \"layerName\": layername });\r\n                \r\n        ctlResultsPanel.div.classList.add(\"tc-ctl-wfsquery-results\");\r\n        \r\n        modalDialog.parentElement.removeChild(modalDialog);\r\n        \r\n        ctlResultsPanel.openTable({\r\n            data: data,\r\n            css: {\r\n                trClass: \"trClass\",\r\n                tdClass: \"tdClass\",\r\n                thClass: \"thClass\",\r\n            },\r\n            callback: function (tabla) {\r\n                \r\n                ctlResultsPanel.maximize();\r\n                console.log(\"render del panel de resultados\");\r\n                var col = tabla.getElementsByTagName(\"tr\");\r\n                var dataTypes = _getDataTypes();\r\n                var j = 1;\r\n                for (var i in data[0]) {\r\n                    if (dataTypes.hasOwnProperty(i)) {\r\n                        if (dataTypes[i].type.indexOf(\"int\") >= 0 ||\r\n                            dataTypes[i].type.indexOf(\"float\") >= 0 ||\r\n                            dataTypes[i].type.indexOf(\"double\") >= 0 ||\r\n                            dataTypes[i].type.indexOf(\"long\") >= 0 ||\r\n                            dataTypes[i].type.indexOf(\"decimal\") >= 0) {\r\n                            var tdNumeric = tabla.querySelectorAll(\"td:nth-child(\" + j + \")\");\r\n                            for (var k = 0; k < tdNumeric.length; k++) {\r\n                                tdNumeric[k].classList.add(\"tc-numeric\");\r\n                            }\r\n                        }\r\n                    }\r\n                    j++;\r\n                }\r\n\r\n                \r\n                for (var i = 0; i < col.length; i++) {\r\n                    col[i].addEventListener(\"click\", function (e) {\r\n                        e.stopPropagation();\r\n                        var index = this.dataset.index;\r\n                        if (index != undefined)\r\n                            layer.map.zoomToFeatures([layer.features[index]]);\r\n                    });\r\n                    col[i].addEventListener(\"mouseenter\", function () {\r\n                        var index = this.dataset.index;\r\n                        if (index == undefined) return;\r\n                        var feat = layer.features[index]\r\n                        if (feat && feat.geometry) {\r\n                            //feat.select();\r\n                            _select(feat);\r\n                        }\r\n                        for (var i = 0; i < this.children.length; i++) {\r\n                            var td = this.children[i];\r\n                            if (td.offsetWidth < td.scrollWidth)\r\n                                td.title = td.innerText;\r\n                        }\r\n\r\n                    });\r\n                    col[i].addEventListener(\"mouseleave\", function () {\r\n                        var index = this.dataset.index;\r\n                        if (index == undefined) return;\r\n                        var feat = layer.features[index]\r\n                        if (feat && feat.geometry) {\r\n                            //feat.unselect();\r\n                            _unselect(feat)\r\n                            //esto es porque el unselect no devulve al estilo por defecto\r\n                            //feat.setStyle(TC.Cfg.styles[feat.STYLETYPE]);\r\n                        }\r\n                    });\r\n                }\r\n                ////se deshabilita el swipe para que se pueda hacer scroll horizontal del panel de resultados\r\n                if (TC.browserFeatures.touch()) {\r\n                    TC.Util.swipe(ctlResultsPanel.div, 'disable');\r\n                }\r\n            }\r\n        });\r\n\r\n    }\r\n    var _validateQuery = function () {\r\n        return whereObjList.length > 0;\r\n    };\r\n    var _showMessage = function (Message, type) {\r\n        var messageDiv = modalBody.getElementsByClassName(\"tc-ctl-wfsquery-message\")[0];\r\n        if (timer) {\r\n            clearTimeout(timer);\r\n        }\r\n        else {\r\n            messageDiv.innerHTML=Message;\r\n            switch (type) {\r\n                case TC.Consts.msgType.INFO:\r\n                    messageDiv.classList.add(\"tc-msg-info\")\r\n                    break;\r\n                case TC.Consts.msgType.WARNING:\r\n                    messageDiv.classList.add(\"tc-msg-warning\")\r\n                    break;\r\n                case TC.Consts.msgType.ERROR:\r\n                default:\r\n                    messageDiv.classList.add(\"tc-msg-error\")\r\n                    break;\r\n            }\r\n            messageDiv.classList.remove(TC.Consts.classes.HIDDEN);\r\n        }\r\n        timer = setTimeout(function () {\r\n            timer = null;\r\n            messageDiv.classList.add(TC.Consts.classes.HIDDEN);\r\n        }, 3000)\r\n    };\r\n    var _getPossibleValues = function (field, value) {\r\n        return new Promise(function (resolve, reject) {\r\n            var _capabilities = Object.assign({}, _currentLayercapabilities);\r\n            _capabilities.version = \"1.1.0\";\r\n            switch (document.querySelector(\".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked\").value) {\r\n                case \"start\":\r\n                    value = (value + \"*\");\r\n                    break;\r\n                case \"contains\":\r\n                case \"eq\":\r\n                    value = (\"*\" + value + \"*\");\r\n                    break;\r\n                case \"end\":\r\n                    value = (\"*\" + value);\r\n                    break;\r\n            }\r\n            if (autoCompletePromise) {\r\n                autoCompletePromise = null;\r\n            }\r\n            //autoCompletePromise = TC.ajax({\r\n            //    url: _currentLayerURL + '?' + Date.now(),\r\n            //    data: TC.Util.WFSQueryBuilder([_currentLayer], TC.filter.like(field, value, undefined, undefined, undefined, false), _capabilities, \"JSON\", false),\r\n            //    contentType: \"application/xml\",\r\n            //    responseType: \"application/json\",\r\n            //    method: \"POST\",\r\n            //});\r\n            autoCompletePromise = _currentLayer.toolProxification.fetchJSON(_currentLayerURL + '?' + Date.now().toString(),{                \r\n                data: TC.Util.WFSQueryBuilder([_currentLayerName], TC.filter.like(field, value, undefined, undefined, undefined, false), _capabilities, \"JSON\", false),\r\n                contentType: \"application/xml\",                \r\n                method: \"POST\",\r\n            });\r\n            autoCompletePromise.then(function (data) {\r\n                if (data.features && data.features.length > 0) {\r\n                    var arr;\r\n                    if (data.features.length === 1)\r\n                        arr = [data.features[0].properties[field]];\r\n                    if (data.features.length > 1)\r\n                        arr = data.features.reduce(function (pv, cv) {\r\n                            if (pv && pv instanceof Array) {\r\n                                if (pv.indexOf(cv.properties[field]) < 0)\r\n                                    return pv.concat(cv.properties[field]);\r\n                                else\r\n                                    return pv;\r\n                            }\r\n                            else {\r\n                                if (pv.properties[field] === cv.properties[field])\r\n                                    return [pv.properties[field]]\r\n                                else\r\n                                    return [pv.properties[field], cv.properties[field]]\r\n                            }\r\n                        });\r\n                    //arr.sort();\r\n                    resolve(arr);\r\n                } else reject(null);\r\n            });\r\n        });\r\n    };\r\n    var _autocompleteConstructor = function (control, property, listCtrl) {\r\n\r\n        TC.UI.autocomplete.call(control, {\r\n            minLength: 3,\r\n            target: listCtrl,\r\n            source: function (text, callback) {\r\n                var _self = this;\r\n                _self.target.innerHTML = '<li><a class=\"tc-ctl-search-li-loading\" href=\"#\">' + getLocaleString(\"searching\") + '<span class=\"tc-ctl-search-loading-spinner tc-ctl-search-loading\"></span></a></li>'\r\n                _self.target.classList.remove(\"tc-hidden\");\r\n                _getPossibleValues(property, text).then(callback).catch(function () {\r\n                    _self.target.classList.add(\"tc-hidden\");\r\n                });\r\n            },\r\n            callback: function (e) {\r\n                control.value = e.currentTarget.dataset[\"value\"];\r\n                this.target.classList.add(\"tc-hidden\");\r\n            },\r\n            buildHTML: function (data) {\r\n                var pattern = control.value;\r\n                this.target.style.maxHeight = \"\";\r\n                if (data.results.length > 1)\r\n                    return data.results.reduce(function (pv, cp, i) {\r\n                        return (i > 1 ? pv : _highlightText(pv, pattern)) + _highlightText(cp, pattern);\r\n                    });\r\n                else\r\n                    return _highlightText(data.results[0], pattern);\r\n            }\r\n        });\r\n        control.addEventListener(\"targetCleared.autocomplete\", function () {\r\n            listCtrl.classList.add(\"tc-hidden\");\r\n        });\r\n        control.addEventListener('keypress', function (e) {\r\n            if (e.which == 13) {\r\n                TC.UI.autocomplete.call(control, \"clear\");\r\n            }\r\n        });\r\n        control.addEventListener(\"search\", function (e) {\r\n            if (control.value.length === 0) {\r\n                TC.UI.autocomplete.call(control, \"clear\")\r\n            }\r\n        });\r\n        control.addEventListener(\"input\", function (e) {\r\n            if (control.value.length === 0) {\r\n                TC.UI.autocomplete.call(control, \"clear\")\r\n            }\r\n        });\r\n    };\r\n    var _highlightText = function (text, pattern) {\r\n        pattern = new RegExp(pattern, \"gi\");\r\n        return \"<li><a href=\\\"#\\\" data-value=\\\"\" + text + \"\\\">\" + text.replace(pattern, '<b>$&</b>') + \"</a></li>\";\r\n    };\r\n    var _numHits = function (map) {\r\n        return new Promise(function (resolve, reject) {\r\n            var filtro = filterConstructor();\r\n            var _capabilities = Object.assign({}, _currentLayercapabilities);\r\n            _capabilities.version = \"1.1.0\";\r\n            //TC.ajax({\r\n            //    url: _currentLayerURL,\r\n            //    data: TC.Util.WFSQueryBuilder([_currentLayerName], filtro, _capabilities, null, true),\r\n            //    contentType: \"application/xml\",\r\n            //    method: \"POST\"\r\n            //})\r\n            _currentLayer.toolProxification.fetchXML(_currentLayerURL,{\r\n                data: TC.Util.WFSQueryBuilder([_currentLayerName], filtro, _capabilities, null, true, map.getCRS()),                \r\n                method: \"POST\"\r\n            }).then(function (response) {\r\n                    var capabilitiesAsJSON = xml2json(response);\r\n                if (capabilitiesAsJSON.Exception) {\r\n                    reject({\r\n                        err: capabilitiesAsJSON.Exception.exceptionCode, errorThrown: capabilitiesAsJSON.Exception.ExceptionText\r\n                    });\r\n                    return;\r\n                }\r\n                var featFounds = parseInt(capabilitiesAsJSON.numberMatched || capabilitiesAsJSON.numberOfFeatures, 10)\r\n                if (isNaN(featFounds) || featFounds >= parseInt(_maxRecordCount, 10)) {\r\n                    reject({\r\n                        err: \"NumMaxFeatures\", limit: _maxRecordCount\r\n                    });\r\n                    return;\r\n                }\r\n                else if (!isNaN(featFounds) && featFounds === 0) {\r\n                    reject({\r\n                        err: \"Empty\"\r\n                    });\r\n                    return;\r\n                }\r\n                resolve();\r\n            }).catch(function (xhr, state, message) {\r\n                reject({\r\n                    err: state, errorThrown: message\r\n                });\r\n            });\r\n        });\r\n    };\r\n    var _select = function (feature) {\r\n        var _addFeature = function (layer, feature) {\r\n            var result\r\n            if (feature instanceof TC.feature.Point) {\r\n                result = layer.addPoint(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.Polyline) {\r\n                result = layer.addPolyline(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.Polygon) {\r\n                result = layer.addPolygon(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.MultiPolygon) {\r\n                result = layer.addMultiPolygon(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.MultiPolyline) {\r\n                result = layer.addMultiPolyline(feature.getCoords());\r\n            }\r\n            return result;\r\n        };\r\n        if (!feature.layer)\r\n            return;\r\n        var layer = feature.layer.map.getLayer(\"WFSQueryResultsHighlight\");\r\n        if (!layer) {\r\n            feature.layer.map.addLayer({\r\n                id: \"WFSQueryResultsHighlight\",\r\n                type: TC.Consts.layerType.VECTOR,\r\n                stealth: true,\r\n                styles: _getHighLightStyles()\r\n            }, function (layer) {\r\n                _addFeature(layer, feature);\r\n            });\r\n        }\r\n        else\r\n            _addFeature(layer, feature);             \r\n    };\r\n    var _unselect = function (feature) {\r\n        var layer = feature.layer.map.getLayer(\"WFSQueryResultsHighlight\");\r\n        if (layer) {\r\n            layer.clearFeatures();\r\n        }\r\n    };\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.render.call(self, callback);\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (_map) {\r\n        const self = this;\r\n        map = _map;\r\n        return new Promise(function (resolve) {\r\n\r\n            //condición IF si una coleccion de atributos tiene 1 o mas elementos. Tiene una lista negra llamada excludedKeys\r\n            dust.helpers.countif = function (chunk, context, bodies, params) {\r\n                params = params || {};\r\n                var body = bodies.block, skip = bodies['else'], key = params[\"key\"] || context.current();\r\n                var excludedKeys = params.excludedKeys != null ? params.excludedKeys.split(',') : null;\r\n                var _count = 0\r\n                for (var k in key) {\r\n                    if (excludedKeys == null || excludedKeys.indexOf(k) < 0) {\r\n                        _count++;\r\n                    }\r\n                }\r\n                if (_count > 0) {\r\n                    chunk = chunk.render(body, context);\r\n                }\r\n                else if (skip) {\r\n                    chunk = chunk.render(skip, context);\r\n                }\r\n                return chunk;\r\n            }\r\n\r\n            TC.Control.prototype.register.call(self, map).then(function () {                \r\n                _getStyles = function () {\r\n                    var _default = TC.Util.extend(true, {}, TC.Cfg.styles, {\r\n                        \"polygon\": {\r\n                            fillColor: \"#ffffff\",\r\n                            fillOpacity: 0,\r\n                            strokeColor: \"#ff0000\",\r\n                            strokeWidth: 2\r\n                        },\r\n                        \"polyline\": {\r\n                            strokeColor: \"#ff0000\",\r\n                            strokeWidth: 2\r\n                        },\r\n                        \"point\": {\r\n                            strokeColor: \"#ff0000\"\r\n                        }\r\n                    });\r\n                    return self.styles ? Object.assign(_default, self.styles) : _default;\r\n                };\r\n                _getHighLightStyles = function () {\r\n                    var _default = TC.Util.extend(true, {}, TC.Cfg.styles, {\r\n                        \"polygon\": {\r\n                            fillColor: \"#0099FF\",\r\n                            fillOpacity: 0,\r\n                            strokeColor: \"#0099FF\",\r\n                            strokeWidth: 4\r\n                        },\r\n                        \"polyline\": {\r\n                            strokeColor: \"#0099FF\",\r\n                            strokeWidth: 4\r\n                        },\r\n                        \"point\": {\r\n                            strokeColor: \"#0099FF\"\r\n                        }\r\n                    });\r\n                    return self.highLightStyles ? Object.assign(_default, self.highLightStyles) : _default;\r\n                };\r\n\r\n                locale = map.options.locale;\r\n\r\n                getLocaleString = function (key, texts) {\r\n                    return TC.Util.getLocaleString(locale, key, texts);\r\n                }\r\n                resolve();\r\n            });\r\n        });\r\n    };\r\n    ctlProto.renderModalDialog = function (layer) {\r\n        var path = layer.getPath();\r\n        var renderDialogPromise = new Promise(function (resolve, reject) {\r\n            layer.getWFSCapabilitiesPromise().then(function (capabilities) {\r\n                _renderModalDialog(layer, path[path.length - 1], capabilities, function (modal) {\r\n                    resolve(modal);\r\n                });\r\n            })\r\n        });\r\n\r\n        Promise.all([layer, renderDialogPromise, layer.getWFSCapabilitiesPromise()]).then(_renderQueryForm);\r\n    };\r\n\r\n})();"]}