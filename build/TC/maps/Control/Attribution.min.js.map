{"version":3,"sources":["control/Attribution.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","Attribution","self","this","apply","arguments","apiAttribution","mainDataAttribution","dataAttributions","options","Array","inherit","ctlProto","prototype","CLASS","isDebug","template","dust","register","body_0","chk","ctx","w","f","get","x","block","body_1","body_5","body_6","s","body_7","__dustBody","h","$key","getPath","else","body_2","body_4","body_3","body_8","body_9","body_10","map","result","call","attribution","addData","obj","attr","getAttribution","test","name","site","textExists","i","length","push","removeData","Layer","workLayers","_wl","slice","reverse","url","getVisibility","checkRemoveData","index","reduce","prev","cur","idx","checkIsSameAttribution","toCheckName","baseLayer","wrap","filter","layer","type","Consts","layerType","WMS","WMTS","some","workLayerAttribution","splice","render","loaded","on","event","LAYERADD","e","isBase","BEFOREBASELAYERCHANGE","OVERVIEWBASELAYERCHANGE","newLayer","oldLayer","indexOf","ignoreLayer","LAYERREMOVE","TERRAINPROVIDERADD","terrainProvider","TERRAINPROVIDERREMOVE","LAYERVISIBILITY","callback","_set1stRenderPromise","renderData","api","mainData","otherData","isCollapsed","div","querySelector","classList","contains","classes","COLLAPSED","cmd","addEventListener","CLICK","toggleOtherAttributions","toggle"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nTC.control.Attribution = function () {\r\n    const self = this;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.apiAttribution = '';\r\n    self.mainDataAttribution = null;\r\n    self.dataAttributions = [];\r\n    if (self.options.dataAttributions) {\r\n        self.dataAttributions = self.options.dataAttributions instanceof Array ? self.options.dataAttributions : [self.options.dataAttributions];\r\n    }\r\n};\r\n\r\nTC.inherit(TC.control.Attribution, TC.Control);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Attribution.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-attrib';\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template = TC.apiLocation + \"TC/templates/Attribution.html\";\r\n    }\r\n    else {\r\n        ctlProto.template = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<div><span>&copy; \").f(ctx.get([\"api\"], false), ctx, \"h\", [\"s\"]).w(\"</span>\").x(ctx.get([\"mainData\"], false), ctx, { \"block\": body_1 }, {}).x(ctx.get([\"otherData\"], false), ctx, { \"block\": body_5 }, {}).w(\"<div class=\\\"tc-ctl-attrib-other \").x(ctx.get([\"isCollapsed\"], false), ctx, { \"block\": body_6 }, {}).w(\"\\\">\").s(ctx.get([\"otherData\"], false), ctx, { \"block\": body_7 }, {}).w(\"</div></div>\"); } body_0.__dustBody = !0; function body_1(chk, ctx) { return chk.w(\" - \").h(\"i18n\", ctx, {}, { \"$key\": \"data\" }).w(\":\").x(ctx.getPath(false, [\"mainData\", \"site\"]), ctx, { \"else\": body_2, \"block\": body_4 }, {}); } body_1.__dustBody = !0; function body_2(chk, ctx) { return chk.x(ctx.getPath(false, [\"mainData\", \"name\"]), ctx, { \"block\": body_3 }, {}); } body_2.__dustBody = !0; function body_3(chk, ctx) { return chk.w(\"<span> &copy; \").f(ctx.getPath(false, [\"mainData\", \"name\"]), ctx, \"h\").w(\"</span>\"); } body_3.__dustBody = !0; function body_4(chk, ctx) { return chk.w(\"<span> &copy; <a href=\\\"\").f(ctx.getPath(false, [\"mainData\", \"site\"]), ctx, \"h\").w(\"\\\" target=\\\"_blank\\\">\").f(ctx.getPath(false, [\"mainData\", \"name\"]), ctx, \"h\").w(\"</a></span>\"); } body_4.__dustBody = !0; function body_5(chk, ctx) { return chk.w(\" - <span class=\\\"tc-ctl-attrib-cmd\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"others\" }).w(\"...</span>\"); } body_5.__dustBody = !0; function body_6(chk, ctx) { return chk.w(\" tc-collapsed \"); } body_6.__dustBody = !0; function body_7(chk, ctx) { return chk.x(ctx.getPath(false, [\"otherData\", ctx.get([\"$idx\"], false), \"site\"]), ctx, { \"else\": body_8, \"block\": body_9 }, {}).h(\"sep\", ctx, { \"block\": body_10 }, {}); } body_7.__dustBody = !0; function body_8(chk, ctx) { return chk.w(\"<span>&copy; \").f(ctx.getPath(false, [\"otherData\", ctx.get([\"$idx\"], false), \"name\"]), ctx, \"h\").w(\"</span>\"); } body_8.__dustBody = !0; function body_9(chk, ctx) { return chk.w(\"<span>&copy; <a href=\\\"\").f(ctx.getPath(false, [\"otherData\", ctx.get([\"$idx\"], false), \"site\"]), ctx, \"h\").w(\"\\\" target=\\\"_blank\\\">\").f(ctx.getPath(false, [\"otherData\", ctx.get([\"$idx\"], false), \"name\"]), ctx, \"h\").w(\"</a></span>\"); } body_9.__dustBody = !0; function body_10(chk, ctx) { return chk.w(\", \"); } body_10.__dustBody = !0; return body_0 };\r\n    }\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self.apiAttribution = self.map.options.attribution || self.apiAttribution;\r\n\r\n        var addData = function (obj) {\r\n            if (obj) {\r\n                // TODO: sanitizer\r\n                var attr = obj.getAttribution();\r\n                if (attr) {\r\n                    if (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) {\r\n                        self.mainDataAttribution = {\r\n                            name: 'IDENA',\r\n                            site: 'http://idena.navarra.es/'\r\n                        };\r\n                    }\r\n                    else {\r\n                        var textExists = false;\r\n                        for (var i = 0; i < self.dataAttributions.length; i++) {\r\n                            if (attr.name === self.dataAttributions[i].name) {\r\n                                textExists = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (!textExists) {\r\n                            self.dataAttributions.push(attr);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        var removeData = function (obj) {\r\n            if (obj) {\r\n\r\n                var checkRemoveData = function () {\r\n                    if (obj.map.workLayers.length > 0) {\r\n                        var _wl = obj.map.workLayers.slice().reverse();\r\n                        for (var i = 0; i < _wl.length; i++) {\r\n                            if (_wl[i].url == obj.url && _wl[i].getVisibility())\r\n                                return false;\r\n                        }\r\n\r\n                        return true;\r\n                    }\r\n\r\n                    return true;\r\n                };\r\n\r\n                if (obj instanceof TC.Layer ? checkRemoveData() : true) {\r\n                    // TODO: sanitizer\r\n                    var attr = obj.getAttribution();\r\n\r\n                    if (attr) {\r\n                        var index = self.dataAttributions.reduce(function (prev, cur, idx) {\r\n                            if (cur.name === attr.name) {\r\n                                return idx;\r\n                            }\r\n                            return prev;\r\n                        }, -1);\r\n\r\n                        const checkIsSameAttribution = function (toCheckName) {\r\n                            return (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) &&\r\n                                (/IDENA/.test(toCheckName) || /Tracasa Instrumental/.test(toCheckName)) ||\r\n                                    (attr.name === toCheckName);\r\n                        };\r\n\r\n                        // Validamos si las atribuciones a borrar son también del mapa base\r\n                        if (self.map.baseLayer && self.map.baseLayer.wrap.getAttribution() && checkIsSameAttribution(self.map.baseLayer.wrap.getAttribution().name)) {\r\n                            return;\r\n                        } else {\r\n                            // Validamos si las atribuciones a borrar son también de alguna de las capas raster cargadas\r\n                            if (self.map.workLayers.filter(function (layer) {\r\n                                return layer.type === TC.Consts.layerType.WMS || layer.type === TC.Consts.layerType.WMTS;\r\n                            }).some(function (layer) {\r\n                                var workLayerAttribution = layer.wrap.getAttribution();\r\n                                return workLayerAttribution && checkIsSameAttribution(workLayerAttribution.name);\r\n                            })) {\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        if (index > -1) {\r\n                            self.dataAttributions.splice(index, 1);\r\n                        } else if (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) {\r\n                            self.mainDataAttribution = null;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        self.render();\r\n\r\n        map.loaded(function () {\r\n            if (map.baseLayer.wrap.getAttribution) {\r\n                addData(map.baseLayer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERADD, function (e) {\r\n            const layer = e.layer;\r\n            if (!layer.isBase && layer.wrap.getAttribution) {\r\n                addData(layer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.BEFOREBASELAYERCHANGE + \" \" + TC.Consts.event.OVERVIEWBASELAYERCHANGE, function (e) {\r\n            const type = e.type;\r\n            const newLayer = e.newLayer;\r\n            const oldLayer = e.oldLayer;\r\n            if (TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(type) > -1) {\r\n                self.ignoreLayer = newLayer;\r\n            }\r\n\r\n            if (oldLayer && oldLayer.wrap.getAttribution) {\r\n                removeData(oldLayer.wrap);\r\n            }\r\n\r\n            if (newLayer && newLayer.wrap.getAttribution) {\r\n                addData(newLayer.wrap);\r\n            }\r\n\r\n            self.render();\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERREMOVE, function (e) {\r\n            const layer = e.layer;\r\n            if (layer.wrap.getAttribution) {\r\n                removeData(layer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.TERRAINPROVIDERADD, function (e) {\r\n            const terrainProvider = e.terrainProvider;\r\n            if (terrainProvider.getAttribution) {\r\n                addData(terrainProvider);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.TERRAINPROVIDERREMOVE, function (e) {\r\n            const terrainProvider = e.terrainProvider;\r\n            if (terrainProvider.getAttribution) {\r\n                removeData(terrainProvider);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERVISIBILITY, function (e) {\r\n            const layer = e.layer;\r\n            if (self.ignoreLayer === layer) {\r\n                return;\r\n            }\r\n\r\n            if (layer.wrap.getAttribution) {\r\n                if (layer.getVisibility()) {\r\n                    addData(layer.wrap);\r\n                } else {\r\n                    removeData(layer.wrap);\r\n                }\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n\r\n        return self._set1stRenderPromise(self.renderData({\r\n            api: self.apiAttribution,\r\n            mainData: self.mainDataAttribution,\r\n            otherData: self.dataAttributions,\r\n            isCollapsed: self.div.querySelector('.' + self.CLASS + '-other') ? self.div.querySelector('.' + self.CLASS + '-other').classList.contains(TC.Consts.classes.COLLAPSED) : true\r\n        }, function () {\r\n            const cmd = self.div.querySelector('.' + self.CLASS + '-cmd');\r\n            cmd && cmd.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.toggleOtherAttributions();\r\n            });\r\n\r\n            if (typeof callback === 'function') {\r\n                callback();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.toggleOtherAttributions = function () {\r\n        const self = this;\r\n        const other = self.div.querySelector('.' + self.CLASS + '-other');\r\n        other.classList.toggle(TC.Consts.classes.COLLAPSED);\r\n    };\r\n})();\r\n"]}