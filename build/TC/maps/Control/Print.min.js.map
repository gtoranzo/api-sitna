{"version":3,"sources":["Control/Print.js"],"names":["TC","control","Consts","classes","PRINTABLE","Print","options","self","this","opts","ready","title","Util","getLocaleString","Cfg","locale","cssUrl","apiLocation","target","querySelector","CLASS","key","template","dust","cache","classList","add","renderPage","e","page","open","content","innerHTML","render","err","out","document","write","close","focus","error","firstChild","insertAdjacentHTML","addEventListener","ctlProto","prototype","register","body_0","chk","ctx","w","h","$key","__dustBody","f","get"],"mappings":"AAACA,GAAGC,QAAUD,GAAGC,YAEjBD,GAAGE,OAAOC,QAAQC,UAAY,eAK9BJ,GAAGC,QAAQI,MAAQ,SAAUC,GAEzB,IAAIC,EAAOC,KACPC,EAAOH,MAEXC,EAAKG,OAAQ,EAEbH,EAAKI,MAAQF,EAAKE,OAASX,GAAGY,KAAKC,gBAAgBb,GAAGc,IAAIC,OAAQ,aAClER,EAAKS,OAASP,EAAKO,QAAUhB,GAAGiB,YAAc,mBAE9C,GAAIR,EAAKS,OACT,CACI,MAAMA,EAAST,EAAKS,OAEpB,IAAKA,EAAOC,cAAc,IAAMZ,EAAKa,MAAQ,QAAS,CAClD,IAAK,IAAIC,KAAOd,EAAKe,SACZC,KAAKC,MAAMH,IACZd,EAAKe,SAASD,KAItBH,EAAOO,UAAUC,IAAI1B,GAAGE,OAAOC,QAAQC,WAEvC,IAAIuB,EAAa,SAAUC,GACvB,IAAIC,EAAOC,KAAK,KAAMvB,EAAKa,OACvBW,EAAUb,EAAOc,UACrBT,KAAKU,OAAO1B,EAAKa,MAAQ,SAAWT,MAAOJ,EAAKI,MAAOoB,QAASA,EAASf,OAAQT,EAAKS,QAAU,SAAUkB,EAAKC,GAC3GN,EAAKO,SAASC,MAAMF,GACpBN,EAAKO,SAASE,QACdT,EAAKU,QACDL,GACAlC,GAAGwC,MAAMN,MAIrBX,KAAKU,OAAO1B,EAAKa,MAAO,KAAM,SAAUc,EAAKC,GACrCjB,EAAOuB,WACPvB,EAAOuB,WAAWC,mBAAmB,cAAeP,GAGpDjB,EAAOc,UAAYG,EAEvBjB,EAAOC,cAAc,IAAMZ,EAAKa,MAAQ,QAAQuB,iBAAiB,QAAShB,SAM1F,WACI,IAAIiB,EAAW5C,GAAGC,QAAQI,MAAMwC,UAEhCD,EAASxB,MAAQ,eAEjBwB,EAAStB,YAOLsB,EAAStB,SAASsB,EAASxB,OAAS,WAAcG,KAAKuB,SAASF,EAASxB,MAAO2B,GAAS,SAASA,EAAOC,EAAKC,GAAO,OAAOD,EAAIE,EAAE,uCAA0CC,EAAE,OAAQF,MAAWG,KAAQ,oBAAqBF,EAAE,MAAOC,EAAE,OAAQF,MAAWG,KAAQ,UAAWF,EAAE,QAAWH,EAAOM,YAAa,EAAI,OAAON,GAC3TH,EAAStB,SAASsB,EAASxB,MAAQ,SAAW,WAAcG,KAAKuB,SAASF,EAASxB,MAAQ,QAAS2B,GAAS,SAASA,EAAOC,EAAKC,GAAO,OAAOD,EAAIE,EAAE,2EAA6EI,EAAEL,EAAIM,KAAK,UAAU,GAAQN,EAAK,KAAKC,EAAE,yCAA4CI,EAAEL,EAAIM,KAAK,WAAW,GAAQN,EAAK,KAAKC,EAAE,oEAAyEI,EAAEL,EAAIM,KAAK,UAAU,GAAQN,EAAK,KAAKC,EAAE,SAASI,EAAEL,EAAIM,KAAK,YAAY,GAAQN,EAAK,KAAM,MAAMC,EAAE,kBAAqBH,EAAOM,YAAa,EAAI,OAAON,GAb3kB","sourcesContent":["TC.control = TC.control || {};\r\n\r\nTC.Consts.classes.PRINTABLE = 'tc-printable';\r\n\r\n\r\n\r\n\r\nTC.control.Print = function (options)\r\n{\r\n    var self = this;\r\n    var opts = options || {};\r\n\r\n    self.ready = false;\r\n\r\n    self.title = opts.title || TC.Util.getLocaleString(TC.Cfg.locale, 'printPage');\r\n    self.cssUrl = opts.cssUrl || TC.apiLocation + 'TC/css/print.css';\r\n\r\n    if (opts.target)\r\n    {\r\n        const target = opts.target;\r\n\r\n        if (!target.querySelector('.' + self.CLASS + '-btn')) {\r\n            for (var key in self.template) {\r\n                if (!dust.cache[key]) {\r\n                    self.template[key]();\r\n                }\r\n            }\r\n            \r\n            target.classList.add(TC.Consts.classes.PRINTABLE);\r\n\r\n            var renderPage = function (e) {\r\n                var page = open(null, self.CLASS);\r\n                var content = target.innerHTML;\r\n                dust.render(self.CLASS + '-page', { title: self.title, content: content, cssUrl: self.cssUrl }, function (err, out) {\r\n                    page.document.write(out);\r\n                    page.document.close();\r\n                    page.focus();\r\n                    if (err) {\r\n                        TC.error(err);\r\n                    }\r\n                });\r\n            };\r\n            dust.render(self.CLASS, null, function (err, out) {\r\n                if (target.firstChild) {\r\n                    target.firstChild.insertAdjacentHTML('beforebegin', out);\r\n                }\r\n                else {\r\n                    target.innerHTML = out;\r\n                }\r\n                target.querySelector('.' + self.CLASS + '-btn').addEventListener('click', renderPage);\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Print.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-print';\r\n\r\n    ctlProto.template = {};\r\n\r\n    //if (TC.isDebug) {\r\n    //    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/Print.html\";\r\n    //    ctlProto.template[ctlProto.CLASS + '-page'] = TC.apiLocation + \"TC/templates/PrintPage.html\";\r\n    //}\r\n    //else {\r\n        ctlProto.template[ctlProto.CLASS] = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<a class=\\\"tc-ctl-print-btn\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"printThisWindow\" }).w(\"\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"print\" }).w(\"</a>\"); } body_0.__dustBody = !0; return body_0 };\r\n        ctlProto.template[ctlProto.CLASS + '-page'] = function () { dust.register(ctlProto.CLASS + '-page', body_0); function body_0(chk, ctx) { return chk.w(\"<!DOCTYPE html><html xmlns=\\\"http://www.w3.org/1999/xhtml\\\"><head><title>\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</title><link rel=\\\"stylesheet\\\" href=\\\"\").f(ctx.get([\"cssUrl\"], false), ctx, \"h\").w(\"\\\" /></head><body onload=\\\"print()\\\" class=\\\"tc-ctl-print-page\\\"><h1>\").f(ctx.get([\"title\"], false), ctx, \"h\").w(\"</h1>\").f(ctx.get([\"content\"], false), ctx, \"h\", [\"s\"]).w(\"</body></html>\"); } body_0.__dustBody = !0; return body_0 };\r\n    //}\r\n\r\n})();"],"file":"../../Control/Print.min.js"}