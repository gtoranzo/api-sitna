{"version":3,"sources":["control/Search.js"],"names":["window","performance","now","offset","Date","this","TC","control","Control","syncLoadJS","apiLocation","SearchType","type","options","parent","self","_featureTypes","Util","extend","typeName","_throwConfigError","Error","getFeatureTypes","toFilter","featureType","Array","length","type_featureType","type_renderFeatureType","renderFeatureType","concat","isFeatureOfThisType","id","indexOf","getStyleByFeatureType","styles","getColor","css","geomType","getValue","style","hasOwnProperty","i","color","getSuggestionListHead","headerData","label","suggestionListHead","title","getLocaleString","call","featureTypes","map","elm","liHTML","join","getSuggestionListElements","data","results","areSame","a","b","isNaN","trim","getUnique","inputArray","outputArray","push","parseFeatures","forEach","feature","attributes","ids","valueToAdd","properties","outputProperties","dataIdProperties","dataIdProperty","strFormat","outputFormatLabel","dataLayer","split","slice","shift","j","compareData","p","tcFormat","text","toCamelCase","r","isThere","property","filter","dataRole","outputFormat","Consts","format","JSON","wrap","parser","WFS","featureNS","featurePrefix","read","getPattern","pattern","bindRootFilterNode","filtersArr","dataT","rootFilters","rootCfg","active","root","limit","item","getFilterNode","filterNode","queryProperties","firstQueryWord","queryWord","index","_LIKE_PATTERN","getPropertyValue","role","propertyName","getSearchTypeByRole","getIsLikeNode","name","value","toEscape","test","replace","toString","toLowerCase","toUpperCase","getFunctionStrMatches","propertyValue","fn","filterByMatch","regex","RegExp","_MATCH_PATTERN","f","key","propName","getFilter","multiL","searchType","NUMBER","_f","exec","t","s","secondQueryWord","match","substring","thirdQueryWord","STREET","LOCALITY","getParams","filters","params","REQUEST","SERVICE","MAXFEATURES","VERSION","version","OUTPUTFORMAT","ft","TYPENAME","_getProperties","Object","prop","_properties","_ids","PROPERTYNAME","FILTER","getParamString","getGoToFilter","props","_id","source","src","transformFilter","equalTo","comparison","EQUAL_TO","and","apply","Search","arguments","exportsState","event","TOOLSCLOSE","url","UTMX","UTMY","LON","LAT","UTMX_LABEL","UTMY_LABEL","LON_LABEL","LAT_LABEL","MUN","POL","PAR","MUN_LABEL","POL_LABEL","PAR_LABEL","availableSearchTypes","CADASTRAL","suggestionRoot","geometryName","searchWeight","municipality","labelProperty","idProperty","CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta","polygon","fillColor","fillOpacity","strokeColor","strokeWidth","strokeOpacity","getCadastralRef","goTo","goToCadastralRef","goToIdFormat","idPropertiesIdentifier","COORDINATES","getCoordinates","goToCoordinates","QUERYWORD","FIRST","SECOND","THIRD","MUNICIPALITY","getStringPattern","bind","stringPatternToCheck","stringPatternsValidators","s_or_t","goToStringPattern","COUNCIL","line","strokeLinecap","strokeDashstyle","point","angle","fontColor","fontSize","fontWeight","labelOutlineColor","labelOutlineWidth","radius","URBAN","PLACENAME","PLACENAMEMUNICIPALITY","COMMONWEALTH","ROAD","getRoad","goToRoad","ROADPK","getPK","goToPK","getRootLabel","Promise","resolve","reject","rootLabel","CQL_FILTER","elem","ajax","method","responseType","mimeType","then","response","totalFeatures","features","catch","allowedSearchTypes","allowed","isEmptyObject","rootType","addAllowedSearchType","queryableFeatures","UTMX_LEN","UTMY_LEN","interval","NORMAL_PATTERNS","ROMAN_NUMBER","ABSOLUTE_NOT_DOT","ABSOLUTE","inherit","ctlProto","prototype","CLASS","SEARCHQUERYEMPTY","isDebug","template","dust","register","body_0","chk","ctx","w","h","$key","__dustBody","result","_search","layerStyleFN","getFeatureType","idFeature","getStyle","getSearchTypeByFeature","Cfg","extractValue","Feature","trigger","FEATURESADD","layer","geom","values","getData","styleFN","layerPromise","addLayer","getUID","stealth","declutter","layerType","VECTOR","marker","anchor","Defaults","height","width","EMPTY_RESULTS_LABEL","EMPTY_RESULTS_TITLE","OUTBBX_LABEL","WFS_TYPE_ATTRS","renderData","callback","search","textInput","list","_goToResult","resultsList","querySelector","getAttribute","classList","add","classes","HIDDEN","_research","textContent","lastPattern","unescape","div","placeHolder","setAttribute","button","addEventListener","CLICK","getLayer","l","querySelectorAll","zoomToFeatures","dispatchEvent","Event","instructions","EventTarget","listenerBySelector","focus","e","which","preventDefault","stopPropagation","remove","retryTimeout","loadJS","UI","autocomplete","searchDelay","link","target","minLength","lastpress","requestAnimationFrame","step","criteria","cancelAnimationFrame","undefined","_target","tagName","el","selector","matchesSelector","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","parentElement","closest","parentNode","buildHTML","html","dataRoles","reA","reN","sortAlphaNum","AInt","parseInt","BInt","aA","bA","aN","bN","sort","sort_","aRoot","bRoot","first","highlighting","strReg","normalizedLastPattern","querys","separatorChar","q","_strReg","st","rex","encodeURIComponent","onKeydown","ctrlKey","altKey","shiftKey","keyCode","document","activeElement","sibling","nextElementSibling","getNextSibling","previousElementSibling","getPreviousSibling","isFunction","getElementOnSuggestionList","getFeatures","cleanMap","clearFeatures","FEATUREREMOVE","getMunicipalities","cache","_municipalitiesPromise","municipalities","coords","parseCoords","xValue","yValue","xLabel","UTM","yLabel","getPoint","insideLimit","crs","getLabel","_pattern","matcher","getItem","mun","munLabel","pol","par","removePunctuation","tsp","getPortal","formatStreetNumber","bindRoot","spt","tnsp","ts","reverse","getStreet","revS","fs","si","_criteria","isPortal","c","x","_cr","inPortal","criteriaRev","chs","sp","snp","isCheck","check","m","ch","addRoot","indicatedRoot","newResult","splice","getObjectsFromStringToQuery","allowedRoles","charAt","tests","ex","error","msgErrorMode","EMAIL","getResultsFromWFS","objectsToQuery","request","keys","doneCallback","innerHTML","CustomEvent","statusText","alert","all","combinedCriteria","bothSearchObjects","some","outputProperty","console","log","waiting","_a","_b","loading","getControlsByClass","wait","addWait","matchMedia","blur","customSearchType","keepOnLooping","dr","removeWait","on","showsPopup","refresh","one","LAYERUPDATE","getSource","bounds","getExtent","pointBoundsRadius","setExtent","ZOOMTO","extent","inner","emptyResultHTML","newData","goToResult","promise","addMarker","group","feat","maxFeatures","isMapGeo","isGeo","parseFloat","reproject","utmCrs","geoCrs","getIntersectsBounds","maxExtent","locale","getMapLocale","toLocaleString","localeDecimalSeparator","Number","isInteger","á","à","Á","À","é","è","É","È","í","ì","Í","Ì","ó","ò","Ó","Ò","ú","ù","ü","Ú","Ù","Ü","len","exportState","searchText","exportStyles","importState","state","setStyle","String","args","number","splitRemoveWhiteSpaces","separator","_arr","arr","_value","defineProperty","enumerable","writable","endsWith","searchString","position","subjectString","isFinite","Math","floor","lastIndex"],"mappings":"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","sourcesContent":["(function () {\r\n    // Polyfill window.performance.now\r\n    if (!window.performance) {\r\n        window.performance = {\r\n            offset: Date.now(),\r\n            now: function () {\r\n                return Date.now() - this.offset;\r\n            }\r\n        };\r\n    } else if (window.performance && !window.performance.now) {\r\n        window.performance.offset = Date.now();\r\n        window.performance.now = function () {\r\n            return Date.now() - window.performance.offset;\r\n        };\r\n    }\r\n}());\r\n\r\nTC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\n\r\nvar SearchType = function (type, options, parent) {\r\n    var self = this;\r\n\r\n    self.parent = parent;\r\n\r\n    self._featureTypes = [];\r\n\r\n    TC.Util.extend(self, options);\r\n\r\n    self.typeName = type;\r\n\r\n    self._throwConfigError = function () {\r\n        var self = this;\r\n\r\n        throw new Error('Error en la configuración de la búsqueda: ' + self.typeName);\r\n    };\r\n\r\n    self.getFeatureTypes = function (toFilter) {\r\n        var self = this;\r\n\r\n        if (toFilter) {\r\n            return self.featureType instanceof Array ? self.featureType : [self.featureType];\r\n        }\r\n\r\n        if (self._featureTypes.length === 0) {\r\n            var type_featureType = self.featureType instanceof Array ? self.featureType : [self.featureType];\r\n            var type_renderFeatureType = self.renderFeatureType ? self.renderFeatureType instanceof Array ? self.renderFeatureType : [self.renderFeatureType] : [];\r\n            self._featureTypes = type_featureType.concat(type_renderFeatureType);\r\n        }\r\n\r\n        return self._featureTypes;\r\n    };\r\n\r\n    self.isFeatureOfThisType = function (id) {\r\n        var self = this;\r\n\r\n        return self.getFeatureTypes().indexOf(id) > -1;\r\n    };\r\n\r\n    self.getStyleByFeatureType = function (featureType) {\r\n        var self = this;\r\n\r\n        if (self.getFeatureTypes().indexOf(featureType) > -1) {\r\n            return self.styles[self.getFeatureTypes().indexOf(featureType)];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    var getColor = function (css, geomType, featureType) {\r\n        var self = this;\r\n\r\n        var getValue = function (style, geomType, css) {\r\n            if (geomType) {\r\n                if (style.hasOwnProperty(geomType) && style[geomType].hasOwnProperty(css)) {\r\n                    return style[geomType][css];\r\n                }\r\n            } else {\r\n                for (var geomType in style) {\r\n                    if (style[geomType].hasOwnProperty(css)) {\r\n                        return style[geomType][css];\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        if (featureType) {\r\n            var style = self.getStyleByFeatureType(featureType);\r\n            return getValue(style, geomType, css);\r\n        } else {\r\n            for (var i = 0; i < self.styles.length; i++) {\r\n                var style = self.styles[i];\r\n                var color = getValue(style, geomType, css);\r\n                if (color) {\r\n                    return color;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    self.getSuggestionListHead = function () {\r\n        var self = this;\r\n\r\n        var headerData, label, color;\r\n\r\n        if (typeof self.suggestionListHead === \"function\") {\r\n            headerData = self.suggestionListHead();\r\n            label = headerData.label;\r\n            color = [{\r\n                color: headerData.color,\r\n                title: headerData.label\r\n            }];\r\n        } else {\r\n            headerData = self.suggestionListHead;\r\n            label = self.parent.getLocaleString(headerData.label);\r\n\r\n            // color es string que es el atributo CSS. El valor se obtiene de la 1º coincidencia encontrada en styles\r\n            if (typeof headerData.color === \"string\") {\r\n                color = [{\r\n                    color: getColor.call(self, headerData.color),\r\n                    title: label\r\n                }];\r\n            } else if (headerData.color instanceof Array) { // color es un array de objetos, con nombre de featureType como clave\r\n                var featureTypes = self.getFeatureTypes();\r\n                if (headerData.color.length === featureTypes.length) {\r\n                    color = headerData.color.map(function (elm, i) {\r\n                        return {\r\n                            color: getColor.call(self, elm[featureTypes[i]].color.css, elm[featureTypes[i]].color.geomType, featureTypes[i]),\r\n                            title: self.parent.getLocaleString(elm[featureTypes[i]].title) || label\r\n                        }\r\n                    });\r\n                } else {\r\n                    self._throwConfigError();\r\n                }\r\n            } else if (typeof headerData.color === \"object\") { // color es un objeto con atributo css y tipo de geometría\r\n                color = [{\r\n                    color: getColor.call(self, headerData.color.css, headerData.color.geomType),\r\n                    title: label\r\n                }];\r\n            }\r\n        }\r\n\r\n        if (label && color) {\r\n            var liHTML = '<li header><span class=\"header\">' + label + '</span>';\r\n\r\n            liHTML += color.map(function (elm) {\r\n                if (elm.color) {\r\n                    return '<span class=\"header-color\" title=\"' + elm.title + '\" style=\"color: ' + elm.color + ';\"></span>';\r\n                }\r\n            }).join('') + '</li>';\r\n\r\n            return liHTML;\r\n\r\n        } else {\r\n            self._throwConfigError();\r\n        }\r\n    };\r\n\r\n    self.getSuggestionListElements = function (data) {\r\n        var self = this;\r\n        var results = [];\r\n\r\n        var areSame = function (a, b) {\r\n            switch (true) {\r\n                case typeof (a) === \"number\":\r\n                    if (a === b) {\r\n                        return true;\r\n                    }\r\n                    break;\r\n                case typeof (a) === \"string\":\r\n                    if (!isNaN(a) || !isNaN(b)) {\r\n                        if (a === b) {\r\n                            return true;\r\n                        }\r\n                    } else {\r\n                        if (a.trim() === b.trim()) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            return false;\r\n        };\r\n        var getUnique = function (inputArray) {\r\n            var outputArray = [];\r\n            for (var i = 0; i < inputArray.length; i++) {\r\n                if (outputArray.indexOf(inputArray[i]) === -1) {\r\n                    outputArray.push(inputArray[i]);\r\n                }\r\n            }\r\n\r\n            return outputArray;\r\n        };\r\n        var intoResults = function (compareData) {\r\n            for (var r = 0; r < results.length; r++) {\r\n                var length = 0;\r\n                var isThere = [];\r\n                for (var property in compareData) {\r\n                    isThere.push(areSame(compareData[property], results[r].properties[property]));\r\n                    length++;\r\n                }\r\n                if (isThere.filter(function (i) { return i; }).length === length) {\r\n                    return true;\r\n                }\r\n\r\n            }\r\n\r\n            return false;\r\n        };\r\n\r\n        var features = self.parseFeatures(data);\r\n\r\n        features.forEach(function (feature) {\r\n            var attributes = [], ids = [];\r\n            var valueToAdd = '';\r\n\r\n            var properties = self.outputProperties;\r\n            var dataIdProperties = self.dataIdProperty;\r\n\r\n            var strFormat = self.outputFormatLabel;\r\n            var dataLayer = feature.id.split('.').slice(0, 1).shift();\r\n\r\n            if (!(self.outputProperties instanceof Array)) {\r\n                properties = self.outputProperties[dataLayer];\r\n                dataIdProperties = self.dataIdProperty[dataLayer];\r\n                strFormat = strFormat[dataLayer];\r\n            }\r\n\r\n            for (var j = 0; j < properties.length; j++) {\r\n                attributes.push(feature.data[properties[j]]);\r\n            }\r\n\r\n            for (var j = 0; j < dataIdProperties.length; j++) {\r\n                ids.push(feature.data[dataIdProperties[j]]);\r\n            }\r\n\r\n            var compareData = {};\r\n            for (var p = 0; p < self.outputProperties.length; p++) {\r\n                compareData[self.outputProperties[p]] = attributes[p];\r\n            }\r\n\r\n            if (attributes instanceof Array && strFormat && getUnique(attributes).length > 1) {\r\n                valueToAdd = strFormat.tcFormat(attributes);\r\n            }\r\n            else if (attributes instanceof Array && getUnique(attributes).length == 1) {\r\n                valueToAdd = attributes[0];\r\n            }\r\n\r\n            var text = valueToAdd.toCamelCase();\r\n\r\n            if (!(intoResults(compareData))) {\r\n\r\n                results.push({\r\n                    text: text,\r\n                    label: text,\r\n                    id: ids.join('#'),\r\n                    dataRole: self.typeName,\r\n                    dataLayer: dataLayer,\r\n                    properties: compareData\r\n                });\r\n            }\r\n        });\r\n\r\n        return results;\r\n    };\r\n\r\n    self.parseFeatures = function (data) {\r\n        var parser;\r\n        if (self.outputFormat === TC.Consts.format.JSON) {\r\n            parser = new TC.wrap.parser.JSON();\r\n        }\r\n        else {\r\n            parser = new TC.wrap.parser.WFS({\r\n                featureNS: self.featurePrefix,\r\n                featureType: self.featureType\r\n            });\r\n        }\r\n        return parser.read(data);\r\n    };\r\n\r\n    self.getPattern = function () {\r\n        var self = this;\r\n\r\n        if (typeof self.pattern === \"function\") {\r\n            return self.pattern();\r\n        } else {\r\n            return self.pattern;\r\n        }\r\n    };\r\n\r\n    self.filter = (function (self) {\r\n\r\n        const bindRootFilterNode = function (filtersArr, dataT) {\r\n            var rootFilters = [];\r\n\r\n            if (dataT != self.parent.rootCfg.active.root) {\r\n                // GLS: Si llego aquí, significa que el usuario está indicando la población\r\n                if (dataT.indexOf('#') === -1 && !self.parent.rootCfg.active.limit) { // si no está limitada la búsqueda, indico la población\r\n\r\n                    var filterNode = self.parent.rootCfg.active.queryProperties.firstQueryWord.map(function (queryWord, index) {\r\n                        return self.filter.getFilterNode(queryWord, self.parent._LIKE_PATTERN + dataT + self.parent._LIKE_PATTERN);\r\n                    });\r\n\r\n                    if (filterNode.length > 1) {\r\n                        rootFilters.push('<ogc:And>');\r\n                        rootFilters = rootFilters.concat(filterNode);\r\n                        rootFilters.push('</ogc:And>');\r\n                    } else {\r\n                        rootFilters = rootFilters.concat(filterNode);\r\n                    }\r\n\r\n                } else { // por tanto no añado todas las raíces posibles, añado la población que ha indicado (validando antes contra rootLabel)                     \r\n                    var item = dataT.split('#');\r\n\r\n                    for (var j = 0; j < self.parent.rootCfg.active.dataIdProperty.length; j++) {\r\n\r\n                        if (j == 0 && self.parent.rootCfg.active.dataIdProperty.length > 1) {\r\n                            rootFilters.push('<ogc:And>');\r\n                        }\r\n\r\n                        rootFilters.push(self.filter.getFilterNode(self.parent.rootCfg.active.dataIdProperty[j], item.length > j ? item[j] : item[0]));\r\n\r\n                        if (j == self.parent.rootCfg.active.dataIdProperty.length - 1 && self.parent.rootCfg.active.dataIdProperty.length > 1) {\r\n                            rootFilters.push('</ogc:And>');\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                for (var i = 0; i < self.parent.rootCfg.active.root.length; i++) {\r\n                    var item = self.parent.rootCfg.active.root[i];\r\n\r\n                    if (i == 0 && self.parent.rootCfg.active.root.length > 1) {\r\n                        rootFilters.push('<ogc:Or>');\r\n                    }\r\n\r\n                    for (var j = 0; j < self.parent.rootCfg.active.dataIdProperty.length; j++) {\r\n\r\n                        if (j == 0 && self.parent.rootCfg.active.dataIdProperty.length > 1) {\r\n                            rootFilters.push('<ogc:And>');\r\n                        }\r\n\r\n                        rootFilters.push(self.filter.getFilterNode(self.parent.rootCfg.active.dataIdProperty[j], item.length > j ? item[j] : item[0]));\r\n\r\n                        if (j == self.parent.rootCfg.active.dataIdProperty.length - 1 && self.parent.rootCfg.active.dataIdProperty.length > 1) {\r\n                            rootFilters.push('</ogc:And>');\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (self.parent.rootCfg.active.root.length > 1) {\r\n                    rootFilters.push('</ogc:Or>');\r\n                }\r\n            }\r\n\r\n            return filtersArr.concat(rootFilters);\r\n        };\r\n\r\n        return {\r\n            getPropertyValue: function (role, propertyName) {\r\n                return self.getSearchTypeByRole(role)[propertyName];\r\n            },\r\n            getIsLikeNode: function (name, value) {\r\n                var toEscape = /([\\-\\\"\\.\\xba\\(\\)\\/])/g;\r\n                if (toEscape.test(value)) {\r\n                    value = value.replace(toEscape, \"\\\\$1\");\r\n                }\r\n\r\n                if (value.toString().indexOf(self.parent._LIKE_PATTERN) > -1)\r\n                    return '<Or><PropertyIsLike escape=\"\\\\\" singleChar=\"_\" wildCard=\"*\" matchCase=\"false\">' +\r\n                        '<PropertyName>' + name + '</PropertyName>' +\r\n                        '<Literal>' + value.toLowerCase().replace(/\\</gi, \"&lt;\").replace(/\\>/gi, \"&gt;\") + '</Literal>' +\r\n                        '</PropertyIsLike>' +\r\n                        '<PropertyIsLike escape=\"\\\\\" singleChar=\"_\" wildCard=\"*\" matchCase=\"false\">' +\r\n                        '<PropertyName>' + name + '</PropertyName>' +\r\n                        '<Literal>' + value.toUpperCase().replace(/\\</gi, \"&lt;\").replace(/\\>/gi, \"&gt;\") + '</Literal>' +\r\n                        '</PropertyIsLike></Or>';\r\n                else\r\n                    return '<PropertyIsEqualTo>' +\r\n                        '<PropertyName>' + name + '</PropertyName>' +\r\n                        '<Literal>' + value.replace(/\\</gi, \"&lt;\").replace(/\\>/gi, \"&gt;\") + '</Literal>' +\r\n                        '</PropertyIsEqualTo>';\r\n            },\r\n            getFunctionStrMatches: function (name, value) {\r\n                var toEscape = /([\\-\\\"\\xba\\(\\)\\/])/g;\r\n                if (toEscape.test(value)) {\r\n                    value = value.replace(toEscape, \"\\\\$1\");\r\n                }\r\n\r\n                if (value.toString().indexOf(self.parent._LIKE_PATTERN) > -1) {\r\n\r\n                    var pattern = value;\r\n                    pattern = pattern.replace(/a/gi, \"[aáà]\");\r\n                    pattern = pattern.replace(/e/gi, \"[eéè]\");\r\n                    pattern = pattern.replace(/i/gi, \"[iíì]\");\r\n                    pattern = pattern.replace(/o/gi, \"[oóò]\");\r\n                    pattern = pattern.replace(/u/gi, \"[uúüù]\");\r\n\r\n                    return '<ogc:PropertyIsEqualTo> ' +\r\n                        '<ogc:Function name=\"strMatches\"> ' +\r\n                        '<ogc:PropertyName>' + name + '</ogc:PropertyName> ' +\r\n                        '<ogc:Literal>' + '(?i)' + pattern.replace(/\\</gi, \"&lt;\").replace(/\\>/gi, \"&gt;\") + '</ogc:Literal> ' +\r\n                        '</ogc:Function> ' +\r\n                        '<ogc:Literal>true</ogc:Literal> ' +\r\n                        '</ogc:PropertyIsEqualTo>';\r\n                }\r\n                else {\r\n                    return '<PropertyIsEqualTo>' +\r\n                        '<PropertyName>' + name + '</PropertyName>' +\r\n                        '<Literal>' + value.replace(/\\</gi, \"&lt;\").replace(/\\>/gi, \"&gt;\") + '</Literal>' +\r\n                        '</PropertyIsEqualTo>';\r\n                }\r\n            },\r\n            getFilterNode: function (propertyName, propertyValue) {\r\n                var r;\r\n\r\n                var fn = self.filter.getIsLikeNode;\r\n\r\n                if (self.filterByMatch) {\r\n\r\n                    fn = self.filter.getFunctionStrMatches;\r\n\r\n                    var regex = new RegExp('\\\\' + self.parent._LIKE_PATTERN, 'gi');\r\n                    propertyValue = propertyValue.replace(regex, self.parent._MATCH_PATTERN);\r\n                }\r\n\r\n                if (!(propertyName instanceof Array) && (typeof propertyName !== 'string')) {\r\n                    var f = [];\r\n                    for (var key in propertyName) {\r\n                        if ((propertyName[key] instanceof Array) && propertyName[key].length > 1) {\r\n                            r = '<Or>';\r\n                            for (var i = 0; i < propertyName[key].length; i++) {\r\n                                r += fn(propertyName[key][i].trim(), propertyValue);\r\n                            }\r\n\r\n                            r += '</Or>';\r\n                            f.push('(<Filter xmlns=\"http://www.opengis.net/ogc\">' + r + '</Filter>)');\r\n                        } else {\r\n                            var propName = propertyName[key];\r\n                            if ((propertyName[key] instanceof Array) && propertyName[key].length == 1)\r\n                                propName = propertyName[key][0];\r\n\r\n                            f.push('(<Filter xmlns=\"http://www.opengis.net/ogc\">' +\r\n                                '<Or>' + fn(propName.trim(), propertyValue) + '</Or>' +\r\n                                '</Filter>)');\r\n                        }\r\n                    }\r\n\r\n                    return f.join('');\r\n\r\n                } else if (propertyName instanceof Array && propertyName.length > 1) {\r\n                    r = '<ogc:Or>';\r\n                    for (var i = 0; i < propertyName.length; i++) {\r\n                        r += fn(propertyName[i].trim(), propertyValue);\r\n                    }\r\n\r\n                    return r += '</ogc:Or>';\r\n                } else\r\n                    return fn((propertyName instanceof Array && propertyName.length === 1 ? propertyName[0].trim() : propertyName.trim()), propertyValue);\r\n            },\r\n            getFilter: function (data) {\r\n                var r = {};\r\n                r.multiL = false;\r\n                r.f = '';\r\n\r\n                var _f;\r\n\r\n                switch (true) {\r\n                    case self.typeName === TC.Consts.searchType.NUMBER:\r\n                        _f = [];\r\n                        if (!(self.parent.rootCfg.active) && (/(\\<|\\>|\\<\\>)/gi.exec(data.t) || /(\\<|\\>|\\<\\>)/gi.exec(data.s))) {\r\n                            var match = /(\\<|\\>|\\<\\>)/gi.exec(data.t);\r\n                            if (match)\r\n\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t.substring(0, data.t.indexOf(match[0])).trim() + self.parent._LIKE_PATTERN));\r\n                            else {\r\n                                if (self.parent.rootCfg.active) {\r\n                                    _f = bindRootFilterNode(_f, data.t);\r\n                                }\r\n                                else {\r\n                                    _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN));\r\n                                }\r\n                            }\r\n\r\n                            match = /(\\<|\\>|\\<\\>)/gi.exec(data.s);\r\n                            if (match)\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s.substring(0, data.s.indexOf(match[0])).trim() + self.parent._LIKE_PATTERN));\r\n                            else _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s + self.parent._LIKE_PATTERN));\r\n                        }\r\n                        else {\r\n                            if (self.parent.rootCfg.active) {\r\n                                _f = bindRootFilterNode(_f, data.t);\r\n                            } else {\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN));\r\n                            }\r\n                            _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s + self.parent._LIKE_PATTERN));\r\n                        }\r\n\r\n                        _f.push(self.filter.getFilterNode(self.queryProperties.thirdQueryWord, data.p + self.parent._LIKE_PATTERN));\r\n\r\n                        r.f = '<ogc:Filter xmlns:ogc=\"http://www.opengis.net/ogc\">' + '<ogc:And>' + _f.join('') + '</ogc:And>' + '</ogc:Filter>';\r\n\r\n                        break;\r\n                    case self.typeName === TC.Consts.searchType.STREET:\r\n                        _f = [];\r\n\r\n                        if (!(self.parent.rootCfg.active) && (/(\\<|\\>|\\<\\>)/gi.exec(data.t) || /(\\<|\\>|\\<\\>)/gi.exec(data.s))) {\r\n                            var match = /(\\<|\\>|\\<\\>)/gi.exec(data.t);\r\n                            if (match)\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t.substring(0, data.t.indexOf(match[0])).trim() + self.parent._LIKE_PATTERN));\r\n                            else {\r\n                                if (self.parent.rootCfg.active) {\r\n                                    _f = bindRootFilterNode(_f, data.t);\r\n                                }\r\n                                else {\r\n                                    _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN));\r\n                                }\r\n                            }\r\n\r\n                            match = /(\\<|\\>|\\<\\>)/gi.exec(data.s);\r\n                            if (match)\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s.substring(0, data.s.indexOf(match[0])).trim() + self.parent._LIKE_PATTERN));\r\n                            else _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s + self.parent._LIKE_PATTERN));\r\n                        } else {\r\n\r\n                            if (self.parent.rootCfg.active) {\r\n                                _f = bindRootFilterNode(_f, data.t);\r\n                            }\r\n                            else {\r\n                                _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN));\r\n                            }\r\n                            _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s + self.parent._LIKE_PATTERN));\r\n                        }\r\n                        r.f = '<ogc:Filter xmlns:ogc=\"http://www.opengis.net/ogc\">' + '<ogc:And>' + _f.join('') + '</ogc:And>' + '</ogc:Filter>';\r\n                        break;\r\n                    case self.typeName === TC.Consts.searchType.LOCALITY:\r\n                        r.f = self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN);\r\n                        r.multiL = true;\r\n                        break;                                            // GLS: consulta de 2 niveles (carretera con pk / topónimo con municipio)\r\n                    case self.queryProperties.hasOwnProperty('secondQueryWord'):\r\n                        var _f = [];\r\n                        _f.push(self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN));\r\n                        _f.push(self.filter.getFilterNode(self.queryProperties.secondQueryWord, self.parent._LIKE_PATTERN + data.s + self.parent._LIKE_PATTERN));\r\n                        r.f = '<ogc:Filter xmlns:ogc=\"http://www.opengis.net/ogc\">' + '<ogc:And>' + _f.join('') + '</ogc:And>' + '</ogc:Filter>';\r\n                        break;\r\n                    default: // GLS: consulta de 1 único nivel (municipio, casco urbano, carretera)\r\n                        r.f = '<ogc:Filter xmlns:ogc=\"http://www.opengis.net/ogc\">' + self.filter.getFilterNode(self.queryProperties.firstQueryWord, self.parent._LIKE_PATTERN + data.t + self.parent._LIKE_PATTERN) + '</ogc:Filter>';\r\n                        break;\r\n                }\r\n\r\n                return r;\r\n            },\r\n            getParams: function (data) {\r\n                var filters = self.filter.getFilter(data);\r\n\r\n                var params = {\r\n                    REQUEST: 'GetFeature',\r\n                    SERVICE: 'WFS',\r\n                    MAXFEATURES: 500,\r\n                    VERSION: self.version,\r\n                    OUTPUTFORMAT: self.outputFormat\r\n                };\r\n\r\n                var featureTypes = self.getFeatureTypes(true);\r\n                if (!(featureTypes instanceof Array))\r\n                    params.TYPENAME = self.featurePrefix ? self.featurePrefix + ':' + featureTypes.trim() : featureTypes.trim();\r\n                else {\r\n                    var ft = [];\r\n                    for (var i = 0; i < featureTypes.length; i++) {\r\n                        ft.push(self.featurePrefix ?\r\n                            self.featurePrefix + ':' + featureTypes[i].trim() :\r\n                            featureTypes[i].trim());\r\n                    }\r\n\r\n                    params.TYPENAME = ft.join(',');\r\n                }\r\n\r\n                var _getProperties = function (properties) {\r\n                    if ((properties || '') !== '') {\r\n                        if (!(properties instanceof Array)) {\r\n                            var p = [];\r\n                            if (properties instanceof Object) {\r\n                                for (var key in properties) {\r\n                                    var prop = properties[key][0];\r\n                                    if (properties[key].length > 1)\r\n                                        prop = properties[key].join(',');\r\n\r\n                                    p.push(prop);\r\n                                }\r\n                            }\r\n                            return p;\r\n                        }\r\n                        else\r\n                            return properties.join(',');\r\n                    }\r\n                };\r\n                var _properties = _getProperties(self.outputProperties);\r\n                var _ids = _getProperties(self.dataIdProperty);\r\n\r\n                if (_properties instanceof Array && _ids instanceof Array) {\r\n                    params.PROPERTYNAME = '';\r\n                    for (var i = 0; i < _properties.length; i++) {\r\n                        params.PROPERTYNAME += '(' + _properties[i] + ',' + _ids[i] + ')';\r\n                    }\r\n                } else\r\n                    params.PROPERTYNAME = _properties + ',' + _ids;\r\n\r\n                params.FILTER = filters.f;\r\n\r\n                return TC.Util.getParamString(params);\r\n            },\r\n            getGoToFilter: function (id) {\r\n                var props = [];\r\n                var _id = id.split('#');\r\n\r\n                var source = self.dataIdProperty;\r\n                var dataLayer = self.getFeatureTypes();\r\n\r\n                if (source && dataLayer) {\r\n\r\n                    if (id.indexOf('#') > -1 && dataLayer instanceof Array && dataLayer.length > 1) {\r\n                        for (var i = 0; i < dataLayer.length; i++) {\r\n\r\n                            for (var j = 0; j < source[dataLayer[i]].length; j++) {\r\n                                props.push({ name: source[dataLayer[i]][j], value: _id[j] });\r\n                            }\r\n                        }\r\n                    } else if (id.indexOf('#') == -1 && dataLayer instanceof Array) {\r\n                        var src = source;\r\n\r\n                        for (var i = 0; i < dataLayer.length; i++) {\r\n                            if (!props.hasOwnProperty(dataLayer[i])) {\r\n\r\n                                if (src instanceof Object && source.hasOwnProperty(dataLayer[i]))\r\n                                    src = source[dataLayer[i]];\r\n\r\n                                for (var j = 0; j < src.length; j++) {\r\n                                    if (j < _id.length)\r\n                                        props.push({ name: src[j], value: _id[j] });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (source instanceof Object && source.hasOwnProperty(dataLayer)) {\r\n                            source = source[dataLayer];\r\n                        }\r\n\r\n                        for (var i = 0; i < source.length; i++) {\r\n                            props.push({ name: source[i], value: _id[i] });\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return self.filter.transformFilter(props);\r\n            },\r\n            transformFilter: function (properties) {\r\n                var self = this;\r\n\r\n                if (!TC.filter) {\r\n                    TC.syncLoadJS(TC.apiLocation + 'TC/Filter');\r\n                }\r\n\r\n                if (properties && properties instanceof Array) {\r\n                    var filters = properties.map(function (elm) {\r\n                        if (elm.hasOwnProperty(\"type\")) {\r\n                            switch (true) {\r\n                                case elm.type == TC.Consts.comparison.EQUAL_TO: {\r\n                                    return new TC.filter.equalTo(elm.name, elm.value);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            return new TC.filter.equalTo(elm.name, elm.value);\r\n                        }\r\n                    });\r\n\r\n                    if (filters.length > 1) {\r\n                        return TC.filter.and.apply(null, filters);\r\n                    } else {\r\n                        return filters[0];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    })(self);\r\n};\r\n\r\nTC.control.Search = function () {\r\n    var self = this;\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.exportsState = true;\r\n\r\n    TC.Consts.event.TOOLSCLOSE = TC.Consts.event.TOOLSCLOSE || 'toolsclose.tc';\r\n\r\n    self.url = '//idena.navarra.es/ogc/wfs';\r\n    self.version = '1.1.0';\r\n    self.featurePrefix = 'IDENA';\r\n\r\n    if (self.options && self.options.url) {\r\n        self.url = self.options.url;\r\n    }\r\n\r\n    self._LIKE_PATTERN = '*';\r\n    self._MATCH_PATTERN = '.*';\r\n\r\n    self.UTMX = 'X';\r\n    self.UTMY = 'Y';\r\n    self.LON = 'Lon';\r\n    self.LAT = 'Lat';\r\n\r\n    self.UTMX_LABEL = 'X: ';\r\n    self.UTMY_LABEL = 'Y: ';\r\n    self.LON_LABEL = 'Lon: ';\r\n    self.LAT_LABEL = 'Lat: ';\r\n\r\n    self.MUN = 'Mun';\r\n    self.POL = 'Pol';\r\n    self.PAR = 'Par';\r\n\r\n    self.MUN_LABEL = 'Mun: ';\r\n    self.POL_LABEL = 'Pol: ';\r\n    self.PAR_LABEL = 'Par: ';\r\n\r\n    self.availableSearchTypes = {};\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.CADASTRAL] = {\r\n        suggestionRoot: null,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        searchWeight: 3,\r\n        featureType: ['CATAST_Pol_ParcelaUrba', 'CATAST_Pol_ParcelaRusti', 'CATAST_Pol_ParcelaMixta'],\r\n        municipality: {\r\n            featureType: 'CATAST_Pol_Municipio',\r\n            labelProperty: 'MUNICIPIO',\r\n            idProperty: 'CMUNICIPIO'\r\n        },\r\n        queryProperties: {\r\n            firstQueryWord: 'CMUNICIPIO',\r\n            secondQueryWord: 'POLIGONO',\r\n            thirdQueryWord: 'PARCELA'\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.cadastral\",\r\n            color: [\r\n                {\r\n                    CATAST_Pol_ParcelaUrba: {\r\n                        title: \"search.list.cadastral.urban\",\r\n                        color: {\r\n                            geomType: \"polygon\",\r\n                            css: \"strokeColor\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    CATAST_Pol_ParcelaRusti: {\r\n                        title: \"search.list.cadastral.rustic\",\r\n                        color: {\r\n                            geomType: \"polygon\",\r\n                            css: \"strokeColor\"\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    CATAST_Pol_ParcelaMixta: {\r\n                        title: \"search.list.cadastral.mixed\",\r\n                        color: {\r\n                            geomType: \"polygon\",\r\n                            css: \"strokeColor\"\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        },\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#136278',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            },\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#0c8b3d',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            },\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#e5475f',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                },\r\n            }\r\n        ],\r\n        parser: self.getCadastralRef,\r\n        goTo: self.goToCadastralRef,\r\n        goToIdFormat: self.MUN + '{0}' + self.POL + '{1}' + self.PAR + '{2}',\r\n        idPropertiesIdentifier: '#'\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.COORDINATES] = {\r\n        parser: self.getCoordinates,\r\n        goTo: self.goToCoordinates,\r\n        searchWeight: 4,\r\n        label: null,\r\n        suggestionListHead: function (text) {\r\n            return {\r\n                label: self.availableSearchTypes[TC.Consts.searchType.COORDINATES].label || self.getLocaleString('search.list.coordinates')\r\n            };\r\n        }\r\n    };\r\n\r\n    self.queryProperties = {\r\n        QUERYWORD: 'QueryWord',\r\n        FIRST: 'first',\r\n        SECOND: 'second',\r\n        THIRD: 'third'\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        url: '//idena.navarra.es/ogc/wfs',\r\n        featurePrefix: 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'CATAST_Pol_Municipio',\r\n        dataIdProperty: ['CMUNICIPIO'],\r\n        queryProperties: {\r\n            firstQueryWord: ['MUNINOAC', 'MUNICIPIO']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.municipality\",\r\n            color: \"strokeColor\"\r\n        },\r\n        outputProperties: ['MUNICIPIO'],\r\n        outputFormatLabel: '{0}',\r\n        searchWeight: 1,\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#fe06a5',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.MUNICIPALITY]),\r\n        stringPatternToCheck: self.stringPatternsValidators.s_or_t,\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    //self.availableSearchTypes[TC.Consts.searchType.LOCALITY] = {\r\n    //    root: null,\r\n    //    limit: false,\r\n    //    url: self.url || '//idena.navarra.es/ogc/wfs',\r\n    //    version: self.version || '1.1.0',\r\n    //    outputFormat: TC.Consts.format.JSON,\r\n    //    featurePrefix: self.featurePrefix || 'IDENA',\r\n    //    geometryName: 'the_geom',\r\n    //    featureType: ['CATAST_Pol_Municipio', 'ESTADI_Pol_EntidadPob'],\r\n    //    renderFeatureType: ['CATAST_Pol_Municipio'],\r\n    //    dataIdProperty: {\r\n    //        CATAST_Pol_Municipio: ['CMUNICIPIO'],\r\n    //        ESTADI_Pol_EntidadPob: ['CMUNICIPIO', 'CENTIDAD']\r\n    //    },\r\n    //    queryProperties: {\r\n    //        firstQueryWord: {\r\n    //            CATAST_Pol_Municipio: ['MUNINOAC', 'MUNICIPIO'],\r\n    //            ESTADI_Pol_EntidadPob: ['ENTINOAC', 'ENTIDAD']\r\n    //        }\r\n    //    },\r\n    //    suggestionListHead: {\r\n    //        label: \"search.list.locality\",\r\n    //        color: \"strokeColor\"\r\n    //    },\r\n    //    outputProperties: {\r\n    //        CATAST_Pol_Municipio: ['MUNICIPIO'],\r\n    //        ESTADI_Pol_EntidadPob: ['MUNICIPIO', 'ENTIDAD']\r\n    //    },\r\n    //    outputFormatLabel: {\r\n    //        CATAST_Pol_Municipio: '{0}',\r\n    //        ESTADI_Pol_EntidadPob: '{1} ({0})'\r\n    //    },\r\n    //    searchWeight: 1,\r\n    //    styles: [\r\n    //        {\r\n    //            polygon: {\r\n    //                fillColor: '#000000',\r\n    //                fillOpacity: 0,\r\n    //                strokeColor: '#ffffff',\r\n    //                strokeWidth: 5,\r\n    //                strokeOpacity: 1\r\n    //            }\r\n    //        },\r\n    //        {\r\n    //            polygon: {\r\n    //                fillColor: '#000000',\r\n    //                fillOpacity: 0.1,\r\n    //                strokeColor: '#feba1e',\r\n    //                strokeWidth: 2,\r\n    //                strokeOpacity: 1\r\n    //            }\r\n    //        }\r\n    //    ],\r\n    //    parser: self.getStringPattern.bind(this, [TC.Consts.searchType.LOCALITY]),\r\n    //    goTo: self.goToStringPattern\r\n    //};\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.COUNCIL] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'CATAST_Pol_Concejo',\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CMUNICIPIO', 'CCONCEJO'],\r\n        queryProperties: {\r\n            firstQueryWord: ['CONCEJO']\r\n        },\r\n        outputProperties: ['MUNICIPIO', 'CONCEJO'],\r\n        outputFormatLabel: '{1} ({0})',\r\n        searchWeight: 4,\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.COUNCIL]),\r\n        stringPatternToCheck: self.stringPatternsValidators.s_or_t,\r\n        goTo: self.goToStringPattern,\r\n        idPropertiesIdentifier: '#',\r\n        suggestionListHead: {\r\n            label: \"search.list.council\",\r\n            color: \"strokeColor\"\r\n        },\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#49006a',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            }\r\n        ]\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.STREET] = {\r\n        root: null,\r\n        limit: null,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        renderFeatureType: 'CATAST_Txt_Calle',\r\n        featureType: 'CATAST_Lin_CalleEje',\r\n        dataIdProperty: ['CVIA'],\r\n        searchWeight: 5,\r\n        queryProperties: {\r\n            firstQueryWord: ['ENTINOAC', 'ENTIDADC'],\r\n            secondQueryWord: ['VIA', 'VIANOAC']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.street\",\r\n            color: \"strokeColor\"\r\n        },\r\n        outputProperties: ['ENTIDADC', 'VIA', 'CVIA', 'CENTIDADC', 'CMUNICIPIO'],\r\n        outputFormatLabel: '{1}, {0}',\r\n        styles: [\r\n            {\r\n                line: {\r\n                    strokeColor: \"#CB0000\",\r\n                    strokeOpacity: 1,\r\n                    strokeWidth: 2,\r\n                    strokeLinecap: \"round\",\r\n                    strokeDashstyle: \"solid\"\r\n                }\r\n            },\r\n            {\r\n                point: {\r\n                    label: \"VIA\",\r\n                    angle: \"CADANGLE\",\r\n                    fontColor: \"#000000\",\r\n                    fontSize: 10,\r\n                    fontWeight: \"bold\",\r\n                    labelOutlineColor: \"#FFFFFF\",\r\n                    labelOutlineWidth: 4\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.STREET]),\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.NUMBER] = {\r\n        root: null,\r\n        limit: null,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'CATAST_Txt_Portal',\r\n        renderFeatureType: '',\r\n        searchWeight: 6,\r\n        dataIdProperty: ['CMUNICIPIO', 'CENTIDADC', 'CVIA', 'PORTAL'],\r\n        queryProperties: {\r\n            firstQueryWord: ['ENTIDADC', 'ENTINOAC'],\r\n            secondQueryWord: ['VIA', 'VIANOAC'],\r\n            thirdQueryWord: ['PORTAL']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.number\",\r\n            color: \"fontColor\"\r\n        },\r\n        outputProperties: ['ENTIDADC', 'VIA', 'PORTAL', 'CVIA', 'CENTIDADC', 'CMUNICIPIO'],\r\n        outputFormatLabel: '{1} {2}, {0}',\r\n        styles: [\r\n            {\r\n                point: {\r\n                    radius: 0,\r\n                    label: \"PORTAL\",\r\n                    angle: \"CADANGLE\",\r\n                    fontColor: \"#CB0000\",\r\n                    fontSize: 14,\r\n                    labelOutlineColor: \"#FFFFFF\",\r\n                    labelOutlineWidth: 4\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.NUMBER]),\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.URBAN] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'ESTADI_Pol_EntidadPob',\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CMUNICIPIO', 'CENTIDAD'],\r\n        idPropertiesIdentifier: '#',\r\n        queryProperties: {\r\n            firstQueryWord: ['ENTINOAC', 'ENTIDAD']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.urban\",\r\n            color: \"strokeColor\"\r\n        },\r\n        outputProperties: ['MUNICIPIO', 'ENTIDAD'],\r\n        outputFormatLabel: '{1} ({0})',\r\n        searchWeight: 2,\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#feba1e',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.URBAN]),\r\n        stringPatternToCheck: self.stringPatternsValidators.s_or_t,\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.PLACENAME] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'TOPONI_Txt_Toponimos',\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CTOPONIMO'],\r\n        idPropertiesIdentifier: '#',\r\n        queryProperties: {\r\n            firstQueryWord: ['TOPONIMO', 'TOPONINOAC']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.placeName\",\r\n            color: \"fontColor\"\r\n        },\r\n        outputProperties: ['MUNICIPIO', 'TOPONIMO', 'CMUNICIPIO', 'CTOPONIMO'],\r\n        outputFormatLabel: '{1} ({0})',\r\n        searchWeight: 7,\r\n        /*filterByMatch: true, // si queremos que filtre por expresión regular */\r\n        styles: [\r\n            {\r\n                point: {\r\n                    radius: 0,\r\n                    label: \"CADTEXT\",\r\n                    angle: \"CADANGLE\",\r\n                    fontColor: \"#ff5722\",\r\n                    fontSize: 14,\r\n                    labelOutlineColor: \"#FFFFFF\",\r\n                    labelOutlineWidth: 4\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.PLACENAME]),\r\n        stringPatternToCheck: self.stringPatternsValidators.s_or_t,\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'TOPONI_Txt_Toponimos',\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CMUNICIPIO', 'CTOPONIMO'],\r\n        idPropertiesIdentifier: '#',\r\n        queryProperties: {\r\n            firstQueryWord: ['MUNICIPIO', 'MUNINOAC'],\r\n            secondQueryWord: ['TOPONIMO', 'TOPONINOAC']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.placeName\",\r\n            color: \"fontColor\"\r\n        },\r\n        outputProperties: ['MUNICIPIO', 'TOPONIMO', 'CMUNICIPIO', 'CTOPONIMO'],\r\n        outputFormatLabel: '{1} ({0})',\r\n        searchWeight: 8,\r\n        /*filterByMatch: true, si queremos que filtre por expresión regular */\r\n        styles: [\r\n            {\r\n                point: {\r\n                    radius: 0,\r\n                    label: \"CADTEXT\",\r\n                    angle: \"CADANGLE\",\r\n                    fontColor: \"#ff5722\",\r\n                    fontSize: 14,\r\n                    labelOutlineColor: \"#FFFFFF\",\r\n                    labelOutlineWidth: 4\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getStringPattern.bind(this, [TC.Consts.searchType.PLACENAMEMUNICIPALITY]),\r\n        goTo: self.goToStringPattern\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: ['POLUCI_Pol_MancoRSUg'],\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CMANCOMUNI'],\r\n        queryProperties: {\r\n            firstQueryWord: ['MANCOMUNID']\r\n        },\r\n        outputProperties: ['MANCOMUNID'],\r\n        outputFormatLabel: '{0}',\r\n        searchWeight: 9,\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    fillColor: '#000000',\r\n                    fillOpacity: 0.1,\r\n                    strokeColor: '#fc4e2a',\r\n                    strokeWidth: 2,\r\n                    strokeOpacity: 1\r\n                }\r\n            }\r\n        ]\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.ROAD] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'INFRAE_Lin_CtraEje',\r\n        dataIdProperty: ['DCARRETERA'],\r\n        queryProperties: {\r\n            firstQueryWord: ['DCARRETERA']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.road\",\r\n            color: \"strokeColor\"\r\n        },\r\n        outputProperties: ['DCARRETERA'],\r\n        outputFormatLabel: self.getLocaleString('search.list.road.shorter') + ': ' + '{0}',\r\n        searchWeight: 10,\r\n        styles: [\r\n            {\r\n                polygon: {\r\n                    strokeColor: \"#00b2fc\",\r\n                    strokeOpacity: 1,\r\n                    strokeWidth: 5\r\n                },\r\n                line: {\r\n                    strokeColor: \"#00b2fc\",\r\n                    strokeOpacity: 1,\r\n                    strokeWidth: 5,\r\n                    strokeLinecap: \"round\",\r\n                    strokeDashstyle: \"solid\"\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getRoad,\r\n        goTo: self.goToRoad,\r\n        pattern: function () {\r\n            return new RegExp(\"^(?:(?:\" + self.getLocaleString(\"search.list.road\") + \"|\" + self.getLocaleString(\"search.list.road.shorter\") + \")\\\\:?)?\\\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\\\s*\\\\-?\\\\s*(\\\\d{1,4})\\\\s*\\\\-?\\\\s*(A?|B?|C?|R?))$\", \"i\")\r\n        }\r\n    };\r\n\r\n    self.availableSearchTypes[TC.Consts.searchType.ROADPK] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'INFRAE_Sym_CtraPK',\r\n        dataIdProperty: ['DCARRETERA', 'CPK'],\r\n        queryProperties: {\r\n            firstQueryWord: ['DCARRETERA'],\r\n            secondQueryWord: ['PK']\r\n        },\r\n        suggestionListHead: {\r\n            label: \"search.list.pk.larger\",\r\n            color: \"fontColor\"\r\n        },\r\n        outputProperties: ['DCARRETERA', 'PK'],\r\n        outputFormatLabel: self.getLocaleString('search.list.road.shorter') + ': {0} ' + self.getLocaleString('search.list.pk') + ': {1}',\r\n        searchWeight: 11,\r\n        styles: [\r\n            {\r\n                point: {\r\n                    label: [\"DCARRETERA\", \"PK\"],\r\n                    fontColor: \"#00b2fc\",\r\n                    fontSize: 14,\r\n                    labelOutlineColor: \"#ffffff\",\r\n                    labelOutlineWidth: 2\r\n                }\r\n            }\r\n        ],\r\n        parser: self.getPK,\r\n        goTo: self.goToPK,\r\n        pattern: function () {\r\n            return new RegExp(\"^(?:(?:\" + self.getLocaleString(\"search.list.road\") + \"|\" + self.getLocaleString(\"search.list.road.shorter\") + \")\\\\:?)?\\\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\\\s*\\\\-?\\\\s*(\\\\d{1,4})\\\\s*\\\\-?\\\\s*(A?|B?|C?|R?))\\\\s*\\\\,*\\\\s*(?:(?:\" + self.getLocaleString(\"search.list.pk\") + \"\\\\:?)|(?:P\\\\:?)|(?:K\\\\:?)|(?:KM\\\\:?)|(?:\\\\s+|\\\\,+))\\\\s*(\\\\d{1,4})$\", \"i\")\r\n        }\r\n    };\r\n\r\n    self.rootCfg = {};\r\n    self.rootCfg[TC.Consts.searchType.MUNICIPALITY] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: 'CATAST_Pol_Municipio',\r\n        dataIdProperty: ['CMUNICIPIO'],\r\n        queryProperties: {\r\n            firstQueryWord: ['MUNICIPIO']\r\n        },\r\n        outputProperties: ['MUNICIPIO'],\r\n        outputFormatLabel: '{0}',\r\n        getRootLabel: function () {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (self.rootCfg.active && !self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel) {\r\n\r\n                    var params = {};\r\n                    params.SERVICE = 'WFS';\r\n                    params.VERSION = self.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;\r\n                    params.REQUEST = 'GetFeature';\r\n                    params.TYPENAME = self.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix + ':' + self.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;\r\n                    params.OUTPUTFORMAT = self.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;\r\n                    params.PROPERTYNAME = ['CMUNICIPIO'].concat(self.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(',');\r\n\r\n                    params.CQL_FILTER = self.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function (elem) {\r\n                        return ['CMUNICIPIO'].map(function (id, index) {\r\n                            return id + '=' + elem[index];\r\n                        }).join(' AND ');\r\n                    });\r\n\r\n                    params.CQL_FILTER = params.CQL_FILTER.join(' OR ');\r\n\r\n                    TC.ajax({\r\n                        url: self.rootCfg[TC.Consts.searchType.MUNICIPALITY].url + '?' + TC.Util.getParamString(params),\r\n                        method: 'GET',\r\n                        responseType: TC.Consts.mimeType.JSON\r\n                    }).then(function (response) {\r\n                        const data = response.data;\r\n                        if (data.totalFeatures > 0) {\r\n\r\n                            self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel = data.features.map(function (feature) {\r\n                                return {\r\n                                    id: ['CMUNICIPIO'].map(function (elem) {\r\n                                        return feature.properties[elem];\r\n                                    }).join('#'),\r\n                                    label: feature.properties[self.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()\r\n                                };\r\n                            });\r\n\r\n                            resolve(self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);\r\n\r\n                        } else {\r\n                            self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel = [];\r\n                            resolve(self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);\r\n                        }\r\n                    }).catch(function () {\r\n                        resolve([]);\r\n                    });\r\n                }\r\n                else {\r\n                    resolve(self.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);\r\n                }\r\n            });\r\n        }\r\n    };\r\n    self.rootCfg[TC.Consts.searchType.LOCALITY] = {\r\n        root: null,\r\n        limit: false,\r\n        url: self.url || '//idena.navarra.es/ogc/wfs',\r\n        version: self.version || '1.1.0',\r\n        outputFormat: TC.Consts.format.JSON,\r\n        featurePrefix: self.featurePrefix || 'IDENA',\r\n        geometryName: 'the_geom',\r\n        featureType: ['ESTADI_Pol_EntidadPob'],\r\n        renderFeatureType: '',\r\n        dataIdProperty: ['CMUNICIPIO', 'CENTIDADC'],\r\n        queryProperties: {\r\n            firstQueryWord: ['ENTINOAC']\r\n        },\r\n        outputProperties: ['ENTINOAC'],\r\n        getRootLabel: function () {\r\n            return new Promise(function (resolve, reject) {\r\n                if (self.rootCfg.active && !self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel) {\r\n\r\n                    var params = {};\r\n                    params.SERVICE = 'WFS';\r\n                    params.VERSION = self.rootCfg[TC.Consts.searchType.LOCALITY].version;\r\n                    params.REQUEST = 'GetFeature';\r\n                    params.TYPENAME = self.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix + ':' + self.rootCfg[TC.Consts.searchType.LOCALITY].featureType;\r\n                    params.OUTPUTFORMAT = self.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;\r\n                    params.PROPERTYNAME = ['CMUNICIPIO', 'CENTIDAD'].concat(self.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(',');\r\n\r\n                    params.CQL_FILTER = self.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function (elem) {\r\n                        return ['CMUNICIPIO', 'CENTIDAD'].map(function (id, index) {\r\n                            return id + '=' + elem[index];\r\n                        }).join(' AND ');\r\n                    });\r\n\r\n                    params.CQL_FILTER = params.CQL_FILTER.join(' OR ');\r\n\r\n                    TC.ajax({\r\n                        url: self.rootCfg[TC.Consts.searchType.LOCALITY].url + '?' + TC.Util.getParamString(params),\r\n                        method: 'GET',\r\n                        responseType: TC.Consts.mimeType.JSON\r\n                    }).then(function (response) {\r\n                        const data = response.data;\r\n                        if (data.totalFeatures > 0) {\r\n\r\n                            self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel = data.features.map(function (feature) {\r\n                                return {\r\n                                    id: ['CMUNICIPIO', 'CENTIDAD'].map(function (elem) {\r\n                                        return feature.properties[elem];\r\n                                    }).join('#'),\r\n                                    label: feature.properties[self.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()\r\n                                };\r\n                            });\r\n\r\n                            resolve(self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);\r\n\r\n                        } else {\r\n                            self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel = [];\r\n                            resolve(self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);\r\n                        }\r\n                    }).catch(function () {\r\n                        resolve([]);\r\n                    });\r\n                }\r\n                else {\r\n                    resolve(self.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);\r\n                }\r\n            });\r\n            return done;\r\n        }\r\n    };\r\n\r\n    self.allowedSearchTypes = [];\r\n\r\n    if (self.options.allowedSearchTypes) {\r\n        for (var allowed in self.options.allowedSearchTypes) {\r\n\r\n            if (self.availableSearchTypes[allowed] && !TC.Util.isEmptyObject(self.options.allowedSearchTypes[allowed])) {\r\n\r\n                // GLS: gestionamos el override de featureType y renderFeatureType.\r\n                // Si por defecto cuenta con renderFeatureType y sobrescribe featureType y no renderFeatureType, \r\n                // elimino la propiedad renderFeatureType y elimino el último estilo definido, que se corresponde con el de renderFeatureType.\r\n                if (self.availableSearchTypes[allowed].renderFeatureType && self.availableSearchTypes[allowed].renderFeatureType.length > 0 &&\r\n                    self.options.allowedSearchTypes[allowed].featureType && !self.options.allowedSearchTypes[allowed].renderFeatureType) {\r\n\r\n                    delete self.availableSearchTypes[allowed].renderFeatureType;\r\n                    self.availableSearchTypes[allowed].styles = self.availableSearchTypes[allowed].styles.slice(0, self.availableSearchTypes[allowed].styles.length - 1);\r\n                }\r\n\r\n                // GLS: override de la configuración por defecto con la del config.JSON\r\n                TC.Util.extend(self.availableSearchTypes[allowed], self.options.allowedSearchTypes[allowed]);\r\n\r\n\r\n                // GLS: Limitamos la búsqueda en portales y calles cuando así se establezca en la configuración de las búsquedas\r\n                if (self.options.allowedSearchTypes[allowed].root &&\r\n                    (allowed != TC.Consts.searchType.MUNICIPALITY && self.options.allowedSearchTypes[allowed].rootType == TC.Consts.searchType.MUNICIPALITY) ||\r\n                    (allowed != TC.Consts.searchType.LOCALITY && self.options.allowedSearchTypes[allowed].rootType == TC.Consts.searchType.LOCALITY)) {\r\n\r\n                    self.rootCfg.active = self.rootCfg[self.options.allowedSearchTypes[allowed].rootType];\r\n                    self.rootCfg.active.root = self.options.allowedSearchTypes[allowed].root;\r\n                    self.rootCfg.active.limit = self.options.allowedSearchTypes[allowed].limit;\r\n\r\n                    self.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord =\r\n                        self.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord =\r\n                        self.rootCfg.active.dataIdProperty;\r\n                }\r\n            }\r\n\r\n            // Si esta a false lo borramos de las disponibles\r\n            if (!self.options.allowedSearchTypes[allowed]) {\r\n                delete self.options.allowedSearchTypes[allowed];\r\n            } else {\r\n                self.addAllowedSearchType(allowed, self.availableSearchTypes[allowed] ? self.availableSearchTypes[allowed] : self.options.allowedSearchTypes[allowed], self);\r\n            }\r\n        }\r\n    }\r\n\r\n    if (self.rootCfg.active) {\r\n        self.rootCfg.active.getRootLabel();\r\n    }\r\n\r\n    self.queryableFeatures = self.options.queryableFeatures || false;\r\n\r\n    self.UTMX_LEN = 6;\r\n    self.UTMY_LEN = 7;\r\n\r\n    self.wrap = new TC.wrap.control.Search(self);\r\n\r\n    self.interval = 500;\r\n\r\n    self.NORMAL_PATTERNS = {\r\n        ROMAN_NUMBER: /M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\\S?\\./i,\r\n        ABSOLUTE_NOT_DOT: /[`~!@#$%^&*_|+\\=?;:'\"\\{\\}\\[\\]\\\\]/gi,\r\n        ABSOLUTE: /[`~!@#$%^&*_|+\\=?;:'.\\{\\}\\[\\]\\\\]/gi\r\n    };\r\n};\r\n\r\nTC.inherit(TC.control.Search, TC.Control);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Search.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-search';\r\n\r\n    TC.Consts.event.SEARCHQUERYEMPTY = TC.Consts.event.SEARCHQUERYEMPTY || 'searchqueryempty.tc';\r\n\r\n    if (TC.isDebug) {\r\n        ctlProto.template = TC.apiLocation + \"TC/templates/Search.html\";\r\n    }\r\n    else {\r\n        ctlProto.template = function () { dust.register(ctlProto.CLASS, body_0); function body_0(chk, ctx) { return chk.w(\"<h2>\").h(\"i18n\", ctx, {}, { \"$key\": \"search.1\" }).w(\"</h2><div class=\\\"tc-ctl-search-content\\\"><input type=\\\"search\\\" class=\\\"tc-ctl-search-txt\\\" placeholder=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"search.placeholder\" }).w(\"\\\" title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"search.instructions\" }).w(\"\\\" /><button title=\\\"\").h(\"i18n\", ctx, {}, { \"$key\": \"search.instructions\" }).w(\"\\\" class=\\\"tc-ctl-btn tc-ctl-search-btn\\\">\").h(\"i18n\", ctx, {}, { \"$key\": \"search.2\" }).w(\"</button><ul class=\\\"tc-ctl-search-list tc-hidden\\\"></ul></div>\"); } body_0.__dustBody = !0; return body_0 };\r\n    }\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self._search = {\r\n            data: []\r\n        };\r\n\r\n        self.layerStyleFN = (function () {\r\n            function getFeatureType(idFeature) {\r\n                return idFeature.indexOf('.') > -1 ? idFeature.split('.')[0] : idFeature;\r\n            };\r\n            function getStyle(property, geomType, id) {\r\n\r\n                var type = self.getSearchTypeByFeature(id);\r\n                if (type) {\r\n                    var style = type.getStyleByFeatureType(getFeatureType(id));\r\n\r\n                    if (style && style.hasOwnProperty(geomType)) {\r\n                        return style[geomType][property];\r\n                    }\r\n                }\r\n\r\n                return TC.Cfg.styles[geomType][property];\r\n            };\r\n\r\n            return function (geomType, property, extractValue, f) {\r\n                var self = this;\r\n\r\n                if (TC.Feature && !(f instanceof TC.Feature)) {\r\n                    self.map.trigger(TC.Consts.event.FEATURESADD, { layer: self.layer, geom: f.geom });\r\n                }\r\n\r\n                var prop = getStyle(property, geomType, getFeatureType(f.id));\r\n                if (extractValue) {\r\n                    if (prop instanceof Array) {\r\n                        var values = prop.map(function (p) {\r\n                            return f.getData().hasOwnProperty(p) ? f.getData()[p] : '';\r\n                        });\r\n                        var searchType = this.getSearchTypeByFeature(getFeatureType(f.id));\r\n                        if (searchType) {\r\n                            return searchType.outputFormatLabel.tcFormat(values);\r\n                        } else {\r\n                            return values.join(' ');\r\n                        }\r\n                    } else {\r\n                        return f.getData().hasOwnProperty(prop) ? f.getData()[prop] : '';\r\n                    }\r\n                }\r\n                else {\r\n                    return prop;\r\n                }\r\n            };\r\n        }());\r\n\r\n        var styleFN = self.layerStyleFN;\r\n\r\n        self.layerPromise = map.addLayer({\r\n            id: self.getUID(),\r\n            title: 'Búsquedas',\r\n            stealth: true,\r\n            declutter: true,\r\n            type: TC.Consts.layerType.VECTOR,\r\n            styles: {\r\n                polygon: {\r\n                    fillColor: styleFN.bind(self, 'polygon', 'fillColor', false),\r\n                    fillOpacity: styleFN.bind(self, 'polygon', 'fillOpacity', false),\r\n                    strokeColor: styleFN.bind(self, 'polygon', 'strokeColor', false),\r\n                    strokeOpacity: styleFN.bind(self, 'polygon', 'strokeOpacity', false),\r\n                    strokeWidth: styleFN.bind(self, 'polygon', 'strokeWidth', false)\r\n                },\r\n                line: {\r\n                    strokeColor: styleFN.bind(self, 'line', 'strokeColor', false),\r\n                    strokeOpacity: styleFN.bind(self, 'line', 'strokeOpacity', false),\r\n                    strokeWidth: styleFN.bind(self, 'line', 'strokeWidth', false)\r\n                },\r\n                marker: {\r\n                    anchor: TC.Defaults.styles.marker.anchor,\r\n                    height: TC.Defaults.styles.marker.height,\r\n                    width: TC.Defaults.styles.marker.width\r\n                },\r\n                point: {\r\n                    radius: styleFN.bind(self, 'point', 'radius', false),\r\n                    height: styleFN.bind(self, 'point', 'height', false),\r\n                    width: styleFN.bind(self, 'point', 'width', false),\r\n                    fillColor: styleFN.bind(self, 'point', 'fillColor', false),\r\n                    fillOpacity: styleFN.bind(self, 'point', 'fillOpacity', false),\r\n                    strokeColor: styleFN.bind(self, 'point', 'strokeColor', false),\r\n                    strokeWidth: styleFN.bind(self, 'point', 'strokeWidth', false),\r\n                    fontSize: styleFN.bind(self, 'point', 'fontSize', false),\r\n                    fontColor: styleFN.bind(self, 'point', 'fontColor', false),\r\n                    labelOutlineColor: styleFN.bind(self, 'point', 'labelOutlineColor', false),\r\n                    labelOutlineWidth: styleFN.bind(self, 'point', 'labelOutlineWidth', false),\r\n                    label: styleFN.bind(self, 'point', 'label', true),\r\n                    angle: styleFN.bind(self, 'point', 'angle', true)\r\n                }\r\n            }\r\n        })\r\n            .then(function (layer) {\r\n                self.layer = layer;\r\n                return layer;\r\n            });\r\n\r\n        self.EMPTY_RESULTS_LABEL = self.getLocaleString('noResults');\r\n        self.EMPTY_RESULTS_TITLE = self.getLocaleString('checkCriterion');\r\n        self.OUTBBX_LABEL = self.getLocaleString('outsideOfLimits');\r\n\r\n        self.WFS_TYPE_ATTRS = [\"url\", \"version\", \"geometryName\", \"featurePrefix\", \"featureType\", \"properties\", \"outputFormat\"];\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.renderData = function (data, callback) {\r\n        var self = this;\r\n\r\n        self._search = self._search || {};\r\n\r\n        var _search = function () {\r\n            self.search(self.textInput.value, function (list) {\r\n                if (list.length === 1) {\r\n                    self.textInput.value = list[0].label;\r\n                    self._goToResult(list[0].id, self.resultsList.querySelector('li:not([header])').getAttribute('dataRole'));\r\n                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n                else if (list.length === 0) {\r\n                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n            });\r\n        };\r\n\r\n        return TC.Control.prototype.renderData.call(self, data, function () {\r\n\r\n            // desde keypress y desde la lupa\r\n            var _research = function () {\r\n                self.textInput.value = self.resultsList.label || self.resultsList.querySelector('li:not([header]) > a > span').textContent;\r\n                self.lastPattern = self.textInput.value;\r\n                self._goToResult(self.resultsList.id || unescape(self.resultsList.querySelector('li:not([header]) > a').getAttribute('href')).substring(1), self.resultsList.querySelector('li:not([header])').getAttribute('dataRole'));\r\n                self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n            };\r\n\r\n            self.textInput = self.div.querySelector('input.tc-ctl-search-txt');\r\n            if (self.options && self.options.placeHolder) {\r\n                self.textInput.setAttribute('placeHolder', self.options.placeHolder.trim());\r\n            }\r\n\r\n            self.resultsList = self.div.querySelector('.tc-ctl-search-list');\r\n            self.button = self.div.querySelector('.tc-ctl-search-btn');\r\n            self.button.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.getLayer().then(function (l) {\r\n                    if (self.resultsList.querySelectorAll('li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)').length > 1) { }\r\n                    else if (l.features.length > 0) {\r\n                        l.map.zoomToFeatures(l.features);\r\n                    }\r\n                    else if (self.resultsList.querySelectorAll('li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)').length === 1) {\r\n                        _research();\r\n                    }\r\n                    else {\r\n                        self.textInput.dispatchEvent(new Event(\"keyup\"));\r\n                    }\r\n                });\r\n            });\r\n            if (self.options.instructions) {\r\n                self.textInput.setAttribute('title', self.options.instructions.trim());\r\n                self.button.setAttribute('title', self.options.instructions.trim());\r\n            }\r\n\r\n            // GLS: añadimos la funcionalidad al mensaje de \"No hay resultados\", al hacer click repliega el mensaje.\r\n            self.resultsList.addEventListener(TC.Consts.event.CLICK, TC.EventTarget.listenerBySelector('a.tc-ctl-search-li-empty', function () {\r\n                self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                self.textInput.focus();\r\n            }));\r\n\r\n            self.textInput.addEventListener('keypress', function (e) {\r\n                if (e.which == 13) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n\r\n                    self.lastPattern = \"\";\r\n\r\n                    if (self.resultsList.querySelectorAll('li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)').length === 1) {\r\n                        _research();\r\n                    } else {\r\n                        _search();\r\n                    }\r\n                    return false;\r\n                }\r\n            });\r\n            self.textInput.addEventListener(\"search\", function () {\r\n                if (self.textInput.value.length === 0) {\r\n                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                    _search();\r\n                }\r\n            });\r\n            self.textInput.addEventListener(\"input\", function () {\r\n                if (self.textInput.value.length === 0) {\r\n                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                    _search();\r\n                }\r\n            });\r\n            self.textInput.addEventListener(\"targetCleared.autocomplete\", function () {\r\n                self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n            })\r\n            self.textInput.addEventListener(\"targetUpdated.autocomplete\", function () {\r\n                if (self.resultsList.querySelectorAll('li').length > 0) {\r\n                    self.resultsList.classList.remove(TC.Consts.classes.HIDDEN);\r\n                }\r\n            });\r\n\r\n            self.lastPattern = '';\r\n            self.retryTimeout = null;\r\n            TC.loadJS(\r\n                !TC.UI || !TC.UI.autocomplete,\r\n                [TC.apiLocation + 'TC/ui/autocomplete.js'],\r\n                function () {\r\n                    var searchDelay;\r\n\r\n                    const source = function (text, callback) {\r\n                        self.lastpress = performance.now();\r\n\r\n                        if (!searchDelay) {\r\n                            function step() {\r\n                                var criteria = self.textInput.value.trim();\r\n\r\n                                if (criteria.length > 0 &&\r\n                                    (!self.lastPattern || criteria != self.lastPattern) &&\r\n                                    performance.now() - self.lastpress > self.interval) {\r\n\r\n                                    window.cancelAnimationFrame(searchDelay);\r\n                                    searchDelay = undefined;\r\n\r\n                                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n\r\n                                    // Pendiente de afinar\r\n                                    //if (self.lastPattern && criteria.substring(0, criteria.lastIndexOf(' ')) == self.lastPattern) {                                            \r\n\r\n                                    //    // Si el patrón de búsqueda anterior y actual es el mismo más algo nuevo (típico en la búsqueda de un portal), lo nuevo lo separo por coma\r\n                                    //    // self.lastPattern: \"Calle Cataluña/Katalunia Kalea, Pamplona\"\r\n                                    //    // text: \"Calle Cataluña/Katalunia Kalea, Pamplona 18\"\r\n\r\n                                    //    criteria = criteria.substring(0, criteria.lastIndexOf(' ')) + (self.lastPattern.trim().endsWith(',') ? \"\" : \",\") + criteria.substring(criteria.lastIndexOf(' '));\r\n                                    //}\r\n\r\n                                    self.lastPattern = criteria;\r\n\r\n                                    self.search(criteria, callback);\r\n                                } else {\r\n                                    searchDelay = requestAnimationFrame(step);\r\n                                }\r\n                            }\r\n\r\n                            searchDelay = requestAnimationFrame(step);\r\n                        }\r\n                    };\r\n\r\n                    var closest = function (el, selector) {\r\n                        const matchesSelector = el.matches || el.webkitMatchesSelector || el.mozMatchesSelector || el.msMatchesSelector;\r\n\r\n                        while (el) {\r\n                            if (matchesSelector.call(el, selector)) {\r\n                                return el;\r\n                            } else {\r\n                                el = el.parentElement;\r\n                            }\r\n                        }\r\n                        return null;\r\n                    };\r\n\r\n                    const callback = function (e) {\r\n                        var _target = e.target;\r\n\r\n                        if (e.target.tagName.toLowerCase() !== 'a') {\r\n                            _target = closest(e.target, 'a');\r\n                        }\r\n\r\n                        if (_target.querySelector('span[hidden]')) {\r\n                            self.textInput.value = _target.querySelector('span[hidden]').textContent;\r\n                            self.lastPattern = self.textInput.value;\r\n                            self._goToResult(unescape(_target.getAttribute('href')).substring(1), _target.parentNode.getAttribute('dataRole'));\r\n                            TC.UI.autocomplete.call(self.textInput, 'clear');\r\n                        }\r\n                    };\r\n\r\n                    const buildHTML = function (results) {\r\n\r\n                        var html = [];\r\n                        var dataRoles = [];\r\n\r\n                        var reA = /[^a-zA-Z]/g;\r\n                        var reN = /[^0-9]/g;\r\n                        function sortAlphaNum(a, b) {\r\n                            var AInt = parseInt(a, 10);\r\n                            var BInt = parseInt(b, 10);\r\n\r\n                            if (isNaN(AInt) && isNaN(BInt)) {\r\n                                var aA = a.replace(reA, \"\");\r\n                                var bA = b.replace(reA, \"\");\r\n                                if (aA === bA) {\r\n                                    var aN = parseInt(a.replace(reN, \"\"), 10);\r\n                                    var bN = parseInt(b.replace(reN, \"\"), 10);\r\n                                    return aN === bN ? 0 : aN > bN ? 1 : -1;\r\n                                } else {\r\n                                    return aA > bA ? 1 : -1;\r\n                                }\r\n                            } else if (isNaN(AInt)) {//A is not an Int\r\n                                return 1;//to make alphanumeric sort first return -1 here\r\n                            } else if (isNaN(BInt)) {//B is not an Int\r\n                                return -1;//to make alphanumeric sort first return 1 here\r\n                            } else {\r\n                                return AInt > BInt ? 1 : -1;\r\n                            }\r\n                        };\r\n\r\n                        // ordenamos por roles y alfabéticamente\r\n                        var data = results.results.sort(function (a, b) {\r\n                            if (this.ctx.getSearchTypeByRole(a.dataRole).searchWeight && this.ctx.getSearchTypeByRole(b.dataRole).searchWeight) {\r\n                                if ((this.ctx.getSearchTypeByRole(a.dataRole).searchWeight || 0) > (this.ctx.getSearchTypeByRole(b.dataRole).searchWeight || 0)) {\r\n                                    return 1;\r\n                                } else if ((this.ctx.getSearchTypeByRole(a.dataRole).searchWeight || 0) < (this.ctx.getSearchTypeByRole(b.dataRole).searchWeight || 0)) {\r\n                                    return -1;\r\n                                }\r\n                                else {\r\n                                    return sortAlphaNum(a.label, b.label);\r\n                                }\r\n                            } else {\r\n                                if (a.dataRole > b.dataRole) {\r\n                                    return 1;\r\n                                }\r\n                                else if (a.dataRole < b.dataRole)\r\n                                    return -1;\r\n                                else {\r\n                                    return sortAlphaNum(a.label, b.label);\r\n                                }\r\n                            }\r\n                        }.bind(this));\r\n\r\n                        if (self.rootCfg.active) {// si hay root, aplicamos el orden por entidades \r\n                            data = data.sort(function (a, b) {\r\n\r\n                                const sort_ = function () {\r\n                                    var first = this.rootCfg.active.root[0] instanceof Array ? this.rootCfg.active.root[0].join('-') : this.rootCfg.active.root[0];\r\n\r\n                                    var aRoot, bRoot;\r\n                                    if (a.properties && a.properties.length > 0 && b.properties && b.properties.length > 0) {\r\n                                        aRoot = this.rootCfg.active.dataIdProperty.map(function (elem) { return a.properties[elem].toString(); }).join('-');\r\n                                        bRoot = this.rootCfg.active.dataIdProperty.map(function (elem) { return b.properties[elem].toString(); }).join('-');\r\n                                    } else {\r\n                                        aRoot = a.id;\r\n                                        bRoot = b.id;\r\n                                    }\r\n\r\n                                    if (aRoot !== first && bRoot === first) {\r\n                                        return 1;\r\n                                    } else if (aRoot === first && bRoot !== first) {\r\n                                        return -1;\r\n                                    } else {\r\n                                        return sortAlphaNum(a.label, b.label);\r\n                                    }\r\n                                }.bind(this);\r\n\r\n                                if (this.getSearchTypeByRole(a.dataRole).searchWeight && this.getSearchTypeByRole(b.dataRole).searchWeight) {\r\n                                    if ((this.getSearchTypeByRole(a.dataRole).searchWeight || 0) > (this.getSearchTypeByRole(b.dataRole).searchWeight || 0)) {\r\n                                        return 1;\r\n                                    } else if ((this.getSearchTypeByRole(a.dataRole).searchWeight || 0) < (this.getSearchTypeByRole(b.dataRole).searchWeight || 0)) {\r\n                                        return -1;\r\n                                    }\r\n                                    else {\r\n                                        return sort_();\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    return sort_();\r\n                                }\r\n\r\n                            }.bind(self));\r\n                        }\r\n\r\n                        for (var i = 0; i < data.length; i++) {\r\n                            var elm = data[i];\r\n\r\n                            if (dataRoles.indexOf(elm.dataRole) == -1) {\r\n\r\n                                var type = this.ctx.getSearchTypeByRole(elm.dataRole);\r\n\r\n                                html[html.length] = type.getSuggestionListHead();\r\n\r\n                                dataRoles.push(elm.dataRole);\r\n                            }\r\n\r\n                            const highlighting = function () {\r\n                                var highlighted = elm.label;\r\n                                var strReg = [];\r\n\r\n                                // eliminamos caracteres extraños del patrón ya analizado\r\n\r\n                                if (this.ctx.lastPattern.trim().length === 0 && self.textInput.value.trim().length > 0) {\r\n                                    this.ctx.lastPattern = self.textInput.value.trim();                                    \r\n                                }\r\n\r\n                                var normalizedLastPattern = this.ctx.lastPattern;\r\n                                if (self.NORMAL_PATTERNS.ROMAN_NUMBER.test(normalizedLastPattern))\r\n                                    normalizedLastPattern = normalizedLastPattern.replace(self.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT, '');\r\n                                else\r\n                                    normalizedLastPattern = normalizedLastPattern.replace(self.NORMAL_PATTERNS.ABSOLUTE, '');\r\n\r\n\r\n                                var querys = [];\r\n                                var separatorChar = ',';\r\n                                if (normalizedLastPattern.indexOf(separatorChar) == -1) {\r\n                                    separatorChar = ' ';\r\n                                }\r\n\r\n                                querys = normalizedLastPattern.trim().split(separatorChar);                                \r\n\r\n                                // si estamos tratando con coordenadas el separador es el espacio, no la coma\r\n                                if ((elm.label.indexOf(this.ctx.LAT_LABEL) > -1 && elm.label.indexOf(this.ctx.LON_LABEL) > -1) ||\r\n                                    (elm.label.indexOf(this.ctx.UTMX_LABEL) > -1 && elm.label.indexOf(this.ctx.UTMY_LABEL) > -1)) {\r\n                                    querys = this.ctx.lastPattern.split(' ');\r\n\r\n                                    for (var t = 0; t < querys.length; t++) {\r\n                                        if (querys[t].trim().slice(-1) == ',')\r\n                                            querys[t] = querys[t].slice(0, -1);\r\n                                    }\r\n                                }\r\n\r\n                                for (var q = 0; q < querys.length; q++) {\r\n                                    if (querys[q].trim().length > 0) {\r\n                                        strReg.push('(' + querys[q].trim().replace(/\\(/gi, \"\").replace(/\\)/gi, \"\") + ')');\r\n                                        var match = /((\\<)|(\\>)|(\\<\\>))/gi.exec(querys[q].trim());\r\n                                        if (match) {\r\n                                            var _strReg = querys[q].trim().replace(/((\\<)|(\\>)|(\\<\\>))/gi, '').split(' ');\r\n                                            for (var st = 0; st < _strReg.length; st++) {\r\n                                                if (_strReg[st].trim().length > 0)\r\n                                                    strReg.push('(' + _strReg[st].trim().replace(/\\(/gi, \"\\\\(\").replace(/\\)/gi, \"\\\\)\") + ')');\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n\r\n                                if (elm.dataRole == TC.Consts.searchType.ROAD || elm.dataRole == TC.Consts.searchType.ROADPK) {\r\n                                    var rPattern = self.getSearchTypeByRole(elm.dataRole).getPattern();\r\n                                    var match = rPattern.exec(this.ctx.lastPattern);\r\n\r\n                                    if (match) {\r\n                                        strReg = [];\r\n\r\n                                        if (match[2] && match[3] && match[4]) {\r\n                                            strReg.push('(' + match[2] + \"-\" + match[3] + \"-\" + match[4] + ')');\r\n                                        } else if (match[2] && match[3]) {\r\n                                            strReg.push('(' + match[2] + \"-\" + match[3] + ')');\r\n                                        } else if (match[3] && match[4]) {\r\n                                            strReg.push('(' + match[3] + \"-\" + match[4] + ')');\r\n                                        } else if (match[2] || match[3]) {\r\n                                            strReg.push('(' + (match[2] || match[3]) + ')');\r\n                                        }\r\n\r\n                                        if (match[5]) {\r\n                                            strReg.push(\"(?:\" + self.getLocaleString(\"search.list.pk\") + \"\\\\:\\\\s\\\\d*)\" + \"(\" + match[5] + \")\" + \"\\\\d*\");\r\n                                        }\r\n                                    } else if (match && match[5]) {\r\n                                        strReg = [];\r\n\r\n                                        strReg.push(\"(?:\" + self.getLocaleString(\"search.list.pk\") + \"\\\\:\\\\s\\\\d*)\" + \"(\" + match[5] + \")\" + \"\\\\d*\");\r\n                                    }\r\n                                }\r\n\r\n                                var pattern = '(' + strReg.join('|') + ')';\r\n\r\n                                pattern = pattern.replace(/á|à/gi, \"a\");\r\n                                pattern = pattern.replace(/é|è/gi, \"e\");\r\n                                pattern = pattern.replace(/í|ì/gi, \"i\");\r\n                                pattern = pattern.replace(/ó|ò/gi, \"o\");\r\n                                pattern = pattern.replace(/ú|ù/gi, \"u\");\r\n                                pattern = pattern.replace(/ü/gi, \"u\");\r\n\r\n                                pattern = pattern.replace(/a/gi, \"[a|á|à]\");\r\n                                pattern = pattern.replace(/e/gi, \"[e|é|è]\");\r\n                                pattern = pattern.replace(/i/gi, \"[i|í|ì]\");\r\n                                pattern = pattern.replace(/o/gi, \"[o|ó|ò]\");\r\n                                pattern = pattern.replace(/u/gi, \"[u|ú|ü|ù]\");\r\n                                var rex = new RegExp(pattern, \"gi\");\r\n\r\n                                var label = elm.label;\r\n\r\n                                if (elm.dataRole !== TC.Consts.searchType.ROAD || elm.dataRole !== TC.Consts.searchType.ROADPK) {\r\n                                    highlighted = label.replace(rex,\r\n                                        function () {\r\n                                            var params = Array.prototype.slice.call(arguments, 0);                                            \r\n\r\n                                            if (params[params.length - 3]) {\r\n                                                return params[0].replace(params[params.length - 3], \"<b>\" + params[params.length - 3] + \"</b>\");\r\n                                            } else {\r\n                                                return \"<b>\" + params[0] + \"</b>\";\r\n                                            }\r\n                                        });\r\n                                } else {\r\n                                    highlighted = label.replace(rex, \"<b>$1</b>\");\r\n                                }\r\n\r\n                                return highlighted;\r\n                            }.bind(this);\r\n\r\n                            html[html.length] = '<li dataRole=\"' + elm.dataRole + '\"><a href=\"' + '#' + encodeURIComponent(elm.id) + '\"><span hidden>' + elm.label + '</span>' + highlighting() + '</a></li>';\r\n                        }\r\n\r\n\r\n\r\n                        return html.join('');\r\n                    };\r\n\r\n                    TC.UI.autocomplete.call(self.textInput, {\r\n                        link: '#',\r\n                        target: self.resultsList,\r\n                        minLength: 2,\r\n                        ctx: self,\r\n                        source: source,\r\n                        callback: callback,\r\n                        buildHTML: buildHTML\r\n                    });                    \r\n\r\n                    var getNextSibling = function (elem, selector) {\r\n\r\n                        // Get the next sibling element\r\n                        var sibling = elem.nextElementSibling;\r\n\r\n                        // If there's no selector, return the first sibling\r\n                        if (!selector) return sibling;\r\n\r\n                        // If the sibling matches our selector, use it\r\n                        // If not, jump to the next sibling and continue the loop\r\n                        while (sibling) {\r\n                            if (sibling.matches(selector)) return sibling;\r\n                            sibling = sibling.nextElementSibling\r\n                        }\r\n\r\n                    };\r\n\r\n                    var getPreviousSibling = function (elem, selector) {\r\n\r\n                        // Get the next sibling element\r\n                        var sibling = elem.previousElementSibling;\r\n\r\n                        // If there's no selector, return the first sibling\r\n                        if (!selector) return sibling;\r\n\r\n                        // If the sibling matches our selector, use it\r\n                        // If not, jump to the next sibling and continue the loop\r\n                        while (sibling) {\r\n                            if (sibling.matches(selector)) return sibling;\r\n                            sibling = sibling.previousElementSibling;\r\n                        }\r\n\r\n                    };\r\n\r\n                    // Detect up/down arrow\r\n                    const onKeydown = function (e) {\r\n                        if (!e.ctrlKey && !e.altKey && !e.shiftKey) {\r\n                            if (e.keyCode === 40) { // down arrow\r\n                                if (self.textInput == document.activeElement && self.resultsList.querySelector('li:not([header]) a')) {\r\n                                    // Scenario 1: We're focused on the search input; move down to the first li\r\n                                    self.resultsList.querySelector('li:not([header]) a').focus();\r\n                                } else if (self.resultsList.querySelector('li:not([header]):last-child a') === document.activeElement) { //} else if (self.resultsList.querySelector('li:not([header]):last a').is(':focus')) {\r\n                                    // Scenario 2: We're focused on the last li; move up to search input\r\n                                    self.textInput.focus();\r\n                                } else {\r\n                                    // Scenario 3: We're in the list but not on the last element, simply move down\r\n                                    getNextSibling(document.activeElement.parentElement, 'li:not([header])')\r\n                                        .querySelector('a').focus();                                    \r\n                                }\r\n                                e.preventDefault(); // Stop page from scrolling\r\n                                e.stopPropagation();\r\n                            } else if (e.keyCode === 38) { // up arrow\r\n                                if (self.textInput == document.activeElement) {\r\n                                    // Scenario 1: We're focused on the search input; move down to the last li\r\n                                    self.resultsList.querySelector('li:not([header]):last-child a').focus();\r\n                                } else if (document.activeElement == self.resultsList.querySelector('li:not([header]) a')) {\r\n                                    self.resultsList.querySelector('li:not([header]):last-child a').focus();\r\n                                } else {\r\n                                    // Scenario 3: We're in the list but not on the first element, simply move up\r\n                                    getPreviousSibling(document.activeElement.parentElement, 'li:not([header])')\r\n                                        .querySelector('a').focus();                                    \r\n                                }\r\n                                e.preventDefault(); // Stop page from scrolling\r\n                                e.stopPropagation();\r\n                            }\r\n                        }\r\n                        e.stopPropagation();\r\n                    };\r\n\r\n                    self.textInput.addEventListener('keydown', onKeydown);\r\n                    self.resultsList.addEventListener('keydown', onKeydown);\r\n                }\r\n            );\r\n\r\n            if (TC.Util.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.addAllowedSearchType = function (name, options) {\r\n        var self = this;\r\n\r\n        self.allowedSearchTypes.push(new SearchType(name, options, self));\r\n    };\r\n\r\n    ctlProto.getSearchTypeByRole = function (type) {\r\n        var self = this;\r\n\r\n        return self.allowedSearchTypes.filter(function (allowed) {\r\n            return allowed.typeName == type;\r\n        })[0];\r\n    };\r\n\r\n    ctlProto.getSearchTypeByFeature = function (id) {\r\n        var self = this;\r\n\r\n        var type = self.allowedSearchTypes.filter(function (allowed) {\r\n            return allowed.isFeatureOfThisType(id);\r\n        });\r\n\r\n        if (type.length > 0) {\r\n            return type[0];\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    ctlProto.getElementOnSuggestionList = function (id, dataRole) {\r\n        const self = this;\r\n\r\n        for (var i = 0; i < self._search.data.length; i++) {\r\n            if (self._search.data[i].id == id && (!dataRole || (dataRole && self._search.data[i].dataRole === dataRole)))\r\n                return self._search.data[i];\r\n        }\r\n    };\r\n\r\n    ctlProto.getLayer = function () {\r\n        const self = this;\r\n        return self.layerPromise;\r\n    };\r\n\r\n    ctlProto.getFeatures = function () {\r\n        const self = this;\r\n        return self.layer.features;\r\n    };\r\n\r\n    ctlProto.cleanMap = function () {\r\n        const self = this;\r\n\r\n        if (self.layer) {\r\n            const l = self.layer;\r\n            var features = l.features.slice();\r\n            l.clearFeatures();\r\n\r\n            self.map.trigger(TC.Consts.event.FEATUREREMOVE, { layer: l, feature: features });\r\n\r\n            for (var i = 0; i < self.WFS_TYPE_ATTRS.length; i++) {\r\n                if (l.hasOwnProperty(self.WFS_TYPE_ATTRS[i]))\r\n                    delete l[self.WFS_TYPE_ATTRS[i]];\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.getMunicipalities = function () {\r\n        var self = this;\r\n\r\n        TC.cache.search = TC.cache.search || {};\r\n        self._municipalitiesPromise = new Promise(function (resolve, reject) {\r\n            if (TC.cache.search.municipalities) {\r\n                resolve(TC.cache.search.municipalities);\r\n            }\r\n            else {\r\n                var type = self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);\r\n\r\n                if (type.municipality && type.municipality.featureType && type.municipality.labelProperty && type.municipality.idProperty) {\r\n                    var params = {\r\n                        REQUEST: 'GetFeature',\r\n                        SERVICE: 'WFS',\r\n                        TYPENAME: type.municipality.featureType,\r\n                        VERSION: type.version,\r\n                        PROPERTYNAME: type.municipality.labelProperty + \",\" + type.municipality.idProperty,\r\n                        OUTPUTFORMAT: type.outputFormat\r\n                    };\r\n                    if (type.featurePrefix) {\r\n                        params.TYPENAME = type.featurePrefix + ':' + params.TYPENAME;\r\n                    }\r\n                    var url = type.url + '?' + TC.Util.getParamString(params);\r\n                    TC.ajax({\r\n                        url: url,\r\n                        method: 'GET',\r\n                        responseType: 'text'\r\n                    }).then(function (response) {\r\n                        const data = response.data;\r\n                        var parser;\r\n                        if (type.outputFormat === TC.Consts.format.JSON) {\r\n                            parser = new TC.wrap.parser.JSON();\r\n                        }\r\n                        else {\r\n                            parser = new TC.wrap.parser.WFS({\r\n                                featureNS: type.municipality.featurePrefix,\r\n                                featureType: type.municipality.featureType\r\n                            });\r\n                        }\r\n                        var features = parser.read(data);\r\n                        TC.cache.search.municipalities = [];\r\n                        for (var i = 0; i < features.length; i++) {\r\n                            var feature = features[i];\r\n                            TC.cache.search.municipalities.push({ label: feature.data[type.municipality.labelProperty], id: feature.data[type.municipality.idProperty] });\r\n                        }\r\n\r\n                        TC.cache.search.municipalities.sort(function (a, b) {\r\n                            var result;\r\n                            if (a.label < b.label) {\r\n                                result = -1;\r\n                            }\r\n                            else if (a.label > b.label) {\r\n                                result = 1;\r\n                            }\r\n                            else {\r\n                                result = 0;\r\n                            }\r\n                            return result;\r\n                        });\r\n\r\n                        resolve(TC.cache.search.municipalities);\r\n                    }).catch(function () {\r\n                        resolve();\r\n                    });\r\n                } else {\r\n                    throw new Error(\"Error en la configuración de la búsqueda: \" + type.typeName + \". Error en el objeto municipality\");\r\n                }\r\n            }\r\n        });\r\n        return self._municipalitiesPromise;\r\n    };\r\n\r\n    ctlProto.getCoordinates = function (pattern) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var match = pattern.match(new RegExp('^' + self.UTMX_LABEL.trim().toLowerCase() + '*\\\\s*([0-9]{' + self.UTMX_LEN + '}(?:[.,]\\\\d+)?)\\\\s*\\\\,?\\\\s*' + self.UTMY_LABEL.trim().toLowerCase() + '*\\\\s*([0-9]{' + self.UTMY_LEN + '}(?:[.,]\\\\d+)?)$'));\r\n            if (match) {\r\n                pattern = match[1] + ' ' + match[2];\r\n            }\r\n\r\n            match = pattern.match(new RegExp('^' + self.LAT_LABEL.trim().toLowerCase() + '*\\\\s*([-+]?\\\\d{1,3}([.,]\\\\d+)?)\\\\,?\\\\s*' + self.LON_LABEL.trim().toLowerCase() + '*\\\\s*([-+]?\\\\d{1,2}([.,]\\\\d+)?)$'));\r\n            if (match) {\r\n                pattern = match[1] + ' ' + match[3];\r\n            }\r\n\r\n            if (/\\d/.test(pattern) && (new RegExp('^([0-9]{' + self.UTMX_LEN + '}(?:[.,]\\\\d+)?)\\\\s*\\\\,?\\\\s*([0-9]{' + self.UTMY_LEN + '}(?:[.,]\\\\d+)?)$').test(pattern) || /^([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*([-+]?\\d{1,2}([.,]\\d+)?)$/.test(pattern))) {\r\n                match = /^([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*([-+]?\\d{1,2}([.,]\\d+)?)$/.exec(pattern);\r\n                if (match && (match[1].indexOf(',') > -1 || match[3].indexOf(',') > -1)) {\r\n                    match[1] = match[1].replace(',', '.');\r\n                    match[3] = match[3].replace(',', '.');\r\n\r\n                    pattern = match[1] + ' ' + match[3];\r\n                }\r\n\r\n                if (!match || match && ((match[1].indexOf(',') > -1 ? match[1].replace(',', '.') : match[1]) <= 180) && ((match[3].indexOf(',') > -1 ? match[3].replace(',', '.') : match[3]) <= 90)) {\r\n\r\n                    match = new RegExp('^([0-9]{' + self.UTMX_LEN + '}(?:[.,]\\\\d+)?)\\\\s*\\\\,?\\\\s*([0-9]{' + self.UTMY_LEN + '}(?:[.,]\\\\d+)?)$').exec(pattern);\r\n                    if (match && (match[1].indexOf(',') > -1 || match[2].indexOf(',') > -1)) {\r\n                        match[1] = match[1].replace(',', '.');\r\n                        match[2] = match[2].replace(',', '.');\r\n\r\n                        pattern = match[1] + ' ' + match[2];\r\n                    }\r\n\r\n                    // parse coordinates\r\n                    pattern = pattern.replace(self.UTMX_LABEL, '').replace(self.UTMY_LABEL, '').replace(self.LON_LABEL, '').replace(self.LAT_LABEL, '');\r\n                    var coords = TC.Util.parseCoords(pattern);\r\n                    if (coords) {\r\n                        var xValue = coords[0].value;\r\n                        var yValue = coords[1].value;\r\n                        var xLabel = (coords[0].type === TC.Consts.UTM) ? self.UTMX : self.LAT;\r\n                        var yLabel = (coords[1].type === TC.Consts.UTM) ? self.UTMY : self.LON;\r\n                        var id = xLabel + xValue + yLabel + yValue;\r\n\r\n                        var point = self.getPoint(id);\r\n                        if (point && !self.insideLimit(point)) {\r\n                            xValue = coords[1].value;\r\n                            yValue = coords[0].value;\r\n                            xLabel = (coords[1].type === TC.Consts.UTM) ? self.UTMX : self.LAT;\r\n                            yLabel = (coords[0].type === TC.Consts.UTM) ? self.UTMY : self.LON;\r\n                            id = xLabel + xValue + yLabel + yValue;\r\n                            point = self.getPoint(id);\r\n                        }\r\n\r\n                        if (point) {\r\n                            self.availableSearchTypes[TC.Consts.searchType.COORDINATES].label = /^X(\\d+(?:\\.\\d+)?)Y(\\d+(?:\\.\\d+)?)$/.test(id) ? self.getLocaleString('search.list.coordinates.utm') + self.map.crs : self.getLocaleString('search.list.coordinates.geo');\r\n\r\n                            //console.log('getCoordinates promise resuelta');\r\n                            resolve([{\r\n                                id: id, label: self.getLabel(id), dataRole: TC.Consts.searchType.COORDINATES\r\n                            }]);\r\n                        }\r\n                        else {\r\n                            //console.log('getCoordinates promise resuelta');\r\n                            resolve([]);\r\n                        }\r\n                    } else {\r\n                        //console.log('getCoordinates promise resuelta');\r\n                        resolve([]);\r\n                    }\r\n                } else {\r\n                    //console.log('getCoordinates promise resuelta');\r\n                    resolve([]);\r\n                }\r\n            } else {\r\n                //console.log('getCoordinates promise resuelta');\r\n                resolve([]);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.getCadastralRef = function (pattern) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var match = pattern.match(new RegExp(self.MUN_LABEL.trim().toLowerCase() + '?\\\\s(.*)\\\\,\\\\s?' + self.POL_LABEL.trim().toLowerCase() + '?\\\\s(\\\\d{1,2})\\\\,\\\\s?' + self.PAR_LABEL.trim().toLowerCase() + '?\\\\s(\\\\d{1,4})'));\r\n            if (match) {\r\n                pattern = match[1] + ', ' + match[2] + ', ' + match[3];\r\n            }\r\n\r\n            var _pattern = pattern;\r\n            if (!(/^(.*)\\,(\\s*\\d{1,2}\\s*)\\,(\\s*\\d{1,4}\\s*)$/.test(pattern)) && self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)\r\n                _pattern = self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot + ', ' + pattern;\r\n\r\n            if (/^(.*)\\,(\\s*\\d{1,2}\\s*)\\,(\\s*\\d{1,4}\\s*)$/.test(_pattern) && !(new RegExp('^([0-9]{' + self.UTMX_LEN + '})\\\\s*\\\\,\\\\s*([0-9]{' + self.UTMY_LEN + '})$').test(pattern))) {\r\n                self.getMunicipalities().then(function (list) {\r\n                    var match = /^(.*)\\,(\\s*\\d{1,2}\\s*)\\,(\\s*\\d{1,4}\\s*)$/.exec(_pattern);\r\n                    if (match) {\r\n                        var matcher = new RegExp(match[1].trim().replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\"), \"i\");\r\n                        var results = [];\r\n\r\n                        const getItem = function (mun, munLabel, pol, par) {\r\n                            var properties = [];\r\n\r\n                            properties.push[self.MUN] = mun;\r\n                            properties.push[self.POL] = pol;\r\n                            properties.push[self.PAR] = par;\r\n\r\n                            return {\r\n                                id: self.MUN + mun + self.POL + pol + self.PAR + par,\r\n                                label: self.getLabel(self.MUN + munLabel + self.POL + pol + self.PAR + par),\r\n                                dataRole: TC.Consts.searchType.CADASTRAL,\r\n                                properties: properties\r\n                            };\r\n                        };\r\n\r\n                        results = list.filter(function (value) {\r\n                            value = value.label || value.id || value;\r\n                            return matcher.test(value) || matcher.test(self.removePunctuation(value));\r\n                        });\r\n\r\n                        if (results.length > 0) {\r\n                            for (var i = 0; i < results.length; i++) {\r\n                                results[i] = getItem(results[i].id, results[i].label, match[2].trim(), match[3].trim());\r\n                            }\r\n                        }\r\n\r\n                        if (/^[0-9]*$/g.test(match[1])) {\r\n\r\n                            if (match[1].trim() === self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot) {\r\n\r\n                                var suggestionRoot = list.filter(function (elm) {\r\n                                    return parseInt(elm.id) === parseInt(self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot);\r\n                                })[0];\r\n\r\n                                if (suggestionRoot) {\r\n                                    resolve([getItem(suggestionRoot.id, suggestionRoot.label, match[2].trim(), match[3].trim())]);\r\n                                }\r\n                            }\r\n\r\n                            results.push(getItem(match[1].trim(), match[1].trim(), match[2].trim(), match[3].trim()));\r\n                        }\r\n\r\n                        //console.log('getCadastralRef promise resuelta');\r\n                        resolve(results);\r\n                    }\r\n                });\r\n            } else {\r\n                //console.log('getCadastralRef promise resuelta - no es ref catastral');\r\n                resolve([]);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.stringPatternsValidators = {\r\n        tsp: function (text, result, root, limit) {\r\n            // town, street, portal - street, town, portal\r\n            var match = /^([^0-9\\,]+)(?:\\s*\\,\\s*)(?:([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9]+))(?:\\s*\\,\\s*)(?:(\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4}))$/i.exec(text);\r\n            if (match && match[1] && match[2]) {\r\n\r\n                var getPortal = function () {\r\n                    return formatStreetNumber((match[3] || match[4] || match[5] || match[6]).trim());\r\n                };\r\n                // ninguno contiene número duplicamos búsqueda\r\n                if (/^([^0-9]+)$/i.test(match[1].trim()) && /^([^0-9]+)$/i.test(match[2].trim())) {\r\n                    result.push({\r\n                        t: match[1].trim(), s: match[2].trim(), p: getPortal()\r\n                    });\r\n                    result.push({\r\n                        t: match[2].trim(), s: match[1].trim(), p: getPortal()\r\n                    });\r\n                }\r\n                else {  // indicamos como calle el criterio que contiene números, ya que no existen municipios con números pero sí calles\r\n                    if (/^([^0-9]+)$/i.test(match[1].trim())) result.push({\r\n                        t: match[1].trim(), s: match[2].trim(), p: getPortal()\r\n                    });\r\n                    else result.push({\r\n                        s: match[1].trim(), t: match[2].trim(), p: getPortal()\r\n                    });\r\n                }\r\n                bindRoot.call(this, result, root, limit);\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        spt: function (text, result, root, limit) {\r\n            // street, portal, town\r\n            var match = /^(?:([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9]+))(?:\\s*\\,\\s*)(?:(\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4}))(?:\\s*\\,\\s*)([^0-9\\,]+)$/i.exec(text);\r\n            if (match && match[6] && match[1]) {\r\n\r\n                var getPortal = function () {\r\n                    return formatStreetNumber((match[2] || match[3] || match[4] || match[5]).trim());\r\n                };\r\n                // ninguno contiene número duplicamos búsqueda\r\n                if (/^([^0-9]+)$/i.test(match[6].trim()) && /^([^0-9]+)$/i.test(match[1].trim())) {\r\n                    result.push({\r\n                        t: match[6].trim(), s: match[1].trim(), p: getPortal()\r\n                    });\r\n                    result.push({\r\n                        t: match[1].trim(), s: match[6].trim(), p: getPortal()\r\n                    });\r\n                }\r\n                else {  // indicamos como calle el criterio que contiene números, ya que no existen municipios con números pero sí calles\r\n                    if (/^([^0-9]+)$/i.test(match[6].trim())) result.push({\r\n                        t: match[6].trim(), s: match[1].trim(), p: getPortal()\r\n                    });\r\n                    else result.push({\r\n                        s: match[6].trim(), t: match[1].trim(), p: getPortal()\r\n                    });\r\n                }\r\n                bindRoot.call(this, result, root, limit);\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        tnsp: function (text, result, root, limit) {\r\n            // town, numbers street, portal\r\n            var match = /^(?:([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9]+))(?:\\s*\\,\\s*)([^0-9\\,]+)(?:\\s*\\,\\s*)(?:(\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4}))$/i.exec(text);\r\n\r\n            if (match && match[1] && match[2]) {\r\n                result.push({\r\n                    t: match[2].trim(), s: match[1].trim(), p: formatStreetNumber((match[3] || match[4] || match[5] || match[6]).trim())\r\n                });\r\n                bindRoot.call(this, result, root, limit);\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        ts: function (text, result, root, limit) {\r\n            // town, street\r\n            var match = /^([^0-9\\,]+)(?:\\s*\\,\\s*)(?:([^\\,][a-zñáéíóúüàèìòù\"\\s*\\-\\.\\(\\)\\/0-9]+))$/i.exec(text);\r\n\r\n            // topónimo, municipio\r\n            if (!match && /^[^0-9]*$/i.test(text.trim())) { // si no hay números reviso dándole la vuelta, si hay números que lo trate la función st\r\n                var criteria = text.split(',').reverse();\r\n                match = /^([^0-9\\,]+)(?:\\s*\\,\\s*)(?:([^\\,][a-zñáéíóúüàèìòù\"\\s*\\-\\.\\(\\)\\/0-9]+))$/i.exec(criteria.join(','));\r\n            }\r\n\r\n            if (match && match[1] && match[2]) {\r\n                // ninguno contiene número duplicamos búsqueda\r\n                if (/^([^0-9]+)$/i.test(match[1].trim()) && /^([^0-9]+)$/i.test(match[2].trim())) {\r\n                    result.push({\r\n                        t: match[1].trim(), s: match[2].trim()\r\n                    });\r\n                    result.push({\r\n                        s: match[1].trim(), t: match[2].trim()\r\n                    });\r\n\r\n                    bindRoot.call(this, result, root, limit);\r\n                }\r\n                else {  // indicamos como calle el criterio que contiene números, ya que no existen municipios con números pero sí calles\r\n\r\n                    var getStreet = function (s) {\r\n                        var revS = s.split(' ').reverse();\r\n                        // validamos si el criterio es compuesto \r\n                        var fs = [];\r\n                        for (var si = 0; si < revS.length; si++) {\r\n                            if (revS[si].length == 1) {\r\n                                fs.push(revS[si]);\r\n                                revS[si] = '';\r\n                            }\r\n                        }\r\n\r\n                        return fs.length > 0 ? revS.reverse().join(' ').trim() + self._LIKE_PATTERN + fs.reverse().join(self._LIKE_PATTERN) : revS.reverse().join(' ').trim();\r\n                    };\r\n\r\n                    if (/^([^0-9]+)$/i.test(match[1].trim()))\r\n                        result.push({\r\n                            t: match[1].trim(), s: getStreet(match[2].trim())\r\n                        });\r\n                    else result.push({\r\n                        s: getStreet(match[1].trim()), t: match[2].trim()\r\n                    });\r\n\r\n                    bindRoot.call(this, result, root, limit, true);\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        st: function (text, result, root, limit) {\r\n            // street, town\r\n            var match = /^(?:([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9]+))(?:\\s*\\,\\s*)([^0-9\\,]+)$/i.exec(text);\r\n\r\n            if (!match) {\r\n                var criteria = text.split(',').reverse();\r\n                match = /^([^0-9\\,]+)(?:\\s*\\,\\s*)(?:([^\\,][a-zñáéíóúüàèìòù\"\\s*\\-\\.\\(\\)\\/0-9]+))$/i.exec(criteria.join(','));\r\n            }\r\n\r\n            if (match) { // puede generar falsos positivos cuando el portal llega seguido de la calle -> calle mayor 14, pamplona\r\n                var data = {\r\n                };\r\n                var criteria = text.split(',').reverse();\r\n                for (var i = 0; i < criteria.length; i++) {\r\n                    if (/^([^0-9\\,]+)$/i.test(criteria[i].trim())) { // si no hay números se trata de municipio\r\n                        data.t = criteria[i].trim();\r\n                    }\r\n                    else if (/(\\s*\\d+)/i.test(criteria[i].trim())) { // si contiene número, puede ser calle o calle + portal\r\n                        if (criteria[i].trim().indexOf(' ') == -1) { // si no contiene espacios se trata de calle compuesta por números\r\n                            data.s = criteria[i].trim();\r\n                        } else { // si contiene espacio puede contener calle + portal\r\n                            var _criteria = criteria[i].trim().split(' ').reverse();\r\n\r\n                            var isPortal = function (c) {\r\n                                var m = /^(?:(\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4}))$/i.exec(c.trim());\r\n                                if (m) {\r\n                                    data.p = formatStreetNumber(c.trim());\r\n                                    return true;\r\n                                }\r\n                                return false;\r\n                            };\r\n\r\n                            var x = 0;\r\n                            var p = _criteria[x].trim();\r\n                            while (x < _criteria.length && !isPortal(p)) {\r\n                                x++;\r\n                                if (x < _criteria.length)\r\n                                    p = p + _criteria[x];\r\n\r\n                            }\r\n\r\n                            if (data.p) {\r\n                                var _cr = _criteria;\r\n                                for (var h = 0; h < _cr.length; h++) {\r\n                                    // validamos que lo que hemos deducido como portal, está en portal para no añadirlo a calle\r\n                                    var inPortal = false;\r\n                                    for (var c = 0; c < _cr[h].split('').length; c++) {\r\n                                        if (data.p.indexOf(_cr[h][c]) > -1)\r\n                                            inPortal = true;\r\n                                    }\r\n\r\n                                    if (inPortal) {\r\n                                        var _p = _cr[h];\r\n\r\n                                        _cr[h] = '';\r\n                                        if (data.p == formatStreetNumber(p))\r\n                                            break;\r\n                                    }\r\n                                }\r\n\r\n                                if (/^([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9]+)$/i.test(_criteria.reverse().join(' ').trim())) {\r\n                                    var fs = [];\r\n                                    var criteriaRev = _criteria.reverse();\r\n                                    for (var chs = 0; chs < criteriaRev.length; chs++) {\r\n                                        if (criteriaRev[chs].trim().length == 1) {\r\n                                            fs.push(criteriaRev[chs].trim());\r\n                                            criteriaRev[chs] = '';\r\n                                        }\r\n                                    }\r\n\r\n                                    data.s = fs.length > 0 ? criteriaRev.reverse().join(' ').trim() + self._LIKE_PATTERN + fs.reverse().join(self._LIKE_PATTERN) : criteriaRev.reverse().join(' ').trim();\r\n                                }\r\n\r\n\r\n                                // nombre_de_calle = 137, 1, 20...\r\n                                // duplico la búsqueda para el caso de [Calle nombre_de_calle], municipio\r\n                                result.push({\r\n                                    t: data.t,\r\n                                    s: data.s + ' ' + data.p\r\n                                });\r\n                            } else {\r\n                                data.s = criteria[i].trim();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                result.push(data);\r\n                bindRoot.call(this, result, root, limit);\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        s_or_t: function (text, result, root, limit) {\r\n            var match = /^([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/0-9\\<\\>]+)$/i.exec(text);\r\n            if (match && match[1]) {\r\n                if (root) {\r\n                    result.push({\r\n                        t: match[1].trim()\r\n                    });\r\n\r\n                    result.push({\r\n                        t: root,\r\n                        s: match[1].trim()\r\n                    });\r\n                }\r\n                else result.push({\r\n                    t: match[1].trim()\r\n                });\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        sp: function (text, result, root, limit) {\r\n            var match = /^([^\\,][a-zñáéíóúüàèìòù\\s*\\-\\.\\(\\)\\/]+)\\s*\\,?\\s*((\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4}))$/i.exec(text);\r\n            if (match && match[1] && match[2]) { // && text.indexOf(',') > -1 && text.split(',').length < 3) {\r\n                if (root)\r\n                    result.push({\r\n                        t: root,\r\n                        s: match[1].trim(),\r\n                        p: formatStreetNumber(match[2].trim())\r\n                    });\r\n                else\r\n                    result.push({\r\n                        t: match[1].trim(),\r\n                        s: match[2].trim()\r\n                    });\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        },\r\n        snp: function (text, result, root, limit) { // calle puede contener números con portal (cuando exista un municipio root establecido)\r\n            var match = /^([^\\,][0-9\\s*\\-\\.\\(\\)\\/]+)\\s*\\,?\\s*(\\d{1,3}\\s?\\-?\\s?[a-z]{0,4}\\s?\\-?\\s?[a-z]{0,4})|([a-z]{1,4}\\s?\\-?\\s?\\d{1,3})|(sn|S\\/N|s\\/n|s\\-n)|([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4})$/i.exec(text);\r\n            if (match && match[1] && match[2] && root) {\r\n                result.push({\r\n                    t: root,\r\n                    s: match[1].trim(),\r\n                    p: formatStreetNumber(match[2].trim())\r\n                });\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n    };\r\n\r\n    /* métodos auxiliares de getStringPattern */\r\n\r\n    const normalizedCriteria = function (value) {\r\n        const self = this;\r\n\r\n        var _value = '';\r\n\r\n        value = self.removePunctuation(value);\r\n\r\n        // elimino los caracteres especiales\r\n        if (self.NORMAL_PATTERNS.ROMAN_NUMBER.test(value))\r\n            value = value.replace(self.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT, '');\r\n        else\r\n            value = value.replace(self.NORMAL_PATTERNS.ABSOLUTE, '');\r\n        return value.toLowerCase();\r\n    };\r\n\r\n    const formatStreetNumber = function (value) {\r\n        var result = value;\r\n\r\n        var is_nc_c = function (value) {\r\n            return /^(\\d{1,3})\\s?\\-?\\s?([a-z]{0,4})\\s?\\-?\\s?([a-z]{0,4})$/i.test(value);\r\n        }\r\n        var nc_c = function (value) {\r\n            var f = [];\r\n            var m = /^(\\d{1,3})\\s?\\-?\\s?([a-z]{0,4})\\s?\\-?\\s?([a-z]{0,4})$/i.exec(value);\r\n            if (m) {\r\n                for (var i = 1; i < m.length; i++) {\r\n                    if (m[i].trim().length > 0)\r\n                        f.push(m[i].trim());\r\n                }\r\n\r\n                return f.join(self._LIKE_PATTERN);\r\n            }\r\n            return value;\r\n        };\r\n\r\n        var is_cn = function (value) {\r\n            return /^([a-z]{1,4})\\s?\\-?\\s?(\\d{1,3})$/i.test(value);\r\n        };\r\n        var cn = function (value) {\r\n            var f = [];\r\n            var m = /^([a-z]{1,4})\\s?\\-?\\s?(\\d{1,3})$/i.exec(value);\r\n            if (m) {\r\n                for (var i = 1; i < m.length; i++) {\r\n                    if (m[i].trim().length > 0)\r\n                        f.push(m[i].trim());\r\n                }\r\n\r\n                return f.join(self._LIKE_PATTERN);\r\n            }\r\n            return value;\r\n        };\r\n\r\n        var is_sn = function (value) {\r\n            return /^(sn|S\\/N|s\\/n|s\\-n)$/i.test(value);\r\n        };\r\n        var sn = function (value) {\r\n            var m = /^(sn|S\\/N|s\\/n|s\\-n)$/i.exec(value);\r\n            if (m) {\r\n                return 's*n';\r\n            }\r\n            return value;\r\n        };\r\n\r\n\r\n        var is_cmc = function (value) {\r\n            return /^([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4})$/i.test(value);\r\n        };\r\n        var cmc = function (value) {\r\n            var m = /^([a-z]{1,4}\\s?\\+\\s?[a-z]{1,4})$/i.exec(value);\r\n            if (m) {\r\n                return value;\r\n            }\r\n            return value;\r\n        };\r\n\r\n        var isCheck = [is_nc_c, is_cn, is_sn, is_cmc];\r\n        var check = [nc_c, cn, sn, cmc];\r\n        var ch = 0;\r\n        while (ch < check.length && !isCheck[ch].call(self, value)) {\r\n            ch++;\r\n        }\r\n\r\n        if (ch < check.length)\r\n            return check[ch].call(self, value);\r\n        else return value;\r\n    };\r\n\r\n    const bindRoot = function (result, root, limit, addRoot) {\r\n        const self = this;\r\n\r\n        if (root) {\r\n            var i = result.length;\r\n            while (i--) {\r\n                if (!addRoot) {\r\n                    if (result[i].t) {\r\n                        var indicatedRoot = self.rootCfg.active.rootLabel.filter(function (elem) {\r\n                            return elem.label.indexOf(self.removePunctuation(result[i].t).toLowerCase()) > -1;\r\n                        }.bind(self));\r\n\r\n                        if (indicatedRoot.length == 1) {\r\n                            result[i].t = indicatedRoot[0].id;\r\n                        } else if (indicatedRoot.length > 1) {\r\n\r\n                            indicatedRoot.map(function (elem) {\r\n                                var newResult = TC.Util.extend({\r\n                                }, result[i]);\r\n                                newResult.t = elem.id;\r\n\r\n                                result.push(newResult);\r\n                            });\r\n\r\n                        } else if (indicatedRoot.length == 0 && limit) {\r\n                            result.splice(i, 1);\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    result.push(TC.Util.extend({}, result[i], { t: root }));\r\n                };\r\n            }\r\n        }\r\n    };\r\n\r\n    const getObjectsFromStringToQuery = function (allowedRoles, text) {\r\n        const self = this;\r\n        const root = self.rootCfg.active && self.rootCfg.active.root || '';\r\n        const limit = self.rootCfg.active && self.rootCfg.active.limit || false;\r\n\r\n        var result = [];\r\n\r\n        const test = function () {\r\n            var tests = [function (text) {\r\n                return text.length >= 3;\r\n            },\r\n            function (text) {\r\n                return /^\\d+$/.test(text) ? false : (/^\\d+\\,\\s*\\d+$/.test(text) ? false : true);\r\n            }];\r\n\r\n            for (var i = 0; i < tests.length; i++) {\r\n                if (!tests[i].call(self, text))\r\n                    return false;\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        // eliminamos espacios en blanco\r\n        text = text.trim();\r\n\r\n        // comprobamos si acaba con coma, si es así, la eliminamos\r\n        if (text.charAt(text.length - 1) == ',') {\r\n            text = text.substring(0, text.length - 1);\r\n        }\r\n\r\n        if (test(text)) {\r\n            var check = [];\r\n\r\n            check = allowedRoles.map(function (dataRole) {\r\n                return self.getSearchTypeByRole(dataRole);\r\n            }).filter(function (searchType) {\r\n                return searchType.stringPatternToCheck;\r\n            }).map(function (searchType) {\r\n                return searchType.stringPatternToCheck;\r\n            });\r\n\r\n            if (check.length === 0) {\r\n                check = [self.stringPatternsValidators.tsp, self.stringPatternsValidators.spt, self.stringPatternsValidators.tnsp, self.stringPatternsValidators.ts, self.stringPatternsValidators.st];\r\n                if (root && text.split(',').length < 3) {\r\n                    check = [self.stringPatternsValidators.sp, self.stringPatternsValidators.snp, self.stringPatternsValidators.s_or_t].concat(check);\r\n                }\r\n                else {\r\n                    check = check.concat([self.stringPatternsValidators.sp, self.stringPatternsValidators.snp, self.stringPatternsValidators.s_or_t]);\r\n                }\r\n            }\r\n\r\n            var ch = 0;\r\n            try {\r\n                while (ch < check.length && !check[ch].call(self, text, result, root, limit)) {\r\n                    ch++;\r\n                }\r\n            }\r\n            catch (ex) {\r\n                TC.error(\"Error según el patrón: \" + text, TC.Consts.msgErrorMode.EMAIL, \"Error en la búsqueda del callejero\");\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    const requestToWFS = function (type, doneCallback, data) {\r\n        const self = this;\r\n\r\n        self.resultsList.innerHTML = '<li><a class=\"tc-ctl-search-li-loading\" href=\"#\">' + self.getLocaleString('searching') + '<span class=\"tc-ctl-search-loading-spinner tc-ctl-search-loading\"></span></a></li>';\r\n        self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n        return TC.ajax({\r\n            url: type.url,\r\n            method: 'POST',\r\n            //contentType: \"application/x-www-form-urlencoded;charset=UTF-8\",\r\n            responseType: 'text',\r\n            data: type.filter.getParams(data)\r\n        })\r\n            .then(doneCallback)\r\n            .catch(function (data) {\r\n                if (data.statusText !== 'abort')\r\n                    alert('error');\r\n\r\n                //console.log('getStringPattern promise resuelta - data.statusText: ' + data.statusText);\r\n            });\r\n    };\r\n\r\n    const getResultsFromWFS = function (allowedRoles, resolve, reject, objectsToQuery) {\r\n        const self = this;\r\n\r\n        if (objectsToQuery) {\r\n            var results = [];\r\n\r\n            self._search.data = results;\r\n\r\n            if (!self.request) {\r\n                self.request = [];\r\n            }\r\n\r\n            objectsToQuery.forEach(function (data, i) {\r\n\r\n                allowedRoles.filter(function (elm) {\r\n                    var type = self.getSearchTypeByRole(elm);\r\n                    return Object.keys(type.queryProperties).length === Object.keys(data).length;\r\n                }).map(function (dataRole) {\r\n                    var type = self.getSearchTypeByRole(dataRole);\r\n                    self.request.push(requestToWFS.call(self, type, function (response) {\r\n                        results = results.concat(type.getSuggestionListElements(response.data));\r\n                    }, data));\r\n                });\r\n            });\r\n\r\n            Promise.all(self.request).then(function () {\r\n                //self.request = [];\r\n                //console.log('getStringPattern promise resuelta');\r\n                resolve(results);\r\n            });\r\n        } else {\r\n            //console.log('getStringPattern promise resuelta - no encaja en address');\r\n            resolve([]);\r\n        }\r\n    };\r\n\r\n    ctlProto.getStringPattern = function (allowedRoles, pattern) {\r\n        const self = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            pattern = normalizedCriteria.call(self, pattern);\r\n\r\n            /* gestionamos:\r\n                Entidad de población: Irisarri Auzoa (Igantzi)\r\n                Topónimo: Aldabeko Bidea (Arbizu)\r\n            */\r\n            var combinedCriteria = /(.*)\\((.*)\\)/.exec(pattern);\r\n            if (combinedCriteria && combinedCriteria.length > 2) {\r\n\r\n                // búsqueda de entidad de población\r\n                var objectsToQuery = getObjectsFromStringToQuery.call(self, allowedRoles, combinedCriteria[1]);\r\n\r\n                // búsqueda de topónimo\r\n                var bothSearchObjects = getObjectsFromStringToQuery.call(self, allowedRoles, combinedCriteria[1] + ',' + combinedCriteria[2]);\r\n\r\n                bothSearchObjects = (bothSearchObjects || []).concat(objectsToQuery || []);\r\n\r\n                getResultsFromWFS.call(self, allowedRoles, resolve, reject, bothSearchObjects);\r\n            } else {\r\n                var objectsToQuery = getObjectsFromStringToQuery.call(self, allowedRoles, pattern);\r\n\r\n                getResultsFromWFS.call(self, allowedRoles, resolve, reject, objectsToQuery);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.getRoad = function (pattern) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            pattern = pattern.trim();\r\n            if (pattern.length < 2) {\r\n                resolve([]);\r\n            } else {\r\n                var type = self.getSearchTypeByRole(TC.Consts.searchType.ROAD);\r\n\r\n                var roadPattern = type.getPattern();\r\n                var match = roadPattern.exec(pattern);\r\n                if (match && match[3]) {\r\n\r\n                    var _pattern = match[2] ? match[2].trim() + \"-\" + match[3].trim() : match[3].trim();\r\n                    if (match[4] && match[4].length > 0) {\r\n                        _pattern = _pattern + \"-\" + match[4].trim();\r\n                    }\r\n\r\n                    self.resultsList.innerHTML = '<li><a class=\"tc-ctl-search-li-loading\" href=\"#\">' + self.getLocaleString('searching') + '<span class=\"tc-ctl-search-loading-spinner tc-ctl-search-loading\"></span></a></li>';\r\n                    self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n                    TC.ajax({\r\n                        url: type.url + '?' + type.filter.getParams({ t: _pattern }),\r\n                        method: 'GET',\r\n                        responseType: TC.Consts.mimeType.JSON\r\n                    }).then(function (response) {\r\n                        const data = response.data;\r\n                        var result = [];                        \r\n\r\n                        if (data.totalFeatures > 0) {\r\n                            data.features.map(function (feature) {\r\n                                var properties = type.outputProperties;\r\n                                if (!result.some(function (elem) {\r\n                                    return (elem.text == feature.properties[properties[0]]);\r\n                                })) {\r\n                                    var label = type.outputFormatLabel.tcFormat(type.outputProperties.map(function (outputProperty) {\r\n                                        return feature.properties[outputProperty];\r\n                                    }));\r\n\r\n                                    var text = type.outputProperties.map(function (outputProperty) {\r\n                                        return feature.properties[outputProperty];\r\n                                    }).join('-');\r\n\r\n                                    result.push({\r\n                                        id: type.dataIdProperty.map(function (elem) {\r\n                                            return feature.properties[elem];\r\n                                        }).join('#'),\r\n                                        label: label,\r\n                                        text: text,\r\n                                        dataLayer: feature.id.split('.')[0],\r\n                                        dataRole: type.typeName\r\n                                    });\r\n                                }\r\n                            });\r\n\r\n                            //console.log('getRoad promise resuelta');\r\n                            resolve(result);\r\n                        } else {\r\n                            //console.log('getRoad promise resuelta');\r\n                            resolve([]);\r\n                        }\r\n                    }).catch(function (data) {\r\n                        //console.log('getRoad promise resuelta - xhr fail');\r\n                        resolve([]);\r\n                    });\r\n                } else {\r\n                    //console.log('getRoad promise resuelta - no encaja en road');\r\n                    resolve([]);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.getPK = function (pattern) {\r\n        var self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            pattern = pattern.trim();\r\n            if (pattern.length < 3) {\r\n                resolve([]);\r\n            } else {\r\n\r\n                var type = self.getSearchTypeByRole(TC.Consts.searchType.ROADPK);\r\n\r\n                var roadPKPattern = type.getPattern();\r\n                var match = roadPKPattern.exec(pattern);\r\n                if (match && match[3] && match[5]) {\r\n\r\n                    var _pattern = match[2] ? match[2].trim() + \"-\" + match[3].trim() : match[3].trim();\r\n                    if (match[4] && match[4].length > 0) {\r\n                        _pattern = _pattern + \"-\" + match[4].trim();\r\n                    }\r\n\r\n                    self.resultsList.innerHTML = '<li><a class=\"tc-ctl-search-li-loading\" href=\"#\">' + self.getLocaleString('searching') + '<span class=\"tc-ctl-search-loading-spinner tc-ctl-search-loading\"></span></a></li>';\r\n                    self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n                    TC.ajax({\r\n                        url: type.url + '?' + type.filter.getParams({ t: _pattern, s: match[5].trim() }),\r\n                        method: 'GET',\r\n                        responseType: TC.Consts.mimeType.JSON                        \r\n                    }).then(function (response) {\r\n                        const data = response.data;\r\n                        var result = [];\r\n                        if (data.totalFeatures > 0) {\r\n                            data.features.map(function (feature) {\r\n                                var properties = type.outputProperties;\r\n                                if (!result.some(function (elem) {\r\n                                    return (elem.label == feature.properties[properties[0]]);\r\n                                })) {\r\n                                    var text = type.outputFormatLabel.tcFormat(type.outputProperties.map(function (outputProperty) {\r\n                                        return feature.properties[outputProperty];\r\n                                    }));\r\n                                    result.push({\r\n                                        id: type.dataIdProperty.map(function (elem) {\r\n                                            return feature.properties[elem];\r\n                                        }).join('#'),\r\n                                        label: text,\r\n                                        text: text,\r\n                                        dataLayer: feature.id.split('.')[0],\r\n                                        dataRole: type.typeName\r\n                                    });\r\n                                }\r\n                            });\r\n                            //console.log('getRoadPK promise resuelta');\r\n                            resolve(result);\r\n                        } else {\r\n                            //console.log('getRoadPK promise resuelta');\r\n                            resolve([]);\r\n                        }\r\n                    }).catch(function (data) {\r\n                        //console.log('getRoadPK promise resuelta - xhr fail');\r\n                        resolve([]);\r\n                    });\r\n                } else {\r\n                    //console.log('getRoadPK promise resuelta - no encaja en pk');\r\n                    resolve([]);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.search = function (pattern, callback) {\r\n        var self = this;\r\n        var results = [];\r\n\r\n        if (self.request) {\r\n\r\n            for (var i = 0; i < self.request.length; i++) {\r\n                console.log(\"new criteria: search promise/s aborted\");\r\n                //self.request[i].abort();\r\n            }\r\n\r\n            self.request = [];\r\n        }\r\n\r\n        pattern = pattern.trim();\r\n        if (pattern.length > 0) {\r\n            pattern = pattern.toLowerCase();\r\n\r\n            var waiting = [];\r\n            var addWaiting = function (fn) {\r\n                waiting.push(new Promise(function (resolve, reject) {\r\n                    fn.call(self, pattern).then(function (result) {\r\n                        results = results.concat(result);\r\n                        resolve(results);\r\n                    });\r\n                }));\r\n            };\r\n\r\n            self.allowedSearchTypes.forEach(function (allowed) {\r\n                if (allowed.parser) {\r\n                    addWaiting(allowed.parser);\r\n                } else {\r\n                    console.log('Falta implementación del método parser');\r\n                }\r\n            });\r\n\r\n            Promise.all(waiting).then(function () {\r\n                if (results)\r\n                    self._search.data = results = results.sort(function (a, b) {\r\n                        var pattern = /(\\d+)/;\r\n                        var _a, _b = '';\r\n                        if (pattern.test(a.label) && pattern.test(b.label)) {\r\n                            _a = a.label.match(pattern)[1];\r\n                            _b = b.label.match(pattern)[1];\r\n                        } else {\r\n                            _a = a.label;\r\n                            _b = b.label;\r\n                        }\r\n\r\n                        if (_a > _b)\r\n                            return 1;\r\n                        else\r\n                            if (_a < _b)\r\n                                return -1;\r\n                            else\r\n                                return 0;\r\n                    }.bind(self));\r\n\r\n                if (callback)\r\n                    callback(results);\r\n\r\n                if (results.length === 0) {\r\n                    self.cleanMap();\r\n\r\n                    if (!self.layer ||\r\n                        (self.layer && self.layer.features.length === 0)) {\r\n                        self.resultsList.innerHTML = '<li><a title=\"' + self.EMPTY_RESULTS_TITLE + '\" class=\"tc-ctl-search-li-empty\">' + self.EMPTY_RESULTS_LABEL + '</a></li>';\r\n                        self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n                    }\r\n                }\r\n\r\n                self.lastPattern = \"\";\r\n            });\r\n        }\r\n        else self.cleanMap();\r\n    };\r\n\r\n    var setQueryableFeatures = function (features) {\r\n        var self = this;\r\n\r\n        if (features && features.length > 0) {\r\n            for (var i = 0; i < features.length; i++) {\r\n                if (features[i].showsPopup != self.queryableFeatures)\r\n                    features[i].showsPopup = self.queryableFeatures;\r\n            }\r\n        }\r\n    };\r\n    ctlProto._goToResult = function (id, dataRole) {\r\n        var self = this;\r\n        var goTo = null;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!self.loading)\r\n                self.loading = self.map.getControlsByClass(\"TC.control.LoadingIndicator\")[0];\r\n\r\n            var wait;\r\n            wait = self.loading.addWait();\r\n\r\n            // en pantallas pequeñas, colapsamos el panel de herramientas\r\n            if (matchMedia('(max-width: 30em)').matches) {\r\n                self.textInput.blur();\r\n                self.map.trigger(TC.Consts.event.TOOLSCLOSE);\r\n            }\r\n\r\n            self.cleanMap();\r\n\r\n            var customSearchType = false;\r\n            var keepOnLooping = true;\r\n\r\n            self.allowedSearchTypes.forEach(function (allowed) {\r\n                if (keepOnLooping) {\r\n\r\n                    if (!self.availableSearchTypes[allowed.typeName]) {\r\n\r\n                        if (allowed.goTo) {\r\n                            customSearchType = true;\r\n\r\n                            goTo = allowed.goTo.call(self, id);\r\n                            if (goTo !== null) {\r\n                                keepOnLooping = false;\r\n                            }\r\n                        } else console.log('Falta implementación del método goTo');\r\n\r\n                    } else {\r\n\r\n                        var dr = dataRole || self.getElementOnSuggestionList.call(self, id).dataRole;\r\n                        if (dr) {\r\n\r\n                            var searchType = self.getSearchTypeByRole(dr);\r\n\r\n                            if (self.availableSearchTypes[dr] && searchType && searchType.goTo) {\r\n                                goTo = searchType.goTo.call(self, id, dr);\r\n                                if (goTo !== null) {\r\n                                    keepOnLooping = false;\r\n                                }\r\n                            } else if (!self.availableSearchTypes[dr] && searchType && searchType.goTo) {\r\n                                customSearchType = true;\r\n\r\n                                goTo = searchType.goTo.call(self, id, dr);\r\n                                if (goTo !== null) {\r\n                                    keepOnLooping = false;\r\n                                }\r\n                            } else console.log('Falta implementación del método goTo');\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.loading.removeWait(wait);\r\n\r\n            if (goTo) {\r\n\r\n                self.getLayer().then(function (layer) {\r\n                    switch (true) {\r\n                        case goTo.params.type == TC.Consts.layerType.VECTOR:\r\n                            for (var i = 0; i < self.WFS_TYPE_ATTRS.length; i++) {\r\n                                if (layer.hasOwnProperty(self.WFS_TYPE_ATTRS[i]))\r\n                                    delete layer[self.WFS_TYPE_ATTRS[i]];\r\n                            }\r\n                            break;\r\n                        case goTo.params.type == TC.Consts.layerType.WFS:\r\n                            for (var i = 0; i < self.WFS_TYPE_ATTRS.length; i++) {\r\n                                layer[self.WFS_TYPE_ATTRS[i]] = goTo.params[self.WFS_TYPE_ATTRS[i]];\r\n                            }\r\n\r\n                            wait = self.loading.addWait();\r\n                            break;\r\n                        default:\r\n                    }\r\n\r\n                    layer.type = goTo.params.type;\r\n\r\n                    self.map.on(TC.Consts.event.FEATURESADD, function (e) {\r\n                        if (e.layer === self.layer) {\r\n                            setQueryableFeatures.call(self, e.features);\r\n                        }\r\n                    });\r\n\r\n                    layer.refresh().then(function () {\r\n                        self.map.one(TC.Consts.event.LAYERUPDATE, function (e) {\r\n                            if (e.layer == layer) {\r\n                                // Salta cuando se pinta una feature que no es de tipo API porque la gestión de estilos salta antes (no es controlable)\r\n                                self.map.one(TC.Consts.event.FEATURESADD, function (e) {\r\n                                    if (e.layer == layer) {\r\n                                        if (!e.layer.features || e.layer.features.length == 0 && e.layer.wrap.layer.getSource().getFeatures()) {\r\n                                            self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                                            var bounds = e.layer.wrap.layer.getSource().getExtent();\r\n                                            var radius = e.layer.map.options.pointBoundsRadius;\r\n\r\n                                            if (bounds[2] - bounds[0] === 0) {\r\n                                                bounds[0] = bounds[0] - radius;\r\n                                                bounds[2] = bounds[2] + radius;\r\n                                            }\r\n                                            if (bounds[3] - bounds[1] === 0) {\r\n                                                bounds[1] = bounds[1] - radius;\r\n                                                bounds[3] = bounds[3] + radius;\r\n                                            }\r\n                                            e.layer.map.setExtent(bounds);\r\n\r\n                                            // GLS: Necesito diferenciar un zoom programático de un zoom del usuario para la gestión del zoom en 3D\r\n                                            self.map.trigger(TC.Consts.event.ZOOMTO, {\r\n                                                extent: bounds, layer: e.layer\r\n                                            });\r\n                                        }\r\n                                        else if (e.layer.features && e.layer.features.length > 0) {\r\n                                            self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                                            self.layer.map.zoomToFeatures(e.layer.features);\r\n\r\n                                            self.map.trigger(TC.Consts.event.FEATURESADD, { layer: self.layer, features: self.layer.features });\r\n\r\n                                        } else if (e.layer.features && e.layer.features.length == 0 && goTo.params.type == TC.Consts.layerType.WFS) {\r\n                                            self.resultsList.inner = goTo.emptyResultHTML;\r\n                                            self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n\r\n                                            self.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);\r\n                                        }\r\n\r\n                                        self.loading.removeWait(wait);\r\n                                    }\r\n                                });\r\n\r\n                                if (e.layer.features && e.layer.features.length > 0) {\r\n                                    self.resultsList.classList.add(TC.Consts.classes.HIDDEN);\r\n                                    self.layer.map.zoomToFeatures(self.layer.features);\r\n\r\n                                    self.map.trigger(TC.Consts.event.FEATURESADD, { layer: self.layer, features: self.layer.features });\r\n\r\n                                    self.loading.removeWait(wait);\r\n                                } else if (e.layer.features && e.layer.features.length == 0 && goTo.params.type == TC.Consts.layerType.WFS) {\r\n                                    self.resultsList.innerHTML = goTo.emptyResultHTML;\r\n                                    self.textInput.dispatchEvent(new CustomEvent(\"targetUpdated.autocomplete\"));\r\n\r\n                                    if (!(e.newData && e.newData.features && e.newData.features.length > 0)) {\r\n                                        self.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);\r\n                                    }\r\n\r\n                                    self.loading.removeWait(wait);\r\n                                }\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n\r\n                resolve(goTo);\r\n            } else {\r\n                reject();\r\n                if (!customSearchType) {\r\n                    self.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.goToResult = function (id, dataRole) {\r\n        var self = this;\r\n        // si está habilitada\r\n        if (self.getSearchTypeByRole(dataRole)) {\r\n            return self._goToResult(id, dataRole);\r\n            // si no está habilitada pero está disponible\r\n        } else if (self.availableSearchTypes[dataRole]) {\r\n            self.addAllowedSearchType(dataRole, self.availableSearchTypes[dataRole], self);\r\n            return self._goToResult(id, dataRole);\r\n        } else {\r\n            alert('No se reconoce el tipo de búsqueda: ' + dataRole);\r\n        }\r\n    };\r\n\r\n    var drawPoint = function (id) {\r\n        var self = this;\r\n\r\n        wait = self.loading.addWait();\r\n\r\n        var point = self.getPoint(id);\r\n        var delta;\r\n        var title;\r\n        var promise;\r\n\r\n        if (point) {\r\n            title = self.getLabel(id);\r\n            promise = self.layer.addMarker(point, TC.Util.extend({}, self.map.options.styles.point, { title: title, group: title }));\r\n        } else {\r\n            var match = /^Lat((?:[+-]?)\\d+(?:\\.\\d+)?)Lon((?:[+-]?)\\d+(?:\\.\\d+)?)$/.exec(id);\r\n            id = self.LAT + match[2] + self.LON + match[1];\r\n            point = self.getPoint(id);\r\n\r\n            if (point) {\r\n                title = self.getLabel(id);\r\n                promise = self.layer.addMarker(point, TC.Util.extend({}, self.map.options.styles.point, { title: title, group: title }));\r\n\r\n                self.textInput.value = title;\r\n            }\r\n        }\r\n\r\n        promise.then(function (feat) {\r\n            self.map.trigger(TC.Consts.event.FEATURESADD, {\r\n                layer: self.layer, features: [feat]\r\n            });\r\n\r\n            self.map.zoomToFeatures([feat]);\r\n\r\n            self.loading.removeWait(wait);\r\n        });\r\n\r\n    };\r\n    ctlProto.goToCoordinates = function (id) {\r\n        var self = this;\r\n        var goTo = {};\r\n        if (/^X(\\d+(?:[\\.\\,]\\d+)?)Y(\\d+(?:[\\.\\,]\\d+)?)$/.test(id) || /^Lat((?:[+-]?)\\d+(?:[.,]\\d+)?)Lon((?:[+-]?)\\d+(?:[.,]\\d+)?)$/.test(id)) {\r\n\r\n            goTo.params = {\r\n                type: TC.Consts.layerType.VECTOR,\r\n                styles: {\r\n                    marker: {\r\n                        url: self.layerStyleFN.bind(self, 'marker', 'url', true)\r\n                    }\r\n                }\r\n            };\r\n\r\n            goTo.emptyResultHTML = '<li><a class=\"tc-ctl-search-li-empty\">' + self.OUTBBX_LABEL + '</a></li>';\r\n\r\n            drawPoint.call(self, id);\r\n\r\n            return goTo;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    ctlProto.goToCadastralRef = function (id) {\r\n        var self = this;\r\n        var goTo = {};\r\n\r\n        var regex = new RegExp(\"^\" + self.MUN + \"(\\\\d+)\" + self.POL + \"(\\\\d{1,2})\" + self.PAR + \"{1}(\\\\d{1,4})\");\r\n        if (regex.test(id)) {\r\n            var match = regex.exec(id);\r\n\r\n            if (!TC.filter) {\r\n                TC.syncLoadJS(TC.apiLocation + 'TC/Filter');\r\n            }\r\n\r\n            var type = self.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);\r\n\r\n            goTo.params = {\r\n                type: TC.Consts.layerType.WFS,\r\n                url: type.url,\r\n                version: type.version,\r\n                geometryName: type.geometryName,\r\n                featurePrefix: type.featurePrefix,\r\n                featureType: type.featureType,\r\n                properties: new TC.filter.and(\r\n                    new TC.filter.equalTo(type.queryProperties.firstQueryWord, match[1].trim()),\r\n                    new TC.filter.equalTo(type.queryProperties.secondQueryWord, match[2].trim()),\r\n                    new TC.filter.equalTo(type.queryProperties.thirdQueryWord, match[3].trim())),\r\n                outputFormat: type.outputFormat,\r\n                styles: type.styles\r\n            };\r\n\r\n            goTo.emptyResultHTML = '<li><a title=\"' + self.EMPTY_RESULTS_TITLE + '\" class=\"tc-ctl-search-li-empty\">' + self.EMPTY_RESULTS_LABEL + '</a></li>';\r\n\r\n            return goTo;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    ctlProto.goToRoad = function (id) {\r\n        var self = this;\r\n        var goTo = {};\r\n\r\n        var type = self.getSearchTypeByRole(TC.Consts.searchType.ROAD);\r\n\r\n        goTo.params = {\r\n            type: TC.Consts.layerType.WFS,\r\n            url: type.url,\r\n            version: type.version,\r\n            geometryName: type.geometryName,\r\n            featurePrefix: type.featurePrefix,\r\n            featureType: type.getFeatureTypes(),\r\n            maxFeatures: 3000,\r\n            properties: type.filter.getGoToFilter(id),\r\n            outputFormat: type.outputFormat,\r\n            styles: type.styles\r\n        };\r\n\r\n        goTo.emptyResultHTML = '<li><a title=\"' + self.EMPTY_RESULTS_TITLE + '\" class=\"tc-ctl-search-li-empty\">' + self.EMPTY_RESULTS_LABEL + '</a></li>';\r\n\r\n        return goTo;\r\n    };\r\n\r\n    ctlProto.goToPK = function (id) {\r\n        var self = this;\r\n        var goTo = {};\r\n\r\n        var type = self.getSearchTypeByRole(TC.Consts.searchType.ROADPK);\r\n\r\n        goTo.params = {\r\n            type: TC.Consts.layerType.WFS,\r\n            url: type.url,\r\n            version: type.version,\r\n            geometryName: type.geometryName,\r\n            featurePrefix: type.featurePrefix,\r\n            featureType: type.getFeatureTypes(),\r\n            maxFeatures: 3000,\r\n            properties: type.filter.getGoToFilter(id),\r\n            outputFormat: type.outputFormat,\r\n            styles: type.styles\r\n        };\r\n\r\n        goTo.emptyResultHTML = '<li><a title=\"' + self.EMPTY_RESULTS_TITLE + '\" class=\"tc-ctl-search-li-empty\">' + self.EMPTY_RESULTS_LABEL + '</a></li>';\r\n\r\n        return goTo;\r\n    };\r\n\r\n    ctlProto.goToStringPattern = function (id, dataRole) {\r\n        var self = this;\r\n        var goTo = {};\r\n\r\n        var type = self.getSearchTypeByRole(dataRole);\r\n\r\n        goTo.params = {\r\n            type: TC.Consts.layerType.WFS,\r\n            url: type.url,\r\n            version: type.version,\r\n            geometryName: type.geometryName,\r\n            featurePrefix: type.featurePrefix,\r\n            featureType: type.getFeatureTypes(),\r\n            maxFeatures: 3000,\r\n            properties: type.filter.getGoToFilter(id),\r\n            outputFormat: type.outputFormat,\r\n            styles: type.styles\r\n        };\r\n\r\n        return goTo;\r\n    };\r\n\r\n    ctlProto.getPoint = function (pattern) {\r\n        var self = this;\r\n        var isMapGeo = self.map.wrap.isGeo();\r\n        var point;\r\n        var match = /^X(\\d+(?:\\.\\d+)?)Y(\\d+(?:\\.\\d+)?)$/.exec(pattern);\r\n        if (match && match.length === 3) {\r\n            point = [parseFloat(match[1]), parseFloat(match[2])];\r\n            if (isMapGeo) {\r\n                point = TC.Util.reproject(point, self.map.options.utmCrs, self.map.crs);\r\n            }\r\n        }\r\n        else {\r\n            match = /^Lat((?:[+-]?)\\d+(?:[.,]\\d+)?)Lon((?:[+-]?)\\d+(?:[.,]\\d+)?)$/.exec(pattern);\r\n            if (match && match.length === 3) {\r\n                point = [parseFloat(match[2]), parseFloat(match[1])];\r\n                if (!isMapGeo) {\r\n                    return TC.Util.reproject(point, self.map.options.geoCrs, self.map.crs);\r\n                }\r\n            }\r\n\r\n            match = /^Lon((?:[+-]?)\\d+(?:[.,]\\d+)?)Lat((?:[+-]?)\\d+(?:[.,]\\d+)?)$/.exec(pattern);\r\n            if (match && match.length === 3) {\r\n                point = [parseFloat(match[2]), parseFloat(match[1])];\r\n                if (!isMapGeo) {\r\n                    return TC.Util.reproject(point, self.map.options.geoCrs, self.map.crs);\r\n                }\r\n            }\r\n        }\r\n\r\n        return point;\r\n    };\r\n\r\n    ctlProto.insideLimit = function (point) {\r\n        var self = this;\r\n        var getIntersectsBounds = function (extent, point) {\r\n            if (extent instanceof Array)\r\n                return point[0] >= extent[0] && point[0] <= extent[2] && point[1] >= extent[1] && point[1] <= extent[3];\r\n            else return true;\r\n        };\r\n\r\n        if (getIntersectsBounds(self.map.options.maxExtent, point)) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    ctlProto.getPattern = function () {\r\n        var self = this;\r\n        return self.textInput.value;\r\n    };\r\n\r\n    ctlProto.getLabel = function (id) {\r\n        var self = this;\r\n        var result = id;\r\n        var locale = TC.Util.getMapLocale(self.map);\r\n\r\n        if (id.match(new RegExp('^(?:' + self.LAT + '[-\\\\d])|(?:' + self.UTMX + '[\\\\d])'))) {\r\n            result = result.replace(self.LAT, self.LAT_LABEL).replace(self.LON, ' ' + self.LON_LABEL).replace(self.UTMX, self.UTMX_LABEL).replace(self.UTMY, ' ' + self.UTMY_LABEL);\r\n            var match = result.match(new RegExp('^' + self.LAT_LABEL.trim() + '*\\\\s*([-+]?\\\\d{1,3}([.,]\\\\d+)?)\\\\,?\\\\s*' + self.LON_LABEL.trim() + '*\\\\s*([-+]?\\\\d{1,2}([.,]\\\\d+)?)$'));\r\n            if (match) {\r\n                result = result.replace(match[1], parseFloat(match[1]).toLocaleString(locale));\r\n                result = result.replace(match[3], parseFloat(match[3]).toLocaleString(locale));\r\n            }\r\n\r\n            var localeDecimalSeparator = 1.1.toLocaleString(locale).substring(1, 2);\r\n            var match = result.match(new RegExp('^' + self.UTMX_LABEL.trim() + '*\\\\s*([0-9]{' + self.UTMX_LEN + '}(?:[.,]\\\\d+)?)\\\\s*\\\\,?\\\\s*' + self.UTMY_LABEL.trim() + '*\\\\s*([0-9]{' + self.UTMY_LEN + '}(?:[.,]\\\\d+)?)$'));\r\n            if (match) {\r\n                if (!Number.isInteger(parseFloat(match[1])))\r\n                    result = result.replace(match[1], match[1].replace('.', localeDecimalSeparator));\r\n                if (!Number.isInteger(parseFloat(match[2])))\r\n                    result = result.replace(match[2], match[2].replace('.', localeDecimalSeparator));\r\n            }\r\n\r\n        } else if (id.match(new RegExp('^(?:' + self.LON + '[-\\\\d])'))) {\r\n            result = result.replace(self.LON, self.LON_LABEL).replace(self.LAT, ' ' + self.LAT_LABEL);\r\n\r\n            var match = result.match(new RegExp('^' + self.LON_LABEL.trim() + '*\\\\s*([-+]?\\\\d{1,3}([.,]\\\\d+)?)\\\\,?\\\\s*' + self.LAT_LABEL.trim() + '*\\\\s*([-+]?\\\\d{1,2}([.,]\\\\d+)?)$'));\r\n            if (match) {\r\n                result = result.replace(match[1], parseFloat(match[1]).toLocaleString(locale));\r\n                result = result.replace(match[3], parseFloat(match[3]).toLocaleString(locale));\r\n            }\r\n\r\n        } else if (id.match(new RegExp('^(?:(\\\\' + self.MUN + '{1})(.*)' + '(\\\\' + self.POL + '{1})' + '(\\\\d{1,2})' + '(\\\\' + self.PAR + '{1})' + '(\\\\d{1,4}))'))) {\r\n            var match = id.match(new RegExp('^(?:(\\\\' + self.MUN + '{1})(.*)' + '(\\\\' + self.POL + '{1})' + '(\\\\d{1,2})' + '(\\\\' + self.PAR + '{1})' + '(\\\\d{1,4}))'));\r\n            result = self.MUN_LABEL + match[2] + ', ' + self.POL_LABEL + match[4] + ', ' + self.PAR_LABEL + match[6];\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.removePunctuation = function (text) {\r\n        text = text || '';\r\n        var result = new Array(text.length);\r\n        var map = {\r\n            'á': 'a',\r\n            'à': 'a',\r\n            'Á': 'A',\r\n            'À': 'A',\r\n            'é': 'e',\r\n            'è': 'e',\r\n            'É': 'E',\r\n            'È': 'E',\r\n            'í': 'i',\r\n            'ì': 'i',\r\n            'Í': 'I',\r\n            'Ì': 'I',\r\n            'ó': 'o',\r\n            'ò': 'o',\r\n            'Ó': 'O',\r\n            'Ò': 'O',\r\n            'ú': 'u',\r\n            'ù': 'u',\r\n            'ü': 'u',\r\n            'Ú': 'U',\r\n            'Ù': 'U',\r\n            'Ü': 'U'\r\n        };\r\n        for (var i = 0, len = text.length; i < len; i++) {\r\n            result[i] = map[text.charAt(i)] || text.charAt(i);\r\n        }\r\n        return result.join('');\r\n    };    \r\n\r\n    ctlProto.exportState = function () {\r\n        const self = this;\r\n        if (self.exportsState) {\r\n            return {\r\n                id: self.id,\r\n                searchText: self.textInput.value,\r\n                layer: self.layer.exportState({\r\n                    exportStyles: false\r\n                })\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.importState = function (state) {\r\n        const self = this;\r\n        self.textInput.value = state.searchText;\r\n        self.layer.importState(state.layer).then(function () {\r\n            self.layer.features.forEach(function (f) {\r\n                f.setStyle(null); // Los estilos vienen dados exclusivamente por la capa, borramos estilos propios de la feature\r\n            });\r\n        });\r\n    };\r\n\r\n})();\r\n\r\n\r\nif (!String.prototype.tcFormat) {\r\n    String.prototype.tcFormat = function () {\r\n        var args = (arguments || [\"\"])[0];\r\n        return this.replace(/{(\\d+)}/g, function (match, number) {\r\n            return typeof args[number] != 'undefined' ?\r\n                args[number]\r\n                : match\r\n                ;\r\n        });\r\n    };\r\n}\r\n\r\n\r\nif (!String.prototype.splitRemoveWhiteSpaces) {\r\n    String.prototype.splitRemoveWhiteSpaces = function (separator) {\r\n        var _arr = [];\r\n        var arr = this.split(separator);\r\n        for (var i = 0; i < arr.length; i++)\r\n            if (arr[i].trim().length > 0)\r\n                _arr.push(arr[i].trim());\r\n\r\n        return _arr;\r\n    };\r\n}\r\n\r\n\r\nif (!String.prototype.toCamelCase) {\r\n    String.prototype.toCamelCase = function () {\r\n        var _value = this.toLowerCase();\r\n        var match = this.toLowerCase().match(/[^A-ZÁÉÍÓÚÜÀÈÌÒÙáéíóúüàèìòùa-z0-9_]+(.)/g);\r\n        if (match) {\r\n            for (var i = 0; i < match.length; i++) {\r\n                if (/[-;:.<>\\{\\}\\[\\]\\/\\s()]/g.test(match[i]))\r\n                    _value = _value.replace(match[i], match[i].toUpperCase());\r\n            }\r\n        }\r\n\r\n        return _value.charAt(0).toUpperCase() + _value.substring(1);\r\n    };\r\n}\r\n\r\n\r\nif (!Array.prototype.hasOwnProperty('findByProperty')) {\r\n    Object.defineProperty(Array.prototype, \"findByProperty\", {\r\n        enumerable: false,\r\n        writable: true,\r\n        value: function (propertyName, value) {\r\n            for (var i = 0; i < this.length; i++) {\r\n                if (this[i][propertyName] == value)\r\n                    return this[i];\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nif (!String.prototype.endsWith) {\r\n    String.prototype.endsWith = function (searchString, position) {\r\n        var subjectString = this.toString();\r\n        if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {\r\n            position = subjectString.length;\r\n        }\r\n        position -= searchString.length;\r\n        var lastIndex = subjectString.indexOf(searchString, position);\r\n        return lastIndex !== -1 && lastIndex === position;\r\n    };\r\n}\r\n"]}