{"version":3,"sources":["control/ResultsPanel.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","Consts","event","DRAWCHART","DRAWTABLE","RESULTSPANELMIN","RESULTSPANELMAX","RESULTSPANELCLOSE","ResultsPanel","apply","this","arguments","wrap","data","classes","FA","SHOW_IN","SHOW_OUT","contentType","TABLE","fnOpen","prototype","openTable","collapsedClass","CHART","openChart","content","Util","isEmptyObject","options","toUpperCase","chart","table","save","inherit","ctlProto","CLASS","CHART_SIZE","MIN_HEIGHT","MAX_HEIGHT","MIN_WIDTH","MEDIUM_WIDTH","MAX_WIDTH","template","dust","register","body_0","chk","ctx","w","h","$key","__dustBody","s","get","block","body_1","f","body_2","on","getPath","body_3","key","x","else","isElementVisible","elm","computedStyle","getComputedStyle","hidden","display","visibility","isVisible","bodyElm","div","querySelector","maximizeElm","isMinimized","manageClassList","classElement","toAdd","toRemove","classList","add","remove","show","style","call","hide","doVisible","HIDDEN","render","callback","self","mainTitleElm","minimizeButton","addEventListener","minimize","closeButton","close","maximizeButton","maximize","saveButton","exportToExcel","removeAttribute","download","downloadButton","isFunction","titles","main","setAttribute","innerHTML","max","getLocaleString","infoDiv","tableDiv","menuDiv","browserFeatures","touch","swipe","left","collapsedElm","map","trigger","destroy","body","getControlsByClass","filter","ctl","forEach","msg","toast","elevationProfileChartData","renderElevationProfileChart","loadJS","window","c3","url","D3C3","ele","val","locale","getMapLocale","getRenderedHtml","upHill","toLocaleString","downHill","out","titleElm","chartOptions","extend","bindto","padding","top","right","bottom","legend","createChartOptions","tooltip","contents","d","fn","getFnFromString","eval","onmouseout","onrendered","_onrendered","svg","_isOverriden","internal","generateDrawLine","lineIndices","isSub","$$","config","line","d3","getPoints","generateGetLinePoints","yScaleGetter","getSubYScale","getYScale","xValue","subxx","xx","yValue","i","data_groups","length","id","value","axis_rotated","y","line_connectNull","defined","path","values","filterRemoveNull","subX","x0","y0","isLineType","data_regions","lineWithRegions","isStepType","convertValuesToStep","interpolate","generateDrawArea","areaIndices","area","generateGetAreaPoints","value0","value1","x1","y1","isAreaType","generate","closeOpenedTableResultsPanel","css","columns","k","push","tableData","results","then","html","parent","parentElement","removeChild","appendChild","open","container","toCheck","requestIsRendered","requestAnimationFrame","clientRect","getBoundingClientRect","width","cancelAnimationFrame","bind","tableElm","getTableContainer","collapsed","result","chartType","getChartSize","panelStyle","getContainerElement","docWidth","document","documentElement","clientWidth","r","height","maxHeight","minHeight","parseFloat","maxWidth","mediumWidth","minWidth","maxy","Number","NEGATIVE_INFINITY","miny","POSITIVE_INFINITY","Math","min","gradId","getUID","concat","types","colors","size","point","axis","tick","outer","count","format","dist","measure","round","parseInt","toFixed","onresize","api","resize","time","slice","m","svgDefsElement","getElementsByTagName","xmlns","grad","createElementNS","setAttributeNS","stop0","stop50","stop100","d3Node","select","node","parentNode","selectAll","e","stopPropagation","coords","index","feature","Point","zoomToFeatures","pattern","attr","exec","replace","svgRect","chartSize","setMultilineLabels","scale","ordinal","rangeRoundBands","textNode","each","d3text","childNodes","clone","cloneNode","words","text","split","textContent","dy","getAttribute","rangeBand","elevationChartLabelsRAF","undefined","hasSize","getTime","timeFrom","timeTo","diff","daysDifference","floor","hoursDifference","minutesDifference","toString","getElevationChartTooltip","distance","p","doneTime","getInfoContainer","getMenuElement","openOn","one","args","closeOn","_ctl","rows","row","hasOwnProperty","_fncSave","exporter","fileName","title","Save","ExcelExport"],"mappings":"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","sourcesContent":["\r\nTC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nTC.Consts.event.DRAWCHART = 'drawchart.tc';\r\nTC.Consts.event.DRAWTABLE = 'drawtable.tc';\r\nTC.Consts.event.RESULTSPANELMIN = 'resultspanelmin.tc';\r\nTC.Consts.event.RESULTSPANELMAX = 'resultspanelmax.tc';\r\nTC.Consts.event.RESULTSPANELCLOSE = 'resultspanelclose.tc';\r\n\r\nTC.control.ResultsPanel = function () {\r\n    var self = this;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.wrap = new TC.wrap.control.ResultsPanel(self);\r\n\r\n    self.data = {};\r\n    self.classes = {\r\n        FA: 'fa',\r\n        SHOW_IN: 'showIn',\r\n        SHOW_OUT: 'showOut'\r\n    };\r\n\r\n    self.contentType = {\r\n        TABLE: {\r\n            fnOpen: TC.control.ResultsPanel.prototype.openTable,\r\n            collapsedClass: '.fa-list-alt'\r\n        },\r\n        CHART: {\r\n            fnOpen: TC.control.ResultsPanel.prototype.openChart,\r\n            collapsedClass: '.fa-area-chart'\r\n        }\r\n    };\r\n\r\n    self.content = self.contentType.TABLE;\r\n\r\n    if (TC.Util.isEmptyObject(self.options)) {\r\n        self.options = { content: \"table\" };\r\n    }\r\n\r\n    if (self.options || { content: \"table\" }) {\r\n        if (self.options.content)\r\n            self.content = self.contentType[self.options.content.toUpperCase()];\r\n\r\n        if (self.options.chart)\r\n            self.chart = self.options.chart;\r\n\r\n        if (self.options.table)\r\n            self.table = self.options.table;\r\n\r\n        if (self.options.save)\r\n            self.save = self.options.save;\r\n\r\n    }\r\n};\r\n\r\nTC.inherit(TC.control.ResultsPanel, TC.Control);\r\n\r\n(function () {\r\n\r\n    const ctlProto = TC.control.ResultsPanel.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-p-results';\r\n\r\n    ctlProto.CHART_SIZE = {\r\n        MIN_HEIGHT: 75,\r\n        MAX_HEIGHT: 128,\r\n\r\n        MIN_WIDTH: 215,\r\n        MEDIUM_WIDTH: 310,\r\n        MAX_WIDTH: 445\r\n    };\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/ResultsPanel.html\";\r\n    ctlProto.template[ctlProto.CLASS + '-table'] = TC.apiLocation + \"TC/templates/ResultsPanelTable.html\";\r\n    ctlProto.template[ctlProto.CLASS + '-chart'] = TC.apiLocation + \"TC/templates/ResultsPanelChart.html\";\r\n\r\n    const isElementVisible = function (elm) {\r\n        const computedStyle = getComputedStyle(elm);\r\n        return (elm && !elm.hidden && computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden');\r\n    };\r\n\r\n    ctlProto.isVisible = function () {\r\n        const self = this;\r\n        const bodyElm = self.div.querySelector('.prsidebar-body');\r\n        const maximizeElm = self.div.querySelector('.prcollapsed-max');\r\n        return isElementVisible(bodyElm) || isElementVisible(maximizeElm);\r\n    };\r\n\r\n    ctlProto.isMinimized = function () {\r\n        const self = this;\r\n        const bodyElm = self.div.querySelector('.prsidebar-body');\r\n        const maximizeElm = self.div.querySelector('.prcollapsed-max');\r\n        return isElementVisible(maximizeElm) && !isElementVisible(bodyElm);\r\n    };\r\n\r\n    const manageClassList = function (classElement, toAdd, toRemove) {\r\n        const self = this;\r\n\r\n        const elm = self.div.querySelector('.' + classElement);\r\n        if (elm) {\r\n            elm.classList.add(toAdd);\r\n            elm.classList.remove(toRemove);\r\n        }\r\n    };\r\n\r\n    ctlProto.show = function (classElement) {\r\n        const self = this;\r\n\r\n        const elm = self.div.querySelector('.' + classElement);\r\n        if (elm && elm.style.display === 'none') {\r\n            elm.style.display = '';\r\n        }\r\n\r\n        manageClassList.call(self, classElement, self.classes.SHOW_IN, self.classes.SHOW_OUT);\r\n    };\r\n\r\n    ctlProto.hide = function (classElement) {\r\n        const self = this;\r\n\r\n        manageClassList.call(self, classElement, self.classes.SHOW_OUT, self.classes.SHOW_IN);\r\n\r\n        const elm = self.div.querySelector('.' + classElement);\r\n        if (elm) {\r\n            elm.style.display = 'none';\r\n        }\r\n    };\r\n\r\n    ctlProto.doVisible = function () {\r\n        const self = this;\r\n\r\n        self.div.classList.remove(TC.Consts.classes.HIDDEN);\r\n        self.show('prsidebar-body');\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n\r\n        self.div.classList.add(TC.Consts.classes.HIDDEN);\r\n\r\n        return TC.Control.prototype.render.call(self, function () {\r\n\r\n            self.mainTitleElm = self.div.querySelector('.prpanel-title-text');\r\n\r\n            self.minimizeButton = self.div.querySelector('.prcollapsed-slide-submenu-min');\r\n            self.minimizeButton.addEventListener('click', function () {\r\n                self.minimize();\r\n            });\r\n\r\n            self.closeButton = self.div.querySelector('.prcollapsed-slide-submenu-close');\r\n            self.closeButton.addEventListener('click', function () {\r\n                self.close();\r\n            });\r\n\r\n            self.maximizeButton = self.div.querySelector('.prcollapsed-max');\r\n            self.maximizeButton.addEventListener('click', function () {\r\n                self.maximize();\r\n            });\r\n\r\n            if (self.save) {\r\n                self.saveButton = self.div.querySelector('.prcollapsed-slide-submenu-csv');\r\n                self.saveButton.addEventListener('click', function () {\r\n                    self.exportToExcel();\r\n                });\r\n                self.saveButton.removeAttribute('hidden');\r\n            }\r\n            if (self.options.download && self.options.content === \"table\") {\r\n                self.downloadButton = self.div.querySelector('.prcollapsed-slide-submenu-dwn');\r\n                self.downloadButton.addEventListener('click', function () {\r\n                    if (TC.Util.isFunction(self.options.download)) {\r\n                        self.options.download.apply(self,[]);\r\n                    }\r\n                });\r\n                self.downloadButton.removeAttribute('hidden');\r\n            }           \r\n            \r\n\r\n            if (self.content) {\r\n                self.content = self.content;\r\n\r\n                if (self.options.titles) {\r\n\r\n                    if (self.options.titles.main) {\r\n                        self.mainTitleElm.setAttribute('title', self.options.titles.main);\r\n                        self.mainTitleElm.innerHTML = self.options.titles.main;\r\n                    }\r\n\r\n                    if (self.options.titles.max) {\r\n                        self.maximizeButton.setAttribute('title', self.options.titles.max);\r\n                    }\r\n                } else {\r\n                    self.mainTitleElm.setAttribute('title', self.getLocaleString(\"rsp.title\"));\r\n                    self.mainTitleElm.innerHTML = self.getLocaleString(\"rsp.title\");\r\n                }\r\n            }\r\n\r\n            const collapsedElm = self.div.querySelector(self.content.collapsedClass);\r\n            //collapsedElm.hidden = false;\r\n            collapsedElm.classList.add(self.classes.FA);\r\n\r\n            self.infoDiv = self.div.querySelector('.' + self.CLASS + '-info');\r\n            self.tableDiv = self.div.querySelector('.' + self.CLASS + '-table');\r\n            //self.$divChart = self._$div.find('.' + self.CLASS + '-chart');\r\n            self.menuDiv = self.div.querySelector('.' + self.CLASS + '-menu');\r\n\r\n            if (TC.browserFeatures.touch()) {\r\n                TC.Util.swipe(self.div, {\r\n                    left: function () {\r\n                        self.minimize();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (callback && typeof (callback) === \"function\")\r\n                callback.call();\r\n        });\r\n    };\r\n\r\n    ctlProto.minimize = function () {\r\n        const self = this;\r\n\r\n        const collapsedElm = self.div.querySelector(self.content.collapsedClass);\r\n        if (!isElementVisible(collapsedElm)) { // ya está minimizado\r\n            collapsedElm.classList.add(self.classes.FA);\r\n            collapsedElm.hidden = false;\r\n\r\n            self.hide('prsidebar-body');\r\n            self.show('prcollapsed-max');\r\n\r\n            self.map.trigger(TC.Consts.event.RESULTSPANELMIN, { control: self });\r\n        }\r\n    };\r\n\r\n    ctlProto.maximize = function () {\r\n        const self = this;\r\n\r\n        const collapsedElm = self.div.querySelector(self.content.collapsedClass);\r\n        if (isElementVisible(collapsedElm)) { // ya está maximizado\r\n            collapsedElm.hidden = true;\r\n\r\n            self.show('prsidebar-body');\r\n            self.hide('prcollapsed-max');\r\n\r\n            self.map.trigger(TC.Consts.event.RESULTSPANELMAX, { control: self });\r\n        }\r\n    };\r\n\r\n    ctlProto.close = function () {\r\n        const self = this;\r\n\r\n        self.div.classList.add(TC.Consts.classes.HIDDEN);\r\n\r\n        if (self.chart && self.chart.chart) {\r\n            self.chart.chart = self.chart.chart.destroy();\r\n        }\r\n\r\n        const body = self.div.querySelector('.prsidebar-body');\r\n        if (body) {\r\n            body.style.display = 'none';\r\n            self.div.querySelector('.prcollapsed-max').style.display = 'none';\r\n\r\n            const collapsedElm = self.div.querySelector(self.content.collapsedClass);\r\n            collapsedElm.hidden = true;\r\n            collapsedElm.classList.remove(self.classes.FA);\r\n\r\n            self.map.trigger(TC.Consts.event.RESULTSPANELCLOSE, { control: self });\r\n        }\r\n    };\r\n\r\n    ctlProto.openChart = function (data) {\r\n        const self = this;\r\n\r\n        self.div.classList.remove(TC.Consts.classes.HIDDEN);\r\n\r\n        // Cerramos el resto de los perfiles\r\n        self.map.getControlsByClass(TC.control.ResultsPanel)\r\n            .filter(function (ctl) {\r\n                return ctl !== self;\r\n            })\r\n            .filter(function (ctl) {\r\n                return ctl.options.content === 'chart';\r\n            })\r\n            .forEach(function (ctl) {\r\n                ctl.close();\r\n            });\r\n\r\n        if (data) {\r\n\r\n            if (data.msg) {\r\n                self.map.toast(data.msg);\r\n            }\r\n            else {\r\n                self.elevationProfileChartData = data;\r\n                self.renderElevationProfileChart({\r\n                    data: data,\r\n                    div: self.div.querySelector('.' + ctlProto.CLASS + '-chart')\r\n                });\r\n            }\r\n        } else {\r\n            self.map.toast(options.msg);\r\n        }\r\n    };\r\n\r\n    ctlProto.renderElevationProfileChart = function (options) {\r\n        const self = this;\r\n        options = options || {};\r\n        TC.loadJS(!window.c3,\r\n            TC.Consts.url.D3C3 || TC.apiLocation + 'lib/d3c3/d3c3.min.js',\r\n            function () {\r\n                const data = options.data;\r\n                data.ele = data.ele.map(val => val === null ? 0 : val);\r\n                const div = options.div;\r\n                var locale = TC.Util.getMapLocale(self.map);\r\n                self.getRenderedHtml(ctlProto.CLASS + '-chart', {\r\n                    upHill: data.upHill ? data.upHill.toLocaleString(locale) : '0',\r\n                    downHill: data.downHill ? data.downHill.toLocaleString(locale) : '0'\r\n                }, function (out) {\r\n\r\n                    div.innerHTML = out;\r\n                    div.style.display = '';\r\n\r\n                    if (self.options.titles) {\r\n\r\n                        if (self.options.titles.main) {\r\n                            const titleElm = self.div.querySelector('.prpanel-title-text');\r\n                            titleElm.setAttribute('title', self.options.titles.main);\r\n                            titleElm.innerHTML = self.options.titles.main;\r\n                        }\r\n\r\n                        if (self.options.titles.max) {\r\n                            self.div.querySelector('.prcollapsed-max').setAttribute('title', self.options.titles.max);\r\n                        }\r\n                    }\r\n                    var chartOptions = TC.Util.extend({\r\n                        bindto: div.querySelector('.tc-chart'),\r\n                        padding: {\r\n                            top: 0,\r\n                            right: 15,\r\n                            bottom: 0,\r\n                            left: 45,\r\n                        },\r\n                        legend: {\r\n                            show: false\r\n                        }\r\n                    }, self.createChartOptions(data));\r\n\r\n                    if (self.chart.tooltip) {\r\n                        chartOptions.tooltip = {\r\n                            contents: function (d) {\r\n                                var fn = self.chart.tooltip;\r\n                                if (typeof (fn) !== \"function\")\r\n                                    fn = TC.Util.getFnFromString(self.chart.tooltip);\r\n                                return fn.call(eval(self.chart.ctx), d);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (self.chart && self.chart.onmouseout) {\r\n                        chartOptions.onmouseout = function () {\r\n                            var fn = self.chart.onmouseout;\r\n                            if (typeof (fn) !== \"function\")\r\n                                fn = TC.Util.getFnFromString(self.chart.onmouseout);\r\n                            fn.call(eval(self.chart.ctx));\r\n                        };\r\n                    }\r\n\r\n                    chartOptions.onrendered = function () {                        \r\n                        if (TC.Util.isFunction(chartOptions._onrendered)) {\r\n                            chartOptions._onrendered.call(this);\r\n                        }\r\n                        self.map.trigger(TC.Consts.event.DRAWCHART, { control: self, svg: this.svg[0][0], chart: this });\r\n                    };\r\n\r\n                    if (window.c3) {\r\n\r\n                        if (!c3._isOverriden) {\r\n                            // GLS: Override de la función generateDrawLine y generateDrawArea para establecer otro tipo de interpolación en la línea\r\n                            window.c3.chart.internal.fn.generateDrawLine = function (lineIndices, isSub) {\r\n                                var $$ = this, config = $$.config,\r\n                                    line = $$.d3.svg.line(),\r\n                                    getPoints = $$.generateGetLinePoints(lineIndices, isSub),\r\n                                    yScaleGetter = isSub ? $$.getSubYScale : $$.getYScale,\r\n                                    xValue = function (d) { return (isSub ? $$.subxx : $$.xx).call($$, d); },\r\n                                    yValue = function (d, i) {\r\n                                        return config.data_groups.length > 0 ? getPoints(d, i)[0][1] : yScaleGetter.call($$, d.id)(d.value);\r\n                                    };\r\n                                line = config.axis_rotated ? line.x(yValue).y(xValue) : line.x(xValue).y(yValue);\r\n                                if (!config.line_connectNull) { line = line.defined(function (d) { return d.value != null; }); }\r\n                                return function (d) {\r\n                                    var values = config.line_connectNull ? $$.filterRemoveNull(d.values) : d.values,\r\n                                        x = isSub ? $$.x : $$.subX, y = yScaleGetter.call($$, d.id), x0 = 0, y0 = 0, path;\r\n                                    if ($$.isLineType(d)) {\r\n                                        if (config.data_regions[d.id]) {\r\n                                            path = $$.lineWithRegions(values, x, y, config.data_regions[d.id]);\r\n                                        } else {\r\n                                            if ($$.isStepType(d)) { values = $$.convertValuesToStep(values); }\r\n                                            path = line.interpolate('linear')(values);\r\n                                        }\r\n                                    } else {\r\n                                        if (values[0]) {\r\n                                            x0 = x(values[0].x);\r\n                                            y0 = y(values[0].value);\r\n                                        }\r\n                                        path = config.axis_rotated ? \"M \" + y0 + \" \" + x0 : \"M \" + x0 + \" \" + y0;\r\n                                    }\r\n                                    return path ? path : \"M 0 0\";\r\n                                };\r\n                            };\r\n                            window.c3.chart.internal.fn.generateDrawArea = function (areaIndices, isSub) {\r\n                                var $$ = this, config = $$.config, area = $$.d3.svg.area(),\r\n                                    getPoints = $$.generateGetAreaPoints(areaIndices, isSub),\r\n                                    yScaleGetter = isSub ? $$.getSubYScale : $$.getYScale,\r\n                                    xValue = function (d) { return (isSub ? $$.subxx : $$.xx).call($$, d); },\r\n                                    value0 = function (d, i) {\r\n                                        return config.data_groups.length > 0 ? getPoints(d, i)[0][1] : yScaleGetter.call($$, d.id)(0);\r\n                                    },\r\n                                    value1 = function (d, i) {\r\n                                        return config.data_groups.length > 0 ? getPoints(d, i)[1][1] : yScaleGetter.call($$, d.id)(d.value);\r\n                                    };\r\n                                area = config.axis_rotated ? area.x0(value0).x1(value1).y(xValue) : area.x(xValue).y0(value0).y1(value1);\r\n                                if (!config.line_connectNull) {\r\n                                    area = area.defined(function (d) { return d.value !== null; });\r\n                                }\r\n                                return function (d) {\r\n                                    var values = config.line_connectNull ? $$.filterRemoveNull(d.values) : d.values,\r\n                                        x0 = 0, y0 = 0, path;\r\n                                    if ($$.isAreaType(d)) {\r\n                                        if ($$.isStepType(d)) { values = $$.convertValuesToStep(values); }\r\n                                        path = area.interpolate('linear')(values);\r\n                                    } else {\r\n                                        if (values[0]) {\r\n                                            x0 = $$.x(values[0].x);\r\n                                            y0 = $$.getYScale(d.id)(values[0].value);\r\n                                        }\r\n                                        path = config.axis_rotated ? \"M \" + y0 + \" \" + x0 : \"M \" + x0 + \" \" + y0;\r\n                                    }\r\n                                    return path ? path : \"M 0 0\";\r\n                                };\r\n                            };\r\n                            c3._isOverriden = true;\r\n                        }\r\n\r\n                        self.chart.chart = c3.generate(chartOptions);\r\n                    }\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    const closeOpenedTableResultsPanel = function () {\r\n        const self = this;\r\n\r\n        self.map.getControlsByClass(TC.control.ResultsPanel)\r\n            .filter(function (ctl) {\r\n                return ctl !== self && ctl.isVisible();\r\n            })\r\n            .filter(function (ctl) {\r\n                return ctl.options.content !== self.contentType.CHART;\r\n            })\r\n            .forEach(function (ctl) {\r\n                ctl.close();\r\n            });\r\n    };\r\n\r\n    ctlProto.openTable = function () {\r\n        var self = this;\r\n\r\n        self.div.classList.remove(TC.Consts.classes.HIDDEN);\r\n\r\n        var data = arguments[0];\r\n        if (data) {\r\n\r\n            var css;\r\n            if (data.css) {\r\n                css = data.css;\r\n            }\r\n            var callback = data.callback;\r\n            var columns = data.columns, data = data.data;\r\n\r\n            if (data && data.length > 0) {\r\n                //Si no recibe columnas, las extrae de las claves del primer objeto de la colección de datos\r\n                if (!columns) {\r\n                    columns = [];\r\n                    for (var k in data[0]) {\r\n                        columns.push(k);\r\n                    }\r\n                }\r\n\r\n                //deleteColumns();\r\n\r\n                self.tableData = {\r\n                    columns: columns,\r\n                    results: data,\r\n                    css: css,\r\n                    callback: callback\r\n                }\r\n                self.getRenderedHtml(self.CLASS + '-table', self.tableData).then(function (html) {\r\n                    const table = self.div.querySelector('.' + self.CLASS + '-table');\r\n                    const parent = table.parentElement;\r\n                    parent.removeChild(table);\r\n                    table.innerHTML = html;\r\n                    parent.appendChild(table);\r\n                    if (self.tableData.callback) {\r\n                        self.tableData.callback(table);\r\n                    }\r\n\r\n                    closeOpenedTableResultsPanel.call(self);\r\n\r\n                    self.map.trigger(TC.Consts.event.DRAWTABLE, { control: self });\r\n                });\r\n\r\n                self.div.querySelector('.' + self.CLASS + '-chart').style.display = 'none';\r\n                self.div.querySelector('.' + self.CLASS + '-info').style.display = 'none';\r\n\r\n                self.show('prsidebar-body');\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.open = function (html, container) {\r\n        const self = this;\r\n\r\n        self.div.classList.remove(TC.Consts.classes.HIDDEN);\r\n\r\n        const toCheck = container || self.div.querySelector('.' + self.CLASS + '-table');\r\n        var checkIsRendered = function () {\r\n            var clientRect = toCheck.getBoundingClientRect();\r\n            if (clientRect && clientRect.width > 100) {\r\n                window.cancelAnimationFrame(this.requestIsRendered);\r\n\r\n                //closeOpenedTableResultsPanel.call(self);\r\n                this.map.trigger(TC.Consts.event.DRAWTABLE, { control: self });\r\n            }\r\n        };\r\n\r\n        self.requestIsRendered = window.requestAnimationFrame(checkIsRendered.bind(self));\r\n\r\n        const chartElm = self.div.querySelector('.' + self.CLASS + '-chart');\r\n        chartElm.style.display = 'none';\r\n        const tableElm = self.div.querySelector('.' + self.CLASS + '-table');\r\n        tableElm.style.display = 'none';\r\n        const infoElm = self.div.querySelector('.' + self.CLASS + '-info');\r\n        infoElm.style.display = 'none';\r\n\r\n        if (html) {\r\n            if (container) {\r\n                self.getTableContainer = function () {\r\n                    return container;\r\n                };\r\n                container.innerHTML = html;\r\n                container.style.display = '';\r\n            } else {\r\n                tableElm.innerHTML = html;\r\n                tableElm.style.display = '';\r\n            }\r\n        }\r\n\r\n        const maximizeElm = self.div.querySelector('.prcollapsed-max');\r\n\r\n        if (self.options.titles) {\r\n\r\n            if (self.options.titles.main) {\r\n                const titleElm = self.div.querySelector('.prpanel-title-text');\r\n                titleElm.setAttribute('title', self.options.titles.main);\r\n                titleElm.innerHTML = self.options.titles.main;\r\n            }\r\n\r\n            if (self.options.titles.max) {\r\n                maximizeElm.setAttribute('title', self.options.titles.max);\r\n            }\r\n        }\r\n\r\n        if (self.options.classes) {\r\n            if (self.options.classes.collapsed) {\r\n                maximizeElm.querySelector('i.fa-list-alt').classList.add(self.options.classes.collapsed);\r\n            }\r\n        }\r\n\r\n        // si está minimizado\r\n        const collapsedElm = self.div.querySelector(self.content.collapsedClass);\r\n        if (isElementVisible(collapsedElm)) {\r\n            self.maximize();\r\n        }\r\n\r\n        self.show('prsidebar-body');\r\n        self.hide('prcollapsed-max');\r\n    };\r\n\r\n    ctlProto.createChartOptions = function (options) {\r\n        const self = this;\r\n        var result = {};\r\n        options = options || {};\r\n        const locale = options.locale || TC.Util.getMapLocale(self.map);\r\n        switch (options.chartType) {\r\n            default:\r\n                if (options.ele != null) {\r\n                    const getChartSize = function () {\r\n                        const panelStyle = getComputedStyle(self.getContainerElement());\r\n                        const docWidth = document.documentElement.clientWidth / 100 * 40; // css panel contendor\r\n                        const r = {\r\n                            height: docWidth > 445 ? options.maxHeight || self.CHART_SIZE.MAX_HEIGHT : options.minHeight || self.CHART_SIZE.MIN_HEIGHT\r\n                        };\r\n                        // Si el panel ocupa el ancho del mapa dejamos el ancho del perfil que ocupe todo, en cualquier otro caso tenemos tres anchos predefinidos.\r\n                        if (panelStyle.width === getComputedStyle(self.map.div).width) {\r\n                            r.width = parseFloat(panelStyle.width) * 0.95;\r\n                        }\r\n                        else {\r\n                            r.width = docWidth > 445 ? options.maxWidth || self.CHART_SIZE.MAX_WIDTH : docWidth > 310 ? options.mediumWidth || self.CHART_SIZE.MEDIUM_WIDTH : options.minWidth || self.CHART_SIZE.MIN_WIDTH\r\n                        }\r\n                        return r;\r\n                    };\r\n\r\n                    var maxy = Number.NEGATIVE_INFINITY;\r\n                    var miny = Number.POSITIVE_INFINITY;\r\n                    options.ele.forEach(function (y) {\r\n                        if (typeof y === 'number') {\r\n                            maxy = Math.max(y, maxy);\r\n                            miny = Math.min(y, miny);\r\n                        }\r\n                    });\r\n\r\n                    const gradId = 'grad' + TC.getUID();\r\n\r\n                    result = {\r\n                        data: {\r\n                            x: 'x',\r\n                            columns: [['x'].concat(options.x), ['ele'].concat(options.ele)],\r\n                            types: { 'ele': 'area-spline' }, colors: {\r\n                                \"ele\": 'url(#' + gradId + ')'\r\n                            }\r\n                        },\r\n                        size: getChartSize(),\r\n                        point: {\r\n                            show: false\r\n                        },\r\n                        axis: {\r\n                            x: {\r\n                                tick: {\r\n                                    outer: false,\r\n                                    count: 5, format: function (d) {\r\n                                        d = d / 1000;\r\n                                        var dist;\r\n                                        var measure;\r\n                                        if (d < 1) {\r\n                                            dist = Math.round(d * 1000);\r\n                                            measure = ' m';\r\n                                        } else {\r\n                                            dist = Math.round(d * 100) / 100;\r\n                                            measure = ' km';\r\n                                        }\r\n\r\n                                        dist = dist.toLocaleString(locale);\r\n                                        return dist + measure;\r\n                                    }\r\n                                }\r\n                            },\r\n                            y: {\r\n                                padding: {\r\n                                    top: 0, bottom: 0\r\n                                },\r\n                                max: maxy,\r\n                                min: miny,\r\n                                tick: {\r\n                                    count: 2,\r\n                                    format: function (d) {\r\n                                        return (parseInt(d.toFixed(0)) || 0).toLocaleString(locale) + 'm';\r\n                                    }\r\n                                }\r\n                            }\r\n                        },\r\n                        onresize: function () {\r\n                            this.api.resize(getChartSize());                            \r\n                        }\r\n                    }\r\n\r\n                    if (options.time) result.time = (\"00000\" + options.time.h).slice(-2) + ':' + (\"00000\" + options.time.m).slice(-2) + ':' + (\"00000\" + options.time.s).slice(-2);\r\n\r\n                    result._onrendered = function () {\r\n                        const svg = this.svg[0][0];\r\n                        var svgDefsElement = svg.getElementsByTagName('defs')[0];\r\n                        var xmlns = \"http://www.w3.org/2000/svg\";\r\n                        var grad = document.createElementNS(xmlns, \"linearGradient\");\r\n                        grad.setAttributeNS(null, \"id\", gradId);\r\n                        grad.setAttributeNS(null, \"x1\", \"0%\");\r\n                        grad.setAttributeNS(null, \"x2\", \"0%\");\r\n                        grad.setAttributeNS(null, \"y1\", \"0%\");\r\n                        grad.setAttributeNS(null, \"y2\", \"100%\");\r\n                        grad.setAttributeNS(null, \"gradientUnits\", \"userSpaceOnUse\");\r\n\r\n                        const stop0 = document.createElementNS(xmlns, \"stop\");\r\n                        stop0.setAttributeNS(null, \"offset\", \"0%\");\r\n                        stop0.setAttributeNS(null, \"stop-color\", \"red\");\r\n                        stop0.setAttributeNS(null, \"stop-opacity\", \"0.7\");\r\n                        grad.appendChild(stop0);\r\n\r\n                        const stop50 = document.createElementNS(xmlns, \"stop\");\r\n                        stop50.setAttributeNS(null, \"offset\", \"50%\");\r\n                        stop50.setAttributeNS(null, \"stop-color\", \"orange\");\r\n                        stop50.setAttributeNS(null, \"stop-opacity\", \"0.9\");\r\n                        grad.appendChild(stop50);\r\n\r\n                        const stop100 = document.createElementNS(xmlns, \"stop\");\r\n                        stop100.setAttributeNS(null, \"offset\", \"100%\");\r\n                        stop100.setAttributeNS(null, \"stop-color\", \"green\");\r\n                        stop100.setAttributeNS(null, \"stop-opacity\", \"1\");\r\n                        grad.appendChild(stop100);\r\n\r\n                        svgDefsElement.appendChild(grad);\r\n\r\n                        const d3Node = d3.select(\".c3-brush\").node();\r\n                        if (d3Node) {\r\n                            d3Node.parentNode.removeChild(d3Node);\r\n                        }\r\n\r\n                        d3.select(\".c3-event-rects,.c3-event-rects-single\")\r\n                            .selectAll(\"rect\")\r\n                            .style(\"cursor\", \"pointer\")\r\n                            .on(\"click\", function (e) {\r\n                                d3.event.stopPropagation();\r\n                                const point = self.elevationProfileChartData.coords[e.index].slice(0, 2);\r\n                                if (point) {\r\n                                    TC.loadJS(!TC.feature || (TC.feature && !TC.feature.Point),\r\n                                        [TC.apiLocation + 'TC/feature/Point'],\r\n                                        function () {\r\n                                            self.map.zoomToFeatures([new TC.feature.Point(point, {})]);\r\n                                        }\r\n                                    );\r\n                                }\r\n                            });\r\n\r\n                        var pattern = d3.select('.c3-axis.c3-axis-x').select('path').attr('d');\r\n                        var match = /^M\\d\\,(\\d)V\\dH\\d{3}V(\\d)$/i.exec(pattern);\r\n                        if (match) { // quitamos las barritas de los extremos del axis-x\r\n                            pattern = pattern.replace(/(M\\d\\,)\\d/i, \"$10\").replace(/(H\\d{3}V)(\\d)/i, \"$10\");\r\n                            d3.select('.c3-axis.c3-axis-x').select('path').attr('d', pattern);\r\n                        } else {\r\n                            var match = /^M\\s\\d\\s(\\d)\\sV\\s\\d\\sH\\s\\d{3}\\sV\\s(\\d)$/i.exec(pattern);\r\n                            if (match) { // quitamos las barritas de los extremos del axis-x\r\n                                pattern = pattern.replace(/(M\\s\\d\\s)\\d/i, \"$10\").replace(/(H\\s\\d{3}\\sV\\s)(\\d)/i, \"$10\");\r\n                                d3.select('.c3-axis.c3-axis-x').select('path').attr('d', pattern);\r\n                            }\r\n                        }\r\n\r\n                        const svgRect = svg.getBoundingClientRect();\r\n                        const chartSize = {\r\n                            width: svgRect.width,\r\n                            height: svgRect.height\r\n                        };\r\n\r\n                        // ¿es necesario pasar los labels a multiline?\r\n                        var setMultilineLabels = function () {\r\n                            var x = d3.scale.ordinal().rangeRoundBands([0, chartSize.width], .1, .3);\r\n                            d3.select('.c3-axis-x').selectAll('text:not(.c3-axis-x-label)')\r\n                                .call(function (textNode, width) {\r\n                                    textNode.each(function () {\r\n                                        textNode.each(function (d, i) {\r\n                                            if (i == 0) return;\r\n\r\n                                            d3text = d3.select(this);\r\n                                            \r\n                                            if (d3text.node().childNodes.length === 1) {                                                \r\n                                                var clone = d3text.select('tspan').node().cloneNode();\r\n                                                var words = d3text.text().split(' ');\r\n\r\n                                                d3text.select('tspan').text(words[0]);\r\n                                                clone.textContent = words[1];\r\n                                                var dy = clone.getAttribute('dy');\r\n                                                dy = dy ? parseFloat(clone.getAttribute('dy')) : .71;\r\n                                                dy = dy + 0.18 + 'em';\r\n                                                clone.setAttribute('dy', dy);\r\n                                                d3text.node().appendChild(clone);\r\n                                            }\r\n                                        });\r\n                                    });\r\n                                }, x.rangeBand());\r\n                        };\r\n                        if (!d3.select('.c3-axis-x').node().getBoundingClientRect().width) {\r\n\r\n                            if (self.elevationChartLabelsRAF) {\r\n                                window.cancelAnimationFrame(self.elevationChartLabelsRAF);\r\n                                self.elevationChartLabelsRAF = undefined;\r\n                            }\r\n\r\n                            function hasSize() {\r\n                                if (d3.select('.c3-axis-x').length && !(d3.select('.c3-axis-x').node())) {\r\n                                    self.elevationChartLabelsRAF = requestAnimationFrame(hasSize);\r\n                                }\r\n                                else if (d3.select('.c3-axis-x').length && d3.select('.c3-axis-x').node() &&\r\n                                    !d3.select('.c3-axis-x').node().getBoundingClientRect().width) {\r\n                                    self.elevationChartLabelsRAF = requestAnimationFrame(hasSize);\r\n                                } else {\r\n                                    window.cancelAnimationFrame(self.elevationChartLabelsRAF);\r\n                                    self.elevationChartLabelsRAF = undefined;\r\n\r\n                                    if (((d3.select('.c3-axis-x').node().getBoundingClientRect().width >= chartSize.width - d3.select('.c3-axis-y').node().getBoundingClientRect().width) ||\r\n                                        (d3.select('.c3-axis-x').node().getBoundingClientRect().width * 100 / (chartSize.width - d3.select('.c3-axis-y').node().getBoundingClientRect().width) > 90))) {\r\n                                        setMultilineLabels();\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            self.elevationChartLabelsRAF = requestAnimationFrame(hasSize);\r\n                        }\r\n                        else if (((d3.select('.c3-axis-x').node().getBoundingClientRect().width >= chartSize.width - d3.select('.c3-axis-y').node().getBoundingClientRect().width) ||\r\n                            (d3.select('.c3-axis-x').node().getBoundingClientRect().width * 100 / (chartSize.width - d3.select('.c3-axis-y').node().getBoundingClientRect().width) > 90))) {\r\n                            setMultilineLabels();\r\n                        }\r\n\r\n                        if (!self.isMinimized()) {\r\n                            self.show('prsidebar-body');\r\n                            self.hide('prcollapsed-max');\r\n                        }\r\n\r\n\r\n                        self.div.querySelector('.' + self.CLASS + '-table').style.display = '';\r\n                        self.div.querySelector('.' + self.CLASS + '-info').style.display = '';\r\n                    }\r\n                }\r\n                else {\r\n                    result = {\r\n                        msg: self.getLocaleString(\"geo.trk.chart.chpe.empty\")\r\n                    };\r\n                }\r\n                break;\r\n        }\r\n        return result;\r\n    };\r\n\r\n    const getTime = function (timeFrom, timeTo) {\r\n        var diff = timeTo - timeFrom;\r\n        var d = {};\r\n        var daysDifference = Math.floor(diff / 1000 / 60 / 60 / 24);\r\n        diff -= daysDifference * 1000 * 60 * 60 * 24;\r\n\r\n        var hoursDifference = Math.floor(diff / 1000 / 60 / 60);\r\n        diff -= hoursDifference * 1000 * 60 * 60;\r\n\r\n        d.h = hoursDifference + (daysDifference * 24);\r\n\r\n        var minutesDifference = Math.floor(diff / 1000 / 60);\r\n        diff -= minutesDifference * 1000 * 60;\r\n\r\n        d.m = minutesDifference;\r\n\r\n        d.s = Math.floor(diff / 1000);\r\n\r\n        return TC.Util.extend({}, d, { toString: (\"00000\" + d.h).slice(-2) + ':' + (\"00000\" + d.m).slice(-2) + ':' + (\"00000\" + d.s).slice(-2) });\r\n    };\r\n\r\n    ctlProto.getElevationChartTooltip = function (data) {\r\n        const self = this;\r\n        const coords = self.elevationProfileChartData.coords;\r\n        var distance = data[0].x;\r\n        distance = distance / 1000;\r\n\r\n        const p = coords[data[0].index];\r\n        var doneTime;\r\n        if (coords[0].length == 4 && coords[0][3] > 0) {\r\n            doneTime = getTime(coords[0][3], p[3]);\r\n        }\r\n\r\n        const locale = self.map.options.locale && self.map.options.locale.replace('_', '-') || undefined;\r\n        const ele = parseInt(data[0].value.toFixed(0)).toLocaleString(locale);\r\n        var dist;\r\n        var measure;\r\n        if (distance < 1) {\r\n            dist = Math.round(distance * 1000);\r\n            measure = ' m';\r\n        } else {\r\n            dist = Math.round(distance * 100) / 100;\r\n            measure = ' km';\r\n        }\r\n        dist = dist.toLocaleString(locale);\r\n        return '<div class=\"track-elevation-tooltip\"><div><span>' + ele + ' m </span><br><span>' + dist + measure + ' </span></div>' + (doneTime ? '<span>' + doneTime.toString + '</span><div/>' : '');\r\n    };\r\n\r\n    ctlProto.getTableContainer = function () {\r\n        return this.tableDiv;\r\n    };\r\n\r\n    ctlProto.getInfoContainer = function () {\r\n        return this.infoDiv;\r\n    };\r\n\r\n    ctlProto.getMenuElement = function () {\r\n        return this.menuDiv;\r\n    };\r\n\r\n    ctlProto.getContainerElement = function () {\r\n        return this.div.querySelector('.prsidebar-body') || null;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self.wrap.register(map);\r\n\r\n        if (self.openOn) {\r\n            self.map.one(self.openOn, function (e, args) {\r\n                self.content.fnOpen.call(self, e.data);\r\n            });\r\n        }\r\n\r\n        if (self.closeOn) {\r\n            self.map.one(self.closeOn, function (e, args) {\r\n                self.close();\r\n            });\r\n        }\r\n\r\n        if (self.options.openOn) {\r\n            self.map.on(self.options.openOn, function (e, args) {\r\n                self.content.fnOpen.call(self, e.data);\r\n            });\r\n        }\r\n\r\n        if (self.options.closeOn) {\r\n            self.map.on(self.options.closeOn, function (e, args) {\r\n                self.close();\r\n            });\r\n        }\r\n\r\n        //map.on(TC.Consts.event.VIEWCHANGE, function () {\r\n\r\n        //    map.getControlsByClass(TC.control.ResultsPanel).filter(function (ctl) {\r\n        //        return ctl.options.content !== \"chart\" && ($(ctl.div).find('.' + ctl.CLASS + '-info:visible').length === 1 || $(ctl.div).find('.' + ctl.CLASS + '-table:visible').length === 1);\r\n        //    }).forEach(function (ctl) {\r\n        //        ctl.close();\r\n        //    });\r\n        //});\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.exportToExcel = function () {\r\n        var _ctl = this;\r\n\r\n        var rows = [_ctl.tableData.columns];\r\n\r\n        _ctl.tableData.results.forEach(function (value) {\r\n            var row = [];\r\n            for (var k in value) {\r\n                if (value.hasOwnProperty(k) && k !== \"Id\" && k !== \"Geom\") { //Las columnas ID y Geom no aparece en la exportaci\\u00f3n\r\n                    row.push(value[k]);\r\n                }\r\n            }\r\n            rows.push(row);\r\n        });\r\n        var _fncSave = function (exporter) {\r\n            var fileName = _ctl.save.fileName ? _ctl.save.fileName : 'resultados.xls';\r\n            var title = (_ctl.options.titles && _ctl.options.titles.main ? _ctl.options.titles.main : null);\r\n            exporter.Save(fileName, rows, title);\r\n        }\r\n        if (!TC.Util.ExcelExport) {\r\n            TC.loadJS(true, TC.apiLocation + 'TC/Util.ExcelExport', function () {\r\n                _fncSave(new TC.Util.ExcelExport());\r\n            });\r\n        }\r\n        else {\r\n            _fncSave(new TC.Util.ExcelExport());\r\n        }\r\n    };\r\n})();"]}