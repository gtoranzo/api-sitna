{"version":3,"sources":["Util.js"],"names":["TC","root","factory","exports","module","define","amd","Util","String","prototype","soundex","a","this","toLowerCase","split","f","shift","r","codes","e","i","o","u","b","p","v","c","g","j","k","q","s","x","z","d","t","l","m","n","map","filter","join","slice","toUpperCase","Number","isInteger","value","isFinite","Math","floor","toLocaleString","locale","options","detectIE","apply","arguments","sNum","replace","iconUrlCache","markerGroupClassCache","path1","path2","getOnPath","obj","length","hasOwnProperty","swipeHandlers","WeakMap","modalCloseHandlers","isPlainObject","Object","toString","call","isEmptyObject","name","isFunction","getMapLocale","regex","PROTOCOL","isOnCapabilities","url","withProtocol","testUrl","capabilities","reqGetMapOnCapabilities","caps","getFNFromString","fnName","scope","window","scopeSplit","undefined","isURL","text","test","isSecureURL","isSameOrigin","uri","result","indexOf","urlParts","match","Consts","SPLIT_REGEX","location","uProtocol","protocol","hostname","uPort","lPort","port","formatNumber","parseFloat","valueOf","addProtocol","getDiv","div","document","getElementById","HTMLElement","$","createElement","getScriptLocation","src","script","currentScript","scripts","getElementsByTagName","getAttribute","substr","lastIndexOf","getBackgroundUrlFromCss","cssClass","iconDiv","style","display","classList","add","body","appendChild","exec","getComputedStyle","backgroundImage","parentElement","removeChild","getPointIconUrl","className","classes","Cfg","styles","marker","group","key","point","addArrayToTree","path","treeNode","index","found","len","children","title","uid","push","parseCoords","_parseGeoCoord","type","GEOGRAPHIC","idx","_parseCoord","trim","UTM","xy","y","reproject","coords","sourceCrs","targetCrs","multipoint","multiring","multipoly","isArray","loadProjDef","crs","sync","sourcePrj","Proj4js","Proj","targetPrj","Array","forEach","poly","pidx","rp","ring","ridx","rr","coord","cidx","transform","getMetersPerDegree","extent","dLat","degToRad","sindlat2","sin","atan2","sqrt","radToDeg","rad","PI","deg","mod","getCRSCode","CRSCodesEqual","crs1","crs2","code1","code2","getLocaleString","texts","i18n","getSimpleMimeType","mimeType","end","substring","getQueryStringParams","queryString","queryIdx","fragmentIdx","search","elm","bind","getParamString","arr","encodeURIComponent","fastUnshift","storage","getCookie","cookie","setCookie","getLocalValue","localStorage","Storage","getItem","setLocalValue","removeItem","setItem","exDate","Date","setDate","getDate","expires","getSessionLocalValue","sessionStorage","setSessionLocalValue","detectFirefox","navigator","userAgent","RegExp","$1","ua","msie","parseInt","rv","edge","detectChrome","chrome","detectSafari","detectMouse","Modernizr","mq","mqResult","hover","touch","matchMedia","media","matches","console","log","testHover","detectAndroid","detectBlackBerry","detectIOS","detectMobileWindows","detectMobile","getBrowser","UAParser","syncLoadJS","apiLocation","UA_PARSER","browser","version","major","getElementByNodeName","parentNode","nodeName","colonIndex","tag","nodes","getElementsByTagNameNS","addURLParameters","parameters","toAdd","keys","urlparts","params","removeURLParameter","parameter","prefix","pars","splice","showModal","contentNode","hidden","fadeIn","get","closeButton","querySelectorAll","closeCallback","delete","stopPropagation","closeModal","target","set","addEventListener","openCallback","callback","hide","modal","querySelector","removeAttribute","closeAlert","btn","swipe","addListeners","handlers","start","removeEventListener","minDistance","maxCrossDistance","maxAllowedTime","touchStartCoords","touchEndCoords","startTime","noSwipe","mustSwipe","changedTouches","pageX","pageY","getTime","startCoords","endCoords","dx","dy","adx","abs","ady","getDirection","getParameterByName","results","decodeURIComponent","getLocaleUserChoice","cookieName","paramName","browserLanguage","languages","language","userLanguage","lang","hyphenIdx","expirationDate","getValidFilename","filename","downloadBlob","blob","link","download","URL","createObjectURL","setAttribute","visibility","click","downloadFile","data","Blob","msSaveBlob","downloadDataURI","dataURI","binary","atob","array","charCodeAt","Uint8Array","shortenUrl","ajax","access_token","longUrl","utf8ToBase64","str","btoa","unescape","base64ToUtf8","escape","error","colorArrayToString","color","reduce","prev","cur","operation","list1","list2","comparerFn","operationIsUnion","item1","inBoth","inFirstOnly","inSecondOnly","toDataUrl","canvas","backgroundColour","_ref","encoderOptions","context","getContext","width","height","getImageData","compositeOperation","globalCompositeOperation","fillStyle","fillRect","imageData","toDataURL","clearRect","putImageData","imgToDataUrl","outputFormat","createCanvas","img","ctx","drawImage","Promise","resolve","reject","Image","crossOrigin","onload","dataURL","dataUrl","proxify","onerror","xhr","XMLHttpRequest","open","setRequestHeader","responseType","status","uInt8Array","response","binaryString","fromCharCode","getResponseHeader","onreadystatechange","readyState","send","complete","imgTagToDataUrl","base64","addToCanvas","position","size","newCanvas","cloneCanvas","newImage","oldCanvas","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","ratio","min","getFormattedDate","date","hasTime","pad","getFullYear","getMonth","concat","getHours","getMinutes","getSeconds","replaceAccent","translate","ä","ö","ü","Ä","Ö","Ü","á","é","ó","ú","Á","É","Í","Ó","Ú","ñ","Ñ","downloadFileForm","fragment","createDocumentFragment","form","input","iframes","iframe","currentIframe","dataset","downloadUrl","content","contentDocument","write","outerHTML","close","htmlObj","arrDownloads","submit","setTimeout","WFSQueryBuilder","layers","onlyHits","queryHeader","query","format","resultType","queryBody","queryItem","each","typeName","getText","WFSFilterBuilder","feature","jQuery","clipLayer","geometryName","where","gmlEnvelope","lowerCorner","upperCorner","Feature","writeGMLGeometry","gmlVersion","getGmlCoordinates","item","Polyline","geometry","isServiceWorker","serviceWorker","controller","state","isSameOriginByLocation","isSameProtocol","protocolRegex","uriProtocol","locationProtocol","consoleRegister","msg","isDebug","getSorterByProperty","propName","getSoundexDifference","res","charAt","toAbsolutePath","href","getRenderedHtml","templateId","template","render","dust","cache","err","out","Error","loadJSInOrder","templating","method","then","html","tpl","compile","loadSource","catch","explodeGeometry","origin","iterationFunction","geom","cloneMappingFunction","compactGeometry","precision","MAX_VALUE","newGeom","firstIterationFunction","round","val","secondIterationFunction","args","arg","fncOvelaps","elem1","elem2","comparisonFnc","getBoundingClientRect","colliding","other","rect1","rect2","top","bottom","right","left","containing","inside"],"mappings":"AAAG,IAAIA,GAAKA,QACZ,SAAWC,EAAMC,GACU,iBAAZC,QACPC,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,UAAWH,GAEXD,EAAKM,KAAOL,IANpB,CAQGF,GAAI,WAEHQ,OAAOC,UAAUC,QAAU,WACvB,IAAIC,EAAIC,KAAKC,cAAcC,MAAM,IACjCC,EAAIJ,EAAEK,QACFC,EAAI,GACJC,OACIP,EAAG,GAAIQ,EAAG,GAAIC,EAAG,GAAIC,EAAG,GAAIC,EAAG,GAC/BC,EAAG,EAAGR,EAAG,EAAGS,EAAG,EAAGC,EAAG,EACrBC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAC7CC,EAAG,EAAGC,EAAG,EACTC,EAAG,EACHC,EAAG,EAAGC,EAAG,EACTrB,EAAG,GAGXA,EAAIF,EACAJ,EACK4B,IAAI,SAAUd,EAAGL,EAAGT,GAAK,OAAOO,MAAMO,KACtCe,OAAO,SAAUf,EAAGL,EAAGT,GAAK,OAAe,IAANS,EAAWK,IAAMP,MAAMH,GAAKU,IAAMd,EAAES,EAAI,KAC7EqB,KAAK,IAEd,OAAQxB,EAAI,OAAOyB,MAAM,EAAG,GAAGC,eAInCC,OAAOC,UAAYD,OAAOC,WAAa,SAAUC,GAC7C,MAAwB,iBAAVA,GACVC,SAASD,IACTE,KAAKC,MAAMH,KAAWA,GAI9B,IAAII,EAAiBN,OAAOnC,UAAUyC,eACtCN,OAAOnC,UAAUyC,eAAiB,SAAUC,EAAQC,GAChD,GAAc,SAAVD,GAAsBnD,GAAGO,KAAK8C,WAS9B,OAAOH,EAAeI,MAAM1C,KAAM2C,WARlC,IAAIC,EAAON,EAAeI,MAAM1C,KAAM2C,WACtCC,EAAOA,EAAKC,QAAQ,MAAO,KACrBT,KAAKC,MAAMrC,OAASA,MAAQgC,OAAOC,UAAUG,KAAKC,MAAMrC,SAC1D4C,EAAOA,EAAKC,QAAQ,YAAa,QAErC,OAAOD,GAMf,IAAIE,KACAC,KAEAC,GAAS,aAAc,UAAW,SAAU,UAAW,IAAK,OAAQ,MAAO,kBAC3EC,GAAS,qBAAsB,UAAW,MAAO,OAAQ,MAAO,IAAK,QACrEC,EAAY,SAAUC,EAAKvC,EAAGJ,GAC9B,OAAIA,EAAII,EAAEwC,OAAS,EACXD,EAAIE,eAAezC,EAAEJ,IACd0C,EAAUC,EAAIvC,EAAEJ,IAAKI,IAAKJ,GACzB,KAEL2C,EAAIvC,EAAEJ,KAIrB,MAAM8C,EAAgB,IAAIC,QACpBC,EAAqB,IAAID,QAE/B,IAAI5D,GAEA8D,cAAe,SAAUN,GACrB,MAA+C,oBAAxCO,OAAO7D,UAAU8D,SAASC,KAAKT,IAG1CU,cAAe,SAAUV,GACrB,IAAIW,EACJ,IAAKA,KAAQX,EACT,OAAO,EAEX,OAAO,GAGXY,WAAY,SAAUZ,GAClB,MAAsB,mBAARA,GAGlBa,aAAc,SAAUrC,GACpB,OAAOA,EAAIa,SAAWb,EAAIa,QAAQD,QAAUZ,EAAIa,QAAQD,OAAOM,QAAQ,IAAK,MAAQ,SAGxFoB,OACIC,SAAU,eAGdC,iBAAkB,SAAUC,GACxB,IAAIC,EAAmC,GAApB1B,UAAUS,QAAcT,UAAU,GACjD2B,EAAWD,EAAyDD,EAA1CA,EAAIvB,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,IAElE,GAAIG,GACA,GAAIjF,GAAGmF,aAAaD,GAChB,OAAOF,OAEX,IAAK,IAAItD,KAAK1B,GAAGmF,aACb,GAAIzD,EAAE+B,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,KAAOI,EACzC,OAAOxD,EAInB,IAAKA,KAAK1B,GAAGmF,aAAc,CACvB,IAAI7D,EAAIwC,EAAU9D,GAAGmF,aAAazD,GAAIkC,EAAO,IAAME,EAAU9D,GAAGmF,aAAazD,GAAImC,EAAO,GAExF,GAAIvC,GAAK2D,GAAgBD,GAAO1D,EAAG,OAAOA,EACrC,GAAIA,GAAK0D,EAAIvB,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,KAAOxD,EAAEmC,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,IAAK,OAAOxD,EAG3G,OAAO0D,GAGXI,wBAAyB,SAAUJ,GAC/B,IAGqBK,EACb/D,EAJJ2D,EAAmC,GAApB1B,UAAUS,QAAcT,UAAU,GACtC0B,GAAeD,EAAIvB,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,IASlE,OAAI9E,GAAGmF,aAAaH,IAPCK,EAQLrF,GAAGmF,aAAaH,IAPxB1D,EAAIwC,EAAUuB,EAAMzB,EAAO,IAAME,EAAUuB,EAAMxB,EAAO,IAEhDoB,EAAqE3D,EAAER,MAAM,KAAK,GAAnEQ,EAAER,MAAM,KAAK,GAAG2C,QAAQzD,GAAGO,KAAKsE,MAAMC,SAAU,IAEpE,MAMJ,MAGXQ,gBAAiB,SAAUC,GACvB,IAAIC,EAAQC,OACRC,EAAaH,EAAOzE,MAAM,KAC9B,IAAKM,EAAI,EAAGA,EAAIsE,EAAW1B,OAAS,EAAG5C,IAGnC,QAAauE,IAFbH,EAAQA,EAAME,EAAWtE,KAED,OAG5B,OAAOoE,EAAME,EAAWA,EAAW1B,OAAS,KAGhD4B,MAAO,SAAUC,GACb,MAAO,kCAAkCC,KAAKD,IAGlDE,YAAa,SAAUf,GAEnB,OAAK,oBAAoBc,KAAKd,IAEtB,mBAAmBc,KAAKd,IAGpCgB,aAAc,SAAUC,GACpB,IAAIC,EAAiC,IAAxBD,EAAIE,QAAQ,SAAuC,IAAtBF,EAAIE,QAAQ,MAClDC,GAAYF,GAAUD,EAAII,MAAMrG,GAAGsG,OAAOtB,IAAIuB,aAClD,GAAIH,EAAU,CACV,IAAII,EAAWf,OAAOe,SAClBC,EAAYL,EAAS,GACzBF,GACKO,GAAaD,EAASE,eAAyBf,GAAbc,IACnCL,EAAS,IAAMI,EAASG,SAC5B,IAAIC,EAAQR,EAAS,GAAIS,EAAQL,EAASM,MAC7B,IAATF,GAAyB,KAAVA,GAAyB,MAATC,GAA2B,KAAVA,KAChDX,EAASA,GAAUU,GAASC,GAGpC,OAAOX,GAGXa,aAAc,SAAUjE,EAAOK,GAC3B,IAAIhB,SAAWW,EACf,GAAU,WAANX,EACA,OAAOW,EAAMI,eAAeC,GAE3B,GAAU,WAANhB,EAAgB,CACrBG,EAAI0E,WAAWlE,GACf,GAAIR,IAAM,IAAIM,OAAOE,GAAOmE,UACxB,OAAO3E,EAAEY,eAAeC,GAGhC,OAAOL,GAGXoE,YAAa,SAAUjB,GACnB,IAAIC,EAASD,EACTA,GAA6B,IAAtBA,EAAIE,QAAQ,QACnBD,EAASM,SAASE,SAAWT,GAEjC,OAAOC,GAOXiB,OAAQ,SAAUC,GAcd,MAZmB,iBAARA,EACEC,SAASC,eAAeF,GAE5BA,aAAeG,YACXH,EAEJ,MAAO3B,QAAU2B,aAAeI,GAAKJ,EAAIpD,OACrCoD,EAAI,GAGJC,SAASI,cAAc,QAKxCC,kBAAmB,WACf,IAAIC,EACAC,EACJ,GAAIP,SAASQ,cACTD,EAASP,SAASQ,kBAEjB,CACD,IAAIC,EAAUT,SAASU,qBAAqB,UAC5CH,EAASE,EAAQA,EAAQ9D,OAAS,GAGtC,OADA2D,EAAMC,EAAOI,aAAa,QAEfL,EAAIM,OAAO,EAAGN,EAAIO,YAAY,KAAO,GAEzC,IAOXC,wBAAyB,SAAUC,GAC/B,IAAIlC,EAAS,GAEb,GAAIkC,EACA,QAA+BzC,IAA3BjC,EAAa0E,GACblC,EAASxC,EAAa0E,OAErB,CACD,MAAMC,EAAUhB,SAASI,cAAc,OACvCY,EAAQC,MAAMC,QAAU,OACxBF,EAAQG,UAAUC,IAAIL,GACtBf,SAASqB,KAAKC,YAAYN,GAE1B,IAAIhC,EAAQ,6BAA6BuC,KAAKnD,OAAOoD,iBAAiBR,EAAS,MAAMS,iBACjFzC,GAASA,EAAMrC,OAAS,IACxBkC,EAASG,EAAMA,EAAMrC,OAAS,IAElCqE,EAAQU,cAAcC,YAAYX,GAClC3E,EAAa0E,GAAYlC,EAGjC,OAAOA,GAGX+C,gBAAiB,SAASA,EAAgB7F,GACtC,IAAI8C,EAAS,KACb,GAAI9C,EAAQ4B,IACRkB,EAAS9C,EAAQ4B,QAEhB,CACD,IAAIkE,EACJ,GAAgC,iBAArB9F,EAAQgF,SACfc,EAAY9F,EAAQgF,aAEnB,CACD,IAAIe,EAAU/F,EAAQ+F,SAAWnJ,GAAGoJ,IAAIC,OAAOC,OAAOH,QACtDD,EAAYC,EAAQ,GACpB,GAAI/F,EAAQmG,MAAO,CACf,QAA6C5D,IAAzChC,EAAsBP,EAAQmG,OAAsB,CACpD,IAAInI,EAAI,EACR,IAAK,IAAIoI,KAAO7F,EACZvC,IAEJA,GAAQ+H,EAAQnF,OAChBL,EAAsBP,EAAQmG,OAASJ,EAAQ/H,GAEnD8H,EAAYvF,EAAsBP,EAAQmG,QAGlDrD,EAASlG,GAAGO,KAAK4H,wBAAwBe,GAExChD,GAAU9C,IAAYpD,GAAGoJ,IAAIC,OAAOI,OAA8B,KAArBrG,EAAQgF,WACtDlC,EAAS+C,EAAgBjJ,GAAGoJ,IAAIC,OAAOI,QAE3C,OAAOvD,GAQXwD,eAAgB,SAASA,EAAeC,EAAMC,EAAUC,GACpD,IAAI3D,EAAS,KACT4D,GAAQ,EAERpF,EAAOiF,EADXE,EAAQA,GAAS,GAEjB,GAAInF,EAAM,CAEN,IADA,IAAIpC,EACKlB,EAAI,EAAG2I,EAAMH,EAASI,SAAShG,OAAQ5C,EAAI2I,EAAK3I,IAErD,IADAkB,EAAIsH,EAASI,SAAS5I,IAChBsD,OAASA,EAAM,CACjBoF,GAAQ,EACR,IAAI7I,EAAIyI,EAAeC,EAAMrH,EAAGuH,EAAQ,GACpC5I,IACAiF,EAASjF,GAEb,MAGR,IAAK6I,EAAO,CACRxH,GAAMoC,KAAMA,EAAMuF,MAAOvF,EAAMwF,IAAK,IAAMP,EAAKjH,MAAM,EAAGmH,EAAQ,GAAGpH,KAAK,KAAMuH,aAC9EJ,EAASI,SAASG,KAAK7H,GACvB4D,EAAS5D,GAGjB,OAAO4D,GAGXkE,YAAa,SAAUvE,GACnB,IAAIK,EAAS,KAETmE,EAAiB,SAAUxE,GAC3B,IAAI1D,EAAI0D,EACJK,KACJA,EAAOoE,KAAOtK,GAAGsG,OAAOiE,WACxB,IAAIC,EAAMrI,EAAEgE,QAAQ,QACpBD,EAAOpD,MAAQkE,WAAW7E,EAAE8F,OAAO,EAAGuC,IAGtC,IADAA,GADArI,EAAIA,EAAE8F,OAAOuC,EAAM,IACXrE,QAAQ,OACL,EAAG,CACV,IAAI1E,EAAIuF,WAAW7E,EAAE8F,OAAO,EAAGuC,IAAQ,GACnCtE,EAAOpD,OAAS,EAChBoD,EAAOpD,OAASrB,EAGhByE,EAAOpD,OAASrB,EAIpB,IADA+I,GADArI,EAAIA,EAAE8F,OAAOuC,EAAM,IACXrE,QAAQ,OACL,EAAG,CACV1E,EAAIuF,WAAW7E,EAAE8F,OAAO,EAAGuC,GAAK/G,QAAQ,IAAK,MAAQ,KACjDyC,EAAOpD,OAAS,EAChBoD,EAAOpD,OAASrB,EAGhByE,EAAOpD,OAASrB,GAI5B,OAAOyE,GAGPuE,EAAc,SAAU5E,GACxB,IAAI1D,EAAIqF,EAAEkD,KAAK7E,GAEf,GAAI1D,EAAEkE,MAAM,qFAAsF,CAC9F,OAAQlE,EAAEA,EAAE6B,OAAS,IACjB,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACD7B,EAAI,IAAMA,EAGlBA,EAAIA,EAAE8F,OAAO,EAAG9F,EAAE6B,OAAS,GAC3B,OAAOqG,EAAelI,GAG1B,GAAIA,EAAEkE,MAAM,2EACR,OAAOgE,EAAelI,GAG1B,GAAIA,EAAEkE,MAAM,mDAAoD,CAC5D,IAAIH,GAAWoE,KAAMtK,GAAGsG,OAAOiE,WAAYzH,MAAOkE,WAAW7E,EAAE8F,OAAO,EAAG9F,EAAE6B,OAAS,GAAGP,QAAQ,IAAK,OAChGtB,EAAEkE,MAAM,eACRH,EAAOpD,OAASoD,EAAOpD,OAE3B,OAAOoD,EAGX,OAAI/D,EAAEkE,MAAM,0CACCiE,KAAMtK,GAAGsG,OAAOiE,WAAYzH,MAAOkE,WAAW7E,EAAEsB,QAAQ,IAAK,OAGtEtB,EAAEkE,MAAM,yBACCiE,KAAMtK,GAAGsG,OAAOqE,IAAK7H,MAAOkE,WAAW7E,EAAEsB,QAAQ,IAAK,OAE5D,MAIPmH,GADJ/E,EAAO2B,EAAEkD,KAAK7E,GAAMlD,eACN7B,MAAM,KACF,IAAd8J,EAAG5G,OACH4G,GAAMA,EAAGlI,MAAM,EAAG,GAAGD,KAAK,KAAMmI,EAAGlI,MAAM,EAAG,GAAGD,KAAK,MAEjC,IAAdmI,EAAG5G,QAA8B,IAAd4G,EAAG5G,SAC3B4G,EAAK/E,EAAK/E,MAAM,MAEpB,GAAkB,IAAd8J,EAAG5G,OAAc,CACjB,IAAIhC,EAAIyI,EAAYG,EAAG,IACnBC,EAAIJ,EAAYG,EAAG,IACb,OAAN5I,GAAoB,OAAN6I,IACd3E,GAAUlE,EAAG6I,IAGrB,OAAO3E,GAGX4E,UAAW,SAAUC,EAAQC,EAAWC,GACpC,IAAI/E,EACAgF,GAAa,EACbC,GAAY,EACZC,GAAY,EAChB,GAAI5D,EAAE6D,QAAQN,EAAO,IACjB,GAAIvD,EAAE6D,QAAQN,EAAO,GAAG,KACpB,IAAKvD,EAAE6D,QAAQN,EAAO,GAAG,GAAG,IAAK,CAC7BK,GAAY,EACZL,GAAUA,QAGb,CACDI,GAAY,EACZJ,IAAWA,QAGd,CACDG,GAAa,EACbC,GAAY,EACZC,GAAY,EACZL,KAAYA,KAEhB/K,GAAGsL,aAAcC,IAAKP,EAAWQ,MAAM,IACvCxL,GAAGsL,aAAcC,IAAKN,EAAWO,MAAM,IACvC,IAAIC,EAAY,IAAIC,QAAQC,KAAKX,GAC7BY,EAAY,IAAIF,QAAQC,KAAKV,GACjC/E,EAAS,IAAI2F,MAAMd,EAAO/G,QAC1B+G,EAAOe,QAAQ,SAAUC,EAAMC,GAC3B,MAAMC,EAAK/F,EAAO8F,MAClBD,EAAKD,QAAQ,SAAUI,EAAMC,GACzB,MAAMC,EAAKH,EAAGE,MACdD,EAAKJ,QAAQ,SAAUO,EAAOC,GAC1B,IAAI7C,EAAQiC,QAAQa,UAAUd,EAAWG,GAAa5J,EAAGqK,EAAM,GAAIxB,EAAGwB,EAAM,KAC5ED,EAAGE,IAAS7C,EAAMzH,EAAGyH,EAAMoB,GACvBwB,EAAMrI,OAAS,IACfoI,EAAGE,GAAM,GAAKD,EAAM,UAK/BnB,EAGKC,EAGAC,IACNlF,EAASA,EAAO,IAHhBA,EAASA,EAAO,GAAG,GAHnBA,EAASA,EAAO,GAAG,GAAG,GAQ1B,OAAOA,GAGXsG,mBAAoB,SAAUC,GAC1B,IAAIvG,OAASP,EAKb,GAAI6B,EAAE6D,QAAQoB,IAAWA,EAAOzI,QAAU,EAAG,CACzC,IAAI0I,EAAO9L,KAAK+L,SAASF,EAAO,GAAKA,EAAO,IACxCG,EAAW5J,KAAK6J,IAAIH,EAAO,GAC3B/L,EAAIiM,EAAWA,EAEnB1G,EATI,SAQI,EAAIlD,KAAK8J,MAAM9J,KAAK+J,KAAKpM,GAAIqC,KAAK+J,KAAK,EAAIpM,MACjC8L,EAAO,GAAKA,EAAO,IAEzC,OAAOvG,GAGX8G,SAAU,SAAUC,GAChB,OAAa,IAANA,EAAYjK,KAAKkK,IAE5BP,SAAU,SAAUQ,GAChB,OAAOA,EAAMnK,KAAKkK,GAAK,KAE3BE,IAAK,SAAU9K,GACX,OAASA,GAAK,EAAIU,KAAKkK,IAAQ,EAAIlK,KAAKkK,KAAQ,EAAIlK,KAAKkK,KAG7DG,WAAY,SAAU9B,GAClB,IAAIrF,EAAS,KACbqF,EAAMA,EAAIb,OACV,GAAI,kBAAkB5E,KAAKyF,IACvB,oCAAoCzF,KAAKyF,IACzC,yDAAyDzF,KAAKyF,GAAM,CACpE,IAAIlF,EAAQkF,EAAIb,OAAOrE,MAAM,qBACzBA,IACAH,EAASG,EAAM,IAGvB,OAAOH,GAGXoH,cAAe,SAAUC,EAAMC,GAC3B,GAAID,IAASC,EACT,OAAO,EAEX,IAAIC,EAAQ7M,KAAKyM,WAAWE,GACxBG,EAAQ9M,KAAKyM,WAAWG,GAC5B,OAAiB,OAAVC,GAA4B,OAAVC,GAAkBD,IAAUC,GAGzDC,gBAAiB,SAAUxK,EAAQqG,EAAKoE,GACpC,IAAI1H,EAASsD,EACb,GAAIxJ,GAAG6N,MAAQ7N,GAAG6N,KAAK1K,GAAS,CAC5B,IAAI0C,EAAO7F,GAAG6N,KAAK1K,GAAQqG,GAC3B,GAAI3D,EAAM,CACNK,EAASL,EACT,GAAI+H,EACA,IAAK,IAAI/L,KAAK+L,EACV1H,EAASA,EAAOzC,QAAQ,IAAM5B,EAAI,IAAK+L,EAAM/L,KAK7D,OAAOqE,GAGX4H,kBAAmB,SAAUC,GACzB,IAAI7H,EAAS,GACb,GAAI6H,EAAU,CACV,IAAIC,EAAMD,EAAS5H,QAAQ,KACvB6H,EAAM,IACND,EAAWA,EAASE,UAAU,EAAGD,IAErC9H,EAAS6H,EAEb,OAAO7H,GAGXgI,qBAAsB,SAAUlJ,GAC5B,IAAImJ,EACJ,GAAInJ,EAAK,CACL,IAAIoJ,EAAWpJ,EAAImB,QAAQ,KAC3B,GAAIiI,GAAY,EAAG,CAEf,IAAIC,GADJF,EAAcnJ,EAAIiD,OAAOmG,IACKjI,QAAQ,KAClCkI,GAAe,IACfF,EAAcA,EAAYlG,OAAO,EAAGoG,SAIxCF,EAAc,SAIlBA,EAAc3H,SAAS8H,OAE3B,IAAIpI,EAASsB,EAAEjF,IAAI4L,EAAY1K,QAAQ,QAAS,IAAI3C,MAAM,KAAM,SAAUyN,GACtE,OAA6B3N,MAAtB2N,EAAMA,EAAIzN,MAAM,MAAe,IAAMyN,EAAI,GAAI3N,MACtD4N,UAAU,UACLtI,EAAO,IACd,OAAOA,GAGXuI,eAAgB,SAAU1K,GACtB,MAAM2K,KACN,IAAK,IAAIlF,KAAOzF,EACZ2K,EAAIA,EAAI1K,QAAU2K,mBAAmBnF,GAAO,IAAMmF,mBAAmB5K,EAAIyF,IAE7E,OAAOkF,EAAIjM,KAAK,KAAKgB,QAAQ,OAAQ,MAGzCmL,YAAa,SAAUjO,EAAG4N,GAEtB,IADA,IAAIxE,EAAMpJ,EAAEqD,OACL+F,GAAK,CACRpJ,EAAEoJ,GAAOpJ,EAAEoJ,EAAM,GACjBA,IAEJpJ,EAAE,GAAK4N,GAGXM,SACIC,UAAW,SAAUtF,GACjB,OAAOxJ,GAAG+O,OAAOvF,IAErBwF,UAAW,SAAUxF,EAAK1G,EAAOM,GAC7B,OAAOpD,GAAG+O,OAAOvF,EAAK1G,EAAOM,IAEjC6L,cAAe,SAAUzF,GAQrB,OANI0F,cAAgBA,wBAAwBC,QAC/BD,aAAaE,QAAQ5F,GAGrBxJ,GAAGO,KAAKsO,QAAQC,UAAUtF,IAI3C6F,cAAe,SAAU7F,EAAK1G,GAC1B,GAAIoM,cAAgBA,wBAAwBC,aAC1BxJ,IAAV7C,EACAoM,aAAaI,WAAW9F,GAGxB0F,aAAaK,QAAQ/F,EAAK1G,QAK9B,QAAc6C,IAAV7C,EAAqB,CACrB,IAAI0M,EAAS,IAAIC,KACjBD,EAAOE,QAAQF,EAAOG,UAAY,GAClC3P,GAAGO,KAAKsO,QAAQG,UAAUxF,EAAK,IAAMoG,QAASJ,SAG9CxP,GAAGO,KAAKsO,QAAQG,UAAUxF,EAAK1G,GAGvC,OAAO0G,GAEXqG,qBAAsB,SAAUrG,GAQ5B,OANIsG,gBAAkBA,0BAA0BX,QACnCW,eAAeV,QAAQ5F,GAGvBxJ,GAAGO,KAAKsO,QAAQC,UAAUtF,IAI3CuG,qBAAsB,SAAUvG,EAAK1G,GACjC,GAAIgN,gBAAkBA,0BAA0BX,aAC9BxJ,IAAV7C,EACAgN,eAAeR,WAAW9F,GAG1BsG,eAAeP,QAAQ/F,EAAK1G,QAKhC,QAAc6C,IAAV7C,EAAqB,CACrB,IAAI0M,EAAS,IAAIC,KACjBD,EAAOE,QAAQF,EAAOG,UAAY,GAClC3P,GAAGO,KAAKsO,QAAQG,UAAUxF,EAAK,IAAMoG,QAASJ,SAG9CxP,GAAGO,KAAKsO,QAAQG,UAAUxF,EAAK1G,GAGvC,OAAO0G,IAGfwG,cAAe,WACX,QAAI,0BAA0BlK,KAAKmK,UAAUC,YAClC,IAAItN,OAAOuN,OAAOC,KAIjC/M,SAAU,WACN,IAAIgN,EAAK5K,OAAOwK,UAAUC,UAEtBI,EAAOD,EAAGlK,QAAQ,SACtB,GAAImK,EAAO,EAEP,OAAOC,SAASF,EAAGpC,UAAUqC,EAAO,EAAGD,EAAGlK,QAAQ,IAAKmK,IAAQ,IAInE,GADcD,EAAGlK,QAAQ,YACX,EAAG,CAEb,IAAIqK,EAAKH,EAAGlK,QAAQ,OACpB,OAAOoK,SAASF,EAAGpC,UAAUuC,EAAK,EAAGH,EAAGlK,QAAQ,IAAKqK,IAAM,IAK/D,IAAIC,EAAOJ,EAAGlK,QAAQ,SACtB,OAAIsK,EAAO,GAEAF,SAASF,EAAGpC,UAAUwC,EAAO,EAAGJ,EAAGlK,QAAQ,IAAKsK,IAAQ,KAMvEC,aAAc,WACV,OAAOjL,OAAOkL,QAGlBC,aAAc,WACV,QAASX,UAAUC,UAAU7J,MAAM,6BAEvCwK,YAAa,WACT,GAAIC,UAAUC,GAAG,qBAAuBD,UAAUC,GAAG,kBACjD,OAAO,EACX,GAAID,UAAUC,GAAG,sBAAwBD,UAAUC,GAAG,kBAAmB,CAuBrE,QAtBgB,WAEZ,IAEIC,EAFAD,EAAK,iBACLE,GAASH,UAAUI,MAGnB,eAAgBzL,QAEhBuL,EAAWvL,OAAO0L,WAAWJ,IAGhBK,QAAUL,IAGnBE,EAAQD,EAASK,SAGhBC,QAAQC,IAAI,4BAErB,OAAON,EAGPO,GAIR,QAAKV,UAAUC,GAAG,sBAAuBD,UAAUC,GAAG,qBAElDD,UAAUC,GAAG,qBAEZD,UAAUI,YAAf,IAGJO,cAAe,WACX,OAAOxB,UAAUC,UAAU7J,MAAM,aAErCqL,iBAAkB,WACd,OAAOzB,UAAUC,UAAU7J,MAAM,gBAErCsL,UAAW,WACP,OAAO1B,UAAUC,UAAU7J,MAAM,sBAErCuL,oBAAqB,WACjB,OAAO3B,UAAUC,UAAU7J,MAAM,cAErCwL,aAAc,WACV,OAAQ7R,GAAGO,KAAKkR,iBAAmBzR,GAAGO,KAAKoR,aAAe3R,GAAGO,KAAKqR,uBAAyB5R,GAAGO,KAAKmR,oBAEvGI,WAAY,WACHrM,OAAOsM,UACR/R,GAAGgS,WAAWhS,GAAGiS,YAAcjS,GAAGsG,OAAOtB,IAAIkN,WAGjD,IACIC,GADS,IAAIJ,UACID,aACrB,OAASpN,KAAMyN,EAAQzN,KAAM0N,QAASD,EAAQE,QAElDC,qBAAsB,SAAUC,EAAYC,GAKxC,IAJA,IAAIC,EAAaD,EAASrM,QAAQ,KAC9BuM,EAAMF,EAASvK,OAAOwK,EAAa,GACnCE,EAAQJ,EAAWK,uBAAuB,IAAKF,GAE1CtR,EAAI,EAAGA,EAAIuR,EAAM3O,OAAQ5C,IAC9B,GAAIuR,EAAMvR,GAAGoR,UAAYA,EACrB,OAAOG,GAInBE,iBAAkB,SAAU7N,EAAK8N,GAC7B,IAAKA,EACD,OAAO9N,EAEX,IAAI+N,EAAQzO,OAAO0O,KAAKF,GAAYvQ,IAAI,SAAUiH,GAC9C,OAAOmF,mBAAmBnF,GAAO,KAAOsJ,EAAWtJ,GAAOmF,mBAAmBmE,EAAWtJ,IAAQ,MACjG/G,KAAK,KAEJwQ,EAAWjO,EAAIlE,MAAM,KACzB,GAAImS,EAASjP,QAAU,EAAG,CAEtB,IAAIkP,EAASD,EAAS,GAAGnS,MAAM,SAC/BoS,EAAO/I,KAAK4I,GAGZ,OADA/N,EAAMiO,EAAS,GAAK,IAAMC,EAAOzQ,KAAK,KAItC,IADAwQ,EAAWjO,EAAIlE,MAAM,MACRkD,QAAU,EAAG,CACtBiP,EAASjS,QAET,OADAgE,EAAMiO,EAAS,GAAK,IAAMF,EAAQ,IAAME,EAASxQ,KAAK,KAKtD,OADAuC,EAAMA,EAAM,IAAM+N,GAK9BI,mBAAoB,SAAUnO,EAAKoO,GAC/B,IAAIH,EAAWjO,EAAIlE,MAAM,KACzB,GAAImS,EAASjP,QAAU,EAAG,CAMtB,IAJA,IAAIqP,EAAS1E,mBAAmByE,EAAUvS,eAAiB,IACvDyS,EAAOL,EAAS,GAAGpS,cAAcC,MAAM,SAGlCM,EAAIkS,EAAKtP,OAAQ5C,KAAM,IAEY,IAApCkS,EAAKlS,GAAG8G,YAAYmL,EAAQ,IAC5BC,EAAKC,OAAOnS,EAAG,GAKvB,OADA4D,EAAMiO,EAAS,GAAK,IAAMK,EAAK7Q,KAAK,KAGpC,OAAOuC,GAIfwO,UAAW,SAAUC,EAAarQ,GAC9BA,EAAUA,MAEVqQ,EAAYC,QAAS,EACrBlM,EAAEiM,GAAaE,OAAO,IAAK,WACnBlO,OAAO+B,GAAKiM,aAAuBjM,IACnCiM,EAAcA,EAAYG,IAAI,IAElC,MAAMC,EAAcJ,EAAYK,iBAAiB,mBACjD,GAAID,GAAeA,EAAY7P,OAAS,EACpC,IAAK,IAAI5C,EAAI,EAAGA,EAAIyS,EAAY7P,OAAQ5C,IAAK,CACzC,IAAI2S,EAAgB3P,EAAmBwP,IAAIC,EAAYzS,IACvD,GAAI2S,EACA3P,EAAmB4P,OAAOH,EAAYzS,QAErC,CACD2S,EAAgB,SAAU5S,GACtBA,EAAE8S,kBACF,OAAOjU,GAAGO,KAAK2T,WAAW9Q,EAAQ2Q,cAAe5S,EAAEgT,SAEvD/P,EAAmBgQ,IAAIP,EAAYzS,GAAI2S,GAE3C3P,EAAmBgQ,IAAIP,EAAYzS,GAAI2S,GACvCF,EAAYzS,GAAGiT,iBAAiB,QAASN,GACrCvM,EAAE7C,WAAWvB,EAAQkR,eACrBlR,EAAQkR,mBAO5BJ,WAAY,SAAUK,EAAUJ,GAE5B,MAAMK,EAAO,SAAUC,GACnBA,EAAMnM,MAAMC,QAAU,OACtBkM,EAAMC,cAAc,oBAAoBC,gBAAgB,UAG5D,IAAIF,EACJ,GAAIN,EAAQ,CACRM,EAAQN,EACR,KAAOM,IAAUA,EAAMpD,QAAQ,cAC3BoD,EAAQA,EAAM1L,cAGlByL,EAAKC,QAEL5I,MAAMpL,UAAUqL,QAAQtH,KAAK6C,SAASyM,iBAAiB,aAAc,SAAUW,GAC3ED,EAAKC,KAITF,GACAA,KAIRK,WAAY,SAAUC,GAClB,IAAItG,EAAMsG,EACV,IACItG,EAAMA,EAAIxF,eACFsI,QAAQ,eACZ9C,EAAIjG,MAAMC,QAAU,cAGrBgG,IAGXuG,MAAO,SAAUX,EAAQ/Q,GACrB,MAAM2R,EAAe,SAAUC,GAC3Bb,EAAOE,iBAAiB,YAAaW,EAASC,OAC9Cd,EAAOE,iBAAiB,aAAcW,EAASC,OAC/Cd,EAAOE,iBAAiB,UAAWW,EAAShH,KAC5CmG,EAAOE,iBAAiB,WAAYW,EAAShH,MAGjD,GAAgB,YAAZ5K,EAAuB,CACvB,MAAM4R,EAAW9Q,EAAc0P,IAAIO,GACnC,GAAIa,EAAU,CACVb,EAAOe,oBAAoB,YAAaF,EAASC,OACjDd,EAAOe,oBAAoB,aAAcF,EAASC,OAClDd,EAAOe,oBAAoB,UAAWF,EAAShH,KAC/CmG,EAAOe,oBAAoB,WAAYF,EAAShH,KAEpD,OAEC,GAAgB,WAAZ5K,EAAsB,CAC3B,MAAM4R,EAAW9Q,EAAc0P,IAAIO,GAC/Ba,GACAD,EAAaC,GAEjB,OAIJ,MAAMG,GADN/R,EAAUA,OACkB+R,aAAe,GACrCC,EAAmBhS,EAAQgS,kBAAoB,GAC/CC,EAAiBjS,EAAQiS,gBAAkB,IACjD,IAAIC,GAAqBtT,GAAM,EAAG6I,GAAM,GACpC0K,GAAmBvT,GAAM,EAAG6I,GAAM,GAClC2K,EAAY,EAGhB,MAoDMR,GACFC,MA1Be,SAAU9T,GACzB,GAdc,SAAUA,GACxB,GAAIiC,EAAQqS,QAER,IADA,IAAIlH,EAAMpN,EAAEgT,OACL5F,GAAOA,IAAQ4F,GAAQ,CAC1B,GAAI5F,EAAI8C,SAAW9C,EAAI8C,QAAQjO,EAAQqS,SACnC,OAAO,EAEXlH,EAAMA,EAAIgE,WAGlB,OAAO,EAIHmD,CAAUvU,GAAI,CACdA,EAAI,mBAAoBA,EAAIA,EAAEwU,eAAe,GAAKxU,EAClDmU,EAAiBtT,EAAIb,EAAEyU,MACvBN,EAAiBzK,EAAI1J,EAAE0U,MACvBL,GAAY,IAAI/F,MAAOqG,YAsB3B9H,IAlBa,SAAU7M,GACvB,GAAIqU,EAAW,CACXrU,EAAI,mBAAoBA,EAAIA,EAAEwU,eAAe,GAAKxU,EAClDoU,EAAevT,EAAIb,EAAEyU,MACrBL,EAAe1K,EAAI1J,EAAE0U,MAErB,IADc,IAAIpG,MAAOqG,UAAYN,GAClBH,EAAgB,CAC/B,MAAMd,EAAWnR,EA3CR,SAAU2S,EAAaC,GACxC,MAAMC,EAAKD,EAAUhU,EAAI+T,EAAY/T,EAC/BkU,EAAKF,EAAUnL,EAAIkL,EAAYlL,EAC/BsL,EAAMnT,KAAKoT,IAAIH,GACfI,EAAMrT,KAAKoT,IAAIF,GACrB,OAAIC,EAAME,GAAOF,EAAMhB,GAAekB,GAAOjB,EAClCa,EAAK,EAAI,OAAS,QAEzBI,EAAMF,GAAOE,EAAMlB,GAAegB,GAAOf,EAClCc,EAAK,EAAI,KAAO,OAEpB,OAgC0BI,CAAahB,EAAkBC,IACpDhB,GACAA,EAAS/P,KAAK2P,GAGtBqB,EAAY,KAQpBtR,EAAckQ,IAAID,EAAQa,GAC1BD,EAAaC,IAGjBuB,mBAAoB,SAAU7R,GAC1BA,EAAOA,EAAKjB,QAAQ,OAAQ,OAAOA,QAAQ,OAAQ,OACnD,IACI+S,EADQ,IAAIrG,OAAO,SAAWzL,EAAO,YAAa,KAClCkE,KAAKpC,SAAS8H,QAClC,OAAmB,OAAZkI,EAAmB,GAAKC,mBAAmBD,EAAQ,GAAG/S,QAAQ,MAAO,OAGhFiT,oBAAqB,SAAUtT,GAC3B,IAAI8C,EAAS,QAETyQ,GADJvT,EAAUA,OACeuT,YAAc,iBACnCC,EAAYxT,EAAQwT,WAAa,OAEjCC,EAAmB5G,UAAU6G,WAAa7G,UAAU6G,UAAU9S,OAAUiM,UAAU6G,UAAU,GAAK7G,UAAU8G,UAAY9G,UAAU+G,aACjIC,EAAOjX,GAAGO,KAAKgW,mBAAmBK,IAAc5W,GAAGO,KAAKsO,QAAQC,UAAU6H,IAAeE,EACzFK,EAAYD,EAAK9Q,QAAQ,KACzB+Q,GAAa,IACbD,EAAOA,EAAKhP,OAAO,EAAGiP,IAE1B,IAAIC,EAAiB,IAAI1H,MAAK,IAAIA,MAAOqG,UAAY,SACrD9V,GAAGO,KAAKsO,QAAQG,UAAU2H,EAAYM,GAAQrH,QAASuH,IAEvD,OAAQF,GACJ,IAAK,KACD/Q,EAAS,QACT,MACJ,IAAK,KACDA,EAAS,QACT,MACJ,QACIA,EAAS,QAGjB,OAAOA,GAGXkR,iBAAkB,SAAUC,GACxB,OAAQA,GAAY,IAAI5T,QAAQ,iBAAkB,MAGtD6T,aAAc,SAAUD,EAAUE,GAC9B,IAAIC,EAAOnQ,SAASI,cAAc,KAClC,QAAsB9B,IAAlB6R,EAAKC,SAAwB,CAC7B,IAAIzS,EAAM0S,IAAIC,gBAAgBJ,GAC9BC,EAAKI,aAAa,OAAQ5S,GAC1BwS,EAAKI,aAAa,WAAY5X,GAAGO,KAAK6W,iBAAiBC,IACvDG,EAAKlP,MAAMuP,WAAa,SACxBxQ,SAASqB,KAAKC,YAAY6O,GAC1BA,EAAKM,QACLzQ,SAASqB,KAAKM,YAAYwO,KAIlCO,aAAc,SAAUV,EAAU/M,EAAM0N,GACpC,IAAIT,EAAO,IAAIU,MAAMD,IAAS1N,KAAMA,IACpC+M,EAAWrX,GAAGO,KAAK6W,iBAAiBC,GAChCpH,UAAUiI,WACVjI,UAAUiI,WAAWX,EAAMF,GAE3BrX,GAAGO,KAAK+W,aAAaD,EAAUE,IAIvCY,gBAAiB,SAAUd,EAAU/M,EAAM8N,GAIvC,IAHA,IAAIC,EAASC,KAAKF,EAAQtX,MAAM,KAAK,IAEjCyX,KACKnX,EAAI,EAAGA,EAAIiX,EAAOrU,OAAQ5C,IAC/BmX,EAAMpO,KAAKkO,EAAOG,WAAWpX,IAEjC,IAAImW,EAAO,IAAIU,MAAM,IAAIQ,WAAWF,KAAWjO,KAAMA,IAErD+M,EAAWrX,GAAGO,KAAK6W,iBAAiBC,GAChCpH,UAAUiI,WACVjI,UAAUiI,WAAWX,EAAMF,GAE3BrX,GAAGO,KAAK+W,aAAaD,EAAUE,IAOvCmB,WAAY,SAAU1T,GAClB,OAAOhF,GAAG2Y,MACN3T,IAAK,uCACLgT,MAAQY,aAAc,2CAA4CC,QAAS7T,MAOnF8T,aAAc,SAAUC,GACpB,OAAOtT,OAAOuT,KAAKC,SAAStK,mBAAmBoK,MAMnDG,aAAc,SAAUH,GACpB,IAAI7S,EACJ,IACIA,EAASuQ,mBAAmB0C,OAAO1T,OAAO6S,KAAKS,KAEnD,MAAOK,GACHlT,EAAS,KAEb,OAAOA,GAGXmT,mBAAoB,SAAUC,GACtB9R,EAAE6D,QAAQiO,KACVA,EAAQA,EACH5W,MAAM,EAAG,GACT6W,OAAO,SAAUC,EAAMC,GACpB,MAAMV,EAAMU,EAAIlV,SAAS,IACzB,OAAOiV,EAAO,KAAKvL,UAAU,EAAG,EAAI8K,EAAI/U,QAAU+U,GACnD,MAEX,OAAOO,GAIXI,UAAW,SAAUC,EAAOC,EAAOC,EAAYC,GAG3C,IAFA,IAAI5T,KAEK9E,EAAI,EAAGA,EAAIuY,EAAM3V,OAAQ5C,IAAK,CAGnC,IAFA,IAAI2Y,EAAQJ,EAAMvY,GACd0I,GAAQ,EACHlI,EAAI,EAAGA,EAAIgY,EAAM5V,OAAQpC,IAC9B,GAAIiY,EAAWE,EAAOH,EAAMhY,IAAK,CAC7BkI,GAAQ,EACR,MAGJA,IAAUgQ,GACV5T,EAAOiE,KAAK4P,GAGpB,OAAO7T,GAEXH,YAAa,SAAUf,GAEnB,OAAK,oBAAoBc,KAAKd,IAEtB,mBAAmBc,KAAKd,IAIpCgV,OAAQ,SAAUL,EAAOC,EAAOC,GAC5B,OAAOjZ,KAAK8Y,UAAUC,EAAOC,EAAOC,GAAY,IAGpDI,YAAa,SAAUN,EAAOC,EAAOC,GACjC,OAAOjZ,KAAK8Y,UAAUC,EAAOC,EAAOC,GAAY,IAGpDK,aAAc,SAAUP,EAAOC,EAAOC,GAClC,OAAOjZ,KAAKqZ,YAAYL,EAAOD,EAAOE,IAG1CM,UAAW,SAAUC,EAAQC,GACzB,IAEIC,EAAO/W,UAAUS,OAAS,QAAsB2B,IAAjBpC,UAAU,GAAmBA,UAAU,IAFnD+G,KAAM,YAAaiQ,eAAgB,KAGtDjQ,EAAOgQ,EAAKhQ,KACZiQ,EAAiBD,EAAKC,eAEtBC,EAAUJ,EAAOK,WAAW,MAEhC,IAAKD,EACD,MAAO,GAGX,IAAIE,EAAQN,EAAOM,MACfC,EAASP,EAAOO,OAEhB3C,EAAOwC,EAAQI,aAAa,EAAG,EAAGF,EAAOC,GACzCE,EAAqBL,EAAQM,yBAEjC,GAAIT,EAAkB,CAElBG,EAAQM,yBAA2B,mBACnCN,EAAQO,UAAYV,EACpBG,EAAQQ,SAAS,EAAG,EAAGN,EAAOC,GAGlC,IAAIM,EAAYb,EAAOc,UAAU5Q,EAAMiQ,GAEvC,GAAIF,EAAkB,CAClBG,EAAQW,UAAU,EAAG,EAAGT,EAAOC,GAC/BH,EAAQY,aAAapD,EAAM,EAAG,GAC9BwC,EAAQM,yBAA2BD,EAGvC,OAAOI,GAGXI,aAAc,SAAU1T,EAAK2T,GAEzB,IAAIC,EAAe,SAAUC,GACzB,IAAIpB,EAAS/S,SAASI,cAAc,UAChCgU,EAAMrB,EAAOK,WAAW,MAC5BL,EAAOO,OAASa,EAAIb,OACpBP,EAAOM,MAAQc,EAAId,MACnBe,EAAIC,UAAUF,EAAK,EAAG,GAEtB,OAAOpB,GAGX,OAAO,IAAIuB,QAAQ,SAAUC,EAASC,GAClC,IAAIL,EAAM,IAAIM,MACdN,EAAIO,YAAc,YAClBP,EAAIQ,OAAS,WACT,IACIC,EADA7B,EAASmB,EAAaC,GAG1B,IACIS,EAAUjc,GAAGO,KAAK4Z,UAAUC,EAAQ,WAChC9P,KAAMgR,GAAgB,aACtBf,eAAgB,IAEpBqB,GAAUM,QAASD,EAAS7B,OAAQA,IACtC,MAAOhB,GACLoC,EAAI7T,IAAM3H,GAAGmc,QAAQxU,KAI7B6T,EAAIY,QAAU,SAAUhD,GACpB,IAAIiD,EAAM,IAAIC,eACdD,EAAIE,KAAK,MAAOvc,GAAGmc,QAAQxU,IAAM,GACjC0U,EAAIG,iBAAiB,eAAgB,qCAErCH,EAAII,aAAe,cACnBJ,EAAIL,OAAS,SAAU7a,GACnB,GAAoB,MAAhBP,KAAK8b,OAAgB,CAIrB,IAHA,IAAIC,EAAa,IAAIlE,WAAW7X,KAAKgc,UACjCxb,EAAIub,EAAW3Y,OACf6Y,EAAe,IAAIhR,MAAMzK,GACtBA,KACHyb,EAAazb,GAAKZ,OAAOsc,aAAaH,EAAWvb,IAErD,IAAI4W,EAAO6E,EAAapa,KAAK,IACzB6H,EAAO+R,EAAIU,kBAAkB,gBACjC,GAA8B,IAA1BzS,EAAKnE,QAAQ,SAAgB,CAC7BqV,EAAI7T,IAAM,QAAU2C,EAAO,WAAa7E,OAAOuT,KAAKhB,GACpDwD,EAAIQ,OAAS,WACT,IAAI5B,EAASmB,EAAaC,GAC1BS,QAAUjc,GAAGO,KAAK4Z,UAAUC,EAAQ,WAChC9P,KAAMgR,GAAgB,aACtBf,eAAgB,IAEpBqB,GAAUM,QAASD,QAAS7B,OAAQA,QAKpDiC,EAAIW,mBAAqB,WACE,IAAnBX,EAAIY,YACe,MAAfZ,EAAIK,QACJb,KAKZQ,EAAIa,QAGR1B,EAAI7T,IAAMA,EACV,GAAI6T,EAAI2B,eAA6BxX,IAAjB6V,EAAI2B,SAAwB,CAC5C3B,EAAI7T,IAAM,yEACV6T,EAAI7T,IAAMA,MAKtByV,gBAAiB,SAAU5B,EAAKF,GAC5B,IAUIlB,EAVe,SAAUoB,GACzB,IAAIpB,EAAS/S,SAASI,cAAc,UAChCgU,EAAMrB,EAAOK,WAAW,MAC5BL,EAAOO,OAASa,EAAIb,OACpBP,EAAOM,MAAQc,EAAId,MACnBe,EAAIC,UAAUF,EAAK,EAAG,GAEtB,OAAOpB,EAGEmB,CAAaC,GAG1B,IAKI,OAAS6B,OAJCrd,GAAGO,KAAK4Z,UAAUC,EAAQ,WAChC9P,KAAMgR,GAAgB,aACtBf,eAAgB,IAEMH,OAAQA,GACpC,MAAOhB,GACL,OAAO,OAIfkE,YAAa,SAAUlD,EAAQoB,EAAK+B,EAAUC,GAC1C,IAAIC,EAAYzd,GAAGO,KAAKmd,YAAYtD,GAChCI,EAAUiD,EAAUhD,WAAW,MAEnC,OAAO,IAAIkB,QAAQ,SAAUC,EAASC,GAClC,IAAI8B,EAAW,IAAI7B,MACnBN,EAAIO,YAAc,YAClB4B,EAAShW,IAAM6T,EACfmC,EAAS3B,OAAS,WACVwB,EACAhD,EAAQkB,UAAUiC,EAAUJ,EAASvb,GAAK,EAAGub,EAAS1S,GAAK,EAAG2S,EAAK9C,MAAO8C,EAAK7C,QAE/EH,EAAQkB,UAAUiC,EAAUJ,EAASvb,GAAK,EAAGub,EAAS1S,GAAK,GAE/D+Q,EAAQ6B,OAKpBC,YAAa,SAAUE,GAEnB,IAAIH,EAAYpW,SAASI,cAAc,UACnC+S,EAAUiD,EAAUhD,WAAW,MAGnCgD,EAAU/C,MAAQkD,EAAUlD,MAC5B+C,EAAU9C,OAASiD,EAAUjD,OAG7BH,EAAQkB,UAAUkC,EAAW,EAAG,GAGhC,OAAOH,GAGXI,wBAAyB,SAAUC,EAAUC,EAAWC,EAAUC,GAC9D,IAAIC,EAAQlb,KAAKmb,IAAIH,EAAWF,EAAUG,EAAYF,GAEtD,OAASrD,MAAOoD,EAAWI,EAAOvD,OAAQoD,EAAYG,IAG1DE,iBAAkB,SAAUC,EAAMC,GAC9B,SAASC,EAAIxc,GAAK,OAAQA,EAAI,GAAM,IAAMA,EAAIA,EAE9C,IAAIG,EAAI,IAAIuN,KAAK4O,GACjB,OAAQnc,EAAEsc,cAAeD,EAAIrc,EAAEuc,WAAa,GAAIF,EAAIrc,EAAEyN,YAAY+O,OAAOJ,GAAW,IAAKC,EAAIrc,EAAEyc,YAAaJ,EAAIrc,EAAE0c,cAAeL,EAAIrc,EAAE2c,mBAAqBpc,KAAK,KAIrKqc,cAAe,SAAU3c,GACrB,IAAI4c,GACAC,OAAK,IAAKC,OAAK,IAAKC,OAAK,IACzBC,OAAK,IAAKC,OAAK,IAAKC,OAAK,IACzBC,OAAK,IAAKC,OAAK,IAAKne,EAAK,IAAKoe,OAAK,IAAKC,OAAK,IAC7CC,OAAK,IAAKC,OAAK,IAAKC,OAAK,IAAKC,OAAK,IAAKC,OAAK,IAC7CC,OAAK,IAAKC,OAAK,KAEnB,OAAO7d,EAAEsB,QAAQ,8EAAyB,SAAU4C,GAChD,OAAO0Y,EAAU1Y,MAIzB4Z,iBAAkB,SAAUjb,EAAKgT,GAE7B,IAAIP,EAAW,SAAUzS,EAAKgT,GAC1B,MAAMkI,EAAW7Y,SAAS8Y,yBAC1B,IAAIC,EAAO/Y,SAASI,cAAc,QAClC2Y,EAAK5X,UAAUC,IAAI,wBACnB2X,EAAKxI,aAAa,SAAU,QAC5BwI,EAAKxI,aAAa,UAAW,cAC7BwI,EAAKxI,aAAa,UAAiC,IAAvB5X,GAAGO,KAAK8C,YAAwBrD,GAAGO,KAAK8C,YAAc,GAAKrD,GAAGmc,QAAQnX,GAAOA,GACzG,MAAMqb,EAAQhZ,SAASI,cAAc,SACrC4Y,EAAM7X,UAAUC,IAAI,yBACpB4X,EAAMzI,aAAa,OAAQI,EAAK/J,UAAU,EAAG+J,EAAK7R,QAAQ,OAC1Dia,EAAKzX,YAAY0X,GACjBH,EAASvX,YAAYyX,GACrB,MAAME,EAAUjZ,SAASyM,iBAAiB,UAE1C,IADA,IAAIyM,EACKnf,EAAI,EAAG2I,EAAMuW,EAAQtc,OAAQ5C,EAAI2I,EAAK3I,IAAK,CAChD,MAAMof,EAAgBF,EAAQlf,GAC9B,GAAIof,EAAcC,QAAQC,cAAgB1b,EAAK,CAC3Cub,EAASC,EACT,OAGR,IAAKD,EAAQ,EACTA,EAASlZ,SAASI,cAAc,WACzBa,MAAMuP,WAAa,SAC1B0I,EAAOjY,MAAMC,QAAU,OACvBgY,EAAOE,QAAQC,YAAc1b,EAC7BqC,SAASqB,KAAKC,YAAY4X,GAG9B,MAAMI,EAAUJ,EAAOK,gBACvBD,EAAQpE,OACRoE,EAAQE,MAAMT,EAAKU,WACnBH,EAAQI,QACRJ,EAAQjM,cAAc,SAAS5R,MAAQkV,EAAK/J,UAAU+J,EAAK7R,QAAQ,KAAO,GAE1E,OADAia,EAAOO,EAAQjM,cAAc,SAI7BsM,KACJ,GAAIxZ,EAAE6D,QAAQrG,GAEV,IADA,IAAIic,EAAejc,EACV5D,EAAI,EAAGA,EAAI6f,EAAajd,OAAQ5C,IACrC4f,EAAQ7W,KAAKsN,EAASwJ,EAAa7f,GAAG4D,IAAKic,EAAa7f,GAAG4W,YAI/DgJ,EAAQ7W,KAAKsN,EAASzS,EAAKgT,IAE/BgJ,EAAQlV,QAAQ,SAAUsU,GACtBA,EAAKc,WAETC,WAAW,WACP9Z,SAASyM,iBAAiB,yBAAyBhI,QAAQ,SAAUsU,GACjEA,EAAKrX,cAAcC,YAAYoX,MAEpC,MAGPgB,gBAAiB,SAAUC,EAAQ7e,EAAQ2C,EAAcmW,EAAcgG,GAC9D9Z,EAAE6D,QAAQgW,KACXA,GAAUA,IACd,IAAIE,EAAc,2KAElB,OAAQpc,EAAaiN,SACjB,IAAK,QACL,IAAK,QACDmP,GAAe,iFACf,MACJ,IAAK,QACDA,GAAe,yFAGvB,IAAK,IAAIngB,KAAK+D,EACuB,iBAArBA,EAAa/D,IAAoBA,EAAE+E,QAAQ,OAAS,GAAKhB,EAAa/D,GAAG+E,QAAQ,OAAS,IAClGob,GAAgBngB,EAAI,KAAO+D,EAAa/D,GAAK,MAGrD,IAAIogB,EAAQ,mBAAqBD,EAAYE,QAASC,WAAaJ,EAAW,oBAAsB,GAAKG,OAAQ,iBAAmBnG,EAAe,MAAS,IACxJqG,EAAY,GAEZC,EAAY,uBAAkD,UAAzBzc,EAAaiN,QAAsB,IAAM,IAAM,qCACxF5K,EAAEqa,KAAKR,EAAQ,SAAUxX,EAAO/G,GAC5B6e,GAAaC,EAAUH,QAASK,SAAUhf,EAAON,OAASA,EAASA,EAAOuf,QAAQ5c,EAAaiN,SAAW,OAG9G,OADAoP,GAASG,EAAY,qBAIzBK,iBAAkB,SAAUC,EAAS7P,GACjC,IAAI5P,EAAS,GACb,GAAI0f,OAAO7d,cAAc4d,GACrBzf,EAAS,mUACJif,QAASpO,OAAqB,UAAZjB,EAAsB,MAAQ,MAAQ+P,UAAaF,EAAQE,UAAWC,aAAgBH,EAAQG,aAAcC,MAASJ,EAAQI,aAGpJ,QAAQ,GACJ,KAAMJ,EACF,MACJ,KAAKza,EAAE6D,QAAQ4W,GACX,IAAIK,EAAc,gIAGKb,QAASc,YAAcN,EAAQ,GAAK,IAAMA,EAAQ,GAAKO,YAAcP,EAAQ,GAAK,IAAMA,EAAQ,KACvH,QAAQ,GACJ,IAAiB,UAAZ7P,EACL,IAAiB,UAAZA,EACD5P,GAAU,yBAA2B8f,EAAc,2BACnD,MACJ,IAAiB,UAAZlQ,EACD5P,GAAU,yBAA2B8f,EAAc,2BAG3D,MACJ,KAAKL,aAAmBjiB,GAAGyiB,QACvB,QAAQ,GACJ,IAAiB,UAAZrQ,EACL,IAAiB,UAAZA,EACD5P,GAAU,oEAAsExC,GAAGO,KAAKmiB,iBAAiBT,EAAS,OAAS,iCAC3H,MACJ,IAAiB,UAAZ7P,EACD5P,GAAU,wEAA0ExC,GAAGO,KAAKmiB,iBAAiBT,EAAS,OAAS,iCAIvI,MACJ,QACIjiB,GAAGoZ,MAAM,6BAKrB,OAAO5W,GAGXkgB,iBAAkB,SAAUT,EAASU,GAEjC,IAAIC,EAAoB,SAAU7X,GAC9B,IAAI7E,EACJ,GAAgC,IAA5Byc,EAAWxc,QAAQ,KAAY,CAC/BD,EAAS6E,EAAOxG,WAChB,KAAO2B,EAAOC,QAAQ,MAAQ,GAC1BD,EAASA,EAAOzC,QAAQ,IAAK,SAGhC,CACDyC,EAAS6E,EACTmX,OAAOL,KAAK3b,EAAQ,SAAU9E,EAAGyhB,GAAQ,OAAOA,EAAKpgB,KAAK,OAAQA,KAAK,KAE3E,OAAOyD,GAGX,OAAQyc,GACJ,IAAK,QACD,MACJ,IAAK,MACD,QAAQ,GACJ,KAAK3iB,GAAGiiB,QAAQa,UAAYb,aAAmBjiB,GAAGiiB,QAAQa,SACtD,MAAO,iDACHF,EAAkBX,EAAQc,UAC1B,kCAGR,QACI,MAAO,4EACHH,EAAkBX,EAAQc,SAAS,IACnC,+DAGZ,MACJ,IAAK,MACL,QACI,QAAQ,GACJ,KAAK/iB,GAAGiiB,QAAQa,UAAYb,aAAmBjiB,GAAGiiB,QAAQa,SACtD,MAAO,oCACHF,EAAkBX,EAAQc,SAAS,IACnC,sCAER,QACI,MAAO,sEACHH,EAAkBX,EAAQc,SAAS,IACnC,6EAOxBC,gBAAiB,WACb,QAAI/S,UAAUgT,kBACNhT,UAAUgT,cAAcC,YAA2D,cAA7CjT,UAAUgT,cAAcC,WAAWC,QAUrFC,uBAAwB,SAAUnd,EAAKO,GACnC,IAAIN,EAAiC,IAAxBD,EAAIE,QAAQ,SAAuC,IAAtBF,EAAIE,QAAQ,MAClDC,GAAYF,GAAUD,EAAII,MAAMrG,GAAGsG,OAAOtB,IAAIuB,aAClD,GAAIH,EAAU,CACV,IAAIK,EAAYL,EAAS,GACzBF,GAAUO,GAAaD,EAASE,eAAyBf,GAAbc,IAA2BL,EAAS,IAAMI,EAASG,SAC/F,IAAIC,EAAQR,EAAS,GAAIS,EAAQL,EAASM,MAC7B,IAATF,GAAyB,KAAVA,GAAyB,MAATC,GAA2B,KAAVA,KAChDX,EAASA,GAAUU,GAASC,GAGpC,OAAOX,GAGXmd,eAAgB,SAAUpd,EAAKO,GAC3B,GAAIP,EAAII,MAAM,YACV,OAAO,EAEX,IAAIid,EAAgB,kBAChBC,EAActd,EAAII,MAAMid,GAC5B,GAAIC,GAAeA,EAAYvf,OAAS,EAAG,CACvC,IAAIwf,EAAmBhd,EAASH,MAAMid,GACtC,GAAIE,GAAoBA,EAAiBxf,OAAS,EAC9C,OAAOuf,EAAY,GAAG7Y,SAAW8Y,EAAiB,GAAG9Y,OAI7D,OAAO,GAGX+Y,gBAAiB,SAAUC,GACnB1jB,GAAG2jB,SACHrS,QAAQC,IAAImS,IAIpBE,oBAAqB,SAAUC,GAC3B,OAAO,SAAUljB,EAAGY,GAChB,OAAIZ,EAAEkjB,GAAYtiB,EAAEsiB,GACT,EAEPljB,EAAEkjB,GAAYtiB,EAAEsiB,IACR,EAEL,IAIfC,qBAAsB,SAAUnjB,EAAGY,GAG/B,IAFA,IAAIwiB,EAAM,EAED3iB,EAAI,EAAGA,EAAIT,EAAEqD,OAAQ5C,IACtBT,EAAEqjB,OAAO5iB,IAAMG,EAAEyiB,OAAO5iB,IACxB2iB,IAIR,OAAOA,GAGXE,eAAgB,SAAUC,GACtB,IAAI1M,EAAOnQ,SAASI,cAAc,KAClC+P,EAAK0M,KAAOA,EACZ,OAAO1M,EAAK0M,MAGhBC,gBAAiB,SAAUC,EAAYC,EAAUrM,EAAMzD,GACnD,OAAO,IAAIoH,QAAQ,SAAUC,EAASC,GAClC,IAAIyI,EAAS,WACLC,KAAKC,MAAMJ,IACXG,KAAKD,OAAOF,EAAYpM,EAAM,SAAUyM,EAAKC,GACzC,GAAID,EAAK,CACLzkB,GAAGoZ,MAAMqL,GACT5I,EAAO8I,MAAMF,QAEZ,CACGjd,EAAE7C,WAAW4P,IACbA,EAASmQ,GAEb9I,EAAQ8I,OAKxB1kB,GAAG4kB,eACEnf,OAAO8e,KACRvkB,GAAGgF,IAAI6f,WACP,WACI,GAAKN,KAAKC,MAAMJ,GAsBZE,SArBA,GAAwB,iBAAbD,EACPrkB,GAAG2Y,MACC3T,IAAKqf,EACLS,OAAQ,MACRrI,aAAc,SAEbsI,KAAK,SAAUC,GACZ,IAAIC,EAAMV,KAAKW,QAAQF,EAAMZ,GAC7BG,KAAKY,WAAWF,GAChBX,MAEHc,MAAM,SAAUX,GACbnT,QAAQC,IAAI,4BAA8BkT,UAGjD,GAAIjd,EAAE7C,WAAW0f,GAAW,CAC7BA,IACAC,UAWxBe,gBAAiB,SAAUthB,GACvB,MAAMuhB,EAASvhB,EAAIuhB,OACbC,EAAoB,SAAUhX,EAAK/D,EAAKkE,GAC1C,GAAIlH,EAAE6D,QAAQkD,GACVA,EAAIzC,QAAQyZ,OAEX,CACW,IAAR/a,IACAkE,EAAI,GAAKH,EAAM+W,EAAO,IAEd,IAAR9a,IACAkE,EAAI,GAAKH,EAAM+W,EAAO,MAIlCvhB,EAAIyhB,KAAK1Z,QAAQyZ,GACjB,OAAOxhB,EAAIyhB,MAGfC,qBAAsB,SAAUlX,GAC5B,OAAI/G,EAAE6D,QAAQkD,GACHA,EAAIhM,IAAIvC,GAAGO,KAAKklB,sBAEpBlX,GAGXmX,gBAAiB,SAAU3C,EAAU4C,GACjC,MAAML,GAAU1iB,OAAOgjB,UAAWhjB,OAAOgjB,WACnCC,EAAU9C,EAASxgB,IAAIvC,GAAGO,KAAKklB,sBAC/BK,EAAyB,SAAUvX,EAAK/D,GACtChD,EAAE6D,QAAQkD,GACVA,EAAIzC,QAAQga,GAGA,IAARtb,GAAa+D,EAAM+W,EAAO,GAC1BA,EAAO,GAAK/W,EAEC,IAAR/D,GAAa+D,EAAM+W,EAAO,KAC/BA,EAAO,GAAK/W,IAIxBsX,EAAQ/Z,QAAQga,GAEhB,MAAMC,EAAQ,SAAUC,GACpB,OAAOhjB,KAAK+iB,MAAMC,EAAML,GAAaA,GAEzCL,EAAO,GAAKS,EAAMT,EAAO,IACzBA,EAAO,GAAKS,EAAMT,EAAO,IACzB,MAAMW,EAA0B,SAAU1X,EAAK/D,EAAKkE,GAChD,GAAIlH,EAAE6D,QAAQkD,GACVA,EAAIzC,QAAQma,OAEX,CACW,IAARzb,IACAkE,EAAI,GAAKqX,EAAMxX,EAAM+W,EAAO,KAEpB,IAAR9a,IACAkE,EAAI,GAAKqX,EAAMxX,EAAM+W,EAAO,OAIxCO,EAAQ/Z,QAAQma,GAChB,OACIX,OAAQA,EACRE,KAAMK,KAIlBrlB,OAAOC,UAAUghB,OAAS,WACtB,IAAI1I,EAAMnY,KAAK2D,WACf,IAAKhB,UAAUS,OACX,OAAO+U,EACX,IACImN,EAAS,WADTA,SAAc3iB,UAAU,KACK,UAAY2iB,EAAQ3iB,UAAYA,UAAU,GAC3E,IAAK4iB,OAAOD,EACRnN,EAAMA,EAAItV,QAAQ0M,OAAO,MAAQgW,IAAM,MAAO,MAAOD,EAAKC,MAC9D,OAAOpN,GAEX,IAAIqN,EAAa,SAAUC,EAAOC,EAAMC,GACpC,OAAOA,EAAcF,EAAMG,wBAAyBF,EAAME,0BAE9Djf,YAAY9G,UAAUgmB,UAAY,SAAUC,GACxC,OAAON,EAAWxlB,KAAM8lB,EAAO,SAAUC,EAAOC,GAC5C,QACID,EAAME,IAAMD,EAAME,QAClBH,EAAMI,MAAQH,EAAMI,MACpBL,EAAMG,OAASF,EAAMC,KACrBF,EAAMK,KAAOJ,EAAMG,UAI/Bxf,YAAY9G,UAAUwmB,WAAa,SAAUP,GACzCN,EAAWxlB,KAAM8lB,EAAO,SAAUC,EAAOC,GACrC,QACID,EAAMK,MAAQJ,EAAMI,MACpBJ,EAAMI,KAAOL,EAAMjM,OACnBiM,EAAME,KAAOD,EAAMC,KACnBD,EAAMC,IAAMF,EAAMhM,WAI9BpT,YAAY9G,UAAUymB,OAAS,SAAUR,GACrC,OAAON,EAAWxlB,KAAM8lB,EAAO,SAAUC,EAAOC,GAC5C,OACMA,EAAMC,KAAOF,EAAME,KAASF,EAAME,KAAOD,EAAME,QAC/CF,EAAMC,KAAOF,EAAMG,QAAYH,EAAMG,QAAUF,EAAME,QACrDF,EAAMI,MAAQL,EAAMK,MAAUL,EAAMK,MAAQJ,EAAMG,OAClDH,EAAMI,MAAQL,EAAMI,OAAWJ,EAAMI,OAASH,EAAMG,SAIlE,OAAOxmB","sourcesContent":["; var TC = TC || {};\r\n(function (root, factory) {\r\n    if (typeof exports === \"object\") { // CommonJS\r\n        module.exports = factory();\r\n    } else if (typeof define === \"function\" && define.amd) { // AMD\r\n        define([], factory);\r\n    } else {\r\n        root.Util = factory();\r\n    }\r\n})(TC, function () {\r\n\r\n    String.prototype.soundex = function () {\r\n        var a = this.toLowerCase().split('')\r\n        f = a.shift(),\r\n            r = '',\r\n            codes = {\r\n                a: '', e: '', i: '', o: '', u: '',\r\n                b: 1, f: 1, p: 1, v: 1,\r\n                c: 2, g: 2, j: 2, k: 2, q: 2, s: 2, x: 2, z: 2,\r\n                d: 3, t: 3,\r\n                l: 4,\r\n                m: 5, n: 5,\r\n                r: 6\r\n            };\r\n\r\n        r = f +\r\n            a\r\n                .map(function (v, i, a) { return codes[v] })\r\n                .filter(function (v, i, a) { return ((i === 0) ? v !== codes[f] : v !== a[i - 1]); })\r\n                .join('');\r\n\r\n        return (r + '000').slice(0, 4).toUpperCase();\r\n    }\r\n\r\n    // Polyfill para IE\r\n    Number.isInteger = Number.isInteger || function (value) {\r\n        return typeof value === \"number\" &&\r\n            isFinite(value) &&\r\n            Math.floor(value) === value;\r\n    };\r\n\r\n    // GLS: Parche: Chrome no formatea correctamente los números en euskera, establece como separador de decimales el (.)\r\n    var toLocaleString = Number.prototype.toLocaleString;\r\n    Number.prototype.toLocaleString = function (locale, options) {\r\n        if (locale == \"eu-ES\" && !TC.Util.detectIE()) {\r\n            var sNum = toLocaleString.apply(this, arguments);\r\n            sNum = sNum.replace(/\\,/g, '.')\r\n            if (!(Math.floor(this) == this && Number.isInteger(Math.floor(this))))\r\n                sNum = sNum.replace(/.([^.]*)$/, \",$1\");\r\n\r\n            return sNum;\r\n        }\r\n        else\r\n            return toLocaleString.apply(this, arguments);\r\n    }\r\n\r\n    var iconUrlCache = {};\r\n    var markerGroupClassCache = {};\r\n\r\n    var path1 = [\"Capability\", \"Request\", \"GetMap\", \"DCPType\", \"0\", \"HTTP\", \"Get\", \"OnlineResource\"];\r\n    var path2 = [\"OperationsMetadata\", \"GetTile\", \"DCP\", \"HTTP\", \"Get\", \"0\", \"href\"];\r\n    var getOnPath = function (obj, p, i) {\r\n        if (i < p.length - 1) {\r\n            if (obj.hasOwnProperty(p[i]))\r\n                return getOnPath(obj[p[i]], p, ++i);\r\n            else return null;\r\n        } else {\r\n            return obj[p[i]];\r\n        }\r\n    };\r\n\r\n    const swipeHandlers = new WeakMap();\r\n    const modalCloseHandlers = new WeakMap();\r\n\r\n    var Util = {\r\n\r\n        isPlainObject: function (obj) {\r\n            return Object.prototype.toString.call(obj) === '[object Object]';\r\n        },\r\n\r\n        isEmptyObject: function (obj) {\r\n            var name;\r\n            for (name in obj) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n\r\n        isFunction: function (obj) {\r\n            return typeof obj === 'function';\r\n        },\r\n\r\n        getMapLocale: function (map) {\r\n            return map.options && map.options.locale && map.options.locale.replace('_', '-') || \"es-ES\";\r\n        },\r\n\r\n        regex: {\r\n            PROTOCOL: /(^https?:)/i\r\n        },\r\n\r\n        isOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            if (withProtocol) {\r\n                if (TC.capabilities[testUrl])\r\n                    return url;\r\n            } else {\r\n                for (var c in TC.capabilities) {\r\n                    if (c.replace(TC.Util.regex.PROTOCOL, \"\") == testUrl)\r\n                        return c;\r\n                }\r\n            }\r\n\r\n            for (c in TC.capabilities) {\r\n                var u = getOnPath(TC.capabilities[c], path1, 0) || getOnPath(TC.capabilities[c], path2, 0);\r\n\r\n                if (u && withProtocol && url == u) return u;\r\n                else if (u && url.replace(TC.Util.regex.PROTOCOL, \"\") == u.replace(TC.Util.regex.PROTOCOL, \"\")) return u;\r\n            }\r\n\r\n            return url;\r\n        },\r\n\r\n        reqGetMapOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            var _get = function (caps) {\r\n                var u = getOnPath(caps, path1, 0) || getOnPath(caps, path2, 0);\r\n                if (u)\r\n                    return !withProtocol ? u.split('?')[0].replace(TC.Util.regex.PROTOCOL, \"\") : u.split('?')[0];\r\n\r\n                return null;\r\n            };\r\n            if (TC.capabilities[url]) {\r\n                return _get(TC.capabilities[url]);\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        getFNFromString: function (fnName) {\r\n            var scope = window;\r\n            var scopeSplit = fnName.split('.');\r\n            for (i = 0; i < scopeSplit.length - 1; i++) {\r\n                scope = scope[scopeSplit[i]];\r\n\r\n                if (scope == undefined) return;\r\n            }\r\n\r\n            return scope[scopeSplit[scopeSplit.length - 1]];\r\n        },\r\n\r\n        isURL: function (text) {\r\n            return /^(http|https|ftp|mailto)\\:\\/\\//i.test(text);\r\n        },\r\n\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        isSameOrigin: function (uri) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var location = window.location;\r\n                var uProtocol = urlParts[1];\r\n                result =\r\n                    (uProtocol == location.protocol || uProtocol == undefined) &&\r\n                    urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        formatNumber: function (value, locale) {\r\n            var t = typeof value;\r\n            if (t === 'number') {\r\n                return value.toLocaleString(locale);\r\n            }\r\n            else if (t === 'string') {\r\n                n = parseFloat(value);\r\n                if (n === new Number(value).valueOf()) {\r\n                    return n.toLocaleString(locale);\r\n                }\r\n            }\r\n            return value;\r\n        },\r\n\r\n        addProtocol: function (uri) {\r\n            var result = uri;\r\n            if (uri && uri.indexOf('//') === 0) {\r\n                result = location.protocol + uri;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * getDiv: returns HTML element or null if the parameter is invalid\r\n        * Parameter: string with element ID or HTML element\r\n        */\r\n        getDiv: function (div) {\r\n            var result;\r\n            if (typeof div === 'string') {\r\n                result = document.getElementById(div);\r\n            }\r\n            else if (div instanceof HTMLElement) {\r\n                result = div;\r\n            }\r\n            else if ('$' in window && div instanceof $ && div.length) {\r\n                result = div[0];\r\n            }\r\n            else {\r\n                result = document.createElement('div');\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getScriptLocation: function () {\r\n            var src;\r\n            var script;\r\n            if (document.currentScript) {\r\n                script = document.currentScript;\r\n            }\r\n            else {\r\n                var scripts = document.getElementsByTagName('script');\r\n                script = scripts[scripts.length - 1];\r\n            }\r\n            src = script.getAttribute('src');\r\n            if (src) {\r\n                return src.substr(0, src.lastIndexOf('/') + 1);\r\n            }\r\n            return \"\";\r\n        },\r\n\r\n        /* \r\n        * getBackgroundUrlFromCss: devuelve la URL de background-image en CSS\r\n        * Parameter: string con nombre de clase\r\n        */\r\n        getBackgroundUrlFromCss: function (cssClass) {\r\n            var result = '';\r\n\r\n            if (cssClass) {\r\n                if (iconUrlCache[cssClass] !== undefined) {\r\n                    result = iconUrlCache[cssClass];\r\n                }\r\n                else {\r\n                    const iconDiv = document.createElement('div');\r\n                    iconDiv.style.display = 'none';\r\n                    iconDiv.classList.add(cssClass);                    \r\n                    document.body.appendChild(iconDiv);                    \r\n                    // The regular expression is nongreedy (.*?), otherwise in FF and IE it gets 'url_to_image\"'\r\n                    var match = /^url\\(['\"]?(.*?)['\"]?\\)$/gi.exec(window.getComputedStyle(iconDiv, null).backgroundImage);\r\n                    if (match && match.length > 1) {\r\n                        result = match[match.length - 1];\r\n                    }\r\n                    iconDiv.parentElement.removeChild(iconDiv);\r\n                    iconUrlCache[cssClass] = result;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getPointIconUrl: function getPointIconUrl(options) {\r\n            var result = null;\r\n            if (options.url) {\r\n                result = options.url;\r\n            }\r\n            else {\r\n                var className;\r\n                if (typeof options.cssClass === 'string') {\r\n                    className = options.cssClass;\r\n                }\r\n                else {\r\n                    var classes = options.classes || TC.Cfg.styles.marker.classes;\r\n                    className = classes[0];\r\n                    if (options.group) {\r\n                        if (markerGroupClassCache[options.group] === undefined) {\r\n                            var i = 0;\r\n                            for (var key in markerGroupClassCache) {\r\n                                i++;\r\n                            }\r\n                            i = i % classes.length;\r\n                            markerGroupClassCache[options.group] = classes[i];\r\n                        }\r\n                        className = markerGroupClassCache[options.group];\r\n                    }\r\n                }\r\n                result = TC.Util.getBackgroundUrlFromCss(className);\r\n            }\r\n            if (!result && options !== TC.Cfg.styles.point && options.cssClass !== '') {\r\n                result = getPointIconUrl(TC.Cfg.styles.point);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * addPathToTree: añade a un array a un árbol, cada elemento en un nivel anidado\r\n        * Parameters: array, nodo de árbol, [índice]\r\n        * Returns: último nodo insertado, null si ya existía la ruta\r\n        */\r\n        addArrayToTree: function addArrayToTree(path, treeNode, index) {\r\n            var result = null;\r\n            var found = false;\r\n            index = index || 0;\r\n            var name = path[index];\r\n            if (name) {\r\n                var n;\r\n                for (var i = 0, len = treeNode.children.length; i < len; i++) {\r\n                    n = treeNode.children[i];\r\n                    if (n.name === name) {\r\n                        found = true;\r\n                        var r = addArrayToTree(path, n, index + 1);\r\n                        if (r) {\r\n                            result = r;\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (!found) {\r\n                    n = { name: name, title: name, uid: '/' + path.slice(0, index + 1).join('/'), children: [] };\r\n                    treeNode.children.push(n);\r\n                    result = n;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        parseCoords: function (text) {\r\n            var result = null;\r\n\r\n            var _parseGeoCoord = function (text) {\r\n                var t = text;\r\n                var result = {};\r\n                result.type = TC.Consts.GEOGRAPHIC;\r\n                var idx = t.indexOf('\\u00B0');\r\n                result.value = parseFloat(t.substr(0, idx));\r\n                t = t.substr(idx + 1);\r\n                idx = t.indexOf('\\'');\r\n                if (idx >= 0) {\r\n                    var v = parseFloat(t.substr(0, idx)) / 60;\r\n                    if (result.value >= 0) {\r\n                        result.value += v;\r\n                    }\r\n                    else {\r\n                        result.value -= v;\r\n                    }\r\n                    t = t.substr(idx + 1);\r\n                    idx = t.indexOf('\\'');\r\n                    if (idx >= 0) {\r\n                        v = parseFloat(t.substr(0, idx).replace(',', '.')) / 3600;\r\n                        if (result.value >= 0) {\r\n                            result.value += v;\r\n                        }\r\n                        else {\r\n                            result.value -= v;\r\n                        }\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n\r\n            var _parseCoord = function (text) {\r\n                var t = $.trim(text);\r\n                // nnºnn'nn''N\r\n                if (t.match(/^1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?\\s*[NnSsWwOoEe]$/g)) {\r\n                    switch (t[t.length - 1]) {\r\n                        case 'S':\r\n                        case 's':\r\n                        case 'W':\r\n                        case 'w':\r\n                        case 'O':\r\n                        case 'o':\r\n                            t = '-' + t;\r\n                            break;\r\n                    }\r\n                    t = t.substr(0, t.length - 1);\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // +nnºnn'nn''\r\n                if (t.match(/^[+-]?1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?$/g)) {\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // nn.nn N\r\n                if (t.match(/^1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?\\s*[NnSsWwOoEe]$/g)) {\r\n                    var result = { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.substr(0, t.length - 1).replace(',', '.')) };\r\n                    if (t.match(/[SsWwOo]$/)) {\r\n                        result.value = -result.value;\r\n                    }\r\n                    return result;\r\n                }\r\n                // +nn.nn\r\n                if (t.match(/^[+-]?1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?$/g)) {\r\n                    return { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                // UTM\r\n                if (t.match(/^\\d{6,7}([.,]\\d+)?$/g)) {\r\n                    return { type: TC.Consts.UTM, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                return null;\r\n            };\r\n\r\n            text = $.trim(text).toUpperCase();\r\n            var xy = text.split(',');\r\n            if (xy.length === 4) {\r\n                xy = [xy.slice(0, 1).join('.'), xy.slice(2, 3).join('.')];\r\n            }\r\n            else if (xy.length === 1 || xy.length === 3) {\r\n                xy = text.split(' ');\r\n            }\r\n            if (xy.length === 2) {\r\n                var x = _parseCoord(xy[0]);\r\n                var y = _parseCoord(xy[1]);\r\n                if (x !== null && y !== null) {\r\n                    result = [x, y];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        reproject: function (coords, sourceCrs, targetCrs) {\r\n            var result;\r\n            var multipoint = true;\r\n            var multiring = true;\r\n            var multipoly = true;\r\n            if ($.isArray(coords[0])) {\r\n                if ($.isArray(coords[0][0])) {\r\n                    if (!$.isArray(coords[0][0][0])) {\r\n                        multipoly = false;\r\n                        coords = [coords];\r\n                    }\r\n                }\r\n                else {\r\n                    multiring = false;\r\n                    coords = [[coords]];\r\n                }\r\n            }\r\n            else {\r\n                multipoint = false;\r\n                multiring = false;\r\n                multipoly = false;\r\n                coords = [[[coords]]];\r\n            }\r\n            TC.loadProjDef({ crs: sourceCrs, sync: true });\r\n            TC.loadProjDef({ crs: targetCrs, sync: true });\r\n            var sourcePrj = new Proj4js.Proj(sourceCrs);\r\n            var targetPrj = new Proj4js.Proj(targetCrs);\r\n            result = new Array(coords.length);\r\n            coords.forEach(function (poly, pidx) {\r\n                const rp = result[pidx] = [];\r\n                poly.forEach(function (ring, ridx) {\r\n                    const rr = rp[ridx] = [];\r\n                    ring.forEach(function (coord, cidx) {\r\n                        var point = Proj4js.transform(sourcePrj, targetPrj, { x: coord[0], y: coord[1] });\r\n                        rr[cidx] = [point.x, point.y];\r\n                        if (coord.length > 2) {\r\n                            rr[cidx][2] = coord[2];\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            if (!multipoint) {\r\n                result = result[0][0][0];\r\n            }\r\n            else if (!multiring) {\r\n                result = result[0][0];\r\n            }\r\n            else if (!multipoly) {\r\n                result = result[0];\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getMetersPerDegree: function (extent) {\r\n            var result = undefined;\r\n            var R = 6370997; // m\r\n            var toRad = function (number) {\r\n                return number * Math.PI / 180;\r\n            };\r\n            if ($.isArray(extent) && extent.length >= 4) {\r\n                var dLat = this.degToRad(extent[3] - extent[1]);\r\n                var sindlat2 = Math.sin(dLat / 2);\r\n                var a = sindlat2 * sindlat2;\r\n                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n                result = R * c / (extent[3] - extent[1]);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        radToDeg: function (rad) { // convert radians to degrees\r\n            return rad * 180 / Math.PI;\r\n        },\r\n        degToRad: function (deg) { // convert degrees to radians\r\n            return deg * Math.PI / 180;\r\n        },\r\n        mod: function (n) { // modulo for negative values\r\n            return ((n % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);\r\n        },\r\n\r\n        getCRSCode: function (crs) {\r\n            var result = null;\r\n            crs = crs.trim();\r\n            if (/^EPSG:\\d{4,6}$/g.test(crs) || //formato EPSG\r\n                /^urn:ogc:def:crs:EPSG:.*:\\d{4,6}/g.test(crs) || // formato URN\r\n                /http:\\/\\/www.opengis.net\\/gml\\/srs\\/epsg.xml#\\d{4,6}$/g.test(crs)) { // formato GML\r\n                var match = crs.trim().match(/^.+[:#](\\d{4,6})$/); // devuelve la parte numérica del código\r\n                if (match) {\r\n                    result = match[1];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        CRSCodesEqual: function (crs1, crs2) {\r\n            if (crs1 === crs2) {\r\n                return true;\r\n            }\r\n            var code1 = this.getCRSCode(crs1);\r\n            var code2 = this.getCRSCode(crs2);\r\n            return code1 !== null && code2 !== null && code1 === code2;\r\n        },\r\n\r\n        getLocaleString: function (locale, key, texts) {\r\n            var result = key;\r\n            if (TC.i18n && TC.i18n[locale]) {\r\n                var text = TC.i18n[locale][key];\r\n                if (text) {\r\n                    result = text;\r\n                    if (texts) {\r\n                        for (var k in texts) {\r\n                            result = result.replace('{' + k + '}', texts[k]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getSimpleMimeType: function (mimeType) {\r\n            var result = '';\r\n            if (mimeType) {\r\n                var end = mimeType.indexOf(';');\r\n                if (end > 0) {\r\n                    mimeType = mimeType.substring(0, end);\r\n                }\r\n                result = mimeType;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getQueryStringParams: function (url) {\r\n            var queryString;\r\n            if (url) {\r\n                var queryIdx = url.indexOf('?');\r\n                if (queryIdx >= 0) {\r\n                    queryString = url.substr(queryIdx);\r\n                    var fragmentIdx = queryString.indexOf('#');\r\n                    if (fragmentIdx >= 0) {\r\n                        queryString = queryString.substr(0, fragmentIdx)\r\n                    }\r\n                }\r\n                else {\r\n                    queryString = '?';\r\n                }\r\n            }\r\n            else {\r\n                queryString = location.search;\r\n            }\r\n            var result = $.map(queryString.replace(/(^\\?)/, '').split(\"&\"), function (elm) {\r\n                return elm = elm.split(\"=\"), this[elm[0]] = elm[1], this\r\n            }.bind({}))[0];\r\n            delete result[''];\r\n            return result;\r\n        },\r\n\r\n        getParamString: function (obj) {\r\n            const arr = [];\r\n            for (var key in obj) {\r\n                arr[arr.length] = encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]);\r\n            }\r\n            return arr.join('&').replace(/%20/g, '+');\r\n        },\r\n\r\n        fastUnshift: function (a, elm) {\r\n            var len = a.length;\r\n            while (len) {\r\n                a[len] = a[len - 1];\r\n                len--;\r\n            }\r\n            a[0] = elm;\r\n        },\r\n\r\n        storage: {\r\n            getCookie: function (key) {\r\n                return TC.cookie(key);\r\n            },\r\n            setCookie: function (key, value, options) {\r\n                return TC.cookie(key, value, options);\r\n            },\r\n            getLocalValue: function (key) {\r\n                var result = null;\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    result = localStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setLocalValue: function (key, value) {\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        localStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        localStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            },\r\n            getSessionLocalValue: function (key) {\r\n                var result = null;\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    result = sessionStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setSessionLocalValue: function (key, value) {\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        sessionStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        sessionStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            }\r\n        },\r\n        detectFirefox: function () {\r\n            if (/Firefox[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) //test for Firefox/x.x or Firefox x.x (ignoring remaining digits);\r\n                return new Number(RegExp.$1); // capture x.x portion and store as a number\r\n            else\r\n                return false;\r\n        },\r\n        detectIE: function () {\r\n            var ua = window.navigator.userAgent;\r\n\r\n            var msie = ua.indexOf('MSIE ');\r\n            if (msie > 0) {\r\n                // IE 10 or older => return version number\r\n                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n            }\r\n\r\n            var trident = ua.indexOf('Trident/');\r\n            if (trident > 0) {\r\n                // IE 11 => return version number\r\n                var rv = ua.indexOf('rv:');\r\n                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n            }\r\n\r\n            // GLS: 13/02/2019. Comento lo que respecta a Edge, no tiene sentido meterlo en el mismo saco que un navegador obsoleto.\r\n            // No lo comento porque en la mesa no hay quorum.\r\n            var edge = ua.indexOf('Edge/');\r\n            if (edge > 0) {\r\n                // IE 12 => return version number\r\n                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n            }\r\n\r\n            // other browser\r\n            return false;\r\n        },\r\n        detectChrome: function () {\r\n            return window.chrome;\r\n\r\n        },\r\n        detectSafari: function () {\r\n            return !!navigator.userAgent.match(/Version\\/[\\d\\.]+.*Safari/);\r\n        },\r\n        detectMouse: function () {\r\n            if (Modernizr.mq('(pointer:coarse)') && Modernizr.mq('(pointer:fine)'))\r\n                return true;\r\n            if (Modernizr.mq('(pointer:coarse)') && !Modernizr.mq('(pointer:fine)')) {\r\n                var testHover = function () {\r\n                    //console.log('estamos en testHover');\r\n                    var mq = '(hover: hover)',\r\n                        hover = !Modernizr.touch, // fallback if mq4 not supported: no hover for touch\r\n                        mqResult;\r\n\r\n                    if ('matchMedia' in window) {\r\n                        //console.log('dispone de matchMedia');\r\n                        mqResult = window.matchMedia(mq);\r\n                        //console.log('resultado de window.matchMedia(mq): ' + mqResult.media);\r\n                        //console.log('mq: ' + mq);\r\n                        if (mqResult.media === mq) {\r\n                            //console.log('es igual');\r\n                            // matchMedia supports hover detection, so we rely on that\r\n                            hover = mqResult.matches;\r\n                            //console.log('va retornar: ' + hover);\r\n                        }\r\n                    } else { console.log('no dispone de matchMedia'); }\r\n\r\n                    return hover;\r\n                };\r\n\r\n                if (testHover())\r\n                    return true;\r\n                else return false;\r\n            }\r\n            if (!Modernizr.mq('(pointer:coarse)') && Modernizr.mq('(pointer:fine)'))\r\n                return true;\r\n            if (Modernizr.mq('(pointer:none)'))\r\n                return false;\r\n            if (!Modernizr.touch)\r\n                return true;\r\n        },\r\n        detectAndroid: function () {\r\n            return navigator.userAgent.match(/Android/i);\r\n        },\r\n        detectBlackBerry: function () {\r\n            return navigator.userAgent.match(/BlackBerry/i);\r\n        },\r\n        detectIOS: function () {\r\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n        },\r\n        detectMobileWindows: function () {\r\n            return navigator.userAgent.match(/IEMobile/i);\r\n        },\r\n        detectMobile: function () {\r\n            return (TC.Util.detectAndroid() || TC.Util.detectIOS() || TC.Util.detectMobileWindows() || TC.Util.detectBlackBerry());\r\n        },\r\n        getBrowser: function () {\r\n            if (!window.UAParser) {\r\n                TC.syncLoadJS(TC.apiLocation + TC.Consts.url.UA_PARSER);\r\n            }\r\n\r\n            var parser = new UAParser();\r\n            var browser = parser.getBrowser();\r\n            return { name: browser.name, version: browser.major };\r\n        },\r\n        getElementByNodeName: function (parentNode, nodeName) {\r\n            var colonIndex = nodeName.indexOf(\":\");\r\n            var tag = nodeName.substr(colonIndex + 1);\r\n            var nodes = parentNode.getElementsByTagNameNS(\"*\", tag);\r\n\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].nodeName == nodeName)\r\n                    return nodes;\r\n            }\r\n            return undefined;\r\n        },\r\n        addURLParameters: function (url, parameters) {\r\n            if (!parameters) {\r\n                return url;\r\n            }\r\n            var toAdd = Object.keys(parameters).map(function (key) {\r\n                return encodeURIComponent(key) + '=' + (parameters[key] ? encodeURIComponent(parameters[key]) : '');\r\n            }).join('&');\r\n\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var params = urlparts[1].split(/[&;]/g);\r\n                params.push(toAdd);\r\n\r\n                url = urlparts[0] + '?' + params.join('&');\r\n                return url;\r\n            } else {\r\n                urlparts = url.split('#');\r\n                if (urlparts.length >= 2) {\r\n                    urlparts.shift();\r\n                    url = urlparts[0] + '?' + toAdd + '#' + urlparts.join('#');\r\n                    return url;\r\n                }\r\n                else {\r\n                    url = url + '?' + toAdd;\r\n                    return url;\r\n                }\r\n            }\r\n        },\r\n        removeURLParameter: function (url, parameter) {\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var prefix = encodeURIComponent(parameter.toLowerCase()) + '=';\r\n                var pars = urlparts[1].toLowerCase().split(/[&;]/g);\r\n\r\n                //reverse iteration as may be destructive\r\n                for (var i = pars.length; i-- > 0;) {\r\n                    //idiom for string.startsWith\r\n                    if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                        pars.splice(i, 1);\r\n                    }\r\n                }\r\n\r\n                url = urlparts[0] + '?' + pars.join('&');\r\n                return url;\r\n            } else {\r\n                return url;\r\n            }\r\n        },\r\n\r\n        showModal: function (contentNode, options) {\r\n            options = options || {};\r\n\r\n            contentNode.hidden = false;\r\n            $(contentNode).fadeIn(250, function () {\r\n                if (window.$ && contentNode instanceof $) {\r\n                    contentNode = contentNode.get(0);\r\n                }\r\n                const closeButton = contentNode.querySelectorAll('.tc-modal-close');\r\n                if (closeButton && closeButton.length > 0) {\r\n                    for (var i = 0; i < closeButton.length; i++) {\r\n                        var closeCallback = modalCloseHandlers.get(closeButton[i]);\r\n                        if (closeCallback) {\r\n                            modalCloseHandlers.delete(closeButton[i]);\r\n                        }\r\n                        else {\r\n                            closeCallback = function (e) {\r\n                                e.stopPropagation();\r\n                                return TC.Util.closeModal(options.closeCallback, e.target);\r\n                            };\r\n                            modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                        }\r\n                        modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                        closeButton[i].addEventListener('click', closeCallback);\r\n                        if ($.isFunction(options.openCallback)) {\r\n                            options.openCallback();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        closeModal: function (callback, target) {\r\n\r\n            const hide = function (modal) {\r\n                modal.style.display = 'none';\r\n                modal.querySelector('.tc-modal-window').removeAttribute('style');\r\n            };\r\n\r\n            var modal;\r\n            if (target) {\r\n                modal = target;\r\n                while (modal && !modal.matches('.tc-modal')) {\r\n                    modal = modal.parentElement;\r\n                }\r\n\r\n                hide(modal);\r\n            } else {\r\n                Array.prototype.forEach.call(document.querySelectorAll('.tc-modal'), function (modal) {\r\n                    hide(modal);\r\n                });\r\n            }\r\n\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        },\r\n\r\n        closeAlert: function (btn) {\r\n            var elm = btn;\r\n            do {\r\n                elm = elm.parentElement;\r\n                if (elm.matches('.tc-alert')) {\r\n                    elm.style.display = 'none';\r\n                }\r\n            }\r\n            while (elm);\r\n        },\r\n\r\n        swipe: function (target, options) {\r\n            const addListeners = function (handlers) {\r\n                target.addEventListener('mousedown', handlers.start);\r\n                target.addEventListener('touchstart', handlers.start);\r\n                target.addEventListener('mouseup', handlers.end);\r\n                target.addEventListener('touchend', handlers.end);\r\n            };\r\n\r\n            if (options === 'disable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    target.removeEventListener('mousedown', handlers.start);\r\n                    target.removeEventListener('touchstart', handlers.start);\r\n                    target.removeEventListener('mouseup', handlers.end);\r\n                    target.removeEventListener('touchend', handlers.end);\r\n                }\r\n                return;\r\n            }\r\n            else if (options === 'enable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    addListeners(handlers);\r\n                }\r\n                return;\r\n            }\r\n\r\n            options = options || {};\r\n            const minDistance = options.minDistance || 30;\r\n            const maxCrossDistance = options.maxCrossDistance || 30;\r\n            const maxAllowedTime = options.maxAllowedTime || 1000;\r\n            var touchStartCoords = { 'x': -1, 'y': -1 }, // X and Y coordinates on mousedown or touchstart events.\r\n                touchEndCoords = { 'x': -1, 'y': -1 },// X and Y coordinates on mouseup or touchend events.\r\n                startTime = 0,// Time on swipeStart\r\n                elapsedTime = 0;// Elapsed time between swipeStart and swipeEnd\r\n\r\n            const getDirection = function (startCoords, endCoords) {\r\n                const dx = endCoords.x - startCoords.x;\r\n                const dy = endCoords.y - startCoords.y;\r\n                const adx = Math.abs(dx);\r\n                const ady = Math.abs(dy);\r\n                if (adx > ady && adx > minDistance && ady <= maxCrossDistance) {\r\n                    return dx < 0 ? 'left' : 'right';\r\n                }\r\n                if (ady > adx && ady > minDistance && adx <= maxCrossDistance) {\r\n                    return dy < 0 ? 'up' : 'down';\r\n                }\r\n                return 'none';\r\n            };\r\n\r\n            const mustSwipe = function (e) {\r\n                if (options.noSwipe) {\r\n                    var elm = e.target;\r\n                    while (elm && elm !== target) {\r\n                        if (elm.matches && elm.matches(options.noSwipe)) {\r\n                            return false;\r\n                        }\r\n                        elm = elm.parentNode;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n\r\n            const swipeStart = function (e) {\r\n                if (mustSwipe(e)) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchStartCoords.x = e.pageX;\r\n                    touchStartCoords.y = e.pageY;\r\n                    startTime = new Date().getTime();\r\n                }\r\n            };\r\n\r\n            const swipeEnd = function (e) {\r\n                if (startTime) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchEndCoords.x = e.pageX;\r\n                    touchEndCoords.y = e.pageY;\r\n                    elapsedTime = new Date().getTime() - startTime;\r\n                    if (elapsedTime <= maxAllowedTime) {\r\n                        const callback = options[getDirection(touchStartCoords, touchEndCoords)];\r\n                        if (callback) {\r\n                            callback.call(target);\r\n                        }\r\n                    }\r\n                    startTime = 0;\r\n                }\r\n            };\r\n\r\n            const handlers = {\r\n                start: swipeStart,\r\n                end: swipeEnd\r\n            };\r\n            swipeHandlers.set(target, handlers);\r\n            addListeners(handlers);\r\n        },\r\n\r\n        getParameterByName: function (name) {\r\n            name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\r\n            var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\", \"i\"),\r\n                results = regex.exec(location.search);\r\n            return results === null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\r\n        },\r\n\r\n        getLocaleUserChoice: function (options) {\r\n            var result = 'en-US';\r\n            options = options || {};\r\n            var cookieName = options.cookieName || 'SITNA.language';\r\n            var paramName = options.paramName || 'lang';\r\n            // Obtenemos preferencia de lenguaje\r\n            var browserLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language || navigator.userLanguage;\r\n            var lang = TC.Util.getParameterByName(paramName) || TC.Util.storage.getCookie(cookieName) || browserLanguage;\r\n            var hyphenIdx = lang.indexOf('-');\r\n            if (hyphenIdx >= 0) {\r\n                lang = lang.substr(0, hyphenIdx);\r\n            }\r\n            var expirationDate = new Date(new Date().getTime() + 365 * 24 * 60 * 60 * 1000);\r\n            TC.Util.storage.setCookie(cookieName, lang, { expires: expirationDate });\r\n\r\n            switch (lang) {\r\n                case 'eu':\r\n                    result = 'eu-ES';\r\n                    break;\r\n                case 'es':\r\n                    result = 'es-ES';\r\n                    break;\r\n                default:\r\n                    result = 'en-US';\r\n                    break;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getValidFilename: function (filename) {\r\n            return (filename || '').replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n        },\r\n\r\n        downloadBlob: function (filename, blob) {\r\n            var link = document.createElement(\"a\");\r\n            if (link.download !== undefined) {\r\n                var url = URL.createObjectURL(blob);\r\n                link.setAttribute(\"href\", url);\r\n                link.setAttribute(\"download\", TC.Util.getValidFilename(filename));\r\n                link.style.visibility = 'hidden';\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n            }\r\n        },\r\n\r\n        downloadFile: function (filename, type, data) {\r\n            var blob = new Blob([data], { type: type });\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        downloadDataURI: function (filename, type, dataURI) {\r\n            var binary = atob(dataURI.split(',')[1]);\r\n\r\n            var array = [];\r\n            for (var i = 0; i < binary.length; i++) {\r\n                array.push(binary.charCodeAt(i));\r\n            }\r\n            var blob = new Blob([new Uint8Array(array)], { type: type });\r\n\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Acorta una URL utilizando el servicio de Bit.ly. No funciona para URLs locales.\r\n         */\r\n        shortenUrl: function (url) {\r\n            return TC.ajax({\r\n                url: \"https://api-ssl.bitly.com/v3/shorten\",\r\n                data: { access_token: \"6c466047309f44bd8173d83e81491648b243ee3d\", longUrl: url },\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Convierte a Base64.\r\n         */\r\n        utf8ToBase64: function (str) {\r\n            return window.btoa(unescape(encodeURIComponent(str)));\r\n        },\r\n\r\n        /**\r\n         * Decodifica un string en Base64.\r\n         */\r\n        base64ToUtf8: function (str) {\r\n            var result;\r\n            try {\r\n                result = decodeURIComponent(escape(window.atob(str)));\r\n            }\r\n            catch (error) {\r\n                result = null;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        colorArrayToString: function (color) {\r\n            if ($.isArray(color)) {\r\n                color = color\r\n                    .slice(0, 3)\r\n                    .reduce(function (prev, cur) {\r\n                        const str = cur.toString(16);\r\n                        return prev + '00'.substring(0, 2 - str.length) + str;\r\n                    }, '#');\r\n            }\r\n            return color;\r\n        },\r\n\r\n        // Generic helper function that can be used for the three operations:        \r\n        operation: function (list1, list2, comparerFn, operationIsUnion) {\r\n            var result = [];\r\n\r\n            for (var i = 0; i < list1.length; i++) {\r\n                var item1 = list1[i],\r\n                    found = false;\r\n                for (var j = 0; j < list2.length; j++) {\r\n                    if (comparerFn(item1, list2[j])) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (found === operationIsUnion) {\r\n                    result.push(item1);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        // Following functions are to be used:\r\n        inBoth: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, true);\r\n        },\r\n\r\n        inFirstOnly: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, false);\r\n        },\r\n\r\n        inSecondOnly: function (list1, list2, comparerFn) {\r\n            return this.inFirstOnly(list2, list1, comparerFn);\r\n        },\r\n\r\n        toDataUrl: function (canvas, backgroundColour) {\r\n            var defaultOptions = { type: 'image/png', encoderOptions: 0.92 };\r\n\r\n            var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions,\r\n                type = _ref.type,\r\n                encoderOptions = _ref.encoderOptions;\r\n\r\n            var context = canvas.getContext('2d');\r\n\r\n            if (!context) {\r\n                return '';\r\n            }\r\n\r\n            var width = canvas.width;\r\n            var height = canvas.height;\r\n\r\n            var data = context.getImageData(0, 0, width, height);\r\n            var compositeOperation = context.globalCompositeOperation;\r\n\r\n            if (backgroundColour) {\r\n\r\n                context.globalCompositeOperation = 'destination-over';\r\n                context.fillStyle = backgroundColour;\r\n                context.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            var imageData = canvas.toDataURL(type, encoderOptions);\r\n\r\n            if (backgroundColour) {\r\n                context.clearRect(0, 0, width, height);\r\n                context.putImageData(data, 0, 0);\r\n                context.globalCompositeOperation = compositeOperation;\r\n            }\r\n\r\n            return imageData;\r\n        },\r\n\r\n        imgToDataUrl: function (src, outputFormat) {\r\n\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var img = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                img.onload = function () {\r\n                    var canvas = createCanvas(img);\r\n                    var dataURL;\r\n\r\n                    try {\r\n                        dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                            type: outputFormat || 'image/jpeg',\r\n                            encoderOptions: 1.0\r\n                        });\r\n                        resolve({ dataUrl: dataURL, canvas: canvas });\r\n                    } catch (error) {\r\n                        img.src = TC.proxify(src);\r\n                    }\r\n                };\r\n\r\n                img.onerror = function (error) {\r\n                    var xhr = new XMLHttpRequest();\r\n                    xhr.open('GET', TC.proxify(src), true);\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\r\n                    xhr.responseType = 'arraybuffer';\r\n                    xhr.onload = function (e) {\r\n                        if (this.status === 200) {\r\n                            var uInt8Array = new Uint8Array(this.response);\r\n                            var i = uInt8Array.length;\r\n                            var binaryString = new Array(i);\r\n                            while (i--) {\r\n                                binaryString[i] = String.fromCharCode(uInt8Array[i]);\r\n                            }\r\n                            var data = binaryString.join('');\r\n                            var type = xhr.getResponseHeader('content-type');\r\n                            if (type.indexOf('image') === 0) {\r\n                                img.src = 'data:' + type + ';base64,' + window.btoa(data);\r\n                                img.onload = function () {\r\n                                    var canvas = createCanvas(img);\r\n                                    dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                                        type: outputFormat || 'image/jpeg',\r\n                                        encoderOptions: 1.0\r\n                                    });\r\n                                    resolve({ dataUrl: dataURL, canvas: canvas });\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    xhr.onreadystatechange = function () {\r\n                        if (xhr.readyState === 4) {\r\n                            if (xhr.status !== 200) {\r\n                                reject();\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    xhr.send();\r\n                };\r\n\r\n                img.src = src;\r\n                if (img.complete || img.complete === undefined) {\r\n                    img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                    img.src = src;\r\n                }\r\n            });\r\n        },\r\n\r\n        imgTagToDataUrl: function (img, outputFormat) {\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            var canvas = createCanvas(img);\r\n            var dataURL;\r\n\r\n            try {\r\n                dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                    type: outputFormat || 'image/jpeg',\r\n                    encoderOptions: 1.0\r\n                });\r\n                return { base64: dataURL, canvas: canvas };\r\n            } catch (error) {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        addToCanvas: function (canvas, img, position, size) {\r\n            var newCanvas = TC.Util.cloneCanvas(canvas);\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var newImage = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                newImage.src = img;\r\n                newImage.onload = function () {\r\n                    if (size) {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0, size.width, size.height);\r\n                    } else {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0);\r\n                    }\r\n                    resolve(newCanvas);\r\n                }\r\n            });\r\n        },\r\n\r\n        cloneCanvas: function (oldCanvas) {\r\n            //create a new canvas\r\n            var newCanvas = document.createElement('canvas');\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            //set dimensions\r\n            newCanvas.width = oldCanvas.width;\r\n            newCanvas.height = oldCanvas.height;\r\n\r\n            //apply the old canvas to the new one\r\n            context.drawImage(oldCanvas, 0, 0);\r\n\r\n            //return the new canvas\r\n            return newCanvas;\r\n        },\r\n\r\n        calculateAspectRatioFit: function (srcWidth, srcHeight, maxWidth, maxHeight) {\r\n            var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\r\n\r\n            return { width: srcWidth * ratio, height: srcHeight * ratio };\r\n        },\r\n\r\n        getFormattedDate: function (date, hasTime) {\r\n            function pad(s) { return (s < 10) ? '0' + s : s; }\r\n\r\n            var d = new Date(date);\r\n            return [d.getFullYear(), pad(d.getMonth() + 1), pad(d.getDate())].concat(hasTime ? [\"_\", pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())] : []).join('');\r\n\r\n        },\r\n\r\n        replaceAccent: function (t) {\r\n            var translate = {\r\n                \"ä\": \"a\", \"ö\": \"o\", \"ü\": \"u\",\r\n                \"Ä\": \"A\", \"Ö\": \"O\", \"Ü\": \"U\",\r\n                \"á\": \"a\", \"é\": \"e\", \"i\": \"i\", \"ó\": \"o\", \"ú\": \"u\",\r\n                \"Á\": \"A\", \"É\": \"E\", \"Í\": \"I\", \"Ó\": \"O\", \"Ú\": \"U\",\r\n                \"ñ\": \"n\", \"Ñ\": \"N\"\r\n            };\r\n            return t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑ]/g, function (match) {\r\n                return translate[match];\r\n            });\r\n        },\r\n\r\n        downloadFileForm: function (url, data) {\r\n\r\n            var download = function (url, data) {\r\n                const fragment = document.createDocumentFragment();\r\n                var form = document.createElement('form');\r\n                form.classList.add('tc-ctl-download-form');\r\n                form.setAttribute('method', 'post');\r\n                form.setAttribute('enctype', 'text/plain');\r\n                form.setAttribute('action', TC.Util.detectIE() !== false && TC.Util.detectIE() <= 11 ? TC.proxify(url) : url);\r\n                const input = document.createElement('input');\r\n                input.classList.add('tc-ctl-download-query');\r\n                input.setAttribute('name', data.substring(0, data.indexOf(\"=\")));\r\n                form.appendChild(input);\r\n                fragment.appendChild(form);\r\n                const iframes = document.querySelectorAll('iframe');\r\n                var iframe;\r\n                for (var i = 0, len = iframes.length; i < len; i++) {\r\n                    const currentIframe = iframes[i];\r\n                    if (currentIframe.dataset.downloadUrl === url) {\r\n                        iframe = currentIframe;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!iframe) {\r\n                    iframe = document.createElement('iframe');\r\n                    iframe.style.visibility = 'hidden';\r\n                    iframe.style.display = 'none';\r\n                    iframe.dataset.downloadUrl = url;\r\n                    document.body.appendChild(iframe);\r\n                }\r\n\r\n                const content = iframe.contentDocument;\r\n                content.open();\r\n                content.write(form.outerHTML);\r\n                content.close();\r\n                content.querySelector('input').value = data.substring(data.indexOf(\"=\") + 1);\r\n                form = content.querySelector('form');\r\n                return form;\r\n            };\r\n\r\n            var htmlObj = [];\r\n            if ($.isArray(url)) {\r\n                var arrDownloads = url;\r\n                for (var i = 0; i < arrDownloads.length; i++) {\r\n                    htmlObj.push(download(arrDownloads[i].url, arrDownloads[i].data));\r\n                }\r\n            }\r\n            else {\r\n                htmlObj.push(download(url, data));\r\n            }\r\n            htmlObj.forEach(function (form) {\r\n                form.submit();\r\n            });\r\n            setTimeout(function () {\r\n                document.querySelectorAll('.tc-ctl-download-form').forEach(function (form) {\r\n                    form.parentElement.removeChild(form);\r\n                });\r\n            }, 1000);\r\n        },\r\n\r\n        WFSQueryBuilder: function (layers, filter, capabilities, outputFormat, onlyHits) {\r\n            if (!$.isArray(layers))\r\n                layers = [layers];\r\n            var queryHeader = 'xsi:schemaLocation=\"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd\" ' +\r\n                'xmlns:ogc=\"http://www.opengis.net/ogc\" service=\"WFS\" {resultType} {format} ';\r\n            switch (capabilities.version) {\r\n                case \"1.0.0\":\r\n                case \"1.1.0\":\r\n                    queryHeader += 'xmlns:gml=\"http://www.opengis.net/gml\" xmlns:wfs=\"http://www.opengis.net/wfs\" ';\r\n                    break;\r\n                case \"2.0.0\":\r\n                    queryHeader += 'xmlns:wfs=\\\"http://www.opengis.net/wfs/2.0\\\" xmlns:gml=\\\"http://www.opengis.net/gml/3.2\\\" ';\r\n                    break;\r\n            }\r\n            for (var i in capabilities) {\r\n                if (typeof (capabilities[i]) === \"string\" && i.indexOf(\"gml\") < 0 && capabilities[i].indexOf(\"wfs\") < 0)\r\n                    queryHeader += (i + '=\"' + capabilities[i] + '\" ');\r\n            }\r\n\r\n            var query = '<wfs:GetFeature ' + queryHeader.format({ resultType: (onlyHits ? 'resultType=\"hits\"' : ''), format: 'outputFormat=\"' + outputFormat + '\"' }) + '>';\r\n            var queryBody = '';\r\n\r\n            var queryItem = '<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\">{filter}</wfs:Query>';\r\n            $.each(layers, function (index, value) {\r\n                queryBody += queryItem.format({ typeName: value, filter: (filter ? filter.getText(capabilities.version) : \"\") });\r\n            });\r\n            query += queryBody + '</wfs:GetFeature>'\r\n            return query;\r\n        },\r\n\r\n        WFSFilterBuilder: function (feature, version) {\r\n            var filter = '';\r\n            if (jQuery.isPlainObject(feature)) {\r\n                filter = '<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name=\"querySingle\"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'\r\n                    .format({ prefix: (version === \"2.0.0\" ? \"fes\" : \"ogc\"), \"clipLayer\": feature.clipLayer, \"geometryName\": feature.geometryName, \"where\": feature.where })\r\n            }\r\n            else {\r\n                switch (true) {\r\n                    case !feature:\r\n                        break;\r\n                    case $.isArray(feature)://bbox\r\n                        var gmlEnvelope = ('<gml:Envelope>' +\r\n                            '<gml:lowerCorner>{lowerCorner}</gml:lowerCorner>' +\r\n                            '<gml:upperCorner>{upperCorner}</gml:upperCorner>' +\r\n                            '</gml:Envelope>').format({ lowerCorner: (feature[0] + ' ' + feature[1]), upperCorner: (feature[2] + ' ' + feature[3]) });\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:BBOX>' + gmlEnvelope + '</ogc:BBOX></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:BBOX>' + gmlEnvelope + '</fes:BBOX></fes:Filter>';\r\n                                break;\r\n                        }\r\n                        break;\r\n                    case feature instanceof TC.Feature:\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>' + TC.Util.writeGMLGeometry(feature, \"2.0\") + '</ogc:Intersects></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>' + TC.Util.writeGMLGeometry(feature, \"3.2\") + '</fes:Intersects></fes:Filter>';\r\n                                break;\r\n                        }\r\n\r\n                        break;\r\n                    default:\r\n                        TC.error(\"Geometr\\u00eda no v\\u00e1lida\");\r\n                        break;\r\n                }\r\n            }\r\n\r\n            return filter;\r\n        },\r\n\r\n        writeGMLGeometry: function (feature, gmlVersion) {\r\n\r\n            var getGmlCoordinates = function (coords) {\r\n                var result;\r\n                if (gmlVersion.indexOf('3') === 0) {\r\n                    result = coords.toString();\r\n                    while (result.indexOf(\",\") >= 0) {\r\n                        result = result.replace(\",\", \" \");\r\n                    }\r\n                }\r\n                else {\r\n                    result = coords;\r\n                    jQuery.each(result, function (i, item) { return item.join(\",\") }).join(\" \");\r\n                }\r\n                return result;\r\n            };\r\n\r\n            switch (gmlVersion) {\r\n                case \"3.1.1\":\r\n                    break;\r\n                case \"3.2\":\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString srsDimension=\\\"2\\\"><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry) +\r\n                                \"</gml:posList></gml:LineString>\";\r\n                            break;\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon srsDimension=\\\"2\\\"><gml:exterior><gml:LinearRing><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n                case \"2.0\":\r\n                default:\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LineString>\";\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n\r\n        isServiceWorker: function () {\r\n            if (navigator.serviceWorker) {\r\n                if (navigator.serviceWorker.controller && navigator.serviceWorker.controller.state === \"activated\") {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n\r\n        isSameOriginByLocation: function (uri, location) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var uProtocol = urlParts[1];\r\n                result = (uProtocol == location.protocol || uProtocol == undefined) && urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        isSameProtocol: function (uri, location) {\r\n            if (uri.match(/^(\\/\\/)/i)) {\r\n                return true;\r\n            }\r\n            var protocolRegex = /^(https?:\\/\\/)/i;\r\n            var uriProtocol = uri.match(protocolRegex);\r\n            if (uriProtocol && uriProtocol.length > 1) {\r\n                var locationProtocol = location.match(protocolRegex);\r\n                if (locationProtocol && locationProtocol.length > 1) {\r\n                    return uriProtocol[0].trim() === locationProtocol[0].trim();\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        consoleRegister: function (msg) {\r\n            if (TC.isDebug) {\r\n                console.log(msg);\r\n            }\r\n        },\r\n\r\n        getSorterByProperty: function (propName) {\r\n            return function (a, b) {\r\n                if (a[propName] > b[propName]) {\r\n                    return 1;\r\n                }\r\n                if (a[propName] < b[propName]) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            };\r\n        },\r\n\r\n        getSoundexDifference: function (a, b) {\r\n            var res = 0\r\n\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (a.charAt(i) == b.charAt(i)) {\r\n                    res++;\r\n                }\r\n            }\r\n\r\n            return res;\r\n        },\r\n\r\n        toAbsolutePath: function (href) {\r\n            var link = document.createElement(\"a\");\r\n            link.href = href;\r\n            return link.href;\r\n        },\r\n\r\n        getRenderedHtml: function (templateId, template, data, callback) {\r\n            return new Promise(function (resolve, reject) {\r\n                var render = function () {\r\n                    if (dust.cache[templateId]) {\r\n                        dust.render(templateId, data, function (err, out) {\r\n                            if (err) {\r\n                                TC.error(err);\r\n                                reject(Error(err));\r\n                            }\r\n                            else {\r\n                                if ($.isFunction(callback)) {\r\n                                    callback(out);\r\n                                }\r\n                                resolve(out);\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n                TC.loadJSInOrder(\r\n                    !window.dust,\r\n                    TC.url.templating,\r\n                    function () {\r\n                        if (!dust.cache[templateId]) {\r\n                            if (typeof template === 'string') {\r\n                                TC.ajax({\r\n                                    url: template,\r\n                                    method: \"GET\",\r\n                                    responseType: 'text'\r\n                                })\r\n                                    .then(function (html) {\r\n                                        var tpl = dust.compile(html, templateId);\r\n                                        dust.loadSource(tpl);\r\n                                        render();\r\n                                    })\r\n                                    .catch(function (err) {\r\n                                        console.log(\"Error fetching template: \" + err)\r\n                                    });\r\n                            }\r\n                            else if ($.isFunction(template)) {\r\n                                template();\r\n                                render();\r\n                            }\r\n                        }\r\n                        else {\r\n                            render();\r\n                        }\r\n                    }\r\n                );\r\n            });\r\n        },\r\n\r\n        explodeGeometry: function (obj) {\r\n            const origin = obj.origin;\r\n            const iterationFunction = function (elm, idx, arr) {\r\n                if ($.isArray(elm)) {\r\n                    elm.forEach(iterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = elm + origin[0];\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = elm + origin[1];\r\n                    }\r\n                }\r\n            };\r\n            obj.geom.forEach(iterationFunction);\r\n            return obj.geom;\r\n        },\r\n\r\n        cloneMappingFunction: function (elm) {\r\n            if ($.isArray(elm)) {\r\n                return elm.map(TC.Util.cloneMappingFunction);\r\n            }\r\n            return elm;\r\n        },\r\n\r\n        compactGeometry: function (geometry, precision) {\r\n            const origin = [Number.MAX_VALUE, Number.MAX_VALUE];\r\n            const newGeom = geometry.map(TC.Util.cloneMappingFunction);\r\n            const firstIterationFunction = function (elm, idx) {\r\n                if ($.isArray(elm)) {\r\n                    elm.forEach(firstIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0 && elm < origin[0]) {\r\n                        origin[0] = elm;\r\n                    }\r\n                    else if (idx === 1 && elm < origin[1]) {\r\n                        origin[1] = elm;\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(firstIterationFunction);\r\n\r\n            const round = function (val) {\r\n                return Math.round(val * precision) / precision;\r\n            }\r\n            origin[0] = round(origin[0]);\r\n            origin[1] = round(origin[1]);\r\n            const secondIterationFunction = function (elm, idx, arr) {\r\n                if ($.isArray(elm)) {\r\n                    elm.forEach(secondIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = round(elm - origin[0]);\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = round(elm - origin[1]);\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(secondIterationFunction);\r\n            return {\r\n                origin: origin,\r\n                geom: newGeom\r\n            }\r\n        }\r\n    };\r\n    String.prototype.format = function () {\r\n        var str = this.toString();\r\n        if (!arguments.length)\r\n            return str;\r\n        var args = typeof arguments[0],\r\n            args = ((\"string\" == args || \"number\" == args) ? arguments : arguments[0]);\r\n        for (arg in args)\r\n            str = str.replace(RegExp(\"\\\\{\" + arg + \"\\\\}\", \"gi\"), args[arg]);\r\n        return str;\r\n    };\r\n    var fncOvelaps = function (elem1, elem2,comparisonFnc) {        \r\n        return comparisonFnc(elem1.getBoundingClientRect(), elem2.getBoundingClientRect());\r\n    }\r\n    HTMLElement.prototype.colliding = function (other) {\r\n        return fncOvelaps(this, other, function (rect1, rect2) {\r\n            return !(\r\n                rect1.top > rect2.bottom ||\r\n                rect1.right < rect2.left ||\r\n                rect1.bottom < rect2.top ||\r\n                rect1.left > rect2.right\r\n            );\r\n        });        \r\n    };\r\n    HTMLElement.prototype.containing = function (other) {\r\n        fncOvelaps(this, other, function (rect1, rect2) {\r\n            return !(\r\n                rect1.left <= rect2.left &&\r\n                rect2.left < rect1.width &&\r\n                rect1.top <= rect2.top &&\r\n                rect2.top < rect1.height\r\n            );\r\n        });\r\n    };\r\n    HTMLElement.prototype.inside = function (other) {\r\n        return fncOvelaps(this, other, function (rect1, rect2) {\r\n            return (\r\n                ((rect2.top <= rect1.top) && (rect1.top <= rect2.bottom)) &&\r\n                ((rect2.top <= rect1.bottom) && (rect1.bottom <= rect2.bottom)) &&\r\n                ((rect2.left <= rect1.left) && (rect1.left <= rect2.right)) &&\r\n                ((rect2.left <= rect1.right) && (rect1.right <= rect2.right))\r\n            );\r\n        });        \r\n    };\r\n    return Util;\r\n});\r\n"],"file":"../Util.min.js"}