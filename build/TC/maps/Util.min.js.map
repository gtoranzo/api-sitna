{"version":3,"sources":["Util.js"],"names":["TC","root","factory","exports","module","define","amd","Util","String","prototype","soundex","a","this","toLowerCase","split","f","shift","r","codes","e","i","o","u","b","p","v","c","g","j","k","q","s","x","z","d","t","l","m","n","map","filter","join","slice","toUpperCase","Number","isInteger","value","isFinite","Math","floor","toLocaleString","locale","options","detectIE","apply","arguments","sNum","replace","iconUrlCache","markerGroupClassCache","path1","path2","getOnPath","obj","length","hasOwnProperty","swipeHandlers","WeakMap","modalCloseHandlers","hasOwn","isPlainObject","nodeType","window","constructor","call","isEmptyObject","name","isFunction","extend","clone","target","deep","len","src","copy","copyIsArray","Array","isArray","undefined","getMapLocale","regex","PROTOCOL","isOnCapabilities","url","withProtocol","testUrl","capabilities","reqGetMapOnCapabilities","caps","getFNFromString","fnName","scope","scopeSplit","isURL","text","test","isSecureURL","isSameOrigin","uri","result","indexOf","urlParts","match","Consts","SPLIT_REGEX","location","uProtocol","protocol","hostname","uPort","lPort","port","formatNumber","parseFloat","valueOf","addProtocol","getDiv","div","document","getElementById","HTMLElement","$","createElement","getScriptLocation","script","currentScript","scripts","getElementsByTagName","getAttribute","substr","lastIndexOf","getBackgroundUrlFromCss","cssClass","iconDiv","style","display","classList","add","body","appendChild","exec","getComputedStyle","backgroundImage","parentElement","removeChild","getPointIconUrl","className","classes","Cfg","styles","marker","group","key","point","addArrayToTree","path","treeNode","index","found","children","title","uid","push","parseCoords","_parseGeoCoord","type","GEOGRAPHIC","idx","_parseCoord","trim","UTM","xy","y","reproject","coords","sourceCrs","targetCrs","multipoint","multiring","multipoly","loadProjDef","crs","sync","sourcePrj","proj4","defs","targetPrj","forEach","poly","pidx","rp","ring","ridx","rr","coord","cidx","getMetersPerDegree","extent","dLat","degToRad","sindlat2","sin","atan2","sqrt","radToDeg","rad","PI","deg","mod","getCRSCode","CRSCodesEqual","crs1","crs2","code1","code2","getLocaleString","texts","i18n","getSimpleMimeType","mimeType","end","substring","getQueryStringParams","queryString","queryIdx","fragmentIdx","search","elm","bind","getParamString","arr","encodeURIComponent","fastUnshift","storage","getCookie","cookie","setCookie","getLocalValue","localStorage","Storage","getItem","setLocalValue","removeItem","setItem","exDate","Date","setDate","getDate","expires","getSessionLocalValue","sessionStorage","setSessionLocalValue","detectFirefox","navigator","userAgent","RegExp","$1","ua","msie","parseInt","rv","edge","detectChrome","chrome","detectSafari","detectMouse","matchesCoarse","matchMedia","matches","matchesFine","mqResult","mq","hover","browserFeatures","touch","media","testHover","detectAndroid","detectBlackBerry","detectIOS","detectMobileWindows","detectMobile","getBrowser","UAParser","syncLoadJS","apiLocation","UA_PARSER","browser","version","major","getElementByNodeName","parentNode","nodeName","colonIndex","tag","nodes","getElementsByTagNameNS","addURLParameters","parameters","toAdd","Object","keys","urlparts","params","removeURLParameter","parameter","prefix","pars","splice","showModal","contentNode","hidden","get","VISIBLE","closeButton","querySelectorAll","closeCallback","delete","stopPropagation","closeModal","set","addEventListener","openCallback","callback","hide","modal","remove","closeAlert","btn","swipe","addListeners","handlers","start","removeEventListener","minDistance","maxCrossDistance","maxAllowedTime","touchStartCoords","touchEndCoords","startTime","noSwipe","mustSwipe","changedTouches","pageX","pageY","getTime","startCoords","endCoords","dx","dy","adx","abs","ady","getDirection","getParameterByName","results","decodeURIComponent","getLocaleUserChoice","cookieName","paramName","browserLanguage","languages","language","userLanguage","lang","hyphenIdx","expirationDate","getValidFilename","filename","downloadBlob","blob","link","download","URL","createObjectURL","setAttribute","visibility","click","downloadFile","data","Blob","msSaveBlob","downloadDataURI","dataURI","binary","atob","array","charCodeAt","Uint8Array","shortenUrl","Promise","resolve","reject","ajax","access_token","longUrl","then","response","catch","utf8ToBase64","str","btoa","unescape","base64ToUtf8","escape","error","colorArrayToString","color","reduce","prev","cur","toString","operation","list1","list2","comparerFn","operationIsUnion","item1","inBoth","inFirstOnly","inSecondOnly","toDataUrl","canvas","backgroundColour","_ref","encoderOptions","context","getContext","width","height","getImageData","compositeOperation","globalCompositeOperation","fillStyle","fillRect","imageData","toDataURL","clearRect","putImageData","imgToDataUrl","outputFormat","createCanvas","img","ctx","drawImage","Image","crossOrigin","onload","dataURL","dataUrl","proxify","onerror","xhr","XMLHttpRequest","open","setRequestHeader","responseType","status","uInt8Array","binaryString","fromCharCode","getResponseHeader","onreadystatechange","readyState","send","complete","imgTagToDataUrl","base64","addToCanvas","position","size","newCanvas","cloneCanvas","newImage","oldCanvas","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","ratio","min","getFormattedDate","date","hasTime","pad","getFullYear","getMonth","concat","getHours","getMinutes","getSeconds","replaceAccent","translate","ä","ö","ü","Ä","Ö","Ü","á","é","ó","ú","Á","É","Í","Ó","Ú","ñ","Ñ","downloadFileForm","request","msg","statusText","contentDispositionHeader","contentType","format","getUID","arrDownloads","WFSQueryBuilder","layers","onlyHits","srsName","queryHeader","query","resultType","queryBody","queryItem","typeName","getText","WFSFilterBuilder","feature","clipLayer","geometryName","where","gmlEnvelope","lowerCorner","upperCorner","Feature","writeGMLGeometry","gmlVersion","getSRSName","getGmlCoordinates","Polyline","geometry","isServiceWorker","serviceWorker","controller","state","isSameOriginByLocation","isSameProtocol","protocolRegex","uriProtocol","locationProtocol","consoleRegister","isDebug","console","log","getSorterByProperty","propName","getSoundexDifference","res","charAt","toAbsolutePath","href","getRenderedHtml","templateId","template","render","dust","cache","err","out","Error","loadJSInOrder","templating","method","html","tpl","compile","loadSource","explodeGeometry","origin","iterationFunction","geom","cloneMappingFunction","compactGeometry","precision","MAX_VALUE","newGeom","firstIterationFunction","round","val","secondIterationFunction","args","arg","fncOvelaps","elem1","elem2","comparisonFnc","getBoundingClientRect","colliding","other","rect1","rect2","top","bottom","right","left","containing","inside"],"mappings":"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","sourcesContent":["; var TC = TC || {};\r\n(function (root, factory) {\r\n    if (typeof exports === \"object\") { // CommonJS\r\n        module.exports = factory();\r\n    } else if (typeof define === \"function\" && define.amd) { // AMD\r\n        define([], factory);\r\n    } else {\r\n        root.Util = factory();\r\n    }\r\n})(TC, function () {\r\n\r\n    String.prototype.soundex = function () {\r\n        var a = this.toLowerCase().split('')\r\n        f = a.shift(),\r\n            r = '',\r\n            codes = {\r\n                a: '', e: '', i: '', o: '', u: '',\r\n                b: 1, f: 1, p: 1, v: 1,\r\n                c: 2, g: 2, j: 2, k: 2, q: 2, s: 2, x: 2, z: 2,\r\n                d: 3, t: 3,\r\n                l: 4,\r\n                m: 5, n: 5,\r\n                r: 6\r\n            };\r\n\r\n        r = f +\r\n            a\r\n                .map(function (v, i, a) { return codes[v] })\r\n                .filter(function (v, i, a) { return ((i === 0) ? v !== codes[f] : v !== a[i - 1]); })\r\n                .join('');\r\n\r\n        return (r + '000').slice(0, 4).toUpperCase();\r\n    }\r\n\r\n    // Polyfill para IE\r\n    Number.isInteger = Number.isInteger || function (value) {\r\n        return typeof value === \"number\" &&\r\n            isFinite(value) &&\r\n            Math.floor(value) === value;\r\n    };\r\n\r\n    // GLS: Parche: Chrome no formatea correctamente los números en euskera, establece como separador de decimales el (.)\r\n    var toLocaleString = Number.prototype.toLocaleString;\r\n    Number.prototype.toLocaleString = function (locale, options) {\r\n        if (locale == \"eu-ES\" && !TC.Util.detectIE()) {\r\n            var sNum = toLocaleString.apply(this, arguments);\r\n            sNum = sNum.replace(/\\,/g, '.')\r\n            if (!(Math.floor(this) == this && Number.isInteger(Math.floor(this))))\r\n                sNum = sNum.replace(/.([^.]*)$/, \",$1\");\r\n\r\n            return sNum;\r\n        }\r\n        else\r\n            return toLocaleString.apply(this, arguments);\r\n    }\r\n\r\n    var iconUrlCache = {};\r\n    var markerGroupClassCache = {};\r\n\r\n    var path1 = [\"Capability\", \"Request\", \"GetMap\", \"DCPType\", \"0\", \"HTTP\", \"Get\", \"OnlineResource\"];\r\n    var path2 = [\"OperationsMetadata\", \"GetTile\", \"DCP\", \"HTTP\", \"Get\", \"0\", \"href\"];\r\n    var getOnPath = function (obj, p, i) {\r\n        if (i < p.length - 1) {\r\n            if (obj.hasOwnProperty(p[i]))\r\n                return getOnPath(obj[p[i]], p, ++i);\r\n            else return null;\r\n        } else {\r\n            return obj[p[i]];\r\n        }\r\n    };\r\n\r\n    const swipeHandlers = new WeakMap();\r\n    const modalCloseHandlers = new WeakMap();\r\n    const hasOwn = ({}).hasOwnProperty;\r\n\r\n    var Util = {\r\n\r\n        isPlainObject: function (obj) {\r\n            // Not plain objects:\r\n            // - Any object or value whose internal [[Class]] property is not \"[object Object]\"\r\n            // - DOM nodes\r\n            // - window\r\n            if (typeof obj !== 'object' || obj.nodeType || obj.window === obj) {\r\n                return false;\r\n            }\r\n\r\n            if (obj.constructor &&\r\n                !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {\r\n                return false;\r\n            }\r\n\r\n            // If the function hasn't returned already, we're confident that\r\n            // |obj| is a plain object, created by {} or constructed with new Object\r\n            return true;\r\n        },\r\n\r\n        isEmptyObject: function (obj) {\r\n            var name;\r\n            for (name in obj) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n\r\n        isFunction: function (obj) {\r\n            return typeof obj === 'function';\r\n        },\r\n\r\n        extend: function () {\r\n            var clone,\r\n                target = arguments[0] || {},\r\n                i = 1,\r\n                deep = false;\r\n\r\n            // Comprobar si hay que hacer copia profunda (primer parámetro === true)\r\n            if (typeof target === 'boolean') {\r\n                deep = target;\r\n\r\n                target = arguments[i] || {};\r\n                i++;\r\n            }\r\n\r\n            // Handle case when target is a string or something (possible in deep copy)\r\n            if (typeof target !== 'object' && !Util.isFunction(target)) {\r\n                target = {};\r\n            }\r\n\r\n            for (var len = arguments.length; i < len; i++) {\r\n                // Only deal with non-null/undefined values\r\n                const options = arguments[i];\r\n                if (options != null) {\r\n                    // Extend the base object\r\n                    for (var name in options) {\r\n                        const src = target[name];\r\n                        const copy = options[name];\r\n\r\n                        // Prevent never-ending loop\r\n                        if (target === copy) {\r\n                            continue;\r\n                        }\r\n\r\n                        // Recurse if we're merging plain objects or arrays\r\n                        const copyIsArray = Array.isArray(copy);\r\n                        if (deep && copy && (Util.isPlainObject(copy) || copyIsArray)) {\r\n                            if (copyIsArray) {\r\n                                clone = src && Array.isArray(src) ? src : [];\r\n\r\n                            } else {\r\n                                clone = src && Util.isPlainObject(src) ? src : {};\r\n                            }\r\n\r\n                            // Never move original objects, clone them\r\n                            target[name] = Util.extend(deep, clone, copy);\r\n\r\n                            // Don't bring in undefined values\r\n                        } else if (copy !== undefined) {\r\n                            target[name] = copy;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Return the modified object\r\n            return target;\r\n        },\r\n\r\n        getMapLocale: function (map) {\r\n            return map.options && map.options.locale && map.options.locale.replace('_', '-') || \"es-ES\";\r\n        },\r\n\r\n        regex: {\r\n            PROTOCOL: /(^https?:)/i\r\n        },\r\n\r\n        isOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            if (withProtocol) {\r\n                if (TC.capabilities[testUrl])\r\n                    return url;\r\n            } else {\r\n                for (var c in TC.capabilities) {\r\n                    if (c.replace(TC.Util.regex.PROTOCOL, \"\") == testUrl)\r\n                        return c;\r\n                }\r\n            }\r\n\r\n            for (c in TC.capabilities) {\r\n                var u = getOnPath(TC.capabilities[c], path1, 0) || getOnPath(TC.capabilities[c], path2, 0);\r\n\r\n                if (u && withProtocol && url == u) return u;\r\n                else if (u && url.replace(TC.Util.regex.PROTOCOL, \"\") == u.replace(TC.Util.regex.PROTOCOL, \"\")) return u;\r\n            }\r\n\r\n            return url;\r\n        },\r\n\r\n        reqGetMapOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            var _get = function (caps) {\r\n                var u = getOnPath(caps, path1, 0) || getOnPath(caps, path2, 0);\r\n                if (u)\r\n                    return !withProtocol ? u.split('?')[0].replace(TC.Util.regex.PROTOCOL, \"\") : u.split('?')[0];\r\n\r\n                return null;\r\n            };\r\n            if (TC.capabilities[url]) {\r\n                return _get(TC.capabilities[url]);\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        getFNFromString: function (fnName) {\r\n            var scope = window;\r\n            var scopeSplit = fnName.split('.');\r\n            for (i = 0; i < scopeSplit.length - 1; i++) {\r\n                scope = scope[scopeSplit[i]];\r\n\r\n                if (scope == undefined) return;\r\n            }\r\n\r\n            return scope[scopeSplit[scopeSplit.length - 1]];\r\n        },\r\n\r\n        isURL: function (text) {\r\n            return /^(http|https|ftp|mailto)\\:\\/\\//i.test(text);\r\n        },\r\n\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        isSameOrigin: function (uri) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var location = window.location;\r\n                var uProtocol = urlParts[1];\r\n                result =\r\n                    (uProtocol == location.protocol || uProtocol == undefined) &&\r\n                    urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        formatNumber: function (value, locale) {\r\n            var t = typeof value;\r\n            if (t === 'number') {\r\n                return value.toLocaleString(locale);\r\n            }\r\n            else if (t === 'string') {\r\n                n = parseFloat(value);\r\n                if (n === new Number(value).valueOf()) {\r\n                    return n.toLocaleString(locale);\r\n                }\r\n            }\r\n            return value;\r\n        },\r\n\r\n        addProtocol: function (uri) {\r\n            var result = uri;\r\n            if (uri && uri.indexOf('//') === 0) {\r\n                result = location.protocol + uri;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * getDiv: returns HTML element or null if the parameter is invalid\r\n        * Parameter: string with element ID or HTML element\r\n        */\r\n        getDiv: function (div) {\r\n            var result;\r\n            if (typeof div === 'string') {\r\n                result = document.getElementById(div);\r\n            }\r\n            else if (div instanceof HTMLElement) {\r\n                result = div;\r\n            }\r\n            else if ('$' in window && div instanceof $ && div.length) {\r\n                result = div[0];\r\n            }\r\n            else {\r\n                result = document.createElement('div');\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getScriptLocation: function () {\r\n            var src;\r\n            var script;\r\n            if (document.currentScript) {\r\n                script = document.currentScript;\r\n            }\r\n            else {\r\n                var scripts = document.getElementsByTagName('script');\r\n                script = scripts[scripts.length - 1];\r\n            }\r\n            src = script.getAttribute('src');\r\n            if (src) {\r\n                return src.substr(0, src.lastIndexOf('/') + 1);\r\n            }\r\n            return \"\";\r\n        },\r\n\r\n        /* \r\n        * getBackgroundUrlFromCss: devuelve la URL de background-image en CSS\r\n        * Parameter: string con nombre de clase\r\n        */\r\n        getBackgroundUrlFromCss: function (cssClass) {\r\n            var result = '';\r\n\r\n            if (cssClass) {\r\n                if (iconUrlCache[cssClass] !== undefined) {\r\n                    result = iconUrlCache[cssClass];\r\n                }\r\n                else {\r\n                    const iconDiv = document.createElement('div');\r\n                    iconDiv.style.display = 'none';\r\n                    iconDiv.classList.add(cssClass);                    \r\n                    document.body.appendChild(iconDiv);                    \r\n                    // The regular expression is nongreedy (.*?), otherwise in FF and IE it gets 'url_to_image\"'\r\n                    var match = /^url\\(['\"]?(.*?)['\"]?\\)$/gi.exec(window.getComputedStyle(iconDiv, null).backgroundImage);\r\n                    if (match && match.length > 1) {\r\n                        result = match[match.length - 1];\r\n                    }\r\n                    iconDiv.parentElement.removeChild(iconDiv);\r\n                    iconUrlCache[cssClass] = result;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getPointIconUrl: function getPointIconUrl(options) {\r\n            var result = null;\r\n            if (options.url) {\r\n                result = options.url;\r\n            }\r\n            else {\r\n                var className;\r\n                if (typeof options.cssClass === 'string') {\r\n                    className = options.cssClass;\r\n                }\r\n                else {\r\n                    var classes = options.classes || TC.Cfg.styles.marker.classes;\r\n                    className = classes[0];\r\n                    if (options.group) {\r\n                        if (markerGroupClassCache[options.group] === undefined) {\r\n                            var i = 0;\r\n                            for (var key in markerGroupClassCache) {\r\n                                i++;\r\n                            }\r\n                            i = i % classes.length;\r\n                            markerGroupClassCache[options.group] = classes[i];\r\n                        }\r\n                        className = markerGroupClassCache[options.group];\r\n                    }\r\n                }\r\n                result = TC.Util.getBackgroundUrlFromCss(className);\r\n            }\r\n            if (!result && options !== TC.Cfg.styles.point && options.cssClass !== '') {\r\n                result = getPointIconUrl(TC.Cfg.styles.point);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * addPathToTree: añade a un array a un árbol, cada elemento en un nivel anidado\r\n        * Parameters: array, nodo de árbol, [índice]\r\n        * Returns: último nodo insertado, null si ya existía la ruta\r\n        */\r\n        addArrayToTree: function addArrayToTree(path, treeNode, index) {\r\n            var result = null;\r\n            var found = false;\r\n            index = index || 0;\r\n            var name = path[index];\r\n            if (name) {\r\n                var n;\r\n                for (var i = 0, len = treeNode.children.length; i < len; i++) {\r\n                    n = treeNode.children[i];\r\n                    if (n.name === name) {\r\n                        found = true;\r\n                        var r = addArrayToTree(path, n, index + 1);\r\n                        if (r) {\r\n                            result = r;\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (!found) {\r\n                    n = { name: name, title: name, uid: '/' + path.slice(0, index + 1).join('/'), children: [] };\r\n                    treeNode.children.push(n);\r\n                    result = n;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        parseCoords: function (text) {\r\n            var result = null;\r\n\r\n            var _parseGeoCoord = function (text) {\r\n                var t = text;\r\n                var result = {};\r\n                result.type = TC.Consts.GEOGRAPHIC;\r\n                var idx = t.indexOf('\\u00B0');\r\n                result.value = parseFloat(t.substr(0, idx));\r\n                t = t.substr(idx + 1);\r\n                idx = t.indexOf('\\'');\r\n                if (idx >= 0) {\r\n                    var v = parseFloat(t.substr(0, idx)) / 60;\r\n                    if (result.value >= 0) {\r\n                        result.value += v;\r\n                    }\r\n                    else {\r\n                        result.value -= v;\r\n                    }\r\n                    t = t.substr(idx + 1);\r\n                    idx = t.indexOf('\\'');\r\n                    if (idx >= 0) {\r\n                        v = parseFloat(t.substr(0, idx).replace(',', '.')) / 3600;\r\n                        if (result.value >= 0) {\r\n                            result.value += v;\r\n                        }\r\n                        else {\r\n                            result.value -= v;\r\n                        }\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n\r\n            var _parseCoord = function (text) {\r\n                var t = text.trim();\r\n                // nnºnn'nn''N\r\n                if (t.match(/^1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?\\s*[NnSsWwOoEe]$/g)) {\r\n                    switch (t[t.length - 1]) {\r\n                        case 'S':\r\n                        case 's':\r\n                        case 'W':\r\n                        case 'w':\r\n                        case 'O':\r\n                        case 'o':\r\n                            t = '-' + t;\r\n                            break;\r\n                    }\r\n                    t = t.substr(0, t.length - 1);\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // +nnºnn'nn''\r\n                if (t.match(/^[+-]?1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?$/g)) {\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // nn.nn N\r\n                if (t.match(/^1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?\\s*[NnSsWwOoEe]$/g)) {\r\n                    var result = { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.substr(0, t.length - 1).replace(',', '.')) };\r\n                    if (t.match(/[SsWwOo]$/)) {\r\n                        result.value = -result.value;\r\n                    }\r\n                    return result;\r\n                }\r\n                // +nn.nn\r\n                if (t.match(/^[+-]?1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?$/g)) {\r\n                    return { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                // UTM\r\n                if (t.match(/^\\d{6,7}([.,]\\d+)?$/g)) {\r\n                    return { type: TC.Consts.UTM, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                return null;\r\n            };\r\n\r\n            text = text.trim().toUpperCase();\r\n            var xy = text.split(',');\r\n            if (xy.length === 4) {\r\n                xy = [xy.slice(0, 1).join('.'), xy.slice(2, 3).join('.')];\r\n            }\r\n            else if (xy.length === 1 || xy.length === 3) {\r\n                xy = text.split(' ');\r\n            }\r\n            if (xy.length === 2) {\r\n                var x = _parseCoord(xy[0]);\r\n                var y = _parseCoord(xy[1]);\r\n                if (x !== null && y !== null) {\r\n                    result = [x, y];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        reproject: function (coords, sourceCrs, targetCrs) {\r\n            var result;\r\n            var multipoint = true;\r\n            var multiring = true;\r\n            var multipoly = true;\r\n            if (Array.isArray(coords[0])) {\r\n                if (Array.isArray(coords[0][0])) {\r\n                    if (!Array.isArray(coords[0][0][0])) {\r\n                        multipoly = false;\r\n                        coords = [coords];\r\n                    }\r\n                }\r\n                else {\r\n                    multiring = false;\r\n                    coords = [[coords]];\r\n                }\r\n            }\r\n            else {\r\n                multipoint = false;\r\n                multiring = false;\r\n                multipoly = false;\r\n                coords = [[[coords]]];\r\n            }\r\n            TC.loadProjDef({ crs: sourceCrs, sync: true });\r\n            TC.loadProjDef({ crs: targetCrs, sync: true });\r\n            var sourcePrj = proj4(proj4.defs[sourceCrs]);\r\n            var targetPrj = proj4(proj4.defs[targetCrs]);\r\n            result = new Array(coords.length);\r\n            coords.forEach(function (poly, pidx) {\r\n                const rp = result[pidx] = [];\r\n                poly.forEach(function (ring, ridx) {\r\n                    const rr = rp[ridx] = [];\r\n                    ring.forEach(function (coord, cidx) {\r\n                        var point = proj4(sourcePrj, targetPrj, { x: coord[0], y: coord[1] });\r\n                        rr[cidx] = [point.x, point.y];\r\n                        if (coord.length > 2) {\r\n                            rr[cidx][2] = coord[2];\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            if (!multipoint) {\r\n                result = result[0][0][0];\r\n            }\r\n            else if (!multiring) {\r\n                result = result[0][0];\r\n            }\r\n            else if (!multipoly) {\r\n                result = result[0];\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getMetersPerDegree: function (extent) {\r\n            var result = undefined;\r\n            var R = 6370997; // m\r\n            var toRad = function (number) {\r\n                return number * Math.PI / 180;\r\n            };\r\n            if (Array.isArray(extent) && extent.length >= 4) {\r\n                var dLat = this.degToRad(extent[3] - extent[1]);\r\n                var sindlat2 = Math.sin(dLat / 2);\r\n                var a = sindlat2 * sindlat2;\r\n                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n                result = R * c / (extent[3] - extent[1]);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        radToDeg: function (rad) { // convert radians to degrees\r\n            return rad * 180 / Math.PI;\r\n        },\r\n        degToRad: function (deg) { // convert degrees to radians\r\n            return deg * Math.PI / 180;\r\n        },\r\n        mod: function (n) { // modulo for negative values\r\n            return ((n % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);\r\n        },\r\n\r\n        getCRSCode: function (crs) {\r\n            var result = null;\r\n            crs = crs.trim();\r\n            if (/^EPSG:\\d{4,6}$/g.test(crs) || //formato EPSG\r\n                /^urn:ogc:def:crs:EPSG:.*:\\d{4,6}/g.test(crs) || // formato URN\r\n                /http:\\/\\/www.opengis.net\\/gml\\/srs\\/epsg.xml#\\d{4,6}$/g.test(crs)) { // formato GML\r\n                var match = crs.trim().match(/^.+[:#](\\d{4,6})$/); // devuelve la parte numérica del código\r\n                if (match) {\r\n                    result = match[1];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        CRSCodesEqual: function (crs1, crs2) {\r\n            if (crs1 === crs2) {\r\n                return true;\r\n            }\r\n            var code1 = this.getCRSCode(crs1);\r\n            var code2 = this.getCRSCode(crs2);\r\n            return code1 !== null && code2 !== null && code1 === code2;\r\n        },\r\n\r\n        getLocaleString: function (locale, key, texts) {\r\n            var result = key;\r\n            if (TC.i18n && TC.i18n[locale]) {\r\n                var text = TC.i18n[locale][key];\r\n                if (text) {\r\n                    result = text;\r\n                    if (texts) {\r\n                        for (var k in texts) {\r\n                            result = result.replace('{' + k + '}', texts[k]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getSimpleMimeType: function (mimeType) {\r\n            var result = '';\r\n            if (mimeType) {\r\n                var end = mimeType.indexOf(';');\r\n                if (end > 0) {\r\n                    mimeType = mimeType.substring(0, end);\r\n                }\r\n                result = mimeType;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getQueryStringParams: function (url) {\r\n            var queryString;\r\n            if (url) {\r\n                var queryIdx = url.indexOf('?');\r\n                if (queryIdx >= 0) {\r\n                    queryString = url.substr(queryIdx);\r\n                    var fragmentIdx = queryString.indexOf('#');\r\n                    if (fragmentIdx >= 0) {\r\n                        queryString = queryString.substr(0, fragmentIdx)\r\n                    }\r\n                }\r\n                else {\r\n                    queryString = '?';\r\n                }\r\n            }\r\n            else {\r\n                queryString = location.search;\r\n            }\r\n            var result = queryString.replace(/(^\\?)/, '').split(\"&\").map(function (elm) {\r\n                return elm = elm.split(\"=\"), this[elm[0]] = elm[1], this\r\n            }.bind({}))[0];\r\n            delete result[''];\r\n            return result;\r\n        },\r\n\r\n        getParamString: function (obj) {\r\n            const arr = [];\r\n            for (var key in obj) {\r\n                arr[arr.length] = encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]);\r\n            }\r\n            return arr.join('&').replace(/%20/g, '+');\r\n        },\r\n\r\n        fastUnshift: function (a, elm) {\r\n            var len = a.length;\r\n            while (len) {\r\n                a[len] = a[len - 1];\r\n                len--;\r\n            }\r\n            a[0] = elm;\r\n        },\r\n\r\n        storage: {\r\n            getCookie: function (key) {\r\n                return TC.cookie(key);\r\n            },\r\n            setCookie: function (key, value, options) {\r\n                return TC.cookie(key, value, options);\r\n            },\r\n            getLocalValue: function (key) {\r\n                var result = null;\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    result = localStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setLocalValue: function (key, value) {\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        localStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        localStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            },\r\n            getSessionLocalValue: function (key) {\r\n                var result = null;\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    result = sessionStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setSessionLocalValue: function (key, value) {\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        sessionStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        sessionStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            }\r\n        },\r\n        detectFirefox: function () {\r\n            if (/Firefox[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) //test for Firefox/x.x or Firefox x.x (ignoring remaining digits);\r\n                return new Number(RegExp.$1); // capture x.x portion and store as a number\r\n            else\r\n                return false;\r\n        },\r\n        detectIE: function () {\r\n            var ua = window.navigator.userAgent;\r\n\r\n            var msie = ua.indexOf('MSIE ');\r\n            if (msie > 0) {\r\n                // IE 10 or older => return version number\r\n                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n            }\r\n\r\n            var trident = ua.indexOf('Trident/');\r\n            if (trident > 0) {\r\n                // IE 11 => return version number\r\n                var rv = ua.indexOf('rv:');\r\n                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n            }\r\n\r\n            // GLS: 13/02/2019. Comento lo que respecta a Edge, no tiene sentido meterlo en el mismo saco que un navegador obsoleto.\r\n            // No lo comento porque en la mesa no hay quorum.\r\n            var edge = ua.indexOf('Edge/');\r\n            if (edge > 0) {\r\n                // IE 12 => return version number\r\n                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n            }\r\n\r\n            // other browser\r\n            return false;\r\n        },\r\n        detectChrome: function () {\r\n            return window.chrome;\r\n\r\n        },\r\n        detectSafari: function () {\r\n            return !!navigator.userAgent.match(/Version\\/[\\d\\.]+.*Safari/);\r\n        },\r\n        detectMouse: function () {\r\n            const matchesCoarse = matchMedia('(pointer:coarse)').matches;\r\n            const matchesFine = matchMedia('(pointer:fine)').matches;\r\n            if (matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchesCoarse && !matchesFine) {\r\n                var testHover = function () {\r\n                    //console.log('estamos en testHover');\r\n                    var mq = '(hover: hover)',\r\n                        hover = !TC.browserFeatures.touch(), // fallback if mq4 not supported: no hover for touch\r\n                        mqResult;\r\n\r\n                    mqResult = window.matchMedia(mq);\r\n                    //console.log('resultado de window.matchMedia(mq): ' + mqResult.media);\r\n                    //console.log('mq: ' + mq);\r\n                    if (mqResult.media === mq) {\r\n                        //console.log('es igual');\r\n                        // matchMedia supports hover detection, so we rely on that\r\n                        hover = mqResult.matches;\r\n                        //console.log('va retornar: ' + hover);\r\n                    }\r\n\r\n                    return hover;\r\n                };\r\n\r\n                if (testHover())\r\n                    return true;\r\n                else return false;\r\n            }\r\n            if (!matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchMedia('(pointer:none)').matches) {\r\n                return false;\r\n            }\r\n            if (!TC.browserFeatures.touch()) {\r\n                return true;\r\n            }\r\n        },\r\n        detectAndroid: function () {\r\n            return navigator.userAgent.match(/Android/i);\r\n        },\r\n        detectBlackBerry: function () {\r\n            return navigator.userAgent.match(/BlackBerry/i);\r\n        },\r\n        detectIOS: function () {\r\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n        },\r\n        detectMobileWindows: function () {\r\n            return navigator.userAgent.match(/IEMobile/i);\r\n        },\r\n        detectMobile: function () {\r\n            return (TC.Util.detectAndroid() || TC.Util.detectIOS() || TC.Util.detectMobileWindows() || TC.Util.detectBlackBerry());\r\n        },\r\n        getBrowser: function () {\r\n            if (!window.UAParser) {\r\n                TC.syncLoadJS(TC.apiLocation + TC.Consts.url.UA_PARSER);\r\n            }\r\n\r\n            var parser = new UAParser();\r\n            var browser = parser.getBrowser();\r\n            return { name: browser.name, version: browser.major };\r\n        },\r\n        getElementByNodeName: function (parentNode, nodeName) {\r\n            var colonIndex = nodeName.indexOf(\":\");\r\n            var tag = nodeName.substr(colonIndex + 1);\r\n            var nodes = parentNode.getElementsByTagNameNS(\"*\", tag);\r\n\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].nodeName == nodeName)\r\n                    return nodes;\r\n            }\r\n            return undefined;\r\n        },\r\n        addURLParameters: function (url, parameters) {\r\n            if (!parameters) {\r\n                return url;\r\n            }\r\n            var toAdd = Object.keys(parameters).map(function (key) {\r\n                return encodeURIComponent(key) + '=' + (parameters[key] ? encodeURIComponent(parameters[key]) : '');\r\n            }).join('&');\r\n\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var params = urlparts[1].split(/[&;]/g);\r\n                params.push(toAdd);\r\n\r\n                url = urlparts[0] + '?' + params.join('&');\r\n                return url;\r\n            } else {\r\n                urlparts = url.split('#');\r\n                if (urlparts.length >= 2) {\r\n                    urlparts.shift();\r\n                    url = urlparts[0] + '?' + toAdd + '#' + urlparts.join('#');\r\n                    return url;\r\n                }\r\n                else {\r\n                    url = url + '?' + toAdd;\r\n                    return url;\r\n                }\r\n            }\r\n        },\r\n        removeURLParameter: function (url, parameter) {\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var prefix = encodeURIComponent(parameter.toLowerCase()) + '=';\r\n                var pars = urlparts[1].toLowerCase().split(/[&;]/g);\r\n\r\n                //reverse iteration as may be destructive\r\n                for (var i = pars.length; i-- > 0;) {\r\n                    //idiom for string.startsWith\r\n                    if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                        pars.splice(i, 1);\r\n                    }\r\n                }\r\n\r\n                url = urlparts[0] + '?' + pars.join('&');\r\n                return url;\r\n            } else {\r\n                return url;\r\n            }\r\n        },\r\n\r\n        showModal: function (contentNode, options) {\r\n            options = options || {};\r\n\r\n            contentNode.hidden = false;\r\n            if (window.$ && contentNode instanceof $) {\r\n                contentNode = contentNode.get(0);\r\n            }\r\n            contentNode.classList.add(TC.Consts.classes.VISIBLE);\r\n            const closeButton = contentNode.querySelectorAll('.tc-modal-close');\r\n            if (closeButton && closeButton.length > 0) {\r\n                for (var i = 0; i < closeButton.length; i++) {\r\n                    var closeCallback = modalCloseHandlers.get(closeButton[i]);\r\n                    if (closeCallback) {\r\n                        modalCloseHandlers.delete(closeButton[i]);\r\n                    }\r\n                    else {\r\n                        closeCallback = function (e) {\r\n                            e.stopPropagation();\r\n                            return TC.Util.closeModal(options.closeCallback, e.target);\r\n                        };\r\n                        modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    }\r\n                    modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    closeButton[i].addEventListener('click', closeCallback);\r\n                    if (Util.isFunction(options.openCallback)) {\r\n                        options.openCallback();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        closeModal: function (callback, target) {\r\n\r\n            const hide = function (modal) {\r\n                modal.classList.remove(TC.Consts.classes.VISIBLE);\r\n            };\r\n\r\n            var modal;\r\n            if (target) {\r\n                modal = target;\r\n                while (modal && !modal.matches('.tc-modal')) {\r\n                    modal = modal.parentElement;\r\n                }\r\n\r\n                hide(modal);\r\n            } else {\r\n                Array.prototype.forEach.call(document.querySelectorAll('.tc-modal'), function (modal) {\r\n                    hide(modal);\r\n                });\r\n            }\r\n\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        },\r\n\r\n        closeAlert: function (btn) {\r\n            var elm = btn;\r\n            do {\r\n                elm = elm.parentElement;\r\n                if (elm.matches('.tc-alert')) {\r\n                    elm.style.display = 'none';\r\n                }\r\n            }\r\n            while (elm);\r\n        },\r\n\r\n        swipe: function (target, options) {\r\n            const addListeners = function (handlers) {\r\n                target.addEventListener('mousedown', handlers.start);\r\n                target.addEventListener('touchstart', handlers.start);\r\n                target.addEventListener('mouseup', handlers.end);\r\n                target.addEventListener('touchend', handlers.end);\r\n            };\r\n\r\n            if (options === 'disable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    target.removeEventListener('mousedown', handlers.start);\r\n                    target.removeEventListener('touchstart', handlers.start);\r\n                    target.removeEventListener('mouseup', handlers.end);\r\n                    target.removeEventListener('touchend', handlers.end);\r\n                }\r\n                return;\r\n            }\r\n            else if (options === 'enable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    addListeners(handlers);\r\n                }\r\n                return;\r\n            }\r\n\r\n            options = options || {};\r\n            const minDistance = options.minDistance || 30;\r\n            const maxCrossDistance = options.maxCrossDistance || 30;\r\n            const maxAllowedTime = options.maxAllowedTime || 1000;\r\n            var touchStartCoords = { 'x': -1, 'y': -1 }, // X and Y coordinates on mousedown or touchstart events.\r\n                touchEndCoords = { 'x': -1, 'y': -1 },// X and Y coordinates on mouseup or touchend events.\r\n                startTime = 0,// Time on swipeStart\r\n                elapsedTime = 0;// Elapsed time between swipeStart and swipeEnd\r\n\r\n            const getDirection = function (startCoords, endCoords) {\r\n                const dx = endCoords.x - startCoords.x;\r\n                const dy = endCoords.y - startCoords.y;\r\n                const adx = Math.abs(dx);\r\n                const ady = Math.abs(dy);\r\n                if (adx > ady && adx > minDistance && ady <= maxCrossDistance) {\r\n                    return dx < 0 ? 'left' : 'right';\r\n                }\r\n                if (ady > adx && ady > minDistance && adx <= maxCrossDistance) {\r\n                    return dy < 0 ? 'up' : 'down';\r\n                }\r\n                return 'none';\r\n            };\r\n\r\n            const mustSwipe = function (e) {\r\n                if (options.noSwipe) {\r\n                    var elm = e.target;\r\n                    while (elm && elm !== target) {\r\n                        if (elm.matches && elm.matches(options.noSwipe)) {\r\n                            return false;\r\n                        }\r\n                        elm = elm.parentNode;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n\r\n            const swipeStart = function (e) {\r\n                if (mustSwipe(e)) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchStartCoords.x = e.pageX;\r\n                    touchStartCoords.y = e.pageY;\r\n                    startTime = new Date().getTime();\r\n                }\r\n            };\r\n\r\n            const swipeEnd = function (e) {\r\n                if (startTime) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchEndCoords.x = e.pageX;\r\n                    touchEndCoords.y = e.pageY;\r\n                    elapsedTime = new Date().getTime() - startTime;\r\n                    if (elapsedTime <= maxAllowedTime) {\r\n                        const callback = options[getDirection(touchStartCoords, touchEndCoords)];\r\n                        if (callback) {\r\n                            callback.call(target);\r\n                        }\r\n                    }\r\n                    startTime = 0;\r\n                }\r\n            };\r\n\r\n            const handlers = {\r\n                start: swipeStart,\r\n                end: swipeEnd\r\n            };\r\n            swipeHandlers.set(target, handlers);\r\n            addListeners(handlers);\r\n        },\r\n\r\n        getParameterByName: function (name) {\r\n            name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\r\n            var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\", \"i\"),\r\n                results = regex.exec(location.search);\r\n            return results === null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\r\n        },\r\n\r\n        getLocaleUserChoice: function (options) {\r\n            var result = 'en-US';\r\n            options = options || {};\r\n            var cookieName = options.cookieName || 'SITNA.language';\r\n            var paramName = options.paramName || 'lang';\r\n            // Obtenemos preferencia de lenguaje\r\n            var browserLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language || navigator.userLanguage;\r\n            var lang = TC.Util.getParameterByName(paramName) || TC.Util.storage.getCookie(cookieName) || browserLanguage;\r\n            var hyphenIdx = lang.indexOf('-');\r\n            if (hyphenIdx >= 0) {\r\n                lang = lang.substr(0, hyphenIdx);\r\n            }\r\n            var expirationDate = new Date(new Date().getTime() + 365 * 24 * 60 * 60 * 1000);\r\n            TC.Util.storage.setCookie(cookieName, lang, { expires: expirationDate });\r\n\r\n            switch (lang) {\r\n                case 'eu':\r\n                    result = 'eu-ES';\r\n                    break;\r\n                case 'es':\r\n                    result = 'es-ES';\r\n                    break;\r\n                default:\r\n                    result = 'en-US';\r\n                    break;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getValidFilename: function (filename) {\r\n            return (filename || '').replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n        },\r\n\r\n        downloadBlob: function (filename, blob) {\r\n            var link = document.createElement(\"a\");\r\n            if (link.download !== undefined) {\r\n                var url = URL.createObjectURL(blob);\r\n                link.setAttribute(\"href\", url);\r\n                link.setAttribute(\"download\", TC.Util.getValidFilename(filename));\r\n                link.style.visibility = 'hidden';\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n            }\r\n        },\r\n\r\n        downloadFile: function (filename, type, data) {\r\n            var blob = new Blob([data], { type: type });\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        downloadDataURI: function (filename, type, dataURI) {\r\n            var binary = atob(dataURI.split(',')[1]);\r\n\r\n            var array = [];\r\n            for (var i = 0; i < binary.length; i++) {\r\n                array.push(binary.charCodeAt(i));\r\n            }\r\n            var blob = new Blob([new Uint8Array(array)], { type: type });\r\n\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Acorta una URL utilizando el servicio de Bit.ly. No funciona para URLs locales.\r\n         */\r\n        shortenUrl: function (url) {\r\n            return new Promise(function (resolve, reject) {\r\n                TC.ajax({\r\n                    url: \"https://api-ssl.bitly.com/v3/shorten\",\r\n                    data: { access_token: \"6c466047309f44bd8173d83e81491648b243ee3d\", longUrl: url },\r\n                })\r\n                    .then(function (response) {\r\n                        resolve(response.data);\r\n                    })\r\n                    .catch(function (e) {\r\n                        reject(e);\r\n                    });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Convierte a Base64.\r\n         */\r\n        utf8ToBase64: function (str) {\r\n            return window.btoa(unescape(encodeURIComponent(str)));\r\n        },\r\n\r\n        /**\r\n         * Decodifica un string en Base64.\r\n         */\r\n        base64ToUtf8: function (str) {\r\n            var result;\r\n            try {\r\n                result = decodeURIComponent(escape(window.atob(str)));\r\n            }\r\n            catch (error) {\r\n                result = null;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        colorArrayToString: function (color) {\r\n            if (Array.isArray(color)) {\r\n                color = color\r\n                    .slice(0, 3)\r\n                    .reduce(function (prev, cur) {\r\n                        const str = cur.toString(16);\r\n                        return prev + '00'.substring(0, 2 - str.length) + str;\r\n                    }, '#');\r\n            }\r\n            return color;\r\n        },\r\n\r\n        // Generic helper function that can be used for the three operations:        \r\n        operation: function (list1, list2, comparerFn, operationIsUnion) {\r\n            var result = [];\r\n\r\n            for (var i = 0; i < list1.length; i++) {\r\n                var item1 = list1[i],\r\n                    found = false;\r\n                for (var j = 0; j < list2.length; j++) {\r\n                    if (comparerFn(item1, list2[j])) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (found === operationIsUnion) {\r\n                    result.push(item1);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        // Following functions are to be used:\r\n        inBoth: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, true);\r\n        },\r\n\r\n        inFirstOnly: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, false);\r\n        },\r\n\r\n        inSecondOnly: function (list1, list2, comparerFn) {\r\n            return this.inFirstOnly(list2, list1, comparerFn);\r\n        },\r\n\r\n        toDataUrl: function (canvas, backgroundColour) {\r\n            var defaultOptions = { type: 'image/png', encoderOptions: 0.92 };\r\n\r\n            var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions,\r\n                type = _ref.type,\r\n                encoderOptions = _ref.encoderOptions;\r\n\r\n            var context = canvas.getContext('2d');\r\n\r\n            if (!context) {\r\n                return '';\r\n            }\r\n\r\n            var width = canvas.width;\r\n            var height = canvas.height;\r\n\r\n            var data = context.getImageData(0, 0, width, height);\r\n            var compositeOperation = context.globalCompositeOperation;\r\n\r\n            if (backgroundColour) {\r\n\r\n                context.globalCompositeOperation = 'destination-over';\r\n                context.fillStyle = backgroundColour;\r\n                context.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            var imageData = canvas.toDataURL(type, encoderOptions);\r\n\r\n            if (backgroundColour) {\r\n                context.clearRect(0, 0, width, height);\r\n                context.putImageData(data, 0, 0);\r\n                context.globalCompositeOperation = compositeOperation;\r\n            }\r\n\r\n            return imageData;\r\n        },\r\n\r\n        imgToDataUrl: function (src, outputFormat) {\r\n\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var img = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                img.onload = function () {\r\n                    var canvas = createCanvas(img);\r\n                    var dataURL;\r\n\r\n                    try {\r\n                        dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                            type: outputFormat || 'image/jpeg',\r\n                            encoderOptions: 1.0\r\n                        });\r\n                        resolve({ dataUrl: dataURL, canvas: canvas });\r\n                    } catch (error) {\r\n                        img.src = TC.proxify(src);\r\n                    }\r\n                };\r\n\r\n                img.onerror = function (error) {\r\n                    var xhr = new XMLHttpRequest();\r\n                    xhr.open('GET', TC.proxify(src), true);\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\r\n                    xhr.responseType = 'arraybuffer';\r\n                    xhr.onload = function (e) {\r\n                        if (this.status === 200) {\r\n                            var uInt8Array = new Uint8Array(this.response);\r\n                            var i = uInt8Array.length;\r\n                            var binaryString = new Array(i);\r\n                            while (i--) {\r\n                                binaryString[i] = String.fromCharCode(uInt8Array[i]);\r\n                            }\r\n                            var data = binaryString.join('');\r\n                            var type = xhr.getResponseHeader('content-type');\r\n                            if (type.indexOf('image') === 0) {\r\n                                img.src = 'data:' + type + ';base64,' + window.btoa(data);\r\n                                img.onload = function () {\r\n                                    var canvas = createCanvas(img);\r\n                                    dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                                        type: outputFormat || 'image/jpeg',\r\n                                        encoderOptions: 1.0\r\n                                    });\r\n                                    resolve({ dataUrl: dataURL, canvas: canvas });\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    xhr.onreadystatechange = function () {\r\n                        if (xhr.readyState === 4) {\r\n                            if (xhr.status !== 200) {\r\n                                reject();\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    xhr.send();\r\n                };\r\n\r\n                img.src = src;\r\n                if (img.complete || img.complete === undefined) {\r\n                    img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                    img.src = src;\r\n                }\r\n            });\r\n        },\r\n\r\n        imgTagToDataUrl: function (img, outputFormat) {\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            var canvas = createCanvas(img);\r\n            var dataURL;\r\n\r\n            try {\r\n                dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                    type: outputFormat || 'image/jpeg',\r\n                    encoderOptions: 1.0\r\n                });\r\n                return { base64: dataURL, canvas: canvas };\r\n            } catch (error) {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        addToCanvas: function (canvas, img, position, size) {\r\n            var newCanvas = TC.Util.cloneCanvas(canvas);\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var newImage = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                newImage.src = img;\r\n                newImage.onload = function () {\r\n                    if (size) {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0, size.width, size.height);\r\n                    } else {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0);\r\n                    }\r\n                    resolve(newCanvas);\r\n                }\r\n            });\r\n        },\r\n\r\n        cloneCanvas: function (oldCanvas) {\r\n            //create a new canvas\r\n            var newCanvas = document.createElement('canvas');\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            //set dimensions\r\n            newCanvas.width = oldCanvas.width;\r\n            newCanvas.height = oldCanvas.height;\r\n\r\n            //apply the old canvas to the new one\r\n            context.drawImage(oldCanvas, 0, 0);\r\n\r\n            //return the new canvas\r\n            return newCanvas;\r\n        },\r\n\r\n        calculateAspectRatioFit: function (srcWidth, srcHeight, maxWidth, maxHeight) {\r\n            var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\r\n\r\n            return { width: srcWidth * ratio, height: srcHeight * ratio };\r\n        },\r\n\r\n        getFormattedDate: function (date, hasTime) {\r\n            function pad(s) { return (s < 10) ? '0' + s : s; }\r\n\r\n            var d = new Date(date);\r\n            return [d.getFullYear(), pad(d.getMonth() + 1), pad(d.getDate())].concat(hasTime ? [\"_\", pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())] : []).join('');\r\n\r\n        },\r\n\r\n        replaceAccent: function (t) {\r\n            var translate = {\r\n                \"ä\": \"a\", \"ö\": \"o\", \"ü\": \"u\",\r\n                \"Ä\": \"A\", \"Ö\": \"O\", \"Ü\": \"U\",\r\n                \"á\": \"a\", \"é\": \"e\", \"i\": \"i\", \"ó\": \"o\", \"ú\": \"u\",\r\n                \"Á\": \"A\", \"É\": \"E\", \"Í\": \"I\", \"Ó\": \"O\", \"Ú\": \"U\",\r\n                \"ñ\": \"n\", \"Ñ\": \"N\"\r\n            };\r\n            return t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑ]/g, function (match) {\r\n                return translate[match];\r\n            });\r\n        },\r\n\r\n        downloadFileForm: function (url, data) {\r\n            var download = function (url, data) {\r\n\r\n                new Promise(function (resolve, reject) {\r\n                    const request = new XMLHttpRequest();\r\n                    request.responseType = \"blob\";\r\n                    request.open(\"POST\", url);\r\n                    request.setRequestHeader('Content-Type', 'application/xml; charset=UTF-8');\r\n\r\n                    request.onreadystatechange = function (e) {\r\n                        if (request.readyState === 4) { // DONE\r\n                            if (request.status !== 200) {\r\n                                reject({\r\n                                    status: request.status,\r\n                                    msg: request.statusText,\r\n                                    url: options.url\r\n                                });\r\n                            } else {\r\n\r\n                                try {\r\n                                    //URI: Miro si devuelve una cabecera content-disposition attachment. Si es asi uso el filenae como nombre de fichero. Esta descarga seguramente venga\r\n                                    //de un proxy con postproceso de zippeado\r\n                                    const contentDispositionHeader = request.getResponseHeader(\"Content-disposition\");\r\n                                    var filename = \"\";\r\n                                    if (contentDispositionHeader) {\r\n                                        filename = contentDispositionHeader.split(\"; \")[1].substring(9);\r\n                                        if (contentDispositionHeader.split(\"; \")[0] !== \"attachment\") {\r\n                                            filename = filename.substring(0, filename.lastIndexOf(\".\"));\r\n                                        }\r\n                                    }\r\n                                    resolve({ data: request.response, contentType: request.getResponseHeader(\"Content-type\"), filename: filename });\r\n                                }\r\n                                catch (error) {\r\n                                    reject(error);\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    try {\r\n                        request.send(data);\r\n                    } catch (error) {\r\n                        reject(error);\r\n                    }\r\n                }).then(function (response) {\r\n                    var format = \"\";\r\n                    if (response.data.type.indexOf(\"kml\") >= 0)\r\n                        format = \".kml\";\r\n                    else if (response.data.type.indexOf(\"json\") >= 0)\r\n                        format = \".geojson\";\r\n                    else if (response.data.type.indexOf(\"xml\") >= 0)\r\n                        format = \".gml\";\r\n                    TC.Util.downloadFile((response.filename ? response.filename : TC.getUID()) + format, response.contentType, response.data)\r\n                });\r\n            };            \r\n            var htmlObj = [];\r\n            if (Array.isArray(url)) {\r\n                var arrDownloads = url;\r\n                for (var i = 0; i < arrDownloads.length; i++) {\r\n                    download(arrDownloads[i].url, arrDownloads[i].data);\r\n                }\r\n            }\r\n            else {\r\n                download(url, data);\r\n            }            \r\n        },\r\n\r\n        WFSQueryBuilder: function (layers, filter, capabilities, outputFormat, onlyHits, srsName) {\r\n            const getSRSAttribute = function () {                \r\n                if (srsName) {\r\n                    return ' srsName=\"' + srsName +'\"'\r\n                }\r\n                else\r\n                    return '';\r\n            }\r\n            if (!Array.isArray(layers))\r\n                layers = [layers];\r\n            var queryHeader = 'xsi:schemaLocation=\"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd\" ' +\r\n                'xmlns:ogc=\"http://www.opengis.net/ogc\" service=\"WFS\" {resultType} {format} ';\r\n            switch (capabilities.version) {\r\n                case \"1.0.0\":\r\n                case \"1.1.0\":\r\n                    queryHeader += 'xmlns:gml=\"http://www.opengis.net/gml\" xmlns:wfs=\"http://www.opengis.net/wfs\" ';\r\n                    break;\r\n                case \"2.0.0\":\r\n                    queryHeader += 'xmlns:wfs=\\\"http://www.opengis.net/wfs/2.0\\\" xmlns:gml=\\\"http://www.opengis.net/gml/3.2\\\" ';\r\n                    break;\r\n            }\r\n            for (var i in capabilities) {\r\n                if (typeof (capabilities[i]) === \"string\" && i.indexOf(\"gml\") < 0 && capabilities[i].indexOf(\"wfs\") < 0)\r\n                    queryHeader += (i + '=\"' + capabilities[i] + '\" ');\r\n            }\r\n\r\n            var query = '<wfs:GetFeature ' + queryHeader.format({ resultType: (onlyHits ? 'resultType=\"hits\"' : ''), format: 'outputFormat=\"' + outputFormat + '\"' }) + '>';\r\n            var queryBody = '';\r\n\r\n            var queryItem = '<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + getSRSAttribute() + '>{filter}</wfs:Query>';\r\n            layers.forEach(function (value) {\r\n                queryBody += queryItem.format({ typeName: value, filter: (filter ? filter.getText(capabilities.version) : \"\") });\r\n            });\r\n            query += queryBody + '</wfs:GetFeature>'\r\n            return query;\r\n        },\r\n\r\n        WFSFilterBuilder: function (feature, version, srsName) {\r\n            var filter = '';\r\n            if (Util.isPlainObject(feature)) {\r\n                filter = '<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name=\"querySingle\"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'\r\n                    .format({ prefix: (version === \"2.0.0\" ? \"fes\" : \"ogc\"), \"clipLayer\": feature.clipLayer, \"geometryName\": feature.geometryName, \"where\": feature.where })\r\n            }\r\n            else {\r\n                switch (true) {\r\n                    case !feature:\r\n                        break;\r\n                    case Array.isArray(feature)://bbox\r\n                        var gmlEnvelope = ('<gml:Envelope>' +\r\n                            '<gml:lowerCorner>{lowerCorner}</gml:lowerCorner>' +\r\n                            '<gml:upperCorner>{upperCorner}</gml:upperCorner>' +\r\n                            '</gml:Envelope>').format({ lowerCorner: (feature[0] + ' ' + feature[1]), upperCorner: (feature[2] + ' ' + feature[3]) });\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:BBOX>' + gmlEnvelope + '</ogc:BBOX></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:BBOX>' + gmlEnvelope + '</fes:BBOX></fes:Filter>';\r\n                                break;\r\n                        }\r\n                        break;\r\n                    case feature instanceof TC.Feature:\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>' + TC.Util.writeGMLGeometry(feature, { version: \"2.0\", srsName: srsName  }) + '</ogc:Intersects></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>' + TC.Util.writeGMLGeometry(feature, { version: \"3.2\", srsName: srsName }) + '</fes:Intersects></fes:Filter>';\r\n                                break;\r\n                        }\r\n\r\n                        break;\r\n                    default:\r\n                        TC.error(\"Geometr\\u00eda no v\\u00e1lida\");\r\n                        break;\r\n                }\r\n            }\r\n\r\n            return filter;\r\n        },\r\n\r\n        writeGMLGeometry: function (feature, options) {\r\n            options = options || {};\r\n            const gmlVersion = options.version;\r\n            const getSRSName = function () {\r\n                if (options.srsName) {\r\n                    return ' srsName=\"' + options.srsName + '\"'\r\n                }\r\n                else\r\n                    return '';\r\n            };\r\n            var getGmlCoordinates = function (coords) {\r\n                var result;\r\n                if (gmlVersion.indexOf('3') === 0) {\r\n                    result = coords.toString();\r\n                    while (result.indexOf(\",\") >= 0) {\r\n                        result = result.replace(\",\", \" \");\r\n                    }\r\n                }\r\n                else {\r\n                    result = coords.map(function (coord) {\r\n                        return coord.join(',');\r\n                    }).join(' ');\r\n                }\r\n                return result;\r\n            };\r\n\r\n            switch (gmlVersion) {\r\n                case \"3.1.1\":\r\n                    break;\r\n                case \"3.2\":\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString srsDimension=\\\"2\\\"\" + getSRSName()+\"><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry) +\r\n                                \"</gml:posList></gml:LineString>\";\r\n                            break;\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon srsDimension=\\\"2\\\"\" + getSRSName() +\"><gml:exterior><gml:LinearRing><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n                case \"2.0\":\r\n                default:\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString\" + getSRSName() +\"><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LineString>\";\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon\" + getSRSName() +\"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n\r\n        isServiceWorker: function () {\r\n            if (navigator.serviceWorker) {\r\n                if (navigator.serviceWorker.controller && navigator.serviceWorker.controller.state === \"activated\") {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n\r\n        isSameOriginByLocation: function (uri, location) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var uProtocol = urlParts[1];\r\n                result = (uProtocol == location.protocol || uProtocol == undefined) && urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        isSameProtocol: function (uri, location) {\r\n            if (uri.match(/^(\\/\\/)/i)) {\r\n                return true;\r\n            }\r\n            var protocolRegex = /^(https?:\\/\\/)/i;\r\n            var uriProtocol = uri.match(protocolRegex);\r\n            if (uriProtocol && uriProtocol.length > 1) {\r\n                var locationProtocol = location.match(protocolRegex);\r\n                if (locationProtocol && locationProtocol.length > 1) {\r\n                    return uriProtocol[0].trim() === locationProtocol[0].trim();\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        consoleRegister: function (msg) {\r\n            if (TC.isDebug) {\r\n                console.log(msg);\r\n            }\r\n        },\r\n\r\n        getSorterByProperty: function (propName) {\r\n            return function (a, b) {\r\n                if (a[propName] > b[propName]) {\r\n                    return 1;\r\n                }\r\n                if (a[propName] < b[propName]) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            };\r\n        },\r\n\r\n        getSoundexDifference: function (a, b) {\r\n            var res = 0\r\n\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (a.charAt(i) == b.charAt(i)) {\r\n                    res++;\r\n                }\r\n            }\r\n\r\n            return res;\r\n        },\r\n\r\n        toAbsolutePath: function (href) {\r\n            var link = document.createElement(\"a\");\r\n            link.href = href;\r\n            return link.href;\r\n        },\r\n\r\n        getRenderedHtml: function (templateId, template, data, callback) {\r\n            return new Promise(function (resolve, reject) {\r\n                var render = function () {\r\n                    if (dust.cache[templateId]) {\r\n                        dust.render(templateId, data, function (err, out) {\r\n                            if (err) {\r\n                                TC.error(err);\r\n                                reject(Error(err));\r\n                            }\r\n                            else {\r\n                                if (Util.isFunction(callback)) {\r\n                                    callback(out);\r\n                                }\r\n                                resolve(out);\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n                TC.loadJSInOrder(\r\n                    !window.dust,\r\n                    TC.url.templating,\r\n                    function () {\r\n                        if (!dust.cache[templateId]) {\r\n                            if (typeof template === 'string') {\r\n                                TC.ajax({\r\n                                    url: template,\r\n                                    method: \"GET\",\r\n                                    responseType: 'text'\r\n                                })\r\n                                    .then(function (response) {\r\n                                        const html = response.data;\r\n                                        var tpl = dust.compile(html, templateId);\r\n                                        dust.loadSource(tpl);\r\n                                        render();\r\n                                    })\r\n                                    .catch(function (err) {\r\n                                        console.log(\"Error fetching template: \" + err)\r\n                                    });\r\n                            }\r\n                            else if (Util.isFunction(template)) {\r\n                                template();\r\n                                render();\r\n                            }\r\n                        }\r\n                        else {\r\n                            render();\r\n                        }\r\n                    }\r\n                );\r\n            });\r\n        },\r\n\r\n        explodeGeometry: function (obj) {\r\n            const origin = obj.origin;\r\n            const iterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(iterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = elm + origin[0];\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = elm + origin[1];\r\n                    }\r\n                }\r\n            };\r\n            obj.geom.forEach(iterationFunction);\r\n            return obj.geom;\r\n        },\r\n\r\n        cloneMappingFunction: function (elm) {\r\n            if (Array.isArray(elm)) {\r\n                return elm.map(TC.Util.cloneMappingFunction);\r\n            }\r\n            return elm;\r\n        },\r\n\r\n        compactGeometry: function (geometry, precision) {\r\n            const origin = [Number.MAX_VALUE, Number.MAX_VALUE];\r\n            const newGeom = geometry.map(TC.Util.cloneMappingFunction);\r\n            const firstIterationFunction = function (elm, idx) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(firstIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0 && elm < origin[0]) {\r\n                        origin[0] = elm;\r\n                    }\r\n                    else if (idx === 1 && elm < origin[1]) {\r\n                        origin[1] = elm;\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(firstIterationFunction);\r\n\r\n            const round = function (val) {\r\n                return Math.round(val * precision) / precision;\r\n            }\r\n            origin[0] = round(origin[0]);\r\n            origin[1] = round(origin[1]);\r\n            const secondIterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(secondIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = round(elm - origin[0]);\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = round(elm - origin[1]);\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(secondIterationFunction);\r\n            return {\r\n                origin: origin,\r\n                geom: newGeom\r\n            }\r\n        }\r\n    };\r\n    String.prototype.format = function () {\r\n        var str = this.toString();\r\n        if (!arguments.length)\r\n            return str;\r\n        var args = typeof arguments[0],\r\n            args = ((\"string\" == args || \"number\" == args) ? arguments : arguments[0]);\r\n        for (arg in args)\r\n            str = str.replace(RegExp(\"\\\\{\" + arg + \"\\\\}\", \"gi\"), args[arg]);\r\n        return str;\r\n    };\r\n    var fncOvelaps = function (elem1, elem2,comparisonFnc) {        \r\n        return comparisonFnc(elem1.getBoundingClientRect(), elem2.getBoundingClientRect());\r\n    }\r\n    if (this.HTMLElement) {\r\n        HTMLElement.prototype.colliding = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.top > rect2.bottom ||\r\n                    rect1.right < rect2.left ||\r\n                    rect1.bottom < rect2.top ||\r\n                    rect1.left > rect2.right\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.containing = function (other) {\r\n            fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.left <= rect2.left &&\r\n                    rect2.left < rect1.width &&\r\n                    rect1.top <= rect2.top &&\r\n                    rect2.top < rect1.height\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.inside = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return (\r\n                    ((rect2.top <= rect1.top) && (rect1.top <= rect2.bottom)) &&\r\n                    ((rect2.top <= rect1.bottom) && (rect1.bottom <= rect2.bottom)) &&\r\n                    ((rect2.left <= rect1.left) && (rect1.left <= rect2.right)) &&\r\n                    ((rect2.left <= rect1.right) && (rect1.right <= rect2.right))\r\n                );\r\n            });\r\n        };\r\n    }\r\n    return Util;\r\n});\r\n"]}