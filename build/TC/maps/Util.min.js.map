{"version":3,"sources":["Util.js"],"names":["TC","root","factory","exports","module","define","amd","Util","String","prototype","soundex","a","this","toLowerCase","split","f","shift","r","codes","e","i","o","u","b","p","v","c","g","j","k","q","s","x","z","d","t","l","m","n","map","filter","join","slice","toUpperCase","Number","isInteger","value","isFinite","Math","floor","toLocaleString","locale","options","detectIE","apply","arguments","sNum","replace","iconUrlCache","markerGroupClassCache","path1","path2","getOnPath","obj","length","hasOwnProperty","swipeHandlers","WeakMap","modalCloseHandlers","hasOwn","isPlainObject","nodeType","window","constructor","call","isEmptyObject","name","isFunction","extend","clone","target","deep","len","src","copy","copyIsArray","Array","isArray","undefined","getMapLocale","regex","PROTOCOL","isOnCapabilities","url","withProtocol","testUrl","capabilities","reqGetMapOnCapabilities","caps","getFnFromString","fnName","scope","scopeSplit","isURL","text","test","isSecureURL","isSameOrigin","uri","result","indexOf","urlParts","match","Consts","SPLIT_REGEX","location","uProtocol","protocol","hostname","uPort","lPort","port","formatNumber","parseFloat","valueOf","addProtocol","getDiv","div","document","getElementById","HTMLElement","$","createElement","getScriptLocation","script","currentScript","scripts","getElementsByTagName","getAttribute","substr","lastIndexOf","getBackgroundUrlFromCss","cssClass","iconDiv","style","display","classList","add","body","appendChild","exec","getComputedStyle","backgroundImage","parentElement","removeChild","getPointIconUrl","className","classes","Cfg","styles","marker","group","key","point","getLegendImageFromStyle","width","height","strokeWidth","strokeHalfWidth","diameter","radius","lineDashText","lineDash","max","geometryType","geom","POINT","strokeColor","fillColor","fillOpacity","POLYLINE","POLYGON","encodeURIComponent","addArrayToTree","path","treeNode","index","found","children","title","uid","push","parseCoords","_parseGeoCoord","type","GEOGRAPHIC","idx","_parseCoord","trim","UTM","xy","y","reproject","coords","sourceCrs","targetCrs","multipoint","multiring","multipoly","loadProjDef","crs","sync","sourcePrj","proj4","defs","targetPrj","forEach","poly","pidx","rp","ring","ridx","rr","coord","cidx","oProj","units","METERS","round","getMetersPerDegree","extent","dLat","degToRad","sindlat2","sin","atan2","sqrt","radToDeg","rad","PI","deg","mod","getCRSCode","CRSCodesEqual","crs1","crs2","code1","code2","getLocaleString","texts","i18n","getSimpleMimeType","mimeType","end","substring","getQueryStringParams","queryString","queryIdx","fragmentIdx","search","elm","bind","getParamString","arr","fastUnshift","storage","getCookie","cookie","setCookie","getLocalValue","localStorage","Storage","getItem","setLocalValue","removeItem","setItem","exDate","Date","setDate","getDate","expires","getSessionLocalValue","sessionStorage","setSessionLocalValue","detectFirefox","navigator","userAgent","RegExp","$1","ua","msie","parseInt","rv","edge","detectChrome","chrome","detectSafari","detectMouse","matchesCoarse","matchMedia","matches","matchesFine","mqResult","mq","hover","browserFeatures","touch","media","testHover","detectAndroid","detectBlackBerry","detectIOS","detectMobileWindows","detectMobile","getBrowser","UAParser","syncLoadJS","apiLocation","UA_PARSER","browser","version","major","getElementByNodeName","parentNode","nodeName","colonIndex","tag","nodes","getElementsByTagNameNS","addURLParameters","parameters","toAdd","Object","keys","urlparts","params","removeURLParameter","parameter","prefix","pars","splice","showModal","contentNode","hidden","get","VISIBLE","closeButton","querySelectorAll","closeCallback","delete","stopPropagation","closeModal","set","addEventListener","openCallback","callback","hide","modal","remove","closeAlert","btn","swipe","addListeners","handlers","start","removeEventListener","minDistance","maxCrossDistance","maxAllowedTime","touchStartCoords","touchEndCoords","startTime","noSwipe","mustSwipe","changedTouches","pageX","pageY","getTime","startCoords","endCoords","dx","dy","adx","abs","ady","getDirection","getParameterByName","results","decodeURIComponent","getLocaleUserChoice","cookieName","paramName","browserLanguage","languages","language","userLanguage","lang","hyphenIdx","expirationDate","getValidFilename","filename","downloadBlob","blob","link","download","URL","createObjectURL","setAttribute","visibility","click","downloadFile","data","Blob","msSaveBlob","downloadDataURI","dataURI","binary","atob","array","charCodeAt","Uint8Array","shortenUrl","Promise","resolve","reject","ajax","access_token","longUrl","then","response","catch","utf8ToBase64","str","btoa","unescape","base64ToUtf8","escape","error","colorArrayToString","color","reduce","prev","cur","toString","operation","list1","list2","comparerFn","operationIsUnion","item1","inBoth","inFirstOnly","inSecondOnly","toDataUrl","canvas","backgroundColour","_ref","encoderOptions","context","getContext","getImageData","compositeOperation","globalCompositeOperation","fillStyle","fillRect","imageData","toDataURL","clearRect","putImageData","imgToDataUrl","outputFormat","createCanvas","img","ctx","drawImage","Image","crossOrigin","onload","dataURL","dataUrl","proxify","onerror","xhr","XMLHttpRequest","open","setRequestHeader","responseType","status","uInt8Array","binaryString","fromCharCode","getResponseHeader","onreadystatechange","readyState","Error","send","complete","imgTagToDataUrl","base64","addToCanvas","position","size","newCanvas","cloneCanvas","newImage","oldCanvas","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","ratio","min","getFormattedDate","date","hasTime","pad","getFullYear","getMonth","concat","getHours","getMinutes","getSeconds","replaceAccent","translate","ä","ö","ü","Ä","Ö","Ü","á","é","ó","ú","Á","É","Í","Ó","Ú","ñ","Ñ","downloadFileForm","async","_err","request","msg","statusText","contentDispositionHeader","contentType","format","includes","DownloadError","MIMETYPE_NOT_SUPORTED","getUID","arrDownloads","err","WFSQueryBuilder","layers","onlyHits","srsName","maxFeatures","getSRSAttribute","queryHeader","query","resultType","queryBody","queryItem","typeName","Filter","getText","layer","WFSFilterBuilder","feature","clipLayer","geometryName","where","gmlEnvelope","lowerCorner","upperCorner","Feature","writeGMLGeometry","gmlVersion","getSRSName","getGmlCoordinates","Polyline","geometry","isServiceWorker","serviceWorker","controller","state","isSameOriginByLocation","isSameProtocol","protocolRegex","uriProtocol","locationProtocol","consoleRegister","isDebug","console","log","getSorterByProperty","propName","getSoundexDifference","res","charAt","toAbsolutePath","href","explodeGeometry","origin","iterationFunction","cloneMappingFunction","isGeometry","compactGeometry","precision","MAX_VALUE","newGeom","firstIterationFunction","val","secondIterationFunction","hasStyleOptions","formatCoord","nDecimales","maximumFractionDigits","args","arg","fncOvelaps","elem1","elem2","comparisonFnc","getBoundingClientRect","colliding","other","rect1","rect2","top","bottom","right","left","containing","inside"],"mappings":"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","sourcesContent":["; var TC = TC || {};\r\n(function (root, factory) {\r\n    if (typeof exports === \"object\") { // CommonJS\r\n        module.exports = factory();\r\n    } else if (typeof define === \"function\" && define.amd) { // AMD\r\n        define([], factory);\r\n    } else {\r\n        root.Util = factory();\r\n    }\r\n})(TC, function () {\r\n\r\n    String.prototype.soundex = function () {\r\n        var a = this.toLowerCase().split('')\r\n        f = a.shift(),\r\n            r = '',\r\n            codes = {\r\n                a: '', e: '', i: '', o: '', u: '',\r\n                b: 1, f: 1, p: 1, v: 1,\r\n                c: 2, g: 2, j: 2, k: 2, q: 2, s: 2, x: 2, z: 2,\r\n                d: 3, t: 3,\r\n                l: 4,\r\n                m: 5, n: 5,\r\n                r: 6\r\n            };\r\n\r\n        r = f +\r\n            a\r\n                .map(function (v, i, a) { return codes[v] })\r\n                .filter(function (v, i, a) { return ((i === 0) ? v !== codes[f] : v !== a[i - 1]); })\r\n                .join('');\r\n\r\n        return (r + '000').slice(0, 4).toUpperCase();\r\n    }\r\n\r\n    // Polyfill para IE\r\n    Number.isInteger = Number.isInteger || function (value) {\r\n        return typeof value === \"number\" &&\r\n            isFinite(value) &&\r\n            Math.floor(value) === value;\r\n    };\r\n\r\n    // GLS: Parche: Chrome no formatea correctamente los números en euskera, establece como separador de decimales el (.)\r\n    var toLocaleString = Number.prototype.toLocaleString;\r\n    Number.prototype.toLocaleString = function (locale, options) {\r\n        if (locale == \"eu-ES\" && !TC.Util.detectIE()) {\r\n            var sNum = toLocaleString.apply(this, arguments);\r\n            sNum = sNum.replace(/\\,/g, '.')\r\n            if (!(Math.floor(this) == this && Number.isInteger(Math.floor(this))))\r\n                sNum = sNum.replace(/.([^.]*)$/, \",$1\");\r\n\r\n            return sNum;\r\n        }\r\n        else\r\n            return toLocaleString.apply(this, arguments);\r\n    }\r\n\r\n    var iconUrlCache = {};\r\n    var markerGroupClassCache = {};\r\n\r\n    var path1 = [\"Capability\", \"Request\", \"GetMap\", \"DCPType\", \"0\", \"HTTP\", \"Get\", \"OnlineResource\"];\r\n    var path2 = [\"OperationsMetadata\", \"GetTile\", \"DCP\", \"HTTP\", \"Get\", \"0\", \"href\"];\r\n    var getOnPath = function (obj, p, i) {\r\n        if (i < p.length - 1) {\r\n            if (obj.hasOwnProperty(p[i]))\r\n                return getOnPath(obj[p[i]], p, ++i);\r\n            else return null;\r\n        } else {\r\n            return obj[p[i]];\r\n        }\r\n    };\r\n\r\n    const swipeHandlers = new WeakMap();\r\n    const modalCloseHandlers = new WeakMap();\r\n    const hasOwn = ({}).hasOwnProperty;\r\n\r\n    var Util = {\r\n\r\n        isPlainObject: function (obj) {\r\n            // Not plain objects:\r\n            // - Any object or value whose internal [[Class]] property is not \"[object Object]\"\r\n            // - DOM nodes\r\n            // - window\r\n            if (typeof obj !== 'object' || obj.nodeType || obj.window === obj) {\r\n                return false;\r\n            }\r\n\r\n            if (obj.constructor &&\r\n                !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {\r\n                return false;\r\n            }\r\n\r\n            // If the function hasn't returned already, we're confident that\r\n            // |obj| is a plain object, created by {} or constructed with new Object\r\n            return true;\r\n        },\r\n\r\n        isEmptyObject: function (obj) {\r\n            var name;\r\n            for (name in obj) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n\r\n        isFunction: function (obj) {\r\n            return typeof obj === 'function';\r\n        },\r\n\r\n        extend: function () {\r\n            var clone,\r\n                target = arguments[0] || {},\r\n                i = 1,\r\n                deep = false;\r\n\r\n            // Comprobar si hay que hacer copia profunda (primer parámetro === true)\r\n            if (typeof target === 'boolean') {\r\n                deep = target;\r\n\r\n                target = arguments[i] || {};\r\n                i++;\r\n            }\r\n\r\n            // Handle case when target is a string or something (possible in deep copy)\r\n            if (typeof target !== 'object' && !Util.isFunction(target)) {\r\n                target = {};\r\n            }\r\n\r\n            for (var len = arguments.length; i < len; i++) {\r\n                // Only deal with non-null/undefined values\r\n                const options = arguments[i];\r\n                if (options != null) {\r\n                    // Extend the base object\r\n                    for (var name in options) {\r\n                        const src = target[name];\r\n                        const copy = options[name];\r\n\r\n                        // Prevent never-ending loop\r\n                        if (target === copy) {\r\n                            continue;\r\n                        }\r\n\r\n                        // Recurse if we're merging plain objects or arrays\r\n                        const copyIsArray = Array.isArray(copy);\r\n                        if (deep && copy && (Util.isPlainObject(copy) || copyIsArray)) {\r\n                            if (copyIsArray) {\r\n                                clone = src && Array.isArray(src) ? src : [];\r\n\r\n                            } else {\r\n                                clone = src && Util.isPlainObject(src) ? src : {};\r\n                            }\r\n\r\n                            // Never move original objects, clone them\r\n                            target[name] = Util.extend(deep, clone, copy);\r\n\r\n                            // Don't bring in undefined values\r\n                        } else if (copy !== undefined) {\r\n                            target[name] = copy;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Return the modified object\r\n            return target;\r\n        },\r\n\r\n        getMapLocale: function (map) {\r\n            return map.options && map.options.locale && map.options.locale.replace('_', '-') || \"es-ES\";\r\n        },\r\n\r\n        regex: {\r\n            PROTOCOL: /(^https?:)/i\r\n        },\r\n\r\n        isOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            if (withProtocol) {\r\n                if (TC.capabilities[testUrl])\r\n                    return url;\r\n            } else {\r\n                for (var c in TC.capabilities) {\r\n                    if (c.replace(TC.Util.regex.PROTOCOL, \"\") == testUrl)\r\n                        return c;\r\n                }\r\n            }\r\n\r\n            for (c in TC.capabilities) {\r\n                var u = getOnPath(TC.capabilities[c], path1, 0) || getOnPath(TC.capabilities[c], path2, 0);\r\n\r\n                if (u && withProtocol && url == u) return u;\r\n                else if (u && url.replace(TC.Util.regex.PROTOCOL, \"\") == u.replace(TC.Util.regex.PROTOCOL, \"\")) return u;\r\n            }\r\n\r\n            return url;\r\n        },\r\n\r\n        reqGetMapOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(TC.Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            var _get = function (caps) {\r\n                var u = getOnPath(caps, path1, 0) || getOnPath(caps, path2, 0);\r\n                if (u)\r\n                    return !withProtocol ? u.split('?')[0].replace(TC.Util.regex.PROTOCOL, \"\") : u.split('?')[0];\r\n\r\n                return null;\r\n            };\r\n            if (TC.capabilities[url]) {\r\n                return _get(TC.capabilities[url]);\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        getFnFromString: function (fnName) {\r\n            var scope = window;\r\n            var scopeSplit = fnName.split('.');\r\n            for (i = 0; i < scopeSplit.length - 1; i++) {\r\n                scope = scope[scopeSplit[i]];\r\n\r\n                if (scope == undefined) return;\r\n            }\r\n\r\n            return scope[scopeSplit[scopeSplit.length - 1]];\r\n        },\r\n\r\n        isURL: function (text) {\r\n            return /^(http|https|ftp|mailto)\\:\\/\\//i.test(text);\r\n        },\r\n\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        isSameOrigin: function (uri) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var location = window.location;\r\n                var uProtocol = urlParts[1];\r\n                result =\r\n                    (uProtocol == location.protocol || uProtocol == undefined) &&\r\n                    urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        formatNumber: function (value, locale) {\r\n            var t = typeof value;\r\n            if (t === 'number') {\r\n                return value.toLocaleString(locale);\r\n            }\r\n            else if (t === 'string') {\r\n                n = parseFloat(value);\r\n                if (n === new Number(value).valueOf()) {\r\n                    return n.toLocaleString(locale);\r\n                }\r\n            }\r\n            return value;\r\n        },\r\n\r\n        addProtocol: function (uri) {\r\n            var result = uri;\r\n            if (uri && uri.indexOf('//') === 0) {\r\n                result = location.protocol + uri;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * getDiv: returns HTML element or null if the parameter is invalid\r\n        * Parameter: string with element ID or HTML element\r\n        */\r\n        getDiv: function (div) {\r\n            var result;\r\n            if (typeof div === 'string') {\r\n                result = document.getElementById(div);\r\n            }\r\n            else if (div instanceof HTMLElement) {\r\n                result = div;\r\n            }\r\n            else if (div && '$' in window && div instanceof $ && div.length) {\r\n                result = div[0];\r\n            }\r\n            else {\r\n                result = document.createElement('div');\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getScriptLocation: function () {\r\n            var src;\r\n            var script;\r\n            if (document.currentScript) {\r\n                script = document.currentScript;\r\n            }\r\n            else {\r\n                var scripts = document.getElementsByTagName('script');\r\n                script = scripts[scripts.length - 1];\r\n            }\r\n            src = script.getAttribute('src');\r\n            if (src) {\r\n                return src.substr(0, src.lastIndexOf('/') + 1);\r\n            }\r\n            return \"\";\r\n        },\r\n\r\n        /* \r\n        * getBackgroundUrlFromCss: devuelve la URL de background-image en CSS\r\n        * Parameter: string con nombre de clase\r\n        */\r\n        getBackgroundUrlFromCss: function (cssClass) {\r\n            var result = '';\r\n\r\n            if (cssClass) {\r\n                if (iconUrlCache[cssClass] !== undefined) {\r\n                    result = iconUrlCache[cssClass];\r\n                }\r\n                else {\r\n                    const iconDiv = document.createElement('div');\r\n                    iconDiv.style.display = 'none';\r\n                    iconDiv.classList.add(cssClass);\r\n                    document.body.appendChild(iconDiv);\r\n                    // The regular expression is nongreedy (.*?), otherwise in FF and IE it gets 'url_to_image\"'\r\n                    var match = /^url\\(['\"]?(.*?)['\"]?\\)$/gi.exec(window.getComputedStyle(iconDiv, null).backgroundImage);\r\n                    if (match && match.length > 1) {\r\n                        result = match[match.length - 1];\r\n                    }\r\n                    iconDiv.parentElement.removeChild(iconDiv);\r\n                    iconUrlCache[cssClass] = result;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getPointIconUrl: function getPointIconUrl(options) {\r\n            var result = null;\r\n            if (options.url) {\r\n                result = options.url;\r\n            }\r\n            else {\r\n                var className;\r\n                if (typeof options.cssClass === 'string') {\r\n                    className = options.cssClass;\r\n                }\r\n                else {\r\n                    var classes = options.classes || TC.Cfg.styles.marker.classes;\r\n                    className = classes[0];\r\n                    if (options.group) {\r\n                        if (markerGroupClassCache[options.group] === undefined) {\r\n                            var i = 0;\r\n                            for (var key in markerGroupClassCache) {\r\n                                i++;\r\n                            }\r\n                            i = i % classes.length;\r\n                            markerGroupClassCache[options.group] = classes[i];\r\n                        }\r\n                        className = markerGroupClassCache[options.group];\r\n                    }\r\n                }\r\n                result = TC.Util.getBackgroundUrlFromCss(className);\r\n            }\r\n            if (!result && options !== TC.Cfg.styles.point && options.cssClass !== '') {\r\n                result = getPointIconUrl(TC.Cfg.styles.point);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getLegendImageFromStyle: function (style, options) {\r\n            let result = null;\r\n            options = options || {};\r\n            if (style.url) {\r\n                result = style.url;\r\n            }\r\n            else {\r\n                let width = options.width || 32;\r\n                let height = options.height || 16;\r\n                const strokeWidth = style.strokeWidth || 0;\r\n                const strokeHalfWidth = strokeWidth / 2;\r\n                const diameter = (style.radius || 0) * 2 + strokeWidth;\r\n                const lineDashText = style.lineDash ? `stroke-dasharray=\"${style.lineDash.join(' ')}\" ` : '';\r\n                let body;\r\n                width = Math.max(width, diameter);\r\n                height = Math.max(height, diameter);\r\n                switch (options.geometryType) {\r\n                    case TC.Consts.geom.POINT:\r\n                        body = `<circle cx=\"${width / 2}\" cy=\"${height / 2}\" r=\"${style.radius}\" stroke=\"${style.strokeColor}\" stroke-width=\"${strokeWidth}\" fill=\"${style.fillColor}\" fill-opacity=\"${style.fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                    case TC.Consts.geom.POLYLINE:\r\n                        const xStart = strokeHalfWidth;\r\n                        const yStart = height - strokeHalfWidth;\r\n                        const xEnd = width - strokeHalfWidth;\r\n                        const yEnd = strokeHalfWidth;\r\n                        body = `<polyline points=\"${xStart},${yStart} ${xEnd},${yEnd}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth}\" ${lineDashText}/>`;\r\n                        break;\r\n                    case TC.Consts.geom.POLYGON:\r\n                        const x1 = strokeHalfWidth;\r\n                        const y1 = height - strokeHalfWidth;\r\n                        const x2 = strokeHalfWidth;\r\n                        const y2 = strokeHalfWidth;\r\n                        const x3 = strokeHalfWidth + width * 0.8;\r\n                        const y3 = strokeHalfWidth;\r\n                        const x4 = width - strokeHalfWidth;\r\n                        const y4 = height - strokeHalfWidth;\r\n                        body = `<polygon points=\"${x1},${y1} ${x2},${y2} ${x3},${y3} ${x4},${y4}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth};fill:${style.fillColor};fill-opacity:${style.fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                    default:\r\n                        body = `<rect x=\"${strokeHalfWidth}\" x=\"${strokeHalfWidth}\" width=\"${width - strokeWidth}\" height=\"${height - strokeWidth}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth};fill:${style.fillColor};fill-opacity:${style.fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                }\r\n                result = 'data:image/svg+xml,' + encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\">${body}</svg>`);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * addPathToTree: añade a un array a un árbol, cada elemento en un nivel anidado\r\n        * Parameters: array, nodo de árbol, [índice]\r\n        * Returns: último nodo insertado, null si ya existía la ruta\r\n        */\r\n        addArrayToTree: function addArrayToTree(path, treeNode, index) {\r\n            var result = null;\r\n            var found = false;\r\n            index = index || 0;\r\n            var name = path[index];\r\n            if (name) {\r\n                var n;\r\n                for (var i = 0, len = treeNode.children.length; i < len; i++) {\r\n                    n = treeNode.children[i];\r\n                    if (n.name === name) {\r\n                        found = true;\r\n                        var r = addArrayToTree(path, n, index + 1);\r\n                        if (r) {\r\n                            result = r;\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (!found) {\r\n                    n = { name: name, title: name, uid: '/' + path.slice(0, index + 1).join('/'), children: [] };\r\n                    treeNode.children.push(n);\r\n                    result = n;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        parseCoords: function (text) {\r\n            var result = null;\r\n\r\n            var _parseGeoCoord = function (text) {\r\n                var t = text;\r\n                var result = {};\r\n                result.type = TC.Consts.GEOGRAPHIC;\r\n                var idx = t.indexOf('\\u00B0');\r\n                result.value = parseFloat(t.substr(0, idx));\r\n                t = t.substr(idx + 1);\r\n                idx = t.indexOf('\\'');\r\n                if (idx >= 0) {\r\n                    var v = parseFloat(t.substr(0, idx)) / 60;\r\n                    if (result.value >= 0) {\r\n                        result.value += v;\r\n                    }\r\n                    else {\r\n                        result.value -= v;\r\n                    }\r\n                    t = t.substr(idx + 1);\r\n                    idx = t.indexOf('\\'');\r\n                    if (idx >= 0) {\r\n                        v = parseFloat(t.substr(0, idx).replace(',', '.')) / 3600;\r\n                        if (result.value >= 0) {\r\n                            result.value += v;\r\n                        }\r\n                        else {\r\n                            result.value -= v;\r\n                        }\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n\r\n            var _parseCoord = function (text) {\r\n                var t = text.trim();\r\n                // nnºnn'nn''N\r\n                if (t.match(/^1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?\\s*[NnSsWwOoEe]$/g)) {\r\n                    switch (t[t.length - 1]) {\r\n                        case 'S':\r\n                        case 's':\r\n                        case 'W':\r\n                        case 'w':\r\n                        case 'O':\r\n                        case 'o':\r\n                            t = '-' + t;\r\n                            break;\r\n                    }\r\n                    t = t.substr(0, t.length - 1);\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // +nnºnn'nn''\r\n                if (t.match(/^[+-]?1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?$/g)) {\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // nn.nn N\r\n                if (t.match(/^1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?\\s*[NnSsWwOoEe]$/g)) {\r\n                    var result = { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.substr(0, t.length - 1).replace(',', '.')) };\r\n                    if (t.match(/[SsWwOo]$/)) {\r\n                        result.value = -result.value;\r\n                    }\r\n                    return result;\r\n                }\r\n                // +nn.nn\r\n                if (t.match(/^[+-]?1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?$/g)) {\r\n                    return { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                // UTM\r\n                if (t.match(/^\\d{6,7}([.,]\\d+)?$/g)) {\r\n                    return { type: TC.Consts.UTM, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                return null;\r\n            };\r\n\r\n            text = text.trim().toUpperCase();\r\n            var xy = text.split(',');\r\n            if (xy.length === 4) {\r\n                xy = [xy.slice(0, 1).join('.'), xy.slice(2, 3).join('.')];\r\n            }\r\n            else if (xy.length === 1 || xy.length === 3) {\r\n                xy = text.split(' ');\r\n            }\r\n            if (xy.length === 2) {\r\n                var x = _parseCoord(xy[0]);\r\n                var y = _parseCoord(xy[1]);\r\n                if (x !== null && y !== null) {\r\n                    result = [x, y];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        reproject: function (coords, sourceCrs, targetCrs) {\r\n            var result;\r\n            var multipoint = true;\r\n            var multiring = true;\r\n            var multipoly = true;\r\n            if (Array.isArray(coords[0])) {\r\n                if (Array.isArray(coords[0][0])) {\r\n                    if (!Array.isArray(coords[0][0][0])) {\r\n                        multipoly = false;\r\n                        coords = [coords];\r\n                    }\r\n                }\r\n                else {\r\n                    multiring = false;\r\n                    coords = [[coords]];\r\n                }\r\n            }\r\n            else {\r\n                multipoint = false;\r\n                multiring = false;\r\n                multipoly = false;\r\n                coords = [[[coords]]];\r\n            }\r\n            TC.loadProjDef({ crs: sourceCrs, sync: true });\r\n            TC.loadProjDef({ crs: targetCrs, sync: true });\r\n            var sourcePrj = proj4(proj4.defs[sourceCrs]);\r\n            var targetPrj = proj4(proj4.defs[targetCrs]);\r\n            result = new Array(coords.length);\r\n            coords.forEach(function (poly, pidx) {\r\n                const rp = result[pidx] = [];\r\n                poly.forEach(function (ring, ridx) {\r\n                    const rr = rp[ridx] = [];\r\n                    ring.forEach(function (coord, cidx) {\r\n                        var point = proj4(sourcePrj, targetPrj, { x: coord[0], y: coord[1] });\r\n                        if (targetPrj.oProj.units === TC.Consts.units.METERS) {\r\n                            rr[cidx] = [Math.round(point.x), Math.round(point.y)];\r\n                        } else {\r\n                            rr[cidx] = [point.x, point.y];\r\n                        }\r\n                        if (coord.length > 2) {\r\n                            rr[cidx][2] = coord[2];\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            if (!multipoint) {\r\n                result = result[0][0][0];\r\n            }\r\n            else if (!multiring) {\r\n                result = result[0][0];\r\n            }\r\n            else if (!multipoly) {\r\n                result = result[0];\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getMetersPerDegree: function (extent) {\r\n            var result = undefined;\r\n            var R = 6370997; // m\r\n            if (Array.isArray(extent) && extent.length >= 4) {\r\n                var dLat = this.degToRad(extent[3] - extent[1]);\r\n                var sindlat2 = Math.sin(dLat / 2);\r\n                var a = sindlat2 * sindlat2;\r\n                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n                result = R * c / (extent[3] - extent[1]);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        radToDeg: function (rad) { // convert radians to degrees\r\n            return rad * 180 / Math.PI;\r\n        },\r\n        degToRad: function (deg) { // convert degrees to radians\r\n            return deg * Math.PI / 180;\r\n        },\r\n        mod: function (n) { // modulo for negative values\r\n            return ((n % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);\r\n        },\r\n\r\n        getCRSCode: function (crs) {\r\n            var result = null;\r\n            crs = crs.trim();\r\n            if (/^EPSG:\\d{4,6}$/g.test(crs) || //formato EPSG\r\n                /^urn:ogc:def:crs:EPSG:.*:\\d{4,6}/g.test(crs) || // formato URN\r\n                /http:\\/\\/www.opengis.net\\/gml\\/srs\\/epsg.xml#\\d{4,6}$/g.test(crs)) { // formato GML\r\n                var match = crs.trim().match(/^.+[:#](\\d{4,6})$/); // devuelve la parte numérica del código\r\n                if (match) {\r\n                    result = match[1];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        CRSCodesEqual: function (crs1, crs2) {\r\n            if (crs1 === crs2) {\r\n                return true;\r\n            }\r\n            var code1 = this.getCRSCode(crs1);\r\n            var code2 = this.getCRSCode(crs2);\r\n            return code1 !== null && code2 !== null && code1 === code2;\r\n        },\r\n\r\n        getLocaleString: function (locale, key, texts) {\r\n            var result = key;\r\n            if (TC.i18n && TC.i18n[locale]) {\r\n                var text = TC.i18n[locale][key];\r\n                if (text) {\r\n                    result = text;\r\n                    if (texts) {\r\n                        for (var k in texts) {\r\n                            result = result.replace('{' + k + '}', texts[k]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getSimpleMimeType: function (mimeType) {\r\n            var result = '';\r\n            if (mimeType) {\r\n                var end = mimeType.indexOf(';');\r\n                if (end > 0) {\r\n                    mimeType = mimeType.substring(0, end);\r\n                }\r\n                result = mimeType;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getQueryStringParams: function (url) {\r\n            var queryString;\r\n            if (url) {\r\n                var queryIdx = url.indexOf('?');\r\n                if (queryIdx >= 0) {\r\n                    queryString = url.substr(queryIdx);\r\n                    var fragmentIdx = queryString.indexOf('#');\r\n                    if (fragmentIdx >= 0) {\r\n                        queryString = queryString.substr(0, fragmentIdx)\r\n                    }\r\n                }\r\n                else {\r\n                    queryString = '?';\r\n                }\r\n            }\r\n            else {\r\n                queryString = location.search;\r\n            }\r\n            var result = queryString.replace(/(^\\?)/, '').split(\"&\").map(function (elm) {\r\n                return elm = elm.split(\"=\"), this[elm[0]] = elm[1], this\r\n            }.bind({}))[0];\r\n            delete result[''];\r\n            return result;\r\n        },\r\n\r\n        getParamString: function (obj) {\r\n            const arr = [];\r\n            for (var key in obj) {\r\n                arr[arr.length] = encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]);\r\n            }\r\n            return arr.join('&').replace(/%20/g, '+');\r\n        },\r\n\r\n        fastUnshift: function (a, elm) {\r\n            var len = a.length;\r\n            while (len) {\r\n                a[len] = a[len - 1];\r\n                len--;\r\n            }\r\n            a[0] = elm;\r\n        },\r\n\r\n        storage: {\r\n            getCookie: function (key) {\r\n                return TC.cookie(key);\r\n            },\r\n            setCookie: function (key, value, options) {\r\n                return TC.cookie(key, value, options);\r\n            },\r\n            getLocalValue: function (key) {\r\n                var result = null;\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    result = localStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setLocalValue: function (key, value) {\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        localStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        localStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            },\r\n            getSessionLocalValue: function (key) {\r\n                var result = null;\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    result = sessionStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = TC.Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setSessionLocalValue: function (key, value) {\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        sessionStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        sessionStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        TC.Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        TC.Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            }\r\n        },\r\n        detectFirefox: function () {\r\n            if (/Firefox[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) //test for Firefox/x.x or Firefox x.x (ignoring remaining digits);\r\n                return new Number(RegExp.$1); // capture x.x portion and store as a number\r\n            else\r\n                return false;\r\n        },\r\n        detectIE: function () {\r\n            var ua = window.navigator.userAgent;\r\n\r\n            var msie = ua.indexOf('MSIE ');\r\n            if (msie > 0) {\r\n                // IE 10 or older => return version number\r\n                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n            }\r\n\r\n            var trident = ua.indexOf('Trident/');\r\n            if (trident > 0) {\r\n                // IE 11 => return version number\r\n                var rv = ua.indexOf('rv:');\r\n                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n            }\r\n\r\n            // GLS: 13/02/2019. Comento lo que respecta a Edge, no tiene sentido meterlo en el mismo saco que un navegador obsoleto.\r\n            // No lo comento porque en la mesa no hay quorum.\r\n            var edge = ua.indexOf('Edge/');\r\n            if (edge > 0) {\r\n                // IE 12 => return version number\r\n                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n            }\r\n\r\n            // other browser\r\n            return false;\r\n        },\r\n        detectChrome: function () {\r\n            return window.chrome;\r\n\r\n        },\r\n        detectSafari: function () {\r\n            return !!navigator.userAgent.match(/Version\\/[\\d\\.]+.*Safari/);\r\n        },\r\n        detectMouse: function () {\r\n            const matchesCoarse = matchMedia('(pointer:coarse)').matches;\r\n            const matchesFine = matchMedia('(pointer:fine)').matches;\r\n            if (matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchesCoarse && !matchesFine) {\r\n                var testHover = function () {\r\n                    //console.log('estamos en testHover');\r\n                    var mq = '(hover: hover)',\r\n                        hover = !TC.browserFeatures.touch(), // fallback if mq4 not supported: no hover for touch\r\n                        mqResult;\r\n\r\n                    mqResult = window.matchMedia(mq);\r\n                    //console.log('resultado de window.matchMedia(mq): ' + mqResult.media);\r\n                    //console.log('mq: ' + mq);\r\n                    if (mqResult.media === mq) {\r\n                        //console.log('es igual');\r\n                        // matchMedia supports hover detection, so we rely on that\r\n                        hover = mqResult.matches;\r\n                        //console.log('va retornar: ' + hover);\r\n                    }\r\n\r\n                    return hover;\r\n                };\r\n\r\n                if (testHover())\r\n                    return true;\r\n                else return false;\r\n            }\r\n            if (!matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchMedia('(pointer:none)').matches) {\r\n                return false;\r\n            }\r\n            if (!TC.browserFeatures.touch()) {\r\n                return true;\r\n            }\r\n        },\r\n        detectAndroid: function () {\r\n            return navigator.userAgent.match(/Android/i);\r\n        },\r\n        detectBlackBerry: function () {\r\n            return navigator.userAgent.match(/BlackBerry/i);\r\n        },\r\n        detectIOS: function () {\r\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n        },\r\n        detectMobileWindows: function () {\r\n            return navigator.userAgent.match(/IEMobile/i);\r\n        },\r\n        detectMobile: function () {\r\n            return (TC.Util.detectAndroid() || TC.Util.detectIOS() || TC.Util.detectMobileWindows() || TC.Util.detectBlackBerry());\r\n        },\r\n        getBrowser: function () {\r\n            if (!window.UAParser) {\r\n                TC.syncLoadJS(TC.apiLocation + TC.Consts.url.UA_PARSER);\r\n            }\r\n\r\n            var parser = new UAParser();\r\n            var browser = parser.getBrowser();\r\n            return { name: browser.name, version: browser.major };\r\n        },\r\n        getElementByNodeName: function (parentNode, nodeName) {\r\n            var colonIndex = nodeName.indexOf(\":\");\r\n            var tag = nodeName.substr(colonIndex + 1);\r\n            var nodes = parentNode.getElementsByTagNameNS(\"*\", tag);\r\n\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].nodeName == nodeName)\r\n                    return nodes;\r\n            }\r\n            return undefined;\r\n        },\r\n        addURLParameters: function (url, parameters) {\r\n            if (!parameters) {\r\n                return url;\r\n            }\r\n            var toAdd = Object.keys(parameters).map(function (key) {\r\n                return encodeURIComponent(key) + '=' + (parameters[key] ? encodeURIComponent(parameters[key]) : '');\r\n            }).join('&');\r\n\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var params = urlparts[1].split(/[&;]/g);\r\n                params.push(toAdd);\r\n\r\n                url = urlparts[0] + '?' + params.join('&');\r\n                return url;\r\n            } else {\r\n                urlparts = url.split('#');\r\n                if (urlparts.length >= 2) {\r\n                    urlparts.shift();\r\n                    url = urlparts[0] + '?' + toAdd + '#' + urlparts.join('#');\r\n                    return url;\r\n                }\r\n                else {\r\n                    url = url + '?' + toAdd;\r\n                    return url;\r\n                }\r\n            }\r\n        },\r\n        removeURLParameter: function (url, parameter) {\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var prefix = encodeURIComponent(parameter.toLowerCase()) + '=';\r\n                var pars = urlparts[1].toLowerCase().split(/[&;]/g);\r\n\r\n                //reverse iteration as may be destructive\r\n                for (var i = pars.length; i-- > 0;) {\r\n                    //idiom for string.startsWith\r\n                    if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                        pars.splice(i, 1);\r\n                    }\r\n                }\r\n\r\n                url = urlparts[0] + '?' + pars.join('&');\r\n                return url;\r\n            } else {\r\n                return url;\r\n            }\r\n        },\r\n\r\n        showModal: function (contentNode, options) {\r\n            options = options || {};\r\n\r\n            contentNode.hidden = false;\r\n            if (window.$ && contentNode instanceof $) {\r\n                contentNode = contentNode.get(0);\r\n            }\r\n            contentNode.classList.add(TC.Consts.classes.VISIBLE);\r\n            const closeButton = contentNode.querySelectorAll('.tc-modal-close');\r\n            if (closeButton && closeButton.length > 0) {\r\n                for (var i = 0; i < closeButton.length; i++) {\r\n                    var closeCallback = modalCloseHandlers.get(closeButton[i]);\r\n                    if (closeCallback) {\r\n                        modalCloseHandlers.delete(closeButton[i]);\r\n                    }\r\n                    else {\r\n                        closeCallback = function (e) {\r\n                            e.stopPropagation();\r\n                            return TC.Util.closeModal(options.closeCallback, e.target);\r\n                        };\r\n                        modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    }\r\n                    modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    closeButton[i].addEventListener('click', closeCallback);\r\n                    if (Util.isFunction(options.openCallback)) {\r\n                        options.openCallback();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        closeModal: function (callback, target) {\r\n\r\n            const hide = function (modal) {\r\n                modal.classList.remove(TC.Consts.classes.VISIBLE);\r\n            };\r\n\r\n            var modal;\r\n            if (target) {\r\n                modal = target;\r\n                while (modal && !modal.matches('.tc-modal')) {\r\n                    modal = modal.parentElement;\r\n                }\r\n\r\n                hide(modal);\r\n            } else {\r\n                Array.prototype.forEach.call(document.querySelectorAll('.tc-modal'), function (modal) {\r\n                    hide(modal);\r\n                });\r\n            }\r\n\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        },\r\n\r\n        closeAlert: function (btn) {\r\n            var elm = btn;\r\n            do {\r\n                elm = elm.parentElement;\r\n                if (elm.matches('.tc-alert')) {\r\n                    elm.style.display = 'none';\r\n                }\r\n            }\r\n            while (elm);\r\n        },\r\n\r\n        swipe: function (target, options) {\r\n            const addListeners = function (handlers) {\r\n                target.addEventListener('mousedown', handlers.start);\r\n                target.addEventListener('touchstart', handlers.start);\r\n                target.addEventListener('mouseup', handlers.end);\r\n                target.addEventListener('touchend', handlers.end);\r\n            };\r\n\r\n            if (options === 'disable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    target.removeEventListener('mousedown', handlers.start);\r\n                    target.removeEventListener('touchstart', handlers.start);\r\n                    target.removeEventListener('mouseup', handlers.end);\r\n                    target.removeEventListener('touchend', handlers.end);\r\n                }\r\n                return;\r\n            }\r\n            else if (options === 'enable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    addListeners(handlers);\r\n                }\r\n                return;\r\n            }\r\n\r\n            options = options || {};\r\n            const minDistance = options.minDistance || 30;\r\n            const maxCrossDistance = options.maxCrossDistance || 30;\r\n            const maxAllowedTime = options.maxAllowedTime || 1000;\r\n            var touchStartCoords = { 'x': -1, 'y': -1 }, // X and Y coordinates on mousedown or touchstart events.\r\n                touchEndCoords = { 'x': -1, 'y': -1 },// X and Y coordinates on mouseup or touchend events.\r\n                startTime = 0,// Time on swipeStart\r\n                elapsedTime = 0;// Elapsed time between swipeStart and swipeEnd\r\n\r\n            const getDirection = function (startCoords, endCoords) {\r\n                const dx = endCoords.x - startCoords.x;\r\n                const dy = endCoords.y - startCoords.y;\r\n                const adx = Math.abs(dx);\r\n                const ady = Math.abs(dy);\r\n                if (adx > ady && adx > minDistance && ady <= maxCrossDistance) {\r\n                    return dx < 0 ? 'left' : 'right';\r\n                }\r\n                if (ady > adx && ady > minDistance && adx <= maxCrossDistance) {\r\n                    return dy < 0 ? 'up' : 'down';\r\n                }\r\n                return 'none';\r\n            };\r\n\r\n            const mustSwipe = function (e) {\r\n                if (options.noSwipe) {\r\n                    var elm = e.target;\r\n                    while (elm && elm !== target) {\r\n                        if (elm.matches && elm.matches(options.noSwipe)) {\r\n                            return false;\r\n                        }\r\n                        elm = elm.parentNode;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n\r\n            const swipeStart = function (e) {\r\n                if (mustSwipe(e)) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchStartCoords.x = e.pageX;\r\n                    touchStartCoords.y = e.pageY;\r\n                    startTime = new Date().getTime();\r\n                }\r\n            };\r\n\r\n            const swipeEnd = function (e) {\r\n                if (startTime) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchEndCoords.x = e.pageX;\r\n                    touchEndCoords.y = e.pageY;\r\n                    elapsedTime = new Date().getTime() - startTime;\r\n                    if (elapsedTime <= maxAllowedTime) {\r\n                        const callback = options[getDirection(touchStartCoords, touchEndCoords)];\r\n                        if (callback) {\r\n                            callback.call(target);\r\n                        }\r\n                    }\r\n                    startTime = 0;\r\n                }\r\n            };\r\n\r\n            const handlers = {\r\n                start: swipeStart,\r\n                end: swipeEnd\r\n            };\r\n            swipeHandlers.set(target, handlers);\r\n            addListeners(handlers);\r\n        },\r\n\r\n        getParameterByName: function (name) {\r\n            name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\r\n            var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\", \"i\"),\r\n                results = regex.exec(location.search);\r\n            return results === null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\r\n        },\r\n\r\n        getLocaleUserChoice: function (options) {\r\n            var result = 'en-US';\r\n            options = options || {};\r\n            var cookieName = options.cookieName || 'SITNA.language';\r\n            var paramName = options.paramName || 'lang';\r\n            // Obtenemos preferencia de lenguaje\r\n            var browserLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language || navigator.userLanguage;\r\n            var lang = TC.Util.getParameterByName(paramName) || TC.Util.storage.getCookie(cookieName) || browserLanguage;\r\n            var hyphenIdx = lang.indexOf('-');\r\n            if (hyphenIdx >= 0) {\r\n                lang = lang.substr(0, hyphenIdx);\r\n            }\r\n            var expirationDate = new Date(new Date().getTime() + 365 * 24 * 60 * 60 * 1000);\r\n            TC.Util.storage.setCookie(cookieName, lang, { expires: expirationDate });\r\n\r\n            switch (lang) {\r\n                case 'eu':\r\n                    result = 'eu-ES';\r\n                    break;\r\n                case 'es':\r\n                    result = 'es-ES';\r\n                    break;\r\n                default:\r\n                    result = 'en-US';\r\n                    break;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getValidFilename: function (filename) {\r\n            return (filename || '').replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n        },\r\n\r\n        downloadBlob: function (filename, blob) {\r\n            var link = document.createElement(\"a\");\r\n            if (link.download !== undefined) {\r\n                var url = URL.createObjectURL(blob);\r\n                link.setAttribute(\"href\", url);\r\n                link.setAttribute(\"download\", TC.Util.getValidFilename(filename));\r\n                link.style.visibility = 'hidden';\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n            }\r\n        },\r\n\r\n        downloadFile: function (filename, type, data) {\r\n            var blob = new Blob([data], { type: type });\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        downloadDataURI: function (filename, type, dataURI) {\r\n            var binary = atob(dataURI.split(',')[1]);\r\n\r\n            var array = [];\r\n            for (var i = 0; i < binary.length; i++) {\r\n                array.push(binary.charCodeAt(i));\r\n            }\r\n            var blob = new Blob([new Uint8Array(array)], { type: type });\r\n\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Acorta una URL utilizando el servicio de Bit.ly. No funciona para URLs locales.\r\n         */\r\n        shortenUrl: function (url) {\r\n            return new Promise(function (resolve, reject) {\r\n                TC.ajax({\r\n                    url: \"https://api-ssl.bitly.com/v3/shorten\",\r\n                    data: { access_token: \"6c466047309f44bd8173d83e81491648b243ee3d\", longUrl: url },\r\n                })\r\n                    .then(function (response) {\r\n                        resolve(response.data);\r\n                    })\r\n                    .catch(function (e) {\r\n                        reject(e);\r\n                    });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Convierte a Base64.\r\n         */\r\n        utf8ToBase64: function (str) {\r\n            return window.btoa(unescape(encodeURIComponent(str)));\r\n        },\r\n\r\n        /**\r\n         * Decodifica un string en Base64.\r\n         */\r\n        base64ToUtf8: function (str) {\r\n            var result;\r\n            try {\r\n                result = decodeURIComponent(escape(window.atob(str)));\r\n            }\r\n            catch (error) {\r\n                result = null;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        colorArrayToString: function (color) {\r\n            if (Array.isArray(color)) {\r\n                color = color\r\n                    .slice(0, 3)\r\n                    .reduce(function (prev, cur) {\r\n                        const str = cur.toString(16);\r\n                        return prev + '00'.substring(0, 2 - str.length) + str;\r\n                    }, '#');\r\n            }\r\n            return color;\r\n        },\r\n\r\n        // Generic helper function that can be used for the three operations:        \r\n        operation: function (list1, list2, comparerFn, operationIsUnion) {\r\n            var result = [];\r\n\r\n            for (var i = 0; i < list1.length; i++) {\r\n                var item1 = list1[i],\r\n                    found = false;\r\n                for (var j = 0; j < list2.length; j++) {\r\n                    if (comparerFn(item1, list2[j])) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (found === operationIsUnion) {\r\n                    result.push(item1);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        // Following functions are to be used:\r\n        inBoth: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, true);\r\n        },\r\n\r\n        inFirstOnly: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, false);\r\n        },\r\n\r\n        inSecondOnly: function (list1, list2, comparerFn) {\r\n            return this.inFirstOnly(list2, list1, comparerFn);\r\n        },\r\n\r\n        toDataUrl: function (canvas, backgroundColour) {\r\n            var defaultOptions = { type: 'image/png', encoderOptions: 0.92 };\r\n\r\n            var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions,\r\n                type = _ref.type,\r\n                encoderOptions = _ref.encoderOptions;\r\n\r\n            var context = canvas.getContext('2d');\r\n\r\n            if (!context) {\r\n                return '';\r\n            }\r\n\r\n            var width = canvas.width;\r\n            var height = canvas.height;\r\n\r\n            var data = context.getImageData(0, 0, width, height);\r\n            var compositeOperation = context.globalCompositeOperation;\r\n\r\n            if (backgroundColour) {\r\n\r\n                context.globalCompositeOperation = 'destination-over';\r\n                context.fillStyle = backgroundColour;\r\n                context.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            var imageData = canvas.toDataURL(type, encoderOptions);\r\n\r\n            if (backgroundColour) {\r\n                context.clearRect(0, 0, width, height);\r\n                context.putImageData(data, 0, 0);\r\n                context.globalCompositeOperation = compositeOperation;\r\n            }\r\n\r\n            return imageData;\r\n        },\r\n\r\n        imgToDataUrl: function (src, outputFormat) {\r\n\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var img = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                img.onload = function () {\r\n                    var canvas = createCanvas(img);\r\n                    var dataURL;\r\n\r\n                    try {\r\n                        dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                            type: outputFormat || 'image/jpeg',\r\n                            encoderOptions: 1.0\r\n                        });\r\n                        resolve({ dataUrl: dataURL, canvas: canvas });\r\n                    } catch (error) {\r\n                        img.src = TC.proxify(src);\r\n                    }\r\n                };\r\n\r\n                img.onerror = function (error) {\r\n                    var xhr = new XMLHttpRequest();\r\n                    xhr.open('GET', TC.proxify(src), true);\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\r\n                    xhr.responseType = 'arraybuffer';\r\n                    xhr.onload = function (e) {\r\n                        if (this.status === 200) {\r\n                            var uInt8Array = new Uint8Array(this.response);\r\n                            var i = uInt8Array.length;\r\n                            var binaryString = new Array(i);\r\n                            while (i--) {\r\n                                binaryString[i] = String.fromCharCode(uInt8Array[i]);\r\n                            }\r\n                            var data = binaryString.join('');\r\n                            var type = xhr.getResponseHeader('content-type');\r\n                            if (type.indexOf('image') === 0) {\r\n                                img.src = 'data:' + type + ';base64,' + window.btoa(data);\r\n                                img.onload = function () {\r\n                                    var canvas = createCanvas(img);\r\n                                    dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                                        type: outputFormat || 'image/jpeg',\r\n                                        encoderOptions: 1.0\r\n                                    });\r\n                                    resolve({ dataUrl: dataURL, canvas: canvas });\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    xhr.onreadystatechange = function () {\r\n                        if (xhr.readyState === 4) {\r\n                            if (xhr.status !== 200) {\r\n                                reject(Error('HTTP error ' + xhr.status));\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    xhr.send();\r\n                };\r\n\r\n                img.src = src;\r\n                if (img.complete || img.complete === undefined) {\r\n                    img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                    img.src = src;\r\n                }\r\n            });\r\n        },\r\n\r\n        imgTagToDataUrl: function (img, outputFormat) {\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            var canvas = createCanvas(img);\r\n            var dataURL;\r\n\r\n            try {\r\n                dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                    type: outputFormat || 'image/jpeg',\r\n                    encoderOptions: 1.0\r\n                });\r\n                return { base64: dataURL, canvas: canvas };\r\n            } catch (error) {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        addToCanvas: function (canvas, img, position, size) {\r\n            var newCanvas = TC.Util.cloneCanvas(canvas);\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var newImage = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                newImage.src = img;\r\n                newImage.onload = function () {\r\n                    if (size) {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0, size.width, size.height);\r\n                    } else {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0);\r\n                    }\r\n                    resolve(newCanvas);\r\n                }\r\n            });\r\n        },\r\n\r\n        cloneCanvas: function (oldCanvas) {\r\n            //create a new canvas\r\n            var newCanvas = document.createElement('canvas');\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            //set dimensions\r\n            newCanvas.width = oldCanvas.width;\r\n            newCanvas.height = oldCanvas.height;\r\n\r\n            //apply the old canvas to the new one\r\n            context.drawImage(oldCanvas, 0, 0);\r\n\r\n            //return the new canvas\r\n            return newCanvas;\r\n        },\r\n\r\n        calculateAspectRatioFit: function (srcWidth, srcHeight, maxWidth, maxHeight) {\r\n            var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\r\n\r\n            return { width: srcWidth * ratio, height: srcHeight * ratio };\r\n        },\r\n\r\n        getFormattedDate: function (date, hasTime) {\r\n            function pad(s) { return (s < 10) ? '0' + s : s; }\r\n\r\n            var d = new Date(date);\r\n            return [d.getFullYear(), pad(d.getMonth() + 1), pad(d.getDate())].concat(hasTime ? [\"_\", pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())] : []).join('');\r\n\r\n        },\r\n\r\n        replaceAccent: function (t) {\r\n            var translate = {\r\n                \"ä\": \"a\", \"ö\": \"o\", \"ü\": \"u\",\r\n                \"Ä\": \"A\", \"Ö\": \"O\", \"Ü\": \"U\",\r\n                \"á\": \"a\", \"é\": \"e\", \"i\": \"i\", \"ó\": \"o\", \"ú\": \"u\",\r\n                \"Á\": \"A\", \"É\": \"E\", \"Í\": \"I\", \"Ó\": \"O\", \"Ú\": \"U\",\r\n                \"ñ\": \"n\", \"Ñ\": \"N\"\r\n            };\r\n            return t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑ]/g, function (match) {\r\n                return translate[match];\r\n            });\r\n        },\r\n\r\n        downloadFileForm: async function (url, data) {\r\n            var download = async function (url, data) {\r\n\r\n                var response = await new Promise(function (resolve, reject) {\r\n                    const request = new XMLHttpRequest();\r\n                    request.responseType = \"blob\";\r\n                    request.open(\"POST\", url);\r\n                    request.setRequestHeader('Content-Type', 'application/xml; charset=UTF-8');\r\n\r\n                    request.onreadystatechange = function (e) {\r\n                        if (request.readyState === 4) { // DONE\r\n                            if (request.status !== 200) {\r\n                                reject({\r\n                                    status: request.status,\r\n                                    msg: request.statusText,\r\n                                    url: url\r\n                                });\r\n                            } else {\r\n\r\n                                try {\r\n                                    //URI: Miro si devuelve una cabecera content-disposition attachment. Si es asi uso el filenae como nombre de fichero. Esta descarga seguramente venga\r\n                                    //de un proxy con postproceso de zippeado\r\n                                    const contentDispositionHeader = request.getResponseHeader(\"Content-disposition\");\r\n                                    var filename = \"\";\r\n                                    if (contentDispositionHeader) {\r\n                                        filename = contentDispositionHeader.split(\"; \")[1].substring(9);\r\n                                        if (contentDispositionHeader.split(\"; \")[0] !== \"attachment\") {\r\n                                            filename = filename.substring(0, filename.lastIndexOf(\".\"));\r\n                                        }\r\n                                    }\r\n                                    resolve({ data: request.response, contentType: request.getResponseHeader(\"Content-type\"), filename: filename });\r\n                                }\r\n                                catch (error) {\r\n                                    reject(error);\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    try {\r\n                        request.send(data);\r\n                    } catch (error) {\r\n                        reject(error);\r\n                    }\r\n                });\r\n                var format = \"\";\r\n                if (response.data.type.indexOf(\"kml\") >= 0)\r\n                    format = \".kml\";\r\n                else if (response.data.type.indexOf(\"json\") >= 0)\r\n                    format = \".geojson\";\r\n                else if (response.data.type.indexOf(\"xml\") >= 0) {\r\n                    format = \".gml\";\r\n                    if (/outputFormat=\"\\S{1,}\"/.exec(data)[0].includes(\".kml\") || /outputFormat=\"\\S{1,}\"/.exec(data)[0].includes(\"shape-zip\")) {\r\n                        throw { key: TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED, url: url, data: data, format: /outputFormat=\"\\S{1,}\"/.exec(data)[0] };\r\n                    }\r\n                }\r\n                TC.Util.downloadFile((response.filename ? response.filename : TC.getUID()) + format, response.contentType, response.data);\r\n\r\n            };\r\n            var htmlObj = [];\r\n            var _err;\r\n            if (Array.isArray(url)) {\r\n                var arrDownloads = url;\r\n                for (var i = 0; i < arrDownloads.length; i++) {\r\n                    try {\r\n                        await download(arrDownloads[i].url, arrDownloads[i].data);\r\n                    }\r\n                    catch (err) {\r\n                        _err = err;\r\n                    }\r\n                }\r\n                if (_err) {\r\n                    throw _err;\r\n                }\r\n            }\r\n            else {\r\n                download(url, data);\r\n            }\r\n        },\r\n\r\n        WFSQueryBuilder: function (layers, filter, capabilities, outputFormat, onlyHits, srsName, maxFeatures) {\r\n            const getSRSAttribute = function () {\r\n                if (srsName) {\r\n                    return ' srsName=\"' + srsName + '\"'\r\n                }\r\n                else\r\n                    return '';\r\n            }\r\n            if (!Array.isArray(layers) && !(layers instanceof Object))\r\n                layers = [layers];\r\n\r\n            var queryHeader = 'xsi:schemaLocation=\"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd\" ' +\r\n                ' service=\"WFS\" {resultType} {format} ';\r\n            switch (capabilities.version) {\r\n                case \"1.0.0\":\r\n                case \"1.1.0\":\r\n                    queryHeader += 'xmlns:gml=\"http://www.opengis.net/gml\" xmlns:wfs=\"http://www.opengis.net/wfs\" ';\r\n                    break;\r\n                case \"2.0.0\":\r\n                    queryHeader += 'xmlns:wfs=\\\"http://www.opengis.net/wfs/2.0\\\" xmlns:gml=\\\"http://www.opengis.net/gml/3.2\\\" ';\r\n                    break;\r\n            }\r\n            for (var i in capabilities) {\r\n                if (typeof (capabilities[i]) === \"string\" && i.indexOf(\"gml\") < 0 && capabilities[i].indexOf(\"wfs\") < 0)\r\n                    queryHeader += (i + '=\"' + capabilities[i] + '\" ');\r\n            }\r\n\r\n            var query = '<wfs:GetFeature ' + queryHeader.format({ resultType: (onlyHits ? 'resultType=\"hits\"' : ''), format: 'outputFormat=\"' + outputFormat + '\"' }) + (capabilities.version !== \"2.0.0\" && maxFeatures ? ' maxFeatures=\"' + maxFeatures + '\"' : '') + '>';\r\n            var queryBody = '';\r\n            if (Array.isArray(layers)) {\r\n                var queryItem = '<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + getSRSAttribute() + '>{filter}</wfs:Query>';\r\n                if (Array.isArray(layers))\r\n                    layers.forEach(function (value) {\r\n                        queryBody += queryItem.format({ typeName: value, filter: (filter && filter instanceof TC.filter.Filter ? filter.getText(capabilities.version) : \"\") });\r\n                    });\r\n            }\r\n            else {\r\n                var queryItem = '';\r\n                for (var layer in layers) {\r\n                    var queryItem = ('<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + getSRSAttribute() + '>{filter}</wfs:Query>');\r\n                    let filter = layers[layer]\r\n                    queryBody += queryItem.format({ typeName: layer, filter: (filter && filter instanceof TC.filter.Filter ? filter.getText(capabilities.version) : \"\") });\r\n                }\r\n            }\r\n\r\n            query += queryBody + '</wfs:GetFeature>'\r\n            return query;\r\n        },\r\n\r\n        WFSFilterBuilder: function (feature, version, srsName) {\r\n            var filter = '';\r\n            if (Util.isPlainObject(feature)) {\r\n                filter = '<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name=\"querySingle\"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'\r\n                    .format({ prefix: (version === \"2.0.0\" ? \"fes\" : \"ogc\"), \"clipLayer\": feature.clipLayer, \"geometryName\": feature.geometryName, \"where\": feature.where })\r\n            }\r\n            else {\r\n                switch (true) {\r\n                    case !feature:\r\n                        break;\r\n                    case Array.isArray(feature)://bbox\r\n                        var gmlEnvelope = ('<gml:Envelope>' +\r\n                            '<gml:lowerCorner>{lowerCorner}</gml:lowerCorner>' +\r\n                            '<gml:upperCorner>{upperCorner}</gml:upperCorner>' +\r\n                            '</gml:Envelope>').format({ lowerCorner: (feature[0] + ' ' + feature[1]), upperCorner: (feature[2] + ' ' + feature[3]) });\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:BBOX>' + gmlEnvelope + '</ogc:BBOX></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:BBOX>' + gmlEnvelope + '</fes:BBOX></fes:Filter>';\r\n                                break;\r\n                        }\r\n                        break;\r\n                    case feature instanceof TC.Feature:\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>' + TC.Util.writeGMLGeometry(feature, { version: \"2.0\", srsName: srsName }) + '</ogc:Intersects></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>' + TC.Util.writeGMLGeometry(feature, { version: \"3.2\", srsName: srsName }) + '</fes:Intersects></fes:Filter>';\r\n                                break;\r\n                        }\r\n\r\n                        break;\r\n                    default:\r\n                        TC.error(\"Geometr\\u00eda no v\\u00e1lida\");\r\n                        break;\r\n                }\r\n            }\r\n\r\n            return filter;\r\n        },\r\n\r\n        writeGMLGeometry: function (feature, options) {\r\n            options = options || {};\r\n            const gmlVersion = options.version;\r\n            const getSRSName = function () {\r\n                if (options.srsName) {\r\n                    return ' srsName=\"' + options.srsName + '\"'\r\n                }\r\n                else\r\n                    return '';\r\n            };\r\n            var getGmlCoordinates = function (coords) {\r\n                var result;\r\n                if (gmlVersion.indexOf('3') === 0) {\r\n                    result = coords.toString();\r\n                    while (result.indexOf(\",\") >= 0) {\r\n                        result = result.replace(\",\", \" \");\r\n                    }\r\n                }\r\n                else {\r\n                    result = coords.map(function (coord) {\r\n                        return coord.join(',');\r\n                    }).join(' ');\r\n                }\r\n                return result;\r\n            };\r\n\r\n            switch (gmlVersion) {\r\n                case \"3.1.1\":\r\n                    break;\r\n                case \"3.2\":\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString srsDimension=\\\"2\\\"\" + getSRSName() + \"><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry) +\r\n                                \"</gml:posList></gml:LineString>\";\r\n                            break;\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon srsDimension=\\\"2\\\"\" + getSRSName() + \"><gml:exterior><gml:LinearRing><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n                case \"2.0\":\r\n                default:\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString\" + getSRSName() + \"><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LineString>\";\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon\" + getSRSName() + \"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n\r\n        isServiceWorker: function () {\r\n            if (navigator.serviceWorker) {\r\n                if (navigator.serviceWorker.controller && navigator.serviceWorker.controller.state === \"activated\") {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n\r\n        isSameOriginByLocation: function (uri, location) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var uProtocol = urlParts[1];\r\n                result = (uProtocol == location.protocol || uProtocol == undefined) && urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        isSameProtocol: function (uri, location) {\r\n            if (uri.match(/^(\\/\\/)/i)) {\r\n                return true;\r\n            }\r\n            var protocolRegex = /^(https?:\\/\\/)/i;\r\n            var uriProtocol = uri.match(protocolRegex);\r\n            if (uriProtocol && uriProtocol.length > 1) {\r\n                var locationProtocol = location.match(protocolRegex);\r\n                if (locationProtocol && locationProtocol.length > 1) {\r\n                    return uriProtocol[0].trim() === locationProtocol[0].trim();\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        consoleRegister: function (msg) {\r\n            if (TC.isDebug) {\r\n                console.log(msg);\r\n            }\r\n        },\r\n\r\n        getSorterByProperty: function (propName) {\r\n            return function (a, b) {\r\n                if (a[propName] > b[propName]) {\r\n                    return 1;\r\n                }\r\n                if (a[propName] < b[propName]) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            };\r\n        },\r\n\r\n        getSoundexDifference: function (a, b) {\r\n            var res = 0\r\n\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (a.charAt(i) == b.charAt(i)) {\r\n                    res++;\r\n                }\r\n            }\r\n\r\n            return res;\r\n        },\r\n\r\n        toAbsolutePath: function (href) {\r\n            var link = document.createElement(\"a\");\r\n            link.href = href;\r\n            return link.href;\r\n        },\r\n\r\n        //getRenderedHtml: function (templateId, template, data, callback) {\r\n        //    return new Promise(function (resolve, reject) {\r\n        //        var render = function () {\r\n        //            if (dust.cache[templateId]) {\r\n        //                dust.render(templateId, data, function (err, out) {\r\n        //                    if (err) {\r\n        //                        TC.error(err);\r\n        //                        reject(Error(err));\r\n        //                    }\r\n        //                    else {\r\n        //                        if (Util.isFunction(callback)) {\r\n        //                            callback(out);\r\n        //                        }\r\n        //                        resolve(out);\r\n        //                    }\r\n        //                });\r\n        //            }\r\n        //        };\r\n        //        TC.loadJSInOrder(\r\n        //            !window.dust,\r\n        //            TC.url.templating,\r\n        //            function () {\r\n        //                if (!dust.cache[templateId]) {\r\n        //                    if (typeof template === 'string') {\r\n        //                        TC.ajax({\r\n        //                            url: template,\r\n        //                            method: \"GET\",\r\n        //                            responseType: 'text'\r\n        //                        })\r\n        //                            .then(function (response) {\r\n        //                                const html = response.data;\r\n        //                                var tpl = dust.compile(html, templateId);\r\n        //                                dust.loadSource(tpl);\r\n        //                                render();\r\n        //                            })\r\n        //                            .catch(function (err) {\r\n        //                                console.log(\"Error fetching template: \" + err)\r\n        //                            });\r\n        //                    }\r\n        //                    else if (Util.isFunction(template)) {\r\n        //                        template();\r\n        //                        render();\r\n        //                    }\r\n        //                }\r\n        //                else {\r\n        //                    render();\r\n        //                }\r\n        //            }\r\n        //        );\r\n        //    });\r\n        //},\r\n\r\n        explodeGeometry: function (obj) {\r\n            const origin = obj.origin;\r\n            const iterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(iterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = elm + origin[0];\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = elm + origin[1];\r\n                    }\r\n                }\r\n            };\r\n            obj.geom.forEach(iterationFunction);\r\n            return obj.geom;\r\n        },\r\n\r\n        cloneMappingFunction: function (elm) {\r\n            if (Array.isArray(elm)) {\r\n                return elm.map(TC.Util.cloneMappingFunction);\r\n            }\r\n            return elm;\r\n        },\r\n\r\n        isGeometry: function (type) {\r\n            switch (type) {\r\n                case 'gml:LinearRingPropertyType':\r\n                case 'gml:PolygonPropertyType':\r\n                case 'gml:MultiPolygonPropertyType':\r\n                case 'gml:MultiSurfacePropertyType':\r\n                case 'gml:LineStringPropertyType':\r\n                case 'gml:MultiLineStringPropertyType':\r\n                case 'gml:PointPropertyType':\r\n                case 'gml:MultiPointPropertyType':\r\n                case 'gml:BoxPropertyType':\r\n                case 'gml:GeometryCollectionPropertyType':\r\n                case 'gml:GeometryAssociationType':\r\n                case 'gml:GeometryPropertyType':\r\n                case 'gml:MultiCurvePropertyType':\r\n                case 'gml:CurvePropertyType':\r\n                    return true;\r\n                    break;\r\n                default:\r\n                    return false;\r\n                    break;\r\n            }\r\n        },\r\n\r\n        compactGeometry: function (geometry, precision) {\r\n            const origin = [Number.MAX_VALUE, Number.MAX_VALUE];\r\n            const newGeom = geometry.map(TC.Util.cloneMappingFunction);\r\n            const firstIterationFunction = function (elm, idx) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(firstIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0 && elm < origin[0]) {\r\n                        origin[0] = elm;\r\n                    }\r\n                    else if (idx === 1 && elm < origin[1]) {\r\n                        origin[1] = elm;\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(firstIterationFunction);\r\n\r\n            const round = function (val) {\r\n                return Math.round(val * precision) / precision;\r\n            }\r\n            origin[0] = round(origin[0]);\r\n            origin[1] = round(origin[1]);\r\n            const secondIterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(secondIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = round(elm - origin[0]);\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = round(elm - origin[1]);\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(secondIterationFunction);\r\n            return {\r\n                origin: origin,\r\n                geom: newGeom\r\n            }\r\n        },\r\n\r\n        hasStyleOptions: function (options) {\r\n            return options.hasOwnProperty('strokeColor') ||\r\n                options.hasOwnProperty('strokeWidth') ||\r\n                options.hasOwnProperty('fillColor') ||\r\n                options.hasOwnProperty('strokeOpacity') ||\r\n                options.hasOwnProperty('fillOpacity') ||\r\n                options.hasOwnProperty('url') ||\r\n                options.hasOwnProperty('radius') ||\r\n                options.hasOwnProperty('anchor') ||\r\n                options.hasOwnProperty('width') ||\r\n                options.hasOwnProperty('height') ||\r\n                options.hasOwnProperty('labelOutlineWidth') ||\r\n                options.hasOwnProperty('labelOutlineColor') ||\r\n                options.hasOwnProperty('labelOffset') ||\r\n                options.hasOwnProperty('fontColor') ||\r\n                options.hasOwnProperty('fontSize');\r\n        },\r\n\r\n        formatCoord: function (x, nDecimales) {\r\n            return x.toLocaleString(TC.Util.getLocaleUserChoice(), { maximumFractionDigits: nDecimales });\r\n\r\n            // No respeta el formato de los números según el idioma\r\n            //var result;            \r\n            //result = x.toFixed(nDecimales);\r\n            //if (nDecimales <= 3) {\r\n            //    result = result.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \"|\");\r\n            //}\r\n\r\n            //result = result.replace(\".\", \",\").replace(/\\|/g, \".\");\r\n            //return result;\r\n        }\r\n    };\r\n    String.prototype.format = function () {\r\n        var str = this.toString();\r\n        if (!arguments.length)\r\n            return str;\r\n        var args = typeof arguments[0],\r\n            args = ((\"string\" == args || \"number\" == args) ? arguments : arguments[0]);\r\n        for (arg in args)\r\n            str = str.replace(RegExp(\"\\\\{\" + arg + \"\\\\}\", \"gi\"), args[arg]);\r\n        return str;\r\n    };\r\n    var fncOvelaps = function (elem1, elem2, comparisonFnc) {\r\n        return comparisonFnc(elem1.getBoundingClientRect(), elem2.getBoundingClientRect());\r\n    }\r\n    if (this.HTMLElement) {\r\n        HTMLElement.prototype.colliding = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.top > rect2.bottom ||\r\n                    rect1.right < rect2.left ||\r\n                    rect1.bottom < rect2.top ||\r\n                    rect1.left > rect2.right\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.containing = function (other) {\r\n            fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.left <= rect2.left &&\r\n                    rect2.left < rect1.width &&\r\n                    rect1.top <= rect2.top &&\r\n                    rect2.top < rect1.height\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.inside = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return (\r\n                    ((rect2.top <= rect1.top) && (rect1.top <= rect2.bottom)) &&\r\n                    ((rect2.top <= rect1.bottom) && (rect1.bottom <= rect2.bottom)) &&\r\n                    ((rect2.left <= rect1.left) && (rect1.left <= rect2.right)) &&\r\n                    ((rect2.left <= rect1.right) && (rect1.right <= rect2.right))\r\n                );\r\n            });\r\n        };\r\n    }\r\n    return Util;\r\n});\r\n"]}