TC.tool=TC.tool||{};TC.tool.ElevationService||TC.syncLoadJS(TC.apiLocation+"TC/tool/ElevationService");TC.tool.ElevationServiceIGNEs=function(e){TC.tool.ElevationService.apply(this,arguments);this.url=this.options.url||"//www.ign.es/wps-analisis/servicios";this.process=this.options.process||"GetProfileTxt";this.minimumElevation=this.options.minimumElevation||-99998;this.serviceVersion=this.options.serviceVersion||"0.4.0";this.nativeCRS="EPSG:25830"};TC.inherit(TC.tool.ElevationServiceIGNEs,TC.tool.ElevationService);!function(){const e=TC.tool.ElevationServiceIGNEs.prototype;e.request=function(e){const t=this;e=e||{};var o,n=!1;switch(!0){case TC.Geometry.isPoint(e.coordinates):o=[[e.coordinates]];break;case TC.Geometry.isRing(e.coordinates):o=[e.coordinates];break;case TC.Geometry.isRingCollection(e.coordinates):o=e.coordinates;n=!0}e.crs&&e.crs!==t.nativeCRS&&(o=TC.Util.reproject(o,e.crs,t.nativeCRS));const i=[].concat.apply([],o),r={Profile:i.map(function(e){return e.join()}).join(),CRS:t.nativeCRS};if(e.sampleNumber){const t=function(e,t){const o=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(o*o+n*n)};var s=0;o.forEach(function(e){s+=e.map(function(e,o,n){const i=n[o-1];return i?t(i,e):0}).reduce(function(e,t){return e+t},0);n&&(s+=t(e[e.length-1],e[0]))});r.Resolution=s/e.sampleNumber}else e.resolution&&(r.Resolution=e.resolution);const a=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];i.forEach(function(e){a[0]=Math.min(e[0],a[0]);a[1]=Math.min(e[1],a[1]);a[2]=Math.max(e[0],a[2]);a[3]=Math.max(e[1],a[3])});var c,l;switch(!0){case r.Resolution>=200&&r.Resolution<500:c="mdt:Elevacion25830_200";l=200;break;case r.Resolution>=500&&r.Resolution<1e3:c="mdt:Elevacion25830_500";l=500;break;case r.Resolution>=1e3:c="mdt:Elevacion25830_1000";l=1e3;break;default:c="mdt:Elevacion25830_25";l=25}r.URLCoverageServer="http://www.ign.es/wcs/mdt?SERVICE=WCS&amp;REQUEST=GetCoverage&amp;VERSION=1.0.0&amp;CRS=EPSG:25830&amp;BBOX="+a.join()+"&amp;COVERAGE="+c+"&amp;RESX="+l+"&amp;RESY="+l+"&amp;FORMAT=ArcGrid&amp;EXCEPTIONS=XML";return new Promise(function(e,o){TC.tool.ElevationService.prototype.request.call(t,{dataInputs:r,process:t.process,contentType:!1,output:{uom:"urn:ogc:def:dataType:OGC:0.0:Integer"}}).then(function(t){var n;try{n=(new DOMParser).parseFromString(t,TC.Consts.mimeType.XML)}catch(e){o(Error(e))}const i=n.getElementsByTagName("URL")[0];i?TC.ajax({url:TC.proxify(i.innerHTML),method:"GET",contentType:!1}).then(function(t){e(t.data)},function(e){o(Error(e))}):o(Error("Servicio WPS del IGN no ha devuelto una respuesta r\xe1pida"))}).catch(function(e){o(Error(e))})})};e.parseResponse=function(e,t){var o=e.split("\n").filter(function(e,t){return t>0}).filter(function(e,t){return e.length}).map(function(e){const t=e.split(";");var o=parseFloat(t[3]);isNaN(o)&&(o=null);return[parseFloat(t[0]),parseFloat(t[1]),o]});t.crs&&t.crs!==this.nativeCRS&&(o=TC.Util.reproject(o,this.nativeCRS,t.crs));return TC.tool.ElevationService.prototype.parseResponse.call(this,{coordinates:o},t)}}();
//# sourceMappingURL=../maps/tool/ElevationServiceIGNEs.min.js.map