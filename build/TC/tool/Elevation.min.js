TC.tool=TC.tool||{};TC.tool.Elevation=function(e){const o=this;o.options=e||{};o._servicePromises=[];(o.options.services||["elevationServiceIDENA","elevationServiceIGNFr"]).forEach(function(e,n){o._servicePromises[n]=new Promise(function(o,n){var t="ElevationService",r=TC.apiLocation+"TC/tool/ElevationService",i=e;if("string"==typeof e){t=e.substr(0,1).toUpperCase()+e.substr(1);r=TC.apiLocation+"TC/tool/"+t;i={}}TC.loadJS(!TC.tool[t],[r],function(){o(new TC.tool[t](i))})})})};!function(){const e=TC.tool.Elevation.prototype;e.getService=function(e){return this._servicePromises[e]};e.getElevation=function(e){const o=this;void 0===(e=e||{}).resolution&&(e.resolution=o.options.resolution);void 0===e.sampleNumber&&(e.sampleNumber=o.options.sampleNumber);return new Promise(function(n,t){const r=function(e,o){t(e,o)};TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){Promise.all(o._servicePromises).then(function(o){const t=new Array(o.length);o.forEach(function(o,n){t[n]=new Promise(function(n,t){o.request(e).then(function(e){n(e)},function(){n(null)})})});Promise.all(t).then(function(t){const r=o.map(function(o,n){const r=t[n];return r?o.parseResponse(r,e):null}).filter(function(e){return null!==e});var i=r.length?r[0].length:0,l=new Array(i);if(i){const e=function(e){return function(o,n,t){const r=n[e],i=o;null===o[0]&&(i[0]=r[0]);null===o[1]&&(i[1]=r[1]);null===o[2]&&(i[2]=r[2]);return i}};for(var u=0;u<i;u++){var a=e(u);l[u]=r.reduce(a,[null,null,null])}}n(l)},r)},r)})})};e.setGeometry=function(e){const o=this,n=(e=e||{}).features||[];if(n.length){const t=function(e,o,n){Promise.all(e).then(function(e){o(e)},function(e){n(e)})};return new Promise(function(r,i){if(e.maxCoordQuantity&&e.resolution){n.reduce(function(o,n){if(n){o+=n.getCoords({pointArray:!0}).length;switch(!0){case TC.feature.Polyline&&n instanceof TC.feature.Polyline:case TC.feature.Polygon&&n instanceof TC.feature.Polygon:case TC.feature.MultiPolyline&&n instanceof TC.feature.MultiPolyline:case TC.feature.MultiPolygon&&n instanceof TC.feature.MultiPolygon:o+=Math.floor(n.getLength()/e.resolution)}}return o},0)>e.maxCoordQuantity&&i(TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED)}const l=e.resolution||0,u=function(o){return{crs:e.crs,coordinates:o,resolution:l,sampleNumber:0}},a=function(e){return o.getElevation(u(e))},s=n.map(function(e){return new Promise(function(n,r){switch(!0){case!e:n(null);break;case TC.feature&&TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:const i=e.getCoords().map(function(e){return new Promise(function(o,n){t(e.map(a),o,n)})});t(i,n,r);break;case TC.feature&&TC.feature.Polygon&&e instanceof TC.feature.Polygon:case TC.feature&&TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:const l=e.getCoords().map(a);t(l,n,r);break;case TC.feature&&TC.feature.Polyline&&e instanceof TC.feature.Polyline:o.getElevation(u(e.getCoords())).then(function(e){n(e)},function(e){r(Error(e))});break;case TC.feature&&TC.feature.Point&&e instanceof TC.feature.Point:o.getElevation(u(e.getCoords())).then(function(e){n(e[0])},function(e){r(Error(e))});break;default:r(Error("Geometry not supported"))}})});Promise.all(s).then(function(e){e.forEach(function(e,o){const t=n[o];if(t){console.log("Estableciendo elevaciones a geometr\xeda de tipo "+t.CLASSNAME);n[o].setCoords(e)}});r(n)},function(e){i(e)})})}return Promise.resolve([])}}();TC.tool.Elevation.errors={MAX_COORD_QUANTITY_EXCEEDED:"max_coord_quantity_exceeded",UNDEFINED:"undefined"};TC.tool.Elevation.getElevationGain=function(e){const o=(e=e||{}).coords;if(o&&o.length>0&&o[0].length>2){var n=0,t=0;const f=e.hillDeltaThreshold||0;for(var r,i,l,u=!0,a=0;a<o.length;a++){var s=o[a][2];if(null!==s){if(void 0===r){r=s;i=s;l=s}i=Math.min(i,s);l=Math.max(l,s);var c=s-r;if(c>f||c>0&&a==o.length-1){if(u)n+=c;else{t-=i-r;n+=s-i;u=!0}r=s;i=s;l=s}else if(c<-f||c<0&&a==o.length-1){if(u){n+=l-r;t-=s-l;u=!1}else t-=c;r=s;i=s;l=s}}}return{upHill:Math.round(n),downHill:Math.round(t)}}return null};
//# sourceMappingURL=../maps/tool/Elevation.min.js.map
