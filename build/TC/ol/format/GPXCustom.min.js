!function(){let e=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const t=function(e){for(var t=[],o=[],r=Math.pow(2,e.length),l=0;l<r;l++){o=[];for(var m=0;m<e.length;m++)l&Math.pow(2,m)&&-1==o.indexOf(e[m])&&o.push(e[m]);o.length>0&&-1==t.indexOf(o.join(" "))&&t.push(o.join(" "))}return t}(e.slice().slice(1));!function(e,t){if(e&&e.length>0)for(var o=0;o<t.length;o++){var r=e.indexOf(t[o]);r>-1&&e.splice(r,1)}}(t,e);e=e.concat(t);const o=function(e){return 1e3*ol.format.xsd.readDateTime(e)},r="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",l={rte:R,trk:D,wpt:I},m=ol.xml.makeStructureNS(e,{rte:ol.xml.makeArrayPusher(R),trk:ol.xml.makeArrayPusher(D),wpt:ol.xml.makeArrayPusher(I)}),a=ol.xml.makeStructureNS(e,{text:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkText"),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkType")}),n=ol.xml.makeStructureNS(e,{rte:ol.xml.makeChildAppender(function(e,t,o){const r=o[0],l=t.getProperties(),m={node:e};m.properties=l;const a=t.getGeometry();if(a.getType()==ol.geom.GeometryType.LINE_STRING){const e=ol.format.Feature.transformWithOptions(a,!0,r);m.geometryLayout=e.getLayout();l.rtept=e.getCoordinates()}const n=o[o.length-1].node,i=f[n.namespaceURI],d=ol.xml.makeSequence(l,i);ol.xml.pushSerializeAndPop(m,S,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,d,o,i)}),trk:ol.xml.makeChildAppender(function(e,t,o){const r=o[0],l=t.getProperties(),m={node:e};m.properties=l;const a=t.getGeometry();if(a.getType()==ol.geom.GeometryType.MULTI_LINE_STRING){const e=ol.format.Feature.transformWithOptions(a,!0,r);l.trkseg=e.getLineStrings()}const n=o[o.length-1].node,i=k[n.namespaceURI],d=ol.xml.makeSequence(l,i);ol.xml.pushSerializeAndPop(m,y,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,d,o,i)}),wpt:ol.xml.makeChildAppender(function(e,t,o){const r=o[0],l=o[o.length-1];l.properties=t.getProperties();const m=t.getGeometry();if(m.getType()==ol.geom.GeometryType.POINT){const t=ol.format.Feature.transformWithOptions(m,!0,r);l.geometryLayout=t.getLayout();E(e,t.getCoordinates(),o)}})});const i=ol.xml.makeStructureNS(e,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:j,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:L,type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),rtept:function(e,t){const o=ol.xml.pushParseAndPop({},d,e,t);if(o){const r=t[t.length-1],l=r.flatCoordinates,m=r.layoutOptions;w(l,m,e,o)}}}),d=ol.xml.makeStructureNS(e,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(o)}),s=ol.xml.makeStructureNS(e,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:j,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),extensions:L,trkseg:function(e,t){const o=t[t.length-1];ol.xml.parseNode(p,e,t);const r=o.flatCoordinates;o.ends.push(r.length)}}),p=ol.xml.makeStructureNS(e,{trkpt:function(e,t){const o=ol.xml.pushParseAndPop({},x,e,t);if(o){const r=t[t.length-1],l=r.flatCoordinates,m=r.layoutOptions;w(l,m,e,o)}}}),x=ol.xml.makeStructureNS(e,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(o)}),c=ol.xml.makeStructureNS(e,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(o),magvar:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),geoidheight:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:j,sym:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),fix:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),sat:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),hdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),vdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),pdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),ageofdgpsdata:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),dgpsid:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:L}),u=["text","type"],g=ol.xml.makeStructureNS(e,{text:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode)}),f=ol.xml.makeStructureNS(e,["name","cmt","desc","src","link","number","type","rtept"]),S=ol.xml.makeStructureNS(e,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(_),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),rtept:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(E))}),h=ol.xml.makeStructureNS(e,["ele","time"]),k=ol.xml.makeStructureNS(e,["name","cmt","desc","src","link","number","type","trkseg"]),y=ol.xml.makeStructureNS(e,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(_),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),trkseg:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(function(e,t,o){const r={node:e};r.geometryLayout=t.getLayout();r.properties={};ol.xml.pushSerializeAndPop(r,P,N,t.getCoordinates(),o)}))}),N=ol.xml.makeSimpleNodeFactory("trkpt"),P=ol.xml.makeStructureNS(e,{trkpt:ol.xml.makeChildAppender(E)}),A=ol.xml.makeStructureNS(e,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),O=ol.xml.makeStructureNS(e,{ele:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),time:ol.xml.makeChildAppender(function(e,t){var o=new Date(t),r=o.getUTCFullYear()+"-"+ol.string.padNumber(o.getUTCMonth()+1,2)+"-"+ol.string.padNumber(o.getUTCDate(),2)+"T"+ol.string.padNumber(o.getUTCHours(),2)+":"+ol.string.padNumber(o.getUTCMinutes(),2)+":"+ol.string.padNumber(o.getUTCSeconds(),2)+"Z";e.appendChild(ol.xml.DOCUMENT.createTextNode(r))}),magvar:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),geoidheight:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(_),sym:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),fix:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),sat:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),hdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),vdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),pdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),ageofdgpsdata:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),dgpsid:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode)}),C={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function T(e,t,o){const r=e.getGeometry();if(r){const e=C[r.getType()];if(e){const o=t[t.length-1].node;return ol.xml.createElementNS(o.namespaceURI,e)}}}function w(e,t,o,r){e.push(parseFloat(o.getAttribute("lon")),parseFloat(o.getAttribute("lat")));if("ele"in r){e.push(r.ele);delete r.ele;t.hasZ=!0}else e.push(0);if("time"in r){e.push(r.time);delete r.time;t.hasM=!0}else e.push(0);return e}function b(e,t,o){let r=ol.geom.GeometryLayout.XY,l=2;if(e.hasZ&&e.hasM){r=ol.geom.GeometryLayout.XYZM;l=4}else if(e.hasZ){r=ol.geom.GeometryLayout.XYZ;l=3}else if(e.hasM){r=ol.geom.GeometryLayout.XYM;l=3}if(4!==l){for(let o=0,r=t.length/4;o<r;o++){t[o*l]=t[4*o];t[o*l+1]=t[4*o+1];e.hasZ&&(t[o*l+2]=t[4*o+2]);e.hasM&&(t[o*l+2]=t[4*o+3])}t.length=t.length/4*l;if(o)for(let e=0,t=o.length;e<t;e++)o[e]=o[e]/4*l}return r}function j(e,t){const o=t[t.length-1],r=e.getAttribute("href");null!==r&&(o.link=r);ol.xml.parseNode(a,e,t)}function L(e,t){t[t.length-1].extensionsNode_=e}function R(e,t){const o=t[0],r=ol.xml.pushParseAndPop({flatCoordinates:[],layoutOptions:{}},i,e,t);if(!r)return;const l=r.flatCoordinates;delete r.flatCoordinates;const m=r.layoutOptions;delete r.layoutOptions;const a=b(m,l),n=new ol.geom.LineString(l,a);ol.format.Feature.transformWithOptions(n,!1,o);const d=new ol.Feature(n);d.setProperties(r,!0);return d}function D(e,t){const o=t[0],r=ol.xml.pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},s,e,t);if(!r)return;const l=r.flatCoordinates;delete r.flatCoordinates;const m=r.ends;delete r.ends;const a=r.layoutOptions;delete r.layoutOptions;const n=b(a,l,m),i=new ol.geom.MultiLineString(l,n,m);ol.format.Feature.transformWithOptions(i,!1,o);const d=new ol.Feature(i);d.setProperties(r,!0);return d}function I(e,t){const o=t[0],r=ol.xml.pushParseAndPop({},c,e,t);if(!r)return;const l={},m=w([],l,e,r),a=b(l,m),n=new ol.geom.Point(m,a);ol.format.Feature.transformWithOptions(n,!1,o);const i=new ol.Feature(n);i.setProperties(r,!0);return i}function _(e,t,o){e.setAttribute("href",t);const r=o[o.length-1].properties,l=[r.linkText,r.linkType];ol.xml.pushSerializeAndPop({node:e},g,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,o,u)}function E(e,t,o){const r=o[o.length-1],l=r.node.namespaceURI,m=r.properties;e.setAttributeNS(null,"lat",String(t[1]));e.setAttributeNS(null,"lon",String(t[0]));switch(r.geometryLayout){case ol.geom.GeometryLayout.XYZM:0!==t[3]&&(m.time=t[3]);case ol.geom.GeometryLayout.XYZ:0!==t[2]&&(m.ele=t[2]);break;case ol.geom.GeometryLayout.XYM:0!==t[2]&&(m.time=t[2])}const a="rtept"==e.nodeName?h[l]:A[l],n=ol.xml.makeSequence(m,a);ol.xml.pushSerializeAndPop({node:e,properties:m},O,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,n,o,a)}ol.format.GPXCustom=class extends ol.format.GPX{constructor(e){super(e)}readFeatureFromNode(t,o){if(!ol.array.includes(e,t.namespaceURI))return null;const r=l[t.localName];if(!r)return null;const m=r(t,[this.getReadOptions(t,o)]);if(!m)return null;this.handleReadExtensions_([m]);return m}readFeaturesFromNode(t,o){if(!ol.array.includes(e,t.namespaceURI))return[];if("gpx"==t.localName){const e=ol.xml.pushParseAndPop([],m,t,[this.getReadOptions(t,o)]);if(e){this.handleReadExtensions_(e);return e}return[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const o=ol.xml.createElementNS("http://www.topografix.com/GPX/1/1","gpx");o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",ol.xml.XML_SCHEMA_INSTANCE_URI);o.setAttributeNS(ol.xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",r);o.setAttribute("version","1.1");o.setAttribute("creator","OpenLayers");ol.xml.pushSerializeAndPop({node:o},n,T,e,[t]);return o}}}();
//# sourceMappingURL=../../maps/ol/format/GPXCustom.min.js.map