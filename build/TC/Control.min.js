TC.control=TC.control||{};TC.Control=function(){const t=this;TC.EventTarget.call(t);t.map=null;t.isActive=!1;t.isDisabled=!1;var e=arguments.length;t.options=TC.Util.extend({},e>1?arguments[1]:arguments[0]);t.id=t.options.id||TC.getUID(t.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]);TC._jQueryIsLoaded&&(t._$div=$(t.div));t.div.classList.add(TC.Control.prototype.CLASS,t.CLASS);t.template=t.options.template||t.template;t.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template="";t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};const e=function(t,e,n){return new Promise(function(i,o){const s=[],r=[];for(var c in n){var a=n[c];if("string"==typeof a)if(dust.cache[t.CLASS])dust.render(t.CLASS,e,function(e,n){t.div.innerHTML=n;e&&TC.error(e)});else{var l=TC.ajax({url:a,method:"GET",responseType:"text"});s.push(l);r.push(c)}else TC.Util.isFunction(a)&&a()}0===s.length?i():Promise.all(s).then(function(t){t.map(t=>t.data).forEach(function(t,e){const n=dust.compile(t,r[e]);dust.loadSource(n)});i()}).catch(function(t){console.error("Error fetching templates: "+t);o(t instanceof Error?t:Error(t))})})};t.renderData=function(t,n){const i=this;return new Promise(function(o,s){i.map&&i.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});i.div.classList.toggle(TC.Consts.classes.DISABLED,i.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r;if("object"==typeof i.template)r=e(i,t,i.template);else{var c={};i.template&&(c[i.CLASS]=i.template);r=e(i,t,c)}r.then(function(){dust.cache[i.CLASS]&&dust.render(i.CLASS,t,function(t,e){i.div.innerHTML=e;if(t){s(Error(t));TC.error(t)}});i.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(n)&&n();o()}).catch(function(t){s(Error(t))})})})};t.getRenderedHtml=function(t,e,n){const i=this;return new Promise(function(o,s){var r=function(){dust.cache[t]&&dust.render(t,e,function(t,e){if(t){TC.error(t);s(Error(t))}else{TC.Util.isFunction(n)&&n(e);o(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])r();else{var e=i.template[t];if("string"==typeof e)TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){const n=e.data;var i=dust.compile(n,t);dust.loadSource(i);r()}).catch(function(t){console.log("Error fetching template: "+t)});else if(TC.Util.isFunction(e)){e();r()}}})})};t.register=function(t){const e=this;return new Promise(function(n,i){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();n(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,n){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,n){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,n)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var n=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(n,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){}}();
//# sourceMappingURL=maps/Control.min.js.map