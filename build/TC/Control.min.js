TC.control=TC.control||{};TC.Control=function(){TC.EventTarget.call(this);this.map=null;this.isActive=!1;this.isDisabled=!1;var t=arguments.length;this.options=$.extend({},t>1?arguments[1]:arguments[0]);this.id=this.options.id||TC.getUID(this.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");this.div=TC.Util.getDiv(this.options.div?this.options.div:arguments[0]);this._$div=$(this.div);this.div.classList.add(TC.Control.prototype.CLASS);this.div.classList.add(this.CLASS);this.template=this.options.template||this.template;this.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template="";t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};const e=function(t,e,i){return new Promise(function(n,s){const o=[],r=[];for(var c in i){var a=i[c];if("string"==typeof a)if(dust.cache[t.CLASS])dust.render(t.CLASS,e,function(e,i){t.div.innerHTML=i;e&&TC.error(e)});else{var l=TC.ajax({url:a,method:"GET",responseType:"text"});o.push(l);r.push(c)}else $.isFunction(a)&&a()}0===o.length?n():Promise.all(o).then(function(t){t.forEach(function(t,e){const i=dust.compile(t,r[e]);dust.loadSource(i)});n()}).catch(function(t){console.error("Error fetching templates: "+t);s(t instanceof Error?t:Error(t))})})};t.renderData=function(t,i){const n=this;return new Promise(function(s,o){n.map&&n.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});n.isDisabled?n.div.classList.add(TC.Consts.classes.DISABLED):n.div.classList.remove(TC.Consts.classes.DISABLED);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r;if("object"==typeof n.template)r=e(n,t,n.template);else{var c={};n.template&&(c[n.CLASS]=n.template);r=e(n,t,c)}r.then(function(){dust.cache[n.CLASS]&&dust.render(n.CLASS,t,function(t,e){n.div.innerHTML=e;if(t){o(Error(t));TC.error(t)}});n.trigger(TC.Consts.event.CONTROLRENDER);$.isFunction(i)&&i();s()}).catch(function(t){o(Error(t))})})})};t.getRenderedHtml=function(t,e,i){const n=this;return new Promise(function(s,o){var r=function(){dust.cache[t]&&dust.render(t,e,function(t,e){if(t){TC.error(t);o(Error(t))}else{$.isFunction(i)&&i(e);s(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])r();else{var e=n.template[t];if("string"==typeof e)TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){var i=dust.compile(e,t);dust.loadSource(i);r()}).catch(function(t){console.log("Error fetching template: "+t)});else if($.isFunction(e)){e();r()}}})})};t.register=function(t){const e=this;return new Promise(function(i,n){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();i(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,i){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,i){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,i)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var i=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(i,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){}}();
//# sourceMappingURL=maps/Control.min.js.map
