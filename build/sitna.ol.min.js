!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.core",[],e):"object"==typeof exports?module.exports=e():t.dust=e()}(this,function(){var dust={version:"2.7.1"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"};!function(){var t,e,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};if("undefined"!=typeof console&&console.log){t=console.log;e="function"==typeof t?function(){t.apply(console,arguments)}:function(){t(Array.prototype.slice.apply(arguments).join(" "))}}else e=EMPTY_FUNC;dust.log=function(t,n){r[n=n||INFO]>=r[dust.debugLevel]&&e("[DUST:"+n+"]",t)};dust.debugLevel=NONE;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}();dust.helpers={};dust.cache={};dust.register=function(t,e){if(t){e.templateName=t;!1!==dust.config.cache&&(dust.cache[t]=e)}};dust.render=function(t,e,r){var n=new Stub(r).head;try{load(t,n,e).end()}catch(t){n.setError(t)}};dust.stream=function(t,e){var r=new Stream,n=r.head;dust.nextTick(function(){try{load(t,n,e).end()}catch(t){n.setError(t)}});return r};function getTemplate(t,e){if(t)return"function"==typeof t&&t.template?t.template:dust.isTemplateFn(t)?t:!1!==e?dust.cache[t]:void 0}function load(t,e,r){if(!t)return e.setError(new Error("No template or template name provided to render"));var n=getTemplate(t,dust.config.cache);return n?n(e,Context.wrap(r,n.templateName)):dust.onLoad?e.map(function(e){var n=t;function i(t,i){var o;if(t)return e.setError(t);if(!(o=getTemplate(i,!1)||getTemplate(n,dust.config.cache))){if(!dust.compile)return e.setError(new Error("Dust compiler not available"));o=dust.loadSource(dust.compile(i,n))}o(e,Context.wrap(r,o.templateName)).end()}3===dust.onLoad.length?dust.onLoad(n,r.options,i):dust.onLoad(n,i)}):e.setError(new Error("Template Not Found: "+t))}dust.loadSource=function(source){return eval(source)};Array.isArray?dust.isArray=Array.isArray:dust.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)};dust.nextTick=function(t){setTimeout(t,0)};dust.isEmpty=function(t){return 0!==t&&(!(!dust.isArray(t)||t.length)||!t)};dust.isEmptyObject=function(t){var e;if(null===t)return!1;if(void 0===t)return!1;if(t.length>0)return!1;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0};dust.isTemplateFn=function(t){return"function"==typeof t&&t.__dustBody};dust.isThenable=function(t){return t&&"object"==typeof t&&"function"==typeof t.then};dust.isStreamable=function(t){return t&&"function"==typeof t.on};dust.filter=function(t,e,r){var n,i,o;if(r)for(n=0,i=r.length;n<i;n++)"s"===(o=r[n])?e=null:"function"==typeof dust.filters[o]?t=dust.filters[o](t):dust.log("Invalid filter `"+o+"`",WARN);e&&(t=dust.filters[e](t));return t};dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return dust.escapeJSON(t)},jp:function(t){if(JSON)return JSON.parse(t);dust.log("JSON is undefined; could not parse `"+t+"`",WARN);return t}};function Context(t,e,r,n,i){void 0===t||t instanceof Stack||(t=new Stack(t));this.stack=t;this.global=e;this.options=r;this.blocks=n;this.templateName=i}dust.makeBase=dust.context=function(t,e){return new Context(void 0,t,e)};function getWithResolvedData(t,e,r){return function(n){return t.push(n)._get(e,r)}}Context.wrap=function(t,e){return t instanceof Context?t:new Context(t,{},{},null,e)};Context.prototype.get=function(t,e){if("string"==typeof t){if("."===t[0]){e=!0;t=t.substr(1)}t=t.split(".")}return this._get(e,t)};Context.prototype._get=function(t,e){var r,n,i,o,a,s=this.stack||{},l=1;n=e[0];i=e.length;if(t&&0===i){o=s;s=s.head}else{if(t)s&&(s=s.head?s.head[n]:void 0);else{for(;s;){if(s.isObject){o=s.head;if(void 0!==(r=s.head[n]))break}s=s.tail}s=void 0!==r?r:this.global&&this.global[n]}for(;s&&l<i;){if(dust.isThenable(s))return s.then(getWithResolvedData(this,t,e.slice(l)));o=s;s=s[e[l]];l++}}if("function"==typeof s){(a=function(){try{return s.apply(o,arguments)}catch(t){dust.log(t,ERROR);throw t}}).__dustBody=!!s.__dustBody;return a}void 0===s&&dust.log("Cannot find reference `{"+e.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO);return s};Context.prototype.getPath=function(t,e){return this._get(t,e)};Context.prototype.push=function(t,e,r){if(void 0===t){dust.log("Not pushing an undefined variable onto the context",INFO);return this}return this.rebase(new Stack(t,this.stack,e,r))};Context.prototype.pop=function(){var t=this.current();this.stack=this.stack&&this.stack.tail;return t};Context.prototype.rebase=function(t){return new Context(t,this.global,this.options,this.blocks,this.getTemplateName())};Context.prototype.clone=function(){var t=this.rebase();t.stack=this.stack;return t};Context.prototype.current=function(){return this.stack&&this.stack.head};Context.prototype.getBlock=function(t){var e,r,n;"function"==typeof t&&(t=t(new Chunk,this).data.join(""));if(!(e=this.blocks)){dust.log("No blocks for context `"+t+"` in template `"+this.getTemplateName()+"`",DEBUG);return!1}r=e.length;for(;r--;)if(n=e[r][t])return n;dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks.");return!1};Context.prototype.shiftBlocks=function(t){var e,r=this.blocks;if(t){e=r?r.concat([t]):[t];return new Context(this.stack,this.global,this.options,e,this.getTemplateName())}return this};Context.prototype.resolve=function(t){var e;return"function"!=typeof t?t:(e=(new Chunk).render(t,this))instanceof Chunk?e.data.join(""):e};Context.prototype.getTemplateName=function(){return this.templateName};function Stack(t,e,r,n){this.tail=e;this.isObject=t&&"object"==typeof t;this.head=t;this.index=r;this.of=n}function Stub(t){this.head=new Chunk(this);this.callback=t;this.out=""}Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable){if(t.error){this.callback(t.error);dust.log("Rendering failed with error `"+t.error+"`",ERROR);this.flush=EMPTY_FUNC;return}return}this.out+=t.data.join("");t=t.next;this.head=t}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable){if(t.error){this.emit("error",t.error);this.emit("end");dust.log("Streaming failed with error `"+t.error+"`",ERROR);this.flush=EMPTY_FUNC;return}return}this.emit("data",t.data.join(""));t=t.next;this.head=t}this.emit("end")};Stream.prototype.emit=function(t,e){var r,n,i=(this.events||{})[t]||[];if(!i.length){dust.log("Stream broadcasting, but no listeners for `"+t+"`",DEBUG);return!1}for(r=0,n=(i=i.slice(0)).length;r<n;r++)i[r](e);return!0};Stream.prototype.on=function(t,e){var r=this.events=this.events||{},n=r[t]=r[t]||[];"function"!=typeof e?dust.log("No callback function provided for `"+t+"` event listener",WARN):n.push(e);return this};Stream.prototype.pipe=function(t){if("function"!=typeof t.write||"function"!=typeof t.end){dust.log("Incompatible stream passed to `pipe`",WARN);return this}var e=!1;"function"==typeof t.emit&&t.emit("pipe",this);"function"==typeof t.on&&t.on("error",function(){e=!0});return this.on("data",function(r){if(!e)try{t.write(r,"utf8")}catch(t){dust.log(t,ERROR)}}).on("end",function(){if(!e)try{t.end();e=!0}catch(t){dust.log(t,ERROR)}})};function Chunk(t,e,r){this.root=t;this.next=e;this.data=[];this.flushable=!1;this.taps=r}Chunk.prototype.write=function(t){var e=this.taps;e&&(t=e.go(t));this.data.push(t);return this};Chunk.prototype.end=function(t){t&&this.write(t);this.flushable=!0;this.root.flush();return this};Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),r=new Chunk(this.root,e,this.taps);this.next=r;this.flushable=!0;try{t(r)}catch(t){dust.log(t,ERROR);r.setError(t)}return e};Chunk.prototype.tap=function(t){var e=this.taps;this.taps=e?e.push(t):new Tap(t);return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(t,e){return t(this,e)};Chunk.prototype.reference=function(t,e,r,n){return"function"==typeof t?(t=t.apply(e.current(),[this,e,null,{auto:r,filters:n}]))instanceof Chunk?t:this.reference(t,e,r,n):dust.isThenable(t)?this.await(t,e,null,r,n):dust.isStreamable(t)?this.stream(t,e,null,r,n):dust.isEmpty(t)?this:this.write(dust.filter(t,r,n))};Chunk.prototype.section=function(t,e,r,n){var i,o,a,s=r.block,l=r.else,c=this;if("function"==typeof t&&!dust.isTemplateFn(t)){try{t=t.apply(e.current(),[this,e,r,n])}catch(t){dust.log(t,ERROR);return this.setError(t)}if(t instanceof Chunk)return t}dust.isEmptyObject(n)||(e=e.push(n));if(dust.isArray(t)){if(s){if((o=t.length)>0){(a=e.stack&&e.stack.head||{}).$len=o;for(i=0;i<o;i++){a.$idx=i;c=s(c,e.push(t[i],i,o))}a.$idx=void 0;a.$len=void 0;return c}if(l)return l(this,e)}}else{if(dust.isThenable(t))return this.await(t,e,r);if(dust.isStreamable(t))return this.stream(t,e,r);if(!0===t){if(s)return s(this,e)}else if(t||0===t){if(s)return s(this,e.push(t))}else if(l)return l(this,e)}dust.log("Section without corresponding key in template `"+e.getTemplateName()+"`",DEBUG);return this};Chunk.prototype.exists=function(t,e,r){var n=r.block,i=r.else;if(dust.isEmpty(t)){if(i)return i(this,e)}else{if(n)return n(this,e);dust.log("No block for exists check in template `"+e.getTemplateName()+"`",DEBUG)}return this};Chunk.prototype.notexists=function(t,e,r){var n=r.block,i=r.else;if(dust.isEmpty(t)){if(n)return n(this,e);dust.log("No block for not-exists check in template `"+e.getTemplateName()+"`",DEBUG)}else if(i)return i(this,e);return this};Chunk.prototype.block=function(t,e,r){var n=t||r.block;return n?n(this,e):this};Chunk.prototype.partial=function(t,e,r,n){var i;if(void 0===n){n=r;r=e}if(!dust.isEmptyObject(n)){i=(r=r.clone()).pop();r=r.push(n).push(i)}if(dust.isTemplateFn(t))return this.capture(t,e,function(t,e){r.templateName=t;load(t,e,r).end()});r.templateName=t;return load(t,this,r)};Chunk.prototype.helper=function(t,e,r,n){var i;if(!dust.helpers[t]){dust.log("Helper `"+t+"` does not exist",WARN);return this}try{i=dust.helpers[t](this,e,r,n);return dust.isThenable(i)?this.await(i,e,r):i}catch(e){dust.log("Error in helper `"+t+"`: "+e.message,ERROR);return this.setError(e)}};Chunk.prototype.await=function(t,e,r,n,i){var o=r&&r.block,a=r&&r.error;return this.map(function(r){t.then(function(t){o?r.render(o,e.push(t)).end():r.reference(t,e,n,i).end()},function(t){if(a)r.render(a,e.push(t)).end();else{dust.log("Unhandled promise rejection in `"+e.getTemplateName()+"`");r.end()}})})};Chunk.prototype.stream=function(t,e,r,n,i){var o=r&&r.block,a=r&&r.error;return this.map(function(r){var s=!1;t.on("data",function(t){s||(r=o?r.map(function(r){r.render(o,e.push(t)).end()}):r.reference(t,e,n,i))}).on("error",function(t){if(!s){a?r.render(a,e.push(t)):dust.log("Unhandled stream error in `"+e.getTemplateName()+"`");if(!s){s=!0;r.end()}}}).on("end",function(){if(!s){s=!0;r.end()}})})};Chunk.prototype.capture=function(t,e,r){return this.map(function(n){var i=new Stub(function(t,e){t?n.setError(t):r(e,n)});t(i.head,e).end()})};Chunk.prototype.setError=function(t){this.error=t;this.root.flush();return this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);function Tap(t,e){this.head=t;this.tail=e}Tap.prototype.push=function(t){return new Tap(t,this)};Tap.prototype.go=function(t){for(var e=this;e;){t=e.head(t);e=e.tail}return t};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){if("string"==typeof t||t&&"function"==typeof t.toString){"string"!=typeof t&&(t=t.toString());return HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t}return t};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t};dust.escapeJSON=function(t){if(JSON)return JSON.stringify(t).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c");dust.log("JSON is undefined; could not escape `"+t+"`",WARN);return t};return dust});!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.parse",["dust.core"],function(t){return e(t).parse}):"object"==typeof exports?module.exports=e(require("./dust")):e(t.dust)}(this,function(t){var e=function(){function t(t,e,r,n,i,o){this.message=t;this.expected=e;this.found=r;this.offset=n;this.line=i;this.column=o;this.name="SyntaxError"}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r}(t,Error);return{SyntaxError:t,parse:function(e){var r,n=arguments.length>1?arguments[1]:{},i={},o={start:Ue},a=Ue,s=function(t){return dr(["body"].concat(t))},l={type:"other",description:"section"},c=i,u=null,h=function(t,e,r,n){n&&t[1].text===n.text||function(t){throw Ge(t,null,Re)}("Expected end tag for "+t[1].text+" but it was not found.");return!0},d=void 0,p=function(t,e,r,n){r.push(["param",["literal","block"],e]);t.push(r);return dr(t)},f="/",g={type:"literal",value:"/",description:'"/"'},y=function(t){t.push(["bodies"]);return dr(t)},m=/^[#?\^<+@%]/,C={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},v=function(t,e,r,n){return[t,e,r,n]},T={type:"other",description:"end tag"},_=function(t){return t},S=":",E={type:"literal",value:":",description:'":"'},w=function(t){return t},b=function(t){return t?["context",t]:["context"]},L={type:"other",description:"params"},A="=",x={type:"literal",value:"=",description:'"="'},P=function(t,e){return["param",["literal",t],e]},I=function(t){return["params"].concat(t)},R={type:"other",description:"bodies"},O=function(t){return["bodies"].concat(t)},M={type:"other",description:"reference"},k=function(t,e){return dr(["reference",t,e])},N={type:"other",description:"partial"},D=">",F={type:"literal",value:">",description:'">"'},B="+",G={type:"literal",value:"+",description:'"+"'},U=function(t){return["literal",t]},j=function(t,e,r,n){return dr([">"===t?"partial":t,e,r,n])},q={type:"other",description:"filters"},W="|",H={type:"literal",value:"|",description:'"|"'},V=function(t){return["filters"].concat(t)},Y={type:"other",description:"special"},z="~",K={type:"literal",value:"~",description:'"~"'},$=function(t){return dr(["special",t])},X={type:"other",description:"identifier"},Z=function(t){var e=["path"].concat(t);e.text=t[1].join(".").replace(/,line,\d+,col,\d+/g,"");return e},J=function(t){var e=["key",t];e.text=t;return e},Q={type:"other",description:"number"},tt=function(t){return["literal",t]},et={type:"other",description:"float"},rt=".",nt={type:"literal",value:".",description:'"."'},it=function(t,e){return parseFloat(t+"."+e)},ot={type:"other",description:"unsigned_integer"},at=/^[0-9]/,st={type:"class",value:"[0-9]",description:"[0-9]"},lt=function(t){return parseInt(t.join(""),10)},ct={type:"other",description:"signed_integer"},ut="-",ht={type:"literal",value:"-",description:'"-"'},dt=function(t,e){return-1*e},pt={type:"other",description:"integer"},ft={type:"other",description:"path"},gt=function(t,e){e=e[0];if(t&&e){e.unshift(t);return dr([!1,e])}return dr([!0,e])},yt=function(t){return t.length>0?dr([!0,t[0]]):dr([!0,[]])},mt={type:"other",description:"key"},Ct=/^[a-zA-Z_$]/,vt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},Tt=/^[0-9a-zA-Z_$\-]/,_t={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},St=function(t,e){return t+e.join("")},Et={type:"other",description:"array"},wt=function(t){return t.join("")},bt=function(t){return t},Lt=function(t,e){e?e.unshift(t):e=[t];return e},At={type:"other",description:"array_part"},xt=function(t){return t},Pt=function(t,e){return e?t.concat(e):t},It={type:"other",description:"inline"},Rt='"',Ot={type:"literal",value:'"',description:'"\\""'},Mt=function(){return dr(["literal",""])},kt=function(t){return dr(["literal",t])},Nt=function(t){return dr(["body"].concat(t))},Dt=function(t){return["buffer",t]},Ft={type:"other",description:"buffer"},Bt=function(t,e){return dr(["format",t,e.join("")])},Gt={type:"any",description:"any character"},Ut=function(t){return t},jt=function(t){return dr(["buffer",t.join("")])},qt={type:"other",description:"literal"},Wt=/^[^"]/,Ht={type:"class",value:'[^"]',description:'[^"]'},Vt=function(t){return t.join("")},Yt='\\"',zt={type:"literal",value:'\\"',description:'"\\\\\\""'},Kt=function(){return'"'},$t={type:"other",description:"raw"},Xt="{`",Zt={type:"literal",value:"{`",description:'"{`"'},Jt="`}",Qt={type:"literal",value:"`}",description:'"`}"'},te=function(t){return t},ee=function(t){return dr(["raw",t.join("")])},re={type:"other",description:"comment"},ne="{!",ie={type:"literal",value:"{!",description:'"{!"'},oe="!}",ae={type:"literal",value:"!}",description:'"!}"'},se=function(t){return dr(["comment",t.join("")])},le=/^[#?\^><+%:@\/~%]/,ce={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},ue="{",he={type:"literal",value:"{",description:'"{"'},de="}",pe={type:"literal",value:"}",description:'"}"'},fe="[",ge={type:"literal",value:"[",description:'"["'},ye="]",me={type:"literal",value:"]",description:'"]"'},Ce="\n",ve={type:"literal",value:"\n",description:'"\\n"'},Te="\r\n",_e={type:"literal",value:"\r\n",description:'"\\r\\n"'},Se="\r",Ee={type:"literal",value:"\r",description:'"\\r"'},we="\u2028",be={type:"literal",value:"\u2028",description:'"\\u2028"'},Le="\u2029",Ae={type:"literal",value:"\u2029",description:'"\\u2029"'},xe=/^[\t\x0B\f \xA0\uFEFF]/,Pe={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},Ie=0,Re=0,Oe=0,Me={line:1,column:1,seenCR:!1},ke=0,Ne=[],De=0;if("startRule"in n){if(!(n.startRule in o))throw new Error("Can't start parsing from rule \""+n.startRule+'".');a=o[n.startRule]}function Fe(t){if(Oe!==t){if(Oe>t){Oe=0;Me={line:1,column:1,seenCR:!1}}!function(t,r,n){var i,o;for(i=r;i<n;i++)if("\n"===(o=e.charAt(i))){t.seenCR||t.line++;t.column=1;t.seenCR=!1}else if("\r"===o||"\u2028"===o||"\u2029"===o){t.line++;t.column=1;t.seenCR=!0}else{t.column++;t.seenCR=!1}}(Me,Oe,t);Oe=t}return Me}function Be(t){if(!(Ie<ke)){if(Ie>ke){ke=Ie;Ne=[]}Ne.push(t)}}function Ge(r,n,i){var o=Fe(i),a=i<e.length?e.charAt(i):null;null!==n&&function(t){var e=1;t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});for(;e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}(n);return new t(null!==r?r:function(t,e){var r,n=new Array(t.length);for(r=0;r<t.length;r++)n[r]=t[r].description;return"Expected "+(t.length>1?n.slice(0,-1).join(", ")+" or "+n[t.length-1]:n[0])+" but "+(e?'"'+function(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}(e)+'"':"end of input")+" found."}(n,a),n,a,i,o.line,o.column)}function Ue(){return je()}function je(){var t,e,r;t=Ie;e=[];r=qe();for(;r!==i;){e.push(r);r=qe()}if(e!==i){Re=t;e=s(e)}return t=e}function qe(){var t;(t=or())===i&&(t=ar())===i&&(t=function(){var t,r,n,o,a,s,m;De++;t=Ie;if((r=We())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i)if((o=cr())!==i)if((a=je())!==i)if((s=function(){var t,r,n,o,a,s,l;De++;t=Ie;r=[];n=Ie;if((o=lr())!==i){if(58===e.charCodeAt(Ie)){a=S;Ie++}else{a=i;0===De&&Be(E)}if(a!==i)if((s=Je())!==i)if(cr()!==i)if((l=je())!==i){Re=n;o=P(s,l);n=o}else{Ie=n;n=c}else{Ie=n;n=c}else{Ie=n;n=c}else{Ie=n;n=c}}else{Ie=n;n=c}for(;n!==i;){r.push(n);n=Ie;if((o=lr())!==i){if(58===e.charCodeAt(Ie)){a=S;Ie++}else{a=i;0===De&&Be(E)}if(a!==i)if((s=Je())!==i)if(cr()!==i)if((l=je())!==i){Re=n;o=P(s,l);n=o}else{Ie=n;n=c}else{Ie=n;n=c}else{Ie=n;n=c}else{Ie=n;n=c}}else{Ie=n;n=c}}if(r!==i){Re=t;r=O(r)}De--;if((t=r)===i){r=i;0===De&&Be(R)}return t}())!==i){(m=function(){var t,r,n,o,a,s,l;De++;t=Ie;if((r=lr())!==i){if(47===e.charCodeAt(Ie)){n=f;Ie++}else{n=i;0===De&&Be(g)}if(n!==i){o=[];a=hr();for(;a!==i;){o.push(a);a=hr()}if(o!==i)if((a=Ke())!==i){s=[];l=hr();for(;l!==i;){s.push(l);l=hr()}if(s!==i)if((l=cr())!==i){Re=t;r=_(a);t=r}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(T)}return t}())===i&&(m=u);if(m!==i){Re=Ie;if((h(r,a,s,m)?d:c)!==i){Re=t;r=p(r,a,s,m);t=r}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}if(t===i){t=Ie;if((r=We())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){if(47===e.charCodeAt(Ie)){o=f;Ie++}else{o=i;0===De&&Be(g)}if(o!==i)if((a=cr())!==i){Re=t;r=y(r);t=r}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}De--;if(t===i){r=i;0===De&&Be(l)}return t}())===i&&(t=function(){var t,r,n,o,a,s,l,u,h;De++;t=Ie;if((r=lr())!==i){if(62===e.charCodeAt(Ie)){n=D;Ie++}else{n=i;0===De&&Be(F)}if(n===i)if(43===e.charCodeAt(Ie)){n=B;Ie++}else{n=i;0===De&&Be(G)}if(n!==i){o=[];a=hr();for(;a!==i;){o.push(a);a=hr()}if(o!==i){a=Ie;if((s=Je())!==i){Re=a;s=U(s)}(a=s)===i&&(a=er());if(a!==i)if((s=He())!==i)if((l=Ve())!==i){u=[];h=hr();for(;h!==i;){u.push(h);h=hr()}if(u!==i){if(47===e.charCodeAt(Ie)){h=f;Ie++}else{h=i;0===De&&Be(g)}if(h!==i)if(cr()!==i){Re=t;r=j(n,a,s,l);t=r}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(N)}return t}())===i&&(t=ze())===i&&(t=Ye())===i&&(t=function(){var t,r,n,o,a,s,l,u;De++;t=Ie;if((r=ur())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){Re=t;r=Bt(r,n);t=r}else{Ie=t;t=c}}else{Ie=t;t=c}if(t===i){t=Ie;r=[];n=Ie;o=Ie;De++;a=sr();De--;if(a===i)o=d;else{Ie=o;o=c}if(o!==i){a=Ie;De++;s=or();De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){s=Ie;De++;l=ar();De--;if(l===i)s=d;else{Ie=s;s=c}if(s!==i){l=Ie;De++;u=ur();De--;if(u===i)l=d;else{Ie=l;l=c}if(l!==i){if(e.length>Ie){u=e.charAt(Ie);Ie++}else{u=i;0===De&&Be(Gt)}if(u!==i){Re=n;o=Ut(u);n=o}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Ie;o=Ie;De++;a=sr();De--;if(a===i)o=d;else{Ie=o;o=c}if(o!==i){a=Ie;De++;s=or();De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){s=Ie;De++;l=ar();De--;if(l===i)s=d;else{Ie=s;s=c}if(s!==i){l=Ie;De++;u=ur();De--;if(u===i)l=d;else{Ie=l;l=c}if(l!==i){if(e.length>Ie){u=e.charAt(Ie);Ie++}else{u=i;0===De&&Be(Gt)}if(u!==i){Re=n;o=Ut(u);n=o}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}}else r=c;if(r!==i){Re=t;r=jt(r)}t=r}De--;if(t===i){r=i;0===De&&Be(Ft)}return t}());return t}function We(){var t,r,n,o,a,s;t=Ie;if(lr()!==i){if(m.test(e.charAt(Ie))){r=e.charAt(Ie);Ie++}else{r=i;0===De&&Be(C)}if(r!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i)if((o=Ke())!==i)if((a=He())!==i)if((s=Ve())!==i){Re=t;t=v(r,o,a,s)}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}return t}function He(){var t,r,n,o;t=Ie;r=Ie;if(58===e.charCodeAt(Ie)){n=S;Ie++}else{n=i;0===De&&Be(E)}if(n!==i)if((o=Ke())!==i){Re=r;r=n=w(o)}else{Ie=r;r=c}else{Ie=r;r=c}r===i&&(r=u);if(r!==i){Re=t;r=b(r)}return t=r}function Ve(){var t,r,n,o,a,s,l;De++;t=Ie;r=[];n=Ie;o=[];if((a=hr())!==i)for(;a!==i;){o.push(a);a=hr()}else o=c;if(o!==i)if((a=Je())!==i){if(61===e.charCodeAt(Ie)){s=A;Ie++}else{s=i;0===De&&Be(x)}if(s!==i){(l=$e())===i&&(l=Ke())===i&&(l=er());if(l!==i){Re=n;n=o=P(a,l)}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}else{Ie=n;n=c}for(;n!==i;){r.push(n);n=Ie;o=[];if((a=hr())!==i)for(;a!==i;){o.push(a);a=hr()}else o=c;if(o!==i)if((a=Je())!==i){if(61===e.charCodeAt(Ie)){s=A;Ie++}else{s=i;0===De&&Be(x)}if(s!==i){(l=$e())===i&&(l=Ke())===i&&(l=er());if(l!==i){Re=n;n=o=P(a,l)}else{Ie=n;n=c}}else{Ie=n;n=c}}else{Ie=n;n=c}else{Ie=n;n=c}}if(r!==i){Re=t;r=I(r)}De--;if((t=r)===i){r=i;0===De&&Be(L)}return t}function Ye(){var t,r,n;De++;t=Ie;if(lr()!==i)if((r=Ke())!==i)if((n=function(){var t,r,n,o,a;De++;t=Ie;r=[];n=Ie;if(124===e.charCodeAt(Ie)){o=W;Ie++}else{o=i;0===De&&Be(H)}if(o!==i)if((a=Je())!==i){Re=n;o=w(a);n=o}else{Ie=n;n=c}else{Ie=n;n=c}for(;n!==i;){r.push(n);n=Ie;if(124===e.charCodeAt(Ie)){o=W;Ie++}else{o=i;0===De&&Be(H)}if(o!==i)if((a=Je())!==i){Re=n;o=w(a);n=o}else{Ie=n;n=c}else{Ie=n;n=c}}if(r!==i){Re=t;r=V(r)}De--;if((t=r)===i){r=i;0===De&&Be(q)}return t}())!==i)if(cr()!==i){Re=t;t=k(r,n)}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}De--;t===i&&0===De&&Be(M);return t}function ze(){var t,r,n;De++;t=Ie;if(lr()!==i){if(126===e.charCodeAt(Ie)){r=z;Ie++}else{r=i;0===De&&Be(K)}if(r!==i)if((n=Je())!==i)if(cr()!==i){Re=t;t=$(n)}else{Ie=t;t=c}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}De--;t===i&&0===De&&Be(Y);return t}function Ke(){var t,r;De++;t=Ie;if((r=function(){var t,r,n,o;De++;t=Ie;(r=Je())===i&&(r=u);if(r!==i){n=[];(o=tr())===i&&(o=Qe());if(o!==i)for(;o!==i;){n.push(o);(o=tr())===i&&(o=Qe())}else n=c;if(n!==i){Re=t;r=gt(r,n);t=r}else{Ie=t;t=c}}else{Ie=t;t=c}if(t===i){t=Ie;if(46===e.charCodeAt(Ie)){r=rt;Ie++}else{r=i;0===De&&Be(nt)}if(r!==i){n=[];(o=tr())===i&&(o=Qe());for(;o!==i;){n.push(o);(o=tr())===i&&(o=Qe())}if(n!==i){Re=t;r=yt(n);t=r}else{Ie=t;t=c}}else{Ie=t;t=c}}De--;if(t===i){r=i;0===De&&Be(ft)}return t}())!==i){Re=t;r=Z(r)}if((t=r)===i){t=Ie;if((r=Je())!==i){Re=t;r=J(r)}t=r}De--;if(t===i){r=i;0===De&&Be(X)}return t}function $e(){var t,r;De++;t=Ie;(r=function(){var t,r,n,o;De++;t=Ie;if((r=Ze())!==i){if(46===e.charCodeAt(Ie)){n=rt;Ie++}else{n=i;0===De&&Be(nt)}if(n!==i)if((o=Xe())!==i){Re=t;r=it(r,o);t=r}else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(et)}return t}())===i&&(r=Ze());if(r!==i){Re=t;r=tt(r)}De--;if((t=r)===i){r=i;0===De&&Be(Q)}return t}function Xe(){var t,r,n;De++;t=Ie;r=[];if(at.test(e.charAt(Ie))){n=e.charAt(Ie);Ie++}else{n=i;0===De&&Be(st)}if(n!==i)for(;n!==i;){r.push(n);if(at.test(e.charAt(Ie))){n=e.charAt(Ie);Ie++}else{n=i;0===De&&Be(st)}}else r=c;if(r!==i){Re=t;r=lt(r)}De--;if((t=r)===i){r=i;0===De&&Be(ot)}return t}function Ze(){var t;De++;(t=function(){var t,r,n;De++;t=Ie;if(45===e.charCodeAt(Ie)){r=ut;Ie++}else{r=i;0===De&&Be(ht)}if(r!==i)if((n=Xe())!==i){Re=t;t=r=dt(r,n)}else{Ie=t;t=c}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(ct)}return t}())===i&&(t=Xe());De--;t===i&&0===De&&Be(pt);return t}function Je(){var t,r,n,o;De++;t=Ie;if(Ct.test(e.charAt(Ie))){r=e.charAt(Ie);Ie++}else{r=i;0===De&&Be(vt)}if(r!==i){n=[];if(Tt.test(e.charAt(Ie))){o=e.charAt(Ie);Ie++}else{o=i;0===De&&Be(_t)}for(;o!==i;){n.push(o);if(Tt.test(e.charAt(Ie))){o=e.charAt(Ie);Ie++}else{o=i;0===De&&Be(_t)}}if(n!==i){Re=t;t=r=St(r,n)}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(mt)}return t}function Qe(){var t,r,n,o,a,s;De++;t=Ie;r=Ie;if((n=function(){var t;if(91===e.charCodeAt(Ie)){t=fe;Ie++}else{t=i;0===De&&Be(ge)}return t}())!==i){o=Ie;a=[];if(at.test(e.charAt(Ie))){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(st)}if(s!==i)for(;s!==i;){a.push(s);if(at.test(e.charAt(Ie))){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(st)}}else a=c;if(a!==i){Re=o;a=wt(a)}(o=a)===i&&(o=Ke());if(o!==i)if((a=function(){var t;if(93===e.charCodeAt(Ie)){t=ye;Ie++}else{t=i;0===De&&Be(me)}return t}())!==i){Re=r;r=n=bt(o)}else{Ie=r;r=c}else{Ie=r;r=c}}else{Ie=r;r=c}if(r!==i){(n=tr())===i&&(n=u);if(n!==i){Re=t;t=r=Lt(r,n)}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(Et)}return t}function tr(){var t,r,n,o,a;De++;t=Ie;r=[];n=Ie;if(46===e.charCodeAt(Ie)){o=rt;Ie++}else{o=i;0===De&&Be(nt)}if(o!==i)if((a=Je())!==i){Re=n;n=o=xt(a)}else{Ie=n;n=c}else{Ie=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Ie;if(46===e.charCodeAt(Ie)){o=rt;Ie++}else{o=i;0===De&&Be(nt)}if(o!==i)if((a=Je())!==i){Re=n;n=o=xt(a)}else{Ie=n;n=c}else{Ie=n;n=c}}else r=c;if(r!==i){(n=Qe())===i&&(n=u);if(n!==i){Re=t;t=r=Pt(r,n)}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(At)}return t}function er(){var t,r,n,o;De++;t=Ie;if(34===e.charCodeAt(Ie)){r=Rt;Ie++}else{r=i;0===De&&Be(Ot)}if(r!==i){if(34===e.charCodeAt(Ie)){n=Rt;Ie++}else{n=i;0===De&&Be(Ot)}if(n!==i){Re=t;t=r=Mt()}else{Ie=t;t=c}}else{Ie=t;t=c}if(t===i){t=Ie;if(34===e.charCodeAt(Ie)){r=Rt;Ie++}else{r=i;0===De&&Be(Ot)}if(r!==i)if((n=nr())!==i){if(34===e.charCodeAt(Ie)){o=Rt;Ie++}else{o=i;0===De&&Be(Ot)}if(o!==i){Re=t;t=r=kt(n)}else{Ie=t;t=c}}else{Ie=t;t=c}else{Ie=t;t=c}if(t===i){t=Ie;if(34===e.charCodeAt(Ie)){r=Rt;Ie++}else{r=i;0===De&&Be(Ot)}if(r!==i){n=[];if((o=rr())!==i)for(;o!==i;){n.push(o);o=rr()}else n=c;if(n!==i){if(34===e.charCodeAt(Ie)){o=Rt;Ie++}else{o=i;0===De&&Be(Ot)}if(o!==i){Re=t;t=r=Nt(n)}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}}De--;if(t===i){r=i;0===De&&Be(It)}return t}function rr(){var t,e;if((t=ze())===i&&(t=Ye())===i){t=Ie;if((e=nr())!==i){Re=t;e=Dt(e)}t=e}return t}function nr(){var t,r,n,o,a;De++;t=Ie;r=[];n=Ie;o=Ie;De++;a=sr();De--;if(a===i)o=d;else{Ie=o;o=c}if(o!==i){if((a=ir())===i)if(Wt.test(e.charAt(Ie))){a=e.charAt(Ie);Ie++}else{a=i;0===De&&Be(Ht)}if(a!==i){Re=n;n=o=Ut(a)}else{Ie=n;n=c}}else{Ie=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Ie;o=Ie;De++;a=sr();De--;if(a===i)o=d;else{Ie=o;o=c}if(o!==i){if((a=ir())===i)if(Wt.test(e.charAt(Ie))){a=e.charAt(Ie);Ie++}else{a=i;0===De&&Be(Ht)}if(a!==i){Re=n;n=o=Ut(a)}else{Ie=n;n=c}}else{Ie=n;n=c}}else r=c;if(r!==i){Re=t;r=Vt(r)}De--;if((t=r)===i){r=i;0===De&&Be(qt)}return t}function ir(){var t,r;t=Ie;if(e.substr(Ie,2)===Yt){r=Yt;Ie+=2}else{r=i;0===De&&Be(zt)}if(r!==i){Re=t;r=Kt()}return t=r}function or(){var t,r,n,o,a,s;De++;t=Ie;if(e.substr(Ie,2)===Xt){r=Xt;Ie+=2}else{r=i;0===De&&Be(Zt)}if(r!==i){n=[];o=Ie;a=Ie;De++;if(e.substr(Ie,2)===Jt){s=Jt;Ie+=2}else{s=i;0===De&&Be(Qt)}De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){if(e.length>Ie){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(Gt)}if(s!==i){Re=o;o=a=te(s)}else{Ie=o;o=c}}else{Ie=o;o=c}for(;o!==i;){n.push(o);o=Ie;a=Ie;De++;if(e.substr(Ie,2)===Jt){s=Jt;Ie+=2}else{s=i;0===De&&Be(Qt)}De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){if(e.length>Ie){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(Gt)}if(s!==i){Re=o;o=a=te(s)}else{Ie=o;o=c}}else{Ie=o;o=c}}if(n!==i){if(e.substr(Ie,2)===Jt){o=Jt;Ie+=2}else{o=i;0===De&&Be(Qt)}if(o!==i){Re=t;t=r=ee(n)}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be($t)}return t}function ar(){var t,r,n,o,a,s;De++;t=Ie;if(e.substr(Ie,2)===ne){r=ne;Ie+=2}else{r=i;0===De&&Be(ie)}if(r!==i){n=[];o=Ie;a=Ie;De++;if(e.substr(Ie,2)===oe){s=oe;Ie+=2}else{s=i;0===De&&Be(ae)}De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){if(e.length>Ie){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(Gt)}if(s!==i){Re=o;o=a=Ut(s)}else{Ie=o;o=c}}else{Ie=o;o=c}for(;o!==i;){n.push(o);o=Ie;a=Ie;De++;if(e.substr(Ie,2)===oe){s=oe;Ie+=2}else{s=i;0===De&&Be(ae)}De--;if(s===i)a=d;else{Ie=a;a=c}if(a!==i){if(e.length>Ie){s=e.charAt(Ie);Ie++}else{s=i;0===De&&Be(Gt)}if(s!==i){Re=o;o=a=Ut(s)}else{Ie=o;o=c}}else{Ie=o;o=c}}if(n!==i){if(e.substr(Ie,2)===oe){o=oe;Ie+=2}else{o=i;0===De&&Be(ae)}if(o!==i){Re=t;t=r=se(n)}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}De--;if(t===i){r=i;0===De&&Be(re)}return t}function sr(){var t,r,n,o,a,s,l,u,h,p;t=Ie;if((r=lr())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){if(le.test(e.charAt(Ie))){o=e.charAt(Ie);Ie++}else{o=i;0===De&&Be(ce)}if(o!==i){a=[];s=hr();for(;s!==i;){a.push(s);s=hr()}if(a!==i){s=[];l=Ie;u=Ie;De++;h=cr();De--;if(h===i)u=d;else{Ie=u;u=c}if(u!==i){h=Ie;De++;p=ur();De--;if(p===i)h=d;else{Ie=h;h=c}if(h!==i){if(e.length>Ie){p=e.charAt(Ie);Ie++}else{p=i;0===De&&Be(Gt)}if(p!==i)l=u=[u,h,p];else{Ie=l;l=c}}else{Ie=l;l=c}}else{Ie=l;l=c}if(l!==i)for(;l!==i;){s.push(l);l=Ie;u=Ie;De++;h=cr();De--;if(h===i)u=d;else{Ie=u;u=c}if(u!==i){h=Ie;De++;p=ur();De--;if(p===i)h=d;else{Ie=h;h=c}if(h!==i){if(e.length>Ie){p=e.charAt(Ie);Ie++}else{p=i;0===De&&Be(Gt)}if(p!==i)l=u=[u,h,p];else{Ie=l;l=c}}else{Ie=l;l=c}}else{Ie=l;l=c}}else s=c;if(s!==i){l=[];u=hr();for(;u!==i;){l.push(u);u=hr()}if(l!==i)if((u=cr())!==i)t=r=[r,n,o,a,s,l,u];else{Ie=t;t=c}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}}else{Ie=t;t=c}t===i&&(t=Ye());return t}function lr(){var t;if(123===e.charCodeAt(Ie)){t=ue;Ie++}else{t=i;0===De&&Be(he)}return t}function cr(){var t;if(125===e.charCodeAt(Ie)){t=de;Ie++}else{t=i;0===De&&Be(pe)}return t}function ur(){var t;if(10===e.charCodeAt(Ie)){t=Ce;Ie++}else{t=i;0===De&&Be(ve)}if(t===i){if(e.substr(Ie,2)===Te){t=Te;Ie+=2}else{t=i;0===De&&Be(_e)}if(t===i){if(13===e.charCodeAt(Ie)){t=Se;Ie++}else{t=i;0===De&&Be(Ee)}if(t===i){if(8232===e.charCodeAt(Ie)){t=we;Ie++}else{t=i;0===De&&Be(be)}if(t===i)if(8233===e.charCodeAt(Ie)){t=Le;Ie++}else{t=i;0===De&&Be(Ae)}}}}return t}function hr(){var t;if(xe.test(e.charAt(Ie))){t=e.charAt(Ie);Ie++}else{t=i;0===De&&Be(Pe)}t===i&&(t=ur());return t}function dr(t){return t.concat([["line",Fe(Re).line],["col",Fe(Re).column]])}if((r=a())!==i&&Ie===e.length)return r;r!==i&&Ie<e.length&&Be({type:"end",description:"end of input"});throw Ge(null,Ne,ke)}}}();t.parse=e.parse;return e});!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.compile",["dust.core","dust.parse"],function(t,r){return e(r,t).compile}):"object"==typeof exports?module.exports=e(require("./parser").parse,require("./dust")):e(t.dust.parse,t.dust)}(this,function(t,e){var r={},n=e.isArray;r.compile=function(n,i){try{return function(t,n){var i,o={name:n,bodies:[],blocks:{},index:0,auto:"h"},a=e.escapeJs(n),s=n?'"'+a+'",':"",l="function(dust){",c=r.compileNode(o,t);n&&(l+='dust.register("'+a+'",'+c+");");l+=function(t){var e,r=[],n=t.blocks;for(e in n)r.push('"'+e+'":'+n[e]);if(r.length){t.blocks="ctx=ctx.shiftBlocks(blocks);";return"var blocks={"+r.join(",")+"};"}t.blocks="";return t.blocks}(o)+function(t){var e,r,n=[],i=t.bodies,o=t.blocks;for(e=0,r=i.length;e<r;e++)n[e]="function body_"+e+"(chk,ctx){"+o+"return chk"+i[e]+";}body_"+e+".__dustBody=!0;";return n.join("")}(o)+"return "+c+"}";i="("+l+"(dust));";return e.config.amd?"define("+s+'["dust.core"],'+l+");":e.config.cjs?"module.exports=function(dust){var tmpl="+i+"var f="+m().toString()+";f.template=tmpl;return f}":i}(function(t){return r.filterNode({},t)}(t(n)),i)}catch(t){if(!t.line||!t.column)throw t;throw new SyntaxError(t.message+" At line : "+t.line+", column : "+t.column)}};r.filterNode=function(t,e){return r.optimizers[e[0]](t,e)};r.optimizers={body:function(t,e){var n,i,o,a,s=[e[0]];for(i=1,o=e.length;i<o;i++)if(a=r.filterNode(t,e[i]))if("buffer"===a[0]||"format"===a[0])if(n){n[0]="buffer"===a[0]?"buffer":n[0];n[1]+=a.slice(1,-2).join("")}else{n=a;s.push(a)}else{n=null;s.push(a)}return s},buffer:a,special:function(t,e){return["buffer",o[e[1]],e[2],e[3]]},format:function(t,r){if(e.config.whitespace){r.splice(1,2,r.slice(1,-2).join(""));return r}return null},reference:i,"#":i,"?":i,"^":i,"<":i,"+":i,"@":i,"%":i,partial:i,context:i,params:i,bodies:i,param:i,filters:a,key:a,path:a,literal:a,raw:a,comment:s,line:s,col:s};r.pragmas={esc:function(t,e,r){var n,i=t.auto;e||(e="h");t.auto="s"===e?"":e;n=l(t,r.block);t.auto=i;return n}};function i(t,e){var n,i,o,a=[e[0]];for(n=1,i=e.length;n<i;n++)(o=r.filterNode(t,e[n]))&&a.push(o);return a}var o={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};function a(t,e){return e}function s(){}function l(t,e){var n,i,o="";for(n=1,i=e.length;n<i;n++)o+=r.compileNode(t,e[n]);return o}r.compileNode=function(t,e){return r.nodes[e[0]](t,e)};r.nodes={body:function(t,e){var r=t.index++,n="body_"+r;t.bodies[r]=l(t,e);return n},buffer:function(t,e){return".w("+y(e[1])+")"},format:function(t,e){return".w("+y(e[1])+")"},reference:function(t,e){return".f("+r.compileNode(t,e[1])+",ctx,"+r.compileNode(t,e[2])+")"},"#":function(t,e){return c(t,e,"section")},"?":function(t,e){return c(t,e,"exists")},"^":function(t,e){return c(t,e,"notexists")},"<":function(t,e){for(var n=e[4],i=1,o=n.length;i<o;i++){var a=n[i];if("block"===a[1][1]){t.blocks[e[1].text]=r.compileNode(t,a[2]);return""}}return""},"+":function(t,e){return void 0===e[1].text&&void 0===e[4]?".b(ctx.getBlock("+r.compileNode(t,e[1])+",chk, ctx),"+r.compileNode(t,e[2])+", {},"+r.compileNode(t,e[3])+")":".b(ctx.getBlock("+y(e[1].text)+"),"+r.compileNode(t,e[2])+","+r.compileNode(t,e[4])+","+r.compileNode(t,e[3])+")"},"@":function(t,e){return".h("+y(e[1].text)+","+r.compileNode(t,e[2])+","+r.compileNode(t,e[4])+","+r.compileNode(t,e[3])+")"},"%":function(t,e){var n,i,o,a,s,l,c,u,h,d=e[1][1];if(!r.pragmas[d])return"";i={};for(u=1,h=(n=e[4]).length;u<h;u++)i[(l=n[u])[1][1]]=l[2];a={};for(u=1,h=(o=e[3]).length;u<h;u++)a[(c=o[u])[1][1]]=c[2][1];s=e[2][1]?e[2][1].text:null;return r.pragmas[d](t,s,i,a)},partial:function(t,e){return".p("+r.compileNode(t,e[1])+",ctx,"+r.compileNode(t,e[2])+","+r.compileNode(t,e[3])+")"},context:function(t,e){return e[1]?"ctx.rebase("+r.compileNode(t,e[1])+")":"ctx"},params:function(t,e){for(var n=[],i=1,o=e.length;i<o;i++)n.push(r.compileNode(t,e[i]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(t,e){for(var n=[],i=1,o=e.length;i<o;i++)n.push(r.compileNode(t,e[i]));return"{"+n.join(",")+"}"},param:function(t,e){return r.compileNode(t,e[1])+":"+r.compileNode(t,e[2])},filters:function(t,e){for(var r=[],n=1,i=e.length;n<i;n++){var o=e[n];r.push('"'+o+'"')}return'"'+t.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(t,e){return'ctx.get(["'+e[1]+'"], false)'},path:function(t,e){for(var i=e[1],o=e[2],a=[],s=0,l=o.length;s<l;s++)n(o[s])?a.push(r.compileNode(t,o[s])):a.push('"'+o[s]+'"');return"ctx.getPath("+i+", ["+a.join(",")+"])"},literal:function(t,e){return y(e[1])},raw:function(t,e){return".w("+y(e[1])+")"}};function c(t,n,i){return"."+(e._aliases[i]||i)+"("+r.compileNode(t,n[1])+","+r.compileNode(t,n[2])+","+r.compileNode(t,n[4])+","+r.compileNode(t,n[3])+")"}var u=/\\/g,h=/"/g,d=/\f/g,p=/\n/g,f=/\r/g,g=/\t/g;var y="undefined"==typeof JSON?function(t){return'"'+function(t){return t.replace(u,"\\\\").replace(h,'\\"').replace(d,"\\f").replace(p,"\\n").replace(f,"\\r").replace(g,"\\t")}(t)+'"'}:JSON.stringify;function m(t){return function(r,n){return e[n?"render":"stream"](t,r,n)}}e.compiler=r;e.compile=e.compiler.compile;e.renderSource=function(t,r,n){return m(e.loadSource(e.compile(t)))(r,n)};e.compileFn=function(t,r){return m(e.loadSource(e.compile(t,r)))};e.filterNode=r.filterNode;e.optimizers=r.optimizers;e.pragmas=r.pragmas;e.compileNode=r.compileNode;e.nodes=r.nodes;return r});"function"==typeof define&&define.amd&&!0===define.amd.dust&&define(["require","dust.core","dust.compile"],function(t,e){e.onLoad=function(e,r){t([e],function(){r()})};return e});!function(t,e){if("function"==typeof define&&define.amd&&!0===define.amd.dust)define(["dust.core"],e);else if("object"==typeof exports){module.exports=e(require("dustjs-linkedin"));module.exports.registerWith=e}else e(t.dust)}(this,function(t){function e(e,r,n){n=n||"INFO";e=e?"{@"+e+"}: ":"";t.log(e+r,n)}var r={};function n(t){return function(t){return t.stack.tail&&t.stack.tail.head&&void 0!==t.stack.tail.head.__select__}(t)&&t.get("__select__")}function i(t,e){var r,n=t.stack.head,i=t.rebase();t.stack&&t.stack.tail&&(i.stack=t.stack.tail);var o={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(r in e)o[r]=e[r];return i.push({__select__:o}).push(n,t.stack.index,t.stack.of)}function o(t){var e,r;t.isDeferredPending=!0;if(t.deferreds.length){t.isDeferredComplete=!0;for(e=0,r=t.deferreds.length;e<r;e++)t.deferreds[e]()}t.isDeferredPending=!1}function a(t,e){return"function"==typeof e?e.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):e}function s(t,r){return function(i,o,a,s){return function(t,r,i,o,a,s){var c,u,h,d,p=i.block,f=i.else,g=n(r)||{};if(g.isResolved&&!g.isDeferredPending)return t;if(o.hasOwnProperty("key"))u=o.key;else{if(!g.hasOwnProperty("key")){e(a,"No key specified","WARN");return t}u=g.key}d=o.type||g.type;u=l(r.resolve(u),d);h=l(r.resolve(o.value),d);if(s(u,h)){if(!g.isPending){c=!0;g.isPending=!0}p&&(t=t.render(p,r));c&&(g.isResolved=!0)}else f&&(t=t.render(f,r));return t}(i,o,a,s,t,r)}}function l(t,e){e&&(e=e.toLowerCase());switch(e){case"number":return+t;case"string":return String(t);case"boolean":t="false"!==t&&t;return Boolean(t);case"date":return new Date(t)}return t}var c={tap:function(t,n,i){!function(t){if(!r[t]){e(t,"Deprecation warning: "+t+" is deprecated and will be removed in a future version of dustjs-helpers","WARN");e(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+t.replace(/\W+/g,""),"WARN");r[t]=!0}}("tap");return i.resolve(t)},sep:function(t,e,r){var n=r.block;return e.stack.index===e.stack.of-1?t:n?n(t,e):t},first:function(t,e,r){return 0===e.stack.index?r.block(t,e):t},last:function(t,e,r){return e.stack.index===e.stack.of-1?r.block(t,e):t},contextDump:function(t,r,n,i){var o,s,l=r.resolve(i.to);switch(r.resolve(i.key)){case"full":o=r.stack;break;default:o=r.stack.head}s=JSON.stringify(o,a,2);switch(l){case"console":e("contextDump",s);break;default:s=s.replace(/</g,"\\u003c");t=t.write(s)}return t},math:function(t,r,a,s){var l,c=s.key,u=s.method,h=s.operand,d=s.round;if(!s.hasOwnProperty("key")||!s.method){e("math","`key` or `method` was not provided","ERROR");return t}c=parseFloat(r.resolve(c));h=parseFloat(r.resolve(h));switch(u){case"mod":0===h&&e("math","Division by 0","ERROR");l=c%h;break;case"add":l=c+h;break;case"subtract":l=c-h;break;case"multiply":l=c*h;break;case"divide":0===h&&e("math","Division by 0","ERROR");l=c/h;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:e("math","Method `"+u+"` is not supported","ERROR")}if(void 0!==l){d&&(l=Math.round(l));if(a&&a.block){r=i(r,{key:l});t=t.render(a.block,r);o(n(r))}else t=t.write(l)}return t},select:function(t,r,a,s){var l=a.block,c={};s.hasOwnProperty("key")&&(c.key=r.resolve(s.key));s.hasOwnProperty("type")&&(c.type=s.type);if(l){r=i(r,c);t=t.render(l,r);o(n(r))}else e("select","Missing body block","WARN");return t},eq:s("eq",function(t,e){return t===e}),ne:s("ne",function(t,e){return t!==e}),lt:s("lt",function(t,e){return t<e}),lte:s("lte",function(t,e){return t<=e}),gt:s("gt",function(t,e){return t>e}),gte:s("gte",function(t,e){return t>=e}),any:function(t,r,i,o){var a=n(r);a?a.isDeferredComplete?e("any","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){a.deferreds.push(function(){a.isResolved&&(t=t.render(i.block,r));t.end()})}):e("any","Must be used inside a {@select} block","ERROR");return t},none:function(t,r,i,o){var a=n(r);a?a.isDeferredComplete?e("none","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){a.deferreds.push(function(){a.isResolved||(t=t.render(i.block,r));t.end()})}):e("none","Must be used inside a {@select} block","ERROR");return t},size:function(e,r,n,i){var o,a,s=i.key;if((s=r.resolve(i.key))&&!0!==s)if(t.isArray(s))o=s.length;else if(!isNaN(parseFloat(s))&&isFinite(s))o=s;else if("object"==typeof s){o=0;for(a in s)s.hasOwnProperty(a)&&o++}else o=(s+"").length;else o=0;return e.write(o)}};for(var u in c)t.helpers[u]=c[u];return t});!function(t,e){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(r){return e(r,t)}):"object"==typeof module&&module.exports?module.exports=e(require("dustjs-linkedin"),this):t.dust=e(t.dust,t)}(this,function(t,e,r){"use strict";var n=Object.prototype.toString,i=typeof console!==r?console:{log:function(){}},o={isArray:Array.isArray||function(t){return"[object Array]"===n.call(t)},isAvailable:function(t){return s[t]!==r},log:i.log},a={selected:r,languages:{},filters:{}},s=a.languages;typeof String.prototype.trim===r&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});t.i18n={resetContext:function(){a.selected=r;Object.keys(s).forEach(function(t){delete s[t]})},setLanguage:function(t){if(!o.isAvailable(t))throw new Error("language '"+t+"' not available!");a.selected=t},setLanguages:function(t){o.isArray(t)&&t.forEach(function(t){o.isAvailable(t)||(s[t]={});a.selected===r&&(a.selected=t)})},add:function(t,e){if(o.isAvailable(t)){var r=s[t];Object.keys(e).forEach(function(t){r[t]=e[t]})}},addFilter:function(t,e){t in a.filters||(a.filters[t]=e)}};t.helpers.i18n=function(e,n,i,l){if(l&&l.$key!==r){var c,u,h,d,p=a.selected,f=s[p],g=/\{(\s*[\w]+\s*)\}/g;h=t.helpers.tap(l.$key,e,n).split("|");var y=t.helpers.tap(h.shift(),e,n);d=f!==r&&f[y]!==r?f[y]:null;for(;null!==(c=g.exec(d));){if("$key"===c[1].trim()){u="";o.log("$key can't be used as a parameter")}else u=t.helpers.tap(l[c[1].trim()],e,n);d=d.replace(c[0],u)}h.forEach(function(t){t in a.filters&&(d=a.filters[t](d))});e.write(d)}else o.log("No key given in the i18n helper");return e};return t});!function(){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){e=e||0;return this.indexOf(t,e)===e});dust.helpers.iterate=function(t,e,r,n){var i=(n=n||{}).on||e.current(),o=null!=n.excludedKeys?n.excludedKeys.split(","):null;for(var a in i)(null==o||o.indexOf(a)<0)&&(t=t.render(r.block,e.push({key:a,value:i[a]})));return t};dust.helpers.startsWith=function(t,e,r,n){var i=r.block,o=r.else,a=n.key,s=n.value;"string"==typeof a&&0===a.toLowerCase().indexOf(s.toLowerCase())?t=t.render(i,e):o&&(t=t.render(o,e));return t};dust.helpers.isObject=function(t,e,r,n){n=n||{};var i=r.block,o=r.else,a=n.object||e.current();a instanceof Array&&r.array?t=t.render(r.array,e):a instanceof Object?t=t.render(i,e):o&&(t=t.render(o,e));return t};dust.helpers.isKeyKalue=function(t,e,r,n){n=n||{};var i=r.block,o=r.else,a=n.object||e.current();!a.hasOwnProperty("value")||a.value instanceof Object?o&&t.render(o,e):t.render(i,e);return t};var t=[];dust.filters.objectId=function(e){let r=t.find(t=>t.obj===e);r||t.push(r={obj:e,id:TC.getUID()});return r.id}}();var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype;t.prototype=new r},exports,define;function JL(t){if(!t)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(t,e){for(var r=e,n=0;n<this.length;n++)r=t(r,this[n],n,this);return r});var e="";return("."+t).split(".").reduce(function(t,r,n,i){void 0===(r=t["__"+(e=e?e+"."+r:r)])&&(JL.Logger.prototype=t,r=new JL.Logger(e),t["__"+e]=r);return r},JL.__)}!function(t){function e(t,e,r){void 0!==e[t]&&(null===e[t]?delete r[t]:r[t]=e[t])}function r(e){if(null!=t.enabled&&!t.enabled||null!=t.maxMessages&&1>t.maxMessages)return!1;try{if(e.userAgentRegex&&!RegExp(e.userAgentRegex).test(navigator.userAgent))return!1}catch(t){}try{if(e.ipRegex&&t.clientIP&&!RegExp(e.ipRegex).test(t.clientIP))return!1}catch(t){}return!0}function n(t,e){try{if(t.disallow&&RegExp(t.disallow).test(e))return!1}catch(t){}return!0}function i(t){return"function"==typeof t?t instanceof RegExp?t.toString():t():t}function o(t){switch(typeof(t=i(t))){case"string":return new a(t,null,t);case"number":case"boolean":return t=t.toString(),new a(t,null,t);case"undefined":return new a("undefined",null,"undefined");case"object":return t instanceof RegExp||t instanceof String||t instanceof Number||t instanceof Boolean?(t=t.toString(),new a(t,null,t)):new a(null,t,JSON.stringify(t));default:return new a("unknown",null,"unknown")}}t.enabled;t.maxMessages;t.defaultAjaxUrl;t.clientIP;t.defaultBeforeSend;t.requestId="";var a=function(t,e,r){this.msg=t;this.meta=e;this.finalString=r};t.setOptions=function(t){e("enabled",t,this);e("maxMessages",t,this);e("defaultAjaxUrl",t,this);e("clientIP",t,this);e("requestId",t,this);e("defaultBeforeSend",t,this);return this};t.getAllLevel=function(){return-2147483648};t.getTraceLevel=function(){return 1e3};t.getDebugLevel=function(){return 2e3};t.getInfoLevel=function(){return 3e3};t.getWarnLevel=function(){return 4e3};t.getErrorLevel=function(){return 5e3};t.getFatalLevel=function(){return 6e3};t.getOffLevel=function(){return 2147483647};var s=function(t,e){this.inner=e;this.name="JL.Exception";this.message=o(t).finalString};t.Exception=s;s.prototype=Error();var l=function(t,e,r,n){this.l=t;this.m=e;this.n=r;this.t=n};t.LogItem=l;s=function(){function i(e,r){this.appenderName=e;this.sendLogItems=r;this.level=t.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(t){e("level",t,this);e("ipRegex",t,this);e("userAgentRegex",t,this);e("disallow",t,this);e("sendWithBufferLevel",t,this);e("storeInBufferLevel",t,this);e("bufferSize",t,this);e("batchSize",t,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(t,e,i,o,a,s,c){!r(this)||!n(this,s)||a<this.storeInBufferLevel||(t=new l(a,s,c,(new Date).getTime()),a<this.level?0<this.bufferSize&&(this.buffer.push(t),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(t),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=t.maxMessages&&1>t.maxMessages||(null!=t.maxMessages&&(t.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();t.Appender=s;var c=function(r){function n(t){r.call(this,t,n.prototype.sendLogItemsAjax)}__extends(n,r);n.prototype.setOptions=function(t){e("url",t,this);e("beforeSend",t,this);r.prototype.setOptions.call(this,t);return this};n.prototype.sendLogItemsAjax=function(e){try{var r="/jsnlog.logger";null!=t.defaultAjaxUrl&&(r=t.defaultAjaxUrl);this.url&&(r=this.url);var n=JSON.stringify({r:t.requestId,lg:e}),i=this.getXhr(r);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof t.defaultBeforeSend&&t.defaultBeforeSend.call(this,i);i.send(n)}catch(t){}};n.prototype.getXhr=function(e){var r=new XMLHttpRequest;if(!("withCredentials"in r)&&"undefined"!=typeof XDomainRequest)return(r=new XDomainRequest).open("POST",e),r;r.open("POST",e);r.setRequestHeader("Content-Type","application/json");r.setRequestHeader("JSNLog-RequestId",t.requestId);return r};return n}(s);t.AjaxAppender=c;var u=function(e){function r(t){e.call(this,t,r.prototype.sendLogItemsConsole)}__extends(r,e);r.prototype.clog=function(t){console.log(t)};r.prototype.cerror=function(t){console.error?console.error(t):this.clog(t)};r.prototype.cwarn=function(t){console.warn?console.warn(t):this.clog(t)};r.prototype.cinfo=function(t){console.info?console.info(t):this.clog(t)};r.prototype.cdebug=function(t){console.debug?console.debug(t):this.cinfo(t)};r.prototype.sendLogItemsConsole=function(e){try{if(console){var r;for(r=0;r<e.length;++r){var n=e[r],i=n.n+": "+n.m;"undefined"==typeof window&&(i=new Date(n.t)+" | "+i);n.l<=t.getDebugLevel()?this.cdebug(i):n.l<=t.getInfoLevel()?this.cinfo(i):n.l<=t.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(t){}};return r}(s);t.ConsoleAppender=u;s=function(){function t(t){this.loggerName=t;this.seenRegexes=[]}t.prototype.setOptions=function(t){e("level",t,this);e("userAgentRegex",t,this);e("disallow",t,this);e("ipRegex",t,this);e("appenders",t,this);e("onceOnly",t,this);this.seenRegexes=[];return this};t.prototype.buildExceptionObject=function(t){var e={};t.stack?e.stack=t.stack:e.e=t;t.message&&(e.message=t.message);t.name&&(e.name=t.name);t.data&&(e.data=t.data);t.inner&&(e.inner=this.buildExceptionObject(t.inner));return e};t.prototype.log=function(t,e,a){var s=0;if(!this.appenders)return this;if(t>=this.level&&r(this)&&(a?(s=this.buildExceptionObject(a)).logData=i(e):s=e,n(this,(e=o(s)).finalString))){if(this.onceOnly)for(s=this.onceOnly.length-1;0<=s;){if(RegExp(this.onceOnly[s]).test(e.finalString)){if(this.seenRegexes[s])return this;this.seenRegexes[s]=!0}s--}e.meta=e.meta||{};e.meta.loggerName=this.loggerName;for(s=this.appenders.length-1;0<=s;)this.appenders[s].log(1e3>=t?"trace":2e3>=t?"debug":3e3>=t?"info":4e3>=t?"warn":5e3>=t?"error":"fatal",e.msg,e.meta,function(){},t,e.finalString,this.loggerName),s--}return this};t.prototype.trace=function(t){return this.log(1e3,t)};t.prototype.debug=function(t){return this.log(2e3,t)};t.prototype.info=function(t){return this.log(3e3,t)};t.prototype.warn=function(t){return this.log(4e3,t)};t.prototype.error=function(t){return this.log(5e3,t)};t.prototype.fatal=function(t){return this.log(6e3,t)};t.prototype.fatalException=function(t,e){return this.log(6e3,t,e)};return t}();t.Logger=s;t.createAjaxAppender=function(t){return new c(t)};t.createConsoleAppender=function(t){return new u(t)};s=new c("");"undefined"==typeof window&&(s=new u(""));t.__=new t.Logger("");t.__.setOptions({level:t.getDebugLevel(),appenders:[s]})}(JL||(JL={}));void 0!==exports&&(exports.JL=JL);"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Handlebars=e():t.Handlebars=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(){var t=new a.HandlebarsEnvironment;return c.extend(t,a),t.SafeString=s.default,t.Exception=l.default,t.Utils=c,t.escapeExpression=c.escapeExpression,t.VM=u,t.template=function(e){return u.template(e,t)},t}var i=r(1).default,o=r(2).default;e.__esModule=!0;var a=i(r(3)),s=o(r(36)),l=o(r(5)),c=i(r(4)),u=i(r(37)),h=o(r(43)),d=n();d.create=n,h.default(d),d.default=d,e.default=d,t.exports=e.default},function(t,e){"use strict";e.default=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e},e.__esModule=!0},function(t,e){"use strict";e.default=function(t){return t&&t.__esModule?t:{default:t}},e.__esModule=!0},function(t,e,r){"use strict";function n(t,e,r){this.helpers=t||{},this.partials=e||{},this.decorators=r||{},s.registerDefaultHelpers(this),l.registerDefaultDecorators(this)}var i=r(2).default;e.__esModule=!0,e.HandlebarsEnvironment=n;var o=r(4),a=i(r(5)),s=r(9),l=r(29),c=i(r(31)),u=r(32);e.VERSION="4.7.3";e.COMPILER_REVISION=8;e.LAST_COMPATIBLE_COMPILER_REVISION=7;e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var h="[object Object]";n.prototype={constructor:n,logger:c.default,log:c.default.log,registerHelper:function(t,e){if(o.toString.call(t)===h){if(e)throw new a.default("Arg not supported with multiple helpers");o.extend(this.helpers,t)}else this.helpers[t]=e},unregisterHelper:function(t){delete this.helpers[t]},registerPartial:function(t,e){if(o.toString.call(t)===h)o.extend(this.partials,t);else{if(void 0===e)throw new a.default('Attempting to register a partial called "'+t+'" as undefined');this.partials[t]=e}},unregisterPartial:function(t){delete this.partials[t]},registerDecorator:function(t,e){if(o.toString.call(t)===h){if(e)throw new a.default("Arg not supported with multiple decorators");o.extend(this.decorators,t)}else this.decorators[t]=e},unregisterDecorator:function(t){delete this.decorators[t]},resetLoggedPropertyAccesses:function(){u.resetLoggedProperties()}};var d=c.default.log;e.log=d,e.createFrame=o.createFrame,e.logger=c.default},function(t,e){"use strict";function r(t){return i[t]}function n(t){for(var e=1;e<arguments.length;e++)for(var r in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],r)&&(t[r]=arguments[e][r]);return t}e.__esModule=!0,e.extend=n,e.indexOf=function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1},e.escapeExpression=function(t){if("string"!=typeof t){if(t&&t.toHTML)return t.toHTML();if(null==t)return"";if(!t)return t+"";t=""+t}return a.test(t)?t.replace(o,r):t},e.isEmpty=function(t){return!t&&0!==t||!(!c(t)||0!==t.length)},e.createFrame=function(t){var e=n({},t);return e._parent=t,e},e.blockParams=function(t,e){return t.path=e,t},e.appendContextPath=function(t,e){return(t?t+".":"")+e};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},o=/[&<>"'`=]/g,a=/[&<>"'`=]/,s=Object.prototype.toString;e.toString=s;var l=function(t){return"function"==typeof t};l(/x/)&&(e.isFunction=l=function(t){return"function"==typeof t&&"[object Function]"===s.call(t)}),e.isFunction=l;var c=Array.isArray||function(t){return!(!t||"object"!=typeof t)&&"[object Array]"===s.call(t)};e.isArray=c},function(t,e,r){"use strict";function n(t,e){var r=e&&e.loc,a=void 0,s=void 0,l=void 0,c=void 0;r&&(a=r.start.line,s=r.end.line,l=r.start.column,c=r.end.column,t+=" - "+a+":"+l);for(var u=Error.prototype.constructor.call(this,t),h=0;h<o.length;h++)this[o[h]]=u[o[h]];Error.captureStackTrace&&Error.captureStackTrace(this,n);try{r&&(this.lineNumber=a,this.endLineNumber=s,i?(Object.defineProperty(this,"column",{value:l,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=l,this.endColumn=c))}catch(t){}}var i=r(6).default;e.__esModule=!0;var o=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];n.prototype=new Error,e.default=n,t.exports=e.default},function(t,e,r){t.exports={default:r(7),__esModule:!0}},function(t,e,r){var n=r(8);t.exports=function(t,e,r){return n.setDesc(t,e,r)}},function(t,e){var r=Object;t.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(t,e,r){"use strict";var n=r(2).default;e.__esModule=!0,e.registerDefaultHelpers=function(t){i.default(t),o.default(t),a.default(t),s.default(t),l.default(t),c.default(t),u.default(t)},e.moveHelperToHooks=function(t,e,r){t.helpers[e]&&(t.hooks[e]=t.helpers[e],r||delete t.helpers[e])};var i=n(r(10)),o=n(r(11)),a=n(r(24)),s=n(r(25)),l=n(r(26)),c=n(r(27)),u=n(r(28))},function(t,e,r){"use strict";e.__esModule=!0;var n=r(4);e.default=function(t){t.registerHelper("blockHelperMissing",function(e,r){var i=r.inverse,o=r.fn;if(!0===e)return o(this);if(!1===e||null==e)return i(this);if(n.isArray(e))return e.length>0?(r.ids&&(r.ids=[r.name]),t.helpers.each(e,r)):i(this);if(r.data&&r.ids){var a=n.createFrame(r.data);a.contextPath=n.appendContextPath(r.data.contextPath,r.name),r={data:a}}return o(e,r)})},t.exports=e.default},function(t,e,r){(function(n){"use strict";var i=r(12).default,o=r(2).default;e.__esModule=!0;var a=r(4),s=o(r(5));e.default=function(t){t.registerHelper("each",function(t,e){function r(e,r,n){h&&(h.key=e,h.index=r,h.first=0===r,h.last=!!n,d&&(h.contextPath=d+e)),u+=o(t[e],{data:h,blockParams:a.blockParams([t[e],e],[d+e,null])})}if(!e)throw new s.default("Must pass iterator to #each");var o=e.fn,l=e.inverse,c=0,u="",h=void 0,d=void 0;if(e.data&&e.ids&&(d=a.appendContextPath(e.data.contextPath,e.ids[0])+"."),a.isFunction(t)&&(t=t.call(this)),e.data&&(h=a.createFrame(e.data)),t&&"object"==typeof t)if(a.isArray(t))for(var p=t.length;c<p;c++)c in t&&r(c,c,c===t.length-1);else if(n.Symbol&&t[n.Symbol.iterator]){for(var f=[],g=t[n.Symbol.iterator](),y=g.next();!y.done;y=g.next())f.push(y.value);for(p=(t=f).length;c<p;c++)r(c,c,c===t.length-1)}else!function(){var e=void 0;i(t).forEach(function(t){void 0!==e&&r(e,c-1),e=t,c++}),void 0!==e&&r(e,c-1,!0)}();return 0===c&&(u=l(this)),u})},t.exports=e.default}).call(e,function(){return this}())},function(t,e,r){t.exports={default:r(13),__esModule:!0}},function(t,e,r){r(14),t.exports=r(20).Object.keys},function(t,e,r){var n=r(15);r(17)("keys",function(t){return function(e){return t(n(e))}})},function(t,e,r){var n=r(16);t.exports=function(t){return Object(n(t))}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,r){var n=r(18),i=r(20),o=r(23);t.exports=function(t,e){var r=(i.Object||{})[t]||Object[t],a={};a[t]=e(r),n(n.S+n.F*o(function(){r(1)}),"Object",a)}},function(t,e,r){var n=r(19),i=r(20),o=r(21),a="prototype",s=function(t,e,r){var l,c,u,h=t&s.F,d=t&s.G,p=t&s.S,f=t&s.P,g=t&s.B,y=t&s.W,m=d?i:i[e]||(i[e]={}),C=d?n:p?n[e]:(n[e]||{})[a];d&&(r=e);for(l in r)(c=!h&&C&&l in C)&&l in m||(u=c?C[l]:r[l],m[l]=d&&"function"!=typeof C[l]?r[l]:g&&c?o(u,n):y&&C[l]==u?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[a]=t[a],e}(u):f&&"function"==typeof u?o(Function.call,u):u,f&&((m[a]||(m[a]={}))[l]=u))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,t.exports=s},function(t,e){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,e){var r=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(t,e,r){var n=r(22);t.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,r){"use strict";var n=r(2).default;e.__esModule=!0;var i=n(r(5));e.default=function(t){t.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},t.exports=e.default},function(t,e,r){"use strict";var n=r(2).default;e.__esModule=!0;var i=r(4),o=n(r(5));e.default=function(t){t.registerHelper("if",function(t,e){if(2!=arguments.length)throw new o.default("#if requires exactly one argument");return i.isFunction(t)&&(t=t.call(this)),!e.hash.includeZero&&!t||i.isEmpty(t)?e.inverse(this):e.fn(this)}),t.registerHelper("unless",function(e,r){if(2!=arguments.length)throw new o.default("#unless requires exactly one argument");return t.helpers.if.call(this,e,{fn:r.inverse,inverse:r.fn,hash:r.hash})})},t.exports=e.default},function(t,e){"use strict";e.__esModule=!0,e.default=function(t){t.registerHelper("log",function(){for(var e=[void 0],r=arguments[arguments.length-1],n=0;n<arguments.length-1;n++)e.push(arguments[n]);var i=1;null!=r.hash.level?i=r.hash.level:r.data&&null!=r.data.level&&(i=r.data.level),e[0]=i,t.log.apply(t,e)})},t.exports=e.default},function(t,e){"use strict";e.__esModule=!0,e.default=function(t){t.registerHelper("lookup",function(t,e,r){return t?r.lookupProperty(t,e):t})},t.exports=e.default},function(t,e,r){"use strict";var n=r(2).default;e.__esModule=!0;var i=r(4),o=n(r(5));e.default=function(t){t.registerHelper("with",function(t,e){if(2!=arguments.length)throw new o.default("#with requires exactly one argument");i.isFunction(t)&&(t=t.call(this));var r=e.fn;if(i.isEmpty(t))return e.inverse(this);var n=e.data;return e.data&&e.ids&&((n=i.createFrame(e.data)).contextPath=i.appendContextPath(e.data.contextPath,e.ids[0])),r(t,{data:n,blockParams:i.blockParams([t],[n&&n.contextPath])})})},t.exports=e.default},function(t,e,r){"use strict";var n=r(2).default;e.__esModule=!0,e.registerDefaultDecorators=function(t){i.default(t)};var i=n(r(30))},function(t,e,r){"use strict";e.__esModule=!0;var n=r(4);e.default=function(t){t.registerDecorator("inline",function(t,e,r,i){var o=t;return e.partials||(e.partials={},o=function(i,o){var a=r.partials;r.partials=n.extend({},a,e.partials);var s=t(i,o);return r.partials=a,s}),e.partials[i.args[0]]=i.fn,o})},t.exports=e.default},function(t,e,r){"use strict";e.__esModule=!0;var n=r(4),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(t){if("string"==typeof t){var e=n.indexOf(i.methodMap,t.toLowerCase());t=e>=0?e:parseInt(t,10)}return t},log:function(t){if(t=i.lookupLevel(t),"undefined"!=typeof console&&i.lookupLevel(i.level)<=t){var e=i.methodMap[t];console[e]||(e="log");for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];console[e].apply(console,n)}}};e.default=i,t.exports=e.default},function(t,e,r){"use strict";function n(t,e){return void 0!==t.whitelist[e]?!0===t.whitelist[e]:void 0!==t.defaultValue?t.defaultValue:(function(t){!0!==c[t]&&(c[t]=!0,l.log("error",'Handlebars: Access has been denied to resolve the property "'+t+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(e),!1)}var i=r(33).default,o=r(12).default,a=r(1).default;e.__esModule=!0,e.createProtoAccessControl=function(t){var e=i(null);e.constructor=!1,e.__defineGetter__=!1,e.__defineSetter__=!1,e.__lookupGetter__=!1;var r=i(null);return r.__proto__=!1,{properties:{whitelist:s.createNewLookupObject(r,t.allowedProtoProperties),defaultValue:t.allowProtoPropertiesByDefault},methods:{whitelist:s.createNewLookupObject(e,t.allowedProtoMethods),defaultValue:t.allowProtoMethodsByDefault}}},e.resultIsAllowed=function(t,e,r){return n("function"==typeof t?e.methods:e.properties,r)},e.resetLoggedProperties=function(){o(c).forEach(function(t){delete c[t]})};var s=r(35),l=a(r(31)),c=i(null)},function(t,e,r){t.exports={default:r(34),__esModule:!0}},function(t,e,r){var n=r(8);t.exports=function(t,e){return n.create(t,e)}},function(t,e,r){"use strict";var n=r(33).default;e.__esModule=!0,e.createNewLookupObject=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.extend.apply(void 0,[n(null)].concat(e))};var i=r(4)},function(t,e){"use strict";function r(t){this.string=t}e.__esModule=!0,r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},e.default=r,t.exports=e.default},function(t,e,r){"use strict";function n(t,e,r,n,i,a,s){function l(e){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=s;return!s||e==s[0]||e===t.nullContext&&null===s[0]||(o=[e].concat(s)),r(t,e,t.helpers,t.partials,i.data||n,a&&[i.blockParams].concat(a),o)}return(l=o(r,l,t,s,n,a)).program=e,l.depth=s?s.length:0,l.blockParams=i||0,l}function i(){return""}function o(t,e,r,n,i,o){if(t.decorator){var a={};e=t.decorator(e,a,r,n&&n[0],i,o,n),u.extend(e,a)}return e}var a=r(38).default,s=r(12).default,l=r(1).default,c=r(2).default;e.__esModule=!0,e.checkRevision=function(t){var e=t&&t[0]||1,r=d.COMPILER_REVISION;if(!(e>=d.LAST_COMPATIBLE_COMPILER_REVISION&&e<=d.COMPILER_REVISION)){if(e<d.LAST_COMPATIBLE_COMPILER_REVISION){var n=d.REVISION_CHANGES[r],i=d.REVISION_CHANGES[e];throw new h.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+i+").")}throw new h.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+t[1]+").")}},e.template=function(t,e){function r(e){function n(e){return""+t.main(l,e,l.helpers,l.partials,a,c,s)}var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=i.data;r._setup(i),!i.partial&&t.useData&&(a=function(t,e){return e&&"root"in e||((e=e?d.createFrame(e):{}).root=t),e}(e,a));var s=void 0,c=t.useBlockParams?[]:void 0;return t.useDepths&&(s=i.depths?e!=i.depths[0]?[e].concat(i.depths):i.depths:[e]),(n=o(t.main,n,l,i.depths||[],a,c))(e,i)}if(!e)throw new h.default("No environment passed to template");if(!t||!t.main)throw new h.default("Unknown template object: "+typeof t);t.main.decorator=t.main_d,e.VM.checkRevision(t.compiler);var i=t.compiler&&7===t.compiler[0],l={strict:function(t,e,r){if(!(t&&e in t))throw new h.default('"'+e+'" not defined in '+t,{loc:r});return t[e]},lookupProperty:function(t,e){var r=t[e];return null==r?r:Object.prototype.hasOwnProperty.call(t,e)?r:g.resultIsAllowed(r,l.protoAccessControl,e)?r:void 0},lookup:function(t,e){for(var r=t.length,n=0;n<r;n++)if(null!=(t[n]&&l.lookupProperty(t[n],e)))return t[n][e]},lambda:function(t,e){return"function"==typeof t?t.call(e):t},escapeExpression:u.escapeExpression,invokePartial:function(r,n,i){i.hash&&(n=u.extend({},n,i.hash),i.ids&&(i.ids[0]=!0)),r=e.VM.resolvePartial.call(this,r,n,i);var o=u.extend({},i,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),a=e.VM.invokePartial.call(this,r,n,o);if(null==a&&e.compile&&(i.partials[i.name]=e.compile(r,t.compilerOptions,e),a=i.partials[i.name](n,o)),null!=a){if(i.indent){for(var s=a.split("\n"),l=0,c=s.length;l<c&&(s[l]||l+1!==c);l++)s[l]=i.indent+s[l];a=s.join("\n")}return a}throw new h.default("The partial "+i.name+" could not be compiled when running in runtime-only mode")},fn:function(e){var r=t[e];return r.decorator=t[e+"_d"],r},programs:[],program:function(t,e,r,i,o){var a=this.programs[t],s=this.fn(t);return e||o||i||r?a=n(this,t,s,e,r,i,o):a||(a=this.programs[t]=n(this,t,s)),a},data:function(t,e){for(;t&&e--;)t=t._parent;return t},mergeIfNeeded:function(t,e){var r=t||e;return t&&e&&t!==e&&(r=u.extend({},e,t)),r},nullContext:a({}),noop:e.VM.noop,compilerInfo:t.compiler};return r.isTop=!0,r._setup=function(r){if(r.partial)l.protoAccessControl=r.protoAccessControl,l.helpers=r.helpers,l.partials=r.partials,l.decorators=r.decorators,l.hooks=r.hooks;else{var n=u.extend({},e.helpers,r.helpers);(function(t,e){s(t).forEach(function(r){var n=t[r];t[r]=function(t,e){var r=e.lookupProperty;return f.wrapHelper(t,function(t){return u.extend({lookupProperty:r},t)})}(n,e)})})(n,l),l.helpers=n,t.usePartial&&(l.partials=l.mergeIfNeeded(r.partials,e.partials)),(t.usePartial||t.useDecorators)&&(l.decorators=u.extend({},e.decorators,r.decorators)),l.hooks={},l.protoAccessControl=g.createProtoAccessControl(r);var o=r.allowCallsToHelperMissing||i;p.moveHelperToHooks(l,"helperMissing",o),p.moveHelperToHooks(l,"blockHelperMissing",o)}},r._child=function(e,r,i,o){if(t.useBlockParams&&!i)throw new h.default("must pass block params");if(t.useDepths&&!o)throw new h.default("must pass parent depths");return n(l,e,t[e],r,0,i,o)},r},e.wrapProgram=n,e.resolvePartial=function(t,e,r){return t?t.call||r.name||(r.name=t,t=r.partials[t]):t="@partial-block"===r.name?r.data["partial-block"]:r.partials[r.name],t},e.invokePartial=function(t,e,r){var n=r.data&&r.data["partial-block"];r.partial=!0,r.ids&&(r.data.contextPath=r.ids[0]||r.data.contextPath);var o=void 0;if(r.fn&&r.fn!==i&&function(){r.data=d.createFrame(r.data);var t=r.fn;o=r.data["partial-block"]=function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.data=d.createFrame(r.data),r.data["partial-block"]=n,t(e,r)},t.partials&&(r.partials=u.extend({},r.partials,t.partials))}(),void 0===t&&o&&(t=o),void 0===t)throw new h.default("The partial "+r.name+" could not be found");if(t instanceof Function)return t(e,r)},e.noop=i;var u=l(r(4)),h=c(r(5)),d=r(3),p=r(9),f=r(42),g=r(32)},function(t,e,r){t.exports={default:r(39),__esModule:!0}},function(t,e,r){r(40),t.exports=r(20).Object.seal},function(t,e,r){var n=r(41);r(17)("seal",function(t){return function(e){return t&&n(e)?t(e):e}})},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){"use strict";e.__esModule=!0,e.wrapHelper=function(t,e){return"function"!=typeof t?t:function(){var r=arguments[arguments.length-1];return arguments[arguments.length-1]=e(r),t.apply(this,arguments)}}},function(t,e){(function(r){"use strict";e.__esModule=!0,e.default=function(t){var e=void 0!==r?r:window,n=e.Handlebars;t.noConflict=function(){return e.Handlebars===t&&(e.Handlebars=n),t}},t.exports=e.default}).call(e,function(){return this}())}])});!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}}(function(){return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){var r=e[a][1][t];return i(r||t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){"use strict";var n=t("./utils"),i=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e,r,i,a,s,l,c,u=[],h=0,d=t.length,p=d,f="string"!==n.getTypeOf(t);h<t.length;){p=d-h;if(f){e=t[h++];r=h<d?t[h++]:0;i=h<d?t[h++]:0}else{e=t.charCodeAt(h++);r=h<d?t.charCodeAt(h++):0;i=h<d?t.charCodeAt(h++):0}a=e>>2;s=(3&e)<<4|r>>4;l=p>1?(15&r)<<2|i>>6:64;c=p>2?63&i:64;u.push(o.charAt(a)+o.charAt(s)+o.charAt(l)+o.charAt(c))}return u.join("")};r.decode=function(t){var e,r,n,a,s,l,c=0,u=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var h,d=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;t.charAt(t.length-1)===o.charAt(64)&&d--;t.charAt(t.length-2)===o.charAt(64)&&d--;if(d%1!=0)throw new Error("Invalid base64 input, bad content length.");h=i.uint8array?new Uint8Array(0|d):new Array(0|d);for(;c<t.length;){e=o.indexOf(t.charAt(c++))<<2|(a=o.indexOf(t.charAt(c++)))>>4;r=(15&a)<<4|(s=o.indexOf(t.charAt(c++)))>>2;n=(3&s)<<6|(l=o.indexOf(t.charAt(c++)));h[u++]=e;64!==s&&(h[u++]=r);64!==l&&(h[u++]=n)}return h}},{"./support":30,"./utils":32}],2:[function(t,e,r){"use strict";var n=t("./external"),i=t("./stream/DataWorker"),o=t("./stream/DataLengthProbe"),a=t("./stream/Crc32Probe");o=t("./stream/DataLengthProbe");function s(t,e,r,n,i){this.compressedSize=t;this.uncompressedSize=e;this.crc32=r;this.compression=n;this.compressedContent=i}s.prototype={getContentWorker:function(){var t=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")});return t},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};s.createWorkerFrom=function(t,e,r){return t.pipe(new a).pipe(new o("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new o("compressedSize")).withStreamInfo("compression",e)};e.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,r){"use strict";var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}};r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,r){"use strict";var n=t("./utils");var i=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,r,n){var o=i,a=n+r;t^=-1;for(var s=n;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function(t,e,r,n){var o=i,a=n+r;t^=-1;for(var s=n;s<a;s++)t=t>>>8^o[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,r){"use strict";r.base64=!1;r.binary=!1;r.dir=!1;r.createFolders=!0;r.date=null;r.compression=null;r.compressionOptions=null;r.comment=null;r.unixPermissions=null;r.dosPermissions=null},{}],6:[function(t,e,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:t("lie");e.exports={Promise:n}},{lie:37}],7:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),s=n?"uint8array":"array";r.magic="\b\0";function l(t,e){a.call(this,"FlateWorker/"+t);this._pako=null;this._pakoAction=t;this._pakoOptions=e;this.meta={}}o.inherits(l,a);l.prototype.processChunk=function(t){this.meta=t.meta;null===this._pako&&this._createPako();this._pako.push(o.transformTo(s,t.data),!1)};l.prototype.flush=function(){a.prototype.flush.call(this);null===this._pako&&this._createPako();this._pako.push([],!0)};l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this);this._pako=null};l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}};r.compressWorker=function(t){return new l("Deflate",t)};r.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../stream/GenericWorker"),o=t("../utf8"),a=t("../crc32"),s=t("../signature"),l=function(t,e){var r,n="";for(r=0;r<e;r++){n+=String.fromCharCode(255&t);t>>>=8}return n},c=function(t,e,r,i,c,u){var h,d,p=t.file,f=t.compression,g=u!==o.utf8encode,y=n.transformTo("string",u(p.name)),m=n.transformTo("string",o.utf8encode(p.name)),C=p.comment,v=n.transformTo("string",u(C)),T=n.transformTo("string",o.utf8encode(C)),_=m.length!==p.name.length,S=T.length!==C.length,E="",w="",b="",L=p.dir,A=p.date,x={crc32:0,compressedSize:0,uncompressedSize:0};if(!e||r){x.crc32=t.crc32;x.compressedSize=t.compressedSize;x.uncompressedSize=t.uncompressedSize}var P=0;e&&(P|=8);g||!_&&!S||(P|=2048);var I=0,R=0;L&&(I|=16);if("UNIX"===c){R=798;I|=function(t,e){var r=t;t||(r=e?16893:33204);return(65535&r)<<16}(p.unixPermissions,L)}else{R=20;I|=63&(p.dosPermissions||0)}h=A.getUTCHours();h<<=6;h|=A.getUTCMinutes();h<<=5;h|=A.getUTCSeconds()/2;d=A.getUTCFullYear()-1980;d<<=4;d|=A.getUTCMonth()+1;d<<=5;d|=A.getUTCDate();if(_){w=l(1,1)+l(a(y),4)+m;E+="up"+l(w.length,2)+w}if(S){b=l(1,1)+l(a(v),4)+T;E+="uc"+l(b.length,2)+b}var O="";O+="\n\0";O+=l(P,2);O+=f.magic;O+=l(h,2);O+=l(d,2);O+=l(x.crc32,4);O+=l(x.compressedSize,4);O+=l(x.uncompressedSize,4);O+=l(y.length,2);O+=l(E.length,2);return{fileRecord:s.LOCAL_FILE_HEADER+O+y+E,dirRecord:s.CENTRAL_FILE_HEADER+l(R,2)+O+l(v.length,2)+"\0\0\0\0"+l(I,4)+l(i,4)+y+E+v}},u=function(t){return s.DATA_DESCRIPTOR+l(t.crc32,4)+l(t.compressedSize,4)+l(t.uncompressedSize,4)};function h(t,e,r,n){i.call(this,"ZipFileWorker");this.bytesWritten=0;this.zipComment=e;this.zipPlatform=r;this.encodeFileName=n;this.streamFiles=t;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.currentSourceOffset=0;this.entriesCount=0;this.currentFile=null;this._sources=[]}n.inherits(h,i);h.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,n=this._sources.length;if(this.accumulate)this.contentBuffer.push(t);else{this.bytesWritten+=t.data.length;i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-n-1))/r:100}})}};h.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten;this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var r=c(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0};h.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=c(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(r.dirRecord);if(e)this.push({data:u(t),meta:{percent:100}});else{this.push({data:r.fileRecord,meta:{percent:0}});for(;this.contentBuffer.length;)this.push(this.contentBuffer.shift())}this.currentFile=null};h.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,i=function(t,e,r,i,o){var a=n.transformTo("string",o(i));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(t,2)+l(t,2)+l(e,4)+l(r,4)+l(a.length,2)+a}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})};h.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);this.isPaused?this.previous.pause():this.previous.resume()};h.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;t.on("data",function(t){e.processChunk(t)});t.on("end",function(){e.closedSource(e.previous.streamInfo);e._sources.length?e.prepareNextSource():e.end()});t.on("error",function(t){e.error(t)});return this};h.prototype.resume=function(){if(!i.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length){this.prepareNextSource();return!0}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return!0}};h.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0};h.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()};e.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,r){"use strict";var n=t("../compressions"),i=t("./ZipFileWorker");r.generateWorker=function(t,e,r){var o=new i(e.streamFiles,r,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,r){a++;var i=function(t,e){var r=t||e,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,e.compression),s=r.options.compressionOptions||e.compressionOptions||{},l=r.dir,c=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:t,dir:l,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(o)});o.entriesCount=a}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}n.prototype=t("./object");n.prototype.loadAsync=t("./load");n.support=t("./support");n.defaults=t("./defaults");n.version="3.2.0";n.loadAsync=function(t,e){return(new n).loadAsync(t,e)};n.external=t("./external");e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,r){"use strict";var n=t("./utils"),i=t("./external"),o=t("./utf8"),a=(n=t("./utils"),t("./zipEntries")),s=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(t){return new i.Promise(function(e,r){var n=t.decompressed.getContentWorker().pipe(new s);n.on("error",function(t){r(t)}).on("end",function(){n.streamInfo.crc32!==t.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}e.exports=function(t,e){var r=this;e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode});return l.isNode&&l.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var r=new a(e);r.load(t);return r}).then(function(t){var r=[i.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var o=0;o<n.length;o++)r.push(c(n[o]));return i.Promise.all(r)}).then(function(t){for(var n=t.shift(),i=n.files,o=0;o<i.length;o++){var a=i[o];r.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}n.zipComment.length&&(r.comment=n.zipComment);return r})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../stream/GenericWorker");function o(t,e){i.call(this,"Nodejs stream input adapter for "+t);this._upstreamEnded=!1;this._bindStream(e)}n.inherits(o,i);o.prototype._bindStream=function(t){var e=this;this._stream=t;t.pause();t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})};o.prototype.pause=function(){if(!i.prototype.pause.call(this))return!1;this._stream.pause();return!0};o.prototype.resume=function(){if(!i.prototype.resume.call(this))return!1;this._upstreamEnded?this.end():this._stream.resume();return!0};e.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,r){"use strict";var n=t("readable-stream").Readable;t("../utils").inherits(i,n);function i(t,e,r){n.call(this,e);this._helper=t;var i=this;t.on("data",function(t,e){i.push(t)||i._helper.pause();r&&r(e)}).on("error",function(t){i.emit("error",t)}).on("end",function(){i.push(null)})}i.prototype._read=function(){this._helper.resume()};e.exports=i},{"../utils":32,"readable-stream":16}],14:[function(t,e,r){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);e.fill(0);return e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,r){"use strict";var n=t("./utf8"),i=t("./utils"),o=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),s=t("./defaults"),l=t("./compressedObject"),c=t("./zipObject"),u=t("./generate"),h=t("./nodejsUtils"),d=t("./nodejs/NodejsStreamInputAdapter"),p=function(t,e,r){var n,a=i.getTypeOf(e),u=i.extend(r||{},s);u.date=u.date||new Date;null!==u.compression&&(u.compression=u.compression.toUpperCase());"string"==typeof u.unixPermissions&&(u.unixPermissions=parseInt(u.unixPermissions,8));u.unixPermissions&&16384&u.unixPermissions&&(u.dir=!0);u.dosPermissions&&16&u.dosPermissions&&(u.dir=!0);u.dir&&(t=g(t));u.createFolders&&(n=f(t))&&y.call(this,n,!0);var p="string"===a&&!1===u.binary&&!1===u.base64;r&&void 0!==r.binary||(u.binary=!p);if(e instanceof l&&0===e.uncompressedSize||u.dir||!e||0===e.length){u.base64=!1;u.binary=!0;e="";u.compression="STORE";a="string"}var m=null;m=e instanceof l||e instanceof o?e:h.isNode&&h.isStream(e)?new d(t,e):i.prepareContent(t,e,u.binary,u.optimizedBinaryString,u.base64);var C=new c(t,m,u);this.files[t]=C},f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},g=function(t){"/"!==t.slice(-1)&&(t+="/");return t},y=function(t,e){e=void 0!==e?e:s.createFolders;t=g(t);this.files[t]||p.call(this,t,null,{dir:!0,createFolders:e});return this.files[t]};function m(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,n;for(e in this.files)if(this.files.hasOwnProperty(e)){n=this.files[e];(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,n)}},filter:function(t){var e=[];this.forEach(function(r,n){t(r,n)&&e.push(n)});return e},file:function(t,e,r){if(1===arguments.length){if(m(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var i=this.files[this.root+t];return i&&!i.dir?i:null}t=this.root+t;p.call(this,t,e,r);return this},folder:function(t){if(!t)return this;if(m(t))return this.filter(function(e,r){return r.dir&&t.test(e)});var e=this.root+t,r=y.call(this,e),n=this.clone();n.root=r.name;return n},remove:function(t){t=this.root+t;var e=this.files[t];if(!e){"/"!==t.slice(-1)&&(t+="/");e=this.files[t]}if(e&&!e.dir)delete this.files[t];else for(var r=this.filter(function(e,r){return r.name.slice(0,t.length)===t}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{(r=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase();r.compression=r.compression.toUpperCase();"binarystring"===r.type&&(r.type="string");if(!r.type)throw new Error("No output type specified.");i.checkSupport(r.type);"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX");"win32"===r.platform&&(r.platform="DOS");var s=r.comment||this.comment||"";e=u.generateWorker(this,r,s)}catch(t){(e=new o("error")).error(t)}return new a(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){(t=t||{}).type||(t.type="nodebuffer");return this.generateInternalStream(t).toNodejsStream(e)}};e.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,r){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,r){"use strict";var n=t("./DataReader");function i(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(i,n);i.prototype.byteAt=function(t){return this.data[this.zero+t]};i.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o-this.zero;return-1};i.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&r===o[1]&&n===o[2]&&i===o[3]};i.prototype.readData=function(t){this.checkOffset(t);if(0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);this.index+=t;return e};e.exports=i},{"../utils":32,"./DataReader":18}],18:[function(t,e,r){"use strict";var n=t("../utils");function i(t){this.data=t;this.length=t.length;this.index=0;this.zero=0}i.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t);this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,r=0;this.checkOffset(t);for(e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);this.index+=t;return r},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}};e.exports=i},{"../utils":32}],19:[function(t,e,r){"use strict";var n=t("./Uint8ArrayReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n);i.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);this.index+=t;return e};e.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,r){"use strict";var n=t("./DataReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n);i.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)};i.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero};i.prototype.readAndCheckSignature=function(t){return t===this.readData(4)};i.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);this.index+=t;return e};e.exports=i},{"../utils":32,"./DataReader":18}],21:[function(t,e,r){"use strict";var n=t("./ArrayReader");function i(t){n.call(this,t)}t("../utils").inherits(i,n);i.prototype.readData=function(t){this.checkOffset(t);if(0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);this.index+=t;return e};e.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),s=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);n.checkSupport(e);return"string"!==e||i.uint8array?"nodebuffer"===e?new s(t):i.uint8array?new l(n.transformTo("uint8array",t)):new o(n.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK\x03\x04";r.CENTRAL_FILE_HEADER="PK\x01\x02";r.CENTRAL_DIRECTORY_END="PK\x05\x06";r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07";r.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06";r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../utils");function o(t){n.call(this,"ConvertWorker to "+t);this.destType=t}i.inherits(o,n);o.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})};e.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../crc32");function o(){n.call(this,"Crc32Probe");this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n);o.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0);this.push(t)};e.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function o(t){i.call(this,"DataLengthProbe for "+t);this.propName=t;this.withStreamInfo(t,0)}n.inherits(o,i);o.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}i.prototype.processChunk.call(this,t)};e.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function o(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=!1;t.then(function(t){e.dataIsReady=!0;e.data=t;e.max=t&&t.length||0;e.type=n.getTypeOf(t);e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(o,i);o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this);this.data=null};o.prototype.resume=function(){if(!i.prototype.resume.call(this))return!1;if(!this._tickScheduled&&this.dataIsReady){this._tickScheduled=!0;n.delay(this._tickAndRepeat,[],this)}return!0};o.prototype._tickAndRepeat=function(){this._tickScheduled=!1;if(!this.isPaused&&!this.isFinished){this._tick();if(!this.isFinished){n.delay(this._tickAndRepeat,[],this);this._tickScheduled=!0}}};o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}this.index=e;return this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};e.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,r){"use strict";function n(t){this.name=t||"default";this.streamInfo={};this.generatedError=null;this.extraStreamInfo={};this.isPaused=!0;this.isFinished=!1;this.isLocked=!1;this._listeners={data:[],end:[],error:[]};this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end");this.cleanUp();this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){if(this.isFinished)return!1;if(this.isPaused)this.generatedError=t;else{this.isFinished=!0;this.emit("error",t);this.previous&&this.previous.error(t);this.cleanUp()}return!0},on:function(t,e){this._listeners[t].push(e);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null;this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo;this.mergeStreamInfo();this.previous=t;var e=this;t.on("data",function(t){e.processChunk(t)});t.on("end",function(){e.end()});t.on("error",function(t){e.error(t)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;if(this.generatedError){this.error(this.generatedError);t=!0}this.previous&&this.previous.resume();return!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){this.extraStreamInfo[t]=e;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}};e.exports=n},{}],29:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),s=t("../support"),l=t("../external"),c=null;if(s.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function u(t,e){return new l.Promise(function(r,i){var o=[],s=t._internalType,l=t._outputType,c=t._mimeType;t.on("data",function(t,r){o.push(t);e&&e(r)}).on("error",function(t){o=[];i(t)}).on("end",function(){try{var t=function(t,e,r){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),r);case"base64":return a.encode(e);default:return n.transformTo(t,e)}}(l,function(t,e){var r,n=0,i=null,o=0;for(r=0;r<e.length;r++)o+=e[r].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":i=new Uint8Array(o);for(r=0;r<e.length;r++){i.set(e[r],n);n+=e[r].length}return i;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(s,o),c);r(t)}catch(t){i(t)}o=[]}).resume()})}function h(t,e,r){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a;this._outputType=e;this._mimeType=r;n.checkSupport(a);this._worker=t.pipe(new i(a));t.lock()}catch(t){this._worker=new o("error");this._worker.error(t)}}h.prototype={accumulate:function(t){return u(this,t)},on:function(t,e){var r=this;"data"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){n.delay(e,arguments,r)});return this},resume:function(){n.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(t){n.checkSupport("nodestream");if("nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:"nodebuffer"!==this._outputType},t)}};e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,r){"use strict";r.base64=!0;r.array=!0;r.string=!0;r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array;r.nodebuffer="undefined"!=typeof Buffer;r.uint8array="undefined"!=typeof Uint8Array;if("undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n);r.blob=0===i.getBlob("application/zip").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch(t){r.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,r){"use strict";for(var n=t("./utils"),i=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1;r.utf8encode=function(t){return i.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,r,n,o,a,s=t.length,l=0;for(o=0;o<s;o++){if(55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))){r=65536+(r-55296<<10)+(n-56320);o++}l+=r<128?1:r<2048?2:r<65536?3:4}e=i.uint8array?new Uint8Array(l):new Array(l);for(a=0,o=0;a<l;o++){if(55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))){r=65536+(r-55296<<10)+(n-56320);o++}if(r<128)e[a++]=r;else if(r<2048){e[a++]=192|r>>>6;e[a++]=128|63&r}else if(r<65536){e[a++]=224|r>>>12;e[a++]=128|r>>>6&63;e[a++]=128|63&r}else{e[a++]=240|r>>>18;e[a++]=128|r>>>12&63;e[a++]=128|r>>>6&63;e[a++]=128|63&r}}return e}(t)};r.utf8decode=function(t){return i.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,i,o,a=t.length,l=new Array(2*a);for(r=0,e=0;e<a;)if((i=t[e++])<128)l[r++]=i;else if((o=s[i])>4){l[r++]=65533;e+=o-1}else{i&=2===o?31:3===o?15:7;for(;o>1&&e<a;){i=i<<6|63&t[e++];o--}if(o>1)l[r++]=65533;else if(i<65536)l[r++]=i;else{i-=65536;l[r++]=55296|i>>10&1023;l[r++]=56320|1023&i}}l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r);return n.applyFromCharCode(l)}(t=n.transformTo(i.uint8array?"uint8array":"array",t))};function c(){a.call(this,"utf-8 decode");this.leftOver=null}n.inherits(c,a);c.prototype.processChunk=function(t){var e=n.transformTo(i.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=e;(e=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0);e.set(o,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var r;(e=e||t.length)>t.length&&(e=t.length);r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}(e),l=e;if(a!==e.length)if(i.uint8array){l=e.subarray(0,a);this.leftOver=e.subarray(a,e.length)}else{l=e.slice(0,a);this.leftOver=e.slice(a,e.length)}this.push({data:r.utf8decode(l),meta:t.meta})};c.prototype.flush=function(){if(this.leftOver&&this.leftOver.length){this.push({data:r.utf8decode(this.leftOver),meta:{}});this.leftOver=null}};r.Utf8DecodeWorker=c;function u(){a.call(this,"utf-8 encode")}n.inherits(u,a);u.prototype.processChunk=function(t){this.push({data:r.utf8encode(t.data),meta:t.meta})};r.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,r){"use strict";var n=t("./support"),i=t("./base64"),o=t("./nodejsUtils"),a=t("set-immediate-shim"),s=t("./external");r.newBlob=function(t,e){r.checkSupport("blob");try{return new Blob([t],{type:e})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(t);return n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};function l(t){return t}function c(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}var u={stringifyByChunk:function(t,e,r){var n=[],i=0,o=t.length;if(o<=r)return String.fromCharCode.apply(null,t);for(;i<o;){"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,o)))):n.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,o))));i+=r}return n.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function h(t){var e=65536,n=r.getTypeOf(t),i=!0;"uint8array"===n?i=u.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=u.applyCanBeUsed.nodebuffer);if(i)for(;e>1;)try{return u.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return u.stringifyByChar(t)}r.applyFromCharCode=h;function d(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}var p={};p.string={string:l,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:function(t){return c(t,o.allocBuffer(t.length))}};p.array={string:h,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}};p.arraybuffer={string:function(t){return h(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}};p.uint8array={string:h,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return o.newBufferFrom(t)}};p.nodebuffer={string:h,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:l};r.transformTo=function(t,e){e||(e="");if(!t)return e;r.checkSupport(t);var n=r.getTypeOf(e);return p[n][t](e)};r.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&o.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0};r.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")};r.MAX_VALUE_16BITS=65535;r.MAX_VALUE_32BITS=-1;r.pretty=function(t){var e,r,n="";for(r=0;r<(t||"").length;r++)n+="\\x"+((e=t.charCodeAt(r))<16?"0":"")+e.toString(16).toUpperCase();return n};r.delay=function(t,e,r){a(function(){t.apply(r||null,e||[])})};r.inherits=function(t,e){var r=function(){};r.prototype=e.prototype;t.prototype=new r};r.extend=function(){var t,e,r={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===r[e]&&(r[e]=arguments[t][e]);return r};r.prepareContent=function(t,e,o,a,l){return s.Promise.resolve(e).then(function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise(function(e,r){var n=new FileReader;n.onload=function(t){e(t.target.result)};n.onerror=function(t){r(t.target.error)};n.readAsArrayBuffer(t)}):t}).then(function(e){var u,h=r.getTypeOf(e);if(!h)return s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));"arraybuffer"===h?e=r.transformTo("uint8array",e):"string"===h&&(l?e=i.decode(e):o&&!0!==a&&(e=c(u=e,n.uint8array?new Uint8Array(u.length):new Array(u.length))));return e})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),o=t("./signature"),a=t("./zipEntry"),s=(t("./utf8"),t("./support"));function l(t){this.files=[];this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;this.reader.setIndex(r);return n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",r=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};for(var t,e,r,n=this.zip64EndOfCentralSize-44;0<n;){t=this.reader.readInt(2);e=this.reader.readInt(4);r=this.reader.readData(e);this.zip64ExtensibleData[t]={id:t,length:e,value:r}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++){e=this.files[t];this.reader.setIndex(e.localHeaderOffset);this.checkSignature(o.LOCAL_FILE_HEADER);e.readLocalPart(this.reader);e.handleUTF8();e.processAttributes()}},readCentralDir:function(){var t;this.reader.setIndex(this.centralDirOffset);for(;this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);){(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader);this.files.push(t)}if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0){throw!this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(t);var e=t;this.checkSignature(o.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){this.zip64=!0;if((t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");this.reader.setIndex(t);this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)){this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory")}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;if(this.zip64){r+=20;r+=12+this.zip64EndOfCentralSize}var n=e-r;if(n>0)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),s=t("./utf8"),l=t("./compressions"),c=t("./support");function u(t,e){this.options=t;this.loadOptions=e}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,r;t.skip(22);this.fileNameLength=t.readInt(2);r=t.readInt(2);this.fileName=t.readData(this.fileNameLength);t.skip(r);if(-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2);t.skip(2);this.bitFlag=t.readInt(2);this.compressionMethod=t.readString(2);this.date=t.readDate();this.crc32=t.readInt(4);this.compressedSize=t.readInt(4);this.uncompressedSize=t.readInt(4);var e=t.readInt(2);this.extraFieldsLength=t.readInt(2);this.fileCommentLength=t.readInt(2);this.diskNumberStart=t.readInt(2);this.internalFileAttributes=t.readInt(2);this.externalFileAttributes=t.readInt(4);this.localHeaderOffset=t.readInt(4);if(this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e);this.readExtraFields(t);this.parseZIP64ExtraField(t);this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null;this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes);0===t&&(this.dosPermissions=63&this.externalFileAttributes);3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535);this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8));this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8));this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8));this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,r,n,i=t.index+this.extraFieldsLength;this.extraFields||(this.extraFields={});for(;t.index<i;){e=t.readInt(2);r=t.readInt(2);n=t.readData(r);this.extraFields[e]={id:e,length:r,value:n}}},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8()){this.fileNameStr=s.utf8decode(this.fileName);this.fileCommentStr=s.utf8decode(this.fileComment)}else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var r=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var o=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}};e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,r){"use strict";var n=t("./stream/StreamHelper"),i=t("./stream/DataWorker"),o=t("./utf8"),a=t("./compressedObject"),s=t("./stream/GenericWorker"),l=function(t,e,r){this.name=t;this.dir=r.dir;this.date=r.date;this.comment=r.comment;this.unixPermissions=r.unixPermissions;this.dosPermissions=r.dosPermissions;this._data=e;this._dataBinary=r.binary;this.options={compression:r.compression,compressionOptions:r.compressionOptions}};l.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string");e=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(e=e.pipe(new o.Utf8EncodeWorker));!a&&i&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new s("error")).error(t)}return new n(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();this._dataBinary||(r=r.pipe(new o.Utf8EncodeWorker));return a.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)l.prototype[c[h]]=u;e.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,r){(function(t){"use strict";var r,n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(u),s=t.document.createTextNode("");a.observe(s,{characterData:!0});r=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u();e.onreadystatechange=null;e.parentNode.removeChild(e);e=null};t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u;r=function(){l.port2.postMessage(0)}}var c=[];function u(){n=!0;for(var t,e,r=c.length;r;){e=c;c=[];t=-1;for(;++t<r;)e[t]();r=c.length}n=!1}e.exports=function(t){1!==c.push(t)||n||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,r){"use strict";var n=t("immediate");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];e.exports=c;function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l;this.queue=[];this.outcome=void 0;t!==i&&p(this,t)}c.prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){throw r})})};c.prototype.catch=function(t){return this.then(null,t)};c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var r=new this.constructor(i);if(this.state!==l){h(r,this.state===s?t:e,this.outcome)}else this.queue.push(new u(r,t,e));return r};function u(t,e,r){this.promise=t;if("function"==typeof e){this.onFulfilled=e;this.callFulfilled=this.otherCallFulfilled}if("function"==typeof r){this.onRejected=r;this.callRejected=this.otherCallRejected}}u.prototype.callFulfilled=function(t){o.resolve(this.promise,t)};u.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)};u.prototype.callRejected=function(t){o.reject(this.promise,t)};u.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)};function h(t,e,r){n(function(){var n;try{n=e(r)}catch(e){return o.reject(t,e)}n===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,n)})}o.resolve=function(t,e){var r=f(d,e);if("error"===r.status)return o.reject(t,r.value);var n=r.value;if(n)p(t,n);else{t.state=s;t.outcome=e;for(var i=-1,a=t.queue.length;++i<a;)t.queue[i].callFulfilled(e)}return t};o.reject=function(t,e){t.state=a;t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t};function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var r=!1;function n(e){if(!r){r=!0;o.reject(t,e)}}function i(e){if(!r){r=!0;o.resolve(t,e)}}var a=f(function(){e(i,n)});"error"===a.status&&n(a.value)}function f(t,e){var r={};try{r.value=t(e);r.status="success"}catch(t){r.status="error";r.value=t}return r}c.resolve=function(t){if(t instanceof this)return t;return o.resolve(new this(i),t)};c.reject=function(t){var e=new this(i);return o.reject(e,t)};c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);var a=new Array(r),s=0,l=-1,c=new this(i);for(;++l<r;)u(t[l],l);return c;function u(t,i){e.resolve(t).then(function(t){a[i]=t;if(++s===r&&!n){n=!0;o.resolve(c,a)}},function(t){if(!n){n=!0;o.reject(c,t)}})}};c.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);var a=-1,s=new this(i);for(;++a<r;)l=t[a],e.resolve(l).then(function(t){if(!n){n=!0;o.resolve(s,t)}},function(t){if(!n){n=!0;o.reject(s,t)}});var l;return s}},{immediate:36}],38:[function(t,e,r){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants"));e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,r){"use strict";var n=t("./zlib/deflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,h=0,d=8;function p(t){if(!(this instanceof p))return new p(t);this.options=i.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new s;this.strm.avail_out=0;var r=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==c)throw new Error(a[r]);e.header&&n.deflateSetHeader(this.strm,e.header);if(e.dictionary){var f;f="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if((r=n.deflateSetDictionary(this.strm,f))!==c)throw new Error(a[r]);this._dict_set=!0}}p.prototype.push=function(t,e){var r,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0;"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===l.call(t)?s.input=new Uint8Array(t):s.input=t;s.next_in=0;s.avail_in=s.input.length;do{if(0===s.avail_out){s.output=new i.Buf8(u);s.next_out=0;s.avail_out=u}if(1!==(r=n.deflate(s,a))&&r!==c){this.onEnd(r);this.ended=!0;return!1}0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);if(4===a){r=n.deflateEnd(this.strm);this.onEnd(r);this.ended=!0;return r===c}if(2===a){this.onEnd(c);s.avail_out=0;return!0}return!0};p.prototype.onData=function(t){this.chunks.push(t)};p.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks));this.chunks=[];this.err=t;this.msg=this.strm.msg};function f(t,e){var r=new p(e);r.push(t,!0);if(r.err)throw r.msg||a[r.err];return r.result}r.Deflate=p;r.deflate=f;r.deflateRaw=function(t,e){(e=e||{}).raw=!0;return f(t,e)};r.gzip=function(t,e){(e=e||{}).gzip=!0;return f(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,r){"use strict";var n=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;if(e.raw&&e.windowBits>=0&&e.windowBits<16){e.windowBits=-e.windowBits;0===e.windowBits&&(e.windowBits=-15)}!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32);e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new l;this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);this.header=new c;n.inflateGetHeader(this.strm,this.header)}h.prototype.push=function(t,e){var r,s,l,c,h,d,p=this.strm,f=this.options.chunkSize,g=this.options.dictionary,y=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH;"string"==typeof t?p.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?p.input=new Uint8Array(t):p.input=t;p.next_in=0;p.avail_in=p.input.length;do{if(0===p.avail_out){p.output=new i.Buf8(f);p.next_out=0;p.avail_out=f}if((r=n.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g){d="string"==typeof g?o.string2buf(g):"[object ArrayBuffer]"===u.call(g)?new Uint8Array(g):g;r=n.inflateSetDictionary(this.strm,d)}if(r===a.Z_BUF_ERROR&&!0===y){r=a.Z_OK;y=!1}if(r!==a.Z_STREAM_END&&r!==a.Z_OK){this.onEnd(r);this.ended=!0;return!1}if(p.next_out&&(0===p.avail_out||r===a.Z_STREAM_END||0===p.avail_in&&(s===a.Z_FINISH||s===a.Z_SYNC_FLUSH)))if("string"===this.options.to){l=o.utf8border(p.output,p.next_out);c=p.next_out-l;h=o.buf2string(p.output,l);p.next_out=c;p.avail_out=f-c;c&&i.arraySet(p.output,p.output,l,c,0);this.onData(h)}else this.onData(i.shrinkBuf(p.output,p.next_out));0===p.avail_in&&0===p.avail_out&&(y=!0)}while((p.avail_in>0||0===p.avail_out)&&r!==a.Z_STREAM_END);r===a.Z_STREAM_END&&(s=a.Z_FINISH);if(s===a.Z_FINISH){r=n.inflateEnd(this.strm);this.onEnd(r);this.ended=!0;return r===a.Z_OK}if(s===a.Z_SYNC_FLUSH){this.onEnd(a.Z_OK);p.avail_out=0;return!0}return!0};h.prototype.onData=function(t){this.chunks.push(t)};h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks));this.chunks=[];this.err=t;this.msg=this.strm.msg};function d(t,e){var r=new h(e);r.push(t,!0);if(r.err)throw r.msg||s[r.err];return r.result}r.Inflate=h;r.inflate=d;r.inflateRaw=function(t,e){(e=e||{}).raw=!0;return d(t,e)};r.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}}return t};r.shrinkBuf=function(t,e){if(t.length===e)return t;if(t.subarray)return t.subarray(0,e);t.length=e;return t};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;n=0;for(e=0,r=t.length;e<r;e++)n+=t[e].length;a=new Uint8Array(n);i=0;for(e=0,r=t.length;e<r;e++){o=t[e];a.set(o,i);i+=o.length}return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){if(t){r.Buf8=Uint8Array;r.Buf16=Uint16Array;r.Buf32=Int32Array;r.assign(r,i)}else{r.Buf8=Array;r.Buf16=Array;r.Buf32=Array;r.assign(r,o)}};r.setTyped(n)},{}],42:[function(t,e,r){"use strict";var n=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;a[254]=a[254]=1;r.string2buf=function(t){var e,r,i,o,a,s=t.length,l=0;for(o=0;o<s;o++){if(55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))){r=65536+(r-55296<<10)+(i-56320);o++}l+=r<128?1:r<2048?2:r<65536?3:4}e=new n.Buf8(l);for(a=0,o=0;a<l;o++){if(55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))){r=65536+(r-55296<<10)+(i-56320);o++}if(r<128)e[a++]=r;else if(r<2048){e[a++]=192|r>>>6;e[a++]=128|63&r}else if(r<65536){e[a++]=224|r>>>12;e[a++]=128|r>>>6&63;e[a++]=128|63&r}else{e[a++]=240|r>>>18;e[a++]=128|r>>>12&63;e[a++]=128|r>>>6&63;e[a++]=128|63&r}}return e};function l(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}r.buf2binstring=function(t){return l(t,t.length)};r.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e};r.buf2string=function(t,e){var r,n,i,o,s=e||t.length,c=new Array(2*s);for(n=0,r=0;r<s;)if((i=t[r++])<128)c[n++]=i;else if((o=a[i])>4){c[n++]=65533;r+=o-1}else{i&=2===o?31:3===o?15:7;for(;o>1&&r<s;){i=i<<6|63&t[r++];o--}if(o>1)c[n++]=65533;else if(i<65536)c[n++]=i;else{i-=65536;c[n++]=55296|i>>10&1023;c[n++]=56320|1023&i}}return l(c,n)};r.utf8border=function(t,e){var r;(e=e||t.length)>t.length&&(e=t.length);r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+a[t[r]]>e?r:e}},{"./common":41}],43:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+e[n++]|0)|0}while(--a);i%=65521;o%=65521}return i|o<<16|0}},{}],44:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],46:[function(t,e,r){"use strict";var n,i=t("../utils/common"),o=t("./trees"),a=t("./adler32"),s=t("./crc32"),l=t("./messages"),c=0,u=1,h=3,d=4,p=5,f=0,g=1,y=-2,m=-3,C=-5,v=-1,T=1,_=2,S=3,E=4,w=0,b=2,L=8,A=9,x=15,P=8,I=286,R=30,O=19,M=2*I+1,k=15,N=3,D=258,F=D+N+1,B=32,G=42,U=69,j=73,q=91,W=103,H=113,V=666,Y=1,z=2,K=3,$=4,X=3;function Z(t,e){t.msg=l[e];return e}function J(t){return(t<<1)-(t>4?9:0)}function Q(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out);if(0!==r){i.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out);t.next_out+=r;e.pending_out+=r;t.total_out+=r;t.avail_out-=r;e.pending-=r;0===e.pending&&(e.pending_out=0)}}function et(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e);t.block_start=t.strstart;tt(t.strm)}function rt(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255;t.pending_buf[t.pending++]=255&e}function it(t,e,r,n){var o=t.avail_in;o>n&&(o=n);if(0===o)return 0;t.avail_in-=o;i.arraySet(e,t.input,t.next_in,o,r);1===t.state.wrap?t.adler=a(t.adler,e,o,r):2===t.state.wrap&&(t.adler=s(t.adler,e,o,r));t.next_in+=o;t.total_in+=o;return o}function ot(t,e){var r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-F?t.strstart-(t.w_size-F):0,c=t.window,u=t.w_mask,h=t.prev,d=t.strstart+D,p=c[o+a-1],f=c[o+a];t.prev_length>=t.good_match&&(i>>=2);s>t.lookahead&&(s=t.lookahead);do{if(c[(r=e)+a]===f&&c[r+a-1]===p&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2;r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<d);n=D-(d-o);o=d-D;if(n>a){t.match_start=e;a=n;if(n>=s)break;p=c[o+a-1];f=c[o+a]}}}while((e=h[e&u])>l&&0!=--i);return a<=t.lookahead?a:t.lookahead}function at(t){var e,r,n,o,a,s=t.w_size;do{o=t.window_size-t.lookahead-t.strstart;if(t.strstart>=s+(s-F)){i.arraySet(t.window,t.window,s,s,0);t.match_start-=s;t.strstart-=s;t.block_start-=s;e=r=t.hash_size;do{n=t.head[--e];t.head[e]=n>=s?n-s:0}while(--r);e=r=s;do{n=t.prev[--e];t.prev[e]=n>=s?n-s:0}while(--r);o+=s}if(0===t.strm.avail_in)break;r=it(t.strm,t.window,t.strstart+t.lookahead,o);t.lookahead+=r;if(t.lookahead+t.insert>=N){a=t.strstart-t.insert;t.ins_h=t.window[a];t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;for(;t.insert;){t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+N-1])&t.hash_mask;t.prev[a&t.w_mask]=t.head[t.ins_h];t.head[t.ins_h]=a;a++;t.insert--;if(t.lookahead+t.insert<N)break}}}while(t.lookahead<F&&0!==t.strm.avail_in)}function st(t,e){for(var r,n;;){if(t.lookahead<F){at(t);if(t.lookahead<F&&e===c)return Y;if(0===t.lookahead)break}r=0;if(t.lookahead>=N){t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask;r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h];t.head[t.ins_h]=t.strstart}0!==r&&t.strstart-r<=t.w_size-F&&(t.match_length=ot(t,r));if(t.match_length>=N){n=o._tr_tally(t,t.strstart-t.match_start,t.match_length-N);t.lookahead-=t.match_length;if(t.match_length<=t.max_lazy_match&&t.lookahead>=N){t.match_length--;do{t.strstart++;t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask;r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h];t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else{t.strstart+=t.match_length;t.match_length=0;t.ins_h=t.window[t.strstart];t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask}}else{n=o._tr_tally(t,0,t.window[t.strstart]);t.lookahead--;t.strstart++}if(n){et(t,!1);if(0===t.strm.avail_out)return Y}}t.insert=t.strstart<N-1?t.strstart:N-1;if(e===d){et(t,!0);return 0===t.strm.avail_out?K:$}if(t.last_lit){et(t,!1);if(0===t.strm.avail_out)return Y}return z}function lt(t,e){for(var r,n,i;;){if(t.lookahead<F){at(t);if(t.lookahead<F&&e===c)return Y;if(0===t.lookahead)break}r=0;if(t.lookahead>=N){t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask;r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h];t.head[t.ins_h]=t.strstart}t.prev_length=t.match_length;t.prev_match=t.match_start;t.match_length=N-1;if(0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-F){t.match_length=ot(t,r);t.match_length<=5&&(t.strategy===T||t.match_length===N&&t.strstart-t.match_start>4096)&&(t.match_length=N-1)}if(t.prev_length>=N&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-N;n=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-N);t.lookahead-=t.prev_length-1;t.prev_length-=2;do{if(++t.strstart<=i){t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask;r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h];t.head[t.ins_h]=t.strstart}}while(0!=--t.prev_length);t.match_available=0;t.match_length=N-1;t.strstart++;if(n){et(t,!1);if(0===t.strm.avail_out)return Y}}else if(t.match_available){(n=o._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1);t.strstart++;t.lookahead--;if(0===t.strm.avail_out)return Y}else{t.match_available=1;t.strstart++;t.lookahead--}}if(t.match_available){n=o._tr_tally(t,0,t.window[t.strstart-1]);t.match_available=0}t.insert=t.strstart<N-1?t.strstart:N-1;if(e===d){et(t,!0);return 0===t.strm.avail_out?K:$}if(t.last_lit){et(t,!1);if(0===t.strm.avail_out)return Y}return z}function ct(t,e,r,n,i){this.good_length=t;this.max_lazy=e;this.nice_length=r;this.max_chain=n;this.func=i}n=[new ct(0,0,0,0,function(t,e){var r=65535;r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);for(;;){if(t.lookahead<=1){at(t);if(0===t.lookahead&&e===c)return Y;if(0===t.lookahead)break}t.strstart+=t.lookahead;t.lookahead=0;var n=t.block_start+r;if(0===t.strstart||t.strstart>=n){t.lookahead=t.strstart-n;t.strstart=n;et(t,!1);if(0===t.strm.avail_out)return Y}if(t.strstart-t.block_start>=t.w_size-F){et(t,!1);if(0===t.strm.avail_out)return Y}}t.insert=0;if(e===d){et(t,!0);return 0===t.strm.avail_out?K:$}if(t.strstart>t.block_start){et(t,!1);if(0===t.strm.avail_out)return Y}return Y}),new ct(4,4,8,4,st),new ct(4,5,16,8,st),new ct(4,6,32,32,st),new ct(4,4,16,16,lt),new ct(8,16,32,32,lt),new ct(8,16,128,128,lt),new ct(8,32,128,256,lt),new ct(32,128,258,1024,lt),new ct(32,258,258,4096,lt)];function ut(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=L;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new i.Buf16(2*M);this.dyn_dtree=new i.Buf16(2*(2*R+1));this.bl_tree=new i.Buf16(2*(2*O+1));Q(this.dyn_ltree);Q(this.dyn_dtree);Q(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new i.Buf16(k+1);this.heap=new i.Buf16(2*I+1);Q(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new i.Buf16(2*I+1);Q(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function ht(t){var e;if(!t||!t.state)return Z(t,y);t.total_in=t.total_out=0;t.data_type=b;(e=t.state).pending=0;e.pending_out=0;e.wrap<0&&(e.wrap=-e.wrap);e.status=e.wrap?G:H;t.adler=2===e.wrap?0:1;e.last_flush=c;o._tr_init(e);return f}function dt(t){var e=ht(t);e===f&&function(t){t.window_size=2*t.w_size;Q(t.head);t.max_lazy_match=n[t.level].max_lazy;t.good_match=n[t.level].good_length;t.nice_match=n[t.level].nice_length;t.max_chain_length=n[t.level].max_chain;t.strstart=0;t.block_start=0;t.lookahead=0;t.insert=0;t.match_length=t.prev_length=N-1;t.match_available=0;t.ins_h=0}(t.state);return e}function pt(t,e,r,n,o,a){if(!t)return y;var s=1;e===v&&(e=6);if(n<0){s=0;n=-n}else if(n>15){s=2;n-=16}if(o<1||o>A||r!==L||n<8||n>15||e<0||e>9||a<0||a>E)return Z(t,y);8===n&&(n=9);var l=new ut;t.state=l;l.strm=t;l.wrap=s;l.gzhead=null;l.w_bits=n;l.w_size=1<<l.w_bits;l.w_mask=l.w_size-1;l.hash_bits=o+7;l.hash_size=1<<l.hash_bits;l.hash_mask=l.hash_size-1;l.hash_shift=~~((l.hash_bits+N-1)/N);l.window=new i.Buf8(2*l.w_size);l.head=new i.Buf16(l.hash_size);l.prev=new i.Buf16(l.w_size);l.lit_bufsize=1<<o+6;l.pending_buf_size=4*l.lit_bufsize;l.pending_buf=new i.Buf8(l.pending_buf_size);l.d_buf=1*l.lit_bufsize;l.l_buf=3*l.lit_bufsize;l.level=e;l.strategy=a;l.method=r;return dt(t)}r.deflateInit=function(t,e){return pt(t,e,L,x,P,w)};r.deflateInit2=pt;r.deflateReset=dt;r.deflateResetKeep=ht;r.deflateSetHeader=function(t,e){if(!t||!t.state)return y;if(2!==t.state.wrap)return y;t.state.gzhead=e;return f};r.deflate=function(t,e){var r,i,a,l;if(!t||!t.state||e>p||e<0)return t?Z(t,y):y;i=t.state;if(!t.output||!t.input&&0!==t.avail_in||i.status===V&&e!==d)return Z(t,0===t.avail_out?C:y);i.strm=t;r=i.last_flush;i.last_flush=e;if(i.status===G)if(2===i.wrap){t.adler=0;rt(i,31);rt(i,139);rt(i,8);if(i.gzhead){rt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0));rt(i,255&i.gzhead.time);rt(i,i.gzhead.time>>8&255);rt(i,i.gzhead.time>>16&255);rt(i,i.gzhead.time>>24&255);rt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0);rt(i,255&i.gzhead.os);if(i.gzhead.extra&&i.gzhead.extra.length){rt(i,255&i.gzhead.extra.length);rt(i,i.gzhead.extra.length>>8&255)}i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0));i.gzindex=0;i.status=U}else{rt(i,0);rt(i,0);rt(i,0);rt(i,0);rt(i,0);rt(i,9===i.level?2:i.strategy>=_||i.level<2?4:0);rt(i,X);i.status=H}}else{var m=L+(i.w_bits-8<<4)<<8;m|=(i.strategy>=_||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6;0!==i.strstart&&(m|=B);m+=31-m%31;i.status=H;nt(i,m);if(0!==i.strstart){nt(i,t.adler>>>16);nt(i,65535&t.adler)}t.adler=1}if(i.status===U)if(i.gzhead.extra){a=i.pending;for(;i.gzindex<(65535&i.gzhead.extra.length);){if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));tt(t);a=i.pending;if(i.pending===i.pending_buf_size)break}rt(i,255&i.gzhead.extra[i.gzindex]);i.gzindex++}i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));if(i.gzindex===i.gzhead.extra.length){i.gzindex=0;i.status=j}}else i.status=j;if(i.status===j)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));tt(t);a=i.pending;if(i.pending===i.pending_buf_size){l=1;break}}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0;rt(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));if(0===l){i.gzindex=0;i.status=q}}else i.status=q;if(i.status===q)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size){i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));tt(t);a=i.pending;if(i.pending===i.pending_buf_size){l=1;break}}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0;rt(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a));0===l&&(i.status=W)}else i.status=W;if(i.status===W)if(i.gzhead.hcrc){i.pending+2>i.pending_buf_size&&tt(t);if(i.pending+2<=i.pending_buf_size){rt(i,255&t.adler);rt(i,t.adler>>8&255);t.adler=0;i.status=H}}else i.status=H;if(0!==i.pending){tt(t);if(0===t.avail_out){i.last_flush=-1;return f}}else if(0===t.avail_in&&J(e)<=J(r)&&e!==d)return Z(t,C);if(i.status===V&&0!==t.avail_in)return Z(t,C);if(0!==t.avail_in||0!==i.lookahead||e!==c&&i.status!==V){var v=i.strategy===_?function(t,e){for(var r;;){if(0===t.lookahead){at(t);if(0===t.lookahead){if(e===c)return Y;break}}t.match_length=0;r=o._tr_tally(t,0,t.window[t.strstart]);t.lookahead--;t.strstart++;if(r){et(t,!1);if(0===t.strm.avail_out)return Y}}t.insert=0;if(e===d){et(t,!0);return 0===t.strm.avail_out?K:$}if(t.last_lit){et(t,!1);if(0===t.strm.avail_out)return Y}return z}(i,e):i.strategy===S?function(t,e){for(var r,n,i,a,s=t.window;;){if(t.lookahead<=D){at(t);if(t.lookahead<=D&&e===c)return Y;if(0===t.lookahead)break}t.match_length=0;if(t.lookahead>=N&&t.strstart>0&&(n=s[i=t.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=t.strstart+D;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);t.match_length=D-(a-i);t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=N){r=o._tr_tally(t,1,t.match_length-N);t.lookahead-=t.match_length;t.strstart+=t.match_length;t.match_length=0}else{r=o._tr_tally(t,0,t.window[t.strstart]);t.lookahead--;t.strstart++}if(r){et(t,!1);if(0===t.strm.avail_out)return Y}}t.insert=0;if(e===d){et(t,!0);return 0===t.strm.avail_out?K:$}if(t.last_lit){et(t,!1);if(0===t.strm.avail_out)return Y}return z}(i,e):n[i.level].func(i,e);v!==K&&v!==$||(i.status=V);if(v===Y||v===K){0===t.avail_out&&(i.last_flush=-1);return f}if(v===z){if(e===u)o._tr_align(i);else if(e!==p){o._tr_stored_block(i,0,0,!1);if(e===h){Q(i.head);if(0===i.lookahead){i.strstart=0;i.block_start=0;i.insert=0}}}tt(t);if(0===t.avail_out){i.last_flush=-1;return f}}}if(e!==d)return f;if(i.wrap<=0)return g;if(2===i.wrap){rt(i,255&t.adler);rt(i,t.adler>>8&255);rt(i,t.adler>>16&255);rt(i,t.adler>>24&255);rt(i,255&t.total_in);rt(i,t.total_in>>8&255);rt(i,t.total_in>>16&255);rt(i,t.total_in>>24&255)}else{nt(i,t.adler>>>16);nt(i,65535&t.adler)}tt(t);i.wrap>0&&(i.wrap=-i.wrap);return 0!==i.pending?f:g};r.deflateEnd=function(t){var e;if(!t||!t.state)return y;if((e=t.state.status)!==G&&e!==U&&e!==j&&e!==q&&e!==W&&e!==H&&e!==V)return Z(t,y);t.state=null;return e===H?Z(t,m):f};r.deflateSetDictionary=function(t,e){var r,n,o,s,l,c,u,h,d=e.length;if(!t||!t.state)return y;if(2===(s=(r=t.state).wrap)||1===s&&r.status!==G||r.lookahead)return y;1===s&&(t.adler=a(t.adler,e,d,0));r.wrap=0;if(d>=r.w_size){if(0===s){Q(r.head);r.strstart=0;r.block_start=0;r.insert=0}h=new i.Buf8(r.w_size);i.arraySet(h,e,d-r.w_size,r.w_size,0);e=h;d=r.w_size}l=t.avail_in;c=t.next_in;u=t.input;t.avail_in=d;t.next_in=0;t.input=e;at(r);for(;r.lookahead>=N;){n=r.strstart;o=r.lookahead-(N-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+N-1])&r.hash_mask;r.prev[n&r.w_mask]=r.head[r.ins_h];r.head[r.ins_h]=n;n++}while(--o);r.strstart=n;r.lookahead=N-1;at(r)}r.strstart+=r.lookahead;r.block_start=r.strstart;r.insert=r.lookahead;r.lookahead=0;r.match_length=r.prev_length=N-1;r.match_available=0;t.next_in=c;t.input=u;t.avail_in=l;r.wrap=s;return f};r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,r){"use strict";e.exports=function(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=!1}},{}],48:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,l,c,u,h,d,p,f,g,y,m,C,v,T,_,S,E,w,b,L;r=t.state;n=t.next_in;b=t.input;i=n+(t.avail_in-5);o=t.next_out;L=t.output;a=o-(e-t.avail_out);s=o+(t.avail_out-257);l=r.dmax;c=r.wsize;u=r.whave;h=r.wnext;d=r.window;p=r.hold;f=r.bits;g=r.lencode;y=r.distcode;m=(1<<r.lenbits)-1;C=(1<<r.distbits)-1;t:do{if(f<15){p+=b[n++]<<f;f+=8;p+=b[n++]<<f;f+=8}v=g[p&m];e:for(;;){p>>>=T=v>>>24;f-=T;if(0===(T=v>>>16&255))L[o++]=65535&v;else{if(!(16&T)){if(0==(64&T)){v=g[(65535&v)+(p&(1<<T)-1)];continue e}if(32&T){r.mode=12;break t}t.msg="invalid literal/length code";r.mode=30;break t}_=65535&v;if(T&=15){if(f<T){p+=b[n++]<<f;f+=8}_+=p&(1<<T)-1;p>>>=T;f-=T}if(f<15){p+=b[n++]<<f;f+=8;p+=b[n++]<<f;f+=8}v=y[p&C];r:for(;;){p>>>=T=v>>>24;f-=T;if(!(16&(T=v>>>16&255))){if(0==(64&T)){v=y[(65535&v)+(p&(1<<T)-1)];continue r}t.msg="invalid distance code";r.mode=30;break t}S=65535&v;if(f<(T&=15)){p+=b[n++]<<f;if((f+=8)<T){p+=b[n++]<<f;f+=8}}if((S+=p&(1<<T)-1)>l){t.msg="invalid distance too far back";r.mode=30;break t}p>>>=T;f-=T;if(S>(T=o-a)){if((T=S-T)>u&&r.sane){t.msg="invalid distance too far back";r.mode=30;break t}E=0;w=d;if(0===h){E+=c-T;if(T<_){_-=T;do{L[o++]=d[E++]}while(--T);E=o-S;w=L}}else if(h<T){E+=c+h-T;if((T-=h)<_){_-=T;do{L[o++]=d[E++]}while(--T);E=0;if(h<_){_-=T=h;do{L[o++]=d[E++]}while(--T);E=o-S;w=L}}}else{E+=h-T;if(T<_){_-=T;do{L[o++]=d[E++]}while(--T);E=o-S;w=L}}for(;_>2;){L[o++]=w[E++];L[o++]=w[E++];L[o++]=w[E++];_-=3}if(_){L[o++]=w[E++];_>1&&(L[o++]=w[E++])}}else{E=o-S;do{L[o++]=L[E++];L[o++]=L[E++];L[o++]=L[E++];_-=3}while(_>2);if(_){L[o++]=L[E++];_>1&&(L[o++]=L[E++])}}break}}break}}while(n<i&&o<s);n-=_=f>>3;p&=(1<<(f-=_<<3))-1;t.next_in=n;t.next_out=o;t.avail_in=n<i?i-n+5:5-(n-i);t.avail_out=o<s?s-o+257:257-(o-s);r.hold=p;r.bits=f}},{}],49:[function(t,e,r){"use strict";var n=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),l=0,c=1,u=2,h=4,d=5,p=6,f=0,g=1,y=2,m=-2,C=-3,v=-4,T=-5,_=8,S=1,E=2,w=3,b=4,L=5,A=6,x=7,P=8,I=9,R=10,O=11,M=12,k=13,N=14,D=15,F=16,B=17,G=18,U=19,j=20,q=21,W=22,H=23,V=24,Y=25,z=26,K=27,$=28,X=29,Z=30,J=31,Q=32,tt=852,et=592,rt=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new n.Buf16(320);this.work=new n.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function ot(t){var e;if(!t||!t.state)return m;e=t.state;t.total_in=t.total_out=e.total=0;t.msg="";e.wrap&&(t.adler=1&e.wrap);e.mode=S;e.last=0;e.havedict=0;e.dmax=32768;e.head=null;e.hold=0;e.bits=0;e.lencode=e.lendyn=new n.Buf32(tt);e.distcode=e.distdyn=new n.Buf32(et);e.sane=1;e.back=-1;return f}function at(t){var e;if(!t||!t.state)return m;(e=t.state).wsize=0;e.whave=0;e.wnext=0;return ot(t)}function st(t,e){var r,n;if(!t||!t.state)return m;n=t.state;if(e<0){r=0;e=-e}else{r=1+(e>>4);e<48&&(e&=15)}if(e&&(e<8||e>15))return m;null!==n.window&&n.wbits!==e&&(n.window=null);n.wrap=r;n.wbits=e;return at(t)}function lt(t,e){var r,n;if(!t)return m;n=new it;t.state=n;n.window=null;(r=st(t,e))!==f&&(t.state=null);return r}var ct,ut,ht=!0;function dt(t){if(ht){var e;ct=new n.Buf32(512);ut=new n.Buf32(32);e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;s(c,t.lens,0,288,ct,0,t.work,{bits:9});e=0;for(;e<32;)t.lens[e++]=5;s(u,t.lens,0,32,ut,0,t.work,{bits:5});ht=!1}t.lencode=ct;t.lenbits=9;t.distcode=ut;t.distbits=5}function pt(t,e,r,i){var o,a=t.state;if(null===a.window){a.wsize=1<<a.wbits;a.wnext=0;a.whave=0;a.window=new n.Buf8(a.wsize)}if(i>=a.wsize){n.arraySet(a.window,e,r-a.wsize,a.wsize,0);a.wnext=0;a.whave=a.wsize}else{(o=a.wsize-a.wnext)>i&&(o=i);n.arraySet(a.window,e,r-i,o,a.wnext);if(i-=o){n.arraySet(a.window,e,r-i,i,0);a.wnext=i;a.whave=a.wsize}else{a.wnext+=o;a.wnext===a.wsize&&(a.wnext=0);a.whave<a.wsize&&(a.whave+=o)}}return 0}r.inflateReset=at;r.inflateReset2=st;r.inflateResetKeep=ot;r.inflateInit=function(t){return lt(t,rt)};r.inflateInit2=lt;r.inflate=function(t,e){var r,tt,et,rt,it,ot,at,st,lt,ct,ut,ht,ft,gt,yt,mt,Ct,vt,Tt,_t,St,Et,wt,bt,Lt=0,At=new n.Buf8(4),xt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return m;(r=t.state).mode===M&&(r.mode=k);it=t.next_out;et=t.output;at=t.avail_out;rt=t.next_in;tt=t.input;ot=t.avail_in;st=r.hold;lt=r.bits;ct=ot;ut=at;Et=f;t:for(;;)switch(r.mode){case S:if(0===r.wrap){r.mode=k;break}for(;lt<16;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(2&r.wrap&&35615===st){r.check=0;At[0]=255&st;At[1]=st>>>8&255;r.check=o(r.check,At,2,0);st=0;lt=0;r.mode=E;break}r.flags=0;r.head&&(r.head.done=!1);if(!(1&r.wrap)||(((255&st)<<8)+(st>>8))%31){t.msg="incorrect header check";r.mode=Z;break}if((15&st)!==_){t.msg="unknown compression method";r.mode=Z;break}lt-=4;St=8+(15&(st>>>=4));if(0===r.wbits)r.wbits=St;else if(St>r.wbits){t.msg="invalid window size";r.mode=Z;break}r.dmax=1<<St;t.adler=r.check=1;r.mode=512&st?R:M;st=0;lt=0;break;case E:for(;lt<16;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.flags=st;if((255&r.flags)!==_){t.msg="unknown compression method";r.mode=Z;break}if(57344&r.flags){t.msg="unknown header flags set";r.mode=Z;break}r.head&&(r.head.text=st>>8&1);if(512&r.flags){At[0]=255&st;At[1]=st>>>8&255;r.check=o(r.check,At,2,0)}st=0;lt=0;r.mode=w;case w:for(;lt<32;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.head&&(r.head.time=st);if(512&r.flags){At[0]=255&st;At[1]=st>>>8&255;At[2]=st>>>16&255;At[3]=st>>>24&255;r.check=o(r.check,At,4,0)}st=0;lt=0;r.mode=b;case b:for(;lt<16;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(r.head){r.head.xflags=255&st;r.head.os=st>>8}if(512&r.flags){At[0]=255&st;At[1]=st>>>8&255;r.check=o(r.check,At,2,0)}st=0;lt=0;r.mode=L;case L:if(1024&r.flags){for(;lt<16;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.length=st;r.head&&(r.head.extra_len=st);if(512&r.flags){At[0]=255&st;At[1]=st>>>8&255;r.check=o(r.check,At,2,0)}st=0;lt=0}else r.head&&(r.head.extra=null);r.mode=A;case A:if(1024&r.flags){(ht=r.length)>ot&&(ht=ot);if(ht){if(r.head){St=r.head.extra_len-r.length;r.head.extra||(r.head.extra=new Array(r.head.extra_len));n.arraySet(r.head.extra,tt,rt,ht,St)}512&r.flags&&(r.check=o(r.check,tt,ht,rt));ot-=ht;rt+=ht;r.length-=ht}if(r.length)break t}r.length=0;r.mode=x;case x:if(2048&r.flags){if(0===ot)break t;ht=0;do{St=tt[rt+ht++];r.head&&St&&r.length<65536&&(r.head.name+=String.fromCharCode(St))}while(St&&ht<ot);512&r.flags&&(r.check=o(r.check,tt,ht,rt));ot-=ht;rt+=ht;if(St)break t}else r.head&&(r.head.name=null);r.length=0;r.mode=P;case P:if(4096&r.flags){if(0===ot)break t;ht=0;do{St=tt[rt+ht++];r.head&&St&&r.length<65536&&(r.head.comment+=String.fromCharCode(St))}while(St&&ht<ot);512&r.flags&&(r.check=o(r.check,tt,ht,rt));ot-=ht;rt+=ht;if(St)break t}else r.head&&(r.head.comment=null);r.mode=I;case I:if(512&r.flags){for(;lt<16;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(st!==(65535&r.check)){t.msg="header crc mismatch";r.mode=Z;break}st=0;lt=0}if(r.head){r.head.hcrc=r.flags>>9&1;r.head.done=!0}t.adler=r.check=0;r.mode=M;break;case R:for(;lt<32;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}t.adler=r.check=nt(st);st=0;lt=0;r.mode=O;case O:if(0===r.havedict){t.next_out=it;t.avail_out=at;t.next_in=rt;t.avail_in=ot;r.hold=st;r.bits=lt;return y}t.adler=r.check=1;r.mode=M;case M:if(e===d||e===p)break t;case k:if(r.last){st>>>=7&lt;lt-=7&lt;r.mode=K;break}for(;lt<3;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.last=1&st;lt-=1;switch(3&(st>>>=1)){case 0:r.mode=N;break;case 1:dt(r);r.mode=j;if(e===p){st>>>=2;lt-=2;break t}break;case 2:r.mode=B;break;case 3:t.msg="invalid block type";r.mode=Z}st>>>=2;lt-=2;break;case N:st>>>=7&lt;lt-=7&lt;for(;lt<32;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if((65535&st)!=(st>>>16^65535)){t.msg="invalid stored block lengths";r.mode=Z;break}r.length=65535&st;st=0;lt=0;r.mode=D;if(e===p)break t;case D:r.mode=F;case F:if(ht=r.length){ht>ot&&(ht=ot);ht>at&&(ht=at);if(0===ht)break t;n.arraySet(et,tt,rt,ht,it);ot-=ht;rt+=ht;at-=ht;it+=ht;r.length-=ht;break}r.mode=M;break;case B:for(;lt<14;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.nlen=257+(31&st);st>>>=5;lt-=5;r.ndist=1+(31&st);st>>>=5;lt-=5;r.ncode=4+(15&st);st>>>=4;lt-=4;if(r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols";r.mode=Z;break}r.have=0;r.mode=G;case G:for(;r.have<r.ncode;){for(;lt<3;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.lens[xt[r.have++]]=7&st;st>>>=3;lt-=3}for(;r.have<19;)r.lens[xt[r.have++]]=0;r.lencode=r.lendyn;r.lenbits=7;wt={bits:r.lenbits};Et=s(l,r.lens,0,19,r.lencode,0,r.work,wt);r.lenbits=wt.bits;if(Et){t.msg="invalid code lengths set";r.mode=Z;break}r.have=0;r.mode=U;case U:for(;r.have<r.nlen+r.ndist;){for(;;){mt=(Lt=r.lencode[st&(1<<r.lenbits)-1])>>>16&255;Ct=65535&Lt;if((yt=Lt>>>24)<=lt)break;if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(Ct<16){st>>>=yt;lt-=yt;r.lens[r.have++]=Ct}else{if(16===Ct){bt=yt+2;for(;lt<bt;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}st>>>=yt;lt-=yt;if(0===r.have){t.msg="invalid bit length repeat";r.mode=Z;break}St=r.lens[r.have-1];ht=3+(3&st);st>>>=2;lt-=2}else if(17===Ct){bt=yt+3;for(;lt<bt;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}lt-=yt;St=0;ht=3+(7&(st>>>=yt));st>>>=3;lt-=3}else{bt=yt+7;for(;lt<bt;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}lt-=yt;St=0;ht=11+(127&(st>>>=yt));st>>>=7;lt-=7}if(r.have+ht>r.nlen+r.ndist){t.msg="invalid bit length repeat";r.mode=Z;break}for(;ht--;)r.lens[r.have++]=St}}if(r.mode===Z)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block";r.mode=Z;break}r.lenbits=9;wt={bits:r.lenbits};Et=s(c,r.lens,0,r.nlen,r.lencode,0,r.work,wt);r.lenbits=wt.bits;if(Et){t.msg="invalid literal/lengths set";r.mode=Z;break}r.distbits=6;r.distcode=r.distdyn;wt={bits:r.distbits};Et=s(u,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,wt);r.distbits=wt.bits;if(Et){t.msg="invalid distances set";r.mode=Z;break}r.mode=j;if(e===p)break t;case j:r.mode=q;case q:if(ot>=6&&at>=258){t.next_out=it;t.avail_out=at;t.next_in=rt;t.avail_in=ot;r.hold=st;r.bits=lt;a(t,ut);it=t.next_out;et=t.output;at=t.avail_out;rt=t.next_in;tt=t.input;ot=t.avail_in;st=r.hold;lt=r.bits;r.mode===M&&(r.back=-1);break}r.back=0;for(;;){mt=(Lt=r.lencode[st&(1<<r.lenbits)-1])>>>16&255;Ct=65535&Lt;if((yt=Lt>>>24)<=lt)break;if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(mt&&0==(240&mt)){vt=yt;Tt=mt;_t=Ct;for(;;){mt=(Lt=r.lencode[_t+((st&(1<<vt+Tt)-1)>>vt)])>>>16&255;Ct=65535&Lt;if(vt+(yt=Lt>>>24)<=lt)break;if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}st>>>=vt;lt-=vt;r.back+=vt}st>>>=yt;lt-=yt;r.back+=yt;r.length=Ct;if(0===mt){r.mode=z;break}if(32&mt){r.back=-1;r.mode=M;break}if(64&mt){t.msg="invalid literal/length code";r.mode=Z;break}r.extra=15&mt;r.mode=W;case W:if(r.extra){bt=r.extra;for(;lt<bt;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.length+=st&(1<<r.extra)-1;st>>>=r.extra;lt-=r.extra;r.back+=r.extra}r.was=r.length;r.mode=H;case H:for(;;){mt=(Lt=r.distcode[st&(1<<r.distbits)-1])>>>16&255;Ct=65535&Lt;if((yt=Lt>>>24)<=lt)break;if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(0==(240&mt)){vt=yt;Tt=mt;_t=Ct;for(;;){mt=(Lt=r.distcode[_t+((st&(1<<vt+Tt)-1)>>vt)])>>>16&255;Ct=65535&Lt;if(vt+(yt=Lt>>>24)<=lt)break;if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}st>>>=vt;lt-=vt;r.back+=vt}st>>>=yt;lt-=yt;r.back+=yt;if(64&mt){t.msg="invalid distance code";r.mode=Z;break}r.offset=Ct;r.extra=15&mt;r.mode=V;case V:if(r.extra){bt=r.extra;for(;lt<bt;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}r.offset+=st&(1<<r.extra)-1;st>>>=r.extra;lt-=r.extra;r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back";r.mode=Z;break}r.mode=Y;case Y:if(0===at)break t;ht=ut-at;if(r.offset>ht){if((ht=r.offset-ht)>r.whave&&r.sane){t.msg="invalid distance too far back";r.mode=Z;break}if(ht>r.wnext){ht-=r.wnext;ft=r.wsize-ht}else ft=r.wnext-ht;ht>r.length&&(ht=r.length);gt=r.window}else{gt=et;ft=it-r.offset;ht=r.length}ht>at&&(ht=at);at-=ht;r.length-=ht;do{et[it++]=gt[ft++]}while(--ht);0===r.length&&(r.mode=q);break;case z:if(0===at)break t;et[it++]=r.length;at--;r.mode=q;break;case K:if(r.wrap){for(;lt<32;){if(0===ot)break t;ot--;st|=tt[rt++]<<lt;lt+=8}ut-=at;t.total_out+=ut;r.total+=ut;ut&&(t.adler=r.check=r.flags?o(r.check,et,ut,it-ut):i(r.check,et,ut,it-ut));ut=at;if((r.flags?st:nt(st))!==r.check){t.msg="incorrect data check";r.mode=Z;break}st=0;lt=0}r.mode=$;case $:if(r.wrap&&r.flags){for(;lt<32;){if(0===ot)break t;ot--;st+=tt[rt++]<<lt;lt+=8}if(st!==(4294967295&r.total)){t.msg="incorrect length check";r.mode=Z;break}st=0;lt=0}r.mode=X;case X:Et=g;break t;case Z:Et=C;break t;case J:return v;case Q:default:return m}t.next_out=it;t.avail_out=at;t.next_in=rt;t.avail_in=ot;r.hold=st;r.bits=lt;if((r.wsize||ut!==t.avail_out&&r.mode<Z&&(r.mode<K||e!==h))&&pt(t,t.output,t.next_out,ut-t.avail_out)){r.mode=J;return v}ct-=t.avail_in;ut-=t.avail_out;t.total_in+=ct;t.total_out+=ut;r.total+=ut;r.wrap&&ut&&(t.adler=r.check=r.flags?o(r.check,et,ut,t.next_out-ut):i(r.check,et,ut,t.next_out-ut));t.data_type=r.bits+(r.last?64:0)+(r.mode===M?128:0)+(r.mode===j||r.mode===D?256:0);(0===ct&&0===ut||e===h)&&Et===f&&(Et=T);return Et};r.inflateEnd=function(t){if(!t||!t.state)return m;var e=t.state;e.window&&(e.window=null);t.state=null;return f};r.inflateGetHeader=function(t,e){var r;if(!t||!t.state)return m;if(0==(2&(r=t.state).wrap))return m;r.head=e;e.done=!1;return f};r.inflateSetDictionary=function(t,e){var r,n=e.length;if(!t||!t.state)return m;if(0!==(r=t.state).wrap&&r.mode!==O)return m;if(r.mode===O&&i(1,e,n,0)!==r.check)return C;if(pt(t,e,n,n)){r.mode=J;return v}r.havedict=1;return f};r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,l,c,u,h,d){var p,f,g,y,m,C,v,T,_,S=d.bits,E=0,w=0,b=0,L=0,A=0,x=0,P=0,I=0,R=0,O=0,M=null,k=0,N=new n.Buf16(16),D=new n.Buf16(16),F=null,B=0;for(E=0;E<=15;E++)N[E]=0;for(w=0;w<l;w++)N[e[r+w]]++;A=S;for(L=15;L>=1&&0===N[L];L--);A>L&&(A=L);if(0===L){c[u++]=20971520;c[u++]=20971520;d.bits=1;return 0}for(b=1;b<L&&0===N[b];b++);A<b&&(A=b);I=1;for(E=1;E<=15;E++){I<<=1;if((I-=N[E])<0)return-1}if(I>0&&(0===t||1!==L))return-1;D[1]=0;for(E=1;E<15;E++)D[E+1]=D[E]+N[E];for(w=0;w<l;w++)0!==e[r+w]&&(h[D[e[r+w]]++]=w);if(0===t){M=F=h;C=19}else if(1===t){M=i;k-=257;F=o;B-=257;C=256}else{M=a;F=s;C=-1}O=0;w=0;E=b;m=u;x=A;P=0;g=-1;y=(R=1<<A)-1;if(1===t&&R>852||2===t&&R>592)return 1;for(;;){v=E-P;if(h[w]<C){T=0;_=h[w]}else if(h[w]>C){T=F[B+h[w]];_=M[k+h[w]]}else{T=96;_=0}p=1<<E-P;b=f=1<<x;do{c[m+(O>>P)+(f-=p)]=v<<24|T<<16|_|0}while(0!==f);p=1<<E-1;for(;O&p;)p>>=1;if(0!==p){O&=p-1;O+=p}else O=0;w++;if(0==--N[E]){if(E===L)break;E=e[r+h[w]]}if(E>A&&(O&y)!==g){0===P&&(P=A);m+=b;I=1<<(x=E-P);for(;x+P<L&&!((I-=N[x+P])<=0);){x++;I<<=1}R+=1<<x;if(1===t&&R>852||2===t&&R>592)return 1;c[g=O&y]=A<<24|x<<16|m-u|0}}0!==O&&(c[m+O]=E-P<<24|64<<16|0);d.bits=A;return 0}},{"../utils/common":41}],51:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,r){"use strict";var n=t("../utils/common"),i=4,o=0,a=1,s=2;function l(t){for(var e=t.length;--e>=0;)t[e]=0}var c=0,u=1,h=2,d=29,p=256,f=p+1+d,g=30,y=19,m=2*f+1,C=15,v=16,T=7,_=256,S=16,E=17,w=18,b=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(f+2));l(P);var I=new Array(2*g);l(I);var R=new Array(512);l(R);var O=new Array(256);l(O);var M=new Array(d);l(M);var k,N,D,F=new Array(g);l(F);function B(t,e,r,n,i){this.static_tree=t;this.extra_bits=e;this.extra_base=r;this.elems=n;this.max_length=i;this.has_stree=t&&t.length}function G(t,e){this.dyn_tree=t;this.max_code=0;this.stat_desc=e}function U(t){return t<256?R[t]:R[256+(t>>>7)]}function j(t,e){t.pending_buf[t.pending++]=255&e;t.pending_buf[t.pending++]=e>>>8&255}function q(t,e,r){if(t.bi_valid>v-r){t.bi_buf|=e<<t.bi_valid&65535;j(t,t.bi_buf);t.bi_buf=e>>v-t.bi_valid;t.bi_valid+=r-v}else{t.bi_buf|=e<<t.bi_valid&65535;t.bi_valid+=r}}function W(t,e,r){q(t,r[2*e],r[2*e+1])}function H(t,e){var r=0;do{r|=1&t;t>>>=1;r<<=1}while(--e>0);return r>>>1}function V(t,e,r){var n,i,o=new Array(C+1),a=0;for(n=1;n<=C;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=H(o[s]++,s))}}function Y(t){var e;for(e=0;e<f;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<y;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*_]=1;t.opt_len=t.static_len=0;t.last_lit=t.matches=0}function z(t){t.bi_valid>8?j(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf);t.bi_buf=0;t.bi_valid=0}function K(t,e,r,n){var i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]}function $(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len;){i<t.heap_len&&K(e,t.heap[i+1],t.heap[i],t.depth)&&i++;if(K(e,n,t.heap[i],t.depth))break;t.heap[r]=t.heap[i];r=i;i<<=1}t.heap[r]=n}function X(t,e,r){var n,i,o,a,s=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1];i=t.pending_buf[t.l_buf+s];s++;if(0===n)W(t,i,e);else{W(t,(o=O[i])+p+1,e);0!==(a=b[o])&&q(t,i-=M[o],a);W(t,o=U(--n),r);0!==(a=L[o])&&q(t,n-=F[o],a)}}while(s<t.last_lit);W(t,_,e)}function Z(t,e){var r,n,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;t.heap_len=0;t.heap_max=m;for(r=0;r<l;r++)if(0!==o[2*r]){t.heap[++t.heap_len]=c=r;t.depth[r]=0}else o[2*r+1]=0;for(;t.heap_len<2;){o[2*(i=t.heap[++t.heap_len]=c<2?++c:0)]=1;t.depth[i]=0;t.opt_len--;s&&(t.static_len-=a[2*i+1])}e.max_code=c;for(r=t.heap_len>>1;r>=1;r--)$(t,o,r);i=l;do{r=t.heap[1];t.heap[1]=t.heap[t.heap_len--];$(t,o,1);n=t.heap[1];t.heap[--t.heap_max]=r;t.heap[--t.heap_max]=n;o[2*i]=o[2*r]+o[2*n];t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1;o[2*r+1]=o[2*n+1]=i;t.heap[1]=i++;$(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1];!function(t,e){var r,n,i,o,a,s,l=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,f=e.stat_desc.max_length,g=0;for(o=0;o<=C;o++)t.bl_count[o]=0;l[2*t.heap[t.heap_max]+1]=0;for(r=t.heap_max+1;r<m;r++){if((o=l[2*l[2*(n=t.heap[r])+1]+1]+1)>f){o=f;g++}l[2*n+1]=o;if(!(n>c)){t.bl_count[o]++;a=0;n>=p&&(a=d[n-p]);s=l[2*n];t.opt_len+=s*(o+a);h&&(t.static_len+=s*(u[2*n+1]+a))}}if(0!==g){do{o=f-1;for(;0===t.bl_count[o];)o--;t.bl_count[o]--;t.bl_count[o+1]+=2;t.bl_count[f]--;g-=2}while(g>0);for(o=f;0!==o;o--){n=t.bl_count[o];for(;0!==n;)if(!((i=t.heap[--r])>c)){if(l[2*i+1]!==o){t.opt_len+=(o-l[2*i+1])*l[2*i];l[2*i+1]=o}n--}}}}(t,e);V(o,c,t.bl_count)}function J(t,e,r){var n,i,o=-1,a=e[1],s=0,l=7,c=4;if(0===a){l=138;c=3}e[2*(r+1)+1]=65535;for(n=0;n<=r;n++){i=a;a=e[2*(n+1)+1];if(!(++s<l&&i===a)){if(s<c)t.bl_tree[2*i]+=s;else if(0!==i){i!==o&&t.bl_tree[2*i]++;t.bl_tree[2*S]++}else s<=10?t.bl_tree[2*E]++:t.bl_tree[2*w]++;s=0;o=i;if(0===a){l=138;c=3}else if(i===a){l=6;c=3}else{l=7;c=4}}}}function Q(t,e,r){var n,i,o=-1,a=e[1],s=0,l=7,c=4;if(0===a){l=138;c=3}for(n=0;n<=r;n++){i=a;a=e[2*(n+1)+1];if(!(++s<l&&i===a)){if(s<c)do{W(t,i,t.bl_tree)}while(0!=--s);else if(0!==i){if(i!==o){W(t,i,t.bl_tree);s--}W(t,S,t.bl_tree);q(t,s-3,2)}else if(s<=10){W(t,E,t.bl_tree);q(t,s-3,3)}else{W(t,w,t.bl_tree);q(t,s-11,7)}s=0;o=i;if(0===a){l=138;c=3}else if(i===a){l=6;c=3}else{l=7;c=4}}}}var tt=!1;function et(t,e,r,i){q(t,(c<<1)+(i?1:0),3);!function(t,e,r,i){z(t);if(i){j(t,r);j(t,~r)}n.arraySet(t.pending_buf,t.window,e,r,t.pending);t.pending+=r}(t,e,r,!0)}r._tr_init=function(t){if(!tt){!function(){var t,e,r,n,i,o=new Array(C+1);r=0;for(n=0;n<d-1;n++){M[n]=r;for(t=0;t<1<<b[n];t++)O[r++]=n}O[r-1]=n;i=0;for(n=0;n<16;n++){F[n]=i;for(t=0;t<1<<L[n];t++)R[i++]=n}i>>=7;for(;n<g;n++){F[n]=i<<7;for(t=0;t<1<<L[n]-7;t++)R[256+i++]=n}for(e=0;e<=C;e++)o[e]=0;t=0;for(;t<=143;){P[2*t+1]=8;t++;o[8]++}for(;t<=255;){P[2*t+1]=9;t++;o[9]++}for(;t<=279;){P[2*t+1]=7;t++;o[7]++}for(;t<=287;){P[2*t+1]=8;t++;o[8]++}V(P,f+1,o);for(t=0;t<g;t++){I[2*t+1]=5;I[2*t]=H(t,5)}k=new B(P,b,p+1,f,C);N=new B(I,L,0,g,C);D=new B(new Array(0),A,0,y,T)}();tt=!0}t.l_desc=new G(t.dyn_ltree,k);t.d_desc=new G(t.dyn_dtree,N);t.bl_desc=new G(t.bl_tree,D);t.bi_buf=0;t.bi_valid=0;Y(t)};r._tr_stored_block=et;r._tr_flush_block=function(t,e,r,n){var l,c,d=0;if(t.level>0){t.strm.data_type===s&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<p;e++)if(0!==t.dyn_ltree[2*e])return a;return o}(t));Z(t,t.l_desc);Z(t,t.d_desc);d=function(t){var e;J(t,t.dyn_ltree,t.l_desc.max_code);J(t,t.dyn_dtree,t.d_desc.max_code);Z(t,t.bl_desc);for(e=y-1;e>=3&&0===t.bl_tree[2*x[e]+1];e--);t.opt_len+=3*(e+1)+5+5+4;return e}(t);l=t.opt_len+3+7>>>3;(c=t.static_len+3+7>>>3)<=l&&(l=c)}else l=c=r+5;if(r+4<=l&&-1!==e)et(t,e,r,n);else if(t.strategy===i||c===l){q(t,(u<<1)+(n?1:0),3);X(t,P,I)}else{q(t,(h<<1)+(n?1:0),3);!function(t,e,r,n){var i;q(t,e-257,5);q(t,r-1,5);q(t,n-4,4);for(i=0;i<n;i++)q(t,t.bl_tree[2*x[i]+1],3);Q(t,t.dyn_ltree,e-1);Q(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1);X(t,t.dyn_ltree,t.dyn_dtree)}Y(t);n&&z(t)};r._tr_tally=function(t,e,r){t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255;t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e;t.pending_buf[t.l_buf+t.last_lit]=255&r;t.last_lit++;if(0===e)t.dyn_ltree[2*r]++;else{t.matches++;e--;t.dyn_ltree[2*(O[r]+p+1)]++;t.dyn_dtree[2*U(e)]++}return t.last_lit===t.lit_bufsize-1};r._tr_align=function(t){q(t,u<<1,3);W(t,_,P);!function(t){if(16===t.bi_valid){j(t,t.bi_buf);t.bi_buf=0;t.bi_valid=0}else if(t.bi_valid>=8){t.pending_buf[t.pending++]=255&t.bi_buf;t.bi_buf>>=8;t.bi_valid-=8}}(t)}},{"../utils/common":41}],53:[function(t,e,r){"use strict";e.exports=function(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}],54:[function(t,e,r){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0);setTimeout.apply(null,t)}},{}]},{},[10])(10)});var ol=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";t.exports=i,t.exports.default=i;var n=r(4);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,n,i){i||(i=g(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],l(i,t.leaf?n(o):o);return i}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,r,i,o){for(var a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,n(t,a,e,r,o),s.push(e,a,a,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!f(t,e))return r;for(var i,o,a,s,l=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],f(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):p(t,s)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!f(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],f(t,a=e.leaf?r(o):o)){if(e.leaf||p(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,a,s=this.data,l=this.toBBox(t),c=[],u=[];s||c.length;){if(s||(s=c.pop(),n=c[c.length-1],r=u.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),c.push(s),this._condense(c),this;a||s.leaf||!p(s,l)?n?(r++,s=n.children[r],a=!1):s=null:(c.push(s),u.push(r),r=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return a(i=g(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=g([])).leaf=!1,i.height=n;var l,c,u,h,d=Math.ceil(o/s),p=d*Math.ceil(Math.sqrt(s));for(y(t,e,r,p,this.compareMinX),l=e;l<=r;l+=p)for(y(t,l,u=Math.min(l+p-1,r),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),i.children.push(this._build(t,c,h,n-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,l,c,u,d,p,f;n.push(e),!e.leaf&&n.length-1!==r;){for(u=d=1/0,i=0,o=e.children.length;i<o;i++)l=h(a=e.children[i]),p=t,f=a,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=c,u=l<u?l:u,s=a):c===d&&l<u&&(u=l,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),l(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=g(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,l,c,u,d,p,f,g,y,m,C;for(c=u=1/0,n=e;n<=r-e;n++)p=i=s(t,0,n,this.toBBox),f=o=s(t,n,r,this.toBBox),void 0,void 0,void 0,void 0,g=Math.max(p.minX,f.minX),y=Math.max(p.minY,f.minY),m=Math.min(p.maxX,f.maxX),C=Math.min(p.maxY,f.maxY),a=Math.max(0,m-g)*Math.max(0,C-y),l=h(i)+h(o),a<c?(c=a,d=n,u=l<u?l:u):a===c&&l<u&&(u=l,d=n);return d},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:c,i=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,c=s(t,0,e,a),u=s(t,r-e,r,a),h=d(c)+d(u);for(i=e;i<r-e;i++)o=t.children[i],l(c,t.leaf?a(o):o),h+=d(c);for(i=r-e-1;i>=e;i--)o=t.children[i],l(u,t.leaf?a(o):o),h+=d(u);return h},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)l(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},,,,function(t,e,r){t.exports=function(){"use strict";function t(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(r,n,i,o,a){!function e(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=n-i+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-l*u/s+h)),Math.min(o,Math.floor(n+(s-l)*u/s+h)),a)}var d=r[n],p=i,f=o;for(t(r,i,n),a(r[o],d)>0&&t(r,i,o);p<f;){for(t(r,p,f),p++,f--;a(r[p],d)<0;)p++;for(;a(r[f],d)>0;)f--}0===a(r[i],d)?t(r,i,f):t(r,++f,o),f<=n&&(i=f+1),n<=f&&(o=f-1)}}(r,n,i||0,o||r.length-1,a||e)}}()},function(t,e,r){"use strict";function n(){return function(){throw new Error("Unimplemented abstract method.")}()}r.r(e);var i=0;function o(t){return t.ol_uid||(t.ol_uid=String(++i))}var a="5.3.3",s=function(t){function e(e){var r="Assertion failed. See https://openlayers.org/en/"+("latest"===a?a:"v"+a.split("-")[0])+"/doc/errors/#"+e+" for details.";t.call(this,r),this.code=e,this.name="AssertionError",this.message=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),l={ADD:"add",REMOVE:"remove"},c="propertychange",u="function"==typeof Object.assign?Object.assign:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1,o=arguments.length;i<o;++i){var a=r[i];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])}return n};function h(t){for(var e in t)delete t[e]}function d(t){var e=[];for(var r in t)e.push(t[r]);return e}function p(t){var e;for(e in t)return!1;return!e}function f(t,e,r,n){for(var i,o=0,a=t.length;o<a;++o)if((i=t[o]).listener===e&&i.bindTo===r)return n&&(i.deleteIndex=o),i}function g(t,e){var r=y(t);return r?r[e]:void 0}function y(t,e){var r=t.ol_lm;return!r&&e&&(r=t.ol_lm={}),r}function m(t,e){var r=g(t,e);if(r){for(var n=0,i=r.length;n<i;++n)t.removeEventListener(e,r[n].boundListener),h(r[n]);r.length=0;var o=y(t);o&&(delete o[e],0===Object.keys(o).length&&function(t){delete t.ol_lm}(t))}}function C(t,e,r,n,i){var o=y(t,!0),a=o[e];a||(a=o[e]=[]);var s=f(a,r,n,!1);return s?i||(s.callOnce=!1):(s={bindTo:n,callOnce:!!i,listener:r,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&_(t),r.call(n,e)};return t.boundListener=e,e}(s)),a.push(s)),s}function v(t,e,r,n){return C(t,e,r,n,!0)}function T(t,e,r,n){var i=g(t,e);if(i){var o=f(i,r,n,!0);o&&_(o)}}function _(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=g(t.target,t.type);if(e){var r="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==r&&e.splice(r,1),0===e.length&&m(t.target,t.type)}h(t)}}var S=function(){this.disposed_=!1};S.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},S.prototype.disposeInternal=function(){};var E=S;function w(){return!0}function b(){return!1}function L(){}var A=function(t){this.propagationStopped,this.type=t,this.target=null};function x(t){t.stopPropagation()}A.prototype.preventDefault=function(){this.propagationStopped=!0},A.prototype.stopPropagation=function(){this.propagationStopped=!0};var P=A,I=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new P(t):t,r=e.type;e.target=this;var n,i=this.listeners_[r];if(i){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var o=0,a=i.length;o<a;++o)if(!1===i[o].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,L);delete this.dispatching_[r]}return n}},e.prototype.disposeInternal=function(){!function(t){var e=y(t);if(e)for(var r in e)m(t,r)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var r=this.listeners_[t];if(r){var n=r.indexOf(e);t in this.pendingRemovals_?(r[n]=L,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t])}},e}(E),R={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},O=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(R.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=C(this,t[i],e);return n}return C(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=v(this,t[i],e);return n}return v(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)T(this,t[r],e);else T(this,t,e)},e}(I),M=function(t){function e(e,r,n){t.call(this,e),this.key=r,this.oldValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),k={};function N(t){return k.hasOwnProperty(t)?k[t]:k[t]="change:"+t}var D=function(t){function e(e){t.call(this),o(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return u({},this.values_)},e.prototype.notify=function(t,e){var r;r=N(t),this.dispatchEvent(new M(r,t,e)),r=c,this.dispatchEvent(new M(r,t,e))},e.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e}(O),F="length",B=function(t){function e(e,r){t.call(this,e),this.element=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),G=function(t){function e(e,r){t.call(this);var n=r||{};if(this.unique_=!!n.unique,this.array_=e||[],this.unique_)for(var i=0,o=this.array_.length;i<o;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,r=t.length;e<r;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)t(e[r],r,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(F)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new B(l.ADD,e))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new B(l.REMOVE,e)),e},e.prototype.setAt=function(t,e){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new B(l.REMOVE,n)),this.dispatchEvent(new B(l.ADD,e))}else{for(var i=r;i<t;++i)this.insertAt(i,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(F,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new s(58)},e}(D),U=function(t){function e(e,r,n){t.call(this,e),this.map=r,this.frameState=void 0!==n?n:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),j=function(t){function e(e,r,n,i,o){t.call(this,e,r,o),this.originalEvent=n,this.pixel=r.getEventPixel(n),this.coordinate=r.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==i&&i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(U),q="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",W=-1!==q.indexOf("firefox"),H=-1!==q.indexOf("safari")&&-1==q.indexOf("chrom"),V=-1!==q.indexOf("webkit")&&-1==q.indexOf("edge"),Y=-1!==q.indexOf("macintosh"),z=window.devicePixelRatio||1,K=function(){var t=!1;try{t=!!document.createElement("canvas").getContext("2d").setLineDash}catch(t){}return t}(),$=(navigator,"ontouchstart"in window),X="PointerEvent"in window,Z=!!navigator.msPointerEnabled,J={SINGLECLICK:"singleclick",CLICK:R.CLICK,DBLCLICK:R.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Q=function(t){function e(e,r,n,i,o){t.call(this,e,r,n.originalEvent,i,o),this.pointerEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(j),tt={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},et=function(t,e){this.dispatcher=t,this.mapping_=e};et.prototype.getEvents=function(){return Object.keys(this.mapping_)},et.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var rt=et,nt=1,it="mouse";function ot(t){if(!this.isEventSimulatedFromTouch_(t)){nt.toString()in this.pointerMap&&this.cancel(t);var e=ut(t,this.dispatcher);this.pointerMap[nt.toString()]=t,this.dispatcher.down(e,t)}}function at(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.move(e,t)}}function st(t){if(!this.isEventSimulatedFromTouch_(t)){var e=this.pointerMap[nt.toString()];if(e&&e.button===t.button){var r=ut(t,this.dispatcher);this.dispatcher.up(r,t),this.cleanupMouse()}}}function lt(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.enterOver(e,t)}}function ct(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}}function ut(t,e){var r=e.cloneEvent(t,t),n=r.preventDefault;return r.preventDefault=function(){t.preventDefault(),n()},r.pointerId=nt,r.isPrimary=!0,r.pointerType=it,r}var ht=function(t){function e(e){var r={mousedown:ot,mousemove:at,mouseup:st,mouseover:lt,mouseout:ct};t.call(this,e,r),this.pointerMap=e.pointerMap,this.lastTouches=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isEventSimulatedFromTouch_=function(t){for(var e=this.lastTouches,r=t.clientX,n=t.clientY,i=0,o=e.length,a=void 0;i<o&&(a=e[i]);i++){var s=Math.abs(r-a[0]),l=Math.abs(n-a[1]);if(s<=25&&l<=25)return!0}return!1},e.prototype.cancel=function(t){var e=ut(t,this.dispatcher);this.dispatcher.cancel(e,t),this.cleanupMouse()},e.prototype.cleanupMouse=function(){delete this.pointerMap[nt.toString()]},e}(rt),dt=["","unavailable","touch","pen","mouse"];function pt(t){this.pointerMap[t.pointerId.toString()]=t;var e=this.prepareEvent_(t);this.dispatcher.down(e,t)}function ft(t){var e=this.prepareEvent_(t);this.dispatcher.move(e,t)}function gt(t){var e=this.prepareEvent_(t);this.dispatcher.up(e,t),this.cleanup(t.pointerId)}function yt(t){var e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)}function mt(t){var e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)}function Ct(t){var e=this.prepareEvent_(t);this.dispatcher.cancel(e,t),this.cleanup(t.pointerId)}function vt(t){var e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)}function Tt(t){var e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)}var _t=function(t){function e(e){var r={MSPointerDown:pt,MSPointerMove:ft,MSPointerUp:gt,MSPointerOut:yt,MSPointerOver:mt,MSPointerCancel:Ct,MSGotPointerCapture:Tt,MSLostPointerCapture:vt};t.call(this,e,r),this.pointerMap=e.pointerMap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvent_=function(t){var e=t;return"number"==typeof t.pointerType&&((e=this.dispatcher.cloneEvent(t,t)).pointerType=dt[t.pointerType]),e},e.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]},e}(rt);function St(t){this.dispatcher.fireNativeEvent(t)}function Et(t){this.dispatcher.fireNativeEvent(t)}function wt(t){this.dispatcher.fireNativeEvent(t)}function bt(t){this.dispatcher.fireNativeEvent(t)}function Lt(t){this.dispatcher.fireNativeEvent(t)}function At(t){this.dispatcher.fireNativeEvent(t)}function xt(t){this.dispatcher.fireNativeEvent(t)}function Pt(t){this.dispatcher.fireNativeEvent(t)}var It=function(t){function e(e){var r={pointerdown:St,pointermove:Et,pointerup:wt,pointerout:bt,pointerover:Lt,pointercancel:At,gotpointercapture:Pt,lostpointercapture:xt};t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(rt),Rt=!1,Ot=function(t){function e(e,r,n){t.call(this,e),this.originalEvent=r;var i=n||{};this.buttons=function(t){var e;if(t.buttons||Rt)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e}(i),this.pressure=function(t,e){return t.pressure?t.pressure:e?.5:0}(i,this.buttons),this.bubbles="bubbles"in i&&i.bubbles,this.cancelable="cancelable"in i&&i.cancelable,this.view="view"in i?i.view:null,this.detail="detail"in i?i.detail:null,this.screenX="screenX"in i?i.screenX:0,this.screenY="screenY"in i?i.screenY:0,this.clientX="clientX"in i?i.clientX:0,this.clientY="clientY"in i?i.clientY:0,this.ctrlKey="ctrlKey"in i&&i.ctrlKey,this.altKey="altKey"in i&&i.altKey,this.shiftKey="shiftKey"in i&&i.shiftKey,this.metaKey="metaKey"in i&&i.metaKey,this.button="button"in i?i.button:0,this.relatedTarget="relatedTarget"in i?i.relatedTarget:null,this.pointerId="pointerId"in i?i.pointerId:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.tiltX="tiltX"in i?i.tiltX:0,this.tiltY="tiltY"in i?i.tiltY:0,this.pointerType="pointerType"in i?i.pointerType:"",this.hwTimestamp="hwTimestamp"in i?i.hwTimestamp:0,this.isPrimary="isPrimary"in i&&i.isPrimary,r.preventDefault&&(this.preventDefault=function(){r.preventDefault()})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);!function(){try{var t=new MouseEvent("click",{buttons:1});Rt=1===t.buttons}catch(t){}}();var Mt=Ot;function kt(t,e){return t>e?1:t<e?-1:0}function Nt(t,e){return t.indexOf(e)>=0}function Dt(t,e,r){var n,i=t.length;if(t[0]<=e)return 0;if(e<=t[i-1])return i-1;if(r>0){for(n=1;n<i;++n)if(t[n]<e)return n-1}else if(r<0){for(n=1;n<i;++n)if(t[n]<=e)return n}else for(n=1;n<i;++n){if(t[n]==e)return n;if(t[n]<e)return t[n-1]-e<e-t[n]?n-1:n}return i-1}function Ft(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}}function Bt(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]}function Gt(t,e){for(var r,n=t.length>>>0,i=0;i<n;i++)if(e(r=t[i],i,t))return r;return null}function Ut(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function jt(t,e){var r;return t.every(function(n,i){return r=i,!e(n,i,t)})?-1:r}function qt(t){this.vacuumTouches_(t),this.setPrimaryTouch_(t.changedTouches[0]),this.dedupSynthMouse_(t),this.clickCount_++,this.processTouches_(t,this.overDown_)}function Wt(t){this.processTouches_(t,this.moveOverOut_)}function Ht(t){this.dedupSynthMouse_(t),this.processTouches_(t,this.upOut_)}function Vt(t){this.processTouches_(t,this.cancelOut_)}var Yt=function(t){function e(e,r){var n={touchstart:qt,touchmove:Wt,touchend:Ht,touchcancel:Vt};t.call(this,e,n),this.pointerMap=e.pointerMap,this.mouseSource=r,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier},e.prototype.setPrimaryTouch_=function(t){var e=Object.keys(this.pointerMap).length;(0===e||1===e&&nt.toString()in this.pointerMap)&&(this.firstTouchId_=t.identifier,this.cancelResetClickCount_())},e.prototype.removePrimaryPointer_=function(t){t.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},e.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)},e.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},e.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)},e.prototype.touchToPointer_=function(t,e){var r=this.dispatcher.cloneEvent(t,e);return r.pointerId=e.identifier+2,r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount_,r.button=0,r.buttons=1,r.width=e.radiusX||0,r.height=e.radiusY||0,r.pressure=e.force||.5,r.isPrimary=this.isPrimaryTouch_(e),r.pointerType="touch",r.clientX=e.clientX,r.clientY=e.clientY,r.screenX=e.screenX,r.screenY=e.screenY,r},e.prototype.processTouches_=function(t,e){var r=Array.prototype.slice.call(t.changedTouches),n=r.length;function i(){t.preventDefault()}for(var o=0;o<n;++o){var a=this.touchToPointer_(t,r[o]);a.preventDefault=i,e.call(this,t,a)}},e.prototype.findTouch_=function(t,e){for(var r=t.length,n=0;n<r;n++)if(t[n].identifier===e)return!0;return!1},e.prototype.vacuumTouches_=function(t){var e=t.touches,r=Object.keys(this.pointerMap),n=r.length;if(n>=e.length){for(var i=[],o=0;o<n;++o){var a=Number(r[o]),s=this.pointerMap[a];a==nt||this.findTouch_(e,a-2)||i.push(s.out)}for(var l=0;l<i.length;++l)this.cancelOut_(t,i[l])}},e.prototype.overDown_=function(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target},this.dispatcher.over(e,t),this.dispatcher.enter(e,t),this.dispatcher.down(e,t)},e.prototype.moveOverOut_=function(t,e){var r=e,n=this.pointerMap[r.pointerId];if(n){var i=n.out,o=n.outTarget;this.dispatcher.move(r,t),i&&o!==r.target&&(i.relatedTarget=r.target,r.relatedTarget=o,i.target=o,r.target?(this.dispatcher.leaveOut(i,t),this.dispatcher.enterOver(r,t)):(r.target=o,r.relatedTarget=null,this.cancelOut_(t,r))),n.out=r,n.outTarget=r.target}},e.prototype.upOut_=function(t,e){this.dispatcher.up(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},e.prototype.cancelOut_=function(t,e){this.dispatcher.cancel(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},e.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId],this.removePrimaryPointer_(t)},e.prototype.dedupSynthMouse_=function(t){var e=this.mouseSource.lastTouches,r=t.changedTouches[0];if(this.isPrimaryTouch_(r)){var n=[r.clientX,r.clientY];e.push(n),setTimeout(function(){var t,r,i;r=n,(i=(t=e).indexOf(r))>-1&&t.splice(i,1)},this.dedupTimeout_)}},e}(rt),zt=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],Kt=function(t){function e(e){t.call(this),this.element_=e,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.registerSources=function(){if(X)this.registerSource("native",new It(this));else if(Z)this.registerSource("ms",new _t(this));else{var t=new ht(this);this.registerSource("mouse",t),$&&this.registerSource("touch",new Yt(this,t))}this.register_()},e.prototype.registerSource=function(t,e){var r=e,n=r.getEvents();n&&(n.forEach(function(t){var e=r.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(r))}.bind(this)),this.eventSourceList_.push(r))},e.prototype.register_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var r=this.eventSourceList_[e];this.addEvents_(r.getEvents())}},e.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var r=this.eventSourceList_[e];this.removeEvents_(r.getEvents())}},e.prototype.eventHandler_=function(t){var e=t.type,r=this.eventMap_[e];r&&r(t)},e.prototype.addEvents_=function(t){t.forEach(function(t){C(this.element_,t,this.eventHandler_,this)}.bind(this))},e.prototype.removeEvents_=function(t){t.forEach(function(t){T(this.element_,t,this.eventHandler_,this)}.bind(this))},e.prototype.cloneEvent=function(t,e){for(var r={},n=0,i=zt.length;n<i;n++){var o=zt[n][0];r[o]=t[o]||e[o]||zt[n][1]}return r},e.prototype.down=function(t,e){this.fireEvent(tt.POINTERDOWN,t,e)},e.prototype.move=function(t,e){this.fireEvent(tt.POINTERMOVE,t,e)},e.prototype.up=function(t,e){this.fireEvent(tt.POINTERUP,t,e)},e.prototype.enter=function(t,e){t.bubbles=!1,this.fireEvent(tt.POINTERENTER,t,e)},e.prototype.leave=function(t,e){t.bubbles=!1,this.fireEvent(tt.POINTERLEAVE,t,e)},e.prototype.over=function(t,e){t.bubbles=!0,this.fireEvent(tt.POINTEROVER,t,e)},e.prototype.out=function(t,e){t.bubbles=!0,this.fireEvent(tt.POINTEROUT,t,e)},e.prototype.cancel=function(t,e){this.fireEvent(tt.POINTERCANCEL,t,e)},e.prototype.leaveOut=function(t,e){this.out(t,e),this.contains_(t.target,t.relatedTarget)||this.leave(t,e)},e.prototype.enterOver=function(t,e){this.over(t,e),this.contains_(t.target,t.relatedTarget)||this.enter(t,e)},e.prototype.contains_=function(t,e){return!(!t||!e)&&t.contains(e)},e.prototype.makeEvent=function(t,e,r){return new Mt(t,r,e)},e.prototype.fireEvent=function(t,e,r){var n=this.makeEvent(t,e,r);this.dispatchEvent(n)},e.prototype.fireNativeEvent=function(t){var e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)},e.prototype.wrapMouseEvent=function(t,e){return this.makeEvent(t,ut(e,this),e)},e.prototype.disposeInternal=function(){this.unregister_(),t.prototype.disposeInternal.call(this)},e}(I),$t=function(t){function e(e,r){t.call(this),this.map_=e,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=r?r*z:z,this.down_=null;var n=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Kt(n),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=C(this.pointerEventHandler_,tt.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=C(this.pointerEventHandler_,tt.POINTERMOVE,this.relayEvent_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.emulateClick_=function(t){var e=new Q(J.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Q(J.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new Q(J.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t;e.type==J.POINTERUP||e.type==J.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==J.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new Q(J.POINTERUP,this.map_,t);this.dispatchEvent(e),e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new Q(J.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_=t,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new Kt(document),this.dragListenerKeys_.push(C(this.documentPointerEventHandler_,J.POINTERMOVE,this.handlePointerMove_,this),C(this.documentPointerEventHandler_,J.POINTERUP,this.handlePointerUp_,this),C(this.pointerEventHandler_,J.POINTERCANCEL,this.handlePointerUp_,this)))},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new Q(J.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()},e.prototype.relayEvent_=function(t){var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Q(t.type,this.map_,t,e))},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(_(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(_(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),t.prototype.disposeInternal.call(this)},e}(I),Xt={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Zt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Jt={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render",RENDERCOMPLETE:"rendercomplete"},Qt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function te(t,e){if(!t)throw new s(e)}var ee=function(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}};ee.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,h(this.queuedElements_)},ee.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,r=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},ee.prototype.enqueue=function(t){te(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=1/0&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},ee.prototype.getCount=function(){return this.elements_.length},ee.prototype.getLeftChildIndex_=function(t){return 2*t+1},ee.prototype.getRightChildIndex_=function(t){return 2*t+2},ee.prototype.getParentIndex_=function(t){return t-1>>1},ee.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},ee.prototype.isEmpty=function(){return 0===this.elements_.length},ee.prototype.isKeyQueued=function(t){return t in this.queuedElements_},ee.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},ee.prototype.siftUp_=function(t){for(var e=this.elements_,r=this.priorities_,n=e.length,i=e[t],o=r[t],a=t;t<n>>1;){var s=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),c=l<n&&r[l]<r[s]?l:s;e[t]=e[c],r[t]=r[c],t=c}e[t]=i,r[t]=o,this.siftDown_(a,t)},ee.prototype.siftDown_=function(t,e){for(var r=this.elements_,n=this.priorities_,i=r[e],o=n[e];e>t;){var a=this.getParentIndex_(e);if(!(n[a]>o))break;r[e]=r[a],n[e]=n[a],e=a}r[e]=i,n[e]=o},ee.prototype.reprioritize=function(){var t,e,r,n=this.priorityFunction_,i=this.elements_,o=this.priorities_,a=0,s=i.length;for(e=0;e<s;++e)(r=n(t=i[e]))==1/0?delete this.queuedElements_[this.keyFunction_(t)]:(o[a]=r,i[a++]=t);i.length=a,o.length=a,this.heapify_()};var re=function(t){function e(e,r){t.call(this,function(t){return e.apply(null,t)},function(t){return t[0].getKey()}),this.tileChangeCallback_=r,this.tilesLoading_=0,this.tilesLoadingKeys_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.enqueue=function(e){var r=t.prototype.enqueue.call(this,e);r&&C(e[0],R.CHANGE,this.handleTileChange,this);return r},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,r=e.getState();if(r===Qt.LOADED||r===Qt.ERROR||r===Qt.EMPTY||r===Qt.ABORT){T(e,R.CHANGE,this.handleTileChange,this);var n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var r,n,i,o=0,a=!1;this.tilesLoading_<t&&o<e&&this.getCount()>0;)i=(n=this.dequeue()[0]).getKey(),(r=n.getState())===Qt.ABORT?a=!0:r!==Qt.IDLE||i in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[i]=!0,++this.tilesLoading_,++o,n.load());0===o&&a&&this.tileChangeCallback_()},e}(ee),ne=42,ie=256;function oe(t,e,r){return Math.min(Math.max(t,e),r)}var ae="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function se(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return le(t,e,r,n)}function le(t,e,r,n){var i=r-t,o=n-e;return i*i+o*o}function ce(t){return t*Math.PI/180}function ue(t,e){var r=t%e;return r*e<0?r+e:r}function he(t,e,r){return t+r*(e-t)}function de(t){return t}function pe(t,e){return void 0!==t?0:void 0}function fe(t,e){return void 0!==t?t+e:void 0}var ge="center",ye="resolution",me="rotation";function Ce(t,e,r){var n=void 0!==r?t.toFixed(r):""+t,i=n.indexOf(".");return(i=-1===i?n.length:i)>e?n:new Array(1+e-i).join("0")+n}function ve(t,e){return t[0]+=e[0],t[1]+=e[1],t}function Te(t,e){var r,n,i=t[0],o=t[1],a=e[0],s=e[1],l=a[0],c=a[1],u=s[0],h=s[1],d=u-l,p=h-c,f=0===d&&0===p?0:(d*(i-l)+p*(o-c))/(d*d+p*p||0);return f<=0?(r=l,n=c):f>=1?(r=u,n=h):(r=l+f*d,n=c+f*p),[r,n]}function _e(t,e){for(var r=!0,n=t.length-1;n>=0;--n)if(t[n]!=e[n]){r=!1;break}return r}function Se(t,e){var r=Math.cos(e),n=Math.sin(e),i=t[0]*r-t[1]*n,o=t[1]*r+t[0]*n;return t[0]=i,t[1]=o,t}function Ee(t,e){return t[0]*=e,t[1]*=e,t}function we(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function be(t,e){return Math.sqrt(we(t,e))}function Le(t,e){return we(t,Te(t,e))}function Ae(t){return Math.pow(t,3)}function xe(t){return 1-Ae(1-t)}function Pe(t){return 3*t*t-2*t*t*t}function Ie(t){return t}var Re={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Oe={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Me(t){for(var e=[1/0,1/0,-1/0,-1/0],r=0,n=t.length;r<n;++r)ze(e,t[r]);return e}function ke(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Ne(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function De(t,e,r){var n,i;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*i}function Fe(t,e){return Ge(t,e[0],e[1])}function Be(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Ge(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function Ue(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=e[0],s=e[1],l=Oe.UNKNOWN;return a<r?l|=Oe.LEFT:a>i&&(l|=Oe.RIGHT),s<n?l|=Oe.BELOW:s>o&&(l|=Oe.ABOVE),l===Oe.UNKNOWN&&(l=Oe.INTERSECTING),l}function je(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]}function qe(t){return je(1/0,1/0,-1/0,-1/0,t)}function We(t,e){var r=t[0],n=t[1];return je(r,n,r,n,e)}function He(t,e,r,n,i){return Ke(qe(i),t,e,r,n)}function Ve(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Ye(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function ze(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Ke(t,e,r,n,i){for(;r<n;r+=i)$e(t,e[r],e[r+1]);return t}function $e(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function Xe(t,e,r){var n;return(n=e.call(r,Je(t)))?n:(n=e.call(r,Qe(t)))?n:(n=e.call(r,ar(t)))?n:(n=e.call(r,or(t)))||!1}function Ze(t){var e=0;return cr(t)||(e=sr(t)*nr(t)),e}function Je(t){return[t[0],t[1]]}function Qe(t){return[t[2],t[1]]}function tr(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function er(t,e){var r;return e===Re.BOTTOM_LEFT?r=Je(t):e===Re.BOTTOM_RIGHT?r=Qe(t):e===Re.TOP_LEFT?r=or(t):e===Re.TOP_RIGHT?r=ar(t):te(!1,13),r}function rr(t,e,r,n,i){var o=e*n[0]/2,a=e*n[1]/2,s=Math.cos(r),l=Math.sin(r),c=o*s,u=o*l,h=a*s,d=a*l,p=t[0],f=t[1],g=p-c+d,y=p-c-d,m=p+c-d,C=p+c+d,v=f-u-h,T=f-u+h,_=f+u+h,S=f+u-h;return je(Math.min(g,y,m,C),Math.min(v,T,_,S),Math.max(g,y,m,C),Math.max(v,T,_,S),i)}function nr(t){return t[3]-t[1]}function ir(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return lr(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):qe(n),n}function or(t){return[t[0],t[3]]}function ar(t){return[t[2],t[3]]}function sr(t){return t[2]-t[0]}function lr(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function cr(t){return t[2]<t[0]||t[3]<t[1]}function ur(t,e){var r=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=n,t[3]+=n}var hr={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},dr={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function pr(t,e,r,n,i,o){for(var a=o||[],s=0,l=e;l<r;l+=n){var c=t[l],u=t[l+1];a[s++]=i[0]*c+i[2]*u+i[4],a[s++]=i[1]*c+i[3]*u+i[5]}return o&&a.length!=s&&(a.length=s),a}var fr=6371008.8;function gr(t,e,r){var n=r||fr,i=ce(t[1]),o=ce(e[1]),a=(o-i)/2,s=ce(e[0]-t[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}var yr={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},mr={};mr[yr.DEGREES]=2*Math.PI*6370997/360,mr[yr.FEET]=.3048,mr[yr.METERS]=1,mr[yr.USFEET]=1200/3937;var Cr=yr,vr=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};vr.prototype.canWrapX=function(){return this.canWrapX_},vr.prototype.getCode=function(){return this.code_},vr.prototype.getExtent=function(){return this.extent_},vr.prototype.getUnits=function(){return this.units_},vr.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||mr[this.units_]},vr.prototype.getWorldExtent=function(){return this.worldExtent_},vr.prototype.getAxisOrientation=function(){return this.axisOrientation_},vr.prototype.isGlobal=function(){return this.global_},vr.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},vr.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},vr.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},vr.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},vr.prototype.setWorldExtent=function(t){this.worldExtent_=t},vr.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},vr.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var Tr=vr,_r=6378137,Sr=Math.PI*_r,Er=[-Sr,-Sr,Sr,Sr],wr=[-180,-85,180,85],br=function(t){function e(e){t.call(this,{code:e,units:Cr.METERS,extent:Er,global:!0,worldExtent:wr,getPointResolution:function(t,e){return t/ae(e[1]/_r)}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Tr),Lr=[new br("EPSG:3857"),new br("EPSG:102100"),new br("EPSG:102113"),new br("EPSG:900913"),new br("urn:ogc:def:crs:EPSG:6.18:3:3857"),new br("urn:ogc:def:crs:EPSG::3857"),new br("http://www.opengis.net/gml/srs/epsg.xml#3857")];var Ar,xr,Pr,Ir=[-180,-90,180,90],Rr=6378137*Math.PI/180,Or=function(t){function e(e,r){t.call(this,{code:e,units:Cr.DEGREES,extent:Ir,axisOrientation:r,global:!0,metersPerUnit:Rr,worldExtent:Ir})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Tr),Mr=[new Or("CRS:84"),new Or("EPSG:4326","neu"),new Or("urn:ogc:def:crs:EPSG::4326","neu"),new Or("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new Or("urn:ogc:def:crs:OGC:1.3:CRS84"),new Or("urn:ogc:def:crs:OGC:2:84"),new Or("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Or("urn:x-ogc:def:crs:EPSG:4326","neu")],kr={},Nr={};function Dr(t,e,r){var n=t.getCode(),i=e.getCode();n in Nr||(Nr[n]={}),Nr[n][i]=r}function Fr(t,e){var r;return t in Nr&&e in Nr[t]&&(r=Nr[t][e]),r}function Br(t,e,r){var n;if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Gr(t,e,r){if(void 0!==e&&t!==e){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function Ur(t){!function(t,e){kr[t]=e}(t.getCode(),t),Dr(t,t,Br)}function jr(t){return"string"==typeof t?kr[t]||null:t||null}function qr(t,e,r,n){var i,o=(t=jr(t)).getPointResolutionFunc();if(o)i=o(e,r);else if(t.getUnits()==Cr.DEGREES&&!n||n==Cr.DEGREES)i=e;else{var a=zr(t,jr("EPSG:4326")),s=[r[0]-e/2,r[1],r[0]+e/2,r[1],r[0],r[1]-e/2,r[0],r[1]+e/2];i=(gr((s=a(s,s,2)).slice(0,2),s.slice(2,4))+gr(s.slice(4,6),s.slice(6,8)))/2;var l=n?mr[n]:t.getMetersPerUnit();void 0!==l&&(i/=l)}return i}function Wr(t){!function(t){t.forEach(Ur)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&Dr(e,t,Br)})})}function Hr(t,e){return t?"string"==typeof t?jr(t):t:jr(e)}function Vr(t){return function(e,r,n){for(var i=e.length,o=void 0!==n?n:2,a=void 0!==r?r:new Array(i),s=0;s<i;s+=o){var l=t([e[s],e[s+1]]);a[s]=l[0],a[s+1]=l[1];for(var c=o-1;c>=2;--c)a[s+c]=e[s+c]}return a}}function Yr(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return t.getCode()===e.getCode()?r:zr(t,e)===Br&&r}function zr(t,e){var r=Fr(t.getCode(),e.getCode());return r||(r=Gr),r}function Kr(t,e){return zr(jr(t),jr(e))}function $r(t,e,r){return Kr(e,r)(t,void 0,t.length)}function Xr(t,e,r){return function(t,e,r){var n=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];return e(n,n,2),function(t,e,r){return je(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}([n[0],n[2],n[4],n[6]],[n[1],n[3],n[5],n[7]],r)}(t,Kr(e,r))}Wr(Lr),Wr(Mr),Ar=Lr,xr=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=Sr,s=0;s<n;s+=i){o[s]=a*t[s]/180;var l=_r*Math.log(Math.tan(Math.PI*(t[s+1]+90)/360));l>a?l=a:l<-a&&(l=-a),o[s+1]=l}return o},Pr=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i)o[a]=180*t[a]/Sr,o[a+1]=360*Math.atan(Math.exp(t[a+1]/_r))/Math.PI-90;return o},Mr.forEach(function(t){Ar.forEach(function(e){Dr(t,e,xr),Dr(e,t,Pr)})});var Zr=new Array(6);function Jr(t){return tn(t,1,0,0,1,0,0)}function Qr(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=e[0],c=e[1],u=e[2],h=e[3],d=e[4],p=e[5];return t[0]=r*l+i*c,t[1]=n*l+o*c,t[2]=r*u+i*h,t[3]=n*u+o*h,t[4]=r*d+i*p+a,t[5]=n*d+o*p+s,t}function tn(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function en(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function rn(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function nn(t,e,r){return Qr(t,tn(Zr,e,0,0,r,0,0))}function on(t,e,r){return Qr(t,tn(Zr,1,0,0,1,e,r))}function an(t,e,r,n,i,o,a,s){var l=Math.sin(o),c=Math.cos(o);return t[0]=n*c,t[1]=i*l,t[2]=-n*l,t[3]=i*c,t[4]=a*n*c-s*n*l+e,t[5]=a*i*l+s*i*c+r,t}var sn=[1,0,0,1,0,0],ln=function(t){function e(){t.call(this),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return n()},e.prototype.closestPointXY=function(t,e,r,i){return n()},e.prototype.containsXY=function(t,e){return!1},e.prototype.getClosestPoint=function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return n()},e.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){n()},e.prototype.scale=function(t,e,r){n()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return n()},e.prototype.getType=function(){return n()},e.prototype.applyTransform=function(t){n()},e.prototype.intersectsExtent=function(t){return n()},e.prototype.translate=function(t,e){n()},e.prototype.transform=function(t,e){var r=jr(t),n=r.getUnits()==Cr.TILE_PIXELS?function(t,n,i){var o=r.getExtent(),a=r.getWorldExtent(),s=nr(a)/nr(o);return an(sn,a[0],a[3],s,-s,0,0,0),pr(t,0,t.length,i,sn,n),Kr(r,e)(t,n,i)}:Kr(r,e);return this.applyTransform(n),this},e}(D);function cn(t){var e;return t==dr.XY?e=2:t==dr.XYZ||t==dr.XYM?e=3:t==dr.XYZM&&(e=4),e}var un=function(t){function e(){t.call(this),this.layout=dr.XY,this.stride=2,this.flatCoordinates=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeExtent=function(t){return He(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return n()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(h(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var r=this.getSimplifiedGeometryInternal(t);return r.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[e]=r,r):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=cn(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){n()},e.prototype.setLayout=function(t,e,r){var n;if(t)n=cn(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=dr.XY,void(this.stride=2);e=e[0]}t=function(t){var e;2==t?e=dr.XY:3==t?e=dr.XYZ:4==t&&(e=dr.XYZM);return e}(n=e.length)}this.layout=t,this.stride=n},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],l=Math.cos(i),c=Math.sin(i),u=o[0],h=o[1],d=0,p=0;p<r;p+=n){var f=t[p]-u,g=t[p+1]-h;s[d++]=u+f*l-g*c,s[d++]=h+f*c+g*l;for(var y=p+2;y<p+n;++y)s[d++]=t[y]}a&&s.length!=d&&(s.length=d)}(r,0,r.length,n,t,e,r),this.changed()}},e.prototype.scale=function(t,e,r){var n=e;void 0===n&&(n=t);var i=r;i||(i=tr(this.getExtent()));var o=this.getFlatCoordinates();if(o){var a=this.getStride();!function(t,e,r,n,i,o,a,s){for(var l=s||[],c=a[0],u=a[1],h=0,d=0;d<r;d+=n){var p=t[d]-c,f=t[d+1]-u;l[h++]=c+i*p,l[h++]=u+o*f;for(var g=d+2;g<d+n;++g)l[h++]=t[g]}s&&l.length!=h&&(l.length=h)}(o,0,o.length,a,t,n,i,o),this.changed()}},e.prototype.translate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],l=0,c=0;c<r;c+=n){s[l++]=t[c]+i,s[l++]=t[c+1]+o;for(var u=c+2;u<c+n;++u)s[l++]=t[u]}a&&s.length!=l&&(s.length=l)}(r,0,r.length,n,t,e,r),this.changed()}},e}(ln);function hn(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],l=t[e+1];i+=a*s-o*l,o=s,a=l}return i/2}function dn(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=hn(t,e,s,n),e=s}return i}function pn(t,e,r,n,i,o,a){var s,l=t[e],c=t[e+1],u=t[r]-l,h=t[r+1]-c;if(0===u&&0===h)s=e;else{var d=((i-l)*u+(o-c)*h)/(u*u+h*h);if(d>1)s=r;else{if(d>0){for(var p=0;p<n;++p)a[p]=he(t[e+p],t[r+p],d);return void(a.length=n)}s=e}}for(var f=0;f<n;++f)a[f]=t[s+f];a.length=n}function fn(t,e,r,n,i){var o=t[e],a=t[e+1];for(e+=n;e<r;e+=n){var s=t[e],l=t[e+1],c=le(o,a,s,l);c>i&&(i=c),o=s,a=l}return i}function gn(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=fn(t,e,s,n,i),e=s}return i}function yn(t,e,r,n,i,o,a,s,l,c,u){if(e==r)return c;var h,d;if(0===i){if((d=le(a,s,t[e],t[e+1]))<c){for(h=0;h<n;++h)l[h]=t[e+h];return l.length=n,d}return c}for(var p=u||[NaN,NaN],f=e+n;f<r;)if(pn(t,f-n,f,n,a,s,p),(d=le(a,s,p[0],p[1]))<c){for(c=d,h=0;h<n;++h)l[h]=p[h];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/i|0,1);if(o&&(pn(t,r-n,e,n,a,s,p),(d=le(a,s,p[0],p[1]))<c)){for(c=d,h=0;h<n;++h)l[h]=p[h];l.length=n}return c}function mn(t,e,r,n,i,o,a,s,l,c,u){for(var h=u||[NaN,NaN],d=0,p=r.length;d<p;++d){var f=r[d];c=yn(t,e,f,n,i,o,a,s,l,c,h),e=f}return c}function Cn(t,e,r,n){for(var i=0,o=r.length;i<o;++i)t[e++]=r[i];return e}function vn(t,e,r,n){for(var i=0,o=r.length;i<o;++i)for(var a=r[i],s=0;s<n;++s)t[e++]=a[s];return e}function Tn(t,e,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=vn(t,e,r[s],n);o[a++]=c,e=c}return o.length=a,o}function _n(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=e;s<r;s+=n)o[a++]=t.slice(s,s+n);return o.length=a,o}function Sn(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=_n(t,e,c,n,o[a]),e=c}return o.length=a,o}function En(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=Sn(t,e,c,n,o[a]),e=c[c.length-1]}return o.length=a,o}function wn(t,e,r,n,i,o,a){var s=(r-e)/n;if(s<3){for(;e<r;e+=n)o[a++]=t[e],o[a++]=t[e+1];return a}var l=new Array(s);l[0]=1,l[s-1]=1;for(var c=[e,r-n],u=0;c.length>0;){for(var h=c.pop(),d=c.pop(),p=0,f=t[d],g=t[d+1],y=t[h],m=t[h+1],C=d+n;C<h;C+=n){var v=se(t[C],t[C+1],f,g,y,m);v>p&&(u=C,p=v)}p>i&&(l[(u-e)/n]=1,d+n<u&&c.push(d,u),u+n<h&&c.push(u,h))}for(var T=0;T<s;++T)l[T]&&(o[a++]=t[e+T*n],o[a++]=t[e+T*n+1]);return a}function bn(t,e){return e*Math.round(t/e)}function Ln(t,e,r,n,i,o,a){if(e==r)return a;var s,l,c=bn(t[e],i),u=bn(t[e+1],i);e+=n,o[a++]=c,o[a++]=u;do{if(s=bn(t[e],i),l=bn(t[e+1],i),(e+=n)==r)return o[a++]=s,o[a++]=l,a}while(s==c&&l==u);for(;e<r;){var h=bn(t[e],i),d=bn(t[e+1],i);if(e+=n,h!=s||d!=l){var p=s-c,f=l-u,g=h-c,y=d-u;p*y==f*g&&(p<0&&g<p||p==g||p>0&&g>p)&&(f<0&&y<f||f==y||f>0&&y>f)?(s=h,l=d):(o[a++]=s,o[a++]=l,c=s,u=l,s=h,l=d)}}return o[a++]=s,o[a++]=l,a}function An(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=Ln(t,e,u,n,i,o,a),s.push(a),e=u}return a}var xn=function(t){function e(e,r){t.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?this.setCoordinates(e,r):this.setFlatCoordinates(r,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.getArea=function(){return hn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,dr.XY)},e.prototype.getType=function(){return hr.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un),Pn=function(t){function e(e,r){t.call(this),this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){var i=this.flatCoordinates,o=le(t,e,i[0],i[1]);if(o<n){for(var a=this.stride,s=0;s<a;++s)r[s]=i[s];return r.length=a,o}return n},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return We(this.flatCoordinates,t)},e.prototype.getType=function(){return hr.POINT},e.prototype.intersectsExtent=function(t){return Ge(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Cn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un);function In(t,e,r,n,i){return!Xe(i,function(i){return!Rn(t,e,r,n,i[0],i[1])})}function Rn(t,e,r,n,i,o){for(var a=0,s=t[r-n],l=t[r-n+1];e<r;e+=n){var c=t[e],u=t[e+1];l<=o?u>o&&(c-s)*(o-l)-(i-s)*(u-l)>0&&a++:u<=o&&(c-s)*(o-l)-(i-s)*(u-l)<0&&a--,s=c,l=u}return 0!==a}function On(t,e,r,n,i,o){if(0===r.length)return!1;if(!Rn(t,e,r[0],n,i,o))return!1;for(var a=1,s=r.length;a<s;++a)if(Rn(t,r[a-1],r[a],n,i,o))return!1;return!0}function Mn(t,e,r,n,i,o,a){for(var s,l,c,u,h,d,p,f=i[o+1],g=[],y=0,m=r.length;y<m;++y){var C=r[y];for(u=t[C-n],d=t[C-n+1],s=e;s<C;s+=n)h=t[s],p=t[s+1],(f<=d&&p<=f||d<=f&&f<=p)&&(c=(f-d)/(p-d)*(h-u)+u,g.push(c)),u=h,d=p}var v=NaN,T=-1/0;for(g.sort(kt),u=g[0],s=1,l=g.length;s<l;++s){h=g[s];var _=Math.abs(h-u);_>T&&On(t,e,r,n,c=(u+h)/2,f)&&(v=c,T=_),u=h}return isNaN(v)&&(v=i[o]),a?(a.push(v,f,T),a):[v,f,T]}function kn(t,e,r,n,i,o){for(var a,s=[t[e],t[e+1]],l=[];e+n<r;e+=n){if(l[0]=t[e+n],l[1]=t[e+n+1],a=i.call(o,s,l))return a;s[0]=l[0],s[1]=l[1]}return!1}function Nn(t,e,r,n,i){var o=Ke([1/0,1/0,-1/0,-1/0],t,e,r,n);return!!lr(i,o)&&(!!Be(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]||kn(t,e,r,n,function(t,e){return function(t,e,r){var n=!1,i=Ue(t,e),o=Ue(t,r);if(i===Oe.INTERSECTING||o===Oe.INTERSECTING)n=!0;else{var a,s,l=t[0],c=t[1],u=t[2],h=t[3],d=e[0],p=e[1],f=r[0],g=r[1],y=(g-p)/(f-d);o&Oe.ABOVE&&!(i&Oe.ABOVE)&&(n=(a=f-(g-h)/y)>=l&&a<=u),n||!(o&Oe.RIGHT)||i&Oe.RIGHT||(n=(s=g-(f-u)*y)>=c&&s<=h),n||!(o&Oe.BELOW)||i&Oe.BELOW||(n=(a=f-(g-c)/y)>=l&&a<=u),n||!(o&Oe.LEFT)||i&Oe.LEFT||(n=(s=g-(f-l)*y)>=c&&s<=h)}return n}(i,t,e)}))}function Dn(t,e,r,n,i){if(!function(t,e,r,n,i){return!!(Nn(t,e,r,n,i)||Rn(t,e,r,n,i[0],i[1])||Rn(t,e,r,n,i[0],i[3])||Rn(t,e,r,n,i[2],i[1])||Rn(t,e,r,n,i[2],i[3]))}(t,e,r[0],n,i))return!1;if(1===r.length)return!0;for(var o=1,a=r.length;o<a;++o)if(In(t,r[o-1],r[o],n,i)&&!Nn(t,r[o-1],r[o],n,i))return!1;return!0}function Fn(t,e,r,n){for(;e<r-n;){for(var i=0;i<n;++i){var o=t[e+i];t[e+i]=t[r-n+i],t[r-n+i]=o}e+=n,r-=n}}function Bn(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],l=t[e+1];i+=(s-o)*(l+a),o=s,a=l}return i>0}function Gn(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=Bn(t,e,l,n);if(0===a){if(o&&c||!o&&!c)return!1}else if(o&&!c||!o&&c)return!1;e=l}return!0}function Un(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=Bn(t,e,l,n);(0===a?o&&c||!o&&!c:o&&!c||!o&&c)&&Fn(t,e,l,n),e=l}return e}function jn(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)e=Un(t,e,r[o],n,i);return e}var qn=function(t){function e(e,r,n){t.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==r&&n?(this.setFlatCoordinates(r,e),this.ends_=n):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLinearRing=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.containsXY=function(t,e){return On(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return dn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?Un(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,Sn(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=tr(this.getExtent());this.flatInteriorPoint_=Mn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new Pn(this.getFlatInteriorPoint(),dr.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new xn(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o],l=new xn(e.slice(i,s),t);n.push(l),i=s}return n},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Gn(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Un(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=An(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,dr.XY,n)},e.prototype.getType=function(){return hr.POLYGON},e.prototype.intersectsExtent=function(t){return Dn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Tn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(un),Wn=qn;function Hn(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=[e,r,e,i,n,i,n,r,e,r];return new qn(o,dr.XY,[o.length])}function Vn(t,e,r){for(var n=e||32,i=t.getStride(),o=t.getLayout(),a=t.getCenter(),s=i*(n+1),l=new Array(s),c=0;c<s;c+=i){l[c]=0,l[c+1]=0;for(var u=2;u<i;u++)l[c+u]=a[u]}var h=[l.length],d=new qn(l,o,h);return function(t,e,r,n){for(var i=t.getFlatCoordinates(),o=t.getStride(),a=i.length/o-1,s=n||0,l=0;l<=a;++l){var c=l*o,u=s+2*ue(l,a)*Math.PI/a;i[c]=e[0]+r*Math.cos(u),i[c+1]=e[1]+r*Math.sin(u)}t.changed()}(d,a,t.getRadius(),r),d}function Yn(t,e){setTimeout(function(){t(e)},0)}function zn(t){return!(t.sourceCenter&&t.targetCenter&&!_e(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}var Kn=function(t){function e(e){t.call(this);var r=u({},e);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=Hr(r.projection,"EPSG:3857"),this.applyOptions_(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.applyOptions_=function(t){var e={};e[ge]=void 0!==t.center?t.center:null;var r=function(t){var e,r,n,i=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28,a=void 0!==t.zoomFactor?t.zoomFactor:2;if(void 0!==t.resolutions){var s=t.resolutions;r=s[i],n=void 0!==s[o]?s[o]:s[s.length-1],e=function(t){return function(e,r,n){if(void 0!==e){var i=Dt(t,e,n);i=oe(i+r,0,t.length-1);var o=Math.floor(i);if(i!=o&&o<t.length-1){var a=t[o]/t[o+1];return t[o]/Math.pow(a,i-o)}return t[o]}}}(s)}else{var l=Hr(t.projection,"EPSG:3857"),c=l.getExtent(),u=(c?Math.max(sr(c),nr(c)):360*mr[Cr.DEGREES]/l.getMetersPerUnit())/ie/Math.pow(2,0),h=u/Math.pow(2,28);void 0!==(r=t.maxResolution)?i=0:r=u/Math.pow(a,i),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?r/Math.pow(a,o):u/Math.pow(a,o):h),o=i+Math.floor(Math.log(r/n)/Math.log(a)),n=r/Math.pow(a,o-i),e=function(t,e,r){return function(n,i,o){if(void 0!==n){var a=-o/2+.5,s=Math.floor(Math.log(e/n)/Math.log(t)+a),l=Math.max(s+i,0);return void 0!==r&&(l=Math.min(l,r)),e/Math.pow(t,l)}}}(a,r,o-i)}return{constraint:e,maxResolution:r,minResolution:n,minZoom:i,zoomFactor:a}}(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=r.minZoom;var n=function(t){return void 0!==t.extent?(e=t.extent,function(t){return t?[oe(t[0],e[0],e[2]),oe(t[1],e[1],e[3])]:void 0}):de;var e}(t),i=r.constraint,o=function(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?(i=ce(5),function(t,e){return void 0!==t?Math.abs(t+e)<=i?0:t+e:void 0}):!1===e?fe:"number"==typeof e?(r=e,n=2*Math.PI/r,function(t,e){return void 0!==t?t=Math.floor((t+e)/n+.5)*n:void 0}):fe}return pe;var r,n,i}(t);this.constraints_={center:n,resolution:i,rotation:o},void 0!==t.resolution?e[ye]=t.resolution:void 0!==t.zoom&&(e[ye]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_),this.resolutions_&&(e[ye]=oe(Number(this.getResolution()||e[ye]),this.minResolution_,this.maxResolution_))),e[me]=void 0!==t.rotation?t.rotation:0,this.setProperties(e),this.options_=t},e.prototype.getUpdatedOptions_=function(t){var e=u({},this.options_);return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenter(),e.rotation=this.getRotation(),u({},e,t)},e.prototype.animate=function(t){var e,r=arguments,n=arguments.length;if(n>1&&"function"==typeof arguments[n-1]&&(e=arguments[n-1],--n),!this.isDef()){var i=arguments[n-1];return i.center&&this.setCenter(i.center),void 0!==i.zoom&&this.setZoom(i.zoom),void 0!==i.rotation&&this.setRotation(i.rotation),void(e&&Yn(e,!0))}for(var o=Date.now(),a=this.getCenter().slice(),s=this.getResolution(),l=this.getRotation(),c=[],u=0;u<n;++u){var h=r[u],d={start:o,complete:!1,anchor:h.anchor,duration:void 0!==h.duration?h.duration:1e3,easing:h.easing||Pe};if(h.center&&(d.sourceCenter=a,d.targetCenter=h.center,a=d.targetCenter),void 0!==h.zoom?(d.sourceResolution=s,d.targetResolution=this.constrainResolution(this.maxResolution_,h.zoom-this.minZoom_,0),s=d.targetResolution):h.resolution&&(d.sourceResolution=s,d.targetResolution=h.resolution,s=d.targetResolution),void 0!==h.rotation){d.sourceRotation=l;var p=ue(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=l+p,l=d.targetRotation}d.callback=e,zn(d)?d.complete=!0:o+=d.duration,c.push(d)}this.animations_.push(c),this.setHint(0,1),this.updateAnimations_()},e.prototype.getAnimating=function(){return this.hints_[0]>0},e.prototype.getInteracting=function(){return this.hints_[1]>0},e.prototype.cancelAnimations=function(){this.setHint(0,-this.hints_[0]);for(var t=0,e=this.animations_.length;t<e;++t){var r=this.animations_[t];r[0].callback&&Yn(r[0].callback,!1)}this.animations_.length=0},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,r=this.animations_.length-1;r>=0;--r){for(var n=this.animations_[r],i=!0,o=0,a=n.length;o<a;++o){var s=n[o];if(!s.complete){var l=t-s.start,c=s.duration>0?l/s.duration:1;c>=1?(s.complete=!0,c=1):i=!1;var u=s.easing(c);if(s.sourceCenter){var h=s.sourceCenter[0],d=s.sourceCenter[1],p=h+u*(s.targetCenter[0]-h),f=d+u*(s.targetCenter[1]-d);this.set(ge,[p,f])}if(s.sourceResolution&&s.targetResolution){var g=1===u?s.targetResolution:s.sourceResolution+u*(s.targetResolution-s.sourceResolution);s.anchor&&this.set(ge,this.calculateCenterZoom(g,s.anchor)),this.set(ye,g)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){var y=1===u?ue(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+u*(s.targetRotation-s.sourceRotation);s.anchor&&this.set(ge,this.calculateCenterRotate(y,s.anchor)),this.set(me,y)}if(e=!0,!s.complete)break}}if(i){this.animations_[r]=null,this.setHint(0,-1);var m=n[0].callback;m&&Yn(m,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},e.prototype.calculateCenterRotate=function(t,e){var r,n=this.getCenter();return void 0!==n&&(Se(r=[n[0]-e[0],n[1]-e[1]],t-this.getRotation()),ve(r,e)),r},e.prototype.calculateCenterZoom=function(t,e){var r,n=this.getCenter(),i=this.getResolution();void 0!==n&&void 0!==i&&(r=[e[0]-t*(e[0]-n[0])/i,e[1]-t*(e[1]-n[1])/i]);return r},e.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+o(this)+'"]',r=document.querySelector(e);if(r){var n=getComputedStyle(r);t[0]=parseInt(n.width,10),t[1]=parseInt(n.height,10)}return t},e.prototype.constrainCenter=function(t){return this.constraints_.center(t)},e.prototype.constrainResolution=function(t,e,r){var n=e||0,i=r||0;return this.constraints_.resolution(t,n,i)},e.prototype.constrainRotation=function(t,e){var r=e||0;return this.constraints_.rotation(t,r)},e.prototype.getCenter=function(){return this.get(ge)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),r=this.getCenter();te(r,1);var n=this.getResolution();te(void 0!==n,2);var i=this.getRotation();return te(void 0!==i,3),rr(r,n,i,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(ye)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){var r=e||this.getSizeFromViewport_(),n=sr(t)/r[0],i=nr(t)/r[1];return Math.max(n,i)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){return r/Math.pow(e,t*i)}},e.prototype.getRotation=function(){return this.get(me)},e.prototype.getValueForResolutionFunction=function(t){var e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){return Math.log(r/t)/Math.log(e)/i}},e.prototype.getState=function(t){var e=this.getCenter(),r=this.getProjection(),n=this.getResolution(),i=n/t,o=this.getRotation();return{center:[Math.round(e[0]/i)*i,Math.round(e[1]/i)*i],projection:void 0!==r?r:null,resolution:n,rotation:o,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,r,n=this.minZoom_||0;if(this.resolutions_){var i=Dt(this.resolutions_,t,1);n=i,e=this.resolutions_[i],r=i==this.resolutions_.length-1?2:e/this.resolutions_[i+1]}else e=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(e/t)/Math.log(r)},e.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)},e.prototype.fit=function(t,e){var r,n=e||{},i=n.size;i||(i=this.getSizeFromViewport_()),te(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)?(te(!cr(t),25),r=Hn(t)):t.getType()===hr.CIRCLE?(r=Hn(t=t.getExtent())).rotate(this.getRotation(),tr(t)):r=t;var o,a=void 0!==n.padding?n.padding:[0,0,0,0],s=void 0===n.constrainResolution||n.constrainResolution,l=void 0!==n.nearest&&n.nearest;o=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.constrainResolution(this.maxResolution_,n.maxZoom-this.minZoom_,0):0;for(var c=r.getFlatCoordinates(),u=this.getRotation(),h=Math.cos(-u),d=Math.sin(-u),p=1/0,f=1/0,g=-1/0,y=-1/0,m=r.getStride(),C=0,v=c.length;C<v;C+=m){var T=c[C]*h-c[C+1]*d,_=c[C]*d+c[C+1]*h;p=Math.min(p,T),f=Math.min(f,_),g=Math.max(g,T),y=Math.max(y,_)}var S=this.getResolutionForExtent([p,f,g,y],[i[0]-a[1]-a[3],i[1]-a[0]-a[2]]);if(S=isNaN(S)?o:Math.max(S,o),s){var E=this.constrainResolution(S,0,0);!l&&E<S&&(E=this.constrainResolution(E,-1,0)),S=E}d=-d;var w=(p+g)/2,b=(f+y)/2,A=[(w+=(a[1]-a[3])/2*S)*h-(b+=(a[0]-a[2])/2*S)*d,b*h+w*d],x=n.callback?n.callback:L;void 0!==n.duration?this.animate({resolution:S,center:A,duration:n.duration,easing:n.easing},x):(this.setResolution(S),this.setCenter(A),Yn(x,!0))},e.prototype.centerOn=function(t,e,r){var n=this.getRotation(),i=Math.cos(-n),o=Math.sin(-n),a=t[0]*i-t[1]*o,s=t[1]*i+t[0]*o,l=this.getResolution(),c=(a+=(e[0]/2-r[0])*l)*i-(s+=(r[1]-e[1]/2)*l)*(o=-o),u=s*i+a*o;this.setCenter([c,u])},e.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},e.prototype.rotate=function(t,e){if(void 0!==e){var r=this.calculateCenterRotate(t,e);this.setCenter(r)}this.setRotation(t)},e.prototype.setCenter=function(t){this.set(ge,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.set(ye,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setRotation=function(t){this.set(me,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e}(D);function $n(t,e){var r=document.createElement("canvas");return t&&(r.width=t),e&&(r.height=e),r.getContext("2d")}function Xn(t){var e=t.offsetWidth,r=getComputedStyle(t);return e+(parseInt(r.marginLeft,10)+parseInt(r.marginRight,10))}function Zn(t){var e=t.offsetHeight,r=getComputedStyle(t);return e+(parseInt(r.marginTop,10)+parseInt(r.marginBottom,10))}function Jn(t,e){var r=e.parentNode;r&&r.replaceChild(t,e)}function Qn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function ti(t){for(;t.lastChild;)t.removeChild(t.lastChild)}var ei={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},ri=function(t){function e(e){t.call(this);var r=u({},e);r[ei.OPACITY]=void 0!==e.opacity?e.opacity:1,r[ei.VISIBLE]=void 0===e.visible||e.visible,r[ei.Z_INDEX]=e.zIndex,r[ei.MAX_RESOLUTION]=void 0!==e.maxResolution?e.maxResolution:1/0,r[ei.MIN_RESOLUTION]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(r),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t=this.state_||{layer:this,managed:!0};return t.opacity=oe(this.getOpacity(),0,1),t.sourceState=this.getSourceState(),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=this.getZIndex()||0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),this.state_=t,t},e.prototype.getLayersArray=function(t){return n()},e.prototype.getLayerStatesArray=function(t){return n()},e.prototype.getExtent=function(){return this.get(ei.EXTENT)},e.prototype.getMaxResolution=function(){return this.get(ei.MAX_RESOLUTION)},e.prototype.getMinResolution=function(){return this.get(ei.MIN_RESOLUTION)},e.prototype.getOpacity=function(){return this.get(ei.OPACITY)},e.prototype.getSourceState=function(){return n()},e.prototype.getVisible=function(){return this.get(ei.VISIBLE)},e.prototype.getZIndex=function(){return this.get(ei.Z_INDEX)},e.prototype.setExtent=function(t){this.set(ei.EXTENT,t)},e.prototype.setMaxResolution=function(t){this.set(ei.MAX_RESOLUTION,t)},e.prototype.setMinResolution=function(t){this.set(ei.MIN_RESOLUTION,t)},e.prototype.setOpacity=function(t){this.set(ei.OPACITY,t)},e.prototype.setVisible=function(t){this.set(ei.VISIBLE,t)},e.prototype.setZIndex=function(t){this.set(ei.Z_INDEX,t)},e}(D),ni={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},ii={LAYERS:"layers"},oi=function(t){function e(e){var r=e||{},n=u({},r);delete n.layers;var i=r.layers;t.call(this,n),this.layersListenerKeys_=[],this.listenerKeys_={},C(this,N(ii.LAYERS),this.handleLayersChanged_,this),i?Array.isArray(i)?i=new G(i.slice(),{unique:!0}):te("function"==typeof i.getArray,43):i=new G(void 0,{unique:!0}),this.setLayers(i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(_),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(C(t,l.ADD,this.handleLayersAdd_,this),C(t,l.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(_);h(this.listenerKeys_);for(var r=t.getArray(),n=0,i=r.length;n<i;n++){var a=r[n];this.listenerKeys_[o(a)]=[C(a,c,this.handleLayerChange_,this),C(a,R.CHANGE,this.handleLayerChange_,this)]}this.changed()},e.prototype.handleLayersAdd_=function(t){var e=t.element;this.listenerKeys_[o(e)]=[C(e,c,this.handleLayerChange_,this),C(e,R.CHANGE,this.handleLayerChange_,this)],this.changed()},e.prototype.handleLayersRemove_=function(t){var e=o(t.element);this.listenerKeys_[e].forEach(_),delete this.listenerKeys_[e],this.changed()},e.prototype.getLayers=function(){return this.get(ii.LAYERS)},e.prototype.setLayers=function(t){this.set(ii.LAYERS,t)},e.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(e)}),e},e.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],r=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});for(var n=this.getLayerState(),i=r,o=e.length;i<o;i++){var a=e[i];a.opacity*=n.opacity,a.visible=a.visible&&n.visible,a.maxResolution=Math.min(a.maxResolution,n.maxResolution),a.minResolution=Math.max(a.minResolution,n.minResolution),void 0!==n.extent&&(void 0!==a.extent?a.extent=ir(a.extent,n.extent):a.extent=n.extent)}return e},e.prototype.getSourceState=function(){return ni.READY},e}(ri);function ai(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:e[0]=e[1]=t,e)}var si,li,ci=function(t){function e(e){t.call(this);var r=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var r,n,i,o={},a=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new oi({layers:t.layers});o[Zt.LAYERGROUP]=a,o[Zt.TARGET]=t.target,o[Zt.VIEW]=void 0!==t.view?t.view:new Kn,void 0!==t.controls&&(Array.isArray(t.controls)?r=new G(t.controls.slice()):(te("function"==typeof t.controls.getArray,47),r=t.controls));void 0!==t.interactions&&(Array.isArray(t.interactions)?n=new G(t.interactions.slice()):(te("function"==typeof t.interactions.getArray,48),n=t.interactions));void 0!==t.overlays?Array.isArray(t.overlays)?i=new G(t.overlays.slice()):(te("function"==typeof t.overlays.getArray,49),i=t.overlays):i=new G;return{controls:r,interactions:n,keyboardEventTarget:e,overlays:i,values:o}}(e);this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:z,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+($?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var n=[R.CLICK,R.DBLCLICK,R.MOUSEDOWN,R.TOUCHSTART,R.MSPOINTERDOWN,J.POINTERDOWN,R.MOUSEWHEEL,R.WHEEL],i=0,o=n.length;i<o;++i)C(this.overlayContainerStopEvent_,n[i],x);for(var a in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new $t(this,e.moveTolerance),J)C(this.mapBrowserEventHandler_,J[a],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=r.keyboardEventTarget,this.keyHandlerKeys_=null,C(this.viewport_,R.CONTEXTMENU,this.handleBrowserEvent,this),C(this.viewport_,R.WHEEL,this.handleBrowserEvent,this),C(this.viewport_,R.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=r.controls||new G,this.interactions=r.interactions||new G,this.overlays_=r.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new re(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},C(this,N(Zt.LAYERGROUP),this.handleLayerGroupChanged_,this),C(this,N(Zt.VIEW),this.handleViewChanged_,this),C(this,N(Zt.SIZE),this.handleSizeChanged_,this),C(this,N(Zt.TARGET),this.handleTargetChanged_,this),this.setProperties(r.values),this.controls.forEach(function(t){t.setMap(this)}.bind(this)),C(this.controls,l.ADD,function(t){t.element.setMap(this)},this),C(this.controls,l.REMOVE,function(t){t.element.setMap(null)},this),this.interactions.forEach(function(t){t.setMap(this)}.bind(this)),C(this.interactions,l.ADD,function(t){t.element.setMap(this)},this),C(this.interactions,l.REMOVE,function(t){t.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),C(this.overlays_,l.ADD,function(t){this.addOverlayInternal_(t.element)},this),C(this.overlays_,l.REMOVE,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)},this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),T(this.viewport_,R.CONTEXTMENU,this.handleBrowserEvent,this),T(this.viewport_,R.WHEEL,this.handleBrowserEvent,this),T(this.viewport_,R.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(removeEventListener(R.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),t.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,e,r){if(this.frameState_){var n=this.getCoordinateFromPixel(t),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=void 0!==r.layerFilter?r.layerFilter:w;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,e,null,o,null)}},e.prototype.getFeaturesAtPixel=function(t,e){var r=null;return this.forEachFeatureAtPixel(t,function(t){r||(r=[]),r.push(t)},e),r},e.prototype.forEachLayerAtPixel=function(t,e,r){if(this.frameState_){var n=r||{},i=void 0!==n.hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=n.layerFilter||w;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,i,e,null,o,null)}},e.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixel(t),n=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:w,i=void 0!==e.hitTolerance?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,n,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),r="changedTouches"in t?t.changedTouches[0]:t;return[r.clientX-e.left,r.clientY-e.top]},e.prototype.getTarget=function(){return this.get(Zt.TARGET)},e.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){var e=this.frameState_;return e?rn(e.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(Zt.LAYERGROUP)},e.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},e.prototype.getPixelFromCoordinate=function(t){var e=this.frameState_;return e?rn(e.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(Zt.SIZE)},e.prototype.getView=function(){return this.get(Zt.VIEW)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getTilePriority=function(t,e,r,n){var i=this.frameState_;if(!(i&&e in i.wantedTiles))return 1/0;if(!i.wantedTiles[e][t.getKey()])return 1/0;var o=r[0]-i.focus[0],a=r[1]-i.focus[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n},e.prototype.handleBrowserEvent=function(t,e){var r=e||t.type,n=new j(r,this,t);this.handleMapBrowserEvent(n)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){this.focus_=t.coordinate,t.frameState=this.frameState_;var e=this.getInteractions().getArray();if(!1!==this.dispatchEvent(t))for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.getActive()&&!n.handleEvent(t))break}}},e.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var r=this.maxTilesLoading_,n=r;if(t){var i=t.viewHints;i[0]&&(r=this.loadTilesWhileAnimating_?8:0,n=2),i[1]&&(r=this.loadTilesWhileInteracting_?8:0,n=2)}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,n))}!t||!this.hasListener(Jt.RENDERCOMPLETE)||t.animate||this.tileQueue_.getTilesLoading()||function t(e){for(var r=0,n=e.length;r<n;++r){var i=e[r];if("function"==typeof i.getLayers)return t(i.getLayers().getArray());var o=i.getSource();if(o&&o.loading)return!0}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(Jt.RENDERCOMPLETE,t);for(var o=this.postRenderFunctions_,a=0,s=o.length;a<s;++a)o[a](this,t);o.length=0},e.prototype.handleSizeChanged_=function(){this.render()},e.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.keyHandlerKeys_){for(var e=0,r=this.keyHandlerKeys_.length;e<r;++e)_(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(t){t.appendChild(this.viewport_);var n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[C(n,R.KEYDOWN,this.handleBrowserEvent,this),C(n,R.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(R.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),Qn(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(R.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(_(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(_(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.viewport_.setAttribute("data-view",o(t)),this.viewPropertyListenerKey_=C(t,c,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=C(t,R.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(_),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[C(t,c,this.render,this),C(t,R.CHANGE,this.render,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var e,r=this.getSize(),n=this.getView(),i=[1/0,1/0,-1/0,-1/0],a=this.frameState_,s=null;if(void 0!==r&&function(t){return t[0]>0&&t[1]>0}(r)&&n&&n.isDef()){for(var l=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),c=this.getLayerGroup().getLayerStatesArray(),u={},h=0,d=c.length;h<d;++h)u[o(c[h].layer)]=c[h];e=n.getState(this.pixelRatio_),s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:i,focus:this.focus_?this.focus_:e.center,index:this.frameIndex_++,layerStates:u,layerStatesArray:c,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:e,viewHints:l,wantedTiles:{}}}if(s&&(s.extent=rr(e.center,e.resolution,e.rotation,s.size,i)),this.frameState_=s,this.renderer_.renderFrame(s),s){(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a)&&(!this.previousExtent_||!cr(this.previousExtent_)&&!Ve(s.extent,this.previousExtent_))&&(this.dispatchEvent(new U(Xt.MOVESTART,this,a)),this.previousExtent_=qe(this.previousExtent_));this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!Ve(s.extent,this.previousExtent_)&&(this.dispatchEvent(new U(Xt.MOVEEND,this,s)),Ne(s.extent,this.previousExtent_))}this.dispatchEvent(new U(Xt.POSTRENDER,this,s)),setTimeout(this.handlePostRender.bind(this),0)},e.prototype.setLayerGroup=function(t){this.set(Zt.LAYERGROUP,t)},e.prototype.setSize=function(t){this.set(Zt.SIZE,t)},e.prototype.setTarget=function(t){this.set(Zt.TARGET,t)},e.prototype.setView=function(t){this.set(Zt.VIEW,t)},e.prototype.skipFeature=function(t){this.skippedFeatureUids_[o(t)]=!0,this.render()},e.prototype.updateSize=function(){var t=this.getTargetElement();if(t){var e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}else this.setSize(void 0)},e.prototype.unskipFeature=function(t){delete this.skippedFeatureUids_[o(t)],this.render()},e}(D),ui=function(t){function e(e){t.call(this),this.element=e.element?e.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=e.render?e.render:L,e.target&&this.setTarget(e.target)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){Qn(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&Qn(this.element);for(var e=0,r=this.listenerKeys.length;e<r;++e)_(this.listenerKeys[e]);(this.listenerKeys.length=0,this.map_=t,this.map_)&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==L&&this.listenerKeys.push(C(t,Xt.POSTRENDER,this.render,this)),t.render())},e.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},e}(D),hi="ol-hidden",di="ol-selectable",pi="ol-unselectable",fi="ol-control",gi="ol-collapsed",yi=(li={},function(t){if(si||(si=document.createElement("div").style),!(t in li)){si.font=t;var e=si.fontFamily;if(si.font="",!e)return null;li[t]=e.split(/,\s?/)}return li[t]});function mi(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}var Ci=function(t){function e(e){var r=u({},e);delete r.source,t.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),C(this,N(ei.SOURCE),this.handleSourcePropertyChange_,this);var n=e.source?e.source:null;this.setSource(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(ei.SOURCE)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():ni.UNDEFINED},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(_(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=C(t,R.CHANGE,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(_(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(_(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=C(t,Jt.PRECOMPOSE,function(t){var e=t,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),e.frameState.layerStatesArray.push(r),e.frameState.layerStates[o(this)]=r},this),this.mapRenderKey_=C(this,R.CHANGE,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(ei.SOURCE,t)},e}(ri);function vi(t){this.updateElement_(t.frameState)}var Ti=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||vi,target:r.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===r.collapsed||r.collapsed,this.overrideCollapsible_=void 0!==r.collapsible,this.collapsible_=void 0===r.collapsible||r.collapsible,this.collapsible_||(this.collapsed_=!1);var n=void 0!==r.className?r.className:"ol-attribution",i=void 0!==r.tipLabel?r.tipLabel:"Attributions",o=void 0!==r.collapseLabel?r.collapseLabel:"\xbb";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;var a=void 0!==r.label?r.label:"i";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a):this.label_=a;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(s),C(l,R.CLICK,this.handleClick_,this);var c=n+" "+pi+" "+fi+(this.collapsed_&&this.collapsible_?" "+gi:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.ulElement_),u.appendChild(l),this.renderedAttributions_=[],this.renderedVisible_=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.collectSourceAttributions_=function(t){for(var e={},r=[],n=t.layerStatesArray,i=t.viewState.resolution,o=0,a=n.length;o<a;++o){var s=n[o];if(mi(s,i)){var l=s.layer.getSource();if(l){var c=l.getAttributions();if(c){var u=c(t);if(u)if(this.overrideCollapsible_||!1!==l.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(u))for(var h=0,d=u.length;h<d;++h)u[h]in e||(r.push(u[h]),e[u[h]]=!0);else u in e||(r.push(u),e[u]=!0)}}}}return r},e.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!Ut(e,this.renderedAttributions_)){ti(this.ulElement_);for(var n=0,i=e.length;n<i;++n){var o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(gi),this.collapsed_?Jn(this.collapseLabel_,this.label_):Jn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e}(ui);function _i(t){var e=t.frameState;if(e){var r=e.viewState.rotation;if(r!=this.rotation_){var n="rotate("+r+"rad)";if(this.autoHide_){var i=this.element.classList.contains(hi);i||0!==r?i&&0!==r&&this.element.classList.remove(hi):this.element.classList.add(hi)}this.label_.style.msTransform=n,this.label_.style.webkitTransform=n,this.label_.style.transform=n}this.rotation_=r}}var Si=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||_i,target:r.target});var n=void 0!==r.className?r.className:"ol-rotate",i=void 0!==r.label?r.label:"\u21e7";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=i):(this.label_=i,this.label_.classList.add("ol-compass"));var o=r.tipLabel?r.tipLabel:"Reset rotation",a=document.createElement("button");a.className=n+"-reset",a.setAttribute("type","button"),a.title=o,a.appendChild(this.label_),C(a,R.CLICK,this.handleClick_,this);var s=n+" "+pi+" "+fi,l=this.element;l.className=s,l.appendChild(a),this.callResetNorth_=r.resetNorth?r.resetNorth:void 0,this.duration_=void 0!==r.duration?r.duration:250,this.autoHide_=void 0===r.autoHide||r.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(hi)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();t&&void 0!==t.getRotation()&&(this.duration_>0?t.animate({rotation:0,duration:this.duration_,easing:xe}):t.setRotation(0))},e}(ui),Ei=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),target:r.target});var n=void 0!==r.className?r.className:"ol-zoom",i=void 0!==r.delta?r.delta:1,o=void 0!==r.zoomInLabel?r.zoomInLabel:"+",a=void 0!==r.zoomOutLabel?r.zoomOutLabel:"\u2212",s=void 0!==r.zoomInTipLabel?r.zoomInTipLabel:"Zoom in",l=void 0!==r.zoomOutTipLabel?r.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n+"-in",c.setAttribute("type","button"),c.title=s,c.appendChild("string"==typeof o?document.createTextNode(o):o),C(c,R.CLICK,this.handleClick_.bind(this,i));var u=document.createElement("button");u.className=n+"-out",u.setAttribute("type","button"),u.title=l,u.appendChild("string"==typeof a?document.createTextNode(a):a),C(u,R.CLICK,this.handleClick_.bind(this,-i));var h=n+" "+pi+" "+fi,d=this.element;d.className=h,d.appendChild(c),d.appendChild(u),this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var r=e.getResolution();if(r){var n=e.constrainResolution(r,t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:n,duration:this.duration_,easing:xe})):e.setResolution(n)}}},e}(ui),wi=function(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0};wi.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},wi.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},wi.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var r=e-3;r>0&&this.points_[r+2]>t;)r-=3;var n=this.points_[e+2]-this.points_[r+2];if(n<1e3/60)return!1;var i=this.points_[e]-this.points_[r],o=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/n,this.initialVelocity_>this.minVelocity_},wi.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},wi.prototype.getAngle=function(){return this.angle_};var bi=wi,Li={ACTIVE:"active"};function Ai(t,e,r,n){e=t.constrainRotation(e,0),xi(t,e,r,n)}function xi(t,e,r,n){if(void 0!==e){var i=t.getRotation(),o=t.getCenter();void 0!==i&&o&&n>0?t.animate({rotation:e,anchor:r,duration:n,easing:xe}):t.rotate(e,r)}}function Pi(t,e,r,n){var i=t.getResolution(),o=t.constrainResolution(i,e,0);if(void 0!==o){var a=t.getResolutions();o=oe(o,t.getMinResolution()||a[a.length-1],t.getMaxResolution()||a[0])}if(r&&void 0!==o&&o!==i){var s=t.getCenter(),l=t.calculateCenterZoom(o,r);l=t.constrainCenter(l),r=[(o*s[0]-i*l[0])/(o-i),(o*s[1]-i*l[1])/(o-i)]}Ii(t,o,r,n)}function Ii(t,e,r,n){if(e){var i=t.getResolution(),o=t.getCenter();if(void 0!==i&&o&&e!==i&&n)t.animate({resolution:e,anchor:r,duration:n,easing:xe});else{if(r){var a=t.calculateCenterZoom(e,r);t.setCenter(a)}t.setResolution(e)}}}var Ri=function(t){function e(e){t.call(this),e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getActive=function(){return this.get(Li.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(Li.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(D);function Oi(t){var e=!1;if(t.type==J.DBLCLICK){var r=t.originalEvent,n=t.map,i=t.coordinate,o=r.shiftKey?-this.delta_:this.delta_;Pi(n.getView(),o,i,this.duration_),t.preventDefault(),e=!0}return!e}var Mi=function(t){function e(e){t.call(this,{handleEvent:Oi});var r=e||{};this.delta_=r.delta?r.delta:1,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ri),ki=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ni=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Di=function(t){return t.target.getTargetElement()===document.activeElement},Fi=w,Bi=function(t){var e=t.originalEvent;return 0==e.button&&!(V&&Y&&e.ctrlKey)},Gi=b,Ui=function(t){return"pointermove"==t.type},ji=function(t){return t.type==J.SINGLECLICK},qi=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Wi=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Hi=function(t){var e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},Vi=function(t){var e=t.pointerEvent;return te(void 0!==e,56),"mouse"==e.pointerType},Yi=function(t){var e=t.pointerEvent;return te(void 0!==e,56),e.isPrimary&&0===e.button};function zi(t){for(var e=t.length,r=0,n=0,i=0;i<e;i++)r+=t[i].clientX,n+=t[i].clientY;return[r/e,n/e]}var Ki=function(t){function e(e){var r=e||{};t.call(this,r),r.handleDownEvent&&(this.handleDownEvent=r.handleDownEvent),r.handleDragEvent&&(this.handleDragEvent=r.handleDragEvent),r.handleMoveEvent&&(this.handleMoveEvent=r.handleMoveEvent),r.handleUpEvent&&(this.handleUpEvent=r.handleUpEvent),r.stopDown&&(this.stopDown=r.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==J.POINTERDRAG)this.handleDragEvent(t);else if(t.type==J.POINTERUP){var r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==J.POINTERDOWN){var n=this.handleDownEvent(t);n&&t.preventDefault(),this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==J.POINTERMOVE&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(function(t){var e=t.type;return e===J.POINTERDOWN||e===J.POINTERDRAG||e===J.POINTERUP}(t)){var e=t.pointerEvent,r=e.pointerId.toString();t.type==J.POINTERUP?delete this.trackedPointers_[r]:t.type==J.POINTERDOWN?this.trackedPointers_[r]=e:r in this.trackedPointers_&&(this.trackedPointers_[r]=e),this.targetPointers=d(this.trackedPointers_)}},e}(Ri),$i=function(t){function e(e){t.call(this,{stopDown:b});var r=e||{};this.kinetic_=r.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=r.condition?r.condition:qi,this.noKinetic_=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().setHint(1,1));var e=this.targetPointers,r=zi(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var n=this.lastCentroid[0]-r[0],i=r[1]-this.lastCentroid[1],o=t.map.getView(),a=[n,i];Ee(a,o.getResolution()),Se(a,o.getRotation()),ve(a,o.getCenter()),a=o.constrainCenter(a),o.setCenter(a)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=e.length},e.prototype.handleUpEvent=function(t){var e=t.map,r=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),o=r.getCenter(),a=e.getPixelFromCoordinate(o),s=e.getCoordinateFromPixel([a[0]-n*Math.cos(i),a[1]-n*Math.sin(i)]);r.animate({center:r.constrainCenter(s),duration:500,easing:xe})}return this.panning_&&(this.panning_=!1,r.setHint(1,-1)),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.setCenter(t.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(Ki),Xi=function(t){function e(e){var r=e||{};t.call(this,{stopDown:b}),this.condition_=r.condition?r.condition:Ni,this.lastAngle_=void 0,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){if(Vi(t)){var e=t.map,r=e.getView();if(r.getConstraints().rotation!==pe){var n=e.getSize(),i=t.pixel,o=Math.atan2(n[1]/2-i[1],i[0]-n[0]/2);if(void 0!==this.lastAngle_){var a=o-this.lastAngle_,s=r.getRotation();xi(r,s-a)}this.lastAngle_=o}}},e.prototype.handleUpEvent=function(t){if(!Vi(t))return!0;var e=t.map.getView();e.setHint(1,-1);var r=e.getRotation();return Ai(e,r,void 0,this.duration_),!1},e.prototype.handleDownEvent=function(t){return!(!Vi(t)||!Bi(t)||!this.condition_(t)||(t.map.getView().setHint(1,1),this.lastAngle_=void 0,0))},e}(Ki),Zi=function(t){function e(e){t.call(this),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,r=this.element_.style;r.left=Math.min(t[0],e[0])+"px",r.top=Math.min(t[1],e[1])+"px",r.width=Math.abs(e[0]-t[0])+"px",r.height=Math.abs(e[1]-t[1])+"px"},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=e.top=e.width=e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixel,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Wn([r])},e.prototype.getGeometry=function(){return this.geometry_},e}(E),Ji=function(t){function e(e,r,n){t.call(this,e),this.coordinate=r,this.mapBrowserEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function Qi(){var t,e=this.getMap(),r=e.getView(),n=e.getSize(),i=this.getGeometry().getExtent();if(this.out_){var o=r.calculateExtent(n),a=(t=[e.getPixelFromCoordinate(Je(i)),e.getPixelFromCoordinate(ar(i))],function(t,e){for(var r=0,n=e.length;r<n;++r)ze(t,e[r]);return t}(qe(void 0),t));ur(o,1/r.getResolutionForExtent(a,n)),i=o}var s=r.constrainResolution(r.getResolutionForExtent(i,n)),l=tr(i);l=r.constrainCenter(l),r.animate({resolution:s,center:l,duration:this.duration_,easing:xe})}var to=function(t){function e(e){var r=e||{},n=r.condition?r.condition:Wi;t.call(this,{condition:n,className:r.className||"ol-dragzoom",onBoxEnd:Qi}),this.duration_=void 0!==r.duration?r.duration:200,this.out_=void 0!==r.out&&r.out}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e){t.call(this);var r=e||{};this.box_=new Zi(r.className||"ol-dragbox"),this.minArea_=void 0!==r.minArea?r.minArea:64,this.onBoxEnd_=r.onBoxEnd?r.onBoxEnd:L,this.startPixel_=null,this.condition_=r.condition?r.condition:Fi,this.boxEndCondition_=r.boxEndCondition?r.boxEndCondition:this.defaultBoxEndCondition}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.defaultBoxEndCondition=function(t,e,r){var n=r[0]-e[0],i=r[1]-e[1];return n*n+i*i>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){Vi(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ji("boxdrag",t.coordinate,t)))},e.prototype.handleUpEvent=function(t){return!Vi(t)||(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new Ji("boxend",t.coordinate,t))),!1)},e.prototype.handleDownEvent=function(t){return!(!Vi(t)||!Bi(t)||!this.condition_(t)||(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ji("boxstart",t.coordinate,t)),0))},e}(Ki)),eo={LEFT:37,UP:38,RIGHT:39,DOWN:40};function ro(t){var e=!1;if(t.type==R.KEYDOWN){var r=t.originalEvent.keyCode;if(this.condition_(t)&&(r==eo.DOWN||r==eo.LEFT||r==eo.RIGHT||r==eo.UP)){var n=t.map.getView(),i=n.getResolution()*this.pixelDelta_,o=0,a=0;r==eo.DOWN?a=-i:r==eo.LEFT?o=-i:r==eo.RIGHT?o=i:a=i;var s=[o,a];Se(s,n.getRotation()),function(t,e,r){var n=t.getCenter();if(n){var i=t.constrainCenter([n[0]+e[0],n[1]+e[1]]);r?t.animate({duration:r,easing:Ie,center:i}):t.setCenter(i)}}(n,s,this.duration_),t.preventDefault(),e=!0}}return!e}var no=function(t){function e(e){t.call(this,{handleEvent:ro});var r=e||{};this.defaultCondition_=function(t){return qi(t)&&Hi(t)},this.condition_=void 0!==r.condition?r.condition:this.defaultCondition_,this.duration_=void 0!==r.duration?r.duration:100,this.pixelDelta_=void 0!==r.pixelDelta?r.pixelDelta:128}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ri);function io(t){var e=!1;if(t.type==R.KEYDOWN||t.type==R.KEYPRESS){var r=t.originalEvent.charCode;if(this.condition_(t)&&(r=="+".charCodeAt(0)||r=="-".charCodeAt(0))){var n=t.map,i=r=="+".charCodeAt(0)?this.delta_:-this.delta_;Pi(n.getView(),i,void 0,this.duration_),t.preventDefault(),e=!0}}return!e}var oo=function(t){function e(e){t.call(this,{handleEvent:io});var r=e||{};this.condition_=r.condition?r.condition:Hi,this.delta_=r.delta?r.delta:1,this.duration_=void 0!==r.duration?r.duration:100}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ri),ao="trackpad",so=function(t){function e(e){var r=e||{};t.call(this,r),this.delta_=0,this.duration_=void 0!==r.duration?r.duration:250,this.timeout_=void 0!==r.timeout?r.timeout:80,this.useAnchor_=void 0===r.useAnchor||r.useAnchor,this.constrainResolution_=r.constrainResolution||!1,this.condition_=r.condition?r.condition:Fi,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().setHint(1,-1)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==R.WHEEL&&e!==R.MOUSEWHEEL)return!0;t.preventDefault();var r,n=t.map,i=t.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==R.WHEEL?(r=i.deltaY,W&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=z),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)):t.type==R.MOUSEWHEEL&&(r=-i.wheelDeltaY,H&&(r/=3)),0===r)return!1;var o=Date.now();if(void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?ao:"wheel"),this.mode_===ao){var a=n.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):a.setHint(1,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var s=a.getResolution()*Math.pow(2,r/this.trackpadDeltaPerZoom_),l=a.getMinResolution(),c=a.getMaxResolution(),u=0;if(s<l?(s=Math.max(s,l/this.trackpadZoomBuffer_),u=1):s>c&&(s=Math.min(s,c*this.trackpadZoomBuffer_),u=-1),this.lastAnchor_){var h=a.calculateCenterZoom(s,this.lastAnchor_);a.setCenter(a.constrainCenter(h))}return a.setResolution(s),0===u&&this.constrainResolution_&&a.animate({resolution:a.constrainResolution(s,r>0?-1:1),easing:xe,anchor:this.lastAnchor_,duration:this.duration_}),u>0?a.animate({resolution:l,easing:xe,anchor:this.lastAnchor_,duration:500}):u<0&&a.animate({resolution:c,easing:xe,anchor:this.lastAnchor_,duration:500}),this.startTime_=o,!1}this.delta_+=r;var d=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),d),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();Pi(e,-oe(this.delta_,-1,1),this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(Ri),lo=function(t){function e(e){var r=e||{},n=r;n.stopDown||(n.stopDown=b),t.call(this,n),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==r.threshold?r.threshold:.3,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var e=0,r=this.targetPointers[0],n=this.targetPointers[1],i=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){var o=i-this.lastAngle_;this.rotationDelta_+=o,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=o}this.lastAngle_=i;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==pe){var l=a.getViewport().getBoundingClientRect(),c=zi(this.targetPointers);if(c[0]-=l.left,c[1]-=l.top,this.anchor_=a.getCoordinateFromPixel(c),this.rotating_){var u=s.getRotation();a.render(),xi(s,u+e,this.anchor_)}}},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();if(e.setHint(1,-1),this.rotating_){var r=e.getRotation();Ai(e,r,this.anchor_,this.duration_)}return!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().setHint(1,1),!0}return!1},e}(Ki),co=function(t){function e(e){var r=e||{},n=r;n.stopDown||(n.stopDown=b),t.call(this,n),this.constrainResolution_=r.constrainResolution||!1,this.anchor_=null,this.duration_=void 0!==r.duration?r.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var e=1,r=this.targetPointers[0],n=this.targetPointers[1],i=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var s=t.map,l=s.getView(),c=l.getResolution(),u=l.getMaxResolution(),h=l.getMinResolution(),d=c*e;d>u?(e=u/c,d=u):d<h&&(e=h/c,d=h),1!=e&&(this.lastScaleDelta_=e);var p=s.getViewport().getBoundingClientRect(),f=zi(this.targetPointers);f[0]-=p.left,f[1]-=p.top,this.anchor_=s.getCoordinateFromPixel(f),s.render(),Ii(l,d,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(1,-1);var r=e.getResolution();if(this.constrainResolution_||r<e.getMinResolution()||r>e.getMaxResolution()){var n=this.lastScaleDelta_-1;!function(t,e,r,n,i){e=t.constrainResolution(e,0,i),Ii(t,e,r,n)}(e,r,this.anchor_,this.duration_,n)}return!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().setHint(1,1),!0}return!1},e}(Ki);function uo(t){var e=t||{},r=new G,n=new bi(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&r.push(new Xi),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&r.push(new Mi({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&r.push(new $i({condition:e.onFocusOnly?Di:void 0,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&r.push(new lo),(void 0===e.pinchZoom||e.pinchZoom)&&r.push(new co({constrainResolution:e.constrainResolution,duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(r.push(new no),r.push(new oo({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&r.push(new so({condition:e.onFocusOnly?Di:void 0,constrainResolution:e.constrainResolution,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&r.push(new to({duration:e.zoomDuration})),r}var ho=.5,po=function(t){function e(e,r,n,i){t.call(this),this.extent=e,this.pixelRatio_=n,this.resolution=r,this.state=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(R.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return n()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){n()},e}(I),fo={IDLE:0,LOADING:1,LOADED:2,ERROR:3},go=function(t){function e(e,r,n,i,o){var a=void 0!==o?fo.IDLE:fo.LOADED;t.call(this,e,r,n,a),this.loader_=void 0!==o?o:null,this.canvas_=i,this.error_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=fo.ERROR):this.state=fo.LOADED,this.changed()},e.prototype.load=function(){this.state==fo.IDLE&&(this.state=fo.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(po),yo={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"},mo={IMAGE:"image",VECTOR:"vector"},Co=function(t){function e(e,r,n,i,o){t.call(this,e),this.vectorContext=r,this.frameState=n,this.context=i,this.glContext=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),vo=function(t){function e(e){t.call(this),this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(R.CLEAR)},e.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},e.prototype.forEach=function(t,e){for(var r=this.oldest_;r;)t.call(e,r.value_,r.key_,this),r=r.newer},e.prototype.get=function(t){var e=this.entries_[t];return te(void 0!==e,15),e===this.newest_?e.value_:(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e,e.value_)},e.prototype.remove=function(t){var e=this.entries_[t];return te(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},e.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},e.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},e.prototype.set=function(t,e){te(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_},e.prototype.setSize=function(t){this.highWaterMark=t},e.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},e}(I),To=[0,0,0,1],_o=[],So=[0,0,0,1],Eo=[0,0,0,0],wo=new vo,bo={},Lo=null,Ao={},xo=function(){var t,e,r=60,n=bo,i="32px ",o=["monospace","serif"],a=o.length,s="wmytzilWMYTZIL@#/&?$%10\uf013";function l(t){for(var r=Po(),n=100;n<=700;n+=300){for(var l=n+" ",c=!0,u=0;u<a;++u){var h=o[u];if(r.font=l+i+h,e=r.measureText(s).width,t!=h){r.font=l+i+t+","+h;var d=r.measureText(s).width;c=c&&d!=e}}if(c)return!0}return!1}function c(){var e=!0;for(var i in n)n[i]<r&&(l(i)?(n[i]=r,h(Ao),Lo=null,wo.clear()):(++n[i],e=!1));e&&(clearInterval(t),t=void 0)}return function(e){var i=yi(e);if(i)for(var o=0,a=i.length;o<a;++o){var s=i[o];s in n||(n[s]=r,l(s)||(n[s]=0,void 0===t&&(t=setInterval(c,32))))}}}();function Po(){return Lo||(Lo=$n(1,1)),Lo}var Io,Ro,Oo=(Ro=Ao,function(t){var e=Ro[t];return null==e&&(Io||((Io=document.createElement("span")).textContent="M",Io.style.margin=Io.style.padding="0 !important",Io.style.position="absolute !important",Io.style.left="-99999px !important"),Io.style.font=t,document.body.appendChild(Io),e=Ro[t]=Io.offsetHeight,document.body.removeChild(Io)),e});function Mo(t,e){var r=Po();return t!=r.font&&(r.font=t),r.measureText(e).width}function ko(t,e,r,n){0!==e&&(t.translate(r,n),t.rotate(e),t.translate(-r,-n))}var No=[1,0,0,1,0,0];function Do(t,e,r,n,i,o,a,s,l,c,u){var h;1!=r&&(h=t.globalAlpha,t.globalAlpha=h*r),e&&t.setTransform.apply(t,e),t.drawImage(n,i,o,a,s,l,c,a*u,s*u),h&&(t.globalAlpha=h),e&&t.setTransform.apply(t,No)}var Fo=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Bo=/^([a-z]*)$/i;function Go(t){return"string"==typeof t?t:Wo(t)}var Uo=function(){var t={},e=0;return function(r){var n;if(t.hasOwnProperty(r))n=t[r];else{if(e>=1024){var i=0;for(var o in t)0==(3&i++)&&(delete t[o],--e)}n=function(t){var e,r,n,i,o;Bo.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}(t));if(Fo.exec(t)){var a,s=t.length-1;a=s<=4?1:2;var l=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),r=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),i=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,l&&(i=(i<<4)+i)),o=[e,r,n,i/255]}else 0==t.indexOf("rgba(")?qo(o=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((o=t.slice(4,-1).split(",").map(Number)).push(1),qo(o)):te(!1,14);return o}(r),t[r]=n,++e}return n}}();function jo(t){return Array.isArray(t)?t:Uo(t)}function qo(t){return t[0]=oe(t[0]+.5|0,0,255),t[1]=oe(t[1]+.5|0,0,255),t[2]=oe(t[2]+.5|0,0,255),t[3]=oe(t[3],0,1),t}function Wo(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:t[3])+")"}function Ho(t){return Array.isArray(t)?Wo(t):t}var Vo=function(){};Vo.prototype.drawCustom=function(t,e,r){},Vo.prototype.drawGeometry=function(t){},Vo.prototype.setStyle=function(t){},Vo.prototype.drawCircle=function(t,e){},Vo.prototype.drawFeature=function(t,e){},Vo.prototype.drawGeometryCollection=function(t,e){},Vo.prototype.drawLineString=function(t,e){},Vo.prototype.drawMultiLineString=function(t,e){},Vo.prototype.drawMultiPoint=function(t,e){},Vo.prototype.drawMultiPolygon=function(t,e){},Vo.prototype.drawPoint=function(t,e){},Vo.prototype.drawPolygon=function(t,e){},Vo.prototype.drawText=function(t,e){},Vo.prototype.setFillStrokeStyle=function(t,e){},Vo.prototype.setImageStyle=function(t,e){},Vo.prototype.setTextStyle=function(t,e){};var Yo=Vo,zo=function(t){function e(e,r,n,i,o){t.call(this),this.context_=e,this.pixelRatio_=r,this.extent_=n,this.transform_=i,this.viewRotation_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawImages_=function(t,e,r,n){if(this.image_){var i=pr(t,e,r,2,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var c=0,u=i.length;c<u;c+=2){var h=i[c]-this.imageAnchorX_,d=i[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_){var p=h+this.imageAnchorX_,f=d+this.imageAnchorY_;an(a,p,f,this.imageScale_,this.imageScale_,l,-p,-f),o.setTransform.apply(o,a)}o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,d,this.imageWidth_,this.imageHeight_)}0===l&&1==this.imageScale_||o.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(o.globalAlpha=s)}},e.prototype.drawText_=function(t,e,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var i=pr(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){var s=i[e]+this.textOffsetX_,l=i[e+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_){var c=an(this.tmpLocalTransform_,s,l,this.textScale_,this.textScale_,a,-s,-l);o.setTransform.apply(o,c)}this.textStrokeState_&&o.strokeText(this.text_,s,l),this.textFillState_&&o.fillText(this.text_,s,l)}0===a&&1==this.textScale_||o.setTransform(1,0,0,1,0,0)}},e.prototype.moveToLineTo_=function(t,e,r,n,i){var o=this.context_,a=pr(t,e,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);var s=a.length;i&&(s-=2);for(var l=2;l<s;l+=2)o.lineTo(a[l],a[l+1]);return i&&o.closePath(),r},e.prototype.drawRings_=function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)e=this.moveToLineTo_(t,e,r[i],n,!0);return e},e.prototype.drawCircle=function(t){if(lr(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,r){var n=t.getFlatCoordinates();if(n){var i=t.getStride();return pr(n,0,n.length,i,e,r)}return null}(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.drawGeometry=function(t){switch(t.getType()){case hr.POINT:this.drawPoint(t);break;case hr.LINE_STRING:this.drawLineString(t);break;case hr.POLYGON:this.drawPolygon(t);break;case hr.MULTI_POINT:this.drawMultiPoint(t);break;case hr.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case hr.MULTI_POLYGON:this.drawMultiPolygon(t);break;case hr.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case hr.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var r=e.getGeometryFunction()(t);r&&lr(this.extent_,r.getExtent())&&(this.setStyle(e),this.drawGeometry(r))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])},e.prototype.drawPoint=function(t){var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawMultiPoint=function(t){var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawLineString=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiLineString=function(t){var e=t.getExtent();if(lr(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getFlatCoordinates(),i=0,o=t.getEnds(),a=t.getStride();r.beginPath();for(var s=0,l=o.length;s<l;++s)i=this.moveToLineTo_(n,i,o[s],a,!1);r.stroke()}if(""!==this.text_){var c=t.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},e.prototype.drawPolygon=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getOrientedFlatCoordinates(),n=0,i=t.getEndss(),o=t.getStride();e.beginPath();for(var a=0,s=i.length;a<s;++a){var l=i[a];n=this.drawRings_(r,n,l,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var c=t.getFlatInteriorPoints();this.drawText_(c,0,c.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=e.lineCap=t.lineCap),K&&(Ut(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset=t.lineDashOffset)),r.lineJoin!=t.lineJoin&&(r.lineJoin=e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,K&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:"center";r?(r.font!=t.font&&(r.font=e.font=t.font),r.textAlign!=n&&(r.textAlign=e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){if(t){var r=t.getColor();this.fillState_={fillStyle:Ho(r||To)}}else this.fillState_=null;if(e){var n=e.getColor(),i=e.getLineCap(),o=e.getLineDash(),a=e.getLineDashOffset(),s=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit();this.strokeState_={lineCap:void 0!==i?i:"round",lineDash:o||_o,lineDashOffset:a||0,lineJoin:void 0!==s?s:"round",lineWidth:this.pixelRatio_*(void 0!==l?l:1),miterLimit:void 0!==c?c:10,strokeStyle:Ho(n||So)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),r=t.getImage(1),n=t.getOrigin(),i=t.getSize();this.imageAnchorX_=e[0],this.imageAnchorY_=e[1],this.imageHeight_=i[1],this.image_=r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageWidth_=i[0]}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var r=e.getColor();this.textFillState_={fillStyle:Ho(r||To)}}else this.textFillState_=null;var n=t.getStroke();if(n){var i=n.getColor(),o=n.getLineCap(),a=n.getLineDash(),s=n.getLineDashOffset(),l=n.getLineJoin(),c=n.getWidth(),u=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:"round",lineDash:a||_o,lineDashOffset:s||0,lineJoin:void 0!==l?l:"round",lineWidth:void 0!==c?c:1,miterLimit:void 0!==u?u:10,strokeStyle:Ho(i||So)}}else this.textStrokeState_=null;var h=t.getFont(),d=t.getOffsetX(),p=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation(),y=t.getScale(),m=t.getText(),C=t.getTextAlign(),v=t.getTextBaseline();this.textState_={font:void 0!==h?h:"10px sans-serif",textAlign:void 0!==C?C:"center",textBaseline:void 0!==v?v:"middle"},this.text_=void 0!==m?m:"",this.textOffsetX_=void 0!==d?this.pixelRatio_*d:0,this.textOffsetY_=void 0!==p?this.pixelRatio_*p:0,this.textRotateWithView_=void 0!==f&&f,this.textRotation_=void 0!==g?g:0,this.textScale_=this.pixelRatio_*(void 0!==y?y:1)}else this.text_=""},e}(Yo),Ko=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};function $o(t,e,r){return e+":"+t+":"+(r?Go(r):"null")}Ko.prototype.clear=function(){this.cache_={},this.cacheSize_=0},Ko.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t=0;for(var e in this.cache_){var r=this.cache_[e];0!=(3&t++)||r.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},Ko.prototype.get=function(t,e,r){var n=$o(t,e,r);return n in this.cache_?this.cache_[n]:null},Ko.prototype.set=function(t,e,r,n){var i=$o(t,e,r);this.cache_[i]=n,++this.cacheSize_},Ko.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()};var Xo=new Ko;function Zo(t,e){Xo.expire()}function Jo(t,e){return t.zIndex-e.zIndex}var Qo=[],ta=function(t){function e(e){t.call(this,e);var r=e.getViewport();this.context_=$n(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=pi,r.insertBefore(this.canvas_,r.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,e){var r=this.getMap(),n=this.context_;if(r.hasListener(t)){var i=e.extent,o=e.pixelRatio,a=e.viewState.rotation,s=this.getTransform(e),l=new zo(n,o,i,s,a),c=new Co(t,l,e,n,null);r.dispatchEvent(c)}},e.prototype.getTransform=function(t){var e=t.viewState,r=this.canvas_.width/2,n=this.canvas_.height/2,i=t.pixelRatio/e.resolution,o=-i,a=-e.rotation,s=-e.center[0],l=-e.center[1];return an(this.transform_,r,n,i,o,a,s,l)},e.prototype.renderFrame=function(t){if(t){var e=this.context_,r=t.pixelRatio,n=Math.round(t.size[0]*r),i=Math.round(t.size[1]*r);this.canvas_.width!=n||this.canvas_.height!=i?(this.canvas_.width=n,this.canvas_.height=i):e.clearRect(0,0,n,i);var o=t.viewState.rotation;this.calculateMatrices2D(t),this.dispatchRenderEvent(Jt.PRECOMPOSE,t);var a=t.layerStatesArray;!function(t,e){var r,n=t.length,i=Array(t.length);for(r=0;r<n;r++)i[r]={index:r,value:t[r]};for(i.sort(function(t,r){return e(t.value,r.value)||t.index-r.index}),r=0;r<t.length;r++)t[r]=i[r].value}(a,Jo),o&&(e.save(),ko(e,o,n/2,i/2));var s,l,c=t.viewState.resolution;for(s=0,l=a.length;s<l;++s){var u=a[s],h=u.layer,d=this.getLayerRenderer(h);mi(u,c)&&u.sourceState==ni.READY&&d.prepareFrame(t,u)&&d.composeFrame(t,u,e)}o&&e.restore(),this.dispatchRenderEvent(Jt.POSTCOMPOSE,t),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(t,e,r,n,i,o,a){var s,l,c=e.viewState.resolution,u=e.layerStatesArray,h=u.length,d=rn(e.pixelToCoordinateTransform,t.slice());for(l=h-1;l>=0;--l){var p=u[l],f=p.layer;if(mi(p,c)&&o.call(a,f)&&(s=this.getLayerRenderer(f).forEachLayerAtCoordinate(d,e,r,n,i)))return s}},e.prototype.registerLayerRenderers=function(e){t.prototype.registerLayerRenderers.call(this,e);for(var r=0,n=e.length;r<n;++r){var i=e[r];Nt(Qo,i)||Qo.push(i)}},e}(function(t){function e(e){t.call(this),this.map_=e,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,e){n()},e.prototype.registerLayerRenderers=function(t){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,t)},e.prototype.calculateMatrices2D=function(t){var e=t.viewState,r=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;an(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),function(t){var e,r=(e=t)[0]*e[3]-e[1]*e[2];te(0!==r,32);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5];t[0]=a/r,t[1]=-i/r,t[2]=-o/r,t[3]=n/r,t[4]=(o*l-a*s)/r,t[5]=-(n*l-i*s)/r}(en(n,r))},e.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,a,s){var l,c=e.viewState,u=c.resolution;function h(t,r){var a=e.layerStates[o(r)].managed;if(!(o(t)in e.skippedFeatureUids)||a)return n.call(i,t,a?r:null)}var d=c.projection,p=t;if(d.canWrapX()){var f=d.getExtent(),g=sr(f),y=t[0];(y<f[0]||y>f[2])&&(p=[y+g*Math.ceil((f[0]-y)/g),t[1]])}var m,C=e.layerStatesArray;for(m=C.length-1;m>=0;--m){var v=C[m],T=v.layer;if(mi(v,u)&&a.call(s,T)){var _=this.getLayerRenderer(T),S=T.getSource();if(S&&(l=_.forEachFeatureAtCoordinate(S.getWrapX()?p:t,e,r,h)),l)return l}}},e.prototype.forEachLayerAtPixel=function(t,e,r,i,o,a,s){return n()},e.prototype.hasFeatureAtCoordinate=function(t,e,r,n,i){return void 0!==this.forEachFeatureAtCoordinate(t,e,r,w,this,n,i)},e.prototype.getLayerRenderer=function(t){var e=o(t);if(e in this.layerRenderers_)return this.layerRenderers_[e];for(var r,n=0,i=this.layerRendererConstructors_.length;n<i;++n){var a=this.layerRendererConstructors_[n];if(a.handles(t)){r=a.create(this,t);break}}if(!r)throw new Error("Unable to create renderer for layer: "+t.getType());return this.layerRenderers_[e]=r,this.layerRendererListeners_[e]=C(r,R.CHANGE,this.handleLayerRendererChange_,this),r},e.prototype.getLayerRendererByKey=function(t){return this.layerRenderers_[t]},e.prototype.getLayerRenderers=function(){return this.layerRenderers_},e.prototype.getMap=function(){return this.map_},e.prototype.handleLayerRendererChange_=function(){this.map_.render()},e.prototype.removeLayerRendererByKey_=function(t){var e=this.layerRenderers_[t];return delete this.layerRenderers_[t],_(this.layerRendererListeners_[t]),delete this.layerRendererListeners_[t],e},e.prototype.removeUnusedLayerRenderers_=function(t,e){for(var r in this.layerRenderers_)e&&r in e.layerStates||this.removeLayerRendererByKey_(r).dispose()},e.prototype.renderFrame=function(t){n()},e.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(Zo)},e.prototype.scheduleRemoveUnusedLayerRenderers=function(t){for(var e in this.layerRenderers_)if(!(e in t.layerStates))return void t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))},e}(E)),ea=function(t){function e(e){t.call(this,e),this.renderedResolution,this.transform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clip=function(t,e,r){var n=e.pixelRatio,i=e.size[0]*n,o=e.size[1]*n,a=e.viewState.rotation,s=or(r),l=ar(r),c=Qe(r),u=Je(r);rn(e.coordinateToPixelTransform,s),rn(e.coordinateToPixelTransform,l),rn(e.coordinateToPixelTransform,c),rn(e.coordinateToPixelTransform,u),t.save(),ko(t,-a,i/2,o/2),t.beginPath(),t.moveTo(s[0]*n,s[1]*n),t.lineTo(l[0]*n,l[1]*n),t.lineTo(c[0]*n,c[1]*n),t.lineTo(u[0]*n,u[1]*n),t.clip(),ko(t,a,i/2,o/2)},e.prototype.dispatchComposeEvent_=function(t,e,r,n){var i=this.getLayer();if(i.hasListener(t)){var o=r.size[0]*r.pixelRatio,a=r.size[1]*r.pixelRatio,s=r.viewState.rotation;ko(e,-s,o/2,a/2);var l=void 0!==n?n:this.getTransform(r,0),c=new zo(e,r.pixelRatio,r.extent,l,r.viewState.rotation),u=new Co(t,c,r,e,null);i.dispatchEvent(u),ko(e,s,o/2,a/2)}},e.prototype.forEachLayerAtCoordinate=function(t,e,r,n,i){return this.forEachFeatureAtCoordinate(t,e,r,w)?n.call(i,this.getLayer(),null):void 0},e.prototype.postCompose=function(t,e,r,n){this.dispatchComposeEvent_(Jt.POSTCOMPOSE,t,e,n)},e.prototype.preCompose=function(t,e,r){this.dispatchComposeEvent_(Jt.PRECOMPOSE,t,e,r)},e.prototype.dispatchRenderEvent=function(t,e,r){this.dispatchComposeEvent_(Jt.RENDER,t,e,r)},e.prototype.getTransform=function(t,e){var r=t.viewState,n=t.pixelRatio,i=n*t.size[0]/2,o=n*t.size[1]/2,a=n/r.resolution,s=-a,l=-r.rotation,c=-r.center[0]+e,u=-r.center[1];return an(this.transform_,i,o,a,s,l,c,u)},e.prototype.composeFrame=function(t,e,r){n()},e.prototype.prepareFrame=function(t,e){return n()},e}(function(t){function e(e){t.call(this),this.layer_=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createLoadedTileFinder=function(t,e,r){return function(n,i){return t.forEachLoadedTile(e,n,i,function(t){r[n]||(r[n]={}),r[n][t.tileCoord.toString()]=t})}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n){},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleImageChange_=function(t){t.target.getState()===fo.LOADED&&this.renderIfReadyAndVisible()},e.prototype.hasFeatureAtCoordinate=function(t,e){return!1},e.prototype.loadImage=function(t){var e=t.getState();return e!=fo.LOADED&&e!=fo.ERROR&&C(t,R.CHANGE,this.handleImageChange_,this),e==fo.IDLE&&(t.load(),e=t.getState()),e==fo.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==ni.READY&&this.changed()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var r=function(t,e,r){var n=o(t);n in r.usedTiles&&t.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(r)}},e.prototype.updateUsedTiles=function(t,e,r,n){var i=o(e),a=r.toString();i in t?a in t[i]?t[i][a].extend(n):t[i][a]=n:(t[i]={},t[i][a]=n)},e.prototype.manageTilePyramid=function(t,e,r,n,i,a,s,l,c,u){var h=o(e);h in t.wantedTiles||(t.wantedTiles[h]={});var d,p,f,g,y,m,C=t.wantedTiles[h],v=t.tileQueue;for(m=r.getMinZoom();m<=s;++m)for(p=r.getTileRangeForExtentAndZ(a,m,p),f=r.getResolution(m),g=p.minX;g<=p.maxX;++g)for(y=p.minY;y<=p.maxY;++y)s-m<=l?((d=e.getTile(m,g,y,n,i)).getState()==Qt.IDLE&&(C[d.getKey()]=!0,v.isKeyQueued(d.getKey())||v.enqueue([d,h,r.getTileCoordCenter(d.tileCoord),f])),void 0!==c&&c.call(u,d)):e.useTile(m,g,y,i)},e}(O)),ra=function(t){function e(e){t.call(this,e),this.coordinateToCanvasPixelTransform=[1,0,0,1,0,0],this.hitCanvasContext_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.composeFrame=function(t,e,r){this.preCompose(r,t);var n=this.getImage();if(n){var i=e.extent,o=void 0!==i&&!Be(i,t.extent)&&lr(i,t.extent);o&&this.clip(r,t,i);var a=this.getImageTransform(),s=r.globalAlpha;r.globalAlpha=e.opacity;var l=a[4],c=a[5],u=n.width*a[0],h=n.height*a[3];u>=.5&&h>=.5&&r.drawImage(n,0,0,+n.width,+n.height,Math.round(l),Math.round(c),Math.round(u),Math.round(h)),r.globalAlpha=s,o&&r.restore()}this.postCompose(r,t,e)},e.prototype.getImage=function(){return n()},e.prototype.getImageTransform=function(){return n()},e.prototype.forEachLayerAtCoordinate=function(t,e,r,n,i){if(this.getImage()){var o=rn(this.coordinateToCanvasPixelTransform,t.slice());Ee(o,e.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=$n(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),o[0],o[1],1,1,0,0,1,1);var a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return a[3]>0?n.call(i,this.getLayer(),a):void 0}},e}(ea),na=function(t){function e(r){if(t.call(this,r),this.image_=null,this.imageTransform_=[1,0,0,1,0,0],this.skippedFeatures_=[],this.vectorRenderer_=null,r.getType()===yo.VECTOR)for(var n=0,i=Qo.length;n<i;++n){var o=Qo[n];if(o!==e&&o.handles(r)){this.vectorRenderer_=new o(r);break}}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.prepareFrame=function(t,e){var r,n=t.pixelRatio,i=t.size,o=t.viewState,a=o.center,s=o.resolution,l=this.getLayer().getSource(),c=t.viewHints,h=this.vectorRenderer_,d=t.extent;if(h||void 0===e.extent||(d=ir(d,e.extent)),!c[0]&&!c[1]&&!cr(d)){var p=o.projection,f=this.skippedFeatures_;if(h){var g=h.context,y=u({},t,{size:[sr(d)/s,nr(d)/s],viewState:u({},t.viewState,{rotation:0})}),m=Object.keys(y.skippedFeatureUids).sort();r=new go(d,s,n,g.canvas,function(t){!h.prepareFrame(y,e)||!h.replayGroupChanged&&Ut(f,m)||(g.canvas.width=y.size[0]*n,g.canvas.height=y.size[1]*n,h.compose(g,y,e),f=m,t())})}else r=l.getImage(d,s,n,p);r&&this.loadImage(r)&&(this.image_=r,this.skippedFeatures_=f)}if(this.image_){var C=(r=this.image_).getExtent(),v=r.getResolution(),T=r.getPixelRatio(),_=n*v/(s*T),S=an(this.imageTransform_,n*i[0]/2,n*i[1]/2,_,_,0,T*(C[0]-a[0])/v,T*(a[1]-C[3])/v);an(this.coordinateToCanvasPixelTransform,n*i[0]/2-S[4],n*i[1]/2-S[5],n/s,-n/s,0,-a[0],-a[1]),this.renderedResolution=v*n/T}return!!this.image_},e.prototype.forEachFeatureAtCoordinate=function(e,r,n,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,n,i):t.prototype.forEachFeatureAtCoordinate.call(this,e,r,n,i)},e}(ra);na.handles=function(t){return t.getType()===yo.IMAGE||t.getType()===yo.VECTOR&&t.getRenderMode()===mo.IMAGE},na.create=function(t,e){return new na(e)};var ia=na,oa=function(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n};function aa(t,e,r,n,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=r,i.maxY=n,i):new oa(t,e,r,n)}oa.prototype.contains=function(t){return this.containsXY(t[1],t[2])},oa.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},oa.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},oa.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},oa.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},oa.prototype.getHeight=function(){return this.maxY-this.minY+1},oa.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},oa.prototype.getWidth=function(){return this.maxX-this.minX+1},oa.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY};var sa=oa,la=function(t){function e(e,r){t.call(this,e),this.context=r?null:$n(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new sa(0,0,0,0),this.imageTransform_=[1,0,0,1,0,0],this.zDirection=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isDrawableTile_=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==Qt.LOADED||r==Qt.EMPTY||r==Qt.ERROR&&!n},e.prototype.getTile=function(t,e,r,n,i){var o=this.getLayer(),a=o.getSource().getTile(t,e,r,n,i);return a.getState()==Qt.ERROR&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):a.setState(Qt.LOADED)),this.isDrawableTile_(a)||(a=a.getInterimTile()),a},e.prototype.prepareFrame=function(t,e){var r=t.pixelRatio,n=t.size,i=t.viewState,a=i.projection,s=i.resolution,l=i.center,c=this.getLayer(),u=c.getSource(),h=u.getRevision(),d=u.getTileGridForProjection(a),p=d.getZForResolution(s,this.zDirection),f=d.getResolution(p),g=Math.round(s/f)||1,y=t.extent;if(void 0!==e.extent&&(y=ir(y,e.extent)),cr(y))return!1;var m=d.getTileRangeForExtentAndZ(y,p),C=d.getTileRangeExtent(p,m),v=u.getTilePixelRatio(r),T={};T[p]={};var _,S,E,w=this.createLoadedTileFinder(u,a,T),b=t.viewHints,L=b[0]||b[1],A=this.tmpExtent,x=this.tmpTileRange_;for(this.newTiles_=!1,S=m.minX;S<=m.maxX;++S)for(E=m.minY;E<=m.maxY;++E)if(!(Date.now()-t.time>16&&L)){if(_=this.getTile(p,S,E,r,a),this.isDrawableTile_(_)){var P=o(this);if(_.getState()==Qt.LOADED){T[p][_.tileCoord.toString()]=_;var I=_.inTransition(P);this.newTiles_||!I&&-1!==this.renderedTiles.indexOf(_)||(this.newTiles_=!0)}if(1===_.getAlpha(P,t.time))continue}var R=d.getTileCoordChildTileRange(_.tileCoord,x,A),O=!1;R&&(O=w(p+1,R)),O||d.forEachTileCoordParentTileRange(_.tileCoord,w,null,x,A)}var M=f*r/v*g;if(!(this.renderedResolution&&Date.now()-t.time>16&&L)&&(this.newTiles_||!this.renderedExtent_||!Be(this.renderedExtent_,y)||this.renderedRevision!=h||g!=this.oversampling_||!L&&M!=this.renderedResolution)){var k=this.context;if(k){var N=u.getTilePixelSize(p,r,a),D=Math.round(m.getWidth()*N[0]/g),F=Math.round(m.getHeight()*N[1]/g),B=k.canvas;B.width!=D||B.height!=F?(this.oversampling_=g,B.width=D,B.height=F):((this.renderedExtent_&&!Ve(C,this.renderedExtent_)||this.renderedRevision!=h)&&k.clearRect(0,0,D,F),g=this.oversampling_)}this.renderedTiles.length=0;var G,U,j,q,W,H,V,Y,z,K,$=Object.keys(T).map(Number);for($.sort(function(t,e){return t===p?1:e===p?-1:t>e?1:t<e?-1:0}),q=0,W=$.length;q<W;++q)for(var X in j=$[q],U=u.getTilePixelSize(j,r,a),G=d.getResolution(j)/f,V=v*u.getGutterForProjection(a),Y=T[j])_=Y[X],S=((H=d.getTileCoordExtent(_.getTileCoord(),A))[0]-C[0])/f*v/g,E=(C[3]-H[3])/f*v/g,z=U[0]*G/g,K=U[1]*G/g,this.drawTileImage(_,t,e,S,E,z,K,V,p===j),this.renderedTiles.push(_);this.renderedRevision=h,this.renderedResolution=f*r/v*g,this.renderedExtent_=C}var Z=this.renderedResolution/s,J=an(this.imageTransform_,r*n[0]/2,r*n[1]/2,Z,Z,0,(this.renderedExtent_[0]-l[0])/this.renderedResolution*r,(l[1]-this.renderedExtent_[3])/this.renderedResolution*r);return an(this.coordinateToCanvasPixelTransform,r*n[0]/2-J[4],r*n[1]/2-J[5],r/s,-r/s,0,-l[0],-l[1]),this.updateUsedTiles(t.usedTiles,u,p,m),this.manageTilePyramid(t,u,d,r,a,y,p,c.getPreload()),this.scheduleExpireCache(t,u),this.renderedTiles.length>0},e.prototype.drawTileImage=function(t,e,r,n,i,a,s,l,c){var u=this.getTileImage(t);if(u){var h=o(this),d=c?t.getAlpha(h,e.time):1,p=this.getLayer().getSource();1!==d||p.getOpaque(e.viewState.projection)||this.context.clearRect(n,i,a,s);var f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(u,l,l,u.width-2*l,u.height-2*l,n,i,a,s),f&&this.context.restore(),1!==d?e.animate=!0:c&&t.endTransition(h)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.getTileImage=function(t){return t.getImage()},e}(ra);la.handles=function(t){return t.getType()===yo.TILE},la.create=function(t,e){return new la(e)},la.prototype.getLayer;var ca=la,ua=r(0),ha=r.n(ua),da=function(){};da.prototype.getReplay=function(t,e){return n()},da.prototype.isEmpty=function(){return n()},da.prototype.addDeclutter=function(t){return n()};var pa=da,fa={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function ga(t,e,r,n){for(var i=t[e],o=t[e+1],a=0,s=e+n;s<r;s+=n){var l=t[s],c=t[s+1];a+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return a}function ya(t,e,r,n,i,o,a,s){for(var l,c,u,h=[],d=t[e]>t[r-n],p=i.length,f=t[e],g=t[e+1],y=t[e+=n],m=t[e+1],C=0,v=Math.sqrt(Math.pow(y-f,2)+Math.pow(m-g,2)),T="",_=0,S=0;S<p;++S){c=d?p-S-1:S;var E=i.charAt(c),w=o(T=d?E+T:T+E)-_;_+=w;for(var b=a+w/2;e<r-n&&C+v<b;)f=y,g=m,y=t[e+=n],m=t[e+1],C+=v,v=Math.sqrt(Math.pow(y-f,2)+Math.pow(m-g,2));var L=b-C,A=Math.atan2(m-g,y-f);if(d&&(A+=A>0?-Math.PI:Math.PI),void 0!==u){var x=A-u;if(x+=x>Math.PI?-2*Math.PI:x<-Math.PI?2*Math.PI:0,Math.abs(x)>s)return null}var P=L/v,I=he(f,y,P),R=he(g,m,P);u==A?(d&&(l[0]=I,l[1]=R,l[2]=w/2),l[4]=T):(_=w,l=[I,R,w/2,A,T=E],d?h.unshift(l):h.push(l),u=A),a+=w}return h}var ma={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ca=[ma.FILL],va=[ma.STROKE],Ta=[ma.BEGIN_PATH],_a=[ma.CLOSE_PATH],Sa=ma,Ea=[fa.POLYGON,fa.CIRCLE,fa.LINE_STRING,fa.IMAGE,fa.TEXT,fa.DEFAULT],wa={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},ba=[1/0,1/0,-1/0,-1/0],La=[1,0,0,1,0,0],Aa=function(t){function e(e,r,n,i,o,a){t.call(this),this.declutterTree=a,this.tolerance=e,this.maxExtent=r,this.overlaps=o,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replayTextBackground_=function(t,e,r,n,i,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())},e.prototype.replayImage_=function(t,e,r,n,i,o,a,s,l,c,u,h,d,p,f,g,y,m){var C=y||m;e-=i*=d,r-=o*=d;var v,T,_,S,E=f+c>n.width?n.width-c:f,w=s+u>n.height?n.height-u:s,b=g[3]+E*d+g[1],L=g[0]+w*d+g[2],A=e-g[3],x=r-g[0];(C||0!==h)&&(v=[A,x],T=[A+b,x],_=[A+b,x+L],S=[A,x+L]);var P=null;if(0!==h){var I=e+i,R=r+o;P=an(La,I,R,1,1,h,-I,-R),qe(ba),ze(ba,rn(La,v)),ze(ba,rn(La,T)),ze(ba,rn(La,_)),ze(ba,rn(La,S))}else je(A,x,A+b,x+L,ba);var O=t.canvas,M=m?m[2]*d/2:0,k=ba[0]-M<=O.width&&ba[2]+M>=0&&ba[1]-M<=O.height&&ba[3]+M>=0;if(p&&(e=Math.round(e),r=Math.round(r)),a){if(!k&&1==a[4])return;Ye(a,ba);var N=k?[t,P?P.slice(0):null,l,n,c,u,E,w,e,r,d]:null;N&&C&&N.push(y,m,v,T,_,S),a.push(N)}else k&&(C&&this.replayTextBackground_(t,v,T,_,S,y,m),Do(t,P,l,n,c,u,E,w,e,r,d))},e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.prototype.appendFlatCoordinates=function(t,e,r,n,i,o){var a=this.coordinates.length,s=this.getBufferedMaxExtent();o&&(e+=n);var l,c,u,h=[t[e],t[e+1]],d=[NaN,NaN],p=!0;for(l=e+n;l<r;l+=n)d[0]=t[l],d[1]=t[l+1],(u=Ue(s,d))!==c?(p&&(this.coordinates[a++]=h[0],this.coordinates[a++]=h[1]),this.coordinates[a++]=d[0],this.coordinates[a++]=d[1],p=!1):u===Oe.INTERSECTING?(this.coordinates[a++]=d[0],this.coordinates[a++]=d[1],p=!1):p=!0,h[0]=d[0],h[1]=d[1],c=u;return(i&&p||l===e+n)&&(this.coordinates[a++]=h[0],this.coordinates[a++]=h[1]),a},e.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o],l=this.appendFlatCoordinates(t,e,s,n,!1,!1);i.push(l),e=s}return e},e.prototype.drawCustom=function(t,e,r){this.beginGeometry(t,e);var n,i,o,a,s,l=t.getType(),c=t.getStride(),u=this.coordinates.length;if(l==hr.MULTI_POLYGON){n=(t=t).getOrientedFlatCoordinates(),a=[];var h=t.getEndss();s=0;for(var d=0,p=h.length;d<p;++d){var f=[];s=this.drawCustomCoordinates_(n,s,h[d],c,f),a.push(f)}this.instructions.push([Sa.CUSTOM,u,a,t,r,En])}else l==hr.POLYGON||l==hr.MULTI_LINE_STRING?(o=[],n=l==hr.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),s=this.drawCustomCoordinates_(n,0,t.getEnds(),c,o),this.instructions.push([Sa.CUSTOM,u,o,t,r,Sn])):l==hr.LINE_STRING||l==hr.MULTI_POINT?(n=t.getFlatCoordinates(),i=this.appendFlatCoordinates(n,0,n.length,c,!1,!1),this.instructions.push([Sa.CUSTOM,u,i,t,r,_n])):l==hr.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),i=this.coordinates.length,this.instructions.push([Sa.CUSTOM,u,i,t,r]));this.endGeometry(t,e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[Sa.BEGIN_GEOMETRY,e,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Sa.BEGIN_GEOMETRY,e,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){},e.prototype.fill_=function(t){if(this.alignFill_){var e=rn(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.translate(e[0]%r,e[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.setTransform.apply(t,No)},e.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],K&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},e.prototype.renderDeclutter_=function(t,e){if(t&&t.length>5){var r=t[4];if(1==r||r==t.length-5){var n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(!this.declutterTree.collides(n)){this.declutterTree.insert(n);for(var i=5,o=t.length;i<o;++i){var a=t[i];a&&(a.length>11&&this.replayTextBackground_(a[0],a[13],a[14],a[15],a[16],a[11],a[12]),Do.apply(void 0,a))}}t.length=5,qe(t)}}},e.prototype.replay_=function(t,e,r,n,i,a,s){var l;this.pixelCoordinates_&&Ut(e,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=pr(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),en(this.renderedTransform_,e));for(var c,u,h,d,f,g,y,m,C,v,T,_,S=!p(r),E=0,w=n.length,b=0,L=0,A=0,x=null,P=null,I=this.coordinateCache_,R=this.viewRotation_,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:R},M=this.instructions!=n||this.overlaps?0:200;E<w;){var k=n[E];switch(k[0]){case Sa.BEGIN_GEOMETRY:v=k[1],S&&r[o(v)]||!v.getGeometry()?E=k[2]:void 0===s||lr(s,v.getGeometry().getExtent())?++E:E=k[2]+1;break;case Sa.BEGIN_PATH:L>M&&(this.fill_(t),L=0),A>M&&(t.stroke(),A=0),L||A||(t.beginPath(),d=f=NaN),++E;break;case Sa.CIRCLE:var N=l[b=k[1]],D=l[b+1],F=l[b+2]-N,B=l[b+3]-D,G=Math.sqrt(F*F+B*B);t.moveTo(N+G,D),t.arc(N,D,G,0,2*Math.PI,!0),++E;break;case Sa.CLOSE_PATH:t.closePath(),++E;break;case Sa.CUSTOM:b=k[1],c=k[2];var U=k[3],j=k[4],q=6==k.length?k[5]:void 0;O.geometry=U,O.feature=v,E in I||(I[E]=[]);var W=I[E];q?q(l,b,c,2,W):(W[0]=l[b],W[1]=l[b+1],W.length=2),j(W,O),++E;break;case Sa.DRAW_IMAGE:b=k[1],c=k[2],C=k[3],u=k[4],h=k[5],m=a?null:k[6];var H=k[7],V=k[8],Y=k[9],z=k[10],K=k[11],$=k[12],X=k[13],Z=k[14],J=void 0,Q=void 0,tt=void 0;for(k.length>16?(J=k[15],Q=k[16],tt=k[17]):(J=Eo,Q=tt=!1),K&&($+=R);b<c;b+=2)this.replayImage_(t,l[b],l[b+1],C,u,h,m,H,V,Y,z,$,X,i,Z,J,Q?x:null,tt?P:null);this.renderDeclutter_(m,v),++E;break;case Sa.DRAW_CHARS:var et=k[1],rt=k[2],nt=k[3];m=a?null:k[4];var it=k[5],ot=k[6],at=k[7],st=k[8],lt=k[9],ct=k[10],ut=k[11],ht=k[12],dt=k[13],pt=k[14],ft=ga(l,et,rt,2),gt=st(ht);if(it||gt<=ft){var yt=this.textStates[dt].textAlign,mt=ya(l,et,rt,2,ht,st,(ft-gt)*wa[yt],at);if(mt){var Ct=void 0,vt=void 0,Tt=void 0,_t=void 0,St=void 0;if(ct)for(Ct=0,vt=mt.length;Ct<vt;++Ct)Tt=(St=mt[Ct])[4],_t=this.getImage(Tt,dt,"",ct),u=St[2]+ut,h=nt*_t.height+2*(.5-nt)*ut-lt,this.replayImage_(t,St[0],St[1],_t,u,h,m,_t.height,1,0,0,St[3],pt,!1,_t.width,Eo,null,null);if(ot)for(Ct=0,vt=mt.length;Ct<vt;++Ct)Tt=(St=mt[Ct])[4],_t=this.getImage(Tt,dt,ot,""),u=St[2],h=nt*_t.height-lt,this.replayImage_(t,St[0],St[1],_t,u,h,m,_t.height,1,0,0,St[3],pt,!1,_t.width,Eo,null,null)}}this.renderDeclutter_(m,v),++E;break;case Sa.END_GEOMETRY:if(void 0!==a){var Et=a(v=k[1]);if(Et)return Et}++E;break;case Sa.FILL:M?L++:this.fill_(t),++E;break;case Sa.MOVE_TO_LINE_TO:for(b=k[1],c=k[2],T=l[b],y=(_=l[b+1])+.5|0,(g=T+.5|0)===d&&y===f||(t.moveTo(T,_),d=g,f=y),b+=2;b<c;b+=2)g=(T=l[b])+.5|0,y=(_=l[b+1])+.5|0,b!=c-2&&g===d&&y===f||(t.lineTo(T,_),d=g,f=y);++E;break;case Sa.SET_FILL_STYLE:x=k,this.alignFill_=k[2],L&&(this.fill_(t),L=0,A&&(t.stroke(),A=0)),t.fillStyle=k[1],++E;break;case Sa.SET_STROKE_STYLE:P=k,A&&(t.stroke(),A=0),this.setStrokeStyle_(t,k),++E;break;case Sa.STROKE:M?A++:t.stroke(),++E;break;default:++E}}L&&this.fill_(t),A&&t.stroke()},e.prototype.replay=function(t,e,r,n,i){this.viewRotation_=r,this.replay_(t,e,n,this.instructions,i,void 0,void 0)},e.prototype.replayHitDetection=function(t,e,r,n,i,o){return this.viewRotation_=r,this.replay_(t,e,n,this.hitDetectionInstructions,!0,i,o)},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var r,n,i=e.length,o=-1;for(t=0;t<i;++t)(n=(r=e[t])[0])==Sa.END_GEOMETRY?o=t:n==Sa.BEGIN_GEOMETRY&&(r[2]=t,Ft(this.hitDetectionInstructions,o,t),o=-1)},e.prototype.setFillStrokeStyle=function(t,e){var r=this.state;if(t){var n=t.getColor();r.fillStyle=Ho(n||To)}else r.fillStyle=void 0;if(e){var i=e.getColor();r.strokeStyle=Ho(i||So);var o=e.getLineCap();r.lineCap=void 0!==o?o:"round";var a=e.getLineDash();r.lineDash=a?a.slice():_o;var s=e.getLineDashOffset();r.lineDashOffset=s||0;var l=e.getLineJoin();r.lineJoin=void 0!==l?l:"round";var c=e.getWidth();r.lineWidth=void 0!==c?c:1;var u=e.getMiterLimit();r.miterLimit=void 0!==u?u:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},e.prototype.createFill=function(t,e){var r=t.fillStyle,n=[Sa.SET_FILL_STYLE,r];return"string"!=typeof r&&n.push(!0),n},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[Sa.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e,r){var n=t.fillStyle;"string"==typeof n&&t.currentFillStyle==n||(void 0!==n&&this.instructions.push(e.call(this,t,r)),t.currentFillStyle=n)},e.prototype.updateStrokeStyle=function(t,e){var r=t.strokeStyle,n=t.lineCap,i=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,s=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||i!=t.currentLineDash&&!Ut(t.currentLineDash,i)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=s||t.currentMiterLimit!=l)&&(void 0!==r&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=i,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=s,t.currentMiterLimit=l)},e.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var r=[Sa.END_GEOMETRY,e];this.instructions.push(r),this.hitDetectionInstructions.push(r)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ne(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;ke(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Yo),xa=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawCoordinates_=function(t,e,r,n){return this.appendFlatCoordinates(t,e,r,n,!1,!1)},e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([Sa.DRAW_IMAGE,i,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([Sa.DRAW_IMAGE,i,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0},e.prototype.setImageStyle=function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getHitDetectionImage(1),o=t.getImage(1),a=t.getOrigin();this.anchorX_=r[0],this.anchorY_=r[1],this.declutterGroup_=e,this.hitDetectionImage_=i,this.image_=o,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=n[0]},e}(Aa),Pa=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinates_=function(t,e,r,n){var i=this.coordinates.length,o=this.appendFlatCoordinates(t,e,r,n,!1,!1),a=[Sa.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r},e.prototype.drawLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],Ta);var o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(va),this.endGeometry(t,e)}},e.prototype.drawMultiLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],Ta);for(var o=t.getEnds(),a=t.getFlatCoordinates(),s=t.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinates_(a,l,o[c],s);this.hitDetectionInstructions.push(va),this.endGeometry(t,e)}},e.prototype.finish=function(){var t=this.state;null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(va),this.reverseHitDetectionInstructions(),this.state=null},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(va),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(Ta)},e}(Aa),Ia=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinatess_=function(t,e,r,n){var i=this.state,o=void 0!==i.fillStyle,a=null!=i.strokeStyle,s=r.length;this.instructions.push(Ta),this.hitDetectionInstructions.push(Ta);for(var l=0;l<s;++l){var c=r[l],u=this.coordinates.length,h=this.appendFlatCoordinates(t,e,c,n,!0,!a),d=[Sa.MOVE_TO_LINE_TO,u,h];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(_a),this.hitDetectionInstructions.push(_a)),e=c}return o&&(this.instructions.push(Ca),this.hitDetectionInstructions.push(Ca)),a&&(this.instructions.push(va),this.hitDetectionInstructions.push(va)),e},e.prototype.drawCircle=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length;this.appendFlatCoordinates(o,0,o.length,a,!1,!1);var l=[Sa.CIRCLE,s];this.instructions.push(Ta,l),this.hitDetectionInstructions.push(Ta,l),this.hitDetectionInstructions.push(Ca),void 0!==r.fillStyle&&this.instructions.push(Ca),void 0!==r.strokeStyle&&(this.instructions.push(va),this.hitDetectionInstructions.push(va)),this.endGeometry(t,e)}},e.prototype.drawPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getEnds(),a=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(t,e)}},e.prototype.drawMultiPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var o=t.getEndss(),a=t.getOrientedFlatCoordinates(),s=t.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinatess_(a,l,o[c],s);this.endGeometry(t,e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,r=0,n=e.length;r<n;++r)e[r]=bn(e[r],t)},e.prototype.setFillStrokeStyles_=function(t){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill,t),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},e}(Aa);function Ra(t,e,r,n,i){var o,a,s,l,c,u,h,d,p,f=r,g=r,y=0,m=0,C=r;for(o=r;o<n;o+=i){var v=e[o],T=e[o+1];void 0!==l&&(d=v-l,p=T-c,s=Math.sqrt(d*d+p*p),void 0!==u&&(m+=a,Math.acos((u*d+h*p)/(a*s))>t&&(m>y&&(y=m,f=C,g=o),m=0,C=o-i)),a=s,u=d,h=p),l=v,c=T}return(m+=s)>y?[C,o]:[f,g]}var Oa={Circle:Ia,Default:Aa,Image:xa,LineString:Pa,Polygon:Ia,Text:function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},wo.prune()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawText=function(t,e){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var o,a,s=this.coordinates.length,l=t.getType(),c=null,u=2,h=2;if("line"===i.placement){if(!lr(this.getBufferedMaxExtent(),t.getExtent()))return;var d;if(c=t.getFlatCoordinates(),h=t.getStride(),l==hr.LINE_STRING)d=[c.length];else if(l==hr.MULTI_LINE_STRING)d=t.getEnds();else if(l==hr.POLYGON)d=t.getEnds().slice(0,1);else if(l==hr.MULTI_POLYGON){var p=t.getEndss();for(d=[],o=0,a=p.length;o<a;++o)d.push(p[o][0])}this.beginGeometry(t,e);for(var f,g=i.textAlign,y=0,m=0,C=d.length;m<C;++m){if(null==g){var v=Ra(i.maxAngle,c,y,d[m],h);y=v[0],f=v[1]}else f=d[m];for(o=y;o<f;o+=h)this.coordinates.push(c[o],c[o+1]);u=this.coordinates.length,y=d[m],this.drawChars_(s,u,this.declutterGroup_),s=u}this.endGeometry(t,e)}else{var T=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),_=T.width/this.pixelRatio;switch(l){case hr.POINT:case hr.MULTI_POINT:u=(c=t.getFlatCoordinates()).length;break;case hr.LINE_STRING:c=t.getFlatMidpoint();break;case hr.CIRCLE:c=t.getCenter();break;case hr.MULTI_LINE_STRING:u=(c=t.getFlatMidpoints()).length;break;case hr.POLYGON:if(c=t.getFlatInteriorPoint(),!i.overflow&&c[2]/this.resolution<_)return;h=3;break;case hr.MULTI_POLYGON:var S=t.getFlatInteriorPoints();for(c=[],o=0,a=S.length;o<a;o+=3)(i.overflow||S[o+2]/this.resolution>=_)&&c.push(S[o],S[o+1]);if(0==(u=c.length))return}u=this.appendFlatCoordinates(c,0,u,h,!1,!1),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,t),this.hitDetectionInstructions.push(this.createFill(this.state,t))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e),this.drawTextImage_(T,s,u),this.endGeometry(t,e)}}},e.prototype.getImage=function(t,e,r,n){var i,o=n+e+t+r+this.pixelRatio;if(!wo.containsKey(o)){var a=n?this.strokeStates[n]||this.textStrokeState_:null,s=r?this.fillStates[r]||this.textFillState_:null,l=this.textStates[e]||this.textState_,c=this.pixelRatio,u=l.scale*c,h=wa[l.textAlign||"center"],d=n&&a.lineWidth?a.lineWidth:0,p=t.split("\n"),f=p.length,g=[],y=function(t,e,r){for(var n=e.length,i=0,o=0;o<n;++o){var a=Mo(t,e[o]);i=Math.max(i,a),r.push(a)}return i}(l.font,p,g),m=Oo(l.font),C=m*f,v=y+d,T=$n(Math.ceil(v*u),Math.ceil((C+d)*u));i=T.canvas,wo.set(o,i),1!=u&&T.scale(u,u),T.font=l.font,n&&(T.strokeStyle=a.strokeStyle,T.lineWidth=d,T.lineCap=a.lineCap,T.lineJoin=a.lineJoin,T.miterLimit=a.miterLimit,K&&a.lineDash.length&&(T.setLineDash(a.lineDash),T.lineDashOffset=a.lineDashOffset)),r&&(T.fillStyle=s.fillStyle),T.textBaseline="middle",T.textAlign="center";var _,S=.5-h,E=h*i.width/u+S*d;if(n)for(_=0;_<f;++_)T.strokeText(p[_],E+S*g[_],.5*(d+m)+_*m);if(r)for(_=0;_<f;++_)T.fillText(p[_],E+S*g[_],.5*(d+m)+_*m)}return wo.get(o)},e.prototype.drawTextImage_=function(t,e,r){var n=this.textState_,i=this.textStrokeState_,o=this.pixelRatio,a=wa[n.textAlign||"center"],s=wa[n.textBaseline],l=i&&i.lineWidth?i.lineWidth:0,c=a*t.width/o+2*(.5-a)*l,u=s*t.height/o+2*(.5-s)*l;this.instructions.push([Sa.DRAW_IMAGE,e,r,t,(c-this.textOffsetX_)*o,(u-this.textOffsetY_)*o,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,t.width,n.padding==Eo?Eo:n.padding.map(function(t){return t*o}),!!n.backgroundFill,!!n.backgroundStroke]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,e,r,t,(c-this.textOffsetX_)*o,(u-this.textOffsetY_)*o,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/o,t.width,n.padding,!!n.backgroundFill,!!n.backgroundStroke])},e.prototype.drawChars_=function(t,e,r){var n=this.textStrokeState_,i=this.textState_,o=this.textFillState_,a=this.strokeKey_;n&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:n.strokeStyle,lineCap:n.lineCap,lineDashOffset:n.lineDashOffset,lineWidth:n.lineWidth,lineJoin:n.lineJoin,miterLimit:n.miterLimit,lineDash:n.lineDash}));var s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:i.font,textAlign:i.textAlign||"center",scale:i.scale});var l=this.fillKey_;o&&(l in this.fillStates||(this.fillStates[l]={fillStyle:o.fillStyle}));var c=this.pixelRatio,u=wa[i.textBaseline],h=this.textOffsetY_*c,d=this.text_,p=i.font,f=i.scale,g=n?n.lineWidth*f/2:0,y=this.widths_[p];y||(this.widths_[p]=y={}),this.instructions.push([Sa.DRAW_CHARS,t,e,u,r,i.overflow,l,i.maxAngle,function(t){var e=y[t];return e||(e=y[t]=Mo(p,t)),e*f*c},h,a,g*c,d,s,1]),this.hitDetectionInstructions.push([Sa.DRAW_CHARS,t,e,u,r,i.overflow,l,i.maxAngle,function(t){var e=y[t];return e||(e=y[t]=Mo(p,t)),e*f},h,a,g,d,s,1/c])},e.prototype.setTextStyle=function(t,e){var r,n,i;if(t){this.declutterGroup_=e;var a=t.getFill();a?((n=this.textFillState_)||(n=this.textFillState_={}),n.fillStyle=Ho(a.getColor()||To)):n=this.textFillState_=null;var s=t.getStroke();if(s){(i=this.textStrokeState_)||(i=this.textStrokeState_={});var l=s.getLineDash(),c=s.getLineDashOffset(),u=s.getWidth(),h=s.getMiterLimit();i.lineCap=s.getLineCap()||"round",i.lineDash=l?l.slice():_o,i.lineDashOffset=void 0===c?0:c,i.lineJoin=s.getLineJoin()||"round",i.lineWidth=void 0===u?1:u,i.miterLimit=void 0===h?10:h,i.strokeStyle=Ho(s.getColor()||So)}else i=this.textStrokeState_=null;r=this.textState_;var d=t.getFont()||"10px sans-serif";xo(d);var p=t.getScale();r.overflow=t.getOverflow(),r.font=d,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.textBaseline=t.getTextBaseline()||"middle",r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||Eo,r.scale=void 0===p?1:p;var f=t.getOffsetX(),g=t.getOffsetY(),y=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===g?0:g,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0===m?0:m,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:o(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+o(n.fillStyle):""}else this.text_=""},e}(Aa)},Ma=function(t){function e(e,r,n,i,o,a,s){t.call(this),this.declutterTree_=a,this.declutterGroup_=null,this.tolerance_=e,this.maxExtent_=r,this.overlaps_=o,this.pixelRatio_=i,this.resolution_=n,this.renderBuffer_=s,this.replaysByZIndex_={},this.hitDetectionContext_=$n(1,1),this.hitDetectionTransform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addDeclutter=function(t){var e=null;return this.declutterTree_&&(t?(e=this.declutterGroup_)[4]++:(e=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1)),e},e.prototype.clip=function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},e.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var r=this.replaysByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},e.prototype.finish=function(){for(var t in this.replaysByZIndex_){var e=this.replaysByZIndex_[t];for(var r in e)e[r].finish()}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,o,a){var s,l=2*(n=Math.round(n))+1,c=an(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),u=this.hitDetectionContext_;u.canvas.width!==l||u.canvas.height!==l?(u.canvas.width=l,u.canvas.height=l):u.clearRect(0,0,l,l),void 0!==this.renderBuffer_&&(ze(s=[1/0,1/0,-1/0,-1/0],t),ke(s,e*(this.renderBuffer_+n),s));var h,d,p=function(t){if(void 0!==ka[t])return ka[t];for(var e=2*t+1,r=new Array(e),n=0;n<e;n++)r[n]=new Array(e);for(var i=t,o=0,a=0;i>=o;)Na(r,t+i,t+o),Na(r,t+o,t+i),Na(r,t-o,t+i),Na(r,t-i,t+o),Na(r,t-i,t-o),Na(r,t-o,t-i),Na(r,t+o,t-i),Na(r,t+i,t-o),2*((a+=1+2*++o)-i)+1>0&&(a+=1-2*(i-=1));return ka[t]=r,r}(n);function f(t){for(var e=u.getImageData(0,0,l,l).data,r=0;r<l;r++)for(var n=0;n<l;n++)if(p[r][n]&&e[4*(n*l+r)+3]>0){var i=void 0;return(!h||d!=fa.IMAGE&&d!=fa.TEXT||-1!==h.indexOf(t))&&(i=o(t)),i||void u.clearRect(0,0,l,l)}}this.declutterTree_&&(h=this.declutterTree_.all().map(function(t){return t.value}));var g,y,m,C,v,T=Object.keys(this.replaysByZIndex_).map(Number);for(T.sort(kt),g=T.length-1;g>=0;--g){var _=T[g].toString();for(m=this.replaysByZIndex_[_],y=Ea.length-1;y>=0;--y)if(void 0!==(C=m[d=Ea[y]]))if(!a||d!=fa.IMAGE&&d!=fa.TEXT){if(v=C.replayHitDetection(u,c,r,i,f,s))return v}else{var S=a[_];S?S.push(C,c.slice(0)):a[_]=[C,c.slice(0)]}}},e.prototype.getClipCoords=function(t){var e=this.maxExtent_,r=e[0],n=e[1],i=e[2],o=e[3],a=[r,n,r,o,i,o,i,n];return pr(a,0,8,2,t,a),a},e.prototype.getReplay=function(t,e){var r=void 0!==t?t.toString():"0",n=this.replaysByZIndex_[r];void 0===n&&(n={},this.replaysByZIndex_[r]=n);var i=n[e];void 0===i&&(i=new(0,Oa[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),n[e]=i);return i},e.prototype.getReplays=function(){return this.replaysByZIndex_},e.prototype.isEmpty=function(){return p(this.replaysByZIndex_)},e.prototype.replay=function(t,e,r,n,i,o,a){var s=Object.keys(this.replaysByZIndex_).map(Number);s.sort(kt),t.save(),this.clip(t,e);var l,c,u,h,d,p,f=o||Ea;for(l=0,c=s.length;l<c;++l){var g=s[l].toString();for(d=this.replaysByZIndex_[g],u=0,h=f.length;u<h;++u){var y=f[u];if(void 0!==(p=d[y]))if(!a||y!=fa.IMAGE&&y!=fa.TEXT)p.replay(t,e,r,n,i);else{var m=a[g];m?m.push(p,e.slice(0)):a[g]=[p,e.slice(0)]}}}t.restore()},e}(pa),ka={0:[[!0]]};function Na(t,e,r){var n,i=Math.floor(t.length/2);if(e>=i)for(n=i;n<e;n++)t[n][r]=!0;else if(e<i)for(n=e+1;n<i;n++)t[n][r]=!0}var Da=Ma,Fa=.5,Ba={Point:function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=fo.LOADED)return;var o=t.getReplay(r.getZIndex(),fa.IMAGE);o.setImageStyle(i,t.addDeclutter(!1)),o.drawPoint(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!!i)),s.drawText(e,n)}},LineString:function(t,e,r,n){var i=r.getStroke();if(i){var o=t.getReplay(r.getZIndex(),fa.LINE_STRING);o.setFillStrokeStyle(null,i),o.drawLineString(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!1)),s.drawText(e,n)}},Polygon:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(i||o){var a=t.getReplay(r.getZIndex(),fa.POLYGON);a.setFillStrokeStyle(i,o),a.drawPolygon(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}},MultiPoint:function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=fo.LOADED)return;var o=t.getReplay(r.getZIndex(),fa.IMAGE);o.setImageStyle(i,t.addDeclutter(!1)),o.drawMultiPoint(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!!i)),s.drawText(e,n)}},MultiLineString:function(t,e,r,n){var i=r.getStroke();if(i){var o=t.getReplay(r.getZIndex(),fa.LINE_STRING);o.setFillStrokeStyle(null,i),o.drawMultiLineString(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!1)),s.drawText(e,n)}},MultiPolygon:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(o||i){var a=t.getReplay(r.getZIndex(),fa.POLYGON);a.setFillStrokeStyle(i,o),a.drawMultiPolygon(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}},GeometryCollection:function(t,e,r,n){var i,o,a=e.getGeometriesArray();for(i=0,o=a.length;i<o;++i){(0,Ba[a[i].getType()])(t,a[i],r,n)}},Circle:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(i||o){var a=t.getReplay(r.getZIndex(),fa.CIRCLE);a.setFillStrokeStyle(i,o),a.drawCircle(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}}};function Ga(t,e){return parseInt(o(t),10)-parseInt(o(e),10)}function Ua(t,e){var r=ja(t,e);return r*r}function ja(t,e){return Fa*t/e}function qa(t,e,r,n,i,o){var a=!1,s=r.getImage();if(s){var l=s.getImageState();l==fo.LOADED||l==fo.ERROR?s.unlistenImageChange(i,o):(l==fo.IDLE&&s.load(),l=s.getImageState(),s.listenImageChange(i,o),a=!0)}return function(t,e,r,n){var i=r.getGeometryFunction()(e);if(i){var o=i.getSimplifiedGeometry(n);if(r.getRenderer())!function t(e,r,n,i){if(r.getType()!=hr.GEOMETRY_COLLECTION){e.getReplay(n.getZIndex(),fa.DEFAULT).drawCustom(r,i,n.getRenderer())}else for(var o=r.getGeometries(),a=0,s=o.length;a<s;++a)t(e,o[a],n,i)}(t,o,r,e);else{(0,Ba[o.getType()])(t,o,r,e)}}}(t,e,r,n),a}var Wa=function(t){function e(e){t.call(this,e),this.declutterTree_=e.getDeclutter()?ha()(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=$n(),C(wo,R.CLEAR,this.handleFontsChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){T(wo,R.CLEAR,this.handleFontsChanged_,this),t.prototype.disposeInternal.call(this)},e.prototype.compose=function(t,e,r){var n=e.extent,i=e.pixelRatio,o=r.managed?e.skippedFeatureUids:{},a=e.viewState,s=a.projection,l=a.rotation,c=s.getExtent(),u=this.getLayer().getSource(),h=this.getTransform(e,0),d=r.extent,p=void 0!==d;p&&this.clip(t,e,d);var f=this.replayGroup_;if(f&&!f.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var g,y=this.getLayer(),m=0,C=0,v=1!==r.opacity,T=y.hasListener(Jt.RENDER);if(v||T){var _=t.canvas.width,S=t.canvas.height;if(l){var E=Math.round(Math.sqrt(_*_+S*S));m=(E-_)/2,C=(E-S)/2,_=S=E}this.context.canvas.width=_,this.context.canvas.height=S,g=this.context}else g=t;var w=g.globalAlpha;v||(g.globalAlpha=r.opacity),g!=t&&g.translate(m,C);var b=e.viewHints,L=!(b[0]||b[1]),A=e.size[0]*i,x=e.size[1]*i;if(ko(g,-l,A/2,x/2),f.replay(g,h,l,o,L),u.getWrapX()&&s.canWrapX()&&!Be(c,n)){for(var P,I=n[0],R=sr(c),O=0;I<c[0];)P=R*--O,h=this.getTransform(e,P),f.replay(g,h,l,o,L),I+=R;for(O=0,I=n[2];I>c[2];)P=R*++O,h=this.getTransform(e,P),f.replay(g,h,l,o,L),I-=R}if(ko(g,l,A/2,x/2),T&&this.dispatchRenderEvent(g,e,h),g!=t){if(v){var M=t.globalAlpha;t.globalAlpha=r.opacity,t.drawImage(g.canvas,-m,-C),t.globalAlpha=M}else t.drawImage(g.canvas,-m,-C);g.translate(-m,-C)}v||(g.globalAlpha=w)}p&&t.restore()},e.prototype.composeFrame=function(t,e,r){var n=this.getTransform(t,0);this.preCompose(r,t,n),this.compose(r,t,e),this.postCompose(r,t,e,n)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){if(this.replayGroup_){var a=e.viewState.resolution,s=e.viewState.rotation,l=this.getLayer(),c={};return this.replayGroup_.forEachFeatureAtCoordinate(t,a,s,r,{},function(t){var e=o(t);if(!(e in c))return c[e]=!0,n.call(i,t,l)},null)}},e.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t,e){var r=this.getLayer(),n=r.getSource(),i=t.viewHints[0],o=t.viewHints[1],a=r.getUpdateWhileAnimating(),s=r.getUpdateWhileInteracting();if(!this.dirty_&&!a&&i||!s&&o)return!0;var l=t.extent,c=t.viewState,u=c.projection,h=c.resolution,d=t.pixelRatio,p=r.getRevision(),f=r.getRenderBuffer(),g=r.getRenderOrder();void 0===g&&(g=Ga);var y=ke(l,f*h),m=c.projection.getExtent();if(n.getWrapX()&&c.projection.canWrapX()&&!Be(m,t.extent)){var C=sr(m),v=Math.max(sr(y)/2,C);y[0]=m[0]-v,y[2]=m[2]+v}if(!this.dirty_&&this.renderedResolution_==h&&this.renderedRevision_==p&&this.renderedRenderOrder_==g&&Be(this.renderedExtent_,y))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var T=new Da(ja(h,d),y,h,d,n.getOverlaps(),this.declutterTree_,r.getRenderBuffer());n.loadFeatures(y,h,u);var _=function(t){var e,n=t.getStyleFunction()||r.getStyleFunction();if(n&&(e=n(t,h)),e){var i=this.renderFeature(t,h,d,e,T);this.dirty_=this.dirty_||i}}.bind(this);if(g){var S=[];n.forEachFeatureInExtent(y,function(t){S.push(t)}),S.sort(g);for(var E=0,w=S.length;E<w;++E)_(S[E])}else n.forEachFeatureInExtent(y,_);return T.finish(),this.renderedResolution_=h,this.renderedRevision_=p,this.renderedRenderOrder_=g,this.renderedExtent_=y,this.replayGroup_=T,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,e,r,n,i){if(!n)return!1;var o=!1;if(Array.isArray(n))for(var a=0,s=n.length;a<s;++a)o=qa(i,t,n[a],Ua(e,r),this.handleStyleImageChange_,this)||o;else o=qa(i,t,n,Ua(e,r),this.handleStyleImageChange_,this);return o},e}(ea);Wa.handles=function(t){return t.getType()===yo.VECTOR},Wa.create=function(t,e){return new Wa(e)};var Ha=Wa,Va={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},Ya={image:[fa.POLYGON,fa.CIRCLE,fa.LINE_STRING,fa.IMAGE,fa.TEXT],hybrid:[fa.POLYGON,fa.LINE_STRING]},za={image:[fa.DEFAULT],hybrid:[fa.IMAGE,fa.TEXT,fa.DEFAULT],vector:Ea},Ka=function(t){function e(e){t.call(this,e,!0),this.declutterTree_=e.getDeclutter()?ha()(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=[1,0,0,1,0,0];var r=e.getRenderMode();this.zDirection=r===Va.VECTOR?1:0,r!==Va.VECTOR&&(this.context=$n()),C(wo,R.CLEAR,this.handleFontsChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){T(wo,R.CLEAR,this.handleFontsChanged_,this),t.prototype.disposeInternal.call(this)},e.prototype.getTile=function(e,r,n,i,o){var a=t.prototype.getTile.call(this,e,r,n,i,o);return a.getState()===Qt.LOADED&&(this.createReplayGroup_(a,i,o),this.context&&this.renderTileImage_(a,i,o)),a},e.prototype.getTileImage=function(t){var e=this.getLayer();return t.getImage(e)},e.prototype.prepareFrame=function(e,r){var n=this.getLayer().getRevision();return this.renderedLayerRevision_!=n&&(this.renderedTiles.length=0),this.renderedLayerRevision_=n,t.prototype.prepareFrame.call(this,e,r)},e.prototype.createReplayGroup_=function(t,e,r){var n=this,i=this.getLayer(),o=i.getRevision(),a=i.getRenderOrder()||null,s=t.getReplayState(i);if(s.dirty||s.renderedRevision!=o||s.renderedRenderOrder!=a){for(var l=i.getSource(),c=l.getTileGrid(),u=l.getTileGridForProjection(r).getResolution(t.tileCoord[0]),h=t.extent,d=function(o,d){var p=t.getTile(t.tileKeys[o]);if(p.getState()==Qt.LOADED){var f=p.tileCoord,g=c.getTileCoordExtent(f),y=ir(h,g),m=Ve(g,y)?null:ke(y,i.getRenderBuffer()*u,n.tmpExtent),C=p.getProjection(),v=!1;Yr(r,C)||(v=!0,p.setProjection(r)),s.dirty=!1;var T=new Da(0,y,u,e,l.getOverlaps(),n.declutterTree_,i.getRenderBuffer()),_=Ua(u,e),S=function(t){var e,r=t.getStyleFunction()||i.getStyleFunction();if(r&&(e=r(t,u)),e){var n=this.renderFeature(t,_,e,T);this.dirty_=this.dirty_||n,s.dirty=s.dirty||n}},E=p.getFeatures();a&&a!==s.renderedRenderOrder&&E.sort(a);for(var w=0,b=E.length;w<b;++w){var L=E[w];v&&(C.getUnits()==Cr.TILE_PIXELS&&(C.setWorldExtent(g),C.setExtent(p.getExtent())),L.getGeometry().transform(C,r)),m&&!lr(m,L.getGeometry().getExtent())||S.call(n,L)}T.finish(),p.setReplayGroup(i,t.tileCoord.toString(),T)}},p=0,f=t.tileKeys.length;p<f;++p)d(p);s.renderedRevision=o,s.renderedRenderOrder=a}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){var a=e.viewState.resolution,s=e.viewState.rotation;r=null==r?0:r;var l,c,u,h,d=this.getLayer(),p={},f=this.renderedTiles;for(u=0,h=f.length;u<h;++u){var g=f[u];if(Fe(l=ke(g.extent,r*a,l),t))for(var y=0,m=g.tileKeys.length;y<m;++y){var C=g.getTile(g.tileKeys[y]);if(C.getState()==Qt.LOADED){var v=C.getReplayGroup(d,g.tileCoord.toString());c=c||v.forEachFeatureAtCoordinate(t,a,s,r,{},function(t){var e=o(t);if(!(e in p))return p[e]=!0,n.call(i,t,d)},null)}}}return c},e.prototype.getReplayTransform_=function(t,e){var r=this.getLayer().getSource().getTileGrid(),n=t.tileCoord,i=r.getResolution(n[0]),o=e.viewState,a=e.pixelRatio,s=o.resolution/a,l=r.getTileCoordExtent(n,this.tmpExtent),c=o.center,u=or(l),h=e.size,d=Math.round(a*h[0]/2),p=Math.round(a*h[1]/2);return an(this.tmpTransform_,d,p,i/s,i/s,o.rotation,(u[0]-c[0])/i,(c[1]-u[1])/i)},e.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.postCompose=function(e,r,n){var i=this.getLayer(),o=i.getRenderMode();if(o!=Va.IMAGE){var a,s,l=i.getDeclutter()?{}:null,c=i.getSource(),u=za[o],h=r.pixelRatio,d=r.viewState.rotation,p=r.size;d&&ko(e,-d,a=Math.round(h*p[0]/2),s=Math.round(h*p[1]/2)),l&&this.declutterTree_.clear();for(var f=r.viewHints,g=!(f[0]||f[1]),y=this.renderedTiles,m=c.getTileGridForProjection(r.viewState.projection),C=[],v=[],T=y.length-1;T>=0;--T){var _=y[T];if(_.getState()!=Qt.ABORT)for(var S=_.tileCoord,E=m.getTileCoordExtent(S,this.tmpExtent)[0]-_.extent[0],w=void 0,b=0,L=_.tileKeys.length;b<L;++b){var A=_.getTile(_.tileKeys[b]);if(A.getState()==Qt.LOADED){var x=A.getReplayGroup(i,S.toString());if(x&&x.hasReplays(u)){w||(w=this.getTransform(r,E));var P=A.tileCoord[0],I=x.getClipCoords(w);e.save(),e.globalAlpha=n.opacity;for(var R=0,O=C.length;R<O;++R){var M=C[R];P<v[R]&&(e.beginPath(),e.moveTo(I[0],I[1]),e.lineTo(I[2],I[3]),e.lineTo(I[4],I[5]),e.lineTo(I[6],I[7]),e.moveTo(M[6],M[7]),e.lineTo(M[4],M[5]),e.lineTo(M[2],M[3]),e.lineTo(M[0],M[1]),e.clip())}x.replay(e,w,d,{},g,u,l),e.restore(),C.push(I),v.push(P)}}}}l&&function(t,e,r,n){for(var i=Object.keys(t).map(Number).sort(kt),o={},a=0,s=i.length;a<s;++a)for(var l=t[i[a].toString()],c=0,u=l.length;c<u;){var h=l[c++],d=l[c++];h.replay(e,d,r,o,n)}}(l,e,d,g),d&&ko(e,d,a,s)}t.prototype.postCompose.call(this,e,r,n)},e.prototype.renderFeature=function(t,e,r,n){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var o=0,a=r.length;o<a;++o)i=qa(n,t,r[o],e,this.handleStyleImageChange_,this)||i;else i=qa(n,t,r,e,this.handleStyleImageChange_,this);return i},e.prototype.renderTileImage_=function(t,e,r){var n=this.getLayer(),i=t.getReplayState(n),o=n.getRevision(),a=Ya[n.getRenderMode()];if(a&&i.renderedTileRevision!==o){i.renderedTileRevision=o;var s=t.wrappedTileCoord,l=s[0],c=n.getSource(),u=c.getTileGridForProjection(r),h=u.getResolution(l),d=t.getContext(n),p=c.getTilePixelSize(l,e,r);d.canvas.width=p[0],d.canvas.height=p[1];for(var f=u.getTileCoordExtent(s,this.tmpExtent),g=0,y=t.tileKeys.length;g<y;++g){var m=t.getTile(t.tileKeys[g]);if(m.getState()==Qt.LOADED){var C=e/h,v=Jr(this.tmpTransform_);nn(v,C,-C),on(v,-f[0],-f[3]),m.getReplayGroup(n,t.tileCoord.toString()).replay(d,v,0,{},!0,a)}}}},e}(ca);Ka.handles=function(t){return t.getType()===yo.VECTOR_TILE},Ka.create=function(t,e){return new Ka(e)};var $a=Ka,Xa=function(t){function e(e){(e=u({},e)).controls||(e.controls=function(t){var e={},r=new G;return(void 0===e.zoom||e.zoom)&&r.push(new Ei(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&r.push(new Si(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&r.push(new Ti(e.attributionOptions)),r}()),e.interactions||(e.interactions=uo()),t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){var t=new ta(this);return t.registerLayerRenderers([ia,ca,Ha,$a]),t},e}(ci),Za={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},Ja={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Qa=function(t){function e(e){t.call(this),this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+di,this.element.style.position="absolute",this.autoPan=void 0!==e.autoPan&&e.autoPan,this.autoPanAnimation=e.autoPanAnimation||{},this.autoPanMargin=void 0!==e.autoPanMargin?e.autoPanMargin:20,this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},this.mapPostrenderListenerKey=null,C(this,N(Ja.ELEMENT),this.handleElementChanged,this),C(this,N(Ja.MAP),this.handleMapChanged,this),C(this,N(Ja.OFFSET),this.handleOffsetChanged,this),C(this,N(Ja.POSITION),this.handlePositionChanged,this),C(this,N(Ja.POSITIONING),this.handlePositioningChanged,this),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(void 0!==e.positioning?e.positioning:Za.TOP_LEFT),void 0!==e.position&&this.setPosition(e.position)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getElement=function(){return this.get(Ja.ELEMENT)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(Ja.MAP)},e.prototype.getOffset=function(){return this.get(Ja.OFFSET)},e.prototype.getPosition=function(){return this.get(Ja.POSITION)},e.prototype.getPositioning=function(){return this.get(Ja.POSITIONING)},e.prototype.handleElementChanged=function(){ti(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(Qn(this.element),_(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=C(t,Xt.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(Ja.POSITION)&&this.autoPan&&this.panIntoView()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(Ja.ELEMENT,t)},e.prototype.setMap=function(t){this.set(Ja.MAP,t)},e.prototype.setOffset=function(t){this.set(Ja.OFFSET,t)},e.prototype.setPosition=function(t){this.set(Ja.POSITION,t)},e.prototype.panIntoView=function(){var t=this.getMap();if(t&&t.getTargetElement()){var e=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),n=this.getRect(r,[Xn(r),Zn(r)]),i=this.autoPanMargin;if(!Be(e,n)){var o=n[0]-e[0],a=e[2]-n[2],s=n[1]-e[1],l=e[3]-n[3],c=[0,0];if(o<0?c[0]=o-i:a<0&&(c[0]=Math.abs(a)+i),s<0?c[1]=s-i:l<0&&(c[1]=Math.abs(l)+i),0!==c[0]||0!==c[1]){var u=t.getView().getCenter(),h=t.getPixelFromCoordinate(u),d=[h[0]+c[0],h[1]+c[1]];t.getView().animate({center:t.getCoordinateFromPixel(d),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},e.prototype.getRect=function(t,e){var r=t.getBoundingClientRect(),n=r.left+window.pageXOffset,i=r.top+window.pageYOffset;return[n,i,n+e[0],i+e[1]]},e.prototype.setPositioning=function(t){this.set(Ja.POSITIONING,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var r=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(r,n)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);var o=n[0],a=n[1];if(i==Za.BOTTOM_RIGHT||i==Za.CENTER_RIGHT||i==Za.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=r.left="");var s=Math.round(e[0]-t[0]-o)+"px";this.rendered.right_!=s&&(this.rendered.right_=r.right=s)}else{""!==this.rendered.right_&&(this.rendered.right_=r.right=""),i!=Za.BOTTOM_CENTER&&i!=Za.CENTER_CENTER&&i!=Za.TOP_CENTER||(o-=this.element.offsetWidth/2);var l=Math.round(t[0]+o)+"px";this.rendered.left_!=l&&(this.rendered.left_=r.left=l)}if(i==Za.BOTTOM_LEFT||i==Za.BOTTOM_CENTER||i==Za.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=r.top="");var c=Math.round(e[1]-t[1]-a)+"px";this.rendered.bottom_!=c&&(this.rendered.bottom_=r.bottom=c)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=r.bottom=""),i!=Za.CENTER_LEFT&&i!=Za.CENTER_CENTER&&i!=Za.CENTER_RIGHT||(a-=this.element.offsetHeight/2);var u=Math.round(t[1]+a)+"px";this.rendered.top_!=u&&(this.rendered.top_=r.top=u)}},e.prototype.getOptions=function(){return this.options},e}(D);function ts(t){this.validateExtent_(),this.updateBox_()}var es=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||ts,target:r.target}),this.collapsed_=void 0===r.collapsed||r.collapsed,this.collapsible_=void 0===r.collapsible||r.collapsible,this.collapsible_||(this.collapsed_=!1);var n=void 0!==r.className?r.className:"ol-overviewmap",i=void 0!==r.tipLabel?r.tipLabel:"Overview map",o=void 0!==r.collapseLabel?r.collapseLabel:"\xab";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;var a=void 0!==r.label?r.label:"\xbb";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a):this.label_=a;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(s),C(l,R.CLICK,this.handleClick_,this),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.ovmap_=new Xa({controls:new G,interactions:new G,view:r.view});var c=this.ovmap_;r.layers&&r.layers.forEach(function(t){c.addLayer(t)}.bind(this));var u=document.createElement("div");u.className="ol-overviewmap-box",u.style.boxSizing="border-box",this.boxOverlay_=new Qa({position:[0,0],positioning:Za.BOTTOM_LEFT,element:u}),this.ovmap_.addOverlay(this.boxOverlay_);var h=n+" "+pi+" "+fi+(this.collapsed_&&this.collapsible_?" "+gi:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=h,d.appendChild(this.ovmapDiv_),d.appendChild(l);var p=this,f=this.boxOverlay_,g=this.boxOverlay_.getElement(),y=function(t){var e,r={clientX:(e=t).clientX-g.offsetWidth/2,clientY:e.clientY+g.offsetHeight/2},n=c.getEventCoordinate(r);f.setPosition(n)},m=function(t){var e=c.getEventCoordinate(t);p.getMap().getView().setCenter(e),window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",m)};g.addEventListener("mousedown",function(){window.addEventListener("mousemove",y),window.addEventListener("mouseup",m)})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){var r=this.getMap();if(e!==r){if(r){var n=r.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(t.prototype.setMap.call(this,e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(C(e,c,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup());var i=e.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},e.prototype.handleMapPropertyChange_=function(t){if(t.key===Zt.VIEW){var e=t.oldValue;e&&this.unbindView_(e);var r=this.getMap().getView();this.bindView_(r)}},e.prototype.bindView_=function(t){C(t,N(me),this.handleRotationChanged_,this)},e.prototype.unbindView_=function(t){T(t,N(me),this.handleRotationChanged_,this)},e.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},e.prototype.validateExtent_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var r=t.getSize(),n=t.getView().calculateExtent(r),i=e.getSize(),o=e.getView().calculateExtent(i),a=e.getPixelFromCoordinate(or(n)),s=e.getPixelFromCoordinate(Qe(n)),l=Math.abs(a[0]-s[0]),c=Math.abs(a[1]-s[1]),u=i[0],h=i[1];l<.1*u||c<.1*h||l>.75*u||c>.75*h?this.resetExtent_():Be(o,n)||this.recenter_()}},e.prototype.resetExtent_=function(){var t=this.getMap(),e=this.ovmap_,r=t.getSize(),n=t.getView().calculateExtent(r),i=e.getView(),o=Math.log(7.5)/Math.LN2;ur(n,1/(.1*Math.pow(2,o/2))),i.fit(n)},e.prototype.recenter_=function(){var t=this.getMap(),e=this.ovmap_,r=t.getView();e.getView().setCenter(r.getCenter())},e.prototype.updateBox_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var r=t.getSize(),n=t.getView(),i=e.getView(),o=n.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=n.calculateExtent(r),c=i.getResolution(),u=Je(l),h=ar(l),d=this.calculateCoordinateRotate_(o,u);a.setPosition(d),s&&(s.style.width=Math.abs((u[0]-h[0])/c)+"px",s.style.height=Math.abs((h[1]-u[1])/c)+"px")}},e.prototype.calculateCoordinateRotate_=function(t,e){var r,n=this.getMap().getView().getCenter();return n&&(Se(r=[e[0]-n[0],e[1]-n[1]],t),ve(r,n)),r},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(gi),this.collapsed_?Jn(this.collapseLabel_,this.label_):Jn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var t=this.ovmap_;this.collapsed_||t.isRendered()||(t.updateSize(),this.resetExtent_(),v(t,Xt.POSTRENDER,function(t){this.updateBox_()},this))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.getOverviewMap=function(){return this.ovmap_},e}(ui),rs="units",ns={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"},is=[1,2,5];function os(t){var e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()}var as=function(t){function e(e){var r=e||{},n=void 0!==r.className?r.className:"ol-scale-line";t.call(this,{element:document.createElement("div"),render:r.render||os,target:r.target}),this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+pi,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==r.minWidth?r.minWidth:64,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",C(this,N(rs),this.handleUnitsChanged_,this),this.setUnits(r.units||ns.METRIC)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUnits=function(){return this.get(rs)},e.prototype.handleUnitsChanged_=function(){this.updateElement_()},e.prototype.setUnits=function(t){this.set(rs,t)},e.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,r=t.projection,n=this.getUnits(),i=n==ns.DEGREES?Cr.DEGREES:Cr.METERS,o=qr(r,t.resolution,e,i);r.getUnits()!=Cr.DEGREES&&r.getMetersPerUnit()&&i==Cr.METERS&&(o*=r.getMetersPerUnit());var a=this.minWidth_*o,s="";if(n==ns.DEGREES){var l=mr[Cr.DEGREES];r.getUnits()==Cr.DEGREES?a*=l:o/=l,a<l/60?(s="\u2033",o*=3600):a<l?(s="\u2032",o*=60):s="\xb0"}else n==ns.IMPERIAL?a<.9144?(s="in",o/=.0254):a<1609.344?(s="ft",o/=.3048):(s="mi",o/=1609.344):n==ns.NAUTICAL?(o/=1852,s="nm"):n==ns.METRIC?a<.001?(s="\u03bcm",o*=1e6):a<1?(s="mm",o*=1e3):a<1e3?s="m":(s="km",o/=1e3):n==ns.US?a<.9144?(s="in",o*=39.37):a<1609.344?(s="ft",o/=.30480061):(s="mi",o/=1609.3472):te(!1,33);for(var c,u,h=3*Math.floor(Math.log(this.minWidth_*o)/Math.log(10));;){if(c=is[(h%3+3)%3]*Math.pow(10,Math.floor(h/3)),u=Math.round(c/o),isNaN(u))return this.element.style.display="none",void(this.renderedVisible_=!1);if(u>=this.minWidth_)break;++h}var d=c+" "+s;this.renderedHTML_!=d&&(this.innerElement_.innerHTML=d,this.renderedHTML_=d),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e}(ui),ss={VERTICAL:0,HORIZONTAL:1};function ls(t){if(t.frameState){this.sliderInitialized_||this.initSlider_();var e=t.frameState.viewState.resolution;e!==this.currentResolution_&&(this.currentResolution_=e,this.setThumbPosition_(e))}}var cs=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||ls}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=ss.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.previousX_,this.previousY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=void 0!==r.duration?r.duration:200;var n=void 0!==r.className?r.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=n+"-thumb "+pi;var o=this.element;o.className=n+" "+pi+" "+fi,o.appendChild(i),this.dragger_=new Kt(o),C(this.dragger_,tt.POINTERDOWN,this.handleDraggerStart_,this),C(this.dragger_,tt.POINTERMOVE,this.handleDraggerDrag_,this),C(this.dragger_,tt.POINTERUP,this.handleDraggerEnd_,this),C(o,R.CLICK,this.handleContainerClick_,this),C(i,R.CLICK,x)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.dragger_.dispose(),t.prototype.disposeInternal.call(this)},e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),e&&e.render()},e.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,r=t.offsetHeight,n=t.firstElementChild,i=getComputedStyle(n),o=n.offsetWidth+parseFloat(i.marginRight)+parseFloat(i.marginLeft),a=n.offsetHeight+parseFloat(i.marginTop)+parseFloat(i.marginBottom);this.thumbSize_=[o,a],e>r?(this.direction_=ss.HORIZONTAL,this.widthLimit_=e-o):(this.direction_=ss.VERTICAL,this.heightLimit_=r-a),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),r=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(r);e.animate({resolution:e.constrainResolution(n),duration:this.duration_,easing:xe})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.originalEvent.target===this.element.firstElementChild&&(this.getMap().getView().setHint(1,1),this.previousX_=t.clientX,this.previousY_=t.clientY,this.dragging_=!0,0===this.dragListenerKeys_.length)){var e=this.handleDraggerDrag_,r=this.handleDraggerEnd_;this.dragListenerKeys_.push(C(document,R.MOUSEMOVE,e,this),C(document,tt.POINTERMOVE,e,this),C(document,R.MOUSEUP,r,this),C(document,tt.POINTERUP,r,this))}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=this.element.firstElementChild,r=t.clientX-this.previousX_+parseFloat(e.style.left),n=t.clientY-this.previousY_+parseFloat(e.style.top),i=this.getRelativePosition_(r,n);this.currentResolution_=this.getResolutionForPosition_(i),this.getMap().getView().setResolution(this.currentResolution_),this.setThumbPosition_(this.currentResolution_),this.previousX_=t.clientX,this.previousY_=t.clientY}},e.prototype.handleDraggerEnd_=function(t){if(this.dragging_){var e=this.getMap().getView();e.setHint(1,-1),e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:xe}),this.dragging_=!1,this.previousX_=void 0,this.previousY_=void 0,this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0}},e.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),r=this.element.firstElementChild;this.direction_==ss.HORIZONTAL?r.style.left=this.widthLimit_*e+"px":r.style.top=this.heightLimit_*e+"px"},e.prototype.getRelativePosition_=function(t,e){return oe(this.direction_===ss.HORIZONTAL?t/this.widthLimit_:e/this.heightLimit_,0,1)},e.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},e.prototype.getPositionForResolution_=function(t){return 1-this.getMap().getView().getValueForResolutionFunction()(t)},e}(ui),us=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),target:r.target}),this.extent=r.extent?r.extent:null;var n=void 0!==r.className?r.className:"ol-zoom-extent",i=void 0!==r.label?r.label:"E",o=void 0!==r.tipLabel?r.tipLabel:"Fit to extent",a=document.createElement("button");a.setAttribute("type","button"),a.title=o,a.appendChild("string"==typeof i?document.createTextNode(i):i),C(a,R.CLICK,this.handleClick_,this);var s=n+" "+pi+" "+fi,l=this.element;l.className=s,l.appendChild(a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t){t.preventDefault(),this.handleZoomToExtent()},e.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fit(e)},e}(ui);function hs(t){return"function"==typeof t?t:(Array.isArray(t)?e=t:(te("function"==typeof t.getZIndex,41),e=[t]),function(){return e});var e}var ds=function(t){function e(e){if(t.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,C(this,N(this.geometryName_),this.handleGeometryChanged_,this),e)if("function"==typeof e.getSimplifiedGeometry){var r=e;this.setGeometry(r)}else{var n=e;this.setProperties(n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e(this.getProperties());t.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&t.setGeometry(r.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(_(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=C(t,R.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?hs(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){T(this,N(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=t,C(this,N(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},e}(D),ps=function(t){function e(e,r){t.call(this),r&&!Array.isArray(e[0])?this.setFlatCoordinates(r,e):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPoint=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){if(n<De(this.getExtent(),t,e))return n;for(var i=this.flatCoordinates,o=this.stride,a=0,s=i.length;a<s;a+=o){var l=le(t,e,i[a],i[a+1]);if(l<n){n=l;for(var c=0;c<o;++c)r[c]=i[a+c];r.length=o}}return n},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Pn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,n=[],i=0,o=t.length;i<o;i+=r){var a=new Pn(t.slice(i,i+r),e);n.push(a)}return n},e.prototype.getType=function(){return hr.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,n=0,i=e.length;n<i;n+=r)if(Ge(t,e[n],e[n+1]))return!0;return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un);function fs(t,e,r,n,i,o){var a=NaN,s=NaN,l=(r-e)/n;if(1===l)a=t[e],s=t[e+1];else if(2==l)a=(1-i)*t[e]+i*t[e+n],s=(1-i)*t[e+1]+i*t[e+n+1];else if(0!==l){for(var c=t[e],u=t[e+1],h=0,d=[0],p=e+n;p<r;p+=n){var f=t[p],g=t[p+1];h+=Math.sqrt((f-c)*(f-c)+(g-u)*(g-u)),d.push(h),c=f,u=g}var y=i*h,m=function(t,e,r){for(var n,i,o=kt,a=0,s=t.length,l=!1;a<s;)(i=+o(t[n=a+(s-a>>1)],e))<0?a=n+1:(s=n,l=!i);return l?a:~a}(d,y);if(m<0){var C=(y-d[-m-2])/(d[-m-1]-d[-m-2]),v=e+(-m-2)*n;a=he(t[v],t[v+n],C),s=he(t[v+1],t[v+n+1],C)}else a=t[e+m*n],s=t[e+m*n+1]}return o?(o[0]=a,o[1]=s,o):[a,s]}function gs(t,e,r,n,i,o){if(r==e)return null;var a;if(i<t[e+n-1])return o?((a=t.slice(e,e+n))[n-1]=i,a):null;if(t[r-1]<i)return o?((a=t.slice(r-n,r))[n-1]=i,a):null;if(i==t[e+n-1])return t.slice(e,e+n);for(var s=e/n,l=r/n;s<l;){var c=s+l>>1;i<t[(c+1)*n-1]?l=c:s=c+1}var u=t[s*n-1];if(i==u)return t.slice((s-1)*n,(s-1)*n+n);var h=(i-u)/(t[(s+1)*n-1]-u);a=[];for(var d=0;d<n-1;++d)a.push(he(t[(s-1)*n+d],t[s*n+d],h));return a.push(i),a}var ys=function(t){function e(e,r){t.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?this.setCoordinates(e,r):this.setFlatCoordinates(r,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendCoordinate=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.forEachSegment=function(t){return kn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=dr.XYM&&this.layout!=dr.XYZM)return null;var r=void 0!==e&&e;return gs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)},e.prototype.getLength=function(){return ga(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=wn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,dr.XY)},e.prototype.getType=function(){return hr.LINE_STRING},e.prototype.intersectsExtent=function(t){return Nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un),ms=function(t){function e(e,r,n){if(t.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,r);else if(void 0!==r&&n)this.setFlatCoordinates(r,e),this.ends_=n;else{for(var i=this.getLayout(),o=e,a=[],s=[],l=0,c=o.length;l<c;++l){var u=o[l];0===l&&(i=u.getLayout()),Bt(a,u.getFlatCoordinates()),s.push(a.length)}this.setFlatCoordinates(i,a),this.ends_=s}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLineString=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.getCoordinateAtM=function(t,e,r){if(this.layout!=dr.XYM&&this.layout!=dr.XYZM||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,i=void 0!==r&&r;return function(t,e,r,n,i,o,a){if(a)return gs(t,e,r[r.length-1],n,i,o);var s;if(i<t[n-1])return o?((s=t.slice(0,n))[n-1]=i,s):null;if(t[t.length-1]<i)return o?((s=t.slice(t.length-n))[n-1]=i,s):null;for(var l=0,c=r.length;l<c;++l){var u=r[l];if(e!=u){if(i<t[e+n-1])return null;if(i<=t[u-1])return gs(t,e,u,n,i,!1);e=u}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,n,i)},e.prototype.getCoordinates=function(){return Sn(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new ys(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,n=[],i=0,o=0,a=e.length;o<a;++o){var s=e[o],l=new ys(t.slice(i,s),r);n.push(l),i=s}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,o=0,a=n.length;o<a;++o){var s=n[o];Bt(t,fs(e,r,s,i,.5)),r=s}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=wn(t,e,u,n,i,o,a),s.push(a),e=u}return a}(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,dr.XY,n)},e.prototype.getType=function(){return hr.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){if(Nn(t,e,r[o],n,i))return!0;e=r[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Tn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(un),Cs=function(t){function e(e,r,n){if(t.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var i=this.getLayout(),o=e,a=[],s=[],l=0,c=o.length;l<c;++l){var u=o[l];0===l&&(i=u.getLayout());for(var h=a.length,d=u.getEnds(),p=0,f=d.length;p<f;++p)d[p]+=h;Bt(a,u.getFlatCoordinates()),s.push(d)}r=i,e=a,n=s}void 0!==r&&n?(this.setFlatCoordinates(r,e),this.endss_=n):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var r=this.flatCoordinates.length;Bt(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,i=(e=t.getEnds().slice()).length;n<i;++n)e[n]+=r}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,r=new Array(t),n=0;n<t;++n)r[n]=this.endss_[n].slice();return new e(this.flatCoordinates.slice(),this.layout,r)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=gn(t,e,s,n,i),e=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,r,n,i,o,a,s,l,c,u){for(var h=[NaN,NaN],d=0,p=r.length;d<p;++d){var f=r[d];c=mn(t,e,f,n,i,!0,a,s,l,c,h),e=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,r,n))},e.prototype.containsXY=function(t,e){return function(t,e,r,n,i,o){if(0===r.length)return!1;for(var a=0,s=r.length;a<s;++a){var l=r[a];if(On(t,e,l,n,i,o))return!0;e=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=dn(t,e,s,n),e=s[s.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?jn(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,En(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,r,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],a=0,s=r.length;a<s;++a){var l=r[a];o=He(t,e,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=l[l.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;++a){var l=r[a];o=Mn(t,e,l,n,i,2*a,o),e=l[l.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new ps(this.getFlatInteriorPoints().slice(),dr.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)if(!Gn(t,0,r[o],n,void 0))return!1;return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=jn(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l],h=[];a=An(t,e,u,n,i,o,a,h),s.push(h),e=u[u.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,dr.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var r=this.endss_[t-1];e=r[r.length-1]}var n=this.endss_[t].slice(),i=n[n.length-1];if(0!==e)for(var o=0,a=n.length;o<a;++o)n[o]-=e;return new Wn(this.flatCoordinates.slice(e,i),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.endss_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o].slice(),l=s[s.length-1];if(0!==i)for(var c=0,u=s.length;c<u;++c)s[c]-=i;var h=new Wn(e.slice(i,l),t,s);n.push(h),i=l}return n},e.prototype.getType=function(){return hr.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(Dn(t,e,s,n,i))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(t,e,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=Tn(t,e,r[s],n,o[a]);o[a++]=c,e=c[c.length-1]}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(un),vs=function(t){function e(e,r,n){if(t.call(this),void 0!==n&&void 0===r)this.setFlatCoordinates(n,e);else{var i=r||0;this.setCenterAndRadius(e,i,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,r,n){var i=this.flatCoordinates,o=t-i[0],a=e-i[1],s=o*o+a*a;if(s<n){if(0===s)for(var l=0;l<this.stride;++l)r[l]=i[l];else{var c=this.getRadius()/Math.sqrt(s);r[0]=i[0]+c*o,r[1]=i[1]+c*a;for(var u=2;u<this.stride;++u)r[u]=i[u]}return r.length=this.stride,s}return n},e.prototype.containsXY=function(t,e){var r=this.flatCoordinates,n=t-r[0],i=e-r[1];return n*n+i*i<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,r=e[this.stride]-e[0];return je(e[0]-r,e[1]-r,e[0]+r,e[1]+r,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return hr.CIRCLE},e.prototype.intersectsExtent=function(t){if(lr(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||Xe(t,this.intersectsCoordinate,this)}return!1},e.prototype.setCenter=function(t){var e=this.stride,r=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+r;for(var i=1;i<e;++i)n[e+i]=t[i];this.setFlatCoordinates(this.layout,n),this.changed()},e.prototype.setCenterAndRadius=function(t,e,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,i=Cn(n,0,t,this.stride);n[i++]=n[0]+e;for(var o=1,a=this.stride;o<a;++o)n[i++]=n[o];n.length=i,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e}(un);vs.prototype.transform;var Ts=vs;function _s(t){for(var e=[],r=0,n=t.length;r<n;++r)e.push(t[r].clone());return e}var Ss=function(t){function e(e){t.call(this),this.geometries_=e||null,this.listenGeometriesChange_()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)T(this.geometries_[t],R.CHANGE,this.changed,this)},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)C(this.geometries_[t],R.CHANGE,this.changed,this)},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t},e.prototype.closestPointXY=function(t,e,r,n){if(n<De(this.getExtent(),t,e))return n;for(var i=this.geometries_,o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(t,e,r,n);return n},e.prototype.containsXY=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){qe(t);for(var e=this.geometries_,r=0,n=e.length;r<n;++r)Ye(t,e[r].getExtent());return t},e.prototype.getGeometries=function(){return _s(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(h(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var r=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(r))return this.simplifiedGeometryCache[r];for(var n=[],i=this.geometries_,o=!1,a=0,s=i.length;a<s;++a){var l=i[a],c=l.getSimplifiedGeometry(t);n.push(c),c!==l&&(o=!0)}if(o){var u=new e(null);return u.setGeometriesArray(n),this.simplifiedGeometryCache[r]=u,u}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return hr.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)if(e[r].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,r){var n=r;n||(n=tr(this.getExtent()));for(var i=this.geometries_,o=0,a=i.length;o<a;++o)i[o].scale(t,e,n);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(_s(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(ln),Es={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function ws(t,e){return function(t,e,r,n){return function(r,i,o){var a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(r,i,o):t,!0),e.getType()==Es.ARRAY_BUFFER&&(a.responseType="arraybuffer"),a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){var r,i=e.getType();i==Es.JSON||i==Es.TEXT?r=a.responseText:i==Es.XML?(r=a.responseXML)||(r=(new DOMParser).parseFromString(a.responseText,"application/xml")):i==Es.ARRAY_BUFFER&&(r=a.response),r?function(t,e){"function"==typeof this.addFeatures&&this.addFeatures(t)}.call(this,e.readFeatures(r,{featureProjection:o}),e.readProjection(r),e.getLastExtent()):n.call(this)}else n.call(this)}.bind(this),a.onerror=function(){n.call(this)}.bind(this),a.send()}}(t,e,0,L)}var bs=function(){this.dataProjection=null,this.defaultFeatureProjection=null};bs.prototype.getReadOptions=function(t,e){var r;return e&&(r={dataProjection:e.dataProjection?e.dataProjection:this.readProjection(t),featureProjection:e.featureProjection}),this.adaptOptions(r)},bs.prototype.adaptOptions=function(t){return u({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},bs.prototype.getLastExtent=function(){return null},bs.prototype.getType=function(){return n()},bs.prototype.readFeature=function(t,e){return n()},bs.prototype.readFeatures=function(t,e){return n()},bs.prototype.readGeometry=function(t,e){return n()},bs.prototype.readProjection=function(t){return n()},bs.prototype.writeFeature=function(t,e){return n()},bs.prototype.writeFeatures=function(t,e){return n()},bs.prototype.writeGeometry=function(t,e){return n()};var Ls=bs;function As(t,e,r){var n,i=r?jr(r.featureProjection):null,o=r?jr(r.dataProjection):null;if(n=i&&o&&!Yr(i,o)?Array.isArray(t)?Xr(t,o,i):(e?t.clone():t).transform(e?i:o,e?o:i):t,e&&r&&void 0!==r.decimals&&!Array.isArray(n)){var a=Math.pow(10,r.decimals);n===t&&(n=t.clone()),n.applyTransform(function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*a)/a;return t})}return n}function xs(t){if("string"==typeof t){return JSON.parse(t)||null}return null!==t?t:null}var Ps=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.JSON},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return n()},e.prototype.readFeaturesFromObject=function(t,e){return n()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return n()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(xs(t))},e.prototype.readProjectionFromObject=function(t){return n()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return n()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return n()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return n()},e}(Ls);function Is(t,e){if(!t)return null;var r;switch(t.type){case hr.POINT:r=function(t){return new Pn(t.coordinates)}(t);break;case hr.LINE_STRING:r=function(t){return new ys(t.coordinates)}(t);break;case hr.POLYGON:r=function(t){return new Wn(t.coordinates)}(t);break;case hr.MULTI_POINT:r=function(t){return new ps(t.coordinates)}(t);break;case hr.MULTI_LINE_STRING:r=function(t){return new ms(t.coordinates)}(t);break;case hr.MULTI_POLYGON:r=function(t){return new Cs(t.coordinates)}(t);break;case hr.GEOMETRY_COLLECTION:r=function(t,e){var r=t.geometries.map(function(t){return Is(t,void 0)});return new Ss(r)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return As(r,!1,e)}function Rs(t,e){var r,n=(t=As(t,!0,e)).getType();switch(n){case hr.POINT:r=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case hr.LINE_STRING:r=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case hr.POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(r)}}(t,e);break;case hr.MULTI_POINT:r=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case hr.MULTI_LINE_STRING:r=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case hr.MULTI_POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(r)}}(t,e);break;case hr.GEOMETRY_COLLECTION:r=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){var r=u({},e);return delete r.featureProjection,Rs(t,r)})}}(t,e);break;case hr.CIRCLE:r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return r}var Os=function(t){function e(e){var r=e||{};t.call(this),this.dataProjection=jr(r.dataProjection?r.dataProjection:"EPSG:4326"),r.featureProjection&&(this.defaultFeatureProjection=jr(r.featureProjection)),this.geometryName_=r.geometryName,this.extractGeometryName_=r.extractGeometryName}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeatureFromObject=function(t,e){var r,n=Is((r="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),i=new ds;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties),i},e.prototype.readFeaturesFromObject=function(t,e){var r=null;if("FeatureCollection"===t.type){r=[];for(var n=t.features,i=0,o=n.length;i<o;++i)r.push(this.readFeatureFromObject(n[i],e))}else r=[this.readFeatureFromObject(t,e)];return r},e.prototype.readGeometryFromObject=function(t,e){return Is(t,e)},e.prototype.readProjectionFromObject=function(t){var e,r=t.crs;return r?"name"==r.type?e=jr(r.properties.name):te(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var r={type:"Feature",geometry:null,properties:null},n=t.getId();void 0!==n&&(r.id=n);var i=t.getGeometry();i&&(r.geometry=Rs(i,e));var o=t.getProperties();return delete o[t.getGeometryName()],p(o)||(r.properties=o),r},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:r}},e.prototype.writeGeometryObject=function(t,e){return Rs(t,this.adaptOptions(e))},e}(Ps),Ms=document.implementation.createDocument("","",null),ks="http://www.w3.org/2001/XMLSchema-instance";function Ns(t,e){return Ms.createElementNS(t,e)}function Ds(t,e){return function t(e,r,n){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)r?n.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):n.push(e.nodeValue);else{var i;for(i=e.firstChild;i;i=i.nextSibling)t(i,r,n)}return n}(t,e,[]).join("")}function Fs(t){return"documentElement"in t}function Bs(t){return(new DOMParser).parseFromString(t,"application/xml")}function Gs(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&Bt(n[n.length-1],i)}}function Us(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&n[n.length-1].push(i)}}function js(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&(n[n.length-1]=i)}}function qs(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName;(s in a?a[s]:a[s]=[]).push(o)}}}function Ws(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);void 0!==o&&(i[i.length-1][void 0!==e?e:n.localName]=o)}}function Hs(t,e){return function(r,n,i){t.call(void 0!==e?e:this,r,n,i),i[i.length-1].node.appendChild(r)}}function Vs(t,e){var r,n;return function(e,i,o){if(void 0===r){r={};var a={};a[e.localName]=t,r[e.namespaceURI]=a,n=Ys(e.localName)}Js(r,n,i,o)}}function Ys(t,e){var r=t;return function(t,n,i){var o=n[n.length-1].node,a=r;return void 0===a&&(a=i),Ns(void 0!==e?e:o.namespaceURI,a)}}var zs=Ys();function Ks(t,e){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=t[e[i]];return n}function $s(t,e,r){var n,i,o=void 0!==r?r:{};for(n=0,i=t.length;n<i;++n)o[t[n]]=e;return o}function Xs(t,e,r,n){var i;for(i=e.firstElementChild;i;i=i.nextElementSibling){var o=t[i.namespaceURI];if(void 0!==o){var a=o[i.localName];void 0!==a&&a.call(n,i,r)}}}function Zs(t,e,r,n,i){return n.push(t),Xs(e,r,n,i),n.pop()}function Js(t,e,r,n,i,o){for(var a,s,l=(void 0!==i?i:r).length,c=0;c<l;++c)void 0!==(a=r[c])&&void 0!==(s=e.call(void 0!==o?o:this,a,n,void 0!==i?i[c]:void 0))&&t[s.namespaceURI][s.localName].call(o,s,a,n)}function Qs(t,e,r,n,i,o,a){return i.push(t),Js(e,r,n,i,o,a),i.pop()}var tl=function(t){function e(){t.call(this),this.xmlSerializer_=new XMLSerializer}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.XML},e.prototype.readFeature=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readFeatureFromDocument(r,e)}return Fs(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}return null},e.prototype.readFeatureFromDocument=function(t,e){var r=this.readFeaturesFromDocument(t,e);return r.length>0?r[0]:null},e.prototype.readFeatureFromNode=function(t,e){return null},e.prototype.readFeatures=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readFeaturesFromDocument(r,e)}return Fs(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}return[]},e.prototype.readFeaturesFromDocument=function(t,e){for(var r=[],n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Bt(r,this.readFeaturesFromNode(n,e));return r},e.prototype.readFeaturesFromNode=function(t,e){return n()},e.prototype.readGeometry=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readGeometryFromDocument(r,e)}return Fs(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}return null},e.prototype.readGeometryFromDocument=function(t,e){return null},e.prototype.readGeometryFromNode=function(t,e){return null},e.prototype.readProjection=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readProjectionFromDocument(e)}return Fs(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}return null},e.prototype.readProjectionFromDocument=function(t){return this.dataProjection},e.prototype.readProjectionFromNode=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){var r=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeFeatureNode=function(t,e){return null},e.prototype.writeFeatures=function(t,e){var r=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeFeaturesNode=function(t,e){return null},e.prototype.writeGeometry=function(t,e){var r=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeGeometryNode=function(t,e){return null},e}(Ls),el="http://www.opengis.net/gml",rl=/^[\s\xa0]*$/,nl=function(t){function e(e){t.call(this);var r=e||{};this.featureType=r.featureType,this.featureNS=r.featureNS,this.srsName=r.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Us(this.readFeaturesInternal),featureMembers:js(this.readFeaturesInternal)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeaturesInternal=function(t,e){var r=t.localName,n=null;if("FeatureCollection"==r)n=Zs([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if("featureMembers"==r||"featureMember"==r){var i=e[0],o=i.featureType,a=i.featureNS;if(!o&&t.childNodes){o=[],a={};for(var s=0,l=t.childNodes.length;s<l;++s){var c=t.childNodes[s];if(1===c.nodeType){var u=c.nodeName.split(":").pop();if(-1===o.indexOf(u)){var h="",d=0,p=c.namespaceURI;for(var f in a){if(a[f]===p){h=f;break}++d}h||(a[h="p"+d]=p),o.push(h+":"+u)}}}"featureMember"!=r&&(i.featureType=o,i.featureNS=a)}if("string"==typeof a){var g=a;(a={}).p0=g}var y={},m=Array.isArray(o)?o:[o];for(var C in a){for(var v={},T=0,_=m.length;T<_;++T)(-1===m[T].indexOf(":")?"p0":m[T].split(":")[0])===C&&(v[m[T].split(":").pop()]="featureMembers"==r?Us(this.readFeatureElement,this):js(this.readFeatureElement,this));y[a[C]]=v}n=Zs("featureMember"==r?void 0:[],y,t,e)}return null===n&&(n=[]),n},e.prototype.readGeometryElement=function(t,e){var r=e[0];r.srsName=t.firstElementChild.getAttribute("srsName"),r.srsDimension=t.firstElementChild.getAttribute("srsDimension");var n=Zs(null,this.GEOMETRY_PARSERS,t,e,this);return n?As(n,!1,r):void 0},e.prototype.readFeatureElementInternal=function(t,e,r){for(var n,i={},o=t.firstElementChild;o;o=o.nextElementSibling){var a=void 0,s=o.localName;0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)?(a=Ds(o,!1),rl.test(a)&&(a=void 0)):(r&&(a=this.readGeometryElement(o,e)),a?"boundedBy"!==s&&(n=s):a=this.readFeatureElementInternal(o,e,!1)),i[s]?(i[s]instanceof Array||(i[s]=[i[s]]),i[s].push(a)):i[s]=a;var l=o.attributes.length;if(l>0){i[s]={_content_:i[s]};for(var c=0;c<l;c++){var u=o.attributes[c].name;i[s][u]=o.attributes[c].value}}}if(r){var h=new ds(i);n&&h.setGeometryName(n);var d=t.getAttribute("fid")||function(t,e,r){return t.getAttributeNS(e,"id")||""}(t,this.namespace);return d&&h.setId(d),h}return i},e.prototype.readFeatureElement=function(t,e){return this.readFeatureElementInternal(t,e,!0)},e.prototype.readPoint=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);if(r)return new Pn(r,dr.XYZ)},e.prototype.readMultiPoint=function(t,e){var r=Zs([],this.MULTIPOINT_PARSERS_,t,e,this);return r?new ps(r):void 0},e.prototype.readMultiLineString=function(t,e){var r=Zs([],this.MULTILINESTRING_PARSERS_,t,e,this);if(r)return new ms(r)},e.prototype.readMultiPolygon=function(t,e){var r=Zs([],this.MULTIPOLYGON_PARSERS_,t,e,this);if(r)return new Cs(r)},e.prototype.pointMemberParser_=function(t,e){Xs(this.POINTMEMBER_PARSERS_,t,e,this)},e.prototype.lineStringMemberParser_=function(t,e){Xs(this.LINESTRINGMEMBER_PARSERS_,t,e,this)},e.prototype.polygonMemberParser_=function(t,e){Xs(this.POLYGONMEMBER_PARSERS_,t,e,this)},e.prototype.readLineString=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);return r?new ys(r,dr.XYZ):void 0},e.prototype.readFlatLinearRing_=function(t,e){return Zs(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)||void 0},e.prototype.readLinearRing=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);if(r)return new xn(r,dr.XYZ)},e.prototype.readPolygon=function(t,e){var r=Zs([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(r&&r[0]){var n,i,o=r[0],a=[o.length];for(n=1,i=r.length;n<i;++n)Bt(o,r[n]),a.push(o.length);return new Wn(o,dr.XYZ,a)}},e.prototype.readFlatCoordinatesFromNode_=function(t,e){return Zs(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.readGeometryFromNode=function(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null},e.prototype.readFeaturesFromNode=function(t,e){var r={featureType:this.featureType,featureNS:this.featureNS};return e&&u(r,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[r])||[]},e.prototype.readProjectionFromNode=function(t){return jr(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))},e}(tl);nl.prototype.namespace=el,nl.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:Us(nl.prototype.pointMemberParser_),pointMembers:Us(nl.prototype.pointMemberParser_)}},nl.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:Us(nl.prototype.lineStringMemberParser_),lineStringMembers:Us(nl.prototype.lineStringMemberParser_)}},nl.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:Us(nl.prototype.polygonMemberParser_),polygonMembers:Us(nl.prototype.polygonMemberParser_)}},nl.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:Us(nl.prototype.readFlatCoordinatesFromNode_)}},nl.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Us(nl.prototype.readLineString)}},nl.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Us(nl.prototype.readPolygon)}},nl.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:js(nl.prototype.readFlatLinearRing_)}};var il=nl;function ol(t){return al(Ds(t,!1))}function al(t){var e=/^\s*(true|1)|(false|0)\s*$/.exec(t);return e?void 0!==e[1]||!1:void 0}function sl(t){var e=Ds(t,!1),r=Date.parse(e);return isNaN(r)?void 0:r/1e3}function ll(t){return cl(Ds(t,!1))}function cl(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function ul(t){return hl(Ds(t,!1))}function hl(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function dl(t){return Ds(t,!1).trim()}function pl(t,e){ml(t,e?"1":"0")}function fl(t,e){t.appendChild(Ms.createCDATASection(e))}function gl(t,e){var r=e.toPrecision();t.appendChild(Ms.createTextNode(r))}function yl(t,e){var r=e.toString();t.appendChild(Ms.createTextNode(r))}function ml(t,e){t.appendChild(Ms.createTextNode(e))}var Cl=el+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",vl={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Tl=function(t){function e(e){var r=e||{};t.call(this,r),this.surface_=void 0!==r.surface&&r.surface,this.curve_=void 0!==r.curve&&r.curve,this.multiCurve_=void 0===r.multiCurve||r.multiCurve,this.multiSurface_=void 0===r.multiSurface||r.multiSurface,this.schemaLocation=r.schemaLocation?r.schemaLocation:Cl,this.hasZ=void 0!==r.hasZ&&r.hasZ}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readMultiCurve_=function(t,e){var r=Zs([],this.MULTICURVE_PARSERS_,t,e,this);return r?new ms(r):void 0},e.prototype.readMultiSurface_=function(t,e){var r=Zs([],this.MULTISURFACE_PARSERS_,t,e,this);if(r)return new Cs(r)},e.prototype.curveMemberParser_=function(t,e){Xs(this.CURVEMEMBER_PARSERS_,t,e,this)},e.prototype.surfaceMemberParser_=function(t,e){Xs(this.SURFACEMEMBER_PARSERS_,t,e,this)},e.prototype.readPatch_=function(t,e){return Zs([null],this.PATCHES_PARSERS_,t,e,this)},e.prototype.readSegment_=function(t,e){return Zs([null],this.SEGMENTS_PARSERS_,t,e,this)},e.prototype.readPolygonPatch_=function(t,e){return Zs([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)},e.prototype.readLineStringSegment_=function(t,e){return Zs([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.interiorParser_=function(t,e){var r=Zs(void 0,this.RING_PARSERS,t,e,this);r&&e[e.length-1].push(r)},e.prototype.exteriorParser_=function(t,e){var r=Zs(void 0,this.RING_PARSERS,t,e,this);r&&(e[e.length-1][0]=r)},e.prototype.readSurface_=function(t,e){var r=Zs([null],this.SURFACE_PARSERS_,t,e,this);if(r&&r[0]){var n,i,o=r[0],a=[o.length];for(n=1,i=r.length;n<i;++n)Bt(o,r[n]),a.push(o.length);return new Wn(o,dr.XYZ,a)}},e.prototype.readCurve_=function(t,e){var r=Zs([null],this.CURVE_PARSERS_,t,e,this);return r?new ys(r,dr.XYZ):void 0},e.prototype.readEnvelope_=function(t,e){var r=Zs([null],this.ENVELOPE_PARSERS_,t,e,this);return je(r[1][0],r[1][1],r[2][0],r[2][1])},e.prototype.readFlatPos_=function(t,e){for(var r,n=Ds(t,!1),i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,o=[];r=i.exec(n);)o.push(parseFloat(r[1])),n=n.substr(r[0].length);if(""===n){var a,s,l=e[0].srsName,c="enu";l&&(c=jr(l).getAxisOrientation());if("neu"===c)for(a=0,s=o.length;a<s;a+=3){var u=o[a],h=o[a+1];o[a]=h,o[a+1]=u}var d=o.length;if(2==d&&o.push(0),0!==d)return o}},e.prototype.readFlatPosList_=function(t,e){var r=Ds(t,!1).replace(/^\s*|\s*$/g,""),n=e[0],i=n.srsName,o=n.srsDimension,a="enu";i&&(a=jr(i).getAxisOrientation());var s,l,c,u=r.split(/\s+/),h=2;t.getAttribute("srsDimension")?h=hl(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=hl(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=hl(t.parentNode.getAttribute("srsDimension")):o&&(h=hl(o));for(var d=[],p=0,f=u.length;p<f;p+=h)s=parseFloat(u[p]),l=parseFloat(u[p+1]),c=3===h?parseFloat(u[p+2]):0,"en"===a.substr(0,2)?d.push(s,l,c):d.push(l,s,c);return d},e.prototype.writePos_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";t.setAttribute("srsDimension",o);var a=n.srsName,s="enu";a&&(s=jr(a).getAxisOrientation());var l,c=e.getCoordinates();(l="en"===s.substr(0,2)?c[0]+" "+c[1]:c[1]+" "+c[0],i)&&(l+=" "+(c[2]||0));ml(t,l)},e.prototype.getCoords_=function(t,e,r){var n="enu";e&&(n=jr(e).getAxisOrientation());var i="en"===n.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];r&&(i+=" "+(t[2]||0));return i},e.prototype.writePosList_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";t.setAttribute("srsDimension",o);for(var a,s=n.srsName,l=e.getCoordinates(),c=l.length,u=new Array(c),h=0;h<c;++h)a=l[h],u[h]=this.getCoords_(a,s,i);ml(t,u.join(" "))},e.prototype.writePoint_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=Ns(t.namespaceURI,"pos");t.appendChild(i),this.writePos_(i,e,r)},e.prototype.writeEnvelope=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=[e[0]+" "+e[1],e[2]+" "+e[3]];Qs({node:t},this.ENVELOPE_SERIALIZERS_,zs,i,r,["lowerCorner","upperCorner"],this)},e.prototype.writeLinearRing_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=Ns(t.namespaceURI,"posList");t.appendChild(i),this.writePosList_(i,e,r)},e.prototype.RING_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),Ns(i.namespaceURI,void 0!==o?"interior":"exterior")},e.prototype.writeSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Qs({node:t,hasZ:i,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===t.nodeName){var s=Ns(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,r)}},e.prototype.writeCurveOrLineString_=function(t,e,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==t.nodeName&&n&&t.setAttribute("srsName",n),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var i=Ns(t.namespaceURI,"posList");t.appendChild(i),this.writePosList_(i,e,r)}else if("Curve"===t.nodeName){var o=Ns(t.namespaceURI,"segments");t.appendChild(o),this.writeCurveSegments_(o,e,r)}},e.prototype.writeMultiSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&t.setAttribute("srsName",o);var s=e.getPolygons();Qs({node:t,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeMultiPoint_=function(t,e,r){var n=r[r.length-1],i=n.srsName,o=n.hasZ;i&&t.setAttribute("srsName",i);var a=e.getPoints();Qs({node:t,hasZ:o,srsName:i},this.POINTMEMBER_SERIALIZERS_,Ys("pointMember"),a,r,void 0,this)},e.prototype.writeMultiCurveOrLineString_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&t.setAttribute("srsName",o);var s=e.getLineStrings();Qs({node:t,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeRing_=function(t,e,r){var n=Ns(t.namespaceURI,"LinearRing");t.appendChild(n),this.writeLinearRing_(n,e,r)},e.prototype.writeSurfaceOrPolygonMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r))},e.prototype.writePointMember_=function(t,e,r){var n=Ns(t.namespaceURI,"Point");t.appendChild(n),this.writePoint_(n,e,r)},e.prototype.writeLineStringOrCurveMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeCurveOrLineString_(n,e,r))},e.prototype.writeSurfacePatches_=function(t,e,r){var n=Ns(t.namespaceURI,"PolygonPatch");t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r)},e.prototype.writeCurveSegments_=function(t,e,r){var n=Ns(t.namespaceURI,"LineStringSegment");t.appendChild(n),this.writeCurveOrLineString_(n,e,r)},e.prototype.writeGeometryElement=function(t,e,r){var n,i=r[r.length-1],o=u({},i);o.node=t,n=Array.isArray(e)?i.dataProjection?Xr(e,i.featureProjection,i.dataProjection):e:As(e,!0,i),Qs(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},e.prototype.writeFeatureElement=function(t,e,r){var n=e.getId();n&&t.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=e.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=e.getProperties(),l=[],c=[];for(var h in s){var d=s[h];null!==d&&(l.push(h),c.push(d),h==a||"function"==typeof d.getSimplifiedGeometry?h in i.serializers[o]||(i.serializers[o][h]=Hs(this.writeGeometryElement,this)):h in i.serializers[o]||(i.serializers[o][h]=Hs(ml)))}var p=u({},i);p.node=t,Qs(p,i.serializers,Ys(void 0,o),c,r,l)},e.prototype.writeFeatureMembers_=function(t,e,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a={};a[o]={},a[o][i]=Hs(this.writeFeatureElement,this);var s=u({},n);s.node=t,Qs(s,a,Ys(i,o),e,r)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1].node;return Ns(this.namespace,vl[n.nodeName])},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,r){var n,i=e[e.length-1],o=i.multiSurface,a=i.surface,s=i.curve,l=i.multiCurve;return Array.isArray(t)?n="Envelope":"MultiPolygon"===(n=t.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"LineString"===n&&!0===s?n="Curve":"MultiLineString"===n&&!0===l&&(n="MultiCurve"),Ns(this.namespace,n)},e.prototype.writeGeometryNode=function(t,e){e=this.adaptOptions(e);var r=Ns(this.namespace,"geom"),n={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&u(n,e),this.writeGeometryElement(r,t,[n]),r},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=Ns(this.namespace,"featureMembers");r.setAttributeNS(ks,"xsi:schemaLocation",this.schemaLocation);var n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&u(n,e),this.writeFeatureMembers_(r,t,[n]),r},e}(il);Tl.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:js(Tl.prototype.readFlatPos_),posList:js(Tl.prototype.readFlatPosList_)}},Tl.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Tl.prototype.interiorParser_,exterior:Tl.prototype.exteriorParser_}},Tl.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:js(il.prototype.readPoint),MultiPoint:js(il.prototype.readMultiPoint),LineString:js(il.prototype.readLineString),MultiLineString:js(il.prototype.readMultiLineString),LinearRing:js(il.prototype.readLinearRing),Polygon:js(il.prototype.readPolygon),MultiPolygon:js(il.prototype.readMultiPolygon),Surface:js(Tl.prototype.readSurface_),MultiSurface:js(Tl.prototype.readMultiSurface_),Curve:js(Tl.prototype.readCurve_),MultiCurve:js(Tl.prototype.readMultiCurve_),Envelope:js(Tl.prototype.readEnvelope_)}},Tl.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:Us(Tl.prototype.curveMemberParser_),curveMembers:Us(Tl.prototype.curveMemberParser_)}},Tl.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:Us(Tl.prototype.surfaceMemberParser_),surfaceMembers:Us(Tl.prototype.surfaceMemberParser_)}},Tl.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Us(il.prototype.readLineString),Curve:Us(Tl.prototype.readCurve_)}},Tl.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Us(il.prototype.readPolygon),Surface:Us(Tl.prototype.readSurface_)}},Tl.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:js(Tl.prototype.readPatch_)}},Tl.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:js(Tl.prototype.readSegment_)}},Tl.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:Us(Tl.prototype.readFlatPosList_),upperCorner:Us(Tl.prototype.readFlatPosList_)}},Tl.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:js(Tl.prototype.readPolygonPatch_)}},Tl.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:js(Tl.prototype.readLineStringSegment_)}},Tl.prototype.writeFeatures,Tl.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:Hs(Tl.prototype.writeRing_),interior:Hs(Tl.prototype.writeRing_)}},Tl.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Hs(ml),upperCorner:Hs(ml)}},Tl.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Hs(Tl.prototype.writeSurfaceOrPolygonMember_),polygonMember:Hs(Tl.prototype.writeSurfaceOrPolygonMember_)}},Tl.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Hs(Tl.prototype.writePointMember_)}},Tl.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Hs(Tl.prototype.writeLineStringOrCurveMember_),curveMember:Hs(Tl.prototype.writeLineStringOrCurveMember_)}},Tl.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Hs(Tl.prototype.writeCurveOrLineString_),MultiCurve:Hs(Tl.prototype.writeMultiCurveOrLineString_),Point:Hs(Tl.prototype.writePoint_),MultiPoint:Hs(Tl.prototype.writeMultiPoint_),LineString:Hs(Tl.prototype.writeCurveOrLineString_),MultiLineString:Hs(Tl.prototype.writeMultiCurveOrLineString_),LinearRing:Hs(Tl.prototype.writeLinearRing_),Polygon:Hs(Tl.prototype.writeSurfaceOrPolygon_),MultiPolygon:Hs(Tl.prototype.writeMultiSurfaceOrPolygon_),Surface:Hs(Tl.prototype.writeSurfaceOrPolygon_),MultiSurface:Hs(Tl.prototype.writeMultiSurfaceOrPolygon_),Envelope:Hs(Tl.prototype.writeEnvelope)}};var _l=Tl,Sl=_l;Sl.prototype.writeFeatures,Sl.prototype.writeFeaturesNode;var El=Sl,wl=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],bl={rte:Ql,trk:tc,wpt:ec},Ll=$s(wl,{rte:Us(Ql),trk:Us(tc),wpt:Us(ec)}),Al=$s(wl,{text:Ws(dl,"linkText"),type:Ws(dl,"linkType")}),xl=$s(wl,{rte:Hs(function(t,e,r){var n=r[0],i=e.getProperties(),o={node:t};o.properties=i;var a=e.getGeometry();if(a.getType()==hr.LINE_STRING){var s=As(a,!0,n);o.geometryLayout=s.getLayout(),i.rtept=s.getCoordinates()}var l=r[r.length-1].node,c=Bl[l.namespaceURI],u=Ks(i,c);Qs(o,Gl,zs,u,r,c)}),trk:Hs(function(t,e,r){var n=r[0],i=e.getProperties(),o={node:t};o.properties=i;var a=e.getGeometry();if(a.getType()==hr.MULTI_LINE_STRING){var s=As(a,!0,n);i.trkseg=s.getLineStrings()}var l=r[r.length-1].node,c=jl[l.namespaceURI],u=Ks(i,c);Qs(o,ql,zs,u,r,c)}),wpt:Hs(function(t,e,r){var n=r[0],i=r[r.length-1];i.properties=e.getProperties();var o=e.getGeometry();if(o.getType()==hr.POINT){var a=As(o,!0,n);i.geometryLayout=a.getLayout(),nc(t,a.getCoordinates(),r)}})}),Pl=function(t){function e(e){t.call(this);var r=e||{};this.dataProjection=jr("EPSG:4326"),this.readExtensions_=r.readExtensions}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleReadExtensions_=function(t){t||(t=[]);for(var e=0,r=t.length;e<r;++e){var n=t[e];if(this.readExtensions_){var i=n.get("extensionsNode_")||null;this.readExtensions_(n,i)}n.set("extensionsNode_",void 0)}},e.prototype.readFeatureFromNode=function(t,e){if(!Nt(wl,t.namespaceURI))return null;var r=bl[t.localName];if(!r)return null;var n=r(t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_([n]),n):null},e.prototype.readFeaturesFromNode=function(t,e){if(!Nt(wl,t.namespaceURI))return[];if("gpx"==t.localName){var r=Zs([],Ll,t,[this.getReadOptions(t,e)]);return r?(this.handleReadExtensions_(r),r):[]}return[]},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=Ns("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",ks),r.setAttributeNS(ks,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),Qs({node:r},xl,Kl,t,[e]),r},e}(tl),Il=$s(wl,{name:Ws(dl),cmt:Ws(dl),desc:Ws(dl),src:Ws(dl),link:Zl,number:Ws(ul),extensions:Jl,type:Ws(dl),rtept:function(t,e){var r=Zs({},Rl,t,e);if(r){var n=e[e.length-1];$l(n.flatCoordinates,n.layoutOptions,t,r)}}}),Rl=$s(wl,{ele:Ws(ll),time:Ws(sl)}),Ol=$s(wl,{name:Ws(dl),cmt:Ws(dl),desc:Ws(dl),src:Ws(dl),link:Zl,number:Ws(ul),type:Ws(dl),extensions:Jl,trkseg:function(t,e){var r=e[e.length-1];Xs(Ml,t,e);var n=r.flatCoordinates;r.ends.push(n.length)}}),Ml=$s(wl,{trkpt:function(t,e){var r=Zs({},kl,t,e);if(r){var n=e[e.length-1];$l(n.flatCoordinates,n.layoutOptions,t,r)}}}),kl=$s(wl,{ele:Ws(ll),time:Ws(sl)}),Nl=$s(wl,{ele:Ws(ll),time:Ws(sl),magvar:Ws(ll),geoidheight:Ws(ll),name:Ws(dl),cmt:Ws(dl),desc:Ws(dl),src:Ws(dl),link:Zl,sym:Ws(dl),type:Ws(dl),fix:Ws(dl),sat:Ws(ul),hdop:Ws(ll),vdop:Ws(ll),pdop:Ws(ll),ageofdgpsdata:Ws(ll),dgpsid:Ws(ul),extensions:Jl}),Dl=["text","type"],Fl=$s(wl,{text:Hs(ml),type:Hs(ml)}),Bl=$s(wl,["name","cmt","desc","src","link","number","type","rtept"]),Gl=$s(wl,{name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),number:Hs(yl),type:Hs(ml),rtept:Vs(Hs(nc))}),Ul=$s(wl,["ele","time"]),jl=$s(wl,["name","cmt","desc","src","link","number","type","trkseg"]),ql=$s(wl,{name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),number:Hs(yl),type:Hs(ml),trkseg:Vs(Hs(function(t,e,r){var n={node:t};n.geometryLayout=e.getLayout(),n.properties={},Qs(n,Hl,Wl,e.getCoordinates(),r)}))}),Wl=Ys("trkpt"),Hl=$s(wl,{trkpt:Hs(nc)}),Vl=$s(wl,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Yl=$s(wl,{ele:Hs(gl),time:Hs(function(t,e){var r=new Date(1e3*e),n=r.getUTCFullYear()+"-"+Ce(r.getUTCMonth()+1,2)+"-"+Ce(r.getUTCDate(),2)+"T"+Ce(r.getUTCHours(),2)+":"+Ce(r.getUTCMinutes(),2)+":"+Ce(r.getUTCSeconds(),2)+"Z";t.appendChild(Ms.createTextNode(n))}),magvar:Hs(gl),geoidheight:Hs(gl),name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),sym:Hs(ml),type:Hs(ml),fix:Hs(ml),sat:Hs(yl),hdop:Hs(gl),vdop:Hs(gl),pdop:Hs(gl),ageofdgpsdata:Hs(gl),dgpsid:Hs(yl)}),zl={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Kl(t,e,r){var n=t.getGeometry();if(n){var i=zl[n.getType()];if(i)return Ns(e[e.length-1].node.namespaceURI,i)}}function $l(t,e,r,n){return t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in n?(t.push(n.ele),delete n.ele,e.hasZ=!0):t.push(0),"time"in n?(t.push(n.time),delete n.time,e.hasM=!0):t.push(0),t}function Xl(t,e,r){var n=dr.XY,i=2;if(t.hasZ&&t.hasM?(n=dr.XYZM,i=4):t.hasZ?(n=dr.XYZ,i=3):t.hasM&&(n=dr.XYM,i=3),4!==i){for(var o=0,a=e.length/4;o<a;o++)e[o*i]=e[4*o],e[o*i+1]=e[4*o+1],t.hasZ&&(e[o*i+2]=e[4*o+2]),t.hasM&&(e[o*i+2]=e[4*o+3]);if(e.length=e.length/4*i,r)for(var s=0,l=r.length;s<l;s++)r[s]=r[s]/4*i}return n}function Zl(t,e){var r=e[e.length-1],n=t.getAttribute("href");null!==n&&(r.link=n),Xs(Al,t,e)}function Jl(t,e){e[e.length-1].extensionsNode_=t}function Ql(t,e){var r=e[0],n=Zs({flatCoordinates:[],layoutOptions:{}},Il,t,e);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.layoutOptions;delete n.layoutOptions;var a=Xl(o,i),s=new ys(i,a);As(s,!1,r);var l=new ds(s);return l.setProperties(n),l}}function tc(t,e){var r=e[0],n=Zs({flatCoordinates:[],ends:[],layoutOptions:{}},Ol,t,e);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.ends;delete n.ends;var a=n.layoutOptions;delete n.layoutOptions;var s=Xl(a,i,o),l=new ms(i,s,o);As(l,!1,r);var c=new ds(l);return c.setProperties(n),c}}function ec(t,e){var r=e[0],n=Zs({},Nl,t,e);if(n){var i={},o=$l([],i,t,n),a=Xl(i,o),s=new Pn(o,a);As(s,!1,r);var l=new ds(s);return l.setProperties(n),l}}function rc(t,e,r){t.setAttribute("href",e);var n=r[r.length-1].properties,i=[n.linkText,n.linkType];Qs({node:t},Fl,zs,i,r,Dl)}function nc(t,e,r){var n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case dr.XYZM:0!==e[3]&&(o.time=e[3]);case dr.XYZ:0!==e[2]&&(o.ele=e[2]);break;case dr.XYM:0!==e[2]&&(o.time=e[2])}var a="rtept"==t.nodeName?Ul[i]:Vl[i],s=Ks(o,a);Qs({node:t,properties:o},Yl,zs,s,r,a)}var ic=Pl,oc=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.checksum_=void 0};oc.prototype.clone=function(){var t=this.getColor();return new oc({color:Array.isArray(t)?t.slice():t||void 0})},oc.prototype.getColor=function(){return this.color_},oc.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},oc.prototype.getChecksum=function(){if(void 0===this.checksum_){var t=this.color_;t?Array.isArray(t)||"string"==typeof t?this.checksum_="f"+Go(t):this.checksum_=o(this.color_):this.checksum_="f-"}return this.checksum_};var ac=oc,sc={FRACTION:"fraction",PIXELS:"pixels"},lc=function(t){function e(e,r,n,i,o,a){t.call(this),this.hitDetectionImage_=null,this.image_=e||new Image,null!==i&&(this.image_.crossOrigin=i),this.canvas_=a?document.createElement("canvas"):null,this.color_=a,this.imageListenerKeys_=null,this.imageState_=o,this.size_=n,this.src_=r,this.tainted_}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===fo.LOADED){this.tainted_=!1;var t=$n(1,1);try{t.drawImage(this.image_,0,0),t.getImageData(0,0,1,1)}catch(t){this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(R.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=fo.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=fo.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.replaceColor_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],r=this.size_[1],n=$n(e,r);n.fillRect(0,0,e,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==fo.IDLE){this.imageState_=fo.LOADING,this.imageListenerKeys_=[v(this.image_,R.ERROR,this.handleImageError_,this),v(this.image_,R.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}},e.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),r=e.data,n=this.color_[0]/255,i=this.color_[1]/255,o=this.color_[2]/255,a=0,s=r.length;a<s;a+=4)r[a]*=n,r[a+1]*=i,r[a+2]*=o;t.putImageData(e,0,0)}},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(I),cc={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},uc=function(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale};uc.prototype.clone=function(){return new uc({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},uc.prototype.getOpacity=function(){return this.opacity_},uc.prototype.getRotateWithView=function(){return this.rotateWithView_},uc.prototype.getRotation=function(){return this.rotation_},uc.prototype.getScale=function(){return this.scale_},uc.prototype.getSnapToPixel=function(){return!1},uc.prototype.getAnchor=function(){return n()},uc.prototype.getImage=function(t){return n()},uc.prototype.getHitDetectionImage=function(t){return n()},uc.prototype.getImageState=function(){return n()},uc.prototype.getImageSize=function(){return n()},uc.prototype.getHitDetectionImageSize=function(){return n()},uc.prototype.getOrigin=function(){return n()},uc.prototype.getSize=function(){return n()},uc.prototype.setOpacity=function(t){this.opacity_=t},uc.prototype.setRotateWithView=function(t){this.rotateWithView_=t},uc.prototype.setRotation=function(t){this.rotation_=t},uc.prototype.setScale=function(t){this.scale_=t},uc.prototype.setSnapToPixel=function(t){},uc.prototype.listenImageChange=function(t,e){return n()},uc.prototype.load=function(){n()},uc.prototype.unlistenImageChange=function(t,e){n()};var hc=uc,dc=function(t){function e(e){var r=e||{},n=void 0!==r.opacity?r.opacity:1,i=void 0!==r.rotation?r.rotation:0,a=void 0!==r.scale?r.scale:1,s=void 0!==r.rotateWithView&&r.rotateWithView;t.call(this,{opacity:n,rotation:i,scale:a,rotateWithView:s}),this.anchor_=void 0!==r.anchor?r.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:cc.TOP_LEFT,this.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:sc.FRACTION,this.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:sc.FRACTION,this.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var l=void 0!==r.img?r.img:null,c=void 0!==r.imgSize?r.imgSize:null,u=r.src;te(!(void 0!==u&&l),4),te(!l||l&&c,5),void 0!==u&&0!==u.length||!l||(u=l.src||o(l)),te(void 0!==u&&u.length>0,6);var h=void 0!==r.src?fo.IDLE:fo.LOADED;this.color_=void 0!==r.color?jo(r.color):null,this.iconImage_=function(t,e,r,n,i,o){var a=Xo.get(e,n,o);return a||(a=new lc(t,e,r,n,i,o),Xo.set(e,n,o,a)),a}(l,u,c,this.crossOrigin_,h,this.color_),this.offset_=void 0!==r.offset?r.offset:[0,0],this.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:cc.TOP_LEFT,this.origin_=null,this.size_=void 0!==r.size?r.size:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==sc.FRACTION||this.anchorYUnits_==sc.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==sc.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==sc.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=cc.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=cc.TOP_RIGHT&&this.anchorOrigin_!=cc.BOTTOM_RIGHT||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=cc.BOTTOM_LEFT&&this.anchorOrigin_!=cc.BOTTOM_RIGHT||(t[1]=-t[1]+e[1])}return this.normalizedAnchor_=t,this.normalizedAnchor_},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=cc.TOP_LEFT){var e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),this.offsetOrigin_!=cc.TOP_RIGHT&&this.offsetOrigin_!=cc.BOTTOM_RIGHT||(t[0]=r[0]-e[0]-t[0]),this.offsetOrigin_!=cc.BOTTOM_LEFT&&this.offsetOrigin_!=cc.BOTTOM_RIGHT||(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t,e){return C(this.iconImage_,R.CHANGE,t,e)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t,e){T(this.iconImage_,R.CHANGE,t,e)},e}(hc),pc=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width,this.checksum_=void 0};pc.prototype.clone=function(){var t=this.getColor();return new pc({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},pc.prototype.getColor=function(){return this.color_},pc.prototype.getLineCap=function(){return this.lineCap_},pc.prototype.getLineDash=function(){return this.lineDash_},pc.prototype.getLineDashOffset=function(){return this.lineDashOffset_},pc.prototype.getLineJoin=function(){return this.lineJoin_},pc.prototype.getMiterLimit=function(){return this.miterLimit_},pc.prototype.getWidth=function(){return this.width_},pc.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},pc.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},pc.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},pc.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},pc.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},pc.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},pc.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},pc.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=o(this.color_):this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_};var fc=pc,gc=function(t){function e(e){var r=void 0!==e.rotateWithView&&e.rotateWithView;t.call(this,{opacity:1,rotateWithView:r,rotation:void 0!==e.rotation?e.rotation:0,scale:1}),this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=void 0!==e.radius?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=e.atlasManager,this.render_(this.atlasManager_)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},e.prototype.getImage=function(t){return this.canvas_},e.prototype.getImageSize=function(){return this.imageSize_},e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.prototype.getImageState=function(){return fo.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t,e){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t,e){},e.prototype.render_=function(t){var e,r,n="",i="",o=0,a=null,s=0,l=0;this.stroke_&&(null===(r=this.stroke_.getColor())&&(r=So),r=Ho(r),void 0===(l=this.stroke_.getWidth())&&(l=1),a=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),K||(a=null,s=0),void 0===(i=this.stroke_.getLineJoin())&&(i="round"),void 0===(n=this.stroke_.getLineCap())&&(n="round"),void 0===(o=this.stroke_.getMiterLimit())&&(o=10));var c=2*(this.radius_+l)+1,u={strokeStyle:r,strokeWidth:l,size:c,lineCap:n,lineDash:a,lineDashOffset:s,lineJoin:i,miterLimit:o};if(void 0===t){var h=$n(c,c);this.canvas_=h.canvas,e=c=this.canvas_.width,this.draw_(u,h,0,0),this.createHitDetectionCanvas_(u)}else{c=Math.round(c);var d,p=!this.fill_;p&&(d=this.drawHitDetectionCanvas_.bind(this,u));var f=this.getChecksum(),g=t.add(f,c,c,this.draw_.bind(this,u),d);this.canvas_=g.image,this.origin_=[g.offsetX,g.offsetY],e=g.image.width,p?(this.hitDetectionCanvas_=g.hitImage,this.hitDetectionImageSize_=[g.hitImage.width,g.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[e,e])}this.anchor_=[c/2,c/2],this.size_=[c,c],this.imageSize_=[e,e]},e.prototype.draw_=function(t,e,r,n){var i,o,a;e.setTransform(1,0,0,1,0,0),e.translate(r,n),e.beginPath();var s=this.points_;if(s===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var l=void 0!==this.radius2_?this.radius2_:this.radius_;for(l!==this.radius_&&(s*=2),i=0;i<=s;i++)o=2*i*Math.PI/s-Math.PI/2+this.angle_,a=i%2==0?this.radius_:l,e.lineTo(t.size/2+a*Math.cos(o),t.size/2+a*Math.sin(o))}if(this.fill_){var c=this.fill_.getColor();null===c&&(c=To),e.fillStyle=Ho(c),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},e.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var e=$n(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e,0,0)}},e.prototype.drawHitDetectionCanvas_=function(t,e,r,n){e.setTransform(1,0,0,1,0,0),e.translate(r,n),e.beginPath();var i=this.points_;if(i===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o,a,s,l=void 0!==this.radius2_?this.radius2_:this.radius_;for(l!==this.radius_&&(i*=2),o=0;o<=i;o++)s=2*o*Math.PI/i-Math.PI/2+this.angle_,a=o%2==0?this.radius_:l,e.lineTo(t.size/2+a*Math.cos(s),t.size/2+a*Math.sin(s))}e.fillStyle=Go(To),e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()},e.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var r="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[r,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},e}(hc),yc=function(t){function e(e){var r=e||{};t.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,atlasManager:r.atlasManager})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.setRadius=function(t){this.radius_=t,this.render_(this.atlasManager_)},e}(gc),mc=function(t){var e=t||{};this.geometry_=null,this.geometryFunction_=_c,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex};mc.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new mc({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},mc.prototype.getRenderer=function(){return this.renderer_},mc.prototype.setRenderer=function(t){this.renderer_=t},mc.prototype.getGeometry=function(){return this.geometry_},mc.prototype.getGeometryFunction=function(){return this.geometryFunction_},mc.prototype.getFill=function(){return this.fill_},mc.prototype.setFill=function(t){this.fill_=t},mc.prototype.getImage=function(){return this.image_},mc.prototype.setImage=function(t){this.image_=t},mc.prototype.getStroke=function(){return this.stroke_},mc.prototype.setStroke=function(t){this.stroke_=t},mc.prototype.getText=function(){return this.text_},mc.prototype.setText=function(t){this.text_=t},mc.prototype.getZIndex=function(){return this.zIndex_},mc.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=_c,this.geometry_=t},mc.prototype.setZIndex=function(t){this.zIndex_=t};var Cc=null;function vc(t,e){if(!Cc){var r=new ac({color:"rgba(255,255,255,0.4)"}),n=new fc({color:"#3399CC",width:1.25});Cc=[new mc({image:new yc({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return Cc}function Tc(){var t={},e=[255,255,255,1],r=[0,153,255,1];return t[hr.POLYGON]=[new mc({fill:new ac({color:[255,255,255,.5]})})],t[hr.MULTI_POLYGON]=t[hr.POLYGON],t[hr.LINE_STRING]=[new mc({stroke:new fc({color:e,width:5})}),new mc({stroke:new fc({color:r,width:3})})],t[hr.MULTI_LINE_STRING]=t[hr.LINE_STRING],t[hr.CIRCLE]=t[hr.POLYGON].concat(t[hr.LINE_STRING]),t[hr.POINT]=[new mc({image:new yc({radius:6,fill:new ac({color:r}),stroke:new fc({color:e,width:1.5})}),zIndex:1/0})],t[hr.MULTI_POINT]=t[hr.POINT],t[hr.GEOMETRY_COLLECTION]=t[hr.POLYGON].concat(t[hr.LINE_STRING],t[hr.POINT]),t}function _c(t){return t.getGeometry()}var Sc=mc,Ec=function(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new ac({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding};Ec.prototype.clone=function(){return new Ec({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})},Ec.prototype.getOverflow=function(){return this.overflow_},Ec.prototype.getFont=function(){return this.font_},Ec.prototype.getMaxAngle=function(){return this.maxAngle_},Ec.prototype.getPlacement=function(){return this.placement_},Ec.prototype.getOffsetX=function(){return this.offsetX_},Ec.prototype.getOffsetY=function(){return this.offsetY_},Ec.prototype.getFill=function(){return this.fill_},Ec.prototype.getRotateWithView=function(){return this.rotateWithView_},Ec.prototype.getRotation=function(){return this.rotation_},Ec.prototype.getScale=function(){return this.scale_},Ec.prototype.getStroke=function(){return this.stroke_},Ec.prototype.getText=function(){return this.text_},Ec.prototype.getTextAlign=function(){return this.textAlign_},Ec.prototype.getTextBaseline=function(){return this.textBaseline_},Ec.prototype.getBackgroundFill=function(){return this.backgroundFill_},Ec.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},Ec.prototype.getPadding=function(){return this.padding_},Ec.prototype.setOverflow=function(t){this.overflow_=t},Ec.prototype.setFont=function(t){this.font_=t},Ec.prototype.setMaxAngle=function(t){this.maxAngle_=t},Ec.prototype.setOffsetX=function(t){this.offsetX_=t},Ec.prototype.setOffsetY=function(t){this.offsetY_=t},Ec.prototype.setPlacement=function(t){this.placement_=t},Ec.prototype.setFill=function(t){this.fill_=t},Ec.prototype.setRotation=function(t){this.rotation_=t},Ec.prototype.setScale=function(t){this.scale_=t},Ec.prototype.setStroke=function(t){this.stroke_=t},Ec.prototype.setText=function(t){this.text_=t},Ec.prototype.setTextAlign=function(t){this.textAlign_=t},Ec.prototype.setTextBaseline=function(t){this.textBaseline_=t},Ec.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},Ec.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},Ec.prototype.setPadding=function(t){this.padding_=t};var wc,bc,Lc,Ac,xc,Pc,Ic,Rc,Oc,Mc=Ec,kc=["http://www.google.com/kml/ext/2.2"],Nc=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Dc={fraction:sc.FRACTION,pixels:sc.PIXELS,insetPixels:sc.PIXELS},Fc=$s(Nc,{ExtendedData:xu,Region:Pu,MultiGeometry:Ws(vu,"geometry"),LineString:Ws(yu,"geometry"),LinearRing:Ws(mu,"geometry"),Point:Ws(Tu,"geometry"),Polygon:Ws(Su,"geometry"),Style:Ws(wu),StyleMap:function(t,e){var r=ru(t,e);if(r){var n=e[e.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:te(!1,38)}},address:Ws(dl),description:Ws(dl),name:Ws(dl),open:Ws(ol),phoneNumber:Ws(dl),styleUrl:Ws(Qc),visibility:Ws(ol)},$s(kc,{MultiTrack:Ws(function(t,e){var r=Zs([],cu,t,e);if(r)return new ms(r)},"geometry"),Track:Ws(hu,"geometry")})),Bc=$s(Nc,{ExtendedData:xu,Region:Pu,Link:function(t,e){Xs(Gc,t,e)},address:Ws(dl),description:Ws(dl),name:Ws(dl),open:Ws(ol),phoneNumber:Ws(dl),visibility:Ws(ol)}),Gc=$s(Nc,{href:Ws(Qc)}),Uc=$s(Nc,{LatLonAltBox:function(t,e){var r=Zs({},Ou,t,e);if(r){var n=e[e.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)}},Lod:function(t,e){var r=Zs({},Mu,t,e);if(r){var n=e[e.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}}),jc=$s(Nc,["Document","Placemark"]),qc=$s(Nc,{Document:Hs(function(t,e,r){Qs({node:t},Bu,Gu,e,r,void 0,this)}),Placemark:Hs(ch)}),Wc=null,Hc=null,Vc=null,Yc=null,zc=null,Kc=null,$c=function(t){function e(e){t.call(this);var r=e||{};Kc||(Wc=new ac({color:wc=[255,255,255,1]}),bc=[20,2],Lc=sc.PIXELS,Ac=sc.PIXELS,xc=[64,64],Pc="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Ic=.5,Hc=new dc({anchor:bc,anchorOrigin:cc.BOTTOM_LEFT,anchorXUnits:Lc,anchorYUnits:Ac,crossOrigin:"anonymous",rotation:0,scale:Ic,size:xc,src:Pc}),Rc="NO_IMAGE",Vc=new fc({color:wc,width:1}),Oc=new fc({color:[51,51,51,1],width:2}),Yc=new Mc({font:"bold 16px Helvetica",fill:Wc,stroke:Oc,scale:.8}),zc=new Sc({fill:Wc,image:Hc,text:Yc,stroke:Vc,zIndex:0}),Kc=[zc]),this.dataProjection=jr("EPSG:4326"),this.defaultStyle_=r.defaultStyle?r.defaultStyle:Kc,this.extractStyles_=void 0===r.extractStyles||r.extractStyles,this.writeStyles_=void 0===r.writeStyles||r.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===r.showPointNames||r.showPointNames}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readDocumentOrFolder_=function(t,e){return Zs([],$s(Nc,{Document:Gs(this.readDocumentOrFolder_,this),Folder:Gs(this.readDocumentOrFolder_,this),Placemark:Us(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this)||void 0},e.prototype.readPlacemark_=function(t,e){var r=Zs({geometry:null},Fc,t,e);if(r){var n=new ds,i=t.getAttribute("id");null!==i&&n.setId(i);var o=e[0],a=r.geometry;if(a&&As(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){var s=function(t,e,r,n,i){return function(o,a){var s,l=i,c="";if(l){var u=o.getGeometry();u&&(l=u.getType()===hr.POINT)}if(l&&(c=o.get("name"),l=l&&!!c),t)return l?(s=Xc(t[0],c),t.concat(s)):t;if(e){var h=function t(e,r,n){return Array.isArray(e)?e:"string"==typeof e?(!(e in n)&&"#"+e in n&&(e="#"+e),t(n[e],r,n)):r}(e,r,n);return l?(s=Xc(h[0],c),h.concat(s)):h}return l?(s=Xc(r[0],c),r.concat(s)):r}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(s)}return delete r.Style,n.setProperties(r),n}},e.prototype.readSharedStyle_=function(t,e){var r=t.getAttribute("id");if(null!==r){var n=wu(t,e);if(n){var i,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href),i=o?new URL("#"+r,o).href:"#"+r;this.sharedStyles_[i]=n}}},e.prototype.readSharedStyleMap_=function(t,e){var r=t.getAttribute("id");if(null!==r){var n=ru(t,e);if(n){var i,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href),i=o?new URL("#"+r,o).href:"#"+r;this.sharedStyles_[i]=n}}},e.prototype.readFeatureFromNode=function(t,e){return Nt(Nc,t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null},e.prototype.readFeaturesFromNode=function(t,e){if(!Nt(Nc,t.namespaceURI))return[];var r,n=t.localName;if("Document"==n||"Folder"==n)return(r=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==n){var i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i?[i]:[]}if("kml"==n){r=[];for(var o=t.firstElementChild;o;o=o.nextElementSibling){var a=this.readFeaturesFromNode(o,e);a&&Bt(r,a)}return r}return[]},e.prototype.readName=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readNameFromDocument(e)}return Fs(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}},e.prototype.readNameFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(e);if(r)return r}},e.prototype.readNameFromNode=function(t){for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(Nt(Nc,e.namespaceURI)&&"name"==e.localName)return dl(e);for(var r=t.firstElementChild;r;r=r.nextElementSibling){var n=r.localName;if(Nt(Nc,r.namespaceURI)&&("Document"==n||"Folder"==n||"Placemark"==n||"kml"==n)){var i=this.readNameFromNode(r);if(i)return i}}},e.prototype.readNetworkLinks=function(t){var e=[];if("string"==typeof t){var r=Bs(t);Bt(e,this.readNetworkLinksFromDocument(r))}else Fs(t)?Bt(e,this.readNetworkLinksFromDocument(t)):Bt(e,this.readNetworkLinksFromNode(t));return e},e.prototype.readNetworkLinksFromDocument=function(t){for(var e=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Bt(e,this.readNetworkLinksFromNode(r));return e},e.prototype.readNetworkLinksFromNode=function(t){for(var e=[],r=t.firstElementChild;r;r=r.nextElementSibling)if(Nt(Nc,r.namespaceURI)&&"NetworkLink"==r.localName){var n=Zs({},Bc,r,[]);e.push(n)}for(var i=t.firstElementChild;i;i=i.nextElementSibling){var o=i.localName;!Nt(Nc,i.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||Bt(e,this.readNetworkLinksFromNode(i))}return e},e.prototype.readRegion=function(t){var e=[];if("string"==typeof t){var r=Bs(t);Bt(e,this.readRegionFromDocument(r))}else Fs(t)?Bt(e,this.readRegionFromDocument(t)):Bt(e,this.readRegionFromNode(t));return e},e.prototype.readRegionFromDocument=function(t){for(var e=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Bt(e,this.readRegionFromNode(r));return e},e.prototype.readRegionFromNode=function(t){for(var e=[],r=t.firstElementChild;r;r=r.nextElementSibling)if(Nt(Nc,r.namespaceURI)&&"Region"==r.localName){var n=Zs({},Uc,r,[]);e.push(n)}for(var i=t.firstElementChild;i;i=i.nextElementSibling){var o=i.localName;!Nt(Nc,i.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||Bt(e,this.readRegionFromNode(i))}return e},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=Ns(Nc[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",kc[0]),r.setAttributeNS(n,"xmlns:xsi",ks),r.setAttributeNS(ks,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var i={node:r},o={};t.length>1?o.Document=t:1==t.length&&(o.Placemark=t[0]);var a=jc[r.namespaceURI],s=Ks(o,a);return Qs(i,qc,zs,s,[e],a,this),r},e}(tl);function Xc(t,e){var r=null,n=[0,0],i="start";if(t.getImage()){var o=t.getImage().getImageSize();if(null===o&&(o=xc),2==o.length){var a=t.getImage().getScale();n[0]=a*o[0]/2,n[1]=-a*o[1]/2,i="left"}}if(null!==t.getText()){var s=t.getText();(r=s.clone()).setFont(s.getFont()||Yc.getFont()),r.setScale(s.getScale()||Yc.getScale()),r.setFill(s.getFill()||Yc.getFill()),r.setStroke(s.getStroke()||Oc)}else r=Yc.clone();return r.setText(e),r.setOffsetX(n[0]),r.setOffsetY(n[1]),r.setTextAlign(i),new Sc({text:r})}function Zc(t){var e=Ds(t,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(r){var n=r[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function Jc(t){for(var e,r=Ds(t,!1),n=[],i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;e=i.exec(r);){var o=parseFloat(e[1]),a=parseFloat(e[2]),s=e[3]?parseFloat(e[3]):0;n.push(o,a,s),r=r.substr(e[0].length)}if(""===r)return n}function Qc(t){var e=Ds(t,!1).trim(),r=t.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(e,r).href:e}function tu(t){return ll(t)}var eu=$s(Nc,{Pair:function(t,e){var r=Zs({},Iu,t,e);if(r){var n=r.key;if(n&&"normal"==n){var i=r.styleUrl;i&&(e[e.length-1]=i);var o=r.Style;o&&(e[e.length-1]=o)}}}});function ru(t,e){return Zs(void 0,eu,t,e)}var nu=$s(Nc,{Icon:Ws(function(t,e){return Zs({},du,t,e)||null}),heading:Ws(ll),hotSpot:Ws(function(t){var e,r=t.getAttribute("xunits"),n=t.getAttribute("yunits");return e="insetPixels"!==r?"insetPixels"!==n?cc.BOTTOM_LEFT:cc.TOP_LEFT:"insetPixels"!==n?cc.BOTTOM_RIGHT:cc.TOP_RIGHT,{x:parseFloat(t.getAttribute("x")),xunits:Dc[r],y:parseFloat(t.getAttribute("y")),yunits:Dc[n],origin:e}}),scale:Ws(tu)}),iu=$s(Nc,{color:Ws(Zc),scale:Ws(tu)}),ou=$s(Nc,{color:Ws(Zc),width:Ws(ll)}),au=$s(Nc,{color:Ws(Zc),fill:Ws(ol),outline:Ws(ol)}),su=$s(Nc,{coordinates:js(Jc)});function lu(t,e){return Zs(null,su,t,e)}var cu=$s(kc,{Track:Us(hu)}),uu=$s(Nc,{when:function(t,e){var r=e[e.length-1].whens,n=Ds(t,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},$s(kc,{coord:function(t,e){var r=e[e.length-1].flatCoordinates,n=Ds(t,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){var o=parseFloat(i[1]),a=parseFloat(i[2]),s=parseFloat(i[3]);r.push(o,a,s,0)}else r.push(0,0,0,0)}}));function hu(t,e){var r=Zs({flatCoordinates:[],whens:[]},uu,t,e);if(r){for(var n=r.flatCoordinates,i=r.whens,o=0,a=Math.min(n.length,i.length);o<a;++o)n[4*o+3]=i[o];return new ys(n,dr.XYZM)}}var du=$s(Nc,{href:Ws(Qc)},$s(kc,{x:Ws(ll),y:Ws(ll),w:Ws(ll),h:Ws(ll)})),pu=$s(Nc,{coordinates:js(Jc)});function fu(t,e){return Zs(null,pu,t,e)}var gu=$s(Nc,{extrude:Ws(ol),tessellate:Ws(ol),altitudeMode:Ws(dl)});function yu(t,e){var r=Zs({},gu,t,e),n=fu(t,e);if(n){var i=new ys(n,dr.XYZ);return i.setProperties(r),i}}function mu(t,e){var r=Zs({},gu,t,e),n=fu(t,e);if(n){var i=new Wn(n,dr.XYZ,[n.length]);return i.setProperties(r),i}}var Cu=$s(Nc,{LineString:Us(yu),LinearRing:Us(mu),MultiGeometry:Us(vu),Point:Us(Tu),Polygon:Us(Su)});function vu(t,e){var r,n=Zs([],Cu,t,e);if(!n)return null;if(0===n.length)return new Ss(n);for(var i,o,a=!0,s=n[0].getType(),l=1,c=n.length;l<c;++l)if(n[l].getType()!=s){a=!1;break}if(a)if(s==hr.POINT){var u=n[0];i=u.getLayout(),o=u.getFlatCoordinates();for(var h=1,d=n.length;h<d;++h)Bt(o,n[h].getFlatCoordinates());bu(r=new ps(o,i),n)}else s==hr.LINE_STRING?bu(r=new ms(n),n):s==hr.POLYGON?bu(r=new Cs(n),n):s==hr.GEOMETRY_COLLECTION?r=new Ss(n):te(!1,37);else r=new Ss(n);return r}function Tu(t,e){var r=Zs({},gu,t,e),n=fu(t,e);if(n){var i=new Pn(n,dr.XYZ);return i.setProperties(r),i}}var _u=$s(Nc,{innerBoundaryIs:function(t,e){var r=Zs(void 0,ku,t,e);if(r){e[e.length-1].push(r)}},outerBoundaryIs:function(t,e){var r=Zs(void 0,Nu,t,e);if(r){e[e.length-1][0]=r}}});function Su(t,e){var r=Zs({},gu,t,e),n=Zs([null],_u,t,e);if(n&&n[0]){for(var i=n[0],o=[i.length],a=1,s=n.length;a<s;++a)Bt(i,n[a]),o.push(i.length);var l=new Wn(i,dr.XYZ,o);return l.setProperties(r),l}}var Eu=$s(Nc,{IconStyle:function(t,e){var r=Zs({},nu,t,e);if(r){var n,i,o,a,s=e[e.length-1],l="Icon"in r?r.Icon:{},c=!("Icon"in r)||Object.keys(l).length>0,u=l.href;u?n=u:c&&(n=Pc);var h,d=cc.BOTTOM_LEFT,p=r.hotSpot;p?(i=[p.x,p.y],o=p.xunits,a=p.yunits,d=p.origin):n===Pc?(i=bc,o=Lc,a=Ac):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(n)&&(i=[.5,0],o=sc.FRACTION,a=sc.FRACTION);var f,g=l.x,y=l.y;void 0!==g&&void 0!==y&&(h=[g,y]);var m,C=l.w,v=l.h;void 0!==C&&void 0!==v&&(f=[C,v]);var T=r.heading;void 0!==T&&(m=ce(T));var _=r.scale;if(c){n==Pc&&(f=xc,void 0===_&&(_=Ic));var S=new dc({anchor:i,anchorOrigin:d,anchorXUnits:o,anchorYUnits:a,crossOrigin:"anonymous",offset:h,offsetOrigin:cc.BOTTOM_LEFT,rotation:m,scale:_,size:f,src:n});s.imageStyle=S}else s.imageStyle=Rc}},LabelStyle:function(t,e){var r=Zs({},iu,t,e);if(r){var n=e[e.length-1],i=new Mc({fill:new ac({color:"color"in r?r.color:wc}),scale:r.scale});n.textStyle=i}},LineStyle:function(t,e){var r=Zs({},ou,t,e);if(r){var n=e[e.length-1],i=new fc({color:"color"in r?r.color:wc,width:"width"in r?r.width:1});n.strokeStyle=i}},PolyStyle:function(t,e){var r=Zs({},au,t,e);if(r){var n=e[e.length-1],i=new ac({color:"color"in r?r.color:wc});n.fillStyle=i;var o=r.fill;void 0!==o&&(n.fill=o);var a=r.outline;void 0!==a&&(n.outline=a)}}});function wu(t,e){var r=Zs({},Eu,t,e);if(!r)return null;var n,i="fillStyle"in r?r.fillStyle:Wc,o=r.fill;void 0===o||o||(i=null),"imageStyle"in r?r.imageStyle!=Rc&&(n=r.imageStyle):n=Hc;var a="textStyle"in r?r.textStyle:Yc,s="strokeStyle"in r?r.strokeStyle:Vc,l=r.outline;return void 0===l||l||(s=null),[new Sc({fill:i,image:n,stroke:s,text:a,zIndex:void 0})]}function bu(t,e){var r,n,i,o=e.length,a=new Array(e.length),s=new Array(e.length),l=new Array(e.length);r=n=i=!1;for(var c=0;c<o;++c){var u=e[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),r=r||void 0!==a[c],n=n||void 0!==s[c],i=i||l[c]}r&&t.set("extrude",a),n&&t.set("tessellate",s),i&&t.set("altitudeMode",l)}var Lu=$s(Nc,{displayName:Ws(dl),value:Ws(dl)}),Au=$s(Nc,{Data:function(t,e){var r=t.getAttribute("name");Xs(Lu,t,e);var n=e[e.length-1];null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(t,e){Xs(Ru,t,e)}});function xu(t,e){Xs(Au,t,e)}function Pu(t,e){Xs(Uc,t,e)}var Iu=$s(Nc,{Style:Ws(wu),key:Ws(dl),styleUrl:Ws(Qc)}),Ru=$s(Nc,{SimpleData:function(t,e){var r=t.getAttribute("name");if(null!==r){var n=dl(t);e[e.length-1][r]=n}}}),Ou=$s(Nc,{altitudeMode:Ws(dl),minAltitude:Ws(ll),maxAltitude:Ws(ll),north:Ws(ll),south:Ws(ll),east:Ws(ll),west:Ws(ll)}),Mu=$s(Nc,{minLodPixels:Ws(ll),maxLodPixels:Ws(ll),minFadeExtent:Ws(ll),maxFadeExtent:Ws(ll)}),ku=$s(Nc,{LinearRing:js(lu)}),Nu=$s(Nc,{LinearRing:js(lu)});function Du(t,e){for(var r=jo(e),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],i=0;i<4;++i){var o=Math.floor(n[i]).toString(16);n[i]=1==o.length?"0"+o:o}ml(t,n.join(""))}var Fu=$s(Nc,{Data:Hs(function(t,e,r){t.setAttribute("name",e.name);var n={node:t},i=e.value;"object"==typeof i?(null!==i&&i.displayName&&Qs(n,Fu,zs,[i.displayName],r,["displayName"]),null!==i&&i.value&&Qs(n,Fu,zs,[i.value],r,["value"])):Qs(n,Fu,zs,[i],r,["value"])}),value:Hs(function(t,e){ml(t,e)}),displayName:Hs(function(t,e){fl(t,e)})}),Bu=$s(Nc,{Placemark:Hs(ch)}),Gu=function(t,e,r){return Ns(e[e.length-1].node.namespaceURI,"Placemark")},Uu=Ys("Data"),ju=$s(Nc,["href"],$s(kc,["x","y","w","h"])),qu=$s(Nc,{href:Hs(ml)},$s(kc,{x:Hs(gl),y:Hs(gl),w:Hs(gl),h:Hs(gl)})),Wu=function(t,e,r){return Ns(kc[0],"gx:"+r)},Hu=$s(Nc,["scale","heading","Icon","hotSpot"]),Vu=$s(Nc,{Icon:Hs(function(t,e,r){var n={node:t},i=r[r.length-1].node,o=ju[i.namespaceURI],a=Ks(e,o);Qs(n,qu,zs,a,r,o),a=Ks(e,o=ju[kc[0]]),Qs(n,qu,Wu,a,r,o)}),heading:Hs(gl),hotSpot:Hs(function(t,e){t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.setAttribute("xunits",e.xunits),t.setAttribute("yunits",e.yunits)}),scale:Hs(vh)}),Yu=$s(Nc,["color","scale"]),zu=$s(Nc,{color:Hs(Du),scale:Hs(vh)}),Ku=$s(Nc,["color","width"]),$u=$s(Nc,{color:Hs(Du),width:Hs(gl)}),Xu={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Zu=function(t,e,r){if(t)return Ns(e[e.length-1].node.namespaceURI,Xu[t.getType()])},Ju=Ys("Point"),Qu=Ys("LineString"),th=Ys("LinearRing"),eh=Ys("Polygon"),rh=$s(Nc,{LineString:Hs(dh),Point:Hs(dh),Polygon:Hs(yh),GeometryCollection:Hs(nh)});function nh(t,e,r){var n,i,o={node:t},a=e.getType();a==hr.GEOMETRY_COLLECTION?(n=e.getGeometries(),i=Zu):a==hr.MULTI_POINT?(n=e.getPoints(),i=Ju):a==hr.MULTI_LINE_STRING?(n=e.getLineStrings(),i=Qu):a==hr.MULTI_POLYGON?(n=e.getPolygons(),i=eh):te(!1,39),Qs(o,rh,i,n,r)}var ih=$s(Nc,{LinearRing:Hs(dh)});function oh(t,e,r){Qs({node:t},ih,th,[e],r)}var ah=$s(Nc,{ExtendedData:Hs(function(t,e,r){for(var n={node:t},i=e.names,o=e.values,a=i.length,s=0;s<a;s++)Qs(n,Fu,Uu,[{name:i[s],value:o[s]}],r)}),MultiGeometry:Hs(nh),LineString:Hs(dh),LinearRing:Hs(dh),Point:Hs(dh),Polygon:Hs(yh),Style:Hs(function(t,e,r){var n={node:t},i={},o=e.getFill(),a=e.getStroke(),s=e.getImage(),l=e.getText();s&&"function"==typeof s.getSrc&&(i.IconStyle=s);l&&(i.LabelStyle=l);a&&(i.LineStyle=a);o&&(i.PolyStyle=o);var c=r[r.length-1].node,u=Th[c.namespaceURI],h=Ks(i,u);Qs(n,_h,zs,h,r,u)}),address:Hs(ml),description:Hs(ml),name:Hs(ml),open:Hs(pl),phoneNumber:Hs(ml),styleUrl:Hs(ml),visibility:Hs(pl)}),sh=$s(Nc,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),lh=Ys("ExtendedData");function ch(t,e,r){var n={node:t};e.getId()&&t.setAttribute("id",e.getId());var i=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;var a=Object.keys(i||{}).sort().filter(function(t){return!o[t]});if(a.length>0){var s=Ks(i,a);Qs(n,ah,lh,[{names:a,values:s}],r)}var l=e.getStyleFunction();if(l){var c=l(e,0);if(c){var u=Array.isArray(c)?c[0]:c;this.writeStyles_&&(i.Style=u);var h=u.getText();h&&(i.name=h.getText())}}var d=r[r.length-1].node,p=sh[d.namespaceURI],f=Ks(i,p);Qs(n,ah,zs,f,r,p);var g=r[0],y=e.getGeometry();y&&(y=As(y,!0,g)),Qs(n,ah,Zu,[y],r)}var uh=$s(Nc,["extrude","tessellate","altitudeMode","coordinates"]),hh=$s(Nc,{extrude:Hs(pl),tessellate:Hs(pl),altitudeMode:Hs(ml),coordinates:Hs(function(t,e,r){var n,i=r[r.length-1],o=i.layout,a=i.stride;o==dr.XY||o==dr.XYM?n=2:o==dr.XYZ||o==dr.XYZM?n=3:te(!1,34);var s=e.length,l="";if(s>0){l+=e[0];for(var c=1;c<n;++c)l+=","+e[c];for(var u=a;u<s;u+=a){l+=" "+e[u];for(var h=1;h<n;++h)l+=","+e[u+h]}}ml(t,l)})});function dh(t,e,r){var n=e.getFlatCoordinates(),i={node:t};i.layout=e.getLayout(),i.stride=e.getStride();var o=e.getProperties();o.coordinates=n;var a=r[r.length-1].node,s=uh[a.namespaceURI],l=Ks(o,s);Qs(i,hh,zs,l,r,s)}var ph=$s(Nc,{outerBoundaryIs:Hs(oh),innerBoundaryIs:Hs(oh)}),fh=Ys("innerBoundaryIs"),gh=Ys("outerBoundaryIs");function yh(t,e,r){var n=e.getLinearRings(),i=n.shift(),o={node:t};Qs(o,ph,fh,n,r),Qs(o,ph,gh,[i],r)}var mh=$s(Nc,{color:Hs(Du)}),Ch=Ys("color");function vh(t,e){gl(t,Math.round(1e6*e)/1e6)}var Th=$s(Nc,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),_h=$s(Nc,{IconStyle:Hs(function(t,e,r){var n={node:t},i={},o=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:o};if(a){l.w=a[0],l.h=a[1];var c=e.getAnchor(),u=e.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var h={x:c[0],xunits:sc.PIXELS,y:a[1]-c[1],yunits:sc.PIXELS};i.hotSpot=h}}i.Icon=l;var d=e.getScale();1!==d&&(i.scale=d);var p=e.getRotation();0!==p&&(i.heading=p);var f=r[r.length-1].node,g=Hu[f.namespaceURI],y=Ks(i,g);Qs(n,Vu,zs,y,r,g)}),LabelStyle:Hs(function(t,e,r){var n={node:t},i={},o=e.getFill();o&&(i.color=o.getColor());var a=e.getScale();a&&1!==a&&(i.scale=a);var s=r[r.length-1].node,l=Yu[s.namespaceURI],c=Ks(i,l);Qs(n,zu,zs,c,r,l)}),LineStyle:Hs(function(t,e,r){var n={node:t},i={color:e.getColor(),width:e.getWidth()},o=r[r.length-1].node,a=Ku[o.namespaceURI],s=Ks(i,a);Qs(n,$u,zs,s,r,a)}),PolyStyle:Hs(function(t,e,r){Qs({node:t},mh,Ch,[e.getColor()],r)})}),Sh=$c,Eh=el+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",wh={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},bh=function(t){function e(e){var r=e||{};t.call(this,r),this.FEATURE_COLLECTION_PARSERS[el].featureMember=Us(this.readFeaturesInternal),this.schemaLocation=r.schemaLocation?r.schemaLocation:Eh}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFlatCoordinates_=function(t,e){var r=Ds(t,!1).replace(/^\s*|\s*$/g,""),n=e[0].srsName,i="enu";if(n){var o=jr(n);o&&(i=o.getAxisOrientation())}for(var a=r.trim().split(/\s+/),s=[],l=0,c=a.length;l<c;l++){var u=a[l].split(/,+/),h=parseFloat(u[0]),d=parseFloat(u[1]),p=3===u.length?parseFloat(u[2]):0;"en"===i.substr(0,2)?s.push(h,d,p):s.push(d,h,p)}return s},e.prototype.readBox_=function(t,e){var r=Zs([null],this.BOX_PARSERS_,t,e,this);return je(r[1][0],r[1][1],r[1][3],r[1][4])},e.prototype.innerBoundaryIsParser_=function(t,e){var r=Zs(void 0,this.RING_PARSERS,t,e,this);r&&e[e.length-1].push(r)},e.prototype.outerBoundaryIsParser_=function(t,e){var r=Zs(void 0,this.RING_PARSERS,t,e,this);r&&(e[e.length-1][0]=r)},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,r){var n,i=e[e.length-1],o=i.multiSurface,a=i.surface,s=i.multiCurve;return Array.isArray(t)?n="Envelope":"MultiPolygon"===(n=t.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"MultiLineString"===n&&!0===s&&(n="MultiCurve"),Ns("http://www.opengis.net/gml",n)},e.prototype.writeFeatureElement=function(t,e,r){var n=e.getId();n&&t.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=e.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=e.getProperties(),l=[],c=[];for(var h in s){var d=s[h];null!==d&&(l.push(h),c.push(d),h==a||"function"==typeof d.getSimplifiedGeometry?h in i.serializers[o]||(i.serializers[o][h]=Hs(this.writeGeometryElement,this)):h in i.serializers[o]||(i.serializers[o][h]=Hs(ml)))}var p=u({},i);p.node=t,Qs(p,i.serializers,Ys(void 0,o),c,r,l)},e.prototype.writeCurveOrLineString_=function(t,e,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==t.nodeName&&n&&t.setAttribute("srsName",n),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var i=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(i),this.writeCoordinates_(i,e,r)}else if("Curve"===t.nodeName){var o=Ns(t.namespaceURI,"segments");t.appendChild(o),this.writeCurveSegments_(o,e,r)}},e.prototype.writeLineStringOrCurveMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeCurveOrLineString_(n,e,r))},e.prototype.writeMultiCurveOrLineString_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&t.setAttribute("srsName",o);var s=e.getLineStrings();Qs({node:t,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeGeometryElement=function(t,e,r){var n,i=r[r.length-1],o=u({},i);o.node=t,n=Array.isArray(e)?i.dataProjection?Xr(e,i.featureProjection,i.dataProjection):e:As(e,!0,i),Qs(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},e.prototype.createCoordinatesNode_=function(t){var e=Ns(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e},e.prototype.writeCoordinates_=function(t,e,r){for(var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=e.getCoordinates(),s=a.length,l=new Array(s),c=0;c<s;++c){var u=a[c];l[c]=this.getCoords_(u,o,i)}ml(t,l.join(" "))},e.prototype.writeCurveSegments_=function(t,e,r){var n=Ns(t.namespaceURI,"LineStringSegment");t.appendChild(n),this.writeCurveOrLineString_(n,e,r)},e.prototype.writeSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Qs({node:t,hasZ:i,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===t.nodeName){var s=Ns(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,r)}},e.prototype.RING_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),Ns(i.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")},e.prototype.writeSurfacePatches_=function(t,e,r){var n=Ns(t.namespaceURI,"PolygonPatch");t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r)},e.prototype.writeRing_=function(t,e,r){var n=Ns(t.namespaceURI,"LinearRing");t.appendChild(n),this.writeLinearRing_(n,e,r)},e.prototype.getCoords_=function(t,e,r){var n="enu";e&&(n=jr(e).getAxisOrientation());var i="en"===n.substr(0,2)?t[0]+","+t[1]:t[1]+","+t[0];r&&(i+=","+(t[2]||0));return i},e.prototype.writePoint_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&t.setAttribute("srsName",o);var a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);var s=e.getCoordinates();ml(a,this.getCoords_(s,o,i))},e.prototype.writeMultiPoint_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&t.setAttribute("srsName",o);var a=e.getPoints();Qs({node:t,hasZ:i,srsName:o},this.POINTMEMBER_SERIALIZERS_,Ys("pointMember"),a,r,void 0,this)},e.prototype.writePointMember_=function(t,e,r){var n=Ns(t.namespaceURI,"Point");t.appendChild(n),this.writePoint_(n,e,r)},e.prototype.writeLinearRing_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(i),this.writeCoordinates_(i,e,r)},e.prototype.writeMultiSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&t.setAttribute("srsName",o);var s=e.getPolygons();Qs({node:t,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeSurfaceOrPolygonMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r))},e.prototype.writeEnvelope=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=[e[0]+" "+e[1],e[2]+" "+e[3]];Qs({node:t},this.ENVELOPE_SERIALIZERS_,zs,i,r,["lowerCorner","upperCorner"],this)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1].node;return Ns("http://www.opengis.net/gml",wh[n.nodeName])},e}(il);bh.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:js(bh.prototype.readFlatCoordinates_)}},bh.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:bh.prototype.innerBoundaryIsParser_,outerBoundaryIs:bh.prototype.outerBoundaryIsParser_}},bh.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Us(bh.prototype.readFlatCoordinates_)}},bh.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:js(il.prototype.readPoint),MultiPoint:js(il.prototype.readMultiPoint),LineString:js(il.prototype.readLineString),MultiLineString:js(il.prototype.readMultiLineString),LinearRing:js(il.prototype.readLinearRing),Polygon:js(il.prototype.readPolygon),MultiPolygon:js(il.prototype.readMultiPolygon),Box:js(bh.prototype.readBox_)}},bh.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Hs(bh.prototype.writeCurveOrLineString_),MultiCurve:Hs(bh.prototype.writeMultiCurveOrLineString_),Point:Hs(bh.prototype.writePoint_),MultiPoint:Hs(bh.prototype.writeMultiPoint_),LineString:Hs(bh.prototype.writeCurveOrLineString_),MultiLineString:Hs(bh.prototype.writeMultiCurveOrLineString_),LinearRing:Hs(bh.prototype.writeLinearRing_),Polygon:Hs(bh.prototype.writeSurfaceOrPolygon_),MultiPolygon:Hs(bh.prototype.writeMultiSurfaceOrPolygon_),Surface:Hs(bh.prototype.writeSurfaceOrPolygon_),MultiSurface:Hs(bh.prototype.writeMultiSurfaceOrPolygon_),Envelope:Hs(bh.prototype.writeEnvelope)}},bh.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Hs(bh.prototype.writeLineStringOrCurveMember_),curveMember:Hs(bh.prototype.writeLineStringOrCurveMember_)}},bh.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:Hs(bh.prototype.writeRing_),innerBoundaryIs:Hs(bh.prototype.writeRing_)}},bh.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Hs(bh.prototype.writePointMember_)}},bh.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Hs(bh.prototype.writeSurfaceOrPolygonMember_),polygonMember:Hs(bh.prototype.writeSurfaceOrPolygonMember_)}},bh.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Hs(ml),upperCorner:Hs(ml)}};var Lh=bh,Ah=function(t){this.tagName_=t};Ah.prototype.getTagName=function(){return this.tagName_};var xh=Ah,Ph=function(t){function e(e){t.call(this,"And",Array.prototype.slice.call(arguments))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e,r){t.call(this,e),this.conditions=r,te(this.conditions.length>=2,57)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xh)),Ih=function(t){function e(e,r,n){t.call(this,"BBOX"),this.geometryName=e,this.extent=r,this.srsName=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xh),Rh={"http://www.opengis.net/gml":{boundedBy:Ws(il.prototype.readGeometryElement,"bounds")}},Oh={"http://www.opengis.net/wfs":{totalInserted:Ws(ul),totalUpdated:Ws(ul),totalDeleted:Ws(ul)}},Mh={"http://www.opengis.net/wfs":{TransactionSummary:Ws(function(t,e){return Zs({},Oh,t,e)},"transactionSummary"),InsertResults:Ws(function(t,e){return Zs([],Hh,t,e)},"insertIds")}},kh={"http://www.opengis.net/wfs":{PropertyName:Hs(ml)}},Nh={"http://www.opengis.net/wfs":{Insert:Hs(function(t,e,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a=n.gmlVersion,s=Ns(o,i);t.appendChild(s),2===a?Lh.prototype.writeFeatureElement(s,e,r):_l.prototype.writeFeatureElement(s,e,r)}),Update:Hs(function(t,e,r){var n=r[r.length-1];te(void 0!==e.getId(),27);var i=n.featureType,o=n.featurePrefix,a=n.featureNS,s=Yh(o,i),l=e.getGeometryName();t.setAttribute("typeName",s),t.setAttributeNS(Fh,"xmlns:"+o,a);var c=e.getId();if(void 0!==c){for(var u=e.getKeys(),h=[],d=0,p=u.length;d<p;d++){var f=e.get(u[d]);if(void 0!==f){var g=u[d];f&&"function"==typeof f.getSimplifiedGeometry&&(g=l),h.push({name:g,value:f})}}Qs({gmlVersion:n.gmlVersion,node:t,hasZ:n.hasZ,srsName:n.srsName},Nh,Ys("Property"),h,r),Vh(t,c,r)}}),Delete:Hs(function(t,e,r){var n=r[r.length-1];te(void 0!==e.getId(),26);var i=n.featureType,o=n.featurePrefix,a=n.featureNS,s=Yh(o,i);t.setAttribute("typeName",s),t.setAttributeNS(Fh,"xmlns:"+o,a);var l=e.getId();void 0!==l&&Vh(t,l,r)}),Property:Hs(function(t,e,r){var n=Ns(Gh,"Name"),i=r[r.length-1].gmlVersion;if(t.appendChild(n),ml(n,e.name),void 0!==e.value&&null!==e.value){var o=Ns(Gh,"Value");t.appendChild(o),e.value&&"function"==typeof e.value.getSimplifiedGeometry?2===i?Lh.prototype.writeGeometryElement(o,e.value,r):_l.prototype.writeGeometryElement(o,e.value,r):ml(o,e.value)}}),Native:Hs(function(t,e,r){e.vendorId&&t.setAttribute("vendorId",e.vendorId);void 0!==e.safeToIgnore&&t.setAttribute("safeToIgnore",String(e.safeToIgnore));void 0!==e.value&&ml(t,e.value)})}},Dh="feature",Fh="http://www.w3.org/2000/xmlns/",Bh="http://www.opengis.net/ogc",Gh="http://www.opengis.net/wfs",Uh={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},jh="1.1.0",qh=function(t){function e(e){t.call(this);var r=e||{};this.featureType_=r.featureType,this.featureNS_=r.featureNS,this.gmlFormat_=r.gmlFormat?r.gmlFormat:new _l,this.schemaLocation_=r.schemaLocation?r.schemaLocation:Uh[jh]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getFeatureType=function(){return this.featureType_},e.prototype.setFeatureType=function(t){this.featureType_=t},e.prototype.readFeaturesFromNode=function(t,e){var r={node:t};u(r,{featureType:this.featureType_,featureNS:this.featureNS_}),u(r,this.getReadOptions(t,e||{}));var n=[r];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[el].featureMember=Us(il.prototype.readFeaturesInternal);var i=Zs([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,n,this.gmlFormat_);return i||(i=[]),i},e.prototype.readTransactionResponse=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readTransactionResponseFromDocument(e)}return Fs(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}},e.prototype.readFeatureCollectionMetadata=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Fs(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}},e.prototype.readFeatureCollectionMetadataFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)},e.prototype.readFeatureCollectionMetadataFromNode=function(t){var e={},r=hl(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=r,Zs(e,Rh,t,[],this.gmlFormat_)},e.prototype.readTransactionResponseFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)},e.prototype.readTransactionResponseFromNode=function(t){return Zs({},Mh,t,[])},e.prototype.writeGetFeature=function(t){var e,r,n,i,o=Ns(Gh,"GetFeature");if(o.setAttribute("service","WFS"),o.setAttribute("version","1.1.0"),t&&(t.handle&&o.setAttribute("handle",t.handle),t.outputFormat&&o.setAttribute("outputFormat",t.outputFormat),void 0!==t.maxFeatures&&o.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&o.setAttribute("resultType",t.resultType),void 0!==t.startIndex&&o.setAttribute("startIndex",String(t.startIndex)),void 0!==t.count&&o.setAttribute("count",String(t.count)),void 0!==t.viewParams&&o.setAttribute("viewParams ",t.viewParams),e=t.filter,t.bbox)){te(t.geometryName,12);var a=(r=t.geometryName,n=t.bbox,i=t.srsName,new Ih(r,n,i));e=e?function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Ph,e))}(e,a):a}o.setAttributeNS(ks,"xsi:schemaLocation",this.schemaLocation_);var s={node:o};return u(s,{srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,geometryName:t.geometryName,filter:e,propertyNames:t.propertyNames?t.propertyNames:[]}),te(Array.isArray(t.featureTypes),11),function(t,e,r){var n=u({},r[r.length-1]);n.node=t,Qs(n,zh,Ys("Query"),e,r)}(o,t.featureTypes,[s]),o},e.prototype.writeTransaction=function(t,e,r,n){var i,o,a=[],s=Ns(Gh,"Transaction"),l=n.version?n.version:jh,c="1.0.0"===l?2:3;s.setAttribute("service","WFS"),s.setAttribute("version",l),n&&(i=n.gmlOptions?n.gmlOptions:{},n.handle&&s.setAttribute("handle",n.handle));var h=Uh[l];s.setAttributeNS(ks,"xsi:schemaLocation",h);var d=n.featurePrefix?n.featurePrefix:Dh;return t&&(o=u({node:s},{featureNS:n.featureNS,featureType:n.featureType,featurePrefix:d,gmlVersion:c,hasZ:n.hasZ,srsName:n.srsName}),u(o,i),Qs(o,Nh,Ys("Insert"),t,a)),e&&(o=u({node:s},{featureNS:n.featureNS,featureType:n.featureType,featurePrefix:d,gmlVersion:c,hasZ:n.hasZ,srsName:n.srsName}),u(o,i),Qs(o,Nh,Ys("Update"),e,a)),r&&Qs({node:s,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:d,gmlVersion:c,srsName:n.srsName},Nh,Ys("Delete"),r,a),n.nativeElements&&Qs({node:s,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:d,gmlVersion:c,srsName:n.srsName},Nh,Ys("Native"),n.nativeElements,a),s},e.prototype.readProjectionFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null},e.prototype.readProjectionFromNode=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(var e=(t=t.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var r=[{}];return this.gmlFormat_.readGeometryElement(e,r),jr(r.pop().srsName)}return null},e}(tl),Wh={"http://www.opengis.net/ogc":{FeatureId:Us(function(t,e){return t.getAttribute("fid")})}},Hh={"http://www.opengis.net/wfs":{Feature:function(t,e){Xs(Wh,t,e)}}};function Vh(t,e,r){var n=Ns(Bh,"Filter"),i=Ns(Bh,"FeatureId");n.appendChild(i),i.setAttribute("fid",e),t.appendChild(n)}function Yh(t,e){var r=(t=t||Dh)+":";return 0===e.indexOf(r)?e:r+e}var zh={"http://www.opengis.net/wfs":{Query:Hs(function(t,e,r){var n,i=r[r.length-1],o=i.featurePrefix,a=i.featureNS,s=i.propertyNames,l=i.srsName;n=o?Yh(o,e):e;t.setAttribute("typeName",n),l&&t.setAttribute("srsName",l);a&&t.setAttributeNS(Fh,"xmlns:"+o,a);var c=u({},i);c.node=t,Qs(c,kh,Ys("PropertyName"),s,r);var h=i.filter;if(h){var d=Ns(Bh,"Filter");t.appendChild(d),function(t,e,r){Qs({node:t},zh,Ys(e.getTagName()),[e],r)}(d,h,r)}})},"http://www.opengis.net/ogc":{During:Hs(function(t,e,r){var n=Ns("http://www.opengis.net/fes","ValueReference");ml(n,e.propertyName),t.appendChild(n);var i=Ns(el,"TimePeriod");t.appendChild(i);var o=Ns(el,"begin");i.appendChild(o),Qh(o,e.begin);var a=Ns(el,"end");i.appendChild(a),Qh(a,e.end)}),And:Hs(Kh),Or:Hs(Kh),Not:Hs(function(t,e,r){var n={node:t},i=e.condition;Qs(n,zh,Ys(i.getTagName()),[i],r)}),BBOX:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Zh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.extent,r)}),Contains:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Zh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),Intersects:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Zh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),Within:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Zh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),PropertyIsEqualTo:Hs($h),PropertyIsNotEqualTo:Hs($h),PropertyIsLessThan:Hs($h),PropertyIsLessThanOrEqualTo:Hs($h),PropertyIsGreaterThan:Hs($h),PropertyIsGreaterThanOrEqualTo:Hs($h),PropertyIsNull:Hs(function(t,e,r){Zh(t,e.propertyName)}),PropertyIsBetween:Hs(function(t,e,r){Zh(t,e.propertyName);var n=Ns(Bh,"LowerBoundary");t.appendChild(n),Jh(n,""+e.lowerBoundary);var i=Ns(Bh,"UpperBoundary");t.appendChild(i),Jh(i,""+e.upperBoundary)}),PropertyIsLike:Hs(function(t,e,r){t.setAttribute("wildCard",e.wildCard),t.setAttribute("singleChar",e.singleChar),t.setAttribute("escapeChar",e.escapeChar),void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());Zh(t,e.propertyName),Jh(t,""+e.pattern)})}};function Kh(t,e,r){for(var n={node:t},i=e.conditions,o=0,a=i.length;o<a;++o){var s=i[o];Qs(n,zh,Ys(s.getTagName()),[s],r)}}function $h(t,e,r){void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString()),Zh(t,e.propertyName),Jh(t,""+e.expression)}function Xh(t,e,r){var n=Ns(Bh,t);ml(n,r),e.appendChild(n)}function Zh(t,e){Xh("PropertyName",t,e)}function Jh(t,e){Xh("Literal",t,e)}function Qh(t,e){var r=Ns(el,"TimeInstant");t.appendChild(r);var n=Ns(el,"timePosition");r.appendChild(n),ml(n,e)}var td=qh;function ed(t){return"string"==typeof t?t:""}var rd=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.TEXT},e.prototype.readFeature=function(t,e){return this.readFeatureFromText(ed(t),this.adaptOptions(e))},e.prototype.readFeatureFromText=function(t,e){return n()},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(ed(t),this.adaptOptions(e))},e.prototype.readFeaturesFromText=function(t,e){return n()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(ed(t),this.adaptOptions(e))},e.prototype.readGeometryFromText=function(t,e){return n()},e.prototype.readProjection=function(t){return this.readProjectionFromText(ed(t))},e.prototype.readProjectionFromText=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))},e.prototype.writeFeatureText=function(t,e){return n()},e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))},e.prototype.writeFeaturesText=function(t,e){return n()},e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))},e.prototype.writeGeometryText=function(t,e){return n()},e}(Ls),nd={POINT:Pn,LINESTRING:ys,POLYGON:Wn,MULTIPOINT:ps,MULTILINESTRING:ms,MULTIPOLYGON:Cs},id="EMPTY",od="Z",ad="M",sd={};for(var ld in hr)sd[ld]=hr[ld].toUpperCase();var cd=function(t){this.wkt=t,this.index_=-1};cd.prototype.isAlpha_=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},cd.prototype.isNumeric_=function(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)},cd.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t},cd.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},cd.prototype.nextToken=function(){var t,e=this.nextChar_(),r=this.index_,n=e;if("("==e)t=2;else if(","==e)t=5;else if(")"==e)t=3;else if(this.isNumeric_(e)||"-"==e)t=4,n=this.readNumber_();else if(this.isAlpha_(e))t=1,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=6}return{position:r,value:n,type:t}},cd.prototype.readNumber_=function(){var t,e=this.index_,r=!1,n=!1;do{"."==t?r=!0:"e"!=t&&"E"!=t||(n=!0),t=this.nextChar_()}while(this.isNumeric_(t,r)||!n&&("e"==t||"E"==t)||n&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))},cd.prototype.readText_=function(){var t,e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()};var ud=function(t){this.lexer_=t,this.token_,this.layout_=dr.XY};function hd(t){var e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function dd(t){for(var e=t.getCoordinates(),r=[],n=0,i=e.length;n<i;++n)r.push(e[n].join(" "));return r.join(",")}function pd(t){for(var e=[],r=t.getLinearRings(),n=0,i=r.length;n<i;++n)e.push("("+dd(r[n])+")");return e.join(",")}ud.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},ud.prototype.isTokenType=function(t){return this.token_.type==t},ud.prototype.match=function(t){var e=this.isTokenType(t);return e&&this.consume_(),e},ud.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},ud.prototype.parseGeometryLayout_=function(){var t=dr.XY,e=this.token_;if(this.isTokenType(1)){var r=e.value;r===od?t=dr.XYZ:r===ad?t=dr.XYM:"ZM"===r&&(t=dr.XYZM),t!==dr.XY&&this.consume_()}return t},ud.prototype.parseGeometryCollectionText_=function(){if(this.match(2)){var t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parsePointText_=function(){if(this.match(2)){var t=this.parsePoint_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())},ud.prototype.parseLineStringText_=function(){if(this.match(2)){var t=this.parsePointList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parsePolygonText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parseMultiPointText_=function(){var t;if(this.match(2)){if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parseMultiLineStringText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parseMultiPolygonText_=function(){if(this.match(2)){var t=this.parsePolygonTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},ud.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,r=0;r<e;++r){var n=this.token_;if(!this.match(4))break;t.push(n.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())},ud.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(5);)t.push(this.parsePoint_());return t},ud.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(5);)t.push(this.parsePointText_());return t},ud.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(5);)t.push(this.parseLineStringText_());return t},ud.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(5);)t.push(this.parsePolygonText_());return t},ud.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(1)&&this.token_.value==id;return t&&this.consume_(),t},ud.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},ud.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(1)){var e=t.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==e){var r=this.parseGeometryCollectionText_();return new Ss(r)}var n,i=nd[e];if(!i)throw new Error("Invalid geometry type: "+e);switch(e){case"POINT":n=this.parsePointText_();break;case"LINESTRING":n=this.parseLineStringText_();break;case"POLYGON":n=this.parsePolygonText_();break;case"MULTIPOINT":n=this.parseMultiPointText_();break;case"MULTILINESTRING":n=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":n=this.parseMultiPolygonText_();break;default:throw new Error("Invalid geometry type: "+e)}return n||(n=i===nd.POINT?[NaN,NaN]:[]),new i(n,this.layout_)}throw new Error(this.formatErrorMessage_())};var fd={Point:hd,LineString:dd,Polygon:pd,MultiPoint:function(t){for(var e=[],r=t.getPoints(),n=0,i=r.length;n<i;++n)e.push("("+hd(r[n])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],r=t.getLineStrings(),n=0,i=r.length;n<i;++n)e.push("("+dd(r[n])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],r=t.getPolygons(),n=0,i=r.length;n<i;++n)e.push("("+pd(r[n])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],r=t.getGeometries(),n=0,i=r.length;n<i;++n)e.push(gd(r[n]));return e.join(",")}};function gd(t){var e=t.getType(),r=(0,fd[e])(t);if(e=e.toUpperCase(),"function"==typeof t.getFlatCoordinates){var n=function(t){var e=t.getLayout(),r="";return e!==dr.XYZ&&e!==dr.XYZM||(r+=od),e!==dr.XYM&&e!==dr.XYZM||(r+=ad),r}(t);n.length>0&&(e+=" "+n)}return 0===r.length?e+" "+id:e+"("+r+")"}var yd=function(t){function e(e){t.call(this);var r=e||{};this.splitCollection_=void 0!==r.splitCollection&&r.splitCollection}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse_=function(t){var e=new cd(t);return new ud(e).parse()},e.prototype.readFeatureFromText=function(t,e){var r=this.readGeometryFromText(t,e);if(r){var n=new ds;return n.setGeometry(r),n}return null},e.prototype.readFeaturesFromText=function(t,e){for(var r,n=this.readGeometryFromText(t,e),i=[],o=0,a=(r=this.splitCollection_&&n.getType()==hr.GEOMETRY_COLLECTION?n.getGeometriesArray():[n]).length;o<a;++o){var s=new ds;s.setGeometry(r[o]),i.push(s)}return i},e.prototype.readGeometryFromText=function(t,e){var r=this.parse_(t);return r?As(r,!1,e):null},e.prototype.writeFeatureText=function(t,e){var r=t.getGeometry();return r?this.writeGeometryText(r,e):""},e.prototype.writeFeaturesText=function(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(t[n].getGeometry());var o=new Ss(r);return this.writeGeometryText(o,e)},e.prototype.writeGeometryText=function(t,e){return gd(As(t,!0,e))},e}(rd),md="http://www.w3.org/1999/xlink";function Cd(t){return t.getAttributeNS(md,"href")}var vd=function(){};vd.prototype.read=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readFromDocument(e)}return Fs(t)?this.readFromDocument(t):this.readFromNode(t)}return null},vd.prototype.readFromDocument=function(t){},vd.prototype.readFromNode=function(t){};var Td=vd,_d=[null,"http://www.opengis.net/wms"],Sd=$s(_d,{Service:Ws(function(t,e){return Zs({},bd,t,e)}),Capability:Ws(function(t,e){return Zs({},Ed,t,e)})}),Ed=$s(_d,{Request:Ws(function(t,e){return Zs({},Md,t,e)}),Exception:Ws(function(t,e){return Zs([],Pd,t,e)}),Layer:Ws(function(t,e){return Zs({},Id,t,e)})}),wd=function(t){function e(){t.call(this),this.version=void 0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){this.version=t.getAttribute("version").trim();return Zs({version:this.version},Sd,t,[])||null},e}(Td),bd=$s(_d,{Name:Ws(dl),Title:Ws(dl),Abstract:Ws(dl),KeywordList:Ws(Wd),OnlineResource:Ws(Cd),ContactInformation:Ws(function(t,e){return Zs({},Ld,t,e)}),Fees:Ws(dl),AccessConstraints:Ws(dl),LayerLimit:Ws(ul),MaxWidth:Ws(ul),MaxHeight:Ws(ul)}),Ld=$s(_d,{ContactPersonPrimary:Ws(function(t,e){return Zs({},Ad,t,e)}),ContactPosition:Ws(dl),ContactAddress:Ws(function(t,e){return Zs({},xd,t,e)}),ContactVoiceTelephone:Ws(dl),ContactFacsimileTelephone:Ws(dl),ContactElectronicMailAddress:Ws(dl)}),Ad=$s(_d,{ContactPerson:Ws(dl),ContactOrganization:Ws(dl)}),xd=$s(_d,{AddressType:Ws(dl),Address:Ws(dl),City:Ws(dl),StateOrProvince:Ws(dl),PostCode:Ws(dl),Country:Ws(dl)}),Pd=$s(_d,{Format:Us(dl)}),Id=$s(_d,{Name:Ws(dl),Title:Ws(dl),Abstract:Ws(dl),KeywordList:Ws(Wd),CRS:qs(dl),EX_GeographicBoundingBox:Ws(function(t,e){var r=Zs({},Od,t,e);if(r){var n=r.westBoundLongitude,i=r.southBoundLatitude,o=r.eastBoundLongitude,a=r.northBoundLatitude;if(void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a)return[n,i,o,a]}}),BoundingBox:qs(function(t,e){var r=[cl(t.getAttribute("minx")),cl(t.getAttribute("miny")),cl(t.getAttribute("maxx")),cl(t.getAttribute("maxy"))],n=[cl(t.getAttribute("resx")),cl(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:r,res:n}}),Dimension:qs(function(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:al(t.getAttribute("multipleValues")),nearestValue:al(t.getAttribute("nearestValue")),current:al(t.getAttribute("current")),values:dl(t)}}),Attribution:Ws(function(t,e){return Zs({},Rd,t,e)}),AuthorityURL:qs(function(t,e){var r=Ud(t,e);if(r)return r.name=t.getAttribute("name"),r}),Identifier:qs(dl),MetadataURL:qs(function(t,e){var r=Ud(t,e);if(r)return r.type=t.getAttribute("type"),r}),DataURL:qs(Ud),FeatureListURL:qs(Ud),Style:qs(function(t,e){return Zs({},Fd,t,e)}),MinScaleDenominator:Ws(ll),MaxScaleDenominator:Ws(ll),Layer:qs(function(t,e){var r=e[e.length-1],n=Zs({},Id,t,e);if(n){var i=al(t.getAttribute("queryable"));void 0===i&&(i=r.queryable);n.queryable=void 0!==i&&i;var o=hl(t.getAttribute("cascaded"));void 0===o&&(o=r.cascaded);n.cascaded=o;var a=al(t.getAttribute("opaque"));void 0===a&&(a=r.opaque);n.opaque=void 0!==a&&a;var s=al(t.getAttribute("noSubsets"));void 0===s&&(s=r.noSubsets);n.noSubsets=void 0!==s&&s;var l=cl(t.getAttribute("fixedWidth"));l||(l=r.fixedWidth);n.fixedWidth=l;var c=cl(t.getAttribute("fixedHeight"));c||(c=r.fixedHeight);n.fixedHeight=c,["Style","CRS","AuthorityURL"].forEach(function(t){if(t in r){var e=n[t]||[];n[t]=e.concat(r[t])}});return["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(t){if(!(t in n)){var e=r[t];n[t]=e}}),n}})}),Rd=$s(_d,{Title:Ws(dl),OnlineResource:Ws(Cd),LogoURL:Ws(qd)}),Od=$s(_d,{westBoundLongitude:Ws(ll),eastBoundLongitude:Ws(ll),southBoundLatitude:Ws(ll),northBoundLatitude:Ws(ll)}),Md=$s(_d,{GetCapabilities:Ws(jd),GetMap:Ws(jd),GetFeatureInfo:Ws(jd)}),kd=$s(_d,{Format:qs(dl),DCPType:qs(function(t,e){return Zs({},Nd,t,e)})}),Nd=$s(_d,{HTTP:Ws(function(t,e){return Zs({},Dd,t,e)})}),Dd=$s(_d,{Get:Ws(Ud),Post:Ws(Ud)}),Fd=$s(_d,{Name:Ws(dl),Title:Ws(dl),Abstract:Ws(dl),LegendURL:qs(qd),StyleSheetURL:Ws(Ud),StyleURL:Ws(Ud)}),Bd=$s(_d,{Format:Ws(dl),OnlineResource:Ws(Cd)}),Gd=$s(_d,{Keyword:Us(dl)});function Ud(t,e){return Zs({},Bd,t,e)}function jd(t,e){return Zs({},kd,t,e)}function qd(t,e){var r=Ud(t,e);if(r){var n=[hl(t.getAttribute("width")),hl(t.getAttribute("height"))];return r.size=n,r}}function Wd(t,e){return Zs([],Gd,t,e)}var Hd=wd,Vd=function(t){function e(e){t.call(this);var r=e||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new Lh,this.layers_=r.layers?r.layers:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayers=function(){return this.layers_},e.prototype.setLayers=function(t){this.layers_=t},e.prototype.readFeatures_=function(t,e){t.setAttribute("namespaceURI",this.featureNS_);var r=t.localName,n=[];if(0===t.childNodes.length)return n;if("msGMLOutput"==r)for(var i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE){var s=a,l=e[0],c=s.localName.replace("_layer","");if(!this.layers_||Nt(this.layers_,c)){var u=c+"_feature";l.featureType=u,l.featureNS=this.featureNS_;var h={};h[u]=Us(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var d=$s([l.featureNS,null],h);s.setAttribute("namespaceURI",this.featureNS_);var p=Zs([],d,s,e,this.gmlFormat_);p&&Bt(n,p)}}}if("FeatureCollection"==r){var f=Zs([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);f&&(n=f)}return n},e.prototype.readFeaturesFromNode=function(t,e){var r={};return e&&u(r,this.getReadOptions(t,e)),this.readFeatures_(t,[r])},e}(tl),Yd=[null,"http://www.opengis.net/ows/1.1"],zd=$s(Yd,{ServiceIdentification:Ws(function(t,e){return Zs({},ap,t,e)}),ServiceProvider:Ws(function(t,e){return Zs({},sp,t,e)}),OperationsMetadata:Ws(function(t,e){return Zs({},rp,t,e)})}),Kd=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){return Zs({},zd,t,[])||null},e}(Td),$d=$s(Yd,{DeliveryPoint:Ws(dl),City:Ws(dl),AdministrativeArea:Ws(dl),PostalCode:Ws(dl),Country:Ws(dl),ElectronicMailAddress:Ws(dl)}),Xd=$s(Yd,{Value:qs(function(t,e){return dl(t)})}),Zd=$s(Yd,{AllowedValues:Ws(function(t,e){return Zs({},Xd,t,e)})}),Jd=$s(Yd,{Phone:Ws(function(t,e){return Zs({},np,t,e)}),Address:Ws(function(t,e){return Zs({},$d,t,e)})}),Qd=$s(Yd,{HTTP:Ws(function(t,e){return Zs({},tp,t,e)})}),tp=$s(Yd,{Get:qs(function(t,e){var r=Cd(t);if(r)return Zs({href:r},ip,t,e)}),Post:void 0}),ep=$s(Yd,{DCP:Ws(function(t,e){return Zs({},Qd,t,e)})}),rp=$s(Yd,{Operation:function(t,e){var r=t.getAttribute("name"),n=Zs({},ep,t,e);n&&(e[e.length-1][r]=n)}}),np=$s(Yd,{Voice:Ws(dl),Facsimile:Ws(dl)}),ip=$s(Yd,{Constraint:qs(function(t,e){var r=t.getAttribute("name");if(r)return Zs({name:r},Zd,t,e)})}),op=$s(Yd,{IndividualName:Ws(dl),PositionName:Ws(dl),ContactInfo:Ws(function(t,e){return Zs({},Jd,t,e)})}),ap=$s(Yd,{Abstract:Ws(dl),AccessConstraints:Ws(dl),Fees:Ws(dl),Title:Ws(dl),ServiceTypeVersion:Ws(dl),ServiceType:Ws(dl)}),sp=$s(Yd,{ProviderName:Ws(dl),ProviderSite:Ws(Cd),ServiceContact:Ws(function(t,e){return Zs({},op,t,e)})}),lp=Kd,cp=[null,"http://www.opengis.net/wmts/1.0"],up=[null,"http://www.opengis.net/ows/1.1"],hp=$s(cp,{Contents:Ws(function(t,e){return Zs({},pp,t,e)})}),dp=function(t){function e(){t.call(this),this.owsParser_=new lp}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){var e=t.getAttribute("version").trim(),r=this.owsParser_.readFromNode(t);return r?(r.version=e,(r=Zs(r,hp,t,[]))||null):null},e}(Td),pp=$s(cp,{Layer:qs(function(t,e){return Zs({},fp,t,e)}),TileMatrixSet:qs(function(t,e){return Zs({},_p,t,e)})}),fp=$s(cp,{Style:qs(function(t,e){var r=Zs({},gp,t,e);if(r){var n="true"===t.getAttribute("isDefault");return r.isDefault=n,r}}),Format:qs(dl),TileMatrixSetLink:qs(function(t,e){return Zs({},yp,t,e)}),Dimension:qs(function(t,e){return Zs({},vp,t,e)}),ResourceURL:qs(function(t,e){var r=t.getAttribute("format"),n=t.getAttribute("template"),i=t.getAttribute("resourceType"),o={};r&&(o.format=r);n&&(o.template=n);i&&(o.resourceType=i);return o})},$s(up,{Title:Ws(dl),Abstract:Ws(dl),WGS84BoundingBox:Ws(function(t,e){var r=Zs([],Tp,t,e);if(2==r.length)return Me(r)}),Identifier:Ws(dl)})),gp=$s(cp,{LegendURL:qs(function(t,e){var r={};return r.format=t.getAttribute("format"),r.href=Cd(t),r})},$s(up,{Title:Ws(dl),Identifier:Ws(dl)})),yp=$s(cp,{TileMatrixSet:Ws(dl),TileMatrixSetLimits:Ws(function(t,e){return Zs([],mp,t,e)})}),mp=$s(cp,{TileMatrixLimits:Us(function(t,e){return Zs({},Cp,t,e)})}),Cp=$s(cp,{TileMatrix:Ws(dl),MinTileRow:Ws(ul),MaxTileRow:Ws(ul),MinTileCol:Ws(ul),MaxTileCol:Ws(ul)}),vp=$s(cp,{Default:Ws(dl),Value:qs(dl)},$s(up,{Identifier:Ws(dl)})),Tp=$s(up,{LowerCorner:Us(Ep),UpperCorner:Us(Ep)}),_p=$s(cp,{WellKnownScaleSet:Ws(dl),TileMatrix:qs(function(t,e){return Zs({},Sp,t,e)})},$s(up,{SupportedCRS:Ws(dl),Identifier:Ws(dl)})),Sp=$s(cp,{TopLeftCorner:Ws(Ep),ScaleDenominator:Ws(ll),TileWidth:Ws(ul),TileHeight:Ws(ul),MatrixWidth:Ws(ul),MatrixHeight:Ws(ul)},$s(up,{Identifier:Ws(dl)}));function Ep(t,e){var r=dl(t).split(/\s+/);if(r&&2==r.length){var n=+r[0],i=+r[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}var wp=dp,bp={Point:function(t,e,r){var n=t.coordinates;e&&r&&Ip(n,e,r);return new Pn(n)},LineString:function(t,e){var r=Lp(t.arcs,e);return new ys(r)},Polygon:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n)r[n]=Lp(t.arcs[n],e);return new Wn(r)},MultiPoint:function(t,e,r){var n=t.coordinates;if(e&&r)for(var i=0,o=n.length;i<o;++i)Ip(n[i],e,r);return new ps(n)},MultiLineString:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n)r[n]=Lp(t.arcs[n],e);return new ms(r)},MultiPolygon:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n){for(var o=t.arcs[n],a=[],s=0,l=o.length;s<l;++s)a[s]=Lp(o[s],e);r[n]=a}return new Cs(r)}};function Lp(t,e){for(var r,n,i=[],o=0,a=t.length;o<a;++o)r=t[o],o>0&&i.pop(),n=r>=0?e[r]:e[~r].slice().reverse(),i.push.apply(i,n);for(var s=0,l=i.length;s<l;++s)i[s]=i[s].slice();return i}function Ap(t,e,r,n,i,o,a){for(var s=t.geometries,l=[],c=0,u=s.length;c<u;++c)l[c]=xp(s[c],e,r,n,i,o,a);return l}function xp(t,e,r,n,i,o,a){var s,l=t.type,c=bp[l];s="Point"===l||"MultiPoint"===l?c(t,r,n):c(t,e);var u=new ds;u.setGeometry(As(s,!1,a)),void 0!==t.id&&u.setId(t.id);var h=t.properties;return i&&(h||(h={}),h[i]=o),h&&u.setProperties(h),u}function Pp(t,e,r){for(var n=0,i=0,o=0,a=t.length;o<a;++o){var s=t[o];n+=s[0],i+=s[1],s[0]=n,s[1]=i,Ip(s,e,r)}}function Ip(t,e,r){t[0]=t[0]*e[0]+r[0],t[1]=t[1]*e[1]+r[1]}var Rp=function(t){function e(e){t.call(this);var r=e||{};this.layerName_=r.layerName,this.layers_=r.layers?r.layers:null,this.dataProjection=jr(r.dataProjection?r.dataProjection:"EPSG:4326")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeaturesFromObject=function(t,e){if("Topology"==t.type){var r,n=t,i=null,o=null;n.transform&&(i=(r=n.transform).scale,o=r.translate);var a=n.arcs;r&&function(t,e,r){for(var n=0,i=t.length;n<i;++n)Pp(t[n],e,r)}(a,i,o);var s,l=[],c=n.objects,u=this.layerName_;for(var h in c)this.layers_&&-1==this.layers_.indexOf(h)||("GeometryCollection"===c[h].type?(s=c[h],l.push.apply(l,Ap(s,a,i,o,u,h,e))):(s=c[h],l.push(xp(s,a,i,o,u,h,e))));return l}return[]},e.prototype.readProjectionFromObject=function(t){return this.dataProjection},e}(Ps),Op=function(t){function e(e){var r=e||{};t.call(this,r),this.schemaLocation=r.schemaLocation?r.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(_l);Op.prototype.namespace="http://www.opengis.net/gml/3.2",Op.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:js(_l.prototype.readFlatPos_),posList:js(_l.prototype.readFlatPosList_)}},Op.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:_l.prototype.interiorParser_,exterior:_l.prototype.exteriorParser_}},Op.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:js(il.prototype.readPoint),MultiPoint:js(il.prototype.readMultiPoint),LineString:js(il.prototype.readLineString),MultiLineString:js(il.prototype.readMultiLineString),LinearRing:js(il.prototype.readLinearRing),Polygon:js(il.prototype.readPolygon),MultiPolygon:js(il.prototype.readMultiPolygon),Surface:js(Op.prototype.readSurface_),MultiSurface:js(_l.prototype.readMultiSurface_),Curve:js(Op.prototype.readCurve_),MultiCurve:js(_l.prototype.readMultiCurve_),Envelope:js(Op.prototype.readEnvelope_)}},Op.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml/3.2":{curveMember:Us(_l.prototype.curveMemberParser_),curveMembers:Us(_l.prototype.curveMemberParser_)}},Op.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml/3.2":{surfaceMember:Us(_l.prototype.surfaceMemberParser_),surfaceMembers:Us(_l.prototype.surfaceMemberParser_)}},Op.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{LineString:Us(il.prototype.readLineString),Curve:Us(_l.prototype.readCurve_)}},Op.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Polygon:Us(il.prototype.readPolygon),Surface:Us(_l.prototype.readSurface_)}},Op.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml/3.2":{patches:js(_l.prototype.readPatch_)}},Op.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml/3.2":{segments:js(_l.prototype.readSegment_)}},Op.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml/3.2":{lowerCorner:Us(_l.prototype.readFlatPosList_),upperCorner:Us(_l.prototype.readFlatPosList_)}},Op.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml/3.2":{PolygonPatch:js(_l.prototype.readPolygonPatch_)}},Op.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml/3.2":{LineStringSegment:js(_l.prototype.readLineStringSegment_)}},Op.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml/3.2":{pointMember:Us(il.prototype.pointMemberParser_),pointMembers:Us(il.prototype.pointMemberParser_)}},Op.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml/3.2":{lineStringMember:Us(il.prototype.lineStringMemberParser_),lineStringMembers:Us(il.prototype.lineStringMemberParser_)}},Op.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml/3.2":{polygonMember:Us(il.prototype.polygonMemberParser_),polygonMembers:Us(il.prototype.polygonMemberParser_)}},Op.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Point:Us(il.prototype.readFlatCoordinatesFromNode_)}},Op.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{LineString:Us(il.prototype.readLineString)}},Op.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Polygon:Us(il.prototype.readPolygon)}},Op.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:js(il.prototype.readFlatLinearRing_)}},Op.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{exterior:Hs(_l.prototype.writeRing_),interior:Hs(_l.prototype.writeRing_)}},Op.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{lowerCorner:Hs(ml),upperCorner:Hs(ml)}},Op.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{surfaceMember:Hs(_l.prototype.writeSurfaceOrPolygonMember_),polygonMember:Hs(_l.prototype.writeSurfaceOrPolygonMember_)}},Op.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{pointMember:Hs(_l.prototype.writePointMember_)}},Op.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{lineStringMember:Hs(_l.prototype.writeLineStringOrCurveMember_),curveMember:Hs(_l.prototype.writeLineStringOrCurveMember_)}},Op.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{Curve:Hs(_l.prototype.writeCurveOrLineString_),MultiCurve:Hs(_l.prototype.writeMultiCurveOrLineString_),Point:Hs(Op.prototype.writePoint_),MultiPoint:Hs(_l.prototype.writeMultiPoint_),LineString:Hs(_l.prototype.writeCurveOrLineString_),MultiLineString:Hs(_l.prototype.writeMultiCurveOrLineString_),LinearRing:Hs(_l.prototype.writeLinearRing_),Polygon:Hs(_l.prototype.writeSurfaceOrPolygon_),MultiPolygon:Hs(_l.prototype.writeMultiSurfaceOrPolygon_),Surface:Hs(_l.prototype.writeSurfaceOrPolygon_),MultiSurface:Hs(_l.prototype.writeMultiSurfaceOrPolygon_),Envelope:Hs(_l.prototype.writeEnvelope)}};var Mp=Op,kp="renderOrder",Np=function(t){function e(e){var r=e||{},n=u({},r);delete n.style,delete n.renderBuffer,delete n.updateWhileAnimating,delete n.updateWhileInteracting,t.call(this,n),this.declutter_=void 0!==r.declutter&&r.declutter,this.renderBuffer_=void 0!==r.renderBuffer?r.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(r.style),this.updateWhileAnimating_=void 0!==r.updateWhileAnimating&&r.updateWhileAnimating,this.updateWhileInteracting_=void 0!==r.updateWhileInteracting&&r.updateWhileInteracting,this.renderMode_=r.renderMode||mo.VECTOR,this.type=yo.VECTOR}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.setDeclutter=function(t){this.declutter_=t},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(kp)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.setRenderOrder=function(t){this.set(kp,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:vc,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var r;Array.isArray(t)?r=t:(te("function"==typeof t.getZIndex,41),r=[t]),e=function(){return r}}return e}(this.style_),this.changed()},e.prototype.getRenderMode=function(){return this.renderMode_},e}(Ci);Np.prototype.getSource;var Dp=Np;function Fp(t,e){return[[-1/0,-1/0,1/0,1/0]]}function Bp(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var Gp=function(t){function e(e){t.call(this),this.projection_=jr(e.projection),this.attributions_=Bp(e.attributions),this.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,this.loading=!1,this.state_=void 0!==e.state?e.state:ni.READY,this.wrapX_=void 0!==e.wrapX&&e.wrapX}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolutions=function(){return n()},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=Bp(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(D),Up={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},jp=function(t){this.rbush_=ha()(t,void 0),this.items_={}};jp.prototype.insert=function(t,e){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[o(e)]=r},jp.prototype.load=function(t,e){for(var r=new Array(e.length),n=0,i=e.length;n<i;n++){var a=t[n],s=e[n],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};r[n]=l,this.items_[o(s)]=l}this.rbush_.load(r)},jp.prototype.remove=function(t){var e=o(t),r=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(r)},jp.prototype.update=function(t,e){var r=this.items_[o(e)];Ve([r.minX,r.minY,r.maxX,r.maxY],t)||(this.remove(e),this.insert(t,e))},jp.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},jp.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})},jp.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)},jp.prototype.forEachInExtent=function(t,e,r){return this.forEach_(this.getInExtent(t),e,r)},jp.prototype.forEach_=function(t,e,r){for(var n,i=0,o=t.length;i<o;i++)if(n=e.call(r,t[i]))return n;return n},jp.prototype.isEmpty=function(){return p(this.items_)},jp.prototype.clear=function(){this.rbush_.clear(),this.items_={}},jp.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return je(e.minX,e.minY,e.maxX,e.maxY,t)},jp.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]};var qp=jp,Wp=function(t){function e(e,r){t.call(this,e),this.feature=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),Hp=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:void 0,state:ni.READY,wrapX:void 0===r.wrapX||r.wrapX}),this.loader_=L,this.format_=r.format,this.overlaps_=null==r.overlaps||r.overlaps,this.url_=r.url,void 0!==r.loader?this.loader_=r.loader:void 0!==this.url_&&(te(this.format_,7),this.loader_=ws(this.url_,this.format_)),this.strategy_=void 0!==r.strategy?r.strategy:Fp;var n,i,o=void 0===r.useSpatialIndex||r.useSpatialIndex;this.featuresRtree_=o?new qp:null,this.loadedExtentsRtree_=new qp,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(r.features)?i=r.features:r.features&&(i=(n=r.features).getArray()),o||void 0!==n||(n=new G(i)),void 0!==i&&this.addFeaturesInternal(i),void 0!==n&&this.bindFeaturesCollection_(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=o(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var r=t.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Wp(Up.ADDFEATURE,t))}},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[C(e,R.CHANGE,this.handleFeatureChange_,this),C(e,c,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var r=!0,n=e.getId();return void 0!==n?n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=e:(te(!(t in this.undefIdIndex_),30),this.undefIdIndex_[t]=e),r},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],r=[],n=[],i=0,a=t.length;i<a;i++){var s=t[i],l=o(s);this.addToIndex_(l,s)&&r.push(s)}for(var c=0,u=r.length;c<u;c++){var h=r[c],d=o(h);this.setupChangeEvents_(d,h);var p=h.getGeometry();if(p){var f=p.getExtent();e.push(f),n.push(h)}else this.nullGeometryFeatures_[d]=h}this.featuresRtree_&&this.featuresRtree_.load(e,n);for(var g=0,y=r.length;g<y;g++)this.dispatchEvent(new Wp(Up.ADDFEATURE,r[g]))},e.prototype.bindFeaturesCollection_=function(t){var e=!1;C(this,Up.ADDFEATURE,function(r){e||(e=!0,t.push(r.feature),e=!1)}),C(this,Up.REMOVEFEATURE,function(r){e||(e=!0,t.remove(r.feature),e=!1)}),C(t,l.ADD,function(t){e||(e=!0,this.addFeature(t.element),e=!1)},this),C(t,l.REMOVE,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)},this),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(_);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var r in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var n=new Wp(Up.CLEAR);this.dispatchEvent(n),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(t)?e(r):void 0})},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(r){if(r.getGeometry().intersectsExtent(t)){var n=e(r);if(n)return n}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray():this.featuresRtree_&&(t=this.featuresRtree_.getAll(),p(this.nullGeometryFeatures_)||Bt(t,d(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_.getInExtent(t)},e.prototype.getClosestFeatureToCoordinate=function(t,e){var r=t[0],n=t[1],i=null,o=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],l=e||w;return this.featuresRtree_.forEachInExtent(s,function(t){if(l(t)){var e=t.getGeometry(),c=a;if((a=e.closestPointXY(r,n,o,a))<c){i=t;var u=Math.sqrt(a);s[0]=r-u,s[1]=n-u,s[2]=r+u,s[3]=n+u}}}),i},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,r=o(e),n=e.getGeometry();if(n){var i=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(i,e)):this.featuresRtree_&&this.featuresRtree_.update(i,e)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);var a=e.getId();if(void 0!==a){var s=a.toString();r in this.undefIdIndex_?(delete this.undefIdIndex_[r],this.idIndex_[s]=e):this.idIndex_[s]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[s]=e)}else r in this.undefIdIndex_||(this.removeFromIdIndex_(e),this.undefIdIndex_[r]=e);this.changed(),this.dispatchEvent(new Wp(Up.CHANGEFEATURE,e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:o(t)in this.undefIdIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&p(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,e,r){var n=this,i=this.loadedExtentsRtree_,o=this.strategy_(t,e);this.loading=!1;for(var a=function(t,a){var s=o[t];i.forEachInExtent(s,function(t){return Be(t.extent,s)})||(n.loader_.call(n,s,e,r),i.insert(s,{extent:s.slice()}),n.loading=n.loader_!==L)},s=0,l=o.length;s<l;++s)a(s)},e.prototype.removeLoadedExtent=function(t){var e,r=this.loadedExtentsRtree_;r.forEachInExtent(t,function(r){if(Ve(r.extent,t))return e=r,!0}),e&&r.remove(e)},e.prototype.removeFeature=function(t){var e=o(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},e.prototype.removeFeatureInternal=function(t){var e=o(t);this.featureChangeKeys_[e].forEach(_),delete this.featureChangeKeys_[e];var r=t.getId();void 0!==r?delete this.idIndex_[r.toString()]:delete this.undefIdIndex_[e],this.dispatchEvent(new Wp(Up.REMOVEFEATURE,t))},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e}(Gp),Vp={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},Yp="drawstart",zp=function(t){function e(e,r){t.call(this,e),this.feature=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),Kp=function(t){function e(e){var r=e;r.stopDown||(r.stopDown=b),t.call(this,r),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(t){var e;t===hr.POINT||t===hr.MULTI_POINT?e=Vp.POINT:t===hr.LINE_STRING||t===hr.MULTI_LINE_STRING?e=Vp.LINE_STRING:t===hr.POLYGON||t===hr.MULTI_POLYGON?e=Vp.POLYGON:t===hr.CIRCLE&&(e=Vp.CIRCLE);return e}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_===Vp.POLYGON?3:2,this.maxPoints_=e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:w;var n,i=e.geometryFunction;if(!i)if(this.type_===hr.CIRCLE)i=function(t,e){var r=e||new Ts([NaN,NaN]),n=we(t[0],t[1]);return r.setCenterAndRadius(t[0],Math.sqrt(n)),r};else{var o,a=this.mode_;a===Vp.POINT?o=Pn:a===Vp.LINE_STRING?o=ys:a===Vp.POLYGON&&(o=Wn),i=function(t,e){var r=e;return r?a===Vp.POLYGON?t[0].length?r.setCoordinates([t[0].concat([t[0][0]])]):r.setCoordinates([]):r.setCoordinates(t):r=new o(t),r}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Dp({source:new Hp({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(n=Tc(),function(t,e){return n[t.getGeometry().getType()]}),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:qi,this.freehandCondition_,e.freehand?this.freehandCondition_=Fi:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Wi,C(this,N(Li.ACTIVE),this.updateState_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===R.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==Vp.POINT&&this.freehandCondition_(e);var r=e.type===J.POINTERMOVE,n=!0;!this.freehand_&&this.lastDragTime_&&e.type===J.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,r=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===J.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e),n=!1):this.freehand_&&e.type===J.POINTERDOWN?n=!1:r?(n=e.type===J.POINTERMOVE)&&this.freehand_?n=this.handlePointerMove_(e):(e.pointerEvent.pointerType==it||e.type===J.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===J.DBLCLICK&&(n=!1),t.prototype.handleEvent.call(this,e)&&n},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):!!this.condition_(t)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Q(J.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0)},e.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var r=this.mode_===Vp.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||r?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t):(this.startDrawing_(t),this.mode_===Vp.POINT&&this.finishDrawing()),e=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,r=t.pixel,n=e[0]-r[0],i=e[1]-r[1],o=n*n+i*i;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var r=!1,n=[this.finishCoordinate_];if(this.mode_===Vp.LINE_STRING)r=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===Vp.POLYGON){var i=this.sketchCoords_;r=i[0].length>this.minPoints_,n=[i[0][0],i[0][i[0].length-2]]}if(r)for(var o=t.map,a=0,s=n.length;a<s;a++){var l=n[a],c=o.getPixelFromCoordinate(l),u=t.pixel,h=u[0]-c[0],d=u[1]-c[1],p=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(h*h+d*d)<=p){this.finishCoordinate_=l;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new ds(new Pn(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e,this.mode_===Vp.POINT?this.sketchCoords_=e.slice():this.mode_===Vp.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new ds(new ys(this.sketchLineCoords_)));var r=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new ds,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new zp(Yp,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,r,n,i=t.coordinate,o=this.sketchFeature_.getGeometry();(this.mode_===Vp.POINT?r=this.sketchCoords_:this.mode_===Vp.POLYGON?(r=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(i=this.finishCoordinate_.slice())):r=(e=this.sketchCoords_)[e.length-1],r[0]=i[0],r[1]=i[1],this.geometryFunction_(this.sketchCoords_,o),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(i);if(o.getType()==hr.POLYGON&&this.mode_!==Vp.POLYGON){this.sketchLine_||(this.sketchLine_=new ds);var a=o.getLinearRing(0);(n=this.sketchLine_.getGeometry())?(n.setFlatCoordinates(a.getLayout(),a.getFlatCoordinates()),n.changed()):(n=new ys(a.getFlatCoordinates(),a.getLayout()),this.sketchLine_.setGeometry(n))}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,r,n=t.coordinate,i=this.sketchFeature_.getGeometry();this.mode_===Vp.LINE_STRING?(this.finishCoordinate_=n.slice(),(r=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(n.slice()),this.geometryFunction_(r,i)):this.mode_===Vp.POLYGON&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(n.slice()),e&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,i)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();this.mode_===Vp.LINE_STRING?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===Vp.POLYGON&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,r=t.getGeometry();this.mode_===Vp.LINE_STRING?(e.pop(),this.geometryFunction_(e,r)):this.mode_===Vp.POLYGON&&(e[0].pop(),this.geometryFunction_(e,r),e=r.getCoordinates()),this.type_===hr.MULTI_POINT?t.setGeometry(new ps([e])):this.type_===hr.MULTI_LINE_STRING?t.setGeometry(new ms([e])):this.type_===hr.MULTI_POLYGON&&t.setGeometry(new Cs([e])),this.dispatchEvent(new zp("drawend",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return t&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),t},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new zp(Yp,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_(),this.overlay_.setMap(e?t:null)},e}(Ki),$p=function(t){function e(e,r,n){t.call(this,e),this.features=r,this.coordinate=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),Xp=function(t){function e(e){var r,n=e||{};if(t.call(this,n),this.lastCoordinate_=null,this.features_=void 0!==n.features?n.features:null,n.layers)if("function"==typeof n.layers)r=n.layers;else{var i=n.layers;r=function(t){return Nt(i,t)}}else r=w;this.layerFilter_=r,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0,this.lastFeature_=null,C(this,N(Li.ACTIVE),this.handleActiveChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new G([this.lastFeature_]);return this.dispatchEvent(new $p("translatestart",e,t.coordinate)),!0}return!1},e.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new G([this.lastFeature_]);return this.dispatchEvent(new $p("translateend",e,t.coordinate)),!0}return!1},e.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,r=e[0]-this.lastCoordinate_[0],n=e[1]-this.lastCoordinate_[1],i=this.features_||new G([this.lastFeature_]);i.forEach(function(t){var e=t.getGeometry();e.translate(r,n),t.setGeometry(e)}),this.lastCoordinate_=e,this.dispatchEvent(new $p("translating",i,e))}},e.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},e.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t){if(!this.features_||Nt(this.features_.getArray(),t))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap();t.prototype.setMap.call(this,e),this.updateState_(r)},e.prototype.handleActiveChanged_=function(){this.updateState_(null)},e.prototype.updateState_=function(t){var e=this.getMap(),r=this.getActive();e&&r||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},e}(Ki);function Zp(t){return t.feature?t.feature:t.element?t.element:void 0}var Jp=function(t){function e(e){var r=e||{},n=r;n.handleDownEvent||(n.handleDownEvent=w),n.stopDown||(n.stopDown=b),t.call(this,n),this.source_=r.source?r.source:null,this.vertex_=void 0===r.vertex||r.vertex,this.edge_=void 0===r.edge||r.edge,this.features_=r.features?r.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,this.sortByDistance_=function(t,e){return Le(this.pixelCoordinate_,t.segment)-Le(this.pixelCoordinate_,e.segment)}.bind(this),this.rBush_=new qp,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t,e){var r=void 0===e||e,n=o(t),i=t.getGeometry();if(i){var a=this.SEGMENT_WRITERS_[i.getType()];a&&(this.indexedFeaturesExtents_[n]=i.getExtent([1/0,1/0,-1/0,-1/0]),a.call(this,t,i))}r&&(this.featureChangeListenerKeys_[n]=C(t,R.CHANGE,this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var r=this.snapTo(e.pixel,e.coordinate,e.map);return r.snapped&&(e.coordinate=r.vertex.slice(0,2),e.pixel=r.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=Zp(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=Zp(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var r=o(e);r in this.pendingFeatures_||(this.pendingFeatures_[r]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=d(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var r=void 0===e||e,n=o(t),i=this.indexedFeaturesExtents_[n];if(i){var a=this.rBush_,s=[];a.forEachInExtent(i,function(e){t===e.feature&&s.push(e)});for(var l=s.length-1;l>=0;--l)a.remove(s[l])}r&&(_(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},e.prototype.setMap=function(e){var r=this.getMap(),n=this.featuresListenerKeys_,i=this.getFeatures_();r&&(n.forEach(_),n.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?n.push(C(this.features_,l.ADD,this.handleFeatureAdd_,this),C(this.features_,l.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push(C(this.source_,Up.ADDFEATURE,this.handleFeatureAdd_,this),C(this.source_,Up.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,r){var n=Me([r.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),r.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),i=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(i=i.filter(function(t){return t.feature.getGeometry().getType()!==hr.CIRCLE}));var o,a,s,l,c=!1,u=null,h=null;if(i.length>0){this.pixelCoordinate_=e,i.sort(this.sortByDistance_);var d=i[0].segment,p=i[0].feature.getGeometry().getType()===hr.CIRCLE;this.vertex_&&!this.edge_?(o=r.getPixelFromCoordinate(d[0]),a=r.getPixelFromCoordinate(d[1]),s=we(t,o),l=we(t,a),Math.sqrt(Math.min(s,l))<=this.pixelTolerance_&&(c=!0,u=s>l?d[1]:d[0],h=r.getPixelFromCoordinate(u))):this.edge_&&(u=p?function(t,e){var r=e.getRadius(),n=e.getCenter(),i=n[0],o=n[1],a=t[0]-i,s=t[1]-o;0===a&&0===s&&(a=1);var l=Math.sqrt(a*a+s*s);return[i+r*a/l,o+r*s/l]}(e,i[0].feature.getGeometry()):Te(e,d),be(t,h=r.getPixelFromCoordinate(u))<=this.pixelTolerance_&&(c=!0,this.vertex_&&!p&&(o=r.getPixelFromCoordinate(d[0]),a=r.getPixelFromCoordinate(d[1]),s=we(h,o),l=we(h,a),Math.sqrt(Math.min(s,l))<=this.pixelTolerance_&&(u=s>l?d[1]:d[0],h=r.getPixelFromCoordinate(u))))),c&&(h=[Math.round(h[0]),Math.round(h[1])])}return{snapped:c,vertex:u,vertexPixel:h}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){for(var r=Vn(e).getCoordinates()[0],n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,segment:o};this.rBush_.insert(Me(o),a)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),n=0;n<r.length;++n){var i=this.SEGMENT_WRITERS_[r[n].getType()];i&&i.call(this,t,r[n])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,segment:o};this.rBush_.insert(Me(o),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert(Me(l),c)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c){var h=l.slice(c,c+2),d={feature:t,segment:h};this.rBush_.insert(Me(h),d)}},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),n={feature:t,segment:[r,r]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert(Me(l),c)}},e}(Ki),Qp={SELECT:"select"},tf=function(t){function e(e,r,n,i){t.call(this,e),this.selected=r,this.deselected=n,this.mapBrowserEvent=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function ef(t){if(!this.condition_(t))return!0;var e=this.addCondition_(t),r=this.removeCondition_(t),n=this.toggleCondition_(t),i=!e&&!r&&!n,o=t.map,a=this.getFeatures(),s=[],l=[];if(i){h(this.featureLayerAssociation_),o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return l.push(t),this.addFeatureLayerAssociation_(t,e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var c=a.getLength()-1;c>=0;--c){var u=a.item(c),d=l.indexOf(u);d>-1?l.splice(d,1):(a.remove(u),s.push(u))}0!==l.length&&a.extend(l)}else{o.forEachFeatureAtPixel(t.pixel,function(t,i){if(this.filter_(t,i))return!e&&!n||Nt(a.getArray(),t)?(r||n)&&Nt(a.getArray(),t)&&(s.push(t),this.removeFeatureLayerAssociation_(t)):(l.push(t),this.addFeatureLayerAssociation_(t,i)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=s.length-1;p>=0;--p)a.remove(s[p]);a.extend(l)}return(l.length>0||s.length>0)&&this.dispatchEvent(new tf(Qp.SELECT,l,s,t)),Ui(t)}function rf(){var t=Tc();return Bt(t[hr.POLYGON],t[hr.LINE_STRING]),Bt(t[hr.GEOMETRY_COLLECTION],t[hr.LINE_STRING]),function(e,r){return e.getGeometry()?t[e.getGeometry().getType()]:null}}var nf=function(t){function e(e){t.call(this,{handleEvent:ef});var r=e||{};this.condition_=r.condition?r.condition:ji,this.addCondition_=r.addCondition?r.addCondition:Gi,this.removeCondition_=r.removeCondition?r.removeCondition:Gi,this.toggleCondition_=r.toggleCondition?r.toggleCondition:Wi,this.multi_=!!r.multi&&r.multi,this.filter_=r.filter?r.filter:w,this.hitTolerance_=r.hitTolerance?r.hitTolerance:0;var n,i=new Dp({source:new Hp({useSpatialIndex:!1,features:r.features,wrapX:r.wrapX}),style:r.style?r.style:rf(),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=i,r.layers)if("function"==typeof r.layers)n=r.layers;else{var o=r.layers;n=function(t){return Nt(o,t)}}else n=w;this.layerFilter_=n,this.featureLayerAssociation_={};var a=this.getFeatures();C(a,l.ADD,this.addFeature_,this),C(a,l.REMOVE,this.removeFeature_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[o(t)]=e},e.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.getLayer=function(t){return this.featureLayerAssociation_[o(t)]},e.prototype.getOverlay=function(){return this.featureOverlay_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap(),n=this.getFeatures();r&&n.forEach(r.unskipFeature.bind(r)),t.prototype.setMap.call(this,e),this.featureOverlay_.setMap(e),e&&n.forEach(e.skipFeature.bind(e))},e.prototype.addFeature_=function(t){var e=this.getMap();e&&e.skipFeature(t.element)},e.prototype.removeFeature_=function(t){var e=this.getMap();e&&e.unskipFeature(t.element)},e.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[o(t)]},e}(Ri),of=1,af="modifyend",sf=function(t){function e(e,r,n){t.call(this,e),this.features=r,this.mapBrowserEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function lf(t,e){return t.index-e.index}function cf(t,e){var r=e.geometry;if(r.getType()===hr.CIRCLE){var n=r;if(e.index===of){var i=we(n.getCenter(),t),o=Math.sqrt(i)-n.getRadius();return o*o}}return Le(t,e.segment)}function uf(t,e){var r=e.geometry;return r.getType()===hr.CIRCLE&&e.index===of?r.getClosestPoint(t):Te(t,e.segment)}function hf(){var t=Tc();return function(e,r){return t[hr.POINT]}}var df=function(t){function e(e){var r;if(t.call(this,e),this.condition_=e.condition?e.condition:Yi,this.defaultDeleteCondition_=function(t){return ki(t)&&ji(t)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Fi,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new qp,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Dp({source:new Hp({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:hf(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,e.source?(this.source_=e.source,r=new G(this.source_.getFeatures()),C(this.source_,Up.ADDFEATURE,this.handleSourceAdd_,this),C(this.source_,Up.REMOVEFEATURE,this.handleSourceRemove_,this)):r=e.features,!r)throw new Error("The modify interaction requires features or a source");this.features_=r,this.features_.forEach(this.addFeature_.bind(this)),C(this.features_,l.ADD,this.handleFeatureAdd_,this),C(this.features_,l.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature_=function(t){var e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),C(t,R.CHANGE,this.handleFeatureChange_,this)},e.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new sf("modifystart",this.features_,t)))},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),T(t,R.CHANGE,this.handleFeatureChange_,this)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,r=[];e.forEach(function(e){t===e.feature&&r.push(e)});for(var n=r.length-1;n>=0;--n)e.remove(r[n])},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),n={feature:t,geometry:e,segment:[r,r]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:t,geometry:e,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,geometry:e,index:n,segment:o};this.rBush_.insert(Me(o),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,geometry:e,depth:[n],index:a,segment:l};this.rBush_.insert(Me(l),c)}},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,geometry:e,depth:[n],index:a,segment:l};this.rBush_.insert(Me(l),c)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c){var h=l.slice(c,c+2),d={feature:t,geometry:e,depth:[a,n],index:c,segment:h};this.rBush_.insert(Me(h),d)}},e.prototype.writeCircleGeometry_=function(t,e){var r=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[r,r]},i={feature:t,geometry:e,index:of,segment:[r,r]},o=[n,i];n.featureSegments=i.featureSegments=o,this.rBush_.insert(We(r),n),this.rBush_.insert(e.getExtent(),i)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),n=0;n<r.length;++n)this.SEGMENT_WRITERS_[r[n].getType()].call(this,t,r[n])},e.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new ds(new Pn(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},e.prototype.handleEvent=function(e){return!e.pointerEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=J.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(r=!(e.type!=J.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==J.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!r);var r},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,r=0,n=this.dragSegments_.length;r<n;++r){for(var i=this.dragSegments_[r],o=i[0],a=o.depth,s=o.geometry,l=void 0,c=o.segment,u=i[1];e.length<s.getStride();)e.push(c[u][e.length]);switch(s.getType()){case hr.POINT:l=e,c[0]=c[1]=e;break;case hr.MULTI_POINT:(l=s.getCoordinates())[o.index]=e,c[0]=c[1]=e;break;case hr.LINE_STRING:(l=s.getCoordinates())[o.index+u]=e,c[u]=e;break;case hr.MULTI_LINE_STRING:case hr.POLYGON:(l=s.getCoordinates())[a[0]][o.index+u]=e,c[u]=e;break;case hr.MULTI_POLYGON:(l=s.getCoordinates())[a[1]][a[0]][o.index+u]=e,c[u]=e;break;case hr.CIRCLE:c[0]=c[1]=e,0===o.index?(this.changingFeature_=!0,s.setCenter(e),this.changingFeature_=!1):(this.changingFeature_=!0,s.setRadius(be(s.getCenter(),e)),this.changingFeature_=!1)}l&&this.setGeometryCoordinates_(s,l)}this.createOrUpdateVertexFeature_(e)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var n=[],i=r.getGeometry().getCoordinates(),a=Me([i]),s=this.rBush_.getInExtent(a),l={};s.sort(lf);for(var c=0,u=s.length;c<u;++c){var h=s[c],d=h.segment,p=o(h.feature),f=h.depth;if(f&&(p+="-"+f.join("-")),l[p]||(l[p]=new Array(2)),h.geometry.getType()===hr.CIRCLE&&h.index===of)_e(uf(e,h),i)&&!l[p][0]&&(this.dragSegments_.push([h,0]),l[p][0]=h);else if(_e(d[0],i)&&!l[p][0])this.dragSegments_.push([h,0]),l[p][0]=h;else if(_e(d[1],i)&&!l[p][1]){if((h.geometry.getType()===hr.LINE_STRING||h.geometry.getType()===hr.MULTI_LINE_STRING)&&l[p][0]&&0===l[p][0].index)continue;this.dragSegments_.push([h,1]),l[p][1]=h}else this.insertVertexCondition_(t)&&o(d)in this.vertexSegments_&&!l[p][0]&&!l[p][1]&&n.push([h,i])}n.length&&this.willModifyFeatures_(t);for(var g=n.length-1;g>=0;--g)this.insertVertex_.apply(this,n[g])}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var r=this.dragSegments_[e][0],n=r.geometry;if(n.getType()===hr.CIRCLE){var i=n.getCenter(),o=r.featureSegments[0],a=r.featureSegments[1];o.segment[0]=o.segment[1]=i,a.segment[0]=a.segment[1]=i,this.rBush_.update(We(i),o),this.rBush_.update(n.getExtent(),a)}else this.rBush_.update(Me(r.segment),r)}return this.modified_&&(this.dispatchEvent(new sf(af,this.features_,t)),this.modified_=!1),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)},e.prototype.handlePointerAtPixel_=function(t,e){var r=e.getCoordinateFromPixel(t),n=ke(We(r),e.getView().getResolution()*this.pixelTolerance_),i=this.rBush_.getInExtent(n);if(i.length>0){i.sort(function(t,e){return cf(r,t)-cf(r,e)});var a=i[0],s=a.segment,l=uf(r,a),c=e.getPixelFromCoordinate(l),u=be(t,c);if(u<=this.pixelTolerance_){var h={};if(a.geometry.getType()===hr.CIRCLE&&a.index===of)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{var d=e.getPixelFromCoordinate(s[0]),p=e.getPixelFromCoordinate(s[1]),f=we(c,d),g=we(c,p);u=Math.sqrt(Math.min(f,g)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(l=f>g?s[1]:s[0]),this.createOrUpdateVertexFeature_(l);for(var y=1,m=i.length;y<m;++y){var C=i[y].segment;if(!(_e(s[0],C[0])&&_e(s[1],C[1])||_e(s[0],C[1])&&_e(s[1],C[0])))break;h[o(C)]=!0}}return h[o(s)]=!0,void(this.vertexSegments_=h)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var r,n=t.segment,i=t.feature,o=t.geometry,a=t.depth,s=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case hr.MULTI_LINE_STRING:case hr.POLYGON:(r=o.getCoordinates())[a[0]].splice(s+1,0,e);break;case hr.MULTI_POLYGON:(r=o.getCoordinates())[a[1]][a[0]].splice(s+1,0,e);break;case hr.LINE_STRING:(r=o.getCoordinates()).splice(s+1,0,e);break;default:return}this.setGeometryCoordinates_(o,r);var l=this.rBush_;l.remove(t),this.updateSegmentIndices_(o,s,a,1);var c={segment:[n[0],e],feature:i,geometry:o,depth:a,index:s};l.insert(Me(c.segment),c),this.dragSegments_.push([c,1]);var u={segment:[e,n[1]],feature:i,geometry:o,depth:a,index:s+1};l.insert(Me(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=J.POINTERDRAG){var t=this.lastPointerEvent_;return this.willModifyFeatures_(t),this.removeVertex_(),this.dispatchEvent(new sf(af,this.features_,t)),this.modified_=!1,!0}return!1},e.prototype.removeVertex_=function(){var t,e,r,n,i,a,s,l,c,u,h,d=this.dragSegments_,p={},f=!1;for(i=d.length-1;i>=0;--i)h=o((u=(r=d[i])[0]).feature),u.depth&&(h+="-"+u.depth.join("-")),h in p||(p[h]={}),0===r[1]?(p[h].right=u,p[h].index=u.index):1==r[1]&&(p[h].left=u,p[h].index=u.index+1);for(h in p){switch(c=p[h].right,s=p[h].left,(l=(a=p[h].index)-1)<0&&(l=0),t=e=(n=(u=void 0!==s?s:c).geometry).getCoordinates(),f=!1,n.getType()){case hr.MULTI_LINE_STRING:e[u.depth[0]].length>2&&(e[u.depth[0]].splice(a,1),f=!0);break;case hr.LINE_STRING:e.length>2&&(e.splice(a,1),f=!0);break;case hr.MULTI_POLYGON:t=t[u.depth[1]];case hr.POLYGON:(t=t[u.depth[0]]).length>4&&(a==t.length-1&&(a=0),t.splice(a,1),f=!0,0===a&&(t.pop(),t.push(t[0]),l=t.length-1))}if(f){this.setGeometryCoordinates_(n,e);var g=[];if(void 0!==s&&(this.rBush_.remove(s),g.push(s.segment[0])),void 0!==c&&(this.rBush_.remove(c),g.push(c.segment[1])),void 0!==s&&void 0!==c){var y={depth:u.depth,feature:u.feature,geometry:u.geometry,index:l,segment:g};this.rBush_.insert(Me(y.segment),y)}this.updateSegmentIndices_(n,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return f},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,r,n){this.rBush_.forEachInExtent(t.getExtent(),function(i){i.geometry===t&&(void 0===r||void 0===i.depth||Ut(i.depth,r))&&i.index>e&&(i.index+=n)})},e}(Ki),pf=function(t){function e(e,r,n,i){t.call(this,e),this.features=n,this.file=r,this.projection=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function ff(t){for(var e=t.dataTransfer.files,r=0,n=e.length;r<n;++r){var i=e.item(r),o=new FileReader;o.addEventListener(R.LOAD,this.handleResult_.bind(this,i)),o.readAsText(i)}}function gf(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}var yf=function(t){function e(e){var r=e||{};t.call(this,{handleEvent:w}),this.formatConstructors_=r.formatConstructors?r.formatConstructors:[],this.projection_=r.projection?jr(r.projection):null,this.dropListenKeys_=null,this.source_=r.source||null,this.target=r.target?r.target:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleResult_=function(t,e){var r=e.target.result,n=this.getMap(),i=this.projection_;i||(i=n.getView().getProjection());for(var o=this.formatConstructors_,a=[],s=0,l=o.length;s<l;++s){var c=new o[s];if((a=this.tryReadFeatures_(c,r,{featureProjection:i}))&&a.length>0)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(a)),this.dispatchEvent(new pf("addfeatures",t,a,i))},e.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[C(e,R.DROP,ff,this),C(e,R.DRAGENTER,gf,this),C(e,R.DRAGOVER,gf,this),C(e,R.DROP,gf,this)]}},e.prototype.setActive=function(e){t.prototype.setActive.call(this,e),e?this.registerListeners_():this.unregisterListeners_()},e.prototype.setMap=function(e){this.unregisterListeners_(),t.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},e.prototype.tryReadFeatures_=function(t,e,r){try{return t.readFeatures(e,r)}catch(t){return null}},e.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(_),this.dropListenKeys_=null)},e}(Ri),mf="preload",Cf="useInterimTilesOnError",vf=function(t){function e(e){var r=e||{},n=u({},r);delete n.preload,delete n.useInterimTilesOnError,t.call(this,n),this.setPreload(void 0!==r.preload?r.preload:0),this.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),this.type=yo.TILE}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPreload=function(){return this.get(mf)},e.prototype.setPreload=function(t){this.set(mf,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(Cf)},e.prototype.setUseInterimTilesOnError=function(t){this.set(Cf,t)},e}(Ci);vf.prototype.getSource;var Tf=vf,_f=function(t){function e(e){var r=e||{};t.call(this,r),this.type=yo.IMAGE}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ci);_f.prototype.getSource;var Sf=_f,Ef=function(t){function e(e){t.call(this,{attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.features=[],this.geometryFunction=e.geometryFunction||function(t){var e=t.getGeometry();return te(e.getType()==hr.POINT,10),e},this.source=e.source,C(this.source,R.CHANGE,this.refresh,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDistance=function(){return this.distance},e.prototype.getSource=function(){return this.source},e.prototype.loadFeatures=function(t,e,r){this.source.loadFeatures(t,e,r),e!==this.resolution&&(this.clear(),this.resolution=e,this.cluster(),this.addFeatures(this.features))},e.prototype.setDistance=function(t){this.distance=t,this.refresh()},e.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features),t.prototype.refresh.call(this)},e.prototype.cluster=function(){if(void 0!==this.resolution){this.features.length=0;for(var t=[1/0,1/0,-1/0,-1/0],e=this.distance*this.resolution,r=this.source.getFeatures(),n={},i=0,a=r.length;i<a;i++){var s=r[i];if(!(o(s)in n)){var l=this.geometryFunction(s);if(l){We(l.getCoordinates(),t),ke(t,e,t);var c=this.source.getFeaturesInExtent(t);c=c.filter(function(t){var e=o(t);return!(e in n||(n[e]=!0,0))}),this.features.push(this.createCluster(c))}}}}},e.prototype.createCluster=function(t){for(var e=[0,0],r=t.length-1;r>=0;--r){var n=this.geometryFunction(t[r]);n?ve(e,n.getCoordinates()):t.splice(r,1)}Ee(e,1/t.length);var i=new ds(new Pn(e));return i.set("features",t),i},e}(Hp),wf=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,fo.IDLE),this.src_=i,this.image_=new Image,null!==o&&(this.image_.crossOrigin=o),this.imageListenerKeys_=null,this.state=fo.IDLE,this.imageLoadFunction_=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=fo.ERROR,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=nr(this.extent)/this.image_.height),this.state=fo.LOADED,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=fo.IDLE&&this.state!=fo.ERROR||(this.state=fo.LOADING,this.changed(),this.imageListenerKeys_=[v(this.image_,R.ERROR,this.handleImageError_,this),v(this.image_,R.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},e.prototype.setImage=function(t){this.image_=t},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(po);function bf(t,e,r,n){var i=$r(r,e,t),o=qr(e,n,r),a=e.getMetersPerUnit();void 0!==a&&(o*=a);var s=t.getMetersPerUnit();void 0!==s&&(o/=s);var l=t.getExtent();if(!l||Fe(l,i)){var c=qr(t,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function Lf(t,e,r,n){var i=r-t,o=n-e,a=Math.sqrt(i*i+o*o);return[Math.round(r+i/a),Math.round(n+o/a)]}function Af(t,e,r,n,i,o,a,s,l,c,u){var h=$n(Math.round(r*t),Math.round(r*e));if(0===l.length)return h.canvas;h.scale(r,r);var d=[1/0,1/0,-1/0,-1/0];l.forEach(function(t,e,r){Ye(d,t.extent)});var p=sr(d),f=nr(d),g=$n(Math.round(r*p/n),Math.round(r*f/n)),y=r/n;l.forEach(function(t,e,r){var n=t.extent[0]-d[0],i=-(t.extent[3]-d[3]),o=sr(t.extent),a=nr(t.extent);g.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,n*y,i*y,o*y,a*y)});var m=or(a);return s.getTriangles().forEach(function(t,e,i){var a=t.source,s=t.target,l=a[0][0],c=a[0][1],u=a[1][0],p=a[1][1],f=a[2][0],y=a[2][1],C=(s[0][0]-m[0])/o,v=-(s[0][1]-m[1])/o,T=(s[1][0]-m[0])/o,_=-(s[1][1]-m[1])/o,S=(s[2][0]-m[0])/o,E=-(s[2][1]-m[1])/o,w=l,b=c;l=0,c=0;var L=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),o=r+1;o<e;o++){var a=Math.abs(t[o][r]);a>i&&(i=a,n=o)}if(0===i)return null;var s=t[n];t[n]=t[r],t[r]=s;for(var l=r+1;l<e;l++)for(var c=-t[l][r]/t[r][r],u=r;u<e+1;u++)r==u?t[l][u]=0:t[l][u]+=c*t[r][u]}for(var h=new Array(e),d=e-1;d>=0;d--){h[d]=t[d][e]/t[d][d];for(var p=d-1;p>=0;p--)t[p][e]-=t[p][d]*h[d]}return h}([[u-=w,p-=b,0,0,T-C],[f-=w,y-=b,0,0,S-C],[0,0,u,p,_-v],[0,0,f,y,E-v]]);if(L){h.save(),h.beginPath();var A=(C+T+S)/3,x=(v+_+E)/3,P=Lf(A,x,C,v),I=Lf(A,x,T,_),R=Lf(A,x,S,E);h.moveTo(I[0],I[1]),h.lineTo(P[0],P[1]),h.lineTo(R[0],R[1]),h.clip(),h.transform(L[0],L[2],L[1],L[3],C,v),h.translate(d[0]-w,d[3]-b),h.scale(n/r,-n/r),h.drawImage(g.canvas,0,0),h.restore()}}),u&&(h.save(),h.strokeStyle="black",h.lineWidth=1,s.getTriangles().forEach(function(t,e,r){var n=t.target,i=(n[0][0]-m[0])/o,a=-(n[0][1]-m[1])/o,s=(n[1][0]-m[0])/o,l=-(n[1][1]-m[1])/o,c=(n[2][0]-m[0])/o,u=-(n[2][1]-m[1])/o;h.beginPath(),h.moveTo(s,l),h.lineTo(i,a),h.lineTo(c,u),h.closePath(),h.stroke()}),h.restore()),h.canvas}var xf=function(t,e,r,n,i){this.sourceProj_=t,this.targetProj_=e;var o={},a=Kr(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&sr(n)==sr(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?sr(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?sr(this.targetProj_.getExtent()):null;var s=or(r),l=ar(r),c=Qe(r),u=Je(r),h=this.transformInv_(s),d=this.transformInv_(l),p=this.transformInv_(c),f=this.transformInv_(u);if(this.addQuad_(s,l,c,u,h,d,p,f,10),this.wrapsXInSource_){var g=1/0;this.triangles_.forEach(function(t,e,r){g=Math.min(g,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-g>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-g>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-g>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-g>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var r=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-r<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}o={}};xf.prototype.addTriangle_=function(t,e,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[t,e,r]})},xf.prototype.addQuad_=function(t,e,r,n,i,o,a,s,l){var c=Me([i,o,a,s]),u=this.sourceWorldWidth_?sr(c)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1,p=!1;if(l>0){this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=sr(Me([t,e,r,n]))/this.targetWorldWidth_>.25||p);!d&&this.sourceProj_.isGlobal()&&u&&(p=u>.25||p)}if(p||!this.maxSourceExtent_||lr(c,this.maxSourceExtent_)){if(!(p||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1]))){if(!(l>0))return;p=!0}if(l>0){if(!p){var f,g=[(t[0]+r[0])/2,(t[1]+r[1])/2],y=this.transformInv_(g);f=d?(ue(i[0],h)+ue(a[0],h))/2-ue(y[0],h):(i[0]+a[0])/2-y[0];var m=(i[1]+a[1])/2-y[1];p=f*f+m*m>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var C=[(e[0]+r[0])/2,(e[1]+r[1])/2],v=this.transformInv_(C),T=[(n[0]+t[0])/2,(n[1]+t[1])/2],_=this.transformInv_(T);this.addQuad_(t,e,C,T,i,o,v,_,l-1),this.addQuad_(T,C,r,n,_,v,a,s,l-1)}else{var S=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(S),w=[(r[0]+n[0])/2,(r[1]+n[1])/2],b=this.transformInv_(w);this.addQuad_(t,S,w,n,i,E,b,s,l-1),this.addQuad_(S,e,r,w,E,o,a,b,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,r,n,i,a,s),this.addTriangle_(t,e,r,i,o,a)}},xf.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,r,n){var i=e.source;ze(t,i[0]),ze(t,i[1]),ze(t,i[2])}),t},xf.prototype.getTriangles=function(){return this.triangles_};var Pf=xf,If=function(t){function e(e,r,n,i,o,a){var s=e.getExtent(),l=r.getExtent(),c=l?ir(n,l):n,u=bf(e,r,tr(c),i),h=new Pf(e,r,c,s,u*ho),d=a(h.calculateSourceExtent(),u,o),p=fo.LOADED;d&&(p=fo.IDLE);var f=d?d.getPixelRatio():1;t.call(this,n,i,f,p),this.targetProj_=r,this.maxSourceExtent_=s,this.triangulation_=h,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=d,this.sourcePixelRatio_=f,this.canvas_=null,this.sourceListenerKey_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==fo.LOADING&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==fo.LOADED){var e=sr(this.targetExtent_)/this.targetResolution_,r=nr(this.targetExtent_)/this.targetResolution_;this.canvas_=Af(e,r,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==fo.IDLE){this.state=fo.LOADING,this.changed();var t=this.sourceImage_.getState();t==fo.LOADED||t==fo.ERROR?this.reproject_():(this.sourceListenerKey_=C(this.sourceImage_,R.CHANGE,function(t){var e=this.sourceImage_.getState();e!=fo.LOADED&&e!=fo.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){_(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(po),Rf=function(t){function e(e,r){t.call(this,e),this.image=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function Of(t,e){t.getImage().src=e}var Mf=function(t){function e(e){t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state}),this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Dt(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,r,n){var i=this.getProjection();if(i&&n&&!Yr(i,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Yr(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Ve(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new If(i,n,t,e,r,function(t,e,r){return this.getImageInternal(t,e,r,i)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return i&&(n=i),this.getImageInternal(t,e,r,n)},e.prototype.getImageInternal=function(t,e,r,i){return n()},e.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case fo.LOADING:this.loading=!0,this.dispatchEvent(new Rf("imageloadstart",e));break;case fo.LOADED:this.loading=!1,this.dispatchEvent(new Rf("imageloadend",e));break;case fo.ERROR:this.loading=!1,this.dispatchEvent(new Rf("imageloaderror",e))}},e}(Gp);function kf(t,e){var r=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&r.push(t+"="+encodeURIComponent(e[t]))});var n=r.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+n}var Nf=[101,101],Df=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:r.projection,resolutions:r.resolutions}),this.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,this.url_=r.url,this.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:Of,this.params_=r.params||{},this.v13_=!0,this.updateV13_(),this.serverType_=r.serverType,this.hidpi_=void 0===r.hidpi||r.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==r.ratio?r.ratio:1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getGetFeatureInfoUrl=function(t,e,r,n){if(void 0!==this.url_){var i=jr(r),o=this.getProjection();o&&o!==i&&(e=bf(o,i,t,e),t=$r(t,i,o));var a=rr(t,e,0,Nf),s={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};u(s,this.params_,n);var l=Math.floor((t[0]-a[0])/e),c=Math.floor((a[3]-t[1])/e);return s[this.v13_?"I":"X"]=l,s[this.v13_?"J":"Y"]=c,this.getRequestUrl_(a,Nf,1,o||i,s)}},e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,r,n){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==r||this.hidpi_&&void 0!==this.serverType_||(r=1);var i=e/r,o=tr(t),a=rr(o,i,0,[Math.ceil(sr(t)/i),Math.ceil(nr(t)/i)]),s=rr(o,i,0,[Math.ceil(this.ratio_*sr(t)/i),Math.ceil(this.ratio_*nr(t)/i)]),l=this.image_;if(l&&this.renderedRevision_==this.getRevision()&&l.getResolution()==e&&l.getPixelRatio()==r&&Be(l.getExtent(),a))return l;var c={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};u(c,this.params_),this.imageSize_[0]=Math.round(sr(s)/i),this.imageSize_[1]=Math.round(nr(s)/i);var h=this.getRequestUrl_(s,this.imageSize_,r,n,c);return this.image_=new wf(s,e,r,h,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),C(this.image_,R.CHANGE,this.handleImageChange,this),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,r,n,i){if(te(void 0!==this.url_,9),i[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(i.STYLES=""),1!=r)switch(this.serverType_){case"geoserver":var o=90*r+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+o:i.FORMAT_OPTIONS="dpi:"+o;break;case"mapserver":i.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":i.DPI=90*r;break;default:te(!1,8)}i.WIDTH=e[0],i.HEIGHT=e[1];var a,s=n.getAxisOrientation();return a=this.v13_&&"ne"==s.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,i.BBOX=a.join(","),kf(this.url_,i)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){u(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},e.prototype.updateV13_=function(){var t=this.params_.VERSION||"1.3.0";this.v13_=function(t,e){for(var r=(""+t).split("."),n="1.3".split("."),i=0;i<Math.max(r.length,n.length);i++){var o=parseInt(r[i]||"0",10),a=parseInt(n[i]||"0",10);if(o>a)return 1;if(a>o)return-1}return 0}(t)>=0},e}(Mf);function Ff(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function Bf(t,e,r){return t+"/"+e+"/"+r}function Gf(t){return Bf(t[0],t[1],t[2])}function Uf(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){return a?t.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,function(){return(-a[2]-1).toString()}).replace(o,function(){var t=a[0],r=e.getFullTileRange(t);return te(r,55),(r.getHeight()+a[2]).toString()}):void 0}}function jf(t){return 1===t.length?t[0]:function(e,r,n){if(e){var i=ue(function(t){return(t[1]<<t[0])+t[2]}(e),t.length);return t[i](e,r,n)}}}function qf(t,e,r){}function Wf(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n,i=r[1].charCodeAt(0),o=r[2].charCodeAt(0);for(n=i;n<=o;++n)e.push(t.replace(r[0],String.fromCharCode(n)));return e}if(r=r=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}var Hf=function(t){function e(e,r,n){t.call(this);var i=n||{};this.tileCoord=e,this.state=r,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(R.CHANGE)},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Qt.LOADED)return t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==Qt.LOADED){t.interimTile=null;break}t.getState()==Qt.LOADING?e=t:t.getState()==Qt.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){this.state=t,this.changed()},e.prototype.load=function(){},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n=e-r+1e3/60;return n>=this.transition_?1:Ae(n/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(I);function Vf(){var t=$n(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}var Yf=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,a),this.crossOrigin_=i,this.src_=n,this.image_=new Image,null!==i&&(this.image_.crossOrigin=i),this.imageListenerKeys_=null,this.tileLoadFunction_=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==Qt.LOADING&&(this.unlistenImage_(),this.image_=Vf()),this.interimTile&&this.interimTile.dispose(),this.state=Qt.ABORT,this.changed(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.image_},e.prototype.getKey=function(){return this.src_},e.prototype.handleImageError_=function(){this.state=Qt.ERROR,this.unlistenImage_(),this.image_=Vf(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Qt.LOADED:this.state=Qt.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==Qt.ERROR&&(this.state=Qt.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Qt.IDLE&&(this.state=Qt.LOADING,this.changed(),this.imageListenerKeys_=[v(this.image_,R.ERROR,this.handleImageError_,this),v(this.image_,R.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(Hf),zf=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast(),r=e.tileCoord[0].toString();if(r in t&&t[r].contains(e.tileCoord))break;this.pop().dispose()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(Gf(e.tileCoord)),e.dispose())},this)}},e}(vo),Kf=function(t){function e(e,r,n,i,o,a,s,l,c,u,h){t.call(this,o,Qt.IDLE),this.renderEdges_=void 0!==h&&h,this.pixelRatio_=s,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=a||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;var d=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),f=this.sourceTileGrid_.getExtent(),g=p?ir(d,p):d;if(0!==Ze(g)){var y=e.getExtent();y&&(f=f?ir(f,y):y);var m=i.getResolution(this.wrappedTileCoord_[0]),C=bf(e,n,tr(g),m);if(!isFinite(C)||C<=0)this.state=Qt.EMPTY;else{var v=void 0!==u?u:ho;if(this.triangulation_=new Pf(e,n,g,f,C*v),0!==this.triangulation_.getTriangles().length){this.sourceZ_=r.getZForResolution(C);var T=this.triangulation_.calculateSourceExtent();if(f&&(e.canWrapX()?(T[1]=oe(T[1],f[1],f[3]),T[3]=oe(T[3],f[1],f[3])):T=ir(T,f)),Ze(T)){for(var _=r.getTileRangeForExtentAndZ(T,this.sourceZ_),S=_.minX;S<=_.maxX;S++)for(var E=_.minY;E<=_.maxY;E++){var w=c(this.sourceZ_,S,E,s);w&&this.sourceTiles_.push(w)}0===this.sourceTiles_.length&&(this.state=Qt.EMPTY)}else this.state=Qt.EMPTY}else this.state=Qt.EMPTY}}else this.state=Qt.EMPTY}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==Qt.LOADING&&this.unlistenSources_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,n){e&&e.getState()==Qt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=Qt.ERROR;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Af(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,t,this.gutter_,this.renderEdges_),this.state=Qt.LOADED}this.changed()},e.prototype.load=function(){if(this.state==Qt.IDLE){this.state=Qt.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,n){var i=e.getState();if(i==Qt.IDLE||i==Qt.LOADING){t++;var o=C(e,R.CHANGE,function(r){var n=e.getState();n!=Qt.LOADED&&n!=Qt.ERROR&&n!=Qt.EMPTY||(_(o),0==--t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach(function(t,e,r){t.getState()==Qt.IDLE&&t.load()}),0===t&&setTimeout(this.reproject_.bind(this),0)}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(_),this.sourcesListenerKeys_=null},e}(Hf),$f=[0,0,0],Xf=function(t){var e,r,n;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,te((e=this.resolutions_,!0,r=function(t,e){return e-t}||kt,e.every(function(t,n){if(0===n)return!0;var i=r(e[n-1],t);return!(i>0||0===i)})),17),!t.origins)for(var i=0,o=this.resolutions_.length-1;i<o;++i)if(n){if(this.resolutions_[i]/this.resolutions_[i+1]!==n){n=void 0;break}}else n=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,te(this.origins_.length==this.resolutions_.length,20));var a=t.extent;void 0===a||this.origin_||this.origins_||(this.origin_=or(a)),te(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,te(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:ie,te(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==a?a:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new sa(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):a&&this.calculateTileRanges_(a)};Xf.prototype.forEachTileCoord=function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),i=n.minX,o=n.maxX;i<=o;++i)for(var a=n.minY,s=n.maxY;a<=s;++a)r([e,i,a])},Xf.prototype.forEachTileCoordParentTileRange=function(t,e,r,n,i){var o,a,s,l=null,c=t[0]-1;for(2===this.zoomFactor_?(a=t[1],s=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(o=2===this.zoomFactor_?aa(a=Math.floor(a/2),a,s=Math.floor(s/2),s,n):this.getTileRangeForExtentAndZ(l,c,n),e.call(r,c,o))return!0;--c}return!1},Xf.prototype.getExtent=function(){return this.extent_},Xf.prototype.getMaxZoom=function(){return this.maxZoom},Xf.prototype.getMinZoom=function(){return this.minZoom},Xf.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},Xf.prototype.getResolution=function(t){return this.resolutions_[t]},Xf.prototype.getResolutions=function(){return this.resolutions_},Xf.prototype.getTileCoordChildTileRange=function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],i=2*t[2];return aa(n,n+1,i,i+1,e)}var o=this.getTileCoordExtent(t,r);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},Xf.prototype.getTileRangeExtent=function(t,e,r){var n=this.getOrigin(t),i=this.getResolution(t),o=ai(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*i,s=n[0]+(e.maxX+1)*o[0]*i;return je(a,n[1]+e.minY*o[1]*i,s,n[1]+(e.maxY+1)*o[1]*i,r)},Xf.prototype.getTileRangeForExtentAndZ=function(t,e,r){var n=$f;this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n);var i=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[3],e,!0,n),aa(i,n[1],o,n[2],r)},Xf.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=ai(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]+(t[2]+.5)*n[1]*r]},Xf.prototype.getTileCoordExtent=function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=ai(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*i[0]*n,a=r[1]+t[2]*i[1]*n;return je(o,a,o+i[0]*n,a+i[1]*n,e)},Xf.prototype.getTileCoordForCoordAndResolution=function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)},Xf.prototype.getTileCoordForXYAndResolution_=function(t,e,r,n,i){var o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),l=ai(this.getTileSize(o),this.tmpSize_),c=n?.5:0,u=n?0:.5,h=Math.floor((t-s[0])/r+c),d=Math.floor((e-s[1])/r+u),p=a*h/l[0],f=a*d/l[1];return n?(p=Math.ceil(p)-1,f=Math.ceil(f)-1):(p=Math.floor(p),f=Math.floor(f)),Ff(o,p,f,i)},Xf.prototype.getTileCoordForXYAndZ_=function(t,e,r,n,i){var o=this.getOrigin(r),a=this.getResolution(r),s=ai(this.getTileSize(r),this.tmpSize_),l=n?.5:0,c=n?0:.5,u=Math.floor((t-o[0])/a+l),h=Math.floor((e-o[1])/a+c),d=u/s[0],p=h/s[1];return n?(d=Math.ceil(d)-1,p=Math.ceil(p)-1):(d=Math.floor(d),p=Math.floor(p)),Ff(r,d,p,i)},Xf.prototype.getTileCoordForCoordAndZ=function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)},Xf.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},Xf.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},Xf.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},Xf.prototype.getZForResolution=function(t,e){return oe(Dt(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},Xf.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r};var Zf=Xf;function Jf(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,r,n){return function(t,e,r,n){var i=Re.TOP_LEFT,o=function(t,e,r){for(var n=void 0!==e?e:ne,i=nr(t),o=sr(t),a=ai(void 0!==r?r:ie),s=Math.max(o/a[0],i/a[1]),l=n+1,c=new Array(l),u=0;u<l;++u)c[u]=s/Math.pow(2,u);return c}(t,void 0,r);return new Zf({extent:t,origin:er(t,i),resolutions:o,tileSize:r})}(Qf(t),0,void 0)}(t),t.setDefaultTileGrid(e)),e}function Qf(t){var e=(t=jr(t)).getExtent();if(!e){var r=180*mr[Cr.DEGREES]/t.getMetersPerUnit();e=je(-r,-r,r,r)}return e}var tg=function(t){function e(e){t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX}),this.opaque_=void 0!==e.opaque&&e.opaque,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null,this.tileCache=new zf(e.cacheSize),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,r,n){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var o,a,s,l=!0,c=r.minX;c<=r.maxX;++c)for(var u=r.minY;u<=r.maxY;++u)a=Bf(e,c,u),s=!1,i.containsKey(a)&&(s=(o=i.get(a)).getState()===Qt.LOADED)&&(s=!1!==n(o)),s||(l=!1);return l},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,e,r,i,o){return n()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Jf(t)},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!Yr(e,t)?null:this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,r){var n,i,o,a=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),l=ai(a.getTileSize(t),this.tmpSize);return 1==s?l:(n=l,i=s,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*i+.5|0,o[1]=n[1]*i+.5|0,o)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n=e[0],i=t.getTileCoordCenter(e),o=Qf(r);if(Fe(o,i))return e;var a=sr(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,t.getTileCoordForCoordAndZ(i,n)}(n,t,r)),function(t,e){var r=t[0],n=t[1],i=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var o,a=e.getExtent();return!(o=a?e.getTileRangeForExtentAndZ(a,r):e.getFullTileRange(r))||o.containsXY(n,i)}(t,n)?t:null},e.prototype.refresh=function(){this.tileCache.clear(),this.changed()},e.prototype.useTile=function(t,e,r,n){},e}(Gp),eg=function(t){function e(e,r){t.call(this,e),this.tile=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),rg={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function ng(t,e){t.getImage().src=e}var ig=function(t){function e(e){t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ng,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:Yf,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);for(var n in this.tileCache.expireCache(this.tileCache==r?e:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[n];i.expireCache(i==r?e:{})}},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Yr(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Yr(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Yr(e,t)){var r=o(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=Jf(t)),this.tileGridForProjection[r]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Yr(e,t))return this.tileCache;var r=o(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new zf(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},e.prototype.createTile_=function(t,e,r,n,i,o){var a=[t,e,r],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,n,i):void 0,c=new this.tileClass(a,void 0!==l?Qt.IDLE:Qt.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,C(c,R.CHANGE,this.handleTileChange,this),c},e.prototype.getTile=function(t,e,r,n,i){var o=this.getProjection();if(o&&i&&!Yr(o,i)){var a,s=this.getTileCacheForProjection(i),l=[t,e,r],c=Gf(l);s.containsKey(c)&&(a=s.get(c));var u=this.getKey();if(a&&a.key==u)return a;var h=this.getTileGridForProjection(o),d=this.getTileGridForProjection(i),p=this.getTileCoordForTileUrlFunction(l,i),f=new Kf(o,h,i,d,l,p,this.getTilePixelRatio(n),this.getGutter(),function(t,e,r,n){return this.getTileInternal(t,e,r,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return f.key=u,a?(f.interimTile=a,f.refreshInterimChain(),s.replace(c,f)):s.set(c,f),f}return this.getTileInternal(t,e,r,n,o||i)},e.prototype.getTileInternal=function(t,e,r,n,i){var o=null,a=Bf(t,e,r),s=this.getKey();if(this.tileCache.containsKey(a)){if((o=this.tileCache.get(a)).key!=s){var l=o;o=this.createTile_(t,e,r,n,i,s),l.getState()==Qt.IDLE?o.interimTile=l.interimTile:o.interimTile=l,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,r,n,i,s),this.tileCache.set(a,o);return o},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var r=jr(t);if(r){var n=o(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}},e}(function(t){function e(e){t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.generateTileUrlFunction_=!e.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,this.tileUrlFunction=e.tileUrlFunction?e.tileUrlFunction.bind(this):qf,this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction,this.key_),this.tileLoadingKeys_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,r=t.target,n=o(r),i=r.getState();i==Qt.LOADING?(this.tileLoadingKeys_[n]=!0,e=rg.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==Qt.ERROR?rg.TILELOADERROR:i==Qt.LOADED||i==Qt.ABORT?rg.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new eg(e,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=this.urls=Wf(t);this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=Uf(t[i],e);return jf(n)}(t,this.tileGrid),e):this.setKey(e)},e.prototype.useTile=function(t,e,r){var n=Bf(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},e}(tg)),og={KVP:"KVP",REST:"REST"},ag=function(t){function e(e){t.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getMatrixId=function(t){return this.matrixIds_[t]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}(Zf),sg=function(t){function e(e){var r=void 0!==e.requestEncoding?e.requestEncoding:og.KVP,n=e.tileGrid,i=e.urls;void 0===i&&void 0!==e.url&&(i=Wf(e.url)),t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:qf,urls:i,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=r,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=jf(i.map(lg.bind(this))))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction(jf(t.map(lg.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var r in this.dimensions_)e[t++]=r+"-"+this.dimensions_[r];return e.join("/")},e.prototype.updateDimensions=function(t){u(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e}(ig);function lg(t){var e=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e==og.KVP&&u(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e==og.KVP?kf(t,r):t.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in r?r[e.toLowerCase()]:t});var n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(r){var s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:-r[2]-1};u(s,i);var l=t;return e==og.KVP?kf(l,s):l.replace(/\{(\w+?)\}/g,function(t,e){return s[e]})}}}var cg=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:r.projection,resolutions:r.resolutions,state:r.state}),this.canvasFunction_=r.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==r.ratio?r.ratio:1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImageInternal=function(t,e,r,n){e=this.findNearestResolution(e);var i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==e&&i.getPixelRatio()==r&&Be(i.getExtent(),t))return i;ur(t=t.slice(),this.ratio_);var o=[sr(t)/e*r,nr(t)/e*r],a=this.canvasFunction_.call(this,t,e,r,o,n);return a&&(i=new go(t,e,r,a)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i},e}(Mf);r.d(e,"array",function(){return ug}),r.d(e,"asserts",function(){return hg}),r.d(e,"color",function(){return dg}),r.d(e,"math",function(){return pg}),r.d(e,"string",function(){return fg}),r.d(e,"control",function(){return gg}),r.d(e,"events",function(){return yg}),r.d(e,"extent",function(){return mg}),r.d(e,"geom",function(){return Cg}),r.d(e,"featureloader",function(){return vg}),r.d(e,"format",function(){return Tg}),r.d(e,"interaction",function(){return _g}),r.d(e,"layer",function(){return Sg}),r.d(e,"Observable",function(){return Eg}),r.d(e,"Object",function(){return wg}),r.d(e,"proj",function(){return bg}),r.d(e,"render",function(){return Lg}),r.d(e,"source",function(){return Ag}),r.d(e,"style",function(){return xg}),r.d(e,"xml",function(){return Pg}),r.d(e,"VERSION",function(){return a}),r.d(e,"Map",function(){return Xa}),r.d(e,"View",function(){return Kn}),r.d(e,"Overlay",function(){return Qa}),r.d(e,"OverlayPositioning",function(){return Za}),r.d(e,"Feature",function(){return ds}),r.d(e,"Collection",function(){return G}),r.d(e,"MapEventType",function(){return Xt}),r.d(e,"MapBrowserEventType",function(){return J}),r.d(e,"Image",function(){return wf}),ds.createStyleFunction=hs;const ug={};ug.extend=Bt,ug.includes=Nt;const hg={};hg.assert=te;const dg={};dg.asArray=jo,dg.asString=Go;const pg={};pg.toRadians=ce;const fg={};fg.padNumber=Ce;const gg={};gg.OverviewMap=es,gg.ScaleLine=as,gg.Zoom=Ei,gg.ZoomSlider=cs,gg.ZoomSlider.render=ls,gg.ZoomToExtent=us;const yg={};yg.EventType=R,yg.listen=C,yg.unlisten=T,yg.condition={shiftKeyOnly:Wi};const mg={};mg.getWidth=sr,mg.getHeight=nr,mg.containsCoordinate=Fe,mg.containsExtent=Be,mg.buffer=ke,mg.boundingExtent=Me;const Cg={};Cg.Point=Pn,Cg.MultiPoint=ps,Cg.LineString=ys,Cg.MultiLineString=ms,Cg.Polygon=Wn,Cg.MultiPolygon=Cs,Cg.GeometryCollection=Ss,Cg.Circle=Ts,Cg.GeometryType=hr,Cg.GeometryLayout=dr,Cg.flat={deflateCoordinates:vn,inflateCoordinates:_n,linearRingLength:function(t,e,r,n){var i=ga(t,e,r,n),o=t[r-n]-t[e],a=t[r-n+1]-t[e+1];return i+Math.sqrt(o*o+a*a)}};const vg={};vg.xhr=ws;const Tg={};Tg.Feature=ds,Tg.Feature.transformWithOptions=As,Tg.GeoJSON=Os,Tg.GMLBase=il,Tg.GML=El,Tg.GML2=Lh,Tg.GML3=_l,Tg.GML32=Mp,Tg.GPX=ic,Tg.KML=Sh,Tg.WFS=td,Tg.WKT=yd,Tg.WMSCapabilities=Hd,Tg.WMSGetFeatureInfo=Vd,Tg.WMTSCapabilities=wp,Tg.TopoJSON=Rp,Tg.xsd={readDecimal:ll,readBoolean:ol,readString:dl,readNonNegativeInteger:ul,readDateTime:sl,writeStringTextNode:ml,writeCDATASection:fl,writeDecimalTextNode:gl,writeBooleanTextNode:pl,writeNonNegativeIntegerTextNode:yl};const _g={};_g.defaults=uo,_g.Draw=Kp,_g.Pointer=Ki,_g.Translate=Xp,_g.Snap=Jp,_g.Select=nf,_g.Modify=df,_g.DragAndDrop=yf,_g.DoubleClickZoom=Mi;const Sg={};Sg.Layer=Ci,Sg.Tile=Tf,Sg.Image=Sf,Sg.Vector=Dp;const Eg={unByKey:function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)_(t[e]);else _(t)}},wg={};wg.getChangeEventType=N;const bg={};bg.METERS_PER_UNIT=mr,bg.Projection=Tr,bg.addEquivalentProjections=Wr,bg.get=jr,bg.transform=$r,bg.transformExtent=Xr,bg.getTransform=Kr,bg.Units=Cr,bg.proj4={register:function(t){var e,r,n,i,o,a,s,l,c=Object.keys(t.defs),u=c.length;for(e=0;e<u;++e){var h=c[e];if(!jr(h)){var d=t.defs(h);Ur(new Tr({code:h,axisOrientation:d.axis,metersPerUnit:d.to_meter,units:d.units}))}}for(e=0;e<u;++e){var p=c[e],f=jr(p);for(r=0;r<u;++r){var g=c[r],y=jr(g);if(!Fr(p,g))if(t.defs[p]===t.defs[g])Wr([f,y]);else{var m=t(p,g);n=f,i=y,o=m.forward,a=m.inverse,void 0,void 0,Dr(s=jr(n),l=jr(i),Vr(o)),Dr(l,s,Vr(a))}}}}},bg.EPSG4326={METERS_PER_UNIT:Rr,PROJECTIONS:Mr};const Lg={toContext:function(t,e){var r=t.canvas,n=e||{},i=n.pixelRatio||z,o=n.size;o&&(r.width=o[0]*i,r.height=o[1]*i,r.style.width=o[0]+"px",r.style.height=o[1]+"px");var a=[0,0,r.width,r.height],s=nn([1,0,0,1,0,0],i,i);return new zo(t,i,a,s,0)}};Lg.EventType=Jt;const Ag={};Ag.Vector=Hp,Ag.Cluster=Ef,Ag.ImageWMS=Df,Ag.WMTS=sg,Ag.WMTS.optionsFromCapabilities=function(t,e){var r=Gt(t.Contents.Layer,function(t,r,n){return t.Identifier==e.layer});if(null===r)return null;var n,i=t.Contents.TileMatrixSet;(n=r.TileMatrixSetLink.length>1?jt(r.TileMatrixSetLink,"projection"in e?function(t,r,n){var o=Gt(i,function(e){return e.Identifier==t.TileMatrixSet}).SupportedCRS,a=jr(o.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(o),s=jr(e.projection);return a&&s?Yr(a,s):o==e.projection}:function(t,r,n){return t.TileMatrixSet==e.matrixSet}):0)<0&&(n=0);var o=r.TileMatrixSetLink[n].TileMatrixSet,a=r.TileMatrixSetLink[n].TileMatrixSetLimits,s=r.Format[0];"format"in e&&(s=e.format),(n=jt(r.Style,function(t,r,n){return"style"in e?t.Title==e.style:t.isDefault}))<0&&(n=0);var l=r.Style[n].Identifier,c={};"Dimension"in r&&r.Dimension.forEach(function(t,e,r){var n=t.Identifier,i=t.Default;void 0===i&&(i=t.Value[0]),c[n]=i});var u,h=Gt(t.Contents.TileMatrixSet,function(t,e,r){return t.Identifier==o}),d=h.SupportedCRS;if(d&&(u=jr(d.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(d)),"projection"in e){var p=jr(e.projection);p&&(u&&!Yr(p,u)||(u=p))}var f,g,y=r.WGS84BoundingBox;if(void 0!==y){var m=jr("EPSG:4326").getExtent();g=y[0]==m[0]&&y[2]==m[2],f=Xr(y,"EPSG:4326",u);var C=u.getExtent();C&&(Be(C,f)||(f=void 0))}var v=function(t,e,r){var n=[],i=[],o=[],a=[],s=[],l=void 0!==r?r:[],c=t.SupportedCRS,u=jr(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(c),h=u.getMetersPerUnit(),d="ne"==u.getAxisOrientation().substr(0,2);return t.TileMatrix.sort(function(t,e){return e.ScaleDenominator-t.ScaleDenominator}),t.TileMatrix.forEach(function(e){if(!(l.length>0)||Gt(l,function(r){return e.Identifier==r.TileMatrix||-1===e.Identifier.indexOf(":")&&t.Identifier+":"+e.Identifier===r.TileMatrix})){i.push(e.Identifier);var r=28e-5*e.ScaleDenominator/h,c=e.TileWidth,u=e.TileHeight;d?o.push([e.TopLeftCorner[1],e.TopLeftCorner[0]]):o.push(e.TopLeftCorner),n.push(r),a.push(c==u?c:[c,u]),s.push([e.MatrixWidth,-e.MatrixHeight])}}),new ag({extent:e,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}(h,f,a),T=[],_=e.requestEncoding;if(_=void 0!==_?_:"","OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var S=t.OperationsMetadata.GetTile.DCP.HTTP.Get,E=0,w=S.length;E<w;++E)if(S[E].Constraint){var b=Gt(S[E].Constraint,function(t){return"GetEncoding"==t.name}).AllowedValues.Value;if(""===_&&(_=b[0]),_!==og.KVP)break;Nt(b,og.KVP)&&T.push(S[E].href)}else S[E].href&&(_=og.KVP,T.push(S[E].href));return 0===T.length&&(_=og.REST,r.ResourceURL.forEach(function(t){"tile"===t.resourceType&&(s=t.format,T.push(t.template))})),{urls:T,layer:e.layer,matrixSet:o,format:s,projection:u,requestEncoding:_,tileGrid:v,style:l,dimensions:c,wrapX:g,crossOrigin:e.crossOrigin}},Ag.TileEventType=rg,Ag.VectorEventType=Up,Ag.ImageCanvas=cg,Ag.Image={defaultImageLoadFunction:Of};const xg={};xg.Style=Sc,xg.RegularShape=gc,xg.Circle=yc,xg.Fill=ac,xg.Icon=dc,xg.Stroke=fc,xg.Style=Sc,xg.Text=Mc,xg.IconAnchorUnits=sc,xg.IconOrigin=cc;const Pg={};Pg.parse=Bs,Pg.parseNode=Xs,Pg.createElementNS=Ns,Pg.pushParseAndPop=Zs,Pg.pushSerializeAndPop=Qs,Pg.makeStructureNS=$s,Pg.getAllTextContent=Ds,Pg.makeChildAppender=Hs,Pg.makeReplacer=js,Pg.makeSequence=Ks,Pg.makeArrayPusher=Us,Pg.makeArrayExtender=Gs,Pg.makeArraySerializer=Vs,Pg.makeObjectPropertySetter=Ws,Pg.makeSimpleNodeFactory=Ys,Pg.OBJECT_PROPERTY_NODE_FACTORY=zs,Pg.XML_SCHEMA_INSTANCE_URI=ks,Pg.DOCUMENT=Ms}]),TC=TC||{},QRCode;TC.UI=TC.UI||{};!function(){var t=function(t){return"[object Object]"===Object.prototype.toString.call(t)},e=function(){var t={},r=!1,n=0;if("[object Boolean]"===Object.prototype.toString.call(arguments[0])){r=arguments[0];n++}for(var i=function(n){for(var i in n)n.hasOwnProperty(i)&&(r&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=e(t[i],n[i]):t[i]=n[i])};n<arguments.length;n++)i(arguments[n]);return t},r=function(e,r,i){var o=[];if(r)if(i.buildHTML)i.target.innerHTML=i.buildHTML({results:r});else{for(var a=0;a<r.length;a++){var s=r[a];t(s)?o[o.length]='<li><a href="'+i.link+encodeURIComponent(s.id)+'">'+s.label+"</a></li>":o[o.length]='<li><a href="'+i.link+encodeURIComponent(s)+'">'+s+"</a></li>"}var l=document.createElement("template");l.innerHTML=o.join("");i.target.appendChild(l.content?l.content.firstChild:l.firstChild)}null!==i.callback&&"function"==typeof i.callback&&n(i);e.value.length>0?e.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")):e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},n=function(t){t.target.querySelectorAll("li a").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})})},i=function(t,e){e.innerHTML="";t.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},o=function(e){var n,o,a,s,l=e.target,c=l.getAttribute("id"),u=l.getAttribute("autocomplete");if(u){var h=this.settings,d=u.openXHR;if((n=l.value).length<h.minLength)i(l,h.target);else if(Array.isArray(h.source)){o=h.source.sort().filter(function(e){s=h.matchFromStart?new RegExp("^"+n,"i"):new RegExp(n,"i");a=t(e)?e.label:e;return s.test(a)});r(l,o,h)}else if("function"==typeof h.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;h.source(n,function(t){r(l,t,h)})}else{const t=function(t){if(h.cancelRequests){d[c]?d[c].abort():h.target.innerHTML='<li><a href="#">Searching...</a></li>';d[c]=t}},e=function(){h.cancelRequests&&(d[c]=null)};var p=new XMLHttpRequest;p.overrideMimeType("application/json");p.open("GET",url,!0);p.onload=function(){e();var t=JSON.parse(req.responseText);r(l,t,h)};p.onerror=function(t){e()};t(p);p.send(null)}}},a={init:function(t){var r=this,n={settings:null};n.settings=e({},n.defaults,t);r.setAttribute("autocomplete",!0);var a=n.settings;r.removeEventListener("keyup",o);r.addEventListener("keyup",o);r.parentNode.querySelector(".ui-input-clear")&&r.parentNode.querySelector(".ui-input-clear").addEventListener("click",function(t){i(r,a.target)});return r},update:function(t,r){this.getAttribute("autocomplete")&&(this.settings=e(this.settings,r));return this},clear:function(t){this.getAttribute("autocomplete")&&i(this,this.settings.target);return this},destroy:function(){if(this.getAttribute("autocomplete")){i(this,this.settings.target);this.removeAttribute("autocomplete");this.removeEventListener("keyup",o)}return this}};TC.UI.autocomplete=function(t){if(a[t])return a[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof t||!t){this.settings=arguments[0];return a.init.apply(this,arguments)}}}();!function(t,e){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("jquery")):t.jQueryBridget=e(t,t.jQuery)}(window,function(t,e){"use strict";var r=Array.prototype.slice,n=t.console,i=void 0===n?function(){}:function(t){n.error(t)};function o(n,o,s){(s=s||e||t.jQuery)&&(o.prototype.option||(o.prototype.option=function(t){s.isPlainObject(t)&&(this.options=s.extend(!0,this.options,t))}),s.fn[n]=function(t){if("string"==typeof t){var e=r.call(arguments,1);return c=e,h="$()."+n+'("'+(l=t)+'")',(a=this).each(function(t,e){var r=s.data(e,n);if(r){var o=r[l];if(o&&"_"!=l.charAt(0)){var a=o.apply(r,c);u=void 0===u?a:u}else i(h+" is not a valid method")}else i(n+" not initialized. Cannot call methods, i.e. "+h)}),void 0!==u?u:a}var a,l,c,u,h,d;return d=t,this.each(function(t,e){var r=s.data(e,n);r?(r.option(d),r._init()):(r=new o(e,d),s.data(e,n,r))}),this},a(s))}function a(t){!t||t&&t.bridget||(t.bridget=o)}return a(e||t.jQuery),o}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return e()}):"object"==typeof module&&module.exports?module.exports=e():t.getSize=e()}(window,function(){"use strict";function t(t){var e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}var e="undefined"==typeof console?function(){}:function(t){console.error(t)},r=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n=r.length;function i(t){var r=getComputedStyle(t);return r||e("Style returned "+r+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),r}var o,a=!1;return function e(s){if(function(){if(!a){a=!0;var r=document.createElement("div");r.style.width="200px",r.style.padding="1px 2px 3px 4px",r.style.borderStyle="solid",r.style.borderWidth="1px 2px 3px 4px",r.style.boxSizing="border-box";var n=document.body||document.documentElement;n.appendChild(r);var s=i(r);e.isBoxSizeOuter=o=200==t(s.width),n.removeChild(r)}}(),"string"==typeof s&&(s=document.querySelector(s)),s&&"object"==typeof s&&s.nodeType){var l=i(s);if("none"==l.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<n;e++)t[r[e]]=0;return t}();var c={};c.width=s.offsetWidth,c.height=s.offsetHeight;for(var u=c.isBorderBox="border-box"==l.boxSizing,h=0;h<n;h++){var d=r[h],p=l[d],f=parseFloat(p);c[d]=isNaN(f)?0:f}var g=c.paddingLeft+c.paddingRight,y=c.paddingTop+c.paddingBottom,m=c.marginLeft+c.marginRight,C=c.marginTop+c.marginBottom,v=c.borderLeftWidth+c.borderRightWidth,T=c.borderTopWidth+c.borderBottomWidth,_=u&&o,S=t(l.width);!1!==S&&(c.width=S+(_?0:g+v));var E=t(l.height);return!1!==E&&(c.height=E+(_?0:y+T)),c.innerWidth=c.width-(g+v),c.innerHeight=c.height-(y+T),c.outerWidth=c.width+m,c.outerHeight=c.height+C,c}}}),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var r=this._events=this._events||{},n=r[t]=r[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var r=this._onceEvents=this._onceEvents||{};return(r[t]=r[t]||{})[e]=!0,this}},e.off=function(t,e){var r=this._events&&this._events[t];if(r&&r.length){var n=r.indexOf(e);return-1!=n&&r.splice(n,1),this}},e.emitEvent=function(t,e){var r=this._events&&this._events[t];if(r&&r.length){r=r.slice(0),e=e||[];for(var n=this._onceEvents&&this._onceEvents[t],i=0;i<r.length;i++){var o=r[i];n&&n[o]&&(this.off(t,o),delete n[o]),o.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t}),function(t,e){"function"==typeof define&&define.amd?define("unipointer/unipointer",["ev-emitter/ev-emitter"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.Unipointer=e(t,t.EvEmitter)}(window,function(t,e){function r(){}var n=r.prototype=Object.create(e.prototype);n.bindStartEvent=function(t){this._bindStartEvent(t,!0)},n.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},n._bindStartEvent=function(e,r){var n=(r=void 0===r||r)?"addEventListener":"removeEventListener",i="mousedown";t.PointerEvent?i="pointerdown":"ontouchstart"in t&&(i="touchstart"),e[n](i,this)},n.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.getTouch=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.identifier==this.pointerIdentifier)return r}},n.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this._pointerDown(t,t)},n.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},n.onpointerdown=function(t){this._pointerDown(t,t)},n._pointerDown=function(t,e){t.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDown(t,e))},n.pointerDown=function(t,e){this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e])};var i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return n._bindPostStartEvents=function(e){if(e){var r=i[e.type];r.forEach(function(e){t.addEventListener(e,this)},this),this._boundPointerEvents=r}},n._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(e){t.removeEventListener(e,this)},this),delete this._boundPointerEvents)},n.onmousemove=function(t){this._pointerMove(t,t)},n.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},n.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerMove(t,e)},n._pointerMove=function(t,e){this.pointerMove(t,e)},n.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])},n.onmouseup=function(t){this._pointerUp(t,t)},n.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},n.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerUp(t,e)},n._pointerUp=function(t,e){this._pointerDone(),this.pointerUp(t,e)},n.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])},n._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},n._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},n.pointerDone=function(){},n.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},n.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerCancel(t,e)},n._pointerCancel=function(t,e){this._pointerDone(),this.pointerCancel(t,e)},n.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])},r.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},r}),function(t,e){"function"==typeof define&&define.amd?define("unidragger/unidragger",["unipointer/unipointer"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("unipointer")):t.Unidragger=e(t,t.Unipointer)}(window,function(t,e){function r(){}var n=r.prototype=Object.create(e.prototype);n.bindHandles=function(){this._bindHandles(!0)},n.unbindHandles=function(){this._bindHandles(!1)},n._bindHandles=function(e){for(var r=(e=void 0===e||e)?"addEventListener":"removeEventListener",n=e?this._touchActionValue:"",i=0;i<this.handles.length;i++){var o=this.handles[i];this._bindStartEvent(o,e),o[r]("click",this),t.PointerEvent&&(o.style.touchAction=n)}},n._touchActionValue="none",n.pointerDown=function(t,e){this.okayPointerDown(t)&&(this.pointerDownPointer=e,t.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e]))};var i={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},o={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return n.okayPointerDown=function(t){var e=i[t.target.nodeName],r=o[t.target.type],n=!e||r;return n||this._pointerReset(),n},n.pointerDownBlur=function(){var t=document.activeElement;t&&t.blur&&t!=document.body&&t.blur()},n.pointerMove=function(t,e){var r=this._dragPointerMove(t,e);this.emitEvent("pointerMove",[t,e,r]),this._dragMove(t,e,r)},n._dragPointerMove=function(t,e){var r={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this._dragStart(t,e),r},n.hasDragStarted=function(t){return 3<Math.abs(t.x)||3<Math.abs(t.y)},n.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e]),this._dragPointerUp(t,e)},n._dragPointerUp=function(t,e){this.isDragging?this._dragEnd(t,e):this._staticClick(t,e)},n._dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(t,e)},n.dragStart=function(t,e){this.emitEvent("dragStart",[t,e])},n._dragMove=function(t,e,r){this.isDragging&&this.dragMove(t,e,r)},n.dragMove=function(t,e,r){t.preventDefault(),this.emitEvent("dragMove",[t,e,r])},n._dragEnd=function(t,e){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(t,e)},n.dragEnd=function(t,e){this.emitEvent("dragEnd",[t,e])},n.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},n._staticClick=function(t,e){this.isIgnoringMouseUp&&"mouseup"==t.type||(this.staticClick(t,e),"mouseup"!=t.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},n.staticClick=function(t,e){this.emitEvent("staticClick",[t,e])},r.getPointerPoint=e.getPointerPoint,r}),function(t,e){"function"==typeof define&&define.amd?define(["get-size/get-size","unidragger/unidragger"],function(r,n){return e(t,r,n)}):"object"==typeof module&&module.exports?module.exports=e(t,require("get-size"),require("unidragger")):t.Draggabilly=e(t,t.getSize,t.Unidragger)}(window,function(t,e,r){function n(t,e){for(var r in e)t[r]=e[r];return t}var i=t.jQuery;function o(t,e){this.element="string"==typeof t?document.querySelector(t):t,i&&(this.$element=i(this.element)),this.options=n({},this.constructor.defaults),this.option(e),this._create()}var a=o.prototype=Object.create(r.prototype);o.defaults={},a.option=function(t){n(this.options,t)};var s={relative:!0,absolute:!0,fixed:!0};function l(t,e,r){return r=r||"round",e?Math[r](t/e)*e:t}return a._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=n({},this.position);var t=getComputedStyle(this.element);s[t.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},a.dispatchEvent=function(t,e,r){var n=[e].concat(r);this.emitEvent(t,n),this.dispatchJQueryEvent(t,e,r)},a.dispatchJQueryEvent=function(e,r,n){var i=t.jQuery;if(i&&this.$element){var o=i.Event(r);o.type=e,this.$element.trigger(o,n)}},a._getPosition=function(){var t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,"width"),r=this._getPositionCoord(t.top,"height");this.position.x=isNaN(e)?0:e,this.position.y=isNaN(r)?0:r,this._addTransformPosition(t)},a._getPositionCoord=function(t,r){if(-1!=t.indexOf("%")){var n=e(this.element.parentNode);return n?parseFloat(t)/100*n[r]:0}return parseInt(t,10)},a._addTransformPosition=function(t){var e=t.transform;if(0===e.indexOf("matrix")){var r=e.split(","),n=0===e.indexOf("matrix3d")?12:4,i=parseInt(r[n],10),o=parseInt(r[n+1],10);this.position.x+=i,this.position.y+=o}},a.onPointerDown=function(t,e){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",t,[e])},a.dragStart=function(t,e){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",t,[e]),this.animate())},a.measureContainment=function(){var t=this.getContainer();if(t){var r=e(this.element),n=e(t),i=this.element.getBoundingClientRect(),o=t.getBoundingClientRect(),a=n.borderLeftWidth+n.borderRightWidth,s=n.borderTopWidth+n.borderBottomWidth,l=this.relativeStartPosition={x:i.left-(o.left+n.borderLeftWidth),y:i.top-(o.top+n.borderTopWidth)};this.containSize={width:n.width-a-l.x-r.width,height:n.height-s-l.y-r.height}}},a.getContainer=function(){var t=this.options.containment;if(t)return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):this.element.parentNode},a.onPointerMove=function(t,e,r){this.dispatchJQueryEvent("pointerMove",t,[e,r])},a.dragMove=function(t,e,r){if(this.isEnabled){var n=r.x,i=r.y,o=this.options.grid,a=o&&o[0],s=o&&o[1];n=l(n,a),i=l(i,s),n=this.containDrag("x",n,a),i=this.containDrag("y",i,s),n="y"==this.options.axis?0:n,i="x"==this.options.axis?0:i,this.position.x=this.startPosition.x+n,this.position.y=this.startPosition.y+i,this.dragPoint.x=n,this.dragPoint.y=i,this.dispatchEvent("dragMove",t,[e,r])}},a.containDrag=function(t,e,r){if(!this.options.containment)return e;var n="x"==t?"width":"height",i=l(-this.relativeStartPosition[t],r,"ceil"),o=this.containSize[n];return o=l(o,r,"floor"),Math.max(i,Math.min(o,e))},a.onPointerUp=function(t,e){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",t,[e])},a.dragEnd=function(t,e){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",t,[e]))},a.animate=function(){if(this.isDragging){this.positionDrag();var t=this;requestAnimationFrame(function(){t.animate()})}},a.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},a.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},a.staticClick=function(t,e){this.dispatchEvent("staticClick",t,[e])},a.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},a.enable=function(){this.isEnabled=!0},a.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},a.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},a._init=function(){},i&&i.bridget&&i.bridget("draggabilly",o),o});!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Sortable=e()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){var n,i,o;n=t,o=r[i=e],i in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o})}return t}function n(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var i=n(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),o=n(/Edge/i),a=n(/firefox/i),s=n(/safari/i)&&!n(/chrome/i)&&!n(/android/i),l=n(/iP(ad|od|hone)/i),c=n(/chrome/i)&&n(/android/i),u={capture:!1,passive:!1};function h(t,e,r){t.addEventListener(e,r,!i&&u)}function d(t,e,r){t.removeEventListener(e,r,!i&&u)}function p(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function f(t,e,r,n){if(t){r=r||document;do{if(null!=e&&(">"===e[0]?t.parentNode===r&&p(t,e):p(t,e))||n&&t===r)return t;if(t===r)break}while(t=(i=t).host&&i!==document&&i.host.nodeType?i.host:i.parentNode)}var i;return null}var g,y=/\s+/g;function m(t,e,r){if(t&&e)if(t.classList)t.classList[r?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(y," ").replace(" "+e+" "," ");t.className=(n+(r?" "+e:"")).replace(y," ")}}function C(t,e,r){var n=t&&t.style;if(n){if(void 0===r)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(r=t.currentStyle),void 0===e?r:r[e];e in n||-1!==e.indexOf("webkit")||(e="-webkit-"+e),n[e]=r+("string"==typeof r?"":"px")}}function v(t,e){var r="";if("string"==typeof t)r=t;else do{var n=C(t,"transform");n&&"none"!==n&&(r=n+" "+r)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(r)}function T(t,e,r){if(t){var n=t.getElementsByTagName(e),i=0,o=n.length;if(r)for(;i<o;i++)r(n[i],i);return n}return[]}function _(){return document.scrollingElement||document.documentElement}function S(t,e,r,n,o){if(t.getBoundingClientRect||t===window){var a,s,l,c,u,h,d;if(d=t!==window&&t!==_()?(s=(a=t.getBoundingClientRect()).top,l=a.left,c=a.bottom,u=a.right,h=a.height,a.width):(l=s=0,c=window.innerHeight,u=window.innerWidth,h=window.innerHeight,window.innerWidth),(e||r)&&t!==window&&(o=o||t.parentNode,!i))do{if(o&&o.getBoundingClientRect&&("none"!==C(o,"transform")||r&&"static"!==C(o,"position"))){var p=o.getBoundingClientRect();s-=p.top+parseInt(C(o,"border-top-width")),l-=p.left+parseInt(C(o,"border-left-width")),c=s+a.height,u=l+a.width;break}}while(o=o.parentNode);if(n&&t!==window){var f=v(o||t),g=f&&f.a,y=f&&f.d;f&&(c=(s/=y)+(h/=y),u=(l/=g)+(d/=g))}return{top:s,left:l,bottom:c,right:u,width:d,height:h}}}function E(t,e,r){for(var n=x(t,!0),i=S(t)[e];n;){var o=S(n)[r];if(!("top"===r||"left"===r?o<=i:i<=o))return n;if(n===_())break;n=x(n,!1)}return!1}function w(t,e,r){for(var n=0,i=0,o=t.children;i<o.length;){if("none"!==o[i].style.display&&o[i]!==Ot.ghost&&o[i]!==Ot.dragged&&f(o[i],r.draggable,t,!1)){if(n===e)return o[i];n++}i++}return null}function b(t,e){for(var r=t.lastElementChild;r&&(r===Ot.ghost||"none"===C(r,"display")||e&&!p(r,e));)r=r.previousElementSibling;return r||null}function L(t,e){var r=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Ot.clone||e&&!p(t,e)||r++;return r}function A(t){var e=0,r=0,n=_();if(t)do{var i=v(t),o=i.a,a=i.d;e+=t.scrollLeft*o,r+=t.scrollTop*a}while(t!==n&&(t=t.parentNode));return[e,r]}function x(t,e){if(!t||!t.getBoundingClientRect)return _();var r=t,n=!1;do{if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var i=C(r);if(r.clientWidth<r.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||r.clientHeight<r.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!r.getBoundingClientRect||r===document.body)return _();if(n||e)return r;n=!0}}}while(r=r.parentNode);return _()}function P(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function I(t,e){return function(){if(!g){var r=arguments;1===r.length?t.call(this,r[0]):t.apply(this,r),g=setTimeout(function(){g=void 0},e)}}}function R(t,e,r){t.scrollLeft+=e,t.scrollTop+=r}function O(t){var e=window.Polymer,r=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):r?r(t).clone(!0)[0]:t.cloneNode(!0)}function M(t,e){C(t,"position","absolute"),C(t,"top",e.top),C(t,"left",e.left),C(t,"width",e.width),C(t,"height",e.height)}function k(t){C(t,"position",""),C(t,"top",""),C(t,"left",""),C(t,"width",""),C(t,"height","")}var N="Sortable"+(new Date).getTime();var D=[],F={initializeByDefault:!0},B={mount:function(t){for(var e in F)!F.hasOwnProperty(e)||e in t||(t[e]=F[e]);D.push(t)},pluginEvent:function(t,e,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var o=t+"Global";D.forEach(function(i){e[i.pluginName]&&(e[i.pluginName][o]&&e[i.pluginName][o](r({sortable:e},n)),e.options[i.pluginName]&&e[i.pluginName][t]&&e[i.pluginName][t](r({sortable:e},n)))})},initializePlugins:function(t,r,n,i){for(var o in D.forEach(function(i){var o=i.pluginName;if(t.options[o]||i.initializeByDefault){var a=new i(t,r,t.options);a.sortable=t,a.options=t.options,t[o]=a,e(n,a.defaults)}}),t.options)if(t.options.hasOwnProperty(o)){var a=this.modifyOption(t,o,t.options[o]);void 0!==a&&(t.options[o]=a)}},getEventProperties:function(t,r){var n={};return D.forEach(function(i){"function"==typeof i.eventProperties&&e(n,i.eventProperties.call(r[i.pluginName],t))}),n},modifyOption:function(t,e,r){var n;return D.forEach(function(i){t[i.pluginName]&&i.optionListeners&&"function"==typeof i.optionListeners[e]&&(n=i.optionListeners[e].call(t[i.pluginName],r))}),n}};function G(t){var e=t.sortable,n=t.rootEl,a=t.name,s=t.targetEl,l=t.cloneEl,c=t.toEl,u=t.fromEl,h=t.oldIndex,d=t.newIndex,p=t.oldDraggableIndex,f=t.newDraggableIndex,g=t.originalEvent,y=t.putSortable,m=t.extraEventProperties;if(e=e||n&&n[N]){var C,v=e.options,T="on"+a.charAt(0).toUpperCase()+a.substr(1);!window.CustomEvent||i||o?(C=document.createEvent("Event")).initEvent(a,!0,!0):C=new CustomEvent(a,{bubbles:!0,cancelable:!0}),C.to=c||n,C.from=u||n,C.item=s||n,C.clone=l,C.oldIndex=h,C.newIndex=d,C.oldDraggableIndex=p,C.newDraggableIndex=f,C.originalEvent=g,C.pullMode=y?y.lastPutMode:void 0;var _=r({},m,B.getEventProperties(a,e));for(var S in _)C[S]=_[S];n&&n.dispatchEvent(C),v[T]&&v[T].call(e,C)}}function U(t,e,n){var i=2<arguments.length&&void 0!==n?n:{},o=i.evt,a=function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(i,["evt"]);B.pluginEvent.bind(Ot)(t,e,r({dragEl:q,parentEl:W,ghostEl:H,rootEl:V,nextEl:Y,lastDownEl:z,cloneEl:K,cloneHidden:$,dragStarted:lt,putSortable:et,activeSortable:Ot.active,originalEvent:o,oldIndex:X,oldDraggableIndex:J,newIndex:Z,newDraggableIndex:Q,hideGhostForTarget:xt,unhideGhostForTarget:Pt,cloneNowHidden:function(){$=!0},cloneNowShown:function(){$=!1},dispatchSortableEvent:function(t){j({sortable:e,name:t,originalEvent:o})}},a))}function j(t){G(r({putSortable:et,cloneEl:K,targetEl:q,rootEl:V,oldIndex:X,oldDraggableIndex:J,newIndex:Z,newDraggableIndex:Q},t))}var q,W,H,V,Y,z,K,$,X,Z,J,Q,tt,et,rt,nt,it,ot,at,st,lt,ct,ut,ht,dt,pt=!1,ft=!1,gt=[],yt=!1,mt=!1,Ct=[],vt=!1,Tt=[],_t="undefined"!=typeof document,St=l,Et=o||i?"cssFloat":"float",wt=_t&&!c&&!l&&"draggable"in document.createElement("div"),bt=function(){if(_t){if(i)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),Lt=function(t,e){var r=C(t),n=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),i=w(t,0,e),o=w(t,1,e),a=i&&C(i),s=o&&C(o),l=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+S(i).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+S(o).width;if("flex"===r.display)return"column"===r.flexDirection||"column-reverse"===r.flexDirection?"vertical":"horizontal";if("grid"===r.display)return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&a.float&&"none"!==a.float){var u="left"===a.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==u?"horizontal":"vertical"}return i&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||n<=l&&"none"===r[Et]||o&&"none"===r[Et]&&n<l+c)?"vertical":"horizontal"},At=function(e){function r(t,e){return function(n,i,o,a){var s=n.options.group.name&&i.options.group.name&&n.options.group.name===i.options.group.name;if(null==t&&(e||s))return!0;if(null==t||!1===t)return!1;if(e&&"clone"===t)return t;if("function"==typeof t)return r(t(n,i,o,a),e)(n,i,o,a);var l=(e?n:i).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&-1<t.indexOf(l)}}var n={},i=e.group;i&&"object"==t(i)||(i={name:i}),n.name=i.name,n.checkPull=r(i.pull,!0),n.checkPut=r(i.put),n.revertClone=i.revertClone,e.group=n},xt=function(){!bt&&H&&C(H,"display","none")},Pt=function(){!bt&&H&&C(H,"display","")};_t&&document.addEventListener("click",function(t){if(ft)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),ft=!1},!0);function It(t){if(q){var e=(i=(t=t.touches?t.touches[0]:t).clientX,o=t.clientY,gt.some(function(t){if(!b(t)){var e=S(t),r=t[N].options.emptyInsertThreshold,n=i>=e.left-r&&i<=e.right+r,s=o>=e.top-r&&o<=e.bottom+r;return r&&n&&s?a=t:void 0}}),a);if(e){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);r.target=r.rootEl=e,r.preventDefault=void 0,r.stopPropagation=void 0,e[N]._onDragOver(r)}}var i,o,a}function Rt(t){q&&q.parentNode[N]._isOutsideThisEl(t.target)}function Ot(t,n){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=n=e({},n),t[N]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Lt(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Ot.supportPointer&&"PointerEvent"in window,emptyInsertThreshold:5};for(var o in B.initializePlugins(this,t,i),i)o in n||(n[o]=i[o]);for(var a in At(n),this)"_"===a.charAt(0)&&"function"==typeof this[a]&&(this[a]=this[a].bind(this));this.nativeDraggable=!n.forceFallback&&wt,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?h(t,"pointerdown",this._onTapStart):(h(t,"mousedown",this._onTapStart),h(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(h(t,"dragover",this),h(t,"dragenter",this)),gt.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),e(this,function(){var t,e=[];return{captureAnimationState:function(){e=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(t){if("none"!==C(t,"display")&&t!==Ot.ghost){e.push({target:t,rect:S(t)});var n=r({},e[e.length-1].rect);if(t.thisAnimationDuration){var i=v(t,!0);i&&(n.top-=i.f,n.left-=i.e)}t.fromRect=n}})},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var r in t)if(t.hasOwnProperty(r))for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[r][n])return Number(r);return-1}(e,{target:t}),1)},animateAll:function(r){var n=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof r&&r());var i=!1,o=0;e.forEach(function(t){var e=0,r=t.target,a=r.fromRect,s=S(r),l=r.prevFromRect,c=r.prevToRect,u=t.rect,h=v(r,!0);h&&(s.top-=h.f,s.left-=h.e),r.toRect=s,r.thisAnimationDuration&&P(l,s)&&!P(a,s)&&(u.top-s.top)/(u.left-s.left)==(a.top-s.top)/(a.left-s.left)&&(e=function(t,e,r,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-r.top,2)+Math.pow(e.left-r.left,2))*n.animation}(u,l,c,n.options)),P(s,a)||(r.prevFromRect=a,r.prevToRect=s,e||(e=n.options.animation),n.animate(r,u,s,e)),e&&(i=!0,o=Math.max(o,e),clearTimeout(r.animationResetTimer),r.animationResetTimer=setTimeout(function(){r.animationTime=0,r.prevFromRect=null,r.fromRect=null,r.prevToRect=null,r.thisAnimationDuration=null},e),r.thisAnimationDuration=e)}),clearTimeout(t),i?t=setTimeout(function(){"function"==typeof r&&r()},o):"function"==typeof r&&r(),e=[]},animate:function(t,e,r,n){if(n){C(t,"transition",""),C(t,"transform","");var i=v(this.el),o=i&&i.a,a=i&&i.d,s=(e.left-r.left)/(o||1),l=(e.top-r.top)/(a||1);t.animatingX=!!s,t.animatingY=!!l,C(t,"transform","translate3d("+s+"px,"+l+"px,0)"),function(t){t.offsetWidth}(t),C(t,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),C(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout(function(){C(t,"transition",""),C(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},n)}}}}())}function Mt(t,e,r,n,a,s,l,c){var u,h,d=t[N],p=d.options.onMove;return!window.CustomEvent||i||o?(u=document.createEvent("Event")).initEvent("move",!0,!0):u=new CustomEvent("move",{bubbles:!0,cancelable:!0}),u.to=e,u.from=t,u.dragged=r,u.draggedRect=n,u.related=a||e,u.relatedRect=s||S(e),u.willInsertAfter=c,u.originalEvent=l,t.dispatchEvent(u),p&&(h=p.call(d,u,l)),h}function kt(t){t.draggable=!1}function Nt(){vt=!1}function Dt(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,r=e.length,n=0;r--;)n+=e.charCodeAt(r);return n.toString(36)}function Ft(t){return setTimeout(t,0)}function Bt(t){return clearTimeout(t)}Ot.prototype={constructor:Ot,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(ct=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,q):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,r=this.el,n=this.options,i=n.preventOnFilter,o=t.type,a=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,s=(a||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||s,c=n.filter;if(function(t){Tt.length=0;for(var e=t.getElementsByTagName("input"),r=e.length;r--;){var n=e[r];n.checked&&Tt.push(n)}}(r),!q&&!(/mousedown|pointerdown/.test(o)&&0!==t.button||n.disabled||l.isContentEditable||(s=f(s,n.draggable,r,!1))&&s.animated||z===s)){if(X=L(s),J=L(s,n.draggable),"function"==typeof c){if(c.call(this,t,s,this))return j({sortable:e,rootEl:l,name:"filter",targetEl:s,toEl:r,fromEl:r}),U("filter",e,{evt:t}),void(i&&t.cancelable&&t.preventDefault())}else if(c&&(c=c.split(",").some(function(n){if(n=f(l,n.trim(),r,!1))return j({sortable:e,rootEl:n,name:"filter",targetEl:s,fromEl:r,toEl:r}),U("filter",e,{evt:t}),!0})))return void(i&&t.cancelable&&t.preventDefault());n.handle&&!f(l,n.handle,r,!1)||this._prepareDragStart(t,a,s)}}},_prepareDragStart:function(t,e,r){var n,s=this,l=s.el,c=s.options,u=l.ownerDocument;if(r&&!q&&r.parentNode===l){var d=S(r);if(V=l,W=(q=r).parentNode,Y=q.nextSibling,z=r,tt=c.group,rt={target:Ot.dragged=q,clientX:(e||t).clientX,clientY:(e||t).clientY},at=rt.clientX-d.left,st=rt.clientY-d.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,q.style["will-change"]="all",n=function(){U("delayEnded",s,{evt:t}),Ot.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!a&&s.nativeDraggable&&(q.draggable=!0),s._triggerDragStart(t,e),j({sortable:s,name:"choose",originalEvent:t}),m(q,c.chosenClass,!0))},c.ignore.split(",").forEach(function(t){T(q,t.trim(),kt)}),h(u,"dragover",It),h(u,"mousemove",It),h(u,"touchmove",It),h(u,"mouseup",s._onDrop),h(u,"touchend",s._onDrop),h(u,"touchcancel",s._onDrop),a&&this.nativeDraggable&&(this.options.touchStartThreshold=4,q.draggable=!0),U("delayStart",this,{evt:t}),!c.delay||c.delayOnTouchOnly&&!e||this.nativeDraggable&&(o||i))n();else{if(Ot.eventCanceled)return void this._onDrop();h(u,"mouseup",s._disableDelayedDrag),h(u,"touchend",s._disableDelayedDrag),h(u,"touchcancel",s._disableDelayedDrag),h(u,"mousemove",s._delayedDragTouchMoveHandler),h(u,"touchmove",s._delayedDragTouchMoveHandler),c.supportPointer&&h(u,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(n,c.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){q&&kt(q),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;d(t,"mouseup",this._disableDelayedDrag),d(t,"touchend",this._disableDelayedDrag),d(t,"touchcancel",this._disableDelayedDrag),d(t,"mousemove",this._delayedDragTouchMoveHandler),d(t,"touchmove",this._delayedDragTouchMoveHandler),d(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?h(document,"pointermove",this._onTouchMove):h(document,e?"touchmove":"mousemove",this._onTouchMove):(h(q,"dragend",this),h(V,"dragstart",this._onDragStart));try{document.selection?Ft(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(pt=!1,V&&q){U("dragStarted",this,{evt:e}),this.nativeDraggable&&h(document,"dragover",Rt);var r=this.options;t||m(q,r.dragClass,!1),m(q,r.ghostClass,!0),Ot.active=this,t&&this._appendGhost(),j({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(nt){this._lastX=nt.clientX,this._lastY=nt.clientY,xt();for(var t=document.elementFromPoint(nt.clientX,nt.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(nt.clientX,nt.clientY))!==e;)e=t;if(q.parentNode[N]._isOutsideThisEl(t),e)do{if(e[N]&&e[N]._onDragOver({clientX:nt.clientX,clientY:nt.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break;t=e}while(e=e.parentNode);Pt()}},_onTouchMove:function(t){if(rt){var e=this.options,r=e.fallbackTolerance,n=e.fallbackOffset,i=t.touches?t.touches[0]:t,o=H&&v(H,!0),a=H&&o&&o.a,s=H&&o&&o.d,l=St&&dt&&A(dt),c=(i.clientX-rt.clientX+n.x)/(a||1)+(l?l[0]-Ct[0]:0)/(a||1),u=(i.clientY-rt.clientY+n.y)/(s||1)+(l?l[1]-Ct[1]:0)/(s||1);if(!Ot.active&&!pt){if(r&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<r)return;this._onDragStart(t,!0)}if(H){o?(o.e+=c-(it||0),o.f+=u-(ot||0)):o={a:1,b:0,c:0,d:1,e:c,f:u};var h="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");C(H,"webkitTransform",h),C(H,"mozTransform",h),C(H,"msTransform",h),C(H,"transform",h),it=c,ot=u,nt=i}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!H){var t=this.options.fallbackOnBody?document.body:V,e=S(q,!0,St,!0,t),r=this.options;if(St){for(dt=t;"static"===C(dt,"position")&&"none"===C(dt,"transform")&&dt!==document;)dt=dt.parentNode;dt!==document.body&&dt!==document.documentElement?(dt===document&&(dt=_()),e.top+=dt.scrollTop,e.left+=dt.scrollLeft):dt=_(),Ct=A(dt)}m(H=q.cloneNode(!0),r.ghostClass,!1),m(H,r.fallbackClass,!0),m(H,r.dragClass,!0),C(H,"transition",""),C(H,"transform",""),C(H,"box-sizing","border-box"),C(H,"margin",0),C(H,"top",e.top),C(H,"left",e.left),C(H,"width",e.width),C(H,"height",e.height),C(H,"opacity","0.8"),C(H,"position",St?"absolute":"fixed"),C(H,"zIndex","100000"),C(H,"pointerEvents","none"),Ot.ghost=H,t.appendChild(H),C(H,"transform-origin",at/parseInt(H.style.width)*100+"% "+st/parseInt(H.style.height)*100+"%")}},_onDragStart:function(t,e){var r=this,n=t.dataTransfer,i=r.options;U("dragStart",this,{evt:t}),Ot.eventCanceled?this._onDrop():(U("setupClone",this),Ot.eventCanceled||((K=O(q)).draggable=!1,K.style["will-change"]="",this._hideClone(),m(K,this.options.chosenClass,!1),Ot.clone=K),r.cloneId=Ft(function(){U("clone",r),Ot.eventCanceled||(r.options.removeCloneOnHide||V.insertBefore(K,q),r._hideClone(),j({sortable:r,name:"clone"}))}),e||m(q,i.dragClass,!0),e?(ft=!0,r._loopId=setInterval(r._emulateDragOver,50)):(d(document,"mouseup",r._onDrop),d(document,"touchend",r._onDrop),d(document,"touchcancel",r._onDrop),n&&(n.effectAllowed="move",i.setData&&i.setData.call(r,n,q)),h(document,"drop",r),C(q,"transform","translateZ(0)")),pt=!0,r._dragStartId=Ft(r._dragStarted.bind(r,e,t)),h(document,"selectstart",r),lt=!0,s&&C(document.body,"user-select","none"))},_onDragOver:function(t){var e,n,i,o,a=this.el,s=t.target,l=this.options,c=l.group,u=Ot.active,h=tt===c,d=l.sort,p=et||u,g=this,y=!1;if(!vt){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),s=f(s,l.draggable,a,!0),B("dragOver"),Ot.eventCanceled)return y;if(q.contains(t.target)||s.animated&&s.animatingX&&s.animatingY||g._ignoreWhileAnimating===s)return z(!1);if(ft=!1,u&&!l.disabled&&(h?d||(i=!V.contains(q)):et===this||(this.lastPutMode=tt.checkPull(this,u,q,t))&&c.checkPut(this,u,q,t))){if(o="vertical"===this._getDirection(t,s),e=S(q),B("dragOverValid"),Ot.eventCanceled)return y;if(i)return W=V,G(),this._hideClone(),B("revert"),Ot.eventCanceled||(Y?V.insertBefore(q,Y):V.appendChild(q)),z(!0);var v=b(a,l.draggable);if(!v||function(t,e,r){var n=S(b(r.el,r.options.draggable));return e?t.clientX>n.right+10||t.clientX<=n.right&&t.clientY>n.bottom&&t.clientX>=n.left:t.clientX>n.right&&t.clientY>n.top||t.clientX<=n.right&&t.clientY>n.bottom+10}(t,o,this)&&!v.animated){if(v===q)return z(!1);if(v&&a===t.target&&(s=v),s&&(n=S(s)),!1!==Mt(V,a,q,e,s,n,t,!!s))return G(),a.appendChild(q),W=a,K(),z(!0)}else if(s.parentNode===a){n=S(s);var T,_,w,A=q.parentNode!==a,x=!function(t,e,r){var n=r?t.left:t.top,i=r?t.right:t.bottom,o=r?t.width:t.height,a=r?e.left:e.top,s=r?e.right:e.bottom,l=r?e.width:e.height;return n===a||i===s||n+o/2===a+l/2}(q.animated&&q.toRect||e,s.animated&&s.toRect||n,o),P=o?"top":"left",I=E(s,"top","top")||E(q,"top","top"),O=I?I.scrollTop:void 0;if(ct!==s&&(_=n[P],yt=!1,mt=!x&&l.invertSwap||A),0!==(T=function(t,e,r,n,i,o,a,s){var l=n?t.clientY:t.clientX,c=n?r.height:r.width,u=n?r.top:r.left,h=n?r.bottom:r.right,d=!1;if(!a)if(s&&ht<c*i){if(!yt&&(1===ut?u+c*o/2<l:l<h-c*o/2)&&(yt=!0),yt)d=!0;else if(1===ut?l<u+ht:h-ht<l)return-ut}else if(u+c*(1-i)/2<l&&l<h-c*(1-i)/2)return function(t){return L(q)<L(t)?1:-1}(e);return(d=d||a)&&(l<u+c*o/2||h-c*o/2<l)?u+c/2<l?1:-1:0}(t,s,n,o,x?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,mt,ct===s)))for(var M=L(q);M-=T,(w=W.children[M])&&("none"===C(w,"display")||w===H););if(0===T||w===s)return z(!1);ut=T;var k=(ct=s).nextElementSibling,D=!1,F=Mt(V,a,q,e,s,n,t,D=1===T);if(!1!==F)return 1!==F&&-1!==F||(D=1===F),vt=!0,setTimeout(Nt,30),G(),D&&!k?a.appendChild(q):s.parentNode.insertBefore(q,D?k:s),I&&R(I,0,O-I.scrollTop),W=q.parentNode,void 0===_||mt||(ht=Math.abs(_-S(s)[P])),K(),z(!0)}if(a.contains(q))return z(!1)}return!1}function B(l,c){U(l,g,r({evt:t,isOwner:h,axis:o?"vertical":"horizontal",revert:i,dragRect:e,targetRect:n,canSort:d,fromSortable:p,target:s,completed:z,onMove:function(r,n){return Mt(V,a,q,e,r,S(r),t,n)},changed:K},c))}function G(){B("dragOverAnimationCapture"),g.captureAnimationState(),g!==p&&p.captureAnimationState()}function z(e){return B("dragOverCompleted",{insertion:e}),e&&(h?u._hideClone():u._showClone(g),g!==p&&(m(q,et?et.options.ghostClass:u.options.ghostClass,!1),m(q,l.ghostClass,!0)),et!==g&&g!==Ot.active?et=g:g===Ot.active&&et&&(et=null),p===g&&(g._ignoreWhileAnimating=s),g.animateAll(function(){B("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(s===q&&!q.animated||s===a&&!s.animated)&&(ct=null),l.dragoverBubble||t.rootEl||s===document||(q.parentNode[N]._isOutsideThisEl(t.target),e||It(t)),!l.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),y=!0}function K(){Z=L(q),Q=L(q,l.draggable),j({sortable:g,name:"change",toEl:a,newIndex:Z,newDraggableIndex:Q,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){d(document,"mousemove",this._onTouchMove),d(document,"touchmove",this._onTouchMove),d(document,"pointermove",this._onTouchMove),d(document,"dragover",It),d(document,"mousemove",It),d(document,"touchmove",It)},_offUpEvents:function(){var t=this.el.ownerDocument;d(t,"mouseup",this._onDrop),d(t,"touchend",this._onDrop),d(t,"pointerup",this._onDrop),d(t,"touchcancel",this._onDrop),d(document,"selectstart",this)},_onDrop:function(t){var e=this.el,r=this.options;Z=L(q),Q=L(q,r.draggable),U("drop",this,{evt:t}),W=q&&q.parentNode,Z=L(q),Q=L(q,r.draggable),Ot.eventCanceled||(yt=mt=pt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Bt(this.cloneId),Bt(this._dragStartId),this.nativeDraggable&&(d(document,"drop",this),d(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),s&&C(document.body,"user-select",""),C(q,"transform",""),t&&(lt&&(t.cancelable&&t.preventDefault(),r.dropBubble||t.stopPropagation()),H&&H.parentNode&&H.parentNode.removeChild(H),(V===W||et&&"clone"!==et.lastPutMode)&&K&&K.parentNode&&K.parentNode.removeChild(K),q&&(this.nativeDraggable&&d(q,"dragend",this),kt(q),q.style["will-change"]="",lt&&!pt&&m(q,et?et.options.ghostClass:this.options.ghostClass,!1),m(q,this.options.chosenClass,!1),j({sortable:this,name:"unchoose",toEl:W,newIndex:null,newDraggableIndex:null,originalEvent:t}),V!==W?(0<=Z&&(j({rootEl:W,name:"add",toEl:W,fromEl:V,originalEvent:t}),j({sortable:this,name:"remove",toEl:W,originalEvent:t}),j({rootEl:W,name:"sort",toEl:W,fromEl:V,originalEvent:t}),j({sortable:this,name:"sort",toEl:W,originalEvent:t})),et&&et.save()):Z!==X&&0<=Z&&(j({sortable:this,name:"update",toEl:W,originalEvent:t}),j({sortable:this,name:"sort",toEl:W,originalEvent:t})),Ot.active&&(null!=Z&&-1!==Z||(Z=X,Q=J),j({sortable:this,name:"end",toEl:W,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){U("nulling",this),V=q=W=H=Y=K=z=$=rt=nt=lt=Z=Q=X=J=ct=ut=et=tt=Ot.dragged=Ot.ghost=Ot.clone=Ot.active=null,Tt.forEach(function(t){t.checked=!0}),Tt.length=it=ot=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":q&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],r=this.el.children,n=0,i=r.length,o=this.options;n<i;n++)f(t=r[n],o.draggable,this.el,!1)&&e.push(t.getAttribute(o.dataIdAttr)||Dt(t));return e},sort:function(t){var e={},r=this.el;this.toArray().forEach(function(t,n){var i=r.children[n];f(i,this.options.draggable,r,!1)&&(e[t]=i)},this),t.forEach(function(t){e[t]&&(r.removeChild(e[t]),r.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return f(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var r=this.options;if(void 0===e)return r[t];var n=B.modifyOption(this,t,e);r[t]=void 0!==n?n:e,"group"===t&&At(r)},destroy:function(){U("destroy",this);var t=this.el;t[N]=null,d(t,"mousedown",this._onTapStart),d(t,"touchstart",this._onTapStart),d(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(d(t,"dragover",this),d(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),gt.splice(gt.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!$){if(U("hideClone",this),Ot.eventCanceled)return;C(K,"display","none"),this.options.removeCloneOnHide&&K.parentNode&&K.parentNode.removeChild(K),$=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if($){if(U("showClone",this),Ot.eventCanceled)return;V.contains(q)&&!this.options.group.revertClone?V.insertBefore(K,q):Y?V.insertBefore(K,Y):V.appendChild(K),this.options.group.revertClone&&this.animate(q,K),C(K,"display",""),$=!1}}else this._hideClone()}},_t&&h(document,"touchmove",function(t){(Ot.active||pt)&&t.cancelable&&t.preventDefault()}),Ot.utils={on:h,off:d,css:C,find:T,is:function(t,e){return!!f(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},throttle:I,closest:f,toggleClass:m,clone:O,index:L,nextTick:Ft,cancelNextTick:Bt,detectDirection:Lt,getChild:w},Ot.get=function(t){return t[N]},Ot.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Ot.utils=r({},Ot.utils,t.utils)),B.mount(t)})},Ot.create=function(t,e){return new Ot(t,e)};var Gt,Ut,jt,qt,Wt,Ht,Vt=[],Yt=!(Ot.version="1.10.2");function zt(){Vt.forEach(function(t){clearInterval(t.pid)}),Vt=[]}function Kt(){clearInterval(Ht)}function $t(t){var e=t.originalEvent,r=t.putSortable,n=t.dragEl,i=t.activeSortable,o=t.dispatchSortableEvent,a=t.hideGhostForTarget,s=t.unhideGhostForTarget;if(e){var l=r||i;a();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(c.clientX,c.clientY);s(),l&&!l.el.contains(u)&&(o("spill"),this.onSpill({dragEl:n,putSortable:r}))}}var Xt,Zt=I(function(t,e,r,n){if(e.scroll){var i,o=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,s=e.scrollSensitivity,l=e.scrollSpeed,c=_(),u=!1;Ut!==r&&(Ut=r,zt(),Gt=e.scroll,i=e.scrollFn,!0===Gt&&(Gt=x(r,!0)));var h=0,d=Gt;do{var p,f=d,g=S(f),y=g.top,m=g.bottom,v=g.left,T=g.right,E=g.width,w=g.height,b=void 0,L=f.scrollWidth,A=f.scrollHeight,P=C(f),I=f.scrollLeft,O=f.scrollTop;p=f===c?(b=E<L&&("auto"===P.overflowX||"scroll"===P.overflowX||"visible"===P.overflowX),w<A&&("auto"===P.overflowY||"scroll"===P.overflowY||"visible"===P.overflowY)):(b=E<L&&("auto"===P.overflowX||"scroll"===P.overflowX),w<A&&("auto"===P.overflowY||"scroll"===P.overflowY));var M=b&&(Math.abs(T-o)<=s&&I+E<L)-(Math.abs(v-o)<=s&&!!I),k=p&&(Math.abs(m-a)<=s&&O+w<A)-(Math.abs(y-a)<=s&&!!O);if(!Vt[h])for(var D=0;D<=h;D++)Vt[D]||(Vt[D]={});Vt[h].vx==M&&Vt[h].vy==k&&Vt[h].el===f||(Vt[h].el=f,Vt[h].vx=M,Vt[h].vy=k,clearInterval(Vt[h].pid),0==M&&0==k||(u=!0,Vt[h].pid=setInterval(function(){n&&0===this.layer&&Ot.active._onTouchMove(Wt);var e=Vt[this.layer].vy?Vt[this.layer].vy*l:0,r=Vt[this.layer].vx?Vt[this.layer].vx*l:0;"function"==typeof i&&"continue"!==i.call(Ot.dragged.parentNode[N],r,e,t,Wt,Vt[this.layer].el)||R(Vt[this.layer].el,r,e)}.bind({layer:h}),24))),h++}while(e.bubbleScroll&&d!==c&&(d=x(d,!1)));Yt=u}},30);function Jt(){}function Qt(){}Jt.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,r=t.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var n=w(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),r&&r.animateAll()},drop:$t},e(Jt,{pluginName:"revertOnSpill"}),Qt.prototype={onSpill:function(t){var e=t.dragEl,r=t.putSortable||this.sortable;r.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),r.animateAll()},drop:$t},e(Qt,{pluginName:"removeOnSpill"});var te,ee,re,ne,ie,oe=[],ae=[],se=!1,le=!1,ce=!1;function ue(t,e){ae.forEach(function(r,n){var i=e.children[r.sortableIndex+(t?Number(n):0)];i?e.insertBefore(r,i):e.appendChild(r)})}function he(){oe.forEach(function(t){t!==re&&t.parentNode&&t.parentNode.removeChild(t)})}return Ot.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?h(document,"dragover",this._handleAutoScroll):this.options.supportPointer?h(document,"pointermove",this._handleFallbackAutoScroll):e.touches?h(document,"touchmove",this._handleFallbackAutoScroll):h(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?d(document,"dragover",this._handleAutoScroll):(d(document,"pointermove",this._handleFallbackAutoScroll),d(document,"touchmove",this._handleFallbackAutoScroll),d(document,"mousemove",this._handleFallbackAutoScroll)),Kt(),zt(),clearTimeout(g),g=void 0},nulling:function(){Wt=Ut=Gt=Yt=Ht=jt=qt=null,Vt.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var r=this,n=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,l=document.elementFromPoint(n,a);if(Wt=t,e||o||i||s){Zt(t,this.options,l,e);var c=x(l,!0);!Yt||Ht&&n===jt&&a===qt||(Ht&&Kt(),Ht=setInterval(function(){var i=x(document.elementFromPoint(n,a),!0);i!==c&&(c=i,zt()),Zt(t,r.options,i,e)},10),jt=n,qt=a)}else{if(!this.options.bubbleScroll||x(l,!0)===_())return void zt();Zt(t,this.options,x(l,!1),!1)}}},e(t,{pluginName:"scroll",initializeByDefault:!0})}),Ot.mount(Qt,Jt),Ot.mount(new function(){function t(){this.defaults={swapClass:"sortable-swap-highlight"}}return t.prototype={dragStart:function(t){var e=t.dragEl;Xt=e},dragOverValid:function(t){var e=t.completed,r=t.target,n=t.onMove,i=t.activeSortable,o=t.changed,a=t.cancel;if(i.options.swap){var s=this.sortable.el,l=this.options;if(r&&r!==s){var c=Xt;Xt=!1!==n(r)?(m(r,l.swapClass,!0),r):null,c&&c!==Xt&&m(c,l.swapClass,!1)}o(),e(!0),a()}},drop:function(t){var e=t.activeSortable,r=t.putSortable,n=t.dragEl,i=r||this.sortable,o=this.options;Xt&&m(Xt,o.swapClass,!1),Xt&&(o.swap||r&&r.options.swap)&&n!==Xt&&(i.captureAnimationState(),i!==e&&e.captureAnimationState(),function(t,e){var r,n,i=t.parentNode,o=e.parentNode;if(i&&o&&!i.isEqualNode(e)&&!o.isEqualNode(t)){r=L(t),n=L(e),i.isEqualNode(o)&&r<n&&n++;i.insertBefore(e,i.children[r]),o.insertBefore(t,o.children[n])}}(n,Xt),i.animateAll(),i!==e&&e.animateAll())},nulling:function(){Xt=null}},e(t,{pluginName:"swap",eventProperties:function(){return{swapItem:Xt}}})}),Ot.mount(new function(){function t(t){for(var e in this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this));t.options.supportPointer?h(document,"pointerup",this._deselectMultiDrag):(h(document,"mouseup",this._deselectMultiDrag),h(document,"touchend",this._deselectMultiDrag)),h(document,"keydown",this._checkKeyDown),h(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(e,r){var n="";oe.length&&ee===t?oe.forEach(function(t,e){n+=(e?", ":"")+t.textContent}):n=r.textContent,e.setData("Text",n)}}}return t.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(t){var e=t.dragEl;re=e},delayEnded:function(){this.isMultiDrag=~oe.indexOf(re)},setupClone:function(t){var e=t.sortable,r=t.cancel;if(this.isMultiDrag){for(var n=0;n<oe.length;n++)ae.push(O(oe[n])),ae[n].sortableIndex=oe[n].sortableIndex,ae[n].draggable=!1,ae[n].style["will-change"]="",m(ae[n],this.options.selectedClass,!1),oe[n]===re&&m(ae[n],this.options.chosenClass,!1);e._hideClone(),r()}},clone:function(t){var e=t.sortable,r=t.rootEl,n=t.dispatchSortableEvent,i=t.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||oe.length&&ee===e&&(ue(!0,r),n("clone"),i()))},showClone:function(t){var e=t.cloneNowShown,r=t.rootEl,n=t.cancel;this.isMultiDrag&&(ue(!1,r),ae.forEach(function(t){C(t,"display","")}),e(),ie=!1,n())},hideClone:function(t){var e=this,r=(t.sortable,t.cloneNowHidden),n=t.cancel;this.isMultiDrag&&(ae.forEach(function(t){C(t,"display","none"),e.options.removeCloneOnHide&&t.parentNode&&t.parentNode.removeChild(t)}),r(),ie=!0,n())},dragStartGlobal:function(t){t.sortable;!this.isMultiDrag&&ee&&ee.multiDrag._deselectMultiDrag(),oe.forEach(function(t){t.sortableIndex=L(t)}),oe=oe.sort(function(t,e){return t.sortableIndex-e.sortableIndex}),ce=!0},dragStarted:function(t){var e=this,r=t.sortable;if(this.isMultiDrag){if(this.options.sort&&(r.captureAnimationState(),this.options.animation)){oe.forEach(function(t){t!==re&&C(t,"position","absolute")});var n=S(re,!1,!0,!0);oe.forEach(function(t){t!==re&&M(t,n)}),se=le=!0}r.animateAll(function(){se=le=!1,e.options.animation&&oe.forEach(function(t){k(t)}),e.options.sort&&he()})}},dragOver:function(t){var e=t.target,r=t.completed,n=t.cancel;le&&~oe.indexOf(e)&&(r(!1),n())},revert:function(t){var e=t.fromSortable,r=t.rootEl,n=t.sortable,i=t.dragRect;1<oe.length&&(oe.forEach(function(t){n.addAnimationState({target:t,rect:le?S(t):i}),k(t),t.fromRect=i,e.removeAnimationState(t)}),le=!1,function(t,e){oe.forEach(function(r,n){var i=e.children[r.sortableIndex+(t?Number(n):0)];i?e.insertBefore(r,i):e.appendChild(r)})}(!this.options.removeCloneOnHide,r))},dragOverCompleted:function(t){var e=t.sortable,r=t.isOwner,n=t.insertion,i=t.activeSortable,o=t.parentEl,a=t.putSortable,s=this.options;if(n){if(r&&i._hideClone(),se=!1,s.animation&&1<oe.length&&(le||!r&&!i.options.sort&&!a)){var l=S(re,!1,!0,!0);oe.forEach(function(t){t!==re&&(M(t,l),o.appendChild(t))}),le=!0}if(!r)if(le||he(),1<oe.length){var c=ie;i._showClone(e),i.options.animation&&!ie&&c&&ae.forEach(function(t){i.addAnimationState({target:t,rect:ne}),t.fromRect=ne,t.thisAnimationDuration=null})}else i._showClone(e)}},dragOverAnimationCapture:function(t){var r=t.dragRect,n=t.isOwner,i=t.activeSortable;if(oe.forEach(function(t){t.thisAnimationDuration=null}),i.options.animation&&!n&&i.multiDrag.isMultiDrag){ne=e({},r);var o=v(re,!0);ne.top-=o.f,ne.left-=o.e}},dragOverAnimationComplete:function(){le&&(le=!1,he())},drop:function(t){var e=t.originalEvent,r=t.rootEl,n=t.parentEl,i=t.sortable,o=t.dispatchSortableEvent,a=t.oldIndex,s=t.putSortable,l=s||this.sortable;if(e){var c=this.options,u=n.children;if(!ce)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),m(re,c.selectedClass,!~oe.indexOf(re)),~oe.indexOf(re))oe.splice(oe.indexOf(re),1),te=null,G({sortable:i,rootEl:r,name:"deselect",targetEl:re,originalEvt:e});else{if(oe.push(re),G({sortable:i,rootEl:r,name:"select",targetEl:re,originalEvt:e}),e.shiftKey&&te&&i.el.contains(te)){var h,d,p=L(te),f=L(re);if(~p&&~f&&p!==f)for(h=p<f?(d=p,f):(d=f,p+1);d<h;d++)~oe.indexOf(u[d])||(m(u[d],c.selectedClass,!0),oe.push(u[d]),G({sortable:i,rootEl:r,name:"select",targetEl:u[d],originalEvt:e}))}else te=re;ee=l}if(ce&&this.isMultiDrag){if((n[N].options.sort||n!==r)&&1<oe.length){var g=S(re),y=L(re,":not(."+this.options.selectedClass+")");if(!se&&c.animation&&(re.thisAnimationDuration=null),l.captureAnimationState(),!se&&(c.animation&&(re.fromRect=g,oe.forEach(function(t){if(t.thisAnimationDuration=null,t!==re){var e=le?S(t):g;t.fromRect=e,l.addAnimationState({target:t,rect:e})}})),he(),oe.forEach(function(t){u[y]?n.insertBefore(t,u[y]):n.appendChild(t),y++}),a===L(re))){var C=!1;oe.forEach(function(t){t.sortableIndex===L(t)||(C=!0)}),C&&o("update")}oe.forEach(function(t){k(t)}),l.animateAll()}ee=l}(r===n||s&&"clone"!==s.lastPutMode)&&ae.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)})}},nullingGlobal:function(){this.isMultiDrag=ce=!1,ae.length=0},destroyGlobal:function(){this._deselectMultiDrag(),d(document,"pointerup",this._deselectMultiDrag),d(document,"mouseup",this._deselectMultiDrag),d(document,"touchend",this._deselectMultiDrag),d(document,"keydown",this._checkKeyDown),d(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(t){if(!(void 0!==ce&&ce||ee!==this.sortable||t&&f(t.target,this.options.draggable,this.sortable.el,!1)||t&&0!==t.button))for(;oe.length;){var e=oe[0];m(e,this.options.selectedClass,!1),oe.shift(),G({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:e,originalEvt:t})}},_checkKeyDown:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},e(t,{pluginName:"multiDrag",utils:{select:function(t){var e=t.parentNode[N];e&&e.options.multiDrag&&!~oe.indexOf(t)&&(ee&&ee!==e&&(ee.multiDrag._deselectMultiDrag(),ee=e),m(t,e.options.selectedClass,!0),oe.push(t))},deselect:function(t){var e=t.parentNode[N],r=oe.indexOf(t);e&&e.options.multiDrag&&~r&&(m(t,e.options.selectedClass,!1),oe.splice(r,1))}},eventProperties:function(){var t,e=this,r=[],n=[];return oe.forEach(function(t){var i;r.push({multiDragElement:t,index:t.sortableIndex}),i=le&&t!==re?-1:le?L(t,":not(."+e.options.selectedClass+")"):L(t),n.push({multiDragElement:t,index:i})}),{items:(t=oe,function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()),clones:[].concat(ae),oldIndicies:r,newIndicies:n}},optionListeners:{multiDragKey:function(t){return"ctrl"===(t=t.toLowerCase())?t="Control":1<t.length&&(t=t.charAt(0).toUpperCase()+t.substr(1)),t}}})}),Ot});!function(){function t(t){this.mode=s.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=[],r=0,n=this.data.length;n>r;r++){var i=this.data.charCodeAt(r);i>65536?(e[0]=240|(1835008&i)>>>18,e[1]=128|(258048&i)>>>12,e[2]=128|(4032&i)>>>6,e[3]=128|63&i):i>2048?(e[0]=224|(61440&i)>>>12,e[1]=128|(4032&i)>>>6,e[2]=128|63&i):i>128?(e[0]=192|(1984&i)>>>6,e[1]=128|63&i):e[0]=i,this.parsedData=this.parsedData.concat(e)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var n=0;n<t.length-r;n++)this.num[n]=t[n+r]}function n(t,e){this.totalCount=t,this.dataCount=e}function i(){this.buffer=[],this.length=0}function o(){var t=!1,e=navigator.userAgent;return/android/i.test(e)&&(t=!0,aMat=e.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(t=parseFloat(aMat[1]))),t}function a(t,e){for(var r=1,n=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),i=0,o=p.length;o>=i;i++){var a=0;switch(e){case l.L:a=p[i][0];break;case l.M:a=p[i][1];break;case l.Q:a=p[i][2];break;case l.H:a=p[i][3]}if(a>=n)break;r++}if(r>p.length)throw new Error("Too long data");return r}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var n=-1;7>=n;n++)-1>=e+n||this.moduleCount<=e+n||(this.modules[t+r][e+n]=r>=0&&6>=r&&(0==n||6==n)||n>=0&&6>=n&&(0==r||6==r)||r>=2&&4>=r&&n>=2&&4>=n)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;8>r;r++){this.makeImpl(!0,r);var n=u.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},createMovieClip:function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,a=0;a<this.modules[i].length;a++){var s=1*a;this.modules[i][a]&&(n.beginFill(0,100),n.moveTo(s,o),n.lineTo(s+1,o),n.lineTo(s+1,o+1),n.lineTo(s,o+1),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=0==t%2);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=0==e%2)},setupPositionAdjustPattern:function(){for(var t=u.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],i=t[r];if(null==this.modules[n][i])for(var o=-2;2>=o;o++)for(var a=-2;2>=a;a++)this.modules[n+o][i+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a}},setupTypeNumber:function(t){for(var e=u.getBCHTypeNumber(this.typeNumber),r=0;18>r;r++){var n=!t&&1==(1&e>>r);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;18>r;r++){n=!t&&1==(1&e>>r);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,n=u.getBCHTypeInfo(r),i=0;15>i;i++){var o=!t&&1==(1&n>>i);6>i?this.modules[i][8]=o:8>i?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;15>i;i++){o=!t&&1==(1&n>>i);8>i?this.modules[8][this.moduleCount-i-1]=o:9>i?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,n=this.moduleCount-1,i=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[n][a-s]){var l=!1;o<t.length&&(l=1==(1&t[o]>>>i));u.getMask(e,n,a-s)&&(l=!l),this.modules[n][a-s]=l,-1==--i&&(o++,i=7)}if(0>(n+=r)||this.moduleCount<=n){n-=r,r=-r;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,r,o){for(var a=n.getRSBlocks(t,r),s=new i,l=0;l<o.length;l++){var c=o[l];s.put(c.mode,4),s.put(c.getLength(),u.getLengthInBits(c.mode,t)),c.write(s)}var h=0;for(l=0;l<a.length;l++)h+=a[l].dataCount;if(s.getLengthInBits()>8*h)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*h+")");for(s.getLengthInBits()+4<=8*h&&s.put(0,4);0!=s.getLengthInBits()%8;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*h)&&(s.put(e.PAD0,8),!(s.getLengthInBits()>=8*h));)s.put(e.PAD1,8);return e.createBytes(s,a)},e.createBytes=function(t,e){for(var n=0,i=0,o=0,a=new Array(e.length),s=new Array(e.length),l=0;l<e.length;l++){var c=e[l].dataCount,h=e[l].totalCount-c;i=Math.max(i,c),o=Math.max(o,h),a[l]=new Array(c);for(var d=0;d<a[l].length;d++)a[l][d]=255&t.buffer[d+n];n+=c;var p=u.getErrorCorrectPolynomial(h),f=new r(a[l],p.getLength()-1).mod(p);s[l]=new Array(p.getLength()-1);for(d=0;d<s[l].length;d++){var g=d+f.getLength()-s[l].length;s[l][d]=g>=0?f.get(g):0}}var y=0;for(d=0;d<e.length;d++)y+=e[d].totalCount;var m=new Array(y),C=0;for(d=0;i>d;d++)for(l=0;l<e.length;l++)d<a[l].length&&(m[C++]=a[l][d]);for(d=0;o>d;d++)for(l=0;l<e.length;l++)d<s[l].length&&(m[C++]=s[l][d]);return m};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;u.getBCHDigit(e)-u.getBCHDigit(u.G15)>=0;)e^=u.G15<<u.getBCHDigit(e)-u.getBCHDigit(u.G15);return(t<<10|e)^u.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;u.getBCHDigit(e)-u.getBCHDigit(u.G18)>=0;)e^=u.G18<<u.getBCHDigit(e)-u.getBCHDigit(u.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return u.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case c.PATTERN000:return 0==(e+r)%2;case c.PATTERN001:return 0==e%2;case c.PATTERN010:return 0==r%3;case c.PATTERN011:return 0==(e+r)%3;case c.PATTERN100:return 0==(Math.floor(e/2)+Math.floor(r/3))%2;case c.PATTERN101:return 0==e*r%2+e*r%3;case c.PATTERN110:return 0==(e*r%2+e*r%3)%2;case c.PATTERN111:return 0==(e*r%3+(e+r)%2)%2;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new r([1],0),n=0;t>n;n++)e=e.multiply(new r([1,h.gexp(n)],0));return e},getLengthInBits:function(t,e){if(e>=1&&10>e)switch(t){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,n=0;e>n;n++)for(var i=0;e>i;i++){for(var o=0,a=t.isDark(n,i),s=-1;1>=s;s++)if(!(0>n+s||n+s>=e))for(var l=-1;1>=l;l++)0>i+l||i+l>=e||(0!=s||0!=l)&&a==t.isDark(n+s,i+l)&&o++;o>5&&(r+=3+o-5)}for(n=0;e-1>n;n++)for(i=0;e-1>i;i++){var c=0;t.isDark(n,i)&&c++,t.isDark(n+1,i)&&c++,t.isDark(n,i+1)&&c++,t.isDark(n+1,i+1)&&c++,(0==c||4==c)&&(r+=3)}for(n=0;e>n;n++)for(i=0;e-6>i;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(r+=40);for(i=0;e>i;i++)for(n=0;e-6>n;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(r+=40);var u=0;for(i=0;e>i;i++)for(n=0;e>n;n++)t.isDark(n,i)&&u++;return r+10*(Math.abs(100*u/e/e-50)/5)}},h={glog:function(t){if(1>t)throw new Error("glog("+t+")");return h.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return h.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},d=0;8>d;d++)h.EXP_TABLE[d]=1<<d;for(d=8;256>d;d++)h.EXP_TABLE[d]=h.EXP_TABLE[d-4]^h.EXP_TABLE[d-5]^h.EXP_TABLE[d-6]^h.EXP_TABLE[d-8];for(d=0;255>d;d++)h.LOG_TABLE[h.EXP_TABLE[d]]=d;r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<t.getLength();i++)e[n+i]^=h.gexp(h.glog(this.get(n))+h.glog(t.get(i)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=h.glog(this.get(0))-h.glog(t.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(i=0;i<t.getLength();i++)n[i]^=h.gexp(h.glog(t.get(i))+e);return new r(n,0).mod(t)}},n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],n.getRSBlocks=function(t,e){var r=n.getRsBlockTable(t,e);if(null==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var i=r.length/3,o=[],a=0;i>a;a++)for(var s=r[3*a+0],l=r[3*a+1],c=r[3*a+2],u=0;s>u;u++)o.push(new n(l,c));return o},n.getRsBlockTable=function(t,e){switch(e){case l.L:return n.RS_BLOCK_TABLE[4*(t-1)+0];case l.M:return n.RS_BLOCK_TABLE[4*(t-1)+1];case l.Q:return n.RS_BLOCK_TABLE[4*(t-1)+2];case l.H:return n.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},i.prototype={get:function(t){var e=Math.floor(t/8);return 1==(1&this.buffer[e]>>>7-t%8)},put:function(t,e){for(var r=0;e>r;r++)this.putBit(1==(1&t>>>e-r-1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],f=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)e.hasOwnProperty(n)&&r.setAttribute(n,e[n]);return r}var r=this._htOption,n=this._el,i=t.getModuleCount();Math.floor(r.width/i),Math.floor(r.height/i),this.clear();var o=e("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:r.colorLight});o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(o),o.appendChild(e("rect",{fill:r.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;i>a;a++)for(var s=0;i>s;s++)if(t.isDark(a,s)){var l=e("use",{x:String(a),y:String(s)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),o.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),g="svg"===document.documentElement.tagName.toLowerCase()?f:"undefined"!=typeof CanvasRenderingContext2D?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,n,i,o,a,s,l,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===c&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);r.apply(this,arguments)}}var n=function(t,e){this._bIsPainted=!1,this._android=o(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(t){var e=this._elImage,r=this._oContext,n=this._htOption,i=t.getModuleCount(),o=n.width/i,a=n.height/i,s=Math.round(o),l=Math.round(a);e.style.display="none",this.clear();for(var c=0;i>c;c++)for(var u=0;i>u;u++){var h=t.isDark(c,u),d=u*o,p=c*a;r.strokeStyle=h?n.colorDark:n.colorLight,r.lineWidth=1,r.fillStyle=h?n.colorDark:n.colorLight,r.fillRect(d,p,o,a),r.strokeRect(Math.floor(d)+.5,Math.floor(p)+.5,s,l),r.strokeRect(Math.ceil(d)-.5,Math.ceil(p)-.5,s,l)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var r=this;if(r._fFail=e,r._fSuccess=t,null===r._bSupportDataURI){var n=document.createElement("img"),i=function(){r._bSupportDataURI=!1,r._fFail&&_fFail.call(r)};return n.onabort=i,n.onerror=i,n.onload=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)},void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===r._bSupportDataURI&&r._fSuccess?r._fSuccess.call(r):!1===r._bSupportDataURI&&r._fFail&&r._fFail.call(r)}.call(this,t)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},n}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,r=this._el,n=t.getModuleCount(),i=Math.floor(e.width/n),o=Math.floor(e.height/n),a=['<table style="border:0;border-collapse:collapse;">'],s=0;n>s;s++){a.push("<tr>");for(var l=0;n>l;l++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+o+"px;background-color:"+(t.isDark(s,l)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),r.innerHTML=a.join("");var c=r.childNodes[0],u=(e.width-c.offsetWidth)/2,h=(e.height-c.offsetHeight)/2;u>0&&h>0&&(c.style.margin=h+"px "+u+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();(QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof e&&(e={text:e}),e)for(var r in e)this._htOption[r]=e[r];"string"==typeof t&&(t=document.getElementById(t)),this._android=o(),this._el=t,this._oQRCode=null,this._oDrawing=new g(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(a(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();(void 0!==define&&define.amd?define:function(t,e){var r,n=e();if(void 0!==exports)for(r in n)exports[r]=n[r];else window.jsonpack=n})([],function(){var t=-4,e=function(t){return"string"!=typeof t?t:t.replace(/[\+ \|\^\%]/g,function(t){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[t]})},r=function(t){return"string"!=typeof t?t:t.replace(/\+|%2B|%7C|%5E|%25/g,function(t){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[t]})},n=function(t){return Number.prototype.toString.call(t,36).toUpperCase()},i=function(t){return parseInt(t,36)},o=Array.prototype.indexOf||function(t,e){for(var r=e||0,n=this.length;r<n;r++)if(this[r]===t)return r;return-1};return{JSON:JSON,pack:function(r,i){var a,s,l;(a=(i=i||{}).verbose||!1)&&console.log("Normalize the JSON Object");r="string"==typeof r?this.JSON.parse(r):r;a&&console.log("Creating a empty dictionary");s={strings:[],integers:[],floats:[]};a&&console.log("Creating the AST");var c=function r(i){var l,c,u,h,d;if(a&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(i)),l=typeof i,null===i)return{type:"null",index:-3};if(void 0===i)return{type:"undefined",index:-5};if(i instanceof Array){u=["@"];for(c in i)i.hasOwnProperty(c)&&u.push(r(i[c]));return u}if("object"===l){u=["$"];for(h in i)i.hasOwnProperty(h)&&(u.push(r(h)),u.push(r(i[h])));return u}if(""===i)return{type:"empty",index:t};if("string"===l)return-1==(d=o.call(s.strings,i))&&(s.strings.push(e(i)),d=s.strings.length-1),{type:"strings",index:d};if("number"===l&&i%1==0)return-1==(d=o.call(s.integers,i))&&(s.integers.push(n(i)),d=s.integers.length-1),{type:"integers",index:d};if("number"===l)return-1==(d=o.call(s.floats,i))&&(s.floats.push(i),d=s.floats.length-1),{type:"floats",index:d};if("boolean"===l)return{type:"boolean",index:i?-1:-2};throw new Error("Unexpected argument of type "+typeof i)}(r),u=s.strings.length,h=s.integers.length;s.floats.length;return a&&console.log("Parsing the dictionary"),l=s.strings.join("|"),l+="^"+s.integers.join("|"),l+="^"+s.floats.join("|"),a&&console.log("Parsing the structure"),l+="^"+function e(r){var i,o,s,l;if(a&&console.log("Calling a recursiveParser with "+this.JSON.stringify(r)),r instanceof Array){i=r.shift();for(o in r)r.hasOwnProperty(o)&&(i+=e(r[o])+"|");return("|"===i[i.length-1]?i.slice(0,-1):i)+"]"}if(s=r.type,l=r.index,"strings"===s)return n(l);if("integers"===s)return n(u+l);if("floats"===s)return n(u+h+l);if("boolean"===s)return r.index;if("null"===s)return-3;if("undefined"===s)return-5;if("empty"===s)return t;throw new TypeError("The item is alien!")}(c),a&&console.log("Ending parser"),i.debug?{dictionary:s,ast:c,packed:l}:l},unpack:function(e,n){var o,a,s,l,c,u,h,d;if(n=n||{},o=e.split("^"),n.verbose&&console.log("Building dictionary"),a=[],""!==(s=o[0]))for(s=s.split("|"),n.verbose&&console.log("Parse the strings dictionary"),c=0,l=s.length;c<l;c++)a.push(r(s[c]));if(""!==(s=o[1]))for(s=s.split("|"),n.verbose&&console.log("Parse the integers dictionary"),c=0,l=s.length;c<l;c++)a.push(i(s[c]));if(""!==(s=o[2]))for(s=s.split("|"),n.verbose&&console.log("Parse the floats dictionary"),c=0,l=s.length;c<l;c++)a.push(parseFloat(s[c]));s=null;n.verbose&&console.log("Tokenizing the structure");var p="",f=[],g=o[3].length;for(c=0;c<g;c++)"|"===(u=o[3].charAt(c))||"$"===u||"@"===u||"]"===u?(p&&(f.push(i(p)),p=""),"|"!==u&&f.push(u)):p+=u;return h=f.length,d=0,n.verbose&&console.log("Starting recursive parser"),function e(){var r,i,o,s=f[d++];if(n.verbose&&console.log("Reading collection type "+("$"===s?"object":"Array")),"@"===s){for(r=[];d<h;d++){if(o=f[d],n.verbose&&console.log("Read "+o+" symbol"),"]"===o)return r;if("@"===o||"$"===o)r.push(e());else switch(o){case-1:r.push(!0);break;case-2:r.push(!1);break;case-3:r.push(null);break;case-5:r.push(void 0);break;case t:r.push("");break;default:r.push(a[o])}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(r)),r}if("$"===s){for(r={};d<h;d++){if("]"===(i=f[d]))return r;if(i=i===t?"":a[i],"@"===(o=f[++d])||"$"===o)r[i]=e();else switch(o){case-1:r[i]=!0;break;case-2:r[i]=!1;break;case-3:r[i]=null;break;case-5:r[i]=void 0;break;case t:r[i]="";break;default:r[i]=a[o]}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(r)),r}throw new TypeError("Bad token "+s+" isn't a type")}()}}});!function(t,e){"use strict";var r="model",n="name",i="type",o="vendor",a="version",s="mobile",l="tablet",c="smarttv",u={extend:function(t,e){var r={};for(var n in t)e[n]&&e[n].length%2==0?r[n]=e[n].concat(t[n]):r[n]=t[n];return r},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},h={rgx:function(t,e){for(var r,n,i,o,a,s,l=0;l<e.length&&!a;){var c=e[l],u=e[l+1];r=n=0;for(;r<c.length&&!a;)if(a=c[r++].exec(t))for(i=0;i<u.length;i++){s=a[++n];"object"==typeof(o=u[i])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0}l+=2}},str:function(t,e){for(var r in e)if("object"==typeof e[r]&&e[r].length>0){for(var n=0;n<e[r].length;n++)if(u.has(e[r][n],t))return"?"===r?void 0:r}else if(u.has(e[r],t))return"?"===r?void 0:r;return t}},d={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[n,a],[/(opios)[\/\s]+([\w\.]+)/i],[[n,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[n,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[n,a],[/(konqueror)\/([\w\.]+)/i],[[n,"Konqueror"],a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[n,"IE"],a],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[n,"Edge"],a],[/(yabrowser)\/([\w\.]+)/i],[[n,"Yandex"],a],[/(Avast)\/([\w\.]+)/i],[[n,"Avast Secure Browser"],a],[/(AVG)\/([\w\.]+)/i],[[n,"AVG Secure Browser"],a],[/(puffin)\/([\w\.]+)/i],[[n,"Puffin"],a],[/(focus)\/([\w\.]+)/i],[[n,"Firefox Focus"],a],[/(opt)\/([\w\.]+)/i],[[n,"Opera Touch"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[n,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[n,/_/g," "],a],[/(windowswechat qbcore)\/([\w\.]+)/i],[[n,"WeChat(Win) Desktop"],a],[/(micromessenger)\/([\w\.]+)/i],[[n,"WeChat"],a],[/(brave)\/([\w\.]+)/i],[[n,"Brave"],a],[/(qqbrowserlite)\/([\w\.]+)/i],[n,a],[/(QQ)\/([\d\.]+)/i],[n,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[n,a],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[n,a],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[n,a],[/(MetaSr)[\/\s]?([\w\.]+)/i],[n],[/(LBBROWSER)/i],[n],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[n,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[n,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[n,a],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[n,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[n,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[n,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[n,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[n,"Sailfish Browser"],a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[n,a],[/(dolfin)\/([\w\.]+)/i],[[n,"Dolphin"],a],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[n,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[n,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[n,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[n,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[n,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,n],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[n,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[n,[a,h.str,d.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[n,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[n,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[n,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",u.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",u.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[r,o,[i,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[o,"Apple"],[i,l]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[o,"Apple"],[i,c]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,r,[i,l]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[r,[o,"Amazon"],[i,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[r,h.str,d.device.amazon.model],[o,"Amazon"],[i,s]],[/android.+aft([bms])\sbuild/i],[r,[o,"Amazon"],[i,c]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,o,[i,s]],[/\((ip[honed|\s\w*]+);/i],[r,[o,"Apple"],[i,s]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,r,[i,s]],[/\(bb10;\s(\w+)/i],[r,[o,"BlackBerry"],[i,s]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[r,[o,"Asus"],[i,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[r,"Xperia Tablet"],[i,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[r,[o,"Sony"],[i,s]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,r,[i,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[o,"Nvidia"],[i,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[o,"Sony"],[i,"console"]],[/(sprint\s(\w+))/i],[[o,h.str,d.device.sprint.vendor],[r,h.str,d.device.sprint.model],[i,s]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[o,[r,/_/g," "],[i,s]],[/(nexus\s9)/i],[r,[o,"HTC"],[i,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[r,[o,"Huawei"],[i,s]],[/android.+(bah2?-a?[lw]\d{2})/i],[r,[o,"Huawei"],[i,l]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,r,[i,s]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[o,"Microsoft"],[i,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[o,"Microsoft"],[i,s]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[o,"Motorola"],[i,s]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[o,"Motorola"],[i,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,u.trim],[r,u.trim],[i,c]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[o,"Samsung"],[i,c]],[/\(dtv[\);].+(aquos)/i],[r,[o,"Sharp"],[i,c]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],r,[i,l]],[/smart-tv.+(samsung)/i],[o,[i,c],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[o,"Samsung"],r,[i,s]],[/sie-(\w*)/i],[r,[o,"Siemens"],[i,s]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[o,"Nokia"],r,[i,s]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[r,[o,"Acer"],[i,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[o,"LG"],[i,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],r,[i,l]],[/(lg) netcast\.tv/i],[o,r,[i,c]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[o,"LG"],[i,s]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[o,r,[i,l]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[o,"Lenovo"],[i,l]],[/(lenovo)[_\s-]?([\w-]+)/i],[o,r,[i,s]],[/linux;.+((jolla));/i],[o,r,[i,s]],[/((pebble))app\/[\d\.]+\s/i],[o,r,[i,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,r,[i,s]],[/crkey/i],[[r,"Chromecast"],[o,"Google"],[i,c]],[/android.+;\s(glass)\s\d/i],[r,[o,"Google"],[i,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[r,[o,"Google"],[i,l]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[r,[o,"Google"],[i,s]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[o,"Xiaomi"],[i,s]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[o,"Xiaomi"],[i,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[o,"Meizu"],[i,s]],[/(mz)-([\w-]{2,})/i],[[o,"Meizu"],r,[i,s]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[r,[o,"OnePlus"],[i,s]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[o,"RCA"],[i,l]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[r,[o,"Dell"],[i,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[o,"Verizon"],[i,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],r,[i,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[o,"NuVision"],[i,l]],[/android.+;\s(k88)\sbuild/i],[r,[o,"ZTE"],[i,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[o,"Swiss"],[i,s]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[o,"Swiss"],[i,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[o,"Zeki"],[i,l]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[o,"Dragon Touch"],r,[i,l]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[r,[o,"Insignia"],[i,l]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[r,[o,"NextBook"],[i,l]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],r,[i,s]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[o,"LvTel"],r,[i,s]],[/android.+;\s(PH-1)\s/i],[r,[o,"Essential"],[i,s]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[o,"Envizen"],[i,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[o,r,[i,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[o,"MachSpeed"],[i,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,r,[i,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[o,"Rotor"],[i,l]],[/android.+(KS(.+))\s+build/i],[r,[o,"Amazon"],[i,l]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[o,r,[i,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,u.lowerize],o,r],[/[\s\/\(](smart-?tv)[;\)]/i],[[i,c]],[/(android[\w\.\s\-]{0,9});.+build/i],[r,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[n,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[a,[n,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,a],[/rv\:([\w\.]{1,9}).+(gecko)/i],[a,n]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[n,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[a,h.str,d.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[a,h.str,d.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[n,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[n,"Symbian"],a],[/\((series40);/i],[n],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[n,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],a],[/(sunos)\s?([\w\.\d]*)/i],[[n,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[n,a],[/(haiku)\s(\w+)/i],[n,a],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[n,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[n,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[n,a]]},f=function(e,r){if("object"==typeof e){r=e;e=void 0}if(!(this instanceof f))return new f(e,r).getResult();var n=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),i=r?u.extend(p,r):p;this.getBrowser=function(){var t={name:void 0,version:void 0};h.rgx.call(t,n,i.browser);t.major=u.major(t.version);return t};this.getCPU=function(){var t={architecture:void 0};h.rgx.call(t,n,i.cpu);return t};this.getDevice=function(){var t={vendor:void 0,model:void 0,type:void 0};h.rgx.call(t,n,i.device);return t};this.getEngine=function(){var t={name:void 0,version:void 0};h.rgx.call(t,n,i.engine);return t};this.getOS=function(){var t={name:void 0,version:void 0};h.rgx.call(t,n,i.os);return t};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return n};this.setUA=function(t){n=t;return this};return this};f.VERSION="0.7.21";f.BROWSER={NAME:n,MAJOR:"major",VERSION:a};f.CPU={ARCHITECTURE:"architecture"};f.DEVICE={MODEL:r,VENDOR:o,TYPE:i,CONSOLE:"console",MOBILE:s,SMARTTV:c,TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"};f.ENGINE={NAME:n,VERSION:a};f.OS={NAME:n,VERSION:a};if(void 0!==exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=f);exports.UAParser=f}else"function"==typeof define&&define.amd?define(function(){return f}):t&&(t.UAParser=f);var g=t&&(t.jQuery||t.Zepto);if(g&&!g.ua){var y=new f;g.ua=y.getResult();g.ua.get=function(){return y.getUA()};g.ua.set=function(t){y.setUA(t);var e=y.getResult();for(var r in e)g.ua[r]=e[r]}}}("object"==typeof window?window:this);!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.proj4=e()}(this,function(){"use strict";function t(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(Z,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(Z,"")===i)return t[r]}function e(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Q}function r(t){return new e(t).output()}function n(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=e?{}:t,o=r.reduce(function(t,e){return i(e,t),t},n);e&&(t[e]=o)}function i(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void i(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){Array.isArray(r)||(e[r]={});var o;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&i(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&i(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void n(e,r,t);default:for(o=-1;++o<t.length;)if(!Array.isArray(t[o]))return i(t,e[r]);return n(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}function o(t){return t*ot}function a(t){function e(e){return e*(t.to_meter||1)}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var r=t.GEOGCS;"GEOGCS"===t.type&&(r=t),r&&(r.DATUM?t.datumCode=r.DATUM.name.toLowerCase():t.datumCode=r.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(t.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=r.DATUM.SPHEROID.a,t.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),r.DATUM&&r.DATUM.TOWGS84&&(t.datum_params=r.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",o],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["azimuth","Azimuth"],["alpha","azimuth",o],["srsCode","name"]].forEach(function(e){return function(t,e){var r=e[0],n=e[1];!(r in t)&&n in t&&(t[r]=t[n],3===e.length&&(t[r]=e[2](t[r])))}(t,e)}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=o(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function s(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?s[t]=J(arguments[1]):s[t]=at(arguments[1]):s[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?s.apply(e,t):s(t)});if("string"==typeof t){if(t in s)return s[t]}else"EPSG"in t?s["EPSG:"+t.EPSG]=t:"ESRI"in t?s["ESRI:"+t.ESRI]=t:"IAU2000"in t?s["IAU2000:"+t.IAU2000]=t:console.log(t);return}}function l(e){var r=t(e,"authority");if(r){var n=t(r,"epsg");return n&&lt.indexOf(n)>-1}}function c(e){var r=t(e,"extension");if(r)return t(r,"proj4")}function u(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in s}(t))return s[t];if(function(t){return st.some(function(e){return t.indexOf(e)>-1})}(t)){var e=at(t);if(l(e))return s["EPSG:3857"];var r=c(e);return r?J(r):e}return function(t){return"+"===t[0]}(t)?J(t):void 0}function h(t){return t}function d(t,e){var r=mt.length;return t.names?(mt[r]=t,t.names.forEach(function(t){yt[t.toLowerCase()]=r}),this):(console.log(e),!0)}function p(e,r){if(!(this instanceof p))return new p(e);r=r||function(t){if(t)throw t};var n=u(e);if("object"==typeof n){var i=p.projections.get(n.projName);if(i){if(n.datumCode&&"none"!==n.datumCode){var o=t(_t,n.datumCode);o&&(n.datum_params=o.towgs84?o.towgs84.split(","):null,n.ellps=o.ellipse,n.datumName=o.datumName?o.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84";var a=function(e,r,n,i,o){if(!e){var a=t(vt,i);a||(a=Tt),e=a.a,r=a.b,n=a.rf}return n&&!r&&(r=(1-1/n)*e),(0===n||Math.abs(e-r)<W)&&(o=!0,r=e),{a:e,b:r,rf:n,sphere:o}}(n.a,n.b,n.rf,n.ellps,n.sphere),s=function(t,e,r,n){var i=t*t,o=e*e,a=(i-o)/i,s=0;return n?(i=(t*=1-a*(U+a*(j+a*q)))*t,a=0):s=Math.sqrt(a),{es:a,e:s,ep2:(i-o)/o}}(a.a,a.b,a.rf,n.R_A),l=n.datum||function(t,e,r,n,i,o){var a={};return a.datum_type=void 0===t||"none"===t?F:D,e&&(a.datum_params=e.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=k),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=N,a.datum_params[3]*=B,a.datum_params[4]*=B,a.datum_params[5]*=B,a.datum_params[6]=a.datum_params[6]/1e6+1))),a.a=r,a.b=n,a.es=i,a.ep2=o,a}(n.datumCode,n.datum_params,a.a,a.b,s.es,s.ep2);ct(this,n),ct(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=l,this.init(),r(null,this)}else r(e)}else r(e)}function f(t,e,r){var n,i,o,a,s=t.x,l=t.y,c=t.z?t.z:0;if(l<-G&&l>-1.001*G)l=-G;else if(l>G&&l<1.001*G)l=G;else{if(l<-G)return{x:-1/0,y:-1/0,z:t.z};if(l>G)return{x:1/0,y:1/0,z:t.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),o=i*i,{x:((n=r/Math.sqrt(1-e*o))+c)*a*Math.cos(s),y:(n+c)*a*Math.sin(s),z:(n*(1-e)+c)*i}}function g(t,e,r,n){var i,o,a,s,l,c,u,h,d,p,f,g,y,m,C,v=t.x,T=t.y,_=t.z?t.z:0;if(i=Math.sqrt(v*v+T*T),o=Math.sqrt(v*v+T*T+_*_),i/r<1e-12){if(m=0,o/r<1e-12)return G,C=-n,{x:t.x,y:t.y,z:t.z}}else m=Math.atan2(T,v);a=_/o,h=(s=i/o)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*s*s)),d=a*l,y=0;do{y++,c=e*(u=r/Math.sqrt(1-e*d*d))/(u+(C=i*h+_*d-u*(1-e*d*d))),g=(f=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(p=s*(1-c)*l)*d,h=p,d=f}while(g*g>1e-24&&y<30);return{x:m,y:Math.atan(f/Math.abs(p)),z:C}}function y(t){return t===k||t===N}function m(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function C(t,e,r){var n;return Array.isArray(r)&&(r=wt(r)),bt(r),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===k||t.datum.datum_type===N)&&"WGS84"!==e.datumCode||(e.datum.datum_type===k||e.datum.datum_type===N)&&"WGS84"!==t.datumCode}(t,e)&&(r=C(t,n=new p("WGS84"),r),t=n),"enu"!==t.axis&&(r=Et(t,!1,r)),"longlat"===t.projName?r={x:r.x*H,y:r.y*H,z:r.z||0}:(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),r=t.inverse(r)),t.from_greenwich&&(r.x+=t.from_greenwich),r=St(t.datum,e.datum,r),e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*V,y:r.y*V,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),"enu"!==e.axis?Et(e,!0,r):r}function v(t,e,r){var n,i,o;return Array.isArray(r)?(n=C(t,e,r)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof n.z?[n.x,n.y,n.z].concat(r.splice(3)):[n.x,n.y,r[2]].concat(r.splice(3)):[n.x,n.y].concat(r.splice(2)):[n.x,n.y]):(i=C(t,e,r),2===(o=Object.keys(r)).length?i:(o.forEach(function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;i[n]=r[n]}),i))}function T(t){return t instanceof p?t:t.oProj?t.oProj:p(t)}function _(t,e,r){t=T(t);var n,i=!1;return void 0===e?(e=t,t=Lt,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=Lt,i=!0),e=T(e),r?v(t,e,r):(n={forward:function(r){return v(t,e,r)},inverse:function(r){return v(e,t,r)}},i&&(n.oProj=e),n)}function S(t,e){return e=e||5,function(t,e){var r="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+function(t,e,r){var n=x(r);return function(t,e,r){var n=r-1,i=xt.charCodeAt(n),o=Pt.charCodeAt(n),a=i+t-1,s=o+e,l=!1;return a>kt&&(a=a-kt+It-1,l=!0),(a===Rt||i<Rt&&a>Rt||(a>Rt||i<Rt)&&l)&&a++,(a===Ot||i<Ot&&a>Ot||(a>Ot||i<Ot)&&l)&&++a===Rt&&a++,a>kt&&(a=a-kt+It-1),s>Mt?(s=s-Mt+It-1,l=!0):l=!1,(s===Rt||o<Rt&&s>Rt||(s>Rt||o<Rt)&&l)&&s++,(s===Ot||o<Ot&&s>Ot||(s>Ot||o<Ot)&&l)&&++s===Rt&&s++,s>Mt&&(s=s-Mt+It-1),String.fromCharCode(a)+String.fromCharCode(s)}(Math.floor(t/1e5),Math.floor(e/1e5)%20,n)}(t.easting,t.northing,t.zoneNumber)+r.substr(r.length-5,e)+n.substr(n.length-5,e)}(function(t){var e,r,n,i,o,a,s=t.lat,l=t.lon,c=6378137,u=w(s),h=w(l);a=Math.floor((l+180)/6)+1,180===l&&(a=60),s>=56&&s<64&&l>=3&&l<12&&(a=32),s>=72&&s<84&&(l>=0&&l<9?a=31:l>=9&&l<21?a=33:l>=21&&l<33?a=35:l>=33&&l<42&&(a=37)),o=w(6*(a-1)-180+3),e=c/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),r=Math.tan(u)*Math.tan(u),n=.006739496752268451*Math.cos(u)*Math.cos(u);var d=.9996*e*((i=Math.cos(u)*(h-o))+(1-r+n)*i*i*i/6+(5-18*r+r*r+72*n-.39089081163157013)*i*i*i*i*i/120)+5e5,p=.9996*(c*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u))+e*Math.tan(u)*(i*i/2+(5-r+9*n+4*n*n)*i*i*i*i/24+(61-58*r+r*r+600*n-2.2240339282485886)*i*i*i*i*i*i/720));return s<0&&(p+=1e7),{northing:Math.round(p),easting:Math.round(d),zoneNumber:a,zoneLetter:A(s)}}({lat:t[1],lon:t[0]}),e)}function E(t){var e=L(P(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function w(t){return t*(Math.PI/180)}function b(t){return t/Math.PI*180}function L(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,h,d,p=6378137,f=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),g=r-5e5,y=e;n<"N"&&(y-=1e7),u=6*(i-1)-180+3,d=(h=y/.9996/6367449.145945056)+(3*f/2-27*f*f*f/32)*Math.sin(2*h)+(21*f*f/16-55*f*f*f*f/32)*Math.sin(4*h)+151*f*f*f/96*Math.sin(6*h),o=p/Math.sqrt(1-.00669438*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),s=.006739496752268451*Math.cos(d)*Math.cos(d),l=.99330562*p/Math.pow(1-.00669438*Math.sin(d)*Math.sin(d),1.5),c=g/(.9996*o);var m=d-o*Math.tan(d)/l*(c*c/2-(5+3*a+10*s-4*s*s-.06065547077041606)*c*c*c*c/24+(61+90*a+298*s+45*a*a-1.6983531815716497-3*s*s)*c*c*c*c*c*c/720);m=b(m);var C,v=(c-(1+2*a+s)*c*c*c/6+(5-2*s+28*a-3*s*s+.05391597401814761+24*a*a)*c*c*c*c*c/120)/Math.cos(d);v=u+b(v);if(t.accuracy){var T=L({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});C={top:T.lat,right:T.lon,bottom:m,left:v}}else C={lat:m,lon:v};return C}function A(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function x(t){var e=t%At;return 0===e&&(e=At),e}function P(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,o++}var a=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(o,o+=2);for(var l=x(a),c=function(t,e){for(var r=xt.charCodeAt(e-1),n=1e5,i=!1;r!==t.charCodeAt(0);){if(++r===Rt&&r++,r===Ot&&r++,r>kt){if(i)throw"Bad character: "+t;r=It,i=!0}n+=1e5}return n}(n.charAt(0),l),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=Pt.charCodeAt(e-1),n=0,i=!1;r!==t.charCodeAt(0);){if(++r===Rt&&r++,r===Ot&&r++,r>Mt){if(i)throw"Bad character: "+t;r=It,i=!0}n+=1e5}return n}(n.charAt(1),l);u<I(s);)u+=2e6;var h=r-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,p,f,g=h/2,y=0,m=0;return g>0&&(d=1e5/Math.pow(10,g),p=t.substring(o,o+g),y=parseFloat(p)*d,f=t.substring(o+g),m=parseFloat(f)*d),{easting:y+c,northing:m+u,zoneLetter:s,zoneNumber:a,accuracy:d}}function I(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function R(t,e,r){if(!(this instanceof R))return new R(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function O(t,e,r,n){var i;return t<W?(n.value=Ue.AREA_0,i=0):(i=Math.atan2(e,r),Math.abs(i)<=Y?n.value=Ue.AREA_0:i>Y&&i<=G+Y?(n.value=Ue.AREA_1,i-=G):i>G+Y||i<=-(G+Y)?(n.value=Ue.AREA_2,i=i>=0?i-K:i+K):(n.value=Ue.AREA_3,i+=G)),i}function M(t,e){var r=t+e;return r<-K?r+=z:r>+K&&(r-=z),r}var k=1,N=2,D=4,F=5,B=484813681109536e-20,G=Math.PI/2,U=.16666666666666666,j=.04722222222222222,q=.022156084656084655,W=1e-10,H=.017453292519943295,V=57.29577951308232,Y=Math.PI/4,z=2*Math.PI,K=3.14159265359,$={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},X={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Z=/[\s_\-\/\(\)]/g,J=function(e){var r,n,i,o={},a=e.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t},{}),s={proj:"projName",datum:"datumCode",rf:function(t){o.rf=parseFloat(t)},lat_0:function(t){o.lat0=t*H},lat_1:function(t){o.lat1=t*H},lat_2:function(t){o.lat2=t*H},lat_ts:function(t){o.lat_ts=t*H},lon_0:function(t){o.long0=t*H},lon_1:function(t){o.long1=t*H},lon_2:function(t){o.long2=t*H},alpha:function(t){o.alpha=parseFloat(t)*H},lonc:function(t){o.longc=t*H},x_0:function(t){o.x0=parseFloat(t)},y_0:function(t){o.y0=parseFloat(t)},k_0:function(t){o.k0=parseFloat(t)},k:function(t){o.k0=parseFloat(t)},a:function(t){o.a=parseFloat(t)},b:function(t){o.b=parseFloat(t)},r_a:function(){o.R_A=!0},zone:function(t){o.zone=parseInt(t,10)},south:function(){o.utmSouth=!0},towgs84:function(t){o.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){o.to_meter=parseFloat(t)},units:function(e){o.units=e;var r=t(X,e);r&&(o.to_meter=r.to_meter)},from_greenwich:function(t){o.from_greenwich=t*H},pm:function(e){var r=t($,e);o.from_greenwich=(r||parseFloat(e))*H},nadgrids:function(t){"@null"===t?o.datumCode="none":o.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(o.axis=t)}};for(r in a)n=a[r],r in s?"function"==typeof(i=s[r])?i(n):o[i]=n:o[r]=n;return"string"==typeof o.datumCode&&"WGS84"!==o.datumCode&&(o.datumCode=o.datumCode.toLowerCase()),o},Q=1,tt=/\s/,et=/[A-Za-z]/,rt=/[A-Za-z84]/,nt=/[,\]]/,it=/[\d\.E\-\+]/;e.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;tt.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Q:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},e.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(nt.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},e.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Q)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Q,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},e.prototype.number=function(t){if(!it.test(t)){if(nt.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},e.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},e.prototype.keyword=function(t){if(rt.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Q)}if(!nt.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},e.prototype.neutral=function(t){if(et.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(it.test(t))return this.word=t,void(this.state=3);if(!nt.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},e.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var ot=.017453292519943295,at=function(t){var e=r(t),n=e.shift(),o=e.shift();e.unshift(["name",o]),e.unshift(["type",n]);var s={};return i(e,s),a(s),s};!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(s);var st=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],lt=["3857","900913","3785","102113"],ct=function(t,e){t=t||{};var r,n;if(!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t},ut=function(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)},ht=function(t){return t<0?-1:1},dt=function(t){return Math.abs(t)<=K?t:t-ht(t)*z},pt=function(t,e,r){var n=t*r,i=.5*t;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(G-e))/n},ft=function(t,e){for(var r,n,i=.5*t,o=G-2*Math.atan(e),a=0;a<=15;a++)if(r=t*Math.sin(o),o+=n=G-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999},gt=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,n=t.x,i=t.y;if(i*V>90&&i*V<-90&&n*V>180&&n*V<-180)return null;if(Math.abs(Math.abs(i)-G)<=W)return null;if(this.sphere)e=this.x0+this.a*this.k0*dt(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Y+.5*i));else{var o=Math.sin(i),a=pt(this.e,i,o);e=this.x0+this.a*this.k0*dt(n-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=G-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=ft(this.e,o)))return null}return e=dt(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:h,inverse:h,names:["longlat","identity"]}],yt={},mt=[],Ct={start:function(){gt.forEach(d)},add:d,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==yt[e]&&mt[yt[e]]?mt[yt[e]]:void 0}},vt={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Tt=vt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};vt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var _t={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};p.projections=Ct,p.projections.start();var St=function(t,e,r){return function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===k?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==N||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e)?r:t.datum_type===F||e.datum_type===F?r:t.es!==e.es||t.a!==e.a||y(t.datum_type)||y(e.datum_type)?(r=f(r,t.es,t.a),y(t.datum_type)&&(r=function(t,e,r){if(e===k)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===N){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6];return{x:c*(t.x-l*t.y+s*t.z)+n,y:c*(l*t.x+t.y-a*t.z)+i,z:c*(-s*t.x+a*t.y+t.z)+o}}}(r,t.datum_type,t.datum_params)),y(e.datum_type)&&(r=function(t,e,r){if(e===k)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===N){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=(t.x-n)/c,h=(t.y-i)/c,d=(t.z-o)/c;return{x:u+l*h-s*d,y:-l*u+h+a*d,z:s*u-a*h+d}}}(r,e.datum_type,e.datum_params)),g(r,e.es,e.a,e.b)):r},Et=function(t,e,r){var n,i,o,a=r.x,s=r.y,l=r.z||0,c={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==r.z)switch(0===o?(n=a,i="x"):1===o?(n=s,i="y"):(n=l,i="z"),t.axis[o]){case"e":c[i]=n;break;case"w":c[i]=-n;break;case"n":c[i]=n;break;case"s":c[i]=-n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c},wt=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e},bt=function(t){m(t.x),m(t.y)},Lt=p("WGS84"),At=6,xt="AJSAJS",Pt="AFAFAF",It=65,Rt=73,Ot=79,Mt=86,kt=90,Nt={forward:S,inverse:function(t){var e=L(P(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:E};R.fromMGRS=function(t){return new R(E(t))},R.prototype.toMGRS=function(t){return S([this.x,this.y],t)};var Dt,Ft=.01068115234375,Bt=function(t){var e=[];e[0]=1-t*(.25+t*(.046875+t*(.01953125+t*Ft))),e[1]=t*(.75-t*(.046875+t*(.01953125+t*Ft)));var r=t*t;return e[2]=r*(.46875-t*(.013020833333333334+.007120768229166667*t)),r*=t,e[3]=r*(.3645833333333333-.005696614583333333*t),e[4]=r*t*.3076171875,e},Gt=function(t,e,r,n){return r*=e,e*=e,n[0]*t-r*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))},Ut=function(t,e,r){for(var n=1/(1-e),i=t,o=20;o;--o){var a=Math.sin(i),s=1-e*a*a;if(i-=s=(Gt(i,a,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<W)return i}return i},jt={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Bt(this.es),this.ml0=Gt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,n,i=t.x,o=t.y,a=dt(i-this.long0),s=Math.sin(o),l=Math.cos(o);if(this.es){var c=l*a,u=Math.pow(c,2),h=this.ep2*Math.pow(l,2),d=Math.pow(h,2),p=Math.abs(l)>W?Math.tan(o):0,f=Math.pow(p,2),g=Math.pow(f,2);e=1-this.es*Math.pow(s,2),c/=Math.sqrt(e);var y=Gt(o,s,l,this.en);r=this.a*(this.k0*c*(1+u/6*(1-f+h+u/20*(5-18*f+g+14*h-58*f*h+u/42*(61+179*g-g*f-479*f)))))+this.x0,n=this.a*(this.k0*(y-this.ml0+s*a*c/2*(1+u/12*(5-f+9*h+4*d+u/30*(61+g-58*f+270*h-330*f*h+u/56*(1385+543*g-g*f-3111*f))))))+this.y0}else{var m=l*Math.sin(a);if(Math.abs(Math.abs(m)-1)<W)return 93;if(r=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,n=l*Math.cos(a)/Math.sqrt(1-Math.pow(m,2)),(m=Math.abs(n))>=1){if(m-1>W)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t},inverse:function(t){var e,r,n,i,o=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,r=Ut(e,this.es,this.en),Math.abs(r)<G){var s=Math.sin(r),l=Math.cos(r),c=Math.abs(l)>W?Math.tan(r):0,u=this.ep2*Math.pow(l,2),h=Math.pow(u,2),d=Math.pow(c,2),p=Math.pow(d,2);e=1-this.es*Math.pow(s,2);var f=o*Math.sqrt(e)/this.k0,g=Math.pow(f,2);n=r-(e*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*d-9*u*d+u-4*h-g/30*(61+90*d-252*u*d+45*p+46*u-g/56*(1385+3633*d+4095*p+1574*p*d)))),i=dt(this.long0+f*(1-g/6*(1+2*d+u-g/20*(5+28*d+24*p+8*u*d+6*u-g/42*(61+662*d+1320*p+720*p*d))))/l)}else n=G*ht(a),i=0;else{var y=Math.exp(o/this.k0),m=.5*(y-1/y),C=this.lat0+a/this.k0,v=Math.cos(C);e=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(m,2))),n=Math.asin(e),a<0&&(n=-n),i=0===m&&0===v?0:dt(Math.atan2(m,v)+this.long0)}return t.x=i,t.y=n,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},qt=function(t){var e=Math.exp(t);return(e-1/e)/2},Wt=function(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))},Ht=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(Wt(1,e)+1))),t<0?-e:e},Vt=function(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return e+r*Math.sin(2*e)},Yt=function(t,e,r){for(var n,i,o=Math.sin(e),a=Math.cos(e),s=qt(r),l=function(t){var e=Math.exp(t);return(e+1/e)/2}(r),c=2*a*l,u=-2*o*s,h=t.length-1,d=t[h],p=0,f=0,g=0;--h>=0;)n=f,i=p,d=c*(f=d)-n-u*(p=g)+t[h],g=u*f-i+c*p;return[(c=o*l)*d-(u=a*s)*g,c*g+u*d]},zt={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var n=Vt(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return Math.sin(e)*r}(this.gtu,2*n))},forward:function(t){var e=dt(t.x-this.long0),r=t.y;r=Vt(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(e),a=Math.cos(e);r=Math.atan2(n,a*i),e=Math.atan2(o*i,Wt(n,i*a)),e=Ht(Math.tan(e));var s,l,c=Yt(this.gtu,2*r,2*e);r+=c[0],e+=c[1];return Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),t.x=s,t.y=l,t},inverse:function(t){var e,r,n=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,n/=this.Qn;if(Math.abs(n)<=2.623395162778){var o=Yt(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(qt(n));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(n),c=Math.cos(n);i=Math.atan2(a*c,Wt(l,c*s)),n=Math.atan2(l,c*s),e=dt(n+this.long0),r=Vt(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Kt={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(dt(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*H,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,zt.init.apply(this),this.forward=zt.forward,this.inverse=zt.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},$t=function(t,e){return Math.pow((1-t)/(1+t),e)},Xt={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Y)/(Math.pow(Math.tan(.5*this.lat0+Y),this.C)*$t(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+Y),this.C)*$t(this.e*Math.sin(r),this.ratexp))-G,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+Y)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*$t(this.e*Math.sin(t.y),-.5*this.e))-G,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]},Zt={init:function(){Xt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,n,i;return t.x=dt(t.x-this.long0),Xt.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n),t.x=i*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,n,i,o;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,o=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(o,this.R2);e=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/o),n=Math.atan2(t.x*e,o*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,Xt.inverse.apply(this,[t]),t.x=dt(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},Jt={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=W&&(this.k0=.5*(1+ht(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=W&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=W&&(this.k0=.5*this.cons*ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/pt(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ut(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-G,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,n,i,o,a,s=t.x,l=t.y,c=Math.sin(l),u=Math.cos(l),h=dt(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=W&&Math.abs(l+this.lat0)<=W?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(h)),t.x=this.a*e*u*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*c-this.sinlat0*u*Math.cos(h))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,c,this.e))-G,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=W?(o=pt(this.e,l*this.con,this.con*c),a=2*this.a*this.k0*o/this.cons,t.x=this.x0+a*Math.sin(s-this.long0),t.y=this.y0-this.con*a*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<W?(e=2*this.a*this.k0/(1+i*Math.cos(h)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),t.x=e*i*Math.sin(h)+this.x0,t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var s=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=W?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/a),e=dt(Math.abs(this.coslat0)<W?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(s),a*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=W){if(a<=W)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,n=a*this.cons/(2*this.a*this.k0),r=this.con*ft(this.e,n),e=this.con*dt(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=W?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/a),e=dt(this.long0+Math.atan2(t.x*Math.sin(i),a*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),r=-1*ft(this.e,Math.tan(.5*(G+o)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(G+t))*Math.pow((1-e)/(1+e),.5*r)}},Qt={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,n=e/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=s,t.y=c,t},names:["somerc"]},te={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),r=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-r*r);var n,i,o=pt(this.e,this.lat0,t),a=this.bl/e*Math.sqrt((1-this.es)/(1-r*r));a*a<1&&(a=1);if(isNaN(this.longc)){var s=pt(this.e,this.lat1,Math.sin(this.lat1)),l=pt(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var c=Math.pow(s,this.bl),u=Math.pow(l,this.bl);i=.5*((n=this.el/c)-1/n);var h=(this.el*this.el-u*c)/(this.el*this.el+u*c),d=(u-c)/(u+c),p=dt(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(h*Math.tan(.5*this.bl*p)/d)/this.bl,this.long0=dt(this.long0);var f=dt(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*f)/i),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else n=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=n*Math.pow(o,this.bl),i=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},forward:function(t){var e,r,n,i=t.x,o=t.y,a=dt(i-this.long0);if(Math.abs(Math.abs(o)-G)<=W)n=o>0?-1:1,r=this.al/this.bl*Math.log(Math.tan(Y+n*this.gamma0*.5)),e=-1*n*G*this.al/this.bl;else{var s=pt(this.e,o,Math.sin(o)),l=this.el/Math.pow(s,this.bl),c=.5*(l-1/l),u=.5*(l+1/l),h=Math.sin(this.bl*a),d=(c*Math.sin(this.gamma0)-h*Math.cos(this.gamma0))/u;r=Math.abs(Math.abs(d)-1)<=W?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-d)/(1+d))/this.bl,e=Math.abs(Math.cos(this.bl*a))<=W?this.al*this.bl*a:this.al*Math.atan2(c*Math.cos(this.gamma0)+h*Math.sin(this.gamma0),Math.cos(this.bl*a))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+r):(e-=this.uc,t.x=this.x0+r*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-r*Math.sin(this.alpha)),t},inverse:function(t){var e,r;this.no_rot?(r=t.y-this.y0,e=t.x-this.x0):(r=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*r/this.al),i=.5*(n-1/n),o=.5*(n+1/n),a=Math.sin(this.bl*e/this.al),s=(a*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/o,l=Math.pow(this.el/Math.sqrt((1+s)/(1-s)),1/this.bl);return Math.abs(s-1)<W?(t.x=this.long0,t.y=G):Math.abs(s+1)<W?(t.x=this.long0,t.y=-1*G):(t.y=ft(this.e,l),t.x=dt(this.long0-Math.atan2(i*Math.cos(this.gamma0)-a*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},ee={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<W)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=ut(this.e,e,r),i=pt(this.e,this.lat1,e),o=Math.sin(this.lat2),a=Math.cos(this.lat2),s=ut(this.e,o,a),l=pt(this.e,this.lat2,o),c=pt(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>W?this.ns=Math.log(n/s)/Math.log(i/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=W&&(r=ht(r)*(G-2*W));var n,i,o=Math.abs(Math.abs(r)-G);if(o>W)n=pt(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var a=this.ns*dt(e-this.long0);return t.x=this.k0*(i*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,t},inverse:function(t){var e,r,n,i,o,a=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+s*s),r=1):(e=-Math.sqrt(a*a+s*s),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*a,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=ft(this.e,n)))return null}else i=-G;return o=dt(l/this.ns+this.long0),t.x=o,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},re={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y,u=dt(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),n=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(a)/1,t.x=s*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,n,i,o,a,s,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,a=e,s=0;var c=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(s=1),a=t.y,c+=1}while(0===s&&c<15);return c>=15?null:t},names:["Krovak","krovak"]},ne=function(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)},ie=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},oe=function(t){return.375*t*(1+.25*t*(1+.46875*t))},ae=function(t){return.05859375*t*t*(1+.75*t)},se=function(t){return t*t*t*(35/3072)},le=function(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)},ce=function(t){return Math.abs(t)<G?t:t-ht(t)*Math.PI},ue=function(t,e,r,n,i){var o,a;o=t/e;for(var s=0;s<15;s++)if(o+=a=(t-(e*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(e-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN},he={init:function(){this.sphere||(this.e0=ie(this.es),this.e1=oe(this.es),this.e2=ae(this.es),this.e3=se(this.es),this.ml0=this.a*ne(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,n=t.x,i=t.y;if(n=dt(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=le(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),u=c*c,h=this.es*a*a/(1-this.es);e=s*c*(1-u*l*(1/6-(8-l+8*h)*u/120)),r=this.a*ne(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*u*(.5+(5-l+6*h)*u/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var o=i+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var a=this.ml0/this.a+i,s=ue(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-G)<=W)return t.x=this.long0,t.y=G,i<0&&(t.y*=-1),t;var l=le(this.a,this.e,Math.sin(s)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),h=n*this.a/l,d=h*h;e=s-l*Math.tan(s)/c*h*h*(.5-(1+3*u)*h*h/24),r=h*(1-d*(u/3+(1+3*u)*u*d/15))/Math.cos(s)}return t.x=dt(r+this.long0),t.y=ce(e),t},names:["Cassini","Cassini_Soldner","cass"]},de=function(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e},pe=.3333333333333333,fe=.17222222222222222,ge=.10257936507936508,ye=.06388888888888888,me=.0664021164021164,Ce=.016415012942191543,ve={init:function(){var t=Math.abs(this.lat0);if(Math.abs(t-G)<W?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<W?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=de(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=t*pe,e=t*t,r[0]+=e*fe,r[1]=e*ye,e*=t,r[0]+=e*ge,r[1]+=e*me,r[2]=e*Ce,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=de(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,n,i,o,a,s,l,c,u,h=t.x,d=t.y;if(h=dt(h-this.long0),this.sphere){if(o=Math.sin(d),u=Math.cos(d),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+u*n:1+this.sinph0*o+this.cosph0*u*n)<=W)return null;e=(r=Math.sqrt(2/r))*u*Math.sin(h),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*u*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(d+this.phi0)<W)return null;r=Y-.5*d,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(s=0,l=0,c=0,n=Math.cos(h),i=Math.sin(h),o=Math.sin(d),a=de(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:c=1+this.sinb1*s+this.cosb1*l*n;break;case this.EQUIT:c=1+l*n;break;case this.N_POLE:c=G+d,a=this.qp-a;break;case this.S_POLE:c=d-G,a=this.qp+a}if(Math.abs(c)<W)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),r=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*s-this.sinb1*l*n):(c=Math.sqrt(2/(1+l*n)))*s*this.ymf,e=this.xmf*c*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(c=Math.sqrt(a))*i,r=n*(this.mode===this.S_POLE?c:-c)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a,s,l=t.x/this.a,c=t.y/this.a;if(this.sphere){var u,h=0,d=0;if((r=.5*(u=Math.sqrt(l*l+c*c)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(d=Math.sin(r),h=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(u)<=W?0:Math.asin(c*d/u),l*=d,c=h*u;break;case this.OBLIQ:r=Math.abs(u)<=W?this.phi0:Math.asin(h*this.sinph0+c*d*this.cosph0/u),l*=d*this.cosph0,c=(h-Math.sin(r)*this.sinph0)*u;break;case this.N_POLE:c=-c,r=G-r;break;case this.S_POLE:r-=G}e=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(a=Math.sqrt(l*l+c*c))<W)return t.x=0,t.y=this.phi0,t;i=2*Math.asin(.5*a/this.rq),n=Math.cos(i),l*=i=Math.sin(i),this.mode===this.OBLIQ?(s=n*this.sinb1+c*i*this.cosb1/a,o=this.qp*s,c=a*this.cosb1*n-c*this.sinb1*i):(s=c*i/a,o=this.qp*s,c=a*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(o=l*l+c*c))return t.x=0,t.y=this.phi0,t;s=1-o/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(l,c),r=function(t,e){var r=t+t;return t+e[0]*Math.sin(r)+e[1]*Math.sin(r+r)+e[2]*Math.sin(r+r+r)}(Math.asin(s),this.apa)}return t.x=dt(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Te=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)},_e={init:function(){Math.abs(this.lat1+this.lat2)<W||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ut(this.e3,this.sin_po,this.cos_po),this.qs1=de(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ut(this.e3,this.sin_po,this.cos_po),this.qs2=de(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=de(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>W?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=de(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*dt(e-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),i=0,0!==e&&(i=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,r)),o=dt(i/this.ns0+this.long0),t.x=o,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,n,i,o,a=Te(.5*e);if(t<W)return a;for(var s=t*t,l=1;l<=25;l++)if(a+=o=.5*(i=1-(n=t*(r=Math.sin(a)))*n)*i/Math.cos(a)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return a;return null}},Se={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y;return n=dt(l-this.long0),e=Math.sin(c),r=Math.cos(c),i=Math.cos(n),(o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=W?(a=this.x0+1*this.a*r*Math.sin(n)/o,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/o):(a=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),n=Math.cos(i),a=Te(n*this.sin_p14+t.y*r*this.cos_p14/e),o=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),o=dt(this.long0+o)):(a=this.phic0,o=0),t.x=o,t.y=a,t},names:["gnom"]},Ee={init:function(){this.sphere||(this.k0=ut(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,n=t.x,i=t.y,o=dt(n-this.long0);if(this.sphere)e=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=de(this.e,Math.sin(i));e=this.x0+this.a*this.k0*o,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r;return this.sphere?(e=dt(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*G:G;for(var n,i,o,a,s=Math.asin(.5*e),l=0;l<30;l++)if(i=Math.sin(s),o=Math.cos(s),a=t*i,s+=n=Math.pow(1-a*a,2)/(2*o)*(e/(1-t*t)-i/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(n)<=1e-10)return s;return NaN}(this.e,2*t.y*this.k0/this.a),e=dt(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]},we={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,n=dt(e-this.long0),i=ce(r-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,r=t.y;return t.x=dt(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ce(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},be={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ie(this.es),this.e1=oe(this.es),this.e2=ae(this.es),this.e3=se(this.es),this.ml0=this.a*ne(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,n,i=t.x,o=t.y,a=dt(i-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=W?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(o),r=this.a*(ce(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=W)e=this.a*a,r=-1*this.ml0;else{var s=le(this.a,this.e,Math.sin(o))/Math.tan(o);e=s*Math.sin(n),r=this.a*ne(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+s*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,n,i,o,a,s,l,c;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=W)e=dt(n/this.a+this.long0),r=0;else{a=this.lat0+i/this.a,s=n*n/this.a/this.a+a*a,l=a;var u;for(o=20;o;--o)if(l+=c=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+s)*u)/((l-a)/u-1),Math.abs(c)<=W){r=l;break}e=dt(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=W)r=0,e=dt(this.long0+n/this.a);else{a=(this.ml0+i)/this.a,s=n*n/this.a/this.a+a*a,l=a;var h,d,p,f,g;for(o=20;o;--o)if(g=this.e*Math.sin(l),h=Math.sqrt(1-g*g)*Math.tan(l),d=this.a*ne(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(a*(h*(f=d/this.a)+1)-f-.5*h*(f*f+s))/(this.es*Math.sin(2*l)*(f*f+s-2*a*f)/(4*h)+(a-f)*(h*p-2/Math.sin(2*l))-p),Math.abs(c)<=W){r=l;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=dt(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]},Le={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,n=t.y-this.lat0,i=r-this.long0,o=n/B*1e-5,a=i,s=1,l=0;for(e=1;e<=10;e++)s*=o,l+=this.A[e]*s;var c,u=l,h=a,d=1,p=0,f=0,g=0;for(e=1;e<=6;e++)c=p*u+d*h,d=d*u-p*h,p=c,f=f+this.B_re[e]*d-this.B_im[e]*p,g=g+this.B_im[e]*d+this.B_re[e]*p;return t.x=g*this.a+this.x0,t.y=f*this.a+this.y0,t},inverse:function(t){var e,r,n=t.x,i=t.y,o=n-this.x0,a=(i-this.y0)/this.a,s=o/this.a,l=1,c=0,u=0,h=0;for(e=1;e<=6;e++)r=c*a+l*s,l=l*a-c*s,c=r,u=u+this.C_re[e]*l-this.C_im[e]*c,h=h+this.C_im[e]*l+this.C_re[e]*c;for(var d=0;d<this.iterations;d++){var p,f=u,g=h,y=a,m=s;for(e=2;e<=6;e++)p=g*u+f*h,f=f*u-g*h,g=p,y+=(e-1)*(this.B_re[e]*f-this.B_im[e]*g),m+=(e-1)*(this.B_im[e]*f+this.B_re[e]*g);f=1,g=0;var C=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)p=g*u+f*h,f=f*u-g*h,g=p,C+=e*(this.B_re[e]*f-this.B_im[e]*g),v+=e*(this.B_im[e]*f+this.B_re[e]*g);var T=C*C+v*v;u=(y*C+m*v)/T,h=(m*C-y*v)/T}var _=u,S=h,E=1,w=0;for(e=1;e<=9;e++)E*=_,w+=this.D[e]*E;var b=this.lat0+w*B*1e5,L=this.long0+S;return t.x=L,t.y=b,t},names:["New_Zealand_Map_Grid","nzmg"]},Ae={init:function(){},forward:function(t){var e=t.x,r=t.y,n=dt(e-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=i,t.y=o,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=dt(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]},xe={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Bt(this.es)},forward:function(t){var e,r,n=t.x,i=t.y;if(n=dt(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=20;a;--a){var s=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<W)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);r=this.a*Gt(i,l,c,this.en),e=this.a*n*c/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i;return t.x-=this.x0,n=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,n/=this.C_x*(this.m+Math.cos(e)),this.m?e=Te((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Te(Math.sin(e)/this.n)),n=dt(n+this.long0),e=ce(e)):(e=Ut(t.y/this.a,this.es,this.en),(i=Math.abs(e))<G?(i=Math.sin(e),r=this.long0+t.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(e)),n=dt(r)):i-W<G&&(n=this.long0)),t.x=n,t.y=e,t},names:["Sinusoidal","sinu"]},Pe={init:function(){},forward:function(t){for(var e=t.x,r=t.y,n=dt(e-this.long0),i=r,o=Math.PI*Math.sin(r);;){var a=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=a,Math.abs(a)<W)break}i/=2,Math.PI/2-Math.abs(r)<W&&(n=0);var s=.900316316158*this.a*n*Math.cos(i)+this.x0,l=1.4142135623731*this.a*Math.sin(i)+this.y0;return t.x=s,t.y=l,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=dt(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t},names:["Mollweide","moll"]},Ie={init:function(){Math.abs(this.lat1+this.lat2)<W||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ie(this.es),this.e1=oe(this.es),this.e2=ae(this.es),this.e3=se(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ut(this.e,this.sinphi,this.cosphi),this.ml1=ne(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<W?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ut(this.e,this.sinphi,this.cosphi),this.ml2=ne(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ne(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=ne(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var o=this.ns*dt(r-this.long0),a=this.x0+e*Math.sin(o),s=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,r,n,i;this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==r&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return i=dt(this.long0+o/this.ns),n=ce(this.g-r/this.a),t.x=i,t.y=n,t;var a=this.g-r/this.a;return n=ue(a,this.e0,this.e1,this.e2,this.e3),i=dt(this.long0+o/this.ns),t.x=i,t.y=n,t},names:["Equidistant_Conic","eqdc"]},Re={init:function(){this.R=this.a},forward:function(t){var e,r,n=t.x,i=t.y,o=dt(n-this.long0);Math.abs(i)<=W&&(e=this.x0+this.R*o,r=this.y0);var a=Te(2*Math.abs(i/Math.PI));(Math.abs(o)<=W||Math.abs(Math.abs(i)-G)<=W)&&(e=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var s=.5*Math.abs(Math.PI/o-o/Math.PI),l=s*s,c=Math.sin(a),u=Math.cos(a),h=u/(c+u-1),d=h*h,p=h*(2/c-1),f=p*p,g=Math.PI*this.R*(s*(h-f)+Math.sqrt(l*(h-f)*(h-f)-(f+l)*(d-f)))/(f+l);o<0&&(g=-g),e=this.x0+g;var y=l+h;return g=Math.PI*this.R*(p*y-s*Math.sqrt((f+l)*(l+1)-y*y))/(f+l),r=i>=0?this.y0+g:this.y0-g,t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i,o,a,s,l,c,u,h,d;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,o=(n=t.x/h)*n+(i=t.y/h)*i,h=3*(i*i/(l=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(s=a-2*i*i+n*n)*s*s/l/l/l-9*a*s/l/l)/27)/(c=(a-s*s/3/l)/l)/(u=2*Math.sqrt(-c/3)),Math.abs(h)>1&&(h=h>=0?1:-1),d=Math.acos(h)/3,r=t.y>=0?(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI:-(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI,e=Math.abs(n)<W?this.long0:dt(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Oe={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l,c,u,h,d,p,f,g,y,m,C,v,T,_,S,E=t.x,w=t.y,b=Math.sin(t.y),L=Math.cos(t.y),A=dt(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=W?(t.x=this.x0+this.a*(G-w)*Math.sin(A),t.y=this.y0-this.a*(G-w)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=W?(t.x=this.x0+this.a*(G+w)*Math.sin(A),t.y=this.y0+this.a*(G+w)*Math.cos(A),t):(C=this.sin_p12*b+this.cos_p12*L*Math.cos(A),m=(y=Math.acos(C))/Math.sin(y),t.x=this.x0+this.a*m*L*Math.sin(A),t.y=this.y0+this.a*m*(this.cos_p12*b-this.sin_p12*L*Math.cos(A)),t):(e=ie(this.es),r=oe(this.es),n=ae(this.es),i=se(this.es),Math.abs(this.sin_p12-1)<=W?(o=this.a*ne(e,r,n,i,G),a=this.a*ne(e,r,n,i,w),t.x=this.x0+(o-a)*Math.sin(A),t.y=this.y0-(o-a)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=W?(o=this.a*ne(e,r,n,i,G),a=this.a*ne(e,r,n,i,w),t.x=this.x0+(o+a)*Math.sin(A),t.y=this.y0+(o+a)*Math.cos(A),t):(s=b/L,l=le(this.a,this.e,this.sin_p12),c=le(this.a,this.e,b),u=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(c*L)),v=0===(h=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(h)-Math.PI)<=W?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(A)*Math.cos(u)/Math.sin(h)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),y=l*v*(1-(T=v*v)*(g=(p=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*p)*(1-g)/6+(_=T*v)/8*(f=d*p)*(1-2*g)+(S=_*v)/120*(g*(4-7*g)-3*d*d*(1-7*g))-S*v/48*f),t.x=this.x0+y*Math.sin(h),t.y=this.y0+y*Math.cos(h),t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a,s,l,c,u,h,d,p,f,g,y,m,C,v,T,_,S;if(this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*G*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=W?a=this.lat0:(a=Te(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-G,o=dt(Math.abs(s)<=W?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=o,t.y=a,t}return l=ie(this.es),c=oe(this.es),u=ae(this.es),h=se(this.es),Math.abs(this.sin_p12-1)<=W?(d=this.a*ne(l,c,u,h,G),e=Math.sqrt(t.x*t.x+t.y*t.y),a=ue((d-e)/this.a,l,c,u,h),o=dt(this.long0+Math.atan2(t.x,-1*t.y)),t.x=o,t.y=a,t):Math.abs(this.sin_p12+1)<=W?(d=this.a*ne(l,c,u,h,G),e=Math.sqrt(t.x*t.x+t.y*t.y),a=ue((e-d)/this.a,l,c,u,h),o=dt(this.long0+Math.atan2(t.x,t.y)),t.x=o,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),g=Math.atan2(t.x,t.y),p=le(this.a,this.e,this.sin_p12),y=Math.cos(g),C=-(m=this.e*this.cos_p12*y)*m/(1-this.es),v=3*this.es*(1-C)*this.sin_p12*this.cos_p12*y/(1-this.es),S=1-C*(_=(T=e/p)-C*(1+C)*Math.pow(T,3)/6-v*(1+3*C)*Math.pow(T,4)/24)*_/2-T*_*_*_/6,f=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*y),o=dt(this.long0+Math.asin(Math.sin(g)*Math.sin(_)/Math.cos(f))),a=Math.atan((1-this.es*S*this.sin_p12/Math.sin(f))*Math.tan(f)/(1-this.es)),t.x=o,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]},Me={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y;return n=dt(l-this.long0),e=Math.sin(c),r=Math.cos(c),i=Math.cos(n),((o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=W)&&(a=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a,s;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),r=Te(e/this.a),n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=W?(s=this.lat0,t.x=a,t.y=s,t):(s=Te(i*this.sin_p14+t.y*n*this.cos_p14/e),o=Math.abs(this.lat0)-G,Math.abs(o)<=W?(a=dt(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=s,t):(a=dt(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=a,t.y=s,t))},names:["ortho"]},ke=1,Ne=2,De=3,Fe=4,Be=5,Ge=6,Ue={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},je={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=G-Y/2?this.face=Be:this.lat0<=-(G-Y/2)?this.face=Ge:Math.abs(this.long0)<=Y?this.face=ke:Math.abs(this.long0)<=G+Y?this.face=this.long0>0?Ne:Fe:this.face=De,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,n,i,o,a,s={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,this.face===Be)i=G-e,r>=Y&&r<=G+Y?(l.value=Ue.AREA_0,n=r-G):r>G+Y||r<=-(G+Y)?(l.value=Ue.AREA_1,n=r>0?r-K:r+K):r>-(G+Y)&&r<=-Y?(l.value=Ue.AREA_2,n=r+G):(l.value=Ue.AREA_3,n=r);else if(this.face===Ge)i=G+e,r>=Y&&r<=G+Y?(l.value=Ue.AREA_0,n=-r+G):r<Y&&r>=-Y?(l.value=Ue.AREA_1,n=-r):r<-Y&&r>=-(G+Y)?(l.value=Ue.AREA_2,n=-r-G):(l.value=Ue.AREA_3,n=r>0?-r+K:-r-K);else{var c,u,h,d,p,f;this.face===Ne?r=M(r,+G):this.face===De?r=M(r,+K):this.face===Fe&&(r=M(r,-G)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(r),c=p*Math.cos(r),u=p*f,h=d,this.face===ke?n=O(i=Math.acos(c),h,u,l):this.face===Ne?n=O(i=Math.acos(u),h,-c,l):this.face===De?n=O(i=Math.acos(-c),h,-u,l):this.face===Fe?n=O(i=Math.acos(-u),h,c,l):(i=n=0,l.value=Ue.AREA_0)}return a=Math.atan(12/K*(n+Math.acos(Math.sin(n)*Math.cos(Y))-G)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===Ue.AREA_1?a+=G:l.value===Ue.AREA_2?a+=K:l.value===Ue.AREA_3&&(a+=1.5*K),s.x=o*Math.cos(a),s.y=o*Math.sin(a),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,t.x=s.x,t.y=s.y,t},inverse:function(t){var e,r,n,i,o,a,s,l,c,u={lam:0,phi:0},h={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?h.value=Ue.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(h.value=Ue.AREA_1,e-=G):t.x<0&&-t.x>=Math.abs(t.y)?(h.value=Ue.AREA_2,e=e<0?e+K:e-K):(h.value=Ue.AREA_3,e+=G),c=K/12*Math.tan(e),o=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),a=Math.atan(o),(s=1-(n=Math.cos(e))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?s=-1:s>1&&(s=1),this.face===Be)l=Math.acos(s),u.phi=G-l,h.value===Ue.AREA_0?u.lam=a+G:h.value===Ue.AREA_1?u.lam=a<0?a+K:a-K:h.value===Ue.AREA_2?u.lam=a-G:u.lam=a;else if(this.face===Ge)l=Math.acos(s),u.phi=l-G,h.value===Ue.AREA_0?u.lam=-a+G:h.value===Ue.AREA_1?u.lam=-a:h.value===Ue.AREA_2?u.lam=-a-G:u.lam=a<0?-a-K:-a+K;else{var d,p,f;c=(d=s)*d,p=(c+=(f=c>=1?0:Math.sqrt(1-c)*Math.sin(a))*f)>=1?0:Math.sqrt(1-c),h.value===Ue.AREA_1?(c=p,p=-f,f=c):h.value===Ue.AREA_2?(p=-p,f=-f):h.value===Ue.AREA_3&&(c=p,p=f,f=-c),this.face===Ne?(c=d,d=-p,p=c):this.face===De?(d=-d,p=-p):this.face===Fe&&(c=d,d=p,p=-c),u.phi=Math.acos(-f)-G,u.lam=Math.atan2(p,d),this.face===Ne?u.lam=M(u.lam,-G):this.face===De?u.lam=M(u.lam,-K):this.face===Fe&&(u.lam=M(u.lam,+G))}if(0!==this.es){var g,y,m;g=u.phi<0?1:0,y=Math.tan(u.phi),m=this.b/Math.sqrt(y*y+this.one_minus_f_squared),u.phi=Math.atan(Math.sqrt(this.a*this.a-m*m)/(this.one_minus_f*m)),g&&(u.phi=-u.phi)}return u.lam+=this.long0,t.x=u.lam,t.y=u.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},qe=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],We=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],He=V/5,Ve=1/He,Ye=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},ze={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=dt(t.x-this.long0),r=Math.abs(t.y),n=Math.floor(r*He);n<0?n=0:n>=18&&(n=17);var i={x:Ye(qe[n],r=V*(r-Ve*n))*e,y:Ye(We[n],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*.8487+this.x0,i.y=i.y*this.a*1.3523+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(e.y>=1)e.x/=qe[18][0],e.y=t.y<0?-G:G;else{var r=Math.floor(18*e.y);for(r<0?r=0:r>=18&&(r=17);;)if(We[r][0]>e.y)--r;else{if(!(We[r+1][0]<=e.y))break;++r}var n=We[r],i=5*(e.y-n[0])/(We[r+1][0]-n[0]);i=function(t,e,r,n){for(var i=e;n;--n){var o=t(i);if(i-=o,Math.abs(o)<r)break}return i}(function(t){return(Ye(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)},i,W,100),e.x/=Ye(qe[r],i),e.y=(5*r+i)*H,t.y<0&&(e.y=-e.y)}return e.x=dt(e.x+this.long0),e},names:["Robinson","robin"]},Ke={init:function(){this.name="geocent"},forward:function(t){return f(t,this.es,this.a)},inverse:function(t){return g(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};return _.defaultDatum="WGS84",_.Proj=p,_.WGS84=new _.Proj("WGS84"),_.Point=R,_.toPoint=wt,_.defs=s,_.transform=C,_.mgrs=Nt,_.version="2.6.0",(Dt=_).Proj.projections.add(jt),Dt.Proj.projections.add(zt),Dt.Proj.projections.add(Kt),Dt.Proj.projections.add(Zt),Dt.Proj.projections.add(Jt),Dt.Proj.projections.add(Qt),Dt.Proj.projections.add(te),Dt.Proj.projections.add(ee),Dt.Proj.projections.add(re),Dt.Proj.projections.add(he),Dt.Proj.projections.add(ve),Dt.Proj.projections.add(_e),Dt.Proj.projections.add(Se),Dt.Proj.projections.add(Ee),Dt.Proj.projections.add(we),Dt.Proj.projections.add(be),Dt.Proj.projections.add(Le),Dt.Proj.projections.add(Ae),Dt.Proj.projections.add(xe),Dt.Proj.projections.add(Pe),Dt.Proj.projections.add(Ie),Dt.Proj.projections.add(Re),Dt.Proj.projections.add(Oe),Dt.Proj.projections.add(Me),Dt.Proj.projections.add(je),Dt.Proj.projections.add(ze),Dt.Proj.projections.add(Ke),_});var TC=TC||{};TC.tool=TC.tool||{};TC.tool.Proxification=function(t,e){this.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}};if(void 0===t)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");this.proxy="function"==typeof t?t:function(e){var r=t;"http"!=e.substr(0,4)&&(r+=window.location.protocol);return r+=encodeURIComponent(e)};e=e||{};this._location=e.location||window.location;this.preventMixedContent=void 0===e.allowedMixedContent||!e.allowedMixedContent};!function(){window.fetch||function(t){"use strict";if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{new Blob;return!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&r.indexOf(Object.prototype.toString.call(t))>-1};u.prototype.append=function(t,e){t=s(t);e=l(e);var r=this.map[t];this.map[t]=r?r+","+e:e};u.prototype.delete=function(t){delete this.map[s(t)]};u.prototype.get=function(t){t=s(t);return this.has(t)?this.map[t]:null};u.prototype.has=function(t){return this.map.hasOwnProperty(s(t))};u.prototype.set=function(t,e){this.map[s(t)]=l(e)};u.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)};u.prototype.keys=function(){var t=[];this.forEach(function(e,r){t.push(r)});return c(t)};u.prototype.values=function(){var t=[];this.forEach(function(e){t.push(e)});return c(t)};u.prototype.entries=function(){var t=[];this.forEach(function(e,r){t.push([r,e])});return c(t)};e.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})};g.call(y.prototype);g.call(v.prototype);v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})};v.error=function(){var t=new v(null,{status:0,statusText:""});t.type="error";return t};var a=[301,302,303,307,308];v.redirect=function(t,e){if(-1===a.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})};t.Headers=u;t.Request=y;t.Response=v;t.fetch=function(t,r){return new Promise(function(n,i){var o=new y(t,r);r=r||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new v(null,{status:a.status});var t={status:a.status,statusText:a.statusText,headers:C(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new v(e,t))};a.onerror=function(){i(new TypeError("Network request failed"))};a.ontimeout=function(){i(new TypeError("Network request failed"))};a.open(o.method,o.url,!r.sync);"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1);!r.sync&&"responseType"in a&&e.blob&&(a.responseType="blob");o.headers.forEach(function(t,e){a.setRequestHeader(e,t)});a.send(void 0===o._bodyInit?null:o._bodyInit)})};t.fetch.polyfill=!0}function s(t){"string"!=typeof t&&(t=String(t));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){"string"!=typeof t&&(t=String(t));return t}function c(t){var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};e.iterable&&(r[Symbol.iterator]=function(){return r});return r}function u(t){this.map={};t instanceof u?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(t){return new Promise(function(e,r){t.onload=function(){e(t.result)};t.onerror=function(){r(t.error)}})}function p(t){var e=new FileReader,r=d(e);e.readAsArrayBuffer(t);return r}function f(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);e.set(new Uint8Array(t));return e.buffer}function g(){this.bodyUsed=!1;this._initBody=function(t){this._bodyInit=t;if(t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&n(t)){this._bodyArrayBuffer=f(t.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};if(e.blob){this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))};this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}}this.text=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,r=d(e);e.readAsText(t);return r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};e.formData&&(this.formData=function(){return this.text().then(m)});this.json=function(){return this.text().then(JSON.parse)};return this}function y(t,e){var r,n,i=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url;this.credentials=t.credentials;e.headers||(this.headers=new u(t.headers));this.method=t.method;this.mode=t.mode;if(!i&&null!=t._bodyInit){i=t._bodyInit;t.bodyUsed=!0}}else this.url=String(t);this.credentials=e.credentials||this.credentials||"omit";!e.headers&&this.headers||(this.headers=new u(e.headers));this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),o.indexOf(n)>-1?n:r);this.mode=e.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(t){var e=new FormData;t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(i))}});return e}function C(t){var e=new u;t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var r=t.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();e.append(n,i)}});return e}function v(t,e){e||(e={});this.type="default";this.status=void 0===e.status?200:e.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in e?e.statusText:"OK";this.headers=new u(e.headers);this.url=e.url||"";this._initBody(t)}}("undefined"!=typeof self?self:this);var t=function(t){var e=document.createElement("a");e.href=t;if(!e.origin){if(!e.protocol||!e.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(e.href);e.protocol=r[1];if(r[4].indexOf(":")>-1){var n=r[4].split(":");e.hostname=n[0];e.port=n[1]}else e.hostname=r[4]}e.origin=(0===e.protocol.length?window.location.protocol:e.protocol)+"//"+e.hostname+(e.port&&t.indexOf(e.port)>-1?":"+e.port:"")}return e};var e=TC.tool.Proxification.prototype;e.cacheHost=new function(){var e=function(e){var r=t(e);return r?r.origin:null};this._hosts=[];this._hostsImage=[];this.is=function(t,r){var n=e(t);return null!==this.get(n,r)};this.get=function(t,e){if(0===this.getList(e).length)return null;var r=this.getList(e).filter(function(r){return r.key===t&&e.exportable==r.exportable});return 0===r.length?null:r[0]};this.getList=function(t){return t.forImage?this._hostsImage:this._hosts};this.addKey=function(t,r){var n={key:e(t),action:null};r.exportable&&(n.exportable=r.exportable);this.getList(r).push(n);return this.getList(r)[this.getList(r).length-1]};this.removeKey=function(t,r){for(var n=e(t),i=0;i<this.getList(r).length;i++)if(this.getList(r)[i].key===n&&r.exportable==this.getList(r)[i].exportable){this.getList(r).splice(i,1);break}};this.getAction=function(t,r){r=r||{};var n=e(t),i=this.get(n,r);return i?i._actionPromise:Promise.reject(new Error("Cache null"))}};e._isServiceWorker=function(){if(navigator.serviceWorker){if(navigator.serviceWorker.controller&&"activated"===navigator.serviceWorker.controller.state)return!0;navigator.serviceWorker.ready.then(function(t){return!!t.active});return!1}return!1};e._isSameOrigin=function(t){var e=0!==t.indexOf("http")&&0!==t.indexOf("//"),r=!e&&t.match(this.Consts.url.SPLIT_REGEX);if(r){var n=r[1];e=(n==this._location.protocol||null==n)&&r[3]==this._location.hostname;var i=r[4],o=this._location.port;(80!=i&&""!==i||"80"!=o&&""!==o)&&(e=e&&i==o)}return e};e._isSameProtocol=function(t){var e=/^(https?:\/\/)/i,r=t.match(e);if(r&&r.length>1){var n=self._location.match(e);if(n&&n.length>1)return r[0].trim()===n[0].trim()}return!1};e._isSecureURL=function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)};const r=function(t,e,r){this.status=t;this.text=e;this.url=r};var n=function(e,r){var n=t(e);return e.replace(n.protocol,r)},i=function(t){return n(t,"https:")},o=function(t){return n(t,"http:")},a=function(t,e,r,n){var a=this;t=i(t);a._image.getImgTag(t,e).then(function(t){r(t,a._actionHTTPS)},function(i){i===a._image.ErrorType.PROTOCOL?n(i):s.call(a,o(t),e,r,n)})},s=function(t,e,r,n){var i=this;e.sameOrigin=i._isSameOrigin(i._actionProxy.call(i,t));i._image.getImgTagByAction(t,e,i._actionProxy.bind(i)).then(function(t){r(t,i._actionProxy)},function(t){n(t)})};e._actionDirect=function(t){return t};e._actionHTTP=function(t){return n(t,"http:")};e._actionHTTPS=function(t){return n(t,"https:")};e._actionProxy=function(t){return this.proxy(t)};e._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected"},checkHttpStatus:function(t){const e=this;return fetch(t,{credentials:"omit"}).then(function(t){return{status:t.status,statusText:t.statusText}}).catch(function(t){return e.ErrorType.UNEXPECTED})},getImgTag:function(t,r){return new Promise(function(e,n){var i=this,o=document.createElement("img");if(r.exportable&&!r.sameOrigin){o.dataset.checkCORSHeaders=!0;o.crossOrigin="anonymous"}o.onload=function(){console.log("Load OK: "+o.src);o.onload=o.onerror=void 0;if(r.exportable&&!r.sameOrigin){try{var t=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e}(o);result=t.toDataURL("image/png");e(o)}catch(t){18===t.code?n(i.ErrorType.CORS):e(o)}}else e(o)};o.onerror=function(e){console.log("Load crossOrigin ERROR: "+o.src);if(o.dataset.checkCORSHeaders){o.crossOrigin=null;o.onerror=void 0;o.onerror=function(t){console.log("Load ERROR: "+o.src);i.checkHttpStatus(o.src).then(function(t){r.ignoreProxification?n(i.ErrorType.PROTOCOL):400===t.status?n(i.ErrorType.PROTOCOL):n(t)}).catch(n);o.onload=o.onerror=void 0};o.src=t}else{console.log("Load ERROR: "+o.src);o.onload=o.onerror=void 0;i.checkHttpStatus(o.src).then(function(t){r.ignoreProxification?n(i.ErrorType.PROTOCOL):400===t.status?n(i.ErrorType.PROTOCOL):n(t)}).catch(n)}};try{o.src=t}catch(t){console.log("Load ERROR: "+o.src);n(i.ErrorType.UNEXPECTED)}}.bind(e._image))},getImgTagByAction:function(t,r,n){return new Promise(function(e,i){var o=this,a=document.createElement("img");r.sameOrigin||r.exportable&&(a.crossOrigin="anonymous");a.onload=function(){a.onload=a.onerror=void 0;e(a)};a.onerror=function(t){console.log("Load ERROR: "+a.src);a.onload=a.onerror=void 0;o.checkHttpStatus(a.src).then(function(t){r.ignoreProxification?i(o.ErrorType.PROTOCOL):400===t.status?i(o.ErrorType.PROTOCOL):i(t)}).catch(i)};a.src=n(t)}.bind(e._image))}};e._fetch={Headers:{CONTENTTYPE:"content-type"},ErrorType:{CORS:"cors",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(t){if(!t.ok)throw new r(t.status,t.statusText,t.url);return t},validateContentType:function(t,e){const r=this;if(!t)return e;var n=e.headers.get(r._fetch.Headers.CONTENTTYPE);if(n&&-1===n.indexOf(t))throw Error(r._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return e}};e.fetchImage=function(t,e){var r=this;(e=e||{}).forImage=!0;return new Promise(function(n,l){if(r.cacheHost.is(t,e))r.cacheHost.getAction(t,e).then(function(i){e.sameOrigin=r._isSameOrigin(i.action(t));r._image.getImgTagByAction(t,e,i.action).then(function(t){n(t)},function(t){l(t)})});else{var c=r.cacheHost.addKey(t,e);c._actionPromise=new Promise(function(u,h){const d=function(t,i){c.action=i.bind(r);c.exportable=e.exportable;u({action:c.action});n(t)},p=function(n){if(200==n.status){r.cacheHost.removeKey(t,e);l(n)}else{r.cacheHost.removeKey(t,e);l(n)}};!function(e){if(r._isSameOrigin(t)){e.sameOrigin=!0;r._image.getImgTag(t,e).then(function(t){d(t,r._actionDirect)},p)}else r._isSecureURL(t)?r._image.getImgTag(t,e).then(function(t){d(t,r._actionDirect)},function(n){e.exportable&&n===r._image.ErrorType.CORS||r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?n===r._image.ErrorType.PROTOCOL&&e.ignoreProxification?p(n):s.call(r,t,e,d,p):function(t,e,r,n){var a=this;t=o(t);a._image.getImgTag(t,e).then(function(t){r(t,a._actionHTTP)},function(o){o===a._image.ErrorType.PROTOCOL?n(o):s.call(a,i(t),e,r,n)})}.call(r,t,e,d,p)}):r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?a.call(r,t,e,d,p):r._image.getImgTag(t,e).then(function(t){d(t,r._actionDirect)},function(n){e.exportable&&n===r._image.ErrorType.CORS||!r._isSecureURL(r._location)?n===r._image.ErrorType.PROTOCOL&&e.ignoreProxification?p(n):s.call(r,t,e,d,p):a.call(r,t,e,d,p)})}(e)})}})};e.fetchRetry=function(t,e,r){const n=this;var i=fetch;e.sync&&(i=n.fetchSync);return i(t,e).catch(function(i){if(1===r)throw i;return n.fetchRetry(t,e,r-1)})};e.fetchSync=function(t,e){var r=this;return new Promise(function(n,i){"Symbol"in r&&Symbol;var o="FileReader"in r&&"Blob"in r&&function(){try{new Blob;return!0}catch(t){return!1}}();if("ArrayBuffer"in r){var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];ArrayBuffer.isView}function s(t){var e=new Headers;t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var r=t.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();e.append(n,i)}});return e}var l=new Request(t,e),c=new XMLHttpRequest;c.onload=function(){var t={status:c.status,statusText:c.statusText,headers:s(c.getAllResponseHeaders()||"")};t.url="responseURL"in c?c.responseURL:t.headers.get("X-Request-URL");var e="response"in c?c.response:c.responseText;n(new Response(e,t))};c.onerror=function(){i(new TypeError("Network request failed"))};c.ontimeout=function(){i(new TypeError("Network request failed"))};c.open(l.method,l.url,!1);"include"===l.credentials?c.withCredentials=!e.sync:"omit"===l.credentials&&(c.withCredentials=!1);!e.sync&&"responseType"in c&&o&&(c.responseType="blob");l.headers.forEach(function(t,e){c.setRequestHeader(e,t)});c.send(void 0===l._bodyInit?null:l._bodyInit)})};e.fetchXML=function(t,e){(e=e||{}).responseType="xml";return this.fetch(t,e)};e.fetchJSON=function(t,e){(e=e||{}).responseType=TC.Consts.mimeType.JSON;return this.fetch(t,e)};e.fetchBlob=function(t,e){(e=e||{}).responseType="blob";return this.fetch(t,e)};e.fetchImageAsBlob=function(t,e){(e=e||{}).responseType="image";return this.fetch(t,e)};e.fetch=function(e,r){const n=this;if((r=r||{}).type){r.method=r.type;delete r.type}if(r.data){r.body=r.data;delete r.data}if(r.contentType){r.headers=new Headers;r.headers.append("Content-Type",r.contentType);delete r.contentType}r.responseType||(r.responseType="");var i=function(t,e,r,o){return(e.retryAttempts?n.fetchRetry(r[0].call(n,t),e,e.retryAttempts):fetch(r[0].call(n,t),e)).then(n._fetch.validateResponse).then(n._fetch.validateContentType.bind(n,e.responseType)).then(function(t){o&&(o.action=r[0].bind(n));const i=t.headers.get(n._fetch.Headers.CONTENTTYPE),a=function(e){return t.blob().then(function(t){const r=new FileReader;return new Promise(function(n,i){r.addEventListener("error",function(){r.abort();i(new DOMException("Problem decoding"))});r.addEventListener("loadend",function(){n(r.result)});r.readAsText(t,e)})})};switch(!0){case e.responseType.indexOf("xml")>-1:case e.responseType.indexOf("text/xml")>-1:case e.responseType.indexOf(TC.Consts.mimeType.XML)>-1:return(s=/charset=([^;]*)/i.exec(i))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(t){return(new window.DOMParser).parseFromString(t,"text/xml")}):t.text().then(function(t){return(new window.DOMParser).parseFromString(t,"text/xml")});case e.responseType.indexOf("arraybuffer")>-1:return t.arrayBuffer();case e.responseType.indexOf("image")>-1:case e.responseType.indexOf("blob")>-1:return t.blob().then(function(t){return new Blob([t],{type:i})});case e.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+e.responseType);case e.responseType.indexOf(TC.Consts.mimeType.JSON)>-1:return t.json();case""==e.responseType:case e.responseType.indexOf("text")>-1:default:var s;return(s=/charset=([^;]*)/i.exec(i))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(t){return""==e.responseType?{responseText:t,contentType:i}:t}):t.text().then(function(t){return""==e.responseType?{responseText:t,contentType:i}:t})}}).catch(function(n){if(1===r.length){console.log("request failed",n);return Promise.reject(n)}r.shift();return i(t,e,r,o)})};if(n.cacheHost.is(e,r))return new Promise(function(t,o){n.cacheHost.getAction(e,r).then(function(n){t(i(e,r,[n.action]))}).catch(function(i){i.status>400?o(new Error(i.text)):t(n.fetch(e,r))})});var o=n.cacheHost.addKey(e,r);return new Promise(function(a,s){o._actionPromise=new Promise(function(l,c){e=t(e).href;const u=function(t){l({action:o.action});a(t)},h=function(t){n.cacheHost.removeKey(e,r);c(t);s(new Error(t.text))};n._isSameOrigin(e)?i(e,r,[n._actionDirect,n._actionProxy],o).then(u).catch(h):n._isSecureURL(e)?n._isServiceWorker()?i(e,r,[n._actionDirect,n._actionProxy],o).then(u).catch(h):i(e,r,[n._actionDirect,n._actionHTTP,n._actionProxy],o).then(u).catch(h):n._isServiceWorker()?i(e,r,[n._actionHTTPS,n._actionProxy],o).then(u).catch(h):i(e,r,n._isSecureURL(n._location)?[n._actionHTTPS,n._actionProxy]:[n._actionDirect,n._actionHTTPS,n._actionProxy],o).then(u).catch(h)});o._actionPromise.catch(function(t){t.status>400?s(new Error(t.text)):a(n.fetch(e,r))})})}}();var TC=TC||{};TC.inherit=function(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t;t._super=e.prototype};!function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(t){e.prototype=new e("").constructor.prototype;return e;function e(t,e){e||(e={});var r=document.createEvent("CustomEvent");r.initCustomEvent(t,!!e.bubbles,!!e.cancelable,e.detail);return r}}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);const t=function(t,e,r){const n=this;t.split(" ").forEach(function(t){n.$events.addEventListener(t,function(t,e){const r=function(t){const r={type:t.type,target:this,currentTarget:this};t.detail&&Object.keys(t.detail).forEach(function(e){e in r||(r[e]=t.detail[e])});return e.call(this,r)}.bind(this);(this._listeners[t]=this._listeners[t]||new Map).set(e,r);return r}.call(n,t,e),r)});return n};TC.EventTarget=function(){const t=this;t._listeners={};t.$events=document.createDocumentFragment();const e=["addEventListener","dispatchEvent","removeEventListener"];e.forEach(function(e){this[e]=t.$events[e].bind(t.$events)},t);e.push("on");e.push("one");e.push("off");e.push("trigger");e.forEach(function(e){t.$events[e]=t[e].bind(t)},t)};const e=TC.EventTarget.prototype;e.on=function(e,r){return t.call(this,e,r)};navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0?e.one=function(t,e){const r=this,n=function(i){r.off(t,n);e.call(this,i)};r.on(t,n);return r}:e.one=function(e,r){return t.call(this,e,r,{once:!0})};e.off=function(t,e){const r=this,n=t.split(" ");e?n.forEach(function(t){const n=r._listeners[t];n&&n.has(e)&&r.$events.removeEventListener(t,n.get(e))}):n.forEach(function(t){const e=r._listeners[t];if(e){e.forEach(function(e){r.$events.removeEventListener(t,e)});e.clear()}});return r};e.trigger=function(t,e){if(window.$&&$.Event&&t instanceof $.Event){e={};Object.keys(t).forEach(function(r){"type"!==r&&(e[r]=t[r])});t=t.type}var r;e&&(r={detail:e});const n=new CustomEvent(t,r);this.dispatchEvent(n)};TC.EventTarget._onBySelectorMap=new WeakMap;TC.EventTarget.listenerBySelector=function(t,e){return function(r){const n=this,i=r.type;var o=TC.EventTarget._onBySelectorMap.get(n);if(!o){o={};TC.EventTarget._onBySelectorMap.set(n,o)}var a=o[i];a||(o[i]=a={});a[t]||(a[t]=e);if(!r._listenerBySelectorCalled)for(var s,l=!1,c=r.target;c&&c!==n;){for(t in a)if(c.matches&&c.matches(t)){l=!0;s=a[t].call(n,r);r._listenerBySelectorCalled=!0}if(l)return s;c=c.parentNode}}};var r=null,n=null;const i=function(t){const e=this;var i=o.call(e);if(e.replaceCurrent){window.history.replaceState(i,null,null);delete e.replaceCurrent}else{e.lastEventType=t.type;var a=function(){n=r;(r=TC.Util.utf8ToBase64(i))!==n&&window.history.pushState(i,null,window.location.href.split("#").shift()+"#"+r)};if(t)switch(!0){case t.type==TC.Consts.event.BASELAYERCHANGE:case t.type==TC.Consts.event.LAYERORDER:case t.type==TC.Consts.event.ZOOM:a();break;case t.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:t.layer.type==TC.Consts.layerType.WMS&&a()}}},o=function(t){const e=this;var r={};e.crs!==e.options.crs&&(r.crs=e.crs);for(var n=e.getExtent(),i=0;i<n.length;i++)Math.abs(n[i])>180&&(n[i]=Math.floor(1e3*n[i])/1e3);r.ext=n;var o,a,s=[];e.baseLayers&&(s=e.baseLayers.filter(function(t){return t.isRaster()&&t.fallbackLayer}).map(function(t){return{baseLayer:t,fallbackLayerID:t.fallbackLayer.id}}).filter(function(t){return t.fallbackLayerID===(e.baseLayer?e.baseLayer.id:e.baseLayers[0].id)}));s.length>0?r.base=s[0].baseLayer.id:r.base=(e.baseLayer||e.baseLayers[0]).id;r.layers=[];for(i=0;i<e.workLayers.length;i++)if("WMS"==(o=e.workLayers[i]).type&&!o.options.stateless&&o.layerNames&&o.layerNames.length){a={u:TC.Util.isOnCapabilities(o.url),n:Array.isArray(o.names)?o.names.join(","):o.names,o:o.getOpacity(),v:o.getVisibility(),h:o.options.hideTitle,ur:o.unremovable,t:o.title};r.layers.push(a)}e.on3DView&&e.view3D.cameraControls&&(r.vw3=e.view3D.cameraControls.getCameraState());window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);t&&TC.Util.extend(r,t);return jsonpack.pack(r)},a=function(t){const e=this,r=[];if(!t)return Promise.resolve();e.loadingctrl||(e.loadingCtrl=e.getControlsByClass("TC.control.LoadingIndicator")[0]);e.hasWait||(e.hasWait=e.loadingCtrl&&e.loadingCtrl.addWait());return new Promise(function(n,i){var o,a=function(){e.loadingCtrl&&e.loadingCtrl.removeWait(e.hasWait);delete e.hasWait;n()};if("string"==typeof t)try{o=jsonpack.unpack(t)}catch(r){try{o=JSON.parse(t)}catch(t){TC.error(TC.Util.getLocaleString(e.options.locale,"mapStateNotValid"))}}else o=t;if(o){if(o.crs&&o.crs!==e.crs||void 0===o.crs&&e.crs!==e.options.crs)r.push(e.setProjection({crs:o.crs||e.options.crs,oldCrs:e.crs,extent:o.ext,baseLayer:e.getLayer(o.base)}));else{if(o.base!=e.getBaseLayer().id){e.getLayer(o.base)&&e.setBaseLayer(o.base);const t=e.baseLayers.filter(function(t){return t.options.fallbackLayer===o.base})[0];if(t){const n=e.addLayer(t.getFallbackLayer());r.push(n);n.then(function(t){e.setBaseLayer(t)})}}o.ext&&r.push(e.setExtent(o.ext,{animate:!1}))}(function(){const t=this;t.workLayers.filter(function(t){return!(t instanceof TC.layer.Vector)}).forEach(function(e){e.unremovable&&(e.unremovable=!1);t.removeLayer(e)})}).call(e);o.layers=o.layers||o.capas||[];if(o.layers.length>0)for(var s=0;s<o.layers.length;s++){var l=o.layers[s],c=!1;for(j=0;j<e.options.workLayers.length;j++){var u=TC.Util.extend({},e.options.workLayers[j],{map:e});if(l.u===u.url&&u.layerNames.indexOf(l.n)>=0){c=!0;u.renderOptions={opacity:l.o,hide:!l.v};u.unremovable=l.ur;u.title=l.t;r.push(e.addLayer(u).then(function(t){t.setVisibility(this.v);t.setOpacity(this.o,!0)}.bind(l)))}}c||r.push(e.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:l.n?l.n.split(","):"",unremovable:l.ur,title:l.t,renderOptions:{opacity:l.o,hide:!l.v}}).then(function(t){var e=t.wrap.getRootLayerNode();t.title=e.Title||e.title;t.setOpacity(this.o,!0);t.setVisibility(this.v)}.bind(l)))}Promise.all(r).then(function(){a()}).catch(function(){a()})}else a()})},s=function(t,e){return function(r,n,i){return n[t]===e?i:r}},l=function(t){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(e){return e.id===t})[0]};TC.Map=TC.Map||function(t,e){const r=this;TC.EventTarget.call(r);TC.Map._instances.push(r);r.isReady=!1;r.isLoaded=!1;r.controls=[];r.activeControl=null;r.layers=[];r.baseLayers=[];r.workLayers=[];r.baseLayer=null;r.vectors=null;var u=0;r.div=TC.Util.getDiv(t);TC._jQueryIsLoaded&&(r._$div=$(r.div));r.div.classList.add(TC.Consts.classes.LOADING,TC.Consts.classes.MAP);r._markerPromises=[];r._layerBuffer={layers:[],contains:function(t){return this.layers.some(function(e){return e.id===t})},getIndex:function(t){return this.layers.reduce(s("id",t),-1)},add:function(t,e,r){const n={id:t,pending:!0,zIndex:e,isBase:r};this.layers.splice(this.getIndexForZIndex(e),0,n)},remove:function(t){this.layers.splice(this.getIndex(t),1)},getMapLayers:function(){return this.layers.filter(t=>!1===t.pending).filter(t=>!t.rejected).map(t=>t.mapLayer)},resolve:function(t,e,r){const n=this.layers[this.getIndex(e.id)];n.mapLayer=e;n.pending=!1;t.layers=this.getMapLayers();if(r){0===t.baseLayers.length&&(t.baseLayers=new Array(t.options.baseLayers.length));if((i=t.options.baseLayers.map(function(t){return t.id}).indexOf(e.id))<0){var i;(i=t.baseLayers.map(function(t){return t.type}).indexOf(TC.Consts.layerType.VECTOR))<0?t.baseLayers.push(e):t.baseLayers.splice(i,0,e)}else t.baseLayers.splice(i,1,e)}else t.workLayers=t.layers.filter(function(t){return!t.isBase})},reject:function(t,e){const r=this.layers[this.getIndex(e.layerId)];r.mapLayer=null;r.pending=!1;r.rejected=!0;var n=t.options.baseLayers.map(t=>t.id).indexOf(e.layerId);n>=0&&t.baseLayers.splice(n,1)},getResolvedWorkLayerIndex:function(t,e){return this.layers.filter(function(t){return t.id===e||!t.isBase&&!1===t.pending}).reduce(s("id",e),-1)},getResolvedVisibleLayerIndex:function(t,e){var r=this.getResolvedWorkLayerIndex(t,e);t.baseLayer&&(r+=1);return r},getIndexForZIndex:function(t){return this.layers.reduce(function(t){return function(e,r,n){return r.zIndex<=t?n:e}}(t),-1)+1},checkMapLoad:function(t){const e=this;if(t.options.baseLayers.concat(t.options.workLayers).every(function(t){return e.contains(t.id||t)})&&!this.layers.some(function(t){return!0===t.pending})){const e=function(){if(!t.isLoaded){const e=function(){t.options.stateful&&function(){const t=this;var e=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");t.replaceCurrent=!0;i.call(t);const r=i.bind(t);t.on(e,r);var n;t.on(TC.Consts.event.LAYEROPACITY,function(e){clearTimeout(n);n=setTimeout(function(){i.call(t,e)},500)});window.addEventListener("popstate",function(n){var i;i=t.loadingCtrl&&t.loadingCtrl.addWait();setTimeout(function(){if(n){t.off(e,r);var o=n.state;"[object Object]"===Object.prototype.toString.call(o)&&(o=t.checkLocation());a.call(t,o).then(function(){setTimeout(function(){t.on(e,r)},200);t.loadingCtrl&&t.loadingCtrl.removeWait(i)})}},4)})}.call(t);t.isLoaded=!0;t.div.classList.remove(TC.Consts.classes.LOADING);t.trigger(TC.Consts.event.MAPLOAD)};if(t.state&&t.state.vw3){if(!t.div.classList.contains(TC.Consts.classes.THREED)){t.div.classList.add(TC.Consts.classes.THREED);TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:t,state:t.state.vw3,callback:function(){e();t.getControlsByClass(TC.control.ThreeD)[0].button.removeAttribute("disabled")}})})}}else e()}};if(t.baseLayer)e();else{var r=[];t.state&&t.state.base&&(r=TC.Cfg.availableBaseLayers.filter(function(e){return e.id===t.state.base}));if(r.length>0){r[0].isBase=!0;t.addLayer(r[0]).then(function(t){e()})}else{const r=t.baseLayers.filter(function(t){return!t.mustReproject}).filter(function(t){return t.wrap&&t.wrap.layer});if(r.length>0){t.wrap.setBaseLayer(r[0].wrap.layer);t.baseLayer=r[0]}e()}}}}};r._layerBuffer.layers=[];if(!TC.ready){TC.Cfg=TC.Util.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(e&&e.controls&&e.controls.search&&e.controls.search.allowedSearchTypes)for(var p in TC.Cfg.controls.search.allowedSearchTypes)e.controls.search.allowedSearchTypes.hasOwnProperty(p)||(e.controls.search.allowedSearchTypes[p]=!1);e=e||{};h.call(r,e);var f=function(){TC.loadJS(r.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){r.options.stateful&&(r.state=r.checkLocation());r.options.layout&&r.trigger(TC.Consts.event.LAYOUTLOAD,{map:r});e&&void 0!==e.workLayers&&(r.options.workLayers=e.workLayers);e&&void 0!==e.baseLayers&&(r.options.baseLayers=e.baseLayers);if(r.options.zoomToFeatures){r.on(TC.Consts.event.FEATURESADD,function t(e){clearTimeout(r._zoomToFeaturesTimeout);r._zoomToFeaturesTimeout=setTimeout(function(){r.zoomToFeatures(e.layer.features,{animate:!1});r.off(TC.Consts.event.FEATURESADD,t)},100)})}r.on(TC.Consts.event.LAYERADD,function t(e){if(e.layer.isBase&&(e.layer===r.baseLayer||r.baseLayer&&e.layer.fallbackLayer&&e.layer.fallbackLayer.id===r.baseLayer.id)){void 0!==r.state&&(r.state.crs?r.loaded(function(){r.setProjection({crs:r.state.crs,extent:r.state.ext})}):r.setExtent(r.state.ext,{animate:!1}));r.off(TC.Consts.event.LAYERADD,t)}});r.options.elevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof r.options.elevation?{}:r.options.elevation;r.elevation=new TC.tool.Elevation(t)});r.crs=r.options.crs;r.initialExtent=r.options.initialExtent;r.maxExtent=r.options.maxExtent;r.wrap=new TC.wrap.Map(r);TC.loadJS(!window[TC.Consts.PROJ4JSOBJ],[TC.url.proj4js],function(){TC.loadJSInOrder(!window[TC.Consts.OLNS],[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:r.options.crs,callback:function(){r.wrap.setMap();const t=[];for(var e in r.options.controls){var n=r.options.controls[e];if(n){"string"==typeof(n="boolean"==typeof n?{}:TC.Util.extend(!0,{},n)).div&&(n.div=r.div.querySelector("#"+n.div)||n.div);t.push(r.addControl(e,n))}}r.on(TC.Consts.event.BEFORELAYERUPDATE,g);r.on(TC.Consts.event.LAYERUPDATE,y);var i,o;for(i=0;i<r.options.baseLayers.length;i++){"string"==typeof(o=r.options.baseLayers[i])&&(o=l.call(r,o));r.addLayer(TC.Util.extend({},o,{isBase:!0,map:r}))}var a=function(t){t.isRaster()&&!t.names&&t.setVisibility(!1)};r.options.workLayers.map(function(t){return TC.Util.extend({},t,{map:r})}).filter(function(t){return!r.state||!r.state.layers||!r.state.layers.some(function(e){const r=e.u===t.url&&t.layerNames.indexOf(e.n)>=0;r&&(e.id=t.id);return r})}).forEach(function(t){r.addLayer(t).then(a)});r.state&&r.state.layers&&r.state.layers.forEach(function(t){r.addLayer({id:t.id||TC.getUID(),url:TC.Util.isOnCapabilities(t.u,t.u.indexOf(window.location.protocol)<0)||t.u,hideTitle:t.h,layerNames:t.n?t.n.split(","):"",unremovable:t.ur,title:t.t,renderOptions:{opacity:t.o,hide:!t.v}}).then(function(e){var r=e.wrap.getRootLayerNode();e.title=t.t||r.Title||r.title;this.o<1&&e.setOpacity(this.o);this.v||e.setVisibility(this.v)}.bind(t))});Promise.all(t).finally(function(){r.isReady=!0;r.trigger(TC.Consts.event.MAPREADY)});C(r.div)}})})});r.on(TC.Consts.event.FEATURECLICK,function(t){r.activeControl&&r.activeControl.isExclusive()||(r.on3DView?t.feature.showResultsPanel():t.feature.showPopup())});r.on(TC.Consts.event.NOFEATURECLICK,function(t){t.layer._noFeatureClicked=!0;for(var e=!0,n=0,i=r.workLayers.length;n<i;n++)if(!r.workLayers[n]._noFeatureClicked){e=!1;break}if(e){r.workLayers.forEach(function(t){delete t._noFeatureClicked});r.getControlsByClass(TC.control.Popup).forEach(function(t){t.isVisible()&&t.hide()})}})})};d.getMapState=function(t){var e=o.call(this,t);return TC.Util.utf8ToBase64(e)};d.getPreviousMapState=function(){return n};d.checkLocation=function(){var t=window.location.hash;if(t&&t.length>1){t=t.substr(1);var e;try{e=jsonpack.unpack(TC.Util.base64ToUtf8(t))}catch(n){try{e=JSON.parse(TC.Util.base64ToUtf8(t))}catch(t){TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValidForEdge"),TC.Consts.msgErrorMode.TOAST);if(e){var n=!1;if(!e.hasOwnProperty("ext")){n=!0;e.ext=r.options.initialExtent}if(!e.hasOwnProperty("base")){n=!0;e.base=r.options.defaultBaseLayer}if(e.hasOwnProperty("layers"))for(var i=e.layers.length-1;i>=0;i--)if(e.layers[i]&&e.layers[i].hasOwnProperty("u")&&e.layers[i].hasOwnProperty("n")){if(!e.layers[i].hasOwnProperty("o")||!e.layers[i].hasOwnProperty("v")||!e.layers[i].hasOwnProperty("h")){n=!0;TC.Util.extend(e.layers[i],{o:e.layers[i].o||1,v:e.layers[i].v||!0,h:e.layers[i].h||!1})}}else{n=!0;e.layers.length=e.layers.length-1}else{n=!0;e.layers=[]}e.hasOwnProperty("vw3")&&(e.vw3?(!e.vw3.cp||e.vw3.cp&&3!=e.vw3.cp.length||!e.vw3.chpr||e.vw3.chpr&&3!=e.vw3.chpr.length||!e.vw3.bcpd)&&(n=!0):n=!0);n&&TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return e}TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var g=function(t){if(u<=0){u=0;r.trigger(TC.Consts.event.BEFOREUPDATE)}u+=1},y=function(t){if((u-=1)<=0){u=0;r.trigger(TC.Consts.event.UPDATE)}};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(t,e,r){var n;if(t)n=new Promise(function(t,n){TC.ajax({url:e+r+".json",method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){const n=e.data;TC.i18n[r]=TC.i18n[r]||{};TC.Util.extend(TC.i18n[r],n);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(r,TC.i18n[r]);t()})}).catch(function(t){n(t)})});else{dust.i18n.add(r,TC.i18n[r]);n=Promise.resolve()}return n};var m=[],v=r.options.locale;m.push(new Promise(function(t,e){TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(v){dust.i18n.setLanguages([v]);m.push(TC.i18n.loadResources(!TC.i18n[v],TC.apiLocation+"TC/resources/",v))}t()})}));Promise.all(m).finally(function(){if(r.options.layout){var t=r.options.layout;r.trigger(TC.Consts.event.BEFORELAYOUTLOAD,{map:r});var n={},i=!1;if("string"==typeof t){var o=t.trim();o+=o.match(/\/$/)?"":"/";n.config=o+"config.json";n.markup=o+"markup.html";n.style=o+"style.css";n.script=o+"script.js";n.i18n=o+"resources";i=!0}else(t.hasOwnProperty("config")||t.hasOwnProperty("markup")||t.hasOwnProperty("style")||t.hasOwnProperty("script")||t.hasOwnProperty("href")||t.hasOwnProperty("i18n"))&&(n=TC.Util.extend({},t));n.i18n&&(n.i18n+=n.i18n.match(/\/$/)?"":"/");r.layout=n;const a=[],s=function(t,e){this.status=t;this.url=e},l=function(t){if(!i||404!=t.status){const e=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.error(TC.Util.getLocaleString(e.options.locale,"urlFailedToLoad",{url:t.url}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+t.url)}},c=new Promise(function(t,i){n.config?a.push(fetch(n.config).then(function(t){if(!t.ok)throw new s(t.status,n.config);return t.json()}).then(function(n){t(n.i18n);h.call(r,n,e)}).catch(function(e){l(e);t(!1)})):t(!1)});a.push(c);if(n.style){r.div.classList.add("tc-lo");fetch(n.style,{method:navigator.onLine?"HEAD":"GET"}).then(function(t){if(!t.ok)throw new s(t.status,n.style);return t}).then(function(){var t=document.createElement("link");t.rel="stylesheet";t.href=n.style;document.head.appendChild(t)}).catch(function(t){l(t)})}n.markup&&a.push(new Promise(function(t,e){fetch(n.markup).then(function(t){if(!t.ok)throw new s(t.status,n.markup);return t.text()}).then(function(e){c.then(function(i){if(i&&v&&n.i18n)TC.i18n.loadResources(!0,n.i18n,v).finally(function(){e=e.replace(/\{\{i18n "([^\}\{]+)"\}\}|\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\}/g,function(t,e,r,n){return TC.Util.getLocaleString(v,e||r||n)});r.div.insertAdjacentHTML("beforeend",e);t()});else{r.div.insertAdjacentHTML("beforeend",e);t()}})}).catch(function(t){l(t);e(Error(t))})}));Promise.all(a).finally(function(){n.script?fetch(n.script).then(function(t){if(!t.ok)throw new s(t.status,n.script);return t.blob()}).then(function(t){var e=URL.createObjectURL(t),n=document.createElement("script");n.src=e;n.onload=function(){C(r.div);f()};document.head.appendChild(n)}).catch(function(t){l(t);f()}):f()})}else f()});r.on(TC.Consts.event.UPDATEPARAMS,function(t){c(t.layer)});r.on(TC.Consts.event.ZOOM,function(){for(var t=0;t<r.workLayers.length;t++)c(r.workLayers[t])});var T=TC.error;TC.error=function(t,e,n){TC.isDebug&&console.trace&&console.trace();if(e){var i=function(t,e,n){switch(e){case TC.Consts.msgErrorMode.TOAST:if(!r.toast){console.warn("No existe el objeto Toast");return}r.toast(t,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(n?{msg:n,errorMsg:t}:t,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(t)}};if(Array.isArray(e))for(var o=0;o<e.length;o++)i(t,e[o],n);else i(t,e,n)}else{T(t);r.toast(t,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};TC.Map._instances=[];TC.Map.get=function(t){for(var e=0,r=TC.Map._instances.length;e<r;e++){const r=TC.Map._instances[e];if(r.div===t)return r}};TC.inherit(TC.Map,TC.EventTarget);var c=function(t){t.type===TC.Consts.layerType.WMS&&(t.tree=null)},u=function(t,e){var r=Array.prototype.slice.call(t).map(function(t){var r={};t&&(r[e]=t[e]);return r});"availableBaseLayers"===e&&console.log("layerOptions",r);var n={};n[e]=TC.Cfg[e];r.unshift(n);if("baseLayers"===e&&r[1].baseLayers){n=r[1];for(var i=0;i<n.baseLayers.length;i++)"object"==typeof n.baseLayers[i]&&TC.Util.extend(n.baseLayers[i],l.call(this,n.baseLayers[i].id))}else{r.unshift(!0);n=TC.Util.extend.apply(this,r);"availableBaseLayers"===e&&console.log("layerOption",n)}return n[e]};const h=function(){const t=[!0,{},TC.Cfg].concat(Array.prototype.slice.call(arguments)),e=this.options=TC.Util.extend.apply(this,t);e.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(t){return t.availableBaseLayers||[]}));e.baseLayers=u.call(this,arguments,"baseLayers");e.workLayers=u.call(this,arguments,"workLayers");const r=Array.prototype.slice.call(arguments).filter(t=>t.controls).map(t=>t.controls);r.length>0&&(e.controls=TC.Util.extend(e.controls,function(t){t.controlContainer&&(Array.isArray(t.controlContainer.controls)?t.controlContainer.controls.forEach(e=>{Object.keys(e).filter(t=>"position"!==t).forEach(r=>{if(void 0!==t[r]){"boolean"==typeof e[r]&&(e[r]={});TC.Util.extend(e[r],t[r]);delete t[r]}})}):Object.keys(t).filter(function(e){return Object.keys(t.controlContainer.controls).indexOf(e)>-1}).forEach(function(e){const r=t.controlContainer.controls[e];"boolean"==typeof r.options&&(r.options={});TC.Util.extend(r.options,t[e]);delete t[e]}));return t}(TC.Util.extend(r[0],r[1]))));return e};var d=TC.Map.prototype,p=function(t,e){var r,n='Layer "'+e.title+'" ("'+e.names+'"): ';r=e.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";n+=TC.Util.getLocaleString(t.options.locale,r);TC.error(n);t.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:r})};d.getCRS=function(){const t=this;return t.on3DView?t.view3D.crs:t.crs};d.addLayer=function(t,e){const r=this,n=new Promise(function(e,n){const o=v(t);"object"!=typeof t||t.id||(t.id=TC.getUID());let a=t.options?t.options.zIndex:t.zIndex;"number"!=typeof a&&(a=o?0:1);r._layerBuffer.add(t.id||t,a,t.isBase);if(r.getLayer(t.id)){const e=Error(`Layer "${t.id}" already exists`);e.layerId=t.id;n(e)}else{var s,c,u;if(o){c=!TC.layer||!TC.layer.Raster;u=TC.apiLocation+"TC/layer/Raster"}else{c=!TC.layer||!TC.layer.Vector;u=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(c,[u],function(){if("string"==typeof t)s=new TC.layer.Raster(TC.Util.extend({},l.call(r,t),{map:r}));else if(t instanceof TC.Layer)(s=t).map=r;else{t.map=r;s=t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t)}Promise.all([r.wrap.getMap(),s.wrap.getLayer()]).then(function(){r.trigger(TC.Consts.event.BEFORELAYERADD,{layer:s});var o;if(v(s)){!function(t){t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){const r=this;if(!r._tileloaderror){const n=t.getPath(),i=n.length?n[n.length-1]:t.title;t.map.toast(TC.Util.getLocaleString(t.map.options.locale,"tileload.error",{name:i,error:e.error.text}),{type:TC.Consts.msgType.ERROR});r._tileloaderror=!0;const o=function(t){if(t.tile.src&&t.tile.src!==TC.Consts.BLANK_IMAGE){delete r._tileloaderror;r.$events.off(TC.Consts.event.TILELOAD,o)}};r.$events.on(TC.Consts.event.TILELOAD,o)}})}(s);o=r.wrap.indexOfFirstVector()}-1===o&&(o=r.wrap.getLayerCount());const a=r.state&&r.state.crs?r.state.crs:r.getCRS();TC.loadProjDef({crs:a,callback:function(){const o=s.isCompatible(a);if(s.isBase){if(!o)if(!s.type===TC.Consts.layerType.WMTS)s.mustReproject=!0;else{const t=s.wrap.getCompatibleMatrixSets(a)[0];t?s.wrap.setMatrixSet(t):s.mustReproject=!0}r.state?s.isDefault=r.state.base===s.id||r.state.base===s.options.fallbackLayer:"string"==typeof r.options.defaultBaseLayer?s.isDefault=r.options.defaultBaseLayer===s.id:"number"==typeof r.options.defaultBaseLayer&&(s.isDefault=r.options.defaultBaseLayer===r.baseLayers.length);if(s.isDefault){var l;if(s.mustReproject&&!s.type===TC.Consts.layerType.WMTS||s.mustReproject&&s.type===TC.Consts.layerType.WMTS&&!s.wrap.getCompatibleMatrixSets(a)[0])if(s.options.fallbackLayer&&s.getFallbackLayer)r.addLayer(s.getFallbackLayer()).then(function(t){r.wrap.setBaseLayer(t.wrap.layer);r.baseLayer=t.wrap.parent;i(l);e(s)});else{p(r,s);const e=Error("Layer "+s.id+" incompatible with CRS");e.layerId=t.id;n(e)}else{l=null===r.baseLayer;s.wrap.getLayer().then(function(t){r.wrap.setBaseLayer(t);r.baseLayer=s;i(l);e(s)})}}else e(s)}else if(o)s.wrap.getLayer().then(function(t){e(s)});else{p(r,s);if(s.isValidFromNames()){const e=Error("Layer "+s.id+" incompatible with CRS");e.layerId=t.id;n(e)}else e(s)}}})},function(e){e.layerId=t.id;n(e)})})}});n.then(function(t){r._layerBuffer.resolve(r,t,t.isBase);t.isBase||r.wrap.insertLayer(t.wrap.layer,r._layerBuffer.getResolvedVisibleLayerIndex(r,t.id));r.trigger(TC.Consts.event.LAYERADD,{layer:t});r._layerBuffer.checkMapLoad(r);TC.Util.isFunction(e)&&e(t)}).catch(function(t){r._layerBuffer.reject(r,t);r._layerBuffer.checkMapLoad(r)});const i=function(t){if(t){var e={projection:r.wrap.map.getView().getProjection(),extent:r.initialExtent},n=r.baseLayer.getResolutions();if(n&&n.length)e.resolutions=n;else{e.minZoom=r.wrap.map.getView().getMinZoom();e.maxZoom=r.wrap.map.getView().getMaxZoom();var i=r.baseLayer.wrap.layer.getMinResolution();0!==i&&(e.minResolution=i);var o=r.baseLayer.wrap.layer.getMaxResolution();o!==Number.POSITIVE_INFINITY&&(e.maxResolution=o)}r.wrap.map.setView(new ol.View(e));r.wrap.map.getView().fit(r.initialExtent)}};return n};d.removeLayer=function(t){const e=this;return new Promise(function(r,n){if(t.unremovable)return n("Unremovable");let i=!1;for(var o=0;o<e.layers.length;o++)if(e.layers[o]===t){e.layers.splice(o,1);i=!0;break}if(i){if(t.isBase){for(o=0;o<e.baseLayers.length;o++)if(e.baseLayers[o]===t){e.baseLayers.splice(o,1);e.baseLayer===t&&e.setBaseLayer(e.baseLayers[0]);break}}else{for(o=0;o<e.workLayers.length;o++)if(e.workLayers[o]===t){e.workLayers.splice(o,1);break}t===e.vectors&&(e.vectors=null)}t.wrap.getLayer().then(function(n){e.wrap.removeLayer(n);e._layerBuffer.remove(t.id);e.trigger(TC.Consts.event.LAYERREMOVE,{layer:t});e._layerBuffer.checkMapLoad(e);r(t)})}else n(new Error(`Layer ${t.id} not found in map`))})};d.insertLayer=function(t,e,r){for(var n=this,i=-1,o=0;o<n.layers.length;o++)if(t===n.layers[o]){i=o;break}var a=[];a.push(t.wrap.getLayer());var s=n.layers[e];s&&a.push(s.wrap.getLayer());Promise.all(a).then(function(o){const a=o[0],s=o[1];var l=-1;if((l=s?n.wrap.getLayerIndex(s):n.wrap.getLayerCount())>=0){t.map=n;n.wrap.insertLayer(a,l);i>-1&&n.layers.splice(i,1);n.layers.splice(e,0,t);n.workLayers=n.layers.filter(function(t){return!t.isBase});n.trigger(TC.Consts.event.LAYERORDER,{layer:t,oldIndex:i,newIndex:e})}TC.Util.isFunction(r)&&r()})};d.setLayerIndex=function(t,e){this.wrap.setLayerIndex(t.wrap.layer,e)};d.putLayerOnTop=function(t){var e=this.wrap.getLayerCount();this.setLayerIndex(t,e-1)};d.setBaseLayer=function(t,e){var r=this,n=null,i=!1;if("string"==typeof t){var o;for(o=0;o<r.layers.length;o++)if(r.layers[o].id===t){t=r.layers[o];i=!0;break}if(!i&&(t=l.call(r,t))){t=r.addLayer(TC.Util.extend(!0,{},t,{isDefault:!0,map:r}));i=!0}}else{if(r.layers.indexOf(t)<0){t.isDefault=!0;t.map=r;r.addLayer(t)}i=!0}if(i)if(t.isCompatible(r.getCRS())||t.fallbackLayer&&(!t.fallbackLayer||t.fallbackLayer.isCompatible(r.getCRS()))){r.trigger(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:t});n=t;r.wrap.getMap().then(function(n){t.wrap.getLayer().then(function(n){r.wrap.setBaseLayer(n).then(function(){r.baseLayer=t;r.trigger(TC.Consts.event.BASELAYERCHANGE,{layer:t});TC.Util.isFunction(e)&&e()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return n};d.setView=function(t){this.view=t;this.trigger(TC.Consts.event.VIEWCHANGE,{view:t})};d.ready=function(t){TC.Util.isFunction(t)&&(this.isReady?t():this.one(TC.Consts.event.MAPREADY,t))};d.loaded=function(t){TC.Util.isFunction(t)&&(this.isLoaded?t():this.one(TC.Consts.event.MAPLOAD,t))};d.getLayerTree=function(){var t={baseLayers:[],workLayers:[]};this.baseLayer&&(t.baseLayers[0]=this.baseLayer.getTree());for(var e=0;e<this.workLayers.length;e++){var r=this.workLayers[e].getTree();r&&t.workLayers.unshift(r)}return t};d.addControl=function(t,e){const r=this;return new Promise(function(n,i){const o=function(t){r.controls.push(t);return Promise.resolve(t.register(r)).then(function(e){t.div.parentElement||r.div.appendChild(t.div);r.trigger(TC.Consts.event.CONTROLADD,{control:t});return e}).catch(function(t){i(t instanceof Error?t:Error(t))})};if("string"==typeof t){t=t.substr(0,1).toUpperCase()+t.substr(1);TC.loadJS(!TC.Control||!TC.control[t],[TC.apiLocation+"TC/control/"+t],function(){o(new TC.control[t](null,e)).then(function(t){n(t)})})}else o(t).then(function(t){n(t)})})};d.getControlsByClass=function(t){var e=[],r=t;if("string"==typeof t){r=window;for(var n=t.split("."),i=0;i<n.length&&(r=r[n[i]]);i++);}if(TC.Util.isFunction(r))for(i=0;i<this.controls.length;i++){var o=this.controls[i];o instanceof r&&e.push(o)}return e};d.getControlById=function(t){const e=this;for(var r=0,n=e.controls.length;r<n;r++){const n=e.controls[r];if(n.id===t)return n}return null};d.getDefaultControl=function(){const t=this;var e;t.options.defaultActiveControl&&(e=t.getControlsByClass("TC.control."+t.options.defaultActiveControl.substr(0,1).toUpperCase()+t.options.defaultActiveControl.substr(1))[0]);e||(e=(e=t.getControlsByClass("TC.control.MultiFeatureInfo")[0])?e.lastCtrlActive:t.getControlsByClass("TC.control.FeatureInfo")[0]);return e};d.getLoadingIndicator=function(){var t=null,e=this.getControlsByClass("TC.control.LoadingIndicator");e.length&&(t=e[0]);return t};d.setExtent=function(t,e){return this.wrap.setExtent(t,e)};d.getExtent=function(){return this.wrap.getExtent()};d.setCenter=function(t,e){return this.wrap.setCenter(t,e)};d.getCenter=function(){return this.wrap.getCenter()};d.setRotation=function(t){this.wrap.setRotation(t)};d.getRotation=function(){return this.wrap.getRotation()};d.getViewHTML=function(){return this.wrap.getViewport()};d.getCompatibleCRS=function(t){const e=((t=t||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(t){return t.isRaster()}).map(function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:t.includeFallbacks})}),r=e.slice(1);return e[0].filter(function(t){return r.every(function(e){return e.indexOf(t)>=0})})};d.loadProjections=function(t){t=t||{};return new Promise(function(e,r){const n=t.crsList||[];Promise.all(n.map(function(t){return TC.getProjectionData({crs:TC.Util.getCRSCode(t)})})).then(function(r){var n=r.filter(function(t){return"ok"===t.status&&t.number_result>0}).map(function(t){const e=t.results[0],r="EPSG:"+e.code;TC.loadProjDef({crs:r,def:e.def,name:e.name});return{code:r,name:e.name,proj4:e.proj4,unit:e.unit}});t.orderBy&&(n=n.sort(TC.Util.getSorterByProperty(t.orderBy)));e(n)},function(t){r(t)})})};d.setProjection=function(t){const e=this;t=t||{};return new Promise(function(r,n){var i;if(t.crs){t.baseLayer?i=t.baseLayer:t.allowFallbackLayer&&(e.baseLayer.isCompatible(t.crs)||0!==e.baseLayer.wrap.getCompatibleMatrixSets(t.crs).length?e.baseLayer.firstOption&&(e.baseLayer.firstOption.isCompatible(t.crs)||e.baseLayer.firstOption.wrap.getCompatibleMatrixSets(t.crs).length>0)&&(i=e.baseLayer.firstOption):e.baseLayer.options.fallbackLayer&&(i=e.baseLayer.getFallbackLayer()));i||(i=e.baseLayer);const o=function(){TC.loadProjDef({crs:t.crs,callback:function(){const o=e.crs,a=function(i){const s=function(){const s=TC.Util.extend({},t,{oldCrs:e.crs}),l=function(t){t.setProjection(s)};if(i.isCompatible(t.crs)||i.wrap.getCompatibleMatrixSets(t.crs).length>0){i.setProjection(s);e.wrap.setProjection(TC.Util.extend({},t,{baseLayer:i}));e.crs=t.crs;e.baseLayers.filter(function(t){return t!==i}).forEach(l);e.workLayers.forEach(l);const n=function(){e.trigger(TC.Consts.event.PROJECTIONCHANGE,{oldCrs:o,newCrs:t.crs});r()};i&&i!==e.baseLayer?e.setBaseLayer(i,n):n()}else i.fallbackLayer?a(i.fallbackLayer):n(Error("Layer has no fallback"))};i.type===TC.Consts.layerType.WMS||i.type===TC.Consts.layerType.WMTS?i.getCapabilitiesPromise().then(s):s()};a(i)}})};e.baseLayers.indexOf(i)<0?e.addLayer(i).then(o):o()}})};d.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};d.getCoordinateFromPixel=function(t){return this.wrap.getCoordinateFromPixel(t)};d.getPixelFromCoordinate=function(t){return this.wrap.getPixelFromCoordinate(t)};d.zoomToFeatures=function(t,e){if(t.length>0){var r=[1/0,1/0,-1/0,-1/0],n=e||{},i=n.pointBoundsRadius||this.options.pointBoundsRadius;i/=this.getMetersPerUnit();var o=n.extentMargin;"number"!=typeof o&&(o=this.options.extentMargin);for(var a=0;a<t.length;a++){var s=t[a].getBounds();if(s){r[0]=Math.min(r[0],s[0]);r[1]=Math.min(r[1],s[1]);r[2]=Math.max(r[2],s[2]);r[3]=Math.max(r[3],s[3])}}if(r[2]-r[0]==0){r[0]=r[0]-i;r[2]=r[2]+i}if(r[3]-r[1]==0){r[1]=r[1]-i;r[3]=r[3]+i}if(this.options.extentMargin){var l=(r[2]-r[0])*o/2,c=(r[3]-r[1])*o/2;r[0]=r[0]-l;r[1]=r[1]-c;r[2]=r[2]+l;r[3]=r[3]+c}if(this.options.maxExtent){r[0]=Math.max(r[0],this.options.maxExtent[0]);r[1]=Math.max(r[1],this.options.maxExtent[1]);r[2]=Math.min(r[2],this.options.maxExtent[2]);r[3]=Math.min(r[3],this.options.maxExtent[3])}this.wrap.setExtent(r,n);this.trigger(TC.Consts.event.ZOOMTO,{extent:r})}};d.zoomToMarkers=function(t){var e=this;Promise.all(e._markerPromises).then(function(){for(var r=[],n=0;n<e.workLayers.length;n++){var i=e.workLayers[n];if(i.type===TC.Consts.layerType.VECTOR)for(var o=0;o<i.features.length;o++){var a=i.features[o];a instanceof TC.feature.Marker&&(r[r.length]=a)}}e.zoomToFeatures(r,t);e._markerPromises=[]})};d.getLayer=function(t){const e=this;var r=null;if("string"==typeof t){for(var n=0;n<e.layers.length;n++)if(e.layers[n].id===t){r=e.layers[n];break}}else TC.Layer&&t instanceof TC.Layer&&t.map===e&&(r=t);return r};var f=function(t){var e;if(t.vectors)e=Promise.resolve(t.vectors);else{e=t.addLayer({id:TC.getUID(),title:TC.i18n[t.options.locale].vectors,type:TC.Consts.layerType.VECTOR});t.vectors=e;e.then(function(e){t.vectors=e})}return e};d.addPoint=function(t,e){if(e&&e.layer){var r=this.getLayer(e.layer);if(!r)throw new Error('Layer "'+e.layer+'" not found');r.addPoint(t,e)}else f(this).then(function(r){r.addPoint(t,e)})};d.addMarker=function(t,e){var r=this;if(e&&e.layer){var n=r.getLayer(e.layer);n?r._markerPromises.push(n.addMarker(t,e)):r._markerPromises.push(Promise.reject(new Error('Layer "'+e.layer+'" not found')))}else r._markerPromises.push(new Promise(function(n,i){f(r).then(function(r){r.addMarker(t,e).then(function(t){n(t)})})}))};d.addPolyline=function(t,e){if(e&&e.layer){if(!this.getLayer(e.layer))throw new Error('Layer "'+e.layer+'" not found');e.layer.addPolyline(t,e)}else f(this).then(function(r){r.addPolyline(t,e)})};d.addPolygon=function(t,e){if(e&&e.layer){if(!this.getLayer(e.layer))throw new Error('Layer "'+e.layer+'" not found');e.layer.addPolygon(t,e)}else f(this).then(function(r){r.addPolygon(t,e)})};d.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};d.getResolutions=function(){return this.wrap.getResolutions()};d.getResolution=function(){return this.wrap.getResolution()};d.setResolution=function(t){this.wrap.setResolution(t)};d.exportFeatures=async function(t,e){e=e||{};var r=this.getLoadingIndicator(),n=r&&r.addWait();const i=e.format===TC.Consts.format.GPX?Number.NaN:0;t.forEach(function(e,r){const n=e.getData();for(let t in n)if(/&(\w+|#\d{2,4});/g.test(t)){const r=n[t],i={},o=document.createElement("div");o.innerHTML=t;i[o.innerText]=r;e.unsetData(t);e.setData(i)}var o=e.getCoords({pointArray:!0});if(o.some(function(t){return null===t[2]})){t[r]=e=e.clone();(o=e.getCoords({pointArray:!0})).forEach(function(t){null===t[2]&&(t[2]=i)})}});const o=this.wrap.exportFeatures(t,e),a=TC.Consts.mimeType[e.format],s=e.format||"";if(s===TC.Consts.format.KMZ){var l=new JSZip,c=e.fileName||TC.getUID();l.file(c+".kml",o);l.generateAsync({type:"blob",mimeType:a}).then(function(t){filename=c+".kmz";TC.Util.downloadBlob(filename,t);r&&r.removeWait(n)})}else{TC.Util.downloadFile((e.fileName||TC.getUID())+"."+s.toLowerCase(),a,o);r&&r.removeWait(n)}};var g={},y=function(){const t=this;var e=t;do{e=e.parentElement}while(e&&!e.matches(".tc-toast-container"));const r=t.innerHTML;t.classList.add(TC.Consts.classes.HIDDEN);void 0!==g[r]&&(g[r]=void 0);setTimeout(function(){t.parentElement&&t.parentElement.removeChild(t);e&&!e.querySelector(".tc-toast")&&e.parentElement&&e.parentElement.removeChild(e)},1e3)};d.toastHide=function(t){var e=g[t];if(e){clearTimeout(e.timeout);e.toast&&e.toast.parentElement&&e.toast.parentElement.removeChild(e.toast);e.toast=null}};d.toast=function(t,e){const r=this;var n=e||{},i=n.duration||TC.Cfg.toastDuration,o=g[t];if(o){clearTimeout(o.timeout);o.toast&&o.toast.parentElement&&o.toast.parentElement.removeChild(o.toast);o.toast=null}var a=r.div.querySelector(".tc-toast-container");if(!a){(a=document.createElement("div")).classList.add("tc-toast-container");(n.container?n.container:r.div).appendChild(a)}const s=document.createElement("div"),l=document.createElement("span");s.classList.add("tc-toast");s.appendChild(l);const c=document.createElement("p");c.innerHTML=t;s.appendChild(c);s.addEventListener(TC.Consts.event.CLICK,y);a.appendChild(s);o=g[t]={toast:s};var u="";switch(n.type){case TC.Consts.msgType.INFO:u=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:u=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:u=TC.Consts.classes.ERROR}u.length&&o.toast.classList.add(u);o.timeout=setTimeout(function(){y.call(o.toast)},i)};var m=!1,C=function(t){if(/iPad/i.test(navigator.userAgent)){var e=window.innerHeight;t.getBoundingClientRect.height===e+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(m=!0)}var r=function(){t.classList.toggle(TC.Consts.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};if(m){r();window.addEventListener("resize",r)}else window.removeEventListener("resize",r)},v=function(t){return"string"==typeof t||t.type!==TC.Consts.layerType.VECTOR&&t.type!==TC.Consts.layerType.KML&&t.type!==TC.Consts.layerType.WFS};d.exportImage=function(){var t=null,e="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",r=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(r&&this.options.crossOrigin)try{t=r.toDataURL()}catch(t){TC.error(e+": "+t.message)}else TC.error(e);return t}}();var TC=TC||{};!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Util=e()}(TC,function(){String.prototype.soundex=function(){var t=this.toLowerCase().split("");f=t.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+t.map(function(t,e,r){return codes[t]}).filter(function(t,e,r){return 0===e?t!==codes[f]:t!==r[e-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};var t=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(e,r){if("eu-ES"!=e||TC.Util.detectIE())return t.apply(this,arguments);var n=t.apply(this,arguments);n=n.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1"));return n};var e={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(t,e,r){return r<e.length-1?t.hasOwnProperty(e[r])?l(t[e[r]],e,++r):null:t[e[r]]};const c=new WeakMap,u=new WeakMap,h={}.hasOwnProperty;var d={isPlainObject:function(t){return"object"==typeof t&&!t.nodeType&&t.window!==t&&!(t.constructor&&!h.call(t.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isFunction:function(t){return"function"==typeof t},extend:function(){var t,e=arguments[0]||{},r=1,n=!1;if("boolean"==typeof e){n=e;e=arguments[r]||{};r++}"object"==typeof e||d.isFunction(e)||(e={});for(var i=arguments.length;r<i;r++){const i=arguments[r];if(null!=i)for(var o in i){const r=e[o],a=i[o];if(e===a)continue;const s=Array.isArray(a);if(n&&a&&(d.isPlainObject(a)||s)){t=s?r&&Array.isArray(r)?r:[]:r&&d.isPlainObject(r)?r:{};e[o]=d.extend(n,t,a)}else void 0!==a&&(e[o]=a)}}return e},getMapLocale:function(t){return t.options&&t.options.locale&&t.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(t){var e=2!=arguments.length||arguments[1],r=e?t:t.replace(TC.Util.regex.PROTOCOL,"");if(e){if(TC.capabilities[r])return t}else for(var n in TC.capabilities)if(n.replace(TC.Util.regex.PROTOCOL,"")==r)return n;for(n in TC.capabilities){var i=l(TC.capabilities[n],a,0)||l(TC.capabilities[n],s,0);if(i&&e&&t==i)return i;if(i&&t.replace(TC.Util.regex.PROTOCOL,"")==i.replace(TC.Util.regex.PROTOCOL,""))return i}return t},reqGetMapOnCapabilities:function(t){var e,r,n=2!=arguments.length||arguments[1];n||t.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[t]?(e=TC.capabilities[t],(r=l(e,a,0)||l(e,s,0))?n?r.split("?")[0]:r.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFnFromString:function(t){var e=window,r=t.split(".");for(i=0;i<r.length-1;i++)if(null==(e=e[r[i]]))return;return e[r[r.length-1]]},isURL:function(t){return/^(http|https|ftp|mailto)\:\/\//i.test(t)},isSecureURL:function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)},isSameOrigin:function(t){var e=0!==t.indexOf("http")&&0!==t.indexOf("//"),r=!e&&t.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,i=r[1];e=(i==n.protocol||null==i)&&r[3]==n.hostname;var o=r[4],a=n.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(e=e&&o==a)}return e},formatNumber:function(t,e){var r=typeof t;if("number"===r)return t.toLocaleString(e);if("string"===r){n=parseFloat(t);if(n===new Number(t).valueOf())return n.toLocaleString(e)}return t},addProtocol:function(t){var e=t;t&&0===t.indexOf("//")&&(e=location.protocol+t);return e},getDiv:function(t){return"string"==typeof t?document.getElementById(t):t instanceof HTMLElement?t:t&&"$"in window&&t instanceof $&&t.length?t[0]:document.createElement("div")},getScriptLocation:function(){var t,e;if(document.currentScript)e=document.currentScript;else{var r=document.getElementsByTagName("script");e=r[r.length-1]}return(t=e.getAttribute("src"))?t.substr(0,t.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(t){var r="";if(t)if(void 0!==e[t])r=e[t];else{const i=document.createElement("div");i.style.display="none";i.classList.add(t);document.body.appendChild(i);var n=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(i,null).backgroundImage);n&&n.length>1&&(r=n[n.length-1]);i.parentElement.removeChild(i);e[t]=r}return r},getPointIconUrl:function t(e){var r=null;if(e.url)r=e.url;else{var n;if("string"==typeof e.cssClass)n=e.cssClass;else{var i=e.classes||TC.Cfg.styles.marker.classes;n=i[0];if(e.group){if(void 0===o[e.group]){var a=0;for(var s in o)a++;a%=i.length;o[e.group]=i[a]}n=o[e.group]}}r=TC.Util.getBackgroundUrlFromCss(n)}r||e===TC.Cfg.styles.point||""===e.cssClass||(r=t(TC.Cfg.styles.point));return r},getLegendImageFromStyle:function(t,e){let r=null;e=e||{};if(t.url)r=t.url;else{let n=e.width||32,i=e.height||16;const o=t.strokeWidth||0,a=o/2,s=2*(t.radius||0)+o,l=t.lineDash?`stroke-dasharray="${t.lineDash.join(" ")}" `:"";let c;n=Math.max(n,s);i=Math.max(i,s);switch(e.geometryType){case TC.Consts.geom.POINT:c=`<circle cx="${n/2}" cy="${i/2}" r="${t.radius}" stroke="${t.strokeColor}" stroke-width="${o}" fill="${t.fillColor}" fill-opacity="${t.fillOpacity}" ${l}/>`;break;case TC.Consts.geom.POLYLINE:c=`<polyline points="${a},${i-a} ${n-a},${a}" style="stroke:${t.strokeColor};stroke-width:${o}" ${l}/>`;break;case TC.Consts.geom.POLYGON:c=`<polygon points="${a},${i-a} ${a},${a} ${a+.8*n},${a} ${n-a},${i-a}" style="stroke:${t.strokeColor};stroke-width:${o};fill:${t.fillColor};fill-opacity:${t.fillOpacity}" ${l}/>`;break;default:c=`<rect x="${a}" x="${a}" width="${n-o}" height="${i-o}" style="stroke:${t.strokeColor};stroke-width:${o};fill:${t.fillColor};fill-opacity:${t.fillOpacity}" ${l}/>`}r="data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${i}">${c}</svg>`)}return r},addArrayToTree:function t(e,r,n){var i=null,o=!1,a=e[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){o=!0;var u=t(e,s,n+1);u&&(i=u);break}if(!o){s={name:a,title:a,uid:"/"+e.slice(0,n+1).join("/"),children:[]};r.children.push(s);i=s}}return i},parseCoords:function(t){var e=null,r=function(t){var e=t,r={};r.type=TC.Consts.GEOGRAPHIC;var n=e.indexOf("\xb0");r.value=parseFloat(e.substr(0,n));if((n=(e=e.substr(n+1)).indexOf("'"))>=0){var i=parseFloat(e.substr(0,n))/60;r.value>=0?r.value+=i:r.value-=i;if((n=(e=e.substr(n+1)).indexOf("'"))>=0){i=parseFloat(e.substr(0,n).replace(",","."))/3600;r.value>=0?r.value+=i:r.value-=i}}return r},n=function(t){var e=t.trim();if(e.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(e[e.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":e="-"+e}e=e.substr(0,e.length-1);return r(e)}if(e.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(e);if(e.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(e.substr(0,e.length-1).replace(",","."))};e.match(/[SsWwOo]$/)&&(n.value=-n.value);return n}return e.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(e.replace(",","."))}:e.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(e.replace(",","."))}:null},i=(t=t.trim().toUpperCase()).split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:1!==i.length&&3!==i.length||(i=t.split(" "));if(2===i.length){var o=n(i[0]),a=n(i[1]);null!==o&&null!==a&&(e=[o,a])}return e},reproject:function(t,e,r){var n,i=!0,o=!0,a=!0;if(Array.isArray(t[0]))if(Array.isArray(t[0][0])){if(!Array.isArray(t[0][0][0])){a=!1;t=[t]}}else{o=!1;t=[[t]]}else{i=!1;o=!1;a=!1;t=[[[t]]]}TC.loadProjDef({crs:e,sync:!0});TC.loadProjDef({crs:r,sync:!0});var s=proj4(proj4.defs[e]),l=proj4(proj4.defs[r]);n=new Array(t.length);t.forEach(function(t,e){const r=n[e]=[];t.forEach(function(t,e){const n=r[e]=[];t.forEach(function(t,e){var r=proj4(s,l,{x:t[0],y:t[1]});l.oProj.units===TC.Consts.units.METERS?n[e]=[Math.round(r.x),Math.round(r.y)]:n[e]=[r.x,r.y];t.length>2&&(n[e][2]=t[2])})})});i?o?a||(n=n[0]):n=n[0][0]:n=n[0][0][0];return n},getMetersPerDegree:function(t){var e=void 0;if(Array.isArray(t)&&t.length>=4){var r=this.degToRad(t[3]-t[1]),n=Math.sin(r/2),i=n*n;e=6370997*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(t[3]-t[1])}return e},radToDeg:function(t){return 180*t/Math.PI},degToRad:function(t){return t*Math.PI/180},mod:function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(t){var e=null;t=t.trim();if(/^EPSG:\d{4,6}$/g.test(t)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(t)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(t)){var r=t.trim().match(/^.+[:#](\d{4,6})$/);r&&(e=r[1])}return e},CRSCodesEqual:function(t,e){if(t===e)return!0;var r=this.getCRSCode(t),n=this.getCRSCode(e);return null!==r&&null!==n&&r===n},getLocaleString:function(t,e,r){var n=e;if(TC.i18n&&TC.i18n[t]){var i=TC.i18n[t][e];if(i){n=i;if(r)for(var o in r)n=n.replace("{"+o+"}",r[o])}}return n},getSimpleMimeType:function(t){var e="";if(t){var r=t.indexOf(";");r>0&&(t=t.substring(0,r));e=t}return e},getQueryStringParams:function(t){var e;if(t){var r=t.indexOf("?");if(r>=0){var n=(e=t.substr(r)).indexOf("#");n>=0&&(e=e.substr(0,n))}else e="?"}else e=location.search;var i=e.replace(/(^\?)/,"").split("&").map(function(t){return this[(t=t.split("="))[0]]=t[1],this}.bind({}))[0];delete i[""];return i},getParamString:function(t){const e=[];for(var r in t)e[e.length]=encodeURIComponent(r)+"="+encodeURIComponent(t[r]);return e.join("&").replace(/%20/g,"+")},fastUnshift:function(t,e){for(var r=t.length;r;){t[r]=t[r-1];r--}t[0]=e},storage:{getCookie:function(t){return TC.cookie(t)},setCookie:function(t,e,r){return TC.cookie(t,e,r)},getLocalValue:function(t){return localStorage&&localStorage instanceof Storage?localStorage.getItem(t):TC.Util.storage.getCookie(t)},setLocalValue:function(t,e){if(localStorage&&localStorage instanceof Storage)void 0===e?localStorage.removeItem(t):localStorage.setItem(t,e);else if(void 0===e){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(t,"",{expires:r})}else TC.Util.storage.setCookie(t,e);return t},getSessionLocalValue:function(t){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(t):TC.Util.storage.getCookie(t)},setSessionLocalValue:function(t,e){if(sessionStorage&&sessionStorage instanceof Storage)void 0===e?sessionStorage.removeItem(t):sessionStorage.setItem(t,e);else if(void 0===e){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(t,"",{expires:r})}else TC.Util.storage.setCookie(t,e);return t}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var r=t.indexOf("rv:");return parseInt(t.substring(r+3,t.indexOf(".",r)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const t=matchMedia("(pointer:coarse)").matches,e=matchMedia("(pointer:fine)").matches;if(t&&e)return!0;if(t&&!e){return!!function(){var t,e="(hover: hover)",r=!TC.browserFeatures.touch();(t=window.matchMedia(e)).media===e&&(r=t.matches);return r}()}return!(t||!e)||!matchMedia("(pointer:none)").matches&&(!TC.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var t=(new UAParser).getBrowser();return{name:t.name,version:t.major}},getElementByNodeName:function(t,e){for(var r=e.indexOf(":"),n=e.substr(r+1),i=t.getElementsByTagNameNS("*",n),o=0;o<i.length;o++)if(i[o].nodeName==e)return i},addURLParameters:function(t,e){if(!e)return t;var r=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+(e[t]?encodeURIComponent(e[t]):"")}).join("&"),n=t.split("?");if(n.length>=2){var i=n[1].split(/[&;]/g);i.push(r);return t=n[0]+"?"+i.join("&")}if((n=t.split("#")).length>=2){n.shift();return t=n[0]+"?"+r+"#"+n.join("#")}return t=t+"?"+r},removeURLParameter:function(t,e){var r=t.split("?");if(r.length>=2){for(var n=encodeURIComponent(e.toLowerCase())+"=",i=r[1].toLowerCase().split(/[&;]/g),o=i.length;o-- >0;)-1!==i[o].lastIndexOf(n,0)&&i.splice(o,1);return t=r[0]+"?"+i.join("&")}return t},showModal:function(t,e){e=e||{};t.hidden=!1;window.$&&t instanceof $&&(t=t.get(0));t.classList.add(TC.Consts.classes.VISIBLE);const r=t.querySelectorAll(".tc-modal-close");if(r&&r.length>0)for(var n=0;n<r.length;n++){var i=u.get(r[n]);if(i)u.delete(r[n]);else{i=function(t){t.stopPropagation();return TC.Util.closeModal(e.closeCallback,t.target)};u.set(r[n],i)}u.set(r[n],i);r[n].addEventListener("click",i);d.isFunction(e.openCallback)&&e.openCallback()}},closeModal:function(t,e){const r=function(t){t.classList.remove(TC.Consts.classes.VISIBLE)};var n;if(e){n=e;for(;n&&!n.matches(".tc-modal");)n=n.parentElement;r(n)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(t){r(t)});t&&t()},closeAlert:function(t){var e=t;do{(e=e.parentElement).matches(".tc-alert")&&(e.style.display="none")}while(e)},swipe:function(t,e){const r=function(e){t.addEventListener("mousedown",e.start);t.addEventListener("touchstart",e.start);t.addEventListener("mouseup",e.end);t.addEventListener("touchend",e.end)};if("disable"===e){const e=c.get(t);if(e){t.removeEventListener("mousedown",e.start);t.removeEventListener("touchstart",e.start);t.removeEventListener("mouseup",e.end);t.removeEventListener("touchend",e.end)}return}if("enable"===e){const e=c.get(t);e&&r(e);return}const n=(e=e||{}).minDistance||30,i=e.maxCrossDistance||30,o=e.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const u={start:function(r){if(function(r){if(e.noSwipe)for(var n=r.target;n&&n!==t;){if(n.matches&&n.matches(e.noSwipe))return!1;n=n.parentNode}return!0}(r)){r="changedTouches"in r?r.changedTouches[0]:r;a.x=r.pageX;a.y=r.pageY;l=(new Date).getTime()}},end:function(r){if(l){r="changedTouches"in r?r.changedTouches[0]:r;s.x=r.pageX;s.y=r.pageY;if((new Date).getTime()-l<=o){const r=e[function(t,e){const r=e.x-t.x,o=e.y-t.y,a=Math.abs(r),s=Math.abs(o);return a>s&&a>n&&s<=i?r<0?"left":"right":s>a&&s>n&&a<=i?o<0?"up":"down":"none"}(a,s)];r&&r.call(t)}l=0}}};c.set(t,u);r(u)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)","i").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},getLocaleUserChoice:function(t){var e="en-US",r=(t=t||{}).cookieName||"SITNA.language",n=t.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,o=TC.Util.getParameterByName(n)||TC.Util.storage.getCookie(r)||i,a=o.indexOf("-");a>=0&&(o=o.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(r,o,{expires:s});switch(o){case"eu":e="eu-ES";break;case"es":e="es-ES";break;default:e="en-US"}return e},getValidFilename:function(t){return(t||"").replace(/[\/\\?%*:|"<>]/g,"-")},downloadBlob:function(t,e){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(e);r.setAttribute("href",n);r.setAttribute("download",TC.Util.getValidFilename(t));r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}},downloadFile:function(t,e,r){var n=new Blob([r],{type:e});t=TC.Util.getValidFilename(t);navigator.msSaveBlob?navigator.msSaveBlob(n,t):TC.Util.downloadBlob(t,n)},downloadDataURI:function(t,e,r){for(var n=atob(r.split(",")[1]),i=[],o=0;o<n.length;o++)i.push(n.charCodeAt(o));var a=new Blob([new Uint8Array(i)],{type:e});t=TC.Util.getValidFilename(t);navigator.msSaveBlob?navigator.msSaveBlob(a,t):TC.Util.downloadBlob(t,a)},shortenUrl:function(t){return new Promise(function(e,r){TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:t}}).then(function(t){e(t.data)}).catch(function(t){r(t)})})},utf8ToBase64:function(t){return window.btoa(unescape(encodeURIComponent(t)))},base64ToUtf8:function(t){var e;try{e=decodeURIComponent(escape(window.atob(t)))}catch(t){e=null}return e},colorArrayToString:function(t){Array.isArray(t)&&(t=t.slice(0,3).reduce(function(t,e){const r=e.toString(16);return t+"00".substring(0,2-r.length)+r},"#"));return t},operation:function(t,e,r,n){for(var i=[],o=0;o<t.length;o++){for(var a=t[o],s=!1,l=0;l<e.length;l++)if(r(a,e[l])){s=!0;break}s===n&&i.push(a)}return i},isSecureURL:function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)},inBoth:function(t,e,r){return this.operation(t,e,r,!0)},inFirstOnly:function(t,e,r){return this.operation(t,e,r,!1)},inSecondOnly:function(t,e,r){return this.inFirstOnly(e,t,r)},toDataUrl:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},n=r.type,i=r.encoderOptions,o=t.getContext("2d");if(!o)return"";var a=t.width,s=t.height,l=o.getImageData(0,0,a,s),c=o.globalCompositeOperation;if(e){o.globalCompositeOperation="destination-over";o.fillStyle=e;o.fillRect(0,0,a,s)}var u=t.toDataURL(n,i);if(e){o.clearRect(0,0,a,s);o.putImageData(l,0,0);o.globalCompositeOperation=c}return u},imgToDataUrl:function(t,e){var r=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e};return new Promise(function(n,i){var o=new Image;o.crossOrigin="anonymous";o.onload=function(){var i,a=r(o);try{i=TC.Util.toDataUrl(a,"#ffffff",{type:e||"image/jpeg",encoderOptions:1});n({dataUrl:i,canvas:a})}catch(e){o.src=TC.proxify(t)}};o.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(t),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(t){if(200===this.status){for(var i=new Uint8Array(this.response),a=i.length,l=new Array(a);a--;)l[a]=String.fromCharCode(i[a]);var c=l.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){o.src="data:"+u+";base64,"+window.btoa(c);o.onload=function(){var t=r(o);dataURL=TC.Util.toDataUrl(t,"#ffffff",{type:e||"image/jpeg",encoderOptions:1});n({dataUrl:dataURL,canvas:t})}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&i(Error("HTTP error "+s.status))};s.send()};o.src=t;if(o.complete||void 0===o.complete){o.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";o.src=t}})},imgTagToDataUrl:function(t,e){var r=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e}(t);try{return{base64:TC.Util.toDataUrl(r,"#ffffff",{type:e||"image/jpeg",encoderOptions:1}),canvas:r}}catch(t){return null}},addToCanvas:function(t,e,r,n){var i=TC.Util.cloneCanvas(t),o=i.getContext("2d");return new Promise(function(t,a){var s=new Image;e.crossOrigin="anonymous";s.src=e;s.onload=function(){n?o.drawImage(s,r.x||0,r.y||0,n.width,n.height):o.drawImage(s,r.x||0,r.y||0);t(i)}})},cloneCanvas:function(t){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=t.width;e.height=t.height;r.drawImage(t,0,0);return e},calculateAspectRatioFit:function(t,e,r,n){var i=Math.min(r/t,n/e);return{width:t*i,height:e*i}},getFormattedDate:function(t,e){function r(t){return t<10?"0"+t:t}var n=new Date(t);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(e?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceAccent:function(t){var e={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return t.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(t){return e[t]})},downloadFileForm:async function(t,e){var r,n=async function(t,e){var r=await new Promise(function(r,n){const i=new XMLHttpRequest;i.responseType="blob";i.open("POST",t);i.setRequestHeader("Content-Type","application/xml; charset=UTF-8");i.onreadystatechange=function(e){if(4===i.readyState)if(200!==i.status)n({status:i.status,msg:i.statusText,url:t});else try{const t=i.getResponseHeader("Content-disposition");var o="";if(t){o=t.split("; ")[1].substring(9);"attachment"!==t.split("; ")[0]&&(o=o.substring(0,o.lastIndexOf(".")))}r({data:i.response,contentType:i.getResponseHeader("Content-type"),filename:o})}catch(t){n(t)}};try{i.send(e)}catch(t){n(t)}}),n="";if(r.data.type.indexOf("kml")>=0)n=".kml";else if(r.data.type.indexOf("json")>=0)n=".geojson";else if(r.data.type.indexOf("xml")>=0){n=".gml";if(/outputFormat="\S{1,}"/.exec(e)[0].includes(".kml")||/outputFormat="\S{1,}"/.exec(e)[0].includes("shape-zip"))throw{key:TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED,url:t,data:e,format:/outputFormat="\S{1,}"/.exec(e)[0]}}TC.Util.downloadFile((r.filename?r.filename:TC.getUID())+n,r.contentType,r.data)};if(Array.isArray(t)){for(var i=t,o=0;o<i.length;o++)try{await n(i[o].url,i[o].data)}catch(t){r=t}if(r)throw r}else n(t,e)},WFSQueryBuilder:function(t,e,r,n,i,o,a){const s=function(){return o?' srsName="'+o+'"':""};Array.isArray(t)||t instanceof Object||(t=[t]);var l='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"  service="WFS" {resultType} {format} ';switch(r.version){case"1.0.0":case"1.1.0":l+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":l+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var c in r)"string"==typeof r[c]&&c.indexOf("gml")<0&&r[c].indexOf("wfs")<0&&(l+=c+'="'+r[c]+'" ');var u="<wfs:GetFeature "+l.format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+n+'"'})+("2.0.0"!==r.version&&a?' maxFeatures="'+a+'"':"")+">",h="";if(Array.isArray(t)){var d="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+s()+">{filter}</wfs:Query>";Array.isArray(t)&&t.forEach(function(t){h+=d.format({typeName:t,filter:e&&e instanceof TC.filter.Filter?e.getText(r.version):""})})}else{d="";for(var p in t){d="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+s()+">{filter}</wfs:Query>";let e=t[p];h+=d.format({typeName:p,filter:e&&e instanceof TC.filter.Filter?e.getText(r.version):""})}}return u+=h+"</wfs:GetFeature>"},WFSFilterBuilder:function(t,e,r){var n="";if(d.isPlainObject(t))n='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===e?"fes":"ogc",clipLayer:t.clipLayer,geometryName:t.geometryName,where:t.where});else switch(!0){case!t:break;case Array.isArray(t):var i="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:t[0]+" "+t[1],upperCorner:t[2]+" "+t[3]});switch(!0){case"1.0.0"===e:case"1.1.0"===e:n+="<ogc:Filter><ogc:BBOX>"+i+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===e:n+="<fes:Filter><fes:BBOX>"+i+"</fes:BBOX></fes:Filter>"}break;case t instanceof TC.Feature:switch(!0){case"1.0.0"===e:case"1.1.0"===e:n+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(t,{version:"2.0",srsName:r})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===e:n+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(t,{version:"3.2",srsName:r})+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return n},writeGMLGeometry:function(t,e){const r=(e=e||{}).version,n=function(){return e.srsName?' srsName="'+e.srsName+'"':""};var i=function(t){var e;if(0===r.indexOf("3")){e=t.toString();for(;e.indexOf(",")>=0;)e=e.replace(","," ")}else e=t.map(function(t){return t.join(",")}).join(" ");return e};switch(r){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&t instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"'+n()+"><gml:posList>"+i(t.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"'+n()+"><gml:exterior><gml:LinearRing><gml:posList>"+i(t.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&t instanceof TC.feature.Polyline:return"<gml:LineString"+n()+"><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon"+n()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(t,e){var r=0!==t.indexOf("http")&&0!==t.indexOf("//"),n=!r&&t.match(TC.Consts.url.SPLIT_REGEX);if(n){var i=n[1];r=(i==e.protocol||null==i)&&n[3]==e.hostname;var o=n[4],a=e.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(r=r&&o==a)}return r},isSameProtocol:function(t,e){if(t.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=t.match(r);if(n&&n.length>1){var i=e.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},consoleRegister:function(t){TC.isDebug&&console.log(t)},getSorterByProperty:function(t){return function(e,r){return e[t]>r[t]?1:e[t]<r[t]?-1:0}},getSoundexDifference:function(t,e){for(var r=0,n=0;n<t.length;n++)t.charAt(n)==e.charAt(n)&&r++;return r},toAbsolutePath:function(t){var e=document.createElement("a");e.href=t;return e.href},explodeGeometry:function(t){const e=t.origin,r=function(t,n,i){if(Array.isArray(t))t.forEach(r);else{0===n&&(i[0]=t+e[0]);1===n&&(i[1]=t+e[1])}};t.geom.forEach(r);return t.geom},cloneMappingFunction:function(t){return Array.isArray(t)?t.map(TC.Util.cloneMappingFunction):t},isGeometry:function(t){switch(t){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"gml:LineStringPropertyType":case"gml:MultiLineStringPropertyType":case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"gml:BoxPropertyType":case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:MultiCurvePropertyType":case"gml:CurvePropertyType":return!0;default:return!1}},compactGeometry:function(t,e){const r=[Number.MAX_VALUE,Number.MAX_VALUE],n=t.map(TC.Util.cloneMappingFunction),i=function(t,e){Array.isArray(t)?t.forEach(i):0===e&&t<r[0]?r[0]=t:1===e&&t<r[1]&&(r[1]=t)};n.forEach(i);const o=function(t){return Math.round(t*e)/e};r[0]=o(r[0]);r[1]=o(r[1]);const a=function(t,e,n){if(Array.isArray(t))t.forEach(a);else{0===e&&(n[0]=o(t-r[0]));1===e&&(n[1]=o(t-r[1]))}};n.forEach(a);return{origin:r,geom:n}},hasStyleOptions:function(t){return t.hasOwnProperty("strokeColor")||t.hasOwnProperty("strokeWidth")||t.hasOwnProperty("fillColor")||t.hasOwnProperty("strokeOpacity")||t.hasOwnProperty("fillOpacity")||t.hasOwnProperty("url")||t.hasOwnProperty("radius")||t.hasOwnProperty("anchor")||t.hasOwnProperty("width")||t.hasOwnProperty("height")||t.hasOwnProperty("labelOutlineWidth")||t.hasOwnProperty("labelOutlineColor")||t.hasOwnProperty("labelOffset")||t.hasOwnProperty("fontColor")||t.hasOwnProperty("fontSize")},formatCoord:function(t,e){return t.toLocaleString(TC.Util.getLocaleUserChoice(),{maximumFractionDigits:e})}};String.prototype.format=function(){var t=this.toString();if(!arguments.length)return t;var e="string"==(e=typeof arguments[0])||"number"==e?arguments:arguments[0];for(arg in e)t=t.replace(RegExp("\\{"+arg+"\\}","gi"),e[arg]);return t};var p=function(t,e,r){return r(t.getBoundingClientRect(),e.getBoundingClientRect())};if(this.HTMLElement){HTMLElement.prototype.colliding=function(t){return p(this,t,function(t,e){return!(t.top>e.bottom||t.right<e.left||t.bottom<e.top||t.left>e.right)})};HTMLElement.prototype.containing=function(t){p(this,t,function(t,e){return!(t.left<=e.left&&e.left<t.width&&t.top<=e.top&&e.top<t.height)})};HTMLElement.prototype.inside=function(t){return p(this,t,function(t,e){return e.top<=t.top&&t.top<=e.bottom&&e.top<=t.bottom&&t.bottom<=e.bottom&&e.left<=t.left&&t.left<=e.right&&e.left<=t.right&&t.right<=e.right})}}return d});loadjs=function(){var t=function(){},e={},r={},n={};function i(t,e){if(t){var i=n[t];if(r[t]=e,i)for(;i.length;)i[0](t,e),i.splice(0,1)}}function o(e,r){e.call&&(e={success:e}),r.length?(e.error||t)(r):(e.success||t)(e)}function a(e,r,n,i){var o,s,l=document,c=n.async,u=(n.numRetries||0)+1,h=n.before||t,d=e.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(e)?(o=!0,(s=l.createElement("link")).rel="stylesheet",s.href=d):/(^img!|\.(png|gif|jpg|svg)$)/.test(e)?(s=l.createElement("img")).src=d:((s=l.createElement("script")).src=e,s.async=void 0===c||c),!(s.onload=s.onerror=s.onbeforeload=function(t){var l=t.type[0];if(o&&"hideFocus"in s)try{s.sheet.cssText.length||(l="e")}catch(t){18!=t.code&&(l="e")}if("e"==l&&(i+=1)<u)return a(e,r,n,i);r(e,l,t.defaultPrevented)})!==h(e,s)&&l.head.appendChild(s)}function s(t,r,n){var s,l;if(r&&r.trim&&(s=r),l=(s?n:r)||{},s){if(s in e)throw"LoadJS";e[s]=!0}!function(t,e,r){var n,i,o=(t=t.push?t:[t]).length,s=o,l=[];for(n=function(t,r,n){if("e"==r&&l.push(t),"b"==r){if(!n)return;l.push(t)}--o||e(l)},i=0;i<s;i++)a(t[i],n,r)}(t,function(t){o(l,t),i(s,t)},l)}return s.ready=function(t,e){return function(t,e){t=t.push?t:[t];var i,o,a,s=[],l=t.length,c=l;for(i=function(t,r){r.length&&s.push(t),--c||e(s)};l--;)o=t[l],(a=r[o])?i(o,a):(n[o]=n[o]||[]).push(i)}(t,function(t){o(e,t)}),s},s.done=function(t){i(t,[])},s.reset=function(){e={},r={},n={}},s.isDefined=function(t){return t in e},s}();var TC=TC||{};TC.version="2.1.0 [2020-3-16 15:28:36]";!function(){if(!TC.apiLocation){var t;if(document.currentScript)t=document.currentScript;else{var e=document.getElementsByTagName("script");t=e[e.length-1]}var r=t.getAttribute("src");TC.apiLocation=r.substr(0,r.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.SRSDOWNLOAD_GEOJSON_KML="EPSG:4326";TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,OL:"lib/ol/build/ol-sitna",OL_CONNECTOR:"TC/ol/ol",TEMPLATING:"lib/dust/dust-full",TEMPLATING_HELPERS:"lib/dust/dust-helpers",TEMPLATING_I18N:"lib/dust/dustjs-i18n",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",TEMPLATING_FULL:"lib/handlebars/handlebars",TEMPLATING_RUNTIME:"lib/handlebars/handlebars.runtime",TEMPLATING_HBS_HELPERS:"lib/handlebars/helpers.js",PROJ4JS:"lib/proj4js/proj4.js",EPSG:"https://epsg.io/",LOCALFORAGE:TC.apiLocation+"lib/localforage/localforage",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js",UA_PARSER:"lib/ua-parser/ua-parser.min.js",HASH:"lib/jshash/md5-min.js",DRAGGABILLY:"lib/draggabilly/draggabilly.pkgd",URL_POLYFILL:"lib/polyfill/url.js",PROMISE_POLYFILL:"lib/polyfill/promise/polyfill.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-threed"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2019:"ortofoto2019",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2019:"ortofoto2019_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_LIDAR:"ign-lidar",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_ES_DYNLIDAR:"ign-lidar-dyn",IGN_FR_CARTO:"ign-fr-cartes",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNCARTO:"ign-fr-cartes-dyn",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"};TC.Consts.logicalOperator={AND:"and",OR:"or"};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",KMZ:"application/vnd.google-earth.kmz",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",KMZ:"KMZ",GML:"GML",GML2:"GML2",GML3:"GML3",GML32:"GML32",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.WFSErrors={GETFEATURE_NOT_AVAILABLE:"GetFeatureNotAvailable",LAYERS_NOT_AVAILABLE:"LayersNotAvailable",NO_LAYERS:"NoLayers",NO_VALID_LAYERS:"noValidLayers",QUERY_NOT_AVAILABLE:"QueryNotAvailable",MAX_NUM_FEATURES:"NumMaxFeatures",GETCAPABILITIES:"GetCapabilities",INDETERMINATE:"Indeterminate",NO_FEATURES:"NoFeatures"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.view={DEFAULT:0,THREED:1,PRINTING:2};TC.Consts.units={DEGREES:"degrees",METERS:"m"};TC.Consts.MARKER="marker";TC.Defaults=function(){var t={};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,locale:"es-ES",view:TC.Consts.view.DEFAULT,screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:TC.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto m\xe1xima actualidad",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2019,title:"Ortofoto 2019",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2019",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2019.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2019,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"mapaTopografico",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:TC.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2019,title:"Ortofoto 2019",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2019",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2019.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2018",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2017",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IGN_ES_CARTO,type:TC.Consts.layerType.WMTS,title:"Cartograf\xeda raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_grey_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/mdt",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_LIDAR,title:"Modelo digital LIDAR (IGN ES)",type:TC.Consts.layerType.WMTS,url:"http://wmts-mapa-lidar.idee.es/lidar",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"EL.GridCoverageDSM",matrixSet:"GoogleMapsCompatible",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNLIDAR,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_grey_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:TC.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mdt",layerNames:"relieve",thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNLIDAR,title:"Modelo digital LIDAR (IGN ES)",type:TC.Consts.layerType.WMS,url:"//wms-mapa-lidar.idee.es/lidar",layerNames:"EL.GridCoverage",thumbnail:TC.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_FR_CARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNCARTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNCARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"HR.ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.OSM,title:"OSM",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:TC.Consts.layer.OSM},{id:TC.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_DARK,title:"CARTO dark",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,workLayerManager:!1,layerCatalog:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!1,click:!1,printMap:!1,featureInfo:{active:!0,persistentHighlights:!0},featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(e){var r=e.features.length,n=t[r];if(!n){n=2+Math.round(5*Math.sqrt(r));t[r]=n}return n},label:"${features.length}",fontColor:"#ffffff",fontSize:9}},selection:{point:{fillColor:"#008000",fillOpacity:.5,strokeColor:"#008000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},line:{strokeColor:"#008000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#008000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=new Array(r),i=arguments.length>=2?arguments[1]:void 0,o=0;o<r;o++)o in e&&(n[o]=t.call(i,e[o],o,e));return n});TC.proxify=function(t){var e=t=t.trim();if(TC.Cfg.proxy){var r=!1;if(TC.Cfg.proxyExceptions)for(var n=0;n<TC.Cfg.proxyExceptions.length;n++)if(t.indexOf(TC.Cfg.proxyExceptions[n])>-1){r=!0;break}if(!r&&!TC.Util.isSameOrigin(t))if("function"==typeof TC.Cfg.proxy)e=TC.Cfg.proxy(t);else{e=TC.Cfg.proxy;"http"!=t.substr(0,4)&&(e+=window.location.protocol);e+=encodeURIComponent(t)}}return e};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);var t=function(t){const e=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.error(TC.Util.getLocaleString(e.options.locale,"urlFailedToLoad",{url:t}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+t)};TC.syncLoadJS=function(e){var r=function(t,e){var r,n=new XMLHttpRequest;n.open("GET",t,!1);n.onreadystatechange=function(t){if(4===n.readyState)if(404===n.status){r=!1;e(!0)}else if(200!==n.status){e();r=!1}else r=n.responseText};try{n.send(null)}catch(t){r=!1;e()}return r};/(\.js|\/)$/i.test(e)||(e+=TC.isDebug?".js":".min.js");var n=r(e,function(n){if(n){t(e);return!1}return r(e,function(){t(e)})});if(n){var i=document.createElement("script");i.type="text/javascript";i.text=n;(function(){var t,e=document,r=e.getElementsByTagName("head");if(0===r.length){t=e.createElement("head");e.documentElement.insertBefore(t,document.body)}else t=r[0];return t})().appendChild(i)}};const e=["","-webkit-","-moz-","-o-","-ms-"];var r,n,i;TC.browserFeatures={touch:function(){if(void 0===r){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch){r=!0;return!0}const t=e.map(function(t){return"("+t+"touch-enabled)"}).join();r=matchMedia(t).matches}return r},inputTypeColor:function(){if(void 0===n){const t=document.createElement("input");t.setAttribute("type","color");if(n="text"!==t.type&&"style"in t){t.value=":-)";n=":-)"!==t.value}}return n},urlParser:function(){if(void 0===i)try{const t=new URL("http://sitna.tracasa.es/");i="http://sitna.tracasa.es/"===t.href}catch(t){i=!1}return i}};if(window.jQuery){TC._jQueryIsLoaded=!0;!function(){$._oldWhen=$.when;$.when=function(){const t=new Array(arguments.length);for(var e=0;e<arguments.length;e++){const r=t[e]=arguments[e];if(r instanceof Promise){const n=$.Deferred();r.then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)});t[e]=n}}return $._oldWhen.apply(this,t)}}()}"Promise"in window||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.PROMISE_POLYFILL);window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);"finally"in Promise.prototype||(Promise.prototype.finally=function(t){const e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){throw r})})});TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");TC.ajax=function(t){return new Promise(function(e,r){const n=(t=t||{}).method||"GET";var i;if(t.data)if("string"==typeof t.data)i=t.data;else if("object"==typeof t.data){const e=[];for(var o in t.data)e[e.length]=o+"="+t.data[o].toString();i=e.join("&")}var a=t.url;"GET"===n&&i&&(a=a+"?"+i);!1===t.cache&&(a+=(a.indexOf("?")<0?"?":"&")+"ts="+Date.now());const s=new XMLHttpRequest;s.open(n,a);t.contentType||"boolean"==typeof t.contentType?t.contentType&&s.setRequestHeader("Content-Type",t.contentType+"; charset=UTF-8"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");s.onreadystatechange=function(n){if(4===s.readyState)if(200!==s.status)r({status:s.status,msg:s.statusText,url:t.url});else{var i;try{switch(t.responseType){case TC.Consts.mimeType.JSON:i=JSON.parse(s.responseText);break;case TC.Consts.mimeType.XML:i=(new DOMParser).parseFromString(s.responseText,"application/xml");break;default:i=s.responseText}e({data:i,contentType:s.getResponseHeader("Content-type")})}catch(t){r(t)}}};try{s.send("POST"===n?i:null)}catch(t){r(t)}})};TC.loadJSInOrder=function(t,e,r){TC.loadJS(t,e,r,!0)};const o=function(t,e){TC.Util.isSameOrigin(t)||(e.crossOrigin="anonymous")};TC.loadJS=function(e,r,n,i,a){arguments.length<4&&(i=!1);var s=Array.isArray(r)?r:[r];s=s.map(function(t){return/\.js$/i.test(t)||0!==t.indexOf(TC.apiLocation)?t:t+(TC.isDebug?".js":".min.js")});if(e){s=s instanceof Array?s:[s];var l="";const e=function(t){return t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if(s.length>1){var c=s.slice(0).filter(function(t,r){if(loadjs.isDefined(e(t))){s.splice(r,1);loadjs.ready(e(t),n);return!1}return!0});1===c.length?l=e(c[0]):c.length>0&&(l=c.reduce(function(t,r){return e(t)+"_"+e(r)}))}else l=e(s[0]);if(l.length>0)if(loadjs.isDefined(l)){s.forEach(function(t){const e=new URL(t,location.href),r=Array.from(document.scripts).filter(t=>t.src===e.href)[0];r&&document.head.appendChild(r.cloneNode())});loadjs.ready(l,n)}else{var u={async:!i,numRetries:1};a||TC.Util.detectIE()||(u.before=o);loadjs(s,l,u);loadjs.ready(l,{success:function(){n()},error:function(e){t(e)}})}}else n()};TC.loadCSS=function(e){const r=e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();loadjs.isDefined(r)?loadjs.ready(r,{}):loadjs(e,r,{error:function(e){t(e)},numRetries:1})};var a={};TC.getProjectionData=function(t){const e=((t=t||{}).crs||"").match(/\d{4,5}$/g);let r=e?e[0]:"";const n=TC.Consts.url.EPSG+"?format=json&q="+r;let i=a[r];if(i)return t.sync?i:Promise.resolve(i);if(t.sync){let t;const e=new XMLHttpRequest;e.onreadystatechange=function(r){4==e.readyState&&(t=404!=e.status&&(200==e.status&&e.responseText))};e.open("GET",n,!1);try{e.send(null)}catch(e){t=!1}t&&(t=JSON.parse(t));return t}return new Promise(function(e,i){new TC.tool.Proxification(TC.proxify).fetchJSON(n,t).then(function(t){a[r]=t;e(t)}).catch(function(t){i(Error(t))})})};TC.loadProjDef=function(t){const e=(t=t||{}).crs;var r;window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);r=function(t){t=function(t){var e=/http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/\d\/(\d{4,5})/.exec(t);return e&&2===e.length?"urn:ogc:def:crs:EPSG::"+e[1]:t}(t);return proj4.defs(t)};const n=function(t,e){proj4.defs(t,e);window.ol&&window.ol.proj&&window.ol.proj.proj4.register(proj4)},i=function(t){return"function"==typeof t},o=function(t,i,o){const a="EPSG:"+t,s="urn:ogc:def:crs:EPSG::"+t,l="urn:x-ogc:def:crs:EPSG:"+t,c="http://www.opengis.net/gml/srs/epsg.xml#"+t,u="http://www.opengis.net/def/crs/EPSG/0/"+t;var h;if("object"==typeof i){h=TC.Util.extend({},i);i=TC.Util.extend({},i);h.axis&&delete h.axis}else"string"==typeof i&&(h=i.replace("+axis=neu",""));n(a,i);n(s,i);n(l,i);n(c,h);n(u,i);if(0===e.indexOf("http://www.opengis.net/gml/srs/epsg.xml#")){n(e,h);r(e).name=o}r(a).name=o;r(c).name=o;r(u).name=o};var a=e.lastIndexOf("#");a<0&&(a=e.lastIndexOf("/"));a<0&&(a=e.lastIndexOf(":"));var s=e.substr(a+1),l=r(e);if(l){o(s,l,t.name);i(t.callback)&&t.callback()}else if(t.def){o(s,t.def,t.name);i(t.callback)&&t.callback()}else{const e=function(e){(function(t){const e=t&&"ok"===t.status&&1===t.number_result;if(e){var r=t.results[0];o(r.code,r.proj4,r.name)}return e})(e)&&i(t.callback)&&t.callback()};if(t.sync){e(TC.getProjectionData(t))}else TC.getProjectionData(t).then(e)}};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_HELPERS,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES],templatingRuntime:[TC.apiLocation+TC.Consts.url.TEMPLATING_RUNTIME,TC.apiLocation+TC.Consts.url.TEMPLATING_HBS_HELPERS],templatingFull:[TC.apiLocation+TC.Consts.url.TEMPLATING_FULL,TC.apiLocation+TC.Consts.url.TEMPLATING_HBS_HELPERS]};TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS;TC.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:25828",name:"ETRS89 / UTM zone 28N",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:25829",name:"ETRS89 / UTM zone 29N",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:25831",name:"ETRS89 / UTM zone 31N",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"});TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");TC.Cfg=TC.Util.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.describeFeatureType={};TC.cache={};TC.alert=function(t){alert(t)};TC.prompt=function(t,e,r){var n=prompt(t,e);TC.Util.isFunction(r)&&r(n)};TC.confirm=function(t,e,r){confirm(t)?TC.Util.isFunction(e)&&e():TC.Util.isFunction(r)&&r()};TC.error=function(t){window.console&&console.error(t)};TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.wrap={Map:function(t){var e=this;e.parent=t;e.map=null;e.getMap=function(){return e._promise}},Layer:function(t){var e=this;e.parent=t;e.layer=null;TC.EventTarget.call(e);e.getLayer=function(){return e.layer?Promise.resolve(e.layer):e._promise};e.setLayer=function(t){e.layer=t}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(t){this.parent=t},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},NavBarHome:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},Modify:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)},ResultsPanel:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};TC.inherit(TC.wrap.Layer,TC.EventTarget);TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBarHome,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.inherit(TC.wrap.control.ResultsPanel,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.loadJS(!TC.browserFeatures.urlParser(),TC.apiLocation+TC.Consts.url.URL_POLYFILL,function(){});var s={};TC.getUID=function(t){var e=s[t=t||""];e||(e=s[t]=1);var r=t+e;s[t]=e+1;return r};const l=/\+/g;function c(t){return t}function u(t){return decodeURIComponent(t.replace(l," "))}TC.cookie=function(t,e,r){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(e))||null===e)){r=TC.Util.extend({},r);null===e&&(r.expires=-1);if("number"==typeof r.expires){var n=r.expires,i=r.expires=new Date;i.setDate(i.getDate()+n)}e=String(e);return document.cookie=[encodeURIComponent(t),"=",r.raw?e:encodeURIComponent(e),r.expires?";expires="+r.expires.toUTCString():"",r.path?";path="+r.path:"",r.domain?";domain="+r.domain:"",r.secure?";secure":""].join("")}for(var o,a=(r=e||{}).raw?c:u,s=document.cookie.split("; "),l=0;o=s[l]&&s[l].split("=");l++)if(a(o.shift())===t)return a(o.join("="));return null}}()}document.addEventListener("DOMContentLoaded",function(){var t,e,r,n="Unknown library",i="OpenLayers";if(TC.Control){t="Compiled";window.ol&&(n=i+" "+ol.VERSION)}else{t="On demand";n=i}TC.version=TC.version+" ("+t+"; "+n+"; @ "+TC.apiLocation+")";TC.browser=TC.Util.getBrowser();TC.loadJS(!TC.Cfg.acceptedBrowserVersions,TC.apiLocation+"TC/config/browser-versions.js",function(t){var e=!0,r=TC.Cfg.acceptedBrowserVersions.filter(function(t){return t.name.toLowerCase()===TC.browser.name.toLowerCase()});if(r.length>0&&r[0].expired)TC.Cfg.loggingErrorsEnabled=!1;else{r.length>0&&!isNaN(r[0].version)&&TC.browser.version<r[0].version&&(e=!1);if(TC.Cfg.oldBrowserAlert&&!e){TC.Cfg.loggingErrorsEnabled=!1;const t=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale).then(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"outdatedBrowser"),TC.Consts.msgErrorMode.TOAST)})}}});/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart");if(TC.Cfg.loggingErrorsEnabled){window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;const t=(r=0,function(t){e=e||TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));var n,i,o,a="",s=-1,l=-1;if("unhandledrejection"===t.type){n=t.reason?t.reason.message:"";o=!t.reason||!t.reason.stack||t.reason.stack.indexOf(TC.apiLocation)>=0;i=t.reason}else{n=t.message;a=t.filename;s=t.lineno;l=t.colno;i=t.error;o=a.indexOf(TC.apiLocation)>=0}if((TC.Cfg.notifyApplicationErrors||o)&&r<TC.Cfg.maxErrorCount&&TC.Cfg.loggingErrorsEnabled){var c=o?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:n,url:a,lineNumber:s,column:l,appUrl:location.href,apiVersion:TC.version,prevState:e.getPreviousMapState(),userAgent:navigator.userAgent},i);r++;TC.isDebug||TC.i18n.loadResources(!TC.i18n[e.options.locale],TC.apiLocation+"TC/resources/",e.options.locale).then(function(){TC.error(TC.Util.getLocaleString(e.options.locale,"genericError")+(e.options.contactEmail||"webmaster@itracasa.es"),{type:TC.Consts.msgType.ERROR})})}return!1});window.addEventListener("error",t,!1);window.addEventListener("unhandledrejection",t,!1)}});if(!TC._hbs||!TC._hbs.compile&&Handlebars.compile){TC._hbs=Handlebars.create();Handlebars.noConflict()}TC._hbs.registerHelper("i18n",function(t,e){const r=TC.i18n.currentLocale[t];return"string"==typeof r?e?new TC._hbs.SafeString(r):r:t});TC._hbs.registerHelper("gt",function(t,e){return t>e});TC._hbs.registerHelper("lt",function(t,e){return t<e});TC._hbs.registerHelper("eq",function(t,e){return t==e});TC._hbs.registerHelper("round",function(t){return Math.round(t)});TC._hbs.registerHelper("lowerCase",function(t){return t.toLowerCase()});TC._hbs.registerHelper("startsWith",function(t,e){return t.startsWith(e)});TC._hbs.registerHelper("isObject",function(t,e){return"object"==typeof t?e.fn(this):e.inverse(this)});TC._hbs.registerHelper("isArray",function(t,e){return Array.isArray(t)?e.fn(this):e.inverse(this)});TC._hbs.registerHelper("isKeyValue",function(t,e){return t.hasOwnProperty("value")&&"object"!=typeof t.value?e.fn(this):e.inverse(this)});!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}}(function(){return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){return i(e[a][1][t]||t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){(function(t){"use strict";function r(){c=!0;for(var t,e,r=u.length;r;){for(e=u,u=[],t=-1;++t<r;)e[t]();r=u.length}c=!1}var n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){r(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(r,0)};else{var l=new t.MessageChannel;l.port1.onmessage=r,n=function(){l.port2.postMessage(0)}}var c,u=[];e.exports=function(t){1!==u.push(t)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){"use strict";function n(){}function i(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,t!==n&&l(this,t)}function o(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(t,e,r){u(function(){var n;try{n=e(r)}catch(e){return h.reject(t,e)}n===t?h.reject(t,new TypeError("Cannot resolve promise with itself")):h.resolve(t,n)})}function s(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function l(t,e){function r(e){i||(i=!0,h.reject(t,e))}function n(e){i||(i=!0,h.resolve(t,e))}var i=!1,o=c(function(){e(n,r)});"error"===o.status&&r(o.value)}function c(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}var u=t(1),h={},d=["REJECTED"],p=["FULFILLED"],f=["PENDING"];e.exports=i,i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){if("function"!=typeof t&&this.state===p||"function"!=typeof e&&this.state===d)return this;var r=new this.constructor(n);this.state!==f?a(r,this.state===p?t:e,this.outcome):this.queue.push(new o(r,t,e));return r},o.prototype.callFulfilled=function(t){h.resolve(this.promise,t)},o.prototype.otherCallFulfilled=function(t){a(this.promise,this.onFulfilled,t)},o.prototype.callRejected=function(t){h.reject(this.promise,t)},o.prototype.otherCallRejected=function(t){a(this.promise,this.onRejected,t)},h.resolve=function(t,e){var r=c(s,e);if("error"===r.status)return h.reject(t,r.value);var n=r.value;if(n)l(t,n);else{t.state=p,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},h.reject=function(t,e){t.state=d,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},i.resolve=function(t){return t instanceof this?t:h.resolve(new this(n),t)},i.reject=function(t){var e=new this(n);return h.reject(e,t)},i.all=function(t){function e(t,e){r.resolve(t).then(function(t){a[e]=t,++s!==i||o||(o=!0,h.resolve(c,a))},function(t){o||(o=!0,h.reject(c,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,o=!1;if(!i)return this.resolve([]);for(var a=new Array(i),s=0,l=-1,c=new this(n);++l<i;)e(t[l],l);return c},i.race=function(t){function e(t){r.resolve(t).then(function(t){o||(o=!0,h.resolve(s,t))},function(t){o||(o=!0,h.reject(s,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,o=!1;if(!i)return this.resolve([]);for(var a=-1,s=new this(n);++a<i;)e(t[a]);return s}},{1:1}],3:[function(t,e,r){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,r){"use strict";function n(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)r.append(t[n]);return r.getBlob(e.type)}}function i(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function o(t,e,r){"function"==typeof e&&t.then(e),"function"==typeof r&&t.catch(r)}function a(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function s(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(t){for(var e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r),i=0;i<e;i++)n[i]=t.charCodeAt(i);return r}function c(t){return"boolean"==typeof M?R.resolve(M):function(t){return new R(function(e){var r=t.transaction(O,F),i=n([""]);r.objectStore(O).put(i,"key"),r.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},r.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);e(r||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return M=t})}function u(t){var e=k[t.name],r={};r.promise=new R(function(t,e){r.resolve=t,r.reject=e}),e.deferredOperations.push(r),e.dbReady?e.dbReady=e.dbReady.then(function(){return r.promise}):e.dbReady=r.promise}function h(t){var e=k[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function d(t,e){var r=k[t.name].deferredOperations.pop();if(r)return r.reject(e),r.promise}function p(t,e){return new R(function(r,n){if(k[t.name]=k[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return r(t.db);u(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var o=I.open.apply(I,i);e&&(o.onupgradeneeded=function(e){var r=o.result;try{r.createObjectStore(t.storeName),e.oldVersion<=1&&r.createObjectStore(O)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),o.onerror=function(t){t.preventDefault(),n(o.error)},o.onsuccess=function(){r(o.result),h(t)}})}function f(t){return p(t,!1)}function g(t){return p(t,!0)}function y(t,e){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,i=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),i||r){if(r){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function m(t){return n([l(atob(t.data))],{type:t.type})}function C(t){return t&&t.__local_forage_encoded_blob}function v(t){var e=this,r=e._initReady().then(function(){var t=k[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return o(r,t,t),r}function T(t,e,r,n){void 0===n&&(n=1);try{var i=t.db.transaction(t.storeName,e);r(null,i)}catch(i){if(n>0&&(!t.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return R.resolve().then(function(){if(!t.db||"NotFoundError"===i.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),g(t)}).then(function(){return function(t){u(t);for(var e=k[t.name],r=e.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return t.db=null,f(t).then(function(e){return t.db=e,y(t)?g(t):e}).then(function(n){t.db=e.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n}).catch(function(e){throw d(t,e),e})}(t).then(function(){T(t,e,r,n-1)})}).catch(r);r(i)}}function _(t){var e,r,n,i,o,a=.75*t.length,s=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(e=0;e<s;e+=4)r=G.indexOf(t[e]),n=G.indexOf(t[e+1]),i=G.indexOf(t[e+2]),o=G.indexOf(t[e+3]),u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function S(t){var e,r=new Uint8Array(t),n="";for(e=0;e<r.length;e+=3)n+=G[r[e]>>2],n+=G[(3&r[e])<<4|r[e+1]>>4],n+=G[(15&r[e+1])<<2|r[e+2]>>6],n+=G[63&r[e+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function E(t,e,r,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function w(t,e,r,n,i,o){t.executeSql(r,n,i,function(t,a){a.code===a.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],function(t,s){s.rows.length?o(t,a):E(t,e,function(){t.executeSql(r,n,i,o)},o)},o):o(t,a)},o)}function b(t,e){var r=t.name+"/";return t.storeName!==e.storeName&&(r+=t.storeName+"/"),r}function L(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}function A(t,e){t[e]=function(){var r=arguments;return t.ready().then(function(){return t[e].apply(t,r)})}}function x(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var r in e)e.hasOwnProperty(r)&&(lt(e[r])?arguments[0][r]=e[r].slice():arguments[0][r]=e[r])}return arguments[0]}var P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();"undefined"==typeof Promise&&t(3);var R=Promise,O="local-forage-detect-blob-support",M=void 0,k={},N=Object.prototype.toString,D="readonly",F="readwrite",B={_driver:"asyncStorage",_initStorage:function(t){function e(){return R.resolve()}var r=this,n={db:null};if(t)for(var i in t)n[i]=t[i];var o=k[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},k[n.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=v);for(var a=[],s=0;s<o.forages.length;s++){var l=o.forages[s];l!==r&&a.push(l._initReady().catch(e))}var c=o.forages.slice(0);return R.all(a).then(function(){return n.db=o.db,f(n)}).then(function(t){return n.db=t,y(n,r._defaultConfig.version)?g(n):t}).then(function(t){n.db=o.db=t,r._dbInfo=n;for(var e=0;e<c.length;e++){var i=c[e];i!==r&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})},_support:function(){try{if(!I)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var r=this,n=new R(function(e,n){r.ready().then(function(){T(r._dbInfo,D,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;C(n)&&(n=m(n));var i=t(n,r.key,s++);void 0!==i?e(i):r.continue()}else e()},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=new R(function(e,n){r.ready().then(function(){T(r._dbInfo,D,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),C(t)&&(t=m(t)),e(t)},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},setItem:function(t,e,r){var n=this;t=a(t);var o=new R(function(r,i){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===N.call(e)?c(o.db).then(function(t){return t?e:function(t){return new R(function(e,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:t.type})},n.readAsBinaryString(t)})}(e)}):e}).then(function(e){T(n._dbInfo,F,function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),r(e)},a.onabort=a.onerror=function(){var t=l.error?l.error:l.transaction.error;i(t)}}catch(t){i(t)}})}).catch(i)});return i(o,r),o},removeItem:function(t,e){var r=this;t=a(t);var n=new R(function(e,n){r.ready().then(function(){T(r._dbInfo,F,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(a.error)},o.onabort=function(){var t=a.error?a.error:a.transaction.error;n(t)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},clear:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){T(e._dbInfo,F,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=o.error?o.error:o.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r},length:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){T(e._dbInfo,D,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){r(o.error)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r},key:function(t,e){var r=this,n=new R(function(e,n){t<0?e(null):r.ready().then(function(){T(r._dbInfo,D,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,l=a.openCursor();l.onsuccess=function(){var r=l.result;r?0===t?e(r.key):s?e(r.key):(s=!0,r.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},keys:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){T(e._dbInfo,D,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var e=o.result;e?(a.push(e.key),e.continue()):t(a)},o.onerror=function(){r(o.error)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r},dropInstance:function(t,e){e=s.apply(this,arguments);var r,n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);if(t.name){var o=t.name===n.name&&this._dbInfo.db?R.resolve(this._dbInfo.db):f(t).then(function(e){var r=k[t.name],n=r.forages;r.db=e;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=e;return e});r=t.storeName?o.then(function(e){if(e.objectStoreNames.contains(t.storeName)){var r=e.version+1;u(t);var n=k[t.name],i=n.forages;e.close();for(var o=0;o<i.length;o++){var a=i[o];a._dbInfo.db=null,a._dbInfo.version=r}return new R(function(e,n){var i=I.open(t.name,r);i.onerror=function(t){i.result.close(),n(t)},i.onupgradeneeded=function(){i.result.deleteObjectStore(t.storeName)},i.onsuccess=function(){var t=i.result;t.close(),e(t)}}).then(function(t){n.db=t;for(var e=0;e<i.length;e++){var r=i[e];r._dbInfo.db=t,h(r._dbInfo)}}).catch(function(e){throw(d(t,e)||R.resolve()).catch(function(){}),e})}}):o.then(function(e){u(t);var r=k[t.name],n=r.forages;e.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;return new R(function(e,r){var n=I.deleteDatabase(t.name);n.onerror=n.onblocked=function(t){var e=n.result;e&&e.close(),r(t)},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}}).then(function(t){r.db=t;for(var e=0;e<n.length;e++)h(n[e]._dbInfo)}).catch(function(e){throw(d(t,e)||R.resolve()).catch(function(){}),e})})}else r=R.reject("Invalid arguments");return i(r,e),r}},G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U="~~local_forage_type~",j=/^~~local_forage_type~([^~]+)~/,q="__lfsc__:",W=q.length,H="arbf",V="blob",Y="si08",z="ui08",K="uic8",$="si16",X="si32",Z="ur16",J="ui32",Q="fl32",tt="fl64",et=W+H.length,rt=Object.prototype.toString,nt={serialize:function(t,e){var r="";if(t&&(r=rt.call(t)),t&&("[object ArrayBuffer]"===r||t.buffer&&"[object ArrayBuffer]"===rt.call(t.buffer))){var n,i=q;t instanceof ArrayBuffer?(n=t,i+=H):(n=t.buffer,"[object Int8Array]"===r?i+=Y:"[object Uint8Array]"===r?i+=z:"[object Uint8ClampedArray]"===r?i+=K:"[object Int16Array]"===r?i+=$:"[object Uint16Array]"===r?i+=Z:"[object Int32Array]"===r?i+=X:"[object Uint32Array]"===r?i+=J:"[object Float32Array]"===r?i+=Q:"[object Float64Array]"===r?i+=tt:e(new Error("Failed to get type for BinaryArray"))),e(i+S(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=U+t.type+"~"+S(this.result);e(q+V+r)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(r){console.error("Couldn't convert value into a JSON string: ",t),e(null,r)}},deserialize:function(t){if(t.substring(0,W)!==q)return JSON.parse(t);var e,r=t.substring(et),i=t.substring(W,et);if(i===V&&j.test(r)){var o=r.match(j);e=o[1],r=r.substring(o[0].length)}var a=_(r);switch(i){case H:return a;case V:return n([a],{type:e});case Y:return new Int8Array(a);case z:return new Uint8Array(a);case K:return new Uint8ClampedArray(a);case $:return new Int16Array(a);case Z:return new Uint16Array(a);case X:return new Int32Array(a);case J:return new Uint32Array(a);case Q:return new Float32Array(a);case tt:return new Float64Array(a);default:throw new Error("Unkown type: "+i)}},stringToBuffer:_,bufferToString:S},it={_driver:"webSQLStorage",_initStorage:function(t){var e=this,r={db:null};if(t)for(var n in t)r[n]="string"!=typeof t[n]?t[n].toString():t[n];var i=new R(function(t,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(t){return n(t)}r.db.transaction(function(i){E(i,r,function(){e._dbInfo=r,t()},function(t,e){n(e)})},n)});return r.serializer=nt,i},_support:"function"==typeof openDatabase,iterate:function(t,e){var r=this,n=new R(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){w(r,i,"SELECT * FROM "+i.storeName,[],function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var l=o.item(s),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=t(c,l.key,s+1)))return void e(c)}e()},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=new R(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){w(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],function(t,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),e(n)},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},setItem:function(t,e,r){return function t(e,r,n,o){var s=this;e=a(e);var l=new R(function(i,a){s.ready().then(function(){void 0===r&&(r=null);var l=r,c=s._dbInfo;c.serializer.serialize(r,function(r,u){u?a(u):c.db.transaction(function(t){w(t,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,r],function(){i(l)},function(t,e){a(e)})},function(r){if(r.code===r.QUOTA_ERR){if(o>0)return void i(t.apply(s,[e,l,n,o-1]));a(r)}})})}).catch(a)});return i(l,n),l}.apply(this,[t,e,r,1])},removeItem:function(t,e){var r=this;t=a(t);var n=new R(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){w(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},clear:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){w(e,n,"DELETE FROM "+n.storeName,[],function(){t()},function(t,e){r(e)})})}).catch(r)});return i(r,t),r},length:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){w(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(e,r){var n=r.rows.item(0).c;t(n)},function(t,e){r(e)})})}).catch(r)});return i(r,t),r},key:function(t,e){var r=this,n=new R(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){w(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,r){var n=r.rows.length?r.rows.item(0).key:null;e(n)},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},keys:function(t){var e=this,r=new R(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){w(e,n,"SELECT key FROM "+n.storeName,[],function(e,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);t(n)},function(t,e){r(e)})})}).catch(r)});return i(r,t),r},dropInstance:function(t,e){e=s.apply(this,arguments);var r=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||r.name,t.storeName=t.storeName||r.storeName);var n,o=this;return i(n=t.name?new R(function(e){var n;n=t.name===r.name?o._dbInfo.db:openDatabase(t.name,"","",0),e(t.storeName?{db:n,storeNames:[t.storeName]}:function(t){return new R(function(e,r){t.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).name);e({db:t,storeNames:i})},function(t,e){r(e)})},function(t){r(t)})})}(n))}).then(function(t){return new R(function(e,r){t.db.transaction(function(n){function i(t){return new R(function(e,r){n.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(t,e){r(e)})})}for(var o=[],a=0,s=t.storeNames.length;a<s;a++)o.push(i(t.storeNames[a]));R.all(o).then(function(){e()}).catch(function(t){r(t)})},function(t){r(t)})})}):R.reject("Invalid arguments"),e),n}},ot={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var r in t)e[r]=t[r];return e.keyPrefix=b(t,this._defaultConfig),L()?(this._dbInfo=e,e.serializer=nt,R.resolve()):R.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var r=this,n=r.ready().then(function(){for(var e=r._dbInfo,n=e.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var l=localStorage.key(s);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(i),a++)))return c}}});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=r.ready().then(function(){var e=r._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return i(n,e),n},setItem:function(t,e,r){var n=this;t=a(t);var o=n.ready().then(function(){void 0===e&&(e=null);var r=e;return new R(function(i,o){var a=n._dbInfo;a.serializer.serialize(e,function(e,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+t,e),i(r)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})});return i(o,r),o},removeItem:function(t,e){var r=this;t=a(t);var n=r.ready().then(function(){var e=r._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return i(n,e),n},clear:function(t){var e=this,r=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(t)&&localStorage.removeItem(n)}});return i(r,t),r},length:function(t){var e=this.keys().then(function(t){return t.length});return i(e,t),e},key:function(t,e){var r=this,n=r.ready().then(function(){var e,n=r._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e});return i(n,e),n},keys:function(t){var e=this,r=e.ready().then(function(){for(var t=e._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(t.keyPrefix)&&n.push(o.substring(t.keyPrefix.length))}return n});return i(r,t),r},dropInstance:function(t,e){if(e=s.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var r=this.config();t.name=t.name||r.name,t.storeName=t.storeName||r.storeName}var n,o=this;return i(n=t.name?new R(function(e){e(t.storeName?b(t,o._defaultConfig):t.name+"/")}).then(function(t){for(var e=localStorage.length-1;e>=0;e--){var r=localStorage.key(e);0===r.indexOf(t)&&localStorage.removeItem(r)}}):R.reject("Invalid arguments"),e),n}},at=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},st=function(t,e){for(var r=t.length,n=0;n<r;){if(at(t[n],e))return!0;n++}return!1},lt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ct={},ut={},ht={INDEXEDDB:B,WEBSQL:it,LOCALSTORAGE:ot},dt=[ht.INDEXEDDB._driver,ht.WEBSQL._driver,ht.LOCALSTORAGE._driver],pt=["dropInstance"],ft=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(pt),gt={description:"",driver:dt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},yt=new(function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r in ht)if(ht.hasOwnProperty(r)){var n=ht[r],i=n._driver;this[r]=i,ct[i]||this.defineDriver(n)}this._defaultConfig=x({},gt),this._config=x({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":P(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,r){var n=new R(function(e,r){try{var n=t._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void r(o);for(var a=ft.concat("_initStorage"),s=0,l=a.length;s<l;s++){var c=a[s];if((!st(pt,c)||t[c])&&"function"!=typeof t[c])return void r(o)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),r=R.reject(e);return i(r,arguments[arguments.length-1]),r}},r=0,n=pt.length;r<n;r++){var o=pt[r];t[o]||(t[o]=e(o))}}();var u=function(r){ct[n]&&console.info("Redefining LocalForage driver: "+n),ct[n]=t,ut[n]=r,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(u,r):u(!!t._support):u(!0)}catch(t){r(t)}});return o(n,e,r),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,r){var n=ct[t]?R.resolve(ct[t]):R.reject(new Error("Driver not found."));return o(n,e,r),n},t.prototype.getSerializer=function(t){var e=R.resolve(nt);return o(e,t),e},t.prototype.ready=function(t){var e=this,r=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return o(r,t,t),r},t.prototype.setDriver=function(t,e,r){function n(){a._config.driver=a.driver()}function i(t){return a._extend(t),n(),a._ready=a._initStorage(a._config),a._ready}var a=this;lt(t)||(t=[t]);var s=this._getSupportedDrivers(t),l=null!==this._driverSet?this._driverSet.catch(function(){return R.resolve()}):R.resolve();return this._driverSet=l.then(function(){var t=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,n(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(t){return function(){var e=0;return function r(){for(;e<t.length;){var o=t[e];return e++,a._dbInfo=null,a._ready=null,a.getDriver(o).then(i).catch(r)}n();var s=new Error("No available storage method found.");return a._driverSet=R.reject(s),a._driverSet}()}}(s)})}).catch(function(){n();var t=new Error("No available storage method found.");return a._driverSet=R.reject(t),a._driverSet}),o(this._driverSet,e,r),this._driverSet},t.prototype.supports=function(t){return!!ut[t]},t.prototype._extend=function(t){x(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];this.supports(i)&&e.push(i)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ft.length;t<e;t++)A(this,ft[t])},t.prototype.createInstance=function(e){return new t(e)},t}());e.exports=yt},{3:3}]},{},[4])(4)});TC.Layer=function(t){this.options=t||{};TC.Util.extend(this,this.options);this.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i;this.id=this.options.id||TC.getUID();this.map=this.options.map;this.type=this.options.type||TC.Consts.layerType.WMS;this.customLegend=this.options.customLegend;var e=this.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;this.options.format=this.options.format||e;this.options.owner&&(this.owner=this.options.owner);void 0===this.options.hideTree&&(this.options.hideTree=!0);void 0===this.options.hideTitle&&(this.options.hideTitle=!1);this._cache={visibilityStates:{}};this.tree=null;this.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(t){this.wrap.setVisibility(t)};TC.Layer.prototype.getVisibility=function(){var t=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(t=this.wrap.getVisibility()));return t};TC.Layer.prototype.getOpacity=function(){var t=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(t=this.wrap.layer.getOpacity()));return t};TC.Layer.prototype.setOpacity=function(t,e){var r=this;this.wrap.getLayer().then(function(n){n.setOpacity(t);r.opacity=t;r.map&&!e&&r.map.trigger(TC.Consts.event.LAYEROPACITY,{layer:r,opacity:t})})};TC.Layer.prototype.isCompatible=function(t){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var t=!0;switch(this.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:t=!1}return t};TC.Layer.prototype.isVisibleByScale=function(t){return!0};TC.Layer.prototype.isVisibleByName=function(t){return!0};TC.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}};TC.Layer.prototype.findNode=function t(e,r){var n=null;if(r.uid==e)n=r;else for(var i=0;i<r.children.length;i++){var o=t(e,r.children[i]);if(o){n=o;break}}return n};TC.Layer.prototype.setNodeVisibility=function(t,e){this.setVisibility(e)};TC.Layer.prototype.getNodeVisibility=function(t){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.Layer.prototype.setProjection=function(){};TC.Layer.prototype.getBySSL_=function(t){return t.replace(this.PROTOCOL_REGEX,"https://")};!function(){const t=window.hasOwnProperty("Worker"),e=new Promise(function(e,r){if(t){var n=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?e(n):TC.ajax({url:n,method:"GET",responseType:"text"}).then(function(t){const r=t.data;var n=new Blob([r],{type:"text/javascript"}),i=window.URL.createObjectURL(n);e(i)},function(t){r(Error(t))})}}),r=function(t,e){return"No se pudo obtener el documento de capacidades del servicio "+t.url+": ["+e+"]"},n=function(t,e){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var r=t.CAPABILITIES_STORE_KEY_PREFIX+t.options.url,n=function(){e.hasOwnProperty("error")||t.getCapabilitiesPromise().then(function(){localforage.setItem(r,e).catch(t=>console.log(t))})};t.map?t.map.loaded(n):n()})};TC.Layer.prototype.getGetMapUrl=function(){return function(t){var e=t;if(t){var r=t.match(/\??SERVICE=\w+&/i);r&&(e=e.replace(r[0],""))}return e}(this.wrap.getGetMapUrl())};TC.Layer.prototype.getCapabilitiesOnline=function(){var i=this;return new Promise(function(o,a){const s=i.getGetCapabilitiesUrl();i.toolProxification.fetch(s,{retryAttempts:2}).then(function(s){(function(r,i){var o;if(i.documentElement){const t=i.getElementsByTagName("ServiceException")[0];if(t)o={error:t.textContent};else{var a=r.type===TC.Consts.layerType.WMTS?new r.wrap.WmtsParser:new r.wrap.WmsParser;o=a.read(i);if(r.type===TC.Consts.layerType.WMTS&&o.Contents&&o.Contents.Layer){const t=i.getElementsByTagName("Layer");for(var s=0,l=t.length;s<l;s++){const e=t[s];var c=TC.Util.getElementByNodeName(e,"ows:Identifier")[0].firstChild.data,u=o.Contents.Layer.filter(function(t){return t.Identifier==c});if(u.length){u=u[0];for(var h=0;h<u.TileMatrixSetLink.length;h++){var d,p=u.TileMatrixSetLink[h];matrixId=p.TileMatrixSet;const t=e.getElementsByTagName("TileMatrixSetLink");for(var f=0,g=t.length;f<g;f++){const e=t[f];if(e.querySelector("TileMatrixSet:first").textContent==matrixId){d=e;break}}if(d){p.TileMatrixSetLimits=[];const t=d.getElementsByTagName("TileMatrixLimits");for(f=0,g=t.length;f<g;f++){const e=t[f];p.TileMatrixSetLimits.push({TileMatrix:e.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(e.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(e.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(e.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(e.getElementsByTagName("MaxTileCol")[0].textContent)})}}}}}}}n(r,o);return Promise.resolve(o)}return new Promise(function(a,s){t&&"string"==typeof i?e.then(function(t){var e=new Worker(t);e.onmessage=function(t){if("success"===t.data.state){o=t.data.capabilities;n(r,o)}else s((o={error:"Web worker error"}).error);a(o);e.terminate()};e.postMessage({type:r.type,text:i,url:TC.apiLocation.indexOf("http")>=0?TC.apiLocation:document.location.protocol+TC.apiLocation})}):a(o=i)})})(i,s.responseText).then(function(t){t.error?a(Error(r(i,t.error))):o(t)}).catch(function(t){a(Error(t))})}).catch(function(t){a(Error(r(i,t)))})})};TC.Layer.prototype.getCapabilitiesFromStorage=function(){var t=this;return new Promise(function(e,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(t.CAPABILITIES_STORE_KEY_PREFIX+t.url).then(function(n){n?e(n):r(Error("Capabilities not in storage: "+t.url))}).catch(function(){r(Error("Undefined storage error"))})})})}}();TC.control=TC.control||{};TC.Control=function(){const t=this;TC.EventTarget.call(t);t.map=null;t.isActive=!1;t.isDisabled=!1;var e=arguments.length;t.options=TC.Util.extend({},e>1?arguments[1]:arguments[0]);t.id=t.options.id||TC.getUID(t.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]);TC._jQueryIsLoaded&&(t._$div=$(t.div));t.div.classList.add(TC.Control.prototype.CLASS,t.CLASS);t.template=t.options.template||t.template;t.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template="";t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};const e=function(t,e,r){return new Promise(function(n,i){const o=[],a=[];for(var s in r){var l=r[s];if("string"==typeof l)if(dust.cache[t.CLASS])dust.render(t.CLASS,e,function(e,r){t.div.innerHTML=r;e&&TC.error(e)});else{var c=TC.ajax({url:l,method:"GET",responseType:"text"});o.push(c);a.push(s)}else TC.Util.isFunction(l)&&l()}0===o.length?n():Promise.all(o).then(function(t){t.map(t=>t.data).forEach(function(t,e){const r=dust.compile(t,a[e]);dust.loadSource(r)});n()}).catch(function(t){console.error("Error fetching templates: "+t);i(t instanceof Error?t:Error(t))})})};t.renderData=function(t,r){const n=this;return new Promise(function(i,o){n.map&&n.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});n.div.classList.toggle(TC.Consts.classes.DISABLED,n.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var a;if("object"==typeof n.template)a=e(n,t,n.template);else{var s={};n.template&&(s[n.CLASS]=n.template);a=e(n,t,s)}a.then(function(){dust.cache[n.CLASS]&&dust.render(n.CLASS,t,function(t,e){n.div.innerHTML=e;if(t){o(Error(t));TC.error(t)}});n.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(r)&&r();i()}).catch(function(t){o(t instanceof Error?t:Error(t))})})})};t.getRenderedHtml=function(t,e,r){const n=this;return new Promise(function(i,o){var a=function(){dust.cache[t]&&dust.render(t,e,function(t,e){if(t){TC.error(t);o(Error(t))}else{TC.Util.isFunction(r)&&r(e);i(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])a();else{var e=n.template[t];if("string"==typeof e)TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){const r=e.data;var n=dust.compile(r,t);dust.loadSource(n);a()}).catch(function(t){console.log("Error fetching template: "+t)});else if(TC.Util.isFunction(e)){e();a()}}})})};t.register=function(t){const e=this;return new Promise(function(r,n){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();r(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,r){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,r){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,r)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var r=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(r,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){}}();TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if(this.wrap.isNative(t)){this.wrap.feature=t;t._wrap=this.wrap;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();t._folders&&(this.folders=t._folders);this.data=this.wrap.getData()}var r=this.options=TC.Util.extend(!0,{},e);this.id=this.id||r.id||TC.getUID();this.data=r.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===r.showsPopup?this.showsPopup=!0:this.showsPopup=r.showsPopup;this.layer=r.layer||null;this._selected=!1;r.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var r=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});if(r.length>0){const t=r[0];t.isVisible()&&t.hide()}}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){const e=this;if(e._hasSelectedStyle!=t){e._hasSelectedStyle=t;e.wrap.toggleSelectedStyle(t)}};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(r,[])},r=function(r,n){t(n)?r[r.length]=n:r=r.concat(e(n));return r};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach(function(r,n){if(Array.isArray(r))e(r);else if(null===r)t[n]=0;else if("number"!=typeof r){console.log("Warning: coordinate does not have number type");t[n]=parseFloat(r)}})};Array.isArray(t)&&e(t);this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=TC.Util.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.unsetData=function(t){delete this.data[t];this.wrap.unsetData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,r=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),n=this.getData();if("object"==typeof n){var i=this.wrap.getTemplate();if(i)e=i.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return n[e]});else{var o=[];const t=[],i=TC.Util.getLocaleString(r,"open"),s=TC.Util.getLocaleString(r,"linkInNewWindow"),l=function(t){var e=[];if(TC.Util.isURL(t)){e[e.length]='<a href="';e[e.length]=t;e[e.length]='" target="_blank" title="';e[e.length]=s;e[e.length]='">';e[e.length]=i;e[e.length]="</a>"}else e[e.length]=void 0!==t?"number"==typeof t?TC.Util.formatNumber(t,r):t:"&mdash;";return e},c=function(t){var e=[];if(t instanceof Array){e[e.length]='<div class="complexAttr">';var n="complexAttr_"+TC.getUID();e[e.length]='<input type="checkbox" id="'+n+'" />';e[e.length]="<div>";e[e.length]='<label for="'+n+'" title="" class="plus"></label>';e[e.length]='<label for="'+n+'" title="" class="title">'+t.length+" "+TC.Util.getLocaleString(r,"featureInfo.complexData.array")+"</label><br/>";e[e.length]='<table class="complexAttr"><tbody>';for(var i=0;i<t.length;i++){e[e.length]="<tr><td>";(e=e.concat(c(t[i])))[e.length]="</td></tr>"}e[e.length]="</tbody></table></div></div>"}else if(t instanceof Object){e[e.length]='<table class="complexAttr"><tbody>';for(var i in t){e[e.length]="<tr>";if(t[i]&&t[i]instanceof Array){e[e.length]='<th style="display:none">'+i+"</th><td>";e[e.length]='<label for="'+n+'" class="title">'+i+"</label><br/>";(e=e.concat(c(t[i])))[e.length]="</div></td>"}else if(t[i]&&t[i]instanceof Object){n="complexAttr_"+TC.getUID();e[e.length]='<th style="display:none">'+i+"</th><td>";e[e.length]='<input type="checkbox" id="'+n+'" /><div>';e[e.length]='<label for="'+n+'" title="" class="plus"></label>';e[e.length]='<label for="'+n+'" title="" class="title">'+i+"</label><br/>";(e=e.concat(c(t[i])))[e.length]="</div></td>"}else{e[e.length]='<th class="key">'+i+"</th>";e[e.length]='<td class="value">';(e=e.concat(c(t[i])))[e.length]="</td>"}e[e.length]="</tr>"}e[e.length]="</tbody></table>"}else e=e.concat(l(t));return e};for(var a in n){const e=n[a],r=a.match(/^h(\d)_/i);if(r)t[r[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e){o[o.length]="<tr><th>";o[o.length]=a;o[o.length]="</th><td>";(o=o.concat(l(e)))[o.length]="</td></tr>"}else{o[o.length]="<tr><th>";o[o.length]=a;o[o.length]="</th><td>";(o=o.concat(c(e)))[o.length]="</td></tr>"}}const u=t.map(function(t,e){if(t)return"<h"+e+">"+t+"</h"+e+">"}).filter(function(t){return t});u.length&&(o=u.concat(o));if(o.length>0){o.unshift('<table class="tc-attr">');o[o.length]="</table>";e=o.join("")}}}else"string"==typeof n&&(e=n);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(r,"noData"));return e};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var n,i=t||e.popup;if(!i)for(var o=r.getControlsByClass("TC.control.Popup"),a=0,s=o.length;a<s;a++){var l=o[a];if(!l.caller){i=l;break}}if(i){i.currentFeature=e;n=Promise.resolve(i)}else n=r.addControl("popup");n.then(function(t){t.currentFeature=e;r.getControlsByClass(TC.control.Popup).filter(e=>e!==t&&e.isVisible()).forEach(t=>t.hide());e.wrap.showPopup(t);const n=t.contentDiv.querySelector("table.tc-attr"),i=t.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(n&&i.length){const t=n.getBoundingClientRect().width+"px";i.forEach(function(e){e.style.maxWidth=t})}r.trigger(TC.Consts.event.POPUP,{control:t});t.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var n,i={content:"table",titles:{main:TC.Util.getLocaleString(r.options.locale,"rsp.title"),max:TC.Util.getLocaleString(r.options.locale,"rsp.title")}},o=r.getControlsByClass("TC.control.ControlContainer")[0];if(o){i.position=o.POSITION.RIGHT;n=o.addControl("resultsPanel",i)}else{i.div=document.createElement("div");r.div.appendChild(i.div);n=r.addControl("resultsPanel",i)}n.then(function(t){t.currentFeature=e;0===r.getControlsByClass(TC.control.ControlContainer).length&&r.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});r.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&!t.chart&&t.close()});t.menuDiv.innerHTML="";t.open(e.getInfo({locale:r.options.locale}),t.getInfoContainer());var n=function(e){r.off(TC.Consts.event.VIEWCHANGE,n);t.close()};r.on(TC.Consts.event.VIEWCHANGE,n)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle(TC.Util.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){const t=this;t._selected=!1;t.setStyle(t.options);if(t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(t,e){TC.Feature.apply(this,arguments);if(!this.wrap.isNative(t)){this.wrap.feature=t;this.wrap.createPoint(t,e)}};TC.inherit(TC.feature.Point,TC.Feature);TC.feature.Point.prototype.STYLETYPE=TC.Consts.geom.POINT;TC.feature.Point.prototype.CLASSNAME="TC.feature.Point";TC.feature.Point.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[e]:e};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(t,e){const r=this;TC.Feature.apply(r,arguments);r.wrap.isNative(t)||r.wrap.createCircle(t,e)};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var t=TC.feature.Circle.prototype;t.STYLETYPE=TC.Consts.geom.POLYGON;t.CLASSNAME="TC.feature.Circle";t.getCoords=function(){return this.wrap.getGeometry()};t.setCoords=function(t){const e=this;if(!Array.isArray(t)||!Array.isArray(t[0])||Array.isArray(t[0][0])||Array.isArray(t[0][1])||Array.isArray(t[1]))throw new Error("Coordinates not valid for circle");return TC.Feature.prototype.setCoords.call(e,t)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){var n=r.layer&&r.layer.map?r.layer.map.options.locale:TC.Cfg.locale;r.title=e.title||TC.i18n[n][TC.Consts.MARKER];r.wrap.createMarker(t,e)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(t,e){const r=this;TC.Feature.apply(r,arguments);r.wrap.isNative(t)||r.wrap.createMultiPolygon(t,e)};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature.MultiPolygon.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],[].concat.apply([],e)):e};TC.feature.MultiPolygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for multipolygon");Array.isArray(t[0][0])?Array.isArray(t[0][0][0])||(t=[t]):t=[[t]];t.forEach(function(t){t.forEach(function(t){const e=t[0],r=t[t.length-1];e[0]===r[0]&&e[1]===r[1]||(t[t.length]=e)})});return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.MultiPolygon.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(t,e){const r=this;TC.Feature.apply(r,arguments);r.wrap.isNative(t)||r.wrap.createMultiPolyline(t,e)};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE="line";TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature.MultiPolyline.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e};TC.feature.MultiPolyline.prototype.setCoords=function(t){Array.isArray(t)&&Array.isArray(t[0])&&!Array.isArray(t[0][0])&&(t=[t]);return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.MultiPolyline.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(t,e){const r=this;TC.Feature.apply(r,arguments);r.wrap.isNative(t)||r.wrap.createPolygon(t,e)};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature.Polygon.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e};TC.feature.Polygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for polygon");Array.isArray(t[0][0])||(t=[t]);t.forEach(function(t){const e=t[0],r=t[t.length-1];e[0]===r[0]&&e[1]===r[1]||(t[t.length]=e)});return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.Polygon.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature.Polygon.prototype.getArea=function(t){return this.wrap.getArea(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(t,e){const r=this;TC.Feature.apply(r,arguments);r.wrap.isNative(t)||r.wrap.createPolyline(t,e)};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE="line";TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.feature.Polyline.prototype.setCoords=function(t){Array.isArray(t)&&!Array.isArray(t[0])&&(t=[t]);return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.Polyline.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.filter={};TC.filter.Filter=function(t){this.tagName_=t;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(t){if(t!=this){t._defaultNSURL=this._defaultNSURL;t._defaultPrefixNS=this._defaultPrefixNS;t._fieldTitle=this._fieldTitle}return t instanceof TC.filter.LogicalNary?t.write():t instanceof TC.filter.ComparisonBinary?t.write():t instanceof TC.filter.Comparison?t.write():t instanceof TC.filter.Spatial?t.write():(TC.filter.Function,t.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(t){const e=this;return e.conditions.reduce(function(t,r,n){return(t instanceof TC.filter.Filter?e.writeInnerCondition_(t):t)+e.writeInnerCondition_(r)})};TC.filter.Filter.prototype.getText=function(t){if(t&&parseFloat(t,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,e))};TC.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,e))};TC.filter.not=function(t){return new TC.filter.Not(t)};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(t,e,r){return new TC.filter.EqualTo(t,e,r)};TC.filter.notEqualTo=function(t,e,r){return new TC.filter.NotEqualTo(t,e,r)};TC.filter.lessThan=function(t,e){return new TC.filter.LessThan(t,e)};TC.filter.lessThanOrEqualTo=function(t,e){return new TC.filter.LessThanOrEqualTo(t,e)};TC.filter.greaterThan=function(t,e){return new TC.filter.GreaterThan(t,e)};TC.filter.greaterThanOrEqualTo=function(t,e){return new TC.filter.GreaterThanOrEqualTo(t,e)};TC.filter.isNull=function(t){return new TC.filter.IsNull(t)};TC.filter.between=function(t,e,r){return new TC.filter.IsBetween(t,e,r)};TC.filter.function=function(t,e){return new TC.filter.Function(t,e)};TC.filter.like=function(t,e,r,n,i,o){return new TC.filter.IsLike(t,e,r,n,i,o)};TC.filter.LogicalNary=function(t,e){TC.filter.Filter.call(this,t);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(t){var e=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(t){var e=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_()})};TC.filter.Not=function(t){this.condition=t;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Comparison=function(t,e){TC.filter.Filter.call(this,t);this.propertyName=e};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var t="";this.lowerBoundary&&this.upperBoundary&&(t="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(t="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(t=Array.isArray(this.params)?this.params.reduce(function(t,e,r){var n=function(t){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:t})};return(r>0?t:n(t))+n(e)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:t,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(t,e,r,n){TC.filter.Comparison.call(this,t,e);this.expression=r;this.matchCase=n};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(t,e,r){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",t,e,r)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",t,e)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",t,e)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",t,e)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(t,e,r){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",t,e,r)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(t,e,r,n,i,o){TC.filter.Comparison.call(this,"PropertyIsLike",t);this.pattern=e;this.wildCard=void 0!==r?r:"*";this.singleChar=void 0!==n?n:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=o};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(t){TC.filter.Comparison.call(this,"PropertyIsNull",t)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(t,e,r){TC.filter.Comparison.call(this,"PropertyIsBetween",t);this.lowerBoundary=e;this.upperBoundary=r};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(t,e){TC.filter.Filter.call(this,t);this.params=e};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var t="";if(this.params){var e=function(t,e){if("string"==typeof t)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:e,value:t});if("object"==typeof t){var r="";for(var n in t)r+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:e,value:t[n],key:n});return r}};if(Array.isArray(this.params)){var r=this._defaultPrefixNS;t=this.params.reduce(function(t,n,i){var o=function(t){return e(t,r)};return(i>1?t:o(t))+o(n)})}else t=e(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:t})};TC.filter.Spatial=function(t,e,r,n){TC.filter.Filter.call(this,t);this.geometryName=e;this.geometry=r;this.srsName=n;this.wrap=new TC.wrap.Filter(this)};TC.wrap.Filter=function(t){this.parent=t};TC.wrap.Filter.prototype.getAxisOrientation=function(){var t=this.parent.srsName;if(t){const e=t.match(/\d{4,6}$/);if(e){const r=e[0],n=ol.proj.get(t);if(n)return("neu"===n.axisOrientation_?"urn:x-ogc:def:crs:EPSG:":"EPSG:")+r}}return t};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.wrap.getAxisOrientation()),fieldTitle:this._fieldTitle})};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.Bbox=function(t,e,r){TC.filter.Filter.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=r};TC.inherit(TC.filter.Bbox,TC.filter.Spatial);TC.filter.Bbox.prototype.write=function(){var t="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:t})};TC.filter.Intersects=function(t,e,r){TC.filter.Spatial.call(this,"Intersects",t,e,r)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(t,e,r){TC.filter.Spatial.call(this,"Within",t,e,r)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var t=TC.control.MapContents.prototype;t.CLASS="tc-ctl-mc";t.render=function(t,e){const r=this;return r._set1stRenderPromise(r.map?r.renderData(e?TC.Util.extend(r.map.getLayerTree(),e):r.map.getLayerTree(),function(){r.addUIEventListeners();"function"==typeof t&&t()}):Promise.reject(Error("Cannot render: control has no map")))};t.register=function(t){const e=this;return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),e.renderPromise()]).then(function(){for(var n=0,i=t.layers.length;n<i;n++)e.updateLayerTree(t.layers[n]);t.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){e.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(t){const r=t.layer;var n=r.names;!function t(e){var r=!1;if(e)if(n.indexOf(e.name)>=0)r=!0;else for(var i=0;i<e.children.length;i++)if(t(e.children[i])){r=!0;break}return r}(e.layerTrees[r.id])&&0!==n.length?e.updateLayerTree(r):e.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(t){e.updateLayerVisibility(t.layer)}).on(TC.Consts.event.LAYERADD,function(t){e.updateLayerTree(t.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){const r=t.layer;e._updateLayerTreeTimeout&&clearTimeout(e._updateLayerTreeTimeout);e._updateLayerTreeTimeout=setTimeout(function(){if(e.map.workLayers.indexOf(r)>-1){e.updateLayerTree(r);delete e._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(t){e.removeLayer(t.layer)}).on(TC.Consts.event.LAYERORDER,function(t){e.updateLayerOrder(t.layer,t.oldIndex,t.newIndex)}).on(TC.Consts.event.LAYERERROR,function(t){e.onErrorLayer(t.layer)});r(e)}).catch(function(t){n(t instanceof Error?t:Error(t))})})};t.updateScale=function(){};t.updateLayerVisibility=function(t){};t.updateLayerTree=function(t){this.layerTrees[t.id]=t.getTree()};t.updateLayerOrder=function(t,e,r,n){const i=this;if(e>=0&&e!==r){var o,a;const e=i.getLayerUIElements();for(var s=(n=n||i.map.workLayers).length-1;s>=0;s--){const r=n[s];a=o;for(var l=0,c=e.length;l<c;l++){const t=e[l];if(t.dataset.layerId===r.id){o=t;break}}if(r===t){o&&(a?a.insertAdjacentElement("afterend",o):o.parentElement.firstChild.insertAdjacentElement("beforebegin",o));break}}}};t.removeLayer=function(t){const e=this,r=e.getLayerUIElements();for(var n=0,i=r.length;n<i;n++){const e=r[n];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}0===e.getLayerUIElements().length&&e.div.querySelector("."+e.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};t.onErrorLayer=function(t){};t.getLayerUIElements=function(){return this.div.querySelector("ul").children};t.styleLegendImage=function(t,e){if(!t.getAttribute("src")){var r=t.dataset.img;const l=new TC.tool.Proxification(TC.proxify);if(e&&e.options.method&&"POST"===e.options.method)e.getLegendGraphicImage().then(function(e){t.src=e}).catch(function(t){TC.error(t)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const c=t.parentElement;var n=c.style.color,i=n.indexOf("("),o=n.indexOf(")");if(i>=0&&o>i){color=n.substr(0,o).substr(i+1).split(",");n="0x";for(var a=0;a<3;a++){var s=parseInt(color[a]).toString(16);n+=1===s.length?"0"+s:s}}else n.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+c.style.fontFamily+";fontSize:"+parseInt(c.style.fontSize)+";fontColor:"+n+";fontAntiAliasing:true";e.params&&e.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:e.params.sld_body}));l.fetchImage(r).then(function(t){t.dataset.img=t.src}).catch(function(t){TC.error(t)})}l.fetchImage(r).then(function(e){t.src=e.src}).catch(function(t){TC.error(t.statusText)})}}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapInfo=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.MapInfo,TC.Control);!function(){var t=TC.control.MapInfo.prototype;t.CLASS="tc-ctl-mi";t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.QR_MAX_URL_LENGTH=150;e.SHORTEN_URL_LENGTH=32715;e.exportsState=!1;e.includeControls=void 0===e.options.includeControls||e.options.includeControls;t.ready(function(){const r=t.state&&t.state.ctl;if(r&&!t._controlStatesLoaded){e.importControlStates(r);t._controlStatesLoaded=!0}});return r};t.exportControlStates=function(){const t=this;return t.map?t.map.controls.map(function(t){return t.exportState()}).filter(function(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!0;return!1}):[]};t.importControlStates=function(t){const e=this;e.map&&t.forEach(function(t){const r=e.map.getControlById(t.id);r&&e.map.loaded(function(){r.importState(t)})})};t.exportState=function(){const t=this;if(t.exportsState){const r={};if(t.featureToShare||t.sharedFeaturesLayer){var e;r.id=t.id;if(t.featureToShare){const r=t.featureToShare.clone();r.showsPopup=!0;e=t.featureToShare.layer.exportState({features:[r]})}else e=t.sharedFeaturesLayer.exportState();r.features=e.features;e.crs&&(r.crs=e.crs)}return r}return null};t.importState=function(t){const e=this;e.map&&t.features.length&&e.map.addLayer({id:e.getUID(),owner:e,type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then(function(r){e.sharedFeaturesLayer=r;r.importState({features:t.features,crs:t.crs}).then(function(){e.map.zoomToFeatures(r.features)})})};t.manageMaxLengthExceed=function(){throw"Falta implementaci\xf3n del m\xe9todo manageMaxLengthExceed"};t.generateLink=function(){var t=window.location.href,e=t.indexOf("#");e>0&&(t=t.substring(0,e));if(this.extraParams){var r=TC.Util.getQueryStringParams(t);TC.Util.extend(r,this.extraParams);var n=t.indexOf("?");n>=0&&(t=t.substring(0,n));t=t.concat("?",TC.Util.getParamString(r))}TC.Util.getParameterByName("lang").length>0&&(t=t.indexOf("&")>-1?t.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):t.replace("?lang="+TC.Util.getParameterByName("lang"),""));const i=this.includeControls?this.exportControlStates():[];this.exportsState&&(this.featureToShare||this.sharedFeaturesLayer)&&i.push(this.exportState());const o=i.length?{ctl:i}:void 0;var a=this.map.getMapState(o),s=t.concat("#",a);this.manageMaxLengthExceed({browser:s.length>TC.Consts.URL_MAX_LENGTH,qr:s.length>this.SHORTEN_URL_LENGTH});return s};t.shortenedLink=function(){const t=this;var e;return new Promise(function(r,n){const i=function(){t.map.toast(t.getLocaleString("urlTooLongForShortener"),{type:TC.Consts.msgType.ERROR});t.map.getLoadingIndicator().removeWait(e);r("")};var o=function(){var e=t.generateLink(),r=e.indexOf("?"),n=e.indexOf("#");r>0&&(e=r<n?e.replace(e.substring(r,n),""):e.replace(e.substring(r,e.length-1),""));return e}();if(o.length>t.QR_MAX_URL_LENGTH&&o.length<t.SHORTEN_URL_LENGTH){e=t.map.getLoadingIndicator().addWait();(function(t){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");var e=new FormData;e.append("url",t);return new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:e}).then(function(t){return t}).catch(function(t){return null})})(o).then(function(n){if(n&&n.responseText){t.map.getLoadingIndicator().removeWait(e);r(n.responseText.replace("http://","https://"))}else i()},i)}else{o.length>=t.SHORTEN_URL_LENGTH&&i();r("")}})};t.makeQRCode=function(t,e,r){const n=this;return new Promise(function(i,o){TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){n.shortenedLink().then(function(n){if((n=n||"").length>0){var o={text:n};if(e&&r){o.width=e;o.height=r}new MutationObserver(function(t,e){var r=t.filter(function(t){return"attributes"===t.type}).filter(function(t){return t.attributeName.indexOf("src")>-1});if(r.length>0){e.disconnect();i(r[0].target.src)}}).observe(t,{attributes:!0,childList:!0,subtree:!0});new QRCode(t,o)}else i()})})})};t.drawScaleBarIntoCanvas=function(t){var e,r=this.map.getControlsByClass(TC.control.ScaleBar);if(0==r.length)return null;var n=(e=(t=t||{}).canvas?t.canvas:document.createElement("CANVAS")).getContext("2d");n.save();var i,o,a=document.getElementsByClassName("ol-scale-line-inner").item(0),s=TC.Util.extend({},a.getBoundingClientRect()),l=a.textContent;n.beginPath();n.strokeStyle=window.getComputedStyle(a).borderColor;if(s.width>s.height){i=s.width;o=s.height}else{i=s.height;o=s.width}if(t.setSize){e.width=i;e.height=o}s.left=null!=t.left?t.left:15;s.top=null!=t.top?t.top:15;n.moveTo(s.left,s.top);n.lineTo(s.left,s.top+o);n.lineTo(s.left+i,s.top+o);n.lineTo(s.left+i,s.top);n.stroke();n.measureText(l);var c={x:s.left+i/2,y:s.top+o/2};t.fill&&function(e,n,i){var o=document.getElementsByClassName(r[0].CLASS).item(0),a=TC.Util.extend({},o.getBoundingClientRect());a.left=(t.left||15)-2;a.top=t.top||15;a.top--;e.globalAlpha=.5;e.fillStyle=window.getComputedStyle(o).backgroundColor;n+=4;i+=4;e.fillRect(a.left,a.top,n,i)}(n,i,o);n.globalAlpha=1;n.fillStyle=null!=t.textColor?t.textColor:window.getComputedStyle(a).color;n.font=null!=t.font?t.font:window.getComputedStyle(a).fontSize+" "+window.getComputedStyle(a).fontFamily;n.textAlign="center";n.textBaseline="middle";n.fillText(l,c.x,c.y);return e};t.registerListeners=function(){const t=this;if(!t.registeredListeners){t.map.on(TC.Consts.event.LAYERADD,t.generateLink.bind(t)).on(TC.Consts.event.LAYERREMOVE,t.generateLink.bind(t)).on(TC.Consts.event.FEATUREADD,t.generateLink.bind(t)).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,t.generateLink.bind(t));t.registeredListeners=!0}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var t=TC.control.TOC.prototype;t.CLASS="tc-ctl-toc";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(e.get(["workLayers"],!1),e,{block:r},{}).w("</ul></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-toc-wlbranch",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:i},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:o},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node"')}n.__dustBody=!0;function i(t,e){return t.w(" checked")}i.__dustBody=!0;function o(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:i},{}).w('<input type="checkbox" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:o},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:a},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node"')}n.__dustBody=!0;function i(t,e){return t.w('<button class="tc-ctl-toc-collapse-btn"></button>')}i.__dustBody=!0;function o(t,e){return t.w(" checked")}o.__dustBody=!0;function a(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}a.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.control.MapContents.prototype.register.call(e,t);t.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){e.onExternalServiceAdded(t)});return r};t.onExternalServiceAdded=function(t){const e=this;if(t&&t.layer){t.layer.map=e.map;e.map.addLayer(t.layer).then(function(r){e.updateLayerTree(t.layer)})}};t.addUIEventListeners=function(){const t=this;t.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const r=e.target;for(var n=r;n&&!n.matches("ul."+t.CLASS+"-wl");)n=n.parentElement;const i=[];for(var o=0,a=n.children.length;o<a;o++){child=n.children[o];"LI"===child.tagName&&i.push(child)}for(o=0,a=i.length;o<a;o++){const e=i[o];if(e.contains(r)){const n=t.map.getLayer(e.dataset.layerId);var s=r;do{s=s.parentElement}while(s&&"LI"!==s.tagName);const i=s.dataset.layerUid;n.setNodeVisibility(i,r.checked);break}}e.stopPropagation()}));t.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",function(e){e.target.blur();const r=e.target.parentElement;if(!r.classList.contains(t.CLASS+"-leaf")){r.classList.toggle(TC.Consts.classes.COLLAPSED);r.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED);e.stopPropagation()}}))};t.update=function(){var t=this,e=function(t){for(var e=0,r=t.children.length;e<r;e++){const r=t.children[e];if(r.matches("input[type=checkbox]"))return r}return null};t.getLayerUIElements().forEach(function(r){const n=t.map.getLayer(r.dataset.layerId);if(n){e(r).checked=n.getVisibility();n.tree=null;r.querySelectorAll("li").forEach(function(t){const r=e(t),i=t.dataset.layerUid;switch(n.getNodeVisibility(i)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:r.checked=!0;r.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:r.checked=!1;r.indeterminate=!0;break;default:r.checked=!1;r.indeterminate=!1}})}});t.updateScale()};t.updateScale=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);e.querySelectorAll("li").forEach(function(e){const n=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!r.isVisibleByScale(n))})})};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);e.getRenderedHtml(e.CLASS+"-branch",e.layerTrees[t.id]).then(function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild,i=n.dataset.layerUid,o=e.div.querySelector("."+e.CLASS+'-wl li[data-layer-uid="'+i+'"]');if(o){o.innerHTML=n.innerHTML;o.setAttribute("class",n.getAttribute("class"));o.dataset.layerId||(o.dataset.layerId=t.id)}else{n.dataset.layerId=t.id;const r=e.div.querySelector("."+e.CLASS+"-wl");r.insertBefore(n,r.firstChild)}}).catch(function(t){TC.error(t)});var r="ul."+e.CLASS+"-wl",n="ul."+e.CLASS+"-branch",i="li."+e.CLASS+"-node",o="li."+e.CLASS+"-leaf";e.div.querySelectorAll(r+" "+n+" "+n+","+r+" "+n+" "+i).forEach(function(t){t.matches(o)||t.classList.add(TC.Consts.classes.COLLAPSED)});e.update()}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(r){if(r.dataset.layerId===t.id){var n=!t.getVisibility();r.querySelectorAll("input[type=checkbox]").forEach(function(t){t.matches("."+e.CLASS+"-branch-cb")?t.checked=!n:t.disabled=n})}})};t.updateLayerOrder=function(t,e,r){};t.render=function(t){const e=this;return TC.Control.prototype.render.call(e,function(){var r=e.options.controls||[];if(r.length>0){var n=r[0],i=document.createElement("div");e.div.appendChild(i);e.map.addControl(n.name,TC.Util.extend({div:i},n.options))}TC.Util.isFunction(t)&&t()})};t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var r=0,n=e.length;r<n;r++){child=e[r];"LI"===child.tagName&&(t[t.length]=child)}return t}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(t){TC.control.TOC.apply(this,arguments);this.layers=[];this.layerTools=[]};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var t=TC.control.WorkLayerManager.prototype;t.CLASS="tc-ctl-wlm";t.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="').h("i18n",e,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-wlm-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><div class="tc-ctl-wlm-content tc-hidden"><form><ul>').s(e.get(["workLayers"],!1),e,{block:r},{}).w("</ul></form></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-elm",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-elm"]=function(){dust.register(t.CLASS+"-elm",e);function e(t,e){return t.w('<li class="tc-ctl-wlm-elm" tabindex="-1"><div class="tc-ctl-wlm-lyr">').x(e.get(["path"],!1),e,{block:r},{}).w('</div><div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="').s(e.get(["path"],!1),e,{else:n,block:i},{}).w('">').s(e.get(["path"],!1),e,{else:a,block:s},{}).w('</div><div class="tc-ctl-wlm-buttons"><div class="tc-ctl-wlm-btn-info" title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('"></div><div class="tc-ctl-wlm-tools"></div><input type="range" value="').f(e.get(["opacity"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"transparencyOfThisLayer"}).w('" /><input id="tc-ctl-wlm-tools-visibility-').f(e.get(["id"],!1),e,"h").w('" type="checkbox" ').nx(e.get(["hide"],!1),e,{block:c},{}).w(' title="').h("i18n",e,{},{$key:"visibilityOfThisLayer"}).w('" /><label for="tc-ctl-wlm-tools-visibility-').f(e.get(["id"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"visibilityOfThisLayer"}).w('">').h("i18n",e,{},{$key:"visibilityOfThisLayer"}).w('</label><button class="tc-ctl-wlm-btn-del" ').x(e.get(["unremovable"],!1),e,{else:u,block:h},{}).w(">").h("i18n",e,{},{$key:"removeLayerFromMap"}).w('</button></div><div class="tc-ctl-wlm-info tc-hidden">').x(e.get(["abstract"],!1),e,{block:d},{}).x(e.get(["customLegend"],!1),e,{else:p,block:y},{}).x(e.get(["metadata"],!1),e,{block:m},{}).w('</div><div class="tc-ctl-wlm-dd" title="').h("i18n",e,{},{$key:"dragToReorder"}).w('"></div></li>')}e.__dustBody=!0;function r(t,e){return t.f(e.get(["title"],!1),e,"h")}r.__dustBody=!0;function n(t,e){return t.f(e.get(["title"],!1),e,"h")}n.__dustBody=!0;function i(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:o},{})}i.__dustBody=!0;function o(t,e){return t.w(" &bull; ")}o.__dustBody=!0;function a(t,e){return t.f(e.get(["title"],!1),e,"h")}a.__dustBody=!0;function s(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:l},{})}s.__dustBody=!0;function l(t,e){return t.w(" &bull; ")}l.__dustBody=!0;function c(t,e){return t.w('checked="checked"')}c.__dustBody=!0;function u(t,e){return t.w('title="').h("i18n",e,{},{$key:"removeLayerFromMap"}).w('"')}u.__dustBody=!0;function h(t,e){return t.w("disabled")}h.__dustBody=!0;function d(t,e){return t.w('<div class="tc-ctl-wlm-abstract"><h4>').h("i18n",e,{},{$key:"abstract"}).w("</h4><div><pre>").f(e.get(["abstract"],!1),e,"h",["s"]).w("</pre></div></div>")}d.__dustBody=!0;function p(t,e){return t.x(e.get(["legend"],!1),e,{block:f},{})}p.__dustBody=!0;function f(t,e){return t.w('<div class="tc-ctl-wlm-legend" data-layer-name="').f(e.get(["layerNames"],!1),e,"h").w('"><h4>').h("i18n",e,{},{$key:"content"}).w("</h4>").s(e.get(["legend"],!1),e,{block:g},{}).w("</div>")}f.__dustBody=!0;function g(t,e){return t.w("<div><p>").f(e.get(["title"],!1),e,"h").w('</p><img data-img="').f(e.get(["src"],!1),e,"h").w('" /></div>')}g.__dustBody=!0;function y(t,e){return t.w('<ul class="tc-ctl-wlm-custom-legend">').f(e.get(["customLegend"],!1),e,"h",["s"]).w("</ul>")}y.__dustBody=!0;function m(t,e){return t.w('<div class="tc-ctl-wlm-metadata"><h4>').h("i18n",e,{},{$key:"metadata"}).w("</h4><ul>").s(e.get(["metadata"],!1),e,{block:C},{}).w("</ul></div>")}m.__dustBody=!0;function C(t,e){return t.w('<li><a href="').f(e.get(["url"],!1),e,"h",["s"]).w('" type="').f(e.get(["format"],!1),e,"h").w('" title="').f(e.get(["formatDescription"],!1),e,"h").w('" target="_blank">').f(e.get(["formatDescription"],!1),e,"h").w("</a></li>")}C.__dustBody=!0;return e};t.template[t.CLASS+"-type-sgl"]=function(){dust.register(t.CLASS+"-type-sgl",e);function e(t,e){return t.h("i18n",e,{},{$key:"singleLayer"})}e.__dustBody=!0;return e};t.template[t.CLASS+"-type-grp"]=function(){dust.register(t.CLASS+"-type-grp",e);function e(t,e){return t.w("<div>").h("i18n",e,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(e.get(["Layer"],!1),e,{block:r},{}).w("</ul>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-type-grp-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-type-grp-node"]=function(){dust.register(t.CLASS+"-type-grp-node",e);function e(t,e){return t.w('<li class="tc-ctl-ltoc-tip-grp-elm"><span>').f(e.get(["Title"],!1),e,"h").w("</span><ul>").s(e.get(["Layer"],!1),e,{block:r},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-type-grp-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};const e=function(t,e){return t.getLayerUIElements().filter(function(t){return t.dataset.layerId===e.id})[0]};var r=function(t){return t.layers.length};const n=function(t){return!t.layers.some(function(t){return t.unremovable})},i=function(t,e,r,n,i){const o=t.getLayerUIElements();var a;if(n>r)a=o[n-1];else{if(!(n<r))return;a=o[n+1]}const s=t.map.getLayer(e.dataset.layerId),l=t.map.getLayer(a.dataset.layerId);for(var c=-1,u=0;u<t.map.layers.length;u++)if(l===t.map.layers[u]){c=u;break}c>=1&&c<t.map.layers.length&&t.map.insertLayer(s,c,i)};t.render=function(t,e){const r=this;return r._set1stRenderPromise(r.map?r.renderData(e?TC.Util.extend(r.map.getLayerTree(),e):r.map.getLayerTree(),function(){r.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){r.map.workLayers.filter(function(t){return!t.stealth}).forEach(function(t){r.updateLayerTree(t)});const e=r.div.querySelector("ul");r._sortable=Sortable.create(e,{handle:"."+r.CLASS+"-dd",animation:150,onSort:function(t){i(r,t.item,t.oldIndex,t.newIndex)}});e.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(t){for(var e=t.target;"LI"!==e.tagName;)if(!(e=e.parentElement))return;const n=function(t,n){const o=r._sortable.toArray(),a=o[t];o[t]=o[n];o[n]=a;r._sortable.sort(o);i(r,e,t,n)},o=r.getLayerUIElements(),a=o.indexOf(e);switch(!0){case/Up$/.test(t.key):if(a>0){n(a,a-1);e.focus();t.stopPropagation()}break;case/Down$/.test(t.key):if(a<o.length-1){n(a,a+1);e.focus();t.stopPropagation()}break;case/Enter$/.test(t.key):e.blur();t.stopPropagation()}}));"function"==typeof t&&t()})}):Promise.reject(Error("Cannot render: control has no map")))};t.register=function(t){const r=this;return new Promise(function(n,i){TC.control.TOC.prototype.register.call(r,t).then(function(){t.loaded(function(){r.updateScale()});t.on(TC.Consts.event.LAYEROPACITY,function(t){const n=e(r,t.layer);n&&(n.querySelector("input[type=range]").value=Math.round(100*t.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(e){var n=e.fileName;if(e.features&&e.features.length>0){var i="."+TC.Consts.format.GPX.toLowerCase();if(e.fileName.toLowerCase().indexOf(i)===e.fileName.length-i.length)return;t.one(TC.Consts.event.LAYERADD,function(t){if(t&&t.layer&&t.layer.title==n){r.map&&r.map.layout&&r.map.layout.accordion&&r.div.classList.contains(TC.Consts.classes.COLLAPSED)&&r.map.controls.filter(function(t){return t!==r&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});r.map.trigger(TC.Consts.event.TOOLSOPEN);r.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});n(r)})})};t.onExternalServiceAdded=function(t){};t.addUIEventListeners=function(){const t=this;t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&!n.matches("li."+t.CLASS+"-elm"));t.map.getLayer(n.dataset.layerId).setVisibility(r.checked);e.stopPropagation()}));const e=function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);t.map.getLayer(n.dataset.layerId).setOpacity(r.value/100)};t.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",e));t.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",e));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector(`.${t.CLASS}-btn-del:not(.disabled)`,function(e){var r=e.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=t.map.getLayer(r.dataset.layerId);t.map.removeLayer(n)}));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-del-all",function(e){TC.confirm(t.getLocaleString("layersRemove.confirm"),function(){t.getLayerUIElements().map(function(e){return t.map.getLayer(e.dataset.layerId)}).forEach(function(e){t.map.removeLayer(e)})})}));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-btn-info",function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const i=n.querySelector("."+t.CLASS+"-info"),o=t.map.getLayer(n.dataset.layerId);i.querySelectorAll("."+t.CLASS+"-legend img").forEach(function(e){t.styleLegendImage(e,o)});i.classList.toggle(TC.Consts.classes.HIDDEN);if(n.querySelector('input[type="checkbox"]').checked){n.querySelector("."+t.CLASS+"-dd").classList.toggle(TC.Consts.classes.HIDDEN,!i.classList.contains(TC.Consts.classes.HIDDEN))}r.classList.toggle(TC.Consts.classes.CHECKED)}))};t.updateLayerVisibility=function(t){const r=e(this,t);if(r){const e=t.getVisibility();r.querySelector('input[type="checkbox"]').checked=e}};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);for(var i=!1,o=0,a=e.layers.length;o<a;o++)if(t===e.layers[o]){i=!0;break}if(!i){e.layers.push(t);var s=t.title||t.wrap.getServiceTitle(),l={title:t.options.hideTitle?"":s,hide:!(!t.renderOptions||!t.renderOptions.hide),opacity:t.renderOptions&&t.renderOptions.opacity?100*t.renderOptions.opacity:100,customLegend:t.customLegend,unremovable:t.unremovable,id:t.id},c=t.isRaster();if(c){l.layerNames=t.layerNames;var u=t.getPath();u.shift();l.path=u;var h=t.names[0],d=t.wrap.getInfo(h);l.legend=d.legend;l.abstract=d.abstract;var p,f=d.hasOwnProperty("abstract")||d.hasOwnProperty("legend")||d.hasOwnProperty("metadata");if(t.tree&&t.tree.children&&t.tree.children.length&&t.tree.children[0].children&&t.tree.children[0].children.length)p=null;else if(p=d.metadata){var g=0;for(a=p.length;g<a;g++){var y=p[g];y.formatDescription=e.getLocaleString(TC.Util.getSimpleMimeType(y.format))||e.getLocaleString("viewMetadata")}}l.metadata=p}(function(t){return new Promise(function(e,r){t&&t.options.method&&"POST"===t.options.method?t.getLegendGraphicImage().then(function(t){e(t)}).catch(function(t){TC.error(t)}):e()})})(t).then(function(r){r&&(legend.src=r);e.getRenderedHtml(e.CLASS+"-elm",l).then(function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild;var i,o=!1;if(c&&!(o=t.names.length>1))for(var a=t.wrap.getAllLayerNodes(),s=0;s<a.length;s++){var l=a[s];if(t.wrap.getName(l)===h){i=l;t.wrap.getLayerNodes(l).length>0&&(o=!0);break}}const u=n.querySelector("."+e.CLASS+"-type"),d=o?e.CLASS+"-type-grp":e.CLASS+"-type-sgl";u.classList.add(d);f||n.querySelector("."+e.CLASS+"-btn-info").classList.add(TC.Consts.classes.HIDDEN);if(i){t.wrap.normalizeLayerNode(i);e.getRenderedHtml(d,i).then(function(t){var r;u.addEventListener("mouseover",function(n){const i=e.map.div,o=u.getBoundingClientRect();(r=document.createElement("div")).classList.add(e.CLASS+"-tip");r.innerHTML=t;r.style.top=o.top-i.offsetTop+"px";r.style.right=i.offsetWidth-(o.left-i.offsetLeft)+"px";i.appendChild(r)});u.addEventListener("mouseout",function(t){r.parentElement.removeChild(r)})})}const p=e.div.querySelector("ul");n.dataset.layerId=t.id;const g=e.getLayerUIElements(),y=e.map.workLayers.filter(function(t){return!t.stealth}),m=y.indexOf(t);e.layerTools.forEach(t=>e.addLayerToolUI(n,t));for(var C=!1,v=(s=0,g.length);s<v;s++){const t=g[s];if(y.indexOf(e.map.getLayer(t.dataset.layerId))<m){t.insertAdjacentElement("beforebegin",n);C=!0;break}}C||p.appendChild(n);void 0;e.updateScale()})});var m=r(e);const i=e.div.querySelector("."+e.CLASS+"-n"),o=e.div.querySelector("."+e.CLASS+"-empty"),C=e.div.querySelector("."+e.CLASS+"-content");i.textContent=m;if(m>0){i.classList.add(TC.Consts.classes.VISIBLE);o.classList.add(TC.Consts.classes.HIDDEN);C.classList.remove(TC.Consts.classes.HIDDEN)}else{i.classList.remove(TC.Consts.classes.VISIBLE);o.classList.remove(TC.Consts.classes.HIDDEN);C.classList.add(TC.Consts.classes.HIDDEN)}e.div.querySelector("."+e.CLASS+"-del-all").classList.toggle(TC.Consts.classes.HIDDEN,!n(e))}}};t.updateScale=function(){var t=this;t.getLayerUIElements().forEach(function(e){var r=t.map.getLayer(e.dataset.layerId);if(r&&r.names){for(var n=!1,i=0;i<r.names.length;i++)if(r.isVisibleByScale(r.names[i])){n=!0;break}e.classList.toggle(t.CLASS+"-elm-notvisible",!n)}})};t.updateLayerOrder=function(t,r,n){const i=this;i.map.workLayers.filter(function(t){return!t.stealth}).forEach(function(t){const r=e(i,t);r&&r.parentElement.firstChild.insertAdjacentElement("beforebegin",r)})};t.removeLayer=function(t){var e=this.layers.indexOf(t);e>=0&&this.layers.splice(e,1);this.getLayerUIElements().forEach(function(e){e.dataset.layerId===t.id&&e.parentElement.removeChild(e)});const i=this.div.querySelector("."+this.CLASS+"-content"),o=this.div.querySelector("."+this.CLASS+"-empty"),a=this.div.querySelector("."+this.CLASS+"-n");var s=r(this);a.textContent=s;if(s>0){i.classList.remove(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.VISIBLE)}else{n(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);i.classList.add(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.VISIBLE)}};t.getLayerUIElements=function(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))};t.addLayerToolUI=function(t,e){const r=this;if(TC.Util.isFunction(e.renderFn)){const n=e.renderFn(t.querySelector(`.${r.CLASS}-tools`),t.dataset.layerId);if(n){TC.Util.isFunction(e.actionFn)&&n.addEventListener(TC.Consts.event.CLICK,function(t){t.preventDefault();e.actionFn.call(n)});TC.Util.isFunction(e.updateFn)&&e.updateEvents&&map.on(e.updateEvents.join(" "),function(t){t.layer&&t.layer.id!==n.dataset.layerId||e.updateFn.call(n,t)})}}};t.addLayerTool=function(t){const e=this;e.layerTools.push(t);e.getLayerUIElements().forEach(function(r){e.addLayerToolUI(r,t)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){TC.Control.apply(this,arguments);this.options&&this.options.callback&&(this.callback=this.options.callback);this.wrap=new TC.wrap.control.Click(this)};TC.inherit(TC.control.Click,TC.Control);!function(){var t=TC.control.Click.prototype;t.CLASS="tc-ctl-click";t.register=function(t){this.wrap.register(t);return TC.Control.prototype.register.call(this,t)};t.activate=function(){TC.Control.prototype.activate.call(this);this.wrap.activate()};t.deactivate=function(){this.wrap.deactivate();TC.Control.prototype.deactivate.call(this)};t.callback=function(t,e){console.log("[Click]["+t[0]+", "+t[1]+"]["+e[0]+", "+e[1]+"]")}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);const t=this._classSelector="."+this.CLASS;this._selectors={LIST_ITEM:"ul"+t+"-features li"};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this._infoHistory={};this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var t=TC.control.FeatureInfoCommons.prototype;t.CLASS="tc-ctl-finfo";t.TITLE_SEPARATOR=" \u2022 ";t.DEFAULT_STROKE_COLOR="#0000ff";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(e.get(["crs"],!1),e,"h").w("</span></span>").x(e.get(["isGeo"],!1),e,{else:r,block:n},{}).x(e.get(["displayElevation"],!1),e,{block:i},{}).w('</div><ul class="tc-ctl-finfo-services">').s(e.get(["services"],!1),e,{else:o,block:l},{}).w("</ul>").x(e.get(["featureCount"],!1),e,{block:O},{})}e.__dustBody=!0;function r(t,e){return t.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","0"]),e,"h").w('</span></span><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","1"]),e,"h").w("</span></span>")}r.__dustBody=!0;function n(t,e){return t.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","1"]),e,"h").w('</span></span><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","0"]),e,"h").w("</span></span>")}n.__dustBody=!0;function i(t,e){return t.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-elev">').h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val"></span></span>')}i.__dustBody=!0;function o(t,e){return t.nx(e.get(["loading"],!1),e,{block:a},{})}o.__dustBody=!0;function a(t,e){return t.nx(e.get(["displayElevation"],!1),e,{block:s},{})}a.__dustBody=!0;function s(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noData"}).w("</li>")}s.__dustBody=!0;function l(t,e){return t.w("<li><h3>").x(e.get(["title"],!1),e,{else:c,block:d},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(e.get(["hasLimits"],!1),e,{else:p,block:R},{}).w("</div></li>")}l.__dustBody=!0;function c(t,e){return t.x(e.getPath(!1,["layers","0","title"]),e,{else:u,block:h},{})}c.__dustBody=!0;function u(t,e){return t.f(e.getPath(!1,["layer","name"]),e,"h")}u.__dustBody=!0;function h(t,e){return t.f(e.getPath(!1,["layers","0","title"]),e,"h")}h.__dustBody=!0;function d(t,e){return t.f(e.get(["title"],!1),e,"h")}d.__dustBody=!0;function p(t,e){return t.w('<ul class="tc-ctl-finfo-layers">').s(e.get(["layers"],!1),e,{else:f,block:g},{}).w("</ul>")}p.__dustBody=!0;function f(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noDataAtThisService"}).w("</li>")}f.__dustBody=!0;function g(t,e){return t.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(e.getPath(!1,["features","length"]),e,"h").w("</span> ").s(e.get(["path"],!1),e,{block:y},{}).w('</h4>                                            <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(e.get(["features"],!1),e,{else:C,block:v},{}).w("</ul></div></li>")}g.__dustBody=!0;function y(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:m},{})}y.__dustBody=!0;function m(t,e){return t.w(" &bull; ")}m.__dustBody=!0;function C(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noDataInThisLayer"}).w("</li>")}C.__dustBody=!0;function v(t,e){return t.w("<li>").x(e.get(["rawContent"],!1),e,{else:T,block:b},{}).w("</li>")}v.__dustBody=!0;function T(t,e){return t.x(e.get(["error"],!1),e,{else:_,block:w},{})}T.__dustBody=!0;function _(t,e){return t.w("<h5>").f(e.get(["id"],!1),e,"h").w("</h5><table").x(e.get(["geometry"],!1),e,{block:S},{}).w("><tbody>").s(e.get(["attributes"],!1),e,{block:E},{}).w("</tbody></table>")}_.__dustBody=!0;function S(t,e){return t.w(' title="').h("i18n",e,{},{$key:"clickToShowOnMap"}).w('"')}S.__dustBody=!0;function E(t,e){return t.w('<tr><th class="tc-ctl-finfo-attr">').f(e.get(["name"],!1),e,"h").w('</th><td class="tc-ctl-finfo-val">').p("tc-ctl-finfo-object",e,e.rebase(e.get(["value"],!1)),{}).w("</td></tr>")}E.__dustBody=!0;function w(t,e){return t.w('<span class="tc-ctl-finfo-errors">').h("i18n",e,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(e.get(["error"],!1),e,"h").w("</span></span>")}w.__dustBody=!0;function b(t,e){return t.w("<h5>").h("i18n",e,{},{$key:"feature"}).w("</h5>").h("eq",e,{else:L,block:A},{key:e.get(["rawFormat"],!1),value:"text/html"})}b.__dustBody=!0;function L(t,e){return t.w("<pre>").f(e.get(["rawContent"],!1),e,"h").w("</pre>")}L.__dustBody=!0;function A(t,e){return t.w("                                ").x(e.get(["expandUrl"],!1),e,{block:x},{})}A.__dustBody=!0;function x(t,e){return t.h("ne",e,{else:P,block:I},{key:e.get(["expandUrl"],!1),value:""})}x.__dustBody=!0;function P(t,e){return t.w('<iframe src="').f(e.get(["rawUrl"],!1),e,"h").w('"></iframe>')}P.__dustBody=!0;function I(t,e){return t.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(e.get(["rawUrl"],!1),e,"h").w('"></iframe><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(e.get(["expandUrl"],!1),e,"h").w("', '_blank')\" title=\"").h("i18n",e,{},{$key:"expand"}).w('"></a></div>')}I.__dustBody=!0;function R(t,e){return t.w('<span class="tc-ctl-finfo-errors">').f(e.get(["hasLimits"],!1),e,"h").w("</span>")}R.__dustBody=!0;function O(t,e){return t.h("gt",e,{block:M},{key:e.get(["featureCount"],!1),value:"1",type:"number"})}O.__dustBody=!0;function M(t,e){return t.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",e,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(e.get(["featureCount"],!1),e,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",e,{},{$key:"next"}).w("</a>")}M.__dustBody=!0;return e};t.template[t.CLASS+"-object"]=function(){dust.register(t.CLASS+"-object",e);function e(t,e){return t.h("isObject",e,{array:r,else:i,block:o},{object:e.getPath(!0,[])})}e.__dustBody=!0;function r(t,e){return t.w('<div class="complexAttr"><input type="checkbox" id="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('"><div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="plus" title=""></label><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="title" title="">').h("size",e,{},{key:e.getPath(!0,[])}).w(" ").h("i18n",e,{},{$key:"featureInfo.complexData.array"}).w('</label><br /><table class="complexAttr"><tbody>').h("iterate",e,{block:n},{on:e.getPath(!0,[])}).w("</tbody></table></div></div>")}r.__dustBody=!0;function n(t,e){return t.w("<tr><td>").p("tc-ctl-finfo-object",e,e.rebase(e.get(["value"],!1)),{}).w("</td></tr>")}n.__dustBody=!0;function i(t,e){return t.f(e.getPath(!0,[]),e,"h",["s"])}i.__dustBody=!0;function o(t,e){return t.w('<table class="complexAttr"><tbody>').h("iterate",e,{block:a},{on:e.getPath(!0,[])}).w("</tbody></table>")}o.__dustBody=!0;function a(t,e){return t.h("isKeyKalue",e,{else:s,block:h},{on:e.getPath(!0,[])})}a.__dustBody=!0;function s(t,e){return t.w('<tr><th style="display:none">').f(e.get(["key"],!1),e,"h").w("</th><td>").h("isObject",e,{array:l,else:c,block:u},{object:e.get(["value"],!1)}).p("tc-ctl-finfo-object",e,e.rebase(e.get(["value"],!1)),{}).w("</div></td></tr>")}s.__dustBody=!0;function l(t,e){return t.w('\x3c!--array--\x3e<div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="title" title="">').f(e.get(["key"],!1),e,"h").w("</label><br />")}l.__dustBody=!0;function c(t,e){return t.w("<div>\x3c!--native--\x3e")}c.__dustBody=!0;function u(t,e){return t.w('\x3c!--object--\x3e<input type="checkbox" id="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('"><div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="plus" title=""></label><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="title" title="">').f(e.get(["key"],!1),e,"h").w("</label><br />")}u.__dustBody=!0;function h(t,e){return t.w('<tr class="keyValue"><th class="key">').f(e.get(["key"],!1),e,"h").w('</th><td class="value tc-ctl-finfo-val">').p("tc-ctl-finfo-object",e,e.rebase(e.get(["value"],!1)),{}).w("</td></tr>")}h.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.control.Click.prototype.register.call(e,t);e._createLayers();t.loaded(function(){const r=t.getControlsByClass("TC.control.Share")[0];r&&e.loadSharedFeature(r.loadParamFeature())});e.displayMode=e.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;e.setDisplayMode(e.displayMode);t.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===e.getDisplayControl()&&e.resultsLayer){if(e.highlightedFeature&&!e.options.persistentHighlights){e.downplayFeature(e.highlightedFeature);e.highlightedFeature=null}!e.querying&&t.feature&&e.filterLayer.removeFeature(t.feature)}}).on(TC.Consts.event.RESULTSPANELCLOSE,function(t){e.highlightedFeature=null}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(t){const r=t.control;r.currentFeature!==e.filterFeature&&(e.highlightedFeature=r.currentFeature);t.control.caller==e&&e._decorateDisplay(r)}).on(TC.Consts.event.DRAWCHART,function(t){setTimeout(function(){e.highlightedFeature=t.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(Object.keys(e._infoHistory).length){const t={};e.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS}).forEach(function(e){const r=t[e.url]||[];t[e.url]=r.concat(e.getDisgregatedLayerNames())});let r=!1;for(let n in e._infoHistory){const i=e._infoHistory[n];if(t.hasOwnProperty(n)){const o=t[n];for(let t in i){const n=i[t];if(o.indexOf(t)<0){n.slice().forEach(t=>e.downplayFeature(t));n.length=0;r=!0}}}else{for(let t in i){i[t].slice().forEach(t=>e.downplayFeature(t));r=!0}delete e._infoHistory[n]}}r&&e.closeResults()}}).on(TC.Consts.event.VIEWCHANGE,function(t){e.closeResults()});return r};t.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};t.responseCallback=function(t){const e=this;e.querying=!1;e.filterFeature&&(e.info={services:t.services});if(t.featureCount){e._addSourceAttributes();e.lastFeatureCount=t.featureCount;e.map.trigger(TC.Consts.event.FEATUREINFO,TC.Util.extend({control:e},t))}else{e.lastFeatureCount=0;e.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:e})}};t.responseError=function(t){const e=this;404===t.status&&e.map.toast(e.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});e.responseCallback({})};t.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};t.setDisplayMode=function(t){var e=this;e.displayMode=t;var r=e.map;switch(t){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:e.resultsPanel||r.addControl("resultsPanel").then(function(t){e.resultsPanel=t;t.caller=e});break;default:e.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;e.popup||r.addControl("popup",{closeButton:!0,draggable:e.options.draggable}).then(function(t){e.popup=t;t.caller=e;r.on(TC.Consts.event.POPUP,function(t){e.onShowPopup(t)});r.on(TC.Consts.event.POPUPHIDE,function(r){r.control===t&&e._resetSize()})})}};t.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};t.getDisplayTarget=function(t){if((t=t||{}).control)switch(!0){case TC.control.Popup&&t.control instanceof TC.control.Popup:return t.control.getContainerElement();case TC.control.ResultsPanel&&t.control instanceof TC.control.ResultsPanel:return t.control.getInfoContainer();default:return null}switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getInfoContainer();default:return this.popup.getContainerElement()}};t.getMenuTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};t.displayResults=function(){var t=this;const e=t.div.cloneNode(!0);e.classList.remove(TC.Consts.classes.HIDDEN);t.filterFeature.data=e.outerHTML;switch(t.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(t.resultsPanel){0===t.map.getControlsByClass(TC.control.ControlContainer).length&&t.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(t){t.isVisible()&&t.close()});t.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(e){e!==t.resultsPanel&&e.currentFeature&&!e.chart&&e.close()});t.resultsPanel.currentFeature=t.filterFeature;t.resultsPanel.open(t.filterFeature.data,t.resultsPanel.getInfoContainer());TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){const e=t.getMenuTarget().querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn");e.length>0&&e[0].remove();t.displayResultsCallback()})}break;default:t.popup&&t.filterFeature.showPopup(t.popup)}};const e=function(t){return Array.from(t.parentElement.children).indexOf(t)},r=function(t,e){var r=t;do{r=r.parentElement}while(r&&r.tagName!==e);return r};t.getFeatureElement=function(t){const n=this;var i;n.getDisplayTarget().querySelectorAll(n._selectors.LIST_ITEM).forEach(function(o){const a=o,s=r(o,"LI"),l=r(s,"LI");n.getFeature(e(l),e(s),e(a))===t&&(i=a)});return i};t.getNextFeatureElement=function(t){const e=this.getDisplayTarget().querySelectorAll("ul."+this.CLASS+"-features > li"),r=e.length;for(var n=0;n<r;n++)if(e[n].matches("."+TC.Consts.classes.CHECKED))return e[(n+t+r)%r];return null};t.getFeaturePath=function(t){const e=this;if(e.info&&e.info.services)for(var r=0,n=e.info.services.length;r<n;r++){const n=e.info.services[r];for(var i=0,o=n.layers.length;i<o;i++){const e=n.layers[i];for(var a=0,s=e.features.length;a<s;a++)if(e.features[a]===t)return{service:n.title||n.mapLayers.reduce(function(t,e){return t||e.title},""),layer:e.path}}}return null};t.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};t.displayResultsCallback=function(){var t=this;const e=t.getDisplayTarget().querySelector("."+t.CLASS);var n,i,o="click";e.addEventListener(o,TC.EventTarget.listenerBySelector(t._selectors.LIST_ITEM,function(e){t.highlightFeature(e.target)}));o=TC.Consts.event.CLICK;n="."+t.CLASS+"-btn-next";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.highlightFeature(t.getNextFeatureElement(1),1);return!1}));n="."+t.CLASS+"-btn-prev";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.highlightFeature(t.getNextFeatureElement(-1),-1);return!1}));n="ul."+t.CLASS+"-layers h4";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(n){const i=r(n.target,"LI");if(i.classList.contains(TC.Consts.classes.CHECKED)){const r=e.querySelector(".tc-ctl-finfo-layers li:not(.tc-checked)");r&&"none"!==getComputedStyle(r).display&&t.downplayFeatures()}else{t.highlightFeature(i.querySelector(t._selectors.LIST_ITEM));t.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&t.popup.fitToView(!0)}}));n="."+t.CLASS+"-del-btn";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.downplayFeatures();t.closeResults()}));if(t.info)if(t.info.defaultFeature&&t.getFeatureElement(t.info.defaultFeature)){t.getFeatureElement(t.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);t.highlightFeature(t.info.defaultFeature)}else e.querySelector(t._selectors.LIST_ITEM)&&t.highlightFeature(e.querySelector(t._selectors.LIST_ITEM));e.querySelectorAll("table:not(.complexAttr)").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){const r=this.parentElement;if(!r.classList.contains(TC.Consts.classes.DISABLED)){if(r.classList.contains(TC.Consts.classes.CHECKED)){if(t.resultsLayer.features[0]&&window.getSelection()&&0===window.getSelection().toString().trim().length){t.map.on(TC.Consts.event.ZOOM,function e(){t._zooming=!1;t.map.off(TC.Consts.event.ZOOM,e)});t._zooming=!0;t.map.zoomToFeatures([t.resultsLayer.features[0]],{animate:!0})}}else t.highlightFeature(r);e.stopPropagation()}})});e.querySelectorAll("table a, table label, table input").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation()})});if(TC.browserFeatures.touch()&&t.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL){const r=e.querySelector("."+t.CLASS+"-btn-prev");if(!r||"none"!==r.style.display){t.resultsPanel&&TC.Util.swipe(t.resultsPanel.div,"disable");((i=t).info&&i.info.services?i.info.services.reduce(function(t,e){return t+e.layers.reduce(function(t,e){return t+1},0)},0):0)>1&&TC.Util.swipe(e,{left:function(){t.highlightFeature(t.getNextFeatureElement(1),1)},right:function(){t.highlightFeature(t.getNextFeatureElement(-1),-1)}})}}};t.onShowPopup=function(t){const e=this;if(t.control===e.popup){e.displayResultsCallback();e._fitSize()}};t.loadSharedFeature=function(t){};t.insertLinks=function(){const t=this.getLocaleString("open"),e=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(r){const n=r.textContent;TC.Util.isURL(n)&&(r.innerHTML='<a href="'+n+'" target="_blank" title="'+e+'">'+t+"</a>")})};t.highlightFeature=function(t,n){const i=this;var o;if(!i._zooming){var a;if(t instanceof TC.Feature){o=t;a=i.getFeatureElement(o)}else{a=t;for(;a&&"LI"!==a.tagName;)a=a.parentElement}const c=r(a,"LI"),u=r(c,"LI"),h=e(u),d=e(c),p=e(a);o=o||i.getFeature(h,d,p);i.downplayFeatures({exception:o});const f=i.info.services[h];i._infoHistory.hasOwnProperty(f.url)||(i._infoHistory[f.url]={});const g=i._infoHistory[f.url],y=f.layers[d],m=g[y.name]||[];g[y.name]=m.concat(o);a.classList.add(TC.Consts.classes.CHECKED);c.classList.add(TC.Consts.classes.CHECKED);u.classList.add(TC.Consts.classes.CHECKED);if(n>0){a.classList.add(TC.Consts.classes.FROMLEFT);c.classList.add(TC.Consts.classes.FROMLEFT);u.classList.add(TC.Consts.classes.FROMLEFT)}else if(n<0){a.classList.add(TC.Consts.classes.FROMRIGHT);c.classList.add(TC.Consts.classes.FROMRIGHT);u.classList.add(TC.Consts.classes.FROMRIGHT)}a.querySelector("table")&&a.querySelector("table").setAttribute("title",i.getLocaleString("clickToCenter"));i.highlightedFeature=o;i.getDisplayTarget().querySelector("."+i.CLASS+"-counter-current")&&(i.getDisplayTarget().querySelector("."+i.CLASS+"-counter-current").innerHTML=i.getFeatureIndex(h,d,p)+1);var s=i.resultsLayer.features.slice(),l=s.filter(function(t){return o&&o.id===t.id});if(l.length>0){i.highlightedFeature=l[0];return}i.options.persistentHighlights||s.forEach(t=>{t!==i.filterFeature&&i.downplayFeature(t)});if(o&&o.geometry){o.showsPopup=i.options.persistentHighlights;i.resultsLayer.addFeature(o)}else a.classList.add(TC.Consts.classes.DISABLED)}};t.downplayFeature=function(t){const e=this;e.resultsLayer.removeFeature(t);for(url in e._infoHistory){const r=e._infoHistory[url];for(name in r){const e=r[name],n=e.indexOf(t);if(n>=0){e.splice(n,1);e.length||delete r[name]}}}};t.downplayFeatures=function(t){const e=this;t=t||{};if(e.highlightedFeature&&e.highlightedFeature!==t.exception){e.downplayFeature(e.highlightedFeature);e.highlightedFeature=null}const n=t.exception?e.getFeatureElement(t.exception):void 0;var i,o;if(n){i=r(n,"LI");o=r(i,"LI")}const a=e.getDisplayTarget();Array.from(a.querySelectorAll("ul."+e.CLASS+"-services li")).filter(function(t){return t!==n&&t!==i&&t!==o}).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED,TC.Consts.classes.DISABLED,TC.Consts.classes.FROMLEFT,TC.Consts.classes.FROMRIGHT)});a.querySelectorAll("."+e.CLASS+"-features table:not(.complexAttr)").forEach(function(t){t.setAttribute("title",e.getLocaleString("clickToShowOnMap"))})};t._fitSize=function(){const t=this.getDisplayTarget();var e=0;t.querySelectorAll("input").forEach(function(t){t.checked=!0});t.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(t){e=Math.max(e,t.offsetLeft+t.offsetWidth)});e&&(t.style.width=e+50+"px");t.querySelectorAll("input").forEach(function(t){t.checked=!1})};t._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};t.getFeature=function(t,e,r){var n;const i=this.info;i&&i.services&&(n=i.services[t])&&(n=n.layers[e])&&(n=n.features[r]);return n};t.getFeatureIndex=function(t,e,r){var n=-1;const i=this.info;if(i)for(var o=0;o<=t;o++)for(var a=i.services[o],s=o===t?e:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===e?r:c.features.length-1,h=0;h<=u;h++)n+=1;return n};t.beforeRequest=function(t){var e=this;e.querying=!0;e.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:t.xy,control:e});e.closeResults();if(e.map&&e.resultsLayer){e.lastFeatureCount=null;e.options.persistentHighlights||e.resultsLayer.features.slice().forEach(t=>e.downplayFeature(t));e.info=null}};t.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};t.deactivate=function(t){var e=this;e.popup&&e.popup.isVisible()&&e.popup.hide();if(!e.options.persistentHighlights){e.resultsLayer.features.slice().forEach(t=>e.downplayFeature(t));e.info=null;e._infoHistory={}}e.filterLayer&&e.filterLayer.clearFeatures();e.filterFeature=null;e.wrap&&e.wrap.deactivate();TC.Control.prototype.deactivate.call(e,t)};t.exportState=function(){const t=this;return t.exportsState&&t.resultsLayer?{id:t.id,layer:t.resultsLayer.exportState()}:null};t.importState=function(t){const e=this;e._layersPromise.then(function(){e.resultsLayer.importState(t.layer)})};t._createLayers=function(){const t=this;var e,r;e=t.options.resultsLayer?t.options.resultsLayer:{id:t.getUID(),title:t.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,owner:t,stealth:!0};if(t.options.filterLayer)r=t.options.filterLayer;else{const e={};t.geometryType===TC.Consts.geom.POLYLINE&&(e.line=t.style);t.geometryType===TC.Consts.geom.POLYGON&&(e.polygon=t.style);r={id:t.getUID(),title:t.CLASS+": Filter layer",owner:t,stealth:!0,type:TC.Consts.layerType.VECTOR,styles:e}}const n=t.map;t._layersPromise=new Promise(function(i,o){n.loaded(function(){Promise.all([n.addLayer(e),n.addLayer(r)]).then(function(e){t.resultsLayer=e[0];t.filterLayer=e[1];i()})})});return t._layersPromise};t._decorateDisplay=function(t){const e=this,r=e.getMenuTarget({control:t});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!r.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var n=e.getLocaleString("feature");if(t===e.getDisplayControl())if(TC.feature.Point&&e.filterFeature instanceof TC.feature.Point){const t=e.filterFeature.geometry;n=e.getLocaleString("featuresAt",{crs:e.map.crs,x:TC.Util.formatCoord(t[0],e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),y:TC.Util.formatCoord(t[1],e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)})}else n=e.getLocaleString("spatialQueryResults");else t.currentFeature&&(n=t.currentFeature.id);(e.lastFeatureCount||t.currentFeature&&!0===t.currentFeature.showsPopup)&&new TC.control.Print({target:r,printableElement:e.getDisplayTarget({control:t}),title:n})}})};t._addSourceAttributes=function(){const t=this,e="h3_"+t.getLocaleString("service"),r="h4_"+t.getLocaleString("layer");t.info&&t.info.services&&t.info.services.forEach(function(n){n.layers.forEach(function(n){n.features.forEach(function(n){if(n instanceof TC.Feature){const i=t.getFeaturePath(n);if(i){const o={};o[e]=i.service;i.layer&&(o[r]=i.layer.join(t.TITLE_SEPARATOR));const a=TC.Util.extend(o,n.getData());n.clearData();n.setData(a)}}})})})}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var t=TC.control.Scale.prototype;t.CLASS="tc-ctl-scl";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",e,{},{key:r,method:"round"}).w('</span> <input type="button" value="').f(e.get(["screenSize"],!1),e,"h").w("''\" title=\"").h("i18n",e,{},{$key:"estimatedMapSize"}).w('" /></div>')}e.__dustBody=!0;function r(t,e){return t.f(e.get(["scale"],!1),e,"h")}r.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({scale:e.getScale(),screenSize:TC.Cfg.screenSize},function(){const r=e.div.querySelector("span");r.textContent="1:"+e.format(r.textContent.substr(2));e.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){e.setScreenSize()});TC.Util.isFunction(t)&&t()}))};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);var n=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);n&&(TC.Cfg.screenSize=n);e.render(function(){t.on(TC.Consts.event.ZOOM,function(){delete e.metersPerDegree;e.update()})});return r};t.update=function(){this.render()};t.setScreenSize=function(){var t=this;TC.prompt(t.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(e){if(e){TC.Cfg.screenSize=parseFloat(e);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);t.update()}})};t.getScale=function(t){var e=0,r=!t&&this.map?this.map.wrap.getResolution():t;if(r){e=r*this.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(e*=window.devicePixelRatio)}if(this.map&&this.map.wrap.isGeo()){if(!this.metersPerDegree){var n=this.map.getExtent();n&&(this.metersPerDegree=TC.Util.getMetersPerDegree(n))}this.metersPerDegree&&(e*=this.metersPerDegree)}return e};t.getDpi=function(t){this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/t;return this.dpi};t.format=function(t){for(var e=new Number(t).toFixed(0),r=[];e.length>3;){var n=e.length-3;r.unshift(e.substr(n));e=e.substr(0,n)}e&&r.unshift(e);return r.join(".")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){TC.Control.apply(this,arguments);this.serviceWorkerEnabled=!1};TC.inherit(TC.control.SWCacheClient,TC.Control);var t=TC.control.SWCacheClient.prototype;t.CLASS="tc-ctl-swcc";t.SW_URL="tc-cb-service-worker.js";t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e._swPromise=new Promise(function(t,r){navigator.serviceWorker?navigator.serviceWorker.register(e.SW_URL,{scope:"./"}).then(function(r){e.serviceWorkerEnabled=!0;r.installing?t(r.installing):r.waiting?t(r.waiting):r.active&&t(r.active);console.log(r.scope,"register")},function(t){e.serviceWorkerEnabled=!1;r(new Error(t));console.error("Could not register service worker: "+t)}):r(new Error("Browser does not support service workers"))});e._swPromise.catch(()=>{"https:"!==location.protocol?t.toast(e.getLocaleString("httpsRequired.warning",{url:location.href.replace(location.protocol,"")}),{type:TC.Consts.msgType.WARNING}):t.toast(e.getLocaleString("browserNotCompatible.warning"),{type:TC.Consts.msgType.WARNING})});return r};t.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var e=function(t,e,r,n,i){navigator.serviceWorker.addEventListener("message",function o(a){if(a.data.name===r){a.data.action===n&&a.data.event===i?t(r):"error"===a.data.event&&e(Error(`Error message from service worker [${a.data.url} - ${a.data.action} - ${a.data.name}]`));"progress"!==a.data.event&&navigator.serviceWorker.removeEventListener("message",o)}})};t.createCache=function(t,r){var n=this;return new Promise(function(i,o){n.getServiceWorker().then(function(n){var a=r||{};e(i,o,t,"create","cached");n.postMessage({action:"create",name:t,list:a.urlList||[],silent:a.silent})},function(){i(!1)})})};t.deleteCache=function(t,r){var n=this;return new Promise(function(i,o){n.getServiceWorker().then(function(n){var a=r||{};e(i,o,t,"delete","deleted");n.postMessage({action:"delete",name:t,silent:a.silent})},function(){i(!1)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Measure=function(){var t=this;TC.Control.apply(t,arguments);t.drawControls=[];t.persistentDrawControls=!1;t.NOMEASURE="-";t.exportsState=!0;this.renderPromise().then(function(){t.measureMode=t.options.mode;t.history=[];t.historyIndex=0;t.reset=!0;t.wrap=new TC.wrap.control.Measure(t);t._len=t.div.querySelector(".tc-ctl-meas-val-len");t._area=t.div.querySelector(".tc-ctl-meas-val-area");t._peri=t.div.querySelector(".tc-ctl-meas-val-peri");t.setMode(t.options.mode)})};TC.control.Measure.units={m:{peso:0,abbr:"m&sup2;"},dam:{peso:1,abbr:"dam&sup2;"},hm:{peso:2,abbr:"hm&sup2;"},ha:{peso:2,abbr:"ha"},km:{peso:3,abbr:"km&sup2;"}};TC.inherit(TC.control.Measure,TC.Control);!function(){var t=TC.control.Measure.prototype;t.CLASS="tc-ctl-meas";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",e,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",e,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",e,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}e.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(TC.Control.prototype.render.call(e,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){e.options.mode&&e.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(`.${TC.control.Measure.prototype.CLASS}-select span`).forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var r=this;r&&"LABEL"!==r.tagName;)r=r.parentElement;var n=r.querySelector("input[type=radio][name=mode]"),i=n.value;n.checked=!0;e.setMode(i,!0)})});TC.Util.isFunction(t)&&t()})}))};t.register=function(t){const e=this;return new Promise(function(r,n){TC.Control.prototype.register.call(e,t).then(function(){e.map.on(TC.Consts.event.VIEWCHANGE,function(){e.map.view===TC.Consts.view.PRINTING&&e.trigger(TC.Consts.event.DRAWEND)});const i=e.getUID(),o=e.getUID(),a=e.getUID();e.units=e.options.units?e.options.units:"km";e.layerPromise=t.addLayer({id:i,title:e.getLocaleString("measure"),owner:e,stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:t.options.styles.point,line:t.options.styles.line,polygon:t.options.styles.polygon}});e.units=e.options.units?e.options.units:"km";Promise.all([e.layerPromise,e.renderPromise()]).then(function(i){const s=i[0];e.layer=s;e.layer.map.putLayerOnTop(e.layer);e._lineDrawControlPromise=t.addControl("draw",{id:o,div:e.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:e.persistentDrawControls,styleTools:e.persistentDrawControls,layer:e.layer});e._polygonDrawControlPromise=t.addControl("draw",{id:a,div:e.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:e.persistentDrawControls,styleTools:e.persistentDrawControls,layer:e.layer});Promise.all([e._lineDrawControlPromise,e._polygonDrawControlPromise]).then(function(t){e.lineDrawControl=t[0];e.polygonDrawControl=t[1];t.forEach(function(t){t.containerControl=e;e.drawControls.push(t);t.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e.showMeasures(t)}).on(TC.Consts.event.DRAWCANCEL,function(t){setTimeout(function(){e.cancel()},100)});t.exportsState=!1});r(e);e.setMode(e.options.mode)}).catch(n)}).catch(n)})})};t.displayMode=function(t){const e=this,r=[];e.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(t){r.push(t)});switch(t){case TC.Consts.geom.POLYLINE:e._activeMode=r.filter(function(t){return t.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:e._activeMode=r.filter(function(t){return t.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:e._activeMode=null}const n=r.filter(function(t){return t!==e._activeMode});if(t){e.div.querySelector("input[type=radio][name=mode][value="+t+"]").checked=!0}else e.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(t){t.checked=!1});if(e._activeMode){e._activeMode.classList.remove(TC.Consts.classes.HIDDEN);e._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}n.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});return e};t.setMode=function(t){const e=this;e.mode=t;e.displayMode(t);var r;switch(t){case TC.Consts.geom.POLYLINE:e.lineDrawControl.activate();r=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:e.polygonDrawControl.activate();r=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:e.drawControls.forEach(function(t){t.isActive&&t.cancel()});r=TC.Consts.event.CONTROLDEACTIVATE;break;default:r=TC.Consts.event.CONTROLACTIVATE}e.resetValues();r&&e.map&&e.map.trigger(r,{control:e});return e};t.cancel=function(){this.setMode(null,!1);return this};t.showMeasures=function(t){const e=this;var r,n=(t=t||{}).units;const i=e.map.options.locale||TC.Cfg.locale;if(t.area){var o=t.area;let r=[];(e.units instanceof Array?e.units:e.units.split(",")).forEach(function(t){const e=TC.control.Measure.units[t.trim()].peso-TC.control.Measure.units.m.peso;if(o>Math.pow(100,e-1)){let n="m"===t?0:3;r.push(TC.Util.formatNumber((o/Math.pow(100,e)).toFixed(n),i)+" "+TC.control.Measure.units[t].abbr)}});e._area.innerHTML=r.join("/")}if(t.perimeter){var a=t.perimeter;if(a>1e3){a/=1e3;n="km"}r="m"===n?0:3;e._peri.innerHTML=TC.Util.formatNumber(a.toFixed(r),i)+" "+n}if(t.length){var s=t.length;if(s>1e3){s/=1e3;n="km"}r="m"===n?0:3;e._len.innerHTML=TC.Util.formatNumber(s.toFixed(r),i)+" "+n}return e};t.resetValues=function(){const t=this;if(t._len){t._len.textContent=t.NOMEASURE;t._area.textContent=t.NOMEASURE;t._peri.textContent=t.NOMEASURE}return t};t.getDrawLines=function(){};t.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null};t.importState=function(t){this.layerPromise.then(function(e){e.importState(t.layer)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const t=this;TC.Control.apply(t,arguments);t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code",CHANGE:t.CLASS+"-change",NO_CHANGE:t.CLASS+"-no-change"};t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+t._cssClasses.LOAD_CRS_BUTTON+")",function(e){const r=e.target.dataset.crsCode;r&&t.setProjection({crs:r,allowFallbackLayer:!0})}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+t._cssClasses.LOAD_CRS_BUTTON,function(e){t.loadFallbackProjections()}))};TC.inherit(TC.control.ProjectionSelector,TC.Control);const t=TC.control.ProjectionSelector.prototype;t.CLASS="tc-ctl-projs";t.render=function(t){const e=this,r=TC.Control.prototype.render.call(e,t);e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t});return r};t.getAvailableCRS=function(t){return this.map.getCompatibleCRS(TC.Util.extend(t||{},{includeFallbacks:!0}))};t.showProjectionChangeDialog=function(t){const e=this,r=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG),n=r.querySelector(".tc-modal-body");n.classList.add(TC.Consts.classes.LOADING);const i=n.querySelector("ul."+e._cssClasses.CRS_LIST);i.innerHTML="";const o=e.map.baseLayer.firstOption||e.map.baseLayer,a=o.isRaster()?o.getFallbackLayer():null,s=function(){var a=[],s=[];t=t||{};if(o.isRaster()){s=o.getCompatibleCRS();a=e.getAvailableCRS(TC.Util.extend(t,{}))}else{s=e.map.baseLayers.filter(t=>t.isRaster()).map(t=>t.getCompatibleCRS({normalized:!0,includeFallback:!0})).reduce((t,e,r,n)=>t.concat(e.filter(e=>t.indexOf(e)<0)));const r=(t.layer?e.map.workLayers.concat(t.layer):e.map.workLayers).filter(function(t){return t.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:!0})});a=s.filter(t=>r.every(e=>e.indexOf(t)>-1))}e.map.loadProjections({crsList:a,orderBy:"name"}).then(function(t){var o=!1,a=r.querySelector("."+e._cssClasses.CURRENT_CRS_NAME),l=r.querySelector("."+e._cssClasses.CURRENT_CRS_CODE);t.forEach(function(t){if(a&&l&&TC.Util.CRSCodesEqual(e.map.crs,t.code)){a.textContent=t.name;l.textContent=t.code}else{const e=document.createElement("button");e.textContent=t.name+" ("+t.code+")";e.dataset.crsCode=t.code;const r=document.createElement("li");r.appendChild(e);if(0===s.filter(function(e){return TC.Util.CRSCodesEqual(e,t.code)}).length){o=!0;r.classList.add(TC.Consts.classes.HIDDEN);e.classList.add(TC.Consts.classes.WARNING)}i.appendChild(r)}});if(o){const t=document.createElement("li"),r=document.createElement("button");r.classList.add(e._cssClasses.LOAD_CRS_BUTTON);r.innerHTML=e.getLocaleString("showOnTheFlyProjections");t.appendChild(r);i.appendChild(t)}if(0===i.querySelectorAll("li").length){const t=document.createElement("li");t.innerHTML=e.getLocaleString("thereAreNoCompatibleCRS");i.appendChild(t)}const c=i.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");r.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(t){t.style.display=c.length>1?"":"none"});r.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(t){t.style.display=c.length>1?"none":""});r.querySelector("ul."+e._cssClasses.CRS_LIST).style.display=c.length>0||o?"":"none";n.classList.remove(TC.Consts.classes.LOADING)})};a?a.getCapabilitiesPromise().then(s):s();TC.Util.showModal(r,t)};t.setProjection=function(t){const e=this;t=t||{};TC.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t)}})};t.loadFallbackProjections=function(){const t=this,e=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li");e.forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(TC.Consts.classes.HIDDEN)});t._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN)});t._dialogDiv.querySelectorAll("."+t._cssClasses.CHANGE).forEach(function(t){t.style.display=e.length>1?"":"none"});t._dialogDiv.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach(function(t){t.style.display=e.length>1?"none":""})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Container=function(){TC.Control.apply(this,arguments);this.controlOptions=this.options.controls||[];this.ctlCount=this.controlOptions instanceof Array?this.controlOptions.length:Object.keys(this.controlOptions).length;this.defaultSelection=this.options.defaultSelection};TC.inherit(TC.control.Container,TC.Control);!function(){var t=TC.control.Container.prototype;t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.uids=new Array(e.ctlCount);e.uids.forEach(function(t,r,n){n[r]=e.getUID()});return new Promise(function(t,n){Promise.all([r,e.renderPromise()]).then(function(){e.onRenderPromise();t(e)})})};t.onRenderPromise=function(){};t.render=function(t){};t.getControl=function(t){var e=this._ctlPromises[t];return e||Promise.reject(Error("No control found"))}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.TabContainer=function(){TC.control.Container.apply(this,arguments);var t=this._classSelector="."+this.CLASS;this._selectors={TAB:t+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:t+"-elm"}};TC.inherit(TC.control.TabContainer,TC.control.Container);!function(){var t=TC.control.TabContainer.prototype;t.CLASS="tc-ctl-tctr";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").f(e.get(["title"],!1),e,"h").w('</h2><div class="tc-ctl-tctr-select"><form>').s(e.get(["controls"],!1),e,{block:r},{}).w("</form></div>").s(e.get(["controls"],!1),e,{block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-').f(e.get(["$idx"],!1),e,"h").w('" style="width:calc(100%/').f(e.get(["$len"],!1),e,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(e.get(["$idx"],!1),e,"h").w('" /><span>').f(e.get(["title"],!1),e,"h").w("</span></label>")}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-').f(e.get(["$idx"],!1),e,"h").w(' tc-hidden"></div>')}n.__dustBody=!0;return e};t.onRenderPromise=function(){const t=this;t.title=t.title||t.getLocaleString(t.options.title||"moreControls");t.div.querySelector("h2").innerHTML=t.title;for(var e=new Array(t.ctlCount),r=0,n=t.controlOptions.length;r<n;r++){var i=t.controlOptions[r],o="",a={};if(void 0!==i.name&&void 0!==i.options){console.log("Gestionamos config de tabContainer antiguo");o=i.name;a=i.options}else a=i[o=Object.keys(i).filter(t=>"title"!==t)[0]];e[r]=t.map.addControl(o,TC.Util.extend({id:t.uids[r],div:t.div.querySelector("."+t.CLASS+"-elm-"+r)},a))}var s=function(e,r){e.renderPromise().then(function(){const n=t.getLocaleString(t.controlOptions[r].title)||e.div.querySelector("h2").innerHTML;var i=e.div;do{i=i.parentElement}while(i&&!i.matches(t._classSelector));i.querySelector(t._selectors.TAB+"-"+r+" span").innerHTML=n})};Promise.all(e).then(function(e){for(var r=0,n=e.length;r<n;r++){var i=e[r];i.containerControl=t;s(i,r)}})};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({title:e.title,controls:e.controlOptions},function(){var t=function(t){for(var r=this;r&&!r.matches(e._selectors.TAB);)r=r.parentElement;var n,i=[];const o=r.querySelector(e._selectors.RADIOBUTTON),a=o.value,s=e.div.querySelectorAll(e._selectors.ELEMENT);if(e._oldValue===a&&e.options.deselectable){setTimeout(function(){o.checked=!1},0);e._oldValue=null;n=null;i=s}else{s.forEach(function(t){t.matches(e._selectors.ELEMENT+"-"+a)?n=t:i.push(t)});e._oldValue=a}if(n&&n.classList.contains(TC.Consts.classes.COLLAPSED)){n.classList.remove(TC.Consts.classes.COLLAPSED);new MutationObserver(function(t){t.forEach(function(t){t.target.classList.contains(TC.Consts.classes.COLLAPSED)&&t.target.classList.remove(TC.Consts.classes.COLLAPSED)})}).observe(n,{attributes:!0})}n&&n.classList.remove(TC.Consts.classes.HIDDEN);i.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});o.checked=!0};e.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,t)});"number"==typeof e.defaultSelection&&t.call(e.div.querySelectorAll(e._selectors.RADIOBUTTON)[e.defaultSelection])}))}}();!function(){let t=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const e=function(t){for(var e=[],r=[],n=Math.pow(2,t.length),i=0;i<n;i++){r=[];for(var o=0;o<t.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(t[o])&&r.push(t[o]);r.length>0&&-1==e.indexOf(r.join(" "))&&e.push(r.join(" "))}return e}(t.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var r=0;r<e.length;r++){var n=t.indexOf(e[r]);n>-1&&t.splice(n,1)}}(e,t);t=t.concat(e);const r=function(t){return 1e3*ol.format.xsd.readDateTime(t)},n="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",i={rte:R,trk:O,wpt:M},o=ol.xml.makeStructureNS(t,{rte:ol.xml.makeArrayPusher(R),trk:ol.xml.makeArrayPusher(O),wpt:ol.xml.makeArrayPusher(M)}),a=ol.xml.makeStructureNS(t,{text:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkText"),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkType")}),s=ol.xml.makeStructureNS(t,{rte:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=e.getProperties(),o={node:t};o.properties=i;const a=e.getGeometry();if(a.getType()==ol.geom.GeometryType.LINE_STRING){const t=ol.format.Feature.transformWithOptions(a,!0,n);o.geometryLayout=t.getLayout();i.rtept=t.getCoordinates()}const s=r[r.length-1].node,l=y[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(o,m,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),trk:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=e.getProperties(),o={node:t};o.properties=i;const a=e.getGeometry();if(a.getType()==ol.geom.GeometryType.MULTI_LINE_STRING){const t=ol.format.Feature.transformWithOptions(a,!0,n);i.trkseg=t.getLineStrings()}const s=r[r.length-1].node,l=v[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(o,T,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),wpt:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=r[r.length-1];i.properties=e.getProperties();const o=e.getGeometry();if(o.getType()==ol.geom.GeometryType.POINT){const e=ol.format.Feature.transformWithOptions(o,!0,n);i.geometryLayout=e.getLayout();N(t,e.getCoordinates(),r)}})});const l=ol.xml.makeStructureNS(t,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:I,type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),rtept:function(t,e){const r=ol.xml.pushParseAndPop({},c,t,e);if(r){const n=e[e.length-1],i=n.flatCoordinates,o=n.layoutOptions;A(i,o,t,r)}}}),c=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r)}),u=ol.xml.makeStructureNS(t,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),extensions:I,trkseg:function(t,e){const r=e[e.length-1];ol.xml.parseNode(h,t,e);const n=r.flatCoordinates;r.ends.push(n.length)}}),h=ol.xml.makeStructureNS(t,{trkpt:function(t,e){const r=ol.xml.pushParseAndPop({},d,t,e);if(r){const n=e[e.length-1],i=n.flatCoordinates,o=n.layoutOptions;A(i,o,t,r)}}}),d=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r)}),p=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r),magvar:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),geoidheight:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,sym:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),fix:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),sat:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),hdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),vdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),pdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),ageofdgpsdata:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),dgpsid:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:I}),f=["text","type"],g=ol.xml.makeStructureNS(t,{text:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode)}),y=ol.xml.makeStructureNS(t,["name","cmt","desc","src","link","number","type","rtept"]),m=ol.xml.makeStructureNS(t,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(k),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),rtept:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(N))}),C=ol.xml.makeStructureNS(t,["ele","time"]),v=ol.xml.makeStructureNS(t,["name","cmt","desc","src","link","number","type","trkseg"]),T=ol.xml.makeStructureNS(t,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(k),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),trkseg:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(function(t,e,r){const n={node:t};n.geometryLayout=e.getLayout();n.properties={};ol.xml.pushSerializeAndPop(n,S,_,e.getCoordinates(),r)}))}),_=ol.xml.makeSimpleNodeFactory("trkpt"),S=ol.xml.makeStructureNS(t,{trkpt:ol.xml.makeChildAppender(N)}),E=ol.xml.makeStructureNS(t,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),w=ol.xml.makeStructureNS(t,{ele:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),time:ol.xml.makeChildAppender(function(t,e){var r=new Date(e),n=r.getUTCFullYear()+"-"+ol.string.padNumber(r.getUTCMonth()+1,2)+"-"+ol.string.padNumber(r.getUTCDate(),2)+"T"+ol.string.padNumber(r.getUTCHours(),2)+":"+ol.string.padNumber(r.getUTCMinutes(),2)+":"+ol.string.padNumber(r.getUTCSeconds(),2)+"Z";t.appendChild(ol.xml.DOCUMENT.createTextNode(n))}),magvar:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),geoidheight:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(k),sym:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),fix:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),sat:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),hdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),vdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),pdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),ageofdgpsdata:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),dgpsid:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode)}),b={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function L(t,e,r){const n=t.getGeometry();if(n){const t=b[n.getType()];if(t){const r=e[e.length-1].node;return ol.xml.createElementNS(r.namespaceURI,t)}}}function A(t,e,r,n){t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat")));if("ele"in n){t.push(n.ele);delete n.ele;e.hasZ=!0}else t.push(0);if("time"in n){t.push(n.time);delete n.time;e.hasM=!0}else t.push(0);return t}function x(t,e,r){let n=ol.geom.GeometryLayout.XY,i=2;if(t.hasZ&&t.hasM){n=ol.geom.GeometryLayout.XYZM;i=4}else if(t.hasZ){n=ol.geom.GeometryLayout.XYZ;i=3}else if(t.hasM){n=ol.geom.GeometryLayout.XYM;i=3}if(4!==i){for(let r=0,n=e.length/4;r<n;r++){e[r*i]=e[4*r];e[r*i+1]=e[4*r+1];t.hasZ&&(e[r*i+2]=e[4*r+2]);t.hasM&&(e[r*i+2]=e[4*r+3])}e.length=e.length/4*i;if(r)for(let t=0,e=r.length;t<e;t++)r[t]=r[t]/4*i}return n}function P(t,e){const r=e[e.length-1],n=t.getAttribute("href");null!==n&&(r.link=n);ol.xml.parseNode(a,t,e)}function I(t,e){e[e.length-1].extensionsNode_=t}function R(t,e){const r=e[0],n=ol.xml.pushParseAndPop({flatCoordinates:[],layoutOptions:{}},l,t,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.layoutOptions;delete n.layoutOptions;const a=x(o,i),s=new ol.geom.LineString(i,a);ol.format.Feature.transformWithOptions(s,!1,r);const c=new ol.Feature(s);c.setProperties(n,!0);return c}function O(t,e){const r=e[0],n=ol.xml.pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},u,t,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.ends;delete n.ends;const a=n.layoutOptions;delete n.layoutOptions;const s=x(a,i,o),l=new ol.geom.MultiLineString(i,s,o);ol.format.Feature.transformWithOptions(l,!1,r);const c=new ol.Feature(l);c.setProperties(n,!0);return c}function M(t,e){const r=e[0],n=ol.xml.pushParseAndPop({},p,t,e);if(!n)return;const i={},o=A([],i,t,n),a=x(i,o),s=new ol.geom.Point(o,a);ol.format.Feature.transformWithOptions(s,!1,r);const l=new ol.Feature(s);l.setProperties(n,!0);return l}function k(t,e,r){t.setAttribute("href",e);const n=r[r.length-1].properties,i=[n.linkText,n.linkType];ol.xml.pushSerializeAndPop({node:t},g,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,i,r,f)}function N(t,e,r){const n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;t.setAttributeNS(null,"lat",String(e[1]));t.setAttributeNS(null,"lon",String(e[0]));switch(n.geometryLayout){case ol.geom.GeometryLayout.XYZM:0!==e[3]&&(o.time=e[3]);case ol.geom.GeometryLayout.XYZ:0!==e[2]&&(o.ele=e[2]);break;case ol.geom.GeometryLayout.XYM:0!==e[2]&&(o.time=e[2])}const a="rtept"==t.nodeName?C[i]:E[i],s=ol.xml.makeSequence(o,a);ol.xml.pushSerializeAndPop({node:t,properties:o},w,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,r,a)}ol.format.GPXCustom=class extends ol.format.GPX{constructor(t){super(t)}readFeatureFromNode(e,r){if(!ol.array.includes(t,e.namespaceURI))return null;const n=i[e.localName];if(!n)return null;const o=n(e,[this.getReadOptions(e,r)]);if(!o)return null;this.handleReadExtensions_([o]);return o}readFeaturesFromNode(e,r){if(!ol.array.includes(t,e.namespaceURI))return[];if("gpx"==e.localName){const t=ol.xml.pushParseAndPop([],o,e,[this.getReadOptions(e,r)]);if(t){this.handleReadExtensions_(t);return t}return[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const r=ol.xml.createElementNS("http://www.topografix.com/GPX/1/1","gpx");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",ol.xml.XML_SCHEMA_INSTANCE_URI);r.setAttributeNS(ol.xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",n);r.setAttribute("version","1.1");r.setAttribute("creator","OpenLayers");ol.xml.pushSerializeAndPop({node:r},s,L,t,[e]);return r}}}();!function(){const t=["http://www.google.com/kml/ext/2.2"];let e=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];const r=function(t){for(var e=[],r=[],n=Math.pow(2,t.length),i=0;i<n;i++){r=[];for(var o=0;o<t.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(t[o])&&r.push(t[o]);r.length>0&&-1==e.indexOf(r.join(" "))&&e.push(r.join(" "))}return e}(e.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var r=0;r<e.length;r++){var n=t.indexOf(e[r]);n>-1&&t.splice(n,1)}}(r,e);e=e.concat(r);const n={fraction:ol.style.IconAnchorUnits.FRACTION,pixels:ol.style.IconAnchorUnits.PIXELS,insetPixels:ol.style.IconAnchorUnits.PIXELS},i=ol.xml.makeStructureNS(e,{ExtendedData:function(t,e){ol.xml.parseNode(tt,t,e)},Region:function(t,e){ol.xml.parseNode(o,t,e)},MultiGeometry:ol.xml.makeObjectPropertySetter(Y,"geometry"),LineString:ol.xml.makeObjectPropertySetter(W,"geometry"),LinearRing:ol.xml.makeObjectPropertySetter(H,"geometry"),Point:ol.xml.makeObjectPropertySetter(z,"geometry"),Polygon:ol.xml.makeObjectPropertySetter($,"geometry"),Style:ol.xml.makeObjectPropertySetter(Z),StyleMap:function(t,e){const r=function(t,e){return ol.xml.pushParseAndPop(void 0,x,t,e)}(t,e);if(!r)return;const n=e[e.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:assert(!1,38)},address:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),description:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),open:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),styleUrl:ol.xml.makeObjectPropertySetter(L),visibility:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean)},ol.xml.makeStructureNS(t,{MultiTrack:ol.xml.makeObjectPropertySetter(function(t,e){const r=ol.xml.pushParseAndPop([],D,t,e);if(!r)return;return new ol.geom.MultiLineString(r)},"geometry"),Track:ol.xml.makeObjectPropertySetter(B,"geometry")})),o=(ol.xml.makeStructureNS(e,{href:ol.xml.makeObjectPropertySetter(L)}),ol.xml.makeStructureNS(e,{LatLonAltBox:function(t,e){const r=ol.xml.pushParseAndPop({},nt,t,e);if(!r)return;const n=e[e.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i;n.altitudeMode=r.altitudeMode;n.minAltitude=parseFloat(r.minAltitude);n.maxAltitude=parseFloat(r.maxAltitude)},Lod:function(t,e){const r=ol.xml.pushParseAndPop({},it,t,e);if(!r)return;const n=e[e.length-1];n.minLodPixels=parseFloat(r.minLodPixels);n.maxLodPixels=parseFloat(r.maxLodPixels);n.minFadeExtent=parseFloat(r.minFadeExtent);n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}));let a,s,l,c,u,h,d,p=null;let f,g=null;let y,m=null;let C=null;let v=null,T=null;const _=function(t,e){var r;if(t){r=(r=ol.color.asArray(t)).slice();void 0!==e&&(r[3]=e)}else r=[0,0,0,1];return r};const S=function(t,r){const n=ol.xml.parse(t).getElementsByTagName(r.toLowerCase());if(n&&n.length>0){var i=n[0].getAttribute("xmlns");if(i&&i.indexOf(" ")>-1&&e.indexOf(i)>-1){const t=i.split(" "),e=[];for(var o=0;o<t.length;o++)e.push("xmlns:"+r.toLowerCase()+o+'="'+t[o].trim()+'"')}}return t};function E(t,e){let r=null;const n=[0,0];let i="start";if(t.getImage()){let e=t.getImage().getImageSize();null===e&&(e=u);if(2==e.length){const r=t.getImage().getScale();n[0]=r*e[0]/2;n[1]=-r*e[1]/2;i="left"}}if(null!==t.getText()){const e=t.getText();(r=e.clone()).setFont(e.getFont()||C.getFont());r.setScale(e.getScale()||C.getScale());r.setFill(e.getFill()||C.getFill());r.setStroke(e.getStroke()||y)}else r=C.clone();r.setText(e);r.setOffsetX(n[0]);r.setOffsetY(n[1]);r.setTextAlign(i);return new ol.style.Style({text:r})}function w(t){const e=ol.xml.getAllTextContent(t,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(r){const t=r[1];return[parseInt(t.substr(6,2),16),parseInt(t.substr(4,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(0,2),16)/255]}}function b(t){let e=ol.xml.getAllTextContent(t,!1);const r=[],n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;let i;for(;i=n.exec(e);){const t=parseFloat(i[1]),n=parseFloat(i[2]),o=i[3]?parseFloat(i[3]):0;r.push(t,n,o);e=e.substr(i[0].length)}if(""===e)return r}function L(t){const e=ol.xml.getAllTextContent(t,!1).trim();let r=t.baseURI;r&&"about:blank"!=r||(r=window.location.href);if(r){"https:"===location.protocol&&0===r.indexOf("http://")&&(r=r.substr(5));return new URL(e,r).href}return e}function A(t){return ol.format.xsd.readDecimal(t)}const x=ol.xml.makeStructureNS(e,{Pair:function(t,e){const r=ol.xml.pushParseAndPop({},et,t,e);if(!r)return;const n=r.key;if(n&&"normal"==n){const t=r.styleUrl;t&&(e[e.length-1]=t);const n=r.Style;n&&(e[e.length-1]=n)}}});const P=ol.xml.makeStructureNS(e,{Icon:ol.xml.makeObjectPropertySetter(function(t,e){const r=ol.xml.pushParseAndPop({},G,t,e);return r||null}),heading:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),hotSpot:ol.xml.makeObjectPropertySetter(function(t){const e=t.getAttribute("xunits"),r=t.getAttribute("yunits");let i;i="insetPixels"!==e?"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_LEFT:ol.style.IconOrigin.TOP_LEFT:"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_RIGHT:ol.style.IconOrigin.TOP_RIGHT;return{x:parseFloat(t.getAttribute("x")),xunits:n[e],y:parseFloat(t.getAttribute("y")),yunits:n[r],origin:i}}),scale:ol.xml.makeObjectPropertySetter(A)}),I=ol.xml.makeStructureNS(e,{text:ol.xml.makeObjectPropertySetter(function(t,e){ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE);ol.asserts.assert("text"==t.localName);return ol.format.xsd.readString(t).trim()})});const R=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(w),scale:ol.xml.makeObjectPropertySetter(A)});const O=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(w),width:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const M=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(w),fill:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),outline:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean)});const k=ol.xml.makeStructureNS(e,{coordinates:ol.xml.makeReplacer(b)});function N(t,e){return ol.xml.pushParseAndPop(null,k,t,e)}const D=ol.xml.makeStructureNS(t,{Track:ol.xml.makeArrayPusher(B)});const F=ol.xml.makeStructureNS(e,{when:function(t,e){const r=e[e.length-1].whens,n=ol.xml.getAllTextContent(t,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},ol.xml.makeStructureNS(t,{coord:function(t,e){const r=e[e.length-1].flatCoordinates,n=ol.xml.getAllTextContent(t,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){const t=parseFloat(i[1]),e=parseFloat(i[2]),n=parseFloat(i[3]);r.push(t,e,n,0)}else r.push(0,0,0,0)}}));function B(t,e){const r=ol.xml.pushParseAndPop({flatCoordinates:[],whens:[]},F,t,e);if(!r)return;const n=r.flatCoordinates,i=r.whens;for(let t=0,e=Math.min(n.length,i.length);t<e;++t)n[4*t+3]=i[t];return new ol.geom.LineString(n,ol.geom.GeometryLayout.XYZM)}const G=ol.xml.makeStructureNS(e,{href:ol.xml.makeObjectPropertySetter(L)},ol.xml.makeStructureNS(t,{x:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),y:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),w:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),h:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)}));const U=ol.xml.makeStructureNS(e,{coordinates:ol.xml.makeReplacer(b)});function j(t,e){return ol.xml.pushParseAndPop(null,U,t,e)}const q=ol.xml.makeStructureNS(e,{extrude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),tessellate:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString)});function W(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.LineString(n,ol.geom.GeometryLayout.XYZ);t.setProperties(r,!0);return t}}function H(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.Polygon(n,ol.geom.GeometryLayout.XYZ,[n.length]);t.setProperties(r,!0);return t}}const V=ol.xml.makeStructureNS(e,{LineString:ol.xml.makeArrayPusher(W),LinearRing:ol.xml.makeArrayPusher(H),MultiGeometry:ol.xml.makeArrayPusher(Y),Point:ol.xml.makeArrayPusher(z),Polygon:ol.xml.makeArrayPusher($)});function Y(t,e){const r=ol.xml.pushParseAndPop([],V,t,e);if(!r)return null;if(0===r.length)return new ol.geom.GeometryCollection(r);let n,i=!0;const o=r[0].getType();let a;for(let t=1,e=r.length;t<e;++t)if((a=r[t]).getType()!=o){i=!1;break}if(i){let t,e;if(o==ol.geom.GeometryType.POINT){const i=r[0];t=i.getLayout();e=i.getFlatCoordinates();for(let t=1,n=r.length;t<n;++t){a=r[t];ol.array.extend(e,a.getFlatCoordinates())}J(n=new ol.geom.MultiPoint(e,t),r)}else o==ol.geom.GeometryType.LINE_STRING?J(n=new ol.geom.MultiLineString(r),r):o==ol.geom.GeometryType.POLYGON?J(n=new ol.geom.MultiPolygon(r),r):o==ol.geom.GeometryType.GEOMETRY_COLLECTION?n=new ol.geom.GeometryCollection(r):assert(!1,37)}else n=new ol.geom.GeometryCollection(r);return n}function z(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.Point(n,ol.geom.GeometryLayout.XYZ);t.setProperties(r,!0);return t}}const K=ol.xml.makeStructureNS(e,{innerBoundaryIs:function(t,e){const r=ol.xml.pushParseAndPop(void 0,ot,t,e);if(r){const t=e[e.length-1];t.push(r)}},outerBoundaryIs:function(t,e){const r=ol.xml.pushParseAndPop(void 0,at,t,e);if(r){const t=e[e.length-1];t[0]=r}}});function $(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=ol.xml.pushParseAndPop([null],K,t,e);if(n&&n[0]){const t=n[0],e=[t.length];for(let r=1,i=n.length;r<i;++r){ol.array.extend(t,n[r]);e.push(t.length)}const i=new ol.geom.Polygon(t,ol.geom.GeometryLayout.XYZ,e);i.setProperties(r,!0);return i}}const X=ol.xml.makeStructureNS(e,{IconStyle:function(t,e){const r=ol.xml.pushParseAndPop({},P,t,e);if(!r)return;const n=e[e.length-1],i="Icon"in r?r.Icon:{},o=!("Icon"in r)||Object.keys(i).length>0;let a;const p=i.href;p?a=p:o&&(a=h);let g,y,m,C=ol.style.IconOrigin.BOTTOM_LEFT;const v=r.hotSpot;if(v){g=[v.x,v.y];y=v.xunits;m=v.yunits;C=v.origin}else if(a===h){g=s;y=l;m=c}else if(/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)){g=[.5,0];y=ol.style.IconAnchorUnits.FRACTION;m=ol.style.IconAnchorUnits.FRACTION}let T;const _=i.x,S=i.y;void 0!==_&&void 0!==S&&(T=[_,S]);let E;const w=i.w,b=i.h;void 0!==w&&void 0!==b&&(E=[w,b]);let L;const A=r.heading;void 0!==A&&(L=ol.math.toRadians(A));let x=r.scale;if(o){if(a==h){E=u;void 0===x&&(x=d)}const t=new ol.style.Icon({anchor:g,anchorOrigin:C,anchorXUnits:y,anchorYUnits:m,crossOrigin:"anonymous",offset:T,offsetOrigin:ol.style.IconOrigin.BOTTOM_LEFT,rotation:L,scale:x,size:E,src:a});n.imageStyle=t}else n.imageStyle=f},LabelStyle:function(t,e){const r=ol.xml.pushParseAndPop({},R,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Text({fill:new ol.style.Fill({color:"color"in r?r.color:a}),scale:r.scale});n.textStyle=i},LineStyle:function(t,e){const r=ol.xml.pushParseAndPop({},O,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Stroke({color:"color"in r?r.color:a,width:"width"in r?r.width:1});n.strokeStyle=i},PolyStyle:function(t,e){const r=ol.xml.pushParseAndPop({},M,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Fill({color:"color"in r?r.color:a});n.fillStyle=i;const o=r.fill;void 0!==o&&(n.fill=o);const s=r.outline;void 0!==s&&(n.outline=s)},BalloonStyle:function(t,e){ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE);ol.asserts.assert("BalloonStyle"==t.localName);var r=ol.xml.pushParseAndPop({},I,t,e);if(!r)return;const n=e[e.length-1],i=typeof n;ol.asserts.assert("object"==i&&null!=n||"function"==i);var o=new ol.style.Text({text:r.text});n.balloonStyle=o}});function Z(t,e){const r=ol.xml.pushParseAndPop({},X,t,e);if(!r)return null;let n="fillStyle"in r?r.fillStyle:p;const i=r.fill;void 0===i||i||(n=null);let o;"imageStyle"in r?r.imageStyle!=f&&(o=r.imageStyle):o=g;const a="textStyle"in r?r.textStyle:C;let s="strokeStyle"in r?r.strokeStyle:m;const l=r.balloonStyle,c=new ol.style.Style({fill:n,image:o,stroke:s,text:a,zIndex:void 0});l&&(c._balloon=l);return[c]}function J(t,e){const r=e.length,n=new Array(e.length),i=new Array(e.length),o=new Array(e.length);let a,s,l;a=s=l=!1;for(let t=0;t<r;++t){const r=e[t];n[t]=r.get("extrude");i[t]=r.get("tessellate");o[t]=r.get("altitudeMode");a=a||void 0!==n[t];s=s||void 0!==i[t];l=l||o[t]}a&&t.set("extrude",n);s&&t.set("tessellate",i);l&&t.set("altitudeMode",o)}const Q=ol.xml.makeStructureNS(e,{displayName:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),value:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString)});const tt=ol.xml.makeStructureNS(e,{Data:function(t,e){const r=t.getAttribute("name");ol.xml.parseNode(Q,t,e);const n=e[e.length-1];null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value);delete n.value},SchemaData:function(t,e){ol.xml.parseNode(rt,t,e)}});const et=ol.xml.makeStructureNS(e,{Style:ol.xml.makeObjectPropertySetter(Z),key:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),styleUrl:ol.xml.makeObjectPropertySetter(L)});const rt=ol.xml.makeStructureNS(e,{SimpleData:function(t,e){const r=t.getAttribute("name");if(null!==r){const n=ol.format.xsd.readString(t),i=e[e.length-1];i[r]=n}}});const nt=ol.xml.makeStructureNS(e,{altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),minAltitude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxAltitude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),north:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),south:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),east:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),west:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const it=ol.xml.makeStructureNS(e,{minLodPixels:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxLodPixels:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),minFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const ot=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeReplacer(N)});const at=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeReplacer(N)});function st(t,e){const r=asArray(e),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]];for(let t=0;t<4;++t){const e=Math.floor(n[t]).toString(16);n[t]=1==e.length?"0"+e:e}ol.format.xsd.writeStringTextNode(t,n.join(""))}const lt=ol.xml.makeStructureNS(e,{Data:ol.xml.makeChildAppender(function(t,e,r){t.setAttribute("name",e.name);const n={node:t},i=e.value;if("object"==typeof i){null!==i&&i.displayName&&ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.displayName],r,["displayName"]);null!==i&&i.value&&ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.value],r,["value"])}else ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i],r,["value"])}),value:ol.xml.makeChildAppender(function(t,e){ol.format.xsd.writeStringTextNode(t,e)}),displayName:ol.xml.makeChildAppender(function(t,e){ol.format.xsd.writeCDATASection(t,e)})});ol.xml.makeStructureNS(e,{Placemark:ol.xml.makeChildAppender(function(t,e,r){const n={node:t};e.getId()&&t.setAttribute("id",e.getId());const i=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;const a=Object.keys(i||{}).sort().filter(function(t){return!o[t]});if(a.length>0){const t=ol.xml.makeSequence(i,a),e={names:a,values:t};ol.xml.pushSerializeAndPop(n,Pt,Rt,[e],r)}const s=e.getStyleFunction();if(s){const t=s(e,0);if(t){const e=Array.isArray(t)?t[0]:t;this.writeStyles_&&(i.Style=e);const r=e.getText();r&&(i.name=r.getText())}}const l=r[r.length-1].node,c=It[l.namespaceURI],u=ol.xml.makeSequence(i,c);ol.xml.pushSerializeAndPop(n,Pt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,u,r,c);const h=r[0];let d=e.getGeometry();d&&(d=ol.format.Feature.transformGeometryWithOptions(d,!0,h));ol.xml.pushSerializeAndPop(n,Pt,Tt,[d],r)})});const ct=ol.xml.makeSimpleNodeFactory("Data");const ut=ol.xml.makeStructureNS(e,["href"],ol.xml.makeStructureNS(t,["x","y","w","h"])),ht=ol.xml.makeStructureNS(e,{href:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode)},ol.xml.makeStructureNS(t,{x:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),y:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),w:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),h:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode)})),dt=function(e,r,n){return ol.xml.createElementNS(t[0],"gx:"+n)};const pt=ol.xml.makeStructureNS(e,["scale","heading","Icon","hotSpot"]),ft=ol.xml.makeStructureNS(e,{Icon:ol.xml.makeChildAppender(function(e,r,n){const i={node:e},o=n[n.length-1].node;let a=ut[o.namespaceURI],s=ol.xml.makeSequence(r,a);ol.xml.pushSerializeAndPop(i,ht,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,n,a);a=ut[t[0]];s=ol.xml.makeSequence(r,a);ol.xml.pushSerializeAndPop(i,ht,dt,s,n,a)}),heading:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),hotSpot:ol.xml.makeChildAppender(function(t,e){t.setAttribute("x",String(e.x));t.setAttribute("y",String(e.y));t.setAttribute("xunits",e.xunits);t.setAttribute("yunits",e.yunits)}),scale:ol.xml.makeChildAppender(jt)});const gt=ol.xml.makeStructureNS(e,["color","scale"]),yt=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st),scale:ol.xml.makeChildAppender(jt)});const mt=ol.xml.makeStructureNS(e,["color","width"]),Ct=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st),width:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode)});const vt={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Tt=function(t,e,r){if(t){const r=e[e.length-1].node;return ol.xml.createElementNS(r.namespaceURI,vt[t.getType()])}},_t=ol.xml.makeSimpleNodeFactory("Point"),St=ol.xml.makeSimpleNodeFactory("LineString"),Et=ol.xml.makeSimpleNodeFactory("LinearRing"),wt=ol.xml.makeSimpleNodeFactory("Polygon"),bt=ol.xml.makeStructureNS(e,{LineString:ol.xml.makeChildAppender(kt),Point:ol.xml.makeChildAppender(kt),Polygon:ol.xml.makeChildAppender(Bt),GeometryCollection:ol.xml.makeChildAppender(Lt)});function Lt(t,e,r){const n={node:t},i=e.getType();let o,a;if(i==ol.geom.GeometryType.GEOMETRY_COLLECTION){o=e.getGeometries();a=Tt}else if(i==ol.geom.GeometryType.MULTI_POINT){o=e.getPoints();a=_t}else if(i==ol.geom.GeometryType.MULTI_LINE_STRING){o=e.getLineStrings();a=St}else if(i==ol.geom.GeometryType.MULTI_POLYGON){o=e.getPolygons();a=wt}else assert(!1,39);ol.xml.pushSerializeAndPop(n,bt,a,o,r)}const At=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeChildAppender(kt)});function xt(t,e,r){const n={node:t};ol.xml.pushSerializeAndPop(n,At,Et,[e],r)}const Pt=ol.xml.makeStructureNS(e,{ExtendedData:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i=e.names,o=e.values,a=i.length;for(let t=0;t<a;t++)ol.xml.pushSerializeAndPop(n,lt,ct,[{name:i[t],value:o[t]}],r)}),MultiGeometry:ol.xml.makeChildAppender(Lt),LineString:ol.xml.makeChildAppender(kt),LinearRing:ol.xml.makeChildAppender(kt),Point:ol.xml.makeChildAppender(kt),Polygon:ol.xml.makeChildAppender(Bt),Style:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getFill(),a=e.getStroke(),s=e.getImage(),l=e.getText();s&&"function"==typeof s.getSrc&&(i.IconStyle=s);l&&(i.LabelStyle=l);a&&(i.LineStyle=a);o&&(i.PolyStyle=o);const c=r[r.length-1].node,u=qt[c.namespaceURI],h=ol.xml.makeSequence(i,u);ol.xml.pushSerializeAndPop(n,Wt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,h,r,u)}),address:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),description:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),open:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),phoneNumber:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),styleUrl:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),visibility:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode)}),It=ol.xml.makeStructureNS(e,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Rt=ol.xml.makeSimpleNodeFactory("ExtendedData");const Ot=ol.xml.makeStructureNS(e,["extrude","tessellate","altitudeMode","coordinates"]),Mt=ol.xml.makeStructureNS(e,{extrude:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),tessellate:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),altitudeMode:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),coordinates:ol.xml.makeChildAppender(function(t,e,r){const n=r[r.length-1],i=n.layout,o=n.stride;let a;i==ol.geom.GeometryLayout.XY||i==ol.geom.GeometryLayout.XYM?a=2:i==ol.geom.GeometryLayout.XYZ||i==ol.geom.GeometryLayout.XYZM?a=3:assert(!1,34);const s=e.length;let l="";if(s>0){l+=e[0];for(let t=1;t<a;++t)l+=","+e[t];for(let t=o;t<s;t+=o){l+=" "+e[t];for(let r=1;r<a;++r)l+=","+e[t+r]}}ol.format.xsd.writeStringTextNode(t,l)})});function kt(t,e,r){const n=e.getFlatCoordinates(),i={node:t};i.layout=e.getLayout();i.stride=e.getStride();const o=e.getProperties();o.coordinates=n;const a=r[r.length-1].node,s=Ot[a.namespaceURI],l=ol.xml.makeSequence(o,s);ol.xml.pushSerializeAndPop(i,Mt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,r,s)}const Nt=ol.xml.makeStructureNS(e,{outerBoundaryIs:ol.xml.makeChildAppender(xt),innerBoundaryIs:ol.xml.makeChildAppender(xt)}),Dt=ol.xml.makeSimpleNodeFactory("innerBoundaryIs"),Ft=ol.xml.makeSimpleNodeFactory("outerBoundaryIs");function Bt(t,e,r){const n=e.getLinearRings(),i=n.shift(),o={node:t};ol.xml.pushSerializeAndPop(o,Nt,Dt,n,r);ol.xml.pushSerializeAndPop(o,Nt,Ft,[i],r)}const Gt=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st)}),Ut=ol.xml.makeSimpleNodeFactory("color");function jt(t,e){ol.format.xsd.writeDecimalTextNode(t,Math.round(1e6*e)/1e6)}const qt=ol.xml.makeStructureNS(e,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Wt=ol.xml.makeStructureNS(e,{IconStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:o};if(a){l.w=a[0];l.h=a[1];const t=e.getAnchor(),r=e.getOrigin();if(r&&s&&0!==r[0]&&r[1]!==a[1]){l.x=r[0];l.y=s[1]-(r[1]+a[1])}if(t&&(t[0]!==a[0]/2||t[1]!==a[1]/2)){const e={x:t[0],xunits:ol.style.IconAnchorUnits.PIXELS,y:a[1]-t[1],yunits:ol.style.IconAnchorUnits.PIXELS};i.hotSpot=e}}i.Icon=l;const c=e.getScale();1!==c&&(i.scale=c);const u=e.getRotation();0!==u&&(i.heading=u);const h=r[r.length-1].node,d=pt[h.namespaceURI],p=ol.xml.makeSequence(i,d);ol.xml.pushSerializeAndPop(n,ft,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,p,r,d)}),LabelStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getFill();o&&(i.color=o.getColor());const a=e.getScale();a&&1!==a&&(i.scale=a);const s=r[r.length-1].node,l=gt[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(n,yt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),LineStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={color:e.getColor(),width:e.getWidth()},o=r[r.length-1].node,a=mt[o.namespaceURI],s=ol.xml.makeSequence(i,a);ol.xml.pushSerializeAndPop(n,Ct,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,r,a)}),PolyStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t};ol.xml.pushSerializeAndPop(n,Gt,Ut,[e.getColor()],r)})});ol.format.KMLCustom=class extends ol.format.KML{constructor(t){super(t);const e=t||{};T||function(){a=[255,255,255,1];p=new ol.style.Fill({color:_(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity)});s=[20,2];l=ol.style.IconAnchorUnits.PIXELS;c=ol.style.IconAnchorUnits.PIXELS;u=[64,64];h="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";d=.5;g=new ol.style.Icon({anchor:s,anchorOrigin:ol.style.IconOrigin.BOTTOM_LEFT,anchorXUnits:l,anchorYUnits:c,crossOrigin:"anonymous",rotation:0,scale:d,size:u,src:h});f="NO_IMAGE";m=new ol.style.Stroke({color:_(TC.Cfg.styles.line.strokeColor,1),width:TC.Cfg.styles.line.strokeWidth||1});y=new ol.style.Stroke({color:[51,51,51,1],width:2});C=new ol.style.Text({font:"bold 16px Helvetica",fill:p,stroke:y,scale:.8});v=new ol.style.Style({fill:p,image:g,text:C,stroke:m,zIndex:0});T=[v]}();this.defaultStyle_=e.defaultStyle?e.defaultStyle:T}readFeatures(t,e){if("string"==typeof t){const e="<kml";let r=t.indexOf(e);if(r>=0){r+=e.length;t.indexOf("xmlns:xsi=")<0&&(t=t.substr(0,r)+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+t.substr(r));t=S(t,"KML")}}return ol.format.KML.prototype.readFeatures.call(this,t,e)}readDocumentOrFolder_(t,r){const n=ol.xml.makeStructureNS(e,{Document:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Folder:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:ol.xml.makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),i=ol.xml.pushParseAndPop([],n,t,r,this);if(i){if("Folder"==t.localName)for(let e=0,r=i.length;e<r;e++){const r=i[e];Array.isArray(r._folders)||(r._folders=[]);var o=t.getElementsByTagName("name")[0];o&&TC.Util.fastUnshift(r._folders,o.innerHTML||o.textContent)}return i}}readPlacemark_(t,e){const r=ol.xml.pushParseAndPop({geometry:null},i,t,e);if(!r)return;const n=new ol.Feature,o=t.getAttribute("id");null!==o&&n.setId(o);const a=e[0],s=r.geometry;s&&ol.format.Feature.transformWithOptions(s,!1,a);n.setGeometry(s);delete r.geometry;if(this.extractStyles_){const t=function(t,e,r,n,i){return function(o,a){let s,l=i,c="";if(l){const t=o.getGeometry();t&&(l=t.getType()===ol.geom.GeometryType.POINT)}if(l){c=o.get("name");l=l&&!!c}if(t){if(l){s=E(t[0],c);return t.concat(s)}return t}if(e){const t=function t(e,r,n){if(Array.isArray(e))return e;if("string"==typeof e){!(e in n)&&"#"+e in n&&(e="#"+e);return t(n[e],r,n)}return r}(e,r,n);if(l){s=E(t[0],c);return t.concat(s)}return t}if(l){s=E(r[0],c);return r.concat(s)}return r}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(t)}delete r.Style;n.setProperties(r,!0);return n}readSharedStyle_(t,e){const r=t.getAttribute("id");if(null!==r){const n=Z(t,e);if(n){let e,i=t.baseURI;i&&"about:blank"!=i||(i=window.location.href);e=i?new URL("#"+r,i).href:"#"+r;this.sharedStyles_[e]=n}}}readFeatureFromNode(t,r){if(!ol.array.includes(e,t.namespaceURI))return null;const n=this.readPlacemark_(t,[this.getReadOptions(t,r)]);return n||null}readFeaturesFromNode(t,r){if(!ol.array.includes(e,t.namespaceURI))return[];let n;const i=t.localName;if("Document"==i||"Folder"==i)return(n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,r)]))||[];if("Placemark"==i){const e=this.readPlacemark_(t,[this.getReadOptions(t,r)]);return e?[e]:[]}if("kml"==i){n=[];for(let e=t.firstElementChild;e;e=e.nextElementSibling){const t=this.readFeaturesFromNode(e,r);t&&ol.array.extend(n,t)}return n}return[]}}}();!function(t,e){"function"==typeof define&&define.amd?define(["../../lib/ol/build/ol-sitna"],e):"object"==typeof exports?module.exports=e(require("../../lib/ol/build/ol-sitna")):t.ol=e(t.ol)}(this,function(t){Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,r=0;r<e;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;t+=arguments[r]*arguments[r]}return Math.sqrt(t)};for(var e=0,r=["ms","moz","webkit","o"],n=0;n<r.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[r[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[r[n]+"CancelAnimationFrame"]||window[r[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+i)},i);e=n+i;return o});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});const i=t.events.EventType.RESIZE,o=t.events.EventType.DRAGENTER,a=t.events.EventType.DRAGOVER,s=t.events.EventType.DROP,l=t.events.EventType.CHANGE,c=t.MapBrowserEventType.SINGLECLICK,u=t.MapBrowserEventType.POINTERMOVE,h=t.MapEventType.MOVEEND,d=t.MapEventType.POSTRENDER,p=t.render.EventType.POSTCOMPOSE,f=t.source.VectorEventType.ADDFEATURE,g=t.source.VectorEventType.REMOVEFEATURE,y=t.source.VectorEventType.CLEAR,m=t.source.TileEventType.TILELOADSTART,C=t.source.TileEventType.TILELOADEND,v=t.source.TileEventType.TILELOADERROR,T=TC.Util.detectMouse()?3:10;var _=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/"));_=_.substr(0,_.lastIndexOf("/")+1)+"css/ol.css";t.format.KMLCustom||TC.syncLoadJS(TC.apiLocation+"TC/ol/format/KMLCustom");t.format.GPXCustom||TC.syncLoadJS(TC.apiLocation+"TC/ol/format/GPXCustom");if(!window.JSZip){window.JSZip=new Promise(function(t,e){TC.loadJS(!window.JSZip,TC.apiLocation+"lib/jszip/jszip",function(){t()})});window.JSZip.then(null,function(t){TC.error(t);window.JSZip=!1})}t.View.prototype.getValueForResolutionFunction=function(t){const e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){var n=Math.log(r/t)/Math.log(e)/i;return n=Math.max(Math.min(1,n),0)}};TC.Util.detectMobile()||(t.Overlay.prototype.updateRenderedPosition=function(e,r){const n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var a=i[0],s=i[1];if(o==t.OverlayPositioning.BOTTOM_RIGHT||o==t.OverlayPositioning.CENTER_RIGHT||o==t.OverlayPositioning.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=n.left="");const t=Math.round(r[0]-e[0]-a)/window.devicePixelRatio+"px";this.rendered.right_!=t&&(this.rendered.right_=n.right=t)}else{""!==this.rendered.right_&&(this.rendered.right_=n.right="");o!=t.OverlayPositioning.BOTTOM_CENTER&&o!=t.OverlayPositioning.CENTER_CENTER&&o!=t.OverlayPositioning.TOP_CENTER||(a-=this.element.offsetWidth/2);const r=Math.round(e[0]+a)/window.devicePixelRatio+"px";this.rendered.left_!=r&&(this.rendered.left_=n.left=r)}if(o==t.OverlayPositioning.BOTTOM_LEFT||o==t.OverlayPositioning.BOTTOM_CENTER||o==t.OverlayPositioning.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=n.top="");const t=Math.round(r[1]-e[1]-s)/window.devicePixelRatio+"px";this.rendered.bottom_!=t&&(this.rendered.bottom_=n.bottom=t)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=n.bottom="");o!=t.OverlayPositioning.CENTER_LEFT&&o!=t.OverlayPositioning.CENTER_CENTER&&o!=t.OverlayPositioning.CENTER_RIGHT||(s-=this.element.offsetHeight/2);const r=Math.round(e[1]+s)/window.devicePixelRatio+"px";this.rendered.top_!=r&&(this.rendered.top_=n.top=r)}});t.control.OverviewMap.prototype._validateExtent_=t.control.OverviewMap.prototype.validateExtent_;t.control.OverviewMap.prototype.validateExtent_=function(){this._validateExtent_();this._wrap&&this._wrap.parent.options.alwaysCentered&&this.recenter_()};t.control.OverviewMap.prototype._resetExtent_=t.control.OverviewMap.prototype.resetExtent_;t.control.OverviewMap.prototype.resetExtent_=function(){this._resetExtent_.call(this);var e=this._wrap;if(e.is3D){var r=this.ovmap_.getView(),n=r.calculateExtent(),i=e.get3DCameraLayer().getSource().getFeatures()[0];if(i){coordinates=i.getGeometry().getCoordinates();var o=coordinates[0][0],a=coordinates[0][1];if(!t.extent.containsCoordinate(n,o)||!t.extent.containsCoordinate(n,a)){var s=Math.max(n[0]-o[0],n[1]-o[1],o[0]-n[2],o[1]-n[3],n[0]-a[0],n[1]-a[1],a[0]-n[2],a[1]-n[3]);r.fit(t.extent.buffer(n,s))}}}};t.format.GML3CRS84=function(){t.format.GML3.call(this,{srsName:"CRS:84"})};TC.inherit(t.format.GML3CRS84,t.format.GML3);t.format.GML2CRS84=function(){t.format.GML2.call(this,{srsName:"CRS:84"})};TC.inherit(t.format.GML2CRS84,t.format.GML2);const S="http://www.opengis.net/gml",E="http://www.opengis.net/gml/3.2";t.format.GMLBase.prototype.MULTIPOINT_PARSERS_[E]=t.format.GMLBase.prototype.MULTIPOINT_PARSERS_[S];t.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[E]=t.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[S];t.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[E]=t.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[S];t.format.GMLBase.prototype.POINTMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.POINTMEMBER_PARSERS_[S];t.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[S];t.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[S];t.format.GMLBase.prototype.RING_PARSERS[E]=t.format.GMLBase.prototype.RING_PARSERS[S];t.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[E]=t.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[S];t.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[E]=t.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[S];t.format.GML3.prototype.GEOMETRY_PARSERS[E]=t.format.GML3.prototype.GEOMETRY_PARSERS[S];t.format.GML3.prototype.MULTICURVE_PARSERS_[E]=t.format.GML3.prototype.MULTICURVE_PARSERS_[S];t.format.GML3.prototype.MULTISURFACE_PARSERS_[E]=t.format.GML3.prototype.MULTISURFACE_PARSERS_[S];t.format.GML3.prototype.CURVEMEMBER_PARSERS_[E]=t.format.GML3.prototype.CURVEMEMBER_PARSERS_[S];t.format.GML3.prototype.SURFACEMEMBER_PARSERS_[E]=t.format.GML3.prototype.SURFACEMEMBER_PARSERS_[S];t.format.GML3.prototype.SURFACE_PARSERS_[E]=t.format.GML3.prototype.SURFACE_PARSERS_[S];t.format.GML3.prototype.CURVE_PARSERS_[E]=t.format.GML3.prototype.CURVE_PARSERS_[S];t.format.GML3.prototype.ENVELOPE_PARSERS_[E]=t.format.GML3.prototype.ENVELOPE_PARSERS_[S];t.format.GML3.prototype.PATCHES_PARSERS_[E]=t.format.GML3.prototype.PATCHES_PARSERS_[S];t.format.GML3.prototype.SEGMENTS_PARSERS_[E]=t.format.GML3.prototype.SEGMENTS_PARSERS_[S];t.format.GMLBase.prototype.readFeaturesInternal=function(e,r){const n=e.localName;let i=null;if("FeatureCollection"==n){var o=this.FEATURE_COLLECTION_PARSERS[t.format.GMLBase.prototype.namespace];o.member||(o.member=t.xml.makeArrayPusher(t.format.GMLBase.prototype.readFeaturesInternal));if("http://www.opengis.net/wfs"===e.namespaceURI)i=t.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,r,this);else{this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[t.format.GMLBase.prototype.namespace];i=t.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,r,this)}}else if("featureMembers"==n||"featureMember"==n||"member"==n){const o=r[0];let a=o.featureType,s=o.featureNS;const l="p",c="p0";if(e.childNodes){a=[],s={};for(let t=0,r=e.childNodes.length;t<r;++t){const r=e.childNodes[t];if(1===r.nodeType){const t=r.nodeName.split(":").pop();if(-1===a.indexOf(t)){let e="",n=0;const i=r.namespaceURI;for(let t in s){if(s[t]===i){e=t;break}++n}e||(s[e=l+n]=i);a.push(e+":"+t)}}}if("featureMember"!=n){o.featureType=a;o.featureNS=s}}if("string"==typeof s){const t=s;(s={})[c]=t}const u={},h=Array.isArray(a)?a:[a];for(let e in s){const r={};for(let i=0,o=h.length;i<o;++i){(-1===h[i].indexOf(":")?c:h[i].split(":")[0])===e&&(r[h[i].split(":").pop()]="featureMembers"==n?t.xml.makeArrayPusher(this.readFeatureElement,this):t.xml.makeReplacer(this.readFeatureElement,this))}u[s[e]]=r}i="featureMember"==n?t.xml.pushParseAndPop(void 0,u,e,r):t.xml.pushParseAndPop([],u,e,r)}null===i&&(i=[]);return i};t.proj.proj4.register(proj4);t.proj.get("EPSG:4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.get("urn:ogc:def:crs:EPSG::4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.get("http://www.opengis.net/gml/srs/epsg.xml#4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.oldGet=t.proj.get;t.proj.get=function(e){if("string"==typeof e){e=e.trim();TC.loadProjDef({crs:e,sync:!0})}return t.proj.oldGet.call(this,e)};t.format.GMLBase.prototype.readGeometryElement=function(e,r){var n=r[0];n.srsName=e.firstElementChild.getAttribute("srsName");n.srsDimension=e.firstElementChild.getAttribute("srsDimension");if((this instanceof t.format.GML2CRS84||this instanceof t.format.GML3CRS84)&&("EPSG:4326"!==n.srsName||!n.srsName))throw new Error("Conflicto de CRS");n.srsName||(n.srsName=this.srsName);n.dataProjection=t.proj.get(n.srsName);const i=t.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS,e,r,this);return i?t.format.Feature.transformWithOptions(i,!1,n):void 0};const w=/^[\s\xa0]*$/;t.format.GMLBase.prototype.readFeatureElementInternal=function(e,r,n){let i;const o={};for(let a=e.firstElementChild;a;a=a.nextElementSibling){let e;const s=a.localName;if(0===a.childNodes.length||1===a.childNodes.length&&(3===a.firstChild.nodeType||4===a.firstChild.nodeType)){e=t.xml.getAllTextContent(a,!1);w.test(e)&&(e=void 0)}else{n&&(e=this.readGeometryElement(a,r));e?"boundedBy"!==s&&"referencePoint"!==s&&(i=s):e=this.readFeatureElementInternal(a,r,!1)}if(o[s]){o[s]instanceof Array||(o[s]=[o[s]]);o[s].push(e)}else o[s]=e;const l=a.attributes.length;if(l>0){o[s]={_content_:o[s]};for(let t=0;t<l;t++){const e=a.attributes[t].name;o[s][e]=a.attributes[t].value}}}if(n){const r=new t.Feature(o);i&&r.setGeometryName(i);const n=e.getAttribute("fid")||e.getAttributeNS(this.namespace,"id");n&&r.setId(n);return r}return o};const b=function(e,r){var n;if(e){n=(n=t.color.asArray(e)).slice();void 0!==r&&(n[3]=r)}else n=[0,0,0,1];return n};var L=function(t,e){var r=t.map.getView(),n=r.getResolution(),i={projection:r.getProjection(),center:r.getCenter(),resolution:n,enableRotation:!1};t.parent.maxExtent&&(i.extent=t.parent.maxExtent);var o=e;e.type===TC.Consts.layerType.VECTOR&&t.parent.getBaseLayer()&&(o=t.parent.getBaseLayer());var a,s,l=o.getResolutions?o.getResolutions():[];if(l&&l.length){a=o.maxResolution||l[0];s=o.minResolution||l[l.length-1];var c=l.indexOf(s),u=l.indexOf(a);i.resolutions=l.slice(u,c+1)}else{a=o.maxResolution;s=o.minResolution}if(s){i.minResolution=s;n<s&&(i.resolution=s)}if(a){i.maxResolution=a;n>a&&(i.resolution=a)}return i};TC.wrap.Map.prototype.setMap=function(){var e=this,r=[(e.parent.initialExtent[0]+e.parent.initialExtent[2])/2,(e.parent.initialExtent[1]+e.parent.initialExtent[3])/2],n=proj4(e.parent.crs);!function(){var r=e.parent.crs.substr(e.parent.crs.lastIndexOf(":")+1),i={units:n.oProj.units,global:!0},o=[];if("4326"!==r){i.code="EPSG:"+r;o.push(new t.proj.Projection(i));i.code="urn:ogc:def:crs:EPSG::"+r;o.push(new t.proj.Projection(i));t.proj.addEquivalentProjections(o)}t.proj.proj4.register(proj4)}();var o={code:e.parent.crs,units:n.oProj.units};"EPSG:4326"===e.parent.crs&&(o.axisOrientation="neu");var a=new t.proj.Projection(o),s=t.interaction.defaults({constrainResolution:!0}),l={projection:a,center:r,enableRotation:!1};const u=e.parent.maxExtent||e.parent.initialExtent;l.extent=u;var d=e.parent.div.getBoundingClientRect(),p=u[2]-u[0],f=u[3]-u[1];d.width/d.height>p/f?l.resolution=p/d.width:l.resolution=f/d.height;e.map=new t.Map({target:e.parent.div,view:new t.View(l),controls:[],interactions:s,pixelRatio:1});TC.Util.detectMobile()||(e.map.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),r=t.changedTouches?t.changedTouches[0]:t;return[((r=r.clientX?r:r.pointerEvent?r.pointerEvent:r).clientX-e.left)*window.devicePixelRatio,(r.clientY-e.top)*window.devicePixelRatio]});e.map._wrap=e;e._promise=Promise.resolve(e.map);e.manageSize.call(e.map);var g=function(){e.map.updateSize()};e.parent.div.addEventListener(i,g);e.parent.one(TC.Consts.event.MAPLOAD,g);e.map.on(c,function(t){if(e.parent.view!==TC.Consts.view.PRINTING){e.parent.workLayers.forEach(function(t){delete t._noFeatureClicked});var r=e.parent.workLayers.map(function(){return!1});e.map.forEachFeatureAtPixel(t.pixel,function(t,n){if(t._wrap&&t._wrap.parent.showsPopup){for(var i=0;i<e.parent.workLayers.length;i++){if(e.parent.workLayers[i].wrap.layer===n){r[i]=!0;break}}e.parent.trigger(TC.Consts.event.FEATURECLICK,{feature:t._wrap.parent});return t}},{hitTolerance:T});for(var n=0;n<r.length;n++)r[n]||e.parent.trigger(TC.Consts.event.NOFEATURECLICK,{layer:e.parent.workLayers[n]})}});const y=function(){e.map.on(h,function(){e.parent.trigger(TC.Consts.event.ZOOM)})};e.map.getView().on("change:resolution",function(){e.map.hasListener(h)||e.map.once(h,function(){y()});e.parent.trigger(TC.Consts.event.BEFOREZOOM)},e.parent);const m=function(){if(!e.map.hasListener(h)){e.map.un("change:view",m);y()}};e.map.on("change:view",m);var C=function(r){e.map.getView().getResolution(),e.map.getView().getZoom();var n=L(e,r),i=new t.View(n);e.map.setView(i);e.map.render()};e.parent.on(TC.Consts.event.BASELAYERCHANGE,function(t){e.parent.crs!==e.parent.options.crs||e.parent.on3DView||t.layer.type===TC.Consts.layerType.VECTOR||C(t.layer)});e.parent.on(TC.Consts.event.MAPLOAD,function(t){C(e.parent.getBaseLayer())});const v=e.map.getViewport();v.addEventListener(TC.Consts.event.MOUSEMOVE,function(t){var r=!1;if(!e.parent.activeControl||!e.parent.activeControl.isExclusive()){if(e.parent.view===TC.Consts.view.PRINTING)return;var n=e.map.getEventPixel(t);r=e.map.forEachFeatureAtPixel(n,function(t,r){var n=!0;!t._wrap||t._wrap.parent.showsPopup||t._wrap.parent.options.selectable||(n=!1);n&&t._wrap&&e.parent.trigger(TC.Consts.event.FEATUREOVER,{feature:t._wrap.parent});return n},{hitTolerance:T})}v.style.cursor=r?"pointer":""})};var A=function(e,r){var n=e.getUnits();return n&&n!==t.proj.Units.DEGREES?t.proj.METERS_PER_UNIT[n]:TC.Util.getMetersPerDegree(r)};TC.wrap.Map.prototype.getMetersPerUnit=function(){return A(t.proj.get(this.parent.crs),this.getExtent())};var x=function(e){e=e||{};var r=this.parent.options.crs||TC.Cfg.crs,n=t.proj.get(r),i=t.proj.get(e.crs);return A(i,e.extentInDegrees)/A(n,e.extentInDegrees)},P=function(e){var r;(r=e.axisOrientation?new t.proj.Projection({code:e.crs,axisOrientation:e.axisOrientation}):t.proj.get(e.crs)).getUnits()||(r.units_=t.proj.Units.DEGREES);return r};TC.wrap.Map.prototype.setProjection=function(e){const r=this,n=(e=e||{}).baseLayer||r.parent.baseLayer;var i;i=e.extent?e.extent:t.proj.transformExtent(r.getExtent(),r.parent.crs,e.crs);const o=t.proj.transformExtent(i,e.crs,"EPSG:4326"),a=x.call(r,{crs:e.crs,extentInDegrees:o}),s=P(e),l=r.map.getView(),c={projection:s,enableRotation:!1},u=n.getResolutions();if(u&&u.length)c.resolutions=u;else{c.minZoom=l.getMinZoom();c.maxZoom=l.getMaxZoom();const t=n.wrap.layer.getMinResolution(),e=n.wrap.layer.getMaxResolution();var h=1;if(0===t||e===Number.POSITIVE_INFINITY){h=x.call(r,{crs:r.parent.crs,extentInDegrees:o})/a}c.minResolution=0===t?l.getMinResolution()*h:t;e===Number.POSITIVE_INFINITY?c.maxResolution=l.getMaxResolution()*h:c.maxResolution=e}c.center=t.proj.transform(r.getCenter(),r.parent.crs,e.crs);var d=new t.View(c);r.map.setView(d);r.parent.initialExtent=1!==a?t.proj.transformExtent(r.parent.initialExtent,r.parent.crs,e.crs):r.parent.options.initialExtent;r.parent.options.maxExtent&&(r.parent.options.maxExtent=r.parent.maxExtent=1!==a?t.proj.transformExtent(r.parent.maxExtent,r.parent.crs,e.crs):r.parent.options.maxExtent);d.fit(i,{nearest:!0})};TC.wrap.Map.prototype.insertLayer=function(e,r){for(var n=this,i=n.map.getLayers(),o=!1,a=0;a<i.getLength();a++)if(i.item(a)===e){o=!0;break}if(o){i.remove(e);i.insertAt(r,e)}else{r<0?i.push(e):i.insertAt(r,e);var s=n.map.getView();if(n.parent.crs===n.parent.options.crs){if(e instanceof t.layer.Tile){var l=e.getSource().getResolutions();s.maxResolution_=l[0];s.minResolution_=l[l.length-1]}}else if(e instanceof t.layer.Tile){e.setMaxResolution(s.getMaxResolution());e.setMinResolution(s.getMinResolution())}var c=e._wrap,u=0,h=function(t){c.parent.state=TC.Layer.state.LOADING;if(u<=0){u=0;n.parent.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent})}e._loadingTileCount=e._loadingTileCount+1};c.parent.state===TC.Layer.state.LOADING&&c.parent.isRaster()&&h();c.$events.on(TC.Consts.event.BEFORETILELOAD,h);c.$events.on(TC.Consts.event.TILELOAD,function(t){if((u-=1)<=0){u=0;c.parent.state=TC.Layer.state.IDLE;n.parent.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent})}})}};TC.wrap.Map.prototype.removeLayer=function(t){this.map.removeLayer(t)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()};TC.wrap.Map.prototype.indexOfFirstVector=function(){var e=-1;this.map.getLayerGroup().getLayers().forEach(function(r,n){r instanceof t.layer.Vector&&-1===e&&(e=n)});return e};TC.wrap.Map.prototype.getLayerIndex=function(t){var e=-1;this.map.getLayerGroup().getLayers().forEach(function(r,n){r===t&&(e=n)});return e};TC.wrap.Map.prototype.setLayerIndex=function(t,e){var r=this.map.getLayers().getArray().indexOf(t);if(r>-1&&r!=e){this.map.removeLayer(t);this.insertLayer(t,e)}};TC.wrap.Map.prototype.setBaseLayer=function(e){var r=this;return new Promise(function(n,i){var o=function(i){if(i=i||r.parent.getBaseLayer()){r.map.removeLayer(i.wrap.layer);e instanceof t.layer.Image&&e._wrap.setProjection({crs:r.parent.crs});if(e._wrap.parent.type===TC.Consts.layerType.WMTS){var o={crs:r.parent.crs,oldCrs:e.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&e._wrap.parent.setProjection(o)}}r.insertLayer(e,0);r.map.getControls().forEach(function(e){e instanceof t.control.ZoomSlider&&e.initSlider_()});n()},a=L(r,e._wrap.parent),s=r.map.getView(),l=s.getResolution();if(a.resolutions){var c=a.resolutions.sort(function(t,e){return t-e}).reduce(function(t,e){return 0===t&&(e>l||Math.abs(1-l/e)<r.parent.options.maxResolutionError)?e:t},0);if(c!==l)if(r.parent.isLoaded)s.animate({resolution:c,duration:TC.Consts.ZOOM_ANIMATION_DURATION},o.bind(r,r.parent.getBaseLayer()));else{s.setResolution(c);o()}else o()}else o()})};TC.wrap.Map.prototype.setExtent=function(e,r){const n=this;r=r||{};const i=function(t,n,i,o){var a=t.getResolutionForExtent(e,n);if(t.constrainResolution){var s=t.constrainResolution(a,0,0);s<a&&s/a<TC.Consts.EXTENT_TOLERANCE&&(s=t.constrainResolution(s,-1,0));a=s}const l=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(void 0===r.animate||r.animate)t.animate({resolution:a,center:l,duration:TC.Consts.ZOOM_ANIMATION_DURATION},i);else{t.setCenter(l);t.setResolution(a);i()}};Promise.resolve(n._setExtentPromise).finally(function(){!function(e){n._setExtentPromise=new Promise(function(r,o){clearTimeout(n._timeout);n._timeout=setTimeout(function(){var o=n.map.getSize(),a=n.map.getView();n.parent.baseLayer?n.parent.baseLayer.wrap.getLayer().then(function(s){const l=a.getResolutionForExtent(e,o),c=n.getResolutions(),u=a.getMaxZoom();u<c.length-1&&(c.length=u+1);if(c.length>0){var h=Math.min.apply(n,c);if(h>l){var d=.5*(h/l-1),p=t.extent.getWidth(e)*d,f=t.extent.getHeight(e)*d;(e=e.slice(0))[0]=e[0]-p;e[1]=e[1]-f;e[2]=e[2]+p;e[3]=e[3]+f}}i(a,o,r)}):i(a,o,r)},50)})}(e)});return n._setExtentPromise};TC.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())};TC.wrap.Map.prototype.setCenter=function(t,e){const r=this;return new Promise(function(n,i){const o=function(){n()},a=e||{},s=r.map.getView();if(a.animate)s.animate({center:t,duration:TC.Consts.ZOOM_ANIMATION_DURATION},o);else{s.setCenter(t);n()}})};TC.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()};TC.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()};TC.wrap.Map.prototype.setResolution=function(t){this.getMap().then(function(e){e.getView().setResolution(t)})};TC.wrap.Map.prototype.setRotation=function(t){this.getMap().then(function(e){e.getView().setRotation(t)})};TC.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()};TC.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]};TC.wrap.Map.prototype.getCoordinateFromPixel=function(t){return this.map.getCoordinateFromPixel(t)};TC.wrap.Map.prototype.getPixelFromCoordinate=function(t){return this.map.getPixelFromCoordinate(t)};TC.wrap.Map.prototype.getViewport=function(t){const e=this;return(t||{}).synchronous?e.map.getViewport():new Promise(function(t,r){e.getMap().then(function(e){t(e.getViewport())})})};TC.wrap.Map.prototype.isNative=function(e){return e instanceof t.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this.map.getView().getProjection().getUnits();return!e||e===t.proj.Units.DEGREES};TC.wrap.Map.prototype.addPopup=function(e){const r=this;return new Promise(function(n,i){var o=void 0===e.options.draggable||e.options.draggable;TC.loadJS(o&&!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){r.getMap().then(function(n){if(!e.popupDiv){const a=TC.Util.getDiv();e.popupDiv=a;window.$&&(e.$popupDiv=$(a));a.classList.add(TC.control.Popup.prototype.CLASS);e.contentDiv=TC.Util.getDiv();e.contentDiv.classList.add(TC.control.Popup.prototype.CLASS+"-content");e.popupDiv.appendChild(e.contentDiv);e.menuDiv=TC.Util.getDiv();e.menuDiv.classList.add(TC.control.Popup.prototype.CLASS+"-menu");e.popupDiv.appendChild(e.menuDiv);r.parent.div.appendChild(a);var i=new t.Overlay({element:a,positioning:t.OverlayPositioning.BOTTOM_LEFT});n.addOverlay(i);e.wrap.popup=i;const s=n.getViewport();if(o){const t=e.popupDiv.parentElement;e.popupDiv.classList.add(TC.Consts.classes.DRAGGABLE);t.addEventListener("touchmove",function(t){var e=t.target;do{if(e.matches(".tc-ctl-finfo-layer-content")){t.stopPropagation();break}e=e.parentElement}while(e)});const r=new Draggabilly(t,{});r.handleEvent=function(t){this.options.not&&t.target.matches(this.options.not)||Draggabilly.prototype.handleEvent.call(this,t)};r.on("pointerDown",function(t,e){var n=t.target.getBoundingClientRect();if(n.left+t.target.clientWidth<e.pageX||n.top+t.target.clientHeight<e.pageY){r._pointerCancel(t,e);return!1}});r.on("dragStart",function(t,r){e.setDragging(!0);e._currentOffset=i.getOffset();if(e._previousContainerPosition){var o=n.getSize();i.setPosition(n.getCoordinateFromPixel([e._previousContainerPosition[0],o[1]-e._previousContainerPosition[1]]));e._currentOffset=[0,0];i.setOffset(e._currentOffset);delete e._previousContainerPosition}else e._currentOffset=i.getOffset()});r.on("dragEnd",function(r){e.setDragging(!1);var o=n.getCoordinateFromPixel([0,0]),a=n.getCoordinateFromPixel(i.getOffset()),s=[a[0]-o[0],a[1]-o[1]],l=i.getPosition();i.setPosition([l[0]+s[0],l[1]+s[1]]);i.setOffset([0,0]);e._currentOffset=[0,0];const c=t.getBoundingClientRect();e._previousContainerPosition=[c.left,c.bottom]})}const l=function(t){const e=n.getViewport();var i=!1;if(!r.parent.activeControl||!r.parent.activeControl.isExclusive()){var o=n.getEventPixel(t);i=n.forEachFeatureAtPixel(o,function(t,e){var r=!0;t._wrap&&!t._wrap.parent.showsPopup&&(r=!1);return r},{hitTolerance:T})}e.style.cursor=i?"pointer":""};s.removeEventListener("mousemove",l);s.addEventListener("mousemove",l)}});n()})})};TC.wrap.Map.prototype.hidePopup=function(t){this.parent.currentFeature=null;t.popupDiv&&t.popupDiv.classList.remove(TC.Consts.classes.VISIBLE)};TC.wrap.Map.prototype.manageSize=function(){const t=this,e=function(t){var e=window.devicePixelRatio||1,r=t.context.canvas.getBoundingClientRect(),n=e*r.width,i=e*r.height;n===r.width&&Number.isInteger(n)||(n=Math.round(n));i===r.height&&Number.isInteger(i)||(i=Math.round(i));if(n!==r.width||i!==r.height){var o=[n,i];t.target.setSize(o)}};TC.Util.detectMobile()||t.on(p,e)};var I=function(e){switch(e){case TC.Consts.layerType.KML:case TC.Consts.mimeType.KML:case TC.Consts.format.KMZ:return new t.format.KMLCustom({showPointNames:!1});case TC.Consts.layerType.GPX:case TC.Consts.mimeType.GPX:return new t.format.GPXCustom;case TC.Consts.layerType.GEOJSON:case TC.Consts.mimeType.GEOJSON:case TC.Consts.mimeType.JSON:case TC.Consts.format.JSON:return new t.format.GeoJSON;case TC.Consts.format.GML2:return new t.format.GML2;case TC.Consts.format.GML3:return new t.format.GML3;case TC.Consts.format.GML32:return new t.format.GML32;case TC.Consts.mimeType.GML:case TC.Consts.format.GML:return new t.format.GML;case TC.Consts.format.TOPOJSON:return new t.format.TopoJSON;case TC.Consts.format.WKT:return new t.format.WKT;default:return null}};TC.wrap.Map.prototype.exportFeatures=function(e,r){r=r||{};var n=F({styles:this.parent.options.styles}),i=e.map(function(t){var e=t.wrap.feature.clone();e.getStyle()||e.setStyle(n);const r=nt(e).getText();r&&e.setProperties({name:r.getText()});return e}),o=I(r.format);if(o instanceof t.format.KML){i=i.map(function(e){const r=e.getGeometry();if(r instanceof t.geom.Point){var n=nt(e);const i=n.getImage();if(i instanceof t.style.RegularShape){const o=2*i.getRadius()+i.getStroke().getWidth()+1,a=o/2,s=document.createElement("canvas");s.width=o;s.height=o;const l=t.render.toContext(s.getContext("2d"),{size:[o,o]}),c=n.getText();(n=n.clone()).setText();l.setStyle(n);l.drawGeometry(new t.geom.Point([a,a]));const u=new t.Feature(r);u.setProperties(e.getProperties());u.setStyle(new t.style.Style({image:new t.style.Icon({src:s.toDataURL("image/png")}),text:c}));return u}}return e});const e=[];i.forEach(function(r){var n=nt(r);const i=r.getGeometry(),o=n.getText();var a;if(o){switch(!0){case i instanceof t.geom.LineString:a=new t.geom.Point(i.getCoordinateAt(.5));break;case i instanceof t.geom.Polygon:a=i.getInteriorPoint();break;case i instanceof t.geom.MultiLineString:const e=i.getLineStrings();var s=-1;a=new t.geom.Point(e[e.map(function(t){return t.getLength()}).reduce(function(t,e,r){if(e>s){s=e;return r}return t},-1)].getCoordinateAt(.5));break;case i instanceof t.geom.MultiPolygon:const r=i.getPolygons();var l=-1;a=r[r.map(function(t){return t.getArea()}).reduce(function(t,e,r){if(e>l){l=e;return r}return t},-1)].getInteriorPoint()}if(a){const r=new t.Feature(a);r.setStyle(new t.style.Style({text:o.clone(),image:new t.style.Icon({crossOrigin:"anonymous",src:TC.apiLocation+"TC/css/img/transparent.gif"})}));e.push(r)}}});e.length&&(i=i.concat(e))}if(o instanceof t.format.GMLBase){o.hasZ=e[0].getGeometryStride()>=3;(i=i.map(function(t){return t.clone()})).forEach(function(t){const e=t.values_,r=[];for(var n in e)n.indexOf(" ")>=0&&r.push(n);r.forEach(function(t){var r=t.replace(/ /g,"_");/^\d/.test(r)&&(r="_"+r);if(t!==r)for(;void 0!==e[r];)r+="_";e[r]=e[t];delete e[t]})});o.featureNS="sitna";o.featureType="feature";var a=o.writeFeaturesNode(i,{featureProjection:this.parent.crs}),s=t.xml.createElementNS("http://www.opengis.net/gml","FeatureCollection");s.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",o.schemaLocation);a.removeAttribute("xmlns:xsi");a.removeAttribute("xsi:schemaLocation");s.appendChild(a)}o instanceof t.format.GPX&&(i=i.map(function(e){const r=e.getGeometry();r instanceof t.geom.LineString&&(e=e.clone()).setGeometry(new t.geom.MultiLineString([r.getCoordinates()]));return e}));var l=o.writeFeatures(i,{dataProjection:"EPSG:4326",featureProjection:this.parent.crs});o instanceof t.format.GPX&&(l=l.replace(/<ele>NaN<\/ele>/g,""));return l};var R=function(t){for(var e=0,r=t.dataTransfer.types.length;e<r;e++)if("Files"===t.dataTransfer.types[e])return!0;return!1},O=function(t){if(R(t)){this.getMap()._wrap.parent.div.classList.add(TC.Consts.classes.DROP);t.preventDefault();t.stopPropagation()}},M=function(t){if(R(t)){var e=this.getMap()._wrap.parent;t.target===this.target&&e.div.classList.remove(TC.Consts.classes.DROP)}};TC.wrap.Map.prototype.enableDragAndDrop=function(e){var r=this,n=e||{},i={formatConstructors:[t.format.KMLCustom,t.format.GPXCustom,t.format.GML3CRS84,t.format.GML2CRS84,t.format.GML3,t.format.GML2,t.format.GeoJSON,function(){return new t.format.WKT({splitCollection:!0})},t.format.TopoJSON]};n.dropTarget?i.target=TC.getDiv(n.dropTarget):i.target=r.parent.div;var l=new t.interaction.DragAndDrop(i);l.on("addfeatures",function(t){var e=t.features?t.features.map(function(t){t.getId()||t.setId(TC.getUID());return TC.wrap.Feature.createFeature(t)}):[];Promise.all(e).then(function(e){var n=r.parent.getLoadingIndicator();n&&n.removeWait(r._featureImportWaitId);e.length&&!e.some(function(t){return!t.geometry})?r.parent.trigger(TC.Consts.event.FEATURESIMPORT,{features:e,fileName:t.file.name,dropTarget:t.target.target}):r.parent.trigger(TC.Consts.event.FEATURESIMPORTERROR,{file:t.file})})});if(n.once)l.map_=r.map;else{r.map.addInteraction(l);var c=l.target?l.target:r.map.getViewport();if(window.JSZip){var u=function(){const t=l.handleResult_;l.handleResult_=function(e,r){var n=this;"application/x-zip-compressed"===e.type||"application/vnd.google-earth.kmz"===e.type?async function(e){try{var r=await JSZip.loadAsync(e)}catch(t){throw t}r.forEach(async function(e,r){r.async("blob").then(function(r){var i=new File([],e),o=new FileReader;o.onload=function(e){t.apply(n,[i,e])};o.readAsText(r)})})}(e):t.apply(n,[e,r])}};window.JSZip instanceof Promise?window.JSZip.then(u):u()}var h=function(t){if(R(t)){var e=r.parent;if(l.target===t.target){var n=e.getLoadingIndicator();n&&(r._featureImportWaitId=n.addWait());t.stopPropagation()}else t.preventDefault();e.div.classList.remove(TC.Consts.classes.DROP)}};l.dropListenKeys_.push(t.events.listen(c,o,O,l));l.dropListenKeys_.push(t.events.listen(document.body,o,O,l));l.dropListenKeys_.push(t.events.listen(c,a,O,l));l.dropListenKeys_.push(t.events.listen(document.body,a,O,l));l.dropListenKeys_.push(t.events.listen(c,s,h,l));l.dropListenKeys_.push(t.events.listen(document.body,s,h,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragleave",M,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragend",M,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragexit",M,l));document.addEventListener("mouseenter",function(t){t.buttons||r.parent.div.classList.remove(TC.Consts.classes.DROP)},!1);r.ddEnabled=!0}return l};TC.wrap.Map.prototype.loadFiles=function(e,r){var n,i=this;i.ddEnabled?i.map.getInteractions().forEach(function(e){e instanceof t.interaction.DragAndDrop&&(n=e)}):n=i.enableDragAndDrop({once:!0});if(n&&r){var o=n.target;n.target=r.control;const t=function(e){n.target=o;i.parent.off(TC.Consts.event.FEATURESIMPORT,t)};i.parent.on(TC.Consts.event.FEATURESIMPORT,t)}var a=i.parent.getLoadingIndicator();a&&(i._featureImportWaitId=a.addWait());for(let r=0,i=e.length;r<i;++r){const i=e.item(r),o=new FileReader;o.addEventListener(t.events.EventType.LOAD,n.handleResult_.bind(n,i));o.readAsText(i)}};TC.wrap.Layer.prototype.getVisibility=function(){const t=this;var e=!1;t.layer&&(e=t.layer.getVisible());return e};TC.wrap.Layer.prototype.setVisibility=function(t){this.getLayer().then(function(e){e.setVisible(t)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof t.layer.Layer};TC.wrap.Layer.prototype.setProjection=function(e){const r=this;e=e||{};const n=r.parent;if(n.map){const a=x.call(r,{crs:e.crs,extentInDegrees:t.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326")});var i=n.getResolutions();if(i&&i.length){i=i.map(function(t){return t/a});n.wrap.layer.setMaxResolution(i[0]);n.wrap.layer.setMinResolution(i[i.length-1])}else if(!e.oldCrs||t.proj.get(e.oldCrs).getUnits()!==t.proj.Units.METERS||t.proj.get(e.crs).getUnits()&&t.proj.get(e.crs).getUnits()!==t.proj.Units.DEGREES){if(e.oldCrs&&t.proj.get(e.oldCrs).getUnits()===t.proj.Units.DEGREES&&t.proj.get(e.crs).getUnits()===t.proj.Units.METERS){var o=TC.Util.getMetersPerDegree(t.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326"));if(n.minResolution){n.minResolution=n.minResolution*o;r.layer.setMinResolution(n.minResolution)}if(n.maxResolution){n.maxResolution=n.maxResolution*o;r.layer.setMaxResolution(n.maxResolution)}}}else{if(n.minResolution){n.minResolution=n.minResolution/a;r.layer.setMinResolution(n.minResolution)}if(n.maxResolution){n.maxResolution=n.maxResolution/a;r.layer.setMaxResolution(n.maxResolution)}}}};TC.wrap.layer.Raster.prototype.WmsParser=t.format.WMSCapabilities;TC.wrap.layer.Raster.prototype.WmtsParser=t.format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(t){var e=this;t.on("change:visible",function(){e.parent.map&&e.parent.map.trigger(TC.Consts.event.LAYERVISIBILITY,{layer:e.parent})},e.parent.map)};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var t=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:for(var e=this.parent.capabilities.Capability.Request.GetMap.DCPType,r=0;r<e.length;r++)if(e[r].HTTP&&e[r].HTTP.Get){t=e[r].HTTP.Get.OnlineResource;break}break;case TC.Consts.layerType.WMTS:t=this.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const n=document.createDocumentFragment(),i=document.createElement("textarea");n.appendChild(i);i.innerHTML=t;return t=i.textContent};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Capability.Request.GetFeatureInfo&&(t=e.Capability.Request.GetFeatureInfo.Format);return t};TC.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var t=null,e=this.parent.capabilities;if(e&&e.Contents)for(var r=0;r<e.Contents.Layer.length;r++)for(var n=e.Contents.Layer[r],i=0;i<n.TileMatrixSetLink.length;i++)if(this.parent.options.matrixSet===n.TileMatrixSetLink[i].TileMatrixSet){t=n;break}return t};TC.wrap.layer.Raster.prototype.getTileMatrix=function(t){var e=null,r=this.parent.capabilities;if(r&&r.Contents&&r.Contents.TileMatrixSet)for(var n=0;n<r.Contents.TileMatrixSet.length;n++){var i=r.Contents.TileMatrixSet[n];if(i.Identifier===t){e=i.TileMatrix;break}}return e};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(t){var e=[];t.ScaleDenominator?e=[t.ScaleDenominator,t.ScaleDenominator]:(t.MinScaleDenominator||t.MaxScaleDenominator)&&(e=[t.MaxScaleDenominator,t.MinScaleDenominator]);if(!e.length&&!this.getName(t)){for(var r=this.getLayerNodes(t),n=-1/0,i=1/0,o=0,a=r.length;o<a;o++){var s=this.getScaleDenominators(r[o]);s[0]>n&&(n=s[0]);s[1]<i&&(i=s[1])}n>-1/0&&i<1/0&&(e=[n,i])}return e};TC.wrap.layer.Raster.prototype.getAttribution=function(){const t={},e=TC.capabilities[this.parent.url];if(e)if(e.ServiceProvider){t.name=e.ServiceProvider.ProviderName.trim();t.site=e.ServiceProvider.ProviderSite;t.site.href&&t.site.href.trim().length>0&&(t.site=t.site.href)}else e.ServiceIdentification?t.name=e.ServiceIdentification.Title.trim():t.name=e.Service.Title.trim();return t};TC.wrap.layer.Raster.prototype.getInfo=function(t){var e=this,r={},n=e.parent.capabilities;if(n&&n.Capability)for(var i=e.getAllLayerNodes(),o=0;o<i.length;o++){var a=i[o];if(e.parent.compareNames(e.getName(a),t)){a.Title&&(r.title=a.Title);a.Abstract&&(r.abstract=a.Abstract);r.legend=[];var s=function(t,r){if(t.Layer&&t.Layer.length>0)for(var n in t.Layer)s(t.Layer[n],r);else r.apply(e,[t])};s(a,function(t){var e=this.getLegend(t);e.src&&r.legend.push({src:e.src,title:t.Title})});if(a.MetadataURL&&a.MetadataURL.length){r.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];r.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}r.queryable=a.queryable;break}}return r};TC.wrap.layer.Raster.prototype.getServiceType=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Capability.Request&&e.Capability.Request.GetMap?t=TC.Consts.layerType.WMS:e.OperationsMetadata&&e.OperationsMetadata.GetTile&&(t=TC.Consts.layerType.WMTS);return t};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Service?t=e.Service.Title:e.ServiceIdentification&&(t=e.ServiceIdentification.Title);return t};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var t;this.getServiceType()===TC.Consts.layerType.WMS&&(t=this.parent.capabilities.Capability.Layer);return t};TC.wrap.layer.Raster.prototype.getName=function(t,e){var r=t.Name;if(r&&e){var n=r.indexOf(":");n>=0&&(r=r.substr(n+1))}return r};TC.wrap.layer.Raster.prototype.getIdentifier=function(t){return t.Identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(t){var e=t.Layer;Array.isArray(e)||(e=e?[e]:[]);return e};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var t=this;if(!t._layerList)switch(t.getServiceType()){case TC.Consts.layerType.WMS:var e=t.getRootLayerNode();t._layerList=e?function e(r){for(var n=[r],i=t.getLayerNodes(r),o=0;o<i.length;o++)n=n.concat(e(i[o]));return n}(e):[];break;case TC.Consts.layerType.WMTS:t._layerList=t.parent.capabilities.Contents.Layer.slice();break;default:t._layerList=[]}return t._layerList};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(t){return t};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(t){return t};TC.wrap.layer.Raster.prototype.getLegend=function(t){var e={},r=t.Style;if(r&&r.length&&r.length&&r[0].LegendURL&&r[0].LegendURL.length){var n=r[0].LegendURL[0];const t=document.createDocumentFragment(),i=document.createElement("textarea");t.appendChild(i);i.innerHTML=n.OnlineResource;e.src=i.textContent}return e};TC.wrap.layer.Raster.prototype.isCompatible=function(t){var e=this,r=!0,n=e.parent;switch(e.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.Capability&&n.capabilities.Capability.Layer&&n.names.length>0)for(var i=n.names.slice(0),o=function r(i,o,a){var s=!1;if(i)for(var l=0;l<i.length;l++){var c=i[l];const h=c.CRS||c.SRS,d=Array.isArray(h)?h:[h];var u=a||d.indexOf(t)>=0;if(n.compareNames(e.getName(c),o)){u&&(s=!0);break}if(r(c.Layer,o,u)){s=!0;break}}return s};i.length>0;)if(!o([n.capabilities.Capability.Layer],i.pop())){r=!1;break}break;case TC.Consts.layerType.WMTS:r=!1;if(n.capabilities&&n.capabilities.Contents&&n.capabilities.Contents.TileMatrixSet)for(var a=n.capabilities.Contents.TileMatrixSet,s=0;s<a.length;s++)if(a[s].Identifier===n.options.matrixSet){r=TC.Util.CRSCodesEqual(t,a[s].SupportedCRS);break}}return r};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var t=[],e=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0){const r=e.names.map(function(t){return e.getNodePath(t).map(function(t){const e=t.CRS||t.SRS||[],r=Array.isArray(e)?e:[e];return Array.isArray(r)?r:[r]}).reduce(function(t,e){if(0===t.length)return e;e.forEach(function(e){t.indexOf(e)<0&&(t[t.length-1]=e)});return t},[])});if(1===r.length)t=r[0];else{const e=r.slice(1);t=r[0].filter(function(t){return e.every(function(e){return e.indexOf(t)>=0})})}}break;case TC.Consts.layerType.WMTS:e.capabilities&&e.capabilities.Contents&&e.capabilities.Contents.Layer.filter(function(t){return t.Identifier===e.layerNames}).forEach(function(r){const n=r.TileMatrixSetLink.map(function(t){return t.TileMatrixSet});t=e.capabilities.Contents.TileMatrixSet.filter(function(t){return n.indexOf(t.Identifier)>=0}).map(function(t){return t.SupportedCRS})})}return t};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(t){var e=[],r=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer){var n=function(t,r,i){var o=t.CRS||t.SRS,a=Array.isArray(o)?o:[o],s=i||a.indexOf(r)>=0;s&&t.Name&&(e[e.length]=t.Name);if(t.Layer)for(var l=0;l<t.Layer.length;l++)n(t.Layer[l],r,s)};n(r.capabilities.Capability.Layer,t)}break;case TC.Consts.layerType.WMTS:if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var i=r.capabilities.Contents.TileMatrixSet,o=0,a=i.length;o<a;o++){var s=i[o];if(TC.Util.CRSCodesEqual(t,s.SupportedCRS))for(var l=s.Identifier,c=r.capabilities.Contents.Layer,u=0,h=c.length;u<h;u++)for(var d=c[u].TileMatrixSetLink,p=0,f=d.length;p<f;p++)if(d[p].TileMatrixSet===l){e[e.length]=c[u].Identifier;break}}}return e};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(t){var e=[];P({crs:t});var r=this.parent;if(this.getServiceType()===TC.Consts.layerType.WMTS)for(var n=r.capabilities.Contents.Layer,i=r.capabilities.Contents.TileMatrixSet,o=0,a=n.length;o<a;o++)if(r.layerNames===n[o].Identifier)for(var s=n[o].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],h=0,d=i.length;h<d;h++){var p=i[h];if(p.Identifier===u.TileMatrixSet){TC.Util.CRSCodesEqual(t,p.SupportedCRS)&&(e[e.length]=p.Identifier);break}}return e};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){var t=this;t.getLayer().then(function(e){t.parent.options=t.parent.options||{};var r=e.getSource().getUrls();t.parent.options.urlPattern=r[r.length-1]})};TC.wrap.layer.Raster.prototype.createWMSLayer=function(e,r,n){const i=this;var o=null,a=new t.source.ImageWMS({url:e,crossOrigin:n.map?n.map.options.crossOrigin:void 0,params:r,extent:TC.Cfg.initialExtent,ratio:TC.Cfg.imageRatio,imageLoadFunction:i.parent.getImageLoad.bind(i.parent)});a.on("imageloadstart",function(t){i.trigger(TC.Consts.event.BEFORETILELOAD,{tile:t.image.getImage()})});a.on("imageloadend",function(t){i.trigger(TC.Consts.event.TILELOAD,{tile:t.image.getImage()})});a.on("imageloaderror",function(t){i.trigger(TC.Consts.event.TILELOAD,{tile:t.image.getImage()})});var s={visible:!!r.LAYERS.length||n&&n.method&&"POST"===n.method,source:a};n.minResolution&&(s.minResolution=n.minResolution);n.maxResolution&&(s.maxResolution=n.maxResolution);(o=new t.layer.Image(s))._wrap=i;i.addCommonEvents(o);return o};var k=function(e){var r=this,n=null,i=t.source.WMTS.optionsFromCapabilities(r.parent.capabilities,{layer:e.layerNames,matrixSet:e.matrixSet,crossOrigin:e.map?e.map.options.crossOrigin:void 0,requestEncoding:e.encoding,format:e.format});if(i){"https:"===location.protocol&&(i.urls=i.urls.map(function(t){return t.replace("http:","https:")}));i.crossOrigin=e.map?e.map.options.crossOrigin:void 0;(n=new t.source.WMTS(i)).setTileLoadFunction(r.parent.getImageLoad.bind(r.parent));n.on(m,function(t){r.trigger(TC.Consts.event.BEFORETILELOAD,{tile:t.tile.getImage()})});n.on(C,function(t){r.trigger(TC.Consts.event.TILELOAD,{tile:t.tile.getImage()})});n.on(v,function(t){r.trigger(TC.Consts.event.TILELOAD,{tile:t.tile.getImage()})});var o=n.getResolutions.bind(n);n.getResolutions=function(){var t=o(),e=r.parent.getLimitedMatrixSet();if(e&&e.length){var n=e[0].matrixIndex;t=t.slice(n,e.length+n)}return t}}return n};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(e){const r=this;var n=null,i=k.call(r,e);if(i){var o={source:i};e.minResolution&&(o.minResolution=e.minResolution);e.maxResolution&&(o.maxResolution=e.maxResolution);(n=new t.layer.Tile(o))._wrap=r;r.addCommonEvents(n);var a=i.getResolutions();n.setMaxResolution(a[0]+1);n.setMinResolution(a[a.length-1])}return n};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()};TC.wrap.layer.Raster.prototype.setParams=function(t){this.layer.getSource().updateParams(t)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(t){const e=this;e.layer.getSource().getResolutions();if(e.parent.type===TC.Consts.layerType.WMTS){const r=k.call(e,TC.Util.extend({},e.parent.options,{matrixSet:t})),n=r.getResolutions(),i=n[0],o=n[n.length-1];e.layer.setMaxResolution(i);e.layer.setMinResolution(o);e.parent.minResolution&&(e.parent.minResolution=o);e.parent.maxResolution&&(e.parent.maxResolution=i);e.layer.setSource(r)}};TC.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var t=this.layer.getSource();return t.getResolutions?t.getResolutions():[]}return[]};TC.wrap.layer.Raster.prototype.setResolutions=function(t){if(this.layer.getSource){var e=this.layer.getSource();e.resolutions_?e.resolutions_=t:e.tileGrid&&(e.tileGrid.resolutions_=t)}};TC.wrap.layer.Raster.prototype.reloadSource=function(){const t=this;return new Promise(function(e,r){if(t.layer.getSource){t.layer.getSource().refresh();e()}else r()})};TC.wrap.Geometry={getNearest:function(e,r){return new t.geom.LineString(r).getClosestPoint(e)}};var N=function(t,e,r){if(t){var n=function(n){var i=(r&&r._wrap?r._wrap.parent.options.width:null)||e;if(i<n){var o=i/n;t.setScale(o)}},i=t.getSize();if(i)n(i[0]);else{var o=t.getImage();if(o.naturalWidth)n(o.naturalWidth);else{const e=document.createDocumentFragment(),r=document.createElement("img");r.src=t.getSrc();r.addEventListener("load",function(){n(this.naturalWidth)});e.appendChild(r)}}}},D=function(t,e){var r=t,n=e&&e.wrap&&e.wrap.feature;if("string"==typeof t){var i=t.match(/^\$\{(.+)\}$/);if(i&&n){for(var o=i[1].split("."),a=n.getProperties(),s=0;s<o.length&&void 0!==a;s++)a=a[o[s]];if(void 0===a){a=e.data;for(s=0;s<o.length&&void 0!==a;s++)a=a[o[s]]}r=a}}else TC.Util.isFunction(t)&&(r=t(e));return r},F=function(e,r){var n,i,o,a,s,l={};if(r){switch(r.getGeometry().getType()){case"Point":case"MultiPoint":i=!0;break;case"LineString":case"MultiLineString":o=!0;break;case"Polygon":case"MultiPolygon":a=!0}n=r._wrap?r._wrap.parent:{id:TC.wrap.Feature.prototype.getId.call({feature:r}),features:r.get("features"),getData:function(){return TC.wrap.Feature.prototype.getData.call({feature:r})}}}var c={};if((s=n&&Array.isArray(n.features)&&n.features.length>1&&e.cluster?TC.Util.extend(!0,{},TC.Cfg.styles.cluster,e.cluster.styles):e.styles||TC.Cfg.styles).line&&(o||!r)){c=s.line;l.stroke=new t.style.Stroke({color:D(s.line.strokeColor,n),width:D(s.line.strokeWidth,n),lineDash:s.line.lineDash})}if(s.polygon&&(a||!r)){c=s.polygon;l.fill=new t.style.Fill({color:b(D(s.polygon.fillColor,n),D(s.polygon.fillOpacity,n))});l.stroke=new t.style.Stroke({color:D(s.polygon.strokeColor,n),width:D(s.polygon.strokeWidth,n),lineDash:s.polygon.lineDash})}if(s.point&&(i||!r)){c=s.point;var u={radius:D(c.radius,n)||(D(c.height,n)+D(c.width,n))/4};c.fillColor&&(u.fill=new t.style.Fill({color:b(D(c.fillColor,n),D(c.fillOpacity,n))}));c.strokeColor&&(u.stroke=new t.style.Stroke({color:D(c.strokeColor,n),width:D(c.strokeWidth,n),lineDash:c.lineDash}));isNaN(u.radius)||(l.image=new t.style.Circle(u))}c.label&&(l.text=B(c,n));if(s.marker&&(i||!r)){if((c=s.marker).url){l.image=new t.style.Icon({crossOrigin:"anonymous",anchor:c.anchor,anchorXUnits:c.anchorXUnits||"fraction",anchorYUnits:c.anchorYUnits||"fraction",src:c.url});l.text=B(c,n)}}return[new t.style.Style(l)]};const B=function(e,r){if(!e||!e.label)return;const n={text:""+D(e.label,r)};e.fontSize&&(n.font=D(e.fontSize,r)+"pt sans-serif");e.angle&&(n.rotation=-Math.PI*D(e.angle,r)/180);e.fontColor&&(n.fill=new t.style.Fill({color:b(D(e.fontColor,r),1)}));e.labelOutlineColor&&(n.stroke=new t.style.Stroke({color:b(D(e.labelOutlineColor,r),1),width:D(e.labelOutlineWidth,r)}));if(e.labelOffset){n.offsetX=e.labelOffset[0];n.offsetY=e.labelOffset[1]}return new t.style.Text(n)};var G=function(t){var e=t.toString(16);1===e.length&&(e="0"+e);return e},U=function(t){return"#"+G(t[0])+G(t[1])+G(t[2])},j=function(e,r){var n={};TC.Util.isFunction(e)&&r&&(e=e(r));Array.isArray(e)&&(e=e[0]);if(!TC.Util.isFunction(e)){var i,o,a;if(r){const n=r.getGeometry().getType();n!==t.geom.GeometryType.POINT&&n!==t.geom.GeometryType.MULTI_POINT&&e.setImage(null)}var s=e.getImage();if(s)if(s instanceof t.style.RegularShape){if(i=(o=s.getStroke()).getColor()){i=t.color.asArray(i);n.strokeColor=U(i)}n.strokeWidth=o.getWidth();if(a=s.getFill()){if(i=a.getColor()){i=t.color.asArray(i);n.fillColor=U(i)}n.fillOpacity=i[3]}}else{n.url=s.getSrc();var l=s.getSize();if(l){n.width=l[0];n.height=l[1];n.anchor=s.getAnchor();if(n.anchor){n.anchor[0]=n.anchor[0]/n.width;n.anchor[1]=n.anchor[1]/n.height}}}else{if(o=e.getStroke()){if(i=o.getColor()){i=t.color.asArray(i);n.strokeColor=U(i)}n.strokeWidth=o.getWidth();n.lineDash=o.getLineDash()}if(a=e.getFill()){if(i=a.getColor()){i=t.color.asArray(i);n.fillColor=U(i)}n.fillOpacity=i[3]}}}return n};TC.wrap.layer.Vector.prototype.getStyle=function(){return j(this.layer.getStyle())};TC.wrap.layer.Vector.prototype.reloadSource=function(){const e=this;return new Promise(function(r,n){const i=e.createVectorSource(e.parent,e.createStyles(e.parent));if(e.parent.type===TC.Consts.layerType.WFS)var o=i.source.on("change",function(e){if("ready"==i.source.getState()){t.Observable.unByKey(o);r()}});var a=e.layer.getSource().getFeatures();e.layer.setSource(i.source);i.style&&e.layer.setStyle(i.style);if(e.parent.type!=TC.Consts.layerType.WFS){i.source.addFeatures(a);r()}})};TC.wrap.layer.Vector.prototype.import=function(t){var e=TC.Util.extend({},t);e.type=t.format;var r=this.layer.getSource().getFeatures(),n=this.createVectorSource(e,this.createStyles(this.parent));this.layer.setSource(n.source);n.style&&this.layer.setStyle(n.style);n.source.addFeatures(r)};TC.wrap.layer.Vector.prototype.createVectorSource=function(e,r){const n=this;var i,o,a,s,c,u=!1;if(Array.isArray(e.url)||e.urls){var h=e.urls||e.url;o={url:h=h.map(function(t,e){return TC.proxify(t)}),format:new t.format.KMLCustom({showPointNames:!1}),projection:e.crs}}else if(e.url&&e.type!==TC.Consts.layerType.WFS){(o={url:TC.proxify(e.url),projection:e.crs}).format=I(e.format)||I(function(t){var e=t.indexOf("?");e>=0?t=t.substr(0,e):(e=t.indexOf("#"))>=0&&(t=t.substr(0,e));switch(t.substr(t.lastIndexOf(".")+1).toLowerCase()){case"kml":return TC.Consts.mimeType.KML;case"json":case"geojson":return TC.Consts.mimeType.GEOJSON;case"gml":return TC.Consts.mimeType.GML;case"gpx":return TC.Consts.mimeType.GPX;default:return null}}(e.url))||I(e.type);o.loader=(a=o.url,s=o.format,c=t.featureloader.xhr(a,s),function(t,e,r){n.parent.state=TC.Layer.state.LOADING;n.parent.map&&n.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});c.call(this,t,e,r)});u=!0}else if(e.data)(o={projection:e.crs,loader:function(t,r,i){n.parent.state=TC.Layer.state.LOADING;n.parent.map&&n.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});var o=this.getFormat();try{var a=o.readFeatures(e.data,{featureProjection:i});this.addFeatures(a);n.parent.state=TC.Layer.state.IDLE;n.parent.map&&n.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:n.parent,newData:data})}catch(t){n.parent.state=TC.Layer.state.IDLE;n.parent.map&&n.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:n.parent,reason:t.message})}}}).format=I(e.format)||I(e.type);else if(e.type==TC.Consts.layerType.WFS){var d,p;switch(e.outputFormat){case TC.Consts.format.JSON:d=new t.format.GeoJSON({geometryName:e.geometryName});p="json";break;case TC.Consts.format.GML3:d=new t.format.WFS({gmlFormat:new t.format.GML3});p=TC.Consts.mimeType.GML;break;case TC.Consts.format.GML32:d=new t.format.WFS({gmlFormat:new t.format.GML32});p=TC.Consts.mimeType.GML;break;default:d=new t.format.WFS({gmlFormat:new t.format.GML2});p=TC.Consts.mimeType.GML}o={format:d,loader:function(t,r,i){var o=this,a=e.url;if(a){n.parent.state=TC.Layer.state.LOADING;n.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});const t=t=>{const e=t.data;let r;try{r=d.readFeatures(e)}catch(t){n.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:n.parent,reason:t.message})}const i=function(){n.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:n.parent,newData:e})},a=function(t){if(t.layer===n.parent){n.parent.map.off(TC.Consts.event.FEATURESADD,a);i()}};if(r&&r.length){o.addFeatures(r);n.parent.map.on(TC.Consts.event.FEATURESADD,a)}else i();n.parent.state=TC.Layer.state.IDLE},r=(t,r)=>{var n={},o=i.getCode(),s=e.version||r.version||"1.1.0";r.version=s;var l=a,c=Array.isArray(e.featureType)?e.featureType:[e.featureType];if(e.properties&&e.properties.getText(r.version).length>TC.Consts.URL_MAX_LENGTH){n.method="POST";n.url=l;n.data=TC.Util.WFSQueryBuilder(c,e.properties,r,t?null:e.outputFormat,t,o,e.maxFeatures)}else{n.method="GET";n.url=l;n.data={service:"WFS",request:"GetFeature",version:s,typename:(e.featurePrefix?e.featurePrefix+":":"")+e.featureType,outputFormat:e.outputFormat,srsname:o};t&&(n.data=Object.assign(n.data,{resultType:"hits"}));e.properties&&(e.properties instanceof TC.filter.Bbox?n.data=Object.assign(n.data,{BBOX:"{0},{1},{2},{3},{4}".format(e.properties.extent.concat([o]))}):n.data=Object.assign(n.data,{filter:e.properties.getText()}));e.maxFeatures&&(n.data=Object.assign(n.data,{maxFeatures:e.maxFeatures}))}switch(t?"":p){case"json":n.responseType=TC.Consts.mimeType.JSON;break;default:n.responseType=TC.Consts.mimeType.XML}n.contentType=TC.Consts.mimeType.XML;return TC.ajax(n)};n.parent.getCapabilitiesPromise().then(i=>{const o=i;let a=null;try{a=o.Operations.GetFeature.CountDefault.DefaultValue}catch(t){}if(a){e.maxFeatures||(e.maxFeatures=a);r(!0,o).then(e=>{var i=e.data.children[0];if(i.tagName.toLowerCase().indexOf("exception")>=0)n.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:n.parent,reason:i.querySelector("ExceptionText").innerHTML});else if(i.tagName.toLowerCase().indexOf("featurecollection")>=0){let e=parseInt((i.attributes.numberMatched||i.attributes.numberOfFeatures).value,10);if(isNaN(e)||e>=parseInt(a,10)){n.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:n.parent,reason:TC.Consts.WFSErrors.MAX_NUM_FEATURES,data:{limit:parseInt(a,10),founded:e}});return}if(!isNaN(e)&&0===e){t({data:d.writeFeatures([])});return}r(!1,o).then(t)}})}else r(!1,o).then(t)});n._requestUrl=a}},projection:e.crs}}i=new t.source.Vector(o);u&&i.on(l,function(t){n.parent.map&&n.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:n.parent})});i._tcLayer=n.parent;var m=e.style&&e.style.marker?e.style.marker:TC.Cfg.styles.marker;e.style&&e.style.marker||(m=TC.Util.extend({},m,{anchor:TC.Cfg.styles.point.anchor}));if(e.cluster){i=new t.source.Cluster({projection:e.crs,distance:e.cluster.distance,source:i});if(e.cluster.animate){var C=function(e,r){var n=Date.now(),i=e.getGeometry().getCoordinates(),o=r.getGeometry().getCoordinates();r.setGeometry(new t.geom.Point(i));requestAnimationFrame(function a(){var s=function(t,e,r,n){var i=Math.min((Date.now()-n)/r,1),o=(e[0]-t[0])*i,a=(e[1]-t[1])*i;return[t[0]+o,t[1]+a]}(i,o,TC.Consts.CLUSTER_ANIMATION_DURATION,n);r.setGeometry(new t.geom.Point(s));s[0]!==o[0]&&s[1]!==o[1]?requestAnimationFrame(a):v.splice(v.indexOf(e),1)})},v=[];i.addEventListener(g,function(t){var e=t.feature.get("features");e&&e.length>1&&v.push(t.feature)});i.addEventListener(f,function(t){var e=t.feature.get("features");if(e){var r=e[0].getGeometry().getCoordinates();if(e.length>1){var n=v.filter(function(t){var e=t.getGeometry().getCoordinates();return e[0]===r[0]&&e[1]===r[1]});n.length&&v.splice(v.indexOf(n[0]),1)}var i=v.filter(function(t){var e=t.get("features");if(e&&e.length>0){return e.filter(function(t){var e=t.getGeometry().getCoordinates();return e[0]===r[0]&&e[1]===r[1]}).length>0}});i.length&&C(i[i.length-1],t.feature)}})}}var T=i;do{T.addEventListener(f,function(t){var e=t.feature,r=nt(e,!0);r&&N(r.getImage(),m.width,e)});T=TC.Util.isFunction(T.getSource)?T.getSource():null}while(T);i.addEventListener(f,function(t){const e=t.feature,r=function(t){var r;switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:r=n.parent.addPoint;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:r=n.parent.addPolyline;break;case TC.feature.Polygon&&t instanceof TC.feature.Polygon:r=n.parent.addPolygon;break;case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:r=n.parent.addMultiPolygon;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:r=n.parent.addMultiPolyline;break;default:r=n.parent.addFeature}if(r){var i;r.call(n.parent,e).then(function(r){var o=e.get("features");Array.isArray(o)&&(r.features=o.map(function(e){return new t.constructor(e)}));clearTimeout(i);i=setTimeout(function(){n.parent.map.trigger(TC.Consts.event.FEATURESADD,{layer:n.parent,features:[r]})},50)})}};e._wrap&&e._wrap.parent.layer||TC.wrap.Feature.createFeature(e).then(r)});i.addEventListener(g,function(t){var e=t.feature;if(e._wrap){var r=n.parent.features.indexOf(e._wrap.parent);if(r>-1){n.parent.features.splice(r,1);n.parent.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:n.parent,feature:e._wrap.parent})}}});i.addEventListener(f,function(t){n.parent.map&&n.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:n.parent})});i.addEventListener(g,function(){n.parent.map&&n.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:n.parent})});i.addEventListener(y,function(){n.parent.map&&n.parent.map.trigger(TC.Consts.event.FEATURESCLEAR,{layer:n.parent})});var _={source:i};e.minResolution&&(_.minResolution=e.minResolution);e.maxResolution&&(_.maxResolution=e.maxResolution);o&&o.format instanceof t.format.KML&&!e.cluster||(_.style=r||e.styles);return _};TC.wrap.layer.Vector.prototype.createStyles=function(t){var e=this,r=!1;if(TC.Util.isFunction(t)){r=!0;e.styleFunction=function(e){return F(t(e))}}else{(t=TC.Util.extend({},t)).crs=t.crs||TC.Cfg.crs;t.styles=t.styles||TC.Cfg.styles;r=!(!t.cluster||!t.cluster.styles)||function t(e){for(var r in e){var n=e[r];switch(typeof n){case"string":if(/^\$\{(.+)\}$/.test(n))return!0;break;case"object":if(t(n))return!0;break;case"function":return!0}}return!1}(t.styles);e.styleFunction=function(t){return F({styles:e.parent.styles},t)}}return r?e.styleFunction:e.styleFunction()};TC.wrap.layer.Vector.prototype.setStyles=function(t){const e=this;e.getLayer().then(function(r){r.setStyle(e.createStyles({styles:t}))})};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=null,r=this.parent.options,n=this.createVectorSource(r,this.createStyles(r));n.declutter=this.parent.options.declutter||!1;(e=new t.layer.Vector(n))._wrap=this;this.addCommonEvents(e);return e};TC.wrap.layer.Vector.prototype.addFeatures=function(t){const e=this,r=function(e){for(var r=e;TC.Util.isFunction(r.getSource);)r=r.getSource();r.addFeatures(t)};e.layer?r(e.layer):e.getLayer().then(r)};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();return e instanceof t.layer.Layer?e.getSource().getFeatures():[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var r=this.layer;return r instanceof t.layer.Layer?r.getSource().getFeatureById(e):null};TC.wrap.layer.Vector.prototype.removeFeature=function(t){const e=this,r=function(e){if(t.wrap.feature){e.getSource().removeFeature(t.wrap.feature)}};e.layer?r(e.layer):e.getLayer().then(r)};TC.wrap.layer.Vector.prototype.clearFeatures=function(){const t=this,e=function(t){var e=t.getSource();e.clearFeatures?e.clearFeatures():e.clear()};t.layer?e(t.layer):t.getLayer().then(e)};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,r){var n=this,i={color:"rgba(0, 0, 0, 0)"},o={color:"rgba(0, 0, 0, 0)"},a=new t.style.Style({image:new t.style.Circle({radius:0,fill:new t.style.Fill(i),stroke:new t.style.Stroke(o)}),fill:new t.style.Fill(i),stroke:new t.style.Stroke(o)});if(n.parent.features.indexOf(e)>=0){var s=e.wrap.feature;n.getLayer().then(function(t){if(r&&s._originalStyle)s.setStyle(s._originalStyle);else{s._originalStyle=s.getStyle()||t.getStyle();s.setStyle(a)}n.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:n.parent})})}};TC.wrap.layer.Vector.prototype.getRGBA=function(t,e){return b(t,e)};TC.wrap.layer.Vector.prototype.findFeature=function(t){};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,r,n){const i=this,o=function(t){return t.wrap.feature};return new Promise(function(a,s){const l=e.map(o),c=r.map(o),u=n.map(o);e.length||r.length||n.length?i.getLayer().then(function(e){var r=new t.format.WFS,n=i.parent.options,o=r.writeTransaction(l,c,u,{featurePrefix:n.featurePrefix,featureNS:n.featureNS,featureType:n.featureType[0]}),h={url:i.parent.url,method:"POST",contentType:TC.Consts.mimeType.XML,responseType:TC.Consts.mimeType.XML,data:o.outerHTML};TC.ajax(h).then(function(t){const e=t.data,n="http://www.opengis.net/ows";var i=e.getElementsByTagNameNS(n,"ExceptionReport")[0],o={reason:""};if(i){var l=i.getElementsByTagNameNS(n,"Exception")[0];if(l){o.code=l.getAttribute("exceptionCode");for(var c=l.getElementsByTagNameNS(n,"ExceptionText"),u=0,h=c.length;u<h;u++)o.reason+="\n"+c[u].innerHTML}s(o)}else{var d=r.readTransactionResponse(e);a(d)}}).catch(function(){s({code:"",reason:"unknown"})})}):a(i.parent)})};TC.wrap.layer.Vector.prototype.setDraggable=function(e,r,n){var i=this;Promise.all([i.parent.map.wrap.getMap(),i.getLayer()]).then(function(o){const a=o[0],s=o[1];if(e){var l={layers:[s],features:new t.Collection(s.getSource().getFeatures())};i.interaction=new t.interaction.Translate(l);TC.Util.isFunction(r)&&i.interaction.on("translateend",function(t){t.features.getLength()&&r(t.features.item(0)._wrap.parent)});TC.Util.isFunction(n)&&i.interaction.on("translatestart",function(t){t.features.getLength()&&n(t.features.item(0)._wrap.parent)});a.addInteraction(i.interaction)}else if(i.interaction){a.removeInteraction(i.interaction);if(TC.Util.detectIE()&&i._handlerDraggablePointerMove&&TC.Util.isFunction(i._handlerDraggablePointerMove)){a.un("pointermove",i._handlerDraggablePointerMove);delete i._handlerDraggablePointerMove}}})};TC.wrap.layer.Vector.prototype.getFeaturesInExtent=function(e,r){var n=this.layer.getSource().getFeatures(),i=[];if(r){var o=this.parent.map.getPixelFromCoordinate([e[0],e[1]]),a=this.parent.map.getPixelFromCoordinate([e[2],e[3]]);o[0]-=r[0]/2;o[1]+=r[1];a[0]+=r[0]/2;e=this.parent.map.getCoordinateFromPixel(o).concat(this.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<n.length;s++){var l=n[s],c=l.getGeometry().getCoordinates();t.extent.containsCoordinate(e,c)&&i.push(l._wrap.parent)}return i};TC.wrap.layer.Vector.prototype.getAttribution=function(){return null};TC.wrap.layer.Vector.prototype.getGetMapUrl=function(){var t=null;switch(this.getServiceType()){case TC.Consts.layerType.WFS:try{t=this.parent.capabilities.Operations.GetFeature.DCP.HTTP.Get.href}catch(t){}}const e=document.createDocumentFragment(),r=document.createElement("textarea");e.appendChild(r);r.innerHTML=t;return t=r.textContent};TC.wrap.layer.Vector.prototype.getServiceType=function(){var t=null;this.parent.capabilities&&(t=TC.Consts.layerType.WFS);return t};TC.wrap.control.Click.prototype.register=function(t){var e=this;e._trigger=function(r){if(t.view!==TC.Consts.view.PRINTING){var n=0;t.wrap.map.forEachFeatureAtPixel(r.pixel,function(t,e){t._wrap&&t._wrap.parent.showsPopup&&n++},{hitTolerance:T});if(!n){e.parent.map.trigger(TC.Consts.event.CLICK,{coordinate:r.coordinate,pixel:r.pixel});e.parent.callback(r.coordinate,r.pixel)}return 0===n}}};TC.wrap.control.Click.prototype.activate=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){e.on(c,t._trigger)})};TC.wrap.control.Click.prototype.deactivate=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){e.un(c,t._trigger)})};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.updateElement_():this.ctl=new t.control.ScaleLine({target:this.parent.div})};TC.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_};TC.wrap.control.NavBar.prototype.register=function(e){var r=this;e.wrap.getMap().then(function(n){const i=r.parent.div;r.zCtl=new t.control.Zoom({target:i});r.zsCtl=new t.control.ZoomSlider({render:function(e){if(!e.frameState||!e.frameState.viewState||n.getView().getMinResolution()<=e.frameState.viewState.resolution){var i=function(){if(this.element.offsetWidth>this.element.offsetHeight){r.requestSliderSize||(r.requestSliderSize=window.requestAnimationFrame(i.bind(this)));window.requestAnimationFrame(i.bind(this))}else if(this.element.offsetWidth<this.element.offsetHeight){if(r.requestSliderSize){window.cancelAnimationFrame(r.requestSliderSize);delete r.requestSliderSize}t.control.ZoomSlider.render.call(this,e)}};i.call(this)}}});r.zsCtl.setTarget(i);n.addControl(r.zsCtl);n.addControl(r.zCtl);i.querySelectorAll("button").forEach(function(t){t.classList.add("tc-ctl-btn",r.parent.CLASS+"-btn");t.style.display="block";t.innerHTML="";if(t.matches(".ol-zoom-in")){t.classList.add(r.parent.CLASS+"-btn-zoomin");t.setAttribute("title",r.parent.getLocaleString("zoomIn"))}if(t.matches(".ol-zoom-out")){t.classList.add(r.parent.CLASS+"-btn-zoomout");t.setAttribute("title",r.parent.getLocaleString("zoomOut"))}});const o=i.querySelector(".ol-zoomslider");o.classList.add(r.parent.CLASS+"-bar");o.querySelector(".ol-zoomslider-thumb").classList.add(r.parent.CLASS+"-slider");e.on(TC.Consts.event.BASELAYERCHANGE,r.refresh.bind(r))})};TC.wrap.control.NavBar.prototype.refresh=function(){var t=this,e=t.parent.map.wrap.map;t.parent.renderPromise().then(function(){if(t.zsCtl.sliderInitialized_){var r=e.getView().getResolution();t.zsCtl.setThumbPosition_(r)}else e.once(d,function(e){t.zsCtl.render(e)})})};TC.wrap.control.NavBarHome.prototype.register=function(e){var r=this;e.wrap.getMap().then(function(n){const i=r.parent.div;r.z2eCtl=new t.control.ZoomToExtent({target:i,extent:e.initialExtent,tipLabel:""});n.addControl(r.z2eCtl);i.querySelectorAll("button").forEach(function(t){t.style.display="block";t.innerHTML=""});const o=i.querySelector(".ol-zoom-extent button");o.classList.add("tc-ctl-btn",r.parent.CLASS+"-btn");o.setAttribute("title",r.parent.getLocaleString("zoomToInitialExtent"))})};TC.wrap.control.NavBarHome.prototype.setInitialExtent=function(t){this.z2eCtl.extent=t};TC.wrap.control.Coordinates.prototype.register=function(e){const r=this;r.map=e;return new Promise(function(n,i){r._coordsTrigger=function(t){r.parent.coordsToClick(t)};e.wrap.getMap().then(function(e){r.olMap=e;if(r.parent.map.on3DView){r.parent.crs=r.parent.map.view3D.crs;r.parent.units=TC.Consts.units.DEGREES}else{var i=e.getView().getProjection();r.parent.crs=i.getCode();r.parent.units=i.getUnits()}r.parent.isGeo=r.parent.units===t.proj.Units.DEGREES;n()})})};TC.wrap.control.Coordinates.prototype.onMouseMove=function(t){if(this.map.wrap.map){var e=this.map.wrap.map.getEventCoordinate(t);if(e){this.parent.isGeo?this.parent.latLon=e.reverse():this.parent.xy=e;this.parent.update.apply(this.parent,arguments)}}};TC.wrap.control.Geolocation.prototype.register=function(t){var e=this;e.map=t;e._snapTrigger=function(t){t.dragging||e.initSnap(e.olMap.getEventCoordinate(t),t.pixel)};e._postcomposeTrigger=function(t){e.duringTrackSnap(t)};t.wrap.getMap().then(function(t){e.olMap=t})};var q=function(){return this.parent.layerTracking.features.filter(function(t){return t instanceof TC.feature.Polyline})[0]};TC.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.layerTracking.features.length>0&&this.parent.layerTracking.features[0].geometry.length>=1};TC.wrap.control.Geolocation.prototype.showElevationMarker=function(t){TC.wrap.control.ResultsPanel.prototype.showElevationMarker.call(this,{data:t,layer:this.parent.layerTrack,coords:this.parent.elevationChartData.coords})};TC.wrap.control.Geolocation.prototype.hideElevationMarker=function(){TC.wrap.control.ResultsPanel.prototype.hideElevationMarker.call(this)};TC.wrap.control.Geolocation.prototype.addWaypoint=function(e,r){var n=new t.Feature({geometry:new t.geom.Point([e[0],e[1],r.ele,r.time],"XYZM")});n.setProperties(r);this.parent.layerTracking.wrap.layer.getSource().addFeature(n)};TC.wrap.control.Geolocation.prototype.addPosition=function(t,e,r,n,i,o,a){var s=Math.round(t[0]),l=Math.round(t[1]),c=q.call(this);if(this.parent.layerTracking.features&&c){var u=c.geometry.length>0&&c.geometry[c.geometry.length-1];if(u&&0==u.length){this.parent.layerTracking.features[0].geometry.push([s,l,a,r]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,r])}else{var h=Math.round(u[0]),d=Math.round(u[1]);if(s!=h||l!=d){this.parent.layerTracking.features[0].geometry.push([s,l,a,r]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,r])}}TC.Util.storage.setSessionLocalValue(this.parent.Const.LocalStorageKey.TRACKINGTEMP,this.formattedToStorage(this.parent.layerTracking).features)}this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:null!=e&&null!=n&&n>0&&e>0})};TC.wrap.control.Geolocation.prototype.positionChangehandler=function(t){const e=this;var r,n,i,o,a;q.call(this)||e.parent.setTracking(!1);return new Promise(function(s,l){if(t&&t.coords){e.parent.layerGPS.clearFeatures();r=t.coords.accuracy/e.parent.map.getMetersPerUnit()||0;n=t.coords.heading||t[2]||0;i=t.coords.speed?3.6*t.coords.speed:0;o=t.coords.altitude||0;a=t.coords.altitudeAccuracy||0;if(e.parent.layerTracking){var c=[t.coords&&t.coords.longitude||t[0],t.coords&&t.coords.latitude||t[1]],u=TC.Util.reproject(c,"EPSG:4326",e.parent.map.crs);e.addPosition(u,n,(new Date).getTime(),i,r,a,o);var h=q.call(e).geometry,d=h.length;d>=2&&(e.parent.deltaMean=(h[d-1][3]-h[0][3])/(d-1));e.parent.trigger(e.parent.Const.Event.POSITIONCHANGE,{pd:{position:u,altitude:o,accuracy:r,heading:TC.Util.radToDeg(n),speed:i}});Promise.all([e.parent.layerGPS.addPoint(u,{radius:4,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),e.parent.layerGPS.addCircle([u,r],{strokeColor:"#00CED1",strokeWidth:.4,fillColor:"#ffffff",fillOpacity:.2,showsPopup:!1})]).then(function(t){const r=t[0],n=t[1];e.parent.geopositionTracking=!0;if(0==e.parent.firstPosition){e.parent.firstPosition=!0;if(!e.parent.trackCenterButton){e.parent.trackCenterButton=e.parent.div.querySelector("."+e.parent.CLASS+"-track-center");e.parent.trackCenterButton.querySelector("button").addEventListener("click",function(){e.parent.layerGPS.map.zoomToFeatures(e.parent.layerGPS.features);e.parent.track.infoPanel.isVisible()||e.parent.track.infoPanel.doVisible();e.parent.track.infoPanel.isMinimized()&&e.parent.track.infoPanel.maximize()});var i=e.parent.map.getControlsByClass("TC.control.ControlContainer")[0];i?e.parent.trackCenterButton=i.addElement({position:i.POSITION.LEFT,htmlElement:e.parent.trackCenterButton}):e.parent.map.div.appendChild(e.parent.trackCenterButton)}e.parent.trackCenterButton.classList.remove(TC.Consts.classes.HIDDEN);e.parent.layerGPS.map.zoomToFeatures(e.parent.layerGPS.features)}s({marker:r,accuracy:n})})}else s(null)}else s(null)})};TC.wrap.control.Geolocation.prototype.setTracking=function(e){var r=this;if(e){r.parent.firstPosition=!1;var n,i=[];if(r.parent.sessionTracking){var o=(new TC.wrap.parser.JSON).parser.readFeatures(r.parent.sessionTracking);o&&r.parent.storageCRS!==r.parent.map.crs&&(o=o.map(function(t){var e=t.clone();e.getGeometry().transform(r.parent.storageCRS,r.parent.map.crs);return e}));var a=o.filter(function(t){var e=t.getGeometry().getType().toLowerCase();"point"===e&&i.push(t);return"linestring"===e||"multilinestring"===e})[0].getGeometry().getCoordinates();n=new t.Feature({geometry:new t.geom.LineString(a,"XYZM"),tracking:!0})}else n=new t.Feature({geometry:new t.geom.LineString([],"XYZM"),tracking:!0});n&&TC.wrap.Feature.createFeature(n).then(function(t){r.parent.layerTracking.addFeature(t);t.geometry.length>1&&r.parent.map.zoomToFeatures(r.parent.layerTracking.features);i.length>0&&Promise.all(i.map(function(t){return TC.wrap.Feature.createFeature(t)})).then(function(t){t&&t.forEach(function(t){r.parent.layerTracking.addFeature(t)})});r.parent.currentPositionWaiting=r.parent.getLoadingIndicator().addWait();r.currentPositionTrk||(r.currentPositionTrk=[]);var e,n=0,o=0,a=!1,s={enableHighAccuracy:!0,timeout:6e5};e=setInterval(function t(i){var l=n++;navigator.geolocation.getCurrentPosition(function(t){clearInterval(e);r.parent.getLoadingIndicator().removeWait(r.parent.currentPositionWaiting);r.positionChangehandler(t).then(function(t){1==r.parent.geopositionTracking&&t&&t.marker&&t.accuracy&&r.currentPositionTrk.push(navigator.geolocation.watchPosition(r.positionChangehandler.bind(r),r.parent.onGeolocateError.bind(r.parent),s))})},i||function(n){switch(n.code){case n.TIMEOUT:if(o>10){clearInterval(e);r.parent.onGeolocateError.call(r.parent,n)}else{o++;t(function(){clearInterval(e);if(!a){a=!0;r.parent.onGeolocateError.call(r.parent,n)}})}break;default:clearInterval(e);r.parent.onGeolocateError.call(r.parent,n)}},{timeout:5e3+l,maximumAge:10,enableHighAccuracy:!0})},1e3);setTimeout(function(){if(r.parent.layerTracking&&r.parent.layerTracking.features&&r.parent.layerTracking.features.length>0&&0==r.parent.layerTracking.features[0].geometry.length){clearInterval(e);r.parent.getLoadingIndicator().removeWait(r.parent.currentPositionWaiting);r.map.toast(r.parent.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});r.parent.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);r.parent.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}},s.timeout+1e3)})}else{r.parent.firstPosition=!1;if(r.currentPositionTrk){r.currentPositionTrk=r.currentPositionTrk instanceof Array?r.currentPositionTrk:[r.currentPositionTrk];r.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});r.currentPositionTrk=[]}r.parent.trackCenterButton&&r.parent.trackCenterButton.classList.add(TC.Consts.classes.HIDDEN)}};TC.wrap.control.Geolocation.prototype.activateSnapping=function(){if(!TC.Util.detectMobile()){this.olMap.on([u,c],this._snapTrigger);this.olMap.on(p,this._postcomposeTrigger)}};TC.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){if(!TC.Util.detectMobile()){e.un([u,c],t._snapTrigger);e.un(p,t._postcomposeTrigger)}t.snapInfo&&e.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");if(t.snapLine){delete t.snapLine;e.render()}})};TC.wrap.control.Geolocation.prototype.clear=function(t){t&&t.clearFeatures();attachedDTD=!1;this.deactivateSnapping.call(this)};TC.wrap.control.Geolocation.prototype.duringTrackSnap=function(e){var r=e.vectorContext;if(r&&this.snapLine){"function"==typeof r.setFillStrokeStyle&&r.setFillStrokeStyle(null,new t.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1}));"function"==typeof r.drawGeometry&&r.drawGeometry(this.snapLine.wrap.feature.getGeometry())}};TC.wrap.control.Geolocation.prototype.endSnap=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){t.snapInfo&&e.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");t.snapLine&&delete t.snapLine})};TC.wrap.control.Geolocation.prototype.initSnap=function(e,r){var n=this;if(n.parent.layerTrack){var i=n.parent.layerTrack.wrap.layer.getSource().getClosestFeatureToCoordinate(e);if(null!==i){var o=i.getGeometry().getClosestPoint(e);const h=n.parent.map.getPixelFromCoordinate(o);if(Math.sqrt(Math.pow(r[0]-h[0],2)+Math.pow(r[1]-h[1],2))>n.parent.snappingTolerance)n.endSnap();else{var a=[e,[o[0],o[1]]];n.snapLine?n.snapLine.wrap.feature.getGeometry().setCoordinates(a):n.snapLine=new TC.feature.Polyline(a,{});n.snapInfoElement||(n.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]);n.snapInfoElement.style.display="block";if(!n.snapInfo){n.snapInfo=new t.Overlay({element:n.snapInfoElement,offset:[5,18]});n.olMap.addOverlay(n.snapInfo)}null==n.snapInfo.getMap()&&n.snapInfo.setMap(n.olMap);n.snapInfo.setPosition(e);var s={};"LineString"!=i.getGeometry().getType()&&i.getKeys().indexOf("name")>-1&&(s.n=i.get("name"));var l=n.parent.map.options.locale&&n.parent.map.options.locale.replace("_","-")||void 0;s.x=n.map.wrap.isGeo()?o[0].toLocaleString(l,{minimumFractionDigits:5}):Math.round(o[0]).toLocaleString(l);s.y=n.map.wrap.isGeo()?o[1].toLocaleString(l,{minimumFractionDigits:5}):Math.round(o[1]).toLocaleString(l);n.map.wrap.isGeo()&&(s.isGeo=!0);var c=function(t){return o[t]?(Math.round(100*o[t])/100).toLocaleString(l):void 0},u=function(t){return o[t]>0?new Date(o[t]).toLocaleString(l):void 0};if(i.getGeometry().getLayout()===t.geom.GeometryLayout.XYZM){s.z=c(2);s.m=u(3)}else i.getGeometry().getLayout()===t.geom.GeometryLayout.XYZ?s.z=c(2):i.getGeometry().getLayout()===t.geom.GeometryLayout.XYM&&(s.m=u(2));s&&n.parent.getRenderedHtml(n.parent.CLASS+"-track-snapping-node",s,function(t){n.snapInfoElement.innerHTML=t})}}}n.olMap.render()};TC.wrap.control.Geolocation.prototype.drawTrackingData=function(t){const e=this;return new Promise(function(r,n){const i=[],o=(new TC.wrap.parser.JSON).parser.readFeatures(t.data);o.filter(function(t){return"linestring"===t.getGeometry().getType().toLowerCase()||"multilinestring"===t.getGeometry().getType().toLowerCase()}).forEach(function(e){e.getGeometry().setCoordinates(e.getGeometry().getCoordinates(),t.layout)});e.activateSnapping.call(e);for(var a=0,s=o.length;a<s;a++)i.push(TC.wrap.Feature.createFeature(o[a]));Promise.all(i).then(function(t){t.forEach(function(t){t&&e.parent.layerTrack.addFeature(t)});e.parent.map.zoomToFeatures(e.parent.layerTrack.features);r()})})};TC.wrap.control.Geolocation.prototype.formattedFromStorage=function(e){const r=this;if(r.parent.storageCRS!==r.parent.map.crs){var n=(new t.format.GeoJSON).readFeatures(e);if(n){n=n.map(function(t){var e=t.clone();e.getGeometry().transform(r.parent.storageCRS,r.parent.map.crs);return e});return(new t.format.GeoJSON).writeFeatures(n)}}return e};TC.wrap.control.Geolocation.prototype.formattedToStorage=function(e,r,n){var i=this,o=new TC.wrap.parser.JSON;o=o.parser;var a,s=e.wrap.layer.getSource().getFeatures();s=s.map(function(e){e.getGeometry()instanceof t.geom.LineString&&(a=e.getGeometry().getLayout());r&&e.getProperties().tracking&&e.unset("tracking");if(!n&&i.parent.map.crs!==i.parent.storageCRS){var o=e.clone();o.getGeometry().transform(i.parent.map.crs,i.parent.storageCRS);return o}return e}).sort(function(e,r){return e.getGeometry()instanceof t.geom.Point&&!(r.getGeometry()instanceof t.geom.Point)?-1:r.getGeometry()instanceof t.geom.Point&&!(e.getGeometry()instanceof t.geom.Point)?2:e.getProperties().name<r.getProperties().name?-1:e.getProperties().name>r.getProperties().name?1:0});return{features:o.writeFeatures(s),layout:a}};TC.wrap.control.Geolocation.prototype.export=function(e){const r=this;return new Promise(function(n,i){r.parent.getTrackingData(e).then(function(o){if(o){var a=(new t.format.GeoJSON).readFeatures(o.data);if(0===a.length){var s=r.parent.getTrackingData(e);a=(new t.format.GeoJSON).readFeatures(s)}Promise.all(a.map(function(t){return TC.wrap.Feature.createFeature(t)})).then(t=>{n(t)})}else i()})})};var W,H,V=function(t){var e=[],r=[];if(t.length>1){4==t[0].length&&(t=t.sort(function(t,e){return t[0][3]==e[0][3]?0:t[0][3]<e[0][3]?-1:1}));for(var n=0;n<t.length;n++){for(var i=t[n],o=-1,a=1/0,s=i.getLastCoordinate(),l=n+1;l<t.length;l++){var c=t[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);if(u<a){o=l;a=u}}if(e.length<t.length){if(-1==e.indexOf(n)){e.push(n);r=r.concat(i.getCoordinates())}if(-1==e.indexOf(o)){e.push(o);r=r.concat(t[o].getCoordinates())}}}return r}return t[0].getCoordinates()};TC.wrap.control.Geolocation.prototype.processImportedFeatures=function(e){for(var r=this,n=r.parent.layerTrack.wrap.layer.getSource(),i=r.parent.importedFileName,o=[],a=[],s=[],l=[],c=n.getFeatures(),u=[],h=[],d=function(t){t.getProperties().hasOwnProperty("name")&&t.getProperties().name.trim().length>0?o.push(t.getProperties().name):o.push(i)},p=0;p<c.length;p++){var f=c[p];f instanceof TC.Feature&&(f=c[p].wrap.feature);if(f.getGeometry()instanceof t.geom.Point){h.push(f.getGeometry().getCoordinates());l.push(f)}else if(f.getGeometry()instanceof t.geom.LineString){d(f);a.push(new t.Feature({geometry:new t.geom.LineString(f.getGeometry().getCoordinates(),f.getGeometry().getLayout())}));s.push(f)}else if(f.getGeometry()instanceof t.geom.MultiLineString){var g=f.clone();d(g);var y=g.getGeometry().getLineStrings(),m=V(y);a.push(new t.Feature({geometry:new t.geom.LineString(m,f.getGeometry().getLayout())}));s.push(f)}}if(u.length>0){m=V(u);a.push(new t.Feature({geometry:new t.geom.LineString(m)}))}h.length>0&&l.length==c.length&&a.push(new t.Feature({geometry:new t.geom.LineString(h)}));if(s.length>0)for(var C=0;C<s.length;C++)n.removeFeature(s[C]);if(a.length>0){var v,T=0;(function(){const t=a.map(function(t,s){return new Promise(function(t,l){v&&n.removeFeature(v);if(o.length>s){var c=o[s];(function(t,e){for(var r=[],n=t.indexOf(e);-1!=n;){r.push(n);n=t.indexOf(e,n+1);if(r.length>1)return!0}return r.length>1})(o,c)&&(c="["+(s+1)+"] "+c)}r.parent.importedFileName=c||i;v=a[s];n.addFeature(v);r.parent.saveTrack({message:r.parent.getLocaleString("geo.trk.upload.ok",{trackName:c||i}),importedFileName:c||i,notReproject:e.notReproject}).then(function(e){0==s&&(T=e);t()})})});return Promise.all(t)})().then(function(){r.parent.layerTrack.setVisibility(!1);r.parent.layerTrack.clearFeatures();r.parent.trigger(r.parent.Const.Event.IMPORTEDTRACK,{index:T});delete r.parent.importedFileName;r.parent.getLoadingIndicator().removeWait(e.wait)})}else{if(r.parent.layerTrack){r.parent.map.removeLayer(r.parent.layerTrack);r.parent.layerTrack=void 0}delete r.parent.importedFileName;r.parent.getLoadingIndicator().removeWait(e.wait);TC.alert(r.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.import=function(e,r,n){var i,o,a=this;if(r&&r.text){var s=a.parent.layerTrack.wrap.createVectorSource({data:r.text,type:n});i=s.source;o=i.on("change",function(r){if("ready"==i.getState()){t.Observable.unByKey(o);a.processImportedFeatures(e)}});a.parent.layerTrack.wrap.layer.setSource(i)}else{if(a.parent.layerTrack){a.parent.map.removeLayer(a.parent.layerTrack);a.parent.layerTrack=void 0}delete a.parent.importedFileName;a.parent.getLoadingIndicator().removeWait(e);TC.alert(a.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.simulateTrackEnd=function(){this.parent.chartProgressClear();if(this.simulateMarker){window.cancelAnimationFrame(W);this.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&this.simulateMarker.layer.removeFeature(this.simulateMarker);delete this.simulateMarker}};TC.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var e,r=this,n=r.parent.layerTrack.wrap.layer.getSource().getFeatures(),i=0;i<n.length;i++)if(n[i].getGeometry()instanceof t.geom.LineString){e=n[i].getGeometry().getCoordinates();break}if(e&&e.length>0){var o=e[0];new Promise(function(t,e){if(r.simulateMarker){r.simulateMarker.setCoords(o.slice(0,2));t(r.simulateMarker)}else r.parent.layerTrack.addPoint(o.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}).then(function(e){t(e)})}).then(function(n){r.simulateMarker=n;var i=function(){e.length;var n,i=!1;const o=function(t){return r.parent.map.crs!==r.parent.map.options.utmCrs?TC.Util.reproject(t,r.parent.map.crs,r.parent.map.options.utmCrs):t};var a=e;if(4==a[0].length&&a[0][3]>0){n=a[0][3];a[a.length-1][3];i=!0}else{a[0][3]=Date.now();for(var s=1;s<a.length;s++){a[s][3]=0;h=s+1<a.length?new t.geom.LineString(o(a.slice(s-1,s+1))).getLength():new t.geom.LineString(o(a.slice(s-1))).getLength();a[s][3]=a[s-1][3]+36e5*h/r.parent.walkingSpeed}n=a[0][3];a[a.length-1][3]}var l=new t.geom.LineString(a),c=n,u=0;u=r.parent.map.crs!==r.parent.map.options.utmCrs?new t.geom.LineString(o(JSON.parse(JSON.stringify(a)))).getLength():l.getLength();var h=0,d=function(){if(!r.parent.simulate_paused){var e=l.getCoordinateAtM(c),n=function(e){for(var r=0;r<a.length;r++)if(a[r][3]>e)return{d:new t.geom.LineString(o(a.slice(0,r))).getLength(),p:a[r-1].slice(0,2)}}(c);if(!e||!n){var s=r.parent.getSelectedTrack();s&&r.parent.uiSimulate(!1,s);r.parent.hasElevation&&r.parent.chartProgressClear();r.simulateTrackEnd();return}r.parent.hasElevation&&r.parent.chartSetProgress(n,e,u,!!i&&r.parent._getTime(a[0][3],e[3]));if(r.simulateMarker){var h=r.simulateMarker.getCoords(),p=e;Math.atan2(p[1]-h[1],p[0]-h[0]),Math.PI;r.simulateMarker.setCoords(e)}1!==r.parent.simulate_speed?c+=r.parent.delta*r.parent.simulate_speed:c+=r.parent.delta}W=requestAnimationFrame(d)};W=requestAnimationFrame(d)};new Promise(function(t,e){window.d3?t():TC.loadJS(!window.d3,[TC.Consts.url.D3C3],function(){t()})}).then(function(){W=requestAnimationFrame(i)})})}};TC.wrap.control.Geolocation.prototype.headingChangehandler=function(t){var e=this;if(!e.parent.track.infoOnMap){e.parent.track.infoOnMap=document.createElement("div");const t=e.parent.track.infoOnMap.style;t.overFlowY="scroll";t.height="200px";t.width="200px";t.top="0";t.left="100px";t.backgroundColor="fuchsia";t.position="absolute";e.parent.map.div.appendChild(e.parent.track.infoOnMap)}e.parent.track.infoOnMap.style.display="";e.heading=t.target.getHeading();e.parent.track.infoOnMap.innerHTML=e.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+e.heading+" </p>";e.map.wrap.getMap().then(function(t){t.getView().setRotation(-e.heading)});e.parent.trigger(e.parent.Const.Event.STATEUPDATED,{moving:null!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.orientationChangehandler=function(t){var e=this.map.wrap.map.getView(),r=e.getCenter(),n=e.getResolution(),i=t.target.getBeta()||0,o=t.target.getGamma()||0;r[0]-=n*o*25;r[1]+=n*i*25;e.setCenter(e.constrainCenter(r));this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:null!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.pulsate=function(e){this.pulsated=!0;var r,n=e.wrap.feature.getGeometry().getRadius(),i=(new Date).getTime();r=this.olMap.on(p,function(o){var a=o.vectorContext,s=o.frameState,l=s.time-i,c=e.wrap.feature.getGeometry().clone(),u=function(t){switch(!0){case t<=50:return n;case t>50&&t<=100:return 1.02*n;case t>100&&t<=150:return 1.05*n;case t>150&&t<=200:return 1.02*n;case t>200&&t<=300:return n;case t>300&&t<=350:return 1.02*n;case t>350&&t<=400:return 1.05*n;case t>400&&t<=450:return 1.02*n;case t>450&&t<=500:return 1*n;default:return n}}(l);c.setRadius(u);a.setFillStrokeStyle(new t.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new t.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1}));a.drawCircleGeometry(c);l>500?t.Observable.unByKey(r):s.animate=!0})};TC.wrap.control.ResultsPanel.prototype.register=function(t){const e=this;e.map=t;t.wrap.getMap().then(function(t){e.olMap=t})};TC.wrap.control.ResultsPanel.prototype.showElevationMarker=function(e){const r=this,n=(e=e||{}).data,i=e.layer,o=e.coords;if(!r.elevationMarker){const e=document.createElement("div");e.style.display="none";e.classList.add("tc-ctl-geolocation-trackMarker","elevation");r.elevationMarker=new t.Overlay({element:e,offset:[0,-11],positioning:t.OverlayPositioning.CENTER_CENTER,stopEvent:!1})}if(i.getVisibility()&&i.getOpacity()>0){r.elevationMarker.getElement().style.display="";r.olMap.addOverlay(r.elevationMarker);r.elevationMarker.setPosition(o[n[0].index])}};TC.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){this.elevationMarker&&(this.elevationMarker.getElement().style.display="none")};TC.wrap.control.Coordinates.prototype.coordsActivate=function(){this.olMap.on(c,this._coordsTrigger)};TC.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(c,this._coordsTrigger)};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(t){var e=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");e=this.parser.readFeatures(t).map(function(t){return new TC.Feature(null,{id:t.getId(),data:t.getProperties()})})}return e};TC.wrap.parser={WFS:function(e){this.parser=new t.format.WFS(e)},JSON:function(e){this.parser=new t.format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.OverviewMap.prototype.register=function(e){var r=this;r.parent.layer.wrap.getLayer().then(function(n){r.ovMap=new t.control.OverviewMap({target:r.parent.div,collapsed:!1,collapsible:!1,className:r.parent.CLASS+" ol-overviewmap",layers:[n]});r.ovMap._wrap=r;r.ovMap.getOverviewMap().pixelRatio_=1;r.ovMap.ovmap_.removeOverlay(r.ovMap.boxOverlay_);var i=document.createElement("DIV");i.className="ol-overviewmap-box";i.style.boxSizing="border-box";r.ovMap.boxOverlay_=new t.Overlay({position:[0,0],positioning:t.OverlayPositioning.BOTTOM_LEFT,element:i});r.ovMap.ovmap_.addOverlay(r.ovMap.boxOverlay_);r.manageSize.call(r.ovMap.ovmap_);r._boxElm=r.ovMap.boxOverlay_.getElement();TC.loadJS(!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){var t=r.ovMap.ovmap_;const n=new Draggabilly(r._boxElm);n.positionDrag=function(){const t=this.element.style,e="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(t.transform.length){const r=t.transform.indexOf("translate3d");if(r>=0){const n=t.transform.indexOf(")",r);t.transform=t.transform.replace(t.transform.substring(r,n+1),e)}else t.transform=e+" "+t.transform}else t.transform=e};n.on("pointerDown",function(i){n.dragged=r._boxElm.cloneNode();n.dragged.classList.add(TC.Consts.classes.ACTIVE);n.dragged.style.position="absolute";r._boxElm.insertAdjacentElement("beforebegin",n.dragged);if(e.maxExtent){var o=t.getPixelFromCoordinate([e.maxExtent[0],e.maxExtent[1]]),a=t.getPixelFromCoordinate([e.maxExtent[2],e.maxExtent[3]]),s=t.getSize();const r=document.createElement("div");r.style.position="absolute";r.style.bottom=Math.round(s[1]-o[1])+"px";r.style.left=Math.round(o[0])+"px";r.style.top=Math.round(a[1])+"px";r.style.right=Math.round(s[0]-a[0])+"px";const i=t.getViewport();i.insertBefore(r,i.firstElementChild);n.options.containment=r}});n.on("pointerUp",function(r){n.dragged.parentElement.removeChild(n.dragged);if(e.maxExtent){t.getViewport().removeChild(n.options.containment);n.options.containment=null}});n.on("dragMove",function(t,e,r){n._delta=r});n.on("dragEnd",function(i,o){var a=r.ovMap.getMap().getView(),s=t.getPixelFromCoordinate(a.getCenter()),l=t.getCoordinateFromPixel([s[0]+n._delta.x,s[1]+n._delta.y]),c=e.getExtent(),u=(c[2]-c[0])/2,h=(c[3]-c[1])/2;l[0]+u>e.maxExtent[2]?l[0]=e.maxExtent[2]-u:l[0]-u<e.maxExtent[0]&&(l[0]=e.maxExtent[0]+u);l[1]+h>e.maxExtent[3]?l[1]=e.maxExtent[3]-h:l[1]-h<e.maxExtent[1]&&(l[1]=e.maxExtent[1]+h);n.setPosition(0,0);delete n._delta;e.setCenter(l,{animate:!0})})});e.wrap.getMap().then(function(t){r.reset();const e=r.parent.div.querySelector("."+r.parent.CLASS+"-load");n._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){e.classList.remove(TC.Consts.classes.HIDDEN);e.classList.add(TC.Consts.classes.VISIBLE)});n._wrap.$events.on(TC.Consts.event.TILELOAD,function(){e.classList.remove(TC.Consts.classes.VISIBLE);e.classList.add(TC.Consts.classes.HIDDEN)});t.addControl(r.ovMap);r.parent.isLoaded=!0;r.parent.trigger(TC.Consts.event.MAPLOAD)})})};TC.wrap.control.OverviewMap.prototype.reset=function(e){const r=this;return new Promise(function(n,i){const o=function(e,i){if(e.type===TC.Consts.layerType.WMTS){var o={crs:i||r.parent.map.crs,oldCrs:e.wrap.layer.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&e.setProjection(o)}e.wrap.getLayer().then(function(i){var o=new t.View(L(r.parent.map.wrap,i._wrap.parent));if(o.getResolutions()){o.setResolution(o.getResolutions().filter(function(t){return t>o.getResolutionForExtent(r.parent.map.getExtent(),s.getSize())}).reverse()[0]);s.setView(o)}else o.getProjection().getCode()!==s.getView().getProjection().getCode()&&s.setView(o);i._wrap.$events.one(TC.Consts.event.TILELOAD,function(){s.getLayers().getArray()[0].getSource().refresh()});if(e!==r.parent.layer||-1===s.getLayers().getArray().indexOf(e)){r.parent.map.trigger(TC.Consts.event.OVERVIEWBASELAYERCHANGE,{oldLayer:e!==r.parent.layer?r.parent.layer:null,newLayer:e});s.getLayers().forEach(function(e){(e instanceof t.layer.Image||e instanceof t.layer.Tile)&&s.removeLayer(e)});const n=r.parent.div.querySelector("."+r.parent.CLASS+"-load");i._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){n.classList.remove(TC.Consts.classes.HIDDEN);n.classList.add(TC.Consts.classes.VISIBLE)});i._wrap.$events.on(TC.Consts.event.TILELOAD,function(){n.classList.remove(TC.Consts.classes.VISIBLE);n.classList.add(TC.Consts.classes.HIDDEN)});s.getLayers().insertAt(0,i)}n(e)})};var a=(e=e||{}).layer||r.parent.layer;if(r.parent.map&&a&&r.ovMap){var s=r.ovMap.ovmap_;a.getCapabilitiesPromise().then(function(){var t=a;a.isCompatible(r.parent.map.crs)||0!==a.wrap.getCompatibleMatrixSets(r.parent.map.crs).length?o(a):(a=a.getFallbackLayer()||r.parent.defaultLayer).getCapabilitiesPromise().then(function(){r.parent.map.on3DView&&!a.isCompatible(r.parent.map.crs)?r.parent.map.loadProjections({crsList:t.getCompatibleCRS(),orderBy:"name"}).then(function(e){o(t,e[0].code)}):a.isCompatible(r.parent.map.crs)&&o(a)})})}})};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var e=null;if(this.ovMap){(r=this.ovMap.getOverviewMap()).getLayers().forEach(function(t){"3DCamera"===t.get("id")&&(e=t)});if(!e){var r=this.ovMap.getOverviewMap(),n=F({});n[0].getFill().setColor([0,0,0,0]);e=new t.layer.Vector({id:"3DCamera",source:new t.source.Vector,style:n});r.addLayer(e)}}return e};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){if(this.parent.map.isLoaded){this.is3D=!!e;var r=this.get3DCameraLayer();if(r){var n,i=(e=e||{}).fov,o=r.getSource();if(i&&i.length){var a=o.getFeatures();if(a.length)n=a[0];else{n=new t.Feature;o.addFeature(n)}n.setGeometry(new t.geom.Polygon([i]))}else o.clear();var s="number"==typeof e.heading?e.heading:0;this._boxElm.style.transform="rotate("+s+"rad)"}}};TC.wrap.control.OverviewMap.prototype.enable=function(){if(this.parent.layer&&this.parent.layer.setVisibility){this.parent.layer.setVisibility(!0);this.parent.wrap.ovMap.ovmap_.updateSize();const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1);this.parent.map.div.dispatchEvent(t)}};TC.wrap.control.OverviewMap.prototype.disable=function(){this.parent.layer&&this.parent.layer.setVisibility&&this.parent.layer.setVisibility(!1)};TC.wrap.control.OverviewMap.prototype.manageSize=function(){TC.wrap.Map.prototype.manageSize.call(this)};TC.wrap.control.FeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then(function(r){TC.wrap.control.Click.prototype.register.call(e,t);var n=e._trigger;e._trigger=function(r){var i=n.call(e,r);i?e.parent.beforeRequest({xy:r.pixel}):t.trigger(TC.Consts.event.NOFEATUREINFO,{control:e.parent});return i}})};var Y=function(t){var e=t.innerHTML||t.textContent;(H=H||document.createElement("textarea")).innerHTML=e;return H.value},z={readFeatures:function(e){var r=[],n=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===n.documentElement.tagName)for(var i=n.documentElement.getElementsByTagName("FeatureInfoCollection"),o=0,a=i.length;o<a;o++)for(var s=i[o],l=s.getAttribute("layername"),c=s.getElementsByTagName("FeatureInfo"),u=0,h=c.length;u<h;u++){for(var d=c[u].getElementsByTagName("Field"),p={},f=0,g=d.length;f<g;f++){var y=d[f];p[Y(y.getElementsByTagName("FieldName")[0])]=Y(y.getElementsByTagName("FieldValue")[0])}var m=new t.Feature(p);m.setId(l+"."+TC.getUID());r[r.length]=m}return r}},K=function(t,e,r){var n=e.getPath(r);t.layers.push({name:r,title:n[n.length-1],path:n.slice(1),features:[]})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,r,n){var i=this,o=n||{},a=i.parent.map;a.wrap.getMap().then(function(n){var s={},l={};const c=[],u=[];var h=[],d=[];T=(T=n.getLayers().getArray()).filter(function(e){return e instanceof t.layer.Image&&e.getVisible()});for(var p=0;p<T.length;p++){var f=T[p],g=f._wrap.parent;if((S=f.getSource()).getGetFeatureInfoUrl&&a.workLayers.indexOf(g)>=0&&g.names.length>0&&(!o.serviceUrl||o.serviceUrl===g.url)){if(s[g.url]){_=s[g.url];l[g.url].source.updateParams(TC.Util.extend(l[g.url].source.getParams(),S.getParams()))}else{_={url:g.url,layers:[],mapLayers:[],title:g.title,request:null};s[g.url]=_;l[g.url]={source:TC.Util.extend(!0,{},S),layers:[]}}_.mapLayers.push(g);var y=g.getDisgregatedLayerNames();if(o.layerName){if(y.indexOf(o.layerName)>=0&&f._wrap.getInfo(o.layerName).queryable){K(_,g,o.layerName);l[g.url].layers.push(o.layerName)}}else{for(var m=0;m<y.length;m++){var C=y[m];if(f._wrap.getInfo(C).queryable)K(_,g,C);else{TC.Util.consoleRegister('Capa "'+y[m]+'" no queryable, la eliminamos de la petici\xf3n GFI');y.splice(m,1);m-=1}}y.length>0&&(l[g.url].layers=l[g.url].layers.concat(y))}}}for(var v in s){d.push(s[v]);var T,_=s[v],S=l[v].source;if(!(T=l[v].layers)||T&&0===T.length)continue;var E=S.getParams();S.params_.LAYERS=T.join(",");var w=S.getGetFeatureInfoUrl(e,r,a.crs,{QUERY_LAYERS:T.join(","),INFO_FORMAT:E.INFO_FORMAT,FEATURE_COUNT:1e3,radius:a.options.pixelTolerance,buffer:a.options.pixelTolerance}),b=w=w.replace(/sld_body=[a-zA-Z%0-9._]*/);const t={serviceUrl:v,requestedFormat:E.INFO_FORMAT,expandUrl:b};u.push(t);c.push(new Promise(function(e,r){const n=_.mapLayers[0];n.toolProxification.fetch(w).then(function(r){n.toolProxification.cacheHost.getAction(t.expandUrl).then(function(i){t.originalUrl=i.action.call(n.toolProxification,t.expandUrl);e(TC.Util.extend({},r,t))})}).catch(function(t){r(Error(t))})}));TC.Util.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then(function(n){for(var l=!1,c=0,d=[],p=0;p<n.length;p++){var f,g=n[p],y=s[u[p].serviceUrl];l=!0;y.text=g.responseText;var m=g.contentType;m&&m.indexOf(";")>-1&&(m=m.substr(0,m.indexOf(";")).trim());m||(m=g.requestedFormat);if(m===g.requestedFormat){switch(m){case"application/json":f=new t.format.GeoJSON;break;case"application/vnd.ogc.gml":f=g.responseText.indexOf("FeatureCollection")>-1?new t.format.WFS({gmlFormat:new t.format.GML2({srsName:a.crs})}):new t.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":f=new t.format.GML3({srsName:a.crs});break;case"application/vnd.esri.wms_featureinfo_xml":f=z;break;default:f=null}if(f){var C;try{C=f.readFeatures(g.responseText,{featureProjection:t.proj.get(a.crs)})}catch(t){TC.error(i.parent.getLocaleString("featureInfo.error.badResponse",{url:g.serviceUrl})+": "+t.message);C=[];continue}c+=C.length;for(var v=function(t,e,r){var n=!1;if(e===r)n=!0;else{var i=t.getNodePath(e),o=t.getNodePath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(t.wrap.getName(i[a])!==t.wrap.getName(o[a])){n=!1;break}}}return n},T={},_=0;_<C.length;_++){var S=C[_];if(S instanceof t.Feature){for(var E=S.getId()||TC.getUID(),w=!1,b=E.substr(0,E.lastIndexOf(".")),L=0;L<y.layers.length;L++){var A=y.layers[L],x=A.name.substr(A.name.indexOf(":")+1);if(y.mapLayers.some(function(t){return v(t,x,b)})){w=!0;if(!o.featureId||S.getId()===o.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));d.push(A.features)}break}}if(!w){var P;if(T[b])P=T[b];else{P={name:b,title:b,path:[b],features:[]};T[b]=P;y.layers.push(P)}if(!o.featureId||S.getId()===o.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));d.push(P.features)}}}}}else{var I={name:"layer"+TC.getUID(),title:"Datos en el punto",features:[]};y.layers[y.layers.length]=I;I.features[0]={rawUrl:g.originalUrl,expandUrl:g.expandUrl,rawContent:g.responseText,rawFormat:m};c+=1}}else{TC.Util.consoleRegister("Respuesta GFI: lo m\xe1s probable es que el servidor est\xe9 devolviendo una excepci\xf3n");TC.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada");i.parent.responseError({message:g.responseText,status:g.status});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})}}if(l){var R=h;h.length&&(R=R.concat(new Promise(function(t,e){TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){t()})})));Promise.all(R).then(function(t){var n;t.forEach(function(t,r){if(t){t.attributes=[];for(var o in t.data){var a=t.data[o];"object"!=typeof a?t.attributes.push({name:o,value:"number"==typeof a?a.toLocaleString(TC.Util.getMapLocale(i.parent.map)):a}):t.attributes.push({name:o,value:a})}!n&&TC.Geometry.isInside(e,t.geometry)&&(n=t);d[r].push(t)}});var o=[];for(var a in s)s.hasOwnProperty(a)&&o.push(s[a]);i.parent.responseCallback({coords:e,resolution:r,services:o,featureCount:c,defaultFeature:n})})}},function(t,n,o){if(d&&0==d.length)for(var l in s)d.push(s[l]);i.parent.responseCallback({coords:e,resolution:r,services:d,featureCount:0});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})});else{a.workLayers.filter(function(t){return t instanceof TC.layer.Raster}).length>0&&a.toast(i.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:TC.Consts.msgType.INFO});if(d&&0==d.length)for(var v in s)d.push(s[v]);a.on(TC.Consts.event.BEFOREFEATUREINFO,function(){i.parent.responseCallback({coords:e,resolution:r,services:d,featureCount:0})});i.parent.responseCallback({coords:e,resolution:r,services:d,featureCount:0})}})};TC.wrap.control.GeometryFeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then(function(r){TC.wrap.control.Click.prototype.register.call(e,t);var n=e._trigger;e._trigger=function(t){e.hasSuitableLayers().then(function(r){r&&(e.parent._isSearching||t.type!=c||e.parent._isDrawing||e.parent._isSearching||n.call(e,t))})}})};TC.wrap.control.GeometryFeatureInfo.prototype.hasSuitableLayers=function(){const t=this;return new Promise(function(e,r){const n=t.parent.map;var i=!1;n.wrap.getMap().then(function(t){t.getLayers().forEach(function(t){var e=t._wrap.parent;if(t.getSource().getGetFeatureInfoUrl&&n.workLayers.indexOf(e)>=0){i=!0;return!1}});e(i)})})};TC.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(e){var r=this,n=(e=e||{}).xy,i=e.layer,o=e.callback,a=e.geometryType,s=!1;if(r.drawCtrl){r.drawCtrl.setActive(!0);r.drawCtrl.startDrawing_({coordinate:n})}else i.wrap.getLayer().then(function(e){var i;switch(a){case TC.Consts.geom.POLYLINE:i=t.geom.GeometryType.LINE_STRING;break;default:i=t.geom.GeometryType.POLYGON}r.drawCtrl=new t.interaction.Draw({source:e.getSource(),type:i,style:e.getStyle()});var l=function(t){t.parent.showsPopup=!1};e.getSource().on(f,function(t){t.feature._wrap?l(t.feature._wrap):t.feature._wrapPromise.then(l)});r.drawCtrl.handleEvent=function(e){if(e.type==c){var r=i===t.geom.GeometryType.POLYGON?this.sketchCoords_[0]:this.sketchCoords_;s&&2==r.length&&null!==this.sketchFeature_?this.addToDrawing_(e):s=!0}return t.interaction.Draw.prototype.handleEvent.call(this,e)};const u=r.parent.map.wrap.map;u.addInteraction(r.drawCtrl);r.drawCtrl.on("drawstart",function(e){r.parent._isDrawing=!0;u.getInteractions().forEach(function(e,r){e instanceof t.interaction.DoubleClickZoom&&e.setActive(!1)})});r.drawCtrl.startDrawing_({coordinate:n});r.drawCtrl.on("drawend",function(n){r.parent._isDrawing=!1;u.getInteractions().forEach(function(e,r){e instanceof t.interaction.DoubleClickZoom&&e.setActive(!1)});u.removeInteraction(r.drawCtrl);this.setActive(!1);r.drawCtrl=null;e.getSource().clear();r.parent._drawToken=!0;setTimeout(function(){r.parent._drawToken=!1},500);o&&TC.wrap.Feature.createFeature(n.feature,{showsPopup:!1}).then(function(t){o(t)})})})};TC.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(t,e,r){if(this.drawCtrl&&this.parent._isDrawing){this.parent._isDrawing=!1;this.drawCtrl.setActive(!1);this.drawCtrl.source_.clear()}};const X=function(t,e,r){return new Promise(async function(n,i){try{var o=await t.describeFeatureType(e)}catch(t){i(t);return}var a={};if(1===e.length){var s={};s[e[0]]=o;o=s}for(var l in o){let t;var c=[];for(var u in o[l])!TC.Util.isGeometry(o[l][u].type)||o[l][u].nillable||o[l][u].minOccurs||c.push(u);if(c.length<=1){var h=(t,e)=>{if(t instanceof TC.filter.LogicalNary)t.conditions.forEach(t=>{h(t,e)});else if(t instanceof TC.filter.Spatial){t.geometryName=e;return t}};t=Object.assign(new r.constructor,h(r,0===c.length?null:c[0]))}else if(c.length>1){h=((t,e)=>{if(t instanceof TC.filter.LogicalNary)t.conditions.forEach(t=>{h(t,e)});else if(t instanceof TC.filter.Spatial)return TC.filter.or.apply(null,e.reduce((e,r)=>{e.push(new(TC.filter[t.getTagName()])(r,t.geometry,t.srsName));return e},[]))});t=Object.assign(new r.constructor,h(r,c))}a[l]=t}n(a)})};var Z=function(t,e,r,n){const i=[];var o={};const a=function(t){const e=t.mapLayers[0];return t.title||t.mapLayers.reduce(function(t,e){return t||e.title},"")||e.tree&&e.tree.title||e.capabilities.Service.Title},s=t.wrap.map,l=function(){return!n||r!==TC.Consts.mimeType.JSON&&r!==TC.Consts.mimeType.KML?t.getCRS():TC.Consts.SRSDOWNLOAD_GEOJSON_KML},c=function(t,e){return new Promise(function(r){n?r({url:t.url,data:e}):function(t,e){return new Promise(function(r){t.mapLayer.toolProxification.fetch(t.url,{data:e,contentType:"application/xml",type:"POST"}).then(function(t){if(t instanceof XMLDocument){const e=t.querySelector("ExceptionReport Exception");if(e){r({errors:[{key:TC.Consts.WFSErrors.INDETERMINATE,params:{err:e.getAttribute("exceptionCode"),errorThrown:e.querySelector("ExceptionText").textContent}}]});return}}r({response:t})}).catch(function(t){r({errors:[{key:TC.Consts.WFSErrors.INDETERMINATE,params:{err:t.name,errorThrown:t.message}}]})})})}(t,e).then(function(t){if(t.errors&&t.errors.length>0){t.errors[0].params.serviceTitle=service.mapLayers.reduce(function(t,e){return t||e.title},"")||a(service);r(t)}else r(t)})})};s.getLayers().forEach(function(s){var u=s._wrap.parent;if(!s.getVisible()||t.workLayers.indexOf(u)<0||u.type!==TC.Consts.layerType.WMS)return;var h=u.getDisgregatedLayerNames()||u.availableNames;const d=u.url.toLowerCase();var p=o[d];p||(p=o[d]={url:d,layers:[],mapLayers:[u],layerNames:[]});for(var f=0;f<h.length;f++){var g=h[f];if(u.wrap.getInfo(g).queryable){p.layerNames.push(g);var y=u.getPath(g);p.layers.push({name:g,title:y[y.length-1],path:y.slice(1),features:[]})}}if(0!=p.layerNames.length&&void 0===p.request){p.request=p.request||u.getWFSCapabilities();i.push(new Promise(function(t,i){p.request.then(function(i){var s=null,u=[];for(var h in o)o[h].request&&o[h].request==p.request&&(s=o[h]);var d=null,f=s.layerNames;if(f instanceof Array&&f.length)if(void 0!==i.Operations.GetFeature){for(var g=[],y=0;y<f.length;y++){for(var m=f[y];"_"===m[m.length-1];)m=m.substring(0,m.lastIndexOf("_"));if(i.FeatureTypes.hasOwnProperty(m.substring(f[y].indexOf(":")+1)))g.indexOf(m)<0&&g.push(m);else{var C=s.mapLayers[0].getPath(m.substring(f[y].indexOf(":")+1));u.push({key:TC.Consts.WFSErrors.LAYERS_NOT_AVAILABLE,params:{serviceTitle:a(s),layerName:C[C.length-1]}})}}if(0!=g.length){i.Operations.GetFeature.CountDefault&&(d=i.Operations.GetFeature.CountDefault.DefaultValue);if("1.0.0"===i.version&&!i.Operations.GetFeature.Operations.hasOwnProperty("Query")||("2.0.0"===i.version||"1.1.0"===i.version)&&i.Operations.QueryExpressions.indexOf("wfs:Query")<0){u.push({key:TC.Consts.WFSErrors.QUERY_NOT_AVAILABLE,params:{serviceTitle:a(s)}});t({errors:u})}else{h=i.Operations.GetFeature.DCPType?i.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:i.Operations.GetFeature.DCP.HTTP.Post.href;Promise.all([X(s.mapLayers[0],g,e)]).then(function(e){var o,p,f,g=e[0];d?(o=d,p={url:h,mapLayer:s.mapLayers[0]},f=TC.Util.WFSQueryBuilder(g,null,i,r,!0,l()),new Promise(function(t){p.mapLayer.toolProxification.fetchXML(p.url,{data:f,contentType:"application/xml",type:"POST"}).then(function(e){if(e instanceof XMLDocument){const r=e.querySelector("ExceptionReport Exception");if(r){t({errors:[{key:TC.Consts.WFSErrors.INDETERMINATE,params:{err:r.getAttribute("exceptionCode"),errorThrown:r.querySelector("ExceptionText").textContent}}]});return}}var r=parseInt(e.querySelector("FeatureCollection").getAttribute("numberMatched")||e.querySelector("FeatureCollection").getAttribute("numberOfFeatures"),10);isNaN(r)||r>parseInt(o,10)?t({errors:[{key:TC.Consts.WFSErrors.MAX_NUM_FEATURES}]}):t(0!==r?r:{errors:[{key:TC.Consts.WFSErrors.NO_FEATURES}]})}).catch(function(e){t({errors:[{key:TC.Consts.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message}}]})})})).then(function(e){if(e.errors&&e.errors.length>0){switch(e.errors[0].key){case TC.Consts.WFSErrors.INDETERMINATE:e.errors[0].params.serviceTitle=s.mapLayers.reduce(function(t,e){return t||e.title},"")||a(s);break;case TC.Consts.WFSErrors.MAX_NUM_FEATURES:e.errors[0].params={limit:d,serviceTitle:a(s)};break;case TC.Consts.WFSErrors.NO_FEATURES:e.errors[0].params={serviceTitle:a(s)}}t(e)}else c({url:h,mapLayer:s.mapLayers[0]},TC.Util.WFSQueryBuilder(g,null,i,n?r:TC.Consts.mimeType.JSON,!1,l())).then(function(e){t(Object.assign({service:s,errors:u},e))})}):c({url:h,mapLayer:s.mapLayers[0]},TC.Util.WFSQueryBuilder(g,null,i,n?r:TC.Consts.mimeType.JSON,!1,l())).then(function(e){t(Object.assign({service:s,errors:u},e))})}).catch(function(e){t({errors:[{key:TC.Consts.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message,serviceTitle:a(s)}}]})})}}else{u.push({key:TC.Consts.WFSErrors.NO_VALID_LAYERS,params:{serviceTitle:a(s)}});t({errors:u})}}else{u.push({key:TC.Consts.WFSErrors.GETFEATURE_NOT_AVAILABLE,params:{serviceTitle:a(s)}});t({errors:u})}},function(e){var r=null;for(var n in o)o[n].request&&o[n].request===p.request&&(r=o[n]);t({errors:[{key:TC.Consts.WFSErrors.GETCAPABILITIES,params:{err:e.name,serviceTitle:a(r)}}]})})}))}});return i};TC.WFSGetFeatureBuilder=Z;var J=function(e,r,n){var i,o=n;o&&o.indexOf(";")>-1&&(o=o.substr(0,o.indexOf(";")).trim());o||(o=r.requestedFormat);switch(o){case"application/json":i=new t.format.GeoJSON;break;case"application/vnd.ogc.gml":i=r.responseText.indexOf("FeatureCollection")>-1?new t.format.WFS({gmlFormat:new t.format.GML2({srsName:e.crs})}):new t.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":i=new t.format.GML3({srsName:e.crs});break;case"text/xml":case"application/xml":const n=r.querySelector("ServiceException");n&&TC.error(n);i=null;break;default:i=null}return i?i.readFeatures(r,{featureProjection:t.proj.get(e.crs)}):null},Q=function(e,r){for(var n=[],i=[],o=function(t,e,r){var n=!1;if(e===r||0===e.indexOf(r))n=!0;else{var i=t.getPath(e),o=t.getPath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(i[a]!==o[a]){n=!1;break}}}return n},a={},s=0;s<e.length;s++){var l=e[s];if(l instanceof t.Feature){for(var c=l.getId()||TC.getUID(),u=!1,h=c.substr(0,c.lastIndexOf(".")),d=0;d<r.layers.length;d++){var p=r.layers[d],f=p.name.substr(p.name.indexOf(":")+1);if(r.mapLayers.some(function(t){return o(t,f,h)})){u=!0;n.push(TC.wrap.Feature.createFeature(l));i[l.id_]=p.features;break}}if(!u){var g;if(a[h])g=a[h];else{g={name:h,title:h,features:[]};a[h]=g;r.layers.push(g)}n.push(TC.wrap.Feature.createFeature(l));i.push(l.id_)}}}return new Promise(function(t,e){Promise.all(n).then(function(e){e.forEach(function(t){t.attributes=[];for(var e in t.data){var r=t.data[e];t.attributes.push({name:e,value:r})}i[t.id].push(t)});t({service:r})})})};TC.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(e,r){var n=this,i=n.parent.map;n.parent.filterFeature=e;e.layer=n.parent.filterLayer;i.wrap.getMap().then(function(o){var a=e.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!r){for(var c=null,u=1,h=l.length;u<h;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);r=o.getPixelFromCoordinate(new t.geom.Point(c).getCoordinates())}n.parent.beforeRequest({xy:r});var d=Z(i,new TC.filter.intersects(e,i.crs),TC.Consts.format.JSON);const p=[];Promise.all(d).then(function(t){for(var e=[],o=0,a=0;a<t.length;a++){const r=t[a];if(r){p[p.length]=new Promise(function(t,e){if(r.errors&&r.errors.length){for(var o=0;o<r.errors.length;o++){var a,s=TC.Consts.msgType.WARNING;!0;var l=r.errors[o];switch(l.key){case TC.Consts.WFSErrors.MAX_NUM_FEATURES:a=n.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case TC.Consts.WFSErrors.GETCAPABILITIES:a=n.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case TC.Consts.WFSErrors.NO_FEATURES:!1;continue;case TC.Consts.WFSErrors.INDETERMINATE:a=n.parent.getLocaleString("wfs.IndeterminateError");TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:l.params.err,descripcion:l.params.errorThrown,serviceName:l.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);s=TC.Consts.msgType.ERROR;break;default:a=n.parent.getLocaleString("wfsGFI."+l.key,l.params)}i.toast(a,{type:s})}r.response||t()}});var s=r.response?J(i,r.response.responseText,r.response.contentType):[];p[p.length-1]=Q(s,r.service);r.service&&e.push(r.service);o+=s.length}}Promise.all(p).then(function(){n.parent.responseCallback({xy:r||null,services:e,featureCount:o})})},function(t){n.parent.responseCallback({})})})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.Consts.event.PANANIMATIONSTART="pananimationstart.tc";TC.Consts.event.PANANIMATIONEND="pananimationend.tc";TC.wrap.control.Popup.prototype.fitToView=function(){var e=this,r=e.parent.map,n=e.parent.map.wrap.map,i=e.parent.popupDiv.getBoundingClientRect(),o=r.div.getBoundingClientRect(),a=n.getCoordinateFromPixel([i.left-o.left,i.top-o.top]),s=n.getCoordinateFromPixel([i.right-o.left,i.bottom-o.top]),l=a[0],c=a[1],u=s[0],h=[l,s[1],u,c],d=r.getExtent();if(!t.extent.containsExtent(d,h)){var p={left:Math.max(d[0]-h[0],0),bottom:Math.max(d[1]-h[1],0),right:Math.max(h[2]-d[2],0),top:Math.max(h[3]-d[3],0)};if(e.parent.dragged){var f=e.popup.getPosition();p.right?f[0]=f[0]-p.right:p.left&&(f[0]=f[0]+p.left);p.top?f[1]=f[1]-p.top:p.bottom&&(f[1]=f[1]+p.bottom);var g=n.getPixelFromCoordinate(f);g[1]=n.getSize()[1]-g[1];e.parent._previousContainerPosition=g;(e.popup._oldUpdatePixelPosition||e.popup.updatePixelPosition).call(e.popup,f)}else if(e.parent.isVisible()){var y=n.getView(),m=y.getCenter().slice();p.top?m[1]+=p.top:p.bottom&&(m[1]-=p.bottom);p.right?m[0]+=p.right:p.left&&(m[0]-=p.left);y.animate({center:m,easing:function(t){0===t&&e.parent.map.trigger(TC.Consts.event.PANANIMATIONSTART);1===t&&e.parent.map.trigger(TC.Consts.event.PANANIMATIONEND);return t}})}}};TC.wrap.control.Popup.prototype.setDragged=function(e){var r=this.popup;if(e){if(!r._oldUpdatePixelPosition){r._oldUpdatePixelPosition=r.updatePixelPosition;r.updatePixelPosition=function(){}}if(!r._newHandleOffsetChanged){r._newHandleOffsetChanged=function(){this._oldUpdatePixelPosition()};t.events.unlisten(r,t.Object.getChangeEventType("offset"),r.handleOffsetChanged,r);t.events.listen(r,t.Object.getChangeEventType("offset"),r._newHandleOffsetChanged,r)}}else{const e=r.getElement().parentElement.style;e.setProperty("top",r.rendered.top_);e.setProperty("bottom",r.rendered.bottom_);e.setProperty("left",r.rendered.left_);e.setProperty("right",r.rendered.right_);delete this.parent._previousContainerPosition;if(r._oldUpdatePixelPosition){r.updatePixelPosition=r._oldUpdatePixelPosition;delete r._oldUpdatePixelPosition}if(r._newHandleOffsetChanged){t.events.unlisten(r,t.Object.getChangeEventType("offset"),r._newHandleOffsetChanged,r);t.events.listen(r,t.Object.getChangeEventType("offset"),r.handleOffsetChanged,r);delete r._newHandleOffsetChanged}}};TC.wrap.Feature.prototype.getLegend=function(){var e={},r=nt(this.feature,!0);if(r){var n=r.getImage();if(n){if(n instanceof t.style.Icon){e.src=n.getSrc();var i=n.getScale();if(i){e.scale=i;var o=n.getImage();if(o.width){e.width=o.width*i;e.height=o.height*i}}}else n instanceof t.style.Circle&&(e.src=n.canvas_.toDataURL());if(this.parent.options.radius)e.height=e.width=2*this.parent.options.radius;else{e.width=e.width||this.parent.options.width;e.height=e.height||this.parent.options.height}}else{var a=r.getStroke(),s=r.getFill();if(a){var l=a.getColor();l&&(e.strokeColor=t.color.asString(l));var c=a.getWidth();c&&(e.strokeWidth=c)}if(s){var u=s.getColor();u&&(e.fillColor=t.color.asString(u))}}}return e};var tt=function(e){const r=new t.Feature;e&&r.setGeometryName(e);return r};TC.wrap.Feature.prototype.createPoint=function(t,e){const r=this;r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{point:e}},r.feature));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createMarker=function(t,e){const r=this;var n=TC.Util.getPointIconUrl(e);if(n){e.url=n;r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{marker:e}},r.feature));r.setData(r.parent.data)}else r.createPoint(t,e)};TC.wrap.Feature.prototype.createPolyline=function(t,e){const r=this;r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{line:e}},r.feature));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createPolygon=function(t,e){const r=this;e=e||{};r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{polygon:e}},r.feature));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createMultiPolyline=function(t,e){const r=this;r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{line:e}},r.feature));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createMultiPolygon=function(t,e){const r=this;e=e||{};r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);TC.Util.hasStyleOptions(e)&&r.feature.setStyle(F({styles:{polygon:e}},r.feature));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createCircle=function(e,r){const n=this;n.feature=tt(r.geometryName);n.feature._wrap=n;n.parent.setCoords(e);r&&n.feature.setStyle(new t.style.Style({stroke:new t.style.Stroke({color:r.strokeColor,width:r.strokeWidth,lineDash:r.lineDash}),fill:new t.style.Fill({color:b(r.fillColor,r.fillOpacity)})}));n.setData(n.parent.data)};TC.wrap.Feature.createFeature=function(e,r){e._featurePromise||(e._featurePromise=new Promise(function(n,i){var o=e.getGeometry();(r=r||{}).id=e.getId();let a,s=e.getStyle();s&&TC.Util.extend(r,j(s,e));switch(!0){case o instanceof t.geom.Point:TC.Util.isFunction(s)&&(s=s(e));for(var l=s?Array.isArray(s)?s:[s]:[],c=0,u=l.length;c<u;c++)if((s=l[c]).getImage()instanceof t.style.Icon){a="Marker";break}a=a||"Point";break;case o instanceof t.geom.LineString:a="Polyline";break;case o instanceof t.geom.Polygon:a="Polygon";break;case o instanceof t.geom.MultiLineString:a="MultiPolyline";break;case o instanceof t.geom.MultiPolygon:a="MultiPolygon"}a?TC.loadJS(!TC.feature||!TC.feature[a],[TC.apiLocation+"TC/feature/"+a],function(){const t=new TC.feature[a](e,r);t.data=t.wrap.getData();n(t)}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){var t=new TC.Feature(e,r);t.data=t.wrap.getData();n(t)})}));return e._featurePromise};TC.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()};TC.wrap.Feature.prototype.getStyle=function(){var e={},r=this.feature.getStyle();TC.Util.isFunction(r)&&(r=r(this.feature));var n=r?Array.isArray(r)?r:[r]:[];const i=function(t,e){if(t){const r=t.getFill();if(r){e.fillColor=r.getColor();Array.isArray(e.fillColor)&&(e.fillOpacity=e.fillColor[3])}}},o=function(t,e){if(t){const r=t.getStroke();if(r){e.strokeColor=r.getColor();e.strokeWidth=r.getWidth()}}};for(var a=0,s=n.length;a<s;a++){i(r=n[a],e);o(r,e);const s=r.getImage();if(s instanceof t.style.Icon){e.url=s.getSrc();const t=s.getSize(),r=s.getScale()||1;if(t){e.width=t[0]*r;e.height=t[1]*r}var l=s.getAnchor();if(l){e.anchor=[l[0]*r,l[1]*r];if(t){e.anchor[0]=e.anchor[0]/e.width;e.anchor[1]=e.anchor[1]/e.height}}}else{i(s,e);o(s,e)}var c=r.getText();if(c){e.label=c.getText();var u=c.getFont();u&&(e.fontSize=parseInt(u.match(/\d+pt/))||.75*parseInt(u.match(/\d+px/)));var h=c.getRotation();h&&(e.angle=-180*h/Math.PI);e.labelOffset=[c.getOffsetX(),c.getOffsetY()];fill=c.getFill();fill&&(e.fontColor=fill.getColor());stroke=c.getStroke();if(stroke){e.labelOutlineColor=stroke.getColor();e.labelOutlineWidth=stroke.getWidth()}}}TC.Util.extend(this.parent.options,e);return e};TC.wrap.Feature.prototype.getGeometry=function(){var e;if(this.feature&&this.feature.getGeometry){var r=this.feature.getGeometry();r&&(r.getCoordinates?e=r.getCoordinates():r instanceof t.geom.Circle&&(e=[r.getCenter(),r.getRadius()]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){const r=this;if(r.feature&&r.feature.getGeometry){var n,i,o,a,s,l,c,u,h=r.feature.getGeometry();switch(!0){case TC.feature.MultiPolygon&&r.parent instanceof TC.feature.MultiPolygon:l=!0;n=t.geom.MultiPolygon;s=e;Array.isArray(s)&&(a=e[0]);case TC.feature.Polygon&&r.parent instanceof TC.feature.Polygon||TC.feature.MultiPolyline&&r.parent instanceof TC.feature.MultiPolyline:c=!0;n=n||(TC.feature.Polygon&&r.parent instanceof TC.feature.Polygon?t.geom.Polygon:t.geom.MultiLineString);a=l?a:e;Array.isArray(a)&&(o=a[0]);case TC.feature.Polyline&&r.parent instanceof TC.feature.Polyline:u=!0;n=n||t.geom.LineString;o=c?o:e;Array.isArray(o)&&(i=o[0]);case TC.feature.Point&&r.parent instanceof TC.feature.Point:n=n||t.geom.Point;i=u?i:e;if(Array.isArray(i)&&"number"==typeof i[0]&&"number"==typeof i[1]){switch(i.length){case 3:d=t.geom.GeometryLayout.XYZ;break;case 4:d=t.geom.GeometryLayout.XYZM;break;default:d=t.geom.GeometryLayout.XY}if(h)h.setCoordinates(e,d);else{h=new n(e,d);r.feature.setGeometry(h)}}break;case TC.feature.Circle&&r.parent instanceof TC.feature.Circle:if(Array.isArray(e)&&Array.isArray(e[0])&&"number"==typeof e[0][0]&&"number"==typeof e[0][1]&&"number"==typeof e[1]){var d;switch(e[0].length){case 3:d=t.geom.GeometryLayout.XYZ;break;case 4:d=t.geom.GeometryLayout.XYZM;break;default:d=t.geom.GeometryLayout.XY}if(h)h.setCenterAndRadius(e[0],e[1],d);else{h=new t.geom.Circle(e[0],e[1],d);r.feature.setGeometry(h)}}}}};TC.wrap.Feature.prototype.getId=function(){var t;this.feature&&(t=this.feature.getId());return t};TC.wrap.Feature.prototype.setId=function(t){this.feature&&this.feature.setId(t)};const et=function(e,r){const n=this;var i=0;e.getLinearRings().forEach(function(e){coordinates=e.getCoordinates();r.crs&&(coordinates=TC.Util.reproject(coordinates,n.parent.layer.map.crs,r.crs));const o=new t.geom.Polygon([coordinates]).getLinearRing(0);i+=t.geom.flat.linearRingLength(o.flatCoordinates,0,o.flatCoordinates.length,o.stride)});return i},rt=function(e,r){const n=this;coordinates=e.getCoordinates();r.crs&&(coordinates=TC.Util.reproject(coordinates,n.parent.layer.map.crs,r.crs));return new t.geom.LineString(coordinates).getLength()};TC.wrap.Feature.prototype.getLength=function(e){const r=this;e=e||{};var n=0;const i=r.feature.getGeometry();switch(!0){case i instanceof t.geom.Polygon:n=et.call(r,i,e);break;case i instanceof t.geom.LineString:n=rt.call(r,i,e);break;case i instanceof t.geom.MultiPolygon:i.getPolygons().forEach(function(t){n+=et.call(r,t,e)});break;case i instanceof t.geom.MultiPolygon:i.getLineStrings().forEach(function(t){n+=rt.call(r,t,e)})}return n};TC.wrap.Feature.prototype.getArea=function(e){const r=this;e=e||{};const n=r.feature.getGeometry();var i;if(n instanceof t.geom.Polygon){i=n.getLinearRing(0).getCoordinates();e.crs&&(i=TC.Util.reproject(i,r.parent.layer.map.crs,e.crs));return new t.geom.Polygon([i]).getArea()}};const nt=function(e,r){var n=e.getStyle();TC.Util.isFunction(n)&&(n=n(e));Array.isArray(n)&&(n=n.reduce(function(t,e){t.fill_=e.fill_||t.fill_;t.image_=e.image_||t.image_;t.stroke_=e.stroke_||t.stroke_;t.text_=e.text_||t.text_;return t},new t.style.Style));if(!n&&!r){n=new t.style.Style;e.setStyle(n)}return n};TC.wrap.Feature.prototype.setStyle=function(e){const r=this.feature;if(null===e){r.setStyle(null);return}const n=this.parent,i=r.getGeometry();let o,a=r.getStyle();n.layer&&(o=function(e){var r=this.getStyle();TC.Util.isFunction(r)&&(r=r(e));Array.isArray(r)&&(r=r[r.length-1]);r||(r=new t.style.Style);return r}.call(n.layer.wrap.layer,n.wrap.feature));a||(a=o?o.clone():new t.style.Style);TC.Util.isFunction(a)&&(a=a(r));Array.isArray(a)||(a=[a]);let s=a[a.length-1];if(i instanceof t.geom.Point||i instanceof t.geom.MultiPoint){var l;if(e.anchor||e.url||e.cssClass){l=s.getImage();const r={};if(l instanceof t.style.Icon){r.src=e.url||TC.Util.getBackgroundUrlFromCss(e.cssClass)||l.getSrc();e.width&&e.height?r.size=[D(e.width,n),D(e.height,n)]:r.size=l.getSize();r.anchor=D(e.anchor,n);if(!r.anchor){const t=l.getAnchor();Array.isArray(t)&&(r.anchor=t.map(function(t,e){return t/r.size[e]}))}}else{r.src=TC.Util.getPointIconUrl(e);r.anchor=D(e.anchor,n);r.size=[D(e.width,n),D(e.height,n)]}e.angle&&(r.angle=e.angle);l=new t.style.Icon(r)}else if(!s.getImage()&&s.getText())void 0!==e.label&&e.label.length?s.setText(B(e,n)):s.setText();else{(l=s.getImage())||(l=new t.style.Circle);const r={radius:D(e.radius,n)||(D(e.height,n)+D(e.width,n))/4};isNaN(r.radius)&&(r.radius=l.getRadius());e.fillColor?r.fill=new t.style.Fill({color:b(D(e.fillColor,n),D(e.fillOpacity,n))}):r.fill=l.getFill();r.stroke=l.getStroke();const i=o&&o.getStroke();if(e.strokeColor||e.strokeWidth){r.stroke||(r.stroke=new t.style.Stroke);if(e.strokeColor)r.stroke.setColor(D(e.strokeColor,n));else{const t=r.stroke.getColor()||i&&i.getColor()||TC.Cfg.styles.point.strokeColor;r.stroke.setColor(D(t,n))}if(e.strokeWidth)r.stroke.setWidth(D(e.strokeWidth,n));else{const t=r.stroke.getWidth()||i&&i.getWidth()||TC.Cfg.styles.point.strokeWidth;r.stroke.setWidth(D(t,n))}}l=new t.style.Circle(r)}s.setImage(l)}else{var c=s.getStroke(),u=!1;c||(c=new t.style.Stroke);if(e.strokeColor){c.setColor(D(e.strokeColor,n));u=!0}if(e.strokeWidth){c.setWidth(D(e.strokeWidth,n));u=!0}if(e.lineDash){c.setLineDash(e.lineDash);u=!0}u&&s.setStroke(c);if((i instanceof t.geom.Polygon||i instanceof t.geom.MultiPolygon)&&(e.fillColor||e.fillOpacity)){var h=s.getFill()||new t.style.Fill;h.setColor(b(D(e.fillColor,n),D(e.fillOpacity,n)));s.setFill(h)}}void 0!==e.label&&(e.label.length?s.setText(B(e,n)):s.setText());r.setStyle(a);r.changed()};TC.wrap.Feature.prototype.toggleSelectedStyle=function(t){const e=this.feature;(void 0===t?!e._originalStyle:t)?st(e):lt(e)};TC.wrap.Feature.prototype.getInnerPoint=function(e){var r,n=e||{},i=this.feature.getGeometry();const o=function(t){const e=n.clipBox;t[0]=Math.min(Math.max(t[0],e[0]),e[2]);t[1]=Math.min(Math.max(t[1],e[1]),e[3])};r=i.getFirstCoordinate();switch(i.getType()){case t.geom.GeometryType.MULTI_POLYGON:var a=0;i=i.getPolygons().reduce(function(t,e){const r=e.getArea(),n=r>a?e:t;a=r;return n});case t.geom.GeometryType.POLYGON:var s=function(t,e){for(var r=!1,n=0,i=e.length-1;n<e.length;i=n++){var o=e[n][0],a=e[n][1],s=e[i][0],l=e[i][1];a>t[1]!=l>t[1]&&t[0]<(s-o)*(t[1]-a)/(l-a)+o&&(r=!r)}return r},l=i.getCoordinates();p=l,n.clipBox&&p[0].forEach(o);r=(i=new t.geom.Polygon(l)).getInteriorPoint().getCoordinates();for(var c=i.getLinearRings(),u=1;u<c.length;u++)if(s(r,c[u].getCoordinates())){r=i.getClosestPoint(r);break}break;case t.geom.GeometryType.MULTI_LINE_STRING:var h=0;i=i.getLineStrings().reduce(function(t,e){const r=e.getLength(),n=r>h?e:t;h=r;return n});case t.geom.GeometryType.LINE_STRING:var d=[0,0];!function(t){const e=n.clipBox;if(e)for(var r=t.length-1;r>=0;r--){const n=t[r],i=n[0],o=n[1];(i<e[0]||i>e[2]||o<e[1]||o>e[3])&&t.splice(r,1)}}(l=i.getCoordinates());i=new t.geom.LineString(l);for(u=0;u<l.length;u++){d[0]+=l[u][0];d[1]+=l[u][1]}d[0]/=l.length;d[1]/=l.length;r=i.getClosestPoint(d)}var p;return r};TC.wrap.Feature.prototype.showPopup=function(e){var r=e.map;if(r){var n=this.feature;if(n){r.currentFeature=this.parent;var i=r.getExtent();this._innerCentroid=this.getInnerPoint({clipBox:i});e.contentDiv.innerHTML=this.parent.getInfo({locale:r.options.locale});e.menuDiv.innerHTML="";if(e.options.closeButton||void 0===e.options.closeButton){const t=document.createElement("div");t.classList.add(e.CLASS+"-close");t.setAttribute("title",e.getLocaleString("close"));e.menuDiv.appendChild(t);t.addEventListener(TC.Consts.event.CLICK,function(){e.hide()});e.contentDiv.classList.add(e.CLASS+"-has-btn");const r=e.contentDiv.querySelector(".tc-ctl-finfo");if(r){r.width="auto";r.height="auto"}}var o,a=this.parent.options;if(TC.Util.isEmptyObject(a)&&this.parent.layer&&this.parent.layer.options&&this.parent.layer.options.styles)switch(this.parent.CLASSNAME){case"TC.feature.Point":(a=this.parent.layer.options.styles.point)&&!TC.Util.isEmptyObject(a)||(a=this.parent.layer.options.styles.marker);break;case"TC.feature.Marker":a=this.parent.layer.options.styles.marker;break;case"TC.feature.Circle":a=this.parent.layer.options.styles.circle;break;case"TC.feature.MultiPolygon":case"TC.feature.Polygon":a=this.parent.layer.options.styles.polygon;break;case"TC.feature.MultiPolyline":case"TC.feature.Polyline":a=this.parent.layer.options.styles.line}if(a.anchor)o=D(a.anchor,this.parent);else{for(var s,l=n._wrap.parent,c=0;c<r.workLayers.length;c++){var u=r.workLayers[c];if(!u.isRaster()&&u.features.indexOf(l)>=0){s=u.wrap.styleFunction(n);break}}if(Array.isArray(s)){const e=s[0].getImage();o=!e||e instanceof t.style.Icon?[.5,0]:[.5,.5]}}const d=[0,0];if(o)if(a.height)d[1]=-(D(a.height,this.parent)||0)*o[1];else{var h=nt(n,!0);if(h){const e=h.getImage();if(e instanceof t.style.Icon){const t=e.getImageSize();t&&(d[1]=t[1]*-e.getScale())}}}e.wrap.setDragged(!1);e.wrap.popup.setOffset(d);e.wrap.popup.setPosition(this._innerCentroid);e.popupDiv.classList.add(TC.Consts.classes.VISIBLE)}else r.wrap.hidePopup(e)}};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof t.Feature};TC.wrap.Feature.prototype.getPath=function(){var t=[];this.feature&&this.feature._folders&&(t=this.feature._folders);return t};TC.wrap.Feature.prototype.getBounds=function(){var t=null;if(this.feature){const e=this.feature.getGeometry();if(!e)return null;t=e.getExtent()}return t};TC.wrap.Feature.prototype.getTemplate=function(){var t=null,e=this.feature.getStyle();TC.Util.isFunction(e)&&(e=e(this.feature));if(Array.isArray(e))for(var r=0;r<e.length;r++)if(e[r]._balloon){if(e[r]._balloon.getText()){e=e[r]._balloon;break}}e&&!Array.isArray(e)&&e.getText&&(t=e.getText());return t};TC.wrap.Feature.prototype.getData=function(){var t=this.feature.getProperties();Array.isArray(t.features)&&(t=1===t.features.length?t.features[0].getProperties():t.features.length+" elementos");var e=this.feature.getGeometryName();t[e]&&delete t[e];return t};TC.wrap.Feature.prototype.setData=function(t){this.feature.setProperties(t)};TC.wrap.Feature.prototype.unsetData=function(t){this.feature.unset(t)};TC.wrap.Feature.prototype.clearData=function(){const t=this.feature,e=t.getGeometryName();t.getKeys().forEach(function(r){r!==e&&t.unset(r)})};TC.wrap.control.Draw.prototype.mouseMoveHandler=function(t){const e=this;e.sketch&&e.parent.trigger(TC.Consts.event.MEASUREPARTIAL,e.getMeasureData())};TC.wrap.control.Draw.prototype.mouseOverHandler=function(t){const e=this;if(e.sketch&&e.hoverCoordinate){e.pushCoordinate(e.hoverCoordinate);e.hoverCoordinate=null}};TC.wrap.control.Draw.prototype.clickHandler=function(t){const e=this;if(e.parent.map.view!==TC.Consts.view.PRINTING){if(e._mdPx){const r=e._mdPx[0]-t.clientX,n=e._mdPx[1]-t.clientY;if(r*r+n*n>e.interaction.squaredClickTolerance_)return}if(e.sketch){var r=e.sketch.getGeometry().getCoordinates();e.parent.trigger(TC.Consts.event.POINT,{point:r[r.length-1]})}}};TC.wrap.control.Draw.prototype.mousedownHandler=function(t){this._mdPx=[t.clientX,t.clientY]};TC.wrap.control.Draw.prototype.getMeasureData=function(){var e=this,r={units:t.proj.Units.METERS};if(this.sketch){var n=this.sketch.getGeometry();n instanceof t.geom.Polygon?function(r,n){r=new t.geom.Polygon([TC.Util.reproject(r.getLinearRing(0).getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs)]);n.area=r.getArea();var i=r.getLinearRing(0);n.perimeter=t.geom.flat.linearRingLength(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)}(n,r):n instanceof t.geom.LineString&&function(r,n){r=new t.geom.LineString(TC.Util.reproject(r.getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs));n.length=r.getLength()}(n,r)}return r};TC.wrap.control.Draw.prototype.activate=function(e){var r,n=this;switch(e){case TC.Consts.geom.POLYGON:r=t.geom.GeometryType.POLYGON;break;case TC.Consts.geom.MULTIPOLYGON:r=t.geom.GeometryType.MULTI_POLYGON;break;case TC.Consts.geom.POINT:r=t.geom.GeometryType.POINT;break;case TC.Consts.geom.MULTIPOINT:r=t.geom.GeometryType.MULTI_POINT;break;case TC.Consts.geom.MULTIPOLYLINE:r=t.geom.GeometryType.MULTI_LINE_STRING;break;default:r=t.geom.GeometryType.LINE_STRING}n.parent.map&&Promise.all([n.parent.map.wrap.getMap(),n.parent.getLayer()]).then(function(i){const o=i[0],a=i[1];a&&a.wrap.getLayer().then(function(i){n.viewport||(n.viewport=o.getViewport());if(n.interaction){o.removeInteraction(n.interaction);if(n._mousedownHandler){n.viewport.removeEventListener("mousedown",n._mousedownHandler);n._mousedownHandler=null}if(n._clickHandler){n.viewport.removeEventListener(TC.Consts.event.CLICK,n._clickHandler);n._clickHandler=null}if(n._mouseMoveHandler&&n._mouseOverHandler){n.viewport.removeEventListener("mousemove",n._mouseMoveHandler);n.viewport.removeEventListener("mouseover",n._mouseOverHandler)}}n.snapInteraction&&o.removeInteraction(n.snapInteraction);if(e){n._mousedownHandler=n.mousedownHandler.bind(n);n._clickHandler=n.clickHandler.bind(n);n.viewport.addEventListener("mousedown",n._mousedownHandler);n.viewport.addEventListener(TC.Consts.event.CLICK,n._clickHandler);if(n.parent.measure){n._mouseMoveHandler=n.mouseMoveHandler.bind(n);n._mouseOverHandler=n.mouseOverHandler.bind(n);n.viewport.addEventListener("mousemove",n._mouseMoveHandler);n.viewport.addEventListener("mouseover",n._mouseOverHandler)}var a={type:r,snapTolerance:0,condition:function(){t.events.condition.shiftKeyOnly(arguments[0])&&(hole=o.forEachFeatureAtPixel(o.getPixelFromCoordinate(arguments[0].coordinate),function(e){return t.geom.GeometryType.POLYGON==e.getGeometry().getType()||t.geom.GeometryType.MULTI_POLYGON==e.getGeometry().getType()?e:null},{hitTolerance:T}));return n.parent.map.view!==TC.Consts.view.PRINTING||null}};i&&(a.source=i.getSource());const l=n.parent.styles||{};switch(e){case TC.Consts.geom.RECTANGLE:a.style=F({styles:{line:n.parent.styles.line}});a.type=t.geom.GeometryType.LINE_STRING;a.maxPoints=2;a.geometryFunction=function(e,r){const n=e[0],i=e[1],o=[[n,[n[0],i[1]],i,[i[0],n[1]],n]];r?r.setCoordinates(o):r=new t.geom.Polygon(o);return r};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:l.polygon&&(a.style=F({styles:{polygon:l.polygon}}));break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:l.point&&(a.style=F({styles:{point:l.point}}));break;case TC.Consts.geom.MULTIPOLYLINE:default:l.line&&(a.style=F({styles:{line:l.line}}))}n.interaction=new t.interaction.Draw(a);n.interaction.on("drawstart",function(t){n.sketch=t.feature;n.parent.trigger(TC.Consts.event.DRAWSTART)},this);n.interaction.on("drawend",function(t){const e=t.target.overlay_.getStyle();t.feature.setStyle(Array.isArray(e)?e.map(function(t){return t.clone()}):e);n.parent.measure&&n.parent.trigger(TC.Consts.event.MEASURE,n.getMeasureData());TC.wrap.Feature.createFeature(n.sketch).then(function(t){n.parent.trigger(TC.Consts.event.DRAWEND,{feature:t});n.sketch=null})},this);n._projectionChangeHandler=function(e){!function(e,r){if(e.sketch){const i=r.oldValue.getProjection(),o=r.target.get(r.key).getProjection();if(i.getCode()!==o.getCode()){const r=e.sketch.getGeometry();r.transform(i,o);e.interaction.sketchPoint_.getGeometry().transform(i,o);const a=[];var n;n="Polygon"===e.interaction.getMode()?e.interaction.sketchCoords_[0]:e.interaction.sketchCoords_;t.geom.flat.deflateCoordinates(a,0,n,r.stride);t.proj.getTransform(i,o)(a,a,r.stride);n=t.geom.flat.inflateCoordinates(a,0,a.length,r.stride);"Polygon"===e.interaction.getMode()?e.interaction.sketchCoords_=[n]:e.interaction.sketchCoords_=n}}}(n,e)};o.on("change:view",n._projectionChangeHandler);o.addInteraction(n.interaction);if(n.parent.snapping){var s={};i?s.source=i.getSource():n.parent.snapping instanceof TC.Layer&&(s.source=n.parent.snapping.wrap.layer.getSource());n.snapInteraction=new t.interaction.Snap(s);o.addInteraction(n.snapInteraction)}}n.redoStack=[]})})};TC.wrap.control.Draw.prototype.deactivate=function(){var t=this;t.parent.map&&Promise.all([t.parent.map.wrap.getMap(),t.parent.getLayer()]).then(function(e){const r=e[0],n=e[1];if(t.viewport){if(t._mousedownHandler){t.viewport.removeEventListener("mousedown",t._mousedownHandler);t._mousedownHandler=null}if(t._clickHandler){t.viewport.removeEventListener(TC.Consts.event.CLICK,t._clickHandler);t._clickHandler=null}}n&&!t.parent.persistent&&n.clearFeatures();if(t.interaction){r.removeInteraction(t.interaction);t.interaction=null}r.un("change:view",t._projectionChangeHandler)})};TC.wrap.control.Draw.prototype.popCoordinate=function(){var e=null;if(this.interaction){var r=this.interaction.sketchFeature_;if(r){var n,i=r.getGeometry();i instanceof t.geom.Polygon?n=i.getCoordinates()[0]:i instanceof t.geom.LineString&&(n=i.getCoordinates());if(n.length>1){var o;i instanceof t.geom.Polygon?o=this.interaction.sketchCoords_[0]:i instanceof t.geom.LineString&&(o=this.interaction.sketchCoords_);var a,s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<n.length;c++)if(n[c][0]==l[0]&&n[c][1]==l[1]){s=!0;break}e=o[a=s?o.length-2:o.length-1];o.splice(a,1);if(i instanceof t.geom.Polygon){i.setCoordinates([o]);this.interaction.sketchLine_.getGeometry().setCoordinates(o)}else i.setCoordinates(o);r.setGeometry(i)}}}return e};TC.wrap.control.Draw.prototype.pushCoordinate=function(e){var r=!1;if(this.interaction){var n=this.interaction.sketchFeature_;if(n){var i,o=n.getGeometry();o instanceof t.geom.Polygon?i=o.getCoordinates()[0]:o instanceof t.geom.LineString&&(i=o.getCoordinates());var a;o instanceof t.geom.Polygon?a=this.interaction.sketchCoords_[0]:o instanceof t.geom.LineString&&(a=this.interaction.sketchCoords_);var s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<i.length;c++)if(i[c][0]==l[0]&&i[c][1]==l[1]){s=!0;break}index=s?a.length-1:a.length;a.splice(index,0,e);if(o instanceof t.geom.LineString)o.setCoordinates(a,t.geom.GeometryLayout.XY);else{o.setCoordinates([a],t.geom.GeometryLayout.XY);this.interaction.sketchLine_.getGeometry().setCoordinates(a)}r=!0}}return r};TC.wrap.control.Draw.prototype.undo=function(){var t=!1,e=this.popCoordinate();if(e){this.redoStack.push(e);t=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return t};TC.wrap.control.Draw.prototype.redo=function(){var t=!1;if(this.redoStack.length>0){this.pushCoordinate(this.redoStack.pop());t=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return t};TC.wrap.control.Draw.prototype.end=function(){this.interaction&&this.interaction.sketchFeature_&&this.interaction.finishDrawing()};TC.wrap.control.Draw.prototype.setStyle=function(t){const e=this;e.interaction&&e.interaction.overlay_.setStyle(F({styles:t}))};TC.wrap.control.CacheBuilder.prototype.getRequestSchemas=function(t){for(var e=t.extent,r=t.layers,n=new Array(r.length),i=0,o=n.length;i<o;i++){var a=r[i],s={layerId:a.id},l=a.wrap.layer.getSource();l.getUrls&&(s.url=l.getUrls()[0]);if(l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),h=c.getMatrixIds(),d=a.getLayerNodeByName(a.layerNames),p=null,f=0,g=d.TileMatrixSetLink.length;f<g;f++){var y=d.TileMatrixSetLink[f];if(y.TileMatrixSet===a.matrixSet){p=y.TileMatrixSetLimits;break}}s.tileMatrixLimits=[];f=0;for(var m=u.length;f<m;f++){var C=c.getOrigin(f),v=c.getTileSize(f),T=u[f],_=v*T,S={mId:h[f],res:T,origin:C,tSize:v,cl:Math.floor((e[0]-C[0])/_),cr:Math.floor((e[2]-C[0])/_),rt:Math.floor((C[1]-e[3])/_),rb:Math.floor((C[1]-e[1])/_)};if(p){var E=p[f];if(E){S.cl=Math.max(S.cl,E.MinTileCol);S.cr=Math.min(S.cr,E.MaxTileCol);S.rt=Math.max(S.rt,E.MinTileRow);S.rb=Math.min(S.rb,E.MaxTileRow)}}S.cl<=S.cr&&S.rt<=S.rb&&s.tileMatrixLimits.push(S)}}n[i]=s}return n};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(t){var e="",r=t.wrap.layer.getSource();r.getUrls&&(e=r.getUrls()[0]);if(t.options.encoding!==TC.Consts.WMTSEncoding.RESTFUL){e.indexOf("?")<0&&(e+="?");e.indexOf("?")===e.length-1&&(e=e+"layer="+t.layerNames+"&style=default&tilematrixset="+encodeURIComponent(t.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(t.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")}return e};const it=function(e){return new t.style.Stroke({color:"#ffffff",width:e+4})},ot=function(e){return new t.style.Stroke({color:"#000000",width:e+6})},at=function(e){e||(e=[]);e instanceof t.style.Style&&(e=[e]);const r=(e=e.slice())[0];if(r){const i=r.getImage();var n;if(i instanceof t.style.RegularShape){n=i.getStroke().getWidth();const o=i.getRadius(),a=r.clone();a.setImage(new t.style.Circle({radius:o,stroke:it(n)}));e.unshift(a);const s=r.clone();s.setImage(new t.style.Circle({radius:o,stroke:ot(n)}));e.unshift(s)}const o=r.getStroke();if(o){n=o.getWidth();e.unshift(new t.style.Style({stroke:it(n)}));e.unshift(new t.style.Style({stroke:ot(n)}))}return e}return null},st=function(t){ct.call(t);t.changed()},lt=function(t){t.hasOwnProperty("_originalStyle")&&t.setStyle(t._originalStyle);delete t._originalStyle},ct=function(){this.style_=function(t){let e=t._originalStyle=t._originalStyle||t.getStyle();!t._originalStyle&&t._wrap.parent.layer&&(e=t._wrap.parent.layer.wrap.layer.getStyle());e||(e=F({},t));return TC.Util.isFunction(e)?function(t,r){return at(e(t,r))}:at(e)}(this);this.styleFunction_=this.style_?t.Feature.createStyleFunction(this.style_):void 0};TC.wrap.control.Modify.prototype.activate=function(){const e=this;e.parent.map&&Promise.all([e.parent.map.wrap.getMap(),e.parent.layer.wrap.getLayer()]).then(function(r){const n=r[0],i=r[1];e.selectInteraction&&n.removeInteraction(e.selectInteraction);var o=new t.interaction.Select({layers:[i],hitTolerance:T});e.selectInteraction=o;n.addInteraction(o);var a=function(t){return t._wrap.parent};o.on("select",function(t){t.selected.length>0&&e.parent.trigger(TC.Consts.event.FEATURESSELECT,{ctrl:e,features:t.selected.map(a)});t.deselected.length>0&&0==t.selected.length&&e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:e.parent,features:t.deselected.map(a)})});e.modifyInteraction&&n.removeInteraction(e.modifyInteraction);var s=new t.interaction.Modify({features:o.getFeatures()});s.on("modifyend",function(t){t.features.forEach(function(t){t._wrap.parent.geometry=t._wrap.getGeometry();e.parent.trigger(TC.Consts.event.FEATUREMODIFY,{feature:t._wrap.parent,layer:e.parent.layer})})});e.modifyInteraction=s;n.addInteraction(s);e.snapInteraction&&n.removeInteraction(e.snapInteraction);if(e.parent.snapping){e.snapInteraction=new t.interaction.Snap({source:i.getSource()});n.addInteraction(e.snapInteraction)}e._onMouseMove||(e._onMouseMove=function(t){const r=n.getViewport();var i,o=n.getEventPixel(t);i=n.forEachFeatureAtPixel(o,function(t,r){return!(!e.parent.layer||r!==e.parent.layer.wrap.layer)},{hitTolerance:T});r.style.cursor=i?"pointer":""});n.getViewport().addEventListener("mousemove",e._onMouseMove)})};TC.wrap.control.Modify.prototype.deactivate=function(){const t=this;if(t.modifyInteraction){t.modifyInteraction.setActive(!1);t.selectInteraction.setActive(!1);t.parent.map.wrap.getMap().then(function(e){e.getViewport().removeEventListener("mousemove",t._onMouseMove);e.removeInteraction(t.modifyInteraction);e.removeInteraction(t.selectInteraction);t.modifyInteraction=null;t.selectInteraction=null})}};TC.wrap.control.Modify.prototype.getSelectedFeatures=function(){var t=[];this.selectInteraction&&this.selectInteraction.getFeatures().forEach(function(e){t[t.length]=e._wrap.parent});return t};TC.wrap.control.Modify.prototype.setSelectedFeatures=function(t){if(this.selectInteraction){var e=this.selectInteraction.featureOverlay_.getSource();e.clear();e.addFeatures(t.map(function(t){return t.wrap.feature}))}};TC.wrap.control.Modify.prototype.unselectFeatures=function(t){t=t||[];const e=this,r=e.selectInteraction?e.selectInteraction.getFeatures():null;if(r){const n=[];r.getArray().slice().forEach(function(e){if(!t.length||t.indexOf(e)>=0){r.remove(e);n[n.length]=e._wrap.parent}});n.length&&e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{features:n})}};TC.wrap.control.Edit.prototype.cancel=function(t,e){this.points=[];this.histPoints=[];this.control&&this.control.layer||this.modifyInteraction&&this.modifyInteraction.layer;if(this.selectInteraction){var r=this.selectInteraction.getFeatures();this.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:this.parent,feature:r.get(0)});r.clear();this.selectInteraction.setActive(!1)}};TC.wrap.control.Edit.prototype.deleteFeatures=function(t){var e=this;if(Array.isArray(t)){var r=t.map(function(t){return t.wrap.feature});e.parent.layer.wrap.getLayer().then(function(t){for(var n=e.selectInteraction?e.selectInteraction.getFeatures():null,i=0,o=r.length;i<o;i++){var a=r[i];if(n){n.remove(a);e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{feature:a._wrap.parent})}t.getSource().removeFeature(a);e.parent.trigger(TC.Consts.event.FEATUREREMOVE,{feature:a._wrap.parent})}})}};TC.wrap.Feature.prototype.toGML=function(e,r){var n=new t.format.GML({srsName:r}).writeGeometryNode(this.feature.getGeometry()),i=n.querySelector("MultiSurface,MultiPolygon,Polygon");i&&i.querySelectorAll("Polygon,LinearRing").forEach(t=>{t.removeAttribute("srsName")});n.firstChild.setAttribute("gml:id",n.firstChild.tagName+"."+TC.getUID());return(new XMLSerializer).serializeToString(n.firstChild).replace(/\<\/?\w/gm,function(t){var e=t.indexOf("/")>0?t.indexOf("/")+1:1;return t.substring(0,e)+"gml:"+t.substring(e)})};TC.wrap.Feature.prototype.toGeoJSON=function(){return(new t.format.GeoJSON).writeGeometry(this.feature.getGeometry())};TC.wrap.Geometry.write=function(e){var r;(e=e||{}).format;e.parser=new t.format.GeoJSON;switch(e.type){case TC.Consts.geom.POLYLINE:r=new t.geom.LineString(e.coordinates);break;case TC.Consts.geom.POLYGON:r=new t.geom.Polygon(e.coordinates);break;case TC.Consts.geom.MULTIPOINT:r=new t.geom.MultiPoint(e.coordinates);break;case TC.Consts.geom.MULTIPOLYLINE:r=new t.geom.MultiLineString(e.coordinates);break;case TC.Consts.geom.MULTIPOLYGON:r=new t.geom.MultiPolygon(e.coordinates);break;case TC.Consts.geom.POINT:default:r=new t.geom.Point(e.coordinates)}return e.parser.writeGeometry(r)};TC.wrap.Geometry.toGeoJSON=function(t){return TC.wrap.Geometry.write(t)};return t});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const t=this;TC.Control.apply(t,arguments);t.apiAttribution="";t.mainDataAttribution=null;t.dataAttributions=[];t.options.dataAttributions&&(t.dataAttributions=t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<div><span>").f(e.get(["api"],!1),e,"h",["s"]).w("</span>").x(e.get(["mainData"],!1),e,{block:r},{}).x(e.get(["otherData"],!1),e,{block:a},{}).w('<div class="tc-ctl-attrib-other ').x(e.get(["isCollapsed"],!1),e,{block:s},{}).w('">').s(e.get(["otherData"],!1),e,{block:l},{}).w("</div></div>")}e.__dustBody=!0;function r(t,e){return t.w(" - ").h("i18n",e,{},{$key:"data"}).w(":").x(e.getPath(!1,["mainData","site"]),e,{else:n,block:o},{})}r.__dustBody=!0;function n(t,e){return t.x(e.getPath(!1,["mainData","name"]),e,{block:i},{})}n.__dustBody=!0;function i(t,e){return t.w("<span> ").f(e.getPath(!1,["mainData","name"]),e,"h").w("</span>")}i.__dustBody=!0;function o(t,e){return t.w('<span> <a href="').f(e.getPath(!1,["mainData","site"]),e,"h").w('" target="_blank">').f(e.getPath(!1,["mainData","name"]),e,"h").w("</a></span>")}o.__dustBody=!0;function a(t,e){return t.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",e,{},{$key:"others"}).w("...</span>")}a.__dustBody=!0;function s(t,e){return t.w(" tc-collapsed ")}s.__dustBody=!0;function l(t,e){return t.x(e.getPath(!1,["otherData",e.get(["$idx"],!1),"site"]),e,{else:c,block:u},{}).h("sep",e,{block:h},{})}l.__dustBody=!0;function c(t,e){return t.w("<span>").f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"name"]),e,"h").w("</span>")}c.__dustBody=!0;function u(t,e){return t.w('<span><a href="').f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"site"]),e,"h").w('" target="_blank">').f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"name"]),e,"h").w("</a></span>")}u.__dustBody=!0;function h(t,e){return t.w(", ")}h.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.apiAttribution=e.map.options.attribution||e.apiAttribution;var n=function(t){if(t){var r=t.getAttribution();if(r)if(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))e.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var n=!1,i=0;i<e.dataAttributions.length;i++)if(r.name===e.dataAttributions[i].name){n=!0;break}n||e.dataAttributions.push(r)}}},i=function(t){if(t){if(!(t instanceof TC.Layer)||function(){if(t.map.workLayers.length>0){for(var e=t.map.workLayers.slice().reverse(),r=0;r<e.length;r++)if(e[r].url==t.url&&e[r].getVisibility())return!1;return!0}return!0}()){var r=t.getAttribution();if(r){var n=e.dataAttributions.reduce(function(t,e,n){return e.name===r.name?n:t},-1);const t=function(t){return(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(/IDENA/.test(t)||/Tracasa Instrumental/.test(t))||r.name===t};if(e.map.baseLayer&&e.map.baseLayer.wrap.getAttribution()&&t(e.map.baseLayer.wrap.getAttribution().name))return;if(e.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).some(function(e){var r=e.wrap.getAttribution();return r&&t(r.name)}))return;n>-1?e.dataAttributions.splice(n,1):(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(e.mainDataAttribution=null)}}}};t.loaded(function(){if(t.baseLayer.wrap.getAttribution){n(t.baseLayer.wrap);e.render()}});t.on(TC.Consts.event.LAYERADD,function(t){const r=t.layer;if(!r.isBase&&r.wrap.getAttribution&&r.wrap.getAttribution()){n(r.wrap);e.render()}});t.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(t){const r=t.type,o=t.newLayer,a=t.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(r)>-1&&(e.ignoreLayer=o);a&&a.wrap.getAttribution&&i(a.wrap);o&&o.wrap.getAttribution&&n(o.wrap);e.render()});t.on(TC.Consts.event.LAYERREMOVE,function(t){const r=t.layer;if(r.wrap.getAttribution){i(r.wrap);e.render()}});t.on(TC.Consts.event.TERRAINPROVIDERADD,function(t){const r=t.terrainProvider;if(r.getAttribution){n(r);e.render()}});t.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(t){const r=t.terrainProvider;if(r.getAttribution){i(r);e.render()}});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){const r=t.layer;if(e.ignoreLayer!==r&&r.wrap.getAttribution){r.getVisibility()?n(r.wrap):i(r.wrap);e.render()}});return r};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({api:"function"==typeof e.apiAttribution?e.apiAttribution.apply(e):e.getLocaleString(e.apiAttribution),mainData:e.mainDataAttribution,otherData:e.dataAttributions,isCollapsed:!e.div.querySelector("."+e.CLASS+"-other")||e.div.querySelector("."+e.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const r=e.div.querySelector("."+e.CLASS+"-cmd");r&&r.addEventListener(TC.Consts.event.CLICK,function(){e.toggleOtherAttributions()});"function"==typeof t&&t()}))};t.toggleOtherAttributions=function(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(TC.Consts.classes.COLLAPSED)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var t=this;TC.control.MapContents.apply(t,arguments);t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code"};t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(.tc-modal-close)",function(e){if(e.target.classList.contains(t._cssClasses.LOAD_CRS_BUTTON)){t.loadFallbackProjections();return}TC.Util.closeModal();const r=e.target,n=r.dataset.crsCode,i=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog");i.classList.add(TC.Consts.classes.HIDDEN);const o=t.getLayer(i.dataset.layerId);if(o)if(n)TC.loadProjDef({crs:n,callback:function(){t.map.setProjection({crs:n,baseLayer:o})}});else{const e=t.getFallbackLayer(r.dataset.fallbackLayerId);e&&t.map.setBaseLayer(e)}}))};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var t=TC.control.BasemapSelector.prototype;t.CLASS="tc-ctl-bms";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(e.get(["baseLayers"],!1),e,{block:r},{}).s(e.get(["dialogMore"],!1),e,{block:n},{}).w("</ul></form></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-bms-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;function n(t,e){return t.w('<li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="').h("i18n",e,{},{$key:"moreBackgroundMaps"}).w('"><input type="radio" name="bms" value="moreLayers"><span></span></label></li>')}n.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w('<li class="tc-ctl-bms-node" data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('" ><label').x(e.get(["legend"],!1),e,{block:r},{}).x(e.get(["thumbnail"],!1),e,{block:n},{}).w('><input type="radio" name="bms" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["mustReproject"],!1),e,{block:i},{}).w("><span>").f(e.get(["title"],!1),e,"h").w("</span></label></li>")}e.__dustBody=!0;function r(t,e){return t.w(' style="background-image: url(').f(e.getPath(!1,["legend","src"]),e,"h").w(')"')}r.__dustBody=!0;function n(t,e){return t.w(' style="background-image: url(').f(e.get(["thumbnail"],!1),e,"h").w(')"')}n.__dustBody=!0;function i(t,e){return t.w(' class="tc-disabled"')}i.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"backgroundMaps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w('</button></div></div></div><div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"baseLayerNotCompatible"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"baseLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-bms-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};const e=function(t,e){for(;t&&!t.matches(e);)t=t.parentElement;return t},r=function(t,r){const n=this;var i=!0,o=t.target,a=n.getLayer(e(o,"li").dataset.layerId);if(n.options.dialogMore&&e(o,"."+n.CLASS+"-more-dialog")){const t=n.div.querySelectorAll("input[type=radio]");for(var s=0,l=t.length;s<l;s++){const r=n.getLayer(e(t[s],"li").dataset.layerId);if(r)switch(!0){case r.id===a.id:a=r}}}if(a!=n.map.getBaseLayer())if(a.mustReproject)if(n.map.on3DView){if(!a.getFallbackLayer()){n._currentSelection.checked=!0;t.stopPropagation();return}if(a.getFallbackLayer()){const t=a.getFallbackLayer();t&&t._capabilitiesPromise.then(function(){t.isCompatible(n.map.getCRS())&&n.map.setBaseLayer(a)});i=!0}}else{n._currentSelection&&(n._currentSelection.checked=!0);const t={layer:a},e=a.getFallbackLayer();e?e._capabilitiesPromise.then(function(){e.isCompatible(n.map.getCRS())&&(t.fallbackLayer=e);n.showProjectionChangeDialog(t)}):n.showProjectionChangeDialog(t);i=!1}else{(a.type===TC.Consts.layerType.WMS||a.type===TC.Consts.layerType.WMTS&&a.getProjection()!==n.map.crs)&&a.setProjection({crs:n.map.crs});n.map.setBaseLayer(a)}this._currentSelection&&(this._currentSelection.checked=!0);r&&r(i)};t.register=function(t){const e=this,n=TC.control.MapContents.prototype.register.call(e,t);e.options.dialogMore&&t.on(TC.Consts.event.VIEWCHANGE,function(){e._getMoreBaseLayers()});t.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(t){e.update(e.div,t.layer)});e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(t){"moreLayers"===t.target.value?e.showMoreLayersDialog():r.call(e,t);t.stopPropagation()}));return n};t.render=function(t){const e=this,n=TC.control.MapContents.prototype.render.call(e,t,e.options);e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t;if(e.options.dialogMore){e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog").addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(t){r.call(e,t,function(t){t&&TC.Util.closeModal()});t.stopPropagation()}))}});return n};t.update=function(t,e){const r=this;(t=t||r.div).querySelectorAll(`ul.${r.CLASS}-branch li`).forEach(function(t){const n=r.getLayer(t.dataset.layerId);if(n){const i=e||r.map.baseLayer,o=t.querySelector("input[type=radio]"),a=i&&(i===n||i.id===n.id||n.getFallbackLayer&&(i===n.getFallbackLayer()||n.getFallbackLayer()&&i.id===n.getFallbackLayer().id));if(r.map.on3DView&&n.mustReproject&&n.fallbackLayer&&n.getFallbackLayer)n.getFallbackLayer().getCapabilitiesPromise().then(function(){var e=!n.getFallbackLayer().isCompatible(r.map.getCRS());o.checked=a;if(e){o.classList.add(TC.Consts.classes.DISABLED);t.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);t.removeAttribute("title")}});else{o.checked=a;if(n.mustReproject){o.classList.add(TC.Consts.classes.DISABLED);t.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);t.removeAttribute("title")}}a&&(r._currentSelection=o)}});r.updateScale()};t.updateLayerTree=function(t){const e=this;if(t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.getRenderedHtml(e.CLASS+"-node",e.layerTrees[t.id]).then(function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild;var i=n.dataset.layerUid;const o=e.div.querySelector("."+e.CLASS+"-branch"),a=o.querySelector('li[data-layer-uid="'+i+'"]');if(a)a.innerHTML=n.innerHTML;else{n.dataset.layerId=t.id;const r=e.map.baseLayers.filter(t=>t&&!t.stealth).map(t=>t.id),i=r.indexOf(t.id);let a=!1;for(let t=i-1;t>=0;t--){const e=o.querySelector(`li[data-layer-id="${r[t]}"]`);if(e){e.insertAdjacentElement("afterend",n);a=!0;break}}if(!a){for(let t=i+1,e=r.length;t<e;t++){const e=o.querySelector(`li[data-layer-id="${r[t]}"]`);if(e){e.insertAdjacentElement("beforebegin",n);a=!0;break}}if(!a){const t=o.querySelector(`.${e.CLASS}-more-node`);t?t.parentElement.insertAdjacentElement("beforebegin",n):o.appendChild(n)}}e.update()}}).catch(function(t){TC.error(t)})}};t.updateLayerOrder=function(t,e,r){};t.removeLayer=function(t){const e=this;if(t.isBase){const i=e.div.querySelector("."+e.CLASS+"-branch").querySelectorAll("li");for(var r=0,n=i.length;r<n;r++){const e=i[r];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}}};t.onErrorLayer=function(t){const e=this;t.isBase&&!t.options.stealth&&e.map.toast(e.getLocaleString("baseLayerNotAvailable",{mapName:t.title}),{type:TC.Consts.msgType.ERROR})};t.getFallbackLayer=function(t){const e=this,r=function(e){return e.fallbackLayer&&e.fallbackLayer.id===t};var n=e.map.baseLayers.filter(r)[0].fallbackLayer;!n&&e._moreBaseLayers&&(n=e._moreBaseLayers.filter(r)[0].fallbackLayer);return n};t.loadFallbackProjections=function(){const t=this;t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li").forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(TC.Consts.classes.HIDDEN)})};t.showProjectionChangeDialog=function(t){const e=this,r=(t=t||{}).layer,n=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog"),i=n.querySelector(".tc-modal-body");i.classList.add(TC.Consts.classes.LOADING);const o=r.getCompatibleCRS();n.classList.remove(TC.Consts.classes.HIDDEN);n.dataset.layerId=r.id;const a=n.querySelector("ul."+e.CLASS+"-crs-list");a.innerHTML="";e.map.loadProjections({crsList:e.map.getCompatibleCRS({layers:e.map.workLayers.concat(r),includeFallbacks:!0}),orderBy:"name"}).then(function(r){var n=!1;const s=document.createDocumentFragment();r.forEach(function(r){const i=document.createElement("li"),a=document.createElement("button");if(0===o.filter(function(t){return TC.Util.CRSCodesEqual(t,r.code)}).length){n=!0;a.innerHTML=r.name+" ("+r.code+")";t.layer.fallbackLayer&&(a.dataset.fallbackLayerId=t.layer.fallbackLayer.id);a.dataset.crsCode=r.code;a.classList.add(TC.Consts.classes.WARNING);i.classList.add(TC.Consts.classes.HIDDEN)}else{a.innerHTML=e.getLocaleString("changeMapToCrs",{crs:r.name+" ("+r.code+")"});a.dataset.crsCode=r.code}i.appendChild(a);s.appendChild(i)});if(t.fallbackLayer){const r=document.createElement("li"),n=document.createElement("button");n.innerHTML=e.getLocaleString("reprojectOnTheFly");n.dataset.fallbackLayerId=t.fallbackLayer.id;r.appendChild(n);s.appendChild(r)}if(n){const t=document.createElement("li"),r=document.createElement("button");r.classList.add(e._cssClasses.LOAD_CRS_BUTTON);r.innerHTML=e.getLocaleString("showOnTheFlyProjections");t.appendChild(r);s.appendChild(t)}a.appendChild(s);i.classList.remove(TC.Consts.classes.LOADING)});n.querySelector("."+e.CLASS+"-name").innerHTML=r.title||r.name;TC.Util.showModal(n)};t.showMoreLayersDialog=function(){const t=this,e=t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog");e.classList.toggle(TC.Consts.classes.THREED,!!t.map.on3DView);const r=e.querySelector(".tc-modal-body");r.innerHTML="";r.classList.add(TC.Consts.classes.LOADING);e.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(e,{closeCallback:function(){this._currentSelection.checked=!0;this.update()}.bind(t)});e.querySelector(".tc-modal-window").classList.add(t.CLASS+"-more-dialog");t._getMoreBaseLayers().then(function(){t.getRenderedHtml(t.CLASS,{baseLayers:t._moreBaseLayers},function(e){r.innerHTML=e;r.classList.remove(TC.Consts.classes.LOADING);r.querySelectorAll("li").forEach(function(e,r){e.dataset.layerId=t._moreBaseLayers[r].id});t.update(r)})})};t.getLayer=function(t){return this.map&&(this.map.getLayer(t)||this._moreBaseLayers&&this._moreBaseLayers.filter(function(e){return e.id===t})[0])};const n=function(t){return new Promise(function(e,r){Promise.all([t.getCapabilitiesPromise(),t.getFallbackLayer()?t.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then(function(){e()})})};t._getMoreBaseLayers=function(){const t=this;if(t._moreBaseLayers||t._moreBaseLayersPromise){if(t._moreBaseLayers)return new Promise(function(e,r){Promise.all(t._moreBaseLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).map(function(e){return t.map.on3DView?n(e):e.getCapabilitiesPromise()})).then(function(){t._moreBaseLayers=t._moreBaseLayers.map(function(e){if(e.type===TC.Consts.layerType.WMTS){var r=e.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];e.mustReproject=!r}else e.type===TC.Consts.layerType.WMS&&(e.mustReproject=!e.isCompatible(t.map.getCRS()));if(t.map.on3DView&&e.mustReproject&&e.getFallbackLayer&&e.getFallbackLayer()){e.mustReproject=!e.getFallbackLayer().isCompatible(t.map.getCRS());return e}return e});e(t._moreBaseLayers)})})}else t._moreBaseLayersPromise=new Promise(function(e,r){var i=TC.Cfg.availableBaseLayers.filter(function(t){return-1==TC.Cfg.availableBaseLayers.filter(function(t){return t.fallbackLayer}).map(function(t){return t.fallbackLayer}).indexOf(t.id)}).map(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(t):t.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(t):void 0});t._moreBaseLayers=new Array(i.length);const o=function(e){const r=this;r.map=t.map;r.isBase=r.options.isBase=!0;if(r.type===TC.Consts.layerType.WMTS){var n=r.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];r.mustReproject=!n}else r.type===TC.Consts.layerType.WMS&&(r.mustReproject=!r.isCompatible(t.map.getCRS()));t.map.on3DView&&r.mustReproject&&r.getFallbackLayer&&r.getFallbackLayer()&&(r.mustReproject=!r.getFallbackLayer().isCompatible(t.map.getCRS()));t._moreBaseLayers.splice(e,1,r)};Promise.all(i.map(function(e,r){return new Promise(function(i,a){if(e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS){(t.map.on3DView?n(e):e.getCapabilitiesPromise()).then(function(){o.call(e,r);i()},function(e){t._moreBaseLayers.splice(r,1,null);i()})}else{o.call(e,r);i()}})})).finally(function(){t._moreBaseLayers=t._moreBaseLayers.filter(function(t){return null!==t});e(t._moreBaseLayers)})});return t._moreBaseLayersPromise}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";TC.control.CacheBuilder=function(){var t=this;TC.control.SWCacheClient.apply(this,arguments);var r=t._classSelector="."+t.CLASS;t._selectors={DRAW:r+"-draw",DRAWING:r+"-drawing",PROGRESS:r+"-progress",NEW:r+"-new",LIST:r+"-list",LISTITEM:r+"-list > li",OKBTN:r+"-btn-ok",NEWBTN:r+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:r+"-tile-count",NAMETB:r+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:r+"-link-exit",OFFPANEL:r+"-off-panel",BLLIST:r+"-bl-list",BLLISTITEM:r+"-bl-list > li",BLLISTTEXT:r+"-bl-panel-txt",RNGMAXRES:r+"-rng-maxres",SEARCH:r+"-map-available-srch",EMPTYLIST:r+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};t.storedMaps=[];const n=TC.Util.getParameterByName(t.MAP_DEFINITION_PARAM_NAME),i=TC.Util.getParameterByName(t.MAP_EXTENT_PARAM_NAME);t.mapIsOffline=!!n;n&&(t.currentMapDefinition=JSON.parse(window.atob(decodeURIComponent(n))));i&&(t.currentMapExtent=e(i));try{t.localStorage=window.localStorage;const e="__delete_me__";t.localStorage.setItem(e,e);t.localStorage.removeItem(e)}catch(e){t.localStorage=null;TC.error(t.getLocaleString("couldNotAccessLocalStorage"))}if(t.localStorage){for(var o=0,a=t.localStorage.length;o<a;o++){var s=t.localStorage.key(o);if(0===s.indexOf(t.LOCAL_STORAGE_KEY_PREFIX)&&s!==t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash"){var l=t.localStorage.getItem(s).split(" "),c=e(l.shift()),u={name:l.join(" "),extent:c,url:decodeURIComponent(s.substr(t.LOCAL_STORAGE_KEY_PREFIX.length))};t.storedMaps.push(u)}}t.storedMaps.sort(function(t,e){return t.name>e.name?1:t.name<e.name?-1:0})}var h=TC.Util.extend({},a>1?arguments[1]:arguments[0]);t._dialogDiv=TC.Util.getDiv(h.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));h.dialogDiv||document.body.appendChild(t._dialogDiv);t.mapIsOffline&&document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});TC.Control.apply(t,arguments);t.wrap=new TC.wrap.control.CacheBuilder(t);t.isDownloading=!1;t.baseLayers=[];t.options.avgTileSize=t.options.avgTileSize||TC.Cfg.avgTileSize;t.requestSchemas=[];t.minResolution=0;t.currentMap=null;t._loadedCount=0;var d=history.pushState;history.pushState=function(e){var r;r=d.apply(history,arguments);if(t._offlinePanelDiv){const e=TC.Util.getQueryStringParams();delete e[t.MAP_DEFINITION_PARAM_NAME];delete e[t.MAP_EXTENT_PARAM_NAME];delete e[t.SERVICE_WORKER_FLAG];var n=TC.Util.getParamString(e);n.length&&(n="?"+n);const r=location.pathname+n+location.hash;t._offlinePanelDiv.querySelector(t._selectors.EXIT).setAttribute("href",r)}return r};var p=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},f=function(){if(t._offlinePanelDiv){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.remove(TC.Consts.classes.CONNECTION_OFFLINE,TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI);switch(p.type){case 1:case 2:case void 0:e.classList.add(TC.Consts.classes.CONNECTION_WIFI);break;default:e.classList.add(TC.Consts.classes.CONNECTION_MOBILE)}}};p.addEventListener&&p.addEventListener("typechange",f);window.addEventListener("online",f);window.addEventListener("offline",function(){if(t._offlinePanelDiv){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);e.classList.remove(TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI)}})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var t=TC.control.CacheBuilder.prototype;t.CLASS="tc-ctl-cbuild";t.MAP_DEFINITION_PARAM_NAME="map-def";t.MAP_EXTENT_PARAM_NAME="map-extent";t.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";t.ROOT_CACHE_NAME="root";t.SERVICE_WORKER_FLAG="sw";t._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};t._actions={CREATE:"create",DELETE:"delete"};t.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(e.get(["listId"],!1),e,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",e,{},{$key:"cb.filter.plhr"}).w('"').x(e.get(["storedMaps"],!1),e,{else:r,block:n},{}).w(' maxlength="200" />                <ul id="').f(e.get(["listId"],!1),e,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(e.get(["storedMaps"],!1),e,{block:i},{}).w("><span>").h("i18n",e,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",e,{},{$key:"noMatches"}).w("</span></li>").s(e.get(["storedMaps"],!1),e,{block:o},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",e,{},{$key:"newofflinemap"}).w('">').h("i18n",e,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",e,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.w(" disabled")}r.__dustBody=!0;function n(t,e){return t}n.__dustBody=!0;function i(t,e){return t.w(" hidden")}i.__dustBody=!0;function o(t,e){return t.p("tc-ctl-cbuild-map-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-map-node"]=function(){dust.register(t.CLASS+"-map-node",e);function e(t,e){return t.w('<li data-extent="').f(e.get(["extent"],!1),e,"h").w('"><span><a href="').f(e.get(["url"],!1),e,"h").w('" title="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(e.get(["name"],!1),e,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",e,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",e,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",e,{},{$key:"editMapName"}).w('">').h("i18n",e,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",e,{},{$key:"viewMapExtent"}).w('">').h("i18n",e,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",e,{},{$key:"deleteMap"}).w('">').h("i18n",e,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-bl-node"]=function(){dust.register(t.CLASS+"-bl-node",e);function e(t,e){return t.w('<li class="tc-ctl-cbuild-bl-node" data-layer-uid="').f(e.get(["id"],!1),e,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(e.get(["thumbnail"],!1),e,"h").w(')"><input type="checkbox" name="cbbl" value="').f(e.get(["id"],!1),e,"h").w('" disabled><span>').f(e.get(["title"],!1),e,"h").w("</span></label></li>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",e,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",e,{},{$key:"availableOfflineMaps"}).w('</h4><p class="tc-ctl-cbuild-bl-panel-txt">').h("i18n",e,{},{$key:"selectAtLeastOne"}).w('</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",e,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",e,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",e,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",e,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-off-panel"]=function(){dust.register(t.CLASS+"-off-panel",e);function e(t,e){return t.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",e,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",e,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",e,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e};const e=function(t){return decodeURIComponent(t).split(",").map(function(t){return parseFloat(t)})},r=function(t,e){e.querySelector("span").classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.TEXTBOX).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.SAVEBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.CANCELBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.EDITBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.VIEWBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.DELETEBTN).classList.remove(TC.Consts.classes.HIDDEN)};var n=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},i=function(t,e){var r=e||{};const n=t._dialogDiv.querySelector(t._classSelector+"-res"),i=t._dialogDiv.querySelector(t._selectors.RNGMAXRES);var o,a,s,l=t.getResolutions();if(l.length){i.setAttribute("max",l.length-1);if(t.minResolution){if(void 0===r.rangeValue)for(var c=0,u=l.length;c<u;c++)if(t.minResolution>=l[c]){i.value=c;break}}else if(void 0===r.rangeValue){const e=t.map.getResolution();i.value=l.filter(t=>t>e).length}a=parseInt(i.value);var h=Math.floor(1e3*new Number(l[a]))/1e3;o=t.getLocaleString("metersPerPixel",{value:h.toLocaleString((t.map?t.map.options.locale:TC.Cfg.locale).replace("_","-"))});s=100*(a+1)/(l.length+1)+"%";i.disabled=!1;t.minResolution=l[i.value]}else{a=0;o="";i.value=0;s="0";t.minResolution=0;i.disabled=!0}n.style.left=s;n.innerHTML=o};const o=function(t){t._dialogDiv.querySelectorAll(t._classSelector+"-bl-node input[type=checkbox]").forEach(function(e,r){if(e.checked){var n=t.requestSchemas.filter(function(t){return t.layerId===e.value})[0];if(n){var i=function(t,e){for(var r=null,n=0,i=t.tileMatrixLimits.length;n<i&&!((r=t.tileMatrixLimits[n]).res<=e);n++);return r}(n,t.minResolution);if(i){var o=n.url;if(o.indexOf("{TileMatrix}")<0){var a=o.indexOf("?");a>=0&&(o=o.substr(0,a));for(var s=0,l=t.baseLayers.length;s<l;s++){var c=t.baseLayers[s];if(c.id===n.layerId){o=o+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}for(;e&&"LABEL"!==e.tagName;)e=e.parentElement;if(e){e.style.backgroundSize="auto";e.style.backgroundPosition="left bottom";e.style.backgroundImage="url("+o.replace("{TileMatrix}",i.mId).replace("{TileRow}",i.rt).replace("{TileCol}",i.cl)+")"}}}}})},a=function(t,e){return e<1?t.getLocaleString("lessThan1Mb"):t.getLocaleString("approxXMb",{quantity:n(e)})},s=function(t){var e="";t.tileCount=0;for(var r=0,i=t.requestSchemas.length;r<i;r++)for(var o=t.requestSchemas[r],s=0,l=o.tileMatrixLimits.length;s<l;s++){var c=o.tileMatrixLimits[s];t.tileCount+=(c.cr-c.cl+1)*(c.rb-c.rt+1);if(c.res<t.minResolution)break}if(t.tileCount){t.estimatedMapSize=Math.round(t.tileCount*t.options.avgTileSize/1048576);e=t.getLocaleString("xTiles",{quantity:n(t.tileCount)})+" ("+a(t,t.estimatedMapSize)+")"}t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML=e},l=function(t,e){var r=e.indexOf("#");r>=0&&(e=e.substr(0,r));const n=t.div.querySelectorAll(t._selectors.LISTITEM);for(var i=0,o=n.length;i<o;i++){const t=n[i],r=t.querySelector("a");if(r&&r.getAttribute("href")===e)return t}return null};var c=function(t,e){var r=!1;if(t.localStorage){t.localStorage.setItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e.url),e.extent+" "+e.name);r=!0}return r};const u=function(t,e){const r=t.findStoredMap({url:e});if(r){if(function(t,e){var r=!1;if(t.localStorage){t.localStorage.removeItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e));r=!0}return r}(t,e)){const e=function(t,e){const r=t.div.querySelectorAll(t._selectors.LISTITEM);for(var n=0,i=r.length;n<i;n++){const t=r[n],i=t.querySelector("a");if(i&&i.innerHTML===e)return t}return null}(t,r.name);e&&e.parentElement.removeChild(e)}var n=t.storedMaps.indexOf(r);t.storedMaps.splice(n,1);if(!t.storedMaps.length){t.div.querySelector(t._selectors.SEARCH).disabled=!0;t.div.querySelector(t._selectors.EMPTYLIST).removeAttribute("hidden")}return r.name}return null};t.render=function(t){const n=this;return n._set1stRenderPromise(new Promise(function(a,u){var h={storedMaps:n.storedMaps,listId:n.CLASS+"-list-"+TC.getUID()};n.getRenderedHtml(n.CLASS+"-dialog",null,function(t){n._dialogDiv.innerHTML=t;n._dialogDiv.querySelector(n._selectors.NAMETB).addEventListener(TC.Consts.event.CLICK,function(t){t.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){n.renderData(h,function(){n._dialogDiv.querySelector(n._selectors.OKBTN).addEventListener(TC.Consts.event.CLICK,function(){n.generateCache()});n._dialogDiv.querySelector(n._selectors.NAMETB).addEventListener("input",function(){n._updateReadyState()});n.div.querySelector(n._selectors.NEWBTN).addEventListener(TC.Consts.event.CLICK,function(){n.setEditState()});n.div.querySelector(n._classSelector+"-btn-cancel-draw").addEventListener(TC.Consts.event.CLICK,function(){n.setReadyState()});n.div.querySelector(n._classSelector+"-btn-cancel-dl").addEventListener(TC.Consts.event.CLICK,function(){n.cancelCacheRequest()});const a=n.div.querySelector(n._selectors.LIST);a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.DELETEBTN,function(t){n.startDeleteMap(t.target.parentElement.querySelector("a").innerHTML)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.EDITBTN,function(t){!function(t,e){e.querySelector("span").classList.add(TC.Consts.classes.HIDDEN);const r=e.querySelector(t._selectors.TEXTBOX);r.classList.remove(TC.Consts.classes.HIDDEN);r.value=e.querySelector("span a").innerHTML;r.focus();e.querySelector(t._selectors.SAVEBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.CANCELBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.EDITBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.VIEWBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.DELETEBTN).classList.add(TC.Consts.classes.HIDDEN)}(n,t.target.parentElement)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.CANCELBTN,function(t){const e=t.target.parentElement;e.querySelector(n._selectors.TEXTBOX).value=e.querySelector("a").innerHTML;r(n,e)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.SAVEBTN,function(t){const e=t.target.parentElement;r(n,e);const i=e.querySelector("a"),o=(i.innerHTML,e.querySelector(n._selectors.TEXTBOX).value),a=n.findStoredMap({url:i.getAttribute("href")});if(a){a.name=o;i.innerHTML=o;i.setAttribute("title",o);c(n,a)}}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.VIEWBTN,function(t){const r=t.target;var i=!r.classList.contains(TC.Consts.classes.ACTIVE);const o=n.div.querySelector(n._selectors.VIEWBTN);o.classList.remove(TC.Consts.classes.ACTIVE);o.parentElement.classList.remove(TC.Consts.classes.ACTIVE);const a=r.parentElement.querySelector("a").innerHTML;if(a){var s=n.findStoredMap({name:a});if(s){var l=e(s.extent);n.layer.clearFeatures();if(i){n.layer.addPolygon([[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]],{showsPopup:!1}).then(function(){n.layer.map.zoomToFeatures(n.layer.features)});r.classList.add(TC.Consts.classes.ACTIVE);r.parentElement.classList.add(TC.Consts.classes.ACTIVE);r.setAttribute("title",n.getLocaleString("removeMapExtent"))}}}}));const u=n.div.querySelector(n._selectors.SEARCH),h=function(){!function(t){t=t.toLowerCase();const e=n.div.querySelectorAll(n._selectors.LISTITEM);e.forEach(function(t){t.style.display="none"});const r=[];e.forEach(function(t){t.matches("li:not([class]),li."+TC.Consts.classes.ACTIVE)&&r.push(t)});if(0===t.length){r.forEach(function(t){t.style.removeProperty("display")});n.div.querySelector(n._classSelector+"-map-search-icon").style.visibility="visible"}else{n.div.querySelector(n._classSelector+"-map-search-icon").style.visibility="hidden";var i=new RegExp(t,"i");r.forEach(function(t){t.style.display=i.test(t.querySelector("a").textContent)?"":"none"});r.some(function(t){return!t.hidden})||e.forEach(function(t){t.matches('[class^="tc-ctl-cbuild-map-not"]')&&t.style.removeProperty("display")})}}(this.value.toLowerCase().trim())};u.addEventListener("keyup",h);u.addEventListener("search",h);n._dialogDiv.querySelector(n._selectors.BLLIST).addEventListener("change",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(t){const e=t.target;if(e.checked)n.baseLayers.push(n.map.getLayer(e.value));else for(var r=0,a=n.baseLayers.length;r<a;r++){if(n.baseLayers[r].id===e.value){n.baseLayers.splice(r,1);break}}n.updateRequestSchemas();i(n);o(n);n._updateReadyState();s(n)}));const d=n._dialogDiv.querySelector(n._selectors.RNGMAXRES),p=function(t){i(n,{rangeValue:t.target.value});o(n);s(n)};d.addEventListener("input",p);d.addEventListener("change",p);const f=l(n,location.href);f&&f.classList.add(TC.Consts.classes.ACTIVE);TC.Util.isFunction(t)&&t()}).then(function(){a()}).catch(function(t){u(t instanceof Error?t:Error(t))})});window.addEventListener("beforeunload",function(t){if(n.isDownloading){var e=n.getLocaleString("cb.mapDownloading.warning");t.returnValue=e;return e}},!0)}))};t.register=function(t){var e=this;const r=TC.control.SWCacheClient.prototype.register.call(e,t);e.getServiceWorker().then(function(){navigator.serviceWorker.ready.then(function(){navigator.serviceWorker.addEventListener("message",function(t){switch(t.data.event){case"progress":e.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:t.data.name,loaded:t.data.count,total:t.data.total});break;case"cached":e.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t.data.name});break;case"deleted":e.trigger(TC.Consts.event.MAPCACHEDELETE,{url:t.data.name});break;case"error":t.data.action===e._actions.CREATE&&TC.error(e.getLocaleString("cb.resourceDownload.error",{url:t.data.url}))}})});navigator.onLine&&new Promise(function(t,e){var r=document.documentElement.getAttribute("manifest")||"manifest.appcache";r?TC.ajax({url:r,method:"GET",responseType:"text"}).then(function(e){var r=e.data;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var e=hex_md5(r),n=r.indexOf("NETWORK:");n>=0&&(r=r.substr(0,n));(n=r.indexOf("FALLBACK:"))>=0&&(r=r.substr(0,n));(n=r.indexOf("SETTINGS:"))>=0&&(r=r.substr(0,n));var i=r.split(/[\n\r]/).filter(function(t){return t.length>0&&0!==t.indexOf("#")&&"CACHE:"!==t});i.shift();t({hash:e,urls:i})})}).catch(function(t){e(t)}):e(Error("There is no manifest in document"))}).then(function(t){const r=e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash";var n;e.localStorage&&(n=e.localStorage.getItem(r));if(n!==t.hash){e.cacheUrlList(t.urls);e.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){const i=!n;e.localStorage&&e.localStorage.setItem(r,t.hash);i||TC.confirm(e.getLocaleString("newAppVersionAvailable"),function(){location.reload()})})}})},function(t){e.renderPromise().then(function(){const r=e.div.querySelector(`.${e.CLASS}-new`),n=document.createElement("div");n.classList.add("tc-alert","alert-warning");const i=document.createElement("p"),o=document.createElement("strong");o.innerHTML=e.getLocaleString("offlineMap.error");i.appendChild(o);const a=document.createElement("p");a.innerHTML=t.message;n.appendChild(i);n.appendChild(a);r.querySelector(e._selectors.NEWBTN).classList.add(TC.Consts.classes.HIDDEN);r.appendChild(n)})}).catch(()=>console.log("No SW available: no events handled"));if(e.mapIsOffline){t.div.classList.add(TC.Consts.classes.OFFLINE);e._offlinePanelDiv=TC.Util.getDiv(e.options.offlinePanelDiv);e.options.offlinePanelDiv||t.div.appendChild(e._offlinePanelDiv);e.getRenderedHtml(e.CLASS+"-off-panel",null,function(t){e._offlinePanelDiv.innerHTML=t;if(!navigator.onLine){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI)}e._offlinePanelDiv.querySelector(e._selectors.EXIT).addEventListener(TC.Consts.event.CLICK,function(t){TC.confirm(e.getLocaleString("offlineMapExit.confirm"),null,function(){t.preventDefault()})})})}const n=e.getUID(),i=e.getUID();e.layerPromise=t.addLayer({id:i,type:TC.Consts.layerType.VECTOR,stealth:!0,owner:e,styles:{line:t.options.styles.line}});e.layer=null;Promise.all([e.layerPromise,e.renderPromise(),t.addControl("draw",{id:n,div:e.div.querySelector(e._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1})]).then(function(r){const n=e.layer=r[0],i=e.boxDraw=r[2];i.setLayer(n);i.on(TC.Consts.event.DRAWSTART,function(t){e.map.toast(e.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(t){var r=t.feature.geometry[0],n=r[0],i=r[2],a=Math.min(n[0],i[0]),l=Math.max(n[0],i[0]),c=Math.min(n[1],i[1]),u=Math.max(n[1],i[1]);e.setExtent([a,c,l,u]);const h=e._dialogDiv.querySelectorAll("input[type=checkbox]");h.forEach(function(t){const r=e.map.getLayer(t.value);for(var n=t;n&&"LI"!==n.tagName;)n=n.parentElement;const i=e.wrap.getRequestSchemas({extent:e.extent,layers:[r]})[0].tileMatrixLimits;n.classList.toggle(TC.Consts.classes.HIDDEN,!i.length)});const d=e._dialogDiv.querySelector(e._selectors.BLLISTITEM+":not(."+TC.Consts.classes.HIDDEN+")");e._dialogDiv.querySelector(e._selectors.BLLISTTEXT).innerHTML=e.getLocaleString(d?"selectAtLeastOne":"cb.noMapsAtSelectedExtent");o(e);s(e);TC.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-dialog"),{openCallback:function(){setTimeout(function(){h.forEach(function(t){t.disabled=!1})},100);var t;if(Date.prototype.toLocaleString){var r={};r.year=r.month=r.day=r.hour=r.minute=r.second="numeric";t=(new Date).toLocaleString(e.map.options.locale.replace("_","-"),r)}else t=(new Date).toString();e._dialogDiv.querySelector(e._selectors.NAMETB).value=t;e._updateReadyState()},closeCallback:function(){h.forEach(function(t){t.disabled=!0});e.boxDraw.layer.clearFeatures()}})});t.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){i===t.control&&e._state===e._states.EDITING&&e.setReadyState()})});var a=function(t){var r=!1;const n=e._dialogDiv.querySelector(e._selectors.BLLIST),i=function(){return!!n.querySelector('li[data-layer-uid="'+t.id+'"]')};var o=t.type===TC.Consts.layerType.WMTS&&!t.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(o=o&&TC.Util.isSameOrigin(t.url));if(o&&!i()){r=!0;e.getRenderedHtml(e.CLASS+"-bl-node",t,function(t){if(!i()){const e=new DOMParser;n.appendChild(e.parseFromString(t,"text/html").body.firstChild)}})}return r};t.on(TC.Consts.event.LAYERADD,function(t){if(t.layer.isBase&&e.mapIsOffline){const r=t.layer.getResolutions();if(r){const n=r.filter(t=>t>=e.currentMapDefinition.res);n.length&&t.layer.setResolutions(n)}}e.renderPromise().then(function(){a(t.layer)})}).on(TC.Consts.event.LAYERREMOVE,function(t){e.renderPromise().then(function(){const r=t.layer;if(r.type===TC.Consts.layerType.WMTS){const t=e._dialogDiv.querySelector(e._selectors.BLLIST).querySelector('li[data-layer-uid="'+r.id+'"]');t.parentElement.removeChild(t)}})});t.ready(function(){if(e.mapIsOffline){var r,n,i=[];for(r=0,n=e.offlineControls.length;r<n;r++){var o=e.offlineControls[r];o=o.substr(0,1).toUpperCase()+o.substr(1);i=i.concat(t.getControlsByClass("TC.control."+o))}for(r=0,n=t.controls.length;r<n;r++){var a=t.controls[r];i.indexOf(a)<0&&a.disable()}document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)})}});t.loaded(function(){e.layerPromise.then(function(e){t.putLayerOnTop(e)});e.renderPromise().then(function(){e.div.querySelector(e._selectors.NEWBTN).disabled=!1;t.baseLayers.forEach(a)});if(e.mapIsOffline){const r=e.currentMapDefinition,n=function(t,e){return(0===t.url.indexOf("//")?location.protocol+t.url:t.url)===r.url[e.urlIdx]&&t.layerNames===e.id&&t.matrixSet===r.tms[e.tmsIdx]},i=t.options.availableBaseLayers.filter(t=>t.type===TC.Consts.layerType.WMTS).filter(t=>r.layers.some(e=>n(t,e))).filter(e=>!t.baseLayers.some(t=>t.id===e.id));Promise.all(i.map(e=>t.addLayer(TC.Util.extend({},e,{isBase:!0})))).finally(function(){const i=[];for(var o=0,a=r.layers.length;o<a;o++)for(var s=0,l=t.baseLayers.length;s<l;s++){const e=t.baseLayers[s];if(e.type===TC.Consts.layerType.WMTS&&n(e,r.layers[o])){i.push(e);break}}i.length&&t.setBaseLayer(i[0],function(){for(var r=t.baseLayers.length-1;r>=0;r--){const e=t.baseLayers[r];e.type===TC.Consts.layerType.VECTOR||i.includes(e)||t.removeLayer(e)}t.setExtent(e.currentMapExtent,{animate:!1})})})}});e.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(r){e.isDownloading=!1;const n=function(t){const e=t.indexOf("#");return e>=0?t.substr(0,e):t}(r.url),i=l(e,n);if(i&&!e.serviceWorkerEnabled){i.classList.remove(TC.Consts.classes.DISABLED);TC.alert(e.getLocaleString("cb.delete.error"))}else if(e.currentMap&&n===e.currentMap.url){!function(t){const e=t.currentMap;if(c(t,e)){t.getRenderedHtml(t.CLASS+"-map-node",{name:e.name,url:e.url},function(e){const r=new DOMParser;t.div.querySelector(t._selectors.LIST).appendChild(r.parseFromString(e,"text/html").body.firstChild);t.div.querySelector(t._selectors.EMPTYLIST).setAttribute("hidden","hidden");t.div.querySelector(t._selectors.SEARCH).disabled=!1});t.storedMaps.push(e)}}(e);t.toast(e.getLocaleString("mapDownloaded",{mapName:e.currentMap.name}))}e.currentMap=null;e.setReadyState()}).on(TC.Consts.event.MAPCACHEDELETE,function(r){e.isDownloading=!1;var n=u(e,r.url)||e.currentMap&&e.currentMap.name;e.currentMap=null;n&&t.toast(e.getLocaleString("mapDeleted",{mapName:n}));e.setReadyState()}).on(TC.Consts.event.MAPCACHEPROGRESS,function(t){var r=t.total;!r&&e.requestSchemas&&(r=e.requestSchemas[0].tileCount);var n=t.loaded;if(n)e._loadedCount=n;else{e._loadedCount+=1;n=e._loadedCount}e.showDownloadProgress(n,r)}).on(TC.Consts.event.MAPCACHEERROR,function(t){e.isDownloading=!1;e.setReadyState();var r=e.getLocaleString("cb.mapCreation.error"),n=!0;switch(t.reason){case"quota":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==t.status&&u(e,t.url);n=!1;break;case"already_exists":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(n)if(TC.Util.detectIE()){TC.error(r);TC.alert(e.getLocaleString("cb.mapCreation.error.reasonEdge"))}else TC.alert(r);e.currentMap=null});return r};t.setExtent=function(t){if(Array.isArray(t)&&t.length>=4){this.extent=t;this.updateRequestSchemas()}};t._updateReadyState=function(){this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!this.extent||0===this._dialogDiv.querySelector(this._selectors.NAMETB).value.length||this._dialogDiv.querySelector(this._selectors.RNGMAXRES).disabled};t.setReadyState=function(){const t=this;t._state=t._states.READY;t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(t._selectors.LISTITEM).forEach(function(t){t.classList.remove(TC.Consts.classes.DISABLED)});t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!1;t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML="";t.extent=null;t._loadedCount=0;t.boxDraw&&t.boxDraw.cancel()};t.setEditState=function(){this._state=this._states.EDITING;this.showDownloadProgress(0,1);this.div.querySelector(this._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.DRAWING).classList.remove(TC.Consts.classes.HIDDEN);this.map.toast(this.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!0;this.div.querySelector(this._selectors.NEWBTN).disabled=!0;this._dialogDiv.querySelector(this._selectors.NAMETB).value="";this.boxDraw.activate()};t.generateCache=function(){const t=this,e={mapName:t._dialogDiv.querySelector(t._selectors.NAMETB).value};if(t.findStoredMap({name:e.mapName}))TC.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var r=function(){t.div.querySelector(t._classSelector+"-name").innerHTML=e.mapName;t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName}));!function(t){t._state=t._states.DOWNLOADING;TC.Util.closeModal();t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.remove(TC.Consts.classes.HIDDEN);t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!0;t.layer.clearFeatures();t.boxDraw.cancel()}(t);t.requestCache(e)};navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then(function(n){const i=(n.quota-n.usage)/1048576;t.estimatedMapSize<i?r():TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:a(t,t.estimatedMapSize),availableStorage:a(t,Math.round(i))}),r)}):r()}};t.cacheUrlList=function(t,e){var r=e||{};this.createCache(r.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:t,silent:r.silent})};t.requestCache=function(t){var e=this,r=t||{};if(e.map){var n=r.extent||e.extent||e.map.getExtent();e.updateRequestSchemas({extent:n});if(e.requestSchemas){for(var i=function(t,r,n){var i=t.res>=e.minResolution;!i&&r>0&&(i=n[r-1].res>e.minResolution);return i},o=function(t){return{mId:t.mId,cl:t.cl,cr:t.cr,rt:t.rt,rb:t.rb}},a=e.requestSchemas.map(function(t){return{layerId:t.layerId,tileMatrixLimits:t.tileMatrixLimits.filter(i)}}),s=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=a.length;l<c;l++){var u=a[l],h=(I=u.tileMatrixLimits[u.tileMatrixLimits.length-1]).res*I.tSize;s[0]=Math.min(s[0],I.origin[0]+h*I.cl);s[1]=Math.min(s[1],I.origin[1]-h*(I.rb+1));s[2]=Math.max(s[2],I.origin[0]+h*(I.cr+1));s[3]=Math.max(s[3],I.origin[1]-h*I.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(o)}var d=Math.pow(10,e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),p={bBox:s=s.map(function(t,e){return(e<3?Math.ceil:Math.floor)(t*d)/d}),res:Math.floor(1e3*e.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(e.baseLayers.length)};for(l=0,c=e.baseLayers.length;l<c;l++){var f=e.baseLayers[l],g=0===f.url.indexOf("//")?location.protocol+f.url:f.url,y=p.url.indexOf(g);y<0&&(y=p.url.push(g)-1);var m=p.tms.indexOf(f.matrixSet);m<0&&(m=p.tms.push(f.matrixSet)-1);var C=f.format.substr(f.format.indexOf("/")+1),v=p.format.indexOf(C);v<0&&(v=p.format.push(C)-1);p.layers[l]={urlIdx:y,id:f.layerNames,tmsIdx:m,formatIdx:v}}var T=TC.Util.getQueryStringParams(),_=T[e.MAP_EXTENT_PARAM_NAME]=s.toString();T[e.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(p));e.serviceWorkerEnabled&&(T[e.SERVICE_WORKER_FLAG]=1);var S=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+"?"+TC.Util.getParamString(T);e.currentMap={name:r.mapName,extent:_,url:S};e.isDownloading=!0;if(e.serviceWorkerEnabled){const t=[];for(l=0,c=a.length;l<c;l++){for(var E=a[l],w=null,b=0,L=e.baseLayers.length;b<L;b++){var A=e.baseLayers[b];if(A.id===E.layerId){w=e.wrap.getGetTilePattern(A);A.getFallbackLayer&&A.getFallbackLayer();A.thumbnail&&t.push(A.thumbnail);break}}if(w)for(var x=0,P=E.tileMatrixLimits.length;x<P;x++)for(var I,R=(I=E.tileMatrixLimits[x]).rt;R<=I.rb;R++)for(var O=I.cl;O<=I.cr;O++)t.push(w.replace("{TileMatrix}",I.mId).replace("{TileCol}",O).replace("{TileRow}",R))}t.push(S);e.cacheUrlList(t,{name:S})}}}};t.cancelCacheRequest=function(){var t=this;t.currentMap&&t.deleteCache(t.currentMap.url).then(function(e){e||(t.currentMap=null)});t.isDownloading=!1;t.setReadyState()};t.deleteMap=function(t){var e=this.findStoredMap({name:t});e&&this.deleteCache(e.url)};t.startDeleteMap=function(t){const e=this;if(navigator.onLine){if(t){var r=e.getLocaleString("cb.delete.confirm",{mapName:t});e.serviceWorkerEnabled||(r=r+" "+e.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(r))if(navigator.onLine){!function(t){t._state=t._states.DELETING;t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(t._selectors.LISTITEM).forEach(function(t){t.classList.add(TC.Consts.classes.DISABLED)});t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!1;t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML="";t.boxDraw.cancel()}(e);e.deleteMap(t)}else TC.alert(e.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(e.getLocaleString("cb.delete.conn.alert"))};t.findStoredMap=function(t){return this.storedMaps.filter(function(e){var r=!0;t.name&&t.name!==e.name&&(r=!1);r&&t.url&&t.url!==e.url&&(r=!1);return r})[0]};t.showDownloadProgress=function(t,e){const r=this,n=r._classSelector,i=r.div.querySelector(n+"-progress-count");if(e){var o=Math.min(Math.round(100*t/e),100)+"%";r.div.querySelector(n+"-progress-ratio").style.width=o;i.innerHTML=o}else{r.div.querySelector(n+"-progress-bar").classList.add(TC.Consts.classes.HIDDEN);i.innerHTML=r.getLocaleString("xFiles",{quantity:t})}};t.updateRequestSchemas=function(t){var e=t||{};e.extent=e.extent||this.extent;e.layers=e.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(e);return this.requestSchemas};t.getResolutions=function(){var t=[];const e=function(t){return t.res},r=this.requestSchemas.map(function(t){return t.tileMatrixLimits.map(e)});(t=t.concat.apply(t,r)).sort(function(t,e){return e-t});return t}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.ControlContainer=function(){var t=this;TC.control.Container.apply(t,arguments);t._classSelector="."+t.CLASS;if(!Array.isArray(t.controlOptions)){console.log("Gestionamos config de controlContainer antiguo");var e=[];Object.keys(t.controlOptions).forEach(r=>{const n=t.controlOptions[r];var i={position:n.side};i[r]=n.options;e.push(i)});t.controlOptions=e}};TC.inherit(TC.control.ControlContainer,TC.control.Container);!function(){var t=TC.control.ControlContainer.prototype;t.CLASS="tc-ctl-cctr";t.POSITION={LEFT:"left",RIGHT:"right"};t.SIDE=t.POSITION;t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<ul class="tc-ctl-cctr-left">').s(e.get(["controls"],!1),e,{block:r},{}).w('</ul><ul class="tc-ctl-cctr-right">').s(e.get(["controls"],!1),e,{block:i},{}).w("</ul>")}e.__dustBody=!0;function r(t,e){return t.h("eq",e,{block:n},{key:e.get(["position"],!1),value:"left"})}r.__dustBody=!0;function n(t,e){return t.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(e.get(["index"],!1),e,"h").w('"><div></div></li>')}n.__dustBody=!0;function i(t,e){return t.h("eq",e,{block:o},{key:e.get(["position"],!1),value:"right"})}i.__dustBody=!0;function o(t,e){return t.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(e.get(["index"],!1),e,"h").w('"><div></div></li>')}o.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(e.get(["index"],!1),e,"h").w('"><div></div></li>')}e.__dustBody=!0;return e};t.onRenderPromise=function(){const t=this;for(var e=new Array(t.ctlCount),r=0,n=t.controlOptions.length;r<n;r++){var i=t.controlOptions[r],o=Object.keys(i).filter(t=>["position","index"].indexOf(t)<0)[0];e[r]=t.map.addControl(o,TC.Util.extend({id:t.uids[r],div:t.div.querySelector("."+t.CLASS+"-elm-"+r).querySelector("div")},i[o]))}Promise.all(e).then(function(){for(var e=0,r=arguments.length;e<r;e++){arguments[e].containerControl=t}})};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({controls:Object.keys(e.controlOptions).map(function(t,r){return TC.Util.extend(e.controlOptions[t],{index:r})})}))};t.addControl=function(t,e){const r=this;e.position=e.position||e.side||r.POSITION.LEFT;return new Promise(function(n,i){r.getRenderedHtml(r.CLASS+"-node",{index:++r.ctlCount},function(i){var o=document.createElement("template");o.innerHTML=i.trim();r.div.querySelector("ul."+r.CLASS+"-"+e.position).appendChild(o.content?o.content.firstChild:o.firstChild);r.map.addControl(t,TC.Util.extend({id:r.getUID(),div:r.div.querySelector("."+r.CLASS+"-elm-"+r.ctlCount).querySelector("div")},e)).then(function(t){n(t)})})})};t.addElement=function(t){t.position=t.position||t.side||this.POSITION.LEFT;var e=document.createElement("li");e.setAttribute("class",this.CLASS+"-elm "+this.CLASS+"-elm-"+this.ctlCount+++" ");this.div.querySelector("ul."+this.CLASS+"-"+t.position).appendChild(e);var r=e.appendChild(t.htmlElement);r.setAttribute("class",r.getAttribute("class")+" tc-ctl");return r}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);TC.Util.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var t=TC.control.Coordinates.prototype;t.CLASS="tc-ctl-coords";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(e.get(["crs"],!1),e,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",e,{},{$key:"changeCRS"}).w('">').f(e.get(["crs"],!1),e,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(e.get(["isGeo"],!1),e,{else:r,block:i},{}).w("</div>").x(e.get(["showGeo"],!1),e,{block:a},{}).w('<span class="close"></span>')}e.__dustBody=!0;function r(t,e){return t.w('x: <span class="tc-ctl-coords-x">').f(e.get(["x"],!1),e,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(e.get(["y"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w('z: <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}n.__dustBody=!0;function i(t,e){return t.h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(e.get(["lat"],!1),e,"h").w("</span> ").h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(e.get(["lon"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:o},{})}i.__dustBody=!0;function o(t,e){return t.h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}o.__dustBody=!0;function a(t,e){return t.w('<div class="tc-ctl-coords-alt"><div class="tc-ctl-coords-xy">').h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(e.get(["lat"],!1),e,"h").w("</span> ").h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(e.get(["lon"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:s},{}).w("</div></div>")}a.__dustBody=!0;function s(t,e){return t.h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}s.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",e,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",e,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",e,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};t.register=function(t){var e=this;const r=TC.control.ProjectionSelector.prototype.register.call(e,t);e.crs=e.map.crs;e.clear();t.on(TC.Consts.event.VIEWCHANGE,function(t){const r=t.view;if(r===TC.Consts.view.PRINTING)return;const n=function(t){e.isPointerOver(t)||e.clear()};if(r===TC.Consts.view.THREED){e.isGeo=!0;e.units=TC.Consts.units.DEGREES;e.crs=e.map.view3D.crs;e.map.view3D.container.addEventListener("mouseout",n);e.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(t){if(t){if(TC.Util.detectMobile()){e.clear();e.coordsToClick({coordinate:[t.lon,t.lat,t.ele],cssClass:e._cssClasses.THREEDMARKER})}e.latLon=[t.lat,t.lon];if(t.ele>0){var r=TC.Util.getMapLocale(e.map);e.latLon.push(t.ele.toLocaleString(r)+"m")}e.update()}else e.clear()})}else if(r===TC.Consts.view.DEFAULT){e.isGeo=e.map.wrap.isGeo();e.units=TC.Consts.units.METERS;e.crs=e.map.crs;e.map.view3D&&e.map.view3D.container.removeEventListener("mouseout",n)}if(e.map.view3D){e.geoCrs=e.map.view3D.crs;e.render()}});t.loaded(function(){e.wrap.register(t).then(function(){e.render(function(){e.clear()})});TC.Util.detectMobile()&&e.renderPromise().then(function(){e.getLayer();e.activateCoords()});t.on(TC.Consts.event.PROJECTIONCHANGE,function(r){if(!t.on3DView){e.isGeo=t.wrap.isGeo();e.crs=r.newCrs;e.render()}});e.map.wrap.getViewport().then(function(t){e.renderPromise().then(function(){t.addEventListener(TC.Consts.event.MOUSEMOVE,function(t){e.map.on3DView||e.onMouseMove(t)});t.addEventListener(TC.Consts.event.MOUSELEAVE,function(t){e.onMouseLeave(t)})})})});return r};t.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.renderData.call(e,{x:e.x,y:e.y,lat:e.lat,lon:e.lon,ele:e.isGeo&&e.latLon.length>2?e.latLon[2]:!e.isGeo&&e.xy.length>2?e.xy[2]:null,crs:e.crs,geoCrs:e.geoCrs,isGeo:e.isGeo,showGeo:!e.isGeo&&e.options.showGeo},function(){e.div.querySelector("button."+e._cssClasses.CRS).addEventListener(TC.Consts.event.CLICK,function(t){e.showProjectionChangeDialog()});TC.Util.isFunction(t)&&t()})}))};t.onMouseMove=function(t){this.wrap.onMouseMove(t)};t.onMouseLeave=function(t){const e=this;setTimeout(function(){if(!e.isPointerOver(t)){e.div.style.visibility="hidden";e.clear()}},200)};t.isPointerOver=function(t){var e=this.div.getBoundingClientRect();return e.left<=t.clientX&&e.left+e.width>=t.clientX&&e.top<=t.clientY&&e.top+e.height>=t.clientY};t.update=function(){const t=this;!t.isGeo&&t.options.showGeo&&(t.latLon=TC.Util.reproject(t.xy,t.crs,t.geoCrs).reverse());if(!t.isGeo){t.x=TC.Util.formatCoord(t.xy[0],TC.Consts.METER_PRECISION);t.y=TC.Util.formatCoord(t.xy[1],TC.Consts.METER_PRECISION)}if(t.isGeo||t.options.showGeo){t.lat=TC.Util.formatCoord(t.latLon[0],TC.Consts.DEGREE_PRECISION);t.lon=TC.Util.formatCoord(t.latLon[1],TC.Consts.DEGREE_PRECISION)}t.render(function(){const e=t.div.querySelector("span.close");if(TC.Util.detectMobile()){e.addEventListener("click",function(){t.div.classList.add(TC.Consts.classes.HIDDEN);t.clear()});e.style.display=""}else{t.div.classList.remove(TC.Consts.classes.HIDDEN);t.div.style.visibility="visible";e.style.display="none"}})};t.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(t){t.clearFeatures()})};t.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};t.activateCoords=function(){this.wrap.coordsActivate()};t.getCoords=function(){var t=this.map.getControlsByClass(TC.control.Popup);if(t&&t.length>0&&t[0].isVisible())this.coordsToPopup(t[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};t.coordsToPopup=function(t){t&&this.updateCoordsCtrl(t.wrap.popup.getPosition())};t.updateCoordsCtrl=function(t){if(t){if(!this.isGeo){this.x=t[0];this.y=t[1];this.xy=[this.x,this.y];t.length>2&&this.xy.push(t[2])}if(this.isGeo||this.options.showGeo){this.lat=t[0];this.lon=t[1];this.latLon=[this.lat,this.lon];t.length>2&&this.latLon.push(t[2])}this.update()}};t.coordsToClick=function(t){var e=this;if(!e.map.div.classList.contains("tc-ctl-sv-active")||!e.map.div.classList.contains(TC.Consts.classes.COLLAPSED)){var r=e.div.getBoundingClientRect();if(r.left<=t.clientX&&t.clientX<=r.right&&r.top<=t.clientY&&t.clientY<=r.bottom){e.div.classList.add(TC.Consts.classes.HIDDEN);e.clear();return}e.div.classList.remove("tc-fading");setTimeout(function(){e.div.classList.add("tc-fading")},10);e.updateCoordsCtrl(t.coordinate);e.map.on3DView||e.coordsMarkerAdd(t.coordinate,t.cssClass);e.div.classList.remove(TC.Consts.classes.HIDDEN)}};t.coordsMarkerAdd=function(t,e){var r=this;r.currentCoordsMarker?r.currentCoordsMarker.setCoords(t):r.getLayer().then(function(n){n.addMarker(t,{title:"Coord",showsPopup:!1,cssClass:e||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(t){r.currentCoordsMarker=t})})};t.getLayer=function(){const t=this;return new Promise(function(e,r){null==t.layer?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,owner:t,title:"Coordenadas"}).then(function(r){t.layer=r;t.layer.map.putLayerOnTop(t.layer);e(t.layer)}):e(t.layer)})}}();TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.DataLoader=function(){TC.control.TabContainer.apply(this,arguments);this.controlOptions=[{name:"externalWMS",title:"addWMS",options:{suggestions:this.options.wmsSuggestions}},{name:"fileImport",options:{enableDragAndDrop:this.options.enableDragAndDrop}}];this.defaultSelection=0};TC.inherit(TC.control.DataLoader,TC.control.TabContainer);TC.control.DataLoader.prototype.register=function(t){const e=this;e.title=e.getLocaleString("addMaps");return new Promise(function(r,n){TC.control.TabContainer.prototype.register.call(e,t).then(t=>{t.div.classList.add(e.CLASS+"-datldr");r(t)})})};TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");TC.Consts.DownloadError={MIMETYPE_NOT_SUPORTED:"MimeTypeNotSupported"};TC.control.Download=function(t){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this._hiddenElms=[];var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv)};TC.inherit(TC.control.Download,TC.control.MapInfo);!function(){var t=TC.control.Download.prototype;t.CLASS="tc-ctl-download";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"download"}).w(' </h2><div class="tc-ctl-tctr tc-ctl-tctr-select"><form><label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",e,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",e,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-collapsed"><div><label>').h("i18n",e,{},{$key:"format"}).w(':</label><select class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr-').f(e.get(["controlId"],!1),e,"h").w('" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr-').f(e.get(["controlId"],!1),e,"h").w('" class="tc-ctl-download-image-qr-label" title="').h("i18n",e,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",e,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",e,{},{$key:"download"}).w('</button></div><div class="tc-ctl-download-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w('</p></div></div></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-collapsed"><div><label>').h("i18n",e,{},{$key:"format"}).w(':</label><select class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",e,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg-').f(e.get(["controlId"],!1),e,"h").w('"><strong>').h("i18n",e,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",e,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg-').f(e.get(["controlId"],!1),e,"h").w('"><strong>').h("i18n",e,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",e,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg-').f(e.get(["controlId"],!1),e,"h").w('"><strong>').h("i18n",e,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",e,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg-').f(e.get(["controlId"],!1),e,"h").w('"><strong>').h("i18n",e,{},{$key:"noData"}).w(": </strong>").h("i18n",e,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg-').f(e.get(["controlId"],!1),e,"h").w('"><strong>').h("i18n",e,{},{$key:"noValidService"}).w(": </strong>").h("i18n",e,{},{$key:"noValidService.instructions"}).w("</p></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"downloadData"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",e,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",e,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.renderData.call(e,{controlId:e.id},function(){const r=".tc-ctl-tctr";e._selectors={TAB:r+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:r+"-elm"};const n=function(t){for(var r=this;r&&!r.matches(e._selectors.TAB);)r=r.parentElement;if(r){const t=r.querySelector(e._selectors.RADIOBUTTON),n=t.value,i=e.div.querySelectorAll(e._selectors.ELEMENT);if(e._oldValue===n&&e.options.deselectable){setTimeout(function(){t.checked=!1},0);e._oldValue=null;e._activeElm=null;i.forEach(function(t){e._hiddenElms.push(t)})}else{i.forEach(function(t){t.matches(e._selectors.ELEMENT+"-"+n)?e._activeElm=t:e._hiddenElms.push(t)});e._oldValue=n}e._hiddenElms.forEach(function(t){t.classList.add(TC.Consts.classes.COLLAPSED)});e._activeElm&&e._activeElm.classList.remove(TC.Consts.classes.COLLAPSED);t.checked=!0}};e.div.querySelectorAll("span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,n)});t&&t()})})};t.register=function(t){var e=this;const r=TC.control.MapInfo.prototype.register.call(e,t);e.map.mustBeExportable=!0;var n=function(t,r){const n=e.div.querySelector(".alert-warning:not(."+e.CLASS+"-alert)");var i;switch(t.key){case TC.Consts.WFSErrors.MAX_NUM_FEATURES:i=n.querySelector("#zoom-msg-"+e.id).innerHTML.format({serviceName:t.params.serviceTitle});break;case TC.Consts.WFSErrors.NO_LAYERS:i=e.getLocaleString("noLayersLoaded");break;case TC.Consts.WFSErrors.GETCAPABILITIES:i=n.querySelector("#novalid-msg-"+e.id).innerHTML.format({serviceName:t.params.serviceTitle});break;case TC.Consts.WFSErrors.NO_FEATURES:i=n.querySelector("#noFeatures-msg-"+e.id).innerHTML;break;case TC.Consts.WFSErrors.INDETERMINATE:i=e.getLocaleString("wfs.IndeterminateError");e.map.toast(i,{type:TC.Consts.msgType.ERROR});TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:t.params.err,descripcion:t.params.errorThrown,serviceName:t.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);e.map.getLoadingIndicator().removeWait(r);return;default:i=e.getLocaleString("wfs."+t.key,t.params)}e.map.toast(i,{type:TC.Consts.msgType.WARNING});e.map.getLoadingIndicator().removeWait(r)};e.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-btn",function(){var t=e.map.getLoadingIndicator().addWait(),r="";e._activeElm&&(r=e._activeElm.querySelector("select").value);if(r.indexOf("image")>-1)new Promise(function(r,n){var i=e.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],o=TC.Util.cloneCanvas(i);e.map.getControlsByClass(TC.control.ScaleBar)&&e.drawScaleBarIntoCanvas({canvas:o,fill:!0});if(e._activeElm.querySelector(`#${e.CLASS}-image-qr-${e.id}:checked`)){const n="qrcode";var a=document.getElementById(n);if(a)a.innerHTML="";else{(a=document.createElement("div")).setAttribute("id",n);document.body.appendChild(a)}a.style.top="-200px";a.style.left="-200px";a.style.position="absolute";e.makeQRCode(a,87,87).then(function(n){if(n){var i=o.getContext("2d");i.fillStyle="#ffffff";i.fillRect(o.width-91,o.height-91,91,91);TC.Util.addToCanvas(o,n,{x:o.width-88,y:o.height-88}).then(function(t){r(t)})}else{TC.error(e.getLocaleString("dl.export.map.error")+": QR");e.map.getLoadingIndicator().removeWait(t)}})}else r(o)}).then(function(n){try{const t=n.toDataURL(r);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+r.split("/")[1],r,t)}catch(t){TC.error(e.getLocaleString("dl.export.map.error")+": "+t.message)}e.map.getLoadingIndicator().removeWait(t)});else{var i=e.map.getExtent(),o=TC.WFSGetFeatureBuilder(e.map,TC.filter.bbox(i,e.map.getCRS()),r,!0);Promise.all(o).then(async function(i){var o=i.filter(function(t){return null!=t});if(0!==o.length){for(var a=[],s=0;s<o.length;s++)if(o[s].errors&&o[s].errors.length)for(var l=0;l<o[s].errors.length;l++){var c=o[s].errors[l];n(c,t)}else{var u=o[s].data,h=o[s].url;u&&h&&a.push({url:h+"?download=zip",data:u})}try{await TC.Util.downloadFileForm(a)}catch(t){if(t.key===TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED){const n=i.find(function(e){return e.data===t.data}).service,o={plural:n.layers.length>1?e.getLocaleString("dl.format.notSupported.plural"):"",layerNames:n.layers.reduce(function(t,r,n,i){return(t instanceof Array?t:[t]).concat([r.title]).join(n<i.length-1?", ":" "+e.getLocaleString("dl.format.notSupported.conjunction")+" ")},[]),serviceTitle:n.mapLayers[0].title,format:r};e.map.toast(e.getLocaleString("dl.format.notSupported").format(o),{type:TC.Consts.msgType.ERROR})}}e.map.getLoadingIndicator().removeWait(t)}else n({key:TC.Consts.WFSErrors.NO_LAYERS},t)})}}));e.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-help",function(t){t.stopPropagation();TC.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-help-dialog"))}));e.div.addEventListener("change",TC.EventTarget.listenerBySelector(`#${e.CLASS}-image-qr-${e.id}`,function(t){t.target.checked?e.generateLink():e.div.querySelector("."+e.CLASS+"-alert").classList.add(TC.Consts.classes.HIDDEN)}));e.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){e.generateLink();e.registerListeners()}));return r};t.manageMaxLengthExceed=function(t){const e=this.div.querySelector("."+this.CLASS+"-alert");document.getElementById(`${this.CLASS}-image-qr-${this.id}`).checked?e.classList.toggle(TC.Consts.classes.HIDDEN,!t.qr):e.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.POINT="point.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change";!function(){const t=function(t){const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return e&&e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:t};TC.control.Draw=function(){var t=this;TC.Control.apply(t,arguments);if(!TC.browserFeatures.inputTypeColor()&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}t._classSelector="."+t.CLASS;t._pointClass=t.CLASS+"-point";t._lineClass=t.CLASS+"-line";t._polygonClass=t.CLASS+"-polygon";t.history=[];t.historyIndex=0;t.exportsState=!0;t.on(TC.Consts.event.DRAWSTART,function(e){t.resetValues()}).on(TC.Consts.event.POINT,function(e){t.layer&&!t.persistent&&t.layer.features&&t.layer.features.length>0&&t.layer.clearFeatures();t.history.length=t.historyIndex;t.history[t.historyIndex++]=e.point;r(t)}).on(TC.Consts.event.DRAWEND,function(e){n(t);e.feature.setId(TC.getUID(t.getLocaleString("sketch")+"."));t.callBack&&t.callBack(e.feature)});t._layerPromise=null};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var r=function(t){t._endBtn.disabled=0===t.historyIndex||t.mode===TC.Consts.geom.POLYGON&&t.historyIndex<3||t.mode===TC.Consts.geom.POLYLINE&&t.historyIndex<2;t._redoBtn.disabled=t.history.length===t.historyIndex;t._undoBtn.disabled=0===t.historyIndex},n=function(t){t.resetValues();t._endBtn.disabled=!0;t._cancelBtn.disabled=!1};e.template=function(){dust.register(e.CLASS,t);function t(t,e){return t.w('<div class="tc-ctl-draw-tools"><button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(e.get(["tooltip"],!1),e,"h").w('">').h("i18n",e,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",e,{},{$key:"undo"}).w('">').h("i18n",e,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",e,{},{$key:"redo"}).w('">').h("i18n",e,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="').h("i18n",e,{},{$key:"end"}).w('">').h("i18n",e,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w("</button></div>").x(e.get(["styleTools"],!1),e,{block:r},{})}t.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-draw-style">').h("i18n",e,{},{$key:"strokeColor"}).w('<input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="').f(e.get(["strokeColor"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"selectColor"}).w('" />').h("i18n",e,{},{$key:"strokeWidth"}).w('<div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:').f(e.get(["strokeWidth"],!1),e,"h").w('px;"> </div><input type="number" class="tc-ctl-draw-str-w tc-textbox" value="').f(e.get(["strokeWidth"],!1),e,"h").w('" min="1" max="15" /></div>')}r.__dustBody=!0;return t};e.render=function(e){var r,n,i,o=this;switch(o.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:r=o.getLocaleString("drawLine");o.div.classList.add(o._lineClass);n=TC.Cfg.styles.line.strokeColor;i=TC.Cfg.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:r=o.getLocaleString("drawPolygon");o.div.classList.add(o._polygonClass);n=TC.Cfg.styles.polygon.strokeColor;i=TC.Cfg.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:r=o.getLocaleString("drawPoint");o.div.classList.add(o._pointClass);n=TC.Cfg.styles.point.strokeColor;i=TC.Cfg.styles.point.strokeWidth;break;default:r=o.getLocaleString("draw");n=TC.Cfg.styles.line.strokeColor;i=TC.Cfg.styles.line.strokeWidth}const a={tooltip:r,strokeColor:t(n),strokeWidth:i,styleTools:o.options.styleTools};return o._set1stRenderPromise(o.renderData(a,function(){if(!TC.browserFeatures.inputTypeColor()){const t=o.div.querySelector("input[type=color]");if(t){t.style.backgroundColor=t.value;t.style.color="transparent";const e=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()};t.onfocus=function(t){this.blur()};t.onchange=function(t){this.style.backgroundColor=this.value};o.map.loaded(function(){e.on("change",function(t){o.setStrokeColor("#"+t)})})}}o.reset=!0;o.callBack=null;o.measure=!1;o._cancelClick=!1;o.mode=o.options.mode||TC.Consts.geom.POLYLINE;o.options.measure&&(o.measure=o.options.measure);TC.Util.isFunction(o.options.callback)&&(o.callBack=o.options.callback);void 0===o.options.persistent?o.persistent=!0:o.persistent=o.options.persistent;o.wrap=new TC.wrap.control.Draw(o);o._newBtn=o.div.querySelector(o._classSelector+"-btn-new");o._newBtn.addEventListener(TC.Consts.event.CLICK,function(){o.new()});o._cancelBtn=o.div.querySelector(o._classSelector+"-btn-cancel");o._cancelBtn.addEventListener(TC.Consts.event.CLICK,function(){o.cancel()});o._endBtn=o.div.querySelector(o._classSelector+"-btn-end");o._endBtn.addEventListener(TC.Consts.event.CLICK,function(){o.end()});o._undoBtn=o.div.querySelector(o._classSelector+"-btn-undo");o._undoBtn.addEventListener(TC.Consts.event.CLICK,function(){o.undo()});o._redoBtn=o.div.querySelector(o._classSelector+"-btn-redo");o._redoBtn.addEventListener(TC.Consts.event.CLICK,function(){o.redo()});if(o.options.styleTools){o._strokeColorPicker=o.div.querySelector(o._classSelector+"-str-c");o._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE,function(t){o.setStrokeColor(t.target.value)});o._strokeWidthSelector=o.div.querySelector(o._classSelector+"-str-w");o._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE,function(t){o.setStrokeWidth(t.target.value)});o._strokeWidthWatch=o.div.querySelector(o._classSelector+"-str-w-watch")}TC.Util.isFunction(e)&&e()}))};e.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.map.on(TC.Consts.event.VIEWCHANGE,function(){e.map.view===TC.Consts.view.PRINTING&&e.end()});e._layerPromise=new Promise(function(r,n){t.loaded(function(){if(e.options.layer){e.setLayer(e.options.layer);r(e.layer)}else if(!1===e.options.layer){e.setLayer(null);r(null)}else t.addLayer({id:e.getUID(),title:"DrawControl",stealth:!0,owner:e,type:TC.Consts.layerType.VECTOR,styles:{point:t.options.styles.point,line:t.options.styles.line,polygon:t.options.styles.polygon}}).then(function(n){t.putLayerOnTop(n);e.setLayer(n);r(e.layer)})})});return r};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._cancelBtn.disabled=!1;this.setMode(this.mode,!0);return this};e.undo=function(){var t=this.wrap.undo();if(t){this.historyIndex--;r(this);this.historyIndex<=0&&this.resetValues();this.trigger(TC.Consts.event.DRAWUNDO)}return t};e.redo=function(){var t=this.wrap.redo();if(t){this.historyIndex++;r(this);this.trigger(TC.Consts.event.DRAWREDO)}return t};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();n(this);this._cancelBtn.disabled=!0;this.trigger(TC.Consts.event.DRAWCANCEL,{ctrl:this});return this};e.activate=function(){this._newBtn.classList.add(TC.Consts.classes.ACTIVE);this._cancelBtn.disabled=!1;TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this.div.classList.remove(this._pointClass,this._lineClass,this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this.div.classList.add(this._pointClass);break;case TC.Consts.geom.POLYLINE:this.div.classList.add(this._lineClass);break;case TC.Consts.geom.POLYGON:this.div.classList.add(this._polygonClass)}};e.deactivate=function(){this._newBtn&&this._newBtn.classList.remove(TC.Consts.classes.ACTIVE);this._cancelBtn&&(this._cancelBtn.disabled=!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const t=this;t.layer&&t.layer.clearFatures();t.resetValues();return t};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(t,e){const r=this;t&&(r.mode=t);e&&t?r.activate():r.deactivate();return r};e.setStyle=function(t){const e=this;if(t)e.style=TC.Util.extend(e.style,t);else switch(e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t={line:e.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t={polygon:e.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t={point:e.styles.point};break;default:t={}}e.isActive&&e.wrap.setStyle(t)};e.getModeStyle=function(t){const e=this;switch(t=t||e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return e.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return e.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return e.styles.point;default:return null}};e.setStrokeColorWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeColor);const r=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);r&&r.length&&(t="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]);e._strokeColorPicker.value=t;if(!TC.browserFeatures.inputTypeColor()){const r=e._strokeColorPicker;r.style.backgroundColor=t;r.blur()}}return e};e.setStrokeColor=function(t){const e=this,r=e.getModeStyle();r&&(r.strokeColor=t);e.isActive&&e.setStyle();e.setStrokeColorWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:t});return e};e.setStrokeWidthWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeWidth);if((t=parseInt(t,10))!==Number.NaN){e._strokeWidthSelector.value=t;e._strokeWidthWatch.style.borderBottomWidth=t+"px"}}return e};e.setStrokeWidth=function(t){const e=this;if((t=parseInt(t,10))!==Number.NaN){const r=e.getModeStyle();r&&(r.strokeWidth=t);e.isActive&&e.setStyle();e.setStrokeWidthWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:t})}return e};e.getLayer=function(){const t=this;return t.layer?Promise.resolve(t.layer):this._layerPromise};e.setLayer=function(t){const e=this;if(e.map){e.layer="string"==typeof t?e.map.getLayer(t):t;e.styles={};const r=e.layer&&e.layer.styles||TC.Cfg.styles;TC.Util.extend(!0,e.styles,e.options.styles||r)}};e.resetValues=function(){this.history.length=0;this.historyIndex=0;r(this);return this};e.exportState=function(){const t=this;return t.exportsState?{id:t.id,layer:t.layer.exportState()}:null};e.importState=function(t){this.getLayer().then(function(e){e.importState(t.layer)})}}();TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var t=this;TC.control.Measure.apply(t,arguments);t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]"};t.persistentDrawControls=!0;t.renderPromise().then(function(){t._1stCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-1-t");t._2ndCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-2-t");t._1stCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-1-v");t._2ndCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-2-v");t._elevationText=t.div.querySelector(".tc-ctl-meas-val-coord-ele-t");t._elevationValue=t.div.querySelector(".tc-ctl-meas-val-coord-ele-v")})};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var t=TC.control.DrawMeasureModify.prototype;t.CLASS="tc-ctl-dmm";var e=null;TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const r=[],n=function(t){return r.filter(function(e){return e.feature===t})[0]},i=function(t){const e=r.reduce(function(e,r,n){return r.feature===t?n:e},-1);e>=0&&r.splice(e,1)};t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",e,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",e,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",e,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",e,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",e,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",e,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",e,{},{$key:"deleteAll"}).w('">').h("i18n",e,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",e,{},{$key:"download"}).w('">').h("i18n",e,{},{$key:"download"}).w("...</button></div></div>")}e.__dustBody=!0;return e};t.render=function(t){const e=this,r=e._set1stRenderPromise(TC.control.Measure.prototype.render.call(e,function(){e._clearBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");e._clearBtn.addEventListener(TC.Consts.event.CLICK,function(t){TC.confirm(e.getLocaleString("deleteAll.confirm"),function(){e.clear()})});e._downloadBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");e._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(t){e.showSketchDownloadDialog()});e._elevProfileBtn=e.div.querySelector(".tc-ctl-meas-prof-btn");e._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(t){e.elevationProfileActive?e.deactivateElevationProfile():e.activateElevationProfile()});e.options.displayElevation||(e._elevProfileBtn.style.display="none");TC.Util.isFunction(t)&&t()}));e.getUID(),e.options.displayElevation;return r};t.register=function(t){const e=this;return new Promise(function(o,a){TC.control.Measure.prototype.register.call(e,t).then(function(){const a=e.getUID(),s=e.getUID(),l=new Promise(function(t,r){if(e.options.displayElevation){e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const r="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(r);t(e.elevation)})}else if(e.map.elevation){e.elevation=e.map.elevation;t(e.elevation)}else t()});Promise.all([e.layerPromise,e.renderPromise(),l]).then(function(l){const c=l[0];c.title=e.getLocaleString("sketch");e._modifyPromise=t.addControl("modify",{id:s,div:e.div.querySelector("."+e.CLASS+"-mod"),layer:c});e._modifyPromise.then(function(r){e.modify=r;r.on(TC.Consts.event.FEATURESSELECT,function(t){e.resultsPanelChart&&!t.features.some(function(t){return e.resultsPanelChart.currentFeature===t})&&e.resultsPanelChart.setCurrentFeature(null);const r=t.features[t.features.length-1];if(r){e.showMeasures(e.getFeatureMeasureData(r));const t=r._originalStyle||r.getStyle();switch(!0){case TC.feature.Polygon&&r instanceof TC.feature.Polygon:e.displayMode(TC.Consts.geom.POLYGON);e.polygonDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth);break;case TC.feature.Polyline&&r instanceof TC.feature.Polyline:e.displayMode(TC.Consts.geom.POLYLINE);e.lineDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth);const i=n(r);if(i){e.resultsPanelChart.setCurrentFeature(r);e.renderElevationChart(i.data)}break;case TC.feature.Point&&r instanceof TC.feature.Point:e.displayMode(TC.Consts.geom.POINT);e.pointDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth)}e.modify.setFontColorWatch(t.fontColor).setFontSizeWatch(t.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(t){e.modify.getSelectedFeatures().length||e.resetDrawWatches();e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(t){if(t.layer===e.layer){i(t.feature);const r=function(t){const r=e.getFeatureMeasureData(t);e.showMeasures(r);e.setFeatureMeasureData(t)};r(t.feature);e.options.displayElevation&&TC.feature.Point&&t.feature instanceof TC.feature.Point&&e.elevation.setGeometry({features:[t.feature],crs:e.map.crs}).then(function(t){r(t[0])});e.map.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===t.feature&&e.isVisible()&&e.hide()})}});t.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){const r=t.control;if(r===e.modify){e.resetDrawWatches();e.resetElevationProfile();if(e.resultsPanelChart){e.resultsPanelChart.setCurrentFeature(null);e.resultsPanelChart.close()}}else if(r===e.lineDrawControl){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}}).on(TC.Consts.event.POPUP,function(t){const r=t.control.currentFeature;if(TC.feature.Polyline&&r instanceof TC.feature.Polyline&&e.layer.features.indexOf(r)>=0&&e.elevationProfileActive){t.control.hide();e.resultsPanelChart&&e.resultsPanelChart.setCurrentFeature(r);const i=n(r);if(e.resultsPanelChart){e.resultsPanelChart.currentFeature=r;e.resultsPanelChart.isMinimized()&&e.resultsPanelChart.maximize()}i?e.renderElevationChart(i.data):e.displayElevationProfile(r.geometry)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.elevationChartData&&(e.elevationChartData.coords=TC.Util.reproject(e.elevationChartData.coords,t.oldCrs,t.newCrs))})});e._lineDrawControlPromise.then(function(t){t.on(TC.Consts.event.DRAWSTART,function(){e.resultsPanelChart&&e.resultsPanelChart.currentFeature&&e.resultsPanelChart.setCurrentFeature(null);e.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){e.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(t){e.resultsPanelChart&&(e.resultsPanelChart.currentFeature=t.feature)}).on(TC.Consts.event.POINT,function(t){const r=this.history.slice(0,this.historyIndex),n=r[r.length-1];n[0]===t.point[0]&&n[1]===t.point[1]||r.push(t.point);e.displayElevationProfile(r)}).on(TC.Consts.event.STYLECHANGE,function(t){e.onStyleChange(t)})});e._polygonDrawControlPromise.then(function(t){t.on(TC.Consts.event.DRAWSTART,function(){e.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(t){e.onStyleChange(t)})});e._pointDrawControlPromise=t.addControl("draw",{id:a,div:e.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:e.persistentDrawControls,styleTools:!0,layer:e.layer});e._pointDrawControlPromise.then(function(r){r.containerControl=e;e.drawControls.push(r);e.pointDrawControl=r;e.resetValues();r.on(TC.Consts.event.DRAWEND,function(r){const n=function(r){e.showMeasures({coords:r.geometry,units:t.wrap.isGeo()?"degrees":"m"});e.setFeatureMeasureData(r)};n(r.feature);e.options.displayElevation&&e.elevation.setGeometry({features:[r.feature],crs:e.map.crs}).then(function(t){n(t[0])})}).on(TC.Consts.event.DRAWCANCEL,function(t){setTimeout(function(){e.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(t){e.onStyleChange(t)});r.exportsState=!1});e.setMode(e.options.mode);t.on(TC.Consts.event.FEATUREADD,function(t){const r=t.layer,n=t.feature;if(r===e.layer){e.setFeatureMeasureData(n);e._modifyPromise.then(function(t){t.displayLabelText(n.getStyle().label)});e._clearBtn.disabled=!1;e._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){const n=t.layer,o=t.feature;if(n===e.layer)if(0===e.layer.features.length){e._clearBtn.disabled=!0;e._downloadBtn.disabled=!0;e.resetValues();r.length=0}else o&&i(o)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(t){const e=t.control;e.setCurrentFeature&&e.setCurrentFeature(null)});o(e)})}).catch(function(t){a(t)})})};t.displayMode=function(t){const e=this;t===TC.Consts.geom.POINT&&(e._activeMode=e.div.querySelector(".tc-ctl-meas-pt"));e.modify&&e.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(e,t)};t.setMode=function(t){const e=this;t===TC.Consts.geom.POINT&&e.pointDrawControl.activate();return TC.control.Measure.prototype.setMode.call(e,t)};t.setFeatureMeasureData=function(t){const e=this,r={};switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:const n=e._1stCoordText.innerHTML,i=e._2ndCoordText.innerHTML,o=e._elevationText.innerHTML;if(e._1stCoordValue.textContent.trim().length>0&&e._2ndCoordValue.textContent.trim().length>0){r.CRS=e.map.crs;r[n.substr(0,n.indexOf(":"))]=parseFloat(e._1stCoordValue.dataset.value);r[i.substr(0,i.indexOf(":"))]=parseFloat(e._2ndCoordValue.dataset.value);o&&(r[e.getLocaleString("ele")]=parseFloat(e._elevationValue.dataset.value));t.setData(r)}break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:if(e._len.innerHTML.trim()!==e.NOMEASURE){r[e.getLocaleString("2dLength")]=e._len.innerHTML;t.setData(r)}break;case TC.feature.Polygon&&t instanceof TC.feature.Polygon:if(e._area.innerHTML.trim()!==e.NOMEASURE&&e._peri.innerHTML.trim()!==e.NOMEASURE){r[e.getLocaleString("area")]=e._area.innerHTML;r[e.getLocaleString("2dPerimeter")]=e._peri.innerHTML;t.setData(r)}}return e};t.getFeatureMeasureData=function(t){const e=this,r={units:"m"},i={};e.map.wrap.isGeo()&&(i.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:r.area=t.getArea(i);r.perimeter=t.getLength(i);break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:r.length=t.getLength(i);const o=n(t);o?e.renderElevationChart(o.data):e.displayElevationProfile(t.geometry);break;case TC.feature.Point&&t instanceof TC.feature.Point:r.coords=t.geometry}return r};t.showMeasures=function(t){const e=this;TC.control.Measure.prototype.showMeasures.call(e,t);(t=t||{}).units;const r=e.map.options.locale||TC.Cfg.locale;if(t.coords){var n,i,o;if("m"===t.units){n=TC.Consts.METER_PRECISION;i=t.coords[0];o=t.coords[1];e._1stCoordText.innerHTML="x: ";e._2ndCoordText.innerHTML="y: "}else{n=TC.Consts.DEGREE_PRECISION;i=t.coords[1];o=t.coords[0];e._1stCoordText.innerHTML="lat: ";e._2ndCoordText.innerHTML="lon: "}const a=Math.pow(10,n),s=function(t){return Math.round(t*a)/a};e._1stCoordValue.innerHTML=TC.Util.formatNumber(i.toFixed(n),r);e._1stCoordValue.dataset.value=s(i);e._2ndCoordValue.innerHTML=TC.Util.formatNumber(o.toFixed(n),r);e._2ndCoordValue.dataset.value=s(o);if(t.coords.length>2){const n=Math.round(t.coords[2]);e._elevationText.innerHTML=e.getLocaleString("ele").toLowerCase()+": ";e._elevationValue.innerHTML=TC.Util.formatNumber(n.toFixed(TC.Consts.METER_PRECISION),r)+" m";e._elevationValue.dataset.value=n}else{e._elevationText.innerHTML="";e._elevationValue.innerHTML="";e._elevationValue.dataset.value=""}}return e};t.resetValues=function(){const t=this;TC.control.Measure.prototype.resetValues.call(t);if(t._1stCoordText){t._1stCoordText.innerHTML=t.NOMEASURE;t._2ndCoordText.innerHTML="";t._1stCoordValue.innerHTML="";t._1stCoordValue.dataset.value="";t._2ndCoordValue.innerHTML="";t._2ndCoordValue.dataset.value="";t._elevationText.innerHTML="";t._elevationValue.innerHTML="";t._elevationValue.dataset.value=""}return t};t.resetDrawWatches=function(){this.drawControls.forEach(function(t){t.setStrokeColorWatch().setStrokeWidthWatch()})};t.clear=function(){const t=this;t.resetValues();t.layer.clearFeatures();t.modify.isActive&&t.modify.deactivate();if(t.options.displayElevation){t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}t._clearBtn.disabled=!0;t._downloadBtn.disabled=!0;return t};t.showSketchDownloadDialog=function(t){const r=this;new Promise(function(t,n){e?t(e):r.map.addControl("FeatureDownloadDialog").then(r=>{t(e=r)})}).then(function(t){var e={title:r.getLocaleString("downloadSketch"),fileName:r.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)};const n=r.layer.features.some(function(t){return TC.feature.Point&&t instanceof TC.feature.Point||TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint}),i=r.layer.features.some(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline}),o=r.layer.features.some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon});n||i||!o||(e=Object.assign({},e,{excludedFormats:["GPX"]}));e=!0!==r.options.displayElevation?Object.assign({},e,{elevation:Object.assign({},r.map.elevation&&r.map.elevation.options,r.options.displayElevation)}):Object.assign({},e,{elevation:r.map.elevation&&r.map.elevation.options});t.open(r.layer.features,e)});return r};t.onStyleChange=function(t){const e=this;var r;switch(t.target.mode){case TC.Consts.geom.POLYGON:r=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:r=TC.feature.Polyline;break;case TC.Consts.geom.POINT:r=TC.feature.Point}r&&e.modify.getSelectedFeatures().forEach(function(e){if(e instanceof r){const r={};r[t.property]=t.value;e.setStyle(r)}})};t.displayElevationProfile=function(t){const e=this;1===t.length&&(t=t.slice()).push(t[0]);const i=e.map.getLoadingIndicator(),o=i&&i.addWait();e.elevation.getElevation({crs:e.map.crs,coordinates:t,partialCallback:function(a){i&&i.removeWait(o);var s=0,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const u=a.map(function(t,e,r){const n=0===e?t:r[e-1],i=t[0]-n[0],o=t[1]-n[1];s+=Math.sqrt(i*i+o*o);var a=t[2];if("number"==typeof a){l=Math.max(a,l);c=Math.min(a,c)}return[s,a]});e.elevationChartData={x:u.map(function(t){return t[0]}),ele:u.map(function(t){return t[1]}),coords:a};const h={coords:a};"object"==typeof e.options.displayElevation&&(h.hillDeltaThreshold=e.options.displayElevation.hillDeltaThreshold);TC.Util.extend(e.elevationChartData,TC.tool.Elevation.getElevationGain(h));const d=e.layer.features.filter(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline}).filter(function(e){for(var r=0,n=e.geometry.length;r<n;r++){const n=t[r],i=e.geometry[r];if(!n||n[0]!==i[0]||n[1]!==i[1])return!1}return!0})[0];d&&function(t,e){var i=n(t);if(!i){i={feature:t};r.push(i)}i.data=e}(d,e.elevationChartData);e.resultsPanelChart?e.renderElevationChart():e.createChartPanel().then(function(t){e.resultsPanelChart.renderPromise().then(function(){e.renderElevationChart()})})}}).catch(function(t){e.resetElevationProfile();i&&i.removeWait(o)})};t.createChartPanel=function(){const e=this,r={id:e.getUID(),content:"chart",titles:{main:e.getLocaleString("geo.trk.chart.chpe"),max:e.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:e,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};return new Promise(function(t,n){var i;const o=function(t){r.position=t.POSITION.RIGHT;i=t.addControl("resultsPanel",r)};if(e.options.displayElevation.displayOn){var a=e.map.getControlsByClass("TC.control."+e.options.displayElevation.displayOn[0].toUpperCase()+e.options.displayElevation.displayOn.substring(1))[0];a?o(a):e.map.addControl(e.options.displayElevation.displayOn).then(o)}else{r.div=document.createElement("div");e.map.div.appendChild(r.div);i=e.map.addControl("resultsPanel",r)}i.then(function(r){r.caller=e;e.resultsPanelChart=r;e._decorateChartPanel();t(r)})})};t._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(t){const e=this;e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1);e.currentFeature=t;t&&t.toggleSelectedStyle(!0)}};t.renderElevationChart=function(t){const e=this;e.elevationChartData=t||e.elevationChartData;if(e.resultsPanelChart&&e.elevationProfileActive){e.resultsPanelChart.caller=e;e.resultsPanelChart.openChart(e.elevationChartData);e.resultsPanelChart.isMinimized()||e.resultsPanelChart.show()}};t.getElevationTooltip=function(t){this.resultsPanelChart.wrap.showElevationMarker({data:t,layer:this.layer,coords:this.elevationChartData.coords});return this.resultsPanelChart.getElevationChartTooltip(t)};t.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};t.activateElevationProfile=function(){const t=this;t.elevationProfileActive=!0;t._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);t._elevProfileBtn.setAttribute("title",t.getLocaleString("deactivateElevationProfile"));var e=!1;if(t.lineDrawControl.historyIndex>1){t.displayElevationProfile(t.lineDrawControl.history.slice(0,t.lineDrawControl.historyIndex));e=!0}else{const r=t.modify.getActiveFeatures().filter(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline});if(r.length){const n=r[r.length-1];t.displayElevationProfile(n.geometry);e=!0}}e||t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.show()};t.deactivateElevationProfile=function(){const t=this;t.elevationProfileActive=!1;t._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);t._elevProfileBtn.setAttribute("title",t.getLocaleString("activateElevationProfile"));t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()};t.resetElevationProfile=function(){const t=this;if(t.options.displayElevation&&t.resultsPanelChart){t.elevationChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};t.resultsPanelChart.openChart(t.elevationChartData)}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.Edit=function(){TC.Control.apply(this,arguments);this._classSelector="."+this.CLASS;this._selectors={MODE_RADIO_BUTTON:"input[type=radio][name=mode]"};this.wrap=new TC.wrap.control.Edit(this);this.layer=null;this.callback=TC.Util.isFunction(arguments[2])?arguments[2]:this.options.callback?this.options.callback:null;this.cancelActionConfirmTxt=this.options.cancelText?this.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";this.styles=this.options.styles;this.layersEditData={};this.pointDrawControl=null;this.lineDrawControl=null;this.polygonDrawControl=null;this.modifyControl=null;this.snapping="boolean"!=typeof this.options.snapping||this.options.snapping};TC.inherit(TC.control.Edit,TC.Control);TC.control.Edit.mode={MODIFY:"modify",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon",CUT:"cut",OTHER:"other"};const t=TC.control.Edit.prototype;t.CLASS="tc-ctl-edit";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"featureEditing"}).w('</h2><div class="tc-ctl-edit-tools"><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-modify" title="').h("i18n",e,{},{$key:"select"}).w('"><input type="radio" name="mode" value="modify" /><span>').h("i18n",e,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",e,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",e,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",e,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",e,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",e,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",e,{},{$key:"newPolygon"}).w('</span></label><label class="tc-ctl-edit-btn-other" title="').h("i18n",e,{},{$key:"otherTools"}).w('"><input type="radio" name="mode" value="other" /><span>').h("i18n",e,{},{$key:"otherTools"}).w('</span></label></form></div><div class="tc-ctl-edit-modify tc-hidden"></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-other tc-hidden"><button class="tc-button tc-ctl-edit-btn-import">').h("i18n",e,{},{$key:"importFromOtherLayer"}).w('</button><button class="tc-button tc-ctl-edit-btn-dl">').h("i18n",e,{},{$key:"download"}).w("</button></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-attr"]=function(){dust.register(t.CLASS+"-attr",r);var e={inputText:P,inputNumber:I,inputCheckbox:R,inputDate:M,inputTime:k,inputDatetime:N};function r(t,r){r=r.shiftBlocks(e);return t.w("<h3>").h("i18n",r,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-mod-attr-body"><table><tbody>').s(r.get(["data"],!1),r,{block:n},{}).w('</tbody></table></div><div class="tc-ctl-mod-attr-footer"><button class="tc-button tc-ctl-mod-btn-attr-ok">').h("i18n",r,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-mod-btn-attr-cancel">').h("i18n",r,{},{$key:"cancel"}).w("</button></div>")}r.__dustBody=!0;function n(t,r){r=r.shiftBlocks(e);return t.w("<tr><th>").f(r.get(["name"],!1),r,"h").w("</th><td>").x(r.get(["readOnly"],!1),r,{else:i,block:D},{}).w("</td></tr>")}n.__dustBody=!0;function i(t,r){r=r.shiftBlocks(e);return t.x(r.get(["availableValues"],!1),r,{block:o},{}).h("select",r,{block:s},{key:r.get(["type"],!1)})}i.__dustBody=!0;function o(t,r){r=r.shiftBlocks(e);return t.w('<select class="tc-combo" name="').f(r.get(["name"],!1),r,"h").w('"><option value=""></option>').s(r.get(["availableValues"],!1),r,{block:a},{}).w("</select>")}o.__dustBody=!0;function a(t,r){r=r.shiftBlocks(e);return t.w('<option value="').f(r.getPath(!0,[]),r,"h").w('">').f(r.getPath(!0,[]),r,"h").w("</option>")}a.__dustBody=!0;function s(t,r){r=r.shiftBlocks(e);return t.h("none",r,{block:l},{}).h("eq",r,{block:c},{value:"int"}).h("eq",r,{block:u},{value:"integer"}).h("eq",r,{block:h},{value:"double"}).h("eq",r,{block:d},{value:"boolean"}).h("eq",r,{block:p},{value:"date"}).h("eq",r,{block:f},{value:"time"}).h("eq",r,{block:g},{value:"dateTime"}).h("eq",r,{block:y},{value:"byte"}).h("eq",r,{block:m},{value:"long"}).h("eq",r,{block:C},{value:"negativeInteger"}).h("eq",r,{block:v},{value:"nonNegativeInteger"}).h("eq",r,{block:T},{value:"nonPositiveInteger"}).h("eq",r,{block:_},{value:"positiveInteger"}).h("eq",r,{block:S},{value:"short"}).h("eq",r,{block:E},{value:"unsignedLong"}).h("eq",r,{block:w},{value:"unsignedInt"}).h("eq",r,{block:b},{value:"unsignedShort"}).h("eq",r,{block:L},{value:"unsignedByte"}).h("eq",r,{block:A},{value:"float"}).h("eq",r,{block:x},{value:"decimal"})}s.__dustBody=!0;function l(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputText"),r,{},{})}l.__dustBody=!0;function c(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}c.__dustBody=!0;function u(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}u.__dustBody=!0;function h(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}h.__dustBody=!0;function d(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputCheckbox"),r,{},{})}d.__dustBody=!0;function p(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputDate"),r,{},{})}p.__dustBody=!0;function f(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputTime"),r,{},{})}f.__dustBody=!0;function g(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputDatetime"),r,{},{})}g.__dustBody=!0;function y(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}y.__dustBody=!0;function m(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}m.__dustBody=!0;function C(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}C.__dustBody=!0;function v(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}v.__dustBody=!0;function T(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}T.__dustBody=!0;function _(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}_.__dustBody=!0;function S(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}S.__dustBody=!0;function E(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}E.__dustBody=!0;function w(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}w.__dustBody=!0;function b(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}b.__dustBody=!0;function L(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}L.__dustBody=!0;function A(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}A.__dustBody=!0;function x(t,r){r=r.shiftBlocks(e);return t.b(r.getBlock("inputNumber"),r,{},{})}x.__dustBody=!0;function P(t,r){r=r.shiftBlocks(e);return t.w('<input type="text" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}P.__dustBody=!0;function I(t,r){r=r.shiftBlocks(e);return t.w('<input type="number" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}I.__dustBody=!0;function R(t,r){r=r.shiftBlocks(e);return t.w('<input type="checkbox" name="').f(r.get(["name"],!1),r,"h").w('"').x(r.get(["value"],!1),r,{block:O},{}).w("/>")}R.__dustBody=!0;function O(t,r){r=r.shiftBlocks(e);return t.w(" checked")}O.__dustBody=!0;function M(t,r){r=r.shiftBlocks(e);return t.w('<input type="date" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}M.__dustBody=!0;function k(t,r){r=r.shiftBlocks(e);return t.w('<input type="time" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}k.__dustBody=!0;function N(t,r){r=r.shiftBlocks(e);return t.w('<input type="datetime" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}N.__dustBody=!0;function D(t,r){r=r.shiftBlocks(e);return t.f(r.get(["value"],!1),r,"h")}D.__dustBody=!0;return r};t.template[t.CLASS+"-import"]=function(){dust.register(t.CLASS+"-import",e);function e(t,e){return t.w('<div class="tc-ctl-edit-import"><div class="tc-ctl-edit-import-list"><ul class="tc-layers">').s(e.get(["layers"],!1),e,{block:r},{}).w('</ul><p class="tc-ctl-edit-import-empty-note">').h("i18n",e,{},{$key:"thereAreNoCompatibleFeatures"}).w('</p></div><div class="tc-ctl-edit-import-foot"><button class="tc-button tc-ctl-edit-import-btn-ok">').h("i18n",e,{},{$key:"ok"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-edit-import-layer",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-import-layer"]=function(){dust.register(t.CLASS+"-import-layer",e);function e(t,e){return t.w('<li class="tc-layer" data-layer-id="').f(e.get(["id"],!1),e,"h").w('"><input type="checkbox" id="tc-ctl-edit-import-list-cb-').f(e.get(["id"],!1),e,"h").w('" value="').f(e.get(["id"],!1),e,"h").w('"> <label for="tc-ctl-edit-import-list-cb-').f(e.get(["id"],!1),e,"h").w('">').f(e.get(["title"],!1),e,"h").w('</label><ul class="tc-features">').s(e.get(["features"],!1),e,{block:r},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-edit-import-feature",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-import-feature"]=function(){dust.register(t.CLASS+"-import-feature",e);function e(t,e){return t.w('<li class="tc-feature"><input type="checkbox" id="tc-ctl-edit-import-list-cb-').f(e.getPath(!1,["layer","id"]),e,"h").w("-").f(e.get(["id"],!1),e,"h").w('" value="').f(e.get(["id"],!1),e,"h").w('"> <label for="tc-ctl-edit-import-list-cb-').f(e.getPath(!1,["layer","id"]),e,"h").w("-").f(e.get(["id"],!1),e,"h").w('">').f(e.get(["id"],!1),e,"h").w("</label></li>")}e.__dustBody=!0;return e};t.register=function(t){const e=this;return new Promise(function(r,n){TC.Control.prototype.register.call(e,t).then(function(){e._pointDrawCtlPromise=t.addControl("draw",{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-point`),mode:TC.Consts.geom.POINT,layer:!1});e._lineDrawCtlPromise=t.addControl("draw",{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-line`),mode:TC.Consts.geom.POLYLINE,layer:!1});e._polygonDrawCtlPromise=t.addControl("draw",{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-polygon`),mode:TC.Consts.geom.POLYGON,layer:!1});e._modifyCtlPromise=t.addControl("modify",{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-modify`),snapping:e.snapping});Promise.all([e._pointDrawCtlPromise,e._lineDrawCtlPromise,e._polygonDrawCtlPromise,e._modifyCtlPromise]).then(function(n){e.pointDrawControl=n[0];e.lineDrawControl=n[1];e.polygonDrawControl=n[2];e.modifyControl=n[3];const i=function(t){t.feature.setStyle(null);e.trigger(TC.Consts.event.DRAWEND,{feature:t.feature})},o=function(){e.cancel()};e.pointDrawControl.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,o);e.lineDrawControl.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,o);e.polygonDrawControl.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,o);e.modifyControl.on(TC.Consts.event.FEATUREMODIFY,function(t){e.trigger(TC.Consts.event.FEATUREMODIFY,{feature:t.feature,layer:t.layer})}).on(TC.Consts.event.FEATUREADD,function(t){e.trigger(TC.Consts.event.FEATUREADD,{feature:t.feature,layer:t.layer})}).on(TC.Consts.event.FEATUREREMOVE,function(t){e.trigger(TC.Consts.event.FEATUREREMOVE,{feature:t.feature,layer:t.layer})});e.modifyControl.displayAttributes=function(){const t=e.getSelectedFeatures(),r=t[t.length-1];if(r){e.modifyControl._editAttrBtn.classList.add(TC.Consts.classes.ACTIVE);const t=e.getLayerEditData(r.layer).attributes,n=Object.keys(t).map(e=>t[e]),i=e._joinedFeatureAttributes||[],o=r.getData()||{};n.forEach(function(t){t.value=o[t.name];"id"===t.name&&(t.readOnly=!0);t.availableValues=[];i.forEach(function(e){const r=e[t.name];void 0!==r&&""!==r&&(t.availableValues[t.availableValues.length]=r)})});n.sort(function(t,e){return(t.readOnly?!e.readOnly:e.readOnly)?!t.readOnly-!e.readOnly:t.name>e.name?1:t.name<e.name?-1:0});e.getRenderedHtml(e.CLASS+"-attr",{data:n},function(t){e.modifyControl._attributesSection;const r=e.getAttributeDisplayTarget();r.classList.remove(TC.Consts.classes.HIDDEN);r.innerHTML=t;const n=r.querySelectorAll("input"),i=r.querySelectorAll("select");n.forEach(function(t){t.addEventListener("input",function(t){const e=t.target;for(var r=0,n=i.length;r<n;r++){const n=i[r];if(n.matches(`[name=${t.target.getAttribute("name")}]`)&&n.value!==e.value){n.value="";break}}})});i.forEach(function(t){t.addEventListener("change",function(t){const e=t.target;for(var r=0,i=n.length;r<i;r++){const i=n[r];if(i.matches(`[name=${t.target.getAttribute("name")}]`)){i.value=e.value;break}}})});r.querySelector(`.${e.modifyControl.CLASS}-btn-attr-ok`).addEventListener(TC.Consts.event.CLICK,function(t){e.modifyControl._onAttrOK()});r.querySelector(`.${e.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(TC.Consts.event.CLICK,function(){e.modifyControl.closeAttributes()})})}};e.modifyControl._onAttrOK=function(){const t=this,r=t.getSelectedFeatures()[0];if(r){const n={},i=e.getLayerEditData(r.layer).attributes;t.getAttributeDisplayTarget().querySelectorAll("input").forEach(function(t){var e=t.getAttribute("name"),r=t.value;switch(i[e].type){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":r=parseInt(r);Number.isNaN(r)||(n[e]=r);break;case"double":case"float":case"decimal":r=parseFloat(r);Number.isNaN(r)||(n[e]=r);break;case"date":case"time":case"dateTime":n[e]=new Date(r);break;case"boolean":n[e]=!!r;break;case void 0:break;default:n[e]=r}});r.setData(n);t.trigger(TC.Consts.event.FEATUREMODIFY,{feature:r,layer:t.layer});t.closeAttributes()}};Array.isArray(e.options.modes)&&1==e.options.modes.length&&e.setMode(e.options.modes[0],null);r(e);t.loaded(function(){e.setLayer(e.options.layer)});t.on(TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===e.featureImportPanel){e.featuresToImport=[];e.getHighlightsLayer().then(t=>t.clearFeatures())}}).on(TC.Consts.event.LAYERREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)&&e.getHighlightsLayer().then(function(r){for(let n=e.featuresToImport.length-1;n>=0;n--){const i=e.featuresToImport[n];if(i.layer===t.layer||i.original&&i.original.layer===t.layer){e.featuresToImport.splice(n,1);r.removeFeature(i)}}const n=e.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${t.layer.id}"]`);n&&n.remove()})}).on(TC.Consts.event.FEATUREREMOVE,function(t){e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)&&e.getHighlightsLayer().then(function(r){for(let n=0,i=e.featuresToImport.length;n<i;n++){const i=e.featuresToImport[n];if(i===t.feature||i.original===t.feature){e.featuresToImport.splice(n,1);r.removeFeature(i);const o=e.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${t.layer.id}"]`);if(o){const e=o.querySelector(`#tc-ctl-edit-import-list-cb-${t.layer.id}-${t.feature.id}`);e&&e.remove();o.children.length||o.remove()}break}}})}).on(TC.Consts.event.LAYERUPDATE,function(t){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const r=e.getAvailableFeaturesToImport().filter(e=>e.id===t.layer.id)[0];r&&e.getRenderedHtml(e.CLASS+"-import-layer",r,function(r){const n=e.featureImportPanel.getInfoContainer().querySelector(`.${e.CLASS}-import-list .tc-layers`);n.querySelector(`li[data-layer-id="${t.layer.id}"]`)||n.insertAdjacentHTML("beforeend",r)})}}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const r=t.layer,n=(t.feature?[t.feature]:t.features).filter(t=>e.isFeatureAllowed(t));n.length&&e.displayLayerToImport({id:r.id,title:r.title,features:n})}})})})})};t.render=function(t){const e=this;return e._set1stRenderPromise(TC.Control.prototype.render.call(e,function(){if(Array.isArray(e.options.modes)&&e.options.modes.length>0){for(var r in TC.control.Edit.mode)if("string"==typeof r&&e.options.modes.indexOf(TC.control.Edit.mode[r])<0){const t=e.div.querySelector(`label${e._classSelector}-btn-${TC.control.Edit.mode[r]}`);t.parentElement.removeChild(t);const n=e.div.querySelector(`div${e._classSelector}-${TC.control.Edit.mode[r]}`);n.parentElement.removeChild(n)}if(1===e.options.modes.length){var n=e.options.modes[0];const t=e.div.querySelector(`label${e._classSelector}-btn-${n}`);t.parentElement.removeChild(t)}}e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach(function(t){t.addEventListener("change",function(){var t=this.value,r=e.mode===t?void 0:t;e.setMode(r)})});e.div.querySelector(e._classSelector+"-btn-import").addEventListener(TC.Consts.event.CLICK,function(t){e.showFeatureImportPanel()});e.div.querySelector(e._classSelector+"-btn-dl").addEventListener(TC.Consts.event.CLICK,function(t){e.getDownloadDialog().then(function(t){const r={title:e.getLocaleString("download"),fileName:e.layer.id.toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),elevation:e.options.downloadElevation};t.open(e.layer.features,r)})});TC.Util.isFunction(t)&&t()}))};t.getGeometryType=function(t){switch(t){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"LinearRingPropertyType":case"PolygonPropertyType":return TC.Consts.geom.POLYGON;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"MultiPolygonPropertyType":case"MultiSurfacePropertyType":return TC.Consts.geom.MULTIPOLYGON;case"gml:LineStringPropertyType":case"gml:CurvePropertyType":case"LineStringPropertyType":case"CurvePropertyType":return TC.Consts.geom.POLYLINE;case"gml:MultiLineStringPropertyType":case"gml:MultiCurvePropertyType":case"MultiLineStringPropertyType":case"MultiCurvePropertyType":return TC.Consts.geom.MULTIPOLYLINE;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"PointPropertyType":case"MultiPointPropertyType":return TC.Consts.geom.POINT;case"gml:BoxPropertyType":case"BoxPropertyType":return TC.Consts.geom.RECTANGLE;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"GeometryCollectionPropertyType":case"GeometryAssociationType":case"GeometryPropertyType":return!0;default:return!1}};t.setLayer=function(t){const e=this;e.layer=e.map.getLayer(t);e.layer&&t.describeFeatureType().then(function(r){const n={attributes:{}};for(var i in r){const t=r[i],o=e.getGeometryType(t.type);if(o){n.geometryName=t.name;n.geometryType="boolean"==typeof o?null:o}else n.attributes[i]=t}for(var i in n.attributes){const t=n.attributes[i];t.type=t.type.substr(t.type.indexOf(":")+1)}e.layersEditData[t.id]=n}).catch(function(r){e.layersEditData[t.id]={geometryType:null,attributes:{}}});const r=t=>t.setLayer(e.layer);e.getModifyControl().then(r);e.getPointDrawControl().then(r);e.getLineDrawControl().then(r);e.getPolygonDrawControl().then(r);e.setMode(e.layer?TC.control.Edit.mode.MODIFY:null);n=e,i=e.layer,n.div.querySelectorAll(n._selectors.MODE_RADIO_BUTTON).forEach(t=>t.disabled=!i);var n,i};t.setMode=function(t){var e=this;e.mode=t;var r,n,i=function(t){if(t){e.snapping&&(t.snapping=e.layer);t.activate()}};Promise.all([e._pointDrawCtlPromise,e._lineDrawCtlPromise,e._polygonDrawCtlPromise,e._modifyCtlPromise]).then(function(o){const a=o[0],s=o[1],l=o[2],c=o[3];switch(t){case TC.control.Edit.mode.MODIFY:r=e.div.querySelector(e._classSelector+"-modify");n=e.div.querySelectorAll(e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other");c.activate();break;case TC.control.Edit.mode.ADDPOINT:r=e.div.querySelector(e._classSelector+"-point");n=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other");i(a);break;case TC.control.Edit.mode.ADDLINE:r=e.div.querySelector(e._classSelector+"-line");n=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-polygon,"+e._classSelector+"-other");i(s);break;case TC.control.Edit.mode.ADDPOLYGON:r=e.div.querySelector(e._classSelector+"-polygon");n=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-other");i(l);break;case TC.control.Edit.mode.OTHER:r=e.div.querySelector(e._classSelector+"-other");n=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon");o.indexOf(e.map.activeControl)>=0&&e.map.activeControl.deactivate();break;default:r=null;n=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other");o.indexOf(e.map.activeControl)>=0&&e.map.activeControl.deactivate()}if(t){e.div.querySelector(`${e._selectors.MODE_RADIO_BUTTON}[value=${t}]`).checked=!0}else e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach(function(t){t.checked=!1});r&&r.classList.remove(TC.Consts.classes.HIDDEN);n.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)})})};t.constrainModes=function(t){const e=this;Array.isArray(t)||(t=[]);e.modes=t.filter(function(t){for(var e in TC.control.Edit.mode)if(TC.control.Edit.mode[e]===t)return!0;return!1}).filter(function(t){return!Array.isArray(e.options.modes)||e.options.modes.indexOf(t)>=0});e.modes.indexOf(e.mode)<0&&e.setMode(null);const r=e.modes.map(t=>`[value=${t}]`).join()||"[value]";e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach(function(t){t.disabled=!t.matches(r)})};t.isFeatureAllowed=function(t){const e=this;switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:return e.modes.indexOf(TC.control.Edit.mode.ADDPOINT)>=0;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:return e.modes.indexOf(TC.control.Edit.mode.ADDLINE)>=0;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:return e.modes.indexOf(TC.control.Edit.mode.ADDLINE)>=0&&e.isMultiple;case TC.feature.Polygon&&t instanceof TC.feature.Polygon:return e.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON)>=0;case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:return e.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON)>=0&&e.isMultiple;default:return!0}};t.setComplexGeometry=function(t){this.isMultiple=t;this.getLineDrawControl().then(e=>e.setMode(t?TC.Consts.geom.MULTIPOLYLINE:TC.Consts.geom.POLYLINE));this.getPolygonDrawControl().then(e=>e.setMode(t?TC.Consts.geom.MULTIPOLYGON:TC.Consts.geom.POLYGON))};t.getLayerEditData=function(t){const e=t||this.layer;return e?this.layersEditData[e.id]=this.layersEditData[e.id]||{checkedOut:!1}:null};t.cancel=function(){Array.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};t.onFeatureClick=function(t){self.activeControl&&self.activeControl.isExclusive()||t.feature.show()};t.activate=function(t){const e=this,r=function(t){t!==e.map.activeControl&&(e._previousActiveControl=e.map.activeControl)};switch((t=t||{}).mode){case TC.control.Edit.mode.ADDPOINT:e.getPointDrawControl().then(r);break;case TC.control.Edit.mode.ADDLINE:e.getLineDrawControl().then(r);break;case TC.control.Edit.mode.ADDPOLYGON:e.getPolygonDrawControl().then(r);break;default:e.getModifyControl().then(r)}};t.deactivate=function(){const t=this;if(t._previousActiveControl){t.map.previousActiveControl=t._previousActiveControl;switch(t.map.activeControl){case t.pointDrawControl:t.pointDrawControl.deactivate();break;case t.lineDrawControl:t.lineDrawControl.deactivate();break;case t.polygonDrawControl:t.polygonDrawControl.deactivate();break;case t.modifyControl:t.modifyControl.deactivate()}}t.modifyControl&&t.modifyControl.closeAttributes()};t.isExclusive=function(){return!0};t.getAttributeDisplayTarget=function(){return this.modifyControl._attributesSection};t.getSelectedFeatures=function(){return this.modifyControl.getSelectedFeatures()};t.setSelectedFeatures=function(t){return this.modifyControl.setSelectedFeatures(t)};t.getLayer=function(){return this.layer};t.getModifyControl=function(){const t=this;return t._modifyCtlPromise||new Promise(function(e,r){t.renderPromise().then(()=>e(t.modifyControl))})};t.getPointDrawControl=function(){const t=this;return t._pointDrawCtlPromise||new Promise(function(e,r){t.renderPromise().then(()=>e(t.pointDrawControl))})};t.getLineDrawControl=function(){const t=this;return t._lineDrawCtlPromise||new Promise(function(e,r){t.renderPromise().then(()=>e(t.lineDrawControl))})};t.getPolygonDrawControl=function(){const t=this;return t._polygonDrawCtlPromise||new Promise(function(e,r){t.renderPromise().then(()=>e(t.polygonDrawControl))})};t.getFeatureImportPanel=function(){const t=this;if(!t._featureImportPanelPromise){t._featureImportPanelPromise=t.map.addControl("resultsPanel",{titles:{main:t.getLocaleString("importFromOtherLayer")}});t._featureImportPanelPromise.then(e=>t.featureImportPanel=e)}return t._featureImportPanelPromise};t.getHighlightsLayer=function(){const t=this;if(!t._highlightsLayerPromise){t._highlightsLayerPromise=t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:"Highlights Layer",stealth:!0,styles:t.map.options.styles.selection||TC.Cfg.styles.selection});t._highlightsLayerPromise.then(e=>t.highlightsLayer=e)}return t._highlightsLayerPromise};t.highlightFeatures=function(t){const e=this;e.getHighlightsLayer().then(function(r){const n=e.featuresToImport.concat(t);r.features.slice().forEach(function(t){(!t.original||n.indexOf(t.original)<0)&&r.removeFeature(t)});r.addFeatures(n.filter(function(t){return!r.features.some(function(e){return e.original&&e.original===t})}).map(function(t){const e=t.clone();e.toggleSelectedStyle(!0);e.original=t;return e}))})};t.getAvailableFeaturesToImport=function(){const t=this;return t.map.workLayers.filter(t=>!t.isRaster()).filter(e=>e!==t.layer).filter(e=>e!==t.highlightsLayer).map(function(e){return{id:e.id,title:e.title,features:e.features.filter(function(e){return t.isFeatureAllowed(e)})}}).filter(t=>t.features.length)};t.getFeatureFromImportList=function(t){const e=t.querySelector("input"),r=this.map.getLayer(t.parentElement.parentElement.dataset.layerId);return r?r.getFeatureById(e.value):null};t.importFeatures=function(t){const e=this;let r=!1;const n=e.getLayerEditData();(t||e.featuresToImport||[]).filter(t=>{const n=e.isFeatureAllowed(t);n||(r=!0);return n}).map(function(t){let r;const i={data:t.data,geometryName:n.geometryName};if(e.isMultiple)switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:r=new TC.feature.MultiPolygon([t.geometry],i);break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:r=new TC.feature.MultiPolyline([t.geometry],i);break;default:r=t.clone()}else switch(!0){case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:r=new TC.feature.Polygon(t.geometry[0],i);break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:r=new TC.feature.Polyline(t.geometry[0],i);break;default:r=t.clone()}r.setStyle(null);return r}).forEach(function(t){e.layer.addFeature(t);e.trigger(TC.Consts.event.FEATUREADD,{feature:t,layer:e.layer})});r&&e.map.toast(e.getLocaleString("importFromOtherLayer.warning"),{type:TC.Consts.msgType.WARNING})};const e=function(t,e){const r=t.getFeatureFromImportList(e.parentElement);if(e.checked)t.featuresToImport.push(r);else{const e=t.featuresToImport.indexOf(r);e>=0&&t.featuresToImport.splice(e,1)}};t._addImportLayerEvents=function(t){const r=this;t.querySelector("input").addEventListener("change",function(t){const n=this;n.parentElement.querySelectorAll("li.tc-feature input").forEach(function(t){if(t.checked!==n.checked){t.checked=n.checked;e(r,t)}});r.highlightFeatures([])});t.querySelectorAll("li.tc-feature").forEach(function(t){r._addImportFeatureEvents(t)})};t._addImportFeatureEvents=function(t){const r=this,n=function(t){const e=r.getFeatureFromImportList(this);e&&r.highlightFeatures([e])};t.addEventListener(TC.Consts.event.CLICK,n);t.addEventListener("mouseover",n);t.querySelector("input").addEventListener("change",function(t){e(r,this)})};t.showFeatureImportPanel=function(){const t=this;t.featuresToImport=[];t.getFeatureImportPanel().then(function(e){const r=e.getInfoContainer();t.getRenderedHtml(t.CLASS+"-import",{layers:t.getAvailableFeaturesToImport()},function(n){e.open(n,r);r.querySelector("ul").addEventListener("mouseout",function(e){t.highlightFeatures([])});r.querySelectorAll("li.tc-layer").forEach(function(e){t._addImportLayerEvents(e)});r.querySelector(`.${t.CLASS}-import-btn-ok`).addEventListener(TC.Consts.event.CLICK,function(e){t.importFeatures();t.featureImportPanel.close()})})})};t.displayLayerToImport=function(t){const e=this;return new Promise(function(r,n){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const n=e.featureImportPanel.getInfoContainer().querySelector(`.${e.CLASS}-import-list .tc-layers`),i=`li[data-layer-id="${t.id}"]`,o=n.querySelector(i);if(o){features.forEach(function(t){e.isFeatureAllowed(t)&&e.getRenderedHtml(e.CLASS+"-import-feature",layerObj,function(t){o.insertAdjacentHTML("beforeend",t);e._addImportFeatureEvents(o.querySelector("li:last-child"))})});r(o)}else e.getRenderedHtml(e.CLASS+"-import-layer",{id:t.id,title:t.title,features:t.features},function(t){n.insertAdjacentHTML("beforeend",t);const o=n.querySelector(i);e._addImportLayerEvents(o);r(o)})}else r(null)})};t.getDownloadDialog=function(){const t=this;return t._downloadDialog?Promise.resolve(t._downloadDialog):new Promise(function(e,r){t.map.addControl("FeatureDownloadDialog").then(r=>{t._downloadDialog=r;e(r)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(t){this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection="boolean"!=typeof this.options.allowReprojection||this.options.allowReprojection};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var t=TC.control.ExternalWMS.prototype;t.CLASS="tc-ctl-xwms";t.markServicesAsSelected=function(t){if(t.length>0){const e=t[0];e.disabled=!0;e.classList.add("tc-ctl-xwms-option-selected")}};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.div.addEventListener("change",TC.EventTarget.listenerBySelector("select",function(t){if(""!==t.target.value){var r=t.target.value;0===r.indexOf("//")&&(r=location.protocol+r);e.div.querySelector("input").value=r;t.target.value=""}}));const n=function(){var t=e.div.querySelector("input").value.trim();if(t)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t))if(e._addedUrls.some(function(e){return e.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")}))TC.alert(e.getLocaleString("serviceAlreadyAdded"));else{var r=e.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var n=TC.Util.getQueryStringParams(t);/https?:\/\/|\/\//i.test(t)||(t="//"+t);var i=["version","service","request"],o=function(t,e){for(var r=0;r<e.length;r++)t=TC.Util.removeURLParameter(t,e[r]);t.match(/\?$/)&&(t=t.substr(0,t.length-1));return t}(t,Object.keys(n));for(var a in n)i.indexOf(a.toLowerCase())>=0&&delete n[a];const h=e.div.querySelector("button");h.disabled=!0;for(var s={id:"xwms"+ ++e.count,type:"WMS",url:o,hideTree:!1,queryParams:n},l=0;l<e.options.suggestions.length;l++){var c=e.options.suggestions[l].items.filter(function(e,r){return e.url===t});if(c.length>0&&c[0].layerNames){s.layerNames=c[0].layerNames;break}}var u=new TC.layer.Raster(s);u.getCapabilitiesPromise().then(function(n){if(void 0!==n.Capability){var i=n.Capability.Layer;if(i.CRS&&-1==i.CRS.indexOf(e.map.crs)&&!e.allowReprojection){TC.alert(e.getLocaleString("serviceSrsNotCompatible"));r.hide();h.disabled=!1;return}e.map.trigger(TC.Consts.event.EXTERNALSERVICEADDED,{layer:u});e.div.querySelector("input").value="";const o=[];e.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")&&o.push(e)});e.markServicesAsSelected(o);e._addedUrls.push(t);r.hide();h.disabled=!1}else{TC.alert(e.getLocaleString("noLayersFoundInService"));r.hide();h.disabled=!1}},function(t){TC.alert(e.getLocaleString("serviceCouldNotBeLoaded")+":\n"+t);r.hide();h.disabled=!1})}else TC.alert(e.getLocaleString("typeAValidAddress"));else TC.alert(e.getLocaleString("typeAnAddress"))};e.renderPromise().then(()=>{e.div.querySelector("input").addEventListener("keyup",t=>{t.key&&"enter"===t.key.toLowerCase()&&e.div.querySelector("input").value.trim().length>0&&n()})});e.div.addEventListener("click",TC.EventTarget.listenerBySelector('button[name="agregar"]',n));t.on(TC.Consts.event.LAYERADD,function(t){const r=t.layer;if(r&&!r.isBase){var n=r.url;if(n){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[];0===e.div.querySelectorAll("select option").length&&n&&-1===e.pending_markServicesAsSelected.indexOf(n)&&e.pending_markServicesAsSelected.push(n);const t=[];e.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")&&t.push(e)});e.markServicesAsSelected(t);e._addedUrls.push(n)}}});return r};t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.x(e.get(["title"],!1),e,{block:r},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt">        <select class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(e.get(["suggestions"],!1),e,{block:n},{}).w('</select><input type="url" class="tc-textbox" placeholder="').h("i18n",e,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",e,{},{$key:"addService"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"addMaps"}).w("</h2>")}r.__dustBody=!0;function n(t,e){return t.x(e.get(["group"],!1),e,{block:i},{}).s(e.get(["items"],!1),e,{block:o},{}).x(e.get(["group"],!1),e,{block:a},{})}n.__dustBody=!0;function i(t,e){return t.w('<optgroup label="').f(e.get(["group"],!1),e,"h").w('">')}i.__dustBody=!0;function o(t,e){return t.w('<option value="').f(e.get(["url"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w("</option>")}o.__dustBody=!0;function a(t,e){return t.w("\t</optgroup>")}a.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(e.options,function(){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[];e.pending_markServicesAsSelected.forEach(function(t){const r=[];e.div.querySelectorAll("select option").forEach(function(e){TC.Util.addProtocol(e.value)===TC.Util.addProtocol(t)&&r.push(e)});e.markServicesAsSelected(r);e._addedUrls.push(t)});e.pending_markServicesAsSelected=[]}))}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FeatureDownloadDialog=function(){TC.Control.apply(this,arguments);this.title=this.options.title;this.cssClass=this.options.cssClass||"";this._selectors={ELEVATION_CHECKBOX:"."+this.CLASS+"-elev input[type=checkbox]",INTERPOLATION_PANEL:"."+this.CLASS+"-ip",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:"."+this.CLASS+"-ip-m"}};TC.inherit(TC.control.FeatureDownloadDialog,TC.Control);!function(){const t=TC.control.FeatureDownloadDialog.prototype;t.CLASS="tc-ctl-dwn-dialog";var e,r=["KML","GML","GeoJSON","WKT","GPX"],n=!1,i=null;t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-dwn-dialog tc-modal ').f(e.get(["cssClass"],!1),e,"h").w('"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').f(e.get(["title"],!1),e,"h").w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(e.get(["elevation"],!1),e,{block:r},{}).w('<div class="tc-ctl-dwn-dialog-dl"><div>').s(e.get(["formats"],!1),e,{block:i},{}).w("</div></div></div></div></div>")}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-dwn-dialog-elev"><input id="').f(e.get(["checkboxId"],!1),e,"h").w('" type="checkbox"><label for="').f(e.get(["checkboxId"],!1),e,"h").w('" class="tc-ctl-dwn-dialog-elev-label">').h("i18n",e,{},{$key:"includeElevations"}).w("</label></div>").x(e.get(["resolution"],!1),e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-dwn-dialog-ip tc-hidden"><h4>').h("i18n",e,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="finfo-ip-coords" value="0" checked /><span>').h("i18n",e,{},{$key:"no"}).w('</span></label><label><input type="radio" name="finfo-ip-coords" value="1" /><span>').h("i18n",e,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dwn-dialog-ip-m tc-hidden">').h("i18n",e,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(e.get(["resolution"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;function i(t,e){return t.h("select",e,{block:o},{key:e.getPath(!0,[])})}i.__dustBody=!0;function o(t,e){return t.h("eq",e,{block:a},{value:"KML"}).h("eq",e,{block:s},{value:"KMZ"}).h("eq",e,{block:l},{value:"GML"}).h("eq",e,{block:c},{value:"GeoJSON"}).h("eq",e,{block:u},{value:"WKT"}).h("eq",e,{block:h},{value:"GPX"})}o.__dustBody=!0;function a(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-kml" data-format="KML" title="KML">KML</button>')}a.__dustBody=!0;function s(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-kmz" data-format="KMZ" title="KMZ">KMZ</button>')}s.__dustBody=!0;function l(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-gml" data-format="GML" title="GML">GML</button>')}l.__dustBody=!0;function c(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button>')}c.__dustBody=!0;function u(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-wkt" data-format="WKT" title="WKT">WKT</button>')}u.__dustBody=!0;function h(t,e){return t.w('<button class="tc-button tc-btn-dl tc-ctl-dwn-dialog-btn-gpx" data-format="GPX" title="GPX">GPX</button>')}h.__dustBody=!0;return e};t.render=function(t){return TC.Control.prototype.render.call(this,t)};t.open=function(o,a){const s=this;t.getRenderedHtml(t.CLASS,Object.assign({},{cssClass:s.cssClass,checkboxId:s.getUID(),elevation:a.elevation,formats:r.filter(function(t){return(a&&a.excludedFormats&&a.excludedFormats.indexOf(t)<0)|!a|!a.excludedFormats})},a),function(t){var r=document.createElement("template");r.innerHTML=t;var l=r.content?r.content.firstChild:r.firstChild;document.body.appendChild(l);var c=l.getElementsByClassName("tc-modal-body")[0];c.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(t){var r=e&&n?parseFloat(c.querySelector(s._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||(s.options.elevation||s.map.elevation.options).resolution:0;const i=async t=>{var n=!1;l!==TC.Consts.format.GEOJSON&&a.format!==TC.Consts.format.WKT&&(t instanceof Array?t:[t]).some(function(t){for(var e in t.getData())if(t.data[e]instanceof Object)return!0;return!1})&&await TC.confirm(s.getLocaleString("dl.export.complexAttr").format(l),null,function(){n=!0});if(n)return;const i=s.map.getLoadingIndicator(),o=i&&i.addWait();TC.Util.closeModal();(function(t,e){const r=this;e=e||{};const n=Array.isArray(t)?t:[t];return new Promise(function(t,i){if(!e.displayElevation){t(n.map(function(t){if(t.getGeometryStride()>2){const e=t.clone();e.getCoordsArray().forEach(t=>t.length=2);e.setCoords(e.geometry);return e}return t}));return}let o=e.elevation&&e.elevation.resolution,a=o?n.map(t=>t.clone()):n.map(t=>t.getGeometryStride()>2?null:t.clone());if(o||a.some(t=>null!==t)){const o={crs:r.map.crs,features:a,maxCoordQuantity:e.elevation&&e.elevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:e.elevation.sampleNumber||0};(r.map.elevation||new TC.tool.Elevation("boolean"==typeof r.options.elevation?{}:r.options.elevation)).setGeometry(o).then(function(e){e.forEach((t,r)=>{t||(e[r]=n[r])});t(e)},function(t){i(t instanceof Error?t:Error(t))})}else t(n)})}).apply(s,[t,{displayElevation:e,elevation:e?Object.assign({},a.elevation||s.map.elevation.options,{resolution:r}):null}]).then(function(t){let e=a?a.fileName||a.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0):a.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0);s.map.exportFeatures(t,{fileName:e,format:l})},function(e){s.open(t,a);TC.tool.Elevation&&e.message===TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.alert(s.getLocaleString("tooManyCoordinatesForElevation.warning")):TC.error(s.getLocaleString("elevation.error"))}).finally(function(){i&&i.removeWait(o)})},l=t.target.dataset.format;l===TC.Consts.format.GPX&&(o instanceof Array?o:[o]).some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon})?TC.confirm(s.getLocaleString("gpxNotCompatible.confirm"),function(){i((o instanceof Array?o:[o]).filter(t=>TC.feature.Polygon&&!(t instanceof TC.feature.Polygon)))}):i(o)}));const u=(o instanceof Array?o:[o]).some(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline}),h=(o instanceof Array?o:[o]).some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon});if(a.elevation){c.querySelector(s._selectors.ELEVATION_CHECKBOX).checked=1==e;e&&(u||h)&&a.elevation.resolution&&c.querySelector(s._selectors.INTERPOLATION_PANEL).classList.remove(TC.Consts.classes.HIDDEN);if(c.querySelector(s._selectors.INTERPOLATION_PANEL)){c.querySelectorAll(s._selectors.INTERPOLATION_RADIO)[n?1:0].checked=!0;if(n){c.querySelector(s._selectors.INTERPOLATION_DISTANCE).classList.remove(TC.Consts.classes.HIDDEN);c.querySelector(s._selectors.INTERPOLATION_DISTANCE+" input").value=i||c.querySelector(s._selectors.INTERPOLATION_DISTANCE+" input").value}}}c.addEventListener("change",TC.EventTarget.listenerBySelector(s._selectors.ELEVATION_CHECKBOX,function(t){var r=c.querySelector(s._selectors.INTERPOLATION_PANEL);r&&r.classList.toggle(TC.Consts.classes.HIDDEN,e||!(u||h));e=!e}));c.addEventListener("change",TC.EventTarget.listenerBySelector(s._selectors.INTERPOLATION_RADIO,function(t){c.querySelector(s._selectors.INTERPOLATION_DISTANCE).classList.toggle(TC.Consts.classes.HIDDEN);(n=!n)&&(c.querySelector(s._selectors.INTERPOLATION_DISTANCE+" input").value=i||c.querySelector(s._selectors.INTERPOLATION_DISTANCE+" input").value)}));c.addEventListener("change",TC.EventTarget.listenerBySelector(s._selectors.INTERPOLATION_DISTANCE,function(t){i=t.target.value}));TC.Util.showModal(l,{closeCallback:function(){l.parentElement.removeChild(l)}})})}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.FeatureInfo(this);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright"};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.FeatureInfo.prototype,e=function t(e,r){var n;if(Array.isArray(e))for(var i=0,o=(n=e.slice()).length;i<o;i++)n[i]=t(n[i]);else n="number"==typeof e?Math.round(e.toFixed(r)):e;return n};t.register=function(t){const e=this,r=TC.control.FeatureInfoCommons.prototype.register.call(e,t);document.createElement("div").appendChild(e.div);(e.options.displayElevation||e.map.options.elevation)&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t=e.options.displayElevation?"boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation:"boolean"==typeof e.map.options.elevation?{}:e.map.options.elevation;e.elevation=new TC.tool.Elevation(t)});return r};t.callback=function(t,e){const r=this;r.querying=!0;r.elevation&&(r.elevationRequest=r.elevation.getElevation({crs:r.map.crs,coordinates:t}));if(r.map&&r.filterLayer){var n=r.getLocaleString("featureInfo"),i=TC.Util.extend({},r.map.options.styles.marker,r.markerStyle,{title:n,set:n,showsPopup:!1});r.filterLayer.clearFeatures();r.highlightedFeature=null;r.filterFeature=null;r.filterLayer.addMarker(t,i).then(function(e){r.map.putLayerOnTop(r.filterLayer);r.filterFeature=e;r.renderResults({coords:e.geometry,displayElevation:r.elevation,loading:!0},function(){r.displayResults()});for(var n=!1,i=0;i<r.map.workLayers.length;i++){var o=r.map.workLayers[i];if(o.type===TC.Consts.layerType.WMS&&o.getVisibility()&&o.names.length>0){n=!0;break}}var a=r.map.getResolution();n?r.wrap.getFeatureInfo(t,a):setTimeout(function(){r.responseCallback({coords:t})})})}};t.responseCallback=function(t){const r=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(r,t);if(r.filterFeature){var n=t.services;if(n)for(var i=0;i<n.length;i++){for(var o=n[i],a=0;a<o.layers.length;a++)if(!o.layers[a].features.length){o.layers.splice(a,1);a-=1}if(!o.layers.length){n.splice(i,1);i-=1}}r.info.defaultFeature=t.defaultFeature;r.elevationRequest&&(t.displayElevation=!0);r.renderResults(t,function(){r.insertLinks();if(r.sharedFeatureInfo){r.div.querySelectorAll("ul."+r.CLASS+"-services li").forEach(function(t){t.classList.add(TC.Consts.classes.CHECKED)});for(var t,n=r.sharedFeatureInfo,i=0,o=r.info.services.length;i<o;i++){var a=r.info.services[i];if(a.mapLayers.some(function(t){return t.url===n.s})){for(var s=0,l=a.layers.length;s<l;s++){var c=a.layers[s];if(c.name===n.l){for(var u=0,h=c.features.length;u<h;u++){var d=c.features[u];if(d.id===n.f){t=d;var p=hex_md5(JSON.stringify({data:d.getData(),geometry:e(d.geometry,TC.Consts.DEGREE_PRECISION)}));n.h!==p&&TC.alert(r.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}if(t){r.highlightedFeature=t;r.map.addLayer({id:r.getUID(),type:TC.Consts.layerType.VECTOR,title:r.getLocaleString("foi"),owner:r,stealth:!0}).then(function(e){r.sharedFeatureLayer=e;r.filterLayer.clearFeatures();r.filterFeature=null;e.addFeature(t);r.map.zoomToFeatures([t])})}delete r.sharedFeatureInfo}else r.displayResults();r.div.querySelectorAll("ul."+r.CLASS+"-services label, ul."+r.CLASS+"-services a").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation()})})})}};t.displayResultsCallback=function(){const t=this;TC.control.FeatureInfoCommons.prototype.displayResultsCallback.call(t);if(t.elevationRequest){const e=t.getDisplayControl();t.getDisplayTarget().querySelector(`.${t.CLASS}-elev`).classList.add(TC.Consts.classes.HIDDEN);t.elevationRequest.then(function(r){if(e.currentFeature){const n=e.currentFeature.geometry;if(TC.Util.formatCoord(n[0],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)===TC.Util.formatCoord(r[0][0],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)&&TC.Util.formatCoord(n[1],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)===TC.Util.formatCoord(r[0][1],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)){const e=r.length?r[0][2]:null;t.displayElevation(e)}}})}else t.querying||t.info&&t.info.services||t.closeResults()};t.renderResults=function(t,e){const r=this;if(r.filterFeature){const n=r.filterFeature.geometry;if(t.coords&&n[0]===t.coords[0]&&n[1]===t.coords[1]){const n=r.map.options.locale||TC.Cfg.locale;t.isGeo=r.map.wrap.isGeo();if(t.coords){t.crs=r.map.crs;t.coords=t.coords.map(function(e){return TC.Util.formatNumber(e.toFixed(t.isGeo?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),n)})}r.renderData(t,e)}}};t.displayElevation=function(t){const e=this.map.options.locale||TC.Cfg.locale,r=null===t?"-":TC.Util.formatNumber(Math.round(t),e)+" m",n=this.getDisplayTarget().querySelector(`.${this.CLASS}-elev`);n.classList.toggle(TC.Consts.classes.HIDDEN,null===t);n.querySelector(`.${this.CLASS}-coords-val`).innerHTML=r};t.loadSharedFeature=function(t){const e=this;if(t){if(0===e.map.workLayers.filter(function(e,r){return e.type===TC.Consts.layerType.WMS&&e.url===t.s&&e.getDisgregatedLayerNames().indexOf(t.l)>=0}).length){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST);return}e.sharedFeatureInfo=t;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){const r=[-100,-100];e.beforeRequest({xy:r});e.filterLayer.clearFeatures();e.filterFeature=null;e.filterLayer.addMarker(r).then(function(r){e.filterFeature=r;e.wrap.getFeatureInfo(t.xy,t.r,{serviceUrl:t.s,layerName:t.l,featureId:t.f})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.control.FeatureTools=function(){const t=this;TC.Control.apply(t,arguments);const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:e+"-dialog-ip-m"};t.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const e="boolean"==typeof t.options.displayElevation?{}:t.options.displayElevation;t.elevation=new TC.tool.Elevation(e)});t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv)};TC.inherit(TC.control.FeatureTools,TC.Control);!function(){var t=TC.control.FeatureTools.prototype;t.CLASS="tc-ctl-ftools";t.TITLE_SEPARATOR=" \u2022 ";t.FILE_TITLE_SEPARATOR="__";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-ftools"><button class="tc-ctl-ftools-dl-btn" title="').h("i18n",e,{},{$key:"downloadFeature"}).w('">').h("i18n",e,{},{$key:"download"}).w('</button><button class="tc-ctl-ftools-share-btn" title="').h("i18n",e,{},{$key:"shareFeature"}).w('">').h("i18n",e,{},{$key:"share"}).w('</button><button class="tc-ctl-ftools-zoom-btn" title="').h("i18n",e,{},{$key:"zoomToFeature"}).w('">').h("i18n",e,{},{$key:"zoomToFeature"}).w('</button><button class="tc-ctl-ftools-del-btn" title="').h("i18n",e,{},{$key:"deleteFeature"}).w('">').h("i18n",e,{},{$key:"deleteFeature"}).w("</button></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-ftools-dialog tc-ctl-ftools-share-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"feature"}).w(" - ").h("i18n",e,{},{$key:"share"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-ftools-share-dialog-ctl"></div></div></div></div>')}e.__dustBody=!0;return e};var e=null;t.register=function(t){const e=this;t.on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(t){e.currentDisplay=t.control;if(e.currentDisplay.caller||!e.currentDisplay.caller&&e.currentDisplay.currentFeature){e.highlightedFeature=e.currentDisplay.caller||!e.currentDisplay.currentFeature?e.currentDisplay.caller.highlightedFeature:e.currentDisplay.currentFeature;e.addUI(e.currentDisplay)}}).on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(t){e.currentDisplay=null}).on(TC.Consts.event.FEATUREADD,function(t){const r=t.feature;e.currentDisplay&&e.currentDisplay.caller&&r===e.currentDisplay.caller.highlightedFeature&&(e.highlightedFeature=r)});return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),e.renderPromise()]).then(function(){e.map.addControl("share",{id:e.getUID(),div:e._dialogDiv.querySelector(".tc-modal-body ."+e.CLASS+"-share-dialog-ctl"),includeControls:!1}).then(function(t){e._shareCtl=t;r(e)}).catch(function(t){n(t instanceof Error?t:Error(t))})})})};t.render=function(){const t=this;return t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",{checkboxId:t.getUID(),elevation:t.options.displayElevation},function(r){t._dialogDiv.innerHTML=r;e||t.map.addControl("FeatureDownloadDialog").then(t=>{e=t})}))};t.addUI=function(t){const e=this,r=t.getMenuElement(),n=function(){return r&&!r.querySelector("."+e.CLASS)};n()?e.getRenderedHtml(e.CLASS,null,function(i){if(n()){const n=(new DOMParser).parseFromString(i,"text/html").body.firstChild;r.appendChild(n);e.updateUI(t);if(!e.map.options.stateful){const t=n.querySelector("."+e.CLASS+"-share-btn");t.parentElement.removeChild(t)}e._setToolButtonHandlers(n);const o=t.getContainerElement();e._decorateDisplay(o);TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){var t="";if(!o.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length&&e.highlightedFeature){t=e.highlightedFeature.id;!0===e.highlightedFeature.showsPopup&&new TC.control.Print({target:r,printableElement:o,title:t})}})}}):e.updateUI(t)};t._decorateDisplay=function(t){const e=this;if(e.highlightedFeature){const r=t.querySelector("table.tc-attr");if(r){r.addEventListener(TC.Consts.event.CLICK,function(t){e.zoomToCurrentFeature()});r.querySelectorAll("a, table label, table input").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation()})});r.classList.add(e.CLASS+"-zoom");r.setAttribute("title",e.getLocaleString("clickToCenter"))}}};t.updateUI=function(t){const e=this,r=t.getMenuElement().querySelector("."+e.CLASS);r.classList.remove(TC.Consts.classes.ACTIVE);clearTimeout(e._uiUpdateTimeout);e._uiUpdateTimeout=setTimeout(function(){const t=e.getCurrentFeature();r.classList.toggle(TC.Consts.classes.ACTIVE,!t||!t.layer.owner||t.layer.owner.filterLayer!==t.layer)},100)};t._setToolButtonHandlers=function(t){const e=this;t.querySelector("."+e.CLASS+"-dl-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.showDownloadDialog()});e.map.options.stateful&&t.querySelector("."+e.CLASS+"-share-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.showShareDialog()});t.querySelector("."+e.CLASS+"-zoom-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.zoomToCurrentFeature()});t.querySelector("."+e.CLASS+"-del-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.removeCurrentFeature()})};t.showDownloadDialog=function(){const t=this.getCurrentFeature();var r={title:this.getLocaleString("feature")+" - "+this.getLocaleString("download"),fileName:this._getFeatureFilename(t)};r=!0!==this.options.displayElevation?Object.assign({},r,{elevation:Object.assign({},this.map.elevation&&this.map.elevation.options,this.options.displayElevation)}):Object.assign({},r,{elevation:this.map.elevation&&this.map.elevation.options});(TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||TC.feature.Polygon&&t instanceof TC.feature.Polygon)&&(r=Object.assign({},r,{excludedFormats:["GPX"]}));e.open(t,r)};t.showShareDialog=function(){const t=this;TC.Util.showModal(t._dialogDiv.querySelector("."+t.CLASS+"-share-dialog"),{openCallback:function(){t.onShowShareDialog()},closeCallback:function(){t._shareCtl.featureToShare=null}})};t.getCurrentFeature=function(){return this.currentDisplay&&(this.currentDisplay.caller&&this.currentDisplay.caller.highlightedFeature||this.currentDisplay.currentFeature)};t.zoomToCurrentFeature=function(){const t=this;t.map&&t.map.zoomToFeatures([t.getCurrentFeature()],{animate:!0})};t.removeCurrentFeature=function(){const t=this,e=t.getCurrentFeature(),r=function(){t.highlightedFeature=null;e&&e.layer&&e.layer.removeFeature(e)},n=function(){t.currentDisplay&&(t.currentDisplay.close?t.currentDisplay.close():t.currentDisplay.hide())};if(e&&e.layer.owner&&e.layer===e.layer.owner.resultsLayer){r();n()}else TC.confirm(t.getLocaleString("deleteFeature.confirm"),function(){r();n()})};t.onShowShareDialog=function(){const t=this._shareCtl;t.extraParams=null;(function(t,e){e=e||{};return new Promise(function(r,n){const i=t.getCurrentFeature();if(i){const a=i.clone();a.setId(i.id);a.layer=i.layer;if(e.elevation){var o=!0;!e.elevation.resolution&&a.getGeometryStride()>2&&(o=!1);if(o){const i={crs:t.map.crs,features:[a],maxCoordQuantity:t.options.displayElevation&&t.options.displayElevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:0};t.elevation.setGeometry(i).then(function(t){r(t[0])},function(t){n(t instanceof Error?t:Error(t))})}else r(a)}else{const t=a.getCoordsArray(),e=t[0];if(e&&e.length>2){t.forEach(function(t){t.length=2});a.setCoords(a.geometry)}r(a)}}else r(null)})})(this).then(function(e){t.featureToShare=e;const r=t.div,n=t.generateLink();r.querySelector(".tc-url input[type=text]").value=n;r.querySelector(".tc-iframe input[type=text]").value=t.generateIframe(n)})};t.getFeatureTitle=function(t){var e="";t&&(e=t.id);return e};t._getFeatureFilename=function(t){return(this.getFeatureTitle(t).toString().replace(new RegExp(this.TITLE_SEPARATOR,"g"),this.FILE_TITLE_SEPARATOR)||this.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){var t=this;TC.Control.apply(t,arguments);Array.isArray(t.options.formats)?t.formats=t.options.formats:t.formats=[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];window.JSZip&&(window.JSZip instanceof Promise?window.JSZip.then(function(){t.formats.splice(1,0,TC.Consts.format.KMZ)}):t.formats.splice(1,0,TC.Consts.format.KMZ));t.layers=[];t.apiAttribution="";t.mainDataAttribution="";t.dataAttributions=[];t.exportsState=!0};TC.inherit(TC.control.FileImport,TC.Control);!function(){var t=TC.control.FileImport.prototype;t.CLASS="tc-ctl-file";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",e,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(e.get(["formats"],!1),e,{block:r},{}).w('" />').h("i18n",e,{},{$key:"openFile"}).w("</label></div></div>")}e.__dustBody=!0;function r(t,e){return t.w(".").f(e.getPath(!0,[]),e,"h").h("sep",e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w(",")}n.__dustBody=!0;return e};t.register=function(t){var e=this;const r=TC.Control.prototype.register.call(e,t);e.options.enableDragAndDrop&&t.wrap.enableDragAndDrop(e.options);t.on(TC.Consts.event.FEATURESIMPORT,function(r){const n=r.fileName,i=r.dropTarget,o=r.features;var a="."+TC.Consts.format.GPX.toLowerCase();n.toLowerCase().indexOf(a)===n.length-a.length||i!==e.map.div&&i!==e||t.addLayer({id:e.getUID(),title:n,owner:e,type:TC.Consts.layerType.VECTOR}).then(function(r){e.layers.push(r);const n=function(t,e){return t.concat(e)};for(var i=function(t){var r=t.geometry;if(r){var i;switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:i=[r];break;case TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint:case TC.feature.Polyline&&t instanceof TC.feature.Polyline:i=r;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:case TC.feature.Polygon&&t instanceof TC.feature.Polygon:i=r.reduce(n);break;case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:i=r.reduce(n).reduce(n)}i&&i.every(function(t){return Math.abs(t[0])<=180&&Math.abs(t[1])<=90})&&t.setCoords(TC.Util.reproject(r,"EPSG:4326",e.map.crs))}return t},a=0,s=o.length;a<s;a++){var l=i(o[a]);r.addFeature(l)}setTimeout(function(){t.zoomToFeatures(r.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(t){var r,n=t.file.name;r=".kmz"===n.toLowerCase().substr(n.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(e.getLocaleString(r,{fileName:n}),TC.Consts.msgErrorMode.TOAST);var i=new FileReader;i.onload=function(t){TC.error("Nombre del archivo: "+n+" \n Contenido del archivo: \n\n"+t.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};i.readAsText(t.file)}).on(TC.Consts.event.FEATUREREMOVE,function(t){const r=t.layer;e.layers.indexOf(r)>=0&&(r.features.length||e.map.removeLayer(r))}).on(TC.Consts.event.LAYERREMOVE,function(t){const r=e.layers.indexOf(t.layer);r>=0&&e.layers.splice(r,1)});return r};t.render=function(){const t=this;return t._set1stRenderPromise(t.renderData({formats:t.formats},function(){const e=t.div.querySelector("input[type=file]");e.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),r=this.parentElement;r.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);r.removeChild(e)});e.addEventListener("change",function(e){if(t.map){console.log("salta el change");t.map.wrap.loadFiles(e.target.files,{control:t})}})}))};t.exportState=function(){const t=this;return t.exportsState?{id:t.id,layers:t.layers.map(function(t){return{title:t.title,state:t.exportState()}})}:null};t.importState=function(t){const e=this;if(e.map){const r=[];t.layers.forEach(function(t){r.push(e.map.addLayer({id:e.getUID(),title:t.title,owner:e,type:TC.Consts.layerType.VECTOR}))});Promise.all(r).then(function(r){for(var n=0,i=r.length;n<i;n++){const i=r[n];i.importState(t.layers[n].state);e.layers.push(i)}})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var t=TC.control.FullScreen.prototype;t.CLASS="tc-ctl-fscreen";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",e,{},{$key:"fscreen.tip"}).w('"></button>')}e.__dustBody=!0;return e};const e={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},r=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],n=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],i=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],o="undefined"!=typeof window&&void 0!==window.document?window.document:{},a="fullscreenEnabled"in o&&Object.keys(e)||r[0]in o&&r||n[0]in o&&n||i[0]in o&&i||[];t.fscreen={inFullscreen:!1,requestFullscreen:t=>t[a[e.requestFullscreen]](),requestFullscreenFunction:t=>t[a[e.requestFullscreen]],get exitFullscreen(){return o[a[e.exitFullscreen]].bind(o)},addEventListener:(t,r,n)=>o.addEventListener(a[e[t]],r,n),removeEventListener:(t,r,n)=>o.removeEventListener(a[e[t]],r,n),get fullscreenEnabled(){return Boolean(o[a[e.fullscreenEnabled]])},set fullscreenEnabled(t){},get fullscreenElement(){return o[a[e.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return o[("on"+a[e.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return o[("on"+a[e.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return o["on"+a[e.fullscreenerror].toLowerCase()]},set onfullscreenerror(t){return o["on"+a[e.fullscreenerror].toLowerCase()]=t}};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);r.then(function(){const t=e.div.querySelector("."+e.CLASS+"-btn");if(e.fscreen.fullscreenEnabled){e.fscreen.addEventListener("fullscreenchange",function(){e.fscreen.inFullscreen=null!==e.fscreen.fullscreenElement;t.classList.toggle(TC.Consts.classes.ACTIVE,e.fscreen.inFullscreen);t.setAttribute("title",e.fscreen.inFullscreen?e.getLocaleString("fscreen.tip.return"):e.getLocaleString("fscreen.tip"))},!1);t.addEventListener("click",function(){e.fscreen.inFullscreen?e.fscreen.exitFullscreen():e.fscreen.requestFullscreen(e.map.div)},!1)}else e.disable()});return r}}();Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,r=0;r<e;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;t+=arguments[r]*arguments[r]}return Math.sqrt(t)};!function(){for(var t=0,e=["ms","moz","webkit","o"],r=!(!window.performance||!window.performance.now),n=0,i=e.length;n<i&&!window.requestAnimationFrame;n+=1){window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);t=n+i;return o});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});if(!r){var o=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(t,e){o(function(e){return t(e<1e12?e:e-a)},e)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(t){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.delta=500;this.walkingSpeed=5e3;this.gapHill=this.options.gapHill||20;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var t=TC.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation";t.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:300,MEDIUM_WIDTH:310,MAX_WIDTH:445};t.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content">    <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div>        \x3c!-- img se insertan en el div del mapa--\x3e        <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;"></div><div class="tc-ctl-geolocation-track-panel-block" ><input id="tc-ctl-geolocation-track-panel-opened-').f(e.get(["controlId"],!1),e,"h").w('" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened-').f(e.get(["controlId"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",e,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form>                    <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",e,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" checked value="tracks" /><span>').h("i18n",e,{},{$key:"geo.gps"}).w('</span></label><label  class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",e,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",e,{},{$key:"geo.tracks"}).w('</span></label>                    </form></div>                        <div  class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",e,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" />                <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",e,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",e,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file-').f(e.get(["controlId"],!1),e,"h").w('" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file-').f(e.get(["controlId"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",e,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel">    <div class="tc-alert alert-warning tc-hidden" ><p id="panel-msg">').h("i18n",e,{},{$key:"geo.trk.panel.1"}).w("                    <ul><li>").h("i18n",e,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div>            <div class="tc-ctl-geolocation-track-ui">   <div  class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render-').f(e.get(["controlId"],!1),e,"h").w('" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render-').f(e.get(["controlId"],!1),e,"h").w('" class="tc-ctl-geolocation-track-render" title="').h("i18n",e,{},{$key:"geo.trk.render"}).w('">').h("i18n",e,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",e,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.deactivate"}).w('</button></div><div  class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",e,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",e,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><div class="tc-ctl-geolocation-track-center tc-hidden"><button title="').h("i18n",e,{},{$key:"geo.trk.center"}).w('"></button></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-track-node"]=function(){dust.register(t.CLASS+"-track-node",e);function e(t,e){return t.w('<li data-id="').f(e.get(["id"],!1),e,"h").w('" data-uid="').f(e.get(["uid"],!1),e,"h").w('"><span class="tc-draw tc-selectable" title="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(e.get(["name"],!1),e,"h").w('" />    <button class="tc-btn-simulate" title="').h("i18n",e,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",e,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",e,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",e,{},{$key:"tr.lst.pause"}).w('"></button>    <button hidden class="tc-btn-backward" title="').h("i18n",e,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",e,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",e,{},{$key:"tr.lst.forward"}).w('"></button>        <button class="tc-btn-save tc-hidden" title="').h("i18n",e,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",e,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",e,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export" title="').h("i18n",e,{},{$key:"download"}).w('"></button>    </li>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-track-snapping-node"]=function(){dust.register(t.CLASS+"-track-snapping-node",e);function e(t,e){return t.w("<ul>").x(e.get(["n"],!1),e,{block:r},{}).w("<li> <span>").x(e.get(["isGeo"],!1),e,{else:n,block:i},{}).w(":</span> ").f(e.get(["x"],!1),e,"h").w("</li><li> <span>").x(e.get(["isGeo"],!1),e,{else:o,block:a},{}).w(":</span> ").f(e.get(["y"],!1),e,"h").w(" </li>").x(e.get(["z"],!1),e,{block:s},{}).x(e.get(["m"],!1),e,{block:c},{}).w("</ul>")}e.__dustBody=!0;function r(t,e){return t.w("<li><span>").h("i18n",e,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(e.get(["n"],!1),e,"h").w("</li>")}r.__dustBody=!0;function n(t,e){return t.w("X")}n.__dustBody=!0;function i(t,e){return t.h("i18n",e,{},{$key:"lon"})}i.__dustBody=!0;function o(t,e){return t.w("Y")}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"lat"})}a.__dustBody=!0;function s(t,e){return t.h("ne",e,{block:l},{key:e.get(["z"],!1),value:0})}s.__dustBody=!0;function l(t,e){return t.w("<li> <span>Z:</span> ").f(e.get(["z"],!1),e,"h").w(" </li>")}l.__dustBody=!0;function c(t,e){return t.w("<li> ").f(e.get(["m"],!1),e,"h").w(" </li>")}c.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.gps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",e,{},{$key:"geo.trk.dialog.new"}).w(' </button>            <button class="tc-button tc-modal-close"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",e,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p">                <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",e,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label>        </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",e,{},{$key:"ok"}).w(" </button></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-tracking-toast"]=function(){dust.register(t.CLASS+"-tracking-toast",e);function e(t,e){return t.w('<table class="tc-ctl-geolocation-info-tracking"><tr><th>').x(e.get(["isGeo"],!1),e,{else:r,block:n},{}).w(":</th><td> ").f(e.get(["x"],!1),e,"h").w(" </td>").x(e.get(["accuracy"],!1),e,{block:i},{}).w("</tr><tr><th>").x(e.get(["isGeo"],!1),e,{else:o,block:a},{}).w(":</th><td> ").f(e.get(["y"],!1),e,"h").w(" </td>").x(e.get(["speed"],!1),e,{block:s},{}).w("</tr><tr>").x(e.get(["z"],!1),e,{block:l},{}).x(e.get(["mdt"],!1),e,{block:h},{}).w("</tr>    </table>")}e.__dustBody=!0;function r(t,e){return t.w("X")}r.__dustBody=!0;function n(t,e){return t.h("i18n",e,{},{$key:"lon"})}n.__dustBody=!0;function i(t,e){return t.w("<th>").h("i18n",e,{},{$key:"geo.trk.accuracy"}).w(":</th><td> ").f(e.get(["accuracy"],!1),e,"h").w(" m </td>")}i.__dustBody=!0;function o(t,e){return t.w("Y")}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"lat"})}a.__dustBody=!0;function s(t,e){return t.w("<th>").h("i18n",e,{},{$key:"geo.trk.speed"}).w(":</th><td>").f(e.get(["speed"],!1),e,"h").w(" km/h</td>")}s.__dustBody=!0;function l(t,e){return t.w("<th>").x(e.get(["isGeo"],!1),e,{else:c,block:u},{}).w(":</th><td> ").f(e.get(["z"],!1),e,"h").w(" m </td>")}l.__dustBody=!0;function c(t,e){return t.w("Z")}c.__dustBody=!0;function u(t,e){return t.h("i18n",e,{},{$key:"ele"})}u.__dustBody=!0;function h(t,e){return t.w('<th title="').h("i18n",e,{},{$key:" mdt.title"}).w('">').h("i18n",e,{},{$key:"ele"}).w(" (").h("i18n",e,{},{$key:"mdt"}).w("):</th><td>").f(e.get(["mdt"],!1),e,"h").w(" m </td>")}h.__dustBody=!0;return e};var e=function(t){const e=this;t.layer;t.layer===e.layerTrack&&e.clearSelection()};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap=new TC.wrap.control.Geolocation(e);e.wrap.register(t);t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.GPS"}).then(function(t){e.layerGPS=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(t){e.layerTracking=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(t){var e=t.getData().name;return e&&(e+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}}}).then(function(t){e.layerTrack=t});t.on(TC.Consts.event.FEATURESIMPORT,function(t){const e=this,r=t.fileName,n=t.dropTarget;var i="."+TC.Consts.format.KML.toLowerCase(),o="."+TC.Consts.format.GPX.toLowerCase();if(r.toLowerCase().indexOf(o)===r.length-o.length||r.toLowerCase().indexOf(i)===r.length-i.length&&n===e){e.clear(e.Const.Layers.TRACK);e.importTrack(t);/.kml$/g.test(r.toLowerCase())&&e.layerTrack&&e.layerTrack.styles&&e.layerTrack.features.forEach(function(t){t instanceof TC.feature.Point&&e.layerTrack.styles.point?t.setStyle(e.layerTrack.styles.point):t instanceof TC.feature.Polyline&&e.layerTrack.styles.line&&t.setStyle(e.layerTrack.styles.line)})}}.bind(e));t.on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.elevationChartData&&(e.elevationChartData.coords=TC.Util.reproject(e.elevationChartData.coords,t.oldCrs,t.newCrs))});return r};t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return e.renderData({controlId:e.id},t)})};t.importTrack=function(t){var r=this;r.map.off(TC.Consts.event.FEATUREREMOVE,e);if(r.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&r.map.toast(r.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var n=r.getLoadingIndicator().addWait();r.importedFileName=t.fileName;const e=[];for(var i=0,o=t.features.length;i<o;i++)e.push(r.layerTrack.addFeature(t.features[i]));Promise.all(e).then(function(){r.wrap.processImportedFeatures({wait:n,notReproject:t.notReproject});if(r.layerTrack){r.map&&r.map.layout&&r.map.layout.accordion&&r.div.classList.contains(TC.Consts.classes.COLLAPSED)&&r.map.controls.filter(function(t){return t!==r&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});r.div.classList.remove(TC.Consts.classes.COLLAPSED);r.div.querySelector("."+r.CLASS+"-btn-tracks > span").click();t.isShared||r.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};t.prepareFeaturesToShare=function(t){const e=this;return new Promise(function(r,n){if(t){var i=e.availableTracks.filter(function(e){return e.uid.toString()===t.toString()})[0].data,o=Math.pow(10,TC.Consts.DEGREE_PRECISION+1),a=(new ol.format.GeoJSON).readFeatures(i);const n=new Array(a.length);a.forEach(function(t,e){n[e]=TC.wrap.Feature.createFeature(t)});Promise.all(n).then(function(t){e.featuresToShare=t.map(function(t){const e={};switch(!0){case TC.feature.Marker&&t instanceof TC.feature.Marker:e.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&t instanceof TC.feature.Point:e.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:e.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:e.type=TC.Consts.geom.MULTIPOLYLINE}e.id=t.id;e.geom=TC.Util.compactGeometry(t.geometry,o);e.data=t.getData();return e});r()})}else r()})};var r=!0;t.renderData=function(a,s){const l=this;var c=l.Const.Selector;return TC.Control.prototype.renderData.call(l,a,function(){const a=l.div.querySelectorAll(l._classSelector+"-panel");l.div.querySelectorAll("."+l.CLASS+"-select span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=t.target;e&&"LABEL"!==e.tagName;)e=e.parentElement;const r=e.querySelector("input[type=radio][name=mode]").value;a.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches("."+l.CLASS+"-"+r))})})});l.track={activateButton:l.div.querySelector(l._classSelector+"-track-ui-activate"),deactivateButton:l.div.querySelector(l._classSelector+"-track-ui-deactivate"),trackSearch:l.div.querySelector(l._classSelector+"-track-available-srch"),trackImportFile:l.div.querySelector(l._classSelector+"-track-import"),trackSave:l.div.querySelector(l._classSelector+"-track-save"),trackAdd:l.div.querySelector(l._classSelector+"-track-add-wpt"),trackContinue:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-continue"),trackRenew:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-new"),trackClose:l._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-ok")};l.track.trackList=l.div.querySelector(l._classSelector+"-track-available-lst");l.track.trackToolPanelOpened=l.div.querySelector("#tc-ctl-geolocation-track-panel-opened-"+l.id);l.div.querySelector("."+t.CLASS+"-track-panel-help").addEventListener("click",function(){o.call(l)});l.track.trackName=l.div.querySelector(l._classSelector+"-track-title");l.track.trackWPT=l.div.querySelector(l._classSelector+"-track-waypoint");TC.Util.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(l.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.trackImportFile.disabled=!1;l.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),r=this.parentElement;r.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);r.removeChild(e)});const t=function(){l.map.off(TC.Consts.event.LAYERERROR,t);l.clearFileInput(l.track.trackImportFile);TC.alert(l.getLocaleString("geo.trk.upload.error3"))};l.track.trackImportFile.addEventListener("change",function(e){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,t);l.map.wrap.loadFiles(e.target.files,{control:l})}}})}else console.log("no es posible la importaci\xf3n");l.track.activateButton.addEventListener("click",function(){l.activateTracking();n.call(l)});l.track.deactivateButton.addEventListener("click",function(){l.deactivateTracking();i.call(l)});const h=function(){!function(t){t=t.toLowerCase();const e=Array.from(l.track.trackList.querySelectorAll("li"));e.forEach(function(t){t.style.display="none"});const r=e.filter(function(t){return t.matches("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK)}),n=l.div.querySelector(l._classSelector+"-track-search-icon");if(0===t.length){r.forEach(function(t){t.style.display=""});n.style.visibility="visible"}else{n.style.visibility="hidden";var i=new RegExp(t,"i");r.forEach(function(t){t.style.display=i.test(t.querySelector("span").textContent)?"":"none"});r.some(function(t){return""===t.style.display})||e.forEach(function(t){t.matches('[class^="tc-ctl-geolocation-track-not"]')&&(t.style.display="")})}}(this.value.toLowerCase().trim())};l.track.trackSearch.addEventListener("keyup",h);l.track.trackSearch.addEventListener("search",h);l.track.trackSave.addEventListener("click",l.saveTrack.bind(l));l.track.trackAdd.addEventListener("click",l.addWaypoint.bind(l));const d=l.div.querySelector(l._classSelector+"-track-available-lst");var p=function(t,e){"LI"!==e.tagName&&(e=e.parentElement);const r=e.querySelector("input"),n=e.querySelector("span");if(t){r.classList.remove(TC.Consts.classes.HIDDEN);r.focus();r.value=n.textContent;n.classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.EDIT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.DELETE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.DRAW).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.SAVE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{r.classList.add(TC.Consts.classes.HIDDEN);n.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.EDIT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.DELETE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.DRAW).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.SAVE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(t,e){if(e){var r=[c.SIMULATE,c.EDIT,c.DELETE,c.EXPORT],n=[c.STOP,c.PAUSE,c.BACKWARD,c.FORWARD,c.SPEED],i="LI"===e.tagName?e:e.parentNode;r.forEach(function(e){i.querySelector(e).hidden=t});n.forEach(function(e){i.querySelector(e).hidden=!t})}};d.addEventListener("click",TC.EventTarget.listenerBySelector(c.SIMULATE,function(t){var e=l.getLoadingIndicator().addWait();t.target.parentElement.querySelector(c.SPEED).textContent="x 1";y(l,t.target).then(function(){l.getLoadingIndicator().removeWait(e)})}));d.addEventListener("click",TC.EventTarget.listenerBySelector(c.DRAW,function(t){var e=l.getLoadingIndicator().addWait();g(l,t.target).then(function(){l.getLoadingIndicator().removeWait(e)})}));l.on(l.Const.Event.IMPORTEDTRACK,function(t){if(l.isDisabled)l.map.toast(l.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const e=l.track.trackList.querySelector('li[data-id="'+t.index+'"]');g(l,e.querySelector(c.DRAW));setTimeout(function(){l.track.trackList.scrollTop=t.index*e.offsetHeight},100)}});const f=function(t,e){t.track.trackList.querySelectorAll("li[data-id]").forEach(function(r){if(r.dataset.id!==e){const e=r.querySelector(c.SIMULATE),n=r.querySelector(c.PAUSE);e.classList.remove(t.Const.Classes.SIMULATIONACTIVATED);e.setAttribute("title",t.getLocaleString("tr.lst.simulate"));n.classList.remove("play");n.setAttribute("title",t.getLocaleString("tr.lst.pause"));t.uiSimulate(!1,r);p(!1,r)}});t.clear(t.Const.Layers.TRACK)};var g=function(t,r){return new Promise(function(n,i){const o=r.parentElement;setTimeout(function(){if(o.classList.contains(t.Const.Classes.SELECTEDTRACK)){t.uiSimulate(!1,r);t.clear(t.Const.Layers.TRACK);t.map.off(TC.Consts.event.FEATUREREMOVE,e);r.setAttribute("title",r.textContent)}else if(t.getSelectedTrack()){f(t,o.dataset.id);t.drawTrack(o)}else t.drawTrack(o);o.classList.contains(t.Const.Classes.SELECTEDTRACK)?t.prepareFeaturesToShare(o.dataset.uid).then(function(){n()}):n()},0)})},y=function(t,e){return new Promise(function(r,n){setTimeout(function(){const n=e.parentElement;f(t,n.dataset.id);t.uiSimulate(!1,t.getSelectedTrack());t.uiSimulate(!0,e);t.simulate_paused=!1;t.simulateTrack(n);r()},0)})};d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EDIT,function(t){p(!0,t.target)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.DELETE,function(t){l.removeTrack(t.target.parentElement)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.SAVE,function(t){if(0===t.target.parentElement.querySelector("input").value.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName(t.target.parentElement.dataset.id,t.target.parentElement.querySelector("input").value);p(!1,t.target)}}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.CANCEL,function(t){p(!1,t.target)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EXPORT,function(t){const e=t.target.parentElement;t.target.setAttribute("disabled","");l.export(e).then(r=>{l.getDownloadDialog().then(function(n){var i=e.querySelector("span").textContent,o=new RegExp(l.Const.SupportedFileExtensions.join("|"),"gi"),a=i.replace(o,"");const s={title:l.getLocaleString("download"),fileName:a,elevation:{resolution:20,sampleNumber:200}};n.open(r,s);t.target.removeAttribute("disabled")})})}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.STOP,function(t){l.uiSimulate(!1,t.target);l.wrap.simulateTrackEnd();const e=t.target.parentElement.querySelector(c.PAUSE);e.classList.remove("play");e.setAttribute("title",l.getLocaleString("tr.lst.pause"));t.target.parentElement.querySelector(c.SPEED).textContent="x 1";l.simulate_speed=1}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.PAUSE,function(t){l.simulate_paused=!t.target.classList.contains("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);t.target.setAttribute("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));t.target.classList.toggle("play",!!l.simulate_paused)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.BACKWARD,function(t){1==l.simulate_speed?l.simulate_speed=.5:l.simulate_speed=l.simulate_speed/2;t.target.parentElement.querySelector(l._classSelector+" "+c.FORWARD).disabled=!1;t.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;.000244140625==l.simulate_speed&&(t.target.disabled=!0)}));d.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.FORWARD,function(t){l.simulate_speed=l.simulate_speed/.5;t.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;t.target.parentElement.querySelector(l._classSelector+" "+c.BACKWARD).disabled=!1;4096==l.simulate_speed&&(t.target.disabled=!0)}));l.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();u.call(l)});l.track.trackRenew.addEventListener("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.trackClose.addEventListener("click",function(){i.call(l)});l.track.trackAdvertisementOK.addEventListener("click",function(){const t=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(t.length>0){new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.setItem(t[0].getAttribute("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=document.querySelector("#tc-ctl-geolocation-track-render-"+l.id);l.track.renderTrack.addEventListener("change",function(){l.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&l.layerTracking.setVisibility(this.checked);r=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()});TC.Util.isFunction(s)&&s()})};t.activate=function(){};t.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var n=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},i=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},o=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};t.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};t.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};t.setFormatInfoNewPosition=function(t){var e={},r=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var n=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(t.position,this.map.crs,this.map.view3D.crs):t.position;e.x=n[0].toLocaleString(r);e.y=n[1].toLocaleString(r);e.mdt=Math.round(this.map.view3D.getHeightFromMDT(n)).toLocaleString(r);e.isGeo=!0}else{e.x=Math.round(t.position[0]).toLocaleString(r);e.y=Math.round(t.position[1]).toLocaleString(r)}e.z=Math.round(t.altitude).toLocaleString(r);e.accuracy=Math.round(t.accuracy).toLocaleString(r);e.speed=t.speed.toLocaleString(r,{minimumFractionDigits:1,maximumFractionDigits:1});return e};t.renderInfoNewPosition=function(t){var e=this;e.getRenderedHtml(e.CLASS+"-tracking-toast",e.setFormatInfoNewPosition(t.pd),function(t){if(e.track.infoPanel)"boolean"==typeof e.track.infoPanel||e.track.infoPanel.isMinimized()||e.track.infoPanel.renderPromise().then(function(){e.track.infoPanel.getTableContainer().innerHTML=t;e.track.infoPanel.isVisible()||e.track.infoPanel.doVisible()});else{e.track.infoPanel=!0;var r,n={content:"table",titles:{main:e.getLocaleString("geo.mylocation"),max:e.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const o=function(t){n.position=t.POSITION.RIGHT;r=t.addControl("resultsPanel",n)};if(e.options.displayOn){var i=e.map.getControlsByClass("TC.control."+e.options.displayOn[0].toUpperCase()+e.options.displayOn.substring(1))[0];i?o(i):e.map.addControl(e.options.displayOn).then(o)}else{n.div=document.createElement("div");e.map.div.appendChild(n.div);r=e.map.addControl("resultsPanel",n)}r.then(function(r){e.map.getControlsByClass("TC.control.ResultsPanel").filter(function(t){return"table"===t.content&&t!==r}).forEach(function(t){t.close()});e.track.infoPanel=r;r.renderPromise().then(function(){r.open(t)})})}})};var a,s,l,c=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},u=function(){var t=this;t.activate();n.call(t);c.call(t);t.on(t.Const.Event.POSITIONCHANGE,function(e){t.currentPoint=e.pd;t.renderInfoNewPosition(e);t.track.trackName.disabled=!1;t.track.trackSave.disabled=!1;t.track.trackWPT.disabled=!1;t.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features)});t.on(t.Const.Event.STATEUPDATED,function(t){});t.clear(t.Const.Layers.TRACKING);y.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);t.wrap.setTracking(!0)},h=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();g.apply(this)},d=function(){var t=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}();document[t]||h.apply(this);console.log("video is: "+this.videoScreenOn.paused)},p=function(){l||(l=d.bind(this));a||(a=function(){f.apply(this)}.bind(this));s||(s=h.bind(this));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",a,!1);window.addEventListener("pageshow",s,!1)}else{window.addEventListener("blur",a,!1);window.addEventListener("focus",s,!1)}},f=function(){var t=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},g=function(){var t=this;localforage.getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then(function(e){null!==e&&"null"!==e&&e.length>0&&TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)})},y=function(t){var e=this;new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.getItem(t).then(function(r){if(null==r){const r=e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),n=r.querySelector('input[type="checkbox"]');n.setAttribute("name",t);n.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop");r.querySelector("h3").textContent=t==e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title");TC.Util.showModal(e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});e.map.toast(TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};t._askTracking=function(t){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){TC.Util.isFunction(t)&&t()}});return!0};t.activateTracking=function(){var t=this,e=!0;t.isActive||t.activate();t.clear(t.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(t.getLocaleString("geo.error.trackinglocalstorage")):TC.error(r);e=!1}if(e){(function(){if(!this.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var e=document.createElement("source");e.src=t.WebM;e.type="video/webm";this.videoScreenOn.appendChild(e);var r=document.createElement("source");r.src=t.MP4;r.type="video/mp4";this.videoScreenOn.appendChild(r)}this.videoScreenOn.play()}).apply(t);p.apply(t);t.sessionTracking=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP);if(t.sessionTracking){t._askTracking(function(){i.call(t)})||t.track.trackRenew.click()}else u.call(t)}else i.call(t)};t.deactivateTracking=function(){var t=this,e=function(){t.track.infoPanel.close();f.apply(t);t.wrap.setTracking(!1);delete t.geopositionTracking;r||t.div.querySelector(t._classSelector+"-track-render").querySelector("label").click();(function(){this.videoScreenOn&&this.videoScreenOn.pause()}).apply(t);(function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",a,!1);window.removeEventListener("pageshow",s,!1)}else{window.removeEventListener("blur",a,!1);window.removeEventListener("focus",s,!1)}}).apply(t);t.off(t.Const.Event.POSITIONCHANGE);t.off(t.Const.Event.STATEUPDATED);i.call(t);t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.clear(t.Const.Layers.TRACKING);t.clear(t.Const.Layers.GPS);return!0};if(t.wrap.hasCoordinates()){t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return e()}return e()};t.getStoredTracks=function(){const t=this;return new Promise(function(e,r){var n=[];localforage.keys().then(function(r){if(0==(r=r.filter(function(e){return 0!==e.indexOf(t.Const.LocalStorageKey.TRACKINGTEMP)&&0===e.indexOf(t.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(e)})).length){t.availableTracks=n;e(n)}const i=new Array(r.length);r.forEach(function(t,e){i[e]=new Promise(function(e,r){localforage.getItem(t,function(t,r){e(r)})})});Promise.all(i).then(function(r){if(r&&r.length){r.forEach(function(t){(t=JSON.parse(t))instanceof Array?n=n.concat(t):n.push(t)});var i=n.length>1?m(n):n;t.availableTracks=i;e(i)}})})})};var m=function(t){var e=[];for(var r in t)if(t[r]&&"object"==typeof t[r]){e.push(t[r]);e.sort(function(t,e){return"string"==typeof t.name&&TC.Util.isFunction(t.name.localeCompare)?t.name.localeCompare(e.name):0})}return e};t.setStoredTracks=function(t){const e=this;return new Promise(function(r,n){const i=[];t.forEach(function(t){i.push(new Promise(function(r,n){localforage.setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),function(t,e){r(e)})}))});Promise.all(i).then(function(){e.getStoredTracks().then(function(){e.bindTracks();r()})})})};t.getAvailableTracks=function(){const t=this;return new Promise(function(e,r){t.availableTracks?e(t.availableTracks):t.getStoredTracks().then(function(t){e(t)})})};t.bindTracks=function(){var t=this;t.track.trackList.querySelectorAll("li").forEach(function(t){t.style.display="none"});t.getAvailableTracks().then(function(e){if(C(e)){t.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(t){t.style.display=""});t.track.trackSearch.disabled=!0}else{const o=t.getSelectedTrack();var r;o&&(r=o.dataset.uid);t.track.trackList.querySelectorAll("li[data-id]").forEach(function(e){t.track.trackList.removeChild(e)});for(var n=0;n<e.length;n++){var i=e[n];"object"==typeof i&&t.getRenderedHtml(t.CLASS+"-track-node",{id:n,uid:i.uid,name:i.name?i.name.trim():""},function(e){const r=(new DOMParser).parseFromString(e,"text/html").body.firstChild;t.track.trackList.appendChild(r)})}r&&t.setSelectedTrack(t.track.trackList.querySelector('li[data-uid="'+r+'"]'));t.track.trackSearch.disabled=!1}})};t.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);const t=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();this.miDiv=document.createElement("div");this.miDiv.classList.add("miDiv");this.miDiv.style.width=t.width+"px";this.miDiv.style.height=t.height+"px";this.miProgressDiv=document.createElement("div");this.miProgressDiv.classList.add("miProgressDiv",this.CLASS+"-track-elevation-chart-progress",TC.Consts.classes.HIDDEN);this.miProgressDiv.style.width="0%";this.miProgressDiv.style.height=t.height+"px";this.miProgressTextDiv=document.createElement("div");this.miProgressTextDiv.classList.add("miProgressTextDiv","tc-ctl-geolocation-track-elevation-chart-progress","text");this.miProgressTextDiv.style.width=t.width+"px";this.miProgressTextDiv.style.height=t.height+"px";this.miDiv.style.top=t.top+"px";this.miDiv.style.left=t.left+"px";this.miDiv.style.bottom=t.bottom+"px";this.miDiv.style.right=t.right+"px";this.miDiv.style.position="absolute";this.miDiv.style.zIndex=10008;this.miDiv.style.display="none";this.miProgressDiv.appendChild(this.miProgressTextDiv);this.miDiv.appendChild(this.miProgressDiv);document.body.appendChild(this.miDiv)};t.chartProgressClear=function(){const t=this;if(t.miDiv){t.miDiv.parentElement.removeChild(t.miDiv);t.miDiv=null;t.miProgressDiv=null;t.miProgressTextDiv=null}};t.chartSetProgress=function(t,e,r,n){this.miDiv&&"none"===this.miDiv.style.display&&(this.miDiv.style.display="");this.miProgressDiv.classList.remove(TC.Consts.classes.HIDDEN);var i=t.d,o=(i+Math.hypot(t.p[0]-e[0],t.p[1]-e[1]))/r*100;this.miProgressDiv.style.width=o+"%";var a,s,l=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,c=parseInt(e[2].toFixed(0)).toLocaleString(l);if(i/1e3<1){a=Math.round(i/1e3*1e3);s=" m"}else{a=Math.round(i/1e3*100)/100;s=" km"}a=a.toLocaleString(l);this.miProgressTextDiv.innerHTML="<div><span>"+c+" m</span><br><span>"+a+s+"</span></div>"+(n?"<br><span>"+n.toString+"</span>":"")};t._getTime=function(t,e){var r=e-t,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60;n.h=o+24*i;var a=Math.floor(r/1e3/60);r-=1e3*a*60;n.m=a;n.s=Math.floor(r/1e3);return TC.Util.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};t.simulateTrack=function(t){var e=this;e.simulate_speed=1;e.drawTrack(t,!1).then(function(){e.wrap.simulateTrack()})};t.drawTrack=function(t,e){var r=this;c.call(r);return new Promise(function(e,n){r.setSelectedTrack(t);r.drawTrackingData(t).then(function(){r.elevationTrack(t).then(()=>{r.activate();e()})})})};t.elevationTrack=function(r,n){var i=this;return new Promise((o,a)=>{const s=function(){i.resultsPanelChart&&(i.resultsPanelChart.currentFeature=i.layerTrack.features.filter(t=>!(TC.feature.Marker&&t instanceof TC.feature.Marker||TC.feature.Point&&t instanceof TC.feature.Point))[0])};if(n){i.wrap.simulateTrackEnd();i.uiSimulate(!1,r);return}if(!i.onResize){i.onResize=i.elevationTrack.bind(i,r,!0);window.addEventListener("resize",i.onResize,!1)}let l=[];i.track.elevationChart&&(i.track.elevationChart=i.track.elevationChart.destroy());(function(t){return new Promise(function(e,r){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){i.getTrackingData(t).then(function(t){var r=t.data;if(r){var n,o;n=[];o=[];var a,s,c,u=!0,h={},d={},p=(new ol.format.GeoJSON).readFeatures(r),f=function(){if(c.getLayout()==ol.geom.GeometryLayout.XYZ||c.getLayout()==ol.geom.GeometryLayout.XYZM){var t=0;if(i.map.crs!==i.map.options.utmCrs){line=new ol.geom.LineString(TC.Util.reproject(c.getCoordinates(),i.map.crs,i.map.options.utmCrs));t=line.getLength()}else t=c.getLength();return parseFloat((t/1e3).toFixed(2))}return null},g=function(){if(c.getLayout()==ol.geom.GeometryLayout.XYZM||c.getLayout()==ol.geom.GeometryLayout.XYM){var t=c.getLastCoordinate()[3]-c.getFirstCoordinate()[3];return{s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}return null},y=function(t){if(l.length>0){var e=0;l.forEach(function(r,n,o){var a=0===n?r:o[n-1];if(i.map.crs!==i.map.options.utmCrs){r=TC.Util.reproject(r,i.map.crs,i.map.options.utmCrs);a=TC.Util.reproject(a,i.map.crs,i.map.options.utmCrs)}const s=r[0]-a[0],l=r[1]-a[1];e+=Math.sqrt(s*s+l*l);t.push(parseFloat(e.toFixed(2)))})}},m=function(t){for(var r=0;r<l.length;r++){if(!(l[r].length>2)){e(null);return}var n=Math.round(10*l[r][2])/10;u&&n>0&&(u=!1);t.push(n);0==r&&(a=s=n);a=Math.min(a,n);s=Math.max(s,n)}};p.filter(function(t){return"linestring"===t.getGeometry().getType().toLowerCase()||"multilinestring"===t.getGeometry().getType().toLowerCase()}).forEach(function(e){switch((c=e.getGeometry()).getType().toLowerCase()){case"linestring":if(t.layout===ol.geom.GeometryLayout.XYZM||t.layout===ol.geom.GeometryLayout.XYZ){d=g();f();h=TC.tool.Elevation.getElevationGain({coords:c.getCoordinates(),hillDeltaThreshold:i.gapHill});l=l.concat(c.getCoordinates());y(n);m(o)}break;case"multilinestring":if(t.layout===ol.geom.GeometryLayout.XYZM||t.layout===ol.geom.GeometryLayout.XYZ)for(var r,a=c.getLineStrings(),s=0;s<a.length;s++){f(a[s]);a[s].getLayout()==ol.geom.GeometryLayout.XYZM&&(r+=a[s].getLastCoordinate()[3]-a[s].getFirstCoordinate()[3]);l=l.concat(a[s].getCoordinates());r&&(d=g());y(n);m(o)}break;default:return null}});o instanceof Array&&0==o.length&&(u=!0);i.elevationChartData=u?null:TC.Util.extend({},{time:d,ele:o,x:n,miny:a,maxy:s},h);e(i.elevationChartData)}else e(null)})})})})(r).then(function(r){if(null!=r){r.time&&(r.time=("00000"+r.time.h).slice(-2)+":"+("00000"+r.time.m).slice(-2)+":"+("00000"+r.time.s).slice(-2));r.coords=l;i.hasElevation=!0}else{i.hasElevation=!1;r={msg:i.getLocaleString("geo.trk.chart.chpe.empty")}}r.minHeight=i.CHART_SIZE.MIN_HEIGHT;r.maxHeight=i.CHART_SIZE.MAX_HEIGHT;r.minWidth=i.CHART_SIZE.MIN_WIDTH;r.mediumWidth=i.CHART_SIZE.MEDIUM_WIDTH;r.maxWidth=i.CHART_SIZE.MAX_WIDTH;i.map.one(TC.Consts.event.DRAWCHART,function(t){i.chartProgressInit();o()});if(i.resultsPanelChart){s();i.resultsPanelChart.open();i.map.trigger(i.Const.Event.DRAWTRACK,{data:r})}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");var n,a={content:"chart",titles:{main:i.getLocaleString("geo.trk.chart.chpe"),max:i.getLocaleString("geo.trk.chart.chpe")},openOn:i.Const.Event.DRAWTRACK,closeOn:i.Const.Event.CLEARTRACK,chart:{ctx:i,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};const e=function(t){a.position=t.POSITION.RIGHT;n=t.addControl("resultsPanel",a)};if(i.options.displayOn){var c=i.map.getControlsByClass("TC.control."+i.options.displayOn[0].toUpperCase()+i.options.displayOn.substring(1))[0];c?e(c):i.map.addControl(i.options.displayOn).then(e)}else{a.div=document.createElement("div");i.map.div.appendChild(a.div);n=i.map.addControl("resultsPanel",a)}n.then(function(t){t.caller=i;i.resultsPanelChart=t;s();t.renderPromise().then(function(){t.activateSnapping=function(t){i.layerTrack&&!i.layerTrack.getVisibility()&&0==i.layerTrack.getOpacity()&&i.wrap.deactivateSnapping.call(i.wrap)};t.deactivateSnapping=function(t){i.layerTrack&&i.layerTrack.getVisibility()&&i.layerTrack.getOpacity()>0&&i.wrap.activateSnapping.call(i.wrap)};t.div.addEventListener("mouseover",t.deactivateSnapping);t.div.addEventListener("mouseout",t.activateSnapping);i.map.on(TC.Consts.event.RESULTSPANELMIN,function(){i.miDiv&&(i.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELMAX,function(){i.miDiv&&(i.miDiv.style.display="")}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){i.miDiv&&(i.miDiv.style.display="none")});i.map.trigger(i.Const.Event.DRAWTRACK,{data:r})})})}e=e.bind(i);i.map.on(TC.Consts.event.FEATUREREMOVE,e)})})};t.clear=function(t){var e=this;if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}if(t==e.Const.Layers.TRACK){e.layerTrack.clearFeatures();e.resultsPanelChart&&e.resultsPanelChart.close();delete e.elevationChartData;e.wrap.simulateTrackEnd();e.wrap.clear();e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});e.map.trigger(e.Const.Event.CLEARTRACK);e.featuresToShare=[]}else{e.layerTracking.clearFeatures();e.layerGPS.clearFeatures()}};t.saveTrack=function(t){const e=this;return new Promise(function(r,n){var i=t.message||e.getLocaleString("geo.trk.save.alert"),o=function(o){var a;a=e.getLoadingIndicator().addWait();var s=t.importedFileName||e.track.trackName.value.trim(),l=e.availableTracks;l||(l=[]);var u=e.wrap.formattedToStorage(o,!0,t.notReproject),h=function(t){e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.getLoadingIndicator().removeWait(t);c.call(e)},d={name:s,data:u.features,layout:u.layout,crs:e.storageCRS};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var t=hex_md5(JSON.stringify(d)),o=l.map(function(e){var r=JSON.parse(JSON.stringify(e));delete r.uid;if(t===hex_md5(JSON.stringify(r)))return e.uid;{const o=new ol.format.GeoJSON;var n=o.readFeatures(r.data),i=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);n.forEach(function(t){var e=TC.Util.explodeGeometry(TC.Util.compactGeometry(t.getGeometry().getCoordinates(),i));t.getGeometry().setCoordinates(e)});r.data=o.writeFeatures(n);return t===hex_md5(JSON.stringify(r))?e.uid:null}}).filter(function(t){return null!==t});const s=function(t){return e.getStoredTracks().then(function(){e.bindTracks();for(var r,n=0;n<e.availableTracks.length;n++)if(e.availableTracks[n].uid===t){r=n;break}return r})};if(0===o.length){d.uid=Date.now()+Math.random();l.push(d);l=m(l);try{e.setStoredTracks(l).then(function(){e.map.toast(i,{duration:3e3});h(a);s(d.uid).then(function(t){r(t)})})}catch(t){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+t.message);h(a);n(t)}}else{console.log("Ya existe un track con ese mismo hash");h(a);s(o[0]).then(function(t){r(t)})}})};if(e.importedFileName)o(e.layerTrack);else if(0==e.track.trackName.value.trim().length){e.track.trackName.value=(new Date).toLocaleString();o(e.layerTracking)}else o(e.layerTracking)})};t.addWaypoint=function(){var t=this.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString());var e=this.getLoadingIndicator().addWait();c.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:t,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(e)};t.editTrackName=function(t,e){var r=this;r.getAvailableTracks().then(function(n){if(n&&n[t]){n[t].name=e;r.setStoredTracks(n)}})};t.removeTrack=function(t){var e=this;e.getAvailableTracks().then(function(r){if(r){var n=t.dataset.id;if(r[n]){var i=r[n].uid;TC.confirm(e.getLocaleString("geo.trk.delete.alert"),function(){const t=e.getSelectedTrack();t&&t.dataset.id===n&&e.clear(e.Const.Layers.TRACK);localforage.removeItem(e.Const.LocalStorageKey.TRACKING+"#"+i).then(function(){e.getStoredTracks().then(function(){e.bindTracks()})}).catch(function(t){console.log(t)})},function(){})}}})};t.setSelectedTrack=function(t){var e=this;e.isActive||e.activate();e.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(t){t.setAttribute("title",t.textContent)});e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});t.classList.add(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",e.getLocaleString("tr.lst.clear")+" "+t.querySelector("span").textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"))};t.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};t.clearSelectedTrack=function(){const t=this,e=t.getSelectedTrack();if(e){if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}e.classList.remove(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",e.textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"))}};t.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};t.drawTrackingData=function(t){const e=this;return new Promise(function(r,n){e.wrap.clear();e.getTrackingData(t).then(function(t){t.data;t.data&&e.wrap.drawTrackingData(t).then(function(){var t=e.layerTrack.features;if(t&&t.length>0){var n=t.filter(function(t){t.showsPopup=!1;return!!(TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)||t instanceof TC.feature.Polyline}).map(function(t){return TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline?t.geometry[0]:t instanceof TC.feature.Polyline?t.geometry:void 0})[0];if(n){var i=n[0],o=n[n.length-1];i&&i!==o&&e.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});o&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}e.layerTrack.setVisibility(!0);r()})})})};t.getTrackingData=function(t){const e=this;return new Promise(function(r,n){e.getAvailableTracks().then(function(n){if(n){const o=t.dataset.id;if(n[o]){var i=n[o].data;i=e.wrap.formattedFromStorage(i);r({data:i,layout:n[o].layout})}}else r()})})};t.export=function(t){return this.wrap.export(t)};t.getElevationTooltip=function(t){this.wrap.showElevationMarker(t);return this.resultsPanelChart.getElevationChartTooltip(t)};t.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};t.clearFileInput=function(t){const e=document.createElement("form"),r=t.parentElement;r.insertBefore(e,t);e.appendChild(t);e.reset();e.insertAdjacentElement("afterend",t);r.removeChild(e)};t.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};t.onGeolocateError=function(t){var e;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(t.code){case t.PERMISSION_DENIED:e=this.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:e=this.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:e=this.getLocaleString("geo.error.timeout");break;default:e=this.getLocaleString("geo.error.default")}this.map.toast(e,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var C=function(t){return!t||0===t.length};t.exportState=function(){const t=this;if(t.exportsState){const r={};if(t.layerTrack){var e=t.layerTrack.features;if(e.length>0&&t.featuresToShare&&t.featuresToShare.length>0)r.features=t.featuresToShare;else{const n=t.layerTrack.exportState({features:e});r.features=n.features}r.id=t.id;const n=t.getSelectedTrack();n&&(r.trackName=n.querySelector("span").innerHTML);return r}}return null};t.importState=function(t){const e=this;if(e.map&&t.features&&t.features.length){e.enable();if(t.features.length>0){const r=new Array(t.features.length);t.features.forEach(function(t,e){const n={data:t.data,id:t.id,showsPopup:t.showsPopup};var i=TC.Util.explodeGeometry(t.geom);switch(t.type){case TC.Consts.geom.POLYLINE:r[e]=new TC.feature.Polyline(i,n);break;case TC.Consts.geom.MULTIPOLYLINE:r[e]=new TC.feature.MultiPolyline(i,n);break;case TC.Consts.geom.MARKER:r[e]=new TC.feature.Marker(i,n);break;case TC.Consts.geom.POINT:r[e]=new TC.feature.Point(i,n)}});Promise.all(r).then(function(r){var n={features:r,fileName:t.trackName,notReproject:!0,isShared:!0};e.availableTracks?e.importTrack(n):e.getStoredTracks().then(function(){e.importTrack(n)})})}}};t.getDownloadDialog=function(){const t=this;return t._downloadDialog?Promise.resolve(t._downloadDialog):new Promise(function(e,r){t.map.addControl("FeatureDownloadDialog").then(r=>{t._downloadDialog=r;e(r)})})}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");!function(){TC.control.GeometryFeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.GeometryFeatureInfo(this);this._isDrawing=!1;this._isSearching=!1;this._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.GeometryFeatureInfo.prototype;t.register=function(t){const e=this,r=TC.control.FeatureInfoCommons.prototype.register.call(e,t);e.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){e.wrap.cancelDraw()});return r};t.callback=function(t,e){var r=this;if(!r._drawToken){r.closeResults();r.highlightedFeature=null;for(var n=!1,i=0;i<r.map.workLayers.length;i++){var o=r.map.workLayers[i];if(o.type===TC.Consts.layerType.WMS&&o.getVisibility()&&o.names.length>0){n=!0;break}}if(n){r.closeResults();r.wrap.beginDraw({geometryType:r.geometryType,xy:t,layer:r.filterLayer,callback:function(t){r.wrap.getFeaturesByGeometry(t)}})}}};t.responseCallback=function(t){var e=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(e,t);if(e.filterFeature){for(var r=t.services,n=0;n<r.length;n++){var i=r[n];if(i.hasLimits){delete i.layers;i.hasLimits=i.hasLimits}else{for(var o=0;o<i.layers.length;o++)if(!i.layers[o].features.length){i.layers.splice(o,1);o-=1}if(!i.layers.length){r.splice(n,1);n-=1}}}e.renderData(t,function(){r.length&&e.insertLinks();e.div.querySelector(`.${e.CLASS}-coords`).classList.add(TC.Consts.classes.HIDDEN);e.displayResults()})}}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var t=TC.control.LayerCatalog.prototype;t.CLASS="tc-ctl-lcat";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"availableLayers"}).x(e.get(["enableSearch"],!1),e,{block:r},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",e,{},{$key:"textToSearchInLayers"}).w('"></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(e.get(["layerTrees"],!1),e,{else:o,block:c},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",e,e.rebase(e.getPath(!0,[])),{}).w("</div>")}e.__dustBody=!0;function r(t,e){return t.x(e.get(["layerTrees"],!1),e,{block:n},{}).x(e.get(["layers"],!1),e,{block:i},{})}r.__dustBody=!0;function n(t,e){return t.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",e,{},{$key:"searchLayersByText"}).w('"></button>')}n.__dustBody=!0;function i(t,e){return t.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",e,{},{$key:"searchLayersByText"}).w('"></button>')}i.__dustBody=!0;function o(t,e){return t.x(e.get(["layers"],!1),e,{else:a,block:s},{})}o.__dustBody=!0;function a(t,e){return t.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",e,{},{$key:"loadingLayerTree"}).w("...</span></div>")}a.__dustBody=!0;function s(t,e){return t.w('<ul class="tc-ctl-lcat-branch">').s(e.get(["layers"],!1),e,{block:l},{}).w("</ul>")}s.__dustBody=!0;function l(t,e){return t.w('<li data-layer-id="').f(e.get(["id"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"loadingLayers"}).w('" class="tc-ctl-lcat-loading-node"> ').f(e.get(["title"],!1),e,"h").w("</li>")}l.__dustBody=!0;function c(t,e){return t.w('<ul class="tc-ctl-lcat-branch">').s(e.get(["layerTrees"],!1),e,{block:u},{}).w("</ul>")}c.__dustBody=!0;function u(t,e){return t.p("tc-ctl-lcat-branch",e,e.rebase(e.getPath(!0,[])),{})}u.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-lcat-collapse-btn"></button><span>').f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:i},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}n.__dustBody=!0;function i(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}i.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.x(e.get(["isVisible"],!1),e,{block:r},{})}e.__dustBody=!0;function r(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:i},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:o},{}).w('<span data-tooltip="').x(e.get(["name"],!1),e,{block:a},{}).w('">').f(e.get(["title"],!1),e,"h").w("</span>").x(e.get(["name"],!1),e,{block:s},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:l},{}).w("</ul></li>")}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}n.__dustBody=!0;function i(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}i.__dustBody=!0;function o(t,e){return t.w('<button class="tc-ctl-lcat-collapse-btn"></button>')}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"clickToAddToMap"})}a.__dustBody=!0;function s(t,e){return t.w('<button title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('" class="tc-ctl-lcat-btn-info"></button>')}s.__dustBody=!0;function l(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}l.__dustBody=!0;return e};t.template[t.CLASS+"-info"]=function(){dust.register(t.CLASS+"-info",e);function e(t,e){return t.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",e,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(e.get(["title"],!1),e,"h").w("</h3>").x(e.get(["abstract"],!1),e,{block:r},{}).x(e.get(["metadata"],!1),e,{block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",e,{},{$key:"abstract"}).w("</h4><div><pre>").f(e.get(["abstract"],!1),e,"h",["s"]).w("</pre></div></div>")}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",e,{},{$key:"metadata"}).w("</h4><ul>").s(e.get(["metadata"],!1),e,{block:i},{}).w("</ul></div>")}n.__dustBody=!0;function i(t,e){return t.w('<li><a href="').f(e.get(["url"],!1),e,"h",["s"]).w('" type="').f(e.get(["format"],!1),e,"h").w('" title="').f(e.get(["formatDescription"],!1),e,"h").w('" target="_blank">').f(e.get(["formatDescription"],!1),e,"h",["s"]).w("</a></li>")}i.__dustBody=!0;return e};t.template[t.CLASS+"-results"]=function(){dust.register(t.CLASS+"-results",e);function e(t,e){return t.s(e.get(["servicesFound"],!1),e,{else:r,block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",e,{},{$key:"noMatches"}).w("</h5></li>")}r.__dustBody=!0;function n(t,e){return t.h("gt",e,{block:i},{key:e.get(["servicesLooked"],!1),value:1}).s(e.get(["founds"],!1),e,{block:a},{}).h("gt",e,{block:u},{key:e.get(["servicesLooked"],!1),value:1})}n.__dustBody=!0;function i(t,e){return t.w('<li class="tc-ctl-lcat-search-group ').x(e.getPath(!1,["service","isCollapsed"]),e,{block:o},{}).w('" data-service-index="').f(e.getPath(!1,["service","index"]),e,"h").w('"><h5>').f(e.getPath(!1,["service","title"]),e,"h").w("</h5><ul>")}i.__dustBody=!0;function o(t,e){return t.w("tc-collapsed")}o.__dustBody=!0;function a(t,e){return t.w('<li data-layer-name="').f(e.get(["Name"],!1),e,"h").w('" ').x(e.get(["alreadyAdded"],!1),e,{block:s},{}).w('><h5 class="tc-selectable"').x(e.get(["alreadyAdded"],!1),e,{else:l,block:c},{}).w(">").f(e.get(["Title"],!1),e,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('"></button></li>')}a.__dustBody=!0;function s(t,e){return t.w(' class="tc-checked"')}s.__dustBody=!0;function l(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"clickToAddToMap"}).w('"')}l.__dustBody=!0;function c(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"layerAlreadyAdded"}).w('"')}c.__dustBody=!0;function u(t,e){return t.w("</ul></li>")}u.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};const e=function(t,e){t.showProjectionChangeDialog({layer:e,closeCallback:function(){t.getLayerNodes(e).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap")})}})};t.register=function(t){const e=this,r=TC.control.ProjectionSelector.prototype.register.call(e,t),o=function(t,r){if(Array.isArray(e.options.layers)){for(var n=0;n<e.options.layers.length;n++){var i=e.options.layers[n];if(!i.type||i.type===TC.Consts.layerType.WMS){i.id||(i.id=TC.getUID());TC.Util.isPlainObject(i)&&(i=new TC.layer.Raster(i));e.layers.push(i)}}e.render(function(){t()})}else t()};e._readyPromise=new Promise(function(e,r){const n=function(r){if(r.layer===t.baseLayer){o(e);t.off(TC.Consts.event.LAYERUPDATE,n)}};t.loaded(function(){t.baseLayer.state&&t.baseLayer.state!==TC.Layer.state.IDLE?t.on(TC.Consts.event.LAYERUPDATE,n):o(e)})});var a=e.getLocaleString("clickToAddToMap");t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(t){e.getLayerNodes(t.layer).forEach(function(t){t.classList.add(TC.Consts.classes.LOADING);delete t.querySelector("span").dataset.tooltip})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(t){const r=t.layer;r.isBase||r.type!==TC.Consts.layerType.WMS||e.loaded().then(function(){if(e.getLayerRootNode(r))i.call(e,r);else{for(var t=!1,n=0,o=e.layers.length;n<o;n++){var a=e.layers[n];if(a.type===r.type&&a.options.url===r.options.url){t=!0;break}}if(t){e.layersToSetChecked||(e.layersToSetChecked=[]);e.layersToSetChecked.push(r)}else e.addLayer(new TC.layer.Raster({url:r.options.url,type:r.type,layerNames:[],title:r.title||r.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){i.call(e,r)})}})}).on(TC.Consts.event.LAYERERROR,function(t){const r=t.reason;if(e.layers.some(e=>e==t.layer)){r&&TC.alert(e.getLocaleString(r,{url:t.layer.url}));e.getLayerNodes(t.layer).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING)})}}).on(TC.Consts.event.LAYERREMOVE,function(t){const r=t.layer;e.getLayerNodes(r).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=a});(function(t){const r=[];if(!t.isBase){var n=t.options.url;e.list&&e.list.querySelectorAll("li").forEach(function(i){const o=e.getLayer(i.dataset.layerId);if(o&&o.type===t.type&&o.options.url===n)for(var a=0;a<t.names.length;a++)if(i.dataset.layerName===t.names[a]){r.push(i);break}})}return r})(r).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.querySelector("h5").dataset.tooltip=a});!function(t){var r=e.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(r)for(var n=r.layers,i=0;i<n.length;i++){var o=n[i];o!==t&&e.getLayerNodes(o).forEach(function(t){t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")})}}(r);n.call(e)}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){if(t&&t.layer){e.addLayer(t.layer);e.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.update()});return r};const r=function(t){t.target.blur();t.stopPropagation();const e=t.target.parentElement;if("LI"===e.tagName&&!e.classList.contains(self.CLASS+"-leaf")){e.classList.toggle(TC.Consts.classes.COLLAPSED);e.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED)}},n=function(){const t=this;if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);t.textInput&&t.textInput.dispatchEvent(e)}else t.textInput&&t.textInput.fireEvent("keyup")},i=function(t){const e=this;e.getLayerNodes(t).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")});n.call(e)},o=function(t,e){const n=this;t.querySelectorAll("li > button."+n.CLASS+"-collapse-btn").forEach(function(t){t.addEventListener("click",r)});t.querySelectorAll("span").forEach(function(t){t.addEventListener("click",function(t){!function(t,e){const r=t.target.parentNode;if(!r.classList.contains(TC.Consts.classes.LOADING)&&!r.classList.contains(TC.Consts.classes.CHECKED)){t.preventDefault;var n,i=r.dataset.layerName;i=void 0!==i?i.toString():"";for(var o=0,a=e._roots.length;o<a;o++){const t=e._roots[o];if(t.contains(r)){n=e.getLayer(t.dataset.layerId);break}}n||(n=e.getLayer(r.dataset.layerId));if(n&&i){var s=1;/iPad/i.test(navigator.userAgent)?s=10:TC.Util.detectFirefox()&&(s=250);n.title||(n.title=n.getTree().title);r.classList.add(TC.Consts.classes.LOADING);r.querySelector("span").dataset.tooltip="";(l=r,new Promise(function(t,e){setTimeout(function(){l.offsetHeight=l.offsetHeight;l.offsetWidth=l.offsetWidth;t()},s)})).then(function(){e.addLayerToMap(n,i)});t.stopPropagation()}}var l}(t,n)})});n._roots=n.div.querySelectorAll(n._selectors.LAYER_ROOT);t.dataset.layerId=e.id;t.querySelectorAll("."+n.CLASS+"-btn-info").forEach(function(t){const r=t.parentElement.querySelector("span"),i=t.parentElement.dataset.layerName;if(i){r.classList.add(TC.Consts.classes.SELECTABLE);var o=e.wrap.getInfo(i);o.hasOwnProperty("abstract")||o.hasOwnProperty("legend")||o.hasOwnProperty("metadata")?t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation();this.classList.toggle(TC.Consts.classes.CHECKED)?n.showLayerInfo(e,i):n.hideLayerInfo()}):t.parentElement.removeChild(t);if(e.compatibleLayers&&e.compatibleLayers.indexOf(i)<0){r.classList.add(TC.Consts.classes.INCOMPATIBLE);r.setAttribute("title",n.getLocaleString("reprojectionNeeded"))}if(n.map)for(var a=0,s=n.map.workLayers.length;a<s;a++){var l=n.map.workLayers[a];if(l.type===TC.Consts.layerType.WMS&&l.url===e.url&&1===l.names.length&&l.names[0]===i){r.parentElement.classList.add(TC.Consts.classes.CHECKED);r.dataset.tooltip=n.getLocaleString("layerAlreadyAdded")}}}else{r.dataset.tooltip="";t.parentElement.removeChild(t)}});(function(){const t=this;t.layersToSetChecked&&t.layersToSetChecked.length>0&&t.layersToSetChecked.forEach(function(e,r,n){if(t.getLayerRootNode(e)){i.call(t,e);n.splice(r,1)}})}).call(n);n.getRenderedHtml(n.CLASS+"-dialog",null,function(t){n._dialogDiv.innerHTML=t})};t.renderBranch=function(t,e,r){const n=this;t.getCapabilitiesPromise().then(function(i){n.sourceLayers.push(t);n.getRenderedHtml(n.CLASS+"-branch",function(t){var e=t.getTree();!function e(r){for(var n=!1,i=0;i<r.children.length;i++)e(r.children[i])&&(n=!0);r.hasOwnProperty("isVisible")&&(r.isVisible=!t.names||!t.names.length||n||r.isVisible);return r.isVisible}(e);return e}(this),function(t){var i=document.createElement("template");i.innerHTML=t;var a=i.content?i.content.firstChild:i.firstChild,s=n.div.querySelector("."+n.CLASS+"-branch").querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');s?n.div.querySelector("."+n.CLASS+"-branch").replaceChild(a,s):n.div.querySelector("."+n.CLASS+"-branch").appendChild(a);o.call(n,a,this);1===n.div.querySelector("."+n.CLASS+"-branch").childElementCount&&r();TC.Util.isFunction(e)&&e(n.sourceLayers[n.sourceLayers.map(function(t){return t.id}).indexOf(this.id)])}.bind(this))}.bind(t)).catch(function(t){var e=n.layers.map(function(t){return t.id}).indexOf(this.id);n.layers.splice(e,1);var r=n.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:this.title}),i=n.div.querySelector("."+n.CLASS+"-branch").querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');i.classList.add("error");i.setAttribute("title",r);n.map.toast(r,{type:TC.Consts.msgType.ERROR})}.bind(t))};t.render=function(t){const r=this;r.sourceLayers=[];return r._set1stRenderPromise(new Promise(function(n,i){0===r.layers.length?r.renderData({layerTrees:[],enableSearch:!1},function(){TC.Util.isFunction(t)&&t();n()}):r.renderData({layers:r.layers,enableSearch:!0},function(){(function(){const t=this;t.textInput=t.div.querySelector("."+t.CLASS+"-input");t.list=t.div.querySelector("."+t.CLASS+"-search ul");t.textInput.addEventListener("mouseup",function(e){""!==t.textInput.value&&setTimeout(function(){""===t.textInput.value&&(t.list.innerHTML="")},1)});var r=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(t.textInput,{link:"#",target:t.list,minLength:0,source:function(e,n){r=[];t._roots.forEach(function(t){t.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(t){r.push(t.dataset.layerName)})});if((e=e.trim()).length<3)t.list.innerHTML="";else if(e.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var r=[],i=0;i<t.sourceLayers.length;i++){var o=t.sourceLayers[i].searchSubLayers(e);o.length&&r.push({service:{index:i,title:t.sourceLayers[i].title||t.sourceLayers[i].id},founds:o})}n({servicesFound:r,servicesLooked:t.sourceLayers.length})},TC._search.interval)}},callback:function(e){t.textInput.value=e.target.text||e.target.innerText;TC._search.lastPattern=t.textInput.value;t.goToResult(unescape(e.target.hash).substring(1));TC.UI.autocomplete.call(t.textInput,"clear")},buildHTML:function(e){var n=this.target;if(e.results&&e.results.servicesFound.length>0)for(var i=t.map.getLayerTree().workLayers,o=0;o<e.results.servicesFound.length;o++){for(var a=e.results.servicesFound[o].founds,s=0;s<a.length;s++){delete a[s].alreadyAdded;for(var l=0;l<i.length;l++)if(r.indexOf(a[s].Name)>=0){a[s].alreadyAdded=!0;break}if(!a[s].Name){a.splice(s,1);s--}}e.results.servicesFound[o].founds.length?t.div.querySelectorAll(".tc-ctl-lcat-search-group")[o]&&(e.results.servicesFound[o].service.isCollapsed=t.div.querySelectorAll(".tc-ctl-lcat-search-group")[o].classList.contains(TC.Consts.classes.COLLAPSED)):e.results.servicesFound.splice(o,1)}var c="";t.getRenderedHtml(t.CLASS+"-results",e.results).then(function(t){n.innerHTML=c=t});return c}})});if(!t.searchInit){t.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2 button",function(e){const r=t.div.classList.contains(TC.Consts.classes.COLLAPSED);t.div.classList.remove(TC.Consts.classes.COLLAPSED);const n=t.div.querySelector("."+t.CLASS+"-search"),i=t.div.querySelector("."+t.CLASS+"-tree"),o=t.div.querySelector("."+t.CLASS+"-info"),a=!(!n.classList.contains(TC.Consts.classes.HIDDEN)&&!r);n.classList.toggle(TC.Consts.classes.HIDDEN,!a);i.classList.toggle(TC.Consts.classes.HIDDEN,a);e.target.classList.toggle(t.CLASS+"-btn-tree",a);e.target.classList.toggle(t.CLASS+"-btn-search",!a);if(a){t.textInput.focus();e.target.setAttribute("title",t.getLocaleString("viewAvailableLayersTree"));0===t.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&o.classList.add(TC.Consts.classes.HIDDEN)}else{e.target.setAttribute("title",t.getLocaleString("searchLayersByText"));t.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&o.classList.remove(TC.Consts.classes.HIDDEN)}}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+t.CLASS+"-search button."+t.CLASS+"-search-btn-info",function(e){e.stopPropagation();const r=e.target;if(r.classList.contains(TC.Consts.classes.CHECKED)){r.classList.remove(TC.Consts.classes.CHECKED);t.hideLayerInfo()}else{const e=r.parentElement;var n=e;do{n=n.parentElement}while(n&&"LI"!==n.tagName);t.showLayerInfo(t.layers.length>1?t.layers[n.dataset.serviceIndex]:t.layers[0],e.dataset.layerName);r.classList.add(TC.Consts.classes.CHECKED)}}));const r="."+t.CLASS+"-search li";t.div.addEventListener("click",TC.EventTarget.listenerBySelector(r,function(n){n.stopPropagation();for(var i=n.target;i&&!i.matches(r);)i=i.parentElement;if(!i.classList.contains(t.CLASS+"-no-results"))if(i.classList.contains(t.CLASS+"-search-group"))i.classList.toggle(TC.Consts.classes.COLLAPSED);else{var o=i.dataset.layerName;if(o&&0!==(o=o.toString()).trim().length&&!i.classList.contains(TC.Consts.classes.CHECKED)){var a=i;do{a=a.parentElement}while(a&&!a.matches("li."+t.CLASS+"-search-group"));const r=a?a.dataset.serviceIndex:0,n=t.layers[r].options.url,s=t.layers[r].title,l=new TC.layer.Raster({id:t.getUID(),url:n,title:s,hideTitle:t.layers[r].hideTitle||t.layers[r].options.hideTitle,hideTree:!1,layerNames:[o]});if(l.isCompatible(t.map.crs)){t.map.addLayer(l,function(t){i.dataset.layerId=t.id;t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)})});i.classList.add(TC.Consts.classes.CHECKED);i.querySelector("h5").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")}else e(t,l)}}}));t.searchInit=!0}}).call(r);r.layers.forEach(function(e){r.renderBranch(e,t,n)})})}))};t.getLayerRootNode=function(t){const e=this;var r=null;if(!t.isBase){var n=t.options.url;e._roots&&e._roots.forEach(function(i){const o=e.getLayer(i.dataset.layerId);o&&o.type===t.type&&o.options.url===n&&(r=i)})}return r};t.getLayerNodes=function(t){const e=[],r=this.getLayerRootNode(t);if(r)for(var n=0;n<t.names.length;n++){const i=r.querySelector('li[data-layer-name="'+t.names[n]+'"]');if(i){e[e.length]=i;i.querySelectorAll("li").forEach(function(t){e[e.length]=t})}}return e};t.showLayerInfo=function(t,e){const r=this;var n=null,i=r.div.querySelector("."+r.CLASS+"-info");const o=function(t,e){var n=!1;if(e){n=!0;i.dataset.layerName=t;i.classList.remove(TC.Consts.classes.HIDDEN);r.getRenderedHtml(r.CLASS+"-info",e).then(function(t){i.innerHTML=t;i.querySelector("."+r.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){r.hideLayerInfo()})}).catch(function(t){TC.error(t)})}return n};r.div.querySelectorAll("."+r.CLASS+"-btn-info, ."+r.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});const a={};for(var s=0,l=r._roots.length;s<l;s++){const i=r._roots[s];if(i.dataset.layerId===t.id){const s=i.querySelectorAll("."+r.CLASS+"-btn-info");for(var c=0,u=s.length;c<u;c++){var h=s[c].parentElement.dataset.layerName;if(h===e){const i=t.wrap.getInfo(e);i.metadata&&i.metadata.forEach(function(t){t.formatDescription=a[t.format]=a[t.format]||r.getLocaleString(TC.Util.getSimpleMimeType(t.format))||r.getLocaleString("viewMetadata")});r.div.querySelector('li [data-layer-name="'+h+'"] > button.'+r.CLASS+"-btn-info").classList.toggle(TC.Consts.classes.CHECKED,o(h,i));n=i;break}}break}}return n};t.update=function(){const t=this;t.sourceLayers.forEach(function(e){e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);const r=t.getLayerRootNode(e);r&&r.querySelectorAll("li[data-layer-name]").forEach(function(r){const n=r.dataset.layerName,i=r.querySelector("span."+TC.Consts.classes.SELECTABLE);if(e.compatibleLayers.indexOf(n)<0){i.classList.add(TC.Consts.classes.INCOMPATIBLE);i.setAttribute("title",t.getLocaleString("reprojectionNeeded"))}else{i.classList.remove(TC.Consts.classes.INCOMPATIBLE);i.removeAttribute("title")}})})})};t.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};t.addLayer=function(t){const e=this;return new Promise(function(r,n){var i=[];e.options.layers&&e.options.layers.length&&(i=e.options.layers.filter(function(e){var r=TC.Util.reqGetMapOnCapabilities(e.url);return r&&r.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));0==i.length&&(i=e.layers.filter(function(e){return e.url.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));if(0==i.length){e.layers.push(t);t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);t.title=t.title||t.wrap.getServiceTitle();e.renderBranch(t,function(){r()})})}else r()})};t.getLayer=function(t){const e=this;for(var r=0,n=e.layers.length;r<n;r++){const n=e.layers[r];if(n.id===t){var i=e.options.layers.filter(e=>e.id===t);i.length>0?n.hideTitle=n.options.hideTitle=i[0].hideTitle:n.hideTitle=n.options.hideTitle=!1;return n}}return null};t.addLayerToMap=function(t,r){const n=this,i=TC.Util.extend({},t.options);i.id=n.getUID();i.layerNames=[r];i.title=t.title;const o=new TC.layer.Raster(i);o.isCompatible(n.map.crs)?n.map.addLayer(i):e(n,o)};t.loaded=function(){return this._readyPromise};t.getAvailableCRS=function(t){t=t||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,t.layer),includeFallbacks:!0})};t.setProjection=function(t){const e=this;t=t||{};TC.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t).then(function(){e._layerToAdd&&e.map.addLayer(e._layerToAdd);TC.Util.closeModal()})}})};t.showProjectionChangeDialog=function(t){this._layerToAdd=t.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,t)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var t=TC.control.Legend.prototype;t.CLASS="tc-ctl-legend";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(e.get(["workLayers"],!1),e,{else:r,block:n},{}).w("</ul></div>")}e.__dustBody=!0;function r(t,e){return t.w('<li class="tc-ctl-legend-empty">').h("i18n",e,{},{$key:"noData"}).w("</li>")}r.__dustBody=!0;function n(t,e){return t.p("tc-ctl-legend-node",e,e.rebase(e.getPath(!0,[])),{})}n.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.x(e.get(["customLegend"],!1),e,{else:r,block:d},{})}e.__dustBody=!0;function r(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:i},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><div class="tc-ctl-legend-title">').f(e.get(["title"],!1),e,"h").w("</div>").x(e.get(["legend"],!1),e,{block:o},{}).w('<ul class="tc-ctl-legend-branch">').s(e.get(["children"],!1),e,{block:h},{}).w("</ul></li>")}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}n.__dustBody=!0;function i(t,e){return t.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function o(t,e){return t.w('<div class="tc-ctl-legend-watch">').x(e.getPath(!1,["legend","src"]),e,{else:a,block:c},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",e,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}o.__dustBody=!0;function a(t,e){return t.x(e.getPath(!1,["legend","width"]),e,{block:s},{})}a.__dustBody=!0;function s(t,e){return t.w('<div class="tc-ctl-legend-img" style="border:solid ').f(e.getPath(!1,["legend","strokeWidth"]),e,"h").w("px ").f(e.getPath(!1,["legend","strokeColor"]),e,"h").w(";background-color:").f(e.getPath(!1,["legend","fillColor"]),e,"h").x(e.getPath(!1,["legend","width"]),e,{block:l},{}).w('"></div>')}s.__dustBody=!0;function l(t,e){return t.w(";width:").f(e.getPath(!1,["legend","width"]),e,"h").w("px;height:").f(e.getPath(!1,["legend","height"]),e,"h").w("px;border-radius:50%")}l.__dustBody=!0;function c(t,e){return t.w('<img src="" data-img="').f(e.getPath(!1,["legend","src"]),e,"h").w('" ').x(e.getPath(!1,["legend","width"]),e,{block:u},{}).w(" />")}c.__dustBody=!0;function u(t,e){return t.w('style="width:').f(e.getPath(!1,["legend","width"]),e,"h").w("px;height:").f(e.getPath(!1,["legend","height"]),e,"h").w('px;" ')}u.__dustBody=!0;function h(t,e){return t.p("tc-ctl-legend-node",e,e.rebase(e.getPath(!0,[])),{})}h.__dustBody=!0;function d(t,e){return t.f(e.get(["customLegend"],!1),e,"h",["s"])}d.__dustBody=!0;return e};t.register=function(t){const e=this;t.on(TC.Consts.event.VIEWCHANGE,function(r){const n=r.view,i=e.loadGraphics.bind(e);n===TC.Consts.view.THREED?t.on(TC.Consts.event.LAYERADD,i):n===TC.Consts.view.DEFAULT&&t.off(TC.Consts.event.LAYERADD,i)});return TC.control.MapContents.prototype.register.call(e,t)};t.loadGraphics=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);r&&e.querySelectorAll("li."+t.CLASS+"-node-visible").forEach(function(e){const n=e.querySelector("img");n&&void 0!==n.getAttribute("src")&&0===n.getAttribute("src").length&&t.styleLegendImage(n,r)})})};t.updateScale=function(){const t=this,e=t.CLASS+"-node-inscale",r=t.CLASS+"-node-outofscale";t.getLayerUIElements().forEach(function(n){const i=t.map.getLayer(n.dataset.layerId);if(i){let o=!1;const a=n.querySelectorAll("li");a.forEach(function(n){if(n.classList.contains(t.CLASS+"-node-visible")){const a=n.dataset.layerUid;if(i.isVisibleByScale(a)){o=!0;n.classList.remove(r);n.classList.add(e);const a=n.querySelector("img");a&&t.styleLegendImage(a,i)}else{n.classList.add(r);n.classList.remove(e)}}});o=o||!a.length;if(!a.length){const e=n.querySelector("img");e&&t.styleLegendImage(e)}n.classList.toggle(e,o);n.classList.toggle(r,!o)}})};t.update=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);if(r){r.getTree();e.querySelectorAll("li").forEach(function(e){const n=e.dataset.layerUid;var i=t.CLASS+"-node-visible",o=t.CLASS+"-node-notvisible",a=t.CLASS+"-node-hasvisible";switch(r._cache.visibilityStates[n]){case TC.Consts.visibility.NOT_VISIBLE:e.classList.remove(i,a);e.classList.add(o);break;case TC.Consts.visibility.HAS_VISIBLE:e.classList.remove(i,o);e.classList.add(a);break;default:e.classList.remove(o,a);e.classList.add(i)}});t.updateLayerVisibility(r)}});t.updateScale()};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){if(t.hideTree||t.options.hideTree){t.tree=null;t.hideTree=t.options.hideTree=!1;t._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);e.getRenderedHtml(e.CLASS+"-node",e.layerTrees[t.id]).then(function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild,i=n.dataset.layerUid,o=e.div.querySelector("ul."+e.CLASS+"-branch"),a=o.querySelectorAll('li[data-layer-uid="'+i+'"]');if(1===a.length){const t=a[0];t.innerHTML=n.innerHTML;t.setAttribute("class",n.getAttribute("class"))}else{n.dataset.layerId=t.id;o.insertBefore(n,o.firstChild)}e.update()}).catch(function(t){TC.error(t)})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(r){r.dataset.layerId===t.id&&r.classList.toggle(e.CLASS+"-node-notvisible",!t.getVisibility())})};t.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYLINE;this.style=TC.Util.extend(!0,{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2},this.options.style)};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.LineFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.control.WorkLayerManager||TC.syncLoadJS(TC.apiLocation+"TC/control/WorkLayerManager");TC.control.ListTOC=TC.control.WorkLayerManager;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){const t=this;TC.Control.apply(t,arguments);t._waits={};window.addEventListener("error",function(){t.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var t=TC.control.LoadingIndicator.prototype;t.CLASS="tc-ctl-load";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}e.__dustBody=!0;return e};t.startWait=function(t){const e=this,r=t.layer.id;void 0===e._waits[r]&&(e._waits[r]=0);e._waits[r]=e._waits[r]+1;e.show();e.map.trigger(TC.Consts.event.STARTLOADING)};t.stopWait=function(t){const e=this,r=t.layer.id;var n=e._waits[r];n>0&&(n=e._waits[r]=n-1);n||delete e._waits[r];var i=0;for(var o in e._waits)i++;if(!i){e.hide();e.map.trigger(TC.Consts.event.STOPLOADING)}};t.endWait=function(t){const e=this,r=t.layer.id;e._waits[r]>0&&delete e._waits[r];var n=0;for(var i in e._waits)n++;if(!n){e.hide();e.map.trigger(TC.Consts.event.STOPLOADING)}};t.reset=function(t){this._waits={};this.hide();this.map.trigger(TC.Consts.event.STOPLOADING)};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(t){e.startWait(t)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(t){e.stopWait(t)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(){e.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(){e.removeWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.LAYERREMOVE,function(t){e.endWait(t)});TC.isDebug||window.addEventListener("error",function(t,r,n,i,o){e.reset();return!1});return r};t.addWait=function(t){const e=t||TC.getUID();this.startWait({layer:{id:e}});return e};t.removeWait=function(t){this.stopWait({layer:{id:t}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featuresselect.tc";TC.Consts.event.FEATURESUNSELECT="featuresunselect.tc";TC.Consts.event.CHANGE="change";TC.control.Modify=function(){TC.Control.apply(this,arguments);if(!TC.browserFeatures.inputTypeColor()&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}this.styles=TC.Util.extend(!0,TC.Cfg.styles.selection,this.options.styles);this.styles.text=this.styles.text||{fontSize:this.styles.line.fontSize,fontColor:this.styles.line.fontColor,labelOutlineColor:this.styles.line.labelOutlineColor,labelOutlineWidth:this.styles.line.labelOutlineWidth};this._classSelector="."+this.CLASS;this.wrap=new TC.wrap.control.Modify(this);this.snapping="boolean"!=typeof this.options.snapping||this.options.snapping};TC.inherit(TC.control.Modify,TC.Control);!function(){var t=TC.control.Modify.prototype;t.CLASS="tc-ctl-mod";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="').h("i18n",e,{},{$key:"select"}).w('">').h("i18n",e,{},{$key:"select"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="').h("i18n",e,{},{$key:"deleteSelectedFeatures"}).w('">').h("i18n",e,{},{$key:"deleteSelectedFeatures"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="').h("i18n",e,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",e,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="').h("i18n",e,{},{$key:"splitGeometry"}).w('">').h("i18n",e,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-attr" disabled title="').h("i18n",e,{},{$key:"editAttributes"}).w('">').h("i18n",e,{},{$key:"editAttributes"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="').h("i18n",e,{},{$key:"addText"}).w('">').h("i18n",e,{},{$key:"addText"}).w('</button><div class="tc-ctl-mod-style tc-hidden"><input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="').h("i18n",e,{},{$key:"writeTextForSketch"}).w('" style="font-size:').f(e.get(["fontSize"],!1),e,"h").w("pt;font-color:").f(e.get(["fontColor"],!1),e,"h").w(";text-shadow: 0 0 ").f(e.get(["labelOutlineWidth"],!1),e,"h").w("px ").f(e.get(["labelOutlineColor"],!1),e,"h").w(';" />').h("i18n",e,{},{$key:"textColor"}).w('<input type="color" class="tc-ctl-mod-fnt-c" value="').f(e.get(["fontColor"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"fontSize"}).w('<input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="').f(e.get(["fontSize"],!1),e,"h").w('" min="7" max="20" /></div><div class="tc-ctl-mod-attr tc-hidden"></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-attr"]=function(){dust.register(t.CLASS+"-attr",e);function e(t,e){return t.w('<div class="tc-ctl-mod-attr"><h3>').h("i18n",e,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-mod-attr-body"><table><tbody>').s(e.get(["data"],!1),e,{block:r},{}).w('</tbody></table></div><div class="tc-ctl-mod-attr-footer"><button class="tc-button tc-ctl-mod-btn-attr-ok">').h("i18n",e,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-mod-btn-attr-cancel">').h("i18n",e,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.w("<tr><th>").f(e.get(["name"],!1),e,"h").w('</th><td><input type="text" class="tc-textbox" name="').f(e.get(["name"],!1),e,"h").w('" value="').f(e.get(["value"],!1),e,"h").w('" /></td></tr>')}r.__dustBody=!0;return e};const e=function(t,e){t._deleteBtn.disabled=0===e.length;t._editAttrBtn.disabled=1!==e.length;t._joinBtn.disabled=e.length<2;t._splitBtn.disabled=0===e.filter(r).length;t.displayLabelText()},r=function(t){var e=!1;(TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)&&t.geometry.length>1&&(e=!0);return e};t.register=function(t){const r=this,n=TC.Control.prototype.register.call(r,t);r.options.layer&&r.setLayer(r.options.layer);t.on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){Promise.all([r.getLayer(),r.renderPromise()]).then(function(e){const n=e[0];t.layer===n&&r.setSelectableState(!0)})}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){const n=t.layer,i=t.feature;Promise.all([r.getLayer(),r.renderPromise()]).then(function(t){if(n===t[0]){i?r.unselectFeatures([i]):r.unselectFeatures();e(r,r.getSelectedFeatures());if(0===r.layer.features.length){r.setSelectableState(!1);r.setTextMode(!1)}}})}).on(TC.Consts.event.LAYERUPDATE,function(t){const n=t.layer;Promise.all([r.getLayer(),r.renderPromise()]).then(function(t){n===t[0]&&e(r,r.getSelectedFeatures())})});r.on(TC.Consts.event.FEATURESSELECT+" "+TC.Consts.event.FEATURESUNSELECT,function(){const t=r.getSelectedFeatures();e(r,t);r.layer.features.filter(function(e){return t.indexOf(e)<0}).forEach(function(t){t.toggleSelectedStyle(!1)});t.forEach(function(t){t.toggleSelectedStyle(!0)});r.getAttributeDisplayTarget().classList.contains(TC.Consts.classes.HIDDEN)||r.displayAttributes();t.length||r.closeAttributes()});return n};t.render=function(t){const e=this,r=function(){e._selectBtn=e.div.querySelector("."+e.CLASS+"-btn-select");e._selectBtn.addEventListener(TC.Consts.event.CLICK,function(t){t.target.disabled||(e.isActive?e.deactivate():e.activate())});e._deleteBtn=e.div.querySelector("."+e.CLASS+"-btn-delete");e._deleteBtn.addEventListener(TC.Consts.event.CLICK,function(){e.deleteSelectedFeatures()});e._textBtn=e.div.querySelector("."+e.CLASS+"-btn-text");e._textBtn.addEventListener(TC.Consts.event.CLICK,function(){e.setTextMode(!e.textActive)});e._joinBtn=e.div.querySelector("."+e.CLASS+"-btn-join");e._splitBtn=e.div.querySelector("."+e.CLASS+"-btn-split");e._editAttrBtn=e.div.querySelector("."+e.CLASS+"-btn-attr");e._editAttrBtn.addEventListener(TC.Consts.event.CLICK,function(){e.toggleAttributes()});e._textInput=e.div.querySelector("input."+e.CLASS+"-txt");e._textInput.addEventListener("input",function(t){e.labelFeatures(t.target.value)});e._styleSection=e.div.querySelector("."+e.CLASS+"-style");e._fontColorPicker=e.div.querySelector(e._classSelector+"-fnt-c");e._fontColorPicker.addEventListener(TC.Consts.event.CHANGE,function(t){e.setFontColor(t.target.value)});e._fontSizeSelector=e.div.querySelector("."+e.CLASS+"-fnt-s");e._fontSizeSelector.addEventListener(TC.Consts.event.CHANGE,function(t){e.setFontSize(t.target.value)});e._attributesSection=e.div.querySelector("."+e.CLASS+"-attr");TC.Util.isFunction(t)&&t()},n={fontSize:e.styles.text.fontSize,fontColor:e.styles.text.fontColor,labelOutlineColor:e.styles.text.labelOutlineColor,labelOutlineWidth:e.styles.text.labelOutlineWidth};return TC.browserFeatures.inputTypeColor()?e._set1stRenderPromise(e.renderData(n,r)):e._set1stRenderPromise(e.renderData(n,function(){const t=e.div.querySelector("input[type=color]");t.style.backgroundColor=t.value;t.style.color="transparent";const n=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()};t.onfocus=function(t){this.blur()};t.onchange=function(t){this.style.backgroundColor=this.value};e.map.loaded(function(){n.on("change",function(t){e.setFontColor("#"+t)})});r()}))};t.activate=function(){this._selectBtn.classList.add(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode)};t.deactivate=function(){const t=this;TC.Control.prototype.deactivate.call(t);t._selectBtn&&e(t,[]);t.wrap&&t.wrap.deactivate();if(t._selectBtn){t._selectBtn.classList.remove(TC.Consts.classes.ACTIVE);t.layer&&t.layer.features.forEach(function(t){t.toggleSelectedStyle(!1)})}};t.clear=function(){const t=this;t.layer&&t.layer.clearFatures();return t};t.isExclusive=function(){return!0};t.end=function(){this.wrap.end();return this};t.setMode=function(t,e){const r=this;t&&(r.mode=t);if(e&&t){r.layer&&r.layer.map.putLayerOnTop(r.layer);r.activate()}else r.deactivate();return r};t.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?Promise.resolve(null):this.layer?Promise.resolve(this.layer):this._layerPromise};t.setLayer=function(t){const e=this;if(e.map){e.setSelectedFeatures([]);e._layerPromise=new Promise(function(r,n){if("string"==typeof t)e.map.loaded(function(){e.layer=e.map.getLayer(t);r(e.layer)});else{e.layer=t;r(e.layer)}});Promise.all([e._layerPromise,e.renderPromise()]).then(function(t){const r=t[0];e.setSelectableState(r&&r.features.length>0)})}};t.setSelectableState=function(t){this._selectBtn.disabled=!t;this._textBtn.disabled=!t};t.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};t.setSelectedFeatures=function(t){const e=this.wrap.setSelectedFeatures(t);this.displayLabelText();return e};t.getActiveFeatures=function(){const t=this,e=t.getSelectedFeatures();!e.length&&t.layer.features.length&&e.push(t.layer.features[t.layer.features.length-1]);return e};t.unselectFeatures=function(t){t=t||[];this.wrap.unselectFeatures(t.map(function(t){return t.wrap.feature}));return this};t.deleteSelectedFeatures=function(){const t=this,e=t.getSelectedFeatures();t.wrap.unselectFeatures(e);e.forEach(function(e){t.layer.removeFeature(e);t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:e})});return t};t.styleFunction=function(t,e){var r;const n=this.map.options.styles.selection;switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:r=TC.Util.extend({},n.polygon);break;case TC.feature.Point&&t instanceof TC.feature.Point:case TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint:r=TC.Util.extend({},n.point);break;default:r=TC.Util.extend({},n.line)}const i=t.getStyle();if(i.label){r.label=i.label;r.fontSize=i.fontSize;r.fontColor=i.fontColor;r.labelOutlineColor=i.labelOutlineColor;r.labelOutlineWidth=i.labelOutlineWidth}return r};t.setTextMode=function(t){const e=this;e.textActive=t;if(t){e._textBtn.classList.add(TC.Consts.classes.ACTIVE,t);e._styleSection.classList.remove(TC.Consts.classes.HIDDEN)}else{e._textBtn.classList.remove(TC.Consts.classes.ACTIVE,t);e._styleSection.classList.add(TC.Consts.classes.HIDDEN)}e.displayLabelText();return e};t.setFontColorWatch=function(t,e){const r=this;void 0===t&&(t=r.styles.text.fontColor);t=TC.Util.colorArrayToString(t);e=e||r.getLabelOutlineColor(t);r.renderPromise().then(function(){r._fontColorPicker.value=t;r._textInput.style.color=t;r._textInput.style.textShadow="0 0 "+r.styles.text.labelOutlineWidth+"px "+e;if(!TC.browserFeatures.inputTypeColor()){r._fontColorPicker.style.backgroundColor=t;r._fontColorPicker.blur()}});return r};t.setFontColor=function(t){const e=this;e.styles.text.fontColor=t;e.styles.text.labelOutlineColor=e.getLabelOutlineColor(t);e.setFontColorWatch(t,e.styles.text.labelOutlineColor);e.getActiveFeatures().forEach(function(r){const n=r.getStyle();n.fontColor=t;n.labelOutlineColor=e.styles.text.labelOutlineColor;r.setStyle(n)});return e};t.setFontSizeWatch=function(t){const e=this;void 0===t&&(t=e.styles.text.fontSize);const r=parseInt(t);r!==Number.NaN&&e.renderPromise().then(function(){e._fontSizeSelector.value=r;e._textInput.style.fontSize=r+"pt"});return e};t.setFontSize=function(t){const e=this,r=parseInt(t);if(r!==Number.NaN){e.styles.text.fontSize=r;e.setFontSizeWatch(r);e.getActiveFeatures().forEach(function(t){const e=t.getStyle();e.fontSize=r;t.setStyle(e)})}return e};t.getLabelOutlineColor=function(t){if(t){const e=(t=TC.Util.colorArrayToString(t)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e&&e.length&&(t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const r=t.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(r&&r.length){return(parseInt(r[1],16)+parseInt(r[2],16)+parseInt(r[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"};t.displayLabelText=function(){const t=this,e=t.getSelectedFeatures();var r,n,i;if(t.isActive&&e.length){const t=e[e.length-1].getStyle();r=t.label;i=t.fontColor;n=t.fontSize}else{r="";i=t.styles.text.fontColor;n=t.styles.text.fontSize}t.renderPromise().then(function(){t.setFontSizeWatch(n).setFontColorWatch(i)._textInput.value=r||""});return t};t.labelFeatures=function(t){const e=this,r=e.getActiveFeatures();if(r.length){const n=r[0].getStyle();r.forEach(function(r){const i=TC.Util.extend({},e.styles.text,n);n.label=t;n.labelOffset=i.labelOffset;n.fontColor=i.fontColor;n.fontSize=i.fontSize;n.labelOutlineColor=i.labelOutlineColor;n.labelOutlineWidth=i.labelOutlineWidth;r.setStyle(n)})}return e};t.getAttributeDisplayTarget=function(){return this._attributesSection};t.displayAttributes=function(){const t=this,e=t.getSelectedFeatures(),r=e[e.length-1];r&&t.getRenderedHtml(t.CLASS+"-attr",{data:r.getData()},function(e){const r=t.getAttributeDisplayTarget();r.innerHTML=e;r.classList.remove(TC.Consts.classes.HIDDEN);t._editAttrBtn.classList.add(TC.Consts.classes.ACTIVE);r.querySelector(`${t.CLASS}-btn-attr-ok`).addEventListener(TC.Consts.event.CLICK,function(e){t._onAttrOK()});r.querySelector(`.${t.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(TC.Consts.event.CLICK,function(){t.closeAttributes()})})};t.closeAttributes=function(){this._attributesSection.classList.add(TC.Consts.classes.HIDDEN);this._editAttrBtn.classList.remove(TC.Consts.classes.ACTIVE)};t.toggleAttributes=function(){const t=this;t._editAttrBtn.classList.toggle(TC.Consts.classes.ACTIVE)?t.displayAttributes():t.closeAttributes()};t._onAttrOK=function(){const t=this,e=t.getSelectedFeatures()[0];if(e){const r={};t.getAttributeDisplayTarget().querySelectorAll("input").forEach(function(t){r[t.getAttribute("name")]=t.value});e.setData(r);t.trigger(TC.Consts.event.FEATUREMODIFY,{feature:e,layer:t.layer});t.closeAttributes()}};t.joinFeatures=function(t){const r=this;if(r.geometryType===TC.Consts.geom.MULTIPOLYLINE||r.geometryType===TC.Consts.geom.MULTIPOLYGON||r.geometryType===TC.Consts.geom.MULTIPOINT){r._joinedFeatureAttributes=[];if(t.length>1){for(var n=t.map(function(t){r._joinedFeatureAttributes[r._joinedFeatureAttributes.length]=t.getData();return t.geometry}).reduce(function(t,e){return t.concat(e)}),i=new t[0].constructor(n),o=0,a=t.length;o<a;o++){var s=t[o];r.layer.removeFeature(s);r.trigger(TC.Consts.event.FEATUREREMOVE,{feature:s})}r.layer.addFeature(i).then(function(t){r.setSelectedFeatures([i]);r.trigger(TC.Consts.event.FEATUREADD,{feature:t});t.showPopup(r.attributeEditor)})}e(r,[i])}}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.featureInfoControl=null;this.lineFeatureInfoControl=null;this.polygonFeatureInfoControl=null;this.featureInfoControls=[];this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.MultiFeatureInfo.prototype;t.CLASS="tc-ctl-m-finfo";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",e,{},{$key:"selectionBy"}).w("</span>").x(e.get(["pointSelectValue"],!1),e,{block:r},{}).x(e.get(["lineSelectValue"],!1),e,{block:n},{}).x(e.get(["polygonSelectValue"],!1),e,{block:i},{}).w('<button class="tc-ctl-m-finfo-btn-remove" disabled title="').h("i18n",e,{},{$key:"deleteFeatures"}).w('"></button></form></div>')}e.__dustBody=!0;function r(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",e,{},{$key:" selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["pointSelectValue"],!1),e,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byPoint"}).w("</span></label>")}r.__dustBody=!0;function n(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",e,{},{$key:" selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["lineSelectValue"],!1),e,"h").w('" /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byLine"}).w("</span></label>")}n.__dustBody=!0;function i(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",e,{},{$key:" selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["polygonSelectValue"],!1),e,"h").w('" /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byPrecinct"}).w("</span></label>")}i.__dustBody=!0;return e};const e=function(t,e){if(t){!0===t&&(t={});return TC.Util.extend(!0,t,e)}return t};t.register=function(t){const r=this;r.div.querySelectorAll("input[type=radio]").forEach(function(t){t.checked=!1});return new Promise(function(n,i){const o=[TC.Control.prototype.register.call(r,t)],a=r.options.styles||{};r.modes[TC.Consts.geom.POINT]&&o.push(t.addControl("featureInfo",e(r.modes[TC.Consts.geom.POINT],{displayMode:r.options.displayMode})).then(function(t){r.featureInfoControl=t;r.featureInfoControls.push(t);return t}));r.modes[TC.Consts.geom.POLYLINE]&&o.push(t.addControl("lineFeatureInfo",e(r.modes[TC.Consts.geom.POLYLINE],{displayMode:r.options.displayMode,style:a.line})).then(function(t){r.lineFeatureInfoControl=t;r.featureInfoControls.push(t);return t}));r.modes[TC.Consts.geom.POLYGON]&&o.push(t.addControl("polygonFeatureInfo",e(r.modes[TC.Consts.geom.POLYGON],{displayMode:r.options.displayMode,style:a.polygon})).then(function(t){r.polygonFeatureInfoControl=t;r.featureInfoControls.push(t);return t}));t.on(`${TC.Consts.event.LAYERADD} ${TC.Consts.event.LAYERREMOVE} ${TC.Consts.event.LAYERVISIBILITY}`,function(t){r.updateUI()});t.on(`${TC.Consts.event.CONTROLACTIVATE} ${TC.Consts.event.CONTROLDEACTIVATE}`,function(t){t.control!==r.featureInfoControl&&t.control!==r.lineFeatureInfoControl&&t.control!==r.polygonFeatureInfoControl||r.updateUI()});Promise.all(o).then(function(){if(r.featureInfoControl){r.featureInfoControl.activate();r.lastCtrlActive=r.featureInfoControl}r.updateUI();n(r)})})};t.render=function(t){const e=this;var r={};e.modes[TC.Consts.geom.POINT]&&(r.pointSelectValue=TC.Consts.geom.POINT);e.modes[TC.Consts.geom.POLYLINE]&&(r.lineSelectValue=TC.Consts.geom.POLYLINE);e.modes[TC.Consts.geom.POLYGON]&&(r.polygonSelectValue=TC.Consts.geom.POLYGON);return e._set1stRenderPromise(e.renderData(r,function(){var r=function(){switch(this.value){case TC.Consts.geom.POLYLINE:e.lineFeatureInfoControl.activate();e.lastCtrlActive=e.lineFeatureInfoControl;break;case TC.Consts.geom.POLYGON:e.polygonFeatureInfoControl.activate();e.lastCtrlActive=e.polygonFeatureInfoControl;break;default:e.featureInfoControl.activate();e.lastCtrlActive=e.featureInfoControl}};e.div.querySelectorAll("input[type=radio]").forEach(function(t){t.addEventListener("change",r)});e.div.querySelector(`.${e.CLASS}-btn-remove`).addEventListener(TC.Consts.event.CLICK,function(t){t.preventDefault();e.featureInfoControls.forEach(t=>{t.info=null;t._infoHistory={};t.resultsLayer.features.slice().forEach(e=>t.downplayFeature(e));t.filterLayer.features.slice().forEach(t=>t.layer.removeFeature(t))})});e.map.on(TC.Consts.event.FEATUREREMOVE,function(t){e.featureInfoControls.some(e=>e.resultsLayer===t.layer||e.filterLayer===t.layer)&&e.updateUI()}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){e.featureInfoControls.some(e=>e.resultsLayer===t.layer||e.filterLayer===t.layer)&&e.updateUI()});TC.Util.isFunction(t)&&t()}))};t.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};t.deactivate=function(){this.lastCtrlActive.deactivate(!1)};t.updateUI=function(){const t=this;t.renderPromise().then(function(){const e=t.map.workLayers.some(t=>t.type===TC.Consts.layerType.WMS&&t.getVisibility());t.div.querySelectorAll("input").forEach(function(t){t.disabled=!e});if(t.featureInfoControl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POINT}]`);e&&(e.checked=t.featureInfoControl.isActive)}if(t.lineFeatureInfoControl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POLYLINE}]`);e&&(e.checked=t.lineFeatureInfoControl.isActive)}if(t.polygonFeatureInfoControl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POLYGON}]`);e&&(e.checked=t.polygonFeatureInfoControl.isActive)}const r=t.div.querySelector(`.${t.CLASS}-btn-remove`);r.classList.toggle(TC.Consts.classes.HIDDEN,!t.featureInfoControls.some(t=>t.options.persistentHighlights));r.disabled=t.featureInfoControls.every(t=>t.resultsLayer&&0===t.resultsLayer.features.length&&t.filterLayer&&0===t.filterLayer.features.length);const n=t.div.style.display;t.div.style.display="none";n?t.div.style.display=n:t.div.style.removeProperty("display")})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var t=TC.control.NavBar.prototype;t.CLASS="tc-ctl-nav";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBar(this));return this._set1stRenderPromise(Promise.resolve())};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);(void 0===e.options.home||e.options.home)&&t.addControl("navBarHome");t.loaded(function(){e.wrap.refresh()});return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBarHome=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBarHome,TC.Control);!function(){var t=TC.control.NavBarHome.prototype;t.CLASS="tc-ctl-nav-home";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBarHome(this));return Promise.resolve()};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);t.on(TC.Consts.event.PROJECTIONCHANGE,function(r){const n=r.newCrs;var i=TC.Util.reproject([t.options.initialExtent[0],t.options.initialExtent[1]],t.options.crs,n),o=TC.Util.reproject([t.options.initialExtent[2],t.options.initialExtent[3]],t.options.crs,n);e.wrap.setInitialExtent([i[0],i[1],o[0],o[1]])});return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.isLoaded=!1;this.layer=null};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var t=TC.control.OverviewMap.prototype;t.CLASS="tc-ctl-ovmap";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=function(e){return function(e){var r,n=function(t,e){for(var r=null,n=0;n<e.length;n++){var i=e[n];if((i.id||i)===t){r=i;break}}return r};if("string"==typeof e){var i=n(e,t.options.availableBaseLayers);TC.Util.isPlainObject(i)||(i=n(e,t.options.baseLayers));TC.Util.isPlainObject(i)&&(r=new TC.layer.Raster(i))}else r=e instanceof TC.Layer?e:e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e);return r}(e)};return new Promise(function(n,i){TC.Control.prototype.register.call(e,t).then(function(i){e.wrap=new TC.wrap.control.OverviewMap(e);t.loaded(function(){e.defaultLayer=r(e.options.layer);e.layer=r(t.baseLayer.overviewMapLayer||e.options.layer||t.options.baseLayers[0]||t.options.availableBaseLayers[0]);e.wrap.register(t);!function(r){const n={};e.layer.getCapabilitiesPromise().then(function(){e.layer.isCompatible(t.crs)||0!==e.layer.wrap.getCompatibleMatrixSets(t.crs).length||(n.layer=e.layer.getFallbackLayer());e.wrap.reset(n)})}(t.crs);t.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(t){const e=this;if(e.map.baseLayer.type===TC.Consts.layerType.WMS||e.map.baseLayer.type===TC.Consts.layerType.WMTS||e.options.layer){var n=e.map.baseLayer.overviewMapLayer||e.options.layer;if(e.layer.id!==n){var i=r(n);e.wrap.reset({layer:i}).then(function(t){e.layer=t})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(t.type)>-1&&e.wrap.reset({layer:e.layer}).then(function(t){e.layer=t})}}.bind(e))});n(i)}).catch(function(t){i(t)})})};t.loaded=function(t){TC.Util.isFunction(t)&&(this.isLoaded&&this.map&&this.map.isLoaded?t():this.on(TC.Consts.event.MAPLOAD,t))};t.activate=function(){this.enable()};t.deactivate=function(){this.disable()};t.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};t.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYGON;this.style=TC.Util.extend(!0,{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},this.options.style)};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.PolygonFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var t=TC.control.Popup.prototype;t.CLASS="tc-ctl-popup";t.render=function(){const t=this;return t._set1stRenderPromise(new Promise(function(e,r){t.map.wrap.addPopup(t).then(function(){t.trigger(TC.Consts.event.CONTROLRENDER);e()},function(t){r(t instanceof Error?t:Error(t))})}))};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);return new Promise(function(n,i){Promise.all([r,e.renderPromise()]).then(function(){t.on(TC.Consts.event.VIEWCHANGE,function(){t.view===TC.Consts.view.PRINTING&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.LAYERREMOVE,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.UPDATE,function(){e.currentFeature&&e.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||e.isVisible()&&e.hide()});t.on(TC.Consts.event.FEATUREREMOVE,function(t){e.currentFeature===t.feature&&e.isVisible()&&e.hide()});n(e)}).catch(function(t){i(t instanceof Error?t:Error(t))})})};t.fitToView=function(t){var e=this;t?setTimeout(function(){e.wrap.fitToView()},1e3):e.wrap.fitToView()};t.hide=function(){if(this.map){const t={control:this,feature:this.currentFeature};this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.trigger(TC.Consts.event.POPUPHIDE,t)}};t.getContainerElement=function(){return this.contentDiv||null};t.getMenuElement=function(){return this.menuDiv||null};t.setDragged=function(t){const e=this;e.dragged=t;e.popupDiv&&e.popupDiv.classList.toggle(TC.Consts.classes.DRAGGED,!!t);e.wrap.setDragged(t)};t.setDragging=function(t){const e=this;if(t){e.setDragged(!0);e.popupDiv.classList.add(TC.Consts.classes.DRAG)}else e.popupDiv.classList.remove(TC.Consts.classes.DRAG)};t.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(t){var e=this,r=t||{};e.ready=!1;e.title=r.title||TC.Util.getLocaleString(TC.Cfg.locale,"printPage");e.cssUrl=r.cssUrl||TC.apiLocation+"TC/css/print.css";if(r.target){const t=r.target;if(!t.querySelector("."+e.CLASS+"-btn")){(r.printableElement||t).classList.add(TC.Consts.classes.PRINTABLE);TC.Control.prototype.getRenderedHtml.call(e,e.CLASS,null).then(function(n){t.insertAdjacentHTML("afterbegin",n);t.querySelector("."+e.CLASS+"-btn").addEventListener("click",function(n){var i=open(null,e.CLASS),o=(r.printableElement||t).innerHTML;TC.Control.prototype.getRenderedHtml.call(e,e.CLASS+"-page",{title:e.title,content:o,cssUrl:e.cssUrl}).then(function(t){i.document.write(t);i.document.close();i.focus()}).catch(function(t){TC.error(t)})}.bind(e))})}}};!function(){var t=TC.control.Print.prototype;t.CLASS="tc-ctl-print";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<a class="tc-ctl-print-btn" title="').h("i18n",e,{},{$key:"printThisWindow"}).w('">').h("i18n",e,{},{$key:"print"}).w("</a>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-page"]=function(){dust.register(t.CLASS+"-page",e);function e(t,e){return t.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(e.get(["title"],!1),e,"h").w('</title><link rel="stylesheet" href="').f(e.get(["cssUrl"],!1),e,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(e.get(["title"],!1),e,"h").w("</h1>").f(e.get(["content"],!1),e,"h",["s"]).w("</body></html>")}e.__dustBody=!0;return e}}();TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.PrintMap=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintMap,TC.control.MapInfo);!function(){var t=TC.control.PrintMap.prototype;t.CLASS="tc-ctl-printMap";const e="portrait",r="landscape",n="A4",i="A3";var o={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},a={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},s={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},l={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}};const c=function(t,c){switch(t){case e:switch(c){case n:return o;case i:return s}break;case r:switch(c){case n:return a;case i:return l}break;default:return o}},u=function(t){return t.layoutPDF.content[0].columns[0]},h=function(t){return t.layoutPDF.content[0].columns[2]},d={sideLength:85};t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",e,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",e,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",e,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt tc-ctl-printMap-cnt-btn"><input id="tc-ctl-printMap-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-printMap-image-qr" class="tc-ctl-printMap-image-qr-label" title="').h("i18n",e,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",e,{},{$key:"appendQRCode"}).w('</label><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"printMap"}).w('">').h("i18n",e,{},{$key:"print"}).w('</button></div><div class="tc-group tc-ctl-printMap-cnt"><div class="tc-ctl-printMap-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w("</p></div></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){dust.register(t.CLASS+"-view",e);function e(t,e){return t.w('<div class="tc-ctl-printMap-view">    </div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-tools"]=function(){dust.register(t.CLASS+"-tools",e);function e(t,e){return t.w('<div class="tc-ctl-printMap-tools"><div class="tc-ctl-printMap-btn-pdf" title="').h("i18n",e,{},{$key:"printpdf"}).w('"></div><div class="tc-ctl-printMap-btn-close" title="').h("i18n",e,{},{$key:"close"}).w('"></div></div>    ')}e.__dustBody=!0;return e};const p=function(){return this.map.workLayers.some(function(t){return t.type===TC.Consts.layerType.WMS&&t.getVisibility()})};t.register=function(t){const r=this,n=TC.control.MapInfo.prototype.register.call(r,t);r.map.mustBeExportable=!0;const i=function(){c(r.orientation||e,r.format.toString().toUpperCase()||"A4").reset()};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+r.CLASS+"-btn",function(){r.map.setView(TC.Consts.view.PRINTING);var t=document.querySelector("."+r.CLASS+"-qrcode");if(document.querySelector("#"+r.CLASS+"-image-qr").checked){if(!t){(t=document.createElement("div")).classList.add(r.CLASS+"-qrcode");r.map.div.appendChild(t)}t.innerHTML="";r.makeQRCode(t,d.sideLength,d.sideLength)}else t&&(t.innerHTML="");const n="."+r.CLASS+"-btn";r.map.on(TC.Consts.event.STARTLOADING,function(){const t=r.div.querySelector(n);t.classList.add("disabled");t.disabled=!0});r.map.on(TC.Consts.event.STOPLOADING,function(){const t=r.div.querySelector(n);t.classList.remove("disabled");t.disabled=!1});p.call(r)&&r.map.on(TC.Consts.event.ZOOM,i);const o=function(t){if(t){r.map.div.classList.add(t);var e=r.map.div.getBoundingClientRect();Number.isInteger(e.width)||(r.map.div.style.width=Math.round(e.width)+"px");Number.isInteger(e.height)||(r.map.div.style.height=Math.round(e.height)+"px");r.map.toast(r.getLocaleString("print.advice.title")+": "+r.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3})}r.map.wrap.map.updateSize()},a=function(){c(r.orientation||e,r.format.toString().toUpperCase()||"A4").reset();p.call(r)&&r.map.off(TC.Consts.event.ZOOM,i);r.map.toastHide(r.getLocaleString("print.advice.title")+": "+r.getLocaleString("print.advice.desc"));r.map.div.classList.remove(r.currentFormat,r.CLASS+"-printing");r.map.div.style.removeProperty("width");r.map.div.style.removeProperty("height");o();r.map.setView(TC.Consts.view.DEFAULT);r._viewDiv.classList.add(TC.Consts.classes.HIDDEN)};if(!r._viewDiv){r._viewDiv=TC.Util.getDiv();document.body.appendChild(r._viewDiv);r.getRenderedHtml(r.CLASS+"-view",null,function(t){r._viewDiv.innerHTML=t});r.getRenderedHtml(r.CLASS+"-tools",null,function(t){r.map.div.insertAdjacentHTML("beforeend",t);r.map.div.querySelector("."+r.CLASS+"-btn-close").addEventListener("click",a);r.map.div.querySelector("."+r.CLASS+"-btn-pdf").addEventListener("click",r.createPdf.bind(r))})}r.orientation=r.div.querySelector("#print-design").value;r.format=r.div.querySelector("#print-size").value;r.currentFormat=r.CLASS+"-"+r.orientation+"-"+r.format;r._viewDiv.classList.remove(TC.Consts.classes.HIDDEN);r.map.div.classList.add(r.CLASS+"-printing");o(r.currentFormat)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("#"+r.CLASS+"-image-qr",function(t){r.generateLink()}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){r.generateLink();r.registerListeners()}));return n};t.createPdf=function(){var t=this,r=t.map.getControlsByClass(TC.control.LoadingIndicator)[0],n=r.addWait();TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){const i=t.map.div.querySelectorAll(".ol-viewport");for(var o=0,a=i.length;o<a;o++){const e=i[o];if(!e.parentElement.classList.contains("ol-overviewmap-map")){t.canvas=e.querySelector("canvas");break}}var s=c(t.orientation||e,t.format.toString().toUpperCase()||"A4"),l=s.layoutPDF;const p=function(e){var i=window.location.host+"_",o=t.div.querySelector("."+t.CLASS+"-title").value.trim();if(o)i+=o;else{i+=TC.Util.getFormattedDate((new Date).toString(),!0)}try{pdfMake.createPdf(e).download(i.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(e){t.map.toast(t.getLocaleString("print.error"),{type:TC.Consts.msgType.ERROR});TC.error(e.message+"  "+e.stack,TC.Consts.msgErrorMode.EMAIL)}r.removeWait(n)},f=function(e){TC.error(t.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+e,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},g=function(){var e=[],r=t.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS&&t.getVisibility()}),n=[],i=function(t,e,r){if(e.isVisibleByScale(t.name)){var n,i;e.options&&e.options.params&&e.options.params.base64LegendSrc?i=e.options.params.base64LegendSrc:t.legend&&(n=t.legend.src);result.push({src:n,title:t.title,level:r,srcBase64:i})}},o=function(t,e,r,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)o(t[i],e,r,n);else if(t&&t.hasOwnProperty("children")&&t.children.length>0){t.title&&t.name&&result.push({header:t.title,level:n});o(t.children,e,r,++n)}if(t&&t.hasOwnProperty("children")&&0==t.children.length){e.apply(this,[t,r,n]);n--}};r.forEach(function(t){result=[];var e=t.options.hideTree;t.tree=null;t.options.hideTree=!0;o(t.getTree(),i,t,0);t.options.hideTree=e;result.length>0&&n.push({title:t.title,layers:result})});return new Promise(function(t,r){Promise.all(function(){for(var t=[],e=0;e<n.length;e++)for(var r=n[e].layers,i=0;i<r.length;i++)!function(r,i){var o=n[e].layers[i],a=o.src||o.srcBase64;if(a){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");t.push(new Promise(function(t,e){new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!0}).fetchImage(a,{exportable:!0}).then(function(e){if(e.complete){var r=TC.Util.imgTagToDataUrl(e,"image/png");o.image={base64:r.base64,canvas:r.canvas}}else f(a);t()},function(t){f(a);e(t)})}))}}(0,i);return t}()).then(function(){n.map(function(t,e){return{groupIndex:e,height:t.layers.filter(function(t){return t.image&&t.image.canvas}).reduce(function(t,e,r,n){return t+n[r].image.canvas.height},0)}}).sort(function(t,e){return t.height>e.height?1:t.height<e.height?-1:0}).forEach(function(t,r){!function(t,r){var n=[[{text:t.title,colSpan:2,alignment:"left",fontSize:11,margin:[0,r>0?10:0,0,5]},{}]];const i=(n=n.concat(t.layers.filter(function(e){return e.hasOwnProperty("header")&&e.header.trim().toLowerCase()!==t.title.trim().toLowerCase()}).map(function(t){return[{text:t.header.trim(),colSpan:2,alignment:"left",margin:[10*t.level,0,0,3]},{}]}))).length;var o=null,a=null;t.layers.forEach(function(t,e){if(t.header){o=t;a&&(a=null)}else{a||(a=1);var r;o&&(r=n.map(function(t){return t[0].text}).indexOf(o.header)+a++);if(t.image){var i=t.image.canvas.width/2,s=i*t.image.canvas.height/t.image.canvas.width,l=[{text:t.title,fontSize:9,width:"auto",margin:[10*t.level,0,0,2]},{image:t.image.base64,width:i,height:s,margin:[10*t.level,0,0,2]}];r?n.splice(r,0,l):n.push(l)}else{l=[{text:t.title,fontSize:9,colSpan:2,margin:[10*t.level,0,0,2]},{}];r?n.splice(r,0,l):n.push(l)}}});e.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:i,body:n}})}(n[t.groupIndex],r)});t(e)},function(){r([])})})},y=[function(){const e=function(){var t=u(s);delete t.image;t.text="";return t};return t.options.logo?TC.Util.imgToDataUrl(t.options.logo,"image/png").then(function(t){const e=t.canvas,r=t.dataUrl;TC.Util.calculateAspectRatioFit(e.width,e.height,s.logoWidth,s.logoHeight);var n=u(s);n.width||(n.width=e.width/e.height*n.height);n.image=r;return n},function(){f(t.options.logo);return e()}):e()},function(){var e=function(t){return t.layoutPDF.content[0].columns[1]}(s);e.text=t.div.querySelector("."+t.CLASS+"-title").value.trim();return e},function(){const e=function(){var t=h(s);delete t.image;t.text="";t.width="auto";return t};var r=t.map.getControlsByClass(TC.control.ScaleBar)[0];if(r){var n=document.getElementsByClassName("ol-scale-line-inner"),i=n[0].getBoundingClientRect();if(i){var o=getComputedStyle(n[0],null),a=parseInt(o.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(o.getPropertyValue("border-right-width").replace("px",""))||0,c=h(s);c.table={widths:[.75*((i.width>i.height?i.width:i.height)-a-l)],body:[[{border:[!0,!1,!0,!0],text:r.getText(),fontSize:10,alignment:"center"}]]};c.layout={paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}};return c}return e()}return e()},function(){if(document.querySelector("#"+t.CLASS+"-image-qr").checked){const e=document.querySelector("."+t.CLASS+"-qrcode");e.innerHTML="";return t.makeQRCode(e,d.sideLength,d.sideLength).then(function(e){if(e)return TC.Util.addToCanvas(t.canvas,e,{x:t.canvas.width-d.sideLength,y:t.canvas.height-d.sideLength},{width:d.sideLength,height:d.sideLength}).then(function(t){return t});TC.error(t.getLocaleString("print.qr.error"));return t.canvas})}return t.canvas}];Promise.all(y.map(function(t){return t()})).then(function(e){e[2].table&&(s.layoutPDF.content[0].columns[1].width=s.layoutPDF.pageSize.width-(s.layoutPDF.pageMargins[0]+s.layoutPDF.pageMargins[2])-s.layoutPDF.content[0].columns[0].width-(s.layoutPDF.content[0].columns[2].table.widths[0]+2));var r=function(t){return t.layoutPDF.content[1].table.body[0][0]}(s),n=e[3]||t.canvas;r.image=n.toDataURL();if(t.options.legend&&t.options.legend.visible&&function(){return this.map.workLayers.some(function(t){if(t.type===TC.Consts.layerType.WMS&&t.getVisibility()){for(var e=0;e<t.names.length;e++)if(t.isVisibleByScale(t.names[e]))return!0;return!1}return!1})}.call(t)&&2==l.content.length){const e=t.div.querySelector("."+t.CLASS+"-title").value.trim();l.content.push({pageBreak:"before",pageOrientation:t.options.legend.orientation||"portrait",text:e.length>0?e:"",fontSize:14,margin:[0,20,0,10]});g().then(function(t){l.content=l.content.concat(t);p(l)})}else p(l)})})};t.manageMaxLengthExceed=function(t){const e=this.div.querySelector("."+this.CLASS+"-alert");document.querySelector("#"+this.CLASS+"-image-qr").checked?e.classList.toggle(TC.Consts.classes.HIDDEN,!t.qr):e.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa",SHOW_IN:"showIn",SHOW_OUT:"showOut"};this.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};this.content=this.contentType.TABLE;TC.Util.isEmptyObject(this.options)&&(this.options={content:"table"});this.options;this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};ctlProto.template={};ctlProto.template[ctlProto.CLASS]=function(){dust.register(ctlProto.CLASS,t);function t(t,e){return t.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><span class="prpanel-title-text"></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",e,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",e,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="').h("i18n",e,{},{$key:"export.excel"}).w('"><i class="fa fa-file-excel-o"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-dwn" hidden title="').h("i18n",e,{},{$key:"download"}).w('"><i class="fa fa-download"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="tc-ctl-p-results-menu"></div><div class="prpanel-body list-group tc-ctl-p-results-info"></div><div class="prpanel-body list-group tc-ctl-p-results-table"></div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",e,{},{$key:"expand"}).w('" data-no-cb><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}t.__dustBody=!0;return t};ctlProto.template[ctlProto.CLASS+"-table"]=function(){dust.register(ctlProto.CLASS+"-table",t);function t(t,r){return t.s(r.get(["results"],!1),r,{block:e},{}).w("    ")}t.__dustBody=!0;function e(t,e){return t.w("<h4>").f(e.get(["tableTitle"],!1),e,"h").w('</h4><table class="table">            <tbody>').h("iterate",e,{block:r},{on:e.getPath(!0,[])}).w("            </tbody></table>")}e.__dustBody=!0;function r(t,e){return t.w('<tr class="').f(e.getPath(!1,["css","trClass"]),e,"h").w('">').h("select",e,{block:n},{key:e.get(["key"],!1)}).w("</tr>")}r.__dustBody=!0;function n(t,e){return t.w('                        <th class="').f(e.getPath(!1,["css","thClass"]),e,"h").w('" title="').f(e.get(["key"],!1),e,"h").w('">').f(e.get(["key"],!1),e,"h").w('</th><td class="').f(e.getPath(!1,["css","tdClass"]),e,"h").w('" title="').f(e.get(["value"],!1),e,"h").w('">').f(e.get(["value"],!1),e,"h").w("</td>")}n.__dustBody=!0;return t};ctlProto.template[ctlProto.CLASS+"-chart"]=function(){dust.register(ctlProto.CLASS+"-chart",t);function t(t,n){return t.w('<div class="tc-track-chart">').x(n.get(["msg"],!1),n,{else:e,block:r},{}).w("</div>")}t.__dustBody=!0;function e(t,e){return t.w('<span id="elevationGain" >').h("i18n",e,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(e.get(["upHill"],!1),e,"h").w("m, -").f(e.get(["downHill"],!1),e,"h").w('m</span><div class="tc-chart"></div>')}e.__dustBody=!0;function r(t,e){return t.f(e.get(["msg"],!1),e,"h")}r.__dustBody=!0;return t};const isElementVisible=function(t){const e=getComputedStyle(t);return t&&!t.hidden&&"none"!==e.display&&"hidden"!==e.visibility};ctlProto.isVisible=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)||isElementVisible(e)};ctlProto.isMinimized=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)&&!isElementVisible(t)};const manageClassList=function(t,e,r){const n=this.div.querySelector("."+t);if(n){n.classList.add(e);n.classList.remove(r)}};ctlProto.show=function(t){const e=this.div.querySelector("."+t);e&&"none"===e.style.display&&(e.style.display="");manageClassList.call(this,t,this.classes.SHOW_IN,this.classes.SHOW_OUT)};ctlProto.hide=function(t){manageClassList.call(this,t,this.classes.SHOW_OUT,this.classes.SHOW_IN);const e=this.div.querySelector("."+t);e&&(e.style.display="none")};ctlProto.doVisible=function(){this.div.classList.remove(TC.Consts.classes.HIDDEN);this.show("prsidebar-body")};ctlProto.render=function(t){const e=this;e.div.classList.add(TC.Consts.classes.HIDDEN);return TC.Control.prototype.render.call(e,function(){e.mainTitleElm=e.div.querySelector(".prpanel-title-text");e.minimizeButton=e.div.querySelector(".prcollapsed-slide-submenu-min");e.minimizeButton.addEventListener("click",function(){e.minimize()});e.closeButton=e.div.querySelector(".prcollapsed-slide-submenu-close");e.closeButton.addEventListener("click",function(){e.close()});e.maximizeButton=e.div.querySelector(".prcollapsed-max");e.maximizeButton.addEventListener("click",function(){e.maximize()});if(e.save){e.saveButton=e.div.querySelector(".prcollapsed-slide-submenu-csv");e.saveButton.addEventListener("click",function(){e.exportToExcel()});e.saveButton.removeAttribute("hidden")}if(e.options.download&&"table"===e.options.content){e.downloadButton=e.div.querySelector(".prcollapsed-slide-submenu-dwn");e.downloadButton.addEventListener("click",function(){TC.Util.isFunction(e.options.download)&&e.options.download.apply(e,[])});e.downloadButton.removeAttribute("hidden")}if(e.content){e.content=e.content;if(e.options.titles){if(e.options.titles.main){e.mainTitleElm.setAttribute("title",e.options.titles.main);e.mainTitleElm.innerHTML=e.options.titles.main}e.options.titles.max&&e.maximizeButton.setAttribute("title",e.options.titles.max)}else{e.mainTitleElm.setAttribute("title",e.getLocaleString("rsp.title"));e.mainTitleElm.innerHTML=e.getLocaleString("rsp.title")}}e.div.querySelector(e.content.collapsedClass).classList.add(e.classes.FA);e.infoDiv=e.div.querySelector("."+e.CLASS+"-info");e.tableDiv=e.div.querySelector("."+e.CLASS+"-table");e.menuDiv=e.div.querySelector("."+e.CLASS+"-menu");TC.browserFeatures.touch()&&TC.Util.swipe(e.div,{left:function(){e.minimize()}});t&&"function"==typeof t&&t.call()})};ctlProto.minimize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(!isElementVisible(e)){e.classList.add(t.classes.FA);e.hidden=!1;t.hide("prsidebar-body");t.show("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMIN,{control:t})}};ctlProto.maximize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(isElementVisible(e)){e.hidden=!0;t.show("prsidebar-body");t.hide("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMAX,{control:t})}};ctlProto.close=function(){const t=this;t.div.classList.add(TC.Consts.classes.HIDDEN);t.chart&&t.chart.chart&&(t.chart.chart=t.chart.chart.destroy());const e=t.div.querySelector(".prsidebar-body");if(e){e.style.display="none";t.div.querySelector(".prcollapsed-max").style.display="none";const r=t.div.querySelector(t.content.collapsedClass);r.hidden=!0;r.classList.remove(t.classes.FA);t.map.trigger(TC.Consts.event.RESULTSPANELCLOSE,{control:t})}};ctlProto.openChart=function(t){const e=this;e.div.classList.remove(TC.Consts.classes.HIDDEN);e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return t!==e}).filter(function(t){return"chart"===t.options.content}).forEach(function(t){t.close()});if(t)if(t.msg)e.map.toast(t.msg);else{e.elevationProfileChartData=t;e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})}else e.map.toast(options.msg)};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data;data.ele=data.ele.map(t=>null===t?0:t);const div=options.div;var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(ctlProto.CLASS+"-chart",{upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"},function(out){div.innerHTML=out;div.style.display="";if(self.options.titles){if(self.options.titles.main){const t=self.div.querySelector(".prpanel-title-text");t.setAttribute("title",self.options.titles.main);t.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var chartOptions=TC.Util.extend({bindto:div.querySelector(".tc-chart"),padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFnFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFnFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){TC.Util.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.trigger(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(t,e){var r=this,n=r.config,i=r.d3.svg.line(),o=r.generateGetLinePoints(t,e),a=e?r.getSubYScale:r.getYScale,s=function(t){return(e?r.subxx:r.xx).call(r,t)},l=function(t,e){return n.data_groups.length>0?o(t,e)[0][1]:a.call(r,t.id)(t.value)};i=n.axis_rotated?i.x(l).y(s):i.x(s).y(l);n.line_connectNull||(i=i.defined(function(t){return null!=t.value}));return function(t){var o,s=n.line_connectNull?r.filterRemoveNull(t.values):t.values,l=e?r.x:r.subX,c=a.call(r,t.id),u=0,h=0;if(r.isLineType(t))if(n.data_regions[t.id])o=r.lineWithRegions(s,l,c,n.data_regions[t.id]);else{r.isStepType(t)&&(s=r.convertValuesToStep(s));o=i.interpolate("linear")(s)}else{if(s[0]){u=l(s[0].x);h=c(s[0].value)}o=n.axis_rotated?"M "+h+" "+u:"M "+u+" "+h}return o||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(t,e){var r=this,n=r.config,i=r.d3.svg.area(),o=r.generateGetAreaPoints(t,e),a=e?r.getSubYScale:r.getYScale,s=function(t){return(e?r.subxx:r.xx).call(r,t)},l=function(t,e){return n.data_groups.length>0?o(t,e)[0][1]:a.call(r,t.id)(0)},c=function(t,e){return n.data_groups.length>0?o(t,e)[1][1]:a.call(r,t.id)(t.value)};i=n.axis_rotated?i.x0(l).x1(c).y(s):i.x(s).y0(l).y1(c);n.line_connectNull||(i=i.defined(function(t){return null!==t.value}));return function(t){var e,o=n.line_connectNull?r.filterRemoveNull(t.values):t.values,a=0,s=0;if(r.isAreaType(t)){r.isStepType(t)&&(o=r.convertValuesToStep(o));e=i.interpolate("linear")(o)}else{if(o[0]){a=r.x(o[0].x);s=r.getYScale(t.id)(o[0].value)}e=n.axis_rotated?"M "+s+" "+a:"M "+a+" "+s}return e||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};const closeOpenedTableResultsPanel=function(){const t=this;t.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return e!==t&&e.isVisible()}).filter(function(e){return e.options.content!==t.contentType.CHART}).forEach(function(t){t.close()})};ctlProto.openTable=function(){var t=this;t.div.classList.remove(TC.Consts.classes.HIDDEN);if(r=arguments[0]){var e;r.css&&(e=r.css);var r,n=r.callback,i=r.columns;if((r=r.data)&&r.length>0){if(!i){i=[];for(var o in r[0])i.push(o)}t.tableData={columns:i,results:r,css:e,callback:n};t.getRenderedHtml(t.CLASS+"-table",t.tableData).then(function(e){const r=t.div.querySelector("."+t.CLASS+"-table"),n=r.parentElement;n.removeChild(r);r.innerHTML=e;n.appendChild(r);t.tableData.callback&&t.tableData.callback(r);closeOpenedTableResultsPanel.call(t);t.map.trigger(TC.Consts.event.DRAWTABLE,{control:t})});t.div.querySelector("."+t.CLASS+"-chart").style.display="none";t.div.querySelector("."+t.CLASS+"-info").style.display="none";t.show("prsidebar-body")}}};ctlProto.open=function(t,e){const r=this;r.div.classList.remove(TC.Consts.classes.HIDDEN);const n=e||r.div.querySelector("."+r.CLASS+"-table");r.requestIsRendered=window.requestAnimationFrame(function(){var t=n.getBoundingClientRect();if(t&&t.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.trigger(TC.Consts.event.DRAWTABLE,{control:r})}}.bind(r));r.div.querySelector("."+r.CLASS+"-chart").style.display="none";const i=r.div.querySelector("."+r.CLASS+"-table");i.style.display="none";r.div.querySelector("."+r.CLASS+"-info").style.display="none";if(t)if(e){r.getTableContainer=function(){return e};e.innerHTML=t;e.style.display=""}else{i.innerHTML=t;i.style.display=""}const o=r.div.querySelector(".prcollapsed-max");if(r.options.titles){if(r.options.titles.main){const t=r.div.querySelector(".prpanel-title-text");t.setAttribute("title",r.options.titles.main);t.innerHTML=r.options.titles.main}r.options.titles.max&&o.setAttribute("title",r.options.titles.max)}r.options.classes&&r.options.classes.collapsed&&o.querySelector("i.fa-list-alt").classList.add(r.options.classes.collapsed);const a=r.div.querySelector(r.content.collapsedClass);isElementVisible(a)&&r.maximize();r.show("prsidebar-body");r.hide("prcollapsed-max")};ctlProto.createChartOptions=function(t){const e=this;var r={};const n=(t=t||{}).locale||TC.Util.getMapLocale(e.map);t.chartType;if(null!=t.ele){const a=function(){const r=getComputedStyle(e.getContainerElement()),n=document.documentElement.clientWidth/100*40,i={height:n>445?t.maxHeight||e.CHART_SIZE.MAX_HEIGHT:t.minHeight||e.CHART_SIZE.MIN_HEIGHT};r.width===getComputedStyle(e.map.div).width?i.width=.95*parseFloat(r.width):i.width=n>445?t.maxWidth||e.CHART_SIZE.MAX_WIDTH:n>310?t.mediumWidth||e.CHART_SIZE.MEDIUM_WIDTH:t.minWidth||e.CHART_SIZE.MIN_WIDTH;return i};var i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;t.ele.forEach(function(t){if("number"==typeof t){i=Math.max(t,i);o=Math.min(t,o)}});const s="grad"+TC.getUID();r={data:{x:"x",columns:[["x"].concat(t.x),["ele"].concat(t.ele)],types:{ele:"area-spline"},colors:{ele:"url(#"+s+")"}},size:a(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(t){var e,r;if((t/=1e3)<1){e=Math.round(1e3*t);r=" m"}else{e=Math.round(100*t)/100;r=" km"}return(e=e.toLocaleString(n))+r}}},y:{padding:{top:0,bottom:0},max:i,min:o,tick:{count:2,format:function(t){return(parseInt(t.toFixed(0))||0).toLocaleString(n)+"m"}}}},onresize:function(){this.api.resize(a())}};t.time&&(r.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));r._onrendered=function(){const t=this.svg[0][0];var r=t.getElementsByTagName("defs")[0],n="http://www.w3.org/2000/svg",i=document.createElementNS(n,"linearGradient");i.setAttributeNS(null,"id",s);i.setAttributeNS(null,"x1","0%");i.setAttributeNS(null,"x2","0%");i.setAttributeNS(null,"y1","0%");i.setAttributeNS(null,"y2","100%");i.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const o=document.createElementNS(n,"stop");o.setAttributeNS(null,"offset","0%");o.setAttributeNS(null,"stop-color","red");o.setAttributeNS(null,"stop-opacity","0.7");i.appendChild(o);const a=document.createElementNS(n,"stop");a.setAttributeNS(null,"offset","50%");a.setAttributeNS(null,"stop-color","orange");a.setAttributeNS(null,"stop-opacity","0.9");i.appendChild(a);const l=document.createElementNS(n,"stop");l.setAttributeNS(null,"offset","100%");l.setAttributeNS(null,"stop-color","green");l.setAttributeNS(null,"stop-opacity","1");i.appendChild(l);r.appendChild(i);const c=d3.select(".c3-brush").node();c&&c.parentNode.removeChild(c);d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(t){d3.event.stopPropagation();const r=e.elevationProfileChartData.coords[t.index].slice(0,2);r&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){e.map.zoomToFeatures([new TC.feature.Point(r,{})])})});var u=d3.select(".c3-axis.c3-axis-x").select("path").attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(u)){u=u.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(u)){u=u.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}}const h=t.getBoundingClientRect(),d={width:h.width,height:h.height};var p=function(){var t=d3.scale.ordinal().rangeRoundBands([0,d.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(t,e){t.each(function(){t.each(function(t,e){if(0!=e){d3text=d3.select(this);if(1===d3text.node().childNodes.length){var r=d3text.select("tspan").node().cloneNode(),n=d3text.text().split(" ");d3text.select("tspan").text(n[0]);r.textContent=n[1];var i=r.getAttribute("dy");i=(i=i?parseFloat(r.getAttribute("dy")):.71)+.18+"em";r.setAttribute("dy",i);d3text.node().appendChild(r)}}})})},t.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p();else{if(e.elevationChartLabelsRAF){window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0}e.elevationChartLabelsRAF=requestAnimationFrame(function t(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())e.elevationChartLabelsRAF=requestAnimationFrame(t);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)e.elevationChartLabelsRAF=requestAnimationFrame(t);else{window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p()}})}if(!e.isMinimized()){e.show("prsidebar-body");e.hide("prcollapsed-max")}e.div.querySelector("."+e.CLASS+"-table").style.display="";e.div.querySelector("."+e.CLASS+"-info").style.display=""}}else r={msg:e.getLocaleString("geo.trk.chart.chpe.empty")};return r};const getTime=function(t,e){var r=e-t,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60;n.h=o+24*i;var a=Math.floor(r/1e3/60);r-=1e3*a*60;n.m=a;n.s=Math.floor(r/1e3);return TC.Util.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(t){const e=this.elevationProfileChartData.coords;var r=t[0].x;r/=1e3;const n=e[t[0].index];var i;4==e[0].length&&e[0][3]>0&&(i=getTime(e[0][3],n[3]));const o=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,a=parseInt(t[0].value.toFixed(0)).toLocaleString(o);var s,l;if(r<1){s=Math.round(1e3*r);l=" m"}else{s=Math.round(100*r)/100;l=" km"}return'<div class="track-elevation-tooltip"><div><span>'+a+" m </span><br><span>"+(s=s.toLocaleString(o))+l+" </span></div>"+(i?"<span>"+i.toString+"</span><div/>":"")};ctlProto.getTableContainer=function(){return this.tableDiv};ctlProto.getInfoContainer=function(){return this.infoDiv};ctlProto.getMenuElement=function(){return this.menuDiv};ctlProto.getContainerElement=function(){return this.div.querySelector(".prsidebar-body")||null};ctlProto.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);e.openOn&&e.map.one(e.openOn,function(t,r){e.content.fnOpen.call(e,t.data)});e.closeOn&&e.map.one(e.closeOn,function(t,r){e.close()});e.options.openOn&&e.map.on(e.options.openOn,function(t,r){e.content.fnOpen.call(e,t.data)});e.options.closeOn&&e.map.on(e.options.closeOn,function(t,r){e.close()});return r};ctlProto.exportToExcel=function(){var t=this,e=[t.tableData.columns];t.tableData.results.forEach(function(t){var r=[];for(var n in t)t.hasOwnProperty(n)&&"Id"!==n&&"Geom"!==n&&r.push(t[n]);e.push(r)});var r=function(r){var n=t.save.fileName?t.save.fileName:"resultados.xls",i=t.options.titles&&t.options.titles.main?t.options.titles.main:null;r.Save(n,e,i)};TC.Util.ExcelExport?r(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/Util.ExcelExport",function(){r(new TC.Util.ExcelExport)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var t=TC.control.ScaleBar.prototype;t.CLASS="tc-ctl-sb";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.ScaleBar(this));this.wrap.render();return this._set1stRenderPromise(Promise.resolve())};t.register=function(t){const e=this;return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),t.wrap.getMap()]).then(function(t){t[1].addControl(e.wrap.ctl);r(e)})})};t.getText=function(){return this.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var t=TC.control.ScaleSelector.prototype;t.CLASS="tc-ctl-ss";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(e.get(["scales"],!1),e,{block:r},{}).w('</select> <input type="button" value="').f(e.get(["screenSize"],!1),e,"h").w("''\" title=\"").h("i18n",e,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}e.__dustBody=!0;function r(t,e){return t.w('<option value="').f(e.getPath(!0,[]),e,"h").w('"').h("eq",e,{block:n},{key:i,value:o}).w(">1:").h("math",e,{},{key:a,method:"round"}).w("</option>\n")}r.__dustBody=!0;function n(t,e){return t.w(' selected="true"')}n.__dustBody=!0;function i(t,e){return t.f(e.getPath(!0,[]),e,"h")}i.__dustBody=!0;function o(t,e){return t.f(e.get(["scale"],!1),e,"h")}o.__dustBody=!0;function a(t,e){return t.f(e.getPath(!0,[]),e,"h")}a.__dustBody=!0;return e};t.render=function(t){var e=this;return e._set1stRenderPromise(new Promise(function(r,n){if(e.map){!e.scales&&e.map.options.resolutions&&(e.scales=e.map.options.resolutions.map(e.getScale,e));var i=function(){e.scales=e.map.wrap.getResolutions().map(e.getScale,e);e.renderData({scale:e.getScale(),screenSize:TC.Cfg.screenSize,scales:e.scales},function(){e.div.querySelectorAll("option").forEach(function(t){t.textContent="1:"+e.format(t.textContent.substr(2))});e.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){e.setScreenSize()});e.div.querySelector("select").addEventListener("change",function(){e.setScale(this.value)});TC.Util.isFunction(t)&&t();r()}).catch(function(t){n(t instanceof Error?t:Error(t))})};e.scales?i():e.map.wrap.getMap().then(i)}else n(Error("ScaleSelector no registrado"))}))};t.setScale=function(t){var e=.0254*t/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(e/=window.devicePixelRatio);this.metersPerDegree&&(e/=this.metersPerDegree);this.map.wrap.setResolution(e);return e}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(t,e,r){var n=this;n.parent=r;n._featureTypes=[];TC.Util.extend(n,e);n.typeName=t;n._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};n.getFeatureTypes=function(t){if(t)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var e=this.featureType instanceof Array?this.featureType:[this.featureType],r=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=e.concat(r)}return this._featureTypes};n.isFeatureOfThisType=function(t){return this.getFeatureTypes().indexOf(t)>-1};n.getStyleByFeatureType=function(t){return this.getFeatureTypes().indexOf(t)>-1?this.styles[this.getFeatureTypes().indexOf(t)]:null};var i=function(t,e,r){var n=function(t,e,r){if(e){if(t.hasOwnProperty(e)&&t[e].hasOwnProperty(r))return t[e][r]}else for(var e in t)if(t[e].hasOwnProperty(r))return t[e][r]};if(r){return n(this.getStyleByFeatureType(r),e,t)}for(var i=0;i<this.styles.length;i++){var o=n(this.styles[i],e,t);if(o)return o}};n.getSuggestionListHead=function(){var t,e,r,n=this;if("function"==typeof n.suggestionListHead){t=n.suggestionListHead();e=t.label;r=[{color:t.color,title:t.label}]}else{t=n.suggestionListHead;e=n.parent.getLocaleString(t.label);if("string"==typeof t.color)r=[{color:i.call(n,t.color),title:e}];else if(t.color instanceof Array){var o=n.getFeatureTypes();t.color.length===o.length?r=t.color.map(function(t,r){return{color:i.call(n,t[o[r]].color.css,t[o[r]].color.geomType,o[r]),title:n.parent.getLocaleString(t[o[r]].title)||e}}):n._throwConfigError()}else"object"==typeof t.color&&(r=[{color:i.call(n,t.color.css,t.color.geomType),title:e}])}if(e&&r){var a='<li header><span class="header">'+e+"</span>";return a+=r.map(function(t){if(t.color)return'<span class="header-color" title="'+t.title+'" style="color: '+t.color+';"></span>'}).join("")+"</li>"}n._throwConfigError()};n.getSuggestionListElements=function(t){var e=this,r=[],n=function(t,e){switch(!0){case"number"==typeof t:if(t===e)return!0;break;case"string"==typeof t:if(isNaN(t)&&isNaN(e)){if(t.trim()===e.trim())return!0}else if(t===e)return!0}return!1},i=function(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e};e.parseFeatures(t).forEach(function(t){var o=[],a=[],s="",l=e.outputProperties,c=e.dataIdProperty,u=e.outputFormatLabel,h=t.id.split(".").slice(0,1).shift();if(!(e.outputProperties instanceof Array)){l=e.outputProperties[h];c=e.dataIdProperty[h];u=u[h]}for(var d=0;d<l.length;d++)o.push(t.data[l[d]]);for(d=0;d<c.length;d++)a.push(t.data[c[d]]);for(var p={},f=0;f<e.outputProperties.length;f++)p[e.outputProperties[f]]=o[f];o instanceof Array&&u&&i(o).length>1?s=u.tcFormat(o):o instanceof Array&&1==i(o).length&&(s=o[0]);var g=s.toCamelCase();(function(t){for(var e=0;e<r.length;e++){var i=0,o=[];for(var a in t){o.push(n(t[a],r[e].properties[a]));i++}if(o.filter(function(t){return t}).length===i)return!0}return!1})(p)||r.push({text:g,label:g,id:a.join("#"),dataRole:e.typeName,dataLayer:h,properties:p})});return r};n.parseFeatures=function(t){return(n.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:n.featurePrefix,featureType:n.featureType})).read(t)};n.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};n.filter=function(t){const e=function(e,r){var n=[];if(r!=t.parent.rootCfg.active.root)if(-1!==r.indexOf("#")||t.parent.rootCfg.active.limit)for(var i=r.split("#"),o=0;o<t.parent.rootCfg.active.dataIdProperty.length;o++){0==o&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(t.filter.getFilterNode(t.parent.rootCfg.active.dataIdProperty[o],i.length>o?i[o]:i[0]));o==t.parent.rootCfg.active.dataIdProperty.length-1&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}else{var a=t.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(e,n){return t.filter.getFilterNode(e,t.parent._LIKE_PATTERN+r+t.parent._LIKE_PATTERN)});if(a.length>1){n.push("<ogc:And>");(n=n.concat(a)).push("</ogc:And>")}else n=n.concat(a)}else{for(var s=0;s<t.parent.rootCfg.active.root.length;s++){i=t.parent.rootCfg.active.root[s];0==s&&t.parent.rootCfg.active.root.length>1&&n.push("<ogc:Or>");for(o=0;o<t.parent.rootCfg.active.dataIdProperty.length;o++){0==o&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(t.filter.getFilterNode(t.parent.rootCfg.active.dataIdProperty[o],i.length>o?i[o]:i[0]));o==t.parent.rootCfg.active.dataIdProperty.length-1&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}}t.parent.rootCfg.active.root.length>1&&n.push("</ogc:Or>")}return e.concat(n)};return{getPropertyValue:function(e,r){return t.getSearchTypeByRole(e)[r]},getIsLikeNode:function(e,r){var n=/([\-\"\.\xba\(\)\/])/g;n.test(r)&&(r=r.replace(n,"\\$1"));return r.toString().indexOf(t.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(e,r){var n=/([\-\"\xba\(\)\/])/g;n.test(r)&&(r=r.replace(n,"\\$1"));if(r.toString().indexOf(t.parent._LIKE_PATTERN)>-1){var i=r;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+e+"</ogc:PropertyName> <ogc:Literal>(?i)"+(i=(i=(i=(i=(i=i.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(e,r){var n,i=t.filter.getIsLikeNode;if(t.filterByMatch){i=t.filter.getFunctionStrMatches;var o=new RegExp("\\"+t.parent._LIKE_PATTERN,"gi");r=r.replace(o,t.parent._MATCH_PATTERN)}if(e instanceof Array||"string"==typeof e){if(e instanceof Array&&e.length>1){n="<ogc:Or>";for(l=0;l<e.length;l++)n+=i(e[l].trim(),r);return n+"</ogc:Or>"}return i(e instanceof Array&&1===e.length?e[0].trim():e.trim(),r)}var a=[];for(var s in e)if(e[s]instanceof Array&&e[s].length>1){n="<Or>";for(var l=0;l<e[s].length;l++)n+=i(e[s][l].trim(),r);n+="</Or>";a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+n+"</Filter>)")}else{var c=e[s];e[s]instanceof Array&&1==e[s].length&&(c=e[s][0]);a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+i(c.trim(),r)+"</Or></Filter>)")}return a.join("")},getFilter:function(r){var n={multiL:!1,f:""};switch(!0){case t.typeName===TC.Consts.searchType.NUMBER:o=[];if(t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}else{(i=/(\<|\>|\<\>)/gi.exec(r.t))?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(r.s))?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}o.push(t.filter.getFilterNode(t.queryProperties.thirdQueryWord,r.p+t.parent._LIKE_PATTERN));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===TC.Consts.searchType.STREET:o=[];if(t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}else{var i;(i=/(\<|\>|\<\>)/gi.exec(r.t))?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(r.s))?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===TC.Consts.searchType.LOCALITY:n.f=t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN);n.multiL=!0;break;case t.queryProperties.hasOwnProperty("secondQueryWord"):var o;(o=[]).push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;default:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN)+"</ogc:Filter>"}return n},getParams:function(e){var r=t.filter.getFilter(e),n={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:t.version,OUTPUTFORMAT:t.outputFormat},i=t.getFeatureTypes(!0);if(i instanceof Array){for(var o=[],a=0;a<i.length;a++)o.push(t.featurePrefix?t.featurePrefix+":"+i[a].trim():i[a].trim());n.TYPENAME=o.join(",")}else n.TYPENAME=t.featurePrefix?t.featurePrefix+":"+i.trim():i.trim();var s=function(t){if(""!==(t||"")){if(t instanceof Array)return t.join(",");var e=[];if(t instanceof Object)for(var r in t){var n=t[r][0];t[r].length>1&&(n=t[r].join(","));e.push(n)}return e}},l=s(t.outputProperties),c=s(t.dataIdProperty);const u=t=>{const e=t.split(",");return e.filter((t,r)=>e.indexOf(t)===r).join(",")};if(l instanceof Array&&c instanceof Array){n.PROPERTYNAME="";for(a=0;a<l.length;a++)n.PROPERTYNAME+="("+u(l[a]+","+c[a])+")"}else n.PROPERTYNAME=u(l+","+c);n.FILTER=r.f;return TC.Util.getParamString(n)},getGoToFilter:function(e){var r=[],n=e.split("#"),i=t.dataIdProperty,o=t.getFeatureTypes();if(i&&o)if(e.indexOf("#")>-1&&o instanceof Array&&o.length>1)for(var a=0;a<o.length;a++)for(var s=0;s<i[o[a]].length;s++)r.push({name:i[o[a]][s],value:n[s]});else if(-1==e.indexOf("#")&&o instanceof Array){var l=i;for(a=0;a<o.length;a++)if(!r.hasOwnProperty(o[a])){l instanceof Object&&i.hasOwnProperty(o[a])&&(l=i[o[a]]);for(s=0;s<l.length;s++)s<n.length&&r.push({name:l[s],value:n[s]})}}else{i instanceof Object&&i.hasOwnProperty(o)&&(i=i[o]);for(a=0;a<i.length;a++)r.push({name:i[a],value:n[a]})}return t.filter.transformFilter(r)},transformFilter:function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(t&&t instanceof Array){var e=t.map(function(t){if(!t.hasOwnProperty("type"))return new TC.filter.equalTo(t.name,t.value);switch(!0){case t.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(t.name,t.value)}});return e.length>1?TC.filter.and.apply(null,e):e[0]}}}}(n)};TC.control.Search=function(){var t=this;TC.Control.apply(t,arguments);t.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";t.url="//idena.navarra.es/ogc/wfs";t.version="1.1.0";t.featurePrefix="IDENA";t.options&&t.options.url&&(t.url=t.options.url);t._LIKE_PATTERN="*";t._MATCH_PATTERN=".*";t.UTMX="X";t.UTMY="Y";t.LON="Lon";t.LAT="Lat";t.UTMX_LABEL="X: ";t.UTMY_LABEL="Y: ";t.LON_LABEL="Lon: ";t.LAT_LABEL="Lat: ";t.MUN="Mun";t.POL="Pol";t.PAR="Par";t.MUN_LABEL="Mun: ";t.POL_LABEL="Pol: ";t.PAR_LABEL="Par: ";t.availableSearchTypes={};t.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:t.getCadastralRef,goTo:t.goToCadastralRef,goToIdFormat:t.MUN+"{0}"+t.POL+"{1}"+t.PAR+"{2}",idPropertiesIdentifier:"#"};t.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:t.getCoordinates,goTo:t.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(e){return{label:t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||t.getLocaleString("search.list.coordinates")}}};t.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:t.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};t.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"TOPONIMO",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"TOPONIMO",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};t.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:t.getRoad,goTo:t.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};t.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0} "+t.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:t.getPK,goTo:t.goToPK,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+t.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};t.rootCfg={};t.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise(function(e,r){if(t.rootCfg.active&&!t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var n={SERVICE:"WFS"};n.VERSION=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;n.REQUEST="GetFeature";n.TYPENAME=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+t.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;n.OUTPUTFORMAT=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;n.PROPERTYNAME=["CMUNICIPIO"].concat(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");n.CQL_FILTER=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(t){return["CMUNICIPIO"].map(function(e,r){return e+"="+t[r]}).join(" AND ")});n.CQL_FILTER=n.CQL_FILTER.join(" OR ");TC.ajax({url:t.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+TC.Util.getParamString(n),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(r){const n=r.data;if(n.totalFeatures>0){t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=n.features.map(function(e){return{id:["CMUNICIPIO"].map(function(t){return e.properties[t]}).join("#"),label:e.properties[t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).catch(function(){e([])})}else e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)})}};t.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise(function(e,r){if(t.rootCfg.active&&!t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var n={SERVICE:"WFS"};n.VERSION=t.rootCfg[TC.Consts.searchType.LOCALITY].version;n.REQUEST="GetFeature";n.TYPENAME=t.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+t.rootCfg[TC.Consts.searchType.LOCALITY].featureType;n.OUTPUTFORMAT=t.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;n.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(t.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");n.CQL_FILTER=t.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(t){return["CMUNICIPIO","CENTIDAD"].map(function(e,r){return e+"="+t[r]}).join(" AND ")});n.CQL_FILTER=n.CQL_FILTER.join(" OR ");TC.ajax({url:t.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+TC.Util.getParamString(n),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(r){const n=r.data;if(n.totalFeatures>0){t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=n.features.map(function(e){return{id:["CMUNICIPIO","CENTIDAD"].map(function(t){return e.properties[t]}).join("#"),label:e.properties[t.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).catch(function(){e([])})}else e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)})}};t.allowedSearchTypes=[];if(t.options.allowedSearchTypes)for(var e in t.options.allowedSearchTypes){if(t.availableSearchTypes[e]&&!TC.Util.isEmptyObject(t.options.allowedSearchTypes[e])){if(t.availableSearchTypes[e].renderFeatureType&&t.availableSearchTypes[e].renderFeatureType.length>0&&t.options.allowedSearchTypes[e].featureType&&!t.options.allowedSearchTypes[e].renderFeatureType){delete t.availableSearchTypes[e].renderFeatureType;t.availableSearchTypes[e].styles=t.availableSearchTypes[e].styles.slice(0,t.availableSearchTypes[e].styles.length-1)}TC.Util.extend(t.availableSearchTypes[e],t.options.allowedSearchTypes[e]);if(t.options.allowedSearchTypes[e].root&&e!=TC.Consts.searchType.MUNICIPALITY&&t.options.allowedSearchTypes[e].rootType==TC.Consts.searchType.MUNICIPALITY||e!=TC.Consts.searchType.LOCALITY&&t.options.allowedSearchTypes[e].rootType==TC.Consts.searchType.LOCALITY){t.rootCfg.active=t.rootCfg[t.options.allowedSearchTypes[e].rootType];t.rootCfg.active.root=t.options.allowedSearchTypes[e].root;t.rootCfg.active.limit=t.options.allowedSearchTypes[e].limit;t.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=t.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=t.rootCfg.active.dataIdProperty}}t.options.allowedSearchTypes[e]?t.addAllowedSearchType(e,t.availableSearchTypes[e]?t.availableSearchTypes[e]:t.options.allowedSearchTypes[e],t):delete t.options.allowedSearchTypes[e]}t.rootCfg.active&&t.rootCfg.active.getRootLabel();t.queryableFeatures=t.options.queryableFeatures||!1;t.UTMX_LEN=6;t.UTMY_LEN=7;t.wrap=new TC.wrap.control.Search(t);t.interval=500;t.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var t=TC.control.Search.prototype;t.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",e,{},{$key:"search.placeholder"}).w('" title="').h("i18n",e,{},{$key:"search.instructions"}).w('" /><button title="').h("i18n",e,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",e,{},{$key:"search.2"}).w('</button><ul class="tc-ctl-search-list tc-hidden"></ul></div>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e._search={data:[]};e.layerStyleFN=function(){function t(t){return t.indexOf(".")>-1?t.split(".")[0]:t}function r(r,n,i){var o=e.getSearchTypeByFeature(i);if(o){var a=o.getStyleByFeatureType(t(i));if(a&&a.hasOwnProperty(n))return a[n][r]}return TC.Cfg.styles[n][r]}return function(e,n,i,o){!TC.Feature||o instanceof TC.Feature||this.map.trigger(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:o.geom});var a=r(n,e,t(o.id));if(i){if(a instanceof Array){var s=a.map(function(t){return o.getData().hasOwnProperty(t)?o.getData()[t]:""}),l=this.getSearchTypeByFeature(t(o.id));return l?l.outputFormatLabel.tcFormat(s):s.join(" ")}return o.getData().hasOwnProperty(a)?o.getData()[a]:""}return a}}();var n=e.layerStyleFN;e.layerPromise=t.addLayer({id:e.getUID(),title:"B\xfasquedas",owner:e,stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:n.bind(e,"polygon","fillColor",!1),fillOpacity:n.bind(e,"polygon","fillOpacity",!1),strokeColor:n.bind(e,"polygon","strokeColor",!1),strokeOpacity:n.bind(e,"polygon","strokeOpacity",!1),strokeWidth:n.bind(e,"polygon","strokeWidth",!1)},line:{strokeColor:n.bind(e,"line","strokeColor",!1),strokeOpacity:n.bind(e,"line","strokeOpacity",!1),strokeWidth:n.bind(e,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:n.bind(e,"point","radius",!1),height:n.bind(e,"point","height",!1),width:n.bind(e,"point","width",!1),fillColor:n.bind(e,"point","fillColor",!1),fillOpacity:n.bind(e,"point","fillOpacity",!1),strokeColor:n.bind(e,"point","strokeColor",!1),strokeWidth:n.bind(e,"point","strokeWidth",!1),fontSize:n.bind(e,"point","fontSize",!1),fontColor:n.bind(e,"point","fontColor",!1),labelOutlineColor:n.bind(e,"point","labelOutlineColor",!1),labelOutlineWidth:n.bind(e,"point","labelOutlineWidth",!1),label:n.bind(e,"point","label",!0),angle:n.bind(e,"point","angle",!0)}}}).then(function(t){e.layer=t;return t});e.EMPTY_RESULTS_LABEL=e.getLocaleString("noResults");e.EMPTY_RESULTS_TITLE=e.getLocaleString("checkCriterion");e.OUTBBX_LABEL=e.getLocaleString("outsideOfLimits");e.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"];return r};const e=function(t){const e=this;t.label;var r=[];0===e.lastPattern.trim().length&&e.textInput.value.trim().length>0&&(e.lastPattern=e.textInput.value.trim());var n=e.lastPattern,i=[],o=",";-1==(n=e.NORMAL_PATTERNS.ROMAN_NUMBER.test(n)?n.replace(e.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):n.replace(e.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(o)&&(o=" ");i=n.trim().split(o);if(t.label.indexOf(e.LAT_LABEL)>-1&&t.label.indexOf(e.LON_LABEL)>-1||t.label.indexOf(e.UTMX_LABEL)>-1&&t.label.indexOf(e.UTMY_LABEL)>-1){i=e.lastPattern.split(" ");for(var a=0;a<i.length;a++)","==i[a].trim().slice(-1)&&(i[a]=i[a].slice(0,-1))}for(var s=0;s<i.length;s++)if(i[s].trim().length>0){r.push("("+i[s].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(u=/((\<)|(\>)|(\<\>))/gi.exec(i[s].trim()))for(var l=i[s].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),c=0;c<l.length;c++)l[c].trim().length>0&&r.push("("+l[c].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(t.dataRole==TC.Consts.searchType.ROAD||t.dataRole==TC.Consts.searchType.ROADPK){var u;if(u=e.getSearchTypeByRole(t.dataRole).getPattern().exec(e.lastPattern)){r=[];u[2]&&u[3]&&u[4]?r.push("("+u[2]+"-"+u[3]+"-"+u[4]+")"):u[2]&&u[3]?r.push("("+u[2]+"-"+u[3]+")"):u[3]&&u[4]?r.push("("+u[3]+"-"+u[4]+")"):(u[2]||u[3])&&r.push("("+(u[2]||u[3])+")");u[5]&&r.push("(?:"+e.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}else u&&u[5]&&(r=[]).push("(?:"+e.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}var h="("+r.join("|")+")";h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=h.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var d=new RegExp(h,"gi"),p=t.label;return t.dataRole!==TC.Consts.searchType.ROAD||t.dataRole!==TC.Consts.searchType.ROADPK?p.replace(d,function(){var t=Array.prototype.slice.call(arguments,0);return t[t.length-3]?t[0].replace(t[t.length-3],"<b>"+t[t.length-3]+"</b>"):"<b>"+t[0]+"</b>"}):p.replace(d,"<b>$1</b>")},r=function(t){const e=this;var r=t.target;if("a"!==r.tagName.toLowerCase()){let e=t.target;const n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;for(;e;){if(n.call(e,"a")){r=e;break}e=e.parentElement}}if(r.querySelector("span[hidden]")){e.textInput.value=r.querySelector("span[hidden]").textContent;e.lastPattern=e.textInput.value;e._goToResult(unescape(r.getAttribute("href")).substring(1),r.parentNode.getAttribute("dataRole"));TC.UI.autocomplete.call(e.textInput,"clear")}},n=function(t,e){const r=/[^a-zA-Z]/g,n=/[^0-9]/g;var i=parseInt(t,10),o=parseInt(e,10);if(isNaN(i)&&isNaN(o)){var a=t.replace(r,""),s=e.replace(r,"");if(a===s){var l=parseInt(t.replace(n,""),10),c=parseInt(e.replace(n,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return isNaN(i)?1:isNaN(o)?-1:i>o?1:-1},i=function(t){const r=this;var i=[],o=[],a=t.results.sort(function(t,e){const r=this;return r.getSearchTypeByRole(t.dataRole).searchWeight&&r.getSearchTypeByRole(e.dataRole).searchWeight?(r.getSearchTypeByRole(t.dataRole).searchWeight||0)>(r.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(r.getSearchTypeByRole(t.dataRole).searchWeight||0)<(r.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:n(t.label,e.label):t.dataRole>e.dataRole?1:t.dataRole<e.dataRole?-1:n(t.label,e.label)}.bind(r));r.rootCfg.active&&(a=a.sort(function(t,e){const r=this,i=function(){var i,o,a=r.rootCfg.active.root[0]instanceof Array?r.rootCfg.active.root[0].join("-"):r.rootCfg.active.root[0];if(t.properties&&t.properties.length>0&&e.properties&&e.properties.length>0){i=r.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-");o=r.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-")}else{i=t.id;o=e.id}return i!==a&&o===a?1:i===a&&o!==a?-1:n(t.label,e.label)}.bind(this);return r.getSearchTypeByRole(t.dataRole).searchWeight&&r.getSearchTypeByRole(e.dataRole).searchWeight?(r.getSearchTypeByRole(t.dataRole).searchWeight||0)>(r.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(r.getSearchTypeByRole(t.dataRole).searchWeight||0)<(r.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:i():i()}.bind(r)));for(var s=0;s<a.length;s++){var l=a[s];if(-1==o.indexOf(l.dataRole)){i[i.length]=r.getSearchTypeByRole(l.dataRole).getSuggestionListHead();o.push(l.dataRole)}i[i.length]='<li dataRole="'+l.dataRole+'"><a href="#'+encodeURIComponent(l.id)+'"><span hidden>'+l.label+"</span>"+e.call(r,l)+"</a></li>"}Array.prototype.map.call(r.resultsList.querySelectorAll("li[dataRole]"),t=>t.getAttribute("dataRole")).filter((t,e,r)=>r.indexOf(t)===e&&!o.includes(t)).forEach(t=>{i[i.length]=r.getSearchTypeByRole(t).getSuggestionListHead();i[i.length]='<li dataRole="'+t+'"><a class="tc-ctl-search-li-loading" href="#">'+r.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>'});return i.join("")};t.renderData=function(t,e){var n=this;n._search=n._search||{};var o=function(){n.search(n.textInput.value,function(t){if(1===t.length){n.textInput.value=t[0].label;n._goToResult(t[0].id,n.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));n.resultsList.classList.add(TC.Consts.classes.HIDDEN)}else 0===t.length&&n.resultsList.classList.add(TC.Consts.classes.HIDDEN)})};return TC.Control.prototype.renderData.call(n,t,function(){var t=function(){n.textInput.value=n.resultsList.label||n.resultsList.querySelector("li:not([header]) > a > span").textContent;n.lastPattern=n.textInput.value;n._goToResult(n.resultsList.id||unescape(n.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),n.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));n.resultsList.classList.add(TC.Consts.classes.HIDDEN)};n.textInput=n.div.querySelector("input.tc-ctl-search-txt");n.options&&n.options.placeHolder&&n.textInput.setAttribute("placeHolder",n.options.placeHolder.trim());n.resultsList=n.div.querySelector(".tc-ctl-search-list");n.button=n.div.querySelector(".tc-ctl-search-btn");n.button.addEventListener(TC.Consts.event.CLICK,function(){n.getLayer().then(function(e){n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(e.features.length>0?e.map.zoomToFeatures(e.features):1===n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?t():n.textInput.dispatchEvent(new Event("keyup")))})});if(n.options.instructions){n.textInput.setAttribute("title",n.options.instructions.trim());n.button.setAttribute("title",n.options.instructions.trim())}n.resultsList.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("a.tc-ctl-search-li-empty",function(){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.textInput.focus()}));n.textInput.addEventListener("keypress",function(e){if(13==e.which){e.preventDefault();e.stopPropagation();n.lastPattern="";1===n.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?t():o();return!1}});n.textInput.addEventListener("search",function(){if(0===n.textInput.value.length){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);o()}});n.textInput.addEventListener("input",function(){if(0===n.textInput.value.length){n.resultsList.classList.add(TC.Consts.classes.HIDDEN);o()}});n.textInput.addEventListener("targetCleared.autocomplete",function(){n.resultsList.classList.add(TC.Consts.classes.HIDDEN)});n.textInput.addEventListener("targetUpdated.autocomplete",function(){n.resultsList.querySelectorAll("li").length>0&&n.resultsList.classList.remove(TC.Consts.classes.HIDDEN)});n.lastPattern="";n.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){var t;TC.UI.autocomplete.call(n.textInput,{link:"#",target:n.resultsList,minLength:2,ctx:n,source:function(e,r){n.lastpress=performance.now();t||(t=requestAnimationFrame(function e(){var i=n.textInput.value.trim();if(i.length>0&&(!n.lastPattern||i!=n.lastPattern)&&performance.now()-n.lastpress>n.interval){window.cancelAnimationFrame(t);t=void 0;n.resultsList.classList.add(TC.Consts.classes.HIDDEN);n.lastPattern=i;n.search(i,r)}else t=requestAnimationFrame(e)}))},callback:r.bind(n),buildHTML:i.bind(n)});const e=function(t){if(!t.ctrlKey&&!t.altKey&&!t.shiftKey)if(40===t.keyCode){n.textInput==document.activeElement&&n.resultsList.querySelector("li:not([header]) a")?n.resultsList.querySelector("li:not([header]) a").focus():n.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?n.textInput.focus():function(t,e){var r=t.nextElementSibling;if(!e)return r;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();t.preventDefault();t.stopPropagation()}else if(38===t.keyCode){n.textInput==document.activeElement?n.resultsList.querySelector("li:not([header]):last-child a").focus():document.activeElement==n.resultsList.querySelector("li:not([header]) a")?n.resultsList.querySelector("li:not([header]):last-child a").focus():function(t,e){var r=t.previousElementSibling;if(!e)return r;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();t.preventDefault();t.stopPropagation()}t.stopPropagation()};n.textInput.addEventListener("keydown",e);n.resultsList.addEventListener("keydown",e)});TC.Util.isFunction(e)&&e()})};t.addAllowedSearchType=function(t,e){this.allowedSearchTypes.push(new SearchType(t,e,this))};t.getSearchTypeByRole=function(t){return this.allowedSearchTypes.filter(function(e){return e.typeName==t})[0]};t.getSearchTypeByFeature=function(t){var e=this.allowedSearchTypes.filter(function(e){return e.isFeatureOfThisType(t)});return e.length>0?e[0]:null};t.getElementOnSuggestionList=function(t,e){const r=this;for(var n=0;n<r.searchRequestsResults.length;n++)if(r.searchRequestsResults[n].id==t&&(!e||e&&r.searchRequestsResults[n].dataRole===e))return r.searchRequestsResults[n]};t.getLayer=function(){return this.layerPromise};t.getFeatures=function(){return this.layer.features};t.cleanMap=function(){const t=this;if(t.layer){const n=t.layer;var e=n.features.slice();n.clearFeatures();t.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:n,feature:e});for(var r=0;r<t.WFS_TYPE_ATTRS.length;r++)n.hasOwnProperty(t.WFS_TYPE_ATTRS[r])&&delete n[t.WFS_TYPE_ATTRS[r]]}};t.getMunicipalities=function(){var t=this;TC.cache.search=TC.cache.search||{};t._municipalitiesPromise=new Promise(function(e,r){if(TC.cache.search.municipalities)e(TC.cache.search.municipalities);else{var n=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(n.municipality&&n.municipality.featureType&&n.municipality.labelProperty&&n.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+n.typeName+". Error en el objeto municipality");var i={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:n.municipality.featureType,VERSION:n.version,PROPERTYNAME:n.municipality.labelProperty+","+n.municipality.idProperty,OUTPUTFORMAT:n.outputFormat};n.featurePrefix&&(i.TYPENAME=n.featurePrefix+":"+i.TYPENAME);var o=n.url+"?"+TC.Util.getParamString(i);TC.ajax({url:o,method:"GET",responseType:"text"}).then(function(t){const r=t.data;var i=(n.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:n.municipality.featurePrefix,featureType:n.municipality.featureType})).read(r);TC.cache.search.municipalities=[];for(var o=0;o<i.length;o++){var a=i[o];TC.cache.search.municipalities.push({label:a.data[n.municipality.labelProperty],id:a.data[n.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(t,e){return t.label<e.label?-1:t.label>e.label?1:0});e(TC.cache.search.municipalities)}).catch(function(){e()})}});return t._municipalitiesPromise};t.getCoordinates=function(t){const e=this;return new Promise(function(r,n){var i=t.match(new RegExp("^"+e.UTMX_LABEL.trim().toLowerCase()+"*\\s*([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+e.UTMY_LABEL.trim().toLowerCase()+"*\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$"));i&&(t=i[1]+" "+i[2]);(i=t.match(new RegExp("^"+e.LAT_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+e.LON_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=i[1]+" "+i[3]);if(/\d/.test(t)&&(new RegExp("^([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(t)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(t))){if((i=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(t))&&(i[1].indexOf(",")>-1||i[3].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[3]=i[3].replace(",",".");t=i[1]+" "+i[3]}if(!i||i&&(i[1].indexOf(",")>-1?i[1].replace(",","."):i[1])<=180&&(i[3].indexOf(",")>-1?i[3].replace(",","."):i[3])<=90){if((i=new RegExp("^([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(t))&&(i[1].indexOf(",")>-1||i[2].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[2]=i[2].replace(",",".");t=i[1]+" "+i[2]}t=t.replace(e.UTMX_LABEL,"").replace(e.UTMY_LABEL,"").replace(e.LON_LABEL,"").replace(e.LAT_LABEL,"");var o=TC.Util.parseCoords(t);if(o){var a=o[0].value,s=o[1].value,l=o[0].type===TC.Consts.UTM?e.UTMX:e.LAT,c=o[1].type===TC.Consts.UTM?e.UTMY:e.LON,u=l+a+c+s,h=e.getPoint(u);if(h&&!e.insideLimit(h)){a=o[1].value;s=o[0].value;u=(l=o[1].type===TC.Consts.UTM?e.UTMX:e.LAT)+a+(c=o[0].type===TC.Consts.UTM?e.UTMY:e.LON)+s;h=e.getPoint(u)}if(h){e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(u)?e.getLocaleString("search.list.coordinates.utm")+e.map.crs:e.getLocaleString("search.list.coordinates.geo");r([{id:u,label:e.getLabel(u),dataRole:TC.Consts.searchType.COORDINATES}])}else n()}else n()}else n()}else n()})};t.getCadastralRef=function(t){const e=this;return new Promise(function(r,n){var i=t.match(new RegExp(e.MUN_LABEL.trim().toLowerCase()+"?\\s(.*)\\,\\s?"+e.POL_LABEL.trim().toLowerCase()+"?\\s(\\d{1,2})\\,\\s?"+e.PAR_LABEL.trim().toLowerCase()+"?\\s(\\d{1,4})"));i&&(t=i[1]+", "+i[2]+", "+i[3]);var o=t;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(t)&&e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(o=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+t);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(o)&&!new RegExp("^([0-9]{"+e.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+e.UTMY_LEN+"})$").test(t)?e.getMunicipalities().then(function(t){var n=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(o);if(n){var i=new RegExp(n[1].trim().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),a=[];const o=function(t,r,n,i){var o=[];o.push[e.MUN]=t;o.push[e.POL]=n;o.push[e.PAR]=i;return{id:e.MUN+t+e.POL+n+e.PAR+i,label:e.getLabel(e.MUN+r+e.POL+n+e.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL,properties:o}};if((a=t.filter(function(t){t=t.label||t.id||t;return i.test(t)||i.test(e.removePunctuation(t))})).length>0)for(var s=0;s<a.length;s++)a[s]=o(a[s].id,a[s].label,n[2].trim(),n[3].trim());if(/^[0-9]*$/g.test(n[1])){if(n[1].trim()===e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var l=t.filter(function(t){return parseInt(t.id)===parseInt(e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];l&&r([o(l.id,l.label,n[2].trim(),n[3].trim())])}a.push(o(n[1].trim(),n[1].trim(),n[2].trim(),n[3].trim()))}r(a)}}):n()})};t.stringPatternsValidators={tsp:function(t,e,r,n){var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(i&&i[1]&&i[2]){var s=function(){return o((i[3]||i[4]||i[5]||i[6]).trim())};if(/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim())){e.push({t:i[1].trim(),s:i[2].trim(),p:s()});e.push({t:i[2].trim(),s:i[1].trim(),p:s()})}else/^([^0-9]+)$/i.test(i[1].trim())?e.push({t:i[1].trim(),s:i[2].trim(),p:s()}):e.push({s:i[1].trim(),t:i[2].trim(),p:s()});a.call(this,e,r,n);return!0}return!1},spt:function(t,e,r,n){var i=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(i&&i[6]&&i[1]){var s=function(){return o((i[2]||i[3]||i[4]||i[5]).trim())};if(/^([^0-9]+)$/i.test(i[6].trim())&&/^([^0-9]+)$/i.test(i[1].trim())){e.push({t:i[6].trim(),s:i[1].trim(),p:s()});e.push({t:i[1].trim(),s:i[6].trim(),p:s()})}else/^([^0-9]+)$/i.test(i[6].trim())?e.push({t:i[6].trim(),s:i[1].trim(),p:s()}):e.push({s:i[6].trim(),t:i[1].trim(),p:s()});a.call(this,e,r,n);return!0}return!1},tnsp:function(t,e,r,n){var i=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(i&&i[1]&&i[2]){e.push({t:i[2].trim(),s:i[1].trim(),p:o((i[3]||i[4]||i[5]||i[6]).trim())});a.call(this,e,r,n);return!0}return!1},ts:function(t,e,r,n){var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(t);if(!i&&/^[^0-9]*$/i.test(t.trim())){var o=t.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(o.join(","))}if(i&&i[1]&&i[2]){if(/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim())){e.push({t:i[1].trim(),s:i[2].trim()});e.push({s:i[1].trim(),t:i[2].trim()});a.call(this,e,r,n)}else{var s=function(t){for(var e=t.split(" ").reverse(),r=[],n=0;n<e.length;n++)if(1==e[n].length){r.push(e[n]);e[n]=""}return r.length>0?e.reverse().join(" ").trim()+self._LIKE_PATTERN+r.reverse().join(self._LIKE_PATTERN):e.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(i[1].trim())?e.push({t:i[1].trim(),s:s(i[2].trim())}):e.push({s:s(i[1].trim()),t:i[2].trim()});a.call(this,e,r,n,!0)}return!0}return!1},st:function(t,e,r,n){var i=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(!i){var s=t.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(s.join(","))}if(i){for(var l={},c=(s=t.split(",").reverse(),0);c<s.length;c++)if(/^([^0-9\,]+)$/i.test(s[c].trim()))l.t=s[c].trim();else if(/(\s*\d+)/i.test(s[c].trim()))if(-1==s[c].trim().indexOf(" "))l.s=s[c].trim();else{for(var u=s[c].trim().split(" ").reverse(),h=function(t){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t.trim())){l.p=o(t.trim());return!0}return!1},d=0,p=u[d].trim();d<u.length&&!h(p);)++d<u.length&&(p+=u[d]);if(l.p){for(var f=u,g=0;g<f.length;g++){for(var y=!1,m=0;m<f[g].split("").length;m++)l.p.indexOf(f[g][m])>-1&&(y=!0);if(y){f[g];f[g]="";if(l.p==o(p))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(u.reverse().join(" ").trim())){for(var C=[],v=u.reverse(),T=0;T<v.length;T++)if(1==v[T].trim().length){C.push(v[T].trim());v[T]=""}l.s=C.length>0?v.reverse().join(" ").trim()+self._LIKE_PATTERN+C.reverse().join(self._LIKE_PATTERN):v.reverse().join(" ").trim()}e.push({t:l.t,s:l.s+" "+l.p})}else l.s=s[c].trim()}e.push(l);a.call(this,e,r,n);return!0}return!1},s_or_t:function(t,e,r,n){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(t);if(i&&i[1]){if(r){e.push({t:i[1].trim()});e.push({t:r,s:i[1].trim()})}else e.push({t:i[1].trim()});return!0}return!1},sp:function(t,e,r,n){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(i&&i[1]&&i[2]){r?e.push({t:r,s:i[1].trim(),p:o(i[2].trim())}):e.push({t:i[1].trim(),s:i[2].trim()});return!0}return!1},snp:function(t,e,r,n){var i=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);if(i&&i[1]&&i[2]&&r){e.push({t:r,s:i[1].trim(),p:o(i[2].trim())});return!0}return!1}};const o=function(t){for(var e=[function(t){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(t)},function(t){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(t)},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.test(t)},function(t){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(t)}],r=[function(t){var e=[],r=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(t);if(r){for(var n=1;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e.join(self._LIKE_PATTERN)}return t},function(t){var e=[],r=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(t);if(r){for(var n=1;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e.join(self._LIKE_PATTERN)}return t},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(t)?"s*n":t},function(t){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);return t}],n=0;n<r.length&&!e[n].call(self,t);)n++;return n<r.length?r[n].call(self,t):t},a=function(t,e,r,n){const i=this;if(e)for(var o=t.length;o--;)if(n)t.push(TC.Util.extend({},t[o],{t:e}));else if(t[o].t){var a=i.rootCfg.active.rootLabel.filter(function(e){return e.label.indexOf(i.removePunctuation(t[o].t).toLowerCase())>-1}.bind(i));1==a.length?t[o].t=a[0].id:a.length>1?a.map(function(e){var r=TC.Util.extend({},t[o]);r.t=e.id;t.push(r)}):0==a.length&&r&&t.splice(o,1)}},s=function(t,e){const r=this,n=r.rootCfg.active&&r.rootCfg.active.root||"",i=r.rootCfg.active&&r.rootCfg.active.limit||!1;var o=[];","==(e=e.trim()).charAt(e.length-1)&&(e=e.substring(0,e.length-1));if(function(){for(var t=[function(t){return t.length>=3},function(t){return!/^\d+$/.test(t)&&!/^\d+\,\s*\d+$/.test(t)}],n=0;n<t.length;n++)if(!t[n].call(r,e))return!1;return!0}()){var a=[];if(0===(a=t.map(function(t){return r.getSearchTypeByRole(t)}).filter(function(t){return t.stringPatternToCheck}).map(function(t){return t.stringPatternToCheck})).length){a=[r.stringPatternsValidators.tsp,r.stringPatternsValidators.spt,r.stringPatternsValidators.tnsp,r.stringPatternsValidators.ts,r.stringPatternsValidators.st];a=n&&e.split(",").length<3?[r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t].concat(a):a.concat([r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t])}var s=0;try{for(;s<a.length&&!a[s].call(r,e,o,n,i);)s++}catch(t){TC.error("Error seg\xfan el patr\xf3n: "+e,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return o}return null},l=function(t,e,r,n){return fetch(t.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:t.filter.getParams(n),signal:e}).then(function(t){if(t.ok)return t.text();throw"Search: error requestToWFS"}).then(r).catch(function(t){"AbortError"===t.name?console.log("Search: petici\xf3n abortada"):TC.error(t);throw t})};t.getStringPattern=function(t,e){const r=this;return new Promise((n,i)=>{let o=[],a=[];e=function(t){t=this.removePunctuation(t);return(t=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(r,e);console.log("getStringPattern sartzen da: "+e);let c=/(.*)\((.*)\)/.exec(e);if(c&&c.length>2){o=s.call(r,t,c[1])||[];let e=s.call(r,t,c[1]+","+c[2])||[];o=o.concat(e)}else o=s.call(r,t,e)||[];if(o.length>0){let e=[],s=e=>t.filter(function(t){return Object.keys(r.getSearchTypeByRole(t).queryProperties).length===Object.keys(e).length}),c=[];for(var u=0;u<o.length;u++){let t=o[u],n=s(t);for(var h=0;h<n.length;h++){let i=r.getSearchTypeByRole(n[h]);if(c.indexOf(i.typeName)<0){e.push(i.getSuggestionListHead());e.push('<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+r.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');c.push(i.typeName)}let o=t=>i.getSuggestionListElements(t);a.push(l.call(r,i,r.searchRequestsAbortController.signal,o,t))}}if(a.length>0){r.resultsList.innerHTML+=e.join("");r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));Promise.all(a).then(t=>{console.log("denei espiatzen duben promesan sartzen da");n([].concat.apply([],t))}).catch(t=>{console.log("denei espiatzen duben promesan catchien sartzen da");i()})}else i()}else i()})};t.getRoad=function(t){const e=this;return new Promise(function(r,n){if((t=t.trim()).length<2)r([]);else{var i=e.getSearchTypeByRole(TC.Consts.searchType.ROAD),o=i.getPattern().exec(t);if(o&&o[3]){var a=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(a=a+"-"+o[4].trim());e.resultsList.innerHTML=i.getSuggestionListHead()+'<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));console.log("getRoad new");fetch(i.url+"?"+i.filter.getParams({t:a}),{signal:e.searchRequestsAbortController.signal}).then(t=>{if(t.ok)return t.json();throw"Search: error getRoad"}).then(t=>{let e=[];if(t.totalFeatures>0){t.features.map(function(t){var r=i.outputProperties;if(!e.some(function(e){return e.text==t.properties[r[0]]})){var n=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(e){return t.properties[e]})),o=i.outputProperties.map(function(e){return t.properties[e]}).join("-");e.push({id:i.dataIdProperty.map(function(e){return t.properties[e]}).join("#"),label:n,text:o,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}});r(e)}else n()}).catch(function(t){n()})}else n()}})};t.getPK=function(t){var e=this;return new Promise(function(r,n){if((t=t.trim()).length<3)r([]);else{var i=e.getSearchTypeByRole(TC.Consts.searchType.ROADPK),o=i.getPattern().exec(t);if(o&&o[3]&&o[5]){var a=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(a=a+"-"+o[4].trim());e.resultsList.innerHTML=i.getSuggestionListHead()+'<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));console.log("getRoadPK new");fetch(i.url+"?"+i.filter.getParams({t:a,s:o[5].trim()}),{signal:e.searchRequestsAbortController.signal}).then(t=>{if(t.ok)return t.json();throw"Search: error getRoadPK"}).then(function(t){let e=[];if(t.totalFeatures>0){t.features.map(function(t){var r=i.outputProperties;if(!e.some(function(e){return e.label==t.properties[r[0]]})){var n=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(e){return t.properties[e]}));e.push({id:i.dataIdProperty.map(function(e){return t.properties[e]}).join("#"),label:n,text:n,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}});r(e)}else n()}).catch(function(t){n()})}else n()}})};t.search=function(t,e){var r=this;if((t=t.trim()).length>0){t=t.toLowerCase();console.log("hasten ga: "+t);r.searchRequestsAbortController&&r.searchRequestsAbortController.abort();r.resultsList.innerHTML="";r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));r.searchRequestsResults=[];let n=!1,i=()=>{console.log("bertan behera uzten du: "+t);n=!0;r.searchRequestsAbortController.signal.removeEventListener("abort",i)};r.searchRequestsAbortController=new AbortController;r.searchRequestsAbortController.signal.addEventListener("abort",i);let o=0,a=()=>{if(0===--o){if(t!==r.textInput.value.trim().toLowerCase())return;if(0===r.searchRequestsResults.length){r.cleanMap();if(!r.layer||r.layer&&0===r.layer.features.length){r.resultsList.innerHTML='<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>";r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"))}}r.lastPattern=""}},s=()=>{if(r.searchRequestsResults){r.searchRequestsResults=r.searchRequestsResults.sort(function(t,e){var r,n=/(\d+)/,i="";if(n.test(t.label)&&n.test(e.label)){r=t.label.match(n)[1];i=e.label.match(n)[1]}else{r=t.label;i=e.label}return r>i?1:r<i?-1:0});r._search.data=r.searchRequestsResults;e&&e(r.searchRequestsResults)}};r.allowedSearchTypes.forEach(function(e){if(e.parser){o++;console.log("registramos promesa: "+e.typeName);e.parser.call(r,t).then(function(t,e){let n=()=>{let e=r.resultsList.querySelector('li[dataRole="'+t+'"]');if(e){let t=Array.prototype.indexOf.call(e.parentElement.childNodes,e),n=r.resultsList.childNodes[t-1];r.resultsList.removeChild(n);r.resultsList.removeChild(e)}};console.log("resulta promesa: "+t);if(e&&e.length>0){let t=e.filter((t,e)=>-1===r.searchRequestsResults.findIndex(e=>e.id===t.id));if(t.length===e.length){r.searchRequestsResults=r.searchRequestsResults.concat(t);s()}else 1===e.length&&n()}else n();a()}.bind(r,e.typeName)).catch(function(t){console.log("reject promesa: "+t);a()}.bind(r,e.typeName))}else console.log("Falta implementaci\xf3n del m\xe9todo parser")})}else{r.lastPattern="";r.cleanMap()}};t._goToResult=function(t,e){var r=this,n=null;r.searchRequestsAbortController&&r.searchRequestsAbortController.abort();return new Promise(function(i,o){r.loading||(r.loading=r.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var a;a=r.loading.addWait();if(matchMedia("(max-width: 30em)").matches){r.textInput.blur();r.map.trigger(TC.Consts.event.TOOLSCLOSE)}r.cleanMap();var s=!1,l=!0;r.allowedSearchTypes.forEach(function(i){if(l)if(r.availableSearchTypes[i.typeName]){var o=e||r.getElementOnSuggestionList.call(r,t).dataRole;if(o){var a=r.getSearchTypeByRole(o);if(r.availableSearchTypes[o]&&a&&a.goTo)null!==(n=a.goTo.call(r,t,o))&&(l=!1);else if(!r.availableSearchTypes[o]&&a&&a.goTo){s=!0;null!==(n=a.goTo.call(r,t,o))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(i.goTo){s=!0;null!==(n=i.goTo.call(r,t))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});r.loading.removeWait(a);if(n){r.getLayer().then(function(t){switch(!0){case n.params.type==TC.Consts.layerType.VECTOR:for(var e=0;e<r.WFS_TYPE_ATTRS.length;e++)t.hasOwnProperty(r.WFS_TYPE_ATTRS[e])&&delete t[r.WFS_TYPE_ATTRS[e]];break;case n.params.type==TC.Consts.layerType.WFS:for(e=0;e<r.WFS_TYPE_ATTRS.length;e++)t[r.WFS_TYPE_ATTRS[e]]=n.params[r.WFS_TYPE_ATTRS[e]];a=r.loading.addWait()}t.type=n.params.type;r.map.on(TC.Consts.event.FEATURESADD,function(t){t.layer===r.layer&&function(t){if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].showsPopup!=this.queryableFeatures&&(t[e].showsPopup=this.queryableFeatures)}.call(r,t.features)});r.map.one(TC.Consts.event.LAYERUPDATE,function(e){if(e.layer==t){r.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==t){if(!e.layer.features||0==e.layer.features.length&&e.layer.wrap.layer.getSource().getFeatures()){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);var i=e.layer.wrap.layer.getSource().getExtent(),o=e.layer.map.options.pointBoundsRadius;if(i[2]-i[0]==0){i[0]=i[0]-o;i[2]=i[2]+o}if(i[3]-i[1]==0){i[1]=i[1]-o;i[3]=i[3]+o}e.layer.map.setExtent(i);r.map.trigger(TC.Consts.event.ZOOMTO,{extent:i,layer:e.layer})}else if(e.layer.features&&e.layer.features.length>0){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.layer.map.zoomToFeatures(e.layer.features);r.map.trigger(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features})}else if(e.layer.features&&0==e.layer.features.length&&n.params.type==TC.Consts.layerType.WFS){r.resultsList.inner=n.emptyResultHTML;r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}r.loading.removeWait(a)}});if(e.layer.features&&e.layer.features.length>0){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.layer.map.zoomToFeatures(r.layer.features);r.map.trigger(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features});r.loading.removeWait(a)}else if(e.layer.features&&0==e.layer.features.length&&n.params.type==TC.Consts.layerType.WFS){r.resultsList.innerHTML=n.emptyResultHTML;r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));e.newData&&e.newData.features&&e.newData.features.length>0||r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);r.loading.removeWait(a)}}});t.refresh()});i(n)}else{o(Error("Method goTo has no implementation"));s||r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}})};t.goToResult=function(t,e){if(this.getSearchTypeByRole(e))return this._goToResult(t,e);if(this.availableSearchTypes[e]){this.addAllowedSearchType(e,this.availableSearchTypes[e],this);return this._goToResult(t,e)}alert("No se reconoce el tipo de b\xfasqueda: "+e)};t.goToCoordinates=function(t){var e={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(t)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(t)){e.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};e.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(t){var e=this;wait=e.loading.addWait();var r,n,i=e.getPoint(t);if(i){r=e.getLabel(t);n=e.layer.addMarker(i,TC.Util.extend({},e.map.options.styles.point,{title:r,group:r}))}else{var o=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(t);t=e.LAT+o[2]+e.LON+o[1];if(i=e.getPoint(t)){r=e.getLabel(t);n=e.layer.addMarker(i,TC.Util.extend({},e.map.options.styles.point,{title:r,group:r}));e.textInput.value=r}}n.then(function(t){e.map.trigger(TC.Consts.event.FEATURESADD,{layer:e.layer,features:[t]});e.map.zoomToFeatures([t]);e.loading.removeWait(wait)})}).call(this,t);return e}return null};t.goToCadastralRef=function(t){var e={},r=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(r.test(t)){var n=r.exec(t);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var i=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);e.params={type:TC.Consts.layerType.WFS,url:i.url,version:i.version,geometryName:i.geometryName,featurePrefix:i.featurePrefix,featureType:i.featureType,properties:new TC.filter.and(new TC.filter.equalTo(i.queryProperties.firstQueryWord,n[1].trim()),new TC.filter.equalTo(i.queryProperties.secondQueryWord,n[2].trim()),new TC.filter.equalTo(i.queryProperties.thirdQueryWord,n[3].trim())),outputFormat:i.outputFormat,styles:i.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e}return null};t.goToRoad=function(t){var e={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);e.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(t),outputFormat:r.outputFormat,styles:r.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e};t.goToPK=function(t){var e={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);e.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(t),outputFormat:r.outputFormat,styles:r.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e};t.goToStringPattern=function(t,e){var r={},n=this.getSearchTypeByRole(e);r.params={type:TC.Consts.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(t),outputFormat:n.outputFormat,styles:n.styles};return r};t.getPoint=function(t){var e,r=this.map.wrap.isGeo(),n=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(t);if(n&&3===n.length){e=[parseFloat(n[1]),parseFloat(n[2])];r&&(e=TC.Util.reproject(e,this.map.options.utmCrs,this.map.crs))}else{if((n=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===n.length){e=[parseFloat(n[2]),parseFloat(n[1])];if(!r)return TC.Util.reproject(e,this.map.options.geoCrs,this.map.crs)}if((n=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===n.length){e=[parseFloat(n[2]),parseFloat(n[1])];if(!r)return TC.Util.reproject(e,this.map.options.geoCrs,this.map.crs)}}return e};t.insideLimit=function(t){return!!function(t,e){return!(t instanceof Array)||e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]}(this.map.options.maxExtent,t)};t.getPattern=function(){return this.textInput.value};t.getLabel=function(t){var e=t,r=TC.Util.getMapLocale(this.map);if(t.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(i=(e=e.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+this.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+this.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=(e=e.replace(i[1],parseFloat(i[1]).toLocaleString(r))).replace(i[3],parseFloat(i[3]).toLocaleString(r)));var n=1.1.toLocaleString(r).substring(1,2);if(i=e.match(new RegExp("^"+this.UTMX_LABEL.trim()+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+this.UTMY_LABEL.trim()+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(i[1]))||(e=e.replace(i[1],i[1].replace(".",n)));Number.isInteger(parseFloat(i[2]))||(e=e.replace(i[2],i[2].replace(".",n)))}}else if(t.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(i=(e=e.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+this.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+this.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=(e=e.replace(i[1],parseFloat(i[1]).toLocaleString(r))).replace(i[3],parseFloat(i[3]).toLocaleString(r)))}else if(t.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var i=t.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));e=this.MUN_LABEL+i[2]+", "+this.POL_LABEL+i[4]+", "+this.PAR_LABEL+i[6]}return e};t.removePunctuation=function(t){t=t||"";for(var e=new Array(t.length),r={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},n=0,i=t.length;n<i;n++)e[n]=r[t.charAt(n)]||t.charAt(n);return e.join("")};t.exportState=function(){const t=this;return t.exportsState?{id:t.id,searchText:t.textInput.value,layer:t.layer.exportState({exportStyles:!1})}:null};t.importState=function(t){const e=this;e.textInput.value=t.searchText;e.layer.importState(t.layer).then(function(){e.layer.features.forEach(function(t){t.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var t=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(e,r){return void 0!==t[r]?t[r]:e})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(t){for(var e=[],r=this.split(t),n=0;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var t=this.toLowerCase(),e=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(e)for(var r=0;r<e.length;r++)/[-;:.<>\{\}\[\]\/\s()]/g.test(e[r])&&(t=t.replace(e[r],e[r].toUpperCase()));return t.charAt(0).toUpperCase()+t.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(t,e){for(var r=0;r<this.length;r++)if(this[r][t]==e)return this[r]}});String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var r=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>r.length)&&(e=r.length);e-=t.length;var n=r.indexOf(t,e);return-1!==n&&n===e});TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.SelectContainer=TC.control.TabContainer;TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(t){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var t=TC.control.Share.prototype;t.CLASS="tc-ctl-share";t.MAILTO_MAX_LENGTH=256;t.IFRAME_WIDTH="600px";t.IFRAME_HEIGHT="450px";t.FEATURE_PARAM="showfeature";t.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";t.NAVALERT=" +D para guardar en marcadores.";t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.render.call(e,function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){e.div.querySelectorAll("button").forEach(function(t){t.classList.remove("hide")});e.div.querySelectorAll("input[type=text]").forEach(function(t){delete t.dataset.dataOriginalTitle})}TC.Util.detectMobile()||e.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const r=e.div.querySelectorAll("."+e.CLASS+"-url-box");e.div.querySelectorAll("span:not(.tc-beta)").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=this;e&&"LABEL"!==e.tagName;)e=e.parentElement;const n=e.querySelector("input[type=radio][name=format]").value;r.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches(".tc-"+n))})})});TC.Util.isFunction(t)&&t()})})};t.getLocation=function(){var t=window.location.href;window.location.hash&&(t=t.substr(0,t.indexOf(window.location.hash)));return t};t.manageMaxLengthExceed=function(t){this.div.querySelector("."+this.CLASS+"-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.browser);this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.qr)};t.generateIframe=function(t){var e=t||this.generateLink();if(e)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+e+'"></iframe>'};t.loadParamFeature=function(){const t=this;var e=null,r=TC.Util.getParameterByName(t.FEATURE_PARAM);if(r){var n;try{n=JSON.parse(decodeURIComponent(escape(window.atob(r))))}catch(e){TC.error(t.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}n&&t.map&&(n.geom?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),owner:t,stealth:!0}).then(function(e){t.paramFeatureLayer=e;e.importState({features:[n]}).then(function(){t.map.zoomToFeatures(e.features)})}):e=n)}return e};t.register=function(e){const r=this,n=TC.control.MapInfo.prototype.register.call(r,e);r.exportsState=!0;r.MOBILEFAV=r.getLocaleString("mobileBookmarks.instructions");r.NAVALERT=r.getLocaleString("bookmarks.instructions");var i=function(t){const e=t.parentElement.querySelector("input[type=text]");e.value=e.classList.contains("tc-url")?r.generateLink():r.generateIframe();e.select()};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){const e=r.generateLink();r.registerListeners();r.div.querySelector(".tc-url input[type=text]").value=e;r.div.querySelector(".tc-iframe input[type=text]").value=r.generateIframe(e)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(t){const e=t.target;i(e);document.execCommand("copy");e.textContent=r.getLocaleString("copied");setTimeout(function(){e.textContent=r.getLocaleString("copy");!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(t){i(t.target)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.disabled",function(t){t.stopImmediatePropagation();t.preventDefault();return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",function(t){t.preventDefault();var n=r.generateLink();if(n){const t=encodeURIComponent(n+"\n");t.length>r.MAILTO_MAX_LENGTH&&e.toast(r.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+t}}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(t){t.preventDefault();const e=r._dialogDiv.querySelector(".qrcode");e.innerHTML="";r._dialogDiv.querySelector("."+r.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?r.makeQRCode(e,256,256).then(function(t){t&&TC.Util.showModal(r._dialogDiv.querySelector(r._classSelector+"-qr-dialog"))}):TC.Util.showModal(r._dialogDiv.querySelector(r._classSelector+"-qr-dialog"))}));const o=function(t,e,n){if(e&&e.trim().length>0)t.location.href=n(e);else{TC.error(r.getLocaleString("urlTooLongForShortener"));t.close()}};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(t){t.preventDefault();const e=window.open();r.shortenedLink().then(function(t){o(e,t,function(t){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t)})});return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(t){t.preventDefault();const e=window.open();r.shortenedLink().then(function(t){o(e,t,function(t){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&amp;url="+encodeURIComponent(t)})});return!1}));TC.Util.detectMobile()&&r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(t){t.preventDefault();r.shortenedLink().then(function(t){var e="whatsapp://send?text=";location.href=void 0!==t?e+encodeURIComponent(t):e+encodeURIComponent(r.generateLink())});return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",function(e){e.preventDefault();var n=r.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(t.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,n,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(n,i);else{window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}return!1}));return n};t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"share"}).w(' </h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url" title="').h("i18n",e,{},{$key:"shareLink"}).w('"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",e,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe" title="').h("i18n",e,{},{$key:"embedMap"}).w('"><input type="radio" name="format" value="iframe" /><span>').h("i18n",e,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",e,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",e,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",e,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",e,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"tooManyLayersLoaded|s"}).w("</p></div>    </div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"qrCode"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div>      <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w('</p></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var t=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){this._sv=null;this._mapActiveControl=null;TC.Control.apply(this,arguments);this.options.googleMapsKey&&(t+="&key="+this.options.googleMapsKey);this.viewDiv=null;this._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var e=TC.control.StreetView.prototype;e.CLASS="tc-ctl-sv";e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(t,e){return t.w('<div class="tc-ctl-sv-btn" title="').h("i18n",e,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-view"]=function(){dust.register(e.CLASS+"-view",t);function t(t,e){return t.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",e,{},{$key:"closeStreetView"}).w('"></div>')}t.__dustBody=!0;return t};const r=function(){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1);this.map.div.querySelector("canvas").dispatchEvent(t)};var n=function(t){const e=t.viewDiv,n=function(){e.removeEventListener("transitionend",n);r.call(t)};e.addEventListener("transitionend",n);setTimeout(function(){r.call(t)},1e3);t.layer.clearFeatures();t.div.querySelector("."+t.CLASS+"-btn").classList.remove(TC.Consts.classes.CHECKED);t.div.querySelector("."+t.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);t.map.div.classList.remove(t.CLASS+"-active");t._startLonLat=null};e.register=function(t){const e=this;if(!e.viewDiv){e.viewDiv=TC.Util.getDiv(e.options.viewDiv);e.viewDiv.classList.add(e.CLASS+"-view",TC.Consts.classes.HIDDEN);e.options.viewDiv||t.div.insertAdjacentElement("beforebegin",e.viewDiv)}const r=TC.Control.prototype.register.call(e,t);e.layer=null;for(var i=e.getUID(),o=0;o<t.workLayers.length;o++){var a=t.workLayers[o];if(a.type===TC.Consts.layerType.VECTOR&&a.id===i){e.layer=a;break}}e.layer||t.loaded(function(){t.addLayer({id:i,owner:e,stealth:!0,type:TC.Consts.layerType.VECTOR}).then(function(t){e.layer=t})});e.renderPromise().then(function(){TC.loadJS(!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){const t=new Draggabilly(e.div.querySelector("."+e.CLASS+"-drag"),{containment:e.map.div});t.on("dragStart",function(t){!function(t){t.div.querySelector("."+t.CLASS+"-btn").classList.add(TC.Consts.classes.CHECKED);t.map.div.classList.add(t.CLASS+"-active")}(e)});t.on("dragEnd",function(r){!function(t){var e=!1;const r=t.div.querySelector("."+t.CLASS+"-btn"),i=t.div.querySelector("."+t.CLASS+"-drag");var o=r.getBoundingClientRect(),a=i.getBoundingClientRect();i.classList.add(TC.Consts.classes.HIDDEN);if(a.top<o.top||a.top>o.bottom||a.left<o.left||a.left>o.right){e=!0;for(var s=t.map.getExtent(),l=[s[2],s[3]],c=0;c<16;c++)t.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=t.map.div.getBoundingClientRect(),h=(a.left*window.devicePixelRatio+a.right*window.devicePixelRatio)/2-u.left*window.devicePixelRatio,d=a.bottom*window.devicePixelRatio-u.top*window.devicePixelRatio,p=t.map.wrap.getCoordinateFromPixel([h,d]);t.callback(p)}else n(t)}(e);t.setPosition(0,0)})});e.viewDiv.querySelector("."+e.CLASS+"-btn-close").addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation();e.closeView()})},function(t,e,r){TC.error("Error de renderizado StreetView")});return r};e.render=function(){const t=this;return t._set1stRenderPromise(new Promise(function(e,r){t.renderData(null,function(){t.getRenderedHtml(t.CLASS+"-view",null).then(function(r){setTimeout(function(){t.viewDiv.innerHTML=r;e(t)},300)}).catch(function(t){TC.error(t)})})}))};var i=0;e.callback=function(e){var o=this,a=function(t){if(o._sv){var e=t.getBounds();lonLat=TC.Util.reproject([(e[0]+e[2])/2,(e[1]+e[3])/2],o.map.crs,"EPSG:4326");o._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},s=function(t){if(o._sv){var e=t.getBounds();o._startLonLat=TC.Util.reproject([(e[0]+e[2])/2,(e[1]+e[3])/2],o.map.crs,"EPSG:4326")}},l=o.map.getLoadingIndicator();l&&(i=l.addWait(i));const c=o.map.div;var u=function(t,r){o.layer.clearFeatures();var n,i;if(t){var l=t.getPosition();n=TC.Util.reproject([l.lng(),l.lat()],"EPSG:4326",o.map.crs);i=t.getPov().heading}else{n=e;i=0}o.map.addMarker(n,{cssClass:"tc-marker-sv-"+(Math.round(16*i/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:o.layer,showsPopup:!1});Promise.all(o.map._markerPromises).then(function(){o.layer.wrap.setDraggable(!0,a,s)});if(r){var u=function(){o.map.setCenter(n)};c.classList.contains(TC.Consts.classes.COLLAPSED)?u():setTimeout(u,1200)}};TC.loadJS(!window.google||!google.maps,t,function(){if(window.google){u();const t=o.viewDiv,a=TC.Util.reproject(e,o.map.crs,"EPSG:4326"),s=new google.maps.LatLng(a[1],a[0]);(new google.maps.StreetViewService).getPanorama({location:s,preference:google.maps.StreetViewPreference.BEST},function(e,a){if(a!==google.maps.StreetViewStatus.OK){l&&l.removeWait(i);setTimeout(function(){TC.alert(a===google.maps.StreetViewStatus.ZERO_RESULTS?o.getLocaleString("noStreetView"):o.getLocaleString("streetViewUnknownError"));o.layer.wrap.setDraggable(!1);n(o)},100)}else{const e=function(n){if(o._transitioning&&("width"===n.propertyName||"height"===n.propertyName)){o._transitioning=!1;l&&l.removeWait(i);const n=document.createEvent("HTMLEvents");n.initEvent("resize",!1,!1);c.dispatchEvent(n);r.call(o);t.removeEventListener("transitionend",e);var a={position:s,pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(o._sv){o._sv.setOptions(a);o._sv.setVisible(!0)}else{o._sv=new google.maps.StreetViewPanorama(t,a);google.maps.event.addListener(o._sv,"position_changed",function(){u(o._sv,t.classList.contains(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(o._sv,"pov_changed",function(){if(o.layer.features&&o.layer.features.length>0){var t=o.layer.features[0];delete t.options.url;t.options.cssClass="tc-marker-sv-"+(Math.round(16*o._sv.getPov().heading/360)+16)%16;t.setStyle(t.options);o.layer.refresh()}});google.maps.event.addListener(o._sv,"status_changed",function(){var t=o._sv.getStatus();if(t!==google.maps.StreetViewStatus.OK){o._sv.setVisible(!1);TC.alert(t===google.maps.StreetViewStatus.ZERO_RESULTS?o.getLocaleString("noStreetView"):o.getLocaleString("streetViewUnknownError"));if(o._startLonLat){o._sv.setVisible(!0);o._sv.setPosition({lng:o._startLonLat[0],lat:o._startLonLat[1]})}else{o.layer.wrap.setDraggable(!1);o.closeView()}}})}}};o._transitioning=!0;t.addEventListener("transitionend",e);if(!o.options.viewDiv){const t=c.getBoundingClientRect();o.viewDiv.style.height=t.height+"px";o.viewDiv.style.width=t.width+"px"}c.classList.add(TC.Consts.classes.COLLAPSED);t.style.left="";t.style.top="";t.classList.remove(TC.Consts.classes.HIDDEN);t.classList.add(TC.Consts.classes.VISIBLE);setTimeout(function(){e({propertyName:"width"})},1e3);const n=document.body.querySelector("header");n&&(n.style.display="none");if(o.map.activeControl){o._previousActiveControl=o.map.activeControl;o.map.activeControl.deactivate(!0)}u(o._sv)}})}else n(o)},!1,!0)};e.closeView=function(){const t=this,e=t.map.div,r=t.viewDiv,i=function(){e.classList.remove(TC.Consts.classes.COLLAPSED);const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1);e.dispatchEvent(t)},o=function(t){if("width"===t.propertyName||"height"===t.propertyName){r.removeEventListener("transitionend",o);i()}};r.removeEventListener("transitionend",o);r.addEventListener("transitionend",o);setTimeout(i,1e3);if(!t.options.viewDiv){t.viewDiv.style.removeProperty("height");t.viewDiv.style.removeProperty("width")}r.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.VISIBLE);t.div.querySelector("."+t.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);n(t);t._sv.setVisible(!1);const a=document.body.querySelector("header");a&&(a.style.display="");t._previousActiveControl&&t._previousActiveControl.activate()}}();TC.control=TC.control||{};!function(){TC.control.ThreeD=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ThreeD,TC.Control);var t=TC.control.ThreeD.prototype;t.CLASS="tc-ctl-threed";t.classes={BETA:"tc-beta-button",BTNACTIVE:"active"};t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",e,{},{$key:"threed.tip"}).w('"></button>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);t.on(TC.Consts.event.VIEWCHANGE,function(t){t.view==TC.Consts.view.THREED&&e.activate()});return r};t.renderData=function(t,e){const r=this;return TC.Control.prototype.renderData.call(r,t,function(){r.button=r.div.querySelector("."+r.CLASS+"-btn");r.button.addEventListener(TC.Consts.event.CLICK,function(){if(!r.button.disabled)if(r.map.on3DView){r.button.disabled=!0;TC.view.ThreeD.unapply({callback:function(){r.button.setAttribute("title",r.getLocaleString("threed.tip"));r.button.classList.remove(r.classes.BTNACTIVE);r.button.disabled=!1}})}else r.activate()});TC.Util.isFunction(e)&&e()})};t.activate=function(){var t=this;t.button.disabled=!0;t.browserSupportWebGL.call(t);const e=function(){t.button.disabled=!1};t.map.view3D?t.map.on3DView||TC.view.ThreeD.apply({map:t.map,options:t.options,getRenderedHtml:t.getRenderedHtml,callback:e}):TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:t.map,options:t.options,getRenderedHtml:t.getRenderedHtml,callback:e})});!function(){t.button.setAttribute("title",t.getLocaleString("threed.two.tip"));t.button.classList.remove(t.classes.BETA);t.button.classList.add(t.classes.BTNACTIVE)}()};t.deactivate=function(){TC.Control.prototype.deactivate.call(this)};t.browserSupportWebGL=function(){var t=!1;if(window.WebGLRenderingContext){var e=document.createElement("canvas"),r={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)||e.getContext("webkit-3d",r)||e.getContext("moz-webgl",r);if(n)t=!0;else{r.failIfMajorPerformanceCaveat=!1;if(n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)||e.getContext("webkit-3d",r)||e.getContext("moz-webgl",r)){t="slow";this.isSlower=!0}else t=!1}}catch(t){console.log(E)}if("slow"===t||!t){var i="slow"===t?"threed.slowSupport.supported":"threed.not.supported";this.map.toast(this.getLocaleString(i),{type:TC.Consts.msgType.WARNING,duration:1e4})}return t}t=!1}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.control.WFSEdit=function(){const t=this;TC.control.SWCacheClient.apply(this,arguments);t._classSelector="."+t.CLASS;t.layer=null;t.callback=TC.Util.isFunction(arguments[2])?arguments[2]:t.options.callback?t.options.callback:null;t.layersEditData={};t.showsOriginalFeatures="boolean"==typeof t.options.showOriginalFeatures&&t.options.showOriginalFeatures;t.highlightsAdded=t.highlightsModified=t.highlightsRemoved="boolean"!=typeof t.options.highlightChanges||t.options.highlightChanges;TC.Util.isFunction(t.options.getBeforeEditLayerStyleFunction)||(t.getBeforeEditLayerStyleFunction=t.getBeforeEditLayerStyle);t.styles=t.options.styles||{point:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1,radius:6},line:{strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1},polygon:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1}}};TC.inherit(TC.control.WFSEdit,TC.control.SWCacheClient);!function(){var t=0;const e=function(t){const e=t.getLayerEditData();t._saveBtn.disabled=!(navigator.onLine&&e&&e.checkedOut)||t.isSyncing},r=function(t,e){t.div.querySelector(t._classSelector+"-view").classList.toggle(TC.Consts.classes.HIDDEN,!e||!t.layer||!(t.layer.type===TC.Consts.layerType.WFS||t.layer.type===TC.Consts.layerType.WMS));if(t.layer&&t.layer.wfsLayer){const e=TC.filter&&TC.filter.Bbox&&t.layer.wfsLayer.properties instanceof TC.filter.Bbox;t._recropBtn.classList.toggle(TC.Consts.classes.HIDDEN,!e)}t.div.querySelector(t._classSelector+"-edit").classList.toggle(TC.Consts.classes.HIDDEN,!e)},n=function(t){e(t);const r=t.getLayerEditData();t._discardBtn.disabled=!r||!r.checkedOut},i=function(t,e){if(t.layer){const r=t.getLayerEditData();if(void 0!==e){r.checkedOut=e;n(t)}else TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var e=s(t);localforage.keys().then(function(i){if(i){for(var o=!0,a=0,s=i.length;a<s;a++)if(0===i[a].indexOf(e)){o=!1;break}r.checkedOut=!o;n(t)}})})}else n(t)},o=function(t,e){return new Promise(function(r,n){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var i,o;switch(!0){case e instanceof TC.feature.Polygon:o=TC.Consts.geom.POLYGON;break;case e instanceof TC.feature.Polyline:o=TC.Consts.geom.POLYLINE;break;case e instanceof TC.feature.Point:o=TC.Consts.geom.POINT;break;case e instanceof TC.feature.MultiPolygon:o=TC.Consts.geom.MULTIPOLYGON;break;case e instanceof TC.feature.MultiPolyline:o=TC.Consts.geom.MULTIPOLYLINE}i={id:e.id||e.provId,attributes:e.data,type:o,geometry:e.geometry};localforage.setItem(t,i).then(function(){r({feature:e})}).catch(function(t){n({feature:e,error:t})})})})},a=function(t){return new Promise(function(e,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(t).then(function(){e(t)}).catch(function(t){r(Error(t))})})})},s=function(t,e){return t.LOCAL_STORAGE_KEY_PREFIX+function(t){let e=t.options.featureType[0];e.indexOf(":")<0&&(e=t.options.featureNS+":"+e);return e+"@"+t.options.url}(e||t.layer.wfsLayer||t.layer)},l=function(t,e){return s(t,e)+t.LOCAL_STORAGE_ADDED_KEY_PREFIX},c=function(t,e){return s(t,e)+t.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},u=function(t,e){return s(t,e)+t.LOCAL_STORAGE_REMOVED_KEY_PREFIX},h=function(t){return t.getPath?t.getPath().join(" \u2022 "):t.title||t.id},d=TC.control.WFSEdit.prototype;d.CLASS="tc-ctl-wfsedit";d.template=function(){dust.register(d.CLASS,t);function t(t,a){return t.w("<h2>").h("i18n",a,{},{$key:"featureEditing"}).w('</h2><div class="tc-ctl-wfsedit-layer"><select class="tc-combo tc-ctl-wfsedit-layer-sel" disabled><option value="">').h("i18n",a,{},{$key:"selectLayerToEdit"}).w("</option>").s(a.get(["layers"],!1),a,{block:e},{}).w('</select></div><div class="tc-ctl-wfsedit-view tc-hidden"><table><tbody><tr><th><img class="tc-ctl-wfsedit-view-watch" /></th><td>').h("i18n",a,{},{$key:"featuresInEditedLayer"}).w('</td></tr><tr><th><img class="tc-ctl-wfsedit-view-original-watch" /></th><td><input type="checkbox" id="tc-ctl-wfsedit-view-original-cb-').f(a.get(["controlId"],!1),a,"h").w('"').x(a.get(["showOriginalFeatures"],!1),a,{block:r},{}).w(' /><label class="tc-ctl-wfsedit-view-original" for="tc-ctl-wfsedit-view-original-cb-').f(a.get(["controlId"],!1),a,"h").w('">').h("i18n",a,{},{$key:"featuresAsBeforeEditing"}).w('</label></td></tr><tr><th><input type="color" id="tc-ctl-wfsedit-view-clr-added-').f(a.get(["controlId"],!1),a,"h").w('" class="tc-clt-wfsedit-view-clr-added" /><label for="tc-ctl-wfsedit-view-clr-added-').f(a.get(["controlId"],!1),a,"h").w('" title="').h("i18n",a,{},{$key:"clickToChangeColor"}).w('"><img class="tc-ctl-wfsedit-view-added-watch" /></label></th><td><input type="checkbox" id="tc-ctl-wfsedit-view-added-cb-').f(a.get(["controlId"],!1),a,"h").w('"').x(a.get(["highlightChanges"],!1),a,{block:n},{}).w(' /><label class="tc-ctl-wfsedit-view-added" for="tc-ctl-wfsedit-view-added-cb-').f(a.get(["controlId"],!1),a,"h").w('">').h("i18n",a,{},{$key:"unsyncedAdded"}).w('</label></td></tr><tr><th><input type="color" id="tc-ctl-wfsedit-view-clr-modified-').f(a.get(["controlId"],!1),a,"h").w('" class="tc-clt-wfsedit-view-clr-modified" /><label for="tc-ctl-wfsedit-view-clr-modified-').f(a.get(["controlId"],!1),a,"h").w('" title="').h("i18n",a,{},{$key:"clickToChangeColor"}).w('"><img class="tc-ctl-wfsedit-view-modified-watch" /></label></th><td><input type="checkbox" id="tc-ctl-wfsedit-view-modified-cb-').f(a.get(["controlId"],!1),a,"h").w('"').x(a.get(["highlightChanges"],!1),a,{block:i},{}).w(' /><label class="tc-ctl-wfsedit-view-modified" for="tc-ctl-wfsedit-view-modified-cb-').f(a.get(["controlId"],!1),a,"h").w('">').h("i18n",a,{},{$key:"unsyncedModified"}).w('</label></td></tr><tr><th><input type="color" id="tc-ctl-wfsedit-view-clr-removed-').f(a.get(["controlId"],!1),a,"h").w('" class="tc-clt-wfsedit-view-clr-removed" /><label for="tc-ctl-wfsedit-view-clr-removed-').f(a.get(["controlId"],!1),a,"h").w('" title="').h("i18n",a,{},{$key:"clickToChangeColor"}).w('"><img class="tc-ctl-wfsedit-view-removed-watch" /></label></th><td><input type="checkbox" id="tc-ctl-wfsedit-view-removed-cb-').f(a.get(["controlId"],!1),a,"h").w('"').x(a.get(["highlightChanges"],!1),a,{block:o},{}).w(' /><label class="tc-ctl-wfsedit-view-removed" for="tc-ctl-wfsedit-view-removed-cb-').f(a.get(["controlId"],!1),a,"h").w('">').h("i18n",a,{},{$key:"unsyncedRemoved"}).w('</label></td></tr></tbody></table><button class="tc-ctl-wfsedit-btn-crop tc-hidden" title="').h("i18n",a,{},{$key:"refreshLayerToCurrentExtent"}).w('">').h("i18n",a,{},{$key:"refreshLayerToCurrentExtent"}).w('</button></div><div class="tc-ctl-wfsedit-edit tc-hidden"></div><div class="tc-ctl-wfsedit-save"><button class="tc-button tc-icon-button tc-ctl-wfsedit-btn-save" disabled title="').h("i18n",a,{},{$key:" syncChanges"}).w('">').h("i18n",a,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-wfsedit-btn-discard" disabled title="').h("i18n",a,{},{$key:" discardChanges"}).w('">').h("i18n",a,{},{$key:"discardChanges"}).w("</button></div>")}t.__dustBody=!0;function e(t,e){return t.w('<option value="').f(e.get(["id"],!1),e,"h").w('">').f(e.get(["title"],!1),e,"h").w("</option>")}e.__dustBody=!0;function r(t,e){return t.w(" checked")}r.__dustBody=!0;function n(t,e){return t.w(" checked")}n.__dustBody=!0;function i(t,e){return t.w(" checked")}i.__dustBody=!0;function o(t,e){return t.w(" checked")}o.__dustBody=!0;return t};d.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";d.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";d.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";d.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";d.register=function(t){const r=this;return new Promise(function(n,a){TC.control.SWCacheClient.prototype.register.call(r,t).then(function(){window.addEventListener("online",function(){e(r)});window.addEventListener("offline",function(){e(r)});r._editPromise=t.addControl("edit",{id:r.getUID(),div:r.div.querySelector(`.${r.CLASS}-edit`),styles:r.styles,downloadElevation:r.options.downloadElevation,snapping:r.options.snapping});r._editPromise.then(function(e){r.editControl=e;r.editControl.getAvailableFeaturesToImport=function(){const e=Object.getPrototypeOf(r.editControl).getAvailableFeaturesToImport.call(r.editControl),n=r.getLayerEditData();return e.filter(e=>{const r=t.getLayer(e.id);return r!==n.addedFeaturesLayer&&r!==n.modifiedFeaturesLayer&&r!==n.removedFeaturesLayer&&r!==n.beforeEditLayer})};r.editControl.importFeatures=function(t){const e=t||this.featuresToImport||[],n=r.getLayerEditData(),i=n.attributes?e.map(function(t){const e={};for(let r in n.attributes)e[r]=t.data[r];return new t.constructor(t.geometry,{geometryName:n.geometryName,data:e})}):t;Object.getPrototypeOf(r.editControl).importFeatures.call(r.editControl,i)};r.editControl.on(TC.Consts.event.DRAWEND,function(t){r.getLayerEditData().serializable&&r._storeFeatureAdd(t.feature)}).on(TC.Consts.event.FEATUREMODIFY,function(t){const e=t.feature,n=e.provId||e.id,a=function(){i(r,!0)},s=function(){TC.error(r.getLocaleString("failedWhenSavingModifyOperationInSession"))},u=r.getLayerEditData();if(u.serializable){let t=u.addedFeaturesLayer.getFeatureById(n);if(t){t.setCoords(e.geometry);t.setData(e.getData());o(l(r)+n,e).then(a,s)}else{if(t=u.modifiedFeaturesLayer.getFeatureById(n)){t.setCoords(e.geometry);t.setData(e.getData())}else u.modifiedFeaturesLayer.addFeature(r._createAuxFeature(e));o(c(r)+n,e).then(a,s)}}}).on(TC.Consts.event.FEATUREADD,function(t){r.getLayerEditData().serializable&&r._storeFeatureAdd(t.feature)}).on(TC.Consts.event.FEATUREREMOVE,function(t){r.getLayerEditData().serializable&&r._storeFeatureRemove(t.feature)});t.workLayers.forEach(t=>r.addLayer(t));t.on(TC.Consts.event.LAYERUPDATE,function(t){const e=t.layer;e.type!==TC.Consts.layerType.WFS||e.options.readOnly||r.getEditableLayer(e).then(t=>r.cacheLayer(t))}).on(TC.Consts.event.ZOOM,function(e){t.workLayers.filter(t=>t.wfsLayer).filter(t=>r.layer!==t).forEach(function(t){t.wfsLayer=null;r.getEditableLayer(t)})}).on(TC.Consts.event.LAYERADD,function(t){r.addLayer(t.layer)}).on(TC.Consts.event.LAYERREMOVE,function(t){const e=t.layer;if(r._removingLayer===e)return;(r.layer===e||e.wmsLayer&&r.layer===e.wmsLayer)&&r.setLayer(null);const n=r._layerSelect.querySelector(`option[value="${e.id}"]`);n&&n.parentElement.removeChild(n)}).on(TC.Consts.event.LAYERERROR,function(e){const n=e.layer;if(n.type===TC.Consts.layerType.WFS&&!n.options.readOnly){e.reason===TC.Consts.WFSErrors.MAX_NUM_FEATURES&&t.toast(r.getLocaleString("query.msgTooManyResults",{limit:e.data.limit}),{type:TC.Consts.msgType.WARNING});if(r.layer===n||r.layer&&r.layer.wfsLayer===n){delete r.layersEditData[r.layer.id];r.setLayer(null)}if(n.wmsLayer){t.removeLayer(n);n.wmsLayer.wfsLayer=null}}});n(r)});t.loaded(function(){r._layerSelect.disabled=!1;if(r.options.layer)r.setLayer(r.options.layer);else{const e=t.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WFS&&!t.options.stealth});1===e.length?r.setLayer(e[0].id):r.setLayer(null)}r.showOriginalFeatures(r.showsOriginalFeatures)});t.ready(function(){t.getControlsByClass("TC.control.WorkLayerManager").forEach(function(e){e.addLayerTool({renderFn:function(e,n){const i=r.CLASS+"-btn-edit";let o=e.querySelector("button."+i);if(!o){const a=r.getLocaleString("featureEditing");(o=document.createElement("button")).innerHTML=a;o.setAttribute("title",a);o.classList.add(i);o.dataset.layerId=n;e.appendChild(o);const s=t.getLayer(n);if(s.type===TC.Consts.layerType.WMS){o.classList.add(TC.Consts.classes.LOADING);s.getWFSCapabilities().catch(()=>o.classList.add(TC.Consts.classes.HIDDEN)).finally(()=>o.classList.remove(TC.Consts.classes.LOADING))}}return o},updateEvents:[TC.Consts.event.BEFORELAYERUPDATE,TC.Consts.event.LAYERUPDATE,TC.Consts.event.LAYERERROR,TC.Consts.event.CONTROLACTIVATE,TC.Consts.event.CONTROLDEACTIVATE],updateFn:function(e){const n=this,i=t.getLayer(n.dataset.layerId);setTimeout(()=>{n.classList.toggle(TC.Consts.classes.ACTIVE,r.layer===i)},500);n.disabled=!i||i.isRaster()&&1!==i.names.length},actionFn:function(){const e=t.getLayer(this.dataset.layerId),n=r.layer;this.classList.remove(TC.Consts.classes.ACTIVE);(e.names&&1===e.names.length||!e.isRaster())&&(e&&n!==e?r.setLayer(e).then(()=>{r.openEditSession()}):r.setLayer(null))}})})})})})};d.render=function(t){const e=this;var n=[];if(e.map)for(var i=0,o=e.map.workLayers.length;i<o;i++){var a=e.map.workLayers[i];a.type!==TC.Consts.layerType.WFS||a.options.stealth||n.push({id:a.id,title:a.title||a.id})}return e._set1stRenderPromise(TC.Control.prototype.renderData.call(e,{layers:n,showOriginalFeatures:e.showsOriginalFeatures,highlightChanges:e.highlightsAdded||e.highlightsModified||e.highlightsRemoved,controlId:e.id},function(){e._layerDiv=e.div.querySelector(e._classSelector+"-layer");e._layerSelect=e._layerDiv.querySelector(e._classSelector+"-layer-sel");e._layerSelect.addEventListener("change",function(t){r(e,!1);e.getEditableLayer(e._layerSelect.value).then(function(t){e.setLayer(t.wmsLayer||t).then(function(){e.layer&&e.openEditSession()})}).catch(()=>{e.setLayer(null)})});const n=e.div.querySelector(e._classSelector+"-view");e._editingWatch=n.querySelector(`.${e.CLASS}-view-watch`);e._beforeEditLayerWatch=n.querySelector(`.${e.CLASS}-view-original-watch`);e._addedWatch=n.querySelector(`.${e.CLASS}-view-added-watch`);e._modifiedWatch=n.querySelector(`.${e.CLASS}-view-modified-watch`);e._removedWatch=n.querySelector(`.${e.CLASS}-view-removed-watch`);n.querySelector(`#${e.CLASS}-view-original-cb-${e.id}`).addEventListener("change",function(t){e.showOriginalFeatures(t.target.checked)});n.querySelector(`#${e.CLASS}-view-added-cb-${e.id}`).addEventListener("change",function(t){e.highlightAdded(t.target.checked)});n.querySelector(`#${e.CLASS}-view-modified-cb-${e.id}`).addEventListener("change",function(t){e.highlightModified(t.target.checked)});n.querySelector(`#${e.CLASS}-view-removed-cb-${e.id}`).addEventListener("change",function(t){e.highlightRemoved(t.target.checked)});const i=new RegExp(`${e.CLASS}-view-clr-(.+)-${e.id}`),o=function(t){const r=this.parentElement.querySelector("input[type=color]"),n=e.getLayerEditData(),o=n[r.id.match(i)[1]+"FeaturesLayer"];switch(n.geometryType){case TC.Consts.geom.POINT:r.value=o.styles.point.strokeColor;break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:r.value=o.styles.line.strokeColor;break;default:r.value=o.styles.polygon.strokeColor}r.click()},a=function(t){const r=t.target,n=e.getLayerEditData(),o=r.id.match(i)[1],a=n[o+"FeaturesLayer"],s=n[o+"CustomColor"]=r.value;switch(n.geometryType){case TC.Consts.geom.POINT:a.styles.point.strokeColor=s;break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:a.styles.line.strokeColor=s;break;default:a.styles.polygon.strokeColor=s;a.styles.polygon.fillColor=s}a.setStyles(a.styles);e[`_${o}Watch`].src=p(a,n.geometryType)},s=`${e.CLASS}-view-clr-added-${e.id}`;n.querySelector(`label[for="${s}"]`).addEventListener(TC.Consts.event.CLICK,o);document.getElementById(s).addEventListener("change",a);const l=`${e.CLASS}-view-clr-modified-${e.id}`;n.querySelector(`label[for="${l}"]`).addEventListener(TC.Consts.event.CLICK,o);document.getElementById(l).addEventListener("change",a);const c=`${e.CLASS}-view-clr-removed-${e.id}`;n.querySelector(`label[for="${c}"]`).addEventListener(TC.Consts.event.CLICK,o);document.getElementById(c).addEventListener("change",a);e._saveBtn=e.div.querySelector(e._classSelector+"-btn-save");e._saveBtn.addEventListener(TC.Consts.event.CLICK,function(){TC.confirm(e.getLocaleString("edit.applyEdits.confirm",{layerTitle:h(e.layer)}),function(){e.applyEdits()})});e._discardBtn=e.div.querySelector(e._classSelector+"-btn-discard");e._discardBtn.addEventListener(TC.Consts.event.CLICK,function(){TC.confirm(e.getLocaleString("edit.discardEdits.confirm",{layerTitle:h(e.layer)}),function(){e.discardEdits()})});e._recropBtn=e.div.querySelector(`.${e.CLASS}-view button.${e.CLASS}-btn-crop`);e._recropBtn.addEventListener(TC.Consts.event.CLICK,function(){if(e.layer){const t=()=>{if(e.layer&&e.layer.wfsLayer&&TC.filter&&TC.filter.Bbox&&e.layer.wfsLayer.properties instanceof TC.filter.Bbox){const t=e.getLayerEditData();e.layer.wfsLayer.properties=new TC.filter.Bbox(null,e.map.getExtent(),e.map.getCRS());e.layer.wfsLayer.refresh();if(t.beforeEditLayer){t.beforeEditLayer.properties=e.layer.wfsLayer.properties;t.beforeEditLayer.refresh()}}},r=e.getLayerEditData(),n=r.addedFeaturesLayer.features.concat(r.modifiedFeaturesLayer.features,r.removedFeaturesLayer.features);n.length?TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){let r=!1;const i=e.map.getExtent(),o=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]];for(var a=0,s=n.length;a<s;a++)if(!TC.Geometry.intersects(n[a].geometry,o)){r=!0;break}r?TC.confirm(e.getLocaleString("refreshLayerToCurrentExtent.confirm"),function(){t()}):t()}):t()}});TC.Util.isFunction(t)&&t()}))};d.addLayer=function(t){const e=this;t.isBase||t.options.readOnly||t.options.stealth||e.getEditableLayer(t).then(function(r){!t.isRaster()&&r.wmsLayer||function(t){const r=document.createElement("option");r.setAttribute("value",t.id);r.innerHTML=h(t);e.renderPromise().then(function(){e._layerSelect.appendChild(r)})}(t)}).catch(e=>console.log(`Layer ${t.id} not editable. Reason: ${e.message}`))};d.setLayer=function(t){const e=this;return new Promise(function(n,i){const o=e.map,a=e.div.querySelector(e._classSelector+"-layer-sel");t=o.getLayer(t);const s=o.workLayers.filter(e=>e===t)[0],l=function(){if(s)e.getEditableLayer(s).then(function(t){const r=function(){e.layer=s;e._enableEditSerialization(s).then(function(){e.getEditControl().then(r=>{a.value=e.layer.id;r.setMode(null);r.setLayer(t);n(e.layer)})}).catch(t=>{e.setLayer(null);i(t)})};o.workLayers.indexOf(t)>=0?r():o.addLayer(t).then(r)}).catch(()=>{e.setLayer(null);n(null)});else{e.layer&&e.layer.wfsLayer&&(e._removingLayer=e.layer.wfsLayer);e.getEditControl().then(t=>{r(e,!1);e.closeEditSession().then(()=>{a.value="";t.setMode(null);t.setLayer(null);e.layer=null;n(null)}).finally(()=>{delete e._removingLayer})})}};if(null!==t&&e.layer){e.layer.wfsLayer&&(e._removingLayer=e.layer.wfsLayer);e.closeEditSession().then(()=>{s&&l()})}else l()})};d._storeFeatureAdd=function(e){const r=this;e.provId="NewFeature."+t++;const n=r.getLayerEditData(),a=r._createAuxFeature(e);n.addedFeaturesLayer.addFeature(a);o(l(r)+e.provId,a).then(function(){i(r,!0)},function(){TC.error(r.getLocaleString("failedWhenSavingAddOperationInSession"))})};d._storeFeatureRemove=function(t){const e=this;var r=t.provId||t.id,n=function(){i(e)},s=function(){TC.error(e.getLocaleString("failedWhenSavingRemoveOperationInSession"))};const h=e.getLayerEditData();if(h.serializable){let i=h.addedFeaturesLayer.getFeatureById(r);if(i){h.addedFeaturesLayer.removeFeature(i);a(l(e)+r).then(n,s)}else{var d=u(e);if(i=h.modifiedFeaturesLayer.getFeatureById(r)){h.modifiedFeaturesLayer.removeFeature(i);h.removedFeaturesLayer.addFeature(e._createAuxFeature(t));a(c(e)+r).then(function(){n();o(d+r,t).then(n,s)},s)}else if(!(i=h.removedFeaturesLayer.getFeatureById(r))){h.removedFeaturesLayer.addFeature(e._createAuxFeature(t));o(d+r,t).then(n,s)}}}};d._createAuxFeature=function(t){const e=t.provId||t.id,r=this.getLayerEditData(),n=new t.constructor(t.geometry,{geometryName:r.geometryName,data:t.getData()});n.setStyle(null);n.setId(e);return n};d.getEditControl=function(){const t=this;return t._editPromise||new Promise(function(e,r){t.renderPromise().then(()=>e(t.editControl))})};d.cacheLayer=function(t){const e=this;return new Promise(function(r,n){e.getServiceWorker().then(function(){if(navigator.onLine){const i=t.wrap.getGetFeatureUrl(),o=t.getDescribeFeatureTypeUrl();i&&o?e.createCache(s(e,t),{urlList:[i,o]}).then(()=>r(),t=>n(t)):r()}else r()}).catch(t=>n(t))})};d.getFeatureType=function(t){const e=this;return new Promise(function(r,n){t=t||e.layer;const i=map.getLoadingIndicator(),o=i&&i.addWait();t.describeFeatureType().then(function(n){e.getEditControl().then(function(i){const o=e.getLayerEditData(t);o.attributes={};for(var a in n){const t=n[a],e=i.getGeometryType(t.type);if(e){o.geometryName=t.name;o.geometryType="boolean"==typeof e?null:e}else o.attributes[a]=t}for(var a in o.attributes){const t=o.attributes[a];t.type=t.type.substr(t.type.indexOf(":")+1)}r(o)})}).catch(function(t){n(t)}).finally(()=>i&&i.removeWait(o))})};d._addAuxLayersToMap=function(t){const e=this;return new Promise(function(r,n){t=t||e.layer;const i=e.getLayerEditData(t),o=i.beforeEditLayer;if(o){const n=i.addedFeaturesLayer,a=i.modifiedFeaturesLayer,s=i.removedFeaturesLayer;Promise.all([map.addLayer(o),map.addLayer(n),map.addLayer(a),map.addLayer(s)]).then(function(){e.getEditableLayer(t).then(function(t){let l=map.layers.indexOf(t);o.setVisibility(e.showsOriginalFeatures);n.setVisibility(e.highlightsAdded);a.setVisibility(e.highlightsModified);s.setVisibility(e.highlightsRemoved);e.map.insertLayer(o,++l,function(){const c=l+1;map.insertLayer(n,c);map.insertLayer(a,c);map.insertLayer(s,c);o.setStyles(e.getBeforeEditLayerStyle(t));n.setStyles(e.getAddedFeaturesLayerStyle(t));a.setStyles(e.getModifiedFeaturesLayerStyle(t));s.setStyles(e.getRemovedFeaturesLayerStyle(t));e._editingWatch.src=p(t,i.geometryType);e._beforeEditLayerWatch.src=p(o,i.geometryType);e._addedWatch.src=p(n,i.geometryType);e._modifiedWatch.src=p(a,i.geometryType);e._removedWatch.src=p(s,i.geometryType);r()})})})}else n(new Error(`No auxiliary layers for ${t.id}`))})};d.openEditSession=function(){const t=this;return t.layer?new Promise(function(e,n){t.getFeatureType().then(function(o){t.getEditControl().then(function(a){t.getEditableLayer(t.layer).then(function(s){a.setLayer(s);switch(o.geometryType){case TC.Consts.geom.MULTIPOLYLINE:case TC.Consts.geom.MULTIPOLYGON:a.setComplexGeometry(!0);break;default:a.setComplexGeometry(!1)}a.activate();r(t,!0);i(t);const l=[TC.control.Edit.mode.MODIFY,TC.control.Edit.mode.OTHER];switch(o.geometryType){case TC.Consts.geom.POINT:l.push(TC.control.Edit.mode.ADDPOINT);break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:l.push(TC.control.Edit.mode.ADDLINE);break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:l.push(TC.control.Edit.mode.ADDPOLYGON)}a.constrainModes(l);a.setMode(TC.control.Edit.mode.MODIFY);t._addAuxLayersToMap().then(()=>e()).catch(t=>n(t))})})}).catch(function(i){t.layer&&t.layer.type===TC.Consts.layerType.VECTOR?t.getEditControl().then(function(n){n.activate();r(t,!0);n.setMode(TC.control.Edit.mode.MODIFY);e()}):n(i)})}):Promise.reject(Error("No layer set for editing"))};d.closeEditSession=function(){const t=this;return new Promise(function(e,r){t.renderPromise().then(function(){i(t,!1);t.getEditControl().then(t=>t.deactivate());const r=t.getLayerEditData();if(r&&r.beforeEditLayer){t._editingWatch.src=TC.Consts.BLANK_IMAGE;t._beforeEditLayerWatch.src=TC.Consts.BLANK_IMAGE;t._addedWatch.src=TC.Consts.BLANK_IMAGE;t._modifiedWatch.src=TC.Consts.BLANK_IMAGE;t._removedWatch.src=TC.Consts.BLANK_IMAGE;const n=t.layer;t.getEditableLayer(t.layer).then(function(t){const i=[],o=function(t){map.workLayers.indexOf(t)>=0&&i.push(map.removeLayer(t))};o(r.beforeEditLayer);o(r.beforeEditLayer);o(r.addedFeaturesLayer);o(r.modifiedFeaturesLayer);o(r.removedFeaturesLayer);if(n!==t){n.wfsLayer=null;o(t)}Promise.all(i).then(()=>e())})}else e()})})};d.getEditableLayer=function(t){const e=this;return new Promise(function(r,n){const i=`Layer ${t.id} not editable`;(t=e.map?map.getLayer(t):t)?t.type!==TC.Consts.layerType.WFS||!t.wmsLayer&&(t.options.stealth||t.options.readOnly)?t.type===TC.Consts.layerType.WMS?t.wfsLayer?t.wfsLayer.getCapabilitiesPromise().then(()=>r(t.wfsLayer)):t.getWFSCapabilities().then(function(o){const a=t.getDisgregatedLayerNames(),s=a[0],l=s.indexOf(":"),c=s.substring(l+1);1!==a.length||o.FeatureTypes.hasOwnProperty(c)?TC.loadJS(!TC.layer.Vector,TC.apiLocation+"TC/layer/Vector",function(){const n={id:e.getUID(),type:TC.Consts.layerType.WFS,url:t.options.url.replace(/wms/gi,"wfs"),properties:e.map?new TC.filter.Bbox(null,map.getExtent(),map.getCRS()):null,outputFormat:TC.Consts.format.JSON,title:`${t.getPath().join(" \u2022 ")} - ${e.getLocaleString("featureEditing")}`,geometryName:"geom",featureType:[s],featureNS:"Edicion",styles:e.styles,stealth:!0};t.wfsLayer=new TC.layer.Vector(n);t.wfsLayer.wmsLayer=t;r(t.wfsLayer)}):n(new Error(i))}).catch(t=>n(t)):t.type===TC.Consts.layerType.VECTOR?r(t):n(new Error(i)):t.getCapabilitiesPromise().then(()=>r(t)):n(new Error("No layer to edit"))})};d.isLayerEdited=function(t){const e=this;return new Promise(function(r,n){const i=s(e,t);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(t){r(!!t&&t.some(t=>0===t.indexOf(i)))})})})};d.getLayerEditData=function(t){const e=t||this.layer;return e?this.layersEditData[e.id]=this.layersEditData[e.id]||{checkedOut:!1}:null};const p=function(t,e){switch(e){case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return TC.Util.getLegendImageFromStyle(t.styles.point,{geometryType:TC.Consts.geom.POINT});case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return TC.Util.getLegendImageFromStyle(t.styles.line,{geometryType:TC.Consts.geom.POLYLINE});default:return TC.Util.getLegendImageFromStyle(t.styles.polygon,{geometryType:TC.Consts.geom.POLYGON})}};d._enableEditSerialization=function(e){const r=this;return new Promise(function(n,i){r.getEditableLayer(e).then(function(i){const o=function(){const o=r.getLayerEditData(e),a=e.getPath?e.getPath().join(" \u2022 "):e.title||e.id;var h=o.beforeEditLayer;h||(h=o.beforeEditLayer=new TC.layer.Vector(TC.Util.extend({},i.options,{id:r.getUID(),title:`${a} - ${r.getLocaleString("dataBeforeEdits")}`,readOnly:!0,owner:r,stealth:!0})));var d=o.addedFeaturesLayer;let p=!0;if(!d){p=!1;d=o.addedFeaturesLayer=new TC.layer.Vector({id:r.getUID(),title:`${a} - ${r.getLocaleString("addedFeatures")}`,owner:r,stealth:!0,zIndex:2})}var f=o.modifiedFeaturesLayer;let g=!0;if(!f){g=!1;f=o.modifiedFeaturesLayer=new TC.layer.Vector({id:r.getUID(),title:`${a} - ${r.getLocaleString("modifiedFeatures")}`,owner:r,stealth:!0,zIndex:2})}var y=o.removedFeaturesLayer;let m=!0;if(!y){m=!1;y=o.removedFeaturesLayer=new TC.layer.Vector({id:r.getUID(),title:`${a} - ${r.getLocaleString("removedFeatures")}`,owner:r,stealth:!0,zIndex:2})}const C=[];if(p&&g&&m){y.features.forEach(function(t){const e=i.getFeatureById(t.id);e&&i.removeFeature(e)});f.features.forEach(function(t){const e=i.getFeatureById(t.id);if(e){e.setCoords(t.geometry);e.setData(t.getData())}});d.features.forEach(function(t){i.getFeatureById(t.id)||C.push(i.addFeature(r._createAuxFeature(t)))});Promise.all(C).then(()=>{o.serializable=!0;n(i)})}else{const e=s(r,i),a=l(r,i),h=c(r,i),p=u(r,i);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(r){r&&r.filter(t=>0===t.indexOf(e)).forEach(function(e){C.push(new Promise(function(r,n){(function(t){return new Promise(function(e,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(t).then(function(r){e({key:t,feature:r})}).catch(function(t){r(t)})})})})(e).then(function(e){var n,o=e.key;if(0===o.indexOf(p)){n=o.substr(p.length);const t=i.getFeatureById(n);i.removeFeature(t);y.addFeature(t).then(()=>r(t))}else if(0===o.indexOf(h)){n=o.substr(h.length);const t=i.getFeatureById(n);if(t){t.setCoords(e.feature.geometry);t.setData(e.feature.attributes);const n=t.clone();n.setId(t.id);f.addFeature(n).then(()=>r(t))}else r(t)}else if(0===o.indexOf(a)){n=o.substr(a.length);var s,l=parseInt(n.substr(n.lastIndexOf(".")+1));t=Math.max(t,l+1);switch(e.feature.type){case TC.Consts.geom.POINT:s=i.addPoint(e.feature.geometry);break;case TC.Consts.geom.POLYLINE:s=i.addPolyline(e.feature.geometry);break;case TC.Consts.geom.POLYGON:s=i.addPolygon(e.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:s=i.addMultiPolyline(e.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:s=i.addMultiPolygon(e.feature.geometry)}s.then(function(t){t.provId=n;t.setData(e.feature.attributes);const i=t.clone();i.setStyle(null);i.setId(t.provId);d.addFeature(i).then(()=>r(i))})}})}))});Promise.all(C).then(()=>{o.serializable=!0;n(i)})})})}};if(i.type===TC.Consts.layerType.WFS)if(i.state===TC.Layer.state.IDLE)o();else{const t=function(e){if(e.layer===i){o();r.map.off(TC.Consts.event.LAYERUPDATE,t)}};r.map.on(TC.Consts.event.LAYERUPDATE,t)}else n(i)})})};d.applyEdits=function(){const t=this;if(t.layer){const r=t.getLayerEditData();if(r.serializable){t.isSyncing=!0;e(t);const n=t.map.getLoadingIndicator(),i=n&&n.addWait(),o=r.modifiedFeaturesLayer.features.map(function(t){const e=new t.constructor(t.geometry,{geometryName:r.geometryName}),n=r.beforeEditLayer.features.filter(e=>e.id===t.id)[0];let i;if(n){i={};for(var o in t.data)if("id"!==o){const e=n.data[o],r=t.data[o];e!==r&&(i[o]=r)}}else i=t.data;e.setData(i);e.setId(t.id);return e});t.getEditableLayer(t.layer).then(function(a){a.applyEdits(r.addedFeaturesLayer.features,o,r.removedFeaturesLayer.features).then(function(e){if(e.transactionSummary.totalInserted!==r.addedFeaturesLayer.features.length||e.transactionSummary.totalUpdated!==o.length||e.transactionSummary.totalDeleted!==r.removedFeaturesLayer.features.length){TC.error("Error de concordancia de n\xfamero de entidades en transacci\xf3n");console.log(e,r.addedFeaturesLayer,o,r.removedFeaturesLayer);throw new Error(`Error en transacci\xf3n: Insertados ${e.transactionSummary.totalInserted}, hay ${r.addedFeaturesLayer.features.length} en capa`)}t.layer.type===TC.Consts.layerType.WMS&&t.layer.refresh();t.deleteCache(s(t)).then(function(){t.cacheLayer(a).then(function(){t.isSyncing=!1;n&&n.removeWait(i);t.discardEdits();t.map.toast(t.getLocaleString("changesSuccessfullySyncedWithServer"),{type:TC.Consts.msgType.INFO})})})}).catch(function(r){t.isSyncing=!1;e(t);TC.error(t.getLocaleString("errorSyncingChanges",{code:r.code,reason:r.reason}),{type:TC.Consts.msgType.ERROR})})})}}};d.discardEdits=function(){var t=this;t._joinedFeatureAttributes=[];var e=s(t);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(r){if(r){for(var n=0,o=r.length;n<o;n++){var a=r[n];0===a.indexOf(e)&&localforage.removeItem(a)}if(t.layer){const e=t.getLayerEditData();if(e.serializable){e.addedFeaturesLayer.clearFeatures();e.modifiedFeaturesLayer.clearFeatures();e.removedFeaturesLayer.clearFeatures();t.editControl.setSelectedFeatures([]);t.editControl.modifyControl.closeAttributes();t.getEditableLayer(t.layer).then(t=>t.refresh())}}i(t,!1)}});t.editControl.setMode(null)})};d.showOriginalFeatures=function(t){this.showsOriginalFeatures=t;const e=this.getLayerEditData();e&&e.beforeEditLayer.setVisibility(t)};d.highlightAdded=function(t){this.highlightsAdded=t;const e=this.getLayerEditData();e&&e.addedFeaturesLayer&&e.addedFeaturesLayer.setVisibility(t)};d.highlightModified=function(t){this.highlightsModified=t;const e=this.getLayerEditData();e&&e.modifiedFeaturesLayer&&e.modifiedFeaturesLayer.setVisibility(t)};d.highlightRemoved=function(t){this.highlightsRemoved=t;const e=this.getLayerEditData();e&&e.removedFeaturesLayer&&e.removedFeaturesLayer.setVisibility(t)};const f=function(t,e){const r={};switch(t.getLayerEditData(e.wmsLayer||e).geometryType){case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:r.polygon=e.map.options.styles.polygon;break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:r.line=e.map.options.styles.line;break;default:r.point=e.map.options.styles.point}return r};d.getBeforeEditLayerStyle=function(t){const e=function(e){const r=t.wrap.getRGBA(e);for(var n=0;n<3;n++)r[n]=255-r[n];return"#"+(65536*r[0]+256*r[1]+r[2]).toString(16).padStart(6,"0")},r=[1,3],n=TC.Util.extend(!0,{},t.options.styles||f(this,t));if(n.point){n.point.strokeColor=e(n.point.strokeColor);n.point.lineDash=r}if(n.line){n.line.strokeColor=e(n.line.strokeColor);n.line.lineDash=r}if(n.polygon){n.polygon.strokeColor=e(n.polygon.strokeColor);n.polygon.lineDash=r}return n};const g=function(t,e,r){const n=TC.Util.extend(!0,{},e.options.styles||f(t,e));if(n.point){n.point.strokeColor=r;n.point.fillColor=r}n.line&&(n.line.strokeColor=r);if(n.polygon){n.polygon.strokeColor=r;n.polygon.fillColor=r}return n};d.getAddedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return g(this,t,e.addedCustomColor||"#00ff00")};d.getModifiedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return g(this,t,e.modifiedCustomColor||"#ff7f00")};d.getRemovedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return g(this,t,e.removedCustomColor||"#ff0000")}}();TC.control=TC.control||{};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r},writable:!0,configurable:!0});TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/filter");TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.feature.MultiPolyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/MultiPolyline");TC.feature.MultiPolygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/MultiPolygon");TC.control.WFSQuery=function(t){TC.Control.apply(this,arguments);this.styles=this.options.styles;this.highlightStyles=this.options.highlightStyles||this.options.highLightStyles;this.download=this.options.download;const e="."+this.CLASS;this._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:e+"-dialog-ip-m"}};TC.inherit(TC.control.WFSQuery,TC.Control);!function(){var t=TC.control.WFSQuery.prototype,e=null,r=null,n=null,i=null,o=(TC.Consts.logicalOperator.AND,null),a=null,s=null,l=null;const c=function(t){if(t)for(;t.children.length;)t.removeChild(t.children[0])};var u={eq:TC.filter.equalTo,not:TC.filter.notEqualTo,gt:TC.filter.greaterThan,lt:TC.filter.lessThan,ge:TC.filter.greaterThanOrEqualTo,le:TC.filter.lessThanOrEqualTo,like:TC.filter.like,contains:TC.filter.like,start:TC.filter.like,end:TC.filter.like,bw:TC.filter.between},h=null,d=null,p=null,f=null,g=null,y=null,m=function(){return null},C=function(){return null},v=null,T=null,_=null;t.CLASS="tc-ctl-wfsquery";t.template={};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-wfsquery-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window tc-ctl-wfsquery-modal-window" ><div class="tc-modal-header"><h3>').f(e.get(["layerName"],!1),e,"h").w('</h3><div title="').h("i18n",e,{},{$key:"query.tooltipCloseDialogBtn"}).w('" class="tc-modal-close"></div></div><div class="tc-modal-body">').h("gt",e,{block:r},{key:e.getPath(!1,["layers","length"]),value:1}).w('<div class="tc-modal-form"></div><div class="tc-ctl-wfsquery-message tc-hidden"></div>                 </div><div class="tc-modal-footer"><button type="button" title="').h("i18n",e,{},{$key:"query.tooltipSendQueryBtn"}).w('" class="tc-button tc-ctl-wlm-btn-launch">').h("i18n",e,{},{$key:"query.sendQueryBtnText"}).w('</button><button type="button" title="').h("i18n",e,{},{$key:"query.cancelQueryTooltip"}).w('" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"query.cancelQueryButton"}).w("</button></div></div></div>")}e.__dustBody=!0;function r(t,e){return t.w('                      <div><select class="tc-combo" name="availableLayers"><option value="">').h("i18n",e,{},{$key:"query.chooseALayerCombo"}).w("</option>").s(e.get(["layers"],!1),e,{block:n},{}).w("</select></div>            ")}r.__dustBody=!0;function n(t,e){return t.w('<option value="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["title"],!1),e,"h").w("</option>")}n.__dustBody=!0;return e};t.template[t.CLASS+"-form"]=function(){dust.register(t.CLASS+"-form",e);function e(t,e){return t.w("<div>").h("countif",e,{else:r,block:n},{key:e.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w('</div><div class="tc-ctl-wfsquery-operacion tc-hidden"><div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden"><input type="radio" id="cond_1" name="codicion" value="eq" /><label for="cond_1" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_2" name="codicion" value="not" /><label for="cond_2" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_3" name="codicion" value="gt" /><label for="cond_3" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_4" name="codicion" value="lt" /><label for="cond_4" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_5" name="codicion" value="ge" /><label for="cond_5" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_6" name="codicion" value="le" /><label for="cond_6" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden"><input type="radio" id="cond_8" name="codicion" value="eq" /><label for="cond_8" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_9" name="codicion" value="contains" /><label for="cond_9" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.containsBtn"}).w('</label><input type="radio" id="cond_10" name="codicion" value="start" /><label for="cond_10" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.startsByBtn"}).w('</label><input type="radio" id="cond_11" name="codicion" value="end" /><label for="cond_11" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.endsByBtn"}).w('</label></div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden"><input type="radio" id="cond_12" name="codicion" value="bw" /><label for="cond_12" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_13" name="codicion" value="nbw" /><label for="cond_13" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_14" name="codicion" value="gt" /><label for="cond_14" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_15" name="codicion" value="lt" /><label for="cond_15" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_16" name="codicion" value="ge" /><label for="cond_16" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_17" name="codicion" value="le" /><label for="cond_17" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery-where tc-hidden"><input type="search" placeholder="').h("i18n",e,{},{$key:"query.searchFieldPhd"}).w('" class="tc-textbox" /><button type="button" title="').h("i18n",e,{},{$key:"query.tooltipAddCondBtn"}).w('" class="tc-button">').h("i18n",e,{},{$key:"query.textAddCondBtn"}).w('</button><ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul><div class="tc-ctl-wfsquery-key"><label>').h("i18n",e,{},{$key:"query.logicalOpLbl"}).w('</label></div><div class="tc-ctl-wfsquery-value"><input type="radio" id="log_op_1" class="tc-ctl-wfsquery-logOpRadio" checked name="log_op" value="AND" /><label for="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",e,{},{$key:"query.logicalOpAndLbl"}).w('</label><input type="radio" id="log_op_2" class="tc-ctl-wfsquery-logOpRadio" name="log_op" value="OR" /><label for="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",e,{},{$key:"query.logicalOpOrLbl"}).w('</label></div><div class="tc-ctl-wfsquery-whereList"></div></div></div>')}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-wfsquery-message tc-msg-warning">').h("i18n",e,{},{$key:"query.noAttributes"}).w("</div>")}r.__dustBody=!0;function n(t,e){return t.w('<select class="tc-combo" id="attributes" name="attributes"><option value="">').h("i18n",e,{},{$key:"query.chooseAttrCombo"}).w("</option>").h("iterate",e,{block:i},{on:e.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w("</select>")}n.__dustBody=!0;function i(t,e){return t.w('<option value="').f(e.get(["key"],!1),e,"h").w('">').f(e.get(["key"],!1),e,"h").w("</option>")}i.__dustBody=!0;return e};t.template[t.CLASS+"-filter"]=function(){dust.register(t.CLASS+"-filter",e);function e(t,e){return t.s(e.get(["conditions"],!1),e,{block:r},{})}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-wfsquery-where-cond">').f(e.get(["field"],!1),e,"h").w("&nbsp;").f(e.get(["opText"],!1),e,"h").w("&nbsp;").x(e.get(["isString"],!1),e,{block:n},{}).f(e.get(["valueToShow"],!1),e,"h",["numberSeparator"]).x(e.get(["isString"],!1),e,{block:i},{}).w('</div><div class="tc-ctl-wfsquery-del-cond" title="').h("i18n",e,{},{$key:"query.tooltipRemoveCond"}).w('"></div>\t')}r.__dustBody=!0;function n(t,e){return t.w("&quot;")}n.__dustBody=!0;function i(t,e){return t.w("&quot;")}i.__dustBody=!0;return e};t.template[t.CLASS+"-table-object"]=function(){dust.register(t.CLASS+"-table-object",e);function e(t,e){return t.h("isObject",e,{array:r,else:i,block:s},{object:e.getPath(!0,[])})}e.__dustBody=!0;function r(t,e){return t.w('<div class="complexAttr"><input type="checkbox" id="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('"><div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" title="" class="plus"></label><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" title="" class="title">').h("size",e,{},{key:e.getPath(!0,[])}).w("  ").h("i18n",e,{},{$key:"featureInfo.complexData.array"}).w('</label><table class="complexAttr"><tbody>').h("iterate",e,{block:n},{on:e.getPath(!0,[])}).w("</tbody></table></div></div>")}r.__dustBody=!0;function n(t,e){return t.w('<tr><td class="arrayNode">').p("tc-ctl-wfsquery-table-object",e,e.rebase(e.get(["value"],!1)),{}).w("</td></tr>")}n.__dustBody=!0;function i(t,e){return t.h("startsWith",e,{else:o,block:a},{key:e.getPath(!0,[]),value:"http"})}i.__dustBody=!0;function o(t,e){return t.w("<div>").f(e.getPath(!0,[]),e,"h",["numberSeparator"]).w("</div>")}o.__dustBody=!0;function a(t,e){return t.w('<a href="').f(e.getPath(!0,[]),e,"h").w('" target="_blank" title="').h("i18n",e,{},{$key:"linkInNewWindow"}).w('">').h("i18n",e,{},{$key:"open"}).w("</a>")}a.__dustBody=!0;function s(t,e){return t.w('<table class="complexAttr"><tbody>').h("iterate",e,{block:l},{on:e.getPath(!0,[])}).w("</tbody></table>")}s.__dustBody=!0;function l(t,e){return t.h("isKeyKalue",e,{else:c,block:p},{on:e.getPath(!0,[])})}l.__dustBody=!0;function c(t,e){return t.w('<tr><th style="display:none">').f(e.get(["key"],!1),e,"h").w("</th><td>").h("isObject",e,{array:u,else:h,block:d},{object:e.get(["value"],!1)}).p("tc-ctl-wfsquery-table-object",e,e.rebase(e.get(["value"],!1)),{}).w("</div></td></tr>")}c.__dustBody=!0;function u(t,e){return t.w('\x3c!--array--\x3e<div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" class="title">').f(e.get(["key"],!1),e,"h").w("</label><br />")}u.__dustBody=!0;function h(t,e){return t.w("<div>\x3c!--native--\x3e")}h.__dustBody=!0;function d(t,e){return t.w('\x3c!--object--\x3e<input type="checkbox" id="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('"><div><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" title="" class="plus"></label><label for="complexAttr_').f(e.getPath(!0,[]),e,"h",["objectId"]).w('" title="" class="title">').f(e.get(["key"],!1),e,"h").w("</label><br />")}d.__dustBody=!0;function p(t,e){return t.w('<tr class="keyValue"><th class="key">').f(e.get(["key"],!1),e,"h").w('</th><td class="value">').p("tc-ctl-wfsquery-table-object",e,e.rebase(e.get(["value"],!1)),{}).w("</td></tr>")}p.__dustBody=!0;return e};var S=function(t){var e=document.createElement("input");e.setAttribute("type",t);return e.type==t},E=function(t){var r=t[0],n=t[1],i=t[2];d=r;f=i;y=(y=i.Operations.DescribeFeatureType.DCP.HTTP.Get.href).substring(y.indexOf(":")+1);i.Operations.GetFeature.CountDefault?_maxRecordCount=i.Operations.GetFeature.CountDefault.DefaultValue:_maxRecordCount=null;var o=r.getDisgregatedLayerNames?r.getDisgregatedLayerNames():r.featureType;if((o=o.filter(function(t){return i.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))})).length>1){e.classList.remove("tc-loading");n.getElementsByClassName("tc-combo")[0].addEventListener("change",function(){if(this.value){n.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",n).classList.add(TC.Consts.classes.HIDDEN);g=this.options[this.selectedIndex].text;e.classList.add("tc-loading");p=this.value;d.describeFeatureType(this.value).then(function(t){var e=Object.entries(t);x(e.length>1?t:e[0][1],n)},function(){var t=n.getElementsByClassName("tc-modal-body")[0];t.classList.remove("tc-loading");t.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+v("query.LayerNotAvailable")+"</div>");c(t)})}else{var t=n.getElementsByClassName("tc-modal-form")[0];c(t);for(var r=0;r<t.children.length;r++)t.removeChild(t.children[r]);R()}})}else if(1===o.length){if(i.FeatureTypes[o[0].substring(o[0].indexOf(":")+1)]){g=i.FeatureTypes[o[0].substring(o[0].indexOf(":")+1)].Title;p=o[0];d.describeFeatureType(o[0]).then(function(t){var e=Object.entries(t);x(e.length>1?t:e[0][1],n)},function(){var t=n.getElementsByClassName("tc-modal-body")[0];t.classList.remove("tc-loading");t.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+v("query.LayerNotAvailable")+"</div>");c(t)})}else{var a=n.getElementsByClassName("tc-modal-body")[0];a.classList.remove("tc-loading");a.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+v("query.LayerNotAvailable")+"</div>")}}else{TC.Util.closeModal();r.map.toast(TC.Util.getLocaleString(r.map.options.locale,"query.LayerNotAvailable"),{type:TC.Consts.msgType.ERROR})}},w=null,b=null,L=function(t){if(S("date"))t.type="date";else{t.type="search";new Promise(function(t,e){"undefined"!=typeof IMask?setTimeout(function(){t()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");t()})}).then(function(){w=new IMask(t,{mask:Date,pattern:l&&"es-ES"!==l?"eu-ES"===l?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(t){var e=t.getDate(),r=t.getMonth()+1,n=t.getFullYear();e<10&&(e="0"+e);r<10&&(r="0"+r);switch(l){case"eu-ES":return[n,r,e].join("/");case"en-US":return[r,e,n].join("/");case"es-ES":default:return[e,r,n].join("/")}},parse:function(t){switch(l){case"eu-ES":return new Date(t.split("/")[1]+"/"+t.split("/")[2]+"/"+t.split("/")[0]);case"en-US":return new Date(t);case"es-ES":default:return new Date(t.split("/")[1]+"/"+t.split("/")[0]+"/"+t.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})}},A=function(){if(w){var t=w.el.input;w.destroy();w=null;t.value="";t.type="search"}},x=function(r,n){R();_internalGetDataTypes=function(){return r};let i={};for(var o in r)TC.Util.isGeometry(r[o].type)||(i[o]=r[o]);r=i;t.getRenderedHtml(t.CLASS+"-form",{attributes:r},function(t){var i=n.getElementsByClassName("tc-modal-form")[0];c(i);i.insertAdjacentHTML("beforeend",t);e.classList.remove("tc-loading");TC.loadJS(!0,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){console.log("autocomplete loaded")});var o=i.getElementsByClassName("tc-combo");if(0==o.length)n.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{n.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled");o[0].addEventListener("change",function(){P.apply(this,[i,r])});i.querySelector(".tc-ctl-wfsquery-where  input[type='radio']").addEventListener("change",function(){"OR"===this.value?TC.Consts.logicalOperator.OR:TC.Consts.logicalOperator.AND;i.getElementsByClassName("tc-ctl-wfsquery-whereList-op")[0].innerHTML=this.nextElementSibling.innerHTML});i.querySelector(".tc-button").addEventListener("click",function(){var t=i.querySelector("input.tc-textbox");TC.UI.autocomplete.call(t,"clear");b&&b.masked.remove();if(O(i)){var e,r,n=[].reduce.call(i.querySelectorAll(".tc-combo"),function(t,e){return t+(t?"/":"")+e.value},""),o=i.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked'),a=o.value,s=o.nextElementSibling.innerText,c=(e=t,b?b.unmaskedValue:w?w.unmaskedValue.substring(4)+"-"+w.unmaskedValue.substring(2,4)+"-"+w.unmaskedValue.substring(0,2):e.value),h=function(t){if(b)return b.value;if(w)return w.value;if("date"===t.type)return new Date(t.value).toLocaleDateString(l);if("number"===t.type){var e=1.1.toLocaleString(l).substring(1,2);return t.value.replace(".",e)}return t.value}(t);i.querySelector('.tc-ctl-wfsquery-where  input[type="radio"]:checked').nextElementSibling.innerText;c=c.replace("<","&lt;").replace(">","&gt;");(r=_.indexOf("dateTime")>=0?"nbw"!==a?new u[a](n,c+"T00:00:00Z",c+"T23:59:59Z"):new TC.filter.not(TC.filter.between(n,c+"T00:00:00Z",c+"T23:59:59Z")):new u[a](n,("end"===a||"contains"===a?"*":"")+c+("start"===a||"contains"===a?"*":""))).matchCase=!1;whereObjList.push(r);switch(!0){case _.indexOf("int")>=0:h=parseInt(c,10);break;case _.indexOf("float")>=0:case _.indexOf("double")>=0:case _.indexOf("long")>=0:case _.indexOf("decimal")>=0:h=parseFloat(c,10)}whereFilterList.push({field:n,opText:s,isString:_.indexOf("string")>=0,valueToShow:h});I(i);t.value=""}})}})},P=function(e,r){var n=this;n.parentElement.parentElement.querySelectorAll("select").forEach(function(t){n.offsetTop<t.offsetTop&&t.parentElement.parentElement.removeChild(t.parentElement)});var i=e.querySelector(".tc-ctl-wfsquery-where .tc-textbox");i.dataset.autocomplete&&TC.UI.autocomplete.call(i,"clear");if(r[this.selectedOptions[0].text]){_=r[this.selectedOptions[0].text].type;e.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.remove("tc-hidden");TC.UI.autocomplete.call(i,"clear");!function(){if(b){var t=b.el.input;b.destroy();b=null;t.value="";t.type="search"}}();i.type="search";e.querySelector(".tc-ctl-wfsquery-numeric").classList.add("tc-hidden");e.querySelector(".tc-ctl-wfsquery-text").classList.add("tc-hidden");e.querySelector(".tc-ctl-wfsquery-date").classList.add("tc-hidden");e.querySelector(".tc-ctl-wfsquery-where").classList.add("tc-hidden");switch(!0){case!_:console.log("type es nulo");break;case _ instanceof Object:(function(t,e){var r="";r+='<option value="">'+v("query.chooseAttrCombo")+"</option>";for(var n in t)t[n].type&&!TC.Util.isGeometry(t[n].type)&&(r+='<option value="'+(t[n].name||n)+'">'+n+"</option>");var i=document.createElement("div");i.insertAdjacentHTML("beforeend",'<select class="'+this.className+'" name="'+this.name+'">'+r+"</select>");this.parentNode.parentNode.insertBefore(i,this.parentNode.nextSibling).firstElementChild.addEventListener("change",function(){P.apply(this,[e,t])})}).apply(this,[_,e]);break;case _.indexOf("int")>=0:case _.indexOf("float")>=0:case _.indexOf("double")>=0:case _.indexOf("long")>=0:case _.indexOf("decimal")>=0:e.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.remove("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===e.querySelectorAll("tc-ctl-wfsquery-numeric input:checked").length&&(e.querySelector(".tc-ctl-wfsquery-numeric :first-child").checked=!0);A();if(S("number"))if(TC.Util.detectIE()){i.type="text";new Promise(function(t,e){"undefined"!=typeof IMask?setTimeout(function(){t()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");t()})}).then(function(){b=new IMask(i,{mask:Number,scale:_.indexOf("int")>=0||_.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:l&&"en-US"===l?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:l&&"en-US"===l?".":","})})}else{i.type="number";_.indexOf("int")>=0||_.indexOf("long")>=0?i.step="1":i.step="0.0001"}break;case _.indexOf("dateTime")>=0:e.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.remove("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===e.querySelectorAll("tc-ctl-wfsquery-date input:checked").length&&(e.querySelector(".tc-ctl-wfsquery-date :first-child").checked=!0);L(i);break;case _.indexOf("string")>=0:e.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.remove("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===e.querySelectorAll("tc-ctl-wfsquery-text input:checked").length&&(e.querySelector(".tc-ctl-wfsquery-text :first-child").checked=!0);A();const r=[].slice.call(e.querySelectorAll("select[name="+this.name+"]")).reduce(function(t,e){return t+(t?"/":"")+e.value},"");q(i,r,e.getElementsByClassName(t.CLASS+"-list tc-ctl-search-list")[0])}}else{e.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.add("tc-hidden");e.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.add("tc-hidden")}},I=function(e){dust.filters.numberSeparator||(dust.filters.numberSeparator=function(t){return t.toLocaleString(l)});TC._hbs&&!TC._hbs.helpers.numberSeparator&&TC._hbs.registerHelper("numberSeparator",function(t){return t.toLocaleString(l)});var r=e.getElementsByClassName("tc-ctl-wfsquery-whereList")[0];c(r);t.getRenderedHtml(t.CLASS+"-filter",{conditions:whereFilterList},function(t){e.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].innerHTML=t;for(var r=e.getElementsByClassName("tc-ctl-wfsquery-del-cond"),n=0;n<r.length;n++)r[n].addEventListener("click",function(){var t=Array.prototype.indexOf.call(r,this);whereObjList.splice(t,1);whereFilterList.splice(t,1);I(e)})})},R=function(){whereObjList=[];whereFilterList=[]},O=function(t){var e,r=t.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');if(w&&!w.masked.isComplete){!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&j("Fecha "+str+" inv\xe1lida",TC.Consts.msgType.ERROR);return!1}if(0==r.length){j(v("query.msgNoCondition"));return!1}if(t.querySelectorAll("input[type='date']").length&&!t.querySelector("input[type='date']").checkValidity()){j(v("query.msgNoValidDate"));return!1}if(t.querySelectorAll("input[type='number']").length&&null!=(e=t.querySelector("input[type='number']"))&&!e.checkValidity()){"1"===e.step?j(v("query.msgNoValidNumberMustInt")):j(v("query.msgNoValidNumber"));return!1}if(""===t.querySelector("input.tc-textbox").value.trim()){j(v("query.msgNoValueCondition"));return!1}return!0},M=function(){const t=this;if(U()){r.getElementsByClassName("tc-modal-body")[0].classList.add("tc-loading");!function(){var e=N();B.apply(t,[g]);d.toolProxification.cacheHost.getAction(y).then(function(r){const o=r.action(y);if(i){i.setVisibility(!1);i.clearFeatures();h.off(TC.Consts.event.LAYERUPDATE,D);h.on(TC.Consts.event.LAYERUPDATE,D);i.url=o;i.featurePrefix=p.substring(0,p.indexOf(":"));i.featureType=p.substring(p.indexOf(":")+1);i.properties=e;i.setVisibility(!0);i.refresh()}else{k({id:"WFSQueryResults",type:TC.Consts.layerType.WFS,url:o,version:"1.1.0",owner:t,stealth:!0,geometryName:"the_geom",featurePrefix:p.substring(0,p.indexOf(":")),featureType:p.substring(p.indexOf(":")+1),properties:e,outputFormat:TC.Consts.format.JSON,styles:m()});h.on(TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===n){TC.browserFeatures.touch()&&TC.Util.swipe(t.control.div,"enable");i.clearFeatures();i.setVisibility(!1);h.off(TC.Consts.event.LAYERUPDATE,D)}})}})}()}else j(v("query.msgNoQueryFilter"))},k=function(t){h.addLayer(t).then(function(t){i=t;t.map.on(TC.Consts.event.LAYERUPDATE,D)})},N=function(){if(whereObjList.length>1){var t=document.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;return TC.filter[TC.Consts.logicalOperator[t]].apply(null,whereObjList)}return 0===whereObjList.length?null:whereObjList[0]},D=function(t){if(t.layer==i){if(t.newData&&0===t.newData.totalFeatures){r.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");j(v("query.msgNoResults"),TC.Consts.msgType.INFO);return}var e=t.layer.features;if(e.length>0){h.zoomToFeatures(e);G(e.length>1?e.reduce(function(t,e,r){return(t instanceof Array?t:[t.data]).concat([e.data])}):[e[0].data],i,g)}else{r.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");j("No hay resultados",TC.Consts.msgType.INFO)}t.layer.map.off(TC.Consts.event.LAYERUPDATE,D)}};const F=()=>g;var B=function(t){const e=this;var r=t;new Promise(function(t,e){TC.control.ResultsPanel?t(TC.control.ResultsPanel):TC.loadJS(!0,TC.apiLocation+"TC/control/ResultsPanel",function(){t(TC.control.ResultsPanel)})}).then(function(t){if(n){n.options.save.fileName=r+".xls";n.options.titles.max=n.getLocaleString("geo.trk.chart.exp")}else{var i=function(t){n=t;delete dust.cache[n.CLASS+"-table"];n.template[n.CLASS+"-table"]=function(){dust.register(n.CLASS+"-table",t);function t(t,n){return t.w('<table class="table"><thead>').s(n.get(["columns"],!1),n,{block:e},{}).w("</thead><tbody>").s(n.get(["results"],!1),n,{block:r},{}).w("</tbody></table>")}t.__dustBody=!0;function e(t,e){return t.w("<th>").f(e.getPath(!0,[]),e,"h").w("</th>")}e.__dustBody=!0;function r(t,e){return t.w('<tr title="').h("i18n",e,{},{$key:"zoomToFeature"}).w('" data-id="').f(e.get(["Id"],!1),e,"h").w('" data-index="').f(e.get(["$idx"],!1),e,"h").w('" class="tc-selectable">').h("iterate",e,{block:i},{on:e.getPath(!0,[])}).w("</tr>")}r.__dustBody=!0;function i(t,e){return t.h("select",e,{block:o},{key:e.get(["key"],!1)})}i.__dustBody=!0;function o(t,e){return t.w('<td class="').f(e.get(["key"],!1),e,"h",["removeAccents","downcase"]).w('">').h("startsWith",e,{else:a,block:s},{key:e.get(["value"],!1),value:"http"}).w("</td>")}o.__dustBody=!0;function a(t,e){return t.p("tc-ctl-wfsquery-table-object",e,e.rebase(e.get(["value"],!1)),{})}a.__dustBody=!0;function s(t,e){return t.w('<a href="').f(e.get(["value"],!1),e,"h").w('" target="_blank" title="').h("i18n",e,{},{$key:"linkInNewWindow"}).w('">').h("i18n",e,{},{$key:"open"}).w("</a>")}s.__dustBody=!0;return t};n.options.titles.max=n.getLocaleString("geo.trk.chart.exp")},a=h.getControlsByClass(TC.control.ControlContainer);0==a.length?h.addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:r+".xls"},download:()=>{o(e,F)}}).then(i):a[0].addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:r+".xls"},download:()=>{o(e,F)},position:"right"}).then(i)}});var o=function(t,e){const r=t;new Promise(function(t,e){T?t(T):r.map.addControl("FeatureDownloadDialog").then(e=>{t(T=e)})}).then(function(t){var n={title:e()};n=!0!==r.options.displayElevation?Object.assign({},n,{elevation:Object.assign({},r.map.elevation&&r.map.elevation.options,r.options.displayElevation)}):Object.assign({},n,{elevation:r.map.elevation&&r.map.elevation.options});i.features.some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon})&&(n=Object.assign({},n,{excludedFormats:["GPX"]}));t.open(i.features,n)})}},G=function(t,e,i){n.div.querySelector(".prpanel-title-text").innerText=n.getLocaleString(t.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:t.length,layerName:i});n.div.classList.add("tc-ctl-wfsquery-results");r.parentElement.removeChild(r);n.openTable({data:t,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},callback:function(r){n.maximize();console.log("render del panel de resultados");var i=r.querySelectorAll(".table>tbody>tr"),o=_internalGetDataTypes(),a=1;for(var s in t[0]){if(o.hasOwnProperty(s)){if(o[s].type&&!(o[s].type instanceof Object)&&(o[s].type.indexOf("int")>=0||o[s].type.indexOf("float")>=0||o[s].type.indexOf("double")>=0||o[s].type.indexOf("long")>=0||o[s].type.indexOf("decimal")>=0))for(var l=r.querySelectorAll("td:nth-child("+a+")"),c=0;c<l.length;c++)l[c].classList.add("tc-numeric");o[s].type&&o[s].type instanceof Object&&console.log("aki lo que sea")}a++}for(s=0;s<i.length;s++){i[s].addEventListener("click",function(t){t.stopPropagation();var r=this.dataset.index;null!=r&&e.map.zoomToFeatures([e.features[r]])});i[s].addEventListener("mouseenter",function(){var t=this.dataset.index;if(null!=t){var r=e.features[t];r&&r.geometry&&H(r);var n=this.querySelectorAll("td.value div");n.length>0?n.forEach(function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)}):this.querySelectorAll("td").forEach(function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)})}});i[s].addEventListener("mouseleave",function(){var t=this.dataset.index;if(null!=t){var r=e.features[t];r&&r.geometry&&V(r)}})}r.querySelectorAll(".complexAttr label,.complexAttr input").forEach(function(t){t.addEventListener("click",function(t){t.stopPropagation()})});r.querySelectorAll(".complexAttr input").forEach(function(t){t.addEventListener("change",function(t){this.checked&&this.nextElementSibling.querySelectorAll("td.value div").forEach(function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)})})});TC.browserFeatures.touch()&&TC.Util.swipe(n.div,"disable")}})},U=function(){return whereObjList.length>0},j=function(t,r){var n=e.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(o)clearTimeout(o);else{n.innerHTML=t;switch(r){case TC.Consts.msgType.INFO:n.classList.add("tc-msg-info");break;case TC.Consts.msgType.WARNING:n.classList.add("tc-msg-warning");break;case TC.Consts.msgType.ERROR:default:n.classList.add("tc-msg-error")}n.classList.remove(TC.Consts.classes.HIDDEN)}o=setTimeout(function(){o=null;n.classList.add(TC.Consts.classes.HIDDEN)},3e3)},q=function(t,e,r){TC.UI.autocomplete.call(t,{minLength:3,target:r,source:function(t,r){var n=this;n.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+v("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';n.target.classList.remove("tc-hidden");a&&window.clearTimeout(a);a=window.setTimeout(async function(){var i=await async function(t,e){var r=Object.assign({},f);r.version="1.1.0";switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"start":e+="*";break;case"contains":case"eq":e="*"+e+"*";break;case"end":e="*"+e}s&&s.abort();let n=(s=new AbortController).signal;try{var i=await d.toolProxification.fetchJSON(y,{data:TC.Util.WFSQueryBuilder([p],TC.filter.like(t,e,void 0,void 0,void 0,!1),r,"JSON",!1),contentType:"application/xml",method:"POST",signal:n});if(i.features&&i.features.length>0){var o;1===i.features.length&&(o=[t.split("/").reduce(function(t,e){return t[e.substring(e.indexOf(":")+1)]},i.features[0].properties)]);i.features.length>1&&(o=i.features.reduce(function(e,r){if(e&&e instanceof Array)return e.indexOf(r.properties[t])<0?e.concat(t.split("/").reduce(function(t,e){return t[e.substring(e.indexOf(":")+1)]},r.properties)):e},[]));return o}return[]}catch(t){return null}}(e,t);i&&(i.length?r(i):n.target.classList.add("tc-hidden"))},500)},callback:function(e){t.value=e.currentTarget.dataset.value;this.target.classList.add("tc-hidden")},buildHTML:function(e){var r=t.value;this.target.style.maxHeight="";return e.results.length>1?e.results.reduce(function(t,e,n){return(n>1?t:W(t,r))+W(e,r)}):W(e.results[0],r)}});t.addEventListener("targetCleared.autocomplete",function(){r.classList.add("tc-hidden")});t.addEventListener("keypress",function(e){13==e.which&&TC.UI.autocomplete.call(t,"clear")});t.addEventListener("search",function(e){0===t.value.length&&TC.UI.autocomplete.call(t,"clear")});t.addEventListener("input",function(e){0===t.value.length&&TC.UI.autocomplete.call(t,"clear")})},W=function(t,e){e=new RegExp(e,"gi");return'<li><a href="#" data-value="'+t+'">'+t.replace(e,"<b>$&</b>")+"</a></li>"},H=function(t){var e=function(t,e){var r;e instanceof TC.feature.Point?r=t.addPoint(e.getCoords()):e instanceof TC.feature.Polyline?r=t.addPolyline(e.getCoords()):e instanceof TC.feature.Polygon?r=t.addPolygon(e.getCoords()):e instanceof TC.feature.MultiPolygon?r=t.addMultiPolygon(e.getCoords()):e instanceof TC.feature.MultiPolyline&&(r=t.addMultiPolyline(e.getCoords()));return r};if(t.layer){var r=t.layer.map.getLayer("WFSQueryResultsHighlight");r?e(r,t):t.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:TC.Consts.layerType.VECTOR,owner:self,stealth:!0,styles:C()},function(r){e(r,t)})}},V=function(t){var e=t.layer.map.getLayer("WFSQueryResultsHighlight");e&&e.clearFeatures()};t.render=function(t){return TC.Control.prototype.render.call(this,t)};t.register=function(t){const e=this;h=t;return new Promise(function(n){t.on(TC.Consts.event.LAYERERROR,t=>{if(t.layer===i){r.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");if(t.reason===TC.Consts.WFSErrors.MAX_NUM_FEATURES)j(v("query.msgTooManyResults",{limit:t.data.limit}),TC.Consts.msgType.WARNING);else{console.error(t.reason);j(v("query.errorUndefined"),TC.Consts.msgType.ERROR)}}});dust.helpers.countif=function(t,e,r,n){n=n||{};var i=r.block,o=r.else,a=n.key||e.current(),s=null!=n.excludedKeys?n.excludedKeys.split(","):null,l=0;for(var c in a)(null==s||s.indexOf(c)<0)&&l++;l>0?t=t.render(i,e):o&&(t=t.render(o,e));return t};TC._hbs&&TC._hbs.registerHelper("countif",function(t,e){const r=e?e.split(","):[];let n=0;for(let e in t)r.indexOf(e)<0&&n++;return n>0});TC.Control.prototype.register.call(e,h).then(function(t){var e=t;m=function(){var t=function(t,e){return this.options.styles&&this.options.styles[t]&&this.options.styles[t][e]||TC.Cfg.styles[t][e]};return{polygon:{fillColor:t.bind(e,"polygon","fillColor"),fillOpacity:t.bind(e,"polygon","fillOpacity"),strokeColor:t.bind(e,"polygon","strokeColor"),strokeOpacity:t.bind(e,"polygon","strokeOpacity"),strokeWidth:t.bind(e,"polygon","strokeWidth")},line:{strokeColor:t.bind(e,"line","strokeColor"),strokeOpacity:t.bind(e,"line","strokeOpacity"),strokeWidth:t.bind(e,"line","strokeWidth")},point:{radius:t.bind(e,"point","radius"),height:t.bind(e,"point","height"),width:t.bind(e,"point","width"),fillColor:t.bind(e,"point","fillColor"),fillOpacity:t.bind(e,"point","fillOpacity"),strokeColor:t.bind(e,"point","strokeColor"),strokeWidth:t.bind(e,"point","strokeWidth"),fontSize:t.bind(e,"point","fontSize"),fontColor:t.bind(e,"point","fontColor"),labelOutlineColor:t.bind(e,"point","labelOutlineColor"),labelOutlineWidth:t.bind(e,"point","labelOutlineWidth"),label:t.bind(e,"point","label"),angle:t.bind(e,"point","angle")}}};C=function(){var t={polygon:TC.Util.extend(!0,{},TC.Cfg.styles.polygon,{fillColor:"#0099FF",fillOpacity:1,strokeColor:"#0099FF",strokeWidth:2}),line:TC.Util.extend(!0,{},TC.Cfg.styles.line,{strokeColor:"#0099FF",strokeWidth:2}),point:TC.Util.extend(!0,{},TC.Cfg.styles.point,{strokeColor:"#0099FF"})};return e.highlightStyles?{polygon:TC.Util.extend(!0,{},t.polygon,e.highlightStyles.polygon?e.highlightStyles.polygon:{}),line:TC.Util.extend(!0,{},t.line,e.highlightStyles.line?e.highlightStyles.line:{}),point:TC.Util.extend(!0,{},t.point,e.highlightStyles.point?e.highlightStyles.point:{})}:t};l=h.options.locale;v=function(t,e){return TC.Util.getLocaleString(l,t,e)};h.ready(function(){h.getControlsByClass("TC.control.WorkLayerManager").forEach(function(t){t.addLayerTool({renderFn:function(t,r){const n=e.CLASS+"-btn-open";let i=t.querySelector("button."+n);if(!i){const o=h.getLayer(r);if(o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WFS){const a=e.getLocaleString("query.tooltipMagnifBtn");(i=document.createElement("button")).innerHTML=a;i.setAttribute("title",a);i.classList.add(n);i.dataset.layerId=r;t.appendChild(i);if(o.type===TC.Consts.layerType.WMS){i.classList.add(TC.Consts.classes.LOADING);o.getWFSCapabilities().then(t=>{if(t.Operations.GetFeature){var e=o.getDisgregatedLayerNames?o.getDisgregatedLayerNames():o.featureType;(e=e.filter(function(e){return t.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))})).length||i.classList.add(TC.Consts.classes.HIDDEN)}else i.classList.add(TC.Consts.classes.HIDDEN)}).catch(()=>i.classList.add(TC.Consts.classes.HIDDEN)).finally(()=>i.classList.remove(TC.Consts.classes.LOADING))}}}return i},updateEvents:[],actionFn:function(){if(this.classList.contains("tc-unavailable")||this.classList.contains("tc-loading"))return;const t=e.map.getLayer(this.dataset.layerId);e.renderModalDialog(t)}})})});n(e)})})};t.renderModalDialog=function(n){const i=this;let o,a;if(n.type===TC.Consts.layerType.WMS){const t=n.getPath();o=t[t.length-1];a=n.getWFSCapabilities()}else{if(n.type!==TC.Consts.layerType.WFS)return;o=n.title;a=n.getCapabilitiesPromise()}let s=new Promise(function(s,l){a.then(function(a){(function(n,i,o,a){const s=this;let l;if(n.getDisgregatedLayerNames){l=[];n.getDisgregatedLayerNames().forEach(function(t,e){var r=n.getPath(t);o.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))&&l.push({name:t,title:r[r.length-1]})});l.sort(function(t,e){return t.title<e.title?-1:t.title>e.title?1:0})}else l=n.featureType;t.getRenderedHtml(t.CLASS+"-dialog",{layerName:v("query.titleDialog",{layerName:i}),layers:l},function(t){var n=document.createElement("div");n.insertAdjacentHTML("beforeEnd",t);var i=null;if(n.childNodes.length>0){i=n.firstChild;document.body.appendChild(i)}(e=i.getElementsByClassName("tc-modal-body")[0]).classList.add("tc-loading");TC.Util.showModal(i,{closeCallback:function(){i.parentElement.removeChild(i)}});if(TC.Util.detectIE()){var o=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:o=.8;case document.body.clientWidth>1140:o=.7}e.style.maxHeight=document.body.clientHeight*o-e.nextElementSibling.clientHeight-e.previousElementSibling.clientHeight}r=i;i.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",function(){M.apply(s,[])});a&&a(i)})}).apply(i,[n,o,a,function(t){s(t)}])})});Promise.all([n,s,a]).then(E)}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var t={},e=null;const r=function(t){return new Promise(function(r,n){e&&e.options.url===t?r(e):TC.loadJS(!TC.layer.Vector,TC.apiLocation+"TC/layer/Vector",function(){e=new TC.layer.Vector({type:TC.Consts.layerType.WFS,url:t,stealth:!0});r(e)})})},n=function t(e,r){var n=e.availableNames.indexOf(r.name);if(-1===n)for(var i=0,o=r.children.length;i<o&&-1===(n=t(e,r.children[i]));i++);return n},i=function t(e,r,n){var i=!1;n.count=n.count+1;if(e.name===r)i=!0;else for(var o=e.children.length-1;o>=0;o--)if(t(e.children[o],r,n)){i=!0;break}return i};TC.layer.Raster=function(){var e=this;TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");this.toolProxification=new TC.tool.Proxification(TC.proxify);this._capabilitiesPromise=null;TC.Layer.apply(e,arguments);e.wrap=new TC.wrap.layer.Raster(e);e.transparent=!1!==e.options.transparent;e.url=e.options.url;e.capabilities=TC.capabilities[e.url];e.params=e.options.params;if("string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else{e.names=[];e.availableNames=[];if(Array.isArray(e.options.layerNames))for(var r=0;r<e.options.layerNames.length;r++){if("string"==typeof(s=e.options.layerNames[r])){e.names.push(s);e.availableNames.push(s)}else if(s.hasOwnProperty("name")){e.availableNames.push(s.name);(void 0===s.isVisible||s.isVisible)&&e.names.push(s.name)}}else{var n=e.options.params?e.options.params.sld_body:null;if(n){const t=new DOMParser;var i;try{i=t.parseFromString(n,"text/xml")}catch(t){TC.error(t.message);i=null}if(i){var o=TC.Util.getElementByNodeName(i,"sld:NamedLayer");if(o&&o.length>0){var a=TC.Util.getElementByNodeName(o[0],"sld:Name");if(a&&a.length>0){var s=a[0].textContent;e.names.push(s);e.availableNames.push(s)}}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes||e.options.ignorePrefixes;e._capabilitiesNodes={};e.wrap._promise=new Promise(function(r,n){var i=function(){var t,i;if(!e.wrap.layer){switch(e.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:t=(i=e).wrap.createWMTSLayer(i.options);break;default:t=function(t){var e=Array.isArray(t.names)?t.names.join(","):t.names,r=t.options.format,n=t.options,i={LAYERS:e,FORMAT:r,TRANSPARENT:t.transparent,VERSION:t.capabilities.version||"1.3.0"};t.params&&TC.Util.extend(i,t.params);t.queryParams&&TC.Util.extend(i,t.queryParams);var o=t.getPreferredInfoFormat();null!==o&&(i.INFO_FORMAT=o);return t.wrap.createWMSLayer(t.getGetMapUrl(),i,n)}(e)}e.wrap.setLayer(t);t?r(t):n(Error('Could not create native layer for "'+e.id+'"'))}};const o=function(t){e.capabilities=e.capabilities||t;var r=e.getGetMapUrl();TC.capabilities[e.options.url]=TC.capabilities[e.options.url]||t;TC.capabilities[r]=TC.capabilities[r]||t;i()};if(e.capabilities){o(e.capabilities);e._capabilitiesPromise=Promise.resolve(e.capabilities);return}const a=t[e.url];t[e.url]=e._capabilitiesPromise=a||new Promise(function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then(function(e){t(e)}).catch(function(t){i.catch(function(){r(t)})});i.then(function(e){t(e)}).catch(function(){n.catch(function(t){r(t)})})});e.getCapabilitiesPromise().then(function(t){o(t)}).catch(function(t){e.map&&e.map.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"});n(t)})});e._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==e.type&&e.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);var o=TC.layer.Raster.prototype;o.capabilitiesState_={PENDING:0,DONE:1};o.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";o.getByProxy_=function(t){return TC.proxify(t)};o.getByUrl_=function(t){return t};o.setVisibility=function(t){this.tree=null;this._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(this,t)};var a=function t(e,r,n){var i=!1,o=e.wrap.getLayerNodes(n);if(o.length){for(var a=0,s=o.length;a<s;a++)t(e,r,o[a])&&(i=!0);var l,c,u=o.map(function(t){return e.wrap.getName(t)}).reverse(),h=!1;c=l=r.indexOf(u[0]);if(l<0)h=!0;else for(a=1,s=u.length;a<s;a++)if(u[a]!=r[++l]){h=!0;break}if(!h){var d=e.wrap.getName(n);if(d&&u.length>1){r.splice(c,u.length,d);i=!0}}}return i},s=function(t,e){for(var r=[],n=e.slice(),i=t.wrap.getRootLayerNode(),o=0,a=n.length;o<a;o++)r=r.concat(l(t,n[o],i));return r},l=function t(e,r,n,i){for(var o=[],a=e.wrap.getName(n),s=e.compareNames(r,a),l=!1,c=e.wrap.getLayerNodes(n),u=0;u<c.length;u++){var h=t(e,r,c[u],i||s);h.length?o=o.concat(h):l=!0}c.length&&!l||(i||s)&&(o=[a]);return o},c=function(t){return TC.Util.extend({aggregate:!0,lazy:!1},t)},u=function(t,e,r){var n,i,o=[];n=e||[];i=r||[];for(var a=(t||[]).concat(n),s=0;s<a.length;s++)a.indexOf(a[s])===s&&-1===i.indexOf(a[s])&&(o[o.length]=a[s]);return o},h=function(t,e){var r="string"==typeof e?e.split(","):e;if(t.capabilities){var n=t.getTree();r.sort(function(t,e){var r={count:0},o={count:0};i(n,t,r);i(n,e,o);return r.count-o.count})}return r},d=function(t,e,r,n){return r.filter(function(r){return t.compareNames(e,r,n)}).length>0};o.getLimitedMatrixSet=function(){return function(t){var e=t.layerNames,r=t.matrixSet,n=t.capabilities,i=[],o=n.Contents.TileMatrixSet.filter(function(t){return t.Identifier==r});if(o.length){o=o[0];var a=n.Contents.Layer.filter(function(t){return t.Identifier==e})[0];if(a.TileMatrixSetLink&&a.TileMatrixSetLink.length&&a.TileMatrixSetLink[0].TileMatrixSetLimits){for(var s,l=a.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){s=l[c];var u=o.TileMatrix.filter(function(t){return t.Identifier==s.TileMatrix});if(u.length){var h=TC.Util.extend({matrixIndex:o.TileMatrix.indexOf(u[0])},u[0],s);i.push(h)}}return i}return o.TileMatrix}return null}(this)};o.setLayerNames=function(t,e){var r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=Array.isArray(t)?t:t.split(",");r.names=i;var o=c(e);o.aggregate&&(i=function(t,e){if(t.type!==TC.Consts.layerType.WMS)return e;var r=e.slice();a(t,r,t.wrap.getRootLayerNode());return r}(r,i));r._disgregatedLayerNames=null;var s={LAYERS:i.join(","),TRANSPARENT:!0};if(o.lazy){var l=r._newParams||r.wrap.getParams();r._newParams=TC.Util.extend(l,s)}else{r.map&&r.map.trigger(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:r});r.tree=null;r._cache.visibilityStates={};r.wrap.setParams(s);!o.reset&&r.map||(r.availableNames=r.names);r.map&&r.map.trigger(TC.Consts.event.UPDATEPARAMS,{layer:r})}n(r.names)})})};o.addLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=c(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=s(r,o);a=r.getDisgregatedLayerNames()}r.setLayerNames(h(r,u(a,o,null)),e).then(function(t){n(t)})})})};o.removeLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=c(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=s(r,o);a=r.getDisgregatedLayerNames()}r.setLayerNames(h(r,u(a,null,o)),e).then(function(t){n(t)})})})};o.toggleLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=c(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=s(r,o);a=r.getDisgregatedLayerNames()}for(var l=[],u=[],h=0;h<o.length;h++){var d=o[h];a.indexOf(d)<0?l[l.length]=d:u[u.length]=d}var p=[];l.length>0&&p.push(r.addLayerNames(l,i));u.length>0&&p.push(r.removeLayerNames(u,i));Promise.all(p).then(function(t){const e=t[0],r=t[1];n(e?r?e.concat(r):e:[])})})})};o.getDisgregatedLayerNames=function(){var t=this.wrap.layer;if(this.wrap.isNative(t)&&this.type===TC.Consts.layerType.WMS){if(!this._disgregatedLayerNames){var e=this.wrap.getParams().LAYERS;e=Array.isArray(e)?e:e.split(",");this._disgregatedLayerNames=s(this,e)}}else this._disgregatedLayerNames=this.names;return this._disgregatedLayerNames.slice()};o.isValidFromNames=function(){for(var t=!0,e=0,r=this.names.length;e<r;e++)if(!this.getLayerNodeByName(this.names[e])){t=!1;break}return t};o.isCompatible=function(t){var e=!1;switch(this.type){case TC.Consts.layerType.WMTS:e=this.wrap.isCompatible(t)||this.wrap.getCompatibleMatrixSets(t).length>0;break;case TC.Consts.layerType.WMS:e=this.wrap.isCompatible(t)}return e};o.getCompatibleCRS=function(t){const e=this;t=t||{};var r=e.wrap.getCompatibleCRS();if(t.includeFallback&&e.fallbackLayer){const t=e.getFallbackLayer();t instanceof TC.Layer&&(r=r.concat(t.wrap.getCompatibleCRS()))}t.normalized&&(r=r.map(function(t){return TC.Util.getCRSCode(t)}).filter(function(t){return null!==t}).reduce(function(t,e){t.indexOf(e)<0&&(t[t.length]=e);return t},[]).map(function(t){return"EPSG:"+t}));return r};o.getProjection=function(){switch(this.type){case TC.Consts.layerType.WMTS:return this.wrap.layer.getSource().getProjection().getCode();case TC.Consts.layerType.WMS:return this.map.crs}};o.setProjection=function(t){if((t=t||{}).crs)switch(this.type){case TC.Consts.layerType.WMTS:var e=this.wrap.getCompatibleMatrixSets(t.crs)[0];if(e){this.matrixSet=e;this.wrap.setMatrixSet(e)}else this.wrap.setProjection(t);this.mustReproject=!e;break;case TC.Consts.layerType.WMS:this.wrap.setProjection(t);this.mustReproject=!this.isCompatible(t.crs)}};o.isVisibleByScale=function(t,e){var r,n,i,o=this,a=function(){return o.map.wrap.getResolution()*o.map.getMetersPerUnit()/28e-5};switch(o.type){case TC.Consts.layerType.WMTS:r=!1;var s=o.wrap.getTileMatrix(o.options.matrixSet);if(s){n=a();for(i=0;i<s.length;i++){if((h=o.wrap.getScaleDenominators(s[i]))[0]===n){r=!0;break}}}break;case TC.Consts.layerType.WMS:r=!0;var l=o.wrap.getAllLayerNodes();if(l.length>0){n=a();var c;if(parseInt(t).toString()===t)c=o._capabilitiesNodes[t];else for(i=0;i<l.length;i++){var u=l[i];if(o.compareNames(o.wrap.getName(u),t,e)){c=u;break}}if(c){var h=o.wrap.getScaleDenominators(c);if(!(r=!(parseFloat(h[1])>n||parseFloat(h[0])<n))&&c.Layer&&c.Layer.length>0)return c.Layer.some(function(t){var e=o.wrap.getScaleDenominators(t);return!(parseFloat(e[1])>n||parseFloat(e[0])<n)})}}break;default:r=!0}return r};o.isVisibleByName=function(t,e){var r=this,n=!1;switch(r.type){case TC.Consts.layerType.WMTS:if(r.wrap.getWMTSLayer()){n=!0;break}break;case TC.Consts.layerType.WMS:var i=function t(n,i){var o=null,a=r.wrap.getName(i);if(r.compareNames(a,n,e))o=[a];else for(var s=r.wrap.getLayerNodes(i),l=0;l<s.length;l++){var c=t(n,s[l]);if(c){TC.Util.fastUnshift(c,a);o=c;break}}return o},o=function(t){return i(t,r.wrap.getRootLayerNode())}(t);if(o)for(var a=0;a<o.length;a++)if(d(r,o[a],r.names)){n=!0;break}break;default:n=!0}return n};o.getTree=function(){var t=this,e=t.tree;if(!e){var r,i=function e(n,i,o){var a;for(var s in t._capabilitiesNodes)if(t._capabilitiesNodes[s]===n){a=s;break}if(!a){a=TC.getUID();t._capabilitiesNodes[a]=n}var l,c,u={name:t.wrap.getName(n),title:n.title||n.Title,uid:a,children:[]};o&&(r=u);d(t,u.name,t.availableNames)&&(i=!0);if(t.options.isBase){u.name=t.names.join(",");u.title=t.title||u.title;u.isBase=t.isDefault;t.options.thumbnail&&(u.legend={src:t.options.thumbnail})}else{u.isVisible=u===r?t.getVisibility():t.isVisibleByName(u.name);var h,p=t.wrap.getLayerNodes(n);for(h=0;h<p.length;h++){var f=e(p[h],i);f&&(l=u,c=f,t.options.inverseTree?TC.Util.fastUnshift(l.children,c):l.children[l.children.length]=c)}u.legend=t.wrap.getLegend(n);if(!i&&!o){r.children=r.children.concat(u.children);u=null}}return u};switch(t.type){case TC.Consts.layerType.WMTS:e=i(t.wrap.getWMTSLayer(),!t.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(t.capabilities){e=i(t.wrap.getRootLayerNode(),!t.options.hideTree,!0);var o=t._cache.visibilityStates;!function t(e){var r=TC.Consts.visibility.NOT_VISIBLE;if(e){if(void 0!==o[e.uid])r=o[e.uid];else{if(e.children)for(var n=!1,i=!1,a=0,s=e.children.length;a<s;a++){switch(t(e.children[a])){case TC.Consts.visibility.VISIBLE:n=!0;break;case TC.Consts.visibility.NOT_VISIBLE:i=!0;break;case TC.Consts.visibility.HAS_VISIBLE:n=!0;i=!0}n&&(r=i?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}e.isVisible&&(r=TC.Consts.visibility.VISIBLE);o[e.uid]=r}e.visibilityState=r}return r}(e);t.options.hideTree&&function t(e,r){r.children.sort(function(t,r){return n(e,r)-n(e,t)});for(var i=0,o=r.children.length;i<o;i++)t(e,r.children[i])}(t,e)}}e||(e={name:t.name,title:t.title});e.title=t.title||e.title;e.customLegend=t.customLegend||e.customLegend;t.tree=e}return e};o.setNodeVisibility=function(t,e){var r=this;r.tree||(r.tree=r.getTree());var n=r.findNode(t,r.tree);if(n===r.tree)e&&0===r.names.length?r.addLayerNames(r.availableNames).then(function(){r.setVisibility(!0)}):r.setVisibility(e);else{var i=function t(e){var r=[];if(e.name)r[0]=e.name;else for(var n=0;n<e.children.length;n++)r=r.concat(t(e.children[n]));return r}(n);e?r.addLayerNames(i):r.removeLayerNames(i)}};o.getNodeVisibility=function(t){this.tree||(this.tree=this.getTree());return this._cache.visibilityStates[t]};o.getNodePath=function(t,e){var r=this,n=[];if(r.type===TC.Consts.layerType.WMS&&r.capabilities){t=t||r.names[0];n=function n(i){var o=[],a=r.wrap.getName(i);if(r.compareNames(a,t,e))o.push(i);else for(var s=r.wrap.getLayerNodes(i),l=0;l<s.length;l++){var c=n(s[l]);if(c.length){o=c;TC.Util.fastUnshift(o,i);break}}return o}(r.wrap.getRootLayerNode())}return n};o.getPath=function(t,e){return this.getNodePath(t,e).map(function(t){return t.title||t.Title})};o.getLayerNodeByName=function(t){for(var e=null,r=this.wrap.getServiceType()===TC.Consts.layerType.WMTS?this.wrap.getIdentifier:this.wrap.getName,n=this.wrap.getAllLayerNodes(),i=0,o=n.length;i<o;i++)if(this.compareNames(r(n[i]),t)){e=n[i];break}return e};o.getChildrenLayers=function(t){var e=[],r=function(t,e){if(t&&t.Layer&&t.Layer.length)for(var n=0;n<t.Layer.length;n++){e[e.length]=t.Layer[n];r(t.Layer[n],e)}};r(t,e);return e};o.compareNames=function(t,e,r){var n=t===e,i=void 0!==r?r:this.ignorePrefixes;if(!n&&i&&t&&e){var o=t.indexOf(":"),a=e.indexOf(":");o>=0&&a<0?n=t.substr(o+1)===e:a>=0&&o<0&&(n=t===e.substr(a+1))}return n};o.getCapabilitiesPromise=function(){return this._capabilitiesPromise};o.getResolutions=function(){return this.wrap.getResolutions()};o.setResolutions=function(t){this.wrap.setResolutions(t)};o.searchSubLayers=function(t){this.patternFn||(this.patternFn=function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/[^a-z\d\xe1\xe9\xed\xf3\xfa\xfc\xf1]/gi,"\\$&")).replace(/(a|\xe1)/gi,"(a|\xe1)")).replace(/(e|\xe9)/gi,"(e|\xe9)")).replace(/(i|\xed)/gi,"(i|\xed)")).replace(/(o|\xf3)/gi,"(o|\xf3)")).replace(/(u|\xfa|\xfc)/gi,"(u|\xfa|\xfc)")).replace(/n/gi,"(n|\xf1)")});if(t&&t.length&&t.length>=3){var e=this,r=null;if(this.lastPattern&&t.indexOf(this.lastPattern)>=0)r=this.lastMatches;else if(e.availableNames&&e.availableNames.length>0){r=[];for(var n=0;n<e.availableNames.length;n++){var i=e.getLayerNodeByName(e.availableNames[n]);if(i){r[r.length]=i;r=r.concat(e.getChildrenLayers(i))}}}else r=e.wrap.getAllLayerNodes();var o=this.patternFn(t),a=new RegExp(o,"i"),s=r.map(function(t,r){delete t.tcScore;t.tcPosition=r;e.wrap.normalizeLayerNode(t);var n=t.Title.trim(),i=a.exec(n),o=i?i.index:-1,s=-1;if(t.Abstract){var l=t.Abstract.trim(),c=a.exec(l);s=c?c.index:-1}i&&n==i[0]?t.tcScore=20:0==o?t.tcScore=15:o>-1?t.tcScore=10:0==s?t.tcScore=5:s>-1&&(t.tcScore=1);return t.tcScore?t:null}).filter(function(t){return null!=t}).sort(function(t,e){if(e.tcScore===t.tcScore){var r=TC.Util.replaceAccent(t.Title),n=TC.Util.replaceAccent(e.Title);return r<n?-1:r>n?1:0}return e.tcScore-t.tcScore});this.lastPattern=t;this.lastMatches=s;return s}return[]};o.getGetCapabilitiesUrl=function(){const t=this;var e;const r=t.url,n={};if(t.type===TC.Consts.layerType.WMTS)if(t.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var i="/1.0.0/WMTSCapabilities.xml";const t=r.indexOf(i);if(t<0||t<r.length-i.length){"/"===r[r.length-1]&&(i=i.substr(1));e=r+i}else e=r}else{e=r;n.SERVICE="WMTS";n.VERSION="1.0.0";n.REQUEST="GetCapabilities"}else{e=r;n.SERVICE="WMS";n.VERSION="1.3.0";n.REQUEST="GetCapabilities"}return e=e+"?"+TC.Util.getParamString(TC.Util.extend(n,t.queryParams))};o.getPreferredInfoFormat=function(){var t=null;const e=this.wrap.getInfoFormats();if(e)for(var r=0;r<TC.wrap.layer.Raster.infoFormatPreference.length;r++){var n=TC.wrap.layer.Raster.infoFormatPreference[r];if(e.indexOf(n)>=0){t=n;break}}return t};o.getLegendGraphicImage=function(){const t=this;return new Promise(function(e,r){if(t.options.params.base64LegendSrc)return e(t.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var n=t.names[0],i=t.wrap.getInfo(n),o=new XMLHttpRequest,a=i.legend[0].src.split("?"),s=a[1].split("&"),l=t.options.params.sld_body?"sld_body="+t.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}t.options.params.env&&(l+="&"+t.options.params.env);o.open("POST",a[0],!0);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.responseType="arraybuffer";o.onload=function(r){if(200===this.status){for(var n=new Uint8Array(this.response),i=n.length,a=new Array(i);i--;)a[i]=String.fromCharCode(n[i]);var s=a.join(""),l=o.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(s);t.options.params.base64LegendSrc=c;e(c)}}};o.send(l)}else r(Error("Funci\xf3n window.btoa no soportada por el navegador"))})};o.getUrl=function(t){return t};o.getWebGLUrl=function(t,e){const r=this;return new Promise(function(e,n){var i=!TC.Util.isSecureURL(t)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(r.url))?r.getBySSL_(t):t;if(r.ignoreProxification)e(i);else{const t={exportable:!0,ignoreProxification:r.ignoreProxification};r.toolProxification.fetchImage(i,t).then(function(){r.toolProxification.cacheHost.getAction(i,t).then(function(t){t&&t.action&&e(t.action.call(r.toolProxification,i))})}).catch(function(t){n(Error(t))})}})};o.getFeatureUrl=function(t){var e=this;return e.toolProxification.fetch(t).then(function(){return e.toolProxification.cacheHost.getAction(t).then(function(r){return r.action.call(e.toolProxification,t)}).catch(function(t){return Promise.reject(t)})}).catch(function(t){return Promise.reject(t)})};o.getSiblingLoadedLayer=function(t){var e=this;if(e.map){return e.map.baseLayers.slice(0).concat(e.map.workLayers.slice(0)).filter(function(r){return(r.type===TC.Consts.layerType.WMS||r.type===TC.Consts.layerType.WMTS)&&(r.capabilities===e.capabilities||r.url===e.url)&&(!TC.Util.isFunction(t)||t(r))})[0]||null}return null};o.getImageLoad=function(t,e,r){const n=this,i=function(e){const r=t.getImage();TC.Util.isSameOrigin(e.src)||(!n.map||n.map&&n.map.mustBeExportable)&&(r.crossOrigin=null!==e.crossOrigin?e.crossOrigin:"anonymous");r.setAttribute("src",e.src);r.onload=function(){p.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})};r.onerror=function(e){r.setAttribute("src",TC.Consts.BLANK_IMAGE);p.call(n).trigger(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}})}};if(n.names&&n.names.length>0){const r=function(e){p.call(n).trigger(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}});i({src:TC.Consts.BLANK_IMAGE})};if(n.type===TC.Consts.layerType.WMTS){var o,a,s;if("KVP"!=n.encoding){var l=e.replace("."+n.format.split("/")[1],"");o=(c=l.split("/").slice(l.split("/").length-3).map(function(t){return parseInt(t)}))[0];a=c[1];s=c[2]}else{var c;if((c=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(e))&&4==c.length){o=(c=c.slice(1).map(function(t){return parseInt(t)}))[0];a=c[2];s=c[1]}}if(o&&a&&s){var u=n.wrap.getWMTSLayer();if(u){var h=u.TileMatrixSetLink.filter(function(t){return t.TileMatrixSet===n.matrixSet});if(h.length>0&&h[0].TileMatrixSetLimits.length>0){var d=h[0].TileMatrixSetLimits.sort(function(t,e){return parseInt(t.TileMatrix)>parseInt(e.TileMatrix)?1:parseInt(t.TileMatrix)<parseInt(e.TileMatrix)?-1:0})[o];if(d&&n.map&&n.map.on3DView&&!(d.MinTileRow<=a&&d.MaxTileRow>=a&&d.MinTileCol<=s&&d.MaxTileCol>=s)){console.log("Prevenimos petici\xf3n fuera de matrix set, cargamos imagen en blanco");i({src:TC.Consts.BLANK_IMAGE});return}}}}}p.call(n).trigger(TC.Consts.event.BEFORETILELOAD,{tile:t});var f="";if("POST"===n.options.method){var g=e.split("?");f=g[1].split("&").filter(function(t){const e=t.split("=");return e.length>1&&e[1].trim().length>0&&"layers"!==e[0].trim().toLowerCase()}).join("&");n.toolProxification.fetchImageAsBlob(g[0],{type:"POST",data:f,contentType:"application/x-www-form-urlencoded"}).then(function(e){const r=URL.createObjectURL(e);t.getImage().onload=function(t){URL.revokeObjectURL(r)};i({src:r})}).catch(r)}else if(n.ignoreProxification){i({src:e});var y=t.getImage();TC.Util.isSameOrigin(e)||(!n.map||n.map&&n.map.mustBeExportable)&&(y.crossOrigin="anonymous");y.onload=function(){p.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})};y.onerror=function(e){y.src=TC.Consts.BLANK_IMAGE;p.call(n).trigger(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}})};y.src=n.names.length?e:TC.Consts.BLANK_IMAGE}else n.toolProxification.fetchImage(e,{exportable:!n.map||n.map&&n.map.mustBeExportable}).then(function(t){i(t)}).catch(r)}else{i({src:TC.Consts.BLANK_IMAGE});p.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})}};var p=function(){const t=this;return t.wrap&&t.wrap.$events?t.wrap.$events:null};o.getWFSCapabilities=function(){const t=this.options.url.replace(/wms/gi,"wfs");return r(t).then(function(t){return t.getCapabilitiesPromise()})};o.getDescribeFeatureTypeUrl=function(){const t=this.options.url.replace(/wms/gi,"wfs");TC.layer.Vector||TC.syncLoadJS(TC.apiLocation+"TC/layer/Vector");e&&e.options.url===t||(e=new TC.layer.Vector({type:TC.Consts.layerType.WFS,url:t,stealth:!0}));return e.getDescribeFeatureTypeUrl(this.options.featureType)};o.getFallbackLayer=function(){const t=this;if(t.fallbackLayer instanceof TC.Layer)return t.fallbackLayer;if(t.options.fallbackLayer){var e=t.options.fallbackLayer;if("string"==typeof e){(t.map?t.map.options.availableBaseLayers:TC.Cfg.availableBaseLayers).forEach(function(e){if(t.options.fallbackLayer===e.id){t.fallbackLayer=new TC.layer.Raster(TC.Util.extend({},e,{isBase:!0,stealth:!0,map:t.map}));t.fallbackLayer.firstOption=t}})}else if(e instanceof TC.Layer){t.fallbackLayer=e;t.fallbackLayer.firstOption=t}else{t.fallbackLayer=new TC.layer.Raster(TC.Util.extend({},e,{id:TC.getUID(),isBase:!0,stealth:!0,title:layer.title,map:t.map}));t.fallbackLayer.firstOption=t}return t.fallbackLayer}return null};o.describeFeatureType=function(t){const e=this,n=e.options.url.replace(/wms/gi,"wfs");return r(n).then(function(r){return r.describeFeatureType(t||e.layerNames[0])})};o.refresh=function(){return this.wrap.reloadSource()}}();var esriParser={parse:function(t){var e=[],r=(new DOMParser).parseFromString(t,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,o=n.length;i<o;i++)for(var a=n[i],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var h=l[c].getElementsByTagName("Field"),d={},p=0,f=h.length;p<f;p++){var g=h[p];d[getElementText(g.getElementsByTagName("FieldName")[0])]=getElementText(g.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(d);y.setId(s+"."+TC.getUID());e[e.length]=y}return e}};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");!function(){var t={};TC.layer.Vector=function(){var t=this;t._capabilitiesPromise=null;t.capabilities=null;TC.Layer.apply(t,arguments);t.type=t.options.type||TC.Consts.layerType.VECTOR;t.features=[];t.selectedFeatures=[];const e=function(t){var e=(t=t||"").indexOf("?");e>=0?t=t.substr(0,e):(e=t.indexOf("#"))>=0&&(t=t.substr(0,e));return t.substr(t.lastIndexOf(".")).toLowerCase()}(t.url),r=function(t){switch(t){case TC.Consts.mimeType.KML:return TC.Consts.format.KML;case TC.Consts.mimeType.GPX:return TC.Consts.format.GPX;case TC.Consts.mimeType.JSON:case TC.Consts.mimeType.GEOJSON:return TC.Consts.format.GEOJSON;case TC.Consts.mimeType.GML:return TC.Consts.format.GML;default:return null}}(t.options.format)||function(t){switch(t){case".kml":return TC.Consts.format.KML;case".gpx":return TC.Consts.format.GPX;case".json":case".geojson":return TC.Consts.format.GEOJSON;case".gml":return TC.Consts.format.GML;case".wkt":return TC.Consts.format.WKT;case".topojson":return TC.Consts.format.TOPOJSON;default:return null}}(e);if(r||t.type===TC.Consts.layerType.KML){r===TC.Consts.format.KML&&(t.type=TC.Consts.layerType.KML);t.title=t.options.title||function(t){for(var r=t=t||"",n=new RegExp("([^/]+"+e+")","i"),i=0;i<3;i++){t=decodeURIComponent(t);var o=n.exec(t);if(o.length>1){r=o[1];break}}return r}(t.url)}t.wrap=new TC.wrap.layer.Vector(t);t.wrap._promise=new Promise((e,r)=>{var n;n=t.wrap.createVectorLayer();t.wrap.setLayer(n);e(n)})};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){const t=this;var e=null;if(!t.options.stealth){(e={}).children=[];for(var r=0;r<t.features.length;r++){var n=t.features[r].getPath();if(n.length){var i=TC.Util.addArrayToTree(n,e);i&&(i.legend=t.features[r].getLegend())}}if(t.styles){const r=Object.keys(t.styles).length>1,n=t.map?t.map.options.locale:null;if(t.styles.point){(r?TC.Util.addArrayToTree([TC.Util.getLocaleString(n,"points")],e):e).legend={src:TC.Util.getLegendImageFromStyle(t.styles.point,{geometryType:TC.Consts.geom.POINT})}}if(t.styles.line){(r?TC.Util.addArrayToTree([TC.Util.getLocaleString(n,"lines")],e):e).legend={src:TC.Util.getLegendImageFromStyle(t.styles.line,{geometryType:TC.Consts.geom.POLYLINE})}}if(t.styles.polygon){(r?TC.Util.addArrayToTree([TC.Util.getLocaleString(n,"polygons")],e):e).legend={src:TC.Util.getLegendImageFromStyle(t.styles.polygon,{geometryType:TC.Consts.geom.POLYGON})}}}e.name=t.name||e.name;e.customLegend=t.options.customLegend;e.title=t.title||e.title;e.uid=t.id}return e};var r=function(t,e,r,n){return new Promise(function(i,o){e.call(t,[r],n).then(function(e){i(e[0]);t.map&&t.map.trigger(TC.Consts.event.FEATUREADD,{layer:t,feature:e[0]})})})},n=function(t,e,r,n,i){var o=TC.Util.extend(!0,{},i);return new Promise(function(a,s){var l;const c=function(){l=l||TC.feature[r];for(var s=new Array(e.length),c=[],u=0,h=e.length;u<h;u++){var d,p=e[u];const a=TC.wrap.Feature.prototype.isNative(p);if(p instanceof l||"TC.feature."+r===p.CLASSNAME)d=p;else{a&&(d=p._wrap&&p._wrap.parent);if(!d){o.layer=t;const e=t.styles&&t.styles[n];!TC.Util.hasStyleOptions(o)&&e||TC.Util.extend(!0,o,TC.Cfg.styles[n],e||{},i);d=new l(p,o)}}d.layer=t;s[u]=d;t.features[t.features.length]=d;a||(c[c.length]=d.wrap.feature);d.options.showPopup&&d.showPopup()}c.length&&t.wrap.addFeatures(c);a(s)};if(r)TC.loadJS(!TC.feature||TC.feature&&!TC.feature[r],[TC.apiLocation+"TC/feature/"+r],c);else{l=TC.Feature;c()}})};e.addPoint=function(t,e){return r(this,this.addPoints,t,e)};e.addPoints=function(t,e){return n(this,t,"Point",TC.Consts.geom.POINT,e)};e.addMarker=function(t,e){return r(this,this.addMarkers,t,e)};e.addMarkers=function(t,e){return n(this,t,"Marker","marker",e)};e.addPolyline=function(t,e){return r(this,this.addPolylines,t,e)};e.addPolylines=function(t,e){return n(this,t,"Polyline","line",e)};e.addMultiPolyline=function(t,e){return r(this,this.addMultiPolylines,t,e)};e.addMultiPolylines=function(t,e){return n(this,t,"MultiPolyline","line",e)};e.addPolygon=function(t,e){return r(this,this.addPolygons,t,e)};e.addPolygons=function(t,e){return n(this,t,"Polygon",TC.Consts.geom.POLYGON,e)};e.addMultiPolygon=function(t,e){return r(this,this.addMultiPolygons,t,e)};e.addMultiPolygons=function(t,e){return n(this,t,"MultiPolygon",TC.Consts.geom.POLYGON,e)};e.addCircle=function(t,e){return r(this,this.addCircles,t,e)};e.addCircles=function(t,e){return n(this,t,"Circle",TC.Consts.geom.POLYGON,e)};e.addFeature=function(t){const e=this;var r;TC.feature&&(r=TC.feature.Point&&t instanceof TC.feature.Point||"TC.feature.Point"===t.CLASSNAME?e.addPoint(t):TC.feature.Polyline&&t instanceof TC.feature.Polyline||"TC.feature.Polyline"===t.CLASSNAME?e.addPolyline(t):TC.feature.Polygon&&t instanceof TC.feature.Polygon||"TC.feature.Polygon"===t.CLASSNAME?e.addPolygon(t):TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||"TC.feature.MultiPolygon"===t.CLASSNAME?e.addMultiPolygon(t):TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline||"TC.feature.MultiPolyline"===t.CLASSNAME?e.addMultiPolyline(t):TC.feature.Circle&&t instanceof TC.feature.Circle||"TC.feature.Circle"===t.CLASSNAME?e.addCircle(t):n(e,[t]));return r};e.addFeatures=function(t){return n(this,t)};e.removeFeature=function(t){const e=this;if(t.layer&&e.features.indexOf(t)>=0){if(e.map){e.map.getControlsByClass("TC.control.Popup").filter(e=>e.currentFeature===t&&e.isVisible()).forEach(t=>t.hide());e.map.getControlsByClass("TC.control.ResultsPanel").filter(e=>e.currentFeature===t&&e.isVisible()).forEach(t=>t.close())}t.layer&&e.wrap.removeFeature(t);t.layer=null}};e.getFeatureById=function(t){var e=null,r=this.wrap.getFeatureById(t);r&&(e=r._wrap.parent);return e};e.clearFeatures=function(){var t=this;if(t.features&&t.wrap){if(t.map){t.map.getControlsByClass("TC.control.Popup").forEach(function(e){e.isVisible()&&t.features.indexOf(e.currentFeature)>=0&&e.hide()})}t.features.length=0;t.wrap.clearFeatures()}};e.getDescribeFeatureTypeUrl=function(t){const e=this.options.version||"1.1.0",r=Array.isArray(t)?t:[t];return this.url+"?service=WFS&version="+e+"&request=DescribeFeatureType&typename="+r.join(",")+"&outputFormat="+this.capabilities.Operations.DescribeFeatureType.outputFormat};e.describeFeatureType=function(t,e,r){const n=this;t||(t=n.options.featureType);const i=new Promise(function(e,r){n.getCapabilitiesPromise().then(function(i){if(i.Operations.DescribeFeatureType)if(window.hasOwnProperty("Worker")){var o={};const i=async function(){var t=TC.apiLocation+"TC/workers/tc-dft-web-worker.js";if(TC.Util.isSameOrigin(TC.apiLocation))return t;try{const r=(await TC.ajax({url:t,method:"GET",responseType:"text"})).data;var e=new Blob([r],{type:"text/javascript"});return window.URL.createObjectURL(e)}catch(t){throw t}},s=async function(){try{n.WebWorkerDFT||(n.WebWorkerDFT=new Worker(await i()));n.WebWorkerDFT.onmessage=async function(t){if(t.data instanceof Object){if("success"!==t.data.state)throw"Ha habido problemas procesando el Describe feature type";{let e=Object.keys(t.data.DFTCollection).join(",");if(!o.hasOwnProperty(e))throw"No se encuentra la clave "+e+" en la colecci\xf3n";o[e].call(null,t.data.DFTCollection);TC.describeFeatureType=Object.assign(TC.describeFeatureType,t.data.DFTCollection)}}else{var e=await n.toolProxification.fetchXML(t.data);n.WebWorkerDFT.postMessage({url:t.data,response:e.documentElement.outerHTML})}}}catch(t){throw t}},l=async function(t,e){var r=await n.toolProxification.fetchXML(n.getDescribeFeatureTypeUrl(t||n.featureType));n.WebWorkerDFT.postMessage({layerName:t,xml:r.documentElement.outerHTML,url:TC.apiLocation.indexOf("http")>=0?TC.apiLocation:document.location.protocol+TC.apiLocation});o[t instanceof Array?t.join(","):t]=e};try{s()}catch(t){r(t)}t instanceof Array||(t=t.split(","));var a=Object.entries(t.reduce(function(t,e){let r=e.substring(0,e.indexOf(":"));if(t[r]){t[r].push(e);return t}{let n={};n[r]=[e];return Object.assign(t,n)}},{})).map(function(t){var e=t[1];return new Promise(function(t,r){TC.describeFeatureType[e]?t(function(t,e){t instanceof Array||(t=t.split(","));return t.reduce(function(t,r){var n=[];n[r]=e[r];return Object.assign(t,n)},{})}(e,TC.describeFeatureType)):l(e,function(e){t(e)})})});Promise.all(a).then(function(t){let r=t.reduce(function(t,e){return Object.assign(t,e)},{});e(1===Object.keys(r).length?r[Object.keys(r)[0]]:r)}).catch(r)}else r("No esta disponible el WebWorker");else r("No esta disponible el m\xe9todo describeFeatureType")}).catch(t=>r(t))});i.then(function(t){TC.Util.isFunction(e)&&e(t)},function(t){TC.Util.isFunction(r)&&r(t)});return i};e.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";e.import=function(t){this.wrap.import(t)};e.setNodeVisibility=function(t,e){this.state=TC.Layer.state.LOADING;this.map.trigger(TC.Consts.event.BEFOREUPDATE);this.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:this});this.tree||(this.tree=this.getTree());if(this.findNode(t,this.tree)===this.tree)this.setVisibility(e);else{this._cache.visibilityStates[t]=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var r,n,i=!1;for(r=0;r<this.features.length;r++)if((n=this.features[r]).id==t){i=!0;n.setVisibility(e);break}if(!i)for(r=0;r<this.features.length;r++){void 0===(n=this.features[r])._path&&(n._path="/"+n.getPath().join("/"));n._path===t&&n.setVisibility(e)}}this.state=TC.Layer.state.IDLE;this.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:this});this.map.trigger(TC.Consts.event.UPDATE)};e.getNodeVisibility=function(t){var e=TC.Layer.prototype.getNodeVisibility.call(this,t);this.tree||(this.tree=this.getTree());if(this.findNode(t,this.tree)===this.tree)e=this.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var r=this._cache.visibilityStates[t];void 0!==r&&(e=r)}return e};e.setModifiable=function(t){this.wrap.setModifiable(t)};e.applyEdits=function(t,e,r){return this.wrap.sendTransaction(t,e,r)};e.refresh=function(){return this.wrap.reloadSource()};e.getFeaturesInCurrentExtent=function(t){var e=this.map.getExtent();return this.getFeaturesInExtent(e,t)};e.getFeaturesInExtent=function(t,e){return this.wrap.getFeaturesInExtent(t,e)};e.setProjection=function(t){const e=this;e.wrap.setProjection(t);if(t.crs&&t.oldCrs){e.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:e});e.features.forEach(function(e){e.wrap.setGeometry(TC.Util.reproject(e.geometry,t.oldCrs,t.crs));e.geometry=e.wrap.getGeometry()});e.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:e})}};e.setStyles=function(t){this.styles=TC.Util.extend({},t);this.wrap.setStyles(t)};e.exportState=function(t){const e=this;t=t||{};const r={id:e.id};e.map&&e.map.crs!==e.map.options.crs&&(r.crs=e.map.crs);var n=Math.pow(10,(e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)+1);const i=t.features||e.features;r.features=i.map(function(r){const i={};var o;switch(!0){case TC.feature.Marker&&r instanceof TC.feature.Marker:i.type=TC.Consts.geom.POINT;o=e.options.styles&&e.options.styles.marker;break;case TC.feature.Point&&r instanceof TC.feature.Point:i.type=TC.Consts.geom.POINT;o=e.options.styles&&e.options.styles.point;break;case TC.feature.Polyline&&r instanceof TC.feature.Polyline:i.type=TC.Consts.geom.POLYLINE;o=e.options.styles&&e.options.styles.line;break;case TC.feature.MultiPolyline&&r instanceof TC.feature.MultiPolyline:i.type=TC.Consts.geom.MULTIPOLYLINE;o=e.options.styles&&e.options.styles.line;break;case TC.feature.Polygon&&r instanceof TC.feature.Polygon:i.type=TC.Consts.geom.POLYGON;o=e.options.styles&&e.options.styles.polygon;break;case TC.feature.MultiPolygon&&r instanceof TC.feature.MultiPolygon:i.type=TC.Consts.geom.MULTIPOLYGON;o=e.options.styles&&e.options.styles.polygon;break;case TC.feature.Circle&&r instanceof TC.feature.Circle:i.type=TC.Consts.geom.CIRCLE;o=e.options.styles&&e.options.styles.polygon}i.id=r.id;i.geom=TC.Util.compactGeometry(r.geometry,n);i.data=r.getData();i.showsPopup=r.showsPopup;if(void 0===t.exportStyles||t.exportStyles){o=TC.Util.extend({},o);for(var a in o){var s=o[a];TC.Util.isFunction(s)&&(o[a]=s(r))}i.style=TC.Util.extend(o,r.getStyle())}return i});return r};e.importState=function(t){const e=this;return new Promise(function(r,n){const i=new Array(t.features.length);t.features.forEach(function(r,n){const o=TC.Util.extend(r.style,{data:r.data,id:r.id,showsPopup:r.showsPopup});var a;switch(r.type){case TC.Consts.geom.POLYGON:a=e.addPolygon;break;case TC.Consts.geom.MULTIPOLYGON:a=e.addMultiPolygon;break;case TC.Consts.geom.POLYLINE:a=e.addPolyline;break;case TC.Consts.geom.MULTIPOLYLINE:a=e.addMultiPolyline;break;case TC.Consts.geom.CIRCLE:a=e.addCircle;break;case TC.Consts.geom.POINT:a=r.style&&(r.style.url||r.style.className)?e.addMarker:e.addPoint}if(a){var s=TC.Util.explodeGeometry(r.geom);t.crs&&e.map.crs!==t.crs?i[n]=new Promise(function(t,r){e.map.one(TC.Consts.event.PROJECTIONCHANGE,function(n){a.call(e,s,o).then(function(){t()},function(){r(Error("addFn failed"))})})}):i[n]=a.call(e,s,o)}});Promise.all(i).then(function(){r()},function(t){n(t instanceof Error?t:Error(t))})})};e.getGetCapabilitiesUrl=function(){const t=this;if(t.type===TC.Consts.layerType.WFS){const r=function(){return t.options.url||t.url};var e={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return(!TC.Util.isSecureURL(r())&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(r()))?t.getBySSL_(r()):r())+"?"+TC.Util.getParamString(e)}return null};e.getCapabilitiesPromise=function(){const e=this;return e.type===TC.Consts.layerType.WFS?new Promise((r,n)=>{const i=function(t){e.capabilities=e.capabilities||t;var n=e.getGetMapUrl();TC.capabilities[e.options.url]=TC.capabilities[e.options.url]||t;TC.capabilities[n]=TC.capabilities[n]||t;r(t)};if(e.capabilities){i(e.capabilities);e._capabilitiesPromise=Promise.resolve(e.capabilities);r(e.capabilities);return}e.toolProxification=new TC.tool.Proxification(TC.proxify);const o=t[e.url];t[e.url]=e._capabilitiesPromise=o||new Promise(function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then(function(e){t(e)}).catch(function(t){i.catch(function(){r(t)})});i.then(function(e){t(e)}).catch(function(){n.catch(function(t){r(t)})})});t[e.url].then(function(t){i(t)}).catch(function(t){e.map&&e.map.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"});n(t)})}):Promise.reject(new Error(`Layer "${e.id}" does not have capabilities document`))}}()}();var TC=TC||{};!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Geometry=e()}(TC,function(){const t={isPoint:function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},isRing:function(e){return Array.isArray(e)&&(0===e.length||t.isPoint(e[0]))},isRingCollection:function(e){return Array.isArray(e)&&(0===e.length||t.isRing(e[0]))},isMultiRingCollection:function(e){return Array.isArray(e)&&(0===e.length||t.isRingCollection(e[0]))},getNearest:function(t,e){return TC.wrap.Geometry.getNearest(t,e)},isInside:function e(r,n){var i=!1;if(t.isPoint(r))if(t.isPoint(n))i=r[0]===n[0]&&r[1]===n[1];else if(t.isRing(n))for(var o=0,a=n.length-1;o<n.length;a=o++){var s=n[o][0],l=n[o][1],c=n[a][0],u=n[a][1];l>r[1]!=u>r[1]&&r[0]<(c-s)*(r[1]-l)/(u-l)+s&&(i=!i)}else if(t.isRingCollection(n)&&n.length>0){if(e(r,n[0])){var h=!1;for(o=1;o<n.length;o++)if(e(r,n[o])){h=!0;break}h||(i=!0)}}else if(t.isMultiRingCollection(n)&&n.length>0){o=0;for(var d=n.length;o<d;o++)if(e(r,n[o])){i=!0;break}}return i},getFlatCoordinates:function(e){const r=function(t,e){return t.concat(e)};switch(!0){case t.isPoint(e):return[e];case t.isRing(e):return e;case t.isRingCollection(e):return e.reduce(r);case t.isMultiRingCollection(e):return e.reduce(r).reduce(r);default:return[]}},intersects:function(e,r){const n=function(e,r){for(var n=0,i=e.length;n<i;n++)if(t.isInside(e[n],r))return!0;return!1};return!(!n(t.getFlatCoordinates(e),r)&&!n(t.getFlatCoordinates(r),e))}};return t});var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var t;if(document.currentScript)t=document.currentScript;else{var e=document.getElementsByTagName("script");t=e[e.length-1]}var r=t.getAttribute("src");TC.apiLocation=r.substr(0,r.lastIndexOf("/")+1);var n=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),i=new XMLHttpRequest;i.open("GET",n,!1);i.send(null);var o=document.getElementsByTagName("head")[0];(t=document.createElement("script")).type="text/javascript";t.text=i.responseText;o.appendChild(t)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(t,e){var r=this;TC.Cfg.controls.search.allowedSearchTypes=TC.Util.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(e&&e.controls&&e.controls.search){var n=Object.keys(e.controls.search),i=TC.Util.extend(e.controls.search,{allowedSearchTypes:{}});n.forEach(function(t){if("boolean"==typeof e.controls.search[t]||TC.Util.isPlainObject(e.controls.search[t])){if(e.controls.search[t])switch(!0){case"postalAddress"===t:i.allowedSearchTypes[TC.Consts.searchType.NUMBER]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;case"cadastralParcel"===t:i.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;case"town"===t:i.allowedSearchTypes[TC.Consts.searchType.URBAN]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;default:i.allowedSearchTypes[t]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{}}delete i[t]}});e.controls.search=i}var o,a,s=new TC.Map(t,e);r.addLayer=function(t,e){s.addLayer(t,e)};r.setBaseLayer=function(t,e){s.setBaseLayer(t,e)};r.addMarker=function(t,e){s.addMarker(t,e)};r.zoomToMarkers=function(t){s.zoomToMarkers(t)};r.loaded=function(t){s.loaded(t)};s.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(o=new TC.control.Search).register(s);o.getLayer().then(function(t){a=t})});if(!s.activeControl){var t=s.getControlsByClass("TC.control.FeatureInfo")[0];t&&t.activate()}});r.getQueryableData=function(t,e){var r=o.availableSearchTypes[t];if(r.queryableData)e&&e(r.queryableData);else{var n={request:"GetFeature",service:"WFS",typename:r.featurePrefix+":"+r.featureType,version:r.version,propertyname:(r.dataIdProperty instanceof Array?r.dataIdProperty:[r.dataIdProperty]).concat(r.outputProperties instanceof Array?r.outputProperties:[r.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},i=r.url+"?"+TC.Util.getParamString(n);TC.ajax({url:i,responseType:TC.Consts.mimeType.JSON}).then(function(t){const n=t.data;r.queryableData=[];if(n.features)for(var i=n.features,a=0;a<i.length;a++){var s=i[a],l={id:[]};r.dataIdProperty instanceof Array||(r.dataIdProperty=[r.dataIdProperty]);for(var c=0;c<r.dataIdProperty.length;c++)s.properties.hasOwnProperty(r.dataIdProperty[c])&&l.id.push(s.properties[r.dataIdProperty[c]]);l.id=r.idPropertiesIdentifier?l.id.join(r.idPropertiesIdentifier):l.id.join("");l.label=[];r.outputProperties instanceof Array||(r.outputProperties=[r.outputProperties]);for(var u=0;u<r.outputProperties.length;u++)s.properties.hasOwnProperty(r.outputProperties[u])&&l.label.push(s.properties[r.outputProperties[u]]);var h=l.label instanceof Array&&l.label.join("").trim().length>0||!(l.label instanceof Array)&&l.label.trim().length>0;l.label=r.outputFormatLabel?r.outputFormatLabel.tcFormat(l.label):l.label.join("-");h&&r.queryableData.push(l)}r.queryableData=r.queryableData.sort(function(t,e){return r.idPropertiesIdentifier&&-1==t.id.indexOf(r.idPropertiesIdentifier)?o.removePunctuation(t.label)<o.removePunctuation(e.label)?-1:o.removePunctuation(t.label)>o.removePunctuation(e.label)?1:0:o.removePunctuation(t.label.split(" ")[0])<o.removePunctuation(e.label.split(" ")[0])?-1:o.removePunctuation(t.label.split(" ")[0])>o.removePunctuation(e.label.split(" ")[0])?1:0});r.queryableData=r.queryableData.filter(function(t,e,r){return e<1||t.id!==r[e-1].id&&t.label!==r[e-1].label});e&&e(r.queryableData)})}};r.getMunicipalities=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,t)};r.getUrbanAreas=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.URBAN,t)};r.getCommonwealths=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,t)};r.getCouncils=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,t)};r.searchCommonwealth=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,t,e)};r.searchCouncil=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,t,e)};r.searchUrbanArea=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.URBAN,t,e)};r.searchMunicipality=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,t,e)};r.searchTyped=function(t,e,n){var i=TC.getUID(),l=o.availableSearchTypes[t];e instanceof Array&&l.goToIdFormat&&(e=l.goToIdFormat.tcFormat(e));o._search.data=o._search.data||[];o._search.data.push({dataLayer:l.featureType,dataRole:t,id:e,label:"",text:""});r.removeSearch();if(o.availableSearchTypes[t]&&!o.getSearchTypeByRole(t)){o.availableSearchTypes[t].goTo||(o.availableSearchTypes[t].goTo=function(t){var e=function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var e=[];l.idPropertiesIdentifier&&(t=t.split(l.idPropertiesIdentifier));t instanceof Array||(t=[t]);for(var r=0;r<l.dataIdProperty.length;r++)e.push(new TC.filter.equalTo(l.dataIdProperty[r],t[r].trim()));return e=e.length>1?new TC.filter.and(e):e[0]}(t);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:e,outputFormat:this.outputFormat,styles:this.styles}}}.bind(l));o.addAllowedSearchType(t,o.availableSearchTypes[t],o)}s.one(TC.Consts.event.SEARCHQUERYEMPTY,function(t){s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});n&&n(null)});s.one(TC.Consts.event.FEATURESADD,function(e){e.layer==a&&e.layer.features&&e.layer.features.length>0&&s.zoomToFeatures(e.layer.features);r.search={layer:e.layer,type:t};n&&n(e.layer.id!==i?e.layer.id:i)});o.goToResult(e,t)};r.searchFeature=function(t,e,n,i){var a=TC.getUID(),l=o.featurePrefix;r.removeSearch();t=(t||"").trim();e=(e||"").trim();n=(n||"").trim();if(0==t.length||0==e.length||0==n.length){s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(null)}else{if(t.indexOf(":")>-1){l=t.split(":")[0];t=t.split(":")[1]}var c,u={id:a,type:SITNA.Consts.layerType.WFS,url:o.url,version:o.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:t,maxFeatures:1,properties:function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(t&&t instanceof Array){var e=t.map(function(t){if(!t.hasOwnProperty("type"))return new TC.filter.equalTo(t.name,t.value);switch(!0){case t.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(t.name,t.value)}});return e.length>1?TC.filter.and.apply(null,e):e[0]}}([{name:e,value:n,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};s.addLayer(u).then(function(t){c=t;r.search={layer:t,type:SITNA.Consts.mapSearchType.GENERIC}});s.on(TC.Consts.event.FEATURESADD,function(t){const e=t.layer;if(e==c&&e.features&&e.features.length>0){for(var r=0;r<e.features.length;r++)e.features[r].showsPopup!=o.queryableFeatures&&(e.features[r].showsPopup=o.queryableFeatures);s.zoomToFeatures(e.features)}});s.on(TC.Consts.event.LAYERUPDATE,function(t){const e=t.layer,r=t.newData;e==c&&r&&r.features&&0==r.features.length&&s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(e==c&&r&&r.features&&0==r.features.length?null:a)})}};r.removeSearch=function(t){if(r.search)if(o.availableSearchTypes[r.search.type]&&o.availableSearchTypes[r.search.type].hasOwnProperty("goTo")){for(var e=0;e<r.search.layer.features.length;e++)r.search.layer.removeFeature(r.search.layer.features[e]);r.search=null}else s.removeLayer(r.search.layer).then(function(){r.search=null});t&&t()};r.exportImage=function(){return s.exportImage()};r.search=null};
//# sourceMappingURL=maps/sitna.ol.min.js.map