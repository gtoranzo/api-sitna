!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.core",[],e):"object"==typeof exports?module.exports=e():t.dust=e()}(this,function(){var dust={version:"2.7.1"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"};!function(){var t,e,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};if("undefined"!=typeof console&&console.log){t=console.log;e="function"==typeof t?function(){t.apply(console,arguments)}:function(){t(Array.prototype.slice.apply(arguments).join(" "))}}else e=EMPTY_FUNC;dust.log=function(t,n){r[n=n||INFO]>=r[dust.debugLevel]&&e("[DUST:"+n+"]",t)};dust.debugLevel=NONE;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}();dust.helpers={};dust.cache={};dust.register=function(t,e){if(t){e.templateName=t;!1!==dust.config.cache&&(dust.cache[t]=e)}};dust.render=function(t,e,r){var n=new Stub(r).head;try{load(t,n,e).end()}catch(t){n.setError(t)}};dust.stream=function(t,e){var r=new Stream,n=r.head;dust.nextTick(function(){try{load(t,n,e).end()}catch(t){n.setError(t)}});return r};function getTemplate(t,e){if(t)return"function"==typeof t&&t.template?t.template:dust.isTemplateFn(t)?t:!1!==e?dust.cache[t]:void 0}function load(t,e,r){if(!t)return e.setError(new Error("No template or template name provided to render"));var n=getTemplate(t,dust.config.cache);return n?n(e,Context.wrap(r,n.templateName)):dust.onLoad?e.map(function(e){var n=t;function i(t,i){var o;if(t)return e.setError(t);if(!(o=getTemplate(i,!1)||getTemplate(n,dust.config.cache))){if(!dust.compile)return e.setError(new Error("Dust compiler not available"));o=dust.loadSource(dust.compile(i,n))}o(e,Context.wrap(r,o.templateName)).end()}3===dust.onLoad.length?dust.onLoad(n,r.options,i):dust.onLoad(n,i)}):e.setError(new Error("Template Not Found: "+t))}dust.loadSource=function(source){return eval(source)};Array.isArray?dust.isArray=Array.isArray:dust.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)};dust.nextTick=function(t){setTimeout(t,0)};dust.isEmpty=function(t){return 0!==t&&(!(!dust.isArray(t)||t.length)||!t)};dust.isEmptyObject=function(t){var e;if(null===t)return!1;if(void 0===t)return!1;if(t.length>0)return!1;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0};dust.isTemplateFn=function(t){return"function"==typeof t&&t.__dustBody};dust.isThenable=function(t){return t&&"object"==typeof t&&"function"==typeof t.then};dust.isStreamable=function(t){return t&&"function"==typeof t.on};dust.filter=function(t,e,r){var n,i,o;if(r)for(n=0,i=r.length;n<i;n++)"s"===(o=r[n])?e=null:"function"==typeof dust.filters[o]?t=dust.filters[o](t):dust.log("Invalid filter `"+o+"`",WARN);e&&(t=dust.filters[e](t));return t};dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return dust.escapeJSON(t)},jp:function(t){if(JSON)return JSON.parse(t);dust.log("JSON is undefined; could not parse `"+t+"`",WARN);return t}};function Context(t,e,r,n,i){void 0===t||t instanceof Stack||(t=new Stack(t));this.stack=t;this.global=e;this.options=r;this.blocks=n;this.templateName=i}dust.makeBase=dust.context=function(t,e){return new Context(void 0,t,e)};function getWithResolvedData(t,e,r){return function(n){return t.push(n)._get(e,r)}}Context.wrap=function(t,e){return t instanceof Context?t:new Context(t,{},{},null,e)};Context.prototype.get=function(t,e){if("string"==typeof t){if("."===t[0]){e=!0;t=t.substr(1)}t=t.split(".")}return this._get(e,t)};Context.prototype._get=function(t,e){var r,n,i,o,a,s=this.stack||{},l=1;n=e[0];i=e.length;if(t&&0===i){o=s;s=s.head}else{if(t)s&&(s=s.head?s.head[n]:void 0);else{for(;s;){if(s.isObject){o=s.head;if(void 0!==(r=s.head[n]))break}s=s.tail}s=void 0!==r?r:this.global&&this.global[n]}for(;s&&l<i;){if(dust.isThenable(s))return s.then(getWithResolvedData(this,t,e.slice(l)));o=s;s=s[e[l]];l++}}if("function"==typeof s){(a=function(){try{return s.apply(o,arguments)}catch(t){dust.log(t,ERROR);throw t}}).__dustBody=!!s.__dustBody;return a}void 0===s&&dust.log("Cannot find reference `{"+e.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO);return s};Context.prototype.getPath=function(t,e){return this._get(t,e)};Context.prototype.push=function(t,e,r){if(void 0===t){dust.log("Not pushing an undefined variable onto the context",INFO);return this}return this.rebase(new Stack(t,this.stack,e,r))};Context.prototype.pop=function(){var t=this.current();this.stack=this.stack&&this.stack.tail;return t};Context.prototype.rebase=function(t){return new Context(t,this.global,this.options,this.blocks,this.getTemplateName())};Context.prototype.clone=function(){var t=this.rebase();t.stack=this.stack;return t};Context.prototype.current=function(){return this.stack&&this.stack.head};Context.prototype.getBlock=function(t){var e,r,n;"function"==typeof t&&(t=t(new Chunk,this).data.join(""));if(!(e=this.blocks)){dust.log("No blocks for context `"+t+"` in template `"+this.getTemplateName()+"`",DEBUG);return!1}r=e.length;for(;r--;)if(n=e[r][t])return n;dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks.");return!1};Context.prototype.shiftBlocks=function(t){var e,r=this.blocks;if(t){e=r?r.concat([t]):[t];return new Context(this.stack,this.global,this.options,e,this.getTemplateName())}return this};Context.prototype.resolve=function(t){var e;return"function"!=typeof t?t:(e=(new Chunk).render(t,this))instanceof Chunk?e.data.join(""):e};Context.prototype.getTemplateName=function(){return this.templateName};function Stack(t,e,r,n){this.tail=e;this.isObject=t&&"object"==typeof t;this.head=t;this.index=r;this.of=n}function Stub(t){this.head=new Chunk(this);this.callback=t;this.out=""}Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable){if(t.error){this.callback(t.error);dust.log("Rendering failed with error `"+t.error+"`",ERROR);this.flush=EMPTY_FUNC;return}return}this.out+=t.data.join("");t=t.next;this.head=t}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable){if(t.error){this.emit("error",t.error);this.emit("end");dust.log("Streaming failed with error `"+t.error+"`",ERROR);this.flush=EMPTY_FUNC;return}return}this.emit("data",t.data.join(""));t=t.next;this.head=t}this.emit("end")};Stream.prototype.emit=function(t,e){var r,n,i=(this.events||{})[t]||[];if(!i.length){dust.log("Stream broadcasting, but no listeners for `"+t+"`",DEBUG);return!1}for(r=0,n=(i=i.slice(0)).length;r<n;r++)i[r](e);return!0};Stream.prototype.on=function(t,e){var r=this.events=this.events||{},n=r[t]=r[t]||[];"function"!=typeof e?dust.log("No callback function provided for `"+t+"` event listener",WARN):n.push(e);return this};Stream.prototype.pipe=function(t){if("function"!=typeof t.write||"function"!=typeof t.end){dust.log("Incompatible stream passed to `pipe`",WARN);return this}var e=!1;"function"==typeof t.emit&&t.emit("pipe",this);"function"==typeof t.on&&t.on("error",function(){e=!0});return this.on("data",function(r){if(!e)try{t.write(r,"utf8")}catch(t){dust.log(t,ERROR)}}).on("end",function(){if(!e)try{t.end();e=!0}catch(t){dust.log(t,ERROR)}})};function Chunk(t,e,r){this.root=t;this.next=e;this.data=[];this.flushable=!1;this.taps=r}Chunk.prototype.write=function(t){var e=this.taps;e&&(t=e.go(t));this.data.push(t);return this};Chunk.prototype.end=function(t){t&&this.write(t);this.flushable=!0;this.root.flush();return this};Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),r=new Chunk(this.root,e,this.taps);this.next=r;this.flushable=!0;try{t(r)}catch(t){dust.log(t,ERROR);r.setError(t)}return e};Chunk.prototype.tap=function(t){var e=this.taps;this.taps=e?e.push(t):new Tap(t);return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(t,e){return t(this,e)};Chunk.prototype.reference=function(t,e,r,n){return"function"==typeof t?(t=t.apply(e.current(),[this,e,null,{auto:r,filters:n}]))instanceof Chunk?t:this.reference(t,e,r,n):dust.isThenable(t)?this.await(t,e,null,r,n):dust.isStreamable(t)?this.stream(t,e,null,r,n):dust.isEmpty(t)?this:this.write(dust.filter(t,r,n))};Chunk.prototype.section=function(t,e,r,n){var i,o,a,s=r.block,l=r.else,c=this;if("function"==typeof t&&!dust.isTemplateFn(t)){try{t=t.apply(e.current(),[this,e,r,n])}catch(t){dust.log(t,ERROR);return this.setError(t)}if(t instanceof Chunk)return t}dust.isEmptyObject(n)||(e=e.push(n));if(dust.isArray(t)){if(s){if((o=t.length)>0){(a=e.stack&&e.stack.head||{}).$len=o;for(i=0;i<o;i++){a.$idx=i;c=s(c,e.push(t[i],i,o))}a.$idx=void 0;a.$len=void 0;return c}if(l)return l(this,e)}}else{if(dust.isThenable(t))return this.await(t,e,r);if(dust.isStreamable(t))return this.stream(t,e,r);if(!0===t){if(s)return s(this,e)}else if(t||0===t){if(s)return s(this,e.push(t))}else if(l)return l(this,e)}dust.log("Section without corresponding key in template `"+e.getTemplateName()+"`",DEBUG);return this};Chunk.prototype.exists=function(t,e,r){var n=r.block,i=r.else;if(dust.isEmpty(t)){if(i)return i(this,e)}else{if(n)return n(this,e);dust.log("No block for exists check in template `"+e.getTemplateName()+"`",DEBUG)}return this};Chunk.prototype.notexists=function(t,e,r){var n=r.block,i=r.else;if(dust.isEmpty(t)){if(n)return n(this,e);dust.log("No block for not-exists check in template `"+e.getTemplateName()+"`",DEBUG)}else if(i)return i(this,e);return this};Chunk.prototype.block=function(t,e,r){var n=t||r.block;return n?n(this,e):this};Chunk.prototype.partial=function(t,e,r,n){var i;if(void 0===n){n=r;r=e}if(!dust.isEmptyObject(n)){i=(r=r.clone()).pop();r=r.push(n).push(i)}if(dust.isTemplateFn(t))return this.capture(t,e,function(t,e){r.templateName=t;load(t,e,r).end()});r.templateName=t;return load(t,this,r)};Chunk.prototype.helper=function(t,e,r,n){var i;if(!dust.helpers[t]){dust.log("Helper `"+t+"` does not exist",WARN);return this}try{i=dust.helpers[t](this,e,r,n);return dust.isThenable(i)?this.await(i,e,r):i}catch(e){dust.log("Error in helper `"+t+"`: "+e.message,ERROR);return this.setError(e)}};Chunk.prototype.await=function(t,e,r,n,i){var o=r&&r.block,a=r&&r.error;return this.map(function(r){t.then(function(t){o?r.render(o,e.push(t)).end():r.reference(t,e,n,i).end()},function(t){if(a)r.render(a,e.push(t)).end();else{dust.log("Unhandled promise rejection in `"+e.getTemplateName()+"`");r.end()}})})};Chunk.prototype.stream=function(t,e,r,n,i){var o=r&&r.block,a=r&&r.error;return this.map(function(r){var s=!1;t.on("data",function(t){s||(r=o?r.map(function(r){r.render(o,e.push(t)).end()}):r.reference(t,e,n,i))}).on("error",function(t){if(!s){a?r.render(a,e.push(t)):dust.log("Unhandled stream error in `"+e.getTemplateName()+"`");if(!s){s=!0;r.end()}}}).on("end",function(){if(!s){s=!0;r.end()}})})};Chunk.prototype.capture=function(t,e,r){return this.map(function(n){var i=new Stub(function(t,e){t?n.setError(t):r(e,n)});t(i.head,e).end()})};Chunk.prototype.setError=function(t){this.error=t;this.root.flush();return this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);function Tap(t,e){this.head=t;this.tail=e}Tap.prototype.push=function(t){return new Tap(t,this)};Tap.prototype.go=function(t){for(var e=this;e;){t=e.head(t);e=e.tail}return t};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){if("string"==typeof t||t&&"function"==typeof t.toString){"string"!=typeof t&&(t=t.toString());return HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t}return t};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t};dust.escapeJSON=function(t){if(JSON)return JSON.stringify(t).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c");dust.log("JSON is undefined; could not escape `"+t+"`",WARN);return t};return dust});!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.parse",["dust.core"],function(t){return e(t).parse}):"object"==typeof exports?module.exports=e(require("./dust")):e(t.dust)}(this,function(t){var e=function(){function t(t,e,r,n,i,o){this.message=t;this.expected=e;this.found=r;this.offset=n;this.line=i;this.column=o;this.name="SyntaxError"}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r}(t,Error);return{SyntaxError:t,parse:function(e){var r,n=arguments.length>1?arguments[1]:{},i={},o={start:Ue},a=Ue,s=function(t){return pr(["body"].concat(t))},l={type:"other",description:"section"},c=i,u=null,h=function(t,e,r,n){n&&t[1].text===n.text||function(t){throw Ge(t,null,Ie)}("Expected end tag for "+t[1].text+" but it was not found.");return!0},p=void 0,d=function(t,e,r,n){r.push(["param",["literal","block"],e]);t.push(r);return pr(t)},f="/",g={type:"literal",value:"/",description:'"/"'},y=function(t){t.push(["bodies"]);return pr(t)},m=/^[#?\^<+@%]/,C={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},v=function(t,e,r,n){return[t,e,r,n]},T={type:"other",description:"end tag"},_=function(t){return t},S=":",E={type:"literal",value:":",description:'":"'},L=function(t){return t},w=function(t){return t?["context",t]:["context"]},b={type:"other",description:"params"},A="=",x={type:"literal",value:"=",description:'"="'},P=function(t,e){return["param",["literal",t],e]},R=function(t){return["params"].concat(t)},I={type:"other",description:"bodies"},M=function(t){return["bodies"].concat(t)},O={type:"other",description:"reference"},N=function(t,e){return pr(["reference",t,e])},k={type:"other",description:"partial"},D=">",F={type:"literal",value:">",description:'">"'},B="+",G={type:"literal",value:"+",description:'"+"'},U=function(t){return["literal",t]},j=function(t,e,r,n){return pr([">"===t?"partial":t,e,r,n])},q={type:"other",description:"filters"},W="|",H={type:"literal",value:"|",description:'"|"'},V=function(t){return["filters"].concat(t)},Y={type:"other",description:"special"},z="~",X={type:"literal",value:"~",description:'"~"'},K=function(t){return pr(["special",t])},$={type:"other",description:"identifier"},J=function(t){var e=["path"].concat(t);e.text=t[1].join(".").replace(/,line,\d+,col,\d+/g,"");return e},Z=function(t){var e=["key",t];e.text=t;return e},Q={type:"other",description:"number"},tt=function(t){return["literal",t]},et={type:"other",description:"float"},rt=".",nt={type:"literal",value:".",description:'"."'},it=function(t,e){return parseFloat(t+"."+e)},ot={type:"other",description:"unsigned_integer"},at=/^[0-9]/,st={type:"class",value:"[0-9]",description:"[0-9]"},lt=function(t){return parseInt(t.join(""),10)},ct={type:"other",description:"signed_integer"},ut="-",ht={type:"literal",value:"-",description:'"-"'},pt=function(t,e){return-1*e},dt={type:"other",description:"integer"},ft={type:"other",description:"path"},gt=function(t,e){e=e[0];if(t&&e){e.unshift(t);return pr([!1,e])}return pr([!0,e])},yt=function(t){return t.length>0?pr([!0,t[0]]):pr([!0,[]])},mt={type:"other",description:"key"},Ct=/^[a-zA-Z_$]/,vt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},Tt=/^[0-9a-zA-Z_$\-]/,_t={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},St=function(t,e){return t+e.join("")},Et={type:"other",description:"array"},Lt=function(t){return t.join("")},wt=function(t){return t},bt=function(t,e){e?e.unshift(t):e=[t];return e},At={type:"other",description:"array_part"},xt=function(t){return t},Pt=function(t,e){return e?t.concat(e):t},Rt={type:"other",description:"inline"},It='"',Mt={type:"literal",value:'"',description:'"\\""'},Ot=function(){return pr(["literal",""])},Nt=function(t){return pr(["literal",t])},kt=function(t){return pr(["body"].concat(t))},Dt=function(t){return["buffer",t]},Ft={type:"other",description:"buffer"},Bt=function(t,e){return pr(["format",t,e.join("")])},Gt={type:"any",description:"any character"},Ut=function(t){return t},jt=function(t){return pr(["buffer",t.join("")])},qt={type:"other",description:"literal"},Wt=/^[^"]/,Ht={type:"class",value:'[^"]',description:'[^"]'},Vt=function(t){return t.join("")},Yt='\\"',zt={type:"literal",value:'\\"',description:'"\\\\\\""'},Xt=function(){return'"'},Kt={type:"other",description:"raw"},$t="{`",Jt={type:"literal",value:"{`",description:'"{`"'},Zt="`}",Qt={type:"literal",value:"`}",description:'"`}"'},te=function(t){return t},ee=function(t){return pr(["raw",t.join("")])},re={type:"other",description:"comment"},ne="{!",ie={type:"literal",value:"{!",description:'"{!"'},oe="!}",ae={type:"literal",value:"!}",description:'"!}"'},se=function(t){return pr(["comment",t.join("")])},le=/^[#?\^><+%:@\/~%]/,ce={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},ue="{",he={type:"literal",value:"{",description:'"{"'},pe="}",de={type:"literal",value:"}",description:'"}"'},fe="[",ge={type:"literal",value:"[",description:'"["'},ye="]",me={type:"literal",value:"]",description:'"]"'},Ce="\n",ve={type:"literal",value:"\n",description:'"\\n"'},Te="\r\n",_e={type:"literal",value:"\r\n",description:'"\\r\\n"'},Se="\r",Ee={type:"literal",value:"\r",description:'"\\r"'},Le="\u2028",we={type:"literal",value:"\u2028",description:'"\\u2028"'},be="\u2029",Ae={type:"literal",value:"\u2029",description:'"\\u2029"'},xe=/^[\t\x0B\f \xA0\uFEFF]/,Pe={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},Re=0,Ie=0,Me=0,Oe={line:1,column:1,seenCR:!1},Ne=0,ke=[],De=0;if("startRule"in n){if(!(n.startRule in o))throw new Error("Can't start parsing from rule \""+n.startRule+'".');a=o[n.startRule]}function Fe(t){if(Me!==t){if(Me>t){Me=0;Oe={line:1,column:1,seenCR:!1}}!function(t,r,n){var i,o;for(i=r;i<n;i++)if("\n"===(o=e.charAt(i))){t.seenCR||t.line++;t.column=1;t.seenCR=!1}else if("\r"===o||"\u2028"===o||"\u2029"===o){t.line++;t.column=1;t.seenCR=!0}else{t.column++;t.seenCR=!1}}(Oe,Me,t);Me=t}return Oe}function Be(t){if(!(Re<Ne)){if(Re>Ne){Ne=Re;ke=[]}ke.push(t)}}function Ge(r,n,i){var o=Fe(i),a=i<e.length?e.charAt(i):null;null!==n&&function(t){var e=1;t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});for(;e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}(n);return new t(null!==r?r:function(t,e){var r,n=new Array(t.length);for(r=0;r<t.length;r++)n[r]=t[r].description;return"Expected "+(t.length>1?n.slice(0,-1).join(", ")+" or "+n[t.length-1]:n[0])+" but "+(e?'"'+function(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}(e)+'"':"end of input")+" found."}(n,a),n,a,i,o.line,o.column)}function Ue(){return je()}function je(){var t,e,r;t=Re;e=[];r=qe();for(;r!==i;){e.push(r);r=qe()}if(e!==i){Ie=t;e=s(e)}return t=e}function qe(){var t;(t=or())===i&&(t=ar())===i&&(t=function(){var t,r,n,o,a,s,m;De++;t=Re;if((r=We())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i)if((o=cr())!==i)if((a=je())!==i)if((s=function(){var t,r,n,o,a,s,l;De++;t=Re;r=[];n=Re;if((o=lr())!==i){if(58===e.charCodeAt(Re)){a=S;Re++}else{a=i;0===De&&Be(E)}if(a!==i)if((s=Ze())!==i)if(cr()!==i)if((l=je())!==i){Ie=n;o=P(s,l);n=o}else{Re=n;n=c}else{Re=n;n=c}else{Re=n;n=c}else{Re=n;n=c}}else{Re=n;n=c}for(;n!==i;){r.push(n);n=Re;if((o=lr())!==i){if(58===e.charCodeAt(Re)){a=S;Re++}else{a=i;0===De&&Be(E)}if(a!==i)if((s=Ze())!==i)if(cr()!==i)if((l=je())!==i){Ie=n;o=P(s,l);n=o}else{Re=n;n=c}else{Re=n;n=c}else{Re=n;n=c}else{Re=n;n=c}}else{Re=n;n=c}}if(r!==i){Ie=t;r=M(r)}De--;if((t=r)===i){r=i;0===De&&Be(I)}return t}())!==i){(m=function(){var t,r,n,o,a,s,l;De++;t=Re;if((r=lr())!==i){if(47===e.charCodeAt(Re)){n=f;Re++}else{n=i;0===De&&Be(g)}if(n!==i){o=[];a=hr();for(;a!==i;){o.push(a);a=hr()}if(o!==i)if((a=Xe())!==i){s=[];l=hr();for(;l!==i;){s.push(l);l=hr()}if(s!==i)if((l=cr())!==i){Ie=t;r=_(a);t=r}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(T)}return t}())===i&&(m=u);if(m!==i){Ie=Re;if((h(r,a,s,m)?p:c)!==i){Ie=t;r=d(r,a,s,m);t=r}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}if(t===i){t=Re;if((r=We())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){if(47===e.charCodeAt(Re)){o=f;Re++}else{o=i;0===De&&Be(g)}if(o!==i)if((a=cr())!==i){Ie=t;r=y(r);t=r}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}De--;if(t===i){r=i;0===De&&Be(l)}return t}())===i&&(t=function(){var t,r,n,o,a,s,l,u,h;De++;t=Re;if((r=lr())!==i){if(62===e.charCodeAt(Re)){n=D;Re++}else{n=i;0===De&&Be(F)}if(n===i)if(43===e.charCodeAt(Re)){n=B;Re++}else{n=i;0===De&&Be(G)}if(n!==i){o=[];a=hr();for(;a!==i;){o.push(a);a=hr()}if(o!==i){a=Re;if((s=Ze())!==i){Ie=a;s=U(s)}(a=s)===i&&(a=er());if(a!==i)if((s=He())!==i)if((l=Ve())!==i){u=[];h=hr();for(;h!==i;){u.push(h);h=hr()}if(u!==i){if(47===e.charCodeAt(Re)){h=f;Re++}else{h=i;0===De&&Be(g)}if(h!==i)if(cr()!==i){Ie=t;r=j(n,a,s,l);t=r}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(k)}return t}())===i&&(t=ze())===i&&(t=Ye())===i&&(t=function(){var t,r,n,o,a,s,l,u;De++;t=Re;if((r=ur())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){Ie=t;r=Bt(r,n);t=r}else{Re=t;t=c}}else{Re=t;t=c}if(t===i){t=Re;r=[];n=Re;o=Re;De++;a=sr();De--;if(a===i)o=p;else{Re=o;o=c}if(o!==i){a=Re;De++;s=or();De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){s=Re;De++;l=ar();De--;if(l===i)s=p;else{Re=s;s=c}if(s!==i){l=Re;De++;u=ur();De--;if(u===i)l=p;else{Re=l;l=c}if(l!==i){if(e.length>Re){u=e.charAt(Re);Re++}else{u=i;0===De&&Be(Gt)}if(u!==i){Ie=n;o=Ut(u);n=o}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Re;o=Re;De++;a=sr();De--;if(a===i)o=p;else{Re=o;o=c}if(o!==i){a=Re;De++;s=or();De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){s=Re;De++;l=ar();De--;if(l===i)s=p;else{Re=s;s=c}if(s!==i){l=Re;De++;u=ur();De--;if(u===i)l=p;else{Re=l;l=c}if(l!==i){if(e.length>Re){u=e.charAt(Re);Re++}else{u=i;0===De&&Be(Gt)}if(u!==i){Ie=n;o=Ut(u);n=o}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}}else r=c;if(r!==i){Ie=t;r=jt(r)}t=r}De--;if(t===i){r=i;0===De&&Be(Ft)}return t}());return t}function We(){var t,r,n,o,a,s;t=Re;if(lr()!==i){if(m.test(e.charAt(Re))){r=e.charAt(Re);Re++}else{r=i;0===De&&Be(C)}if(r!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i)if((o=Xe())!==i)if((a=He())!==i)if((s=Ve())!==i){Ie=t;t=v(r,o,a,s)}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}return t}function He(){var t,r,n,o;t=Re;r=Re;if(58===e.charCodeAt(Re)){n=S;Re++}else{n=i;0===De&&Be(E)}if(n!==i)if((o=Xe())!==i){Ie=r;r=n=L(o)}else{Re=r;r=c}else{Re=r;r=c}r===i&&(r=u);if(r!==i){Ie=t;r=w(r)}return t=r}function Ve(){var t,r,n,o,a,s,l;De++;t=Re;r=[];n=Re;o=[];if((a=hr())!==i)for(;a!==i;){o.push(a);a=hr()}else o=c;if(o!==i)if((a=Ze())!==i){if(61===e.charCodeAt(Re)){s=A;Re++}else{s=i;0===De&&Be(x)}if(s!==i){(l=Ke())===i&&(l=Xe())===i&&(l=er());if(l!==i){Ie=n;n=o=P(a,l)}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}else{Re=n;n=c}for(;n!==i;){r.push(n);n=Re;o=[];if((a=hr())!==i)for(;a!==i;){o.push(a);a=hr()}else o=c;if(o!==i)if((a=Ze())!==i){if(61===e.charCodeAt(Re)){s=A;Re++}else{s=i;0===De&&Be(x)}if(s!==i){(l=Ke())===i&&(l=Xe())===i&&(l=er());if(l!==i){Ie=n;n=o=P(a,l)}else{Re=n;n=c}}else{Re=n;n=c}}else{Re=n;n=c}else{Re=n;n=c}}if(r!==i){Ie=t;r=R(r)}De--;if((t=r)===i){r=i;0===De&&Be(b)}return t}function Ye(){var t,r,n;De++;t=Re;if(lr()!==i)if((r=Xe())!==i)if((n=function(){var t,r,n,o,a;De++;t=Re;r=[];n=Re;if(124===e.charCodeAt(Re)){o=W;Re++}else{o=i;0===De&&Be(H)}if(o!==i)if((a=Ze())!==i){Ie=n;o=L(a);n=o}else{Re=n;n=c}else{Re=n;n=c}for(;n!==i;){r.push(n);n=Re;if(124===e.charCodeAt(Re)){o=W;Re++}else{o=i;0===De&&Be(H)}if(o!==i)if((a=Ze())!==i){Ie=n;o=L(a);n=o}else{Re=n;n=c}else{Re=n;n=c}}if(r!==i){Ie=t;r=V(r)}De--;if((t=r)===i){r=i;0===De&&Be(q)}return t}())!==i)if(cr()!==i){Ie=t;t=N(r,n)}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}De--;t===i&&0===De&&Be(O);return t}function ze(){var t,r,n;De++;t=Re;if(lr()!==i){if(126===e.charCodeAt(Re)){r=z;Re++}else{r=i;0===De&&Be(X)}if(r!==i)if((n=Ze())!==i)if(cr()!==i){Ie=t;t=K(n)}else{Re=t;t=c}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}De--;t===i&&0===De&&Be(Y);return t}function Xe(){var t,r;De++;t=Re;if((r=function(){var t,r,n,o;De++;t=Re;(r=Ze())===i&&(r=u);if(r!==i){n=[];(o=tr())===i&&(o=Qe());if(o!==i)for(;o!==i;){n.push(o);(o=tr())===i&&(o=Qe())}else n=c;if(n!==i){Ie=t;r=gt(r,n);t=r}else{Re=t;t=c}}else{Re=t;t=c}if(t===i){t=Re;if(46===e.charCodeAt(Re)){r=rt;Re++}else{r=i;0===De&&Be(nt)}if(r!==i){n=[];(o=tr())===i&&(o=Qe());for(;o!==i;){n.push(o);(o=tr())===i&&(o=Qe())}if(n!==i){Ie=t;r=yt(n);t=r}else{Re=t;t=c}}else{Re=t;t=c}}De--;if(t===i){r=i;0===De&&Be(ft)}return t}())!==i){Ie=t;r=J(r)}if((t=r)===i){t=Re;if((r=Ze())!==i){Ie=t;r=Z(r)}t=r}De--;if(t===i){r=i;0===De&&Be($)}return t}function Ke(){var t,r;De++;t=Re;(r=function(){var t,r,n,o;De++;t=Re;if((r=Je())!==i){if(46===e.charCodeAt(Re)){n=rt;Re++}else{n=i;0===De&&Be(nt)}if(n!==i)if((o=$e())!==i){Ie=t;r=it(r,o);t=r}else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(et)}return t}())===i&&(r=Je());if(r!==i){Ie=t;r=tt(r)}De--;if((t=r)===i){r=i;0===De&&Be(Q)}return t}function $e(){var t,r,n;De++;t=Re;r=[];if(at.test(e.charAt(Re))){n=e.charAt(Re);Re++}else{n=i;0===De&&Be(st)}if(n!==i)for(;n!==i;){r.push(n);if(at.test(e.charAt(Re))){n=e.charAt(Re);Re++}else{n=i;0===De&&Be(st)}}else r=c;if(r!==i){Ie=t;r=lt(r)}De--;if((t=r)===i){r=i;0===De&&Be(ot)}return t}function Je(){var t;De++;(t=function(){var t,r,n;De++;t=Re;if(45===e.charCodeAt(Re)){r=ut;Re++}else{r=i;0===De&&Be(ht)}if(r!==i)if((n=$e())!==i){Ie=t;t=r=pt(r,n)}else{Re=t;t=c}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(ct)}return t}())===i&&(t=$e());De--;t===i&&0===De&&Be(dt);return t}function Ze(){var t,r,n,o;De++;t=Re;if(Ct.test(e.charAt(Re))){r=e.charAt(Re);Re++}else{r=i;0===De&&Be(vt)}if(r!==i){n=[];if(Tt.test(e.charAt(Re))){o=e.charAt(Re);Re++}else{o=i;0===De&&Be(_t)}for(;o!==i;){n.push(o);if(Tt.test(e.charAt(Re))){o=e.charAt(Re);Re++}else{o=i;0===De&&Be(_t)}}if(n!==i){Ie=t;t=r=St(r,n)}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(mt)}return t}function Qe(){var t,r,n,o,a,s;De++;t=Re;r=Re;if((n=function(){var t;if(91===e.charCodeAt(Re)){t=fe;Re++}else{t=i;0===De&&Be(ge)}return t}())!==i){o=Re;a=[];if(at.test(e.charAt(Re))){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(st)}if(s!==i)for(;s!==i;){a.push(s);if(at.test(e.charAt(Re))){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(st)}}else a=c;if(a!==i){Ie=o;a=Lt(a)}(o=a)===i&&(o=Xe());if(o!==i)if((a=function(){var t;if(93===e.charCodeAt(Re)){t=ye;Re++}else{t=i;0===De&&Be(me)}return t}())!==i){Ie=r;r=n=wt(o)}else{Re=r;r=c}else{Re=r;r=c}}else{Re=r;r=c}if(r!==i){(n=tr())===i&&(n=u);if(n!==i){Ie=t;t=r=bt(r,n)}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(Et)}return t}function tr(){var t,r,n,o,a;De++;t=Re;r=[];n=Re;if(46===e.charCodeAt(Re)){o=rt;Re++}else{o=i;0===De&&Be(nt)}if(o!==i)if((a=Ze())!==i){Ie=n;n=o=xt(a)}else{Re=n;n=c}else{Re=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Re;if(46===e.charCodeAt(Re)){o=rt;Re++}else{o=i;0===De&&Be(nt)}if(o!==i)if((a=Ze())!==i){Ie=n;n=o=xt(a)}else{Re=n;n=c}else{Re=n;n=c}}else r=c;if(r!==i){(n=Qe())===i&&(n=u);if(n!==i){Ie=t;t=r=Pt(r,n)}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(At)}return t}function er(){var t,r,n,o;De++;t=Re;if(34===e.charCodeAt(Re)){r=It;Re++}else{r=i;0===De&&Be(Mt)}if(r!==i){if(34===e.charCodeAt(Re)){n=It;Re++}else{n=i;0===De&&Be(Mt)}if(n!==i){Ie=t;t=r=Ot()}else{Re=t;t=c}}else{Re=t;t=c}if(t===i){t=Re;if(34===e.charCodeAt(Re)){r=It;Re++}else{r=i;0===De&&Be(Mt)}if(r!==i)if((n=nr())!==i){if(34===e.charCodeAt(Re)){o=It;Re++}else{o=i;0===De&&Be(Mt)}if(o!==i){Ie=t;t=r=Nt(n)}else{Re=t;t=c}}else{Re=t;t=c}else{Re=t;t=c}if(t===i){t=Re;if(34===e.charCodeAt(Re)){r=It;Re++}else{r=i;0===De&&Be(Mt)}if(r!==i){n=[];if((o=rr())!==i)for(;o!==i;){n.push(o);o=rr()}else n=c;if(n!==i){if(34===e.charCodeAt(Re)){o=It;Re++}else{o=i;0===De&&Be(Mt)}if(o!==i){Ie=t;t=r=kt(n)}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}}De--;if(t===i){r=i;0===De&&Be(Rt)}return t}function rr(){var t,e;if((t=ze())===i&&(t=Ye())===i){t=Re;if((e=nr())!==i){Ie=t;e=Dt(e)}t=e}return t}function nr(){var t,r,n,o,a;De++;t=Re;r=[];n=Re;o=Re;De++;a=sr();De--;if(a===i)o=p;else{Re=o;o=c}if(o!==i){if((a=ir())===i)if(Wt.test(e.charAt(Re))){a=e.charAt(Re);Re++}else{a=i;0===De&&Be(Ht)}if(a!==i){Ie=n;n=o=Ut(a)}else{Re=n;n=c}}else{Re=n;n=c}if(n!==i)for(;n!==i;){r.push(n);n=Re;o=Re;De++;a=sr();De--;if(a===i)o=p;else{Re=o;o=c}if(o!==i){if((a=ir())===i)if(Wt.test(e.charAt(Re))){a=e.charAt(Re);Re++}else{a=i;0===De&&Be(Ht)}if(a!==i){Ie=n;n=o=Ut(a)}else{Re=n;n=c}}else{Re=n;n=c}}else r=c;if(r!==i){Ie=t;r=Vt(r)}De--;if((t=r)===i){r=i;0===De&&Be(qt)}return t}function ir(){var t,r;t=Re;if(e.substr(Re,2)===Yt){r=Yt;Re+=2}else{r=i;0===De&&Be(zt)}if(r!==i){Ie=t;r=Xt()}return t=r}function or(){var t,r,n,o,a,s;De++;t=Re;if(e.substr(Re,2)===$t){r=$t;Re+=2}else{r=i;0===De&&Be(Jt)}if(r!==i){n=[];o=Re;a=Re;De++;if(e.substr(Re,2)===Zt){s=Zt;Re+=2}else{s=i;0===De&&Be(Qt)}De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){if(e.length>Re){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(Gt)}if(s!==i){Ie=o;o=a=te(s)}else{Re=o;o=c}}else{Re=o;o=c}for(;o!==i;){n.push(o);o=Re;a=Re;De++;if(e.substr(Re,2)===Zt){s=Zt;Re+=2}else{s=i;0===De&&Be(Qt)}De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){if(e.length>Re){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(Gt)}if(s!==i){Ie=o;o=a=te(s)}else{Re=o;o=c}}else{Re=o;o=c}}if(n!==i){if(e.substr(Re,2)===Zt){o=Zt;Re+=2}else{o=i;0===De&&Be(Qt)}if(o!==i){Ie=t;t=r=ee(n)}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(Kt)}return t}function ar(){var t,r,n,o,a,s;De++;t=Re;if(e.substr(Re,2)===ne){r=ne;Re+=2}else{r=i;0===De&&Be(ie)}if(r!==i){n=[];o=Re;a=Re;De++;if(e.substr(Re,2)===oe){s=oe;Re+=2}else{s=i;0===De&&Be(ae)}De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){if(e.length>Re){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(Gt)}if(s!==i){Ie=o;o=a=Ut(s)}else{Re=o;o=c}}else{Re=o;o=c}for(;o!==i;){n.push(o);o=Re;a=Re;De++;if(e.substr(Re,2)===oe){s=oe;Re+=2}else{s=i;0===De&&Be(ae)}De--;if(s===i)a=p;else{Re=a;a=c}if(a!==i){if(e.length>Re){s=e.charAt(Re);Re++}else{s=i;0===De&&Be(Gt)}if(s!==i){Ie=o;o=a=Ut(s)}else{Re=o;o=c}}else{Re=o;o=c}}if(n!==i){if(e.substr(Re,2)===oe){o=oe;Re+=2}else{o=i;0===De&&Be(ae)}if(o!==i){Ie=t;t=r=se(n)}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}De--;if(t===i){r=i;0===De&&Be(re)}return t}function sr(){var t,r,n,o,a,s,l,u,h,d;t=Re;if((r=lr())!==i){n=[];o=hr();for(;o!==i;){n.push(o);o=hr()}if(n!==i){if(le.test(e.charAt(Re))){o=e.charAt(Re);Re++}else{o=i;0===De&&Be(ce)}if(o!==i){a=[];s=hr();for(;s!==i;){a.push(s);s=hr()}if(a!==i){s=[];l=Re;u=Re;De++;h=cr();De--;if(h===i)u=p;else{Re=u;u=c}if(u!==i){h=Re;De++;d=ur();De--;if(d===i)h=p;else{Re=h;h=c}if(h!==i){if(e.length>Re){d=e.charAt(Re);Re++}else{d=i;0===De&&Be(Gt)}if(d!==i)l=u=[u,h,d];else{Re=l;l=c}}else{Re=l;l=c}}else{Re=l;l=c}if(l!==i)for(;l!==i;){s.push(l);l=Re;u=Re;De++;h=cr();De--;if(h===i)u=p;else{Re=u;u=c}if(u!==i){h=Re;De++;d=ur();De--;if(d===i)h=p;else{Re=h;h=c}if(h!==i){if(e.length>Re){d=e.charAt(Re);Re++}else{d=i;0===De&&Be(Gt)}if(d!==i)l=u=[u,h,d];else{Re=l;l=c}}else{Re=l;l=c}}else{Re=l;l=c}}else s=c;if(s!==i){l=[];u=hr();for(;u!==i;){l.push(u);u=hr()}if(l!==i)if((u=cr())!==i)t=r=[r,n,o,a,s,l,u];else{Re=t;t=c}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}}else{Re=t;t=c}t===i&&(t=Ye());return t}function lr(){var t;if(123===e.charCodeAt(Re)){t=ue;Re++}else{t=i;0===De&&Be(he)}return t}function cr(){var t;if(125===e.charCodeAt(Re)){t=pe;Re++}else{t=i;0===De&&Be(de)}return t}function ur(){var t;if(10===e.charCodeAt(Re)){t=Ce;Re++}else{t=i;0===De&&Be(ve)}if(t===i){if(e.substr(Re,2)===Te){t=Te;Re+=2}else{t=i;0===De&&Be(_e)}if(t===i){if(13===e.charCodeAt(Re)){t=Se;Re++}else{t=i;0===De&&Be(Ee)}if(t===i){if(8232===e.charCodeAt(Re)){t=Le;Re++}else{t=i;0===De&&Be(we)}if(t===i)if(8233===e.charCodeAt(Re)){t=be;Re++}else{t=i;0===De&&Be(Ae)}}}}return t}function hr(){var t;if(xe.test(e.charAt(Re))){t=e.charAt(Re);Re++}else{t=i;0===De&&Be(Pe)}t===i&&(t=ur());return t}function pr(t){return t.concat([["line",Fe(Ie).line],["col",Fe(Ie).column]])}if((r=a())!==i&&Re===e.length)return r;r!==i&&Re<e.length&&Be({type:"end",description:"end of input"});throw Ge(null,ke,Ne)}}}();t.parse=e.parse;return e});!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.compile",["dust.core","dust.parse"],function(t,r){return e(r,t).compile}):"object"==typeof exports?module.exports=e(require("./parser").parse,require("./dust")):e(t.dust.parse,t.dust)}(this,function(t,e){var r={},n=e.isArray;r.compile=function(n,i){try{return function(t,n){var i,o={name:n,bodies:[],blocks:{},index:0,auto:"h"},a=e.escapeJs(n),s=n?'"'+a+'",':"",l="function(dust){",c=r.compileNode(o,t);n&&(l+='dust.register("'+a+'",'+c+");");l+=function(t){var e,r=[],n=t.blocks;for(e in n)r.push('"'+e+'":'+n[e]);if(r.length){t.blocks="ctx=ctx.shiftBlocks(blocks);";return"var blocks={"+r.join(",")+"};"}t.blocks="";return t.blocks}(o)+function(t){var e,r,n=[],i=t.bodies,o=t.blocks;for(e=0,r=i.length;e<r;e++)n[e]="function body_"+e+"(chk,ctx){"+o+"return chk"+i[e]+";}body_"+e+".__dustBody=!0;";return n.join("")}(o)+"return "+c+"}";i="("+l+"(dust));";return e.config.amd?"define("+s+'["dust.core"],'+l+");":e.config.cjs?"module.exports=function(dust){var tmpl="+i+"var f="+m().toString()+";f.template=tmpl;return f}":i}(function(t){return r.filterNode({},t)}(t(n)),i)}catch(t){if(!t.line||!t.column)throw t;throw new SyntaxError(t.message+" At line : "+t.line+", column : "+t.column)}};r.filterNode=function(t,e){return r.optimizers[e[0]](t,e)};r.optimizers={body:function(t,e){var n,i,o,a,s=[e[0]];for(i=1,o=e.length;i<o;i++)if(a=r.filterNode(t,e[i]))if("buffer"===a[0]||"format"===a[0])if(n){n[0]="buffer"===a[0]?"buffer":n[0];n[1]+=a.slice(1,-2).join("")}else{n=a;s.push(a)}else{n=null;s.push(a)}return s},buffer:a,special:function(t,e){return["buffer",o[e[1]],e[2],e[3]]},format:function(t,r){if(e.config.whitespace){r.splice(1,2,r.slice(1,-2).join(""));return r}return null},reference:i,"#":i,"?":i,"^":i,"<":i,"+":i,"@":i,"%":i,partial:i,context:i,params:i,bodies:i,param:i,filters:a,key:a,path:a,literal:a,raw:a,comment:s,line:s,col:s};r.pragmas={esc:function(t,e,r){var n,i=t.auto;e||(e="h");t.auto="s"===e?"":e;n=l(t,r.block);t.auto=i;return n}};function i(t,e){var n,i,o,a=[e[0]];for(n=1,i=e.length;n<i;n++)(o=r.filterNode(t,e[n]))&&a.push(o);return a}var o={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};function a(t,e){return e}function s(){}function l(t,e){var n,i,o="";for(n=1,i=e.length;n<i;n++)o+=r.compileNode(t,e[n]);return o}r.compileNode=function(t,e){return r.nodes[e[0]](t,e)};r.nodes={body:function(t,e){var r=t.index++,n="body_"+r;t.bodies[r]=l(t,e);return n},buffer:function(t,e){return".w("+y(e[1])+")"},format:function(t,e){return".w("+y(e[1])+")"},reference:function(t,e){return".f("+r.compileNode(t,e[1])+",ctx,"+r.compileNode(t,e[2])+")"},"#":function(t,e){return c(t,e,"section")},"?":function(t,e){return c(t,e,"exists")},"^":function(t,e){return c(t,e,"notexists")},"<":function(t,e){for(var n=e[4],i=1,o=n.length;i<o;i++){var a=n[i];if("block"===a[1][1]){t.blocks[e[1].text]=r.compileNode(t,a[2]);return""}}return""},"+":function(t,e){return void 0===e[1].text&&void 0===e[4]?".b(ctx.getBlock("+r.compileNode(t,e[1])+",chk, ctx),"+r.compileNode(t,e[2])+", {},"+r.compileNode(t,e[3])+")":".b(ctx.getBlock("+y(e[1].text)+"),"+r.compileNode(t,e[2])+","+r.compileNode(t,e[4])+","+r.compileNode(t,e[3])+")"},"@":function(t,e){return".h("+y(e[1].text)+","+r.compileNode(t,e[2])+","+r.compileNode(t,e[4])+","+r.compileNode(t,e[3])+")"},"%":function(t,e){var n,i,o,a,s,l,c,u,h,p=e[1][1];if(!r.pragmas[p])return"";i={};for(u=1,h=(n=e[4]).length;u<h;u++)i[(l=n[u])[1][1]]=l[2];a={};for(u=1,h=(o=e[3]).length;u<h;u++)a[(c=o[u])[1][1]]=c[2][1];s=e[2][1]?e[2][1].text:null;return r.pragmas[p](t,s,i,a)},partial:function(t,e){return".p("+r.compileNode(t,e[1])+",ctx,"+r.compileNode(t,e[2])+","+r.compileNode(t,e[3])+")"},context:function(t,e){return e[1]?"ctx.rebase("+r.compileNode(t,e[1])+")":"ctx"},params:function(t,e){for(var n=[],i=1,o=e.length;i<o;i++)n.push(r.compileNode(t,e[i]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(t,e){for(var n=[],i=1,o=e.length;i<o;i++)n.push(r.compileNode(t,e[i]));return"{"+n.join(",")+"}"},param:function(t,e){return r.compileNode(t,e[1])+":"+r.compileNode(t,e[2])},filters:function(t,e){for(var r=[],n=1,i=e.length;n<i;n++){var o=e[n];r.push('"'+o+'"')}return'"'+t.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(t,e){return'ctx.get(["'+e[1]+'"], false)'},path:function(t,e){for(var i=e[1],o=e[2],a=[],s=0,l=o.length;s<l;s++)n(o[s])?a.push(r.compileNode(t,o[s])):a.push('"'+o[s]+'"');return"ctx.getPath("+i+", ["+a.join(",")+"])"},literal:function(t,e){return y(e[1])},raw:function(t,e){return".w("+y(e[1])+")"}};function c(t,n,i){return"."+(e._aliases[i]||i)+"("+r.compileNode(t,n[1])+","+r.compileNode(t,n[2])+","+r.compileNode(t,n[4])+","+r.compileNode(t,n[3])+")"}var u=/\\/g,h=/"/g,p=/\f/g,d=/\n/g,f=/\r/g,g=/\t/g;var y="undefined"==typeof JSON?function(t){return'"'+function(t){return t.replace(u,"\\\\").replace(h,'\\"').replace(p,"\\f").replace(d,"\\n").replace(f,"\\r").replace(g,"\\t")}(t)+'"'}:JSON.stringify;function m(t){return function(r,n){return e[n?"render":"stream"](t,r,n)}}e.compiler=r;e.compile=e.compiler.compile;e.renderSource=function(t,r,n){return m(e.loadSource(e.compile(t)))(r,n)};e.compileFn=function(t,r){return m(e.loadSource(e.compile(t,r)))};e.filterNode=r.filterNode;e.optimizers=r.optimizers;e.pragmas=r.pragmas;e.compileNode=r.compileNode;e.nodes=r.nodes;return r});"function"==typeof define&&define.amd&&!0===define.amd.dust&&define(["require","dust.core","dust.compile"],function(t,e){e.onLoad=function(e,r){t([e],function(){r()})};return e});!function(t,e){"function"==typeof define&&define.amd&&!0===define.amd.dust?define(["dust.core"],e):"object"==typeof exports?module.exports=e(require("dustjs-linkedin")):e(t.dust)}(this,function(t){function e(e,r,n){n=n||"INFO";e=e?"{@"+e+"}: ":"";t.log(e+r,n)}var r={};function n(t){return function(t){return t.stack.tail&&t.stack.tail.head&&void 0!==t.stack.tail.head.__select__}(t)&&t.get("__select__")}function i(t,e){var r,n=t.stack.head,i=t.rebase();t.stack&&t.stack.tail&&(i.stack=t.stack.tail);var o={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(r in e)o[r]=e[r];return i.push({__select__:o}).push(n,t.stack.index,t.stack.of)}function o(t){var e,r;t.isDeferredPending=!0;if(t.deferreds.length){t.isDeferredComplete=!0;for(e=0,r=t.deferreds.length;e<r;e++)t.deferreds[e]()}t.isDeferredPending=!1}function a(t,e){return"function"==typeof e?e.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):e}function s(t,r){return function(i,o,a,s){return function(t,r,i,o,a,s){var c,u,h,p,d=i.block,f=i.else,g=n(r)||{};if(g.isResolved&&!g.isDeferredPending)return t;if(o.hasOwnProperty("key"))u=o.key;else{if(!g.hasOwnProperty("key")){e(a,"No key specified","WARN");return t}u=g.key}p=o.type||g.type;u=l(r.resolve(u),p);h=l(r.resolve(o.value),p);if(s(u,h)){if(!g.isPending){c=!0;g.isPending=!0}d&&(t=t.render(d,r));c&&(g.isResolved=!0)}else f&&(t=t.render(f,r));return t}(i,o,a,s,t,r)}}function l(t,e){e&&(e=e.toLowerCase());switch(e){case"number":return+t;case"string":return String(t);case"boolean":t="false"!==t&&t;return Boolean(t);case"date":return new Date(t)}return t}var c={tap:function(t,n,i){!function(t){if(!r[t]){e(t,"Deprecation warning: "+t+" is deprecated and will be removed in a future version of dustjs-helpers","WARN");e(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+t.replace(/\W+/g,""),"WARN");r[t]=!0}}("tap");return i.resolve(t)},sep:function(t,e,r){var n=r.block;return e.stack.index===e.stack.of-1?t:n?n(t,e):t},first:function(t,e,r){return 0===e.stack.index?r.block(t,e):t},last:function(t,e,r){return e.stack.index===e.stack.of-1?r.block(t,e):t},contextDump:function(t,r,n,i){var o,s,l=r.resolve(i.to);switch(r.resolve(i.key)){case"full":o=r.stack;break;default:o=r.stack.head}s=JSON.stringify(o,a,2);switch(l){case"console":e("contextDump",s);break;default:s=s.replace(/</g,"\\u003c");t=t.write(s)}return t},math:function(t,r,a,s){var l,c=s.key,u=s.method,h=s.operand,p=s.round;if(!s.hasOwnProperty("key")||!s.method){e("math","`key` or `method` was not provided","ERROR");return t}c=parseFloat(r.resolve(c));h=parseFloat(r.resolve(h));switch(u){case"mod":0===h&&e("math","Division by 0","ERROR");l=c%h;break;case"add":l=c+h;break;case"subtract":l=c-h;break;case"multiply":l=c*h;break;case"divide":0===h&&e("math","Division by 0","ERROR");l=c/h;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:e("math","Method `"+u+"` is not supported","ERROR")}if(void 0!==l){p&&(l=Math.round(l));if(a&&a.block){r=i(r,{key:l});t=t.render(a.block,r);o(n(r))}else t=t.write(l)}return t},select:function(t,r,a,s){var l=a.block,c={};s.hasOwnProperty("key")&&(c.key=r.resolve(s.key));s.hasOwnProperty("type")&&(c.type=s.type);if(l){r=i(r,c);t=t.render(l,r);o(n(r))}else e("select","Missing body block","WARN");return t},eq:s("eq",function(t,e){return t===e}),ne:s("ne",function(t,e){return t!==e}),lt:s("lt",function(t,e){return t<e}),lte:s("lte",function(t,e){return t<=e}),gt:s("gt",function(t,e){return t>e}),gte:s("gte",function(t,e){return t>=e}),any:function(t,r,i,o){var a=n(r);a?a.isDeferredComplete?e("any","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){a.deferreds.push(function(){a.isResolved&&(t=t.render(i.block,r));t.end()})}):e("any","Must be used inside a {@select} block","ERROR");return t},none:function(t,r,i,o){var a=n(r);a?a.isDeferredComplete?e("none","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){a.deferreds.push(function(){a.isResolved||(t=t.render(i.block,r));t.end()})}):e("none","Must be used inside a {@select} block","ERROR");return t},size:function(e,r,n,i){var o,a,s=i.key;if((s=r.resolve(i.key))&&!0!==s)if(t.isArray(s))o=s.length;else if(!isNaN(parseFloat(s))&&isFinite(s))o=s;else if("object"==typeof s){o=0;for(a in s)s.hasOwnProperty(a)&&o++}else o=(s+"").length;else o=0;return e.write(o)}};for(var u in c)t.helpers[u]=c[u];return t});!function(t,e){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(r){return e(r,t)}):"object"==typeof module&&module.exports?module.exports=e(require("dustjs-linkedin"),this):t.dust=e(t.dust,t)}(this,function(t,e,r){"use strict";var n=Object.prototype.toString,i=typeof console!==r?console:{log:function(){}},o={isArray:Array.isArray||function(t){return"[object Array]"===n.call(t)},isAvailable:function(t){return s[t]!==r},log:i.log},a={selected:r,languages:{},filters:{}},s=a.languages;typeof String.prototype.trim===r&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});t.i18n={resetContext:function(){a.selected=r;Object.keys(s).forEach(function(t){delete s[t]})},setLanguage:function(t){if(!o.isAvailable(t))throw new Error("language '"+t+"' not available!");a.selected=t},setLanguages:function(t){o.isArray(t)&&t.forEach(function(t){o.isAvailable(t)||(s[t]={});a.selected===r&&(a.selected=t)})},add:function(t,e){if(o.isAvailable(t)){var r=s[t];Object.keys(e).forEach(function(t){r[t]=e[t]})}},addFilter:function(t,e){t in a.filters||(a.filters[t]=e)}};t.helpers.i18n=function(e,n,i,l){if(l&&l.$key!==r){var c,u,h,p,d=a.selected,f=s[d],g=/\{(\s*[\w]+\s*)\}/g;h=t.helpers.tap(l.$key,e,n).split("|");var y=t.helpers.tap(h.shift(),e,n);p=f!==r&&f[y]!==r?f[y]:null;for(;null!==(c=g.exec(p));){if("$key"===c[1].trim()){u="";o.log("$key can't be used as a parameter")}else u=t.helpers.tap(l[c[1].trim()],e,n);p=p.replace(c[0],u)}h.forEach(function(t){t in a.filters&&(p=a.filters[t](p))});e.write(p)}else o.log("No key given in the i18n helper");return e};return t});!function(){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){e=e||0;return this.indexOf(t,e)===e});dust.helpers.iterate=function(t,e,r,n){var i=(n=n||{}).on||e.current(),o=null!=n.excludedKeys?n.excludedKeys.split(","):null;for(var a in i)(null==o||o.indexOf(a)<0)&&(t=t.render(r.block,e.push({key:a,value:i[a]})));return t};dust.helpers.startsWith=function(t,e,r,n){var i=r.block,o=r.else,a=n.key,s=n.value;"string"==typeof a&&0===a.toLowerCase().indexOf(s.toLowerCase())?t=t.render(i,e):o&&(t=t.render(o,e));return t}}();var __extends=this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype;t.prototype=new r},exports,define;function JL(t){if(!t)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(t,e){for(var r=e,n=0;n<this.length;n++)r=t(r,this[n],n,this);return r});var e="";return("."+t).split(".").reduce(function(t,r,n,i){void 0===(r=t["__"+(e=e?e+"."+r:r)])&&(JL.Logger.prototype=t,r=new JL.Logger(e),t["__"+e]=r);return r},JL.__)}!function(t){function e(t,e,r){void 0!==e[t]&&(null===e[t]?delete r[t]:r[t]=e[t])}function r(e){if(null!=t.enabled&&!t.enabled||null!=t.maxMessages&&1>t.maxMessages)return!1;try{if(e.userAgentRegex&&!RegExp(e.userAgentRegex).test(navigator.userAgent))return!1}catch(t){}try{if(e.ipRegex&&t.clientIP&&!RegExp(e.ipRegex).test(t.clientIP))return!1}catch(t){}return!0}function n(t,e){try{if(t.disallow&&RegExp(t.disallow).test(e))return!1}catch(t){}return!0}function i(t){return"function"==typeof t?t instanceof RegExp?t.toString():t():t}function o(t){switch(typeof(t=i(t))){case"string":return new a(t,null,t);case"number":case"boolean":return t=t.toString(),new a(t,null,t);case"undefined":return new a("undefined",null,"undefined");case"object":return t instanceof RegExp||t instanceof String||t instanceof Number||t instanceof Boolean?(t=t.toString(),new a(t,null,t)):new a(null,t,JSON.stringify(t));default:return new a("unknown",null,"unknown")}}t.enabled;t.maxMessages;t.defaultAjaxUrl;t.clientIP;t.defaultBeforeSend;t.requestId="";var a=function(t,e,r){this.msg=t;this.meta=e;this.finalString=r};t.setOptions=function(t){e("enabled",t,this);e("maxMessages",t,this);e("defaultAjaxUrl",t,this);e("clientIP",t,this);e("requestId",t,this);e("defaultBeforeSend",t,this);return this};t.getAllLevel=function(){return-2147483648};t.getTraceLevel=function(){return 1e3};t.getDebugLevel=function(){return 2e3};t.getInfoLevel=function(){return 3e3};t.getWarnLevel=function(){return 4e3};t.getErrorLevel=function(){return 5e3};t.getFatalLevel=function(){return 6e3};t.getOffLevel=function(){return 2147483647};var s=function(t,e){this.inner=e;this.name="JL.Exception";this.message=o(t).finalString};t.Exception=s;s.prototype=Error();var l=function(t,e,r,n){this.l=t;this.m=e;this.n=r;this.t=n};t.LogItem=l;s=function(){function i(e,r){this.appenderName=e;this.sendLogItems=r;this.level=t.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(t){e("level",t,this);e("ipRegex",t,this);e("userAgentRegex",t,this);e("disallow",t,this);e("sendWithBufferLevel",t,this);e("storeInBufferLevel",t,this);e("bufferSize",t,this);e("batchSize",t,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(t,e,i,o,a,s,c){!r(this)||!n(this,s)||a<this.storeInBufferLevel||(t=new l(a,s,c,(new Date).getTime()),a<this.level?0<this.bufferSize&&(this.buffer.push(t),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(t),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=t.maxMessages&&1>t.maxMessages||(null!=t.maxMessages&&(t.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();t.Appender=s;var c=function(r){function n(t){r.call(this,t,n.prototype.sendLogItemsAjax)}__extends(n,r);n.prototype.setOptions=function(t){e("url",t,this);e("beforeSend",t,this);r.prototype.setOptions.call(this,t);return this};n.prototype.sendLogItemsAjax=function(e){try{var r="/jsnlog.logger";null!=t.defaultAjaxUrl&&(r=t.defaultAjaxUrl);this.url&&(r=this.url);var n=JSON.stringify({r:t.requestId,lg:e}),i=this.getXhr(r);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof t.defaultBeforeSend&&t.defaultBeforeSend.call(this,i);i.send(n)}catch(t){}};n.prototype.getXhr=function(e){var r=new XMLHttpRequest;if(!("withCredentials"in r)&&"undefined"!=typeof XDomainRequest)return(r=new XDomainRequest).open("POST",e),r;r.open("POST",e);r.setRequestHeader("Content-Type","application/json");r.setRequestHeader("JSNLog-RequestId",t.requestId);return r};return n}(s);t.AjaxAppender=c;var u=function(e){function r(t){e.call(this,t,r.prototype.sendLogItemsConsole)}__extends(r,e);r.prototype.clog=function(t){console.log(t)};r.prototype.cerror=function(t){console.error?console.error(t):this.clog(t)};r.prototype.cwarn=function(t){console.warn?console.warn(t):this.clog(t)};r.prototype.cinfo=function(t){console.info?console.info(t):this.clog(t)};r.prototype.cdebug=function(t){console.debug?console.debug(t):this.cinfo(t)};r.prototype.sendLogItemsConsole=function(e){try{if(console){var r;for(r=0;r<e.length;++r){var n=e[r],i=n.n+": "+n.m;"undefined"==typeof window&&(i=new Date(n.t)+" | "+i);n.l<=t.getDebugLevel()?this.cdebug(i):n.l<=t.getInfoLevel()?this.cinfo(i):n.l<=t.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(t){}};return r}(s);t.ConsoleAppender=u;s=function(){function t(t){this.loggerName=t;this.seenRegexes=[]}t.prototype.setOptions=function(t){e("level",t,this);e("userAgentRegex",t,this);e("disallow",t,this);e("ipRegex",t,this);e("appenders",t,this);e("onceOnly",t,this);this.seenRegexes=[];return this};t.prototype.buildExceptionObject=function(t){var e={};t.stack?e.stack=t.stack:e.e=t;t.message&&(e.message=t.message);t.name&&(e.name=t.name);t.data&&(e.data=t.data);t.inner&&(e.inner=this.buildExceptionObject(t.inner));return e};t.prototype.log=function(t,e,a){var s=0;if(!this.appenders)return this;if(t>=this.level&&r(this)&&(a?(s=this.buildExceptionObject(a)).logData=i(e):s=e,n(this,(e=o(s)).finalString))){if(this.onceOnly)for(s=this.onceOnly.length-1;0<=s;){if(RegExp(this.onceOnly[s]).test(e.finalString)){if(this.seenRegexes[s])return this;this.seenRegexes[s]=!0}s--}e.meta=e.meta||{};e.meta.loggerName=this.loggerName;for(s=this.appenders.length-1;0<=s;)this.appenders[s].log(1e3>=t?"trace":2e3>=t?"debug":3e3>=t?"info":4e3>=t?"warn":5e3>=t?"error":"fatal",e.msg,e.meta,function(){},t,e.finalString,this.loggerName),s--}return this};t.prototype.trace=function(t){return this.log(1e3,t)};t.prototype.debug=function(t){return this.log(2e3,t)};t.prototype.info=function(t){return this.log(3e3,t)};t.prototype.warn=function(t){return this.log(4e3,t)};t.prototype.error=function(t){return this.log(5e3,t)};t.prototype.fatal=function(t){return this.log(6e3,t)};t.prototype.fatalException=function(t,e){return this.log(6e3,t,e)};return t}();t.Logger=s;t.createAjaxAppender=function(t){return new c(t)};t.createConsoleAppender=function(t){return new u(t)};s=new c("");"undefined"==typeof window&&(s=new u(""));t.__=new t.Logger("");t.__.setOptions({level:t.getDebugLevel(),appenders:[s]})}(JL||(JL={}));void 0!==exports&&(exports.JL=JL);"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);var ol=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";t.exports=i,t.exports.default=i;var n=r(4);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,r,n,i){i||(i=g(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],l(i,t.leaf?n(o):o);return i}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,r,i,o){for(var a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((r-e)/i/2)*i,n(t,a,e,r,o),s.push(e,a,a,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!f(t,e))return r;for(var i,o,a,s,l=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],f(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):d(t,s)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!f(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],f(t,a=e.leaf?r(o):o)){if(e.leaf||d(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,a,s=this.data,l=this.toBBox(t),c=[],u=[];s||c.length;){if(s||(s=c.pop(),n=c[c.length-1],r=u.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),c.push(s),this._condense(c),this;a||s.leaf||!d(s,l)?n?(r++,s=n.children[r],a=!1):s=null:(c.push(s),u.push(r),r=0,n=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return a(i=g(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=g([])).leaf=!1,i.height=n;var l,c,u,h,p=Math.ceil(o/s),d=p*Math.ceil(Math.sqrt(s));for(y(t,e,r,d,this.compareMinX),l=e;l<=r;l+=d)for(y(t,l,u=Math.min(l+d-1,r),p,this.compareMinY),c=l;c<=u;c+=p)h=Math.min(c+p-1,u),i.children.push(this._build(t,c,h,n-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,l,c,u,p,d,f;n.push(e),!e.leaf&&n.length-1!==r;){for(u=p=1/0,i=0,o=e.children.length;i<o;i++)l=h(a=e.children[i]),d=t,f=a,(c=(Math.max(f.maxX,d.maxX)-Math.min(f.minX,d.minX))*(Math.max(f.maxY,d.maxY)-Math.min(f.minY,d.minY))-l)<p?(p=c,u=l<u?l:u,s=a):c===p&&l<u&&(u=l,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),l(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=g(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=g([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,l,c,u,p,d,f,g,y,m,C;for(c=u=1/0,n=e;n<=r-e;n++)d=i=s(t,0,n,this.toBBox),f=o=s(t,n,r,this.toBBox),void 0,void 0,void 0,void 0,g=Math.max(d.minX,f.minX),y=Math.max(d.minY,f.minY),m=Math.min(d.maxX,f.maxX),C=Math.min(d.maxY,f.maxY),a=Math.max(0,m-g)*Math.max(0,C-y),l=h(i)+h(o),a<c?(c=a,p=n,u=l<u?l:u):a===c&&l<u&&(u=l,p=n);return p},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:c,i=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,c=s(t,0,e,a),u=s(t,r-e,r,a),h=p(c)+p(u);for(i=e;i<r-e;i++)o=t.children[i],l(c,t.leaf?a(o):o),h+=p(c);for(i=r-e-1;i>=e;i--)o=t.children[i],l(u,t.leaf?a(o):o),h+=p(u);return h},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)l(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},,,,function(t,e,r){t.exports=function(){"use strict";function t(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(r,n,i,o,a){!function e(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=n-i+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-l*u/s+h)),Math.min(o,Math.floor(n+(s-l)*u/s+h)),a)}var p=r[n],d=i,f=o;for(t(r,i,n),a(r[o],p)>0&&t(r,i,o);d<f;){for(t(r,d,f),d++,f--;a(r[d],p)<0;)d++;for(;a(r[f],p)>0;)f--}0===a(r[i],p)?t(r,i,f):t(r,++f,o),f<=n&&(i=f+1),n<=f&&(o=f-1)}}(r,n,i||0,o||r.length-1,a||e)}}()},function(t,e,r){"use strict";function n(){return function(){throw new Error("Unimplemented abstract method.")}()}r.r(e);var i=0;function o(t){return t.ol_uid||(t.ol_uid=String(++i))}var a="5.3.3",s=function(t){function e(e){var r="Assertion failed. See https://openlayers.org/en/"+("latest"===a?a:"v"+a.split("-")[0])+"/doc/errors/#"+e+" for details.";t.call(this,r),this.code=e,this.name="AssertionError",this.message=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),l={ADD:"add",REMOVE:"remove"},c="propertychange",u="function"==typeof Object.assign?Object.assign:function(t,e){var r=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1,o=arguments.length;i<o;++i){var a=r[i];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(n[s]=a[s])}return n};function h(t){for(var e in t)delete t[e]}function p(t){var e=[];for(var r in t)e.push(t[r]);return e}function d(t){var e;for(e in t)return!1;return!e}function f(t,e,r,n){for(var i,o=0,a=t.length;o<a;++o)if((i=t[o]).listener===e&&i.bindTo===r)return n&&(i.deleteIndex=o),i}function g(t,e){var r=y(t);return r?r[e]:void 0}function y(t,e){var r=t.ol_lm;return!r&&e&&(r=t.ol_lm={}),r}function m(t,e){var r=g(t,e);if(r){for(var n=0,i=r.length;n<i;++n)t.removeEventListener(e,r[n].boundListener),h(r[n]);r.length=0;var o=y(t);o&&(delete o[e],0===Object.keys(o).length&&function(t){delete t.ol_lm}(t))}}function C(t,e,r,n,i){var o=y(t,!0),a=o[e];a||(a=o[e]=[]);var s=f(a,r,n,!1);return s?i||(s.callOnce=!1):(s={bindTo:n,callOnce:!!i,listener:r,target:t,type:e},t.addEventListener(e,function(t){var e=function(e){var r=t.listener,n=t.bindTo||t.target;return t.callOnce&&_(t),r.call(n,e)};return t.boundListener=e,e}(s)),a.push(s)),s}function v(t,e,r,n){return C(t,e,r,n,!0)}function T(t,e,r,n){var i=g(t,e);if(i){var o=f(i,r,n,!0);o&&_(o)}}function _(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=g(t.target,t.type);if(e){var r="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==r&&e.splice(r,1),0===e.length&&m(t.target,t.type)}h(t)}}var S=function(){this.disposed_=!1};S.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},S.prototype.disposeInternal=function(){};var E=S;function L(){return!0}function w(){return!1}function b(){}var A=function(t){this.propagationStopped,this.type=t,this.target=null};function x(t){t.stopPropagation()}A.prototype.preventDefault=function(){this.propagationStopped=!0},A.prototype.stopPropagation=function(){this.propagationStopped=!0};var P=A,R=function(t){function e(){t.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new P(t):t,r=e.type;e.target=this;var n,i=this.listeners_[r];if(i){r in this.dispatching_||(this.dispatching_[r]=0,this.pendingRemovals_[r]=0),++this.dispatching_[r];for(var o=0,a=i.length;o<a;++o)if(!1===i[o].call(this,e)||e.propagationStopped){n=!1;break}if(--this.dispatching_[r],0===this.dispatching_[r]){var s=this.pendingRemovals_[r];for(delete this.pendingRemovals_[r];s--;)this.removeEventListener(r,b);delete this.dispatching_[r]}return n}},e.prototype.disposeInternal=function(){!function(t){var e=y(t);if(e)for(var r in e)m(t,r)}(this)},e.prototype.getListeners=function(t){return this.listeners_[t]},e.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.prototype.removeEventListener=function(t,e){var r=this.listeners_[t];if(r){var n=r.indexOf(e);t in this.pendingRemovals_?(r[n]=b,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t])}},e}(E),I={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},M=function(t){function e(){t.call(this),this.revision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){++this.revision_,this.dispatchEvent(I.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=C(this,t[i],e);return n}return C(this,t,e)},e.prototype.once=function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=v(this,t[i],e);return n}return v(this,t,e)},e.prototype.un=function(t,e){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)T(this,t[r],e);else T(this,t,e)},e}(R),O=function(t){function e(e,r,n){t.call(this,e),this.key=r,this.oldValue=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),N={};function k(t){return N.hasOwnProperty(t)?N[t]:N[t]="change:"+t}var D=function(t){function e(e){t.call(this),o(this),this.values_={},void 0!==e&&this.setProperties(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return Object.keys(this.values_)},e.prototype.getProperties=function(){return u({},this.values_)},e.prototype.notify=function(t,e){var r;r=k(t),this.dispatchEvent(new O(r,t,e)),r=c,this.dispatchEvent(new O(r,t,e))},e.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.prototype.setProperties=function(t,e){for(var r in t)this.set(r,t[r],e)},e.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e}(M),F="length",B=function(t){function e(e,r){t.call(this,e),this.element=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),G=function(t){function e(e,r){t.call(this);var n=r||{};if(this.unique_=!!n.unique,this.array_=e||[],this.unique_)for(var i=0,o=this.array_.length;i<o;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,r=t.length;e<r;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)t(e[r],r,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(F)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new B(l.ADD,e))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new B(l.REMOVE,e)),e},e.prototype.setAt=function(t,e){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new B(l.REMOVE,n)),this.dispatchEvent(new B(l.ADD,e))}else{for(var i=r;i<t;++i)this.insertAt(i,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(F,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new s(58)},e}(D),U=function(t){function e(e,r,n){t.call(this,e),this.map=r,this.frameState=void 0!==n?n:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),j=function(t){function e(e,r,n,i,o){t.call(this,e,r,o),this.originalEvent=n,this.pixel=r.getEventPixel(n),this.coordinate=r.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==i&&i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(U),q="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",W=-1!==q.indexOf("firefox"),H=-1!==q.indexOf("safari")&&-1==q.indexOf("chrom"),V=-1!==q.indexOf("webkit")&&-1==q.indexOf("edge"),Y=-1!==q.indexOf("macintosh"),z=window.devicePixelRatio||1,X=function(){var t=!1;try{t=!!document.createElement("canvas").getContext("2d").setLineDash}catch(t){}return t}(),K=(navigator,"ontouchstart"in window),$="PointerEvent"in window,J=!!navigator.msPointerEnabled,Z={SINGLECLICK:"singleclick",CLICK:I.CLICK,DBLCLICK:I.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Q=function(t){function e(e,r,n,i,o){t.call(this,e,r,n.originalEvent,i,o),this.pointerEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(j),tt={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},et=function(t,e){this.dispatcher=t,this.mapping_=e};et.prototype.getEvents=function(){return Object.keys(this.mapping_)},et.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var rt=et,nt=1,it="mouse";function ot(t){if(!this.isEventSimulatedFromTouch_(t)){nt.toString()in this.pointerMap&&this.cancel(t);var e=ut(t,this.dispatcher);this.pointerMap[nt.toString()]=t,this.dispatcher.down(e,t)}}function at(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.move(e,t)}}function st(t){if(!this.isEventSimulatedFromTouch_(t)){var e=this.pointerMap[nt.toString()];if(e&&e.button===t.button){var r=ut(t,this.dispatcher);this.dispatcher.up(r,t),this.cleanupMouse()}}}function lt(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.enterOver(e,t)}}function ct(t){if(!this.isEventSimulatedFromTouch_(t)){var e=ut(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}}function ut(t,e){var r=e.cloneEvent(t,t),n=r.preventDefault;return r.preventDefault=function(){t.preventDefault(),n()},r.pointerId=nt,r.isPrimary=!0,r.pointerType=it,r}var ht=function(t){function e(e){var r={mousedown:ot,mousemove:at,mouseup:st,mouseover:lt,mouseout:ct};t.call(this,e,r),this.pointerMap=e.pointerMap,this.lastTouches=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isEventSimulatedFromTouch_=function(t){for(var e=this.lastTouches,r=t.clientX,n=t.clientY,i=0,o=e.length,a=void 0;i<o&&(a=e[i]);i++){var s=Math.abs(r-a[0]),l=Math.abs(n-a[1]);if(s<=25&&l<=25)return!0}return!1},e.prototype.cancel=function(t){var e=ut(t,this.dispatcher);this.dispatcher.cancel(e,t),this.cleanupMouse()},e.prototype.cleanupMouse=function(){delete this.pointerMap[nt.toString()]},e}(rt),pt=["","unavailable","touch","pen","mouse"];function dt(t){this.pointerMap[t.pointerId.toString()]=t;var e=this.prepareEvent_(t);this.dispatcher.down(e,t)}function ft(t){var e=this.prepareEvent_(t);this.dispatcher.move(e,t)}function gt(t){var e=this.prepareEvent_(t);this.dispatcher.up(e,t),this.cleanup(t.pointerId)}function yt(t){var e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)}function mt(t){var e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)}function Ct(t){var e=this.prepareEvent_(t);this.dispatcher.cancel(e,t),this.cleanup(t.pointerId)}function vt(t){var e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)}function Tt(t){var e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)}var _t=function(t){function e(e){var r={MSPointerDown:dt,MSPointerMove:ft,MSPointerUp:gt,MSPointerOut:yt,MSPointerOver:mt,MSPointerCancel:Ct,MSGotPointerCapture:Tt,MSLostPointerCapture:vt};t.call(this,e,r),this.pointerMap=e.pointerMap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvent_=function(t){var e=t;return"number"==typeof t.pointerType&&((e=this.dispatcher.cloneEvent(t,t)).pointerType=pt[t.pointerType]),e},e.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]},e}(rt);function St(t){this.dispatcher.fireNativeEvent(t)}function Et(t){this.dispatcher.fireNativeEvent(t)}function Lt(t){this.dispatcher.fireNativeEvent(t)}function wt(t){this.dispatcher.fireNativeEvent(t)}function bt(t){this.dispatcher.fireNativeEvent(t)}function At(t){this.dispatcher.fireNativeEvent(t)}function xt(t){this.dispatcher.fireNativeEvent(t)}function Pt(t){this.dispatcher.fireNativeEvent(t)}var Rt=function(t){function e(e){var r={pointerdown:St,pointermove:Et,pointerup:Lt,pointerout:wt,pointerover:bt,pointercancel:At,gotpointercapture:Pt,lostpointercapture:xt};t.call(this,e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(rt),It=!1,Mt=function(t){function e(e,r,n){t.call(this,e),this.originalEvent=r;var i=n||{};this.buttons=function(t){var e;if(t.buttons||It)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e}(i),this.pressure=function(t,e){return t.pressure?t.pressure:e?.5:0}(i,this.buttons),this.bubbles="bubbles"in i&&i.bubbles,this.cancelable="cancelable"in i&&i.cancelable,this.view="view"in i?i.view:null,this.detail="detail"in i?i.detail:null,this.screenX="screenX"in i?i.screenX:0,this.screenY="screenY"in i?i.screenY:0,this.clientX="clientX"in i?i.clientX:0,this.clientY="clientY"in i?i.clientY:0,this.ctrlKey="ctrlKey"in i&&i.ctrlKey,this.altKey="altKey"in i&&i.altKey,this.shiftKey="shiftKey"in i&&i.shiftKey,this.metaKey="metaKey"in i&&i.metaKey,this.button="button"in i?i.button:0,this.relatedTarget="relatedTarget"in i?i.relatedTarget:null,this.pointerId="pointerId"in i?i.pointerId:0,this.width="width"in i?i.width:0,this.height="height"in i?i.height:0,this.tiltX="tiltX"in i?i.tiltX:0,this.tiltY="tiltY"in i?i.tiltY:0,this.pointerType="pointerType"in i?i.pointerType:"",this.hwTimestamp="hwTimestamp"in i?i.hwTimestamp:0,this.isPrimary="isPrimary"in i&&i.isPrimary,r.preventDefault&&(this.preventDefault=function(){r.preventDefault()})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);!function(){try{var t=new MouseEvent("click",{buttons:1});It=1===t.buttons}catch(t){}}();var Ot=Mt;function Nt(t,e){return t>e?1:t<e?-1:0}function kt(t,e){return t.indexOf(e)>=0}function Dt(t,e,r){var n,i=t.length;if(t[0]<=e)return 0;if(e<=t[i-1])return i-1;if(r>0){for(n=1;n<i;++n)if(t[n]<e)return n-1}else if(r<0){for(n=1;n<i;++n)if(t[n]<=e)return n}else for(n=1;n<i;++n){if(t[n]==e)return n;if(t[n]<e)return t[n-1]-e<e-t[n]?n-1:n}return i-1}function Ft(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}}function Bt(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]}function Gt(t,e){for(var r,n=t.length>>>0,i=0;i<n;i++)if(e(r=t[i],i,t))return r;return null}function Ut(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function jt(t,e){var r;return t.every(function(n,i){return r=i,!e(n,i,t)})?-1:r}function qt(t){this.vacuumTouches_(t),this.setPrimaryTouch_(t.changedTouches[0]),this.dedupSynthMouse_(t),this.clickCount_++,this.processTouches_(t,this.overDown_)}function Wt(t){this.processTouches_(t,this.moveOverOut_)}function Ht(t){this.dedupSynthMouse_(t),this.processTouches_(t,this.upOut_)}function Vt(t){this.processTouches_(t,this.cancelOut_)}var Yt=function(t){function e(e,r){var n={touchstart:qt,touchmove:Wt,touchend:Ht,touchcancel:Vt};t.call(this,e,n),this.pointerMap=e.pointerMap,this.mouseSource=r,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier},e.prototype.setPrimaryTouch_=function(t){var e=Object.keys(this.pointerMap).length;(0===e||1===e&&nt.toString()in this.pointerMap)&&(this.firstTouchId_=t.identifier,this.cancelResetClickCount_())},e.prototype.removePrimaryPointer_=function(t){t.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},e.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)},e.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},e.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)},e.prototype.touchToPointer_=function(t,e){var r=this.dispatcher.cloneEvent(t,e);return r.pointerId=e.identifier+2,r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount_,r.button=0,r.buttons=1,r.width=e.radiusX||0,r.height=e.radiusY||0,r.pressure=e.force||.5,r.isPrimary=this.isPrimaryTouch_(e),r.pointerType="touch",r.clientX=e.clientX,r.clientY=e.clientY,r.screenX=e.screenX,r.screenY=e.screenY,r},e.prototype.processTouches_=function(t,e){var r=Array.prototype.slice.call(t.changedTouches),n=r.length;function i(){t.preventDefault()}for(var o=0;o<n;++o){var a=this.touchToPointer_(t,r[o]);a.preventDefault=i,e.call(this,t,a)}},e.prototype.findTouch_=function(t,e){for(var r=t.length,n=0;n<r;n++)if(t[n].identifier===e)return!0;return!1},e.prototype.vacuumTouches_=function(t){var e=t.touches,r=Object.keys(this.pointerMap),n=r.length;if(n>=e.length){for(var i=[],o=0;o<n;++o){var a=Number(r[o]),s=this.pointerMap[a];a==nt||this.findTouch_(e,a-2)||i.push(s.out)}for(var l=0;l<i.length;++l)this.cancelOut_(t,i[l])}},e.prototype.overDown_=function(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target},this.dispatcher.over(e,t),this.dispatcher.enter(e,t),this.dispatcher.down(e,t)},e.prototype.moveOverOut_=function(t,e){var r=e,n=this.pointerMap[r.pointerId];if(n){var i=n.out,o=n.outTarget;this.dispatcher.move(r,t),i&&o!==r.target&&(i.relatedTarget=r.target,r.relatedTarget=o,i.target=o,r.target?(this.dispatcher.leaveOut(i,t),this.dispatcher.enterOver(r,t)):(r.target=o,r.relatedTarget=null,this.cancelOut_(t,r))),n.out=r,n.outTarget=r.target}},e.prototype.upOut_=function(t,e){this.dispatcher.up(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},e.prototype.cancelOut_=function(t,e){this.dispatcher.cancel(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)},e.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId],this.removePrimaryPointer_(t)},e.prototype.dedupSynthMouse_=function(t){var e=this.mouseSource.lastTouches,r=t.changedTouches[0];if(this.isPrimaryTouch_(r)){var n=[r.clientX,r.clientY];e.push(n),setTimeout(function(){var t,r,i;r=n,(i=(t=e).indexOf(r))>-1&&t.splice(i,1)},this.dedupTimeout_)}},e}(rt),zt=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],Xt=function(t){function e(e){t.call(this),this.element_=e,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.registerSources=function(){if($)this.registerSource("native",new Rt(this));else if(J)this.registerSource("ms",new _t(this));else{var t=new ht(this);this.registerSource("mouse",t),K&&this.registerSource("touch",new Yt(this,t))}this.register_()},e.prototype.registerSource=function(t,e){var r=e,n=r.getEvents();n&&(n.forEach(function(t){var e=r.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(r))}.bind(this)),this.eventSourceList_.push(r))},e.prototype.register_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var r=this.eventSourceList_[e];this.addEvents_(r.getEvents())}},e.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var r=this.eventSourceList_[e];this.removeEvents_(r.getEvents())}},e.prototype.eventHandler_=function(t){var e=t.type,r=this.eventMap_[e];r&&r(t)},e.prototype.addEvents_=function(t){t.forEach(function(t){C(this.element_,t,this.eventHandler_,this)}.bind(this))},e.prototype.removeEvents_=function(t){t.forEach(function(t){T(this.element_,t,this.eventHandler_,this)}.bind(this))},e.prototype.cloneEvent=function(t,e){for(var r={},n=0,i=zt.length;n<i;n++){var o=zt[n][0];r[o]=t[o]||e[o]||zt[n][1]}return r},e.prototype.down=function(t,e){this.fireEvent(tt.POINTERDOWN,t,e)},e.prototype.move=function(t,e){this.fireEvent(tt.POINTERMOVE,t,e)},e.prototype.up=function(t,e){this.fireEvent(tt.POINTERUP,t,e)},e.prototype.enter=function(t,e){t.bubbles=!1,this.fireEvent(tt.POINTERENTER,t,e)},e.prototype.leave=function(t,e){t.bubbles=!1,this.fireEvent(tt.POINTERLEAVE,t,e)},e.prototype.over=function(t,e){t.bubbles=!0,this.fireEvent(tt.POINTEROVER,t,e)},e.prototype.out=function(t,e){t.bubbles=!0,this.fireEvent(tt.POINTEROUT,t,e)},e.prototype.cancel=function(t,e){this.fireEvent(tt.POINTERCANCEL,t,e)},e.prototype.leaveOut=function(t,e){this.out(t,e),this.contains_(t.target,t.relatedTarget)||this.leave(t,e)},e.prototype.enterOver=function(t,e){this.over(t,e),this.contains_(t.target,t.relatedTarget)||this.enter(t,e)},e.prototype.contains_=function(t,e){return!(!t||!e)&&t.contains(e)},e.prototype.makeEvent=function(t,e,r){return new Ot(t,r,e)},e.prototype.fireEvent=function(t,e,r){var n=this.makeEvent(t,e,r);this.dispatchEvent(n)},e.prototype.fireNativeEvent=function(t){var e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)},e.prototype.wrapMouseEvent=function(t,e){return this.makeEvent(t,ut(e,this),e)},e.prototype.disposeInternal=function(){this.unregister_(),t.prototype.disposeInternal.call(this)},e}(R),Kt=function(t){function e(e,r){t.call(this),this.map_=e,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=r?r*z:z,this.down_=null;var n=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Xt(n),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=C(this.pointerEventHandler_,tt.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=C(this.pointerEventHandler_,tt.POINTERMOVE,this.relayEvent_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.emulateClick_=function(t){var e=new Q(Z.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Q(Z.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new Q(Z.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t;e.type==Z.POINTERUP||e.type==Z.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==Z.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new Q(Z.POINTERUP,this.map_,t);this.dispatchEvent(e),e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new Q(Z.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_=t,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new Xt(document),this.dragListenerKeys_.push(C(this.documentPointerEventHandler_,Z.POINTERMOVE,this.handlePointerMove_,this),C(this.documentPointerEventHandler_,Z.POINTERUP,this.handlePointerUp_,this),C(this.pointerEventHandler_,Z.POINTERCANCEL,this.handlePointerUp_,this)))},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new Q(Z.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()},e.prototype.relayEvent_=function(t){var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Q(t.type,this.map_,t,e))},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(_(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(_(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),t.prototype.disposeInternal.call(this)},e}(R),$t={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Jt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Zt={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render",RENDERCOMPLETE:"rendercomplete"},Qt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function te(t,e){if(!t)throw new s(e)}var ee=function(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}};ee.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,h(this.queuedElements_)},ee.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,r=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},ee.prototype.enqueue=function(t){te(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=1/0&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},ee.prototype.getCount=function(){return this.elements_.length},ee.prototype.getLeftChildIndex_=function(t){return 2*t+1},ee.prototype.getRightChildIndex_=function(t){return 2*t+2},ee.prototype.getParentIndex_=function(t){return t-1>>1},ee.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},ee.prototype.isEmpty=function(){return 0===this.elements_.length},ee.prototype.isKeyQueued=function(t){return t in this.queuedElements_},ee.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},ee.prototype.siftUp_=function(t){for(var e=this.elements_,r=this.priorities_,n=e.length,i=e[t],o=r[t],a=t;t<n>>1;){var s=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),c=l<n&&r[l]<r[s]?l:s;e[t]=e[c],r[t]=r[c],t=c}e[t]=i,r[t]=o,this.siftDown_(a,t)},ee.prototype.siftDown_=function(t,e){for(var r=this.elements_,n=this.priorities_,i=r[e],o=n[e];e>t;){var a=this.getParentIndex_(e);if(!(n[a]>o))break;r[e]=r[a],n[e]=n[a],e=a}r[e]=i,n[e]=o},ee.prototype.reprioritize=function(){var t,e,r,n=this.priorityFunction_,i=this.elements_,o=this.priorities_,a=0,s=i.length;for(e=0;e<s;++e)(r=n(t=i[e]))==1/0?delete this.queuedElements_[this.keyFunction_(t)]:(o[a]=r,i[a++]=t);i.length=a,o.length=a,this.heapify_()};var re=function(t){function e(e,r){t.call(this,function(t){return e.apply(null,t)},function(t){return t[0].getKey()}),this.tileChangeCallback_=r,this.tilesLoading_=0,this.tilesLoadingKeys_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.enqueue=function(e){var r=t.prototype.enqueue.call(this,e);r&&C(e[0],I.CHANGE,this.handleTileChange,this);return r},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,r=e.getState();if(r===Qt.LOADED||r===Qt.ERROR||r===Qt.EMPTY||r===Qt.ABORT){T(e,I.CHANGE,this.handleTileChange,this);var n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var r,n,i,o=0,a=!1;this.tilesLoading_<t&&o<e&&this.getCount()>0;)i=(n=this.dequeue()[0]).getKey(),(r=n.getState())===Qt.ABORT?a=!0:r!==Qt.IDLE||i in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[i]=!0,++this.tilesLoading_,++o,n.load());0===o&&a&&this.tileChangeCallback_()},e}(ee),ne=42,ie=256;function oe(t,e,r){return Math.min(Math.max(t,e),r)}var ae="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function se(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((t-r)*a+(e-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return le(t,e,r,n)}function le(t,e,r,n){var i=r-t,o=n-e;return i*i+o*o}function ce(t){return t*Math.PI/180}function ue(t,e){var r=t%e;return r*e<0?r+e:r}function he(t,e,r){return t+r*(e-t)}function pe(t){return t}function de(t,e){return void 0!==t?0:void 0}function fe(t,e){return void 0!==t?t+e:void 0}var ge="center",ye="resolution",me="rotation";function Ce(t,e,r){var n=void 0!==r?t.toFixed(r):""+t,i=n.indexOf(".");return(i=-1===i?n.length:i)>e?n:new Array(1+e-i).join("0")+n}function ve(t,e){return t[0]+=e[0],t[1]+=e[1],t}function Te(t,e){var r,n,i=t[0],o=t[1],a=e[0],s=e[1],l=a[0],c=a[1],u=s[0],h=s[1],p=u-l,d=h-c,f=0===p&&0===d?0:(p*(i-l)+d*(o-c))/(p*p+d*d||0);return f<=0?(r=l,n=c):f>=1?(r=u,n=h):(r=l+f*p,n=c+f*d),[r,n]}function _e(t,e){for(var r=!0,n=t.length-1;n>=0;--n)if(t[n]!=e[n]){r=!1;break}return r}function Se(t,e){var r=Math.cos(e),n=Math.sin(e),i=t[0]*r-t[1]*n,o=t[1]*r+t[0]*n;return t[0]=i,t[1]=o,t}function Ee(t,e){return t[0]*=e,t[1]*=e,t}function Le(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function we(t,e){return Math.sqrt(Le(t,e))}function be(t,e){return Le(t,Te(t,e))}function Ae(t){return Math.pow(t,3)}function xe(t){return 1-Ae(1-t)}function Pe(t){return 3*t*t-2*t*t*t}function Re(t){return t}var Ie={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Me={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Oe(t){for(var e=[1/0,1/0,-1/0,-1/0],r=0,n=t.length;r<n;++r)ze(e,t[r]);return e}function Ne(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function ke(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function De(t,e,r){var n,i;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*i}function Fe(t,e){return Ge(t,e[0],e[1])}function Be(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Ge(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function Ue(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=e[0],s=e[1],l=Me.UNKNOWN;return a<r?l|=Me.LEFT:a>i&&(l|=Me.RIGHT),s<n?l|=Me.BELOW:s>o&&(l|=Me.ABOVE),l===Me.UNKNOWN&&(l=Me.INTERSECTING),l}function je(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]}function qe(t){return je(1/0,1/0,-1/0,-1/0,t)}function We(t,e){var r=t[0],n=t[1];return je(r,n,r,n,e)}function He(t,e,r,n,i){return Xe(qe(i),t,e,r,n)}function Ve(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Ye(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function ze(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Xe(t,e,r,n,i){for(;r<n;r+=i)Ke(t,e[r],e[r+1]);return t}function Ke(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function $e(t,e,r){var n;return(n=e.call(r,Ze(t)))?n:(n=e.call(r,Qe(t)))?n:(n=e.call(r,ar(t)))?n:(n=e.call(r,or(t)))||!1}function Je(t){var e=0;return cr(t)||(e=sr(t)*nr(t)),e}function Ze(t){return[t[0],t[1]]}function Qe(t){return[t[2],t[1]]}function tr(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function er(t,e){var r;return e===Ie.BOTTOM_LEFT?r=Ze(t):e===Ie.BOTTOM_RIGHT?r=Qe(t):e===Ie.TOP_LEFT?r=or(t):e===Ie.TOP_RIGHT?r=ar(t):te(!1,13),r}function rr(t,e,r,n,i){var o=e*n[0]/2,a=e*n[1]/2,s=Math.cos(r),l=Math.sin(r),c=o*s,u=o*l,h=a*s,p=a*l,d=t[0],f=t[1],g=d-c+p,y=d-c-p,m=d+c-p,C=d+c+p,v=f-u-h,T=f-u+h,_=f+u+h,S=f+u-h;return je(Math.min(g,y,m,C),Math.min(v,T,_,S),Math.max(g,y,m,C),Math.max(v,T,_,S),i)}function nr(t){return t[3]-t[1]}function ir(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return lr(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):qe(n),n}function or(t){return[t[0],t[3]]}function ar(t){return[t[2],t[3]]}function sr(t){return t[2]-t[0]}function lr(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function cr(t){return t[2]<t[0]||t[3]<t[1]}function ur(t,e){var r=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=n,t[3]+=n}var hr={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},pr={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function dr(t,e,r,n,i,o){for(var a=o||[],s=0,l=e;l<r;l+=n){var c=t[l],u=t[l+1];a[s++]=i[0]*c+i[2]*u+i[4],a[s++]=i[1]*c+i[3]*u+i[5]}return o&&a.length!=s&&(a.length=s),a}var fr=6371008.8;function gr(t,e,r){var n=r||fr,i=ce(t[1]),o=ce(e[1]),a=(o-i)/2,s=ce(e[0]-t[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}var yr={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},mr={};mr[yr.DEGREES]=2*Math.PI*6370997/360,mr[yr.FEET]=.3048,mr[yr.METERS]=1,mr[yr.USFEET]=1200/3937;var Cr=yr,vr=function(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit};vr.prototype.canWrapX=function(){return this.canWrapX_},vr.prototype.getCode=function(){return this.code_},vr.prototype.getExtent=function(){return this.extent_},vr.prototype.getUnits=function(){return this.units_},vr.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||mr[this.units_]},vr.prototype.getWorldExtent=function(){return this.worldExtent_},vr.prototype.getAxisOrientation=function(){return this.axisOrientation_},vr.prototype.isGlobal=function(){return this.global_},vr.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},vr.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},vr.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},vr.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},vr.prototype.setWorldExtent=function(t){this.worldExtent_=t},vr.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},vr.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var Tr=vr,_r=6378137,Sr=Math.PI*_r,Er=[-Sr,-Sr,Sr,Sr],Lr=[-180,-85,180,85],wr=function(t){function e(e){t.call(this,{code:e,units:Cr.METERS,extent:Er,global:!0,worldExtent:Lr,getPointResolution:function(t,e){return t/ae(e[1]/_r)}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Tr),br=[new wr("EPSG:3857"),new wr("EPSG:102100"),new wr("EPSG:102113"),new wr("EPSG:900913"),new wr("urn:ogc:def:crs:EPSG:6.18:3:3857"),new wr("urn:ogc:def:crs:EPSG::3857"),new wr("http://www.opengis.net/gml/srs/epsg.xml#3857")];var Ar,xr,Pr,Rr=[-180,-90,180,90],Ir=6378137*Math.PI/180,Mr=function(t){function e(e,r){t.call(this,{code:e,units:Cr.DEGREES,extent:Rr,axisOrientation:r,global:!0,metersPerUnit:Ir,worldExtent:Rr})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Tr),Or=[new Mr("CRS:84"),new Mr("EPSG:4326","neu"),new Mr("urn:ogc:def:crs:EPSG::4326","neu"),new Mr("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new Mr("urn:ogc:def:crs:OGC:1.3:CRS84"),new Mr("urn:ogc:def:crs:OGC:2:84"),new Mr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Mr("urn:x-ogc:def:crs:EPSG:4326","neu")],Nr={},kr={};function Dr(t,e,r){var n=t.getCode(),i=e.getCode();n in kr||(kr[n]={}),kr[n][i]=r}function Fr(t,e){var r;return t in kr&&e in kr[t]&&(r=kr[t][e]),r}function Br(t,e,r){var n;if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Gr(t,e,r){if(void 0!==e&&t!==e){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function Ur(t){!function(t,e){Nr[t]=e}(t.getCode(),t),Dr(t,t,Br)}function jr(t){return"string"==typeof t?Nr[t]||null:t||null}function qr(t,e,r,n){var i,o=(t=jr(t)).getPointResolutionFunc();if(o)i=o(e,r);else if(t.getUnits()==Cr.DEGREES&&!n||n==Cr.DEGREES)i=e;else{var a=zr(t,jr("EPSG:4326")),s=[r[0]-e/2,r[1],r[0]+e/2,r[1],r[0],r[1]-e/2,r[0],r[1]+e/2];i=(gr((s=a(s,s,2)).slice(0,2),s.slice(2,4))+gr(s.slice(4,6),s.slice(6,8)))/2;var l=n?mr[n]:t.getMetersPerUnit();void 0!==l&&(i/=l)}return i}function Wr(t){!function(t){t.forEach(Ur)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&Dr(e,t,Br)})})}function Hr(t,e){return t?"string"==typeof t?jr(t):t:jr(e)}function Vr(t){return function(e,r,n){for(var i=e.length,o=void 0!==n?n:2,a=void 0!==r?r:new Array(i),s=0;s<i;s+=o){var l=t([e[s],e[s+1]]);a[s]=l[0],a[s+1]=l[1];for(var c=o-1;c>=2;--c)a[s+c]=e[s+c]}return a}}function Yr(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return t.getCode()===e.getCode()?r:zr(t,e)===Br&&r}function zr(t,e){var r=Fr(t.getCode(),e.getCode());return r||(r=Gr),r}function Xr(t,e){return zr(jr(t),jr(e))}function Kr(t,e,r){return Xr(e,r)(t,void 0,t.length)}function $r(t,e,r){return function(t,e,r){var n=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];return e(n,n,2),function(t,e,r){return je(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}([n[0],n[2],n[4],n[6]],[n[1],n[3],n[5],n[7]],r)}(t,Xr(e,r))}Wr(br),Wr(Or),Ar=br,xr=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=Sr,s=0;s<n;s+=i){o[s]=a*t[s]/180;var l=_r*Math.log(Math.tan(Math.PI*(t[s+1]+90)/360));l>a?l=a:l<-a&&(l=-a),o[s+1]=l}return o},Pr=function(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i)o[a]=180*t[a]/Sr,o[a+1]=360*Math.atan(Math.exp(t[a+1]/_r))/Math.PI-90;return o},Or.forEach(function(t){Ar.forEach(function(e){Dr(t,e,xr),Dr(e,t,Pr)})});var Jr=new Array(6);function Zr(t){return tn(t,1,0,0,1,0,0)}function Qr(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],d=e[5];return t[0]=r*l+i*c,t[1]=n*l+o*c,t[2]=r*u+i*h,t[3]=n*u+o*h,t[4]=r*p+i*d+a,t[5]=n*p+o*d+s,t}function tn(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function en(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function rn(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function nn(t,e,r){return Qr(t,tn(Jr,e,0,0,r,0,0))}function on(t,e,r){return Qr(t,tn(Jr,1,0,0,1,e,r))}function an(t,e,r,n,i,o,a,s){var l=Math.sin(o),c=Math.cos(o);return t[0]=n*c,t[1]=i*l,t[2]=-n*l,t[3]=i*c,t[4]=a*n*c-s*n*l+e,t[5]=a*i*l+s*i*c+r,t}var sn=[1,0,0,1,0,0],ln=function(t){function e(){t.call(this),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return n()},e.prototype.closestPointXY=function(t,e,r,i){return n()},e.prototype.containsXY=function(t,e){return!1},e.prototype.getClosestPoint=function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return n()},e.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){n()},e.prototype.scale=function(t,e,r){n()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return n()},e.prototype.getType=function(){return n()},e.prototype.applyTransform=function(t){n()},e.prototype.intersectsExtent=function(t){return n()},e.prototype.translate=function(t,e){n()},e.prototype.transform=function(t,e){var r=jr(t),n=r.getUnits()==Cr.TILE_PIXELS?function(t,n,i){var o=r.getExtent(),a=r.getWorldExtent(),s=nr(a)/nr(o);return an(sn,a[0],a[3],s,-s,0,0,0),dr(t,0,t.length,i,sn,n),Xr(r,e)(t,n,i)}:Xr(r,e);return this.applyTransform(n),this},e}(D);function cn(t){var e;return t==pr.XY?e=2:t==pr.XYZ||t==pr.XYM?e=3:t==pr.XYZM&&(e=4),e}var un=function(t){function e(){t.call(this),this.layout=pr.XY,this.stride=2,this.flatCoordinates=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeExtent=function(t){return He(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return n()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(h(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var r=this.getSimplifiedGeometryInternal(t);return r.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[e]=r,r):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=cn(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){n()},e.prototype.setLayout=function(t,e,r){var n;if(t)n=cn(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=pr.XY,void(this.stride=2);e=e[0]}t=function(t){var e;2==t?e=pr.XY:3==t?e=pr.XYZ:4==t&&(e=pr.XYZM);return e}(n=e.length)}this.layout=t,this.stride=n},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],l=Math.cos(i),c=Math.sin(i),u=o[0],h=o[1],p=0,d=0;d<r;d+=n){var f=t[d]-u,g=t[d+1]-h;s[p++]=u+f*l-g*c,s[p++]=h+f*c+g*l;for(var y=d+2;y<d+n;++y)s[p++]=t[y]}a&&s.length!=p&&(s.length=p)}(r,0,r.length,n,t,e,r),this.changed()}},e.prototype.scale=function(t,e,r){var n=e;void 0===n&&(n=t);var i=r;i||(i=tr(this.getExtent()));var o=this.getFlatCoordinates();if(o){var a=this.getStride();!function(t,e,r,n,i,o,a,s){for(var l=s||[],c=a[0],u=a[1],h=0,p=0;p<r;p+=n){var d=t[p]-c,f=t[p+1]-u;l[h++]=c+i*d,l[h++]=u+o*f;for(var g=p+2;g<p+n;++g)l[h++]=t[g]}s&&l.length!=h&&(l.length=h)}(o,0,o.length,a,t,n,i,o),this.changed()}},e.prototype.translate=function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],l=0,c=0;c<r;c+=n){s[l++]=t[c]+i,s[l++]=t[c+1]+o;for(var u=c+2;u<c+n;++u)s[l++]=t[u]}a&&s.length!=l&&(s.length=l)}(r,0,r.length,n,t,e,r),this.changed()}},e}(ln);function hn(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],l=t[e+1];i+=a*s-o*l,o=s,a=l}return i/2}function pn(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=hn(t,e,s,n),e=s}return i}function dn(t,e,r,n,i,o,a){var s,l=t[e],c=t[e+1],u=t[r]-l,h=t[r+1]-c;if(0===u&&0===h)s=e;else{var p=((i-l)*u+(o-c)*h)/(u*u+h*h);if(p>1)s=r;else{if(p>0){for(var d=0;d<n;++d)a[d]=he(t[e+d],t[r+d],p);return void(a.length=n)}s=e}}for(var f=0;f<n;++f)a[f]=t[s+f];a.length=n}function fn(t,e,r,n,i){var o=t[e],a=t[e+1];for(e+=n;e<r;e+=n){var s=t[e],l=t[e+1],c=le(o,a,s,l);c>i&&(i=c),o=s,a=l}return i}function gn(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=fn(t,e,s,n,i),e=s}return i}function yn(t,e,r,n,i,o,a,s,l,c,u){if(e==r)return c;var h,p;if(0===i){if((p=le(a,s,t[e],t[e+1]))<c){for(h=0;h<n;++h)l[h]=t[e+h];return l.length=n,p}return c}for(var d=u||[NaN,NaN],f=e+n;f<r;)if(dn(t,f-n,f,n,a,s,d),(p=le(a,s,d[0],d[1]))<c){for(c=p,h=0;h<n;++h)l[h]=d[h];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(p)-Math.sqrt(c))/i|0,1);if(o&&(dn(t,r-n,e,n,a,s,d),(p=le(a,s,d[0],d[1]))<c)){for(c=p,h=0;h<n;++h)l[h]=d[h];l.length=n}return c}function mn(t,e,r,n,i,o,a,s,l,c,u){for(var h=u||[NaN,NaN],p=0,d=r.length;p<d;++p){var f=r[p];c=yn(t,e,f,n,i,o,a,s,l,c,h),e=f}return c}function Cn(t,e,r,n){for(var i=0,o=r.length;i<o;++i)t[e++]=r[i];return e}function vn(t,e,r,n){for(var i=0,o=r.length;i<o;++i)for(var a=r[i],s=0;s<n;++s)t[e++]=a[s];return e}function Tn(t,e,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=vn(t,e,r[s],n);o[a++]=c,e=c}return o.length=a,o}function _n(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=e;s<r;s+=n)o[a++]=t.slice(s,s+n);return o.length=a,o}function Sn(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=_n(t,e,c,n,o[a]),e=c}return o.length=a,o}function En(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=Sn(t,e,c,n,o[a]),e=c[c.length-1]}return o.length=a,o}function Ln(t,e,r,n,i,o,a){var s=(r-e)/n;if(s<3){for(;e<r;e+=n)o[a++]=t[e],o[a++]=t[e+1];return a}var l=new Array(s);l[0]=1,l[s-1]=1;for(var c=[e,r-n],u=0;c.length>0;){for(var h=c.pop(),p=c.pop(),d=0,f=t[p],g=t[p+1],y=t[h],m=t[h+1],C=p+n;C<h;C+=n){var v=se(t[C],t[C+1],f,g,y,m);v>d&&(u=C,d=v)}d>i&&(l[(u-e)/n]=1,p+n<u&&c.push(p,u),u+n<h&&c.push(u,h))}for(var T=0;T<s;++T)l[T]&&(o[a++]=t[e+T*n],o[a++]=t[e+T*n+1]);return a}function wn(t,e){return e*Math.round(t/e)}function bn(t,e,r,n,i,o,a){if(e==r)return a;var s,l,c=wn(t[e],i),u=wn(t[e+1],i);e+=n,o[a++]=c,o[a++]=u;do{if(s=wn(t[e],i),l=wn(t[e+1],i),(e+=n)==r)return o[a++]=s,o[a++]=l,a}while(s==c&&l==u);for(;e<r;){var h=wn(t[e],i),p=wn(t[e+1],i);if(e+=n,h!=s||p!=l){var d=s-c,f=l-u,g=h-c,y=p-u;d*y==f*g&&(d<0&&g<d||d==g||d>0&&g>d)&&(f<0&&y<f||f==y||f>0&&y>f)?(s=h,l=p):(o[a++]=s,o[a++]=l,c=s,u=l,s=h,l=p)}}return o[a++]=s,o[a++]=l,a}function An(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=bn(t,e,u,n,i,o,a),s.push(a),e=u}return a}var xn=function(t){function e(e,r){t.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?this.setCoordinates(e,r):this.setFlatCoordinates(r,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.getArea=function(){return hn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=Ln(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,pr.XY)},e.prototype.getType=function(){return hr.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un),Pn=function(t){function e(e,r){t.call(this),this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){var i=this.flatCoordinates,o=le(t,e,i[0],i[1]);if(o<n){for(var a=this.stride,s=0;s<a;++s)r[s]=i[s];return r.length=a,o}return n},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return We(this.flatCoordinates,t)},e.prototype.getType=function(){return hr.POINT},e.prototype.intersectsExtent=function(t){return Ge(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Cn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un);function Rn(t,e,r,n,i){return!$e(i,function(i){return!In(t,e,r,n,i[0],i[1])})}function In(t,e,r,n,i,o){for(var a=0,s=t[r-n],l=t[r-n+1];e<r;e+=n){var c=t[e],u=t[e+1];l<=o?u>o&&(c-s)*(o-l)-(i-s)*(u-l)>0&&a++:u<=o&&(c-s)*(o-l)-(i-s)*(u-l)<0&&a--,s=c,l=u}return 0!==a}function Mn(t,e,r,n,i,o){if(0===r.length)return!1;if(!In(t,e,r[0],n,i,o))return!1;for(var a=1,s=r.length;a<s;++a)if(In(t,r[a-1],r[a],n,i,o))return!1;return!0}function On(t,e,r,n,i,o,a){for(var s,l,c,u,h,p,d,f=i[o+1],g=[],y=0,m=r.length;y<m;++y){var C=r[y];for(u=t[C-n],p=t[C-n+1],s=e;s<C;s+=n)h=t[s],d=t[s+1],(f<=p&&d<=f||p<=f&&f<=d)&&(c=(f-p)/(d-p)*(h-u)+u,g.push(c)),u=h,p=d}var v=NaN,T=-1/0;for(g.sort(Nt),u=g[0],s=1,l=g.length;s<l;++s){h=g[s];var _=Math.abs(h-u);_>T&&Mn(t,e,r,n,c=(u+h)/2,f)&&(v=c,T=_),u=h}return isNaN(v)&&(v=i[o]),a?(a.push(v,f,T),a):[v,f,T]}function Nn(t,e,r,n,i,o){for(var a,s=[t[e],t[e+1]],l=[];e+n<r;e+=n){if(l[0]=t[e+n],l[1]=t[e+n+1],a=i.call(o,s,l))return a;s[0]=l[0],s[1]=l[1]}return!1}function kn(t,e,r,n,i){var o=Xe([1/0,1/0,-1/0,-1/0],t,e,r,n);return!!lr(i,o)&&(!!Be(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3]||Nn(t,e,r,n,function(t,e){return function(t,e,r){var n=!1,i=Ue(t,e),o=Ue(t,r);if(i===Me.INTERSECTING||o===Me.INTERSECTING)n=!0;else{var a,s,l=t[0],c=t[1],u=t[2],h=t[3],p=e[0],d=e[1],f=r[0],g=r[1],y=(g-d)/(f-p);o&Me.ABOVE&&!(i&Me.ABOVE)&&(n=(a=f-(g-h)/y)>=l&&a<=u),n||!(o&Me.RIGHT)||i&Me.RIGHT||(n=(s=g-(f-u)*y)>=c&&s<=h),n||!(o&Me.BELOW)||i&Me.BELOW||(n=(a=f-(g-c)/y)>=l&&a<=u),n||!(o&Me.LEFT)||i&Me.LEFT||(n=(s=g-(f-l)*y)>=c&&s<=h)}return n}(i,t,e)}))}function Dn(t,e,r,n,i){if(!function(t,e,r,n,i){return!!(kn(t,e,r,n,i)||In(t,e,r,n,i[0],i[1])||In(t,e,r,n,i[0],i[3])||In(t,e,r,n,i[2],i[1])||In(t,e,r,n,i[2],i[3]))}(t,e,r[0],n,i))return!1;if(1===r.length)return!0;for(var o=1,a=r.length;o<a;++o)if(Rn(t,r[o-1],r[o],n,i)&&!kn(t,r[o-1],r[o],n,i))return!1;return!0}function Fn(t,e,r,n){for(;e<r-n;){for(var i=0;i<n;++i){var o=t[e+i];t[e+i]=t[r-n+i],t[r-n+i]=o}e+=n,r-=n}}function Bn(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],l=t[e+1];i+=(s-o)*(l+a),o=s,a=l}return i>0}function Gn(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=Bn(t,e,l,n);if(0===a){if(o&&c||!o&&!c)return!1}else if(o&&!c||!o&&c)return!1;e=l}return!0}function Un(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=Bn(t,e,l,n);(0===a?o&&c||!o&&!c:o&&!c||!o&&c)&&Fn(t,e,l,n),e=l}return e}function jn(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)e=Un(t,e,r[o],n,i);return e}var qn=function(t){function e(e,r,n){t.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==r&&n?(this.setFlatCoordinates(r,e),this.ends_=n):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLinearRing=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))},e.prototype.containsXY=function(t,e){return Mn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return pn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?Un(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,Sn(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=tr(this.getExtent());this.flatInteriorPoint_=On(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new Pn(this.getFlatInteriorPoint(),pr.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new xn(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o],l=new xn(e.slice(i,s),t);n.push(l),i=s}return n},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Gn(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Un(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=An(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n),new e(r,pr.XY,n)},e.prototype.getType=function(){return hr.POLYGON},e.prototype.intersectsExtent=function(t){return Dn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Tn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(un),Wn=qn;function Hn(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=[e,r,e,i,n,i,n,r,e,r];return new qn(o,pr.XY,[o.length])}function Vn(t,e,r){for(var n=e||32,i=t.getStride(),o=t.getLayout(),a=t.getCenter(),s=i*(n+1),l=new Array(s),c=0;c<s;c+=i){l[c]=0,l[c+1]=0;for(var u=2;u<i;u++)l[c+u]=a[u]}var h=[l.length],p=new qn(l,o,h);return function(t,e,r,n){for(var i=t.getFlatCoordinates(),o=t.getStride(),a=i.length/o-1,s=n||0,l=0;l<=a;++l){var c=l*o,u=s+2*ue(l,a)*Math.PI/a;i[c]=e[0]+r*Math.cos(u),i[c+1]=e[1]+r*Math.sin(u)}t.changed()}(p,a,t.getRadius(),r),p}function Yn(t,e){setTimeout(function(){t(e)},0)}function zn(t){return!(t.sourceCenter&&t.targetCenter&&!_e(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}var Xn=function(t){function e(e){t.call(this);var r=u({},e);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=Hr(r.projection,"EPSG:3857"),this.applyOptions_(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.applyOptions_=function(t){var e={};e[ge]=void 0!==t.center?t.center:null;var r=function(t){var e,r,n,i=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28,a=void 0!==t.zoomFactor?t.zoomFactor:2;if(void 0!==t.resolutions){var s=t.resolutions;r=s[i],n=void 0!==s[o]?s[o]:s[s.length-1],e=function(t){return function(e,r,n){if(void 0!==e){var i=Dt(t,e,n);i=oe(i+r,0,t.length-1);var o=Math.floor(i);if(i!=o&&o<t.length-1){var a=t[o]/t[o+1];return t[o]/Math.pow(a,i-o)}return t[o]}}}(s)}else{var l=Hr(t.projection,"EPSG:3857"),c=l.getExtent(),u=(c?Math.max(sr(c),nr(c)):360*mr[Cr.DEGREES]/l.getMetersPerUnit())/ie/Math.pow(2,0),h=u/Math.pow(2,28);void 0!==(r=t.maxResolution)?i=0:r=u/Math.pow(a,i),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?r/Math.pow(a,o):u/Math.pow(a,o):h),o=i+Math.floor(Math.log(r/n)/Math.log(a)),n=r/Math.pow(a,o-i),e=function(t,e,r){return function(n,i,o){if(void 0!==n){var a=-o/2+.5,s=Math.floor(Math.log(e/n)/Math.log(t)+a),l=Math.max(s+i,0);return void 0!==r&&(l=Math.min(l,r)),e/Math.pow(t,l)}}}(a,r,o-i)}return{constraint:e,maxResolution:r,minResolution:n,minZoom:i,zoomFactor:a}}(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=r.minZoom;var n=function(t){return void 0!==t.extent?(e=t.extent,function(t){return t?[oe(t[0],e[0],e[2]),oe(t[1],e[1],e[3])]:void 0}):pe;var e}(t),i=r.constraint,o=function(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?(i=ce(5),function(t,e){return void 0!==t?Math.abs(t+e)<=i?0:t+e:void 0}):!1===e?fe:"number"==typeof e?(r=e,n=2*Math.PI/r,function(t,e){return void 0!==t?t=Math.floor((t+e)/n+.5)*n:void 0}):fe}return de;var r,n,i}(t);this.constraints_={center:n,resolution:i,rotation:o},void 0!==t.resolution?e[ye]=t.resolution:void 0!==t.zoom&&(e[ye]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_),this.resolutions_&&(e[ye]=oe(Number(this.getResolution()||e[ye]),this.minResolution_,this.maxResolution_))),e[me]=void 0!==t.rotation?t.rotation:0,this.setProperties(e),this.options_=t},e.prototype.getUpdatedOptions_=function(t){var e=u({},this.options_);return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenter(),e.rotation=this.getRotation(),u({},e,t)},e.prototype.animate=function(t){var e,r=arguments,n=arguments.length;if(n>1&&"function"==typeof arguments[n-1]&&(e=arguments[n-1],--n),!this.isDef()){var i=arguments[n-1];return i.center&&this.setCenter(i.center),void 0!==i.zoom&&this.setZoom(i.zoom),void 0!==i.rotation&&this.setRotation(i.rotation),void(e&&Yn(e,!0))}for(var o=Date.now(),a=this.getCenter().slice(),s=this.getResolution(),l=this.getRotation(),c=[],u=0;u<n;++u){var h=r[u],p={start:o,complete:!1,anchor:h.anchor,duration:void 0!==h.duration?h.duration:1e3,easing:h.easing||Pe};if(h.center&&(p.sourceCenter=a,p.targetCenter=h.center,a=p.targetCenter),void 0!==h.zoom?(p.sourceResolution=s,p.targetResolution=this.constrainResolution(this.maxResolution_,h.zoom-this.minZoom_,0),s=p.targetResolution):h.resolution&&(p.sourceResolution=s,p.targetResolution=h.resolution,s=p.targetResolution),void 0!==h.rotation){p.sourceRotation=l;var d=ue(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=l+d,l=p.targetRotation}p.callback=e,zn(p)?p.complete=!0:o+=p.duration,c.push(p)}this.animations_.push(c),this.setHint(0,1),this.updateAnimations_()},e.prototype.getAnimating=function(){return this.hints_[0]>0},e.prototype.getInteracting=function(){return this.hints_[1]>0},e.prototype.cancelAnimations=function(){this.setHint(0,-this.hints_[0]);for(var t=0,e=this.animations_.length;t<e;++t){var r=this.animations_[t];r[0].callback&&Yn(r[0].callback,!1)}this.animations_.length=0},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,r=this.animations_.length-1;r>=0;--r){for(var n=this.animations_[r],i=!0,o=0,a=n.length;o<a;++o){var s=n[o];if(!s.complete){var l=t-s.start,c=s.duration>0?l/s.duration:1;c>=1?(s.complete=!0,c=1):i=!1;var u=s.easing(c);if(s.sourceCenter){var h=s.sourceCenter[0],p=s.sourceCenter[1],d=h+u*(s.targetCenter[0]-h),f=p+u*(s.targetCenter[1]-p);this.set(ge,[d,f])}if(s.sourceResolution&&s.targetResolution){var g=1===u?s.targetResolution:s.sourceResolution+u*(s.targetResolution-s.sourceResolution);s.anchor&&this.set(ge,this.calculateCenterZoom(g,s.anchor)),this.set(ye,g)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){var y=1===u?ue(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+u*(s.targetRotation-s.sourceRotation);s.anchor&&this.set(ge,this.calculateCenterRotate(y,s.anchor)),this.set(me,y)}if(e=!0,!s.complete)break}}if(i){this.animations_[r]=null,this.setHint(0,-1);var m=n[0].callback;m&&Yn(m,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}},e.prototype.calculateCenterRotate=function(t,e){var r,n=this.getCenter();return void 0!==n&&(Se(r=[n[0]-e[0],n[1]-e[1]],t-this.getRotation()),ve(r,e)),r},e.prototype.calculateCenterZoom=function(t,e){var r,n=this.getCenter(),i=this.getResolution();void 0!==n&&void 0!==i&&(r=[e[0]-t*(e[0]-n[0])/i,e[1]-t*(e[1]-n[1])/i]);return r},e.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+o(this)+'"]',r=document.querySelector(e);if(r){var n=getComputedStyle(r);t[0]=parseInt(n.width,10),t[1]=parseInt(n.height,10)}return t},e.prototype.constrainCenter=function(t){return this.constraints_.center(t)},e.prototype.constrainResolution=function(t,e,r){var n=e||0,i=r||0;return this.constraints_.resolution(t,n,i)},e.prototype.constrainRotation=function(t,e){var r=e||0;return this.constraints_.rotation(t,r)},e.prototype.getCenter=function(){return this.get(ge)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),r=this.getCenter();te(r,1);var n=this.getResolution();te(void 0!==n,2);var i=this.getRotation();return te(void 0!==i,3),rr(r,n,i,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(ye)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){var r=e||this.getSizeFromViewport_(),n=sr(t)/r[0],i=nr(t)/r[1];return Math.max(n,i)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){return r/Math.pow(e,t*i)}},e.prototype.getRotation=function(){return this.get(me)},e.prototype.getValueForResolutionFunction=function(t){var e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){return Math.log(r/t)/Math.log(e)/i}},e.prototype.getState=function(t){var e=this.getCenter(),r=this.getProjection(),n=this.getResolution(),i=n/t,o=this.getRotation();return{center:[Math.round(e[0]/i)*i,Math.round(e[1]/i)*i],projection:void 0!==r?r:null,resolution:n,rotation:o,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,r,n=this.minZoom_||0;if(this.resolutions_){var i=Dt(this.resolutions_,t,1);n=i,e=this.resolutions_[i],r=i==this.resolutions_.length-1?2:e/this.resolutions_[i+1]}else e=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(e/t)/Math.log(r)},e.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)},e.prototype.fit=function(t,e){var r,n=e||{},i=n.size;i||(i=this.getSizeFromViewport_()),te(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)?(te(!cr(t),25),r=Hn(t)):t.getType()===hr.CIRCLE?(r=Hn(t=t.getExtent())).rotate(this.getRotation(),tr(t)):r=t;var o,a=void 0!==n.padding?n.padding:[0,0,0,0],s=void 0===n.constrainResolution||n.constrainResolution,l=void 0!==n.nearest&&n.nearest;o=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.constrainResolution(this.maxResolution_,n.maxZoom-this.minZoom_,0):0;for(var c=r.getFlatCoordinates(),u=this.getRotation(),h=Math.cos(-u),p=Math.sin(-u),d=1/0,f=1/0,g=-1/0,y=-1/0,m=r.getStride(),C=0,v=c.length;C<v;C+=m){var T=c[C]*h-c[C+1]*p,_=c[C]*p+c[C+1]*h;d=Math.min(d,T),f=Math.min(f,_),g=Math.max(g,T),y=Math.max(y,_)}var S=this.getResolutionForExtent([d,f,g,y],[i[0]-a[1]-a[3],i[1]-a[0]-a[2]]);if(S=isNaN(S)?o:Math.max(S,o),s){var E=this.constrainResolution(S,0,0);!l&&E<S&&(E=this.constrainResolution(E,-1,0)),S=E}p=-p;var L=(d+g)/2,w=(f+y)/2,A=[(L+=(a[1]-a[3])/2*S)*h-(w+=(a[0]-a[2])/2*S)*p,w*h+L*p],x=n.callback?n.callback:b;void 0!==n.duration?this.animate({resolution:S,center:A,duration:n.duration,easing:n.easing},x):(this.setResolution(S),this.setCenter(A),Yn(x,!0))},e.prototype.centerOn=function(t,e,r){var n=this.getRotation(),i=Math.cos(-n),o=Math.sin(-n),a=t[0]*i-t[1]*o,s=t[1]*i+t[0]*o,l=this.getResolution(),c=(a+=(e[0]/2-r[0])*l)*i-(s+=(r[1]-e[1]/2)*l)*(o=-o),u=s*i+a*o;this.setCenter([c,u])},e.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()},e.prototype.rotate=function(t,e){if(void 0!==e){var r=this.calculateCenterRotate(t,e);this.setCenter(r)}this.setRotation(t)},e.prototype.setCenter=function(t){this.set(ge,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.set(ye,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setRotation=function(t){this.set(me,t),this.getAnimating()&&this.cancelAnimations()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e}(D);function Kn(t,e){var r=document.createElement("canvas");return t&&(r.width=t),e&&(r.height=e),r.getContext("2d")}function $n(t){var e=t.offsetWidth,r=getComputedStyle(t);return e+(parseInt(r.marginLeft,10)+parseInt(r.marginRight,10))}function Jn(t){var e=t.offsetHeight,r=getComputedStyle(t);return e+(parseInt(r.marginTop,10)+parseInt(r.marginBottom,10))}function Zn(t,e){var r=e.parentNode;r&&r.replaceChild(t,e)}function Qn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function ti(t){for(;t.lastChild;)t.removeChild(t.lastChild)}var ei={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},ri=function(t){function e(e){t.call(this);var r=u({},e);r[ei.OPACITY]=void 0!==e.opacity?e.opacity:1,r[ei.VISIBLE]=void 0===e.visible||e.visible,r[ei.Z_INDEX]=e.zIndex,r[ei.MAX_RESOLUTION]=void 0!==e.maxResolution?e.maxResolution:1/0,r[ei.MIN_RESOLUTION]=void 0!==e.minResolution?e.minResolution:0,this.setProperties(r),this.state_=null,this.type}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return this.type},e.prototype.getLayerState=function(){var t=this.state_||{layer:this,managed:!0};return t.opacity=oe(this.getOpacity(),0,1),t.sourceState=this.getSourceState(),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=this.getZIndex()||0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),this.state_=t,t},e.prototype.getLayersArray=function(t){return n()},e.prototype.getLayerStatesArray=function(t){return n()},e.prototype.getExtent=function(){return this.get(ei.EXTENT)},e.prototype.getMaxResolution=function(){return this.get(ei.MAX_RESOLUTION)},e.prototype.getMinResolution=function(){return this.get(ei.MIN_RESOLUTION)},e.prototype.getOpacity=function(){return this.get(ei.OPACITY)},e.prototype.getSourceState=function(){return n()},e.prototype.getVisible=function(){return this.get(ei.VISIBLE)},e.prototype.getZIndex=function(){return this.get(ei.Z_INDEX)},e.prototype.setExtent=function(t){this.set(ei.EXTENT,t)},e.prototype.setMaxResolution=function(t){this.set(ei.MAX_RESOLUTION,t)},e.prototype.setMinResolution=function(t){this.set(ei.MIN_RESOLUTION,t)},e.prototype.setOpacity=function(t){this.set(ei.OPACITY,t)},e.prototype.setVisible=function(t){this.set(ei.VISIBLE,t)},e.prototype.setZIndex=function(t){this.set(ei.Z_INDEX,t)},e}(D),ni={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},ii={LAYERS:"layers"},oi=function(t){function e(e){var r=e||{},n=u({},r);delete n.layers;var i=r.layers;t.call(this,n),this.layersListenerKeys_=[],this.listenerKeys_={},C(this,k(ii.LAYERS),this.handleLayersChanged_,this),i?Array.isArray(i)?i=new G(i.slice(),{unique:!0}):te("function"==typeof i.getArray,43):i=new G(void 0,{unique:!0}),this.setLayers(i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(_),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(C(t,l.ADD,this.handleLayersAdd_,this),C(t,l.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(_);h(this.listenerKeys_);for(var r=t.getArray(),n=0,i=r.length;n<i;n++){var a=r[n];this.listenerKeys_[o(a)]=[C(a,c,this.handleLayerChange_,this),C(a,I.CHANGE,this.handleLayerChange_,this)]}this.changed()},e.prototype.handleLayersAdd_=function(t){var e=t.element;this.listenerKeys_[o(e)]=[C(e,c,this.handleLayerChange_,this),C(e,I.CHANGE,this.handleLayerChange_,this)],this.changed()},e.prototype.handleLayersRemove_=function(t){var e=o(t.element);this.listenerKeys_[e].forEach(_),delete this.listenerKeys_[e],this.changed()},e.prototype.getLayers=function(){return this.get(ii.LAYERS)},e.prototype.setLayers=function(t){this.set(ii.LAYERS,t)},e.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(e)}),e},e.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],r=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});for(var n=this.getLayerState(),i=r,o=e.length;i<o;i++){var a=e[i];a.opacity*=n.opacity,a.visible=a.visible&&n.visible,a.maxResolution=Math.min(a.maxResolution,n.maxResolution),a.minResolution=Math.max(a.minResolution,n.minResolution),void 0!==n.extent&&(void 0!==a.extent?a.extent=ir(a.extent,n.extent):a.extent=n.extent)}return e},e.prototype.getSourceState=function(){return ni.READY},e}(ri);function ai(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:e[0]=e[1]=t,e)}var si,li,ci=function(t){function e(e){t.call(this);var r=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var r,n,i,o={},a=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new oi({layers:t.layers});o[Jt.LAYERGROUP]=a,o[Jt.TARGET]=t.target,o[Jt.VIEW]=void 0!==t.view?t.view:new Xn,void 0!==t.controls&&(Array.isArray(t.controls)?r=new G(t.controls.slice()):(te("function"==typeof t.controls.getArray,47),r=t.controls));void 0!==t.interactions&&(Array.isArray(t.interactions)?n=new G(t.interactions.slice()):(te("function"==typeof t.interactions.getArray,48),n=t.interactions));void 0!==t.overlays?Array.isArray(t.overlays)?i=new G(t.overlays.slice()):(te("function"==typeof t.overlays.getArray,49),i=t.overlays):i=new G;return{controls:r,interactions:n,keyboardEventTarget:e,overlays:i,values:o}}(e);this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:z,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+(K?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var n=[I.CLICK,I.DBLCLICK,I.MOUSEDOWN,I.TOUCHSTART,I.MSPOINTERDOWN,Z.POINTERDOWN,I.MOUSEWHEEL,I.WHEEL],i=0,o=n.length;i<o;++i)C(this.overlayContainerStopEvent_,n[i],x);for(var a in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new Kt(this,e.moveTolerance),Z)C(this.mapBrowserEventHandler_,Z[a],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=r.keyboardEventTarget,this.keyHandlerKeys_=null,C(this.viewport_,I.CONTEXTMENU,this.handleBrowserEvent,this),C(this.viewport_,I.WHEEL,this.handleBrowserEvent,this),C(this.viewport_,I.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=r.controls||new G,this.interactions=r.interactions||new G,this.overlays_=r.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new re(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},C(this,k(Jt.LAYERGROUP),this.handleLayerGroupChanged_,this),C(this,k(Jt.VIEW),this.handleViewChanged_,this),C(this,k(Jt.SIZE),this.handleSizeChanged_,this),C(this,k(Jt.TARGET),this.handleTargetChanged_,this),this.setProperties(r.values),this.controls.forEach(function(t){t.setMap(this)}.bind(this)),C(this.controls,l.ADD,function(t){t.element.setMap(this)},this),C(this.controls,l.REMOVE,function(t){t.element.setMap(null)},this),this.interactions.forEach(function(t){t.setMap(this)}.bind(this)),C(this.interactions,l.ADD,function(t){t.element.setMap(this)},this),C(this.interactions,l.REMOVE,function(t){t.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),C(this.overlays_,l.ADD,function(t){this.addOverlayInternal_(t.element)},this),C(this.overlays_,l.REMOVE,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)},this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),T(this.viewport_,I.CONTEXTMENU,this.handleBrowserEvent,this),T(this.viewport_,I.WHEEL,this.handleBrowserEvent,this),T(this.viewport_,I.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(removeEventListener(I.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),t.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,e,r){if(this.frameState_){var n=this.getCoordinateFromPixel(t),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=void 0!==r.layerFilter?r.layerFilter:L;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,e,null,o,null)}},e.prototype.getFeaturesAtPixel=function(t,e){var r=null;return this.forEachFeatureAtPixel(t,function(t){r||(r=[]),r.push(t)},e),r},e.prototype.forEachLayerAtPixel=function(t,e,r){if(this.frameState_){var n=r||{},i=void 0!==n.hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=n.layerFilter||L;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,i,e,null,o,null)}},e.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixel(t),n=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:L,i=void 0!==e.hitTolerance?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,n,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),r="changedTouches"in t?t.changedTouches[0]:t;return[r.clientX-e.left,r.clientY-e.top]},e.prototype.getTarget=function(){return this.get(Jt.TARGET)},e.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){var e=this.frameState_;return e?rn(e.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(Jt.LAYERGROUP)},e.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},e.prototype.getPixelFromCoordinate=function(t){var e=this.frameState_;return e?rn(e.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(Jt.SIZE)},e.prototype.getView=function(){return this.get(Jt.VIEW)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getTilePriority=function(t,e,r,n){var i=this.frameState_;if(!(i&&e in i.wantedTiles))return 1/0;if(!i.wantedTiles[e][t.getKey()])return 1/0;var o=r[0]-i.focus[0],a=r[1]-i.focus[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n},e.prototype.handleBrowserEvent=function(t,e){var r=e||t.type,n=new j(r,this,t);this.handleMapBrowserEvent(n)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){this.focus_=t.coordinate,t.frameState=this.frameState_;var e=this.getInteractions().getArray();if(!1!==this.dispatchEvent(t))for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.getActive()&&!n.handleEvent(t))break}}},e.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var r=this.maxTilesLoading_,n=r;if(t){var i=t.viewHints;i[0]&&(r=this.loadTilesWhileAnimating_?8:0,n=2),i[1]&&(r=this.loadTilesWhileInteracting_?8:0,n=2)}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,n))}!t||!this.hasListener(Zt.RENDERCOMPLETE)||t.animate||this.tileQueue_.getTilesLoading()||function t(e){for(var r=0,n=e.length;r<n;++r){var i=e[r];if("function"==typeof i.getLayers)return t(i.getLayers().getArray());var o=i.getSource();if(o&&o.loading)return!0}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(Zt.RENDERCOMPLETE,t);for(var o=this.postRenderFunctions_,a=0,s=o.length;a<s;++a)o[a](this,t);o.length=0},e.prototype.handleSizeChanged_=function(){this.render()},e.prototype.handleTargetChanged_=function(){var t;if(this.getTarget()&&(t=this.getTargetElement()),this.keyHandlerKeys_){for(var e=0,r=this.keyHandlerKeys_.length;e<r;++e)_(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(t){t.appendChild(this.viewport_);var n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[C(n,I.KEYDOWN,this.handleBrowserEvent,this),C(n,I.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(I.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),Qn(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(I.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(_(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(_(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.viewport_.setAttribute("data-view",o(t)),this.viewPropertyListenerKey_=C(t,c,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=C(t,I.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(_),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[C(t,c,this.render,this),C(t,I.CHANGE,this.render,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var e,r=this.getSize(),n=this.getView(),i=[1/0,1/0,-1/0,-1/0],a=this.frameState_,s=null;if(void 0!==r&&function(t){return t[0]>0&&t[1]>0}(r)&&n&&n.isDef()){for(var l=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),c=this.getLayerGroup().getLayerStatesArray(),u={},h=0,p=c.length;h<p;++h)u[o(c[h].layer)]=c[h];e=n.getState(this.pixelRatio_),s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:i,focus:this.focus_?this.focus_:e.center,index:this.frameIndex_++,layerStates:u,layerStatesArray:c,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:e,viewHints:l,wantedTiles:{}}}if(s&&(s.extent=rr(e.center,e.resolution,e.rotation,s.size,i)),this.frameState_=s,this.renderer_.renderFrame(s),s){(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a)&&(!this.previousExtent_||!cr(this.previousExtent_)&&!Ve(s.extent,this.previousExtent_))&&(this.dispatchEvent(new U($t.MOVESTART,this,a)),this.previousExtent_=qe(this.previousExtent_));this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!Ve(s.extent,this.previousExtent_)&&(this.dispatchEvent(new U($t.MOVEEND,this,s)),ke(s.extent,this.previousExtent_))}this.dispatchEvent(new U($t.POSTRENDER,this,s)),setTimeout(this.handlePostRender.bind(this),0)},e.prototype.setLayerGroup=function(t){this.set(Jt.LAYERGROUP,t)},e.prototype.setSize=function(t){this.set(Jt.SIZE,t)},e.prototype.setTarget=function(t){this.set(Jt.TARGET,t)},e.prototype.setView=function(t){this.set(Jt.VIEW,t)},e.prototype.skipFeature=function(t){this.skippedFeatureUids_[o(t)]=!0,this.render()},e.prototype.updateSize=function(){var t=this.getTargetElement();if(t){var e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}else this.setSize(void 0)},e.prototype.unskipFeature=function(t){delete this.skippedFeatureUids_[o(t)],this.render()},e}(D),ui=function(t){function e(e){t.call(this),this.element=e.element?e.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=e.render?e.render:b,e.target&&this.setTarget(e.target)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){Qn(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&Qn(this.element);for(var e=0,r=this.listenerKeys.length;e<r;++e)_(this.listenerKeys[e]);(this.listenerKeys.length=0,this.map_=t,this.map_)&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==b&&this.listenerKeys.push(C(t,$t.POSTRENDER,this.render,this)),t.render())},e.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},e}(D),hi="ol-hidden",pi="ol-selectable",di="ol-unselectable",fi="ol-control",gi="ol-collapsed",yi=(li={},function(t){if(si||(si=document.createElement("div").style),!(t in li)){si.font=t;var e=si.fontFamily;if(si.font="",!e)return null;li[t]=e.split(/,\s?/)}return li[t]});function mi(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}var Ci=function(t){function e(e){var r=u({},e);delete r.source,t.call(this,r),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),C(this,k(ei.SOURCE),this.handleSourcePropertyChange_,this);var n=e.source?e.source:null;this.setSource(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(ei.SOURCE)||null},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():ni.UNDEFINED},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(_(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=C(t,I.CHANGE,this.handleSourceChange_,this)),this.changed()},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(_(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(_(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=C(t,Zt.PRECOMPOSE,function(t){var e=t,r=this.getLayerState();r.managed=!1,void 0===this.getZIndex()&&(r.zIndex=1/0),e.frameState.layerStatesArray.push(r),e.frameState.layerStates[o(this)]=r},this),this.mapRenderKey_=C(this,I.CHANGE,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(ei.SOURCE,t)},e}(ri);function vi(t){this.updateElement_(t.frameState)}var Ti=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||vi,target:r.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===r.collapsed||r.collapsed,this.overrideCollapsible_=void 0!==r.collapsible,this.collapsible_=void 0===r.collapsible||r.collapsible,this.collapsible_||(this.collapsed_=!1);var n=void 0!==r.className?r.className:"ol-attribution",i=void 0!==r.tipLabel?r.tipLabel:"Attributions",o=void 0!==r.collapseLabel?r.collapseLabel:"\xbb";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;var a=void 0!==r.label?r.label:"i";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a):this.label_=a;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(s),C(l,I.CLICK,this.handleClick_,this);var c=n+" "+di+" "+fi+(this.collapsed_&&this.collapsible_?" "+gi:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.ulElement_),u.appendChild(l),this.renderedAttributions_=[],this.renderedVisible_=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.collectSourceAttributions_=function(t){for(var e={},r=[],n=t.layerStatesArray,i=t.viewState.resolution,o=0,a=n.length;o<a;++o){var s=n[o];if(mi(s,i)){var l=s.layer.getSource();if(l){var c=l.getAttributions();if(c){var u=c(t);if(u)if(this.overrideCollapsible_||!1!==l.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(u))for(var h=0,p=u.length;h<p;++h)u[h]in e||(r.push(u[h]),e[u[h]]=!0);else u in e||(r.push(u),e[u]=!0)}}}}return r},e.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),r=e.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!Ut(e,this.renderedAttributions_)){ti(this.ulElement_);for(var n=0,i=e.length;n<i;++n){var o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(gi),this.collapsed_?Zn(this.collapseLabel_,this.label_):Zn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e}(ui);function _i(t){var e=t.frameState;if(e){var r=e.viewState.rotation;if(r!=this.rotation_){var n="rotate("+r+"rad)";if(this.autoHide_){var i=this.element.classList.contains(hi);i||0!==r?i&&0!==r&&this.element.classList.remove(hi):this.element.classList.add(hi)}this.label_.style.msTransform=n,this.label_.style.webkitTransform=n,this.label_.style.transform=n}this.rotation_=r}}var Si=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||_i,target:r.target});var n=void 0!==r.className?r.className:"ol-rotate",i=void 0!==r.label?r.label:"\u21e7";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=i):(this.label_=i,this.label_.classList.add("ol-compass"));var o=r.tipLabel?r.tipLabel:"Reset rotation",a=document.createElement("button");a.className=n+"-reset",a.setAttribute("type","button"),a.title=o,a.appendChild(this.label_),C(a,I.CLICK,this.handleClick_,this);var s=n+" "+di+" "+fi,l=this.element;l.className=s,l.appendChild(a),this.callResetNorth_=r.resetNorth?r.resetNorth:void 0,this.duration_=void 0!==r.duration?r.duration:250,this.autoHide_=void 0===r.autoHide||r.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(hi)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();t&&void 0!==t.getRotation()&&(this.duration_>0?t.animate({rotation:0,duration:this.duration_,easing:xe}):t.setRotation(0))},e}(ui),Ei=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),target:r.target});var n=void 0!==r.className?r.className:"ol-zoom",i=void 0!==r.delta?r.delta:1,o=void 0!==r.zoomInLabel?r.zoomInLabel:"+",a=void 0!==r.zoomOutLabel?r.zoomOutLabel:"\u2212",s=void 0!==r.zoomInTipLabel?r.zoomInTipLabel:"Zoom in",l=void 0!==r.zoomOutTipLabel?r.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n+"-in",c.setAttribute("type","button"),c.title=s,c.appendChild("string"==typeof o?document.createTextNode(o):o),C(c,I.CLICK,this.handleClick_.bind(this,i));var u=document.createElement("button");u.className=n+"-out",u.setAttribute("type","button"),u.title=l,u.appendChild("string"==typeof a?document.createTextNode(a):a),C(u,I.CLICK,this.handleClick_.bind(this,-i));var h=n+" "+di+" "+fi,p=this.element;p.className=h,p.appendChild(c),p.appendChild(u),this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var r=e.getResolution();if(r){var n=e.constrainResolution(r,t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:n,duration:this.duration_,easing:xe})):e.setResolution(n)}}},e}(ui),Li=function(t,e,r){this.decay_=t,this.minVelocity_=e,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0};Li.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},Li.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},Li.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var r=e-3;r>0&&this.points_[r+2]>t;)r-=3;var n=this.points_[e+2]-this.points_[r+2];if(n<1e3/60)return!1;var i=this.points_[e]-this.points_[r],o=this.points_[e+1]-this.points_[r+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/n,this.initialVelocity_>this.minVelocity_},Li.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},Li.prototype.getAngle=function(){return this.angle_};var wi=Li,bi={ACTIVE:"active"};function Ai(t,e,r,n){e=t.constrainRotation(e,0),xi(t,e,r,n)}function xi(t,e,r,n){if(void 0!==e){var i=t.getRotation(),o=t.getCenter();void 0!==i&&o&&n>0?t.animate({rotation:e,anchor:r,duration:n,easing:xe}):t.rotate(e,r)}}function Pi(t,e,r,n){var i=t.getResolution(),o=t.constrainResolution(i,e,0);if(void 0!==o){var a=t.getResolutions();o=oe(o,t.getMinResolution()||a[a.length-1],t.getMaxResolution()||a[0])}if(r&&void 0!==o&&o!==i){var s=t.getCenter(),l=t.calculateCenterZoom(o,r);l=t.constrainCenter(l),r=[(o*s[0]-i*l[0])/(o-i),(o*s[1]-i*l[1])/(o-i)]}Ri(t,o,r,n)}function Ri(t,e,r,n){if(e){var i=t.getResolution(),o=t.getCenter();if(void 0!==i&&o&&e!==i&&n)t.animate({resolution:e,anchor:r,duration:n,easing:xe});else{if(r){var a=t.calculateCenterZoom(e,r);t.setCenter(a)}t.setResolution(e)}}}var Ii=function(t){function e(e){t.call(this),e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getActive=function(){return this.get(bi.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(bi.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(D);function Mi(t){var e=!1;if(t.type==Z.DBLCLICK){var r=t.originalEvent,n=t.map,i=t.coordinate,o=r.shiftKey?-this.delta_:this.delta_;Pi(n.getView(),o,i,this.duration_),t.preventDefault(),e=!0}return!e}var Oi=function(t){function e(e){t.call(this,{handleEvent:Mi});var r=e||{};this.delta_=r.delta?r.delta:1,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ii),Ni=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ki=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Di=function(t){return t.target.getTargetElement()===document.activeElement},Fi=L,Bi=function(t){var e=t.originalEvent;return 0==e.button&&!(V&&Y&&e.ctrlKey)},Gi=w,Ui=function(t){return"pointermove"==t.type},ji=function(t){return t.type==Z.SINGLECLICK},qi=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Wi=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Hi=function(t){var e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},Vi=function(t){var e=t.pointerEvent;return te(void 0!==e,56),"mouse"==e.pointerType},Yi=function(t){var e=t.pointerEvent;return te(void 0!==e,56),e.isPrimary&&0===e.button};function zi(t){for(var e=t.length,r=0,n=0,i=0;i<e;i++)r+=t[i].clientX,n+=t[i].clientY;return[r/e,n/e]}var Xi=function(t){function e(e){var r=e||{};t.call(this,r),r.handleDownEvent&&(this.handleDownEvent=r.handleDownEvent),r.handleDragEvent&&(this.handleDragEvent=r.handleDragEvent),r.handleMoveEvent&&(this.handleMoveEvent=r.handleMoveEvent),r.handleUpEvent&&(this.handleUpEvent=r.handleUpEvent),r.stopDown&&(this.stopDown=r.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Z.POINTERDRAG)this.handleDragEvent(t);else if(t.type==Z.POINTERUP){var r=this.handleUpEvent(t);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(t.type==Z.POINTERDOWN){var n=this.handleDownEvent(t);n&&t.preventDefault(),this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==Z.POINTERMOVE&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(function(t){var e=t.type;return e===Z.POINTERDOWN||e===Z.POINTERDRAG||e===Z.POINTERUP}(t)){var e=t.pointerEvent,r=e.pointerId.toString();t.type==Z.POINTERUP?delete this.trackedPointers_[r]:t.type==Z.POINTERDOWN?this.trackedPointers_[r]=e:r in this.trackedPointers_&&(this.trackedPointers_[r]=e),this.targetPointers=p(this.trackedPointers_)}},e}(Ii),Ki=function(t){function e(e){t.call(this,{stopDown:w});var r=e||{};this.kinetic_=r.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=r.condition?r.condition:qi,this.noKinetic_=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().setHint(1,1));var e=this.targetPointers,r=zi(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var n=this.lastCentroid[0]-r[0],i=r[1]-this.lastCentroid[1],o=t.map.getView(),a=[n,i];Ee(a,o.getResolution()),Se(a,o.getRotation()),ve(a,o.getCenter()),a=o.constrainCenter(a),o.setCenter(a)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=e.length},e.prototype.handleUpEvent=function(t){var e=t.map,r=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),o=r.getCenter(),a=e.getPixelFromCoordinate(o),s=e.getCoordinateFromPixel([a[0]-n*Math.cos(i),a[1]-n*Math.sin(i)]);r.animate({center:r.constrainCenter(s),duration:500,easing:xe})}return this.panning_&&(this.panning_=!1,r.setHint(1,-1)),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.setCenter(t.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(Xi),$i=function(t){function e(e){var r=e||{};t.call(this,{stopDown:w}),this.condition_=r.condition?r.condition:ki,this.lastAngle_=void 0,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){if(Vi(t)){var e=t.map,r=e.getView();if(r.getConstraints().rotation!==de){var n=e.getSize(),i=t.pixel,o=Math.atan2(n[1]/2-i[1],i[0]-n[0]/2);if(void 0!==this.lastAngle_){var a=o-this.lastAngle_,s=r.getRotation();xi(r,s-a)}this.lastAngle_=o}}},e.prototype.handleUpEvent=function(t){if(!Vi(t))return!0;var e=t.map.getView();e.setHint(1,-1);var r=e.getRotation();return Ai(e,r,void 0,this.duration_),!1},e.prototype.handleDownEvent=function(t){return!(!Vi(t)||!Bi(t)||!this.condition_(t)||(t.map.getView().setHint(1,1),this.lastAngle_=void 0,0))},e}(Xi),Ji=function(t){function e(e){t.call(this),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,r=this.element_.style;r.left=Math.min(t[0],e[0])+"px",r.top=Math.min(t[1],e[1])+"px",r.width=Math.abs(e[0]-t[0])+"px",r.height=Math.abs(e[1]-t[1])+"px"},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=e.top=e.width=e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixel,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Wn([r])},e.prototype.getGeometry=function(){return this.geometry_},e}(E),Zi=function(t){function e(e,r,n){t.call(this,e),this.coordinate=r,this.mapBrowserEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function Qi(){var t,e=this.getMap(),r=e.getView(),n=e.getSize(),i=this.getGeometry().getExtent();if(this.out_){var o=r.calculateExtent(n),a=(t=[e.getPixelFromCoordinate(Ze(i)),e.getPixelFromCoordinate(ar(i))],function(t,e){for(var r=0,n=e.length;r<n;++r)ze(t,e[r]);return t}(qe(void 0),t));ur(o,1/r.getResolutionForExtent(a,n)),i=o}var s=r.constrainResolution(r.getResolutionForExtent(i,n)),l=tr(i);l=r.constrainCenter(l),r.animate({resolution:s,center:l,duration:this.duration_,easing:xe})}var to=function(t){function e(e){var r=e||{},n=r.condition?r.condition:Wi;t.call(this,{condition:n,className:r.className||"ol-dragzoom",onBoxEnd:Qi}),this.duration_=void 0!==r.duration?r.duration:200,this.out_=void 0!==r.out&&r.out}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e){t.call(this);var r=e||{};this.box_=new Ji(r.className||"ol-dragbox"),this.minArea_=void 0!==r.minArea?r.minArea:64,this.onBoxEnd_=r.onBoxEnd?r.onBoxEnd:b,this.startPixel_=null,this.condition_=r.condition?r.condition:Fi,this.boxEndCondition_=r.boxEndCondition?r.boxEndCondition:this.defaultBoxEndCondition}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.defaultBoxEndCondition=function(t,e,r){var n=r[0]-e[0],i=r[1]-e[1];return n*n+i*i>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){Vi(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Zi("boxdrag",t.coordinate,t)))},e.prototype.handleUpEvent=function(t){return!Vi(t)||(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new Zi("boxend",t.coordinate,t))),!1)},e.prototype.handleDownEvent=function(t){return!(!Vi(t)||!Bi(t)||!this.condition_(t)||(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Zi("boxstart",t.coordinate,t)),0))},e}(Xi)),eo={LEFT:37,UP:38,RIGHT:39,DOWN:40};function ro(t){var e=!1;if(t.type==I.KEYDOWN){var r=t.originalEvent.keyCode;if(this.condition_(t)&&(r==eo.DOWN||r==eo.LEFT||r==eo.RIGHT||r==eo.UP)){var n=t.map.getView(),i=n.getResolution()*this.pixelDelta_,o=0,a=0;r==eo.DOWN?a=-i:r==eo.LEFT?o=-i:r==eo.RIGHT?o=i:a=i;var s=[o,a];Se(s,n.getRotation()),function(t,e,r){var n=t.getCenter();if(n){var i=t.constrainCenter([n[0]+e[0],n[1]+e[1]]);r?t.animate({duration:r,easing:Re,center:i}):t.setCenter(i)}}(n,s,this.duration_),t.preventDefault(),e=!0}}return!e}var no=function(t){function e(e){t.call(this,{handleEvent:ro});var r=e||{};this.defaultCondition_=function(t){return qi(t)&&Hi(t)},this.condition_=void 0!==r.condition?r.condition:this.defaultCondition_,this.duration_=void 0!==r.duration?r.duration:100,this.pixelDelta_=void 0!==r.pixelDelta?r.pixelDelta:128}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ii);function io(t){var e=!1;if(t.type==I.KEYDOWN||t.type==I.KEYPRESS){var r=t.originalEvent.charCode;if(this.condition_(t)&&(r=="+".charCodeAt(0)||r=="-".charCodeAt(0))){var n=t.map,i=r=="+".charCodeAt(0)?this.delta_:-this.delta_;Pi(n.getView(),i,void 0,this.duration_),t.preventDefault(),e=!0}}return!e}var oo=function(t){function e(e){t.call(this,{handleEvent:io});var r=e||{};this.condition_=r.condition?r.condition:Hi,this.delta_=r.delta?r.delta:1,this.duration_=void 0!==r.duration?r.duration:100}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ii),ao="trackpad",so=function(t){function e(e){var r=e||{};t.call(this,r),this.delta_=0,this.duration_=void 0!==r.duration?r.duration:250,this.timeout_=void 0!==r.timeout?r.timeout:80,this.useAnchor_=void 0===r.useAnchor||r.useAnchor,this.constrainResolution_=r.constrainResolution||!1,this.condition_=r.condition?r.condition:Fi,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().setHint(1,-1)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==I.WHEEL&&e!==I.MOUSEWHEEL)return!0;t.preventDefault();var r,n=t.map,i=t.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==I.WHEEL?(r=i.deltaY,W&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=z),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)):t.type==I.MOUSEWHEEL&&(r=-i.wheelDeltaY,H&&(r/=3)),0===r)return!1;var o=Date.now();if(void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?ao:"wheel"),this.mode_===ao){var a=n.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):a.setHint(1,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var s=a.getResolution()*Math.pow(2,r/this.trackpadDeltaPerZoom_),l=a.getMinResolution(),c=a.getMaxResolution(),u=0;if(s<l?(s=Math.max(s,l/this.trackpadZoomBuffer_),u=1):s>c&&(s=Math.min(s,c*this.trackpadZoomBuffer_),u=-1),this.lastAnchor_){var h=a.calculateCenterZoom(s,this.lastAnchor_);a.setCenter(a.constrainCenter(h))}return a.setResolution(s),0===u&&this.constrainResolution_&&a.animate({resolution:a.constrainResolution(s,r>0?-1:1),easing:xe,anchor:this.lastAnchor_,duration:this.duration_}),u>0?a.animate({resolution:l,easing:xe,anchor:this.lastAnchor_,duration:500}):u<0&&a.animate({resolution:c,easing:xe,anchor:this.lastAnchor_,duration:500}),this.startTime_=o,!1}this.delta_+=r;var p=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),p),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();Pi(e,-oe(this.delta_,-1,1),this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(Ii),lo=function(t){function e(e){var r=e||{},n=r;n.stopDown||(n.stopDown=w),t.call(this,n),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==r.threshold?r.threshold:.3,this.duration_=void 0!==r.duration?r.duration:250}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var e=0,r=this.targetPointers[0],n=this.targetPointers[1],i=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){var o=i-this.lastAngle_;this.rotationDelta_+=o,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=o}this.lastAngle_=i;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==de){var l=a.getViewport().getBoundingClientRect(),c=zi(this.targetPointers);if(c[0]-=l.left,c[1]-=l.top,this.anchor_=a.getCoordinateFromPixel(c),this.rotating_){var u=s.getRotation();a.render(),xi(s,u+e,this.anchor_)}}},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();if(e.setHint(1,-1),this.rotating_){var r=e.getRotation();Ai(e,r,this.anchor_,this.duration_)}return!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().setHint(1,1),!0}return!1},e}(Xi),co=function(t){function e(e){var r=e||{},n=r;n.stopDown||(n.stopDown=w),t.call(this,n),this.constrainResolution_=r.constrainResolution||!1,this.anchor_=null,this.duration_=void 0!==r.duration?r.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDragEvent=function(t){var e=1,r=this.targetPointers[0],n=this.targetPointers[1],i=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var s=t.map,l=s.getView(),c=l.getResolution(),u=l.getMaxResolution(),h=l.getMinResolution(),p=c*e;p>u?(e=u/c,p=u):p<h&&(e=h/c,p=h),1!=e&&(this.lastScaleDelta_=e);var d=s.getViewport().getBoundingClientRect(),f=zi(this.targetPointers);f[0]-=d.left,f[1]-=d.top,this.anchor_=s.getCoordinateFromPixel(f),s.render(),Ri(l,p,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(1,-1);var r=e.getResolution();if(this.constrainResolution_||r<e.getMinResolution()||r>e.getMaxResolution()){var n=this.lastScaleDelta_-1;!function(t,e,r,n,i){e=t.constrainResolution(e,0,i),Ri(t,e,r,n)}(e,r,this.anchor_,this.duration_,n)}return!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().setHint(1,1),!0}return!1},e}(Xi);function uo(t){var e=t||{},r=new G,n=new wi(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&r.push(new $i),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&r.push(new Oi({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&r.push(new Ki({condition:e.onFocusOnly?Di:void 0,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&r.push(new lo),(void 0===e.pinchZoom||e.pinchZoom)&&r.push(new co({constrainResolution:e.constrainResolution,duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(r.push(new no),r.push(new oo({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&r.push(new so({condition:e.onFocusOnly?Di:void 0,constrainResolution:e.constrainResolution,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&r.push(new to({duration:e.zoomDuration})),r}var ho=.5,po=function(t){function e(e,r,n,i){t.call(this),this.extent=e,this.pixelRatio_=n,this.resolution=r,this.state=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(I.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return n()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){n()},e}(R),fo={IDLE:0,LOADING:1,LOADED:2,ERROR:3},go=function(t){function e(e,r,n,i,o){var a=void 0!==o?fo.IDLE:fo.LOADED;t.call(this,e,r,n,a),this.loader_=void 0!==o?o:null,this.canvas_=i,this.error_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=fo.ERROR):this.state=fo.LOADED,this.changed()},e.prototype.load=function(){this.state==fo.IDLE&&(this.state=fo.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(po),yo={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"},mo={IMAGE:"image",VECTOR:"vector"},Co=function(t){function e(e,r,n,i,o){t.call(this,e),this.vectorContext=r,this.frameState=n,this.context=i,this.glContext=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),vo=function(t){function e(e){t.call(this),this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(I.CLEAR)},e.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},e.prototype.forEach=function(t,e){for(var r=this.oldest_;r;)t.call(e,r.value_,r.key_,this),r=r.newer},e.prototype.get=function(t){var e=this.entries_[t];return te(void 0!==e,15),e===this.newest_?e.value_:(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e,e.value_)},e.prototype.remove=function(t){var e=this.entries_[t];return te(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},e.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},e.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},e.prototype.set=function(t,e){te(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_},e.prototype.setSize=function(t){this.highWaterMark=t},e.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},e}(R),To=[0,0,0,1],_o=[],So=[0,0,0,1],Eo=[0,0,0,0],Lo=new vo,wo={},bo=null,Ao={},xo=function(){var t,e,r=60,n=wo,i="32px ",o=["monospace","serif"],a=o.length,s="wmytzilWMYTZIL@#/&?$%10\uf013";function l(t){for(var r=Po(),n=100;n<=700;n+=300){for(var l=n+" ",c=!0,u=0;u<a;++u){var h=o[u];if(r.font=l+i+h,e=r.measureText(s).width,t!=h){r.font=l+i+t+","+h;var p=r.measureText(s).width;c=c&&p!=e}}if(c)return!0}return!1}function c(){var e=!0;for(var i in n)n[i]<r&&(l(i)?(n[i]=r,h(Ao),bo=null,Lo.clear()):(++n[i],e=!1));e&&(clearInterval(t),t=void 0)}return function(e){var i=yi(e);if(i)for(var o=0,a=i.length;o<a;++o){var s=i[o];s in n||(n[s]=r,l(s)||(n[s]=0,void 0===t&&(t=setInterval(c,32))))}}}();function Po(){return bo||(bo=Kn(1,1)),bo}var Ro,Io,Mo=(Io=Ao,function(t){var e=Io[t];return null==e&&(Ro||((Ro=document.createElement("span")).textContent="M",Ro.style.margin=Ro.style.padding="0 !important",Ro.style.position="absolute !important",Ro.style.left="-99999px !important"),Ro.style.font=t,document.body.appendChild(Ro),e=Io[t]=Ro.offsetHeight,document.body.removeChild(Ro)),e});function Oo(t,e){var r=Po();return t!=r.font&&(r.font=t),r.measureText(e).width}function No(t,e,r,n){0!==e&&(t.translate(r,n),t.rotate(e),t.translate(-r,-n))}var ko=[1,0,0,1,0,0];function Do(t,e,r,n,i,o,a,s,l,c,u){var h;1!=r&&(h=t.globalAlpha,t.globalAlpha=h*r),e&&t.setTransform.apply(t,e),t.drawImage(n,i,o,a,s,l,c,a*u,s*u),h&&(t.globalAlpha=h),e&&t.setTransform.apply(t,ko)}var Fo=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Bo=/^([a-z]*)$/i;function Go(t){return"string"==typeof t?t:Wo(t)}var Uo=function(){var t={},e=0;return function(r){var n;if(t.hasOwnProperty(r))n=t[r];else{if(e>=1024){var i=0;for(var o in t)0==(3&i++)&&(delete t[o],--e)}n=function(t){var e,r,n,i,o;Bo.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}(t));if(Fo.exec(t)){var a,s=t.length-1;a=s<=4?1:2;var l=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),r=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),i=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,l&&(i=(i<<4)+i)),o=[e,r,n,i/255]}else 0==t.indexOf("rgba(")?qo(o=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((o=t.slice(4,-1).split(",").map(Number)).push(1),qo(o)):te(!1,14);return o}(r),t[r]=n,++e}return n}}();function jo(t){return Array.isArray(t)?t:Uo(t)}function qo(t){return t[0]=oe(t[0]+.5|0,0,255),t[1]=oe(t[1]+.5|0,0,255),t[2]=oe(t[2]+.5|0,0,255),t[3]=oe(t[3],0,1),t}function Wo(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:t[3])+")"}function Ho(t){return Array.isArray(t)?Wo(t):t}var Vo=function(){};Vo.prototype.drawCustom=function(t,e,r){},Vo.prototype.drawGeometry=function(t){},Vo.prototype.setStyle=function(t){},Vo.prototype.drawCircle=function(t,e){},Vo.prototype.drawFeature=function(t,e){},Vo.prototype.drawGeometryCollection=function(t,e){},Vo.prototype.drawLineString=function(t,e){},Vo.prototype.drawMultiLineString=function(t,e){},Vo.prototype.drawMultiPoint=function(t,e){},Vo.prototype.drawMultiPolygon=function(t,e){},Vo.prototype.drawPoint=function(t,e){},Vo.prototype.drawPolygon=function(t,e){},Vo.prototype.drawText=function(t,e){},Vo.prototype.setFillStrokeStyle=function(t,e){},Vo.prototype.setImageStyle=function(t,e){},Vo.prototype.setTextStyle=function(t,e){};var Yo=Vo,zo=function(t){function e(e,r,n,i,o){t.call(this),this.context_=e,this.pixelRatio_=r,this.extent_=n,this.transform_=i,this.viewRotation_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawImages_=function(t,e,r,n){if(this.image_){var i=dr(t,e,r,2,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var c=0,u=i.length;c<u;c+=2){var h=i[c]-this.imageAnchorX_,p=i[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_){var d=h+this.imageAnchorX_,f=p+this.imageAnchorY_;an(a,d,f,this.imageScale_,this.imageScale_,l,-d,-f),o.setTransform.apply(o,a)}o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,h,p,this.imageWidth_,this.imageHeight_)}0===l&&1==this.imageScale_||o.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(o.globalAlpha=s)}},e.prototype.drawText_=function(t,e,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var i=dr(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){var s=i[e]+this.textOffsetX_,l=i[e+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_){var c=an(this.tmpLocalTransform_,s,l,this.textScale_,this.textScale_,a,-s,-l);o.setTransform.apply(o,c)}this.textStrokeState_&&o.strokeText(this.text_,s,l),this.textFillState_&&o.fillText(this.text_,s,l)}0===a&&1==this.textScale_||o.setTransform(1,0,0,1,0,0)}},e.prototype.moveToLineTo_=function(t,e,r,n,i){var o=this.context_,a=dr(t,e,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);var s=a.length;i&&(s-=2);for(var l=2;l<s;l+=2)o.lineTo(a[l],a[l+1]);return i&&o.closePath(),r},e.prototype.drawRings_=function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)e=this.moveToLineTo_(t,e,r[i],n,!0);return e},e.prototype.drawCircle=function(t){if(lr(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,r){var n=t.getFlatCoordinates();if(n){var i=t.getStride();return dr(n,0,n.length,i,e,r)}return null}(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.drawGeometry=function(t){switch(t.getType()){case hr.POINT:this.drawPoint(t);break;case hr.LINE_STRING:this.drawLineString(t);break;case hr.POLYGON:this.drawPolygon(t);break;case hr.MULTI_POINT:this.drawMultiPoint(t);break;case hr.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case hr.MULTI_POLYGON:this.drawMultiPolygon(t);break;case hr.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case hr.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var r=e.getGeometryFunction()(t);r&&lr(this.extent_,r.getExtent())&&(this.setStyle(e),this.drawGeometry(r))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])},e.prototype.drawPoint=function(t){var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawMultiPoint=function(t){var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)},e.prototype.drawLineString=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiLineString=function(t){var e=t.getExtent();if(lr(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getFlatCoordinates(),i=0,o=t.getEnds(),a=t.getStride();r.beginPath();for(var s=0,l=o.length;s<l;++s)i=this.moveToLineTo_(n,i,o[s],a,!1);r.stroke()}if(""!==this.text_){var c=t.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},e.prototype.drawPolygon=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(lr(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getOrientedFlatCoordinates(),n=0,i=t.getEndss(),o=t.getStride();e.beginPath();for(var a=0,s=i.length;a<s;++a){var l=i[a];n=this.drawRings_(r,n,l,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var c=t.getFlatInteriorPoints();this.drawText_(c,0,c.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=e.lineCap=t.lineCap),X&&(Ut(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset=t.lineDashOffset)),r.lineJoin!=t.lineJoin&&(r.lineJoin=e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,X&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:"center";r?(r.font!=t.font&&(r.font=e.font=t.font),r.textAlign!=n&&(r.textAlign=e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){if(t){var r=t.getColor();this.fillState_={fillStyle:Ho(r||To)}}else this.fillState_=null;if(e){var n=e.getColor(),i=e.getLineCap(),o=e.getLineDash(),a=e.getLineDashOffset(),s=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit();this.strokeState_={lineCap:void 0!==i?i:"round",lineDash:o||_o,lineDashOffset:a||0,lineJoin:void 0!==s?s:"round",lineWidth:this.pixelRatio_*(void 0!==l?l:1),miterLimit:void 0!==c?c:10,strokeStyle:Ho(n||So)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),r=t.getImage(1),n=t.getOrigin(),i=t.getSize();this.imageAnchorX_=e[0],this.imageAnchorY_=e[1],this.imageHeight_=i[1],this.image_=r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScale()*this.pixelRatio_,this.imageWidth_=i[0]}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var r=e.getColor();this.textFillState_={fillStyle:Ho(r||To)}}else this.textFillState_=null;var n=t.getStroke();if(n){var i=n.getColor(),o=n.getLineCap(),a=n.getLineDash(),s=n.getLineDashOffset(),l=n.getLineJoin(),c=n.getWidth(),u=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:"round",lineDash:a||_o,lineDashOffset:s||0,lineJoin:void 0!==l?l:"round",lineWidth:void 0!==c?c:1,miterLimit:void 0!==u?u:10,strokeStyle:Ho(i||So)}}else this.textStrokeState_=null;var h=t.getFont(),p=t.getOffsetX(),d=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation(),y=t.getScale(),m=t.getText(),C=t.getTextAlign(),v=t.getTextBaseline();this.textState_={font:void 0!==h?h:"10px sans-serif",textAlign:void 0!==C?C:"center",textBaseline:void 0!==v?v:"middle"},this.text_=void 0!==m?m:"",this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0,this.textOffsetY_=void 0!==d?this.pixelRatio_*d:0,this.textRotateWithView_=void 0!==f&&f,this.textRotation_=void 0!==g?g:0,this.textScale_=this.pixelRatio_*(void 0!==y?y:1)}else this.text_=""},e}(Yo),Xo=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};function Ko(t,e,r){return e+":"+t+":"+(r?Go(r):"null")}Xo.prototype.clear=function(){this.cache_={},this.cacheSize_=0},Xo.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t=0;for(var e in this.cache_){var r=this.cache_[e];0!=(3&t++)||r.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},Xo.prototype.get=function(t,e,r){var n=Ko(t,e,r);return n in this.cache_?this.cache_[n]:null},Xo.prototype.set=function(t,e,r,n){var i=Ko(t,e,r);this.cache_[i]=n,++this.cacheSize_},Xo.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()};var $o=new Xo;function Jo(t,e){$o.expire()}function Zo(t,e){return t.zIndex-e.zIndex}var Qo=[],ta=function(t){function e(e){t.call(this,e);var r=e.getViewport();this.context_=Kn(),this.canvas_=this.context_.canvas,this.canvas_.style.width="100%",this.canvas_.style.height="100%",this.canvas_.style.display="block",this.canvas_.className=di,r.insertBefore(this.canvas_,r.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,e){var r=this.getMap(),n=this.context_;if(r.hasListener(t)){var i=e.extent,o=e.pixelRatio,a=e.viewState.rotation,s=this.getTransform(e),l=new zo(n,o,i,s,a),c=new Co(t,l,e,n,null);r.dispatchEvent(c)}},e.prototype.getTransform=function(t){var e=t.viewState,r=this.canvas_.width/2,n=this.canvas_.height/2,i=t.pixelRatio/e.resolution,o=-i,a=-e.rotation,s=-e.center[0],l=-e.center[1];return an(this.transform_,r,n,i,o,a,s,l)},e.prototype.renderFrame=function(t){if(t){var e=this.context_,r=t.pixelRatio,n=Math.round(t.size[0]*r),i=Math.round(t.size[1]*r);this.canvas_.width!=n||this.canvas_.height!=i?(this.canvas_.width=n,this.canvas_.height=i):e.clearRect(0,0,n,i);var o=t.viewState.rotation;this.calculateMatrices2D(t),this.dispatchRenderEvent(Zt.PRECOMPOSE,t);var a=t.layerStatesArray;!function(t,e){var r,n=t.length,i=Array(t.length);for(r=0;r<n;r++)i[r]={index:r,value:t[r]};for(i.sort(function(t,r){return e(t.value,r.value)||t.index-r.index}),r=0;r<t.length;r++)t[r]=i[r].value}(a,Zo),o&&(e.save(),No(e,o,n/2,i/2));var s,l,c=t.viewState.resolution;for(s=0,l=a.length;s<l;++s){var u=a[s],h=u.layer,p=this.getLayerRenderer(h);mi(u,c)&&u.sourceState==ni.READY&&p.prepareFrame(t,u)&&p.composeFrame(t,u,e)}o&&e.restore(),this.dispatchRenderEvent(Zt.POSTCOMPOSE,t),this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(t,e,r,n,i,o,a){var s,l,c=e.viewState.resolution,u=e.layerStatesArray,h=u.length,p=rn(e.pixelToCoordinateTransform,t.slice());for(l=h-1;l>=0;--l){var d=u[l],f=d.layer;if(mi(d,c)&&o.call(a,f)&&(s=this.getLayerRenderer(f).forEachLayerAtCoordinate(p,e,r,n,i)))return s}},e.prototype.registerLayerRenderers=function(e){t.prototype.registerLayerRenderers.call(this,e);for(var r=0,n=e.length;r<n;++r){var i=e[r];kt(Qo,i)||Qo.push(i)}},e}(function(t){function e(e){t.call(this),this.map_=e,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispatchRenderEvent=function(t,e){n()},e.prototype.registerLayerRenderers=function(t){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,t)},e.prototype.calculateMatrices2D=function(t){var e=t.viewState,r=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;an(r,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),function(t){var e,r=(e=t)[0]*e[3]-e[1]*e[2];te(0!==r,32);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5];t[0]=a/r,t[1]=-i/r,t[2]=-o/r,t[3]=n/r,t[4]=(o*l-a*s)/r,t[5]=-(n*l-i*s)/r}(en(n,r))},e.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,a,s){var l,c=e.viewState,u=c.resolution;function h(t,r){var a=e.layerStates[o(r)].managed;if(!(o(t)in e.skippedFeatureUids)||a)return n.call(i,t,a?r:null)}var p=c.projection,d=t;if(p.canWrapX()){var f=p.getExtent(),g=sr(f),y=t[0];(y<f[0]||y>f[2])&&(d=[y+g*Math.ceil((f[0]-y)/g),t[1]])}var m,C=e.layerStatesArray;for(m=C.length-1;m>=0;--m){var v=C[m],T=v.layer;if(mi(v,u)&&a.call(s,T)){var _=this.getLayerRenderer(T),S=T.getSource();if(S&&(l=_.forEachFeatureAtCoordinate(S.getWrapX()?d:t,e,r,h)),l)return l}}},e.prototype.forEachLayerAtPixel=function(t,e,r,i,o,a,s){return n()},e.prototype.hasFeatureAtCoordinate=function(t,e,r,n,i){return void 0!==this.forEachFeatureAtCoordinate(t,e,r,L,this,n,i)},e.prototype.getLayerRenderer=function(t){var e=o(t);if(e in this.layerRenderers_)return this.layerRenderers_[e];for(var r,n=0,i=this.layerRendererConstructors_.length;n<i;++n){var a=this.layerRendererConstructors_[n];if(a.handles(t)){r=a.create(this,t);break}}if(!r)throw new Error("Unable to create renderer for layer: "+t.getType());return this.layerRenderers_[e]=r,this.layerRendererListeners_[e]=C(r,I.CHANGE,this.handleLayerRendererChange_,this),r},e.prototype.getLayerRendererByKey=function(t){return this.layerRenderers_[t]},e.prototype.getLayerRenderers=function(){return this.layerRenderers_},e.prototype.getMap=function(){return this.map_},e.prototype.handleLayerRendererChange_=function(){this.map_.render()},e.prototype.removeLayerRendererByKey_=function(t){var e=this.layerRenderers_[t];return delete this.layerRenderers_[t],_(this.layerRendererListeners_[t]),delete this.layerRendererListeners_[t],e},e.prototype.removeUnusedLayerRenderers_=function(t,e){for(var r in this.layerRenderers_)e&&r in e.layerStates||this.removeLayerRendererByKey_(r).dispose()},e.prototype.renderFrame=function(t){n()},e.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(Jo)},e.prototype.scheduleRemoveUnusedLayerRenderers=function(t){for(var e in this.layerRenderers_)if(!(e in t.layerStates))return void t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))},e}(E)),ea=function(t){function e(e){t.call(this,e),this.renderedResolution,this.transform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clip=function(t,e,r){var n=e.pixelRatio,i=e.size[0]*n,o=e.size[1]*n,a=e.viewState.rotation,s=or(r),l=ar(r),c=Qe(r),u=Ze(r);rn(e.coordinateToPixelTransform,s),rn(e.coordinateToPixelTransform,l),rn(e.coordinateToPixelTransform,c),rn(e.coordinateToPixelTransform,u),t.save(),No(t,-a,i/2,o/2),t.beginPath(),t.moveTo(s[0]*n,s[1]*n),t.lineTo(l[0]*n,l[1]*n),t.lineTo(c[0]*n,c[1]*n),t.lineTo(u[0]*n,u[1]*n),t.clip(),No(t,a,i/2,o/2)},e.prototype.dispatchComposeEvent_=function(t,e,r,n){var i=this.getLayer();if(i.hasListener(t)){var o=r.size[0]*r.pixelRatio,a=r.size[1]*r.pixelRatio,s=r.viewState.rotation;No(e,-s,o/2,a/2);var l=void 0!==n?n:this.getTransform(r,0),c=new zo(e,r.pixelRatio,r.extent,l,r.viewState.rotation),u=new Co(t,c,r,e,null);i.dispatchEvent(u),No(e,s,o/2,a/2)}},e.prototype.forEachLayerAtCoordinate=function(t,e,r,n,i){return this.forEachFeatureAtCoordinate(t,e,r,L)?n.call(i,this.getLayer(),null):void 0},e.prototype.postCompose=function(t,e,r,n){this.dispatchComposeEvent_(Zt.POSTCOMPOSE,t,e,n)},e.prototype.preCompose=function(t,e,r){this.dispatchComposeEvent_(Zt.PRECOMPOSE,t,e,r)},e.prototype.dispatchRenderEvent=function(t,e,r){this.dispatchComposeEvent_(Zt.RENDER,t,e,r)},e.prototype.getTransform=function(t,e){var r=t.viewState,n=t.pixelRatio,i=n*t.size[0]/2,o=n*t.size[1]/2,a=n/r.resolution,s=-a,l=-r.rotation,c=-r.center[0]+e,u=-r.center[1];return an(this.transform_,i,o,a,s,l,c,u)},e.prototype.composeFrame=function(t,e,r){n()},e.prototype.prepareFrame=function(t,e){return n()},e}(function(t){function e(e){t.call(this),this.layer_=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createLoadedTileFinder=function(t,e,r){return function(n,i){return t.forEachLoadedTile(e,n,i,function(t){r[n]||(r[n]={}),r[n][t.tileCoord.toString()]=t})}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n){},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleImageChange_=function(t){t.target.getState()===fo.LOADED&&this.renderIfReadyAndVisible()},e.prototype.hasFeatureAtCoordinate=function(t,e){return!1},e.prototype.loadImage=function(t){var e=t.getState();return e!=fo.LOADED&&e!=fo.ERROR&&C(t,I.CHANGE,this.handleImageChange_,this),e==fo.IDLE&&(t.load(),e=t.getState()),e==fo.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==ni.READY&&this.changed()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var r=function(t,e,r){var n=o(t);n in r.usedTiles&&t.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(r)}},e.prototype.updateUsedTiles=function(t,e,r,n){var i=o(e),a=r.toString();i in t?a in t[i]?t[i][a].extend(n):t[i][a]=n:(t[i]={},t[i][a]=n)},e.prototype.manageTilePyramid=function(t,e,r,n,i,a,s,l,c,u){var h=o(e);h in t.wantedTiles||(t.wantedTiles[h]={});var p,d,f,g,y,m,C=t.wantedTiles[h],v=t.tileQueue;for(m=r.getMinZoom();m<=s;++m)for(d=r.getTileRangeForExtentAndZ(a,m,d),f=r.getResolution(m),g=d.minX;g<=d.maxX;++g)for(y=d.minY;y<=d.maxY;++y)s-m<=l?((p=e.getTile(m,g,y,n,i)).getState()==Qt.IDLE&&(C[p.getKey()]=!0,v.isKeyQueued(p.getKey())||v.enqueue([p,h,r.getTileCoordCenter(p.tileCoord),f])),void 0!==c&&c.call(u,p)):e.useTile(m,g,y,i)},e}(M)),ra=function(t){function e(e){t.call(this,e),this.coordinateToCanvasPixelTransform=[1,0,0,1,0,0],this.hitCanvasContext_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.composeFrame=function(t,e,r){this.preCompose(r,t);var n=this.getImage();if(n){var i=e.extent,o=void 0!==i&&!Be(i,t.extent)&&lr(i,t.extent);o&&this.clip(r,t,i);var a=this.getImageTransform(),s=r.globalAlpha;r.globalAlpha=e.opacity;var l=a[4],c=a[5],u=n.width*a[0],h=n.height*a[3];u>=.5&&h>=.5&&r.drawImage(n,0,0,+n.width,+n.height,Math.round(l),Math.round(c),Math.round(u),Math.round(h)),r.globalAlpha=s,o&&r.restore()}this.postCompose(r,t,e)},e.prototype.getImage=function(){return n()},e.prototype.getImageTransform=function(){return n()},e.prototype.forEachLayerAtCoordinate=function(t,e,r,n,i){if(this.getImage()){var o=rn(this.coordinateToCanvasPixelTransform,t.slice());Ee(o,e.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=Kn(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),o[0],o[1],1,1,0,0,1,1);var a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return a[3]>0?n.call(i,this.getLayer(),a):void 0}},e}(ea),na=function(t){function e(r){if(t.call(this,r),this.image_=null,this.imageTransform_=[1,0,0,1,0,0],this.skippedFeatures_=[],this.vectorRenderer_=null,r.getType()===yo.VECTOR)for(var n=0,i=Qo.length;n<i;++n){var o=Qo[n];if(o!==e&&o.handles(r)){this.vectorRenderer_=new o(r);break}}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.prepareFrame=function(t,e){var r,n=t.pixelRatio,i=t.size,o=t.viewState,a=o.center,s=o.resolution,l=this.getLayer().getSource(),c=t.viewHints,h=this.vectorRenderer_,p=t.extent;if(h||void 0===e.extent||(p=ir(p,e.extent)),!c[0]&&!c[1]&&!cr(p)){var d=o.projection,f=this.skippedFeatures_;if(h){var g=h.context,y=u({},t,{size:[sr(p)/s,nr(p)/s],viewState:u({},t.viewState,{rotation:0})}),m=Object.keys(y.skippedFeatureUids).sort();r=new go(p,s,n,g.canvas,function(t){!h.prepareFrame(y,e)||!h.replayGroupChanged&&Ut(f,m)||(g.canvas.width=y.size[0]*n,g.canvas.height=y.size[1]*n,h.compose(g,y,e),f=m,t())})}else r=l.getImage(p,s,n,d);r&&this.loadImage(r)&&(this.image_=r,this.skippedFeatures_=f)}if(this.image_){var C=(r=this.image_).getExtent(),v=r.getResolution(),T=r.getPixelRatio(),_=n*v/(s*T),S=an(this.imageTransform_,n*i[0]/2,n*i[1]/2,_,_,0,T*(C[0]-a[0])/v,T*(a[1]-C[3])/v);an(this.coordinateToCanvasPixelTransform,n*i[0]/2-S[4],n*i[1]/2-S[5],n/s,-n/s,0,-a[0],-a[1]),this.renderedResolution=v*n/T}return!!this.image_},e.prototype.forEachFeatureAtCoordinate=function(e,r,n,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,r,n,i):t.prototype.forEachFeatureAtCoordinate.call(this,e,r,n,i)},e}(ra);na.handles=function(t){return t.getType()===yo.IMAGE||t.getType()===yo.VECTOR&&t.getRenderMode()===mo.IMAGE},na.create=function(t,e){return new na(e)};var ia=na,oa=function(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n};function aa(t,e,r,n,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=r,i.maxY=n,i):new oa(t,e,r,n)}oa.prototype.contains=function(t){return this.containsXY(t[1],t[2])},oa.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},oa.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},oa.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},oa.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},oa.prototype.getHeight=function(){return this.maxY-this.minY+1},oa.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},oa.prototype.getWidth=function(){return this.maxX-this.minX+1},oa.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY};var sa=oa,la=function(t){function e(e,r){t.call(this,e),this.context=r?null:Kn(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new sa(0,0,0,0),this.imageTransform_=[1,0,0,1,0,0],this.zDirection=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isDrawableTile_=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==Qt.LOADED||r==Qt.EMPTY||r==Qt.ERROR&&!n},e.prototype.getTile=function(t,e,r,n,i){var o=this.getLayer(),a=o.getSource().getTile(t,e,r,n,i);return a.getState()==Qt.ERROR&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):a.setState(Qt.LOADED)),this.isDrawableTile_(a)||(a=a.getInterimTile()),a},e.prototype.prepareFrame=function(t,e){var r=t.pixelRatio,n=t.size,i=t.viewState,a=i.projection,s=i.resolution,l=i.center,c=this.getLayer(),u=c.getSource(),h=u.getRevision(),p=u.getTileGridForProjection(a),d=p.getZForResolution(s,this.zDirection),f=p.getResolution(d),g=Math.round(s/f)||1,y=t.extent;if(void 0!==e.extent&&(y=ir(y,e.extent)),cr(y))return!1;var m=p.getTileRangeForExtentAndZ(y,d),C=p.getTileRangeExtent(d,m),v=u.getTilePixelRatio(r),T={};T[d]={};var _,S,E,L=this.createLoadedTileFinder(u,a,T),w=t.viewHints,b=w[0]||w[1],A=this.tmpExtent,x=this.tmpTileRange_;for(this.newTiles_=!1,S=m.minX;S<=m.maxX;++S)for(E=m.minY;E<=m.maxY;++E)if(!(Date.now()-t.time>16&&b)){if(_=this.getTile(d,S,E,r,a),this.isDrawableTile_(_)){var P=o(this);if(_.getState()==Qt.LOADED){T[d][_.tileCoord.toString()]=_;var R=_.inTransition(P);this.newTiles_||!R&&-1!==this.renderedTiles.indexOf(_)||(this.newTiles_=!0)}if(1===_.getAlpha(P,t.time))continue}var I=p.getTileCoordChildTileRange(_.tileCoord,x,A),M=!1;I&&(M=L(d+1,I)),M||p.forEachTileCoordParentTileRange(_.tileCoord,L,null,x,A)}var O=f*r/v*g;if(!(this.renderedResolution&&Date.now()-t.time>16&&b)&&(this.newTiles_||!this.renderedExtent_||!Be(this.renderedExtent_,y)||this.renderedRevision!=h||g!=this.oversampling_||!b&&O!=this.renderedResolution)){var N=this.context;if(N){var k=u.getTilePixelSize(d,r,a),D=Math.round(m.getWidth()*k[0]/g),F=Math.round(m.getHeight()*k[1]/g),B=N.canvas;B.width!=D||B.height!=F?(this.oversampling_=g,B.width=D,B.height=F):((this.renderedExtent_&&!Ve(C,this.renderedExtent_)||this.renderedRevision!=h)&&N.clearRect(0,0,D,F),g=this.oversampling_)}this.renderedTiles.length=0;var G,U,j,q,W,H,V,Y,z,X,K=Object.keys(T).map(Number);for(K.sort(function(t,e){return t===d?1:e===d?-1:t>e?1:t<e?-1:0}),q=0,W=K.length;q<W;++q)for(var $ in j=K[q],U=u.getTilePixelSize(j,r,a),G=p.getResolution(j)/f,V=v*u.getGutterForProjection(a),Y=T[j])_=Y[$],S=((H=p.getTileCoordExtent(_.getTileCoord(),A))[0]-C[0])/f*v/g,E=(C[3]-H[3])/f*v/g,z=U[0]*G/g,X=U[1]*G/g,this.drawTileImage(_,t,e,S,E,z,X,V,d===j),this.renderedTiles.push(_);this.renderedRevision=h,this.renderedResolution=f*r/v*g,this.renderedExtent_=C}var J=this.renderedResolution/s,Z=an(this.imageTransform_,r*n[0]/2,r*n[1]/2,J,J,0,(this.renderedExtent_[0]-l[0])/this.renderedResolution*r,(l[1]-this.renderedExtent_[3])/this.renderedResolution*r);return an(this.coordinateToCanvasPixelTransform,r*n[0]/2-Z[4],r*n[1]/2-Z[5],r/s,-r/s,0,-l[0],-l[1]),this.updateUsedTiles(t.usedTiles,u,d,m),this.manageTilePyramid(t,u,p,r,a,y,d,c.getPreload()),this.scheduleExpireCache(t,u),this.renderedTiles.length>0},e.prototype.drawTileImage=function(t,e,r,n,i,a,s,l,c){var u=this.getTileImage(t);if(u){var h=o(this),p=c?t.getAlpha(h,e.time):1,d=this.getLayer().getSource();1!==p||d.getOpaque(e.viewState.projection)||this.context.clearRect(n,i,a,s);var f=p!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(u,l,l,u.width-2*l,u.height-2*l,n,i,a,s),f&&this.context.restore(),1!==p?e.animate=!0:c&&t.endTransition(h)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getImageTransform=function(){return this.imageTransform_},e.prototype.getTileImage=function(t){return t.getImage()},e}(ra);la.handles=function(t){return t.getType()===yo.TILE},la.create=function(t,e){return new la(e)},la.prototype.getLayer;var ca=la,ua=r(0),ha=r.n(ua),pa=function(){};pa.prototype.getReplay=function(t,e){return n()},pa.prototype.isEmpty=function(){return n()},pa.prototype.addDeclutter=function(t){return n()};var da=pa,fa={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function ga(t,e,r,n){for(var i=t[e],o=t[e+1],a=0,s=e+n;s<r;s+=n){var l=t[s],c=t[s+1];a+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return a}function ya(t,e,r,n,i,o,a,s){for(var l,c,u,h=[],p=t[e]>t[r-n],d=i.length,f=t[e],g=t[e+1],y=t[e+=n],m=t[e+1],C=0,v=Math.sqrt(Math.pow(y-f,2)+Math.pow(m-g,2)),T="",_=0,S=0;S<d;++S){c=p?d-S-1:S;var E=i.charAt(c),L=o(T=p?E+T:T+E)-_;_+=L;for(var w=a+L/2;e<r-n&&C+v<w;)f=y,g=m,y=t[e+=n],m=t[e+1],C+=v,v=Math.sqrt(Math.pow(y-f,2)+Math.pow(m-g,2));var b=w-C,A=Math.atan2(m-g,y-f);if(p&&(A+=A>0?-Math.PI:Math.PI),void 0!==u){var x=A-u;if(x+=x>Math.PI?-2*Math.PI:x<-Math.PI?2*Math.PI:0,Math.abs(x)>s)return null}var P=b/v,R=he(f,y,P),I=he(g,m,P);u==A?(p&&(l[0]=R,l[1]=I,l[2]=L/2),l[4]=T):(_=L,l=[R,I,L/2,A,T=E],p?h.unshift(l):h.push(l),u=A),a+=L}return h}var ma={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ca=[ma.FILL],va=[ma.STROKE],Ta=[ma.BEGIN_PATH],_a=[ma.CLOSE_PATH],Sa=ma,Ea=[fa.POLYGON,fa.CIRCLE,fa.LINE_STRING,fa.IMAGE,fa.TEXT,fa.DEFAULT],La={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},wa=[1/0,1/0,-1/0,-1/0],ba=[1,0,0,1,0,0],Aa=function(t){function e(e,r,n,i,o,a){t.call(this),this.declutterTree=a,this.tolerance=e,this.maxExtent=r,this.overlaps=o,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.replayTextBackground_=function(t,e,r,n,i,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())},e.prototype.replayImage_=function(t,e,r,n,i,o,a,s,l,c,u,h,p,d,f,g,y,m){var C=y||m;e-=i*=p,r-=o*=p;var v,T,_,S,E=f+c>n.width?n.width-c:f,L=s+u>n.height?n.height-u:s,w=g[3]+E*p+g[1],b=g[0]+L*p+g[2],A=e-g[3],x=r-g[0];(C||0!==h)&&(v=[A,x],T=[A+w,x],_=[A+w,x+b],S=[A,x+b]);var P=null;if(0!==h){var R=e+i,I=r+o;P=an(ba,R,I,1,1,h,-R,-I),qe(wa),ze(wa,rn(ba,v)),ze(wa,rn(ba,T)),ze(wa,rn(ba,_)),ze(wa,rn(ba,S))}else je(A,x,A+w,x+b,wa);var M=t.canvas,O=m?m[2]*p/2:0,N=wa[0]-O<=M.width&&wa[2]+O>=0&&wa[1]-O<=M.height&&wa[3]+O>=0;if(d&&(e=Math.round(e),r=Math.round(r)),a){if(!N&&1==a[4])return;Ye(a,wa);var k=N?[t,P?P.slice(0):null,l,n,c,u,E,L,e,r,p]:null;k&&C&&k.push(y,m,v,T,_,S),a.push(k)}else N&&(C&&this.replayTextBackground_(t,v,T,_,S,y,m),Do(t,P,l,n,c,u,E,L,e,r,p))},e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.prototype.appendFlatCoordinates=function(t,e,r,n,i,o){var a=this.coordinates.length,s=this.getBufferedMaxExtent();o&&(e+=n);var l,c,u,h=[t[e],t[e+1]],p=[NaN,NaN],d=!0;for(l=e+n;l<r;l+=n)p[0]=t[l],p[1]=t[l+1],(u=Ue(s,p))!==c?(d&&(this.coordinates[a++]=h[0],this.coordinates[a++]=h[1]),this.coordinates[a++]=p[0],this.coordinates[a++]=p[1],d=!1):u===Me.INTERSECTING?(this.coordinates[a++]=p[0],this.coordinates[a++]=p[1],d=!1):d=!0,h[0]=p[0],h[1]=p[1],c=u;return(i&&d||l===e+n)&&(this.coordinates[a++]=h[0],this.coordinates[a++]=h[1]),a},e.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o],l=this.appendFlatCoordinates(t,e,s,n,!1,!1);i.push(l),e=s}return e},e.prototype.drawCustom=function(t,e,r){this.beginGeometry(t,e);var n,i,o,a,s,l=t.getType(),c=t.getStride(),u=this.coordinates.length;if(l==hr.MULTI_POLYGON){n=(t=t).getOrientedFlatCoordinates(),a=[];var h=t.getEndss();s=0;for(var p=0,d=h.length;p<d;++p){var f=[];s=this.drawCustomCoordinates_(n,s,h[p],c,f),a.push(f)}this.instructions.push([Sa.CUSTOM,u,a,t,r,En])}else l==hr.POLYGON||l==hr.MULTI_LINE_STRING?(o=[],n=l==hr.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),s=this.drawCustomCoordinates_(n,0,t.getEnds(),c,o),this.instructions.push([Sa.CUSTOM,u,o,t,r,Sn])):l==hr.LINE_STRING||l==hr.MULTI_POINT?(n=t.getFlatCoordinates(),i=this.appendFlatCoordinates(n,0,n.length,c,!1,!1),this.instructions.push([Sa.CUSTOM,u,i,t,r,_n])):l==hr.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),i=this.coordinates.length,this.instructions.push([Sa.CUSTOM,u,i,t,r]));this.endGeometry(t,e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[Sa.BEGIN_GEOMETRY,e,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Sa.BEGIN_GEOMETRY,e,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){},e.prototype.fill_=function(t){if(this.alignFill_){var e=rn(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.translate(e[0]%r,e[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.setTransform.apply(t,ko)},e.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],X&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},e.prototype.renderDeclutter_=function(t,e){if(t&&t.length>5){var r=t[4];if(1==r||r==t.length-5){var n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(!this.declutterTree.collides(n)){this.declutterTree.insert(n);for(var i=5,o=t.length;i<o;++i){var a=t[i];a&&(a.length>11&&this.replayTextBackground_(a[0],a[13],a[14],a[15],a[16],a[11],a[12]),Do.apply(void 0,a))}}t.length=5,qe(t)}}},e.prototype.replay_=function(t,e,r,n,i,a,s){var l;this.pixelCoordinates_&&Ut(e,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=dr(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),en(this.renderedTransform_,e));for(var c,u,h,p,f,g,y,m,C,v,T,_,S=!d(r),E=0,L=n.length,w=0,b=0,A=0,x=null,P=null,R=this.coordinateCache_,I=this.viewRotation_,M={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:I},O=this.instructions!=n||this.overlaps?0:200;E<L;){var N=n[E];switch(N[0]){case Sa.BEGIN_GEOMETRY:v=N[1],S&&r[o(v)]||!v.getGeometry()?E=N[2]:void 0===s||lr(s,v.getGeometry().getExtent())?++E:E=N[2]+1;break;case Sa.BEGIN_PATH:b>O&&(this.fill_(t),b=0),A>O&&(t.stroke(),A=0),b||A||(t.beginPath(),p=f=NaN),++E;break;case Sa.CIRCLE:var k=l[w=N[1]],D=l[w+1],F=l[w+2]-k,B=l[w+3]-D,G=Math.sqrt(F*F+B*B);t.moveTo(k+G,D),t.arc(k,D,G,0,2*Math.PI,!0),++E;break;case Sa.CLOSE_PATH:t.closePath(),++E;break;case Sa.CUSTOM:w=N[1],c=N[2];var U=N[3],j=N[4],q=6==N.length?N[5]:void 0;M.geometry=U,M.feature=v,E in R||(R[E]=[]);var W=R[E];q?q(l,w,c,2,W):(W[0]=l[w],W[1]=l[w+1],W.length=2),j(W,M),++E;break;case Sa.DRAW_IMAGE:w=N[1],c=N[2],C=N[3],u=N[4],h=N[5],m=a?null:N[6];var H=N[7],V=N[8],Y=N[9],z=N[10],X=N[11],K=N[12],$=N[13],J=N[14],Z=void 0,Q=void 0,tt=void 0;for(N.length>16?(Z=N[15],Q=N[16],tt=N[17]):(Z=Eo,Q=tt=!1),X&&(K+=I);w<c;w+=2)this.replayImage_(t,l[w],l[w+1],C,u,h,m,H,V,Y,z,K,$,i,J,Z,Q?x:null,tt?P:null);this.renderDeclutter_(m,v),++E;break;case Sa.DRAW_CHARS:var et=N[1],rt=N[2],nt=N[3];m=a?null:N[4];var it=N[5],ot=N[6],at=N[7],st=N[8],lt=N[9],ct=N[10],ut=N[11],ht=N[12],pt=N[13],dt=N[14],ft=ga(l,et,rt,2),gt=st(ht);if(it||gt<=ft){var yt=this.textStates[pt].textAlign,mt=ya(l,et,rt,2,ht,st,(ft-gt)*La[yt],at);if(mt){var Ct=void 0,vt=void 0,Tt=void 0,_t=void 0,St=void 0;if(ct)for(Ct=0,vt=mt.length;Ct<vt;++Ct)Tt=(St=mt[Ct])[4],_t=this.getImage(Tt,pt,"",ct),u=St[2]+ut,h=nt*_t.height+2*(.5-nt)*ut-lt,this.replayImage_(t,St[0],St[1],_t,u,h,m,_t.height,1,0,0,St[3],dt,!1,_t.width,Eo,null,null);if(ot)for(Ct=0,vt=mt.length;Ct<vt;++Ct)Tt=(St=mt[Ct])[4],_t=this.getImage(Tt,pt,ot,""),u=St[2],h=nt*_t.height-lt,this.replayImage_(t,St[0],St[1],_t,u,h,m,_t.height,1,0,0,St[3],dt,!1,_t.width,Eo,null,null)}}this.renderDeclutter_(m,v),++E;break;case Sa.END_GEOMETRY:if(void 0!==a){var Et=a(v=N[1]);if(Et)return Et}++E;break;case Sa.FILL:O?b++:this.fill_(t),++E;break;case Sa.MOVE_TO_LINE_TO:for(w=N[1],c=N[2],T=l[w],y=(_=l[w+1])+.5|0,(g=T+.5|0)===p&&y===f||(t.moveTo(T,_),p=g,f=y),w+=2;w<c;w+=2)g=(T=l[w])+.5|0,y=(_=l[w+1])+.5|0,w!=c-2&&g===p&&y===f||(t.lineTo(T,_),p=g,f=y);++E;break;case Sa.SET_FILL_STYLE:x=N,this.alignFill_=N[2],b&&(this.fill_(t),b=0,A&&(t.stroke(),A=0)),t.fillStyle=N[1],++E;break;case Sa.SET_STROKE_STYLE:P=N,A&&(t.stroke(),A=0),this.setStrokeStyle_(t,N),++E;break;case Sa.STROKE:O?A++:t.stroke(),++E;break;default:++E}}b&&this.fill_(t),A&&t.stroke()},e.prototype.replay=function(t,e,r,n,i){this.viewRotation_=r,this.replay_(t,e,n,this.instructions,i,void 0,void 0)},e.prototype.replayHitDetection=function(t,e,r,n,i,o){return this.viewRotation_=r,this.replay_(t,e,n,this.hitDetectionInstructions,!0,i,o)},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var r,n,i=e.length,o=-1;for(t=0;t<i;++t)(n=(r=e[t])[0])==Sa.END_GEOMETRY?o=t:n==Sa.BEGIN_GEOMETRY&&(r[2]=t,Ft(this.hitDetectionInstructions,o,t),o=-1)},e.prototype.setFillStrokeStyle=function(t,e){var r=this.state;if(t){var n=t.getColor();r.fillStyle=Ho(n||To)}else r.fillStyle=void 0;if(e){var i=e.getColor();r.strokeStyle=Ho(i||So);var o=e.getLineCap();r.lineCap=void 0!==o?o:"round";var a=e.getLineDash();r.lineDash=a?a.slice():_o;var s=e.getLineDashOffset();r.lineDashOffset=s||0;var l=e.getLineJoin();r.lineJoin=void 0!==l?l:"round";var c=e.getWidth();r.lineWidth=void 0!==c?c:1;var u=e.getMiterLimit();r.miterLimit=void 0!==u?u:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},e.prototype.createFill=function(t,e){var r=t.fillStyle,n=[Sa.SET_FILL_STYLE,r];return"string"!=typeof r&&n.push(!0),n},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[Sa.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e,r){var n=t.fillStyle;"string"==typeof n&&t.currentFillStyle==n||(void 0!==n&&this.instructions.push(e.call(this,t,r)),t.currentFillStyle=n)},e.prototype.updateStrokeStyle=function(t,e){var r=t.strokeStyle,n=t.lineCap,i=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,s=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||i!=t.currentLineDash&&!Ut(t.currentLineDash,i)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=s||t.currentMiterLimit!=l)&&(void 0!==r&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=i,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=s,t.currentMiterLimit=l)},e.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var r=[Sa.END_GEOMETRY,e];this.instructions.push(r),this.hitDetectionInstructions.push(r)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ke(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;Ne(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Yo),xa=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawCoordinates_=function(t,e,r,n){return this.appendFlatCoordinates(t,e,r,n,!1,!1)},e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([Sa.DRAW_IMAGE,i,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([Sa.DRAW_IMAGE,i,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(t,e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0},e.prototype.setImageStyle=function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getHitDetectionImage(1),o=t.getImage(1),a=t.getOrigin();this.anchorX_=r[0],this.anchorY_=r[1],this.declutterGroup_=e,this.hitDetectionImage_=i,this.image_=o,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=n[0]},e}(Aa),Pa=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinates_=function(t,e,r,n){var i=this.coordinates.length,o=this.appendFlatCoordinates(t,e,r,n,!1,!1),a=[Sa.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r},e.prototype.drawLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],Ta);var o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(va),this.endGeometry(t,e)}},e.prototype.drawMultiLineString=function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],Ta);for(var o=t.getEnds(),a=t.getFlatCoordinates(),s=t.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinates_(a,l,o[c],s);this.hitDetectionInstructions.push(va),this.endGeometry(t,e)}},e.prototype.finish=function(){var t=this.state;null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(va),this.reverseHitDetectionInstructions(),this.state=null},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(va),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(Ta)},e}(Aa),Ra=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawFlatCoordinatess_=function(t,e,r,n){var i=this.state,o=void 0!==i.fillStyle,a=null!=i.strokeStyle,s=r.length;this.instructions.push(Ta),this.hitDetectionInstructions.push(Ta);for(var l=0;l<s;++l){var c=r[l],u=this.coordinates.length,h=this.appendFlatCoordinates(t,e,c,n,!0,!a),p=[Sa.MOVE_TO_LINE_TO,u,h];this.instructions.push(p),this.hitDetectionInstructions.push(p),a&&(this.instructions.push(_a),this.hitDetectionInstructions.push(_a)),e=c}return o&&(this.instructions.push(Ca),this.hitDetectionInstructions.push(Ca)),a&&(this.instructions.push(va),this.hitDetectionInstructions.push(va)),e},e.prototype.drawCircle=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length;this.appendFlatCoordinates(o,0,o.length,a,!1,!1);var l=[Sa.CIRCLE,s];this.instructions.push(Ta,l),this.hitDetectionInstructions.push(Ta,l),this.hitDetectionInstructions.push(Ca),void 0!==r.fillStyle&&this.instructions.push(Ca),void 0!==r.strokeStyle&&(this.instructions.push(va),this.hitDetectionInstructions.push(va)),this.endGeometry(t,e)}},e.prototype.drawPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getEnds(),a=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(t,e)}},e.prototype.drawMultiPolygon=function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(t),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Sa.SET_FILL_STYLE,Go(To)]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Sa.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var o=t.getEndss(),a=t.getOrientedFlatCoordinates(),s=t.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinatess_(a,l,o[c],s);this.endGeometry(t,e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,r=0,n=e.length;r<n;++r)e[r]=wn(e[r],t)},e.prototype.setFillStrokeStyles_=function(t){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill,t),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},e}(Aa);function Ia(t,e,r,n,i){var o,a,s,l,c,u,h,p,d,f=r,g=r,y=0,m=0,C=r;for(o=r;o<n;o+=i){var v=e[o],T=e[o+1];void 0!==l&&(p=v-l,d=T-c,s=Math.sqrt(p*p+d*d),void 0!==u&&(m+=a,Math.acos((u*p+h*d)/(a*s))>t&&(m>y&&(y=m,f=C,g=o),m=0,C=o-i)),a=s,u=p,h=d),l=v,c=T}return(m+=s)>y?[C,o]:[f,g]}var Ma={Circle:Ra,Default:Aa,Image:xa,LineString:Pa,Polygon:Ra,Text:function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,i,o,a),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},Lo.prune()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.drawText=function(t,e){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var o,a,s=this.coordinates.length,l=t.getType(),c=null,u=2,h=2;if("line"===i.placement){if(!lr(this.getBufferedMaxExtent(),t.getExtent()))return;var p;if(c=t.getFlatCoordinates(),h=t.getStride(),l==hr.LINE_STRING)p=[c.length];else if(l==hr.MULTI_LINE_STRING)p=t.getEnds();else if(l==hr.POLYGON)p=t.getEnds().slice(0,1);else if(l==hr.MULTI_POLYGON){var d=t.getEndss();for(p=[],o=0,a=d.length;o<a;++o)p.push(d[o][0])}this.beginGeometry(t,e);for(var f,g=i.textAlign,y=0,m=0,C=p.length;m<C;++m){if(null==g){var v=Ia(i.maxAngle,c,y,p[m],h);y=v[0],f=v[1]}else f=p[m];for(o=y;o<f;o+=h)this.coordinates.push(c[o],c[o+1]);u=this.coordinates.length,y=p[m],this.drawChars_(s,u,this.declutterGroup_),s=u}this.endGeometry(t,e)}else{var T=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),_=T.width/this.pixelRatio;switch(l){case hr.POINT:case hr.MULTI_POINT:u=(c=t.getFlatCoordinates()).length;break;case hr.LINE_STRING:c=t.getFlatMidpoint();break;case hr.CIRCLE:c=t.getCenter();break;case hr.MULTI_LINE_STRING:u=(c=t.getFlatMidpoints()).length;break;case hr.POLYGON:if(c=t.getFlatInteriorPoint(),!i.overflow&&c[2]/this.resolution<_)return;h=3;break;case hr.MULTI_POLYGON:var S=t.getFlatInteriorPoints();for(c=[],o=0,a=S.length;o<a;o+=3)(i.overflow||S[o+2]/this.resolution>=_)&&c.push(S[o],S[o+1]);if(0==(u=c.length))return}u=this.appendFlatCoordinates(c,0,u,h,!1,!1),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,t),this.hitDetectionInstructions.push(this.createFill(this.state,t))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e),this.drawTextImage_(T,s,u),this.endGeometry(t,e)}}},e.prototype.getImage=function(t,e,r,n){var i,o=n+e+t+r+this.pixelRatio;if(!Lo.containsKey(o)){var a=n?this.strokeStates[n]||this.textStrokeState_:null,s=r?this.fillStates[r]||this.textFillState_:null,l=this.textStates[e]||this.textState_,c=this.pixelRatio,u=l.scale*c,h=La[l.textAlign||"center"],p=n&&a.lineWidth?a.lineWidth:0,d=t.split("\n"),f=d.length,g=[],y=function(t,e,r){for(var n=e.length,i=0,o=0;o<n;++o){var a=Oo(t,e[o]);i=Math.max(i,a),r.push(a)}return i}(l.font,d,g),m=Mo(l.font),C=m*f,v=y+p,T=Kn(Math.ceil(v*u),Math.ceil((C+p)*u));i=T.canvas,Lo.set(o,i),1!=u&&T.scale(u,u),T.font=l.font,n&&(T.strokeStyle=a.strokeStyle,T.lineWidth=p,T.lineCap=a.lineCap,T.lineJoin=a.lineJoin,T.miterLimit=a.miterLimit,X&&a.lineDash.length&&(T.setLineDash(a.lineDash),T.lineDashOffset=a.lineDashOffset)),r&&(T.fillStyle=s.fillStyle),T.textBaseline="middle",T.textAlign="center";var _,S=.5-h,E=h*i.width/u+S*p;if(n)for(_=0;_<f;++_)T.strokeText(d[_],E+S*g[_],.5*(p+m)+_*m);if(r)for(_=0;_<f;++_)T.fillText(d[_],E+S*g[_],.5*(p+m)+_*m)}return Lo.get(o)},e.prototype.drawTextImage_=function(t,e,r){var n=this.textState_,i=this.textStrokeState_,o=this.pixelRatio,a=La[n.textAlign||"center"],s=La[n.textBaseline],l=i&&i.lineWidth?i.lineWidth:0,c=a*t.width/o+2*(.5-a)*l,u=s*t.height/o+2*(.5-s)*l;this.instructions.push([Sa.DRAW_IMAGE,e,r,t,(c-this.textOffsetX_)*o,(u-this.textOffsetY_)*o,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,t.width,n.padding==Eo?Eo:n.padding.map(function(t){return t*o}),!!n.backgroundFill,!!n.backgroundStroke]),this.hitDetectionInstructions.push([Sa.DRAW_IMAGE,e,r,t,(c-this.textOffsetX_)*o,(u-this.textOffsetY_)*o,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/o,t.width,n.padding,!!n.backgroundFill,!!n.backgroundStroke])},e.prototype.drawChars_=function(t,e,r){var n=this.textStrokeState_,i=this.textState_,o=this.textFillState_,a=this.strokeKey_;n&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:n.strokeStyle,lineCap:n.lineCap,lineDashOffset:n.lineDashOffset,lineWidth:n.lineWidth,lineJoin:n.lineJoin,miterLimit:n.miterLimit,lineDash:n.lineDash}));var s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:i.font,textAlign:i.textAlign||"center",scale:i.scale});var l=this.fillKey_;o&&(l in this.fillStates||(this.fillStates[l]={fillStyle:o.fillStyle}));var c=this.pixelRatio,u=La[i.textBaseline],h=this.textOffsetY_*c,p=this.text_,d=i.font,f=i.scale,g=n?n.lineWidth*f/2:0,y=this.widths_[d];y||(this.widths_[d]=y={}),this.instructions.push([Sa.DRAW_CHARS,t,e,u,r,i.overflow,l,i.maxAngle,function(t){var e=y[t];return e||(e=y[t]=Oo(d,t)),e*f*c},h,a,g*c,p,s,1]),this.hitDetectionInstructions.push([Sa.DRAW_CHARS,t,e,u,r,i.overflow,l,i.maxAngle,function(t){var e=y[t];return e||(e=y[t]=Oo(d,t)),e*f},h,a,g,p,s,1/c])},e.prototype.setTextStyle=function(t,e){var r,n,i;if(t){this.declutterGroup_=e;var a=t.getFill();a?((n=this.textFillState_)||(n=this.textFillState_={}),n.fillStyle=Ho(a.getColor()||To)):n=this.textFillState_=null;var s=t.getStroke();if(s){(i=this.textStrokeState_)||(i=this.textStrokeState_={});var l=s.getLineDash(),c=s.getLineDashOffset(),u=s.getWidth(),h=s.getMiterLimit();i.lineCap=s.getLineCap()||"round",i.lineDash=l?l.slice():_o,i.lineDashOffset=void 0===c?0:c,i.lineJoin=s.getLineJoin()||"round",i.lineWidth=void 0===u?1:u,i.miterLimit=void 0===h?10:h,i.strokeStyle=Ho(s.getColor()||So)}else i=this.textStrokeState_=null;r=this.textState_;var p=t.getFont()||"10px sans-serif";xo(p);var d=t.getScale();r.overflow=t.getOverflow(),r.font=p,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.textBaseline=t.getTextBaseline()||"middle",r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||Eo,r.scale=void 0===d?1:d;var f=t.getOffsetX(),g=t.getOffsetY(),y=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===g?0:g,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0===m?0:m,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:o(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+o(n.fillStyle):""}else this.text_=""},e}(Aa)},Oa=function(t){function e(e,r,n,i,o,a,s){t.call(this),this.declutterTree_=a,this.declutterGroup_=null,this.tolerance_=e,this.maxExtent_=r,this.overlaps_=o,this.pixelRatio_=i,this.resolution_=n,this.renderBuffer_=s,this.replaysByZIndex_={},this.hitDetectionContext_=Kn(1,1),this.hitDetectionTransform_=[1,0,0,1,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addDeclutter=function(t){var e=null;return this.declutterTree_&&(t?(e=this.declutterGroup_)[4]++:(e=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1)),e},e.prototype.clip=function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},e.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var r=this.replaysByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},e.prototype.finish=function(){for(var t in this.replaysByZIndex_){var e=this.replaysByZIndex_[t];for(var r in e)e[r].finish()}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i,o,a){var s,l=2*(n=Math.round(n))+1,c=an(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),u=this.hitDetectionContext_;u.canvas.width!==l||u.canvas.height!==l?(u.canvas.width=l,u.canvas.height=l):u.clearRect(0,0,l,l),void 0!==this.renderBuffer_&&(ze(s=[1/0,1/0,-1/0,-1/0],t),Ne(s,e*(this.renderBuffer_+n),s));var h,p,d=function(t){if(void 0!==Na[t])return Na[t];for(var e=2*t+1,r=new Array(e),n=0;n<e;n++)r[n]=new Array(e);for(var i=t,o=0,a=0;i>=o;)ka(r,t+i,t+o),ka(r,t+o,t+i),ka(r,t-o,t+i),ka(r,t-i,t+o),ka(r,t-i,t-o),ka(r,t-o,t-i),ka(r,t+o,t-i),ka(r,t+i,t-o),2*((a+=1+2*++o)-i)+1>0&&(a+=1-2*(i-=1));return Na[t]=r,r}(n);function f(t){for(var e=u.getImageData(0,0,l,l).data,r=0;r<l;r++)for(var n=0;n<l;n++)if(d[r][n]&&e[4*(n*l+r)+3]>0){var i=void 0;return(!h||p!=fa.IMAGE&&p!=fa.TEXT||-1!==h.indexOf(t))&&(i=o(t)),i||void u.clearRect(0,0,l,l)}}this.declutterTree_&&(h=this.declutterTree_.all().map(function(t){return t.value}));var g,y,m,C,v,T=Object.keys(this.replaysByZIndex_).map(Number);for(T.sort(Nt),g=T.length-1;g>=0;--g){var _=T[g].toString();for(m=this.replaysByZIndex_[_],y=Ea.length-1;y>=0;--y)if(void 0!==(C=m[p=Ea[y]]))if(!a||p!=fa.IMAGE&&p!=fa.TEXT){if(v=C.replayHitDetection(u,c,r,i,f,s))return v}else{var S=a[_];S?S.push(C,c.slice(0)):a[_]=[C,c.slice(0)]}}},e.prototype.getClipCoords=function(t){var e=this.maxExtent_,r=e[0],n=e[1],i=e[2],o=e[3],a=[r,n,r,o,i,o,i,n];return dr(a,0,8,2,t,a),a},e.prototype.getReplay=function(t,e){var r=void 0!==t?t.toString():"0",n=this.replaysByZIndex_[r];void 0===n&&(n={},this.replaysByZIndex_[r]=n);var i=n[e];void 0===i&&(i=new(0,Ma[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),n[e]=i);return i},e.prototype.getReplays=function(){return this.replaysByZIndex_},e.prototype.isEmpty=function(){return d(this.replaysByZIndex_)},e.prototype.replay=function(t,e,r,n,i,o,a){var s=Object.keys(this.replaysByZIndex_).map(Number);s.sort(Nt),t.save(),this.clip(t,e);var l,c,u,h,p,d,f=o||Ea;for(l=0,c=s.length;l<c;++l){var g=s[l].toString();for(p=this.replaysByZIndex_[g],u=0,h=f.length;u<h;++u){var y=f[u];if(void 0!==(d=p[y]))if(!a||y!=fa.IMAGE&&y!=fa.TEXT)d.replay(t,e,r,n,i);else{var m=a[g];m?m.push(d,e.slice(0)):a[g]=[d,e.slice(0)]}}}t.restore()},e}(da),Na={0:[[!0]]};function ka(t,e,r){var n,i=Math.floor(t.length/2);if(e>=i)for(n=i;n<e;n++)t[n][r]=!0;else if(e<i)for(n=e+1;n<i;n++)t[n][r]=!0}var Da=Oa,Fa=.5,Ba={Point:function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=fo.LOADED)return;var o=t.getReplay(r.getZIndex(),fa.IMAGE);o.setImageStyle(i,t.addDeclutter(!1)),o.drawPoint(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!!i)),s.drawText(e,n)}},LineString:function(t,e,r,n){var i=r.getStroke();if(i){var o=t.getReplay(r.getZIndex(),fa.LINE_STRING);o.setFillStrokeStyle(null,i),o.drawLineString(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!1)),s.drawText(e,n)}},Polygon:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(i||o){var a=t.getReplay(r.getZIndex(),fa.POLYGON);a.setFillStrokeStyle(i,o),a.drawPolygon(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}},MultiPoint:function(t,e,r,n){var i=r.getImage();if(i){if(i.getImageState()!=fo.LOADED)return;var o=t.getReplay(r.getZIndex(),fa.IMAGE);o.setImageStyle(i,t.addDeclutter(!1)),o.drawMultiPoint(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!!i)),s.drawText(e,n)}},MultiLineString:function(t,e,r,n){var i=r.getStroke();if(i){var o=t.getReplay(r.getZIndex(),fa.LINE_STRING);o.setFillStrokeStyle(null,i),o.drawMultiLineString(e,n)}var a=r.getText();if(a){var s=t.getReplay(r.getZIndex(),fa.TEXT);s.setTextStyle(a,t.addDeclutter(!1)),s.drawText(e,n)}},MultiPolygon:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(o||i){var a=t.getReplay(r.getZIndex(),fa.POLYGON);a.setFillStrokeStyle(i,o),a.drawMultiPolygon(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}},GeometryCollection:function(t,e,r,n){var i,o,a=e.getGeometriesArray();for(i=0,o=a.length;i<o;++i){(0,Ba[a[i].getType()])(t,a[i],r,n)}},Circle:function(t,e,r,n){var i=r.getFill(),o=r.getStroke();if(i||o){var a=t.getReplay(r.getZIndex(),fa.CIRCLE);a.setFillStrokeStyle(i,o),a.drawCircle(e,n)}var s=r.getText();if(s){var l=t.getReplay(r.getZIndex(),fa.TEXT);l.setTextStyle(s,t.addDeclutter(!1)),l.drawText(e,n)}}};function Ga(t,e){return parseInt(o(t),10)-parseInt(o(e),10)}function Ua(t,e){var r=ja(t,e);return r*r}function ja(t,e){return Fa*t/e}function qa(t,e,r,n,i,o){var a=!1,s=r.getImage();if(s){var l=s.getImageState();l==fo.LOADED||l==fo.ERROR?s.unlistenImageChange(i,o):(l==fo.IDLE&&s.load(),l=s.getImageState(),s.listenImageChange(i,o),a=!0)}return function(t,e,r,n){var i=r.getGeometryFunction()(e);if(i){var o=i.getSimplifiedGeometry(n);if(r.getRenderer())!function t(e,r,n,i){if(r.getType()!=hr.GEOMETRY_COLLECTION){e.getReplay(n.getZIndex(),fa.DEFAULT).drawCustom(r,i,n.getRenderer())}else for(var o=r.getGeometries(),a=0,s=o.length;a<s;++a)t(e,o[a],n,i)}(t,o,r,e);else{(0,Ba[o.getType()])(t,o,r,e)}}}(t,e,r,n),a}var Wa=function(t){function e(e){t.call(this,e),this.declutterTree_=e.getDeclutter()?ha()(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=Kn(),C(Lo,I.CLEAR,this.handleFontsChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){T(Lo,I.CLEAR,this.handleFontsChanged_,this),t.prototype.disposeInternal.call(this)},e.prototype.compose=function(t,e,r){var n=e.extent,i=e.pixelRatio,o=r.managed?e.skippedFeatureUids:{},a=e.viewState,s=a.projection,l=a.rotation,c=s.getExtent(),u=this.getLayer().getSource(),h=this.getTransform(e,0),p=r.extent,d=void 0!==p;d&&this.clip(t,e,p);var f=this.replayGroup_;if(f&&!f.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var g,y=this.getLayer(),m=0,C=0,v=1!==r.opacity,T=y.hasListener(Zt.RENDER);if(v||T){var _=t.canvas.width,S=t.canvas.height;if(l){var E=Math.round(Math.sqrt(_*_+S*S));m=(E-_)/2,C=(E-S)/2,_=S=E}this.context.canvas.width=_,this.context.canvas.height=S,g=this.context}else g=t;var L=g.globalAlpha;v||(g.globalAlpha=r.opacity),g!=t&&g.translate(m,C);var w=e.viewHints,b=!(w[0]||w[1]),A=e.size[0]*i,x=e.size[1]*i;if(No(g,-l,A/2,x/2),f.replay(g,h,l,o,b),u.getWrapX()&&s.canWrapX()&&!Be(c,n)){for(var P,R=n[0],I=sr(c),M=0;R<c[0];)P=I*--M,h=this.getTransform(e,P),f.replay(g,h,l,o,b),R+=I;for(M=0,R=n[2];R>c[2];)P=I*++M,h=this.getTransform(e,P),f.replay(g,h,l,o,b),R-=I}if(No(g,l,A/2,x/2),T&&this.dispatchRenderEvent(g,e,h),g!=t){if(v){var O=t.globalAlpha;t.globalAlpha=r.opacity,t.drawImage(g.canvas,-m,-C),t.globalAlpha=O}else t.drawImage(g.canvas,-m,-C);g.translate(-m,-C)}v||(g.globalAlpha=L)}d&&t.restore()},e.prototype.composeFrame=function(t,e,r){var n=this.getTransform(t,0);this.preCompose(r,t,n),this.compose(r,t,e),this.postCompose(r,t,e,n)},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){if(this.replayGroup_){var a=e.viewState.resolution,s=e.viewState.rotation,l=this.getLayer(),c={};return this.replayGroup_.forEachFeatureAtCoordinate(t,a,s,r,{},function(t){var e=o(t);if(!(e in c))return c[e]=!0,n.call(i,t,l)},null)}},e.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t,e){var r=this.getLayer(),n=r.getSource(),i=t.viewHints[0],o=t.viewHints[1],a=r.getUpdateWhileAnimating(),s=r.getUpdateWhileInteracting();if(!this.dirty_&&!a&&i||!s&&o)return!0;var l=t.extent,c=t.viewState,u=c.projection,h=c.resolution,p=t.pixelRatio,d=r.getRevision(),f=r.getRenderBuffer(),g=r.getRenderOrder();void 0===g&&(g=Ga);var y=Ne(l,f*h),m=c.projection.getExtent();if(n.getWrapX()&&c.projection.canWrapX()&&!Be(m,t.extent)){var C=sr(m),v=Math.max(sr(y)/2,C);y[0]=m[0]-v,y[2]=m[2]+v}if(!this.dirty_&&this.renderedResolution_==h&&this.renderedRevision_==d&&this.renderedRenderOrder_==g&&Be(this.renderedExtent_,y))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var T=new Da(ja(h,p),y,h,p,n.getOverlaps(),this.declutterTree_,r.getRenderBuffer());n.loadFeatures(y,h,u);var _=function(t){var e,n=t.getStyleFunction()||r.getStyleFunction();if(n&&(e=n(t,h)),e){var i=this.renderFeature(t,h,p,e,T);this.dirty_=this.dirty_||i}}.bind(this);if(g){var S=[];n.forEachFeatureInExtent(y,function(t){S.push(t)}),S.sort(g);for(var E=0,L=S.length;E<L;++E)_(S[E])}else n.forEachFeatureInExtent(y,_);return T.finish(),this.renderedResolution_=h,this.renderedRevision_=d,this.renderedRenderOrder_=g,this.renderedExtent_=y,this.replayGroup_=T,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,e,r,n,i){if(!n)return!1;var o=!1;if(Array.isArray(n))for(var a=0,s=n.length;a<s;++a)o=qa(i,t,n[a],Ua(e,r),this.handleStyleImageChange_,this)||o;else o=qa(i,t,n,Ua(e,r),this.handleStyleImageChange_,this);return o},e}(ea);Wa.handles=function(t){return t.getType()===yo.VECTOR},Wa.create=function(t,e){return new Wa(e)};var Ha=Wa,Va={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},Ya={image:[fa.POLYGON,fa.CIRCLE,fa.LINE_STRING,fa.IMAGE,fa.TEXT],hybrid:[fa.POLYGON,fa.LINE_STRING]},za={image:[fa.DEFAULT],hybrid:[fa.IMAGE,fa.TEXT,fa.DEFAULT],vector:Ea},Xa=function(t){function e(e){t.call(this,e,!0),this.declutterTree_=e.getDeclutter()?ha()(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=[1,0,0,1,0,0];var r=e.getRenderMode();this.zDirection=r===Va.VECTOR?1:0,r!==Va.VECTOR&&(this.context=Kn()),C(Lo,I.CLEAR,this.handleFontsChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){T(Lo,I.CLEAR,this.handleFontsChanged_,this),t.prototype.disposeInternal.call(this)},e.prototype.getTile=function(e,r,n,i,o){var a=t.prototype.getTile.call(this,e,r,n,i,o);return a.getState()===Qt.LOADED&&(this.createReplayGroup_(a,i,o),this.context&&this.renderTileImage_(a,i,o)),a},e.prototype.getTileImage=function(t){var e=this.getLayer();return t.getImage(e)},e.prototype.prepareFrame=function(e,r){var n=this.getLayer().getRevision();return this.renderedLayerRevision_!=n&&(this.renderedTiles.length=0),this.renderedLayerRevision_=n,t.prototype.prepareFrame.call(this,e,r)},e.prototype.createReplayGroup_=function(t,e,r){var n=this,i=this.getLayer(),o=i.getRevision(),a=i.getRenderOrder()||null,s=t.getReplayState(i);if(s.dirty||s.renderedRevision!=o||s.renderedRenderOrder!=a){for(var l=i.getSource(),c=l.getTileGrid(),u=l.getTileGridForProjection(r).getResolution(t.tileCoord[0]),h=t.extent,p=function(o,p){var d=t.getTile(t.tileKeys[o]);if(d.getState()==Qt.LOADED){var f=d.tileCoord,g=c.getTileCoordExtent(f),y=ir(h,g),m=Ve(g,y)?null:Ne(y,i.getRenderBuffer()*u,n.tmpExtent),C=d.getProjection(),v=!1;Yr(r,C)||(v=!0,d.setProjection(r)),s.dirty=!1;var T=new Da(0,y,u,e,l.getOverlaps(),n.declutterTree_,i.getRenderBuffer()),_=Ua(u,e),S=function(t){var e,r=t.getStyleFunction()||i.getStyleFunction();if(r&&(e=r(t,u)),e){var n=this.renderFeature(t,_,e,T);this.dirty_=this.dirty_||n,s.dirty=s.dirty||n}},E=d.getFeatures();a&&a!==s.renderedRenderOrder&&E.sort(a);for(var L=0,w=E.length;L<w;++L){var b=E[L];v&&(C.getUnits()==Cr.TILE_PIXELS&&(C.setWorldExtent(g),C.setExtent(d.getExtent())),b.getGeometry().transform(C,r)),m&&!lr(m,b.getGeometry().getExtent())||S.call(n,b)}T.finish(),d.setReplayGroup(i,t.tileCoord.toString(),T)}},d=0,f=t.tileKeys.length;d<f;++d)p(d);s.renderedRevision=o,s.renderedRenderOrder=a}},e.prototype.forEachFeatureAtCoordinate=function(t,e,r,n,i){var a=e.viewState.resolution,s=e.viewState.rotation;r=null==r?0:r;var l,c,u,h,p=this.getLayer(),d={},f=this.renderedTiles;for(u=0,h=f.length;u<h;++u){var g=f[u];if(Fe(l=Ne(g.extent,r*a,l),t))for(var y=0,m=g.tileKeys.length;y<m;++y){var C=g.getTile(g.tileKeys[y]);if(C.getState()==Qt.LOADED){var v=C.getReplayGroup(p,g.tileCoord.toString());c=c||v.forEachFeatureAtCoordinate(t,a,s,r,{},function(t){var e=o(t);if(!(e in d))return d[e]=!0,n.call(i,t,p)},null)}}}return c},e.prototype.getReplayTransform_=function(t,e){var r=this.getLayer().getSource().getTileGrid(),n=t.tileCoord,i=r.getResolution(n[0]),o=e.viewState,a=e.pixelRatio,s=o.resolution/a,l=r.getTileCoordExtent(n,this.tmpExtent),c=o.center,u=or(l),h=e.size,p=Math.round(a*h[0]/2),d=Math.round(a*h[1]/2);return an(this.tmpTransform_,p,d,i/s,i/s,o.rotation,(u[0]-c[0])/i,(c[1]-u[1])/i)},e.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.postCompose=function(e,r,n){var i=this.getLayer(),o=i.getRenderMode();if(o!=Va.IMAGE){var a,s,l=i.getDeclutter()?{}:null,c=i.getSource(),u=za[o],h=r.pixelRatio,p=r.viewState.rotation,d=r.size;p&&No(e,-p,a=Math.round(h*d[0]/2),s=Math.round(h*d[1]/2)),l&&this.declutterTree_.clear();for(var f=r.viewHints,g=!(f[0]||f[1]),y=this.renderedTiles,m=c.getTileGridForProjection(r.viewState.projection),C=[],v=[],T=y.length-1;T>=0;--T){var _=y[T];if(_.getState()!=Qt.ABORT)for(var S=_.tileCoord,E=m.getTileCoordExtent(S,this.tmpExtent)[0]-_.extent[0],L=void 0,w=0,b=_.tileKeys.length;w<b;++w){var A=_.getTile(_.tileKeys[w]);if(A.getState()==Qt.LOADED){var x=A.getReplayGroup(i,S.toString());if(x&&x.hasReplays(u)){L||(L=this.getTransform(r,E));var P=A.tileCoord[0],R=x.getClipCoords(L);e.save(),e.globalAlpha=n.opacity;for(var I=0,M=C.length;I<M;++I){var O=C[I];P<v[I]&&(e.beginPath(),e.moveTo(R[0],R[1]),e.lineTo(R[2],R[3]),e.lineTo(R[4],R[5]),e.lineTo(R[6],R[7]),e.moveTo(O[6],O[7]),e.lineTo(O[4],O[5]),e.lineTo(O[2],O[3]),e.lineTo(O[0],O[1]),e.clip())}x.replay(e,L,p,{},g,u,l),e.restore(),C.push(R),v.push(P)}}}}l&&function(t,e,r,n){for(var i=Object.keys(t).map(Number).sort(Nt),o={},a=0,s=i.length;a<s;++a)for(var l=t[i[a].toString()],c=0,u=l.length;c<u;){var h=l[c++],p=l[c++];h.replay(e,p,r,o,n)}}(l,e,p,g),p&&No(e,p,a,s)}t.prototype.postCompose.call(this,e,r,n)},e.prototype.renderFeature=function(t,e,r,n){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var o=0,a=r.length;o<a;++o)i=qa(n,t,r[o],e,this.handleStyleImageChange_,this)||i;else i=qa(n,t,r,e,this.handleStyleImageChange_,this);return i},e.prototype.renderTileImage_=function(t,e,r){var n=this.getLayer(),i=t.getReplayState(n),o=n.getRevision(),a=Ya[n.getRenderMode()];if(a&&i.renderedTileRevision!==o){i.renderedTileRevision=o;var s=t.wrappedTileCoord,l=s[0],c=n.getSource(),u=c.getTileGridForProjection(r),h=u.getResolution(l),p=t.getContext(n),d=c.getTilePixelSize(l,e,r);p.canvas.width=d[0],p.canvas.height=d[1];for(var f=u.getTileCoordExtent(s,this.tmpExtent),g=0,y=t.tileKeys.length;g<y;++g){var m=t.getTile(t.tileKeys[g]);if(m.getState()==Qt.LOADED){var C=e/h,v=Zr(this.tmpTransform_);nn(v,C,-C),on(v,-f[0],-f[3]),m.getReplayGroup(n,t.tileCoord.toString()).replay(p,v,0,{},!0,a)}}}},e}(ca);Xa.handles=function(t){return t.getType()===yo.VECTOR_TILE},Xa.create=function(t,e){return new Xa(e)};var Ka=Xa,$a=function(t){function e(e){(e=u({},e)).controls||(e.controls=function(t){var e={},r=new G;return(void 0===e.zoom||e.zoom)&&r.push(new Ei(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&r.push(new Si(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&r.push(new Ti(e.attributionOptions)),r}()),e.interactions||(e.interactions=uo()),t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createRenderer=function(){var t=new ta(this);return t.registerLayerRenderers([ia,ca,Ha,Ka]),t},e}(ci),Ja={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},Za={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Qa=function(t){function e(e){t.call(this),this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+pi,this.element.style.position="absolute",this.autoPan=void 0!==e.autoPan&&e.autoPan,this.autoPanAnimation=e.autoPanAnimation||{},this.autoPanMargin=void 0!==e.autoPanMargin?e.autoPanMargin:20,this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0},this.mapPostrenderListenerKey=null,C(this,k(Za.ELEMENT),this.handleElementChanged,this),C(this,k(Za.MAP),this.handleMapChanged,this),C(this,k(Za.OFFSET),this.handleOffsetChanged,this),C(this,k(Za.POSITION),this.handlePositionChanged,this),C(this,k(Za.POSITIONING),this.handlePositioningChanged,this),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(void 0!==e.positioning?e.positioning:Ja.TOP_LEFT),void 0!==e.position&&this.setPosition(e.position)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getElement=function(){return this.get(Za.ELEMENT)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(Za.MAP)},e.prototype.getOffset=function(){return this.get(Za.OFFSET)},e.prototype.getPosition=function(){return this.get(Za.POSITION)},e.prototype.getPositioning=function(){return this.get(Za.POSITIONING)},e.prototype.handleElementChanged=function(){ti(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(Qn(this.element),_(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=C(t,$t.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(Za.POSITION)&&this.autoPan&&this.panIntoView()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(Za.ELEMENT,t)},e.prototype.setMap=function(t){this.set(Za.MAP,t)},e.prototype.setOffset=function(t){this.set(Za.OFFSET,t)},e.prototype.setPosition=function(t){this.set(Za.POSITION,t)},e.prototype.panIntoView=function(){var t=this.getMap();if(t&&t.getTargetElement()){var e=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),n=this.getRect(r,[$n(r),Jn(r)]),i=this.autoPanMargin;if(!Be(e,n)){var o=n[0]-e[0],a=e[2]-n[2],s=n[1]-e[1],l=e[3]-n[3],c=[0,0];if(o<0?c[0]=o-i:a<0&&(c[0]=Math.abs(a)+i),s<0?c[1]=s-i:l<0&&(c[1]=Math.abs(l)+i),0!==c[0]||0!==c[1]){var u=t.getView().getCenter(),h=t.getPixelFromCoordinate(u),p=[h[0]+c[0],h[1]+c[1]];t.getView().animate({center:t.getCoordinateFromPixel(p),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},e.prototype.getRect=function(t,e){var r=t.getBoundingClientRect(),n=r.left+window.pageXOffset,i=r.top+window.pageYOffset;return[n,i,n+e[0],i+e[1]]},e.prototype.setPositioning=function(t){this.set(Za.POSITIONING,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var r=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(r,n)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);var o=n[0],a=n[1];if(i==Ja.BOTTOM_RIGHT||i==Ja.CENTER_RIGHT||i==Ja.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=r.left="");var s=Math.round(e[0]-t[0]-o)+"px";this.rendered.right_!=s&&(this.rendered.right_=r.right=s)}else{""!==this.rendered.right_&&(this.rendered.right_=r.right=""),i!=Ja.BOTTOM_CENTER&&i!=Ja.CENTER_CENTER&&i!=Ja.TOP_CENTER||(o-=this.element.offsetWidth/2);var l=Math.round(t[0]+o)+"px";this.rendered.left_!=l&&(this.rendered.left_=r.left=l)}if(i==Ja.BOTTOM_LEFT||i==Ja.BOTTOM_CENTER||i==Ja.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=r.top="");var c=Math.round(e[1]-t[1]-a)+"px";this.rendered.bottom_!=c&&(this.rendered.bottom_=r.bottom=c)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=r.bottom=""),i!=Ja.CENTER_LEFT&&i!=Ja.CENTER_CENTER&&i!=Ja.CENTER_RIGHT||(a-=this.element.offsetHeight/2);var u=Math.round(t[1]+a)+"px";this.rendered.top_!=u&&(this.rendered.top_=r.top=u)}},e.prototype.getOptions=function(){return this.options},e}(D);function ts(t){this.validateExtent_(),this.updateBox_()}var es=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||ts,target:r.target}),this.collapsed_=void 0===r.collapsed||r.collapsed,this.collapsible_=void 0===r.collapsible||r.collapsible,this.collapsible_||(this.collapsed_=!1);var n=void 0!==r.className?r.className:"ol-overviewmap",i=void 0!==r.tipLabel?r.tipLabel:"Overview map",o=void 0!==r.collapseLabel?r.collapseLabel:"\xab";"string"==typeof o?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o):this.collapseLabel_=o;var a=void 0!==r.label?r.label:"\xbb";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a):this.label_=a;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(s),C(l,I.CLICK,this.handleClick_,this),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.ovmap_=new $a({controls:new G,interactions:new G,view:r.view});var c=this.ovmap_;r.layers&&r.layers.forEach(function(t){c.addLayer(t)}.bind(this));var u=document.createElement("div");u.className="ol-overviewmap-box",u.style.boxSizing="border-box",this.boxOverlay_=new Qa({position:[0,0],positioning:Ja.BOTTOM_LEFT,element:u}),this.ovmap_.addOverlay(this.boxOverlay_);var h=n+" "+di+" "+fi+(this.collapsed_&&this.collapsible_?" "+gi:"")+(this.collapsible_?"":" ol-uncollapsible"),p=this.element;p.className=h,p.appendChild(this.ovmapDiv_),p.appendChild(l);var d=this,f=this.boxOverlay_,g=this.boxOverlay_.getElement(),y=function(t){var e,r={clientX:(e=t).clientX-g.offsetWidth/2,clientY:e.clientY+g.offsetHeight/2},n=c.getEventCoordinate(r);f.setPosition(n)},m=function(t){var e=c.getEventCoordinate(t);d.getMap().getView().setCenter(e),window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",m)};g.addEventListener("mousedown",function(){window.addEventListener("mousemove",y),window.addEventListener("mouseup",m)})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){var r=this.getMap();if(e!==r){if(r){var n=r.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(t.prototype.setMap.call(this,e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(C(e,c,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup());var i=e.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},e.prototype.handleMapPropertyChange_=function(t){if(t.key===Jt.VIEW){var e=t.oldValue;e&&this.unbindView_(e);var r=this.getMap().getView();this.bindView_(r)}},e.prototype.bindView_=function(t){C(t,k(me),this.handleRotationChanged_,this)},e.prototype.unbindView_=function(t){T(t,k(me),this.handleRotationChanged_,this)},e.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},e.prototype.validateExtent_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var r=t.getSize(),n=t.getView().calculateExtent(r),i=e.getSize(),o=e.getView().calculateExtent(i),a=e.getPixelFromCoordinate(or(n)),s=e.getPixelFromCoordinate(Qe(n)),l=Math.abs(a[0]-s[0]),c=Math.abs(a[1]-s[1]),u=i[0],h=i[1];l<.1*u||c<.1*h||l>.75*u||c>.75*h?this.resetExtent_():Be(o,n)||this.recenter_()}},e.prototype.resetExtent_=function(){var t=this.getMap(),e=this.ovmap_,r=t.getSize(),n=t.getView().calculateExtent(r),i=e.getView(),o=Math.log(7.5)/Math.LN2;ur(n,1/(.1*Math.pow(2,o/2))),i.fit(n)},e.prototype.recenter_=function(){var t=this.getMap(),e=this.ovmap_,r=t.getView();e.getView().setCenter(r.getCenter())},e.prototype.updateBox_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var r=t.getSize(),n=t.getView(),i=e.getView(),o=n.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=n.calculateExtent(r),c=i.getResolution(),u=Ze(l),h=ar(l),p=this.calculateCoordinateRotate_(o,u);a.setPosition(p),s&&(s.style.width=Math.abs((u[0]-h[0])/c)+"px",s.style.height=Math.abs((h[1]-u[1])/c)+"px")}},e.prototype.calculateCoordinateRotate_=function(t,e){var r,n=this.getMap().getView().getCenter();return n&&(Se(r=[e[0]-n[0],e[1]-n[1]],t),ve(r,n)),r},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(gi),this.collapsed_?Zn(this.collapseLabel_,this.label_):Zn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var t=this.ovmap_;this.collapsed_||t.isRendered()||(t.updateSize(),this.resetExtent_(),v(t,$t.POSTRENDER,function(t){this.updateBox_()},this))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.getOverviewMap=function(){return this.ovmap_},e}(ui),rs="units",ns={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"},is=[1,2,5];function os(t){var e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()}var as=function(t){function e(e){var r=e||{},n=void 0!==r.className?r.className:"ol-scale-line";t.call(this,{element:document.createElement("div"),render:r.render||os,target:r.target}),this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+di,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==r.minWidth?r.minWidth:64,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",C(this,k(rs),this.handleUnitsChanged_,this),this.setUnits(r.units||ns.METRIC)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getUnits=function(){return this.get(rs)},e.prototype.handleUnitsChanged_=function(){this.updateElement_()},e.prototype.setUnits=function(t){this.set(rs,t)},e.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,r=t.projection,n=this.getUnits(),i=n==ns.DEGREES?Cr.DEGREES:Cr.METERS,o=qr(r,t.resolution,e,i);r.getUnits()!=Cr.DEGREES&&r.getMetersPerUnit()&&i==Cr.METERS&&(o*=r.getMetersPerUnit());var a=this.minWidth_*o,s="";if(n==ns.DEGREES){var l=mr[Cr.DEGREES];r.getUnits()==Cr.DEGREES?a*=l:o/=l,a<l/60?(s="\u2033",o*=3600):a<l?(s="\u2032",o*=60):s="\xb0"}else n==ns.IMPERIAL?a<.9144?(s="in",o/=.0254):a<1609.344?(s="ft",o/=.3048):(s="mi",o/=1609.344):n==ns.NAUTICAL?(o/=1852,s="nm"):n==ns.METRIC?a<.001?(s="\u03bcm",o*=1e6):a<1?(s="mm",o*=1e3):a<1e3?s="m":(s="km",o/=1e3):n==ns.US?a<.9144?(s="in",o*=39.37):a<1609.344?(s="ft",o/=.30480061):(s="mi",o/=1609.3472):te(!1,33);for(var c,u,h=3*Math.floor(Math.log(this.minWidth_*o)/Math.log(10));;){if(c=is[(h%3+3)%3]*Math.pow(10,Math.floor(h/3)),u=Math.round(c/o),isNaN(u))return this.element.style.display="none",void(this.renderedVisible_=!1);if(u>=this.minWidth_)break;++h}var p=c+" "+s;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e}(ui),ss={VERTICAL:0,HORIZONTAL:1};function ls(t){if(t.frameState){this.sliderInitialized_||this.initSlider_();var e=t.frameState.viewState.resolution;e!==this.currentResolution_&&(this.currentResolution_=e,this.setThumbPosition_(e))}}var cs=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),render:r.render||ls}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=ss.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.previousX_,this.previousY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=void 0!==r.duration?r.duration:200;var n=void 0!==r.className?r.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=n+"-thumb "+di;var o=this.element;o.className=n+" "+di+" "+fi,o.appendChild(i),this.dragger_=new Xt(o),C(this.dragger_,tt.POINTERDOWN,this.handleDraggerStart_,this),C(this.dragger_,tt.POINTERMOVE,this.handleDraggerDrag_,this),C(this.dragger_,tt.POINTERUP,this.handleDraggerEnd_,this),C(o,I.CLICK,this.handleContainerClick_,this),C(i,I.CLICK,x)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.dragger_.dispose(),t.prototype.disposeInternal.call(this)},e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),e&&e.render()},e.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,r=t.offsetHeight,n=t.firstElementChild,i=getComputedStyle(n),o=n.offsetWidth+parseFloat(i.marginRight)+parseFloat(i.marginLeft),a=n.offsetHeight+parseFloat(i.marginTop)+parseFloat(i.marginBottom);this.thumbSize_=[o,a],e>r?(this.direction_=ss.HORIZONTAL,this.widthLimit_=e-o):(this.direction_=ss.VERTICAL,this.heightLimit_=r-a),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),r=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(r);e.animate({resolution:e.constrainResolution(n),duration:this.duration_,easing:xe})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.originalEvent.target===this.element.firstElementChild&&(this.getMap().getView().setHint(1,1),this.previousX_=t.clientX,this.previousY_=t.clientY,this.dragging_=!0,0===this.dragListenerKeys_.length)){var e=this.handleDraggerDrag_,r=this.handleDraggerEnd_;this.dragListenerKeys_.push(C(document,I.MOUSEMOVE,e,this),C(document,tt.POINTERMOVE,e,this),C(document,I.MOUSEUP,r,this),C(document,tt.POINTERUP,r,this))}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=this.element.firstElementChild,r=t.clientX-this.previousX_+parseFloat(e.style.left),n=t.clientY-this.previousY_+parseFloat(e.style.top),i=this.getRelativePosition_(r,n);this.currentResolution_=this.getResolutionForPosition_(i),this.getMap().getView().setResolution(this.currentResolution_),this.setThumbPosition_(this.currentResolution_),this.previousX_=t.clientX,this.previousY_=t.clientY}},e.prototype.handleDraggerEnd_=function(t){if(this.dragging_){var e=this.getMap().getView();e.setHint(1,-1),e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:xe}),this.dragging_=!1,this.previousX_=void 0,this.previousY_=void 0,this.dragListenerKeys_.forEach(_),this.dragListenerKeys_.length=0}},e.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),r=this.element.firstElementChild;this.direction_==ss.HORIZONTAL?r.style.left=this.widthLimit_*e+"px":r.style.top=this.heightLimit_*e+"px"},e.prototype.getRelativePosition_=function(t,e){return oe(this.direction_===ss.HORIZONTAL?t/this.widthLimit_:e/this.heightLimit_,0,1)},e.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},e.prototype.getPositionForResolution_=function(t){return 1-this.getMap().getView().getValueForResolutionFunction()(t)},e}(ui),us=function(t){function e(e){var r=e||{};t.call(this,{element:document.createElement("div"),target:r.target}),this.extent=r.extent?r.extent:null;var n=void 0!==r.className?r.className:"ol-zoom-extent",i=void 0!==r.label?r.label:"E",o=void 0!==r.tipLabel?r.tipLabel:"Fit to extent",a=document.createElement("button");a.setAttribute("type","button"),a.title=o,a.appendChild("string"==typeof i?document.createTextNode(i):i),C(a,I.CLICK,this.handleClick_,this);var s=n+" "+di+" "+fi,l=this.element;l.className=s,l.appendChild(a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleClick_=function(t){t.preventDefault(),this.handleZoomToExtent()},e.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fit(e)},e}(ui);function hs(t){return"function"==typeof t?t:(Array.isArray(t)?e=t:(te("function"==typeof t.getZIndex,41),e=[t]),function(){return e});var e}var ps=function(t){function e(e){if(t.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,C(this,k(this.geometryName_),this.handleGeometryChanged_,this),e)if("function"==typeof e.getSimplifiedGeometry){var r=e;this.setGeometry(r)}else{var n=e;this.setProperties(n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e(this.getProperties());t.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&t.setGeometry(r.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(_(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=C(t,I.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?hs(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){T(this,k(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=t,C(this,k(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},e}(D),ds=function(t){function e(e,r){t.call(this),r&&!Array.isArray(e[0])?this.setFlatCoordinates(r,e):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPoint=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){if(n<De(this.getExtent(),t,e))return n;for(var i=this.flatCoordinates,o=this.stride,a=0,s=i.length;a<s;a+=o){var l=le(t,e,i[a],i[a+1]);if(l<n){n=l;for(var c=0;c<o;++c)r[c]=i[a+c];r.length=o}}return n},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Pn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,n=[],i=0,o=t.length;i<o;i+=r){var a=new Pn(t.slice(i,i+r),e);n.push(a)}return n},e.prototype.getType=function(){return hr.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,n=0,i=e.length;n<i;n+=r)if(Ge(t,e[n],e[n+1]))return!0;return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un);function fs(t,e,r,n,i,o){var a=NaN,s=NaN,l=(r-e)/n;if(1===l)a=t[e],s=t[e+1];else if(2==l)a=(1-i)*t[e]+i*t[e+n],s=(1-i)*t[e+1]+i*t[e+n+1];else if(0!==l){for(var c=t[e],u=t[e+1],h=0,p=[0],d=e+n;d<r;d+=n){var f=t[d],g=t[d+1];h+=Math.sqrt((f-c)*(f-c)+(g-u)*(g-u)),p.push(h),c=f,u=g}var y=i*h,m=function(t,e,r){for(var n,i,o=Nt,a=0,s=t.length,l=!1;a<s;)(i=+o(t[n=a+(s-a>>1)],e))<0?a=n+1:(s=n,l=!i);return l?a:~a}(p,y);if(m<0){var C=(y-p[-m-2])/(p[-m-1]-p[-m-2]),v=e+(-m-2)*n;a=he(t[v],t[v+n],C),s=he(t[v+1],t[v+n+1],C)}else a=t[e+m*n],s=t[e+m*n+1]}return o?(o[0]=a,o[1]=s,o):[a,s]}function gs(t,e,r,n,i,o){if(r==e)return null;var a;if(i<t[e+n-1])return o?((a=t.slice(e,e+n))[n-1]=i,a):null;if(t[r-1]<i)return o?((a=t.slice(r-n,r))[n-1]=i,a):null;if(i==t[e+n-1])return t.slice(e,e+n);for(var s=e/n,l=r/n;s<l;){var c=s+l>>1;i<t[(c+1)*n-1]?l=c:s=c+1}var u=t[s*n-1];if(i==u)return t.slice((s-1)*n,(s-1)*n+n);var h=(i-u)/(t[(s+1)*n-1]-u);a=[];for(var p=0;p<n-1;++p)a.push(he(t[(s-1)*n+p],t[s*n+p],h));return a.push(i),a}var ys=function(t){function e(e,r){t.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?this.setCoordinates(e,r):this.setFlatCoordinates(r,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendCoordinate=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.forEachSegment=function(t){return Nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=pr.XYM&&this.layout!=pr.XYZM)return null;var r=void 0!==e&&e;return gs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.prototype.getCoordinates=function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)},e.prototype.getLength=function(){return ga(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=Ln(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,pr.XY)},e.prototype.getType=function(){return hr.LINE_STRING},e.prototype.intersectsExtent=function(t){return kn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=vn(this.flatCoordinates,0,t,this.stride),this.changed()},e}(un),ms=function(t){function e(e,r,n){if(t.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,r);else if(void 0!==r&&n)this.setFlatCoordinates(r,e),this.ends_=n;else{for(var i=this.getLayout(),o=e,a=[],s=[],l=0,c=o.length;l<c;++l){var u=o[l];0===l&&(i=u.getLayout()),Bt(a,u.getFlatCoordinates()),s.push(a.length)}this.setFlatCoordinates(i,a),this.ends_=s}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendLineString=function(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,n))},e.prototype.getCoordinateAtM=function(t,e,r){if(this.layout!=pr.XYM&&this.layout!=pr.XYZM||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,i=void 0!==r&&r;return function(t,e,r,n,i,o,a){if(a)return gs(t,e,r[r.length-1],n,i,o);var s;if(i<t[n-1])return o?((s=t.slice(0,n))[n-1]=i,s):null;if(t[t.length-1]<i)return o?((s=t.slice(t.length-n))[n-1]=i,s):null;for(var l=0,c=r.length;l<c;++l){var u=r[l];if(e!=u){if(i<t[e+n-1])return null;if(i<=t[u-1])return gs(t,e,u,n,i,!1);e=u}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,n,i)},e.prototype.getCoordinates=function(){return Sn(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new ys(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,n=[],i=0,o=0,a=e.length;o<a;++o){var s=e[o],l=new ys(t.slice(i,s),r);n.push(l),i=s}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,o=0,a=n.length;o<a;++o){var s=n[o];Bt(t,fs(e,r,s,i,.5)),r=s}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=Ln(t,e,u,n,i,o,a),s.push(a),e=u}return a}(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n),new e(r,pr.XY,n)},e.prototype.getType=function(){return hr.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){if(kn(t,e,r[o],n,i))return!0;e=r[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Tn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(un),Cs=function(t){function e(e,r,n){if(t.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var i=this.getLayout(),o=e,a=[],s=[],l=0,c=o.length;l<c;++l){var u=o[l];0===l&&(i=u.getLayout());for(var h=a.length,p=u.getEnds(),d=0,f=p.length;d<f;++d)p[d]+=h;Bt(a,u.getFlatCoordinates()),s.push(p)}r=i,e=a,n=s}void 0!==r&&n?(this.setFlatCoordinates(r,e),this.endss_=n):this.setCoordinates(e,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var r=this.flatCoordinates.length;Bt(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,i=(e=t.getEnds().slice()).length;n<i;++n)e[n]+=r}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,r=new Array(t),n=0;n<t;++n)r[n]=this.endss_[n].slice();return new e(this.flatCoordinates.slice(),this.layout,r)},e.prototype.closestPointXY=function(t,e,r,n){return n<De(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=gn(t,e,s,n,i),e=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,r,n,i,o,a,s,l,c,u){for(var h=[NaN,NaN],p=0,d=r.length;p<d;++p){var f=r[p];c=mn(t,e,f,n,i,!0,a,s,l,c,h),e=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,r,n))},e.prototype.containsXY=function(t,e){return function(t,e,r,n,i,o){if(0===r.length)return!1;for(var a=0,s=r.length;a<s;++a){var l=r[a];if(Mn(t,e,l,n,i,o))return!0;e=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=pn(t,e,s,n),e=s[s.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?jn(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,En(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,r,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],a=0,s=r.length;a<s;++a){var l=r[a];o=He(t,e,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=l[l.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;++a){var l=r[a];o=On(t,e,l,n,i,2*a,o),e=l[l.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new ds(this.getFlatInteriorPoints().slice(),pr.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)if(!Gn(t,0,r[o],n,void 0))return!1;return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=jn(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=function(t,e,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l],h=[];a=An(t,e,u,n,i,o,a,h),s.push(h),e=u[u.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,pr.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var r=this.endss_[t-1];e=r[r.length-1]}var n=this.endss_[t].slice(),i=n[n.length-1];if(0!==e)for(var o=0,a=n.length;o<a;++o)n[o]-=e;return new Wn(this.flatCoordinates.slice(e,i),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.endss_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o].slice(),l=s[s.length-1];if(0!==i)for(var c=0,u=s.length;c<u;++c)s[c]-=i;var h=new Wn(e.slice(i,l),t,s);n.push(h),i=l}return n},e.prototype.getType=function(){return hr.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(Dn(t,e,s,n,i))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(t,e,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=Tn(t,e,r[s],n,o[a]);o[a++]=c,e=c[c.length-1]}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(un),vs=function(t){function e(e,r,n){if(t.call(this),void 0!==n&&void 0===r)this.setFlatCoordinates(n,e);else{var i=r||0;this.setCenterAndRadius(e,i,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,r,n){var i=this.flatCoordinates,o=t-i[0],a=e-i[1],s=o*o+a*a;if(s<n){if(0===s)for(var l=0;l<this.stride;++l)r[l]=i[l];else{var c=this.getRadius()/Math.sqrt(s);r[0]=i[0]+c*o,r[1]=i[1]+c*a;for(var u=2;u<this.stride;++u)r[u]=i[u]}return r.length=this.stride,s}return n},e.prototype.containsXY=function(t,e){var r=this.flatCoordinates,n=t-r[0],i=e-r[1];return n*n+i*i<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,r=e[this.stride]-e[0];return je(e[0]-r,e[1]-r,e[0]+r,e[1]+r,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return hr.CIRCLE},e.prototype.intersectsExtent=function(t){if(lr(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||$e(t,this.intersectsCoordinate,this)}return!1},e.prototype.setCenter=function(t){var e=this.stride,r=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+r;for(var i=1;i<e;++i)n[e+i]=t[i];this.setFlatCoordinates(this.layout,n),this.changed()},e.prototype.setCenterAndRadius=function(t,e,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,i=Cn(n,0,t,this.stride);n[i++]=n[0]+e;for(var o=1,a=this.stride;o<a;++o)n[i++]=n[o];n.length=i,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e}(un);vs.prototype.transform;var Ts=vs;function _s(t){for(var e=[],r=0,n=t.length;r<n;++r)e.push(t[r].clone());return e}var Ss=function(t){function e(e){t.call(this),this.geometries_=e||null,this.listenGeometriesChange_()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)T(this.geometries_[t],I.CHANGE,this.changed,this)},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)C(this.geometries_[t],I.CHANGE,this.changed,this)},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t},e.prototype.closestPointXY=function(t,e,r,n){if(n<De(this.getExtent(),t,e))return n;for(var i=this.geometries_,o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(t,e,r,n);return n},e.prototype.containsXY=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){qe(t);for(var e=this.geometries_,r=0,n=e.length;r<n;++r)Ye(t,e[r].getExtent());return t},e.prototype.getGeometries=function(){return _s(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(h(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var r=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(r))return this.simplifiedGeometryCache[r];for(var n=[],i=this.geometries_,o=!1,a=0,s=i.length;a<s;++a){var l=i[a],c=l.getSimplifiedGeometry(t);n.push(c),c!==l&&(o=!0)}if(o){var u=new e(null);return u.setGeometriesArray(n),this.simplifiedGeometryCache[r]=u,u}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return hr.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)if(e[r].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,r){var n=r;n||(n=tr(this.getExtent()));for(var i=this.geometries_,o=0,a=i.length;o<a;++o)i[o].scale(t,e,n);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(_s(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(ln),Es={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function Ls(t,e){return function(t,e,r,n){return function(r,i,o){var a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(r,i,o):t,!0),e.getType()==Es.ARRAY_BUFFER&&(a.responseType="arraybuffer"),a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){var r,i=e.getType();i==Es.JSON||i==Es.TEXT?r=a.responseText:i==Es.XML?(r=a.responseXML)||(r=(new DOMParser).parseFromString(a.responseText,"application/xml")):i==Es.ARRAY_BUFFER&&(r=a.response),r?function(t,e){"function"==typeof this.addFeatures&&this.addFeatures(t)}.call(this,e.readFeatures(r,{featureProjection:o}),e.readProjection(r),e.getLastExtent()):n.call(this)}else n.call(this)}.bind(this),a.onerror=function(){n.call(this)}.bind(this),a.send()}}(t,e,0,b)}var ws=function(){this.dataProjection=null,this.defaultFeatureProjection=null};ws.prototype.getReadOptions=function(t,e){var r;return e&&(r={dataProjection:e.dataProjection?e.dataProjection:this.readProjection(t),featureProjection:e.featureProjection}),this.adaptOptions(r)},ws.prototype.adaptOptions=function(t){return u({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},ws.prototype.getLastExtent=function(){return null},ws.prototype.getType=function(){return n()},ws.prototype.readFeature=function(t,e){return n()},ws.prototype.readFeatures=function(t,e){return n()},ws.prototype.readGeometry=function(t,e){return n()},ws.prototype.readProjection=function(t){return n()},ws.prototype.writeFeature=function(t,e){return n()},ws.prototype.writeFeatures=function(t,e){return n()},ws.prototype.writeGeometry=function(t,e){return n()};var bs=ws;function As(t,e,r){var n,i=r?jr(r.featureProjection):null,o=r?jr(r.dataProjection):null;if(n=i&&o&&!Yr(i,o)?Array.isArray(t)?$r(t,o,i):(e?t.clone():t).transform(e?i:o,e?o:i):t,e&&r&&void 0!==r.decimals&&!Array.isArray(n)){var a=Math.pow(10,r.decimals);n===t&&(n=t.clone()),n.applyTransform(function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*a)/a;return t})}return n}function xs(t){if("string"==typeof t){return JSON.parse(t)||null}return null!==t?t:null}var Ps=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.JSON},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return n()},e.prototype.readFeaturesFromObject=function(t,e){return n()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(xs(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return n()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(xs(t))},e.prototype.readProjectionFromObject=function(t){return n()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return n()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return n()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return n()},e}(bs);function Rs(t,e){if(!t)return null;var r;switch(t.type){case hr.POINT:r=function(t){return new Pn(t.coordinates)}(t);break;case hr.LINE_STRING:r=function(t){return new ys(t.coordinates)}(t);break;case hr.POLYGON:r=function(t){return new Wn(t.coordinates)}(t);break;case hr.MULTI_POINT:r=function(t){return new ds(t.coordinates)}(t);break;case hr.MULTI_LINE_STRING:r=function(t){return new ms(t.coordinates)}(t);break;case hr.MULTI_POLYGON:r=function(t){return new Cs(t.coordinates)}(t);break;case hr.GEOMETRY_COLLECTION:r=function(t,e){var r=t.geometries.map(function(t){return Rs(t,void 0)});return new Ss(r)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return As(r,!1,e)}function Is(t,e){var r,n=(t=As(t,!0,e)).getType();switch(n){case hr.POINT:r=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case hr.LINE_STRING:r=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case hr.POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(r)}}(t,e);break;case hr.MULTI_POINT:r=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case hr.MULTI_LINE_STRING:r=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case hr.MULTI_POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(r)}}(t,e);break;case hr.GEOMETRY_COLLECTION:r=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){var r=u({},e);return delete r.featureProjection,Is(t,r)})}}(t,e);break;case hr.CIRCLE:r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return r}var Ms=function(t){function e(e){var r=e||{};t.call(this),this.dataProjection=jr(r.dataProjection?r.dataProjection:"EPSG:4326"),r.featureProjection&&(this.defaultFeatureProjection=jr(r.featureProjection)),this.geometryName_=r.geometryName,this.extractGeometryName_=r.extractGeometryName}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeatureFromObject=function(t,e){var r,n=Rs((r="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),i=new ps;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties),i},e.prototype.readFeaturesFromObject=function(t,e){var r=null;if("FeatureCollection"===t.type){r=[];for(var n=t.features,i=0,o=n.length;i<o;++i)r.push(this.readFeatureFromObject(n[i],e))}else r=[this.readFeatureFromObject(t,e)];return r},e.prototype.readGeometryFromObject=function(t,e){return Rs(t,e)},e.prototype.readProjectionFromObject=function(t){var e,r=t.crs;return r?"name"==r.type?e=jr(r.properties.name):te(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var r={type:"Feature",geometry:null,properties:null},n=t.getId();void 0!==n&&(r.id=n);var i=t.getGeometry();i&&(r.geometry=Is(i,e));var o=t.getProperties();return delete o[t.getGeometryName()],d(o)||(r.properties=o),r},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:r}},e.prototype.writeGeometryObject=function(t,e){return Is(t,this.adaptOptions(e))},e}(Ps),Os=document.implementation.createDocument("","",null),Ns="http://www.w3.org/2001/XMLSchema-instance";function ks(t,e){return Os.createElementNS(t,e)}function Ds(t,e){return function t(e,r,n){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)r?n.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):n.push(e.nodeValue);else{var i;for(i=e.firstChild;i;i=i.nextSibling)t(i,r,n)}return n}(t,e,[]).join("")}function Fs(t){return"documentElement"in t}function Bs(t){return(new DOMParser).parseFromString(t,"application/xml")}function Gs(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&Bt(n[n.length-1],i)}}function Us(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&n[n.length-1].push(i)}}function js(t,e){return function(r,n){var i=t.call(void 0!==e?e:this,r,n);void 0!==i&&(n[n.length-1]=i)}}function qs(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==e?e:n.localName;(s in a?a[s]:a[s]=[]).push(o)}}}function Ws(t,e,r){return function(n,i){var o=t.call(void 0!==r?r:this,n,i);void 0!==o&&(i[i.length-1][void 0!==e?e:n.localName]=o)}}function Hs(t,e){return function(r,n,i){t.call(void 0!==e?e:this,r,n,i),i[i.length-1].node.appendChild(r)}}function Vs(t,e){var r,n;return function(e,i,o){if(void 0===r){r={};var a={};a[e.localName]=t,r[e.namespaceURI]=a,n=Ys(e.localName)}Zs(r,n,i,o)}}function Ys(t,e){var r=t;return function(t,n,i){var o=n[n.length-1].node,a=r;return void 0===a&&(a=i),ks(void 0!==e?e:o.namespaceURI,a)}}var zs=Ys();function Xs(t,e){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=t[e[i]];return n}function Ks(t,e,r){var n,i,o=void 0!==r?r:{};for(n=0,i=t.length;n<i;++n)o[t[n]]=e;return o}function $s(t,e,r,n){var i;for(i=e.firstElementChild;i;i=i.nextElementSibling){var o=t[i.namespaceURI];if(void 0!==o){var a=o[i.localName];void 0!==a&&a.call(n,i,r)}}}function Js(t,e,r,n,i){return n.push(t),$s(e,r,n,i),n.pop()}function Zs(t,e,r,n,i,o){for(var a,s,l=(void 0!==i?i:r).length,c=0;c<l;++c)void 0!==(a=r[c])&&void 0!==(s=e.call(void 0!==o?o:this,a,n,void 0!==i?i[c]:void 0))&&t[s.namespaceURI][s.localName].call(o,s,a,n)}function Qs(t,e,r,n,i,o,a){return i.push(t),Zs(e,r,n,i,o,a),i.pop()}var tl=function(t){function e(){t.call(this),this.xmlSerializer_=new XMLSerializer}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.XML},e.prototype.readFeature=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readFeatureFromDocument(r,e)}return Fs(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}return null},e.prototype.readFeatureFromDocument=function(t,e){var r=this.readFeaturesFromDocument(t,e);return r.length>0?r[0]:null},e.prototype.readFeatureFromNode=function(t,e){return null},e.prototype.readFeatures=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readFeaturesFromDocument(r,e)}return Fs(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}return[]},e.prototype.readFeaturesFromDocument=function(t,e){for(var r=[],n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Bt(r,this.readFeaturesFromNode(n,e));return r},e.prototype.readFeaturesFromNode=function(t,e){return n()},e.prototype.readGeometry=function(t,e){if(t){if("string"==typeof t){var r=Bs(t);return this.readGeometryFromDocument(r,e)}return Fs(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}return null},e.prototype.readGeometryFromDocument=function(t,e){return null},e.prototype.readGeometryFromNode=function(t,e){return null},e.prototype.readProjection=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readProjectionFromDocument(e)}return Fs(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}return null},e.prototype.readProjectionFromDocument=function(t){return this.dataProjection},e.prototype.readProjectionFromNode=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){var r=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeFeatureNode=function(t,e){return null},e.prototype.writeFeatures=function(t,e){var r=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeFeaturesNode=function(t,e){return null},e.prototype.writeGeometry=function(t,e){var r=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(r)},e.prototype.writeGeometryNode=function(t,e){return null},e}(bs),el="http://www.opengis.net/gml",rl=/^[\s\xa0]*$/,nl=function(t){function e(e){t.call(this);var r=e||{};this.featureType=r.featureType,this.featureNS=r.featureNS,this.srsName=r.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Us(this.readFeaturesInternal),featureMembers:js(this.readFeaturesInternal)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeaturesInternal=function(t,e){var r=t.localName,n=null;if("FeatureCollection"==r)n=Js([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if("featureMembers"==r||"featureMember"==r){var i=e[0],o=i.featureType,a=i.featureNS;if(!o&&t.childNodes){o=[],a={};for(var s=0,l=t.childNodes.length;s<l;++s){var c=t.childNodes[s];if(1===c.nodeType){var u=c.nodeName.split(":").pop();if(-1===o.indexOf(u)){var h="",p=0,d=c.namespaceURI;for(var f in a){if(a[f]===d){h=f;break}++p}h||(a[h="p"+p]=d),o.push(h+":"+u)}}}"featureMember"!=r&&(i.featureType=o,i.featureNS=a)}if("string"==typeof a){var g=a;(a={}).p0=g}var y={},m=Array.isArray(o)?o:[o];for(var C in a){for(var v={},T=0,_=m.length;T<_;++T)(-1===m[T].indexOf(":")?"p0":m[T].split(":")[0])===C&&(v[m[T].split(":").pop()]="featureMembers"==r?Us(this.readFeatureElement,this):js(this.readFeatureElement,this));y[a[C]]=v}n=Js("featureMember"==r?void 0:[],y,t,e)}return null===n&&(n=[]),n},e.prototype.readGeometryElement=function(t,e){var r=e[0];r.srsName=t.firstElementChild.getAttribute("srsName"),r.srsDimension=t.firstElementChild.getAttribute("srsDimension");var n=Js(null,this.GEOMETRY_PARSERS,t,e,this);return n?As(n,!1,r):void 0},e.prototype.readFeatureElementInternal=function(t,e,r){for(var n,i={},o=t.firstElementChild;o;o=o.nextElementSibling){var a=void 0,s=o.localName;0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)?(a=Ds(o,!1),rl.test(a)&&(a=void 0)):(r&&(a=this.readGeometryElement(o,e)),a?"boundedBy"!==s&&(n=s):a=this.readFeatureElementInternal(o,e,!1)),i[s]?(i[s]instanceof Array||(i[s]=[i[s]]),i[s].push(a)):i[s]=a;var l=o.attributes.length;if(l>0){i[s]={_content_:i[s]};for(var c=0;c<l;c++){var u=o.attributes[c].name;i[s][u]=o.attributes[c].value}}}if(r){var h=new ps(i);n&&h.setGeometryName(n);var p=t.getAttribute("fid")||function(t,e,r){return t.getAttributeNS(e,"id")||""}(t,this.namespace);return p&&h.setId(p),h}return i},e.prototype.readFeatureElement=function(t,e){return this.readFeatureElementInternal(t,e,!0)},e.prototype.readPoint=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);if(r)return new Pn(r,pr.XYZ)},e.prototype.readMultiPoint=function(t,e){var r=Js([],this.MULTIPOINT_PARSERS_,t,e,this);return r?new ds(r):void 0},e.prototype.readMultiLineString=function(t,e){var r=Js([],this.MULTILINESTRING_PARSERS_,t,e,this);if(r)return new ms(r)},e.prototype.readMultiPolygon=function(t,e){var r=Js([],this.MULTIPOLYGON_PARSERS_,t,e,this);if(r)return new Cs(r)},e.prototype.pointMemberParser_=function(t,e){$s(this.POINTMEMBER_PARSERS_,t,e,this)},e.prototype.lineStringMemberParser_=function(t,e){$s(this.LINESTRINGMEMBER_PARSERS_,t,e,this)},e.prototype.polygonMemberParser_=function(t,e){$s(this.POLYGONMEMBER_PARSERS_,t,e,this)},e.prototype.readLineString=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);return r?new ys(r,pr.XYZ):void 0},e.prototype.readFlatLinearRing_=function(t,e){return Js(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)||void 0},e.prototype.readLinearRing=function(t,e){var r=this.readFlatCoordinatesFromNode_(t,e);if(r)return new xn(r,pr.XYZ)},e.prototype.readPolygon=function(t,e){var r=Js([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(r&&r[0]){var n,i,o=r[0],a=[o.length];for(n=1,i=r.length;n<i;++n)Bt(o,r[n]),a.push(o.length);return new Wn(o,pr.XYZ,a)}},e.prototype.readFlatCoordinatesFromNode_=function(t,e){return Js(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.readGeometryFromNode=function(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null},e.prototype.readFeaturesFromNode=function(t,e){var r={featureType:this.featureType,featureNS:this.featureNS};return e&&u(r,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[r])||[]},e.prototype.readProjectionFromNode=function(t){return jr(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))},e}(tl);nl.prototype.namespace=el,nl.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},nl.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:Us(nl.prototype.pointMemberParser_),pointMembers:Us(nl.prototype.pointMemberParser_)}},nl.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:Us(nl.prototype.lineStringMemberParser_),lineStringMembers:Us(nl.prototype.lineStringMemberParser_)}},nl.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:Us(nl.prototype.polygonMemberParser_),polygonMembers:Us(nl.prototype.polygonMemberParser_)}},nl.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:Us(nl.prototype.readFlatCoordinatesFromNode_)}},nl.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Us(nl.prototype.readLineString)}},nl.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Us(nl.prototype.readPolygon)}},nl.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:js(nl.prototype.readFlatLinearRing_)}};var il=nl;function ol(t){return al(Ds(t,!1))}function al(t){var e=/^\s*(true|1)|(false|0)\s*$/.exec(t);return e?void 0!==e[1]||!1:void 0}function sl(t){var e=Ds(t,!1),r=Date.parse(e);return isNaN(r)?void 0:r/1e3}function ll(t){return cl(Ds(t,!1))}function cl(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function ul(t){return hl(Ds(t,!1))}function hl(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function pl(t){return Ds(t,!1).trim()}function dl(t,e){ml(t,e?"1":"0")}function fl(t,e){t.appendChild(Os.createCDATASection(e))}function gl(t,e){var r=e.toPrecision();t.appendChild(Os.createTextNode(r))}function yl(t,e){var r=e.toString();t.appendChild(Os.createTextNode(r))}function ml(t,e){t.appendChild(Os.createTextNode(e))}var Cl=el+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",vl={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Tl=function(t){function e(e){var r=e||{};t.call(this,r),this.surface_=void 0!==r.surface&&r.surface,this.curve_=void 0!==r.curve&&r.curve,this.multiCurve_=void 0===r.multiCurve||r.multiCurve,this.multiSurface_=void 0===r.multiSurface||r.multiSurface,this.schemaLocation=r.schemaLocation?r.schemaLocation:Cl,this.hasZ=void 0!==r.hasZ&&r.hasZ}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readMultiCurve_=function(t,e){var r=Js([],this.MULTICURVE_PARSERS_,t,e,this);return r?new ms(r):void 0},e.prototype.readMultiSurface_=function(t,e){var r=Js([],this.MULTISURFACE_PARSERS_,t,e,this);if(r)return new Cs(r)},e.prototype.curveMemberParser_=function(t,e){$s(this.CURVEMEMBER_PARSERS_,t,e,this)},e.prototype.surfaceMemberParser_=function(t,e){$s(this.SURFACEMEMBER_PARSERS_,t,e,this)},e.prototype.readPatch_=function(t,e){return Js([null],this.PATCHES_PARSERS_,t,e,this)},e.prototype.readSegment_=function(t,e){return Js([null],this.SEGMENTS_PARSERS_,t,e,this)},e.prototype.readPolygonPatch_=function(t,e){return Js([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)},e.prototype.readLineStringSegment_=function(t,e){return Js([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.interiorParser_=function(t,e){var r=Js(void 0,this.RING_PARSERS,t,e,this);r&&e[e.length-1].push(r)},e.prototype.exteriorParser_=function(t,e){var r=Js(void 0,this.RING_PARSERS,t,e,this);r&&(e[e.length-1][0]=r)},e.prototype.readSurface_=function(t,e){var r=Js([null],this.SURFACE_PARSERS_,t,e,this);if(r&&r[0]){var n,i,o=r[0],a=[o.length];for(n=1,i=r.length;n<i;++n)Bt(o,r[n]),a.push(o.length);return new Wn(o,pr.XYZ,a)}},e.prototype.readCurve_=function(t,e){var r=Js([null],this.CURVE_PARSERS_,t,e,this);return r?new ys(r,pr.XYZ):void 0},e.prototype.readEnvelope_=function(t,e){var r=Js([null],this.ENVELOPE_PARSERS_,t,e,this);return je(r[1][0],r[1][1],r[2][0],r[2][1])},e.prototype.readFlatPos_=function(t,e){for(var r,n=Ds(t,!1),i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,o=[];r=i.exec(n);)o.push(parseFloat(r[1])),n=n.substr(r[0].length);if(""===n){var a,s,l=e[0].srsName,c="enu";l&&(c=jr(l).getAxisOrientation());if("neu"===c)for(a=0,s=o.length;a<s;a+=3){var u=o[a],h=o[a+1];o[a]=h,o[a+1]=u}var p=o.length;if(2==p&&o.push(0),0!==p)return o}},e.prototype.readFlatPosList_=function(t,e){var r=Ds(t,!1).replace(/^\s*|\s*$/g,""),n=e[0],i=n.srsName,o=n.srsDimension,a="enu";i&&(a=jr(i).getAxisOrientation());var s,l,c,u=r.split(/\s+/),h=2;t.getAttribute("srsDimension")?h=hl(t.getAttribute("srsDimension")):t.getAttribute("dimension")?h=hl(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?h=hl(t.parentNode.getAttribute("srsDimension")):o&&(h=hl(o));for(var p=[],d=0,f=u.length;d<f;d+=h)s=parseFloat(u[d]),l=parseFloat(u[d+1]),c=3===h?parseFloat(u[d+2]):0,"en"===a.substr(0,2)?p.push(s,l,c):p.push(l,s,c);return p},e.prototype.writePos_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";t.setAttribute("srsDimension",o);var a=n.srsName,s="enu";a&&(s=jr(a).getAxisOrientation());var l,c=e.getCoordinates();(l="en"===s.substr(0,2)?c[0]+" "+c[1]:c[1]+" "+c[0],i)&&(l+=" "+(c[2]||0));ml(t,l)},e.prototype.getCoords_=function(t,e,r){var n="enu";e&&(n=jr(e).getAxisOrientation());var i="en"===n.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];r&&(i+=" "+(t[2]||0));return i},e.prototype.writePosList_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";t.setAttribute("srsDimension",o);for(var a,s=n.srsName,l=e.getCoordinates(),c=l.length,u=new Array(c),h=0;h<c;++h)a=l[h],u[h]=this.getCoords_(a,s,i);ml(t,u.join(" "))},e.prototype.writePoint_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=ks(t.namespaceURI,"pos");t.appendChild(i),this.writePos_(i,e,r)},e.prototype.writeEnvelope=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=[e[0]+" "+e[1],e[2]+" "+e[3]];Qs({node:t},this.ENVELOPE_SERIALIZERS_,zs,i,r,["lowerCorner","upperCorner"],this)},e.prototype.writeLinearRing_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=ks(t.namespaceURI,"posList");t.appendChild(i),this.writePosList_(i,e,r)},e.prototype.RING_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),ks(i.namespaceURI,void 0!==o?"interior":"exterior")},e.prototype.writeSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Qs({node:t,hasZ:i,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===t.nodeName){var s=ks(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,r)}},e.prototype.writeCurveOrLineString_=function(t,e,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==t.nodeName&&n&&t.setAttribute("srsName",n),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var i=ks(t.namespaceURI,"posList");t.appendChild(i),this.writePosList_(i,e,r)}else if("Curve"===t.nodeName){var o=ks(t.namespaceURI,"segments");t.appendChild(o),this.writeCurveSegments_(o,e,r)}},e.prototype.writeMultiSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&t.setAttribute("srsName",o);var s=e.getPolygons();Qs({node:t,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeMultiPoint_=function(t,e,r){var n=r[r.length-1],i=n.srsName,o=n.hasZ;i&&t.setAttribute("srsName",i);var a=e.getPoints();Qs({node:t,hasZ:o,srsName:i},this.POINTMEMBER_SERIALIZERS_,Ys("pointMember"),a,r,void 0,this)},e.prototype.writeMultiCurveOrLineString_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&t.setAttribute("srsName",o);var s=e.getLineStrings();Qs({node:t,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeRing_=function(t,e,r){var n=ks(t.namespaceURI,"LinearRing");t.appendChild(n),this.writeLinearRing_(n,e,r)},e.prototype.writeSurfaceOrPolygonMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r))},e.prototype.writePointMember_=function(t,e,r){var n=ks(t.namespaceURI,"Point");t.appendChild(n),this.writePoint_(n,e,r)},e.prototype.writeLineStringOrCurveMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeCurveOrLineString_(n,e,r))},e.prototype.writeSurfacePatches_=function(t,e,r){var n=ks(t.namespaceURI,"PolygonPatch");t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r)},e.prototype.writeCurveSegments_=function(t,e,r){var n=ks(t.namespaceURI,"LineStringSegment");t.appendChild(n),this.writeCurveOrLineString_(n,e,r)},e.prototype.writeGeometryElement=function(t,e,r){var n,i=r[r.length-1],o=u({},i);o.node=t,n=Array.isArray(e)?i.dataProjection?$r(e,i.featureProjection,i.dataProjection):e:As(e,!0,i),Qs(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},e.prototype.writeFeatureElement=function(t,e,r){var n=e.getId();n&&t.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=e.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=e.getProperties(),l=[],c=[];for(var h in s){var p=s[h];null!==p&&(l.push(h),c.push(p),h==a||"function"==typeof p.getSimplifiedGeometry?h in i.serializers[o]||(i.serializers[o][h]=Hs(this.writeGeometryElement,this)):h in i.serializers[o]||(i.serializers[o][h]=Hs(ml)))}var d=u({},i);d.node=t,Qs(d,i.serializers,Ys(void 0,o),c,r,l)},e.prototype.writeFeatureMembers_=function(t,e,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a={};a[o]={},a[o][i]=Hs(this.writeFeatureElement,this);var s=u({},n);s.node=t,Qs(s,a,Ys(i,o),e,r)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1].node;return ks(this.namespace,vl[n.nodeName])},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,r){var n,i=e[e.length-1],o=i.multiSurface,a=i.surface,s=i.curve,l=i.multiCurve;return Array.isArray(t)?n="Envelope":"MultiPolygon"===(n=t.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"LineString"===n&&!0===s?n="Curve":"MultiLineString"===n&&!0===l&&(n="MultiCurve"),ks(this.namespace,n)},e.prototype.writeGeometryNode=function(t,e){e=this.adaptOptions(e);var r=ks(this.namespace,"geom"),n={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&u(n,e),this.writeGeometryElement(r,t,[n]),r},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=ks(this.namespace,"featureMembers");r.setAttributeNS(Ns,"xsi:schemaLocation",this.schemaLocation);var n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&u(n,e),this.writeFeatureMembers_(r,t,[n]),r},e}(il);Tl.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:js(Tl.prototype.readFlatPos_),posList:js(Tl.prototype.readFlatPosList_)}},Tl.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Tl.prototype.interiorParser_,exterior:Tl.prototype.exteriorParser_}},Tl.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:js(il.prototype.readPoint),MultiPoint:js(il.prototype.readMultiPoint),LineString:js(il.prototype.readLineString),MultiLineString:js(il.prototype.readMultiLineString),LinearRing:js(il.prototype.readLinearRing),Polygon:js(il.prototype.readPolygon),MultiPolygon:js(il.prototype.readMultiPolygon),Surface:js(Tl.prototype.readSurface_),MultiSurface:js(Tl.prototype.readMultiSurface_),Curve:js(Tl.prototype.readCurve_),MultiCurve:js(Tl.prototype.readMultiCurve_),Envelope:js(Tl.prototype.readEnvelope_)}},Tl.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:Us(Tl.prototype.curveMemberParser_),curveMembers:Us(Tl.prototype.curveMemberParser_)}},Tl.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:Us(Tl.prototype.surfaceMemberParser_),surfaceMembers:Us(Tl.prototype.surfaceMemberParser_)}},Tl.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Us(il.prototype.readLineString),Curve:Us(Tl.prototype.readCurve_)}},Tl.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Us(il.prototype.readPolygon),Surface:Us(Tl.prototype.readSurface_)}},Tl.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:js(Tl.prototype.readPatch_)}},Tl.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:js(Tl.prototype.readSegment_)}},Tl.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:Us(Tl.prototype.readFlatPosList_),upperCorner:Us(Tl.prototype.readFlatPosList_)}},Tl.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:js(Tl.prototype.readPolygonPatch_)}},Tl.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:js(Tl.prototype.readLineStringSegment_)}},Tl.prototype.writeFeatures,Tl.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:Hs(Tl.prototype.writeRing_),interior:Hs(Tl.prototype.writeRing_)}},Tl.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Hs(ml),upperCorner:Hs(ml)}},Tl.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Hs(Tl.prototype.writeSurfaceOrPolygonMember_),polygonMember:Hs(Tl.prototype.writeSurfaceOrPolygonMember_)}},Tl.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Hs(Tl.prototype.writePointMember_)}},Tl.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Hs(Tl.prototype.writeLineStringOrCurveMember_),curveMember:Hs(Tl.prototype.writeLineStringOrCurveMember_)}},Tl.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Hs(Tl.prototype.writeCurveOrLineString_),MultiCurve:Hs(Tl.prototype.writeMultiCurveOrLineString_),Point:Hs(Tl.prototype.writePoint_),MultiPoint:Hs(Tl.prototype.writeMultiPoint_),LineString:Hs(Tl.prototype.writeCurveOrLineString_),MultiLineString:Hs(Tl.prototype.writeMultiCurveOrLineString_),LinearRing:Hs(Tl.prototype.writeLinearRing_),Polygon:Hs(Tl.prototype.writeSurfaceOrPolygon_),MultiPolygon:Hs(Tl.prototype.writeMultiSurfaceOrPolygon_),Surface:Hs(Tl.prototype.writeSurfaceOrPolygon_),MultiSurface:Hs(Tl.prototype.writeMultiSurfaceOrPolygon_),Envelope:Hs(Tl.prototype.writeEnvelope)}};var _l=Tl,Sl=_l;Sl.prototype.writeFeatures,Sl.prototype.writeFeaturesNode;var El=Sl,Ll=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],wl={rte:Ql,trk:tc,wpt:ec},bl=Ks(Ll,{rte:Us(Ql),trk:Us(tc),wpt:Us(ec)}),Al=Ks(Ll,{text:Ws(pl,"linkText"),type:Ws(pl,"linkType")}),xl=Ks(Ll,{rte:Hs(function(t,e,r){var n=r[0],i=e.getProperties(),o={node:t};o.properties=i;var a=e.getGeometry();if(a.getType()==hr.LINE_STRING){var s=As(a,!0,n);o.geometryLayout=s.getLayout(),i.rtept=s.getCoordinates()}var l=r[r.length-1].node,c=Bl[l.namespaceURI],u=Xs(i,c);Qs(o,Gl,zs,u,r,c)}),trk:Hs(function(t,e,r){var n=r[0],i=e.getProperties(),o={node:t};o.properties=i;var a=e.getGeometry();if(a.getType()==hr.MULTI_LINE_STRING){var s=As(a,!0,n);i.trkseg=s.getLineStrings()}var l=r[r.length-1].node,c=jl[l.namespaceURI],u=Xs(i,c);Qs(o,ql,zs,u,r,c)}),wpt:Hs(function(t,e,r){var n=r[0],i=r[r.length-1];i.properties=e.getProperties();var o=e.getGeometry();if(o.getType()==hr.POINT){var a=As(o,!0,n);i.geometryLayout=a.getLayout(),nc(t,a.getCoordinates(),r)}})}),Pl=function(t){function e(e){t.call(this);var r=e||{};this.dataProjection=jr("EPSG:4326"),this.readExtensions_=r.readExtensions}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleReadExtensions_=function(t){t||(t=[]);for(var e=0,r=t.length;e<r;++e){var n=t[e];if(this.readExtensions_){var i=n.get("extensionsNode_")||null;this.readExtensions_(n,i)}n.set("extensionsNode_",void 0)}},e.prototype.readFeatureFromNode=function(t,e){if(!kt(Ll,t.namespaceURI))return null;var r=wl[t.localName];if(!r)return null;var n=r(t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_([n]),n):null},e.prototype.readFeaturesFromNode=function(t,e){if(!kt(Ll,t.namespaceURI))return[];if("gpx"==t.localName){var r=Js([],bl,t,[this.getReadOptions(t,e)]);return r?(this.handleReadExtensions_(r),r):[]}return[]},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=ks("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ns),r.setAttributeNS(Ns,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),Qs({node:r},xl,Xl,t,[e]),r},e}(tl),Rl=Ks(Ll,{name:Ws(pl),cmt:Ws(pl),desc:Ws(pl),src:Ws(pl),link:Jl,number:Ws(ul),extensions:Zl,type:Ws(pl),rtept:function(t,e){var r=Js({},Il,t,e);if(r){var n=e[e.length-1];Kl(n.flatCoordinates,n.layoutOptions,t,r)}}}),Il=Ks(Ll,{ele:Ws(ll),time:Ws(sl)}),Ml=Ks(Ll,{name:Ws(pl),cmt:Ws(pl),desc:Ws(pl),src:Ws(pl),link:Jl,number:Ws(ul),type:Ws(pl),extensions:Zl,trkseg:function(t,e){var r=e[e.length-1];$s(Ol,t,e);var n=r.flatCoordinates;r.ends.push(n.length)}}),Ol=Ks(Ll,{trkpt:function(t,e){var r=Js({},Nl,t,e);if(r){var n=e[e.length-1];Kl(n.flatCoordinates,n.layoutOptions,t,r)}}}),Nl=Ks(Ll,{ele:Ws(ll),time:Ws(sl)}),kl=Ks(Ll,{ele:Ws(ll),time:Ws(sl),magvar:Ws(ll),geoidheight:Ws(ll),name:Ws(pl),cmt:Ws(pl),desc:Ws(pl),src:Ws(pl),link:Jl,sym:Ws(pl),type:Ws(pl),fix:Ws(pl),sat:Ws(ul),hdop:Ws(ll),vdop:Ws(ll),pdop:Ws(ll),ageofdgpsdata:Ws(ll),dgpsid:Ws(ul),extensions:Zl}),Dl=["text","type"],Fl=Ks(Ll,{text:Hs(ml),type:Hs(ml)}),Bl=Ks(Ll,["name","cmt","desc","src","link","number","type","rtept"]),Gl=Ks(Ll,{name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),number:Hs(yl),type:Hs(ml),rtept:Vs(Hs(nc))}),Ul=Ks(Ll,["ele","time"]),jl=Ks(Ll,["name","cmt","desc","src","link","number","type","trkseg"]),ql=Ks(Ll,{name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),number:Hs(yl),type:Hs(ml),trkseg:Vs(Hs(function(t,e,r){var n={node:t};n.geometryLayout=e.getLayout(),n.properties={},Qs(n,Hl,Wl,e.getCoordinates(),r)}))}),Wl=Ys("trkpt"),Hl=Ks(Ll,{trkpt:Hs(nc)}),Vl=Ks(Ll,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Yl=Ks(Ll,{ele:Hs(gl),time:Hs(function(t,e){var r=new Date(1e3*e),n=r.getUTCFullYear()+"-"+Ce(r.getUTCMonth()+1,2)+"-"+Ce(r.getUTCDate(),2)+"T"+Ce(r.getUTCHours(),2)+":"+Ce(r.getUTCMinutes(),2)+":"+Ce(r.getUTCSeconds(),2)+"Z";t.appendChild(Os.createTextNode(n))}),magvar:Hs(gl),geoidheight:Hs(gl),name:Hs(ml),cmt:Hs(ml),desc:Hs(ml),src:Hs(ml),link:Hs(rc),sym:Hs(ml),type:Hs(ml),fix:Hs(ml),sat:Hs(yl),hdop:Hs(gl),vdop:Hs(gl),pdop:Hs(gl),ageofdgpsdata:Hs(gl),dgpsid:Hs(yl)}),zl={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Xl(t,e,r){var n=t.getGeometry();if(n){var i=zl[n.getType()];if(i)return ks(e[e.length-1].node.namespaceURI,i)}}function Kl(t,e,r,n){return t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in n?(t.push(n.ele),delete n.ele,e.hasZ=!0):t.push(0),"time"in n?(t.push(n.time),delete n.time,e.hasM=!0):t.push(0),t}function $l(t,e,r){var n=pr.XY,i=2;if(t.hasZ&&t.hasM?(n=pr.XYZM,i=4):t.hasZ?(n=pr.XYZ,i=3):t.hasM&&(n=pr.XYM,i=3),4!==i){for(var o=0,a=e.length/4;o<a;o++)e[o*i]=e[4*o],e[o*i+1]=e[4*o+1],t.hasZ&&(e[o*i+2]=e[4*o+2]),t.hasM&&(e[o*i+2]=e[4*o+3]);if(e.length=e.length/4*i,r)for(var s=0,l=r.length;s<l;s++)r[s]=r[s]/4*i}return n}function Jl(t,e){var r=e[e.length-1],n=t.getAttribute("href");null!==n&&(r.link=n),$s(Al,t,e)}function Zl(t,e){e[e.length-1].extensionsNode_=t}function Ql(t,e){var r=e[0],n=Js({flatCoordinates:[],layoutOptions:{}},Rl,t,e);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.layoutOptions;delete n.layoutOptions;var a=$l(o,i),s=new ys(i,a);As(s,!1,r);var l=new ps(s);return l.setProperties(n),l}}function tc(t,e){var r=e[0],n=Js({flatCoordinates:[],ends:[],layoutOptions:{}},Ml,t,e);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.ends;delete n.ends;var a=n.layoutOptions;delete n.layoutOptions;var s=$l(a,i,o),l=new ms(i,s,o);As(l,!1,r);var c=new ps(l);return c.setProperties(n),c}}function ec(t,e){var r=e[0],n=Js({},kl,t,e);if(n){var i={},o=Kl([],i,t,n),a=$l(i,o),s=new Pn(o,a);As(s,!1,r);var l=new ps(s);return l.setProperties(n),l}}function rc(t,e,r){t.setAttribute("href",e);var n=r[r.length-1].properties,i=[n.linkText,n.linkType];Qs({node:t},Fl,zs,i,r,Dl)}function nc(t,e,r){var n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case pr.XYZM:0!==e[3]&&(o.time=e[3]);case pr.XYZ:0!==e[2]&&(o.ele=e[2]);break;case pr.XYM:0!==e[2]&&(o.time=e[2])}var a="rtept"==t.nodeName?Ul[i]:Vl[i],s=Xs(o,a);Qs({node:t,properties:o},Yl,zs,s,r,a)}var ic=Pl,oc=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.checksum_=void 0};oc.prototype.clone=function(){var t=this.getColor();return new oc({color:Array.isArray(t)?t.slice():t||void 0})},oc.prototype.getColor=function(){return this.color_},oc.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},oc.prototype.getChecksum=function(){if(void 0===this.checksum_){var t=this.color_;t?Array.isArray(t)||"string"==typeof t?this.checksum_="f"+Go(t):this.checksum_=o(this.color_):this.checksum_="f-"}return this.checksum_};var ac=oc,sc={FRACTION:"fraction",PIXELS:"pixels"},lc=function(t){function e(e,r,n,i,o,a){t.call(this),this.hitDetectionImage_=null,this.image_=e||new Image,null!==i&&(this.image_.crossOrigin=i),this.canvas_=a?document.createElement("canvas"):null,this.color_=a,this.imageListenerKeys_=null,this.imageState_=o,this.size_=n,this.src_=r,this.tainted_}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===fo.LOADED){this.tainted_=!1;var t=Kn(1,1);try{t.drawImage(this.image_,0,0),t.getImageData(0,0,1,1)}catch(t){this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(I.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=fo.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=fo.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.replaceColor_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],r=this.size_[1],n=Kn(e,r);n.fillRect(0,0,e,r),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==fo.IDLE){this.imageState_=fo.LOADING,this.imageListenerKeys_=[v(this.image_,I.ERROR,this.handleImageError_,this),v(this.image_,I.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}},e.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),r=e.data,n=this.color_[0]/255,i=this.color_[1]/255,o=this.color_[2]/255,a=0,s=r.length;a<s;a+=4)r[a]*=n,r[a+1]*=i,r[a+2]*=o;t.putImageData(e,0,0)}},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(R),cc={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},uc=function(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale};uc.prototype.clone=function(){return new uc({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},uc.prototype.getOpacity=function(){return this.opacity_},uc.prototype.getRotateWithView=function(){return this.rotateWithView_},uc.prototype.getRotation=function(){return this.rotation_},uc.prototype.getScale=function(){return this.scale_},uc.prototype.getSnapToPixel=function(){return!1},uc.prototype.getAnchor=function(){return n()},uc.prototype.getImage=function(t){return n()},uc.prototype.getHitDetectionImage=function(t){return n()},uc.prototype.getImageState=function(){return n()},uc.prototype.getImageSize=function(){return n()},uc.prototype.getHitDetectionImageSize=function(){return n()},uc.prototype.getOrigin=function(){return n()},uc.prototype.getSize=function(){return n()},uc.prototype.setOpacity=function(t){this.opacity_=t},uc.prototype.setRotateWithView=function(t){this.rotateWithView_=t},uc.prototype.setRotation=function(t){this.rotation_=t},uc.prototype.setScale=function(t){this.scale_=t},uc.prototype.setSnapToPixel=function(t){},uc.prototype.listenImageChange=function(t,e){return n()},uc.prototype.load=function(){n()},uc.prototype.unlistenImageChange=function(t,e){n()};var hc=uc,pc=function(t){function e(e){var r=e||{},n=void 0!==r.opacity?r.opacity:1,i=void 0!==r.rotation?r.rotation:0,a=void 0!==r.scale?r.scale:1,s=void 0!==r.rotateWithView&&r.rotateWithView;t.call(this,{opacity:n,rotation:i,scale:a,rotateWithView:s}),this.anchor_=void 0!==r.anchor?r.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:cc.TOP_LEFT,this.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:sc.FRACTION,this.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:sc.FRACTION,this.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var l=void 0!==r.img?r.img:null,c=void 0!==r.imgSize?r.imgSize:null,u=r.src;te(!(void 0!==u&&l),4),te(!l||l&&c,5),void 0!==u&&0!==u.length||!l||(u=l.src||o(l)),te(void 0!==u&&u.length>0,6);var h=void 0!==r.src?fo.IDLE:fo.LOADED;this.color_=void 0!==r.color?jo(r.color):null,this.iconImage_=function(t,e,r,n,i,o){var a=$o.get(e,n,o);return a||(a=new lc(t,e,r,n,i,o),$o.set(e,n,o,a)),a}(l,u,c,this.crossOrigin_,h,this.color_),this.offset_=void 0!==r.offset?r.offset:[0,0],this.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:cc.TOP_LEFT,this.origin_=null,this.size_=void 0!==r.size?r.size:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==sc.FRACTION||this.anchorYUnits_==sc.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==sc.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==sc.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=cc.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=cc.TOP_RIGHT&&this.anchorOrigin_!=cc.BOTTOM_RIGHT||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=cc.BOTTOM_LEFT&&this.anchorOrigin_!=cc.BOTTOM_RIGHT||(t[1]=-t[1]+e[1])}return this.normalizedAnchor_=t,this.normalizedAnchor_},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=cc.TOP_LEFT){var e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),this.offsetOrigin_!=cc.TOP_RIGHT&&this.offsetOrigin_!=cc.BOTTOM_RIGHT||(t[0]=r[0]-e[0]-t[0]),this.offsetOrigin_!=cc.BOTTOM_LEFT&&this.offsetOrigin_!=cc.BOTTOM_RIGHT||(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t,e){return C(this.iconImage_,I.CHANGE,t,e)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t,e){T(this.iconImage_,I.CHANGE,t,e)},e}(hc),dc=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width,this.checksum_=void 0};dc.prototype.clone=function(){var t=this.getColor();return new dc({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},dc.prototype.getColor=function(){return this.color_},dc.prototype.getLineCap=function(){return this.lineCap_},dc.prototype.getLineDash=function(){return this.lineDash_},dc.prototype.getLineDashOffset=function(){return this.lineDashOffset_},dc.prototype.getLineJoin=function(){return this.lineJoin_},dc.prototype.getMiterLimit=function(){return this.miterLimit_},dc.prototype.getWidth=function(){return this.width_},dc.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},dc.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},dc.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},dc.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},dc.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},dc.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},dc.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},dc.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=o(this.color_):this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_};var fc=dc,gc=function(t){function e(e){var r=void 0!==e.rotateWithView&&e.rotateWithView;t.call(this,{opacity:1,rotateWithView:r,rotation:void 0!==e.rotation?e.rotation:0,scale:1}),this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=void 0!==e.radius?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=e.atlasManager,this.render_(this.atlasManager_)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},e.prototype.getImage=function(t){return this.canvas_},e.prototype.getImageSize=function(){return this.imageSize_},e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.prototype.getImageState=function(){return fo.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t,e){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t,e){},e.prototype.render_=function(t){var e,r,n="",i="",o=0,a=null,s=0,l=0;this.stroke_&&(null===(r=this.stroke_.getColor())&&(r=So),r=Ho(r),void 0===(l=this.stroke_.getWidth())&&(l=1),a=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),X||(a=null,s=0),void 0===(i=this.stroke_.getLineJoin())&&(i="round"),void 0===(n=this.stroke_.getLineCap())&&(n="round"),void 0===(o=this.stroke_.getMiterLimit())&&(o=10));var c=2*(this.radius_+l)+1,u={strokeStyle:r,strokeWidth:l,size:c,lineCap:n,lineDash:a,lineDashOffset:s,lineJoin:i,miterLimit:o};if(void 0===t){var h=Kn(c,c);this.canvas_=h.canvas,e=c=this.canvas_.width,this.draw_(u,h,0,0),this.createHitDetectionCanvas_(u)}else{c=Math.round(c);var p,d=!this.fill_;d&&(p=this.drawHitDetectionCanvas_.bind(this,u));var f=this.getChecksum(),g=t.add(f,c,c,this.draw_.bind(this,u),p);this.canvas_=g.image,this.origin_=[g.offsetX,g.offsetY],e=g.image.width,d?(this.hitDetectionCanvas_=g.hitImage,this.hitDetectionImageSize_=[g.hitImage.width,g.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[e,e])}this.anchor_=[c/2,c/2],this.size_=[c,c],this.imageSize_=[e,e]},e.prototype.draw_=function(t,e,r,n){var i,o,a;e.setTransform(1,0,0,1,0,0),e.translate(r,n),e.beginPath();var s=this.points_;if(s===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var l=void 0!==this.radius2_?this.radius2_:this.radius_;for(l!==this.radius_&&(s*=2),i=0;i<=s;i++)o=2*i*Math.PI/s-Math.PI/2+this.angle_,a=i%2==0?this.radius_:l,e.lineTo(t.size/2+a*Math.cos(o),t.size/2+a*Math.sin(o))}if(this.fill_){var c=this.fill_.getColor();null===c&&(c=To),e.fillStyle=Ho(c),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},e.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var e=Kn(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e,0,0)}},e.prototype.drawHitDetectionCanvas_=function(t,e,r,n){e.setTransform(1,0,0,1,0,0),e.translate(r,n),e.beginPath();var i=this.points_;if(i===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o,a,s,l=void 0!==this.radius2_?this.radius2_:this.radius_;for(l!==this.radius_&&(i*=2),o=0;o<=i;o++)s=2*o*Math.PI/i-Math.PI/2+this.angle_,a=o%2==0?this.radius_:l,e.lineTo(t.size/2+a*Math.cos(s),t.size/2+a*Math.sin(s))}e.fillStyle=Go(To),e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()},e.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var r="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[r,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},e}(hc),yc=function(t){function e(e){var r=e||{};t.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,atlasManager:r.atlasManager})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.setRadius=function(t){this.radius_=t,this.render_(this.atlasManager_)},e}(gc),mc=function(t){var e=t||{};this.geometry_=null,this.geometryFunction_=_c,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex};mc.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new mc({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},mc.prototype.getRenderer=function(){return this.renderer_},mc.prototype.setRenderer=function(t){this.renderer_=t},mc.prototype.getGeometry=function(){return this.geometry_},mc.prototype.getGeometryFunction=function(){return this.geometryFunction_},mc.prototype.getFill=function(){return this.fill_},mc.prototype.setFill=function(t){this.fill_=t},mc.prototype.getImage=function(){return this.image_},mc.prototype.setImage=function(t){this.image_=t},mc.prototype.getStroke=function(){return this.stroke_},mc.prototype.setStroke=function(t){this.stroke_=t},mc.prototype.getText=function(){return this.text_},mc.prototype.setText=function(t){this.text_=t},mc.prototype.getZIndex=function(){return this.zIndex_},mc.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=_c,this.geometry_=t},mc.prototype.setZIndex=function(t){this.zIndex_=t};var Cc=null;function vc(t,e){if(!Cc){var r=new ac({color:"rgba(255,255,255,0.4)"}),n=new fc({color:"#3399CC",width:1.25});Cc=[new mc({image:new yc({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return Cc}function Tc(){var t={},e=[255,255,255,1],r=[0,153,255,1];return t[hr.POLYGON]=[new mc({fill:new ac({color:[255,255,255,.5]})})],t[hr.MULTI_POLYGON]=t[hr.POLYGON],t[hr.LINE_STRING]=[new mc({stroke:new fc({color:e,width:5})}),new mc({stroke:new fc({color:r,width:3})})],t[hr.MULTI_LINE_STRING]=t[hr.LINE_STRING],t[hr.CIRCLE]=t[hr.POLYGON].concat(t[hr.LINE_STRING]),t[hr.POINT]=[new mc({image:new yc({radius:6,fill:new ac({color:r}),stroke:new fc({color:e,width:1.5})}),zIndex:1/0})],t[hr.MULTI_POINT]=t[hr.POINT],t[hr.GEOMETRY_COLLECTION]=t[hr.POLYGON].concat(t[hr.LINE_STRING],t[hr.POINT]),t}function _c(t){return t.getGeometry()}var Sc=mc,Ec=function(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new ac({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding};Ec.prototype.clone=function(){return new Ec({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})},Ec.prototype.getOverflow=function(){return this.overflow_},Ec.prototype.getFont=function(){return this.font_},Ec.prototype.getMaxAngle=function(){return this.maxAngle_},Ec.prototype.getPlacement=function(){return this.placement_},Ec.prototype.getOffsetX=function(){return this.offsetX_},Ec.prototype.getOffsetY=function(){return this.offsetY_},Ec.prototype.getFill=function(){return this.fill_},Ec.prototype.getRotateWithView=function(){return this.rotateWithView_},Ec.prototype.getRotation=function(){return this.rotation_},Ec.prototype.getScale=function(){return this.scale_},Ec.prototype.getStroke=function(){return this.stroke_},Ec.prototype.getText=function(){return this.text_},Ec.prototype.getTextAlign=function(){return this.textAlign_},Ec.prototype.getTextBaseline=function(){return this.textBaseline_},Ec.prototype.getBackgroundFill=function(){return this.backgroundFill_},Ec.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},Ec.prototype.getPadding=function(){return this.padding_},Ec.prototype.setOverflow=function(t){this.overflow_=t},Ec.prototype.setFont=function(t){this.font_=t},Ec.prototype.setMaxAngle=function(t){this.maxAngle_=t},Ec.prototype.setOffsetX=function(t){this.offsetX_=t},Ec.prototype.setOffsetY=function(t){this.offsetY_=t},Ec.prototype.setPlacement=function(t){this.placement_=t},Ec.prototype.setFill=function(t){this.fill_=t},Ec.prototype.setRotation=function(t){this.rotation_=t},Ec.prototype.setScale=function(t){this.scale_=t},Ec.prototype.setStroke=function(t){this.stroke_=t},Ec.prototype.setText=function(t){this.text_=t},Ec.prototype.setTextAlign=function(t){this.textAlign_=t},Ec.prototype.setTextBaseline=function(t){this.textBaseline_=t},Ec.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},Ec.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},Ec.prototype.setPadding=function(t){this.padding_=t};var Lc,wc,bc,Ac,xc,Pc,Rc,Ic,Mc,Oc=Ec,Nc=["http://www.google.com/kml/ext/2.2"],kc=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Dc={fraction:sc.FRACTION,pixels:sc.PIXELS,insetPixels:sc.PIXELS},Fc=Ks(kc,{ExtendedData:xu,Region:Pu,MultiGeometry:Ws(vu,"geometry"),LineString:Ws(yu,"geometry"),LinearRing:Ws(mu,"geometry"),Point:Ws(Tu,"geometry"),Polygon:Ws(Su,"geometry"),Style:Ws(Lu),StyleMap:function(t,e){var r=ru(t,e);if(r){var n=e[e.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:te(!1,38)}},address:Ws(pl),description:Ws(pl),name:Ws(pl),open:Ws(ol),phoneNumber:Ws(pl),styleUrl:Ws(Qc),visibility:Ws(ol)},Ks(Nc,{MultiTrack:Ws(function(t,e){var r=Js([],cu,t,e);if(r)return new ms(r)},"geometry"),Track:Ws(hu,"geometry")})),Bc=Ks(kc,{ExtendedData:xu,Region:Pu,Link:function(t,e){$s(Gc,t,e)},address:Ws(pl),description:Ws(pl),name:Ws(pl),open:Ws(ol),phoneNumber:Ws(pl),visibility:Ws(ol)}),Gc=Ks(kc,{href:Ws(Qc)}),Uc=Ks(kc,{LatLonAltBox:function(t,e){var r=Js({},Mu,t,e);if(r){var n=e[e.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)}},Lod:function(t,e){var r=Js({},Ou,t,e);if(r){var n=e[e.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}}),jc=Ks(kc,["Document","Placemark"]),qc=Ks(kc,{Document:Hs(function(t,e,r){Qs({node:t},Bu,Gu,e,r,void 0,this)}),Placemark:Hs(ch)}),Wc=null,Hc=null,Vc=null,Yc=null,zc=null,Xc=null,Kc=function(t){function e(e){t.call(this);var r=e||{};Xc||(Wc=new ac({color:Lc=[255,255,255,1]}),wc=[20,2],bc=sc.PIXELS,Ac=sc.PIXELS,xc=[64,64],Pc="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Rc=.5,Hc=new pc({anchor:wc,anchorOrigin:cc.BOTTOM_LEFT,anchorXUnits:bc,anchorYUnits:Ac,crossOrigin:"anonymous",rotation:0,scale:Rc,size:xc,src:Pc}),Ic="NO_IMAGE",Vc=new fc({color:Lc,width:1}),Mc=new fc({color:[51,51,51,1],width:2}),Yc=new Oc({font:"bold 16px Helvetica",fill:Wc,stroke:Mc,scale:.8}),zc=new Sc({fill:Wc,image:Hc,text:Yc,stroke:Vc,zIndex:0}),Xc=[zc]),this.dataProjection=jr("EPSG:4326"),this.defaultStyle_=r.defaultStyle?r.defaultStyle:Xc,this.extractStyles_=void 0===r.extractStyles||r.extractStyles,this.writeStyles_=void 0===r.writeStyles||r.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===r.showPointNames||r.showPointNames}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readDocumentOrFolder_=function(t,e){return Js([],Ks(kc,{Document:Gs(this.readDocumentOrFolder_,this),Folder:Gs(this.readDocumentOrFolder_,this),Placemark:Us(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this)||void 0},e.prototype.readPlacemark_=function(t,e){var r=Js({geometry:null},Fc,t,e);if(r){var n=new ps,i=t.getAttribute("id");null!==i&&n.setId(i);var o=e[0],a=r.geometry;if(a&&As(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){var s=function(t,e,r,n,i){return function(o,a){var s,l=i,c="";if(l){var u=o.getGeometry();u&&(l=u.getType()===hr.POINT)}if(l&&(c=o.get("name"),l=l&&!!c),t)return l?(s=$c(t[0],c),t.concat(s)):t;if(e){var h=function t(e,r,n){return Array.isArray(e)?e:"string"==typeof e?(!(e in n)&&"#"+e in n&&(e="#"+e),t(n[e],r,n)):r}(e,r,n);return l?(s=$c(h[0],c),h.concat(s)):h}return l?(s=$c(r[0],c),r.concat(s)):r}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(s)}return delete r.Style,n.setProperties(r),n}},e.prototype.readSharedStyle_=function(t,e){var r=t.getAttribute("id");if(null!==r){var n=Lu(t,e);if(n){var i,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href),i=o?new URL("#"+r,o).href:"#"+r;this.sharedStyles_[i]=n}}},e.prototype.readSharedStyleMap_=function(t,e){var r=t.getAttribute("id");if(null!==r){var n=ru(t,e);if(n){var i,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href),i=o?new URL("#"+r,o).href:"#"+r;this.sharedStyles_[i]=n}}},e.prototype.readFeatureFromNode=function(t,e){return kt(kc,t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null},e.prototype.readFeaturesFromNode=function(t,e){if(!kt(kc,t.namespaceURI))return[];var r,n=t.localName;if("Document"==n||"Folder"==n)return(r=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==n){var i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i?[i]:[]}if("kml"==n){r=[];for(var o=t.firstElementChild;o;o=o.nextElementSibling){var a=this.readFeaturesFromNode(o,e);a&&Bt(r,a)}return r}return[]},e.prototype.readName=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readNameFromDocument(e)}return Fs(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}},e.prototype.readNameFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(e);if(r)return r}},e.prototype.readNameFromNode=function(t){for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(kt(kc,e.namespaceURI)&&"name"==e.localName)return pl(e);for(var r=t.firstElementChild;r;r=r.nextElementSibling){var n=r.localName;if(kt(kc,r.namespaceURI)&&("Document"==n||"Folder"==n||"Placemark"==n||"kml"==n)){var i=this.readNameFromNode(r);if(i)return i}}},e.prototype.readNetworkLinks=function(t){var e=[];if("string"==typeof t){var r=Bs(t);Bt(e,this.readNetworkLinksFromDocument(r))}else Fs(t)?Bt(e,this.readNetworkLinksFromDocument(t)):Bt(e,this.readNetworkLinksFromNode(t));return e},e.prototype.readNetworkLinksFromDocument=function(t){for(var e=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Bt(e,this.readNetworkLinksFromNode(r));return e},e.prototype.readNetworkLinksFromNode=function(t){for(var e=[],r=t.firstElementChild;r;r=r.nextElementSibling)if(kt(kc,r.namespaceURI)&&"NetworkLink"==r.localName){var n=Js({},Bc,r,[]);e.push(n)}for(var i=t.firstElementChild;i;i=i.nextElementSibling){var o=i.localName;!kt(kc,i.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||Bt(e,this.readNetworkLinksFromNode(i))}return e},e.prototype.readRegion=function(t){var e=[];if("string"==typeof t){var r=Bs(t);Bt(e,this.readRegionFromDocument(r))}else Fs(t)?Bt(e,this.readRegionFromDocument(t)):Bt(e,this.readRegionFromNode(t));return e},e.prototype.readRegionFromDocument=function(t){for(var e=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&Bt(e,this.readRegionFromNode(r));return e},e.prototype.readRegionFromNode=function(t){for(var e=[],r=t.firstElementChild;r;r=r.nextElementSibling)if(kt(kc,r.namespaceURI)&&"Region"==r.localName){var n=Js({},Uc,r,[]);e.push(n)}for(var i=t.firstElementChild;i;i=i.nextElementSibling){var o=i.localName;!kt(kc,i.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||Bt(e,this.readRegionFromNode(i))}return e},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var r=ks(kc[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",Nc[0]),r.setAttributeNS(n,"xmlns:xsi",Ns),r.setAttributeNS(Ns,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var i={node:r},o={};t.length>1?o.Document=t:1==t.length&&(o.Placemark=t[0]);var a=jc[r.namespaceURI],s=Xs(o,a);return Qs(i,qc,zs,s,[e],a,this),r},e}(tl);function $c(t,e){var r=null,n=[0,0],i="start";if(t.getImage()){var o=t.getImage().getImageSize();if(null===o&&(o=xc),2==o.length){var a=t.getImage().getScale();n[0]=a*o[0]/2,n[1]=-a*o[1]/2,i="left"}}if(null!==t.getText()){var s=t.getText();(r=s.clone()).setFont(s.getFont()||Yc.getFont()),r.setScale(s.getScale()||Yc.getScale()),r.setFill(s.getFill()||Yc.getFill()),r.setStroke(s.getStroke()||Mc)}else r=Yc.clone();return r.setText(e),r.setOffsetX(n[0]),r.setOffsetY(n[1]),r.setTextAlign(i),new Sc({text:r})}function Jc(t){var e=Ds(t,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(r){var n=r[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function Zc(t){for(var e,r=Ds(t,!1),n=[],i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;e=i.exec(r);){var o=parseFloat(e[1]),a=parseFloat(e[2]),s=e[3]?parseFloat(e[3]):0;n.push(o,a,s),r=r.substr(e[0].length)}if(""===r)return n}function Qc(t){var e=Ds(t,!1).trim(),r=t.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(e,r).href:e}function tu(t){return ll(t)}var eu=Ks(kc,{Pair:function(t,e){var r=Js({},Ru,t,e);if(r){var n=r.key;if(n&&"normal"==n){var i=r.styleUrl;i&&(e[e.length-1]=i);var o=r.Style;o&&(e[e.length-1]=o)}}}});function ru(t,e){return Js(void 0,eu,t,e)}var nu=Ks(kc,{Icon:Ws(function(t,e){return Js({},pu,t,e)||null}),heading:Ws(ll),hotSpot:Ws(function(t){var e,r=t.getAttribute("xunits"),n=t.getAttribute("yunits");return e="insetPixels"!==r?"insetPixels"!==n?cc.BOTTOM_LEFT:cc.TOP_LEFT:"insetPixels"!==n?cc.BOTTOM_RIGHT:cc.TOP_RIGHT,{x:parseFloat(t.getAttribute("x")),xunits:Dc[r],y:parseFloat(t.getAttribute("y")),yunits:Dc[n],origin:e}}),scale:Ws(tu)}),iu=Ks(kc,{color:Ws(Jc),scale:Ws(tu)}),ou=Ks(kc,{color:Ws(Jc),width:Ws(ll)}),au=Ks(kc,{color:Ws(Jc),fill:Ws(ol),outline:Ws(ol)}),su=Ks(kc,{coordinates:js(Zc)});function lu(t,e){return Js(null,su,t,e)}var cu=Ks(Nc,{Track:Us(hu)}),uu=Ks(kc,{when:function(t,e){var r=e[e.length-1].whens,n=Ds(t,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},Ks(Nc,{coord:function(t,e){var r=e[e.length-1].flatCoordinates,n=Ds(t,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){var o=parseFloat(i[1]),a=parseFloat(i[2]),s=parseFloat(i[3]);r.push(o,a,s,0)}else r.push(0,0,0,0)}}));function hu(t,e){var r=Js({flatCoordinates:[],whens:[]},uu,t,e);if(r){for(var n=r.flatCoordinates,i=r.whens,o=0,a=Math.min(n.length,i.length);o<a;++o)n[4*o+3]=i[o];return new ys(n,pr.XYZM)}}var pu=Ks(kc,{href:Ws(Qc)},Ks(Nc,{x:Ws(ll),y:Ws(ll),w:Ws(ll),h:Ws(ll)})),du=Ks(kc,{coordinates:js(Zc)});function fu(t,e){return Js(null,du,t,e)}var gu=Ks(kc,{extrude:Ws(ol),tessellate:Ws(ol),altitudeMode:Ws(pl)});function yu(t,e){var r=Js({},gu,t,e),n=fu(t,e);if(n){var i=new ys(n,pr.XYZ);return i.setProperties(r),i}}function mu(t,e){var r=Js({},gu,t,e),n=fu(t,e);if(n){var i=new Wn(n,pr.XYZ,[n.length]);return i.setProperties(r),i}}var Cu=Ks(kc,{LineString:Us(yu),LinearRing:Us(mu),MultiGeometry:Us(vu),Point:Us(Tu),Polygon:Us(Su)});function vu(t,e){var r,n=Js([],Cu,t,e);if(!n)return null;if(0===n.length)return new Ss(n);for(var i,o,a=!0,s=n[0].getType(),l=1,c=n.length;l<c;++l)if(n[l].getType()!=s){a=!1;break}if(a)if(s==hr.POINT){var u=n[0];i=u.getLayout(),o=u.getFlatCoordinates();for(var h=1,p=n.length;h<p;++h)Bt(o,n[h].getFlatCoordinates());wu(r=new ds(o,i),n)}else s==hr.LINE_STRING?wu(r=new ms(n),n):s==hr.POLYGON?wu(r=new Cs(n),n):s==hr.GEOMETRY_COLLECTION?r=new Ss(n):te(!1,37);else r=new Ss(n);return r}function Tu(t,e){var r=Js({},gu,t,e),n=fu(t,e);if(n){var i=new Pn(n,pr.XYZ);return i.setProperties(r),i}}var _u=Ks(kc,{innerBoundaryIs:function(t,e){var r=Js(void 0,Nu,t,e);if(r){e[e.length-1].push(r)}},outerBoundaryIs:function(t,e){var r=Js(void 0,ku,t,e);if(r){e[e.length-1][0]=r}}});function Su(t,e){var r=Js({},gu,t,e),n=Js([null],_u,t,e);if(n&&n[0]){for(var i=n[0],o=[i.length],a=1,s=n.length;a<s;++a)Bt(i,n[a]),o.push(i.length);var l=new Wn(i,pr.XYZ,o);return l.setProperties(r),l}}var Eu=Ks(kc,{IconStyle:function(t,e){var r=Js({},nu,t,e);if(r){var n,i,o,a,s=e[e.length-1],l="Icon"in r?r.Icon:{},c=!("Icon"in r)||Object.keys(l).length>0,u=l.href;u?n=u:c&&(n=Pc);var h,p=cc.BOTTOM_LEFT,d=r.hotSpot;d?(i=[d.x,d.y],o=d.xunits,a=d.yunits,p=d.origin):n===Pc?(i=wc,o=bc,a=Ac):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(n)&&(i=[.5,0],o=sc.FRACTION,a=sc.FRACTION);var f,g=l.x,y=l.y;void 0!==g&&void 0!==y&&(h=[g,y]);var m,C=l.w,v=l.h;void 0!==C&&void 0!==v&&(f=[C,v]);var T=r.heading;void 0!==T&&(m=ce(T));var _=r.scale;if(c){n==Pc&&(f=xc,void 0===_&&(_=Rc));var S=new pc({anchor:i,anchorOrigin:p,anchorXUnits:o,anchorYUnits:a,crossOrigin:"anonymous",offset:h,offsetOrigin:cc.BOTTOM_LEFT,rotation:m,scale:_,size:f,src:n});s.imageStyle=S}else s.imageStyle=Ic}},LabelStyle:function(t,e){var r=Js({},iu,t,e);if(r){var n=e[e.length-1],i=new Oc({fill:new ac({color:"color"in r?r.color:Lc}),scale:r.scale});n.textStyle=i}},LineStyle:function(t,e){var r=Js({},ou,t,e);if(r){var n=e[e.length-1],i=new fc({color:"color"in r?r.color:Lc,width:"width"in r?r.width:1});n.strokeStyle=i}},PolyStyle:function(t,e){var r=Js({},au,t,e);if(r){var n=e[e.length-1],i=new ac({color:"color"in r?r.color:Lc});n.fillStyle=i;var o=r.fill;void 0!==o&&(n.fill=o);var a=r.outline;void 0!==a&&(n.outline=a)}}});function Lu(t,e){var r=Js({},Eu,t,e);if(!r)return null;var n,i="fillStyle"in r?r.fillStyle:Wc,o=r.fill;void 0===o||o||(i=null),"imageStyle"in r?r.imageStyle!=Ic&&(n=r.imageStyle):n=Hc;var a="textStyle"in r?r.textStyle:Yc,s="strokeStyle"in r?r.strokeStyle:Vc,l=r.outline;return void 0===l||l||(s=null),[new Sc({fill:i,image:n,stroke:s,text:a,zIndex:void 0})]}function wu(t,e){var r,n,i,o=e.length,a=new Array(e.length),s=new Array(e.length),l=new Array(e.length);r=n=i=!1;for(var c=0;c<o;++c){var u=e[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),r=r||void 0!==a[c],n=n||void 0!==s[c],i=i||l[c]}r&&t.set("extrude",a),n&&t.set("tessellate",s),i&&t.set("altitudeMode",l)}var bu=Ks(kc,{displayName:Ws(pl),value:Ws(pl)}),Au=Ks(kc,{Data:function(t,e){var r=t.getAttribute("name");$s(bu,t,e);var n=e[e.length-1];null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(t,e){$s(Iu,t,e)}});function xu(t,e){$s(Au,t,e)}function Pu(t,e){$s(Uc,t,e)}var Ru=Ks(kc,{Style:Ws(Lu),key:Ws(pl),styleUrl:Ws(Qc)}),Iu=Ks(kc,{SimpleData:function(t,e){var r=t.getAttribute("name");if(null!==r){var n=pl(t);e[e.length-1][r]=n}}}),Mu=Ks(kc,{altitudeMode:Ws(pl),minAltitude:Ws(ll),maxAltitude:Ws(ll),north:Ws(ll),south:Ws(ll),east:Ws(ll),west:Ws(ll)}),Ou=Ks(kc,{minLodPixels:Ws(ll),maxLodPixels:Ws(ll),minFadeExtent:Ws(ll),maxFadeExtent:Ws(ll)}),Nu=Ks(kc,{LinearRing:js(lu)}),ku=Ks(kc,{LinearRing:js(lu)});function Du(t,e){for(var r=jo(e),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],i=0;i<4;++i){var o=Math.floor(n[i]).toString(16);n[i]=1==o.length?"0"+o:o}ml(t,n.join(""))}var Fu=Ks(kc,{Data:Hs(function(t,e,r){t.setAttribute("name",e.name);var n={node:t},i=e.value;"object"==typeof i?(null!==i&&i.displayName&&Qs(n,Fu,zs,[i.displayName],r,["displayName"]),null!==i&&i.value&&Qs(n,Fu,zs,[i.value],r,["value"])):Qs(n,Fu,zs,[i],r,["value"])}),value:Hs(function(t,e){ml(t,e)}),displayName:Hs(function(t,e){fl(t,e)})}),Bu=Ks(kc,{Placemark:Hs(ch)}),Gu=function(t,e,r){return ks(e[e.length-1].node.namespaceURI,"Placemark")},Uu=Ys("Data"),ju=Ks(kc,["href"],Ks(Nc,["x","y","w","h"])),qu=Ks(kc,{href:Hs(ml)},Ks(Nc,{x:Hs(gl),y:Hs(gl),w:Hs(gl),h:Hs(gl)})),Wu=function(t,e,r){return ks(Nc[0],"gx:"+r)},Hu=Ks(kc,["scale","heading","Icon","hotSpot"]),Vu=Ks(kc,{Icon:Hs(function(t,e,r){var n={node:t},i=r[r.length-1].node,o=ju[i.namespaceURI],a=Xs(e,o);Qs(n,qu,zs,a,r,o),a=Xs(e,o=ju[Nc[0]]),Qs(n,qu,Wu,a,r,o)}),heading:Hs(gl),hotSpot:Hs(function(t,e){t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.setAttribute("xunits",e.xunits),t.setAttribute("yunits",e.yunits)}),scale:Hs(vh)}),Yu=Ks(kc,["color","scale"]),zu=Ks(kc,{color:Hs(Du),scale:Hs(vh)}),Xu=Ks(kc,["color","width"]),Ku=Ks(kc,{color:Hs(Du),width:Hs(gl)}),$u={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Ju=function(t,e,r){if(t)return ks(e[e.length-1].node.namespaceURI,$u[t.getType()])},Zu=Ys("Point"),Qu=Ys("LineString"),th=Ys("LinearRing"),eh=Ys("Polygon"),rh=Ks(kc,{LineString:Hs(ph),Point:Hs(ph),Polygon:Hs(yh),GeometryCollection:Hs(nh)});function nh(t,e,r){var n,i,o={node:t},a=e.getType();a==hr.GEOMETRY_COLLECTION?(n=e.getGeometries(),i=Ju):a==hr.MULTI_POINT?(n=e.getPoints(),i=Zu):a==hr.MULTI_LINE_STRING?(n=e.getLineStrings(),i=Qu):a==hr.MULTI_POLYGON?(n=e.getPolygons(),i=eh):te(!1,39),Qs(o,rh,i,n,r)}var ih=Ks(kc,{LinearRing:Hs(ph)});function oh(t,e,r){Qs({node:t},ih,th,[e],r)}var ah=Ks(kc,{ExtendedData:Hs(function(t,e,r){for(var n={node:t},i=e.names,o=e.values,a=i.length,s=0;s<a;s++)Qs(n,Fu,Uu,[{name:i[s],value:o[s]}],r)}),MultiGeometry:Hs(nh),LineString:Hs(ph),LinearRing:Hs(ph),Point:Hs(ph),Polygon:Hs(yh),Style:Hs(function(t,e,r){var n={node:t},i={},o=e.getFill(),a=e.getStroke(),s=e.getImage(),l=e.getText();s&&"function"==typeof s.getSrc&&(i.IconStyle=s);l&&(i.LabelStyle=l);a&&(i.LineStyle=a);o&&(i.PolyStyle=o);var c=r[r.length-1].node,u=Th[c.namespaceURI],h=Xs(i,u);Qs(n,_h,zs,h,r,u)}),address:Hs(ml),description:Hs(ml),name:Hs(ml),open:Hs(dl),phoneNumber:Hs(ml),styleUrl:Hs(ml),visibility:Hs(dl)}),sh=Ks(kc,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),lh=Ys("ExtendedData");function ch(t,e,r){var n={node:t};e.getId()&&t.setAttribute("id",e.getId());var i=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;var a=Object.keys(i||{}).sort().filter(function(t){return!o[t]});if(a.length>0){var s=Xs(i,a);Qs(n,ah,lh,[{names:a,values:s}],r)}var l=e.getStyleFunction();if(l){var c=l(e,0);if(c){var u=Array.isArray(c)?c[0]:c;this.writeStyles_&&(i.Style=u);var h=u.getText();h&&(i.name=h.getText())}}var p=r[r.length-1].node,d=sh[p.namespaceURI],f=Xs(i,d);Qs(n,ah,zs,f,r,d);var g=r[0],y=e.getGeometry();y&&(y=As(y,!0,g)),Qs(n,ah,Ju,[y],r)}var uh=Ks(kc,["extrude","tessellate","altitudeMode","coordinates"]),hh=Ks(kc,{extrude:Hs(dl),tessellate:Hs(dl),altitudeMode:Hs(ml),coordinates:Hs(function(t,e,r){var n,i=r[r.length-1],o=i.layout,a=i.stride;o==pr.XY||o==pr.XYM?n=2:o==pr.XYZ||o==pr.XYZM?n=3:te(!1,34);var s=e.length,l="";if(s>0){l+=e[0];for(var c=1;c<n;++c)l+=","+e[c];for(var u=a;u<s;u+=a){l+=" "+e[u];for(var h=1;h<n;++h)l+=","+e[u+h]}}ml(t,l)})});function ph(t,e,r){var n=e.getFlatCoordinates(),i={node:t};i.layout=e.getLayout(),i.stride=e.getStride();var o=e.getProperties();o.coordinates=n;var a=r[r.length-1].node,s=uh[a.namespaceURI],l=Xs(o,s);Qs(i,hh,zs,l,r,s)}var dh=Ks(kc,{outerBoundaryIs:Hs(oh),innerBoundaryIs:Hs(oh)}),fh=Ys("innerBoundaryIs"),gh=Ys("outerBoundaryIs");function yh(t,e,r){var n=e.getLinearRings(),i=n.shift(),o={node:t};Qs(o,dh,fh,n,r),Qs(o,dh,gh,[i],r)}var mh=Ks(kc,{color:Hs(Du)}),Ch=Ys("color");function vh(t,e){gl(t,Math.round(1e6*e)/1e6)}var Th=Ks(kc,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),_h=Ks(kc,{IconStyle:Hs(function(t,e,r){var n={node:t},i={},o=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:o};if(a){l.w=a[0],l.h=a[1];var c=e.getAnchor(),u=e.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var h={x:c[0],xunits:sc.PIXELS,y:a[1]-c[1],yunits:sc.PIXELS};i.hotSpot=h}}i.Icon=l;var p=e.getScale();1!==p&&(i.scale=p);var d=e.getRotation();0!==d&&(i.heading=d);var f=r[r.length-1].node,g=Hu[f.namespaceURI],y=Xs(i,g);Qs(n,Vu,zs,y,r,g)}),LabelStyle:Hs(function(t,e,r){var n={node:t},i={},o=e.getFill();o&&(i.color=o.getColor());var a=e.getScale();a&&1!==a&&(i.scale=a);var s=r[r.length-1].node,l=Yu[s.namespaceURI],c=Xs(i,l);Qs(n,zu,zs,c,r,l)}),LineStyle:Hs(function(t,e,r){var n={node:t},i={color:e.getColor(),width:e.getWidth()},o=r[r.length-1].node,a=Xu[o.namespaceURI],s=Xs(i,a);Qs(n,Ku,zs,s,r,a)}),PolyStyle:Hs(function(t,e,r){Qs({node:t},mh,Ch,[e.getColor()],r)})}),Sh=Kc,Eh=el+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Lh={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},wh=function(t){function e(e){var r=e||{};t.call(this,r),this.FEATURE_COLLECTION_PARSERS[el].featureMember=Us(this.readFeaturesInternal),this.schemaLocation=r.schemaLocation?r.schemaLocation:Eh}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFlatCoordinates_=function(t,e){var r=Ds(t,!1).replace(/^\s*|\s*$/g,""),n=e[0].srsName,i="enu";if(n){var o=jr(n);o&&(i=o.getAxisOrientation())}for(var a=r.trim().split(/\s+/),s=[],l=0,c=a.length;l<c;l++){var u=a[l].split(/,+/),h=parseFloat(u[0]),p=parseFloat(u[1]),d=3===u.length?parseFloat(u[2]):0;"en"===i.substr(0,2)?s.push(h,p,d):s.push(p,h,d)}return s},e.prototype.readBox_=function(t,e){var r=Js([null],this.BOX_PARSERS_,t,e,this);return je(r[1][0],r[1][1],r[1][3],r[1][4])},e.prototype.innerBoundaryIsParser_=function(t,e){var r=Js(void 0,this.RING_PARSERS,t,e,this);r&&e[e.length-1].push(r)},e.prototype.outerBoundaryIsParser_=function(t,e){var r=Js(void 0,this.RING_PARSERS,t,e,this);r&&(e[e.length-1][0]=r)},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,r){var n,i=e[e.length-1],o=i.multiSurface,a=i.surface,s=i.multiCurve;return Array.isArray(t)?n="Envelope":"MultiPolygon"===(n=t.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"MultiLineString"===n&&!0===s&&(n="MultiCurve"),ks("http://www.opengis.net/gml",n)},e.prototype.writeFeatureElement=function(t,e,r){var n=e.getId();n&&t.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=e.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=e.getProperties(),l=[],c=[];for(var h in s){var p=s[h];null!==p&&(l.push(h),c.push(p),h==a||"function"==typeof p.getSimplifiedGeometry?h in i.serializers[o]||(i.serializers[o][h]=Hs(this.writeGeometryElement,this)):h in i.serializers[o]||(i.serializers[o][h]=Hs(ml)))}var d=u({},i);d.node=t,Qs(d,i.serializers,Ys(void 0,o),c,r,l)},e.prototype.writeCurveOrLineString_=function(t,e,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==t.nodeName&&n&&t.setAttribute("srsName",n),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var i=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(i),this.writeCoordinates_(i,e,r)}else if("Curve"===t.nodeName){var o=ks(t.namespaceURI,"segments");t.appendChild(o),this.writeCurveSegments_(o,e,r)}},e.prototype.writeLineStringOrCurveMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeCurveOrLineString_(n,e,r))},e.prototype.writeMultiCurveOrLineString_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&t.setAttribute("srsName",o);var s=e.getLineStrings();Qs({node:t,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeGeometryElement=function(t,e,r){var n,i=r[r.length-1],o=u({},i);o.node=t,n=Array.isArray(e)?i.dataProjection?$r(e,i.featureProjection,i.dataProjection):e:As(e,!0,i),Qs(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},e.prototype.createCoordinatesNode_=function(t){var e=ks(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e},e.prototype.writeCoordinates_=function(t,e,r){for(var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=e.getCoordinates(),s=a.length,l=new Array(s),c=0;c<s;++c){var u=a[c];l[c]=this.getCoords_(u,o,i)}ml(t,l.join(" "))},e.prototype.writeCurveSegments_=function(t,e,r){var n=ks(t.namespaceURI,"LineStringSegment");t.appendChild(n),this.writeCurveOrLineString_(n,e,r)},e.prototype.writeSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Qs({node:t,hasZ:i,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===t.nodeName){var s=ks(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,r)}},e.prototype.RING_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),ks(i.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")},e.prototype.writeSurfacePatches_=function(t,e,r){var n=ks(t.namespaceURI,"PolygonPatch");t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r)},e.prototype.writeRing_=function(t,e,r){var n=ks(t.namespaceURI,"LinearRing");t.appendChild(n),this.writeLinearRing_(n,e,r)},e.prototype.getCoords_=function(t,e,r){var n="enu";e&&(n=jr(e).getAxisOrientation());var i="en"===n.substr(0,2)?t[0]+","+t[1]:t[1]+","+t[0];r&&(i+=","+(t[2]||0));return i},e.prototype.writePoint_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&t.setAttribute("srsName",o);var a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);var s=e.getCoordinates();ml(a,this.getCoords_(s,o,i))},e.prototype.writeMultiPoint_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&t.setAttribute("srsName",o);var a=e.getPoints();Qs({node:t,hasZ:i,srsName:o},this.POINTMEMBER_SERIALIZERS_,Ys("pointMember"),a,r,void 0,this)},e.prototype.writePointMember_=function(t,e,r){var n=ks(t.namespaceURI,"Point");t.appendChild(n),this.writePoint_(n,e,r)},e.prototype.writeLinearRing_=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(i),this.writeCoordinates_(i,e,r)},e.prototype.writeMultiSurfaceOrPolygon_=function(t,e,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&t.setAttribute("srsName",o);var s=e.getPolygons();Qs({node:t,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},e.prototype.writeSurfaceOrPolygonMember_=function(t,e,r){var n=this.GEOMETRY_NODE_FACTORY_(e,r);n&&(t.appendChild(n),this.writeSurfaceOrPolygon_(n,e,r))},e.prototype.writeEnvelope=function(t,e,r){var n=r[r.length-1].srsName;n&&t.setAttribute("srsName",n);var i=[e[0]+" "+e[1],e[2]+" "+e[3]];Qs({node:t},this.ENVELOPE_SERIALIZERS_,zs,i,r,["lowerCorner","upperCorner"],this)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,r){var n=e[e.length-1].node;return ks("http://www.opengis.net/gml",Lh[n.nodeName])},e}(il);wh.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:js(wh.prototype.readFlatCoordinates_)}},wh.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:wh.prototype.innerBoundaryIsParser_,outerBoundaryIs:wh.prototype.outerBoundaryIsParser_}},wh.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Us(wh.prototype.readFlatCoordinates_)}},wh.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:js(il.prototype.readPoint),MultiPoint:js(il.prototype.readMultiPoint),LineString:js(il.prototype.readLineString),MultiLineString:js(il.prototype.readMultiLineString),LinearRing:js(il.prototype.readLinearRing),Polygon:js(il.prototype.readPolygon),MultiPolygon:js(il.prototype.readMultiPolygon),Box:js(wh.prototype.readBox_)}},wh.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Hs(wh.prototype.writeCurveOrLineString_),MultiCurve:Hs(wh.prototype.writeMultiCurveOrLineString_),Point:Hs(wh.prototype.writePoint_),MultiPoint:Hs(wh.prototype.writeMultiPoint_),LineString:Hs(wh.prototype.writeCurveOrLineString_),MultiLineString:Hs(wh.prototype.writeMultiCurveOrLineString_),LinearRing:Hs(wh.prototype.writeLinearRing_),Polygon:Hs(wh.prototype.writeSurfaceOrPolygon_),MultiPolygon:Hs(wh.prototype.writeMultiSurfaceOrPolygon_),Surface:Hs(wh.prototype.writeSurfaceOrPolygon_),MultiSurface:Hs(wh.prototype.writeMultiSurfaceOrPolygon_),Envelope:Hs(wh.prototype.writeEnvelope)}},wh.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Hs(wh.prototype.writeLineStringOrCurveMember_),curveMember:Hs(wh.prototype.writeLineStringOrCurveMember_)}},wh.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:Hs(wh.prototype.writeRing_),innerBoundaryIs:Hs(wh.prototype.writeRing_)}},wh.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Hs(wh.prototype.writePointMember_)}},wh.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Hs(wh.prototype.writeSurfaceOrPolygonMember_),polygonMember:Hs(wh.prototype.writeSurfaceOrPolygonMember_)}},wh.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Hs(ml),upperCorner:Hs(ml)}};var bh=wh,Ah=function(t){this.tagName_=t};Ah.prototype.getTagName=function(){return this.tagName_};var xh=Ah,Ph=function(t){function e(e){t.call(this,"And",Array.prototype.slice.call(arguments))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e,r){t.call(this,e),this.conditions=r,te(this.conditions.length>=2,57)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xh)),Rh=function(t){function e(e,r,n){t.call(this,"BBOX"),this.geometryName=e,this.extent=r,this.srsName=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xh),Ih={"http://www.opengis.net/gml":{boundedBy:Ws(il.prototype.readGeometryElement,"bounds")}},Mh={"http://www.opengis.net/wfs":{totalInserted:Ws(ul),totalUpdated:Ws(ul),totalDeleted:Ws(ul)}},Oh={"http://www.opengis.net/wfs":{TransactionSummary:Ws(function(t,e){return Js({},Mh,t,e)},"transactionSummary"),InsertResults:Ws(function(t,e){return Js([],Hh,t,e)},"insertIds")}},Nh={"http://www.opengis.net/wfs":{PropertyName:Hs(ml)}},kh={"http://www.opengis.net/wfs":{Insert:Hs(function(t,e,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a=n.gmlVersion,s=ks(o,i);t.appendChild(s),2===a?bh.prototype.writeFeatureElement(s,e,r):_l.prototype.writeFeatureElement(s,e,r)}),Update:Hs(function(t,e,r){var n=r[r.length-1];te(void 0!==e.getId(),27);var i=n.featureType,o=n.featurePrefix,a=n.featureNS,s=Yh(o,i),l=e.getGeometryName();t.setAttribute("typeName",s),t.setAttributeNS(Fh,"xmlns:"+o,a);var c=e.getId();if(void 0!==c){for(var u=e.getKeys(),h=[],p=0,d=u.length;p<d;p++){var f=e.get(u[p]);if(void 0!==f){var g=u[p];f&&"function"==typeof f.getSimplifiedGeometry&&(g=l),h.push({name:g,value:f})}}Qs({gmlVersion:n.gmlVersion,node:t,hasZ:n.hasZ,srsName:n.srsName},kh,Ys("Property"),h,r),Vh(t,c,r)}}),Delete:Hs(function(t,e,r){var n=r[r.length-1];te(void 0!==e.getId(),26);var i=n.featureType,o=n.featurePrefix,a=n.featureNS,s=Yh(o,i);t.setAttribute("typeName",s),t.setAttributeNS(Fh,"xmlns:"+o,a);var l=e.getId();void 0!==l&&Vh(t,l,r)}),Property:Hs(function(t,e,r){var n=ks(Gh,"Name"),i=r[r.length-1].gmlVersion;if(t.appendChild(n),ml(n,e.name),void 0!==e.value&&null!==e.value){var o=ks(Gh,"Value");t.appendChild(o),e.value&&"function"==typeof e.value.getSimplifiedGeometry?2===i?bh.prototype.writeGeometryElement(o,e.value,r):_l.prototype.writeGeometryElement(o,e.value,r):ml(o,e.value)}}),Native:Hs(function(t,e,r){e.vendorId&&t.setAttribute("vendorId",e.vendorId);void 0!==e.safeToIgnore&&t.setAttribute("safeToIgnore",String(e.safeToIgnore));void 0!==e.value&&ml(t,e.value)})}},Dh="feature",Fh="http://www.w3.org/2000/xmlns/",Bh="http://www.opengis.net/ogc",Gh="http://www.opengis.net/wfs",Uh={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},jh="1.1.0",qh=function(t){function e(e){t.call(this);var r=e||{};this.featureType_=r.featureType,this.featureNS_=r.featureNS,this.gmlFormat_=r.gmlFormat?r.gmlFormat:new _l,this.schemaLocation_=r.schemaLocation?r.schemaLocation:Uh[jh]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getFeatureType=function(){return this.featureType_},e.prototype.setFeatureType=function(t){this.featureType_=t},e.prototype.readFeaturesFromNode=function(t,e){var r={node:t};u(r,{featureType:this.featureType_,featureNS:this.featureNS_}),u(r,this.getReadOptions(t,e||{}));var n=[r];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[el].featureMember=Us(il.prototype.readFeaturesInternal);var i=Js([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,n,this.gmlFormat_);return i||(i=[]),i},e.prototype.readTransactionResponse=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readTransactionResponseFromDocument(e)}return Fs(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}},e.prototype.readFeatureCollectionMetadata=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Fs(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}},e.prototype.readFeatureCollectionMetadataFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)},e.prototype.readFeatureCollectionMetadataFromNode=function(t){var e={},r=hl(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=r,Js(e,Ih,t,[],this.gmlFormat_)},e.prototype.readTransactionResponseFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)},e.prototype.readTransactionResponseFromNode=function(t){return Js({},Oh,t,[])},e.prototype.writeGetFeature=function(t){var e,r,n,i,o=ks(Gh,"GetFeature");if(o.setAttribute("service","WFS"),o.setAttribute("version","1.1.0"),t&&(t.handle&&o.setAttribute("handle",t.handle),t.outputFormat&&o.setAttribute("outputFormat",t.outputFormat),void 0!==t.maxFeatures&&o.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&o.setAttribute("resultType",t.resultType),void 0!==t.startIndex&&o.setAttribute("startIndex",String(t.startIndex)),void 0!==t.count&&o.setAttribute("count",String(t.count)),void 0!==t.viewParams&&o.setAttribute("viewParams ",t.viewParams),e=t.filter,t.bbox)){te(t.geometryName,12);var a=(r=t.geometryName,n=t.bbox,i=t.srsName,new Rh(r,n,i));e=e?function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Ph,e))}(e,a):a}o.setAttributeNS(Ns,"xsi:schemaLocation",this.schemaLocation_);var s={node:o};return u(s,{srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,geometryName:t.geometryName,filter:e,propertyNames:t.propertyNames?t.propertyNames:[]}),te(Array.isArray(t.featureTypes),11),function(t,e,r){var n=u({},r[r.length-1]);n.node=t,Qs(n,zh,Ys("Query"),e,r)}(o,t.featureTypes,[s]),o},e.prototype.writeTransaction=function(t,e,r,n){var i,o,a=[],s=ks(Gh,"Transaction"),l=n.version?n.version:jh,c="1.0.0"===l?2:3;s.setAttribute("service","WFS"),s.setAttribute("version",l),n&&(i=n.gmlOptions?n.gmlOptions:{},n.handle&&s.setAttribute("handle",n.handle));var h=Uh[l];s.setAttributeNS(Ns,"xsi:schemaLocation",h);var p=n.featurePrefix?n.featurePrefix:Dh;return t&&(o=u({node:s},{featureNS:n.featureNS,featureType:n.featureType,featurePrefix:p,gmlVersion:c,hasZ:n.hasZ,srsName:n.srsName}),u(o,i),Qs(o,kh,Ys("Insert"),t,a)),e&&(o=u({node:s},{featureNS:n.featureNS,featureType:n.featureType,featurePrefix:p,gmlVersion:c,hasZ:n.hasZ,srsName:n.srsName}),u(o,i),Qs(o,kh,Ys("Update"),e,a)),r&&Qs({node:s,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:p,gmlVersion:c,srsName:n.srsName},kh,Ys("Delete"),r,a),n.nativeElements&&Qs({node:s,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:p,gmlVersion:c,srsName:n.srsName},kh,Ys("Native"),n.nativeElements,a),s},e.prototype.readProjectionFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null},e.prototype.readProjectionFromNode=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(var e=(t=t.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var r=[{}];return this.gmlFormat_.readGeometryElement(e,r),jr(r.pop().srsName)}return null},e}(tl),Wh={"http://www.opengis.net/ogc":{FeatureId:Us(function(t,e){return t.getAttribute("fid")})}},Hh={"http://www.opengis.net/wfs":{Feature:function(t,e){$s(Wh,t,e)}}};function Vh(t,e,r){var n=ks(Bh,"Filter"),i=ks(Bh,"FeatureId");n.appendChild(i),i.setAttribute("fid",e),t.appendChild(n)}function Yh(t,e){var r=(t=t||Dh)+":";return 0===e.indexOf(r)?e:r+e}var zh={"http://www.opengis.net/wfs":{Query:Hs(function(t,e,r){var n,i=r[r.length-1],o=i.featurePrefix,a=i.featureNS,s=i.propertyNames,l=i.srsName;n=o?Yh(o,e):e;t.setAttribute("typeName",n),l&&t.setAttribute("srsName",l);a&&t.setAttributeNS(Fh,"xmlns:"+o,a);var c=u({},i);c.node=t,Qs(c,Nh,Ys("PropertyName"),s,r);var h=i.filter;if(h){var p=ks(Bh,"Filter");t.appendChild(p),function(t,e,r){Qs({node:t},zh,Ys(e.getTagName()),[e],r)}(p,h,r)}})},"http://www.opengis.net/ogc":{During:Hs(function(t,e,r){var n=ks("http://www.opengis.net/fes","ValueReference");ml(n,e.propertyName),t.appendChild(n);var i=ks(el,"TimePeriod");t.appendChild(i);var o=ks(el,"begin");i.appendChild(o),Qh(o,e.begin);var a=ks(el,"end");i.appendChild(a),Qh(a,e.end)}),And:Hs(Xh),Or:Hs(Xh),Not:Hs(function(t,e,r){var n={node:t},i=e.condition;Qs(n,zh,Ys(i.getTagName()),[i],r)}),BBOX:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Jh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.extent,r)}),Contains:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Jh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),Intersects:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Jh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),Within:Hs(function(t,e,r){r[r.length-1].srsName=e.srsName,Jh(t,e.geometryName),_l.prototype.writeGeometryElement(t,e.geometry,r)}),PropertyIsEqualTo:Hs(Kh),PropertyIsNotEqualTo:Hs(Kh),PropertyIsLessThan:Hs(Kh),PropertyIsLessThanOrEqualTo:Hs(Kh),PropertyIsGreaterThan:Hs(Kh),PropertyIsGreaterThanOrEqualTo:Hs(Kh),PropertyIsNull:Hs(function(t,e,r){Jh(t,e.propertyName)}),PropertyIsBetween:Hs(function(t,e,r){Jh(t,e.propertyName);var n=ks(Bh,"LowerBoundary");t.appendChild(n),Zh(n,""+e.lowerBoundary);var i=ks(Bh,"UpperBoundary");t.appendChild(i),Zh(i,""+e.upperBoundary)}),PropertyIsLike:Hs(function(t,e,r){t.setAttribute("wildCard",e.wildCard),t.setAttribute("singleChar",e.singleChar),t.setAttribute("escapeChar",e.escapeChar),void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());Jh(t,e.propertyName),Zh(t,""+e.pattern)})}};function Xh(t,e,r){for(var n={node:t},i=e.conditions,o=0,a=i.length;o<a;++o){var s=i[o];Qs(n,zh,Ys(s.getTagName()),[s],r)}}function Kh(t,e,r){void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString()),Jh(t,e.propertyName),Zh(t,""+e.expression)}function $h(t,e,r){var n=ks(Bh,t);ml(n,r),e.appendChild(n)}function Jh(t,e){$h("PropertyName",t,e)}function Zh(t,e){$h("Literal",t,e)}function Qh(t,e){var r=ks(el,"TimeInstant");t.appendChild(r);var n=ks(el,"timePosition");r.appendChild(n),ml(n,e)}var tp=qh;function ep(t){return"string"==typeof t?t:""}var rp=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getType=function(){return Es.TEXT},e.prototype.readFeature=function(t,e){return this.readFeatureFromText(ep(t),this.adaptOptions(e))},e.prototype.readFeatureFromText=function(t,e){return n()},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(ep(t),this.adaptOptions(e))},e.prototype.readFeaturesFromText=function(t,e){return n()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(ep(t),this.adaptOptions(e))},e.prototype.readGeometryFromText=function(t,e){return n()},e.prototype.readProjection=function(t){return this.readProjectionFromText(ep(t))},e.prototype.readProjectionFromText=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))},e.prototype.writeFeatureText=function(t,e){return n()},e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))},e.prototype.writeFeaturesText=function(t,e){return n()},e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))},e.prototype.writeGeometryText=function(t,e){return n()},e}(bs),np={POINT:Pn,LINESTRING:ys,POLYGON:Wn,MULTIPOINT:ds,MULTILINESTRING:ms,MULTIPOLYGON:Cs},ip="EMPTY",op="Z",ap="M",sp={};for(var lp in hr)sp[lp]=hr[lp].toUpperCase();var cp=function(t){this.wkt=t,this.index_=-1};cp.prototype.isAlpha_=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},cp.prototype.isNumeric_=function(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)},cp.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t},cp.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},cp.prototype.nextToken=function(){var t,e=this.nextChar_(),r=this.index_,n=e;if("("==e)t=2;else if(","==e)t=5;else if(")"==e)t=3;else if(this.isNumeric_(e)||"-"==e)t=4,n=this.readNumber_();else if(this.isAlpha_(e))t=1,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=6}return{position:r,value:n,type:t}},cp.prototype.readNumber_=function(){var t,e=this.index_,r=!1,n=!1;do{"."==t?r=!0:"e"!=t&&"E"!=t||(n=!0),t=this.nextChar_()}while(this.isNumeric_(t,r)||!n&&("e"==t||"E"==t)||n&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))},cp.prototype.readText_=function(){var t,e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()};var up=function(t){this.lexer_=t,this.token_,this.layout_=pr.XY};function hp(t){var e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function pp(t){for(var e=t.getCoordinates(),r=[],n=0,i=e.length;n<i;++n)r.push(e[n].join(" "));return r.join(",")}function dp(t){for(var e=[],r=t.getLinearRings(),n=0,i=r.length;n<i;++n)e.push("("+pp(r[n])+")");return e.join(",")}up.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},up.prototype.isTokenType=function(t){return this.token_.type==t},up.prototype.match=function(t){var e=this.isTokenType(t);return e&&this.consume_(),e},up.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},up.prototype.parseGeometryLayout_=function(){var t=pr.XY,e=this.token_;if(this.isTokenType(1)){var r=e.value;r===op?t=pr.XYZ:r===ap?t=pr.XYM:"ZM"===r&&(t=pr.XYZM),t!==pr.XY&&this.consume_()}return t},up.prototype.parseGeometryCollectionText_=function(){if(this.match(2)){var t=[];do{t.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parsePointText_=function(){if(this.match(2)){var t=this.parsePoint_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())},up.prototype.parseLineStringText_=function(){if(this.match(2)){var t=this.parsePointList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parsePolygonText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parseMultiPointText_=function(){var t;if(this.match(2)){if(t=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parseMultiLineStringText_=function(){if(this.match(2)){var t=this.parseLineStringTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parseMultiPolygonText_=function(){if(this.match(2)){var t=this.parsePolygonTextList_();if(this.match(3))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},up.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,r=0;r<e;++r){var n=this.token_;if(!this.match(4))break;t.push(n.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())},up.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(5);)t.push(this.parsePoint_());return t},up.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(5);)t.push(this.parsePointText_());return t},up.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(5);)t.push(this.parseLineStringText_());return t},up.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(5);)t.push(this.parsePolygonText_());return t},up.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(1)&&this.token_.value==ip;return t&&this.consume_(),t},up.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},up.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(1)){var e=t.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==e){var r=this.parseGeometryCollectionText_();return new Ss(r)}var n,i=np[e];if(!i)throw new Error("Invalid geometry type: "+e);switch(e){case"POINT":n=this.parsePointText_();break;case"LINESTRING":n=this.parseLineStringText_();break;case"POLYGON":n=this.parsePolygonText_();break;case"MULTIPOINT":n=this.parseMultiPointText_();break;case"MULTILINESTRING":n=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":n=this.parseMultiPolygonText_();break;default:throw new Error("Invalid geometry type: "+e)}return n||(n=i===np.POINT?[NaN,NaN]:[]),new i(n,this.layout_)}throw new Error(this.formatErrorMessage_())};var fp={Point:hp,LineString:pp,Polygon:dp,MultiPoint:function(t){for(var e=[],r=t.getPoints(),n=0,i=r.length;n<i;++n)e.push("("+hp(r[n])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],r=t.getLineStrings(),n=0,i=r.length;n<i;++n)e.push("("+pp(r[n])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],r=t.getPolygons(),n=0,i=r.length;n<i;++n)e.push("("+dp(r[n])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],r=t.getGeometries(),n=0,i=r.length;n<i;++n)e.push(gp(r[n]));return e.join(",")}};function gp(t){var e=t.getType(),r=(0,fp[e])(t);if(e=e.toUpperCase(),"function"==typeof t.getFlatCoordinates){var n=function(t){var e=t.getLayout(),r="";return e!==pr.XYZ&&e!==pr.XYZM||(r+=op),e!==pr.XYM&&e!==pr.XYZM||(r+=ap),r}(t);n.length>0&&(e+=" "+n)}return 0===r.length?e+" "+ip:e+"("+r+")"}var yp=function(t){function e(e){t.call(this);var r=e||{};this.splitCollection_=void 0!==r.splitCollection&&r.splitCollection}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parse_=function(t){var e=new cp(t);return new up(e).parse()},e.prototype.readFeatureFromText=function(t,e){var r=this.readGeometryFromText(t,e);if(r){var n=new ps;return n.setGeometry(r),n}return null},e.prototype.readFeaturesFromText=function(t,e){for(var r,n=this.readGeometryFromText(t,e),i=[],o=0,a=(r=this.splitCollection_&&n.getType()==hr.GEOMETRY_COLLECTION?n.getGeometriesArray():[n]).length;o<a;++o){var s=new ps;s.setGeometry(r[o]),i.push(s)}return i},e.prototype.readGeometryFromText=function(t,e){var r=this.parse_(t);return r?As(r,!1,e):null},e.prototype.writeFeatureText=function(t,e){var r=t.getGeometry();return r?this.writeGeometryText(r,e):""},e.prototype.writeFeaturesText=function(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(t[n].getGeometry());var o=new Ss(r);return this.writeGeometryText(o,e)},e.prototype.writeGeometryText=function(t,e){return gp(As(t,!0,e))},e}(rp),mp="http://www.w3.org/1999/xlink";function Cp(t){return t.getAttributeNS(mp,"href")}var vp=function(){};vp.prototype.read=function(t){if(t){if("string"==typeof t){var e=Bs(t);return this.readFromDocument(e)}return Fs(t)?this.readFromDocument(t):this.readFromNode(t)}return null},vp.prototype.readFromDocument=function(t){},vp.prototype.readFromNode=function(t){};var Tp=vp,_p=[null,"http://www.opengis.net/wms"],Sp=Ks(_p,{Service:Ws(function(t,e){return Js({},wp,t,e)}),Capability:Ws(function(t,e){return Js({},Ep,t,e)})}),Ep=Ks(_p,{Request:Ws(function(t,e){return Js({},Op,t,e)}),Exception:Ws(function(t,e){return Js([],Pp,t,e)}),Layer:Ws(function(t,e){return Js({},Rp,t,e)})}),Lp=function(t){function e(){t.call(this),this.version=void 0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){this.version=t.getAttribute("version").trim();return Js({version:this.version},Sp,t,[])||null},e}(Tp),wp=Ks(_p,{Name:Ws(pl),Title:Ws(pl),Abstract:Ws(pl),KeywordList:Ws(Wp),OnlineResource:Ws(Cp),ContactInformation:Ws(function(t,e){return Js({},bp,t,e)}),Fees:Ws(pl),AccessConstraints:Ws(pl),LayerLimit:Ws(ul),MaxWidth:Ws(ul),MaxHeight:Ws(ul)}),bp=Ks(_p,{ContactPersonPrimary:Ws(function(t,e){return Js({},Ap,t,e)}),ContactPosition:Ws(pl),ContactAddress:Ws(function(t,e){return Js({},xp,t,e)}),ContactVoiceTelephone:Ws(pl),ContactFacsimileTelephone:Ws(pl),ContactElectronicMailAddress:Ws(pl)}),Ap=Ks(_p,{ContactPerson:Ws(pl),ContactOrganization:Ws(pl)}),xp=Ks(_p,{AddressType:Ws(pl),Address:Ws(pl),City:Ws(pl),StateOrProvince:Ws(pl),PostCode:Ws(pl),Country:Ws(pl)}),Pp=Ks(_p,{Format:Us(pl)}),Rp=Ks(_p,{Name:Ws(pl),Title:Ws(pl),Abstract:Ws(pl),KeywordList:Ws(Wp),CRS:qs(pl),EX_GeographicBoundingBox:Ws(function(t,e){var r=Js({},Mp,t,e);if(r){var n=r.westBoundLongitude,i=r.southBoundLatitude,o=r.eastBoundLongitude,a=r.northBoundLatitude;if(void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a)return[n,i,o,a]}}),BoundingBox:qs(function(t,e){var r=[cl(t.getAttribute("minx")),cl(t.getAttribute("miny")),cl(t.getAttribute("maxx")),cl(t.getAttribute("maxy"))],n=[cl(t.getAttribute("resx")),cl(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:r,res:n}}),Dimension:qs(function(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:al(t.getAttribute("multipleValues")),nearestValue:al(t.getAttribute("nearestValue")),current:al(t.getAttribute("current")),values:pl(t)}}),Attribution:Ws(function(t,e){return Js({},Ip,t,e)}),AuthorityURL:qs(function(t,e){var r=Up(t,e);if(r)return r.name=t.getAttribute("name"),r}),Identifier:qs(pl),MetadataURL:qs(function(t,e){var r=Up(t,e);if(r)return r.type=t.getAttribute("type"),r}),DataURL:qs(Up),FeatureListURL:qs(Up),Style:qs(function(t,e){return Js({},Fp,t,e)}),MinScaleDenominator:Ws(ll),MaxScaleDenominator:Ws(ll),Layer:qs(function(t,e){var r=e[e.length-1],n=Js({},Rp,t,e);if(n){var i=al(t.getAttribute("queryable"));void 0===i&&(i=r.queryable);n.queryable=void 0!==i&&i;var o=hl(t.getAttribute("cascaded"));void 0===o&&(o=r.cascaded);n.cascaded=o;var a=al(t.getAttribute("opaque"));void 0===a&&(a=r.opaque);n.opaque=void 0!==a&&a;var s=al(t.getAttribute("noSubsets"));void 0===s&&(s=r.noSubsets);n.noSubsets=void 0!==s&&s;var l=cl(t.getAttribute("fixedWidth"));l||(l=r.fixedWidth);n.fixedWidth=l;var c=cl(t.getAttribute("fixedHeight"));c||(c=r.fixedHeight);n.fixedHeight=c,["Style","CRS","AuthorityURL"].forEach(function(t){if(t in r){var e=n[t]||[];n[t]=e.concat(r[t])}});return["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(t){if(!(t in n)){var e=r[t];n[t]=e}}),n}})}),Ip=Ks(_p,{Title:Ws(pl),OnlineResource:Ws(Cp),LogoURL:Ws(qp)}),Mp=Ks(_p,{westBoundLongitude:Ws(ll),eastBoundLongitude:Ws(ll),southBoundLatitude:Ws(ll),northBoundLatitude:Ws(ll)}),Op=Ks(_p,{GetCapabilities:Ws(jp),GetMap:Ws(jp),GetFeatureInfo:Ws(jp)}),Np=Ks(_p,{Format:qs(pl),DCPType:qs(function(t,e){return Js({},kp,t,e)})}),kp=Ks(_p,{HTTP:Ws(function(t,e){return Js({},Dp,t,e)})}),Dp=Ks(_p,{Get:Ws(Up),Post:Ws(Up)}),Fp=Ks(_p,{Name:Ws(pl),Title:Ws(pl),Abstract:Ws(pl),LegendURL:qs(qp),StyleSheetURL:Ws(Up),StyleURL:Ws(Up)}),Bp=Ks(_p,{Format:Ws(pl),OnlineResource:Ws(Cp)}),Gp=Ks(_p,{Keyword:Us(pl)});function Up(t,e){return Js({},Bp,t,e)}function jp(t,e){return Js({},Np,t,e)}function qp(t,e){var r=Up(t,e);if(r){var n=[hl(t.getAttribute("width")),hl(t.getAttribute("height"))];return r.size=n,r}}function Wp(t,e){return Js([],Gp,t,e)}var Hp=Lp,Vp=function(t){function e(e){t.call(this);var r=e||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new bh,this.layers_=r.layers?r.layers:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayers=function(){return this.layers_},e.prototype.setLayers=function(t){this.layers_=t},e.prototype.readFeatures_=function(t,e){t.setAttribute("namespaceURI",this.featureNS_);var r=t.localName,n=[];if(0===t.childNodes.length)return n;if("msGMLOutput"==r)for(var i=0,o=t.childNodes.length;i<o;i++){var a=t.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE){var s=a,l=e[0],c=s.localName.replace("_layer","");if(!this.layers_||kt(this.layers_,c)){var u=c+"_feature";l.featureType=u,l.featureNS=this.featureNS_;var h={};h[u]=Us(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var p=Ks([l.featureNS,null],h);s.setAttribute("namespaceURI",this.featureNS_);var d=Js([],p,s,e,this.gmlFormat_);d&&Bt(n,d)}}}if("FeatureCollection"==r){var f=Js([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);f&&(n=f)}return n},e.prototype.readFeaturesFromNode=function(t,e){var r={};return e&&u(r,this.getReadOptions(t,e)),this.readFeatures_(t,[r])},e}(tl),Yp=[null,"http://www.opengis.net/ows/1.1"],zp=Ks(Yp,{ServiceIdentification:Ws(function(t,e){return Js({},ad,t,e)}),ServiceProvider:Ws(function(t,e){return Js({},sd,t,e)}),OperationsMetadata:Ws(function(t,e){return Js({},rd,t,e)})}),Xp=function(t){function e(){t.call(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){return Js({},zp,t,[])||null},e}(Tp),Kp=Ks(Yp,{DeliveryPoint:Ws(pl),City:Ws(pl),AdministrativeArea:Ws(pl),PostalCode:Ws(pl),Country:Ws(pl),ElectronicMailAddress:Ws(pl)}),$p=Ks(Yp,{Value:qs(function(t,e){return pl(t)})}),Jp=Ks(Yp,{AllowedValues:Ws(function(t,e){return Js({},$p,t,e)})}),Zp=Ks(Yp,{Phone:Ws(function(t,e){return Js({},nd,t,e)}),Address:Ws(function(t,e){return Js({},Kp,t,e)})}),Qp=Ks(Yp,{HTTP:Ws(function(t,e){return Js({},td,t,e)})}),td=Ks(Yp,{Get:qs(function(t,e){var r=Cp(t);if(r)return Js({href:r},id,t,e)}),Post:void 0}),ed=Ks(Yp,{DCP:Ws(function(t,e){return Js({},Qp,t,e)})}),rd=Ks(Yp,{Operation:function(t,e){var r=t.getAttribute("name"),n=Js({},ed,t,e);n&&(e[e.length-1][r]=n)}}),nd=Ks(Yp,{Voice:Ws(pl),Facsimile:Ws(pl)}),id=Ks(Yp,{Constraint:qs(function(t,e){var r=t.getAttribute("name");if(r)return Js({name:r},Jp,t,e)})}),od=Ks(Yp,{IndividualName:Ws(pl),PositionName:Ws(pl),ContactInfo:Ws(function(t,e){return Js({},Zp,t,e)})}),ad=Ks(Yp,{Abstract:Ws(pl),AccessConstraints:Ws(pl),Fees:Ws(pl),Title:Ws(pl),ServiceTypeVersion:Ws(pl),ServiceType:Ws(pl)}),sd=Ks(Yp,{ProviderName:Ws(pl),ProviderSite:Ws(Cp),ServiceContact:Ws(function(t,e){return Js({},od,t,e)})}),ld=Xp,cd=[null,"http://www.opengis.net/wmts/1.0"],ud=[null,"http://www.opengis.net/ows/1.1"],hd=Ks(cd,{Contents:Ws(function(t,e){return Js({},dd,t,e)})}),pd=function(t){function e(){t.call(this),this.owsParser_=new ld}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},e.prototype.readFromNode=function(t){var e=t.getAttribute("version").trim(),r=this.owsParser_.readFromNode(t);return r?(r.version=e,(r=Js(r,hd,t,[]))||null):null},e}(Tp),dd=Ks(cd,{Layer:qs(function(t,e){return Js({},fd,t,e)}),TileMatrixSet:qs(function(t,e){return Js({},_d,t,e)})}),fd=Ks(cd,{Style:qs(function(t,e){var r=Js({},gd,t,e);if(r){var n="true"===t.getAttribute("isDefault");return r.isDefault=n,r}}),Format:qs(pl),TileMatrixSetLink:qs(function(t,e){return Js({},yd,t,e)}),Dimension:qs(function(t,e){return Js({},vd,t,e)}),ResourceURL:qs(function(t,e){var r=t.getAttribute("format"),n=t.getAttribute("template"),i=t.getAttribute("resourceType"),o={};r&&(o.format=r);n&&(o.template=n);i&&(o.resourceType=i);return o})},Ks(ud,{Title:Ws(pl),Abstract:Ws(pl),WGS84BoundingBox:Ws(function(t,e){var r=Js([],Td,t,e);if(2==r.length)return Oe(r)}),Identifier:Ws(pl)})),gd=Ks(cd,{LegendURL:qs(function(t,e){var r={};return r.format=t.getAttribute("format"),r.href=Cp(t),r})},Ks(ud,{Title:Ws(pl),Identifier:Ws(pl)})),yd=Ks(cd,{TileMatrixSet:Ws(pl),TileMatrixSetLimits:Ws(function(t,e){return Js([],md,t,e)})}),md=Ks(cd,{TileMatrixLimits:Us(function(t,e){return Js({},Cd,t,e)})}),Cd=Ks(cd,{TileMatrix:Ws(pl),MinTileRow:Ws(ul),MaxTileRow:Ws(ul),MinTileCol:Ws(ul),MaxTileCol:Ws(ul)}),vd=Ks(cd,{Default:Ws(pl),Value:qs(pl)},Ks(ud,{Identifier:Ws(pl)})),Td=Ks(ud,{LowerCorner:Us(Ed),UpperCorner:Us(Ed)}),_d=Ks(cd,{WellKnownScaleSet:Ws(pl),TileMatrix:qs(function(t,e){return Js({},Sd,t,e)})},Ks(ud,{SupportedCRS:Ws(pl),Identifier:Ws(pl)})),Sd=Ks(cd,{TopLeftCorner:Ws(Ed),ScaleDenominator:Ws(ll),TileWidth:Ws(ul),TileHeight:Ws(ul),MatrixWidth:Ws(ul),MatrixHeight:Ws(ul)},Ks(ud,{Identifier:Ws(pl)}));function Ed(t,e){var r=pl(t).split(/\s+/);if(r&&2==r.length){var n=+r[0],i=+r[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}var Ld=pd,wd={Point:function(t,e,r){var n=t.coordinates;e&&r&&Rd(n,e,r);return new Pn(n)},LineString:function(t,e){var r=bd(t.arcs,e);return new ys(r)},Polygon:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n)r[n]=bd(t.arcs[n],e);return new Wn(r)},MultiPoint:function(t,e,r){var n=t.coordinates;if(e&&r)for(var i=0,o=n.length;i<o;++i)Rd(n[i],e,r);return new ds(n)},MultiLineString:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n)r[n]=bd(t.arcs[n],e);return new ms(r)},MultiPolygon:function(t,e){for(var r=[],n=0,i=t.arcs.length;n<i;++n){for(var o=t.arcs[n],a=[],s=0,l=o.length;s<l;++s)a[s]=bd(o[s],e);r[n]=a}return new Cs(r)}};function bd(t,e){for(var r,n,i=[],o=0,a=t.length;o<a;++o)r=t[o],o>0&&i.pop(),n=r>=0?e[r]:e[~r].slice().reverse(),i.push.apply(i,n);for(var s=0,l=i.length;s<l;++s)i[s]=i[s].slice();return i}function Ad(t,e,r,n,i,o,a){for(var s=t.geometries,l=[],c=0,u=s.length;c<u;++c)l[c]=xd(s[c],e,r,n,i,o,a);return l}function xd(t,e,r,n,i,o,a){var s,l=t.type,c=wd[l];s="Point"===l||"MultiPoint"===l?c(t,r,n):c(t,e);var u=new ps;u.setGeometry(As(s,!1,a)),void 0!==t.id&&u.setId(t.id);var h=t.properties;return i&&(h||(h={}),h[i]=o),h&&u.setProperties(h),u}function Pd(t,e,r){for(var n=0,i=0,o=0,a=t.length;o<a;++o){var s=t[o];n+=s[0],i+=s[1],s[0]=n,s[1]=i,Rd(s,e,r)}}function Rd(t,e,r){t[0]=t[0]*e[0]+r[0],t[1]=t[1]*e[1]+r[1]}var Id=function(t){function e(e){t.call(this);var r=e||{};this.layerName_=r.layerName,this.layers_=r.layers?r.layers:null,this.dataProjection=jr(r.dataProjection?r.dataProjection:"EPSG:4326")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.readFeaturesFromObject=function(t,e){if("Topology"==t.type){var r,n=t,i=null,o=null;n.transform&&(i=(r=n.transform).scale,o=r.translate);var a=n.arcs;r&&function(t,e,r){for(var n=0,i=t.length;n<i;++n)Pd(t[n],e,r)}(a,i,o);var s,l=[],c=n.objects,u=this.layerName_;for(var h in c)this.layers_&&-1==this.layers_.indexOf(h)||("GeometryCollection"===c[h].type?(s=c[h],l.push.apply(l,Ad(s,a,i,o,u,h,e))):(s=c[h],l.push(xd(s,a,i,o,u,h,e))));return l}return[]},e.prototype.readProjectionFromObject=function(t){return this.dataProjection},e}(Ps),Md="renderOrder",Od=function(t){function e(e){var r=e||{},n=u({},r);delete n.style,delete n.renderBuffer,delete n.updateWhileAnimating,delete n.updateWhileInteracting,t.call(this,n),this.declutter_=void 0!==r.declutter&&r.declutter,this.renderBuffer_=void 0!==r.renderBuffer?r.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(r.style),this.updateWhileAnimating_=void 0!==r.updateWhileAnimating&&r.updateWhileAnimating,this.updateWhileInteracting_=void 0!==r.updateWhileInteracting&&r.updateWhileInteracting,this.renderMode_=r.renderMode||mo.VECTOR,this.type=yo.VECTOR}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.setDeclutter=function(t){this.declutter_=t},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(Md)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.setRenderOrder=function(t){this.set(Md,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:vc,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var r;Array.isArray(t)?r=t:(te("function"==typeof t.getZIndex,41),r=[t]),e=function(){return r}}return e}(this.style_),this.changed()},e.prototype.getRenderMode=function(){return this.renderMode_},e}(Ci);Od.prototype.getSource;var Nd=Od;function kd(t,e){return[[-1/0,-1/0,1/0,1/0]]}function Dd(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var Fd=function(t){function e(e){t.call(this),this.projection_=jr(e.projection),this.attributions_=Dd(e.attributions),this.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,this.loading=!1,this.state_=void 0!==e.state?e.state:ni.READY,this.wrapX_=void 0!==e.wrapX&&e.wrapX}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolutions=function(){return n()},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=Dd(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(D),Bd={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},Gd=function(t){this.rbush_=ha()(t,void 0),this.items_={}};Gd.prototype.insert=function(t,e){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[o(e)]=r},Gd.prototype.load=function(t,e){for(var r=new Array(e.length),n=0,i=e.length;n<i;n++){var a=t[n],s=e[n],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};r[n]=l,this.items_[o(s)]=l}this.rbush_.load(r)},Gd.prototype.remove=function(t){var e=o(t),r=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(r)},Gd.prototype.update=function(t,e){var r=this.items_[o(e)];Ve([r.minX,r.minY,r.maxX,r.maxY],t)||(this.remove(e),this.insert(t,e))},Gd.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},Gd.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})},Gd.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)},Gd.prototype.forEachInExtent=function(t,e,r){return this.forEach_(this.getInExtent(t),e,r)},Gd.prototype.forEach_=function(t,e,r){for(var n,i=0,o=t.length;i<o;i++)if(n=e.call(r,t[i]))return n;return n},Gd.prototype.isEmpty=function(){return d(this.items_)},Gd.prototype.clear=function(){this.rbush_.clear(),this.items_={}},Gd.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return je(e.minX,e.minY,e.maxX,e.maxY,t)},Gd.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]};var Ud=Gd,jd=function(t){function e(e,r){t.call(this,e),this.feature=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),qd=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:void 0,state:ni.READY,wrapX:void 0===r.wrapX||r.wrapX}),this.loader_=b,this.format_=r.format,this.overlaps_=null==r.overlaps||r.overlaps,this.url_=r.url,void 0!==r.loader?this.loader_=r.loader:void 0!==this.url_&&(te(this.format_,7),this.loader_=Ls(this.url_,this.format_)),this.strategy_=void 0!==r.strategy?r.strategy:kd;var n,i,o=void 0===r.useSpatialIndex||r.useSpatialIndex;this.featuresRtree_=o?new Ud:null,this.loadedExtentsRtree_=new Ud,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(r.features)?i=r.features:r.features&&(i=(n=r.features).getArray()),o||void 0!==n||(n=new G(i)),void 0!==i&&this.addFeaturesInternal(i),void 0!==n&&this.bindFeaturesCollection_(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=o(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var r=t.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new jd(Bd.ADDFEATURE,t))}},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[C(e,I.CHANGE,this.handleFeatureChange_,this),C(e,c,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var r=!0,n=e.getId();return void 0!==n?n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=e:(te(!(t in this.undefIdIndex_),30),this.undefIdIndex_[t]=e),r},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],r=[],n=[],i=0,a=t.length;i<a;i++){var s=t[i],l=o(s);this.addToIndex_(l,s)&&r.push(s)}for(var c=0,u=r.length;c<u;c++){var h=r[c],p=o(h);this.setupChangeEvents_(p,h);var d=h.getGeometry();if(d){var f=d.getExtent();e.push(f),n.push(h)}else this.nullGeometryFeatures_[p]=h}this.featuresRtree_&&this.featuresRtree_.load(e,n);for(var g=0,y=r.length;g<y;g++)this.dispatchEvent(new jd(Bd.ADDFEATURE,r[g]))},e.prototype.bindFeaturesCollection_=function(t){var e=!1;C(this,Bd.ADDFEATURE,function(r){e||(e=!0,t.push(r.feature),e=!1)}),C(this,Bd.REMOVEFEATURE,function(r){e||(e=!0,t.remove(r.feature),e=!1)}),C(t,l.ADD,function(t){e||(e=!0,this.addFeature(t.element),e=!1)},this),C(t,l.REMOVE,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)},this),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(_);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(var r in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};var n=new jd(Bd.CLEAR);this.dispatchEvent(n),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(t)?e(r):void 0})},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(r){if(r.getGeometry().intersectsExtent(t)){var n=e(r);if(n)return n}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray():this.featuresRtree_&&(t=this.featuresRtree_.getAll(),d(this.nullGeometryFeatures_)||Bt(t,p(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_.getInExtent(t)},e.prototype.getClosestFeatureToCoordinate=function(t,e){var r=t[0],n=t[1],i=null,o=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],l=e||L;return this.featuresRtree_.forEachInExtent(s,function(t){if(l(t)){var e=t.getGeometry(),c=a;if((a=e.closestPointXY(r,n,o,a))<c){i=t;var u=Math.sqrt(a);s[0]=r-u,s[1]=n-u,s[2]=r+u,s[3]=n+u}}}),i},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,r=o(e),n=e.getGeometry();if(n){var i=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(i,e)):this.featuresRtree_&&this.featuresRtree_.update(i,e)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);var a=e.getId();if(void 0!==a){var s=a.toString();r in this.undefIdIndex_?(delete this.undefIdIndex_[r],this.idIndex_[s]=e):this.idIndex_[s]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[s]=e)}else r in this.undefIdIndex_||(this.removeFromIdIndex_(e),this.undefIdIndex_[r]=e);this.changed(),this.dispatchEvent(new jd(Bd.CHANGEFEATURE,e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:o(t)in this.undefIdIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&d(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,e,r){var n=this,i=this.loadedExtentsRtree_,o=this.strategy_(t,e);this.loading=!1;for(var a=function(t,a){var s=o[t];i.forEachInExtent(s,function(t){return Be(t.extent,s)})||(n.loader_.call(n,s,e,r),i.insert(s,{extent:s.slice()}),n.loading=n.loader_!==b)},s=0,l=o.length;s<l;++s)a(s)},e.prototype.removeLoadedExtent=function(t){var e,r=this.loadedExtentsRtree_;r.forEachInExtent(t,function(r){if(Ve(r.extent,t))return e=r,!0}),e&&r.remove(e)},e.prototype.removeFeature=function(t){var e=o(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()},e.prototype.removeFeatureInternal=function(t){var e=o(t);this.featureChangeKeys_[e].forEach(_),delete this.featureChangeKeys_[e];var r=t.getId();void 0!==r?delete this.idIndex_[r.toString()]:delete this.undefIdIndex_[e],this.dispatchEvent(new jd(Bd.REMOVEFEATURE,t))},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===t){delete this.idIndex_[r],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e}(Fd),Wd={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},Hd="drawstart",Vd=function(t){function e(e,r){t.call(this,e),this.feature=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),Yd=function(t){function e(e){var r=e;r.stopDown||(r.stopDown=w),t.call(this,r),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(t){var e;t===hr.POINT||t===hr.MULTI_POINT?e=Wd.POINT:t===hr.LINE_STRING||t===hr.MULTI_LINE_STRING?e=Wd.LINE_STRING:t===hr.POLYGON||t===hr.MULTI_POLYGON?e=Wd.POLYGON:t===hr.CIRCLE&&(e=Wd.CIRCLE);return e}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_===Wd.POLYGON?3:2,this.maxPoints_=e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:L;var n,i=e.geometryFunction;if(!i)if(this.type_===hr.CIRCLE)i=function(t,e){var r=e||new Ts([NaN,NaN]),n=Le(t[0],t[1]);return r.setCenterAndRadius(t[0],Math.sqrt(n)),r};else{var o,a=this.mode_;a===Wd.POINT?o=Pn:a===Wd.LINE_STRING?o=ys:a===Wd.POLYGON&&(o=Wn),i=function(t,e){var r=e;return r?a===Wd.POLYGON?t[0].length?r.setCoordinates([t[0].concat([t[0][0]])]):r.setCoordinates([]):r.setCoordinates(t):r=new o(t),r}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Nd({source:new qd({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(n=Tc(),function(t,e){return n[t.getGeometry().getType()]}),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:qi,this.freehandCondition_,e.freehand?this.freehandCondition_=Fi:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Wi,C(this,k(bi.ACTIVE),this.updateState_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===I.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==Wd.POINT&&this.freehandCondition_(e);var r=e.type===Z.POINTERMOVE,n=!0;!this.freehand_&&this.lastDragTime_&&e.type===Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,r=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e),n=!1):this.freehand_&&e.type===Z.POINTERDOWN?n=!1:r?(n=e.type===Z.POINTERMOVE)&&this.freehand_?n=this.handlePointerMove_(e):(e.pointerEvent.pointerType==it||e.type===Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===Z.DBLCLICK&&(n=!1),t.prototype.handleEvent.call(this,e)&&n},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):!!this.condition_(t)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Q(Z.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0)},e.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var r=this.mode_===Wd.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||r?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t):(this.startDrawing_(t),this.mode_===Wd.POINT&&this.finishDrawing()),e=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,r=t.pixel,n=e[0]-r[0],i=e[1]-r[1],o=n*n+i*i;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t),!0},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var r=!1,n=[this.finishCoordinate_];if(this.mode_===Wd.LINE_STRING)r=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===Wd.POLYGON){var i=this.sketchCoords_;r=i[0].length>this.minPoints_,n=[i[0][0],i[0][i[0].length-2]]}if(r)for(var o=t.map,a=0,s=n.length;a<s;a++){var l=n[a],c=o.getPixelFromCoordinate(l),u=t.pixel,h=u[0]-c[0],p=u[1]-c[1],d=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(h*h+p*p)<=d){this.finishCoordinate_=l;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new ps(new Pn(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e,this.mode_===Wd.POINT?this.sketchCoords_=e.slice():this.mode_===Wd.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new ps(new ys(this.sketchLineCoords_)));var r=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new ps,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Vd(Hd,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,r,n,i=t.coordinate,o=this.sketchFeature_.getGeometry();(this.mode_===Wd.POINT?r=this.sketchCoords_:this.mode_===Wd.POLYGON?(r=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(i=this.finishCoordinate_.slice())):r=(e=this.sketchCoords_)[e.length-1],r[0]=i[0],r[1]=i[1],this.geometryFunction_(this.sketchCoords_,o),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(i);if(o.getType()==hr.POLYGON&&this.mode_!==Wd.POLYGON){this.sketchLine_||(this.sketchLine_=new ps);var a=o.getLinearRing(0);(n=this.sketchLine_.getGeometry())?(n.setFlatCoordinates(a.getLayout(),a.getFlatCoordinates()),n.changed()):(n=new ys(a.getFlatCoordinates(),a.getLayout()),this.sketchLine_.setGeometry(n))}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,r,n=t.coordinate,i=this.sketchFeature_.getGeometry();this.mode_===Wd.LINE_STRING?(this.finishCoordinate_=n.slice(),(r=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(n.slice()),this.geometryFunction_(r,i)):this.mode_===Wd.POLYGON&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(n.slice()),e&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,i)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();this.mode_===Wd.LINE_STRING?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===Wd.POLYGON&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,r=t.getGeometry();this.mode_===Wd.LINE_STRING?(e.pop(),this.geometryFunction_(e,r)):this.mode_===Wd.POLYGON&&(e[0].pop(),this.geometryFunction_(e,r),e=r.getCoordinates()),this.type_===hr.MULTI_POINT?t.setGeometry(new ds([e])):this.type_===hr.MULTI_LINE_STRING?t.setGeometry(new ms([e])):this.type_===hr.MULTI_POLYGON&&t.setGeometry(new Cs([e])),this.dispatchEvent(new Vd("drawend",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return t&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),t},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new Vd(Hd,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_(),this.overlay_.setMap(e?t:null)},e}(Xi),zd=function(t){function e(e,r,n){t.call(this,e),this.features=r,this.coordinate=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),Xd=function(t){function e(e){var r,n=e||{};if(t.call(this,n),this.lastCoordinate_=null,this.features_=void 0!==n.features?n.features:null,n.layers)if("function"==typeof n.layers)r=n.layers;else{var i=n.layers;r=function(t){return kt(i,t)}}else r=L;this.layerFilter_=r,this.hitTolerance_=n.hitTolerance?n.hitTolerance:0,this.lastFeature_=null,C(this,k(bi.ACTIVE),this.handleActiveChanged_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleDownEvent=function(t){if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new G([this.lastFeature_]);return this.dispatchEvent(new zd("translatestart",e,t.coordinate)),!0}return!1},e.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new G([this.lastFeature_]);return this.dispatchEvent(new zd("translateend",e,t.coordinate)),!0}return!1},e.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,r=e[0]-this.lastCoordinate_[0],n=e[1]-this.lastCoordinate_[1],i=this.features_||new G([this.lastFeature_]);i.forEach(function(t){var e=t.getGeometry();e.translate(r,n),t.setGeometry(e)}),this.lastCoordinate_=e,this.dispatchEvent(new zd("translating",i,e))}},e.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},e.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t){if(!this.features_||kt(this.features_.getArray(),t))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap();t.prototype.setMap.call(this,e),this.updateState_(r)},e.prototype.handleActiveChanged_=function(){this.updateState_(null)},e.prototype.updateState_=function(t){var e=this.getMap(),r=this.getActive();e&&r||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},e}(Xi);function Kd(t){return t.feature?t.feature:t.element?t.element:void 0}var $d=function(t){function e(e){var r=e||{},n=r;n.handleDownEvent||(n.handleDownEvent=L),n.stopDown||(n.stopDown=w),t.call(this,n),this.source_=r.source?r.source:null,this.vertex_=void 0===r.vertex||r.vertex,this.edge_=void 0===r.edge||r.edge,this.features_=r.features?r.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,this.sortByDistance_=function(t,e){return be(this.pixelCoordinate_,t.segment)-be(this.pixelCoordinate_,e.segment)}.bind(this),this.rBush_=new Ud,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t,e){var r=void 0===e||e,n=o(t),i=t.getGeometry();if(i){var a=this.SEGMENT_WRITERS_[i.getType()];a&&(this.indexedFeaturesExtents_[n]=i.getExtent([1/0,1/0,-1/0,-1/0]),a.call(this,t,i))}r&&(this.featureChangeListenerKeys_[n]=C(t,I.CHANGE,this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var r=this.snapTo(e.pixel,e.coordinate,e.map);return r.snapped&&(e.coordinate=r.vertex.slice(0,2),e.pixel=r.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=Kd(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=Kd(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var r=o(e);r in this.pendingFeatures_||(this.pendingFeatures_[r]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=p(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var r=void 0===e||e,n=o(t),i=this.indexedFeaturesExtents_[n];if(i){var a=this.rBush_,s=[];a.forEachInExtent(i,function(e){t===e.feature&&s.push(e)});for(var l=s.length-1;l>=0;--l)a.remove(s[l])}r&&(_(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},e.prototype.setMap=function(e){var r=this.getMap(),n=this.featuresListenerKeys_,i=this.getFeatures_();r&&(n.forEach(_),n.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?n.push(C(this.features_,l.ADD,this.handleFeatureAdd_,this),C(this.features_,l.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push(C(this.source_,Bd.ADDFEATURE,this.handleFeatureAdd_,this),C(this.source_,Bd.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,r){var n=Oe([r.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),r.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),i=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(i=i.filter(function(t){return t.feature.getGeometry().getType()!==hr.CIRCLE}));var o,a,s,l,c=!1,u=null,h=null;if(i.length>0){this.pixelCoordinate_=e,i.sort(this.sortByDistance_);var p=i[0].segment,d=i[0].feature.getGeometry().getType()===hr.CIRCLE;this.vertex_&&!this.edge_?(o=r.getPixelFromCoordinate(p[0]),a=r.getPixelFromCoordinate(p[1]),s=Le(t,o),l=Le(t,a),Math.sqrt(Math.min(s,l))<=this.pixelTolerance_&&(c=!0,u=s>l?p[1]:p[0],h=r.getPixelFromCoordinate(u))):this.edge_&&(u=d?function(t,e){var r=e.getRadius(),n=e.getCenter(),i=n[0],o=n[1],a=t[0]-i,s=t[1]-o;0===a&&0===s&&(a=1);var l=Math.sqrt(a*a+s*s);return[i+r*a/l,o+r*s/l]}(e,i[0].feature.getGeometry()):Te(e,p),we(t,h=r.getPixelFromCoordinate(u))<=this.pixelTolerance_&&(c=!0,this.vertex_&&!d&&(o=r.getPixelFromCoordinate(p[0]),a=r.getPixelFromCoordinate(p[1]),s=Le(h,o),l=Le(h,a),Math.sqrt(Math.min(s,l))<=this.pixelTolerance_&&(u=s>l?p[1]:p[0],h=r.getPixelFromCoordinate(u))))),c&&(h=[Math.round(h[0]),Math.round(h[1])])}return{snapped:c,vertex:u,vertexPixel:h}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){for(var r=Vn(e).getCoordinates()[0],n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,segment:o};this.rBush_.insert(Oe(o),a)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),n=0;n<r.length;++n){var i=this.SEGMENT_WRITERS_[r[n].getType()];i&&i.call(this,t,r[n])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,segment:o};this.rBush_.insert(Oe(o),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert(Oe(l),c)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c){var h=l.slice(c,c+2),p={feature:t,segment:h};this.rBush_.insert(Oe(h),p)}},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),n={feature:t,segment:[r,r]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert(Oe(l),c)}},e}(Xi),Jd={SELECT:"select"},Zd=function(t){function e(e,r,n,i){t.call(this,e),this.selected=r,this.deselected=n,this.mapBrowserEvent=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function Qd(t){if(!this.condition_(t))return!0;var e=this.addCondition_(t),r=this.removeCondition_(t),n=this.toggleCondition_(t),i=!e&&!r&&!n,o=t.map,a=this.getFeatures(),s=[],l=[];if(i){h(this.featureLayerAssociation_),o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return l.push(t),this.addFeatureLayerAssociation_(t,e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var c=a.getLength()-1;c>=0;--c){var u=a.item(c),p=l.indexOf(u);p>-1?l.splice(p,1):(a.remove(u),s.push(u))}0!==l.length&&a.extend(l)}else{o.forEachFeatureAtPixel(t.pixel,function(t,i){if(this.filter_(t,i))return!e&&!n||kt(a.getArray(),t)?(r||n)&&kt(a.getArray(),t)&&(s.push(t),this.removeFeatureLayerAssociation_(t)):(l.push(t),this.addFeatureLayerAssociation_(t,i)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var d=s.length-1;d>=0;--d)a.remove(s[d]);a.extend(l)}return(l.length>0||s.length>0)&&this.dispatchEvent(new Zd(Jd.SELECT,l,s,t)),Ui(t)}function tf(){var t=Tc();return Bt(t[hr.POLYGON],t[hr.LINE_STRING]),Bt(t[hr.GEOMETRY_COLLECTION],t[hr.LINE_STRING]),function(e,r){return e.getGeometry()?t[e.getGeometry().getType()]:null}}var ef=function(t){function e(e){t.call(this,{handleEvent:Qd});var r=e||{};this.condition_=r.condition?r.condition:ji,this.addCondition_=r.addCondition?r.addCondition:Gi,this.removeCondition_=r.removeCondition?r.removeCondition:Gi,this.toggleCondition_=r.toggleCondition?r.toggleCondition:Wi,this.multi_=!!r.multi&&r.multi,this.filter_=r.filter?r.filter:L,this.hitTolerance_=r.hitTolerance?r.hitTolerance:0;var n,i=new Nd({source:new qd({useSpatialIndex:!1,features:r.features,wrapX:r.wrapX}),style:r.style?r.style:tf(),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=i,r.layers)if("function"==typeof r.layers)n=r.layers;else{var o=r.layers;n=function(t){return kt(o,t)}}else n=L;this.layerFilter_=n,this.featureLayerAssociation_={};var a=this.getFeatures();C(a,l.ADD,this.addFeature_,this),C(a,l.REMOVE,this.removeFeature_,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[o(t)]=e},e.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.getLayer=function(t){return this.featureLayerAssociation_[o(t)]},e.prototype.getOverlay=function(){return this.featureOverlay_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap(),n=this.getFeatures();r&&n.forEach(r.unskipFeature.bind(r)),t.prototype.setMap.call(this,e),this.featureOverlay_.setMap(e),e&&n.forEach(e.skipFeature.bind(e))},e.prototype.addFeature_=function(t){var e=this.getMap();e&&e.skipFeature(t.element)},e.prototype.removeFeature_=function(t){var e=this.getMap();e&&e.unskipFeature(t.element)},e.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[o(t)]},e}(Ii),rf=1,nf="modifyend",of=function(t){function e(e,r,n){t.call(this,e),this.features=r,this.mapBrowserEvent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function af(t,e){return t.index-e.index}function sf(t,e){var r=e.geometry;if(r.getType()===hr.CIRCLE){var n=r;if(e.index===rf){var i=Le(n.getCenter(),t),o=Math.sqrt(i)-n.getRadius();return o*o}}return be(t,e.segment)}function lf(t,e){var r=e.geometry;return r.getType()===hr.CIRCLE&&e.index===rf?r.getClosestPoint(t):Te(t,e.segment)}function cf(){var t=Tc();return function(e,r){return t[hr.POINT]}}var uf=function(t){function e(e){var r;if(t.call(this,e),this.condition_=e.condition?e.condition:Yi,this.defaultDeleteCondition_=function(t){return Ni(t)&&ji(t)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Fi,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new Ud,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Nd({source:new qd({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:cf(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,e.source?(this.source_=e.source,r=new G(this.source_.getFeatures()),C(this.source_,Bd.ADDFEATURE,this.handleSourceAdd_,this),C(this.source_,Bd.REMOVEFEATURE,this.handleSourceRemove_,this)):r=e.features,!r)throw new Error("The modify interaction requires features or a source");this.features_=r,this.features_.forEach(this.addFeature_.bind(this)),C(this.features_,l.ADD,this.handleFeatureAdd_,this),C(this.features_,l.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature_=function(t){var e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),C(t,I.CHANGE,this.handleFeatureChange_,this)},e.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new of("modifystart",this.features_,t)))},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),T(t,I.CHANGE,this.handleFeatureChange_,this)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,r=[];e.forEach(function(e){t===e.feature&&r.push(e)});for(var n=r.length-1;n>=0;--n)e.remove(r[n])},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),n={feature:t,geometry:e,segment:[r,r]};this.rBush_.insert(e.getExtent(),n)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:t,geometry:e,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:t,geometry:e,index:n,segment:o};this.rBush_.insert(Oe(o),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,geometry:e,depth:[n],index:a,segment:l};this.rBush_.insert(Oe(l),c)}},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:t,geometry:e,depth:[n],index:a,segment:l};this.rBush_.insert(Oe(l),c)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c){var h=l.slice(c,c+2),p={feature:t,geometry:e,depth:[a,n],index:c,segment:h};this.rBush_.insert(Oe(h),p)}},e.prototype.writeCircleGeometry_=function(t,e){var r=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[r,r]},i={feature:t,geometry:e,index:rf,segment:[r,r]},o=[n,i];n.featureSegments=i.featureSegments=o,this.rBush_.insert(We(r),n),this.rBush_.insert(e.getExtent(),i)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),n=0;n<r.length;++n)this.SEGMENT_WRITERS_[r[n].getType()].call(this,t,r[n])},e.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new ps(new Pn(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},e.prototype.handleEvent=function(e){return!e.pointerEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=Z.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(r=!(e.type!=Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!r);var r},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,r=0,n=this.dragSegments_.length;r<n;++r){for(var i=this.dragSegments_[r],o=i[0],a=o.depth,s=o.geometry,l=void 0,c=o.segment,u=i[1];e.length<s.getStride();)e.push(c[u][e.length]);switch(s.getType()){case hr.POINT:l=e,c[0]=c[1]=e;break;case hr.MULTI_POINT:(l=s.getCoordinates())[o.index]=e,c[0]=c[1]=e;break;case hr.LINE_STRING:(l=s.getCoordinates())[o.index+u]=e,c[u]=e;break;case hr.MULTI_LINE_STRING:case hr.POLYGON:(l=s.getCoordinates())[a[0]][o.index+u]=e,c[u]=e;break;case hr.MULTI_POLYGON:(l=s.getCoordinates())[a[1]][a[0]][o.index+u]=e,c[u]=e;break;case hr.CIRCLE:c[0]=c[1]=e,0===o.index?(this.changingFeature_=!0,s.setCenter(e),this.changingFeature_=!1):(this.changingFeature_=!0,s.setRadius(we(s.getCenter(),e)),this.changingFeature_=!1)}l&&this.setGeometryCoordinates_(s,l)}this.createOrUpdateVertexFeature_(e)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var n=[],i=r.getGeometry().getCoordinates(),a=Oe([i]),s=this.rBush_.getInExtent(a),l={};s.sort(af);for(var c=0,u=s.length;c<u;++c){var h=s[c],p=h.segment,d=o(h.feature),f=h.depth;if(f&&(d+="-"+f.join("-")),l[d]||(l[d]=new Array(2)),h.geometry.getType()===hr.CIRCLE&&h.index===rf)_e(lf(e,h),i)&&!l[d][0]&&(this.dragSegments_.push([h,0]),l[d][0]=h);else if(_e(p[0],i)&&!l[d][0])this.dragSegments_.push([h,0]),l[d][0]=h;else if(_e(p[1],i)&&!l[d][1]){if((h.geometry.getType()===hr.LINE_STRING||h.geometry.getType()===hr.MULTI_LINE_STRING)&&l[d][0]&&0===l[d][0].index)continue;this.dragSegments_.push([h,1]),l[d][1]=h}else this.insertVertexCondition_(t)&&o(p)in this.vertexSegments_&&!l[d][0]&&!l[d][1]&&n.push([h,i])}n.length&&this.willModifyFeatures_(t);for(var g=n.length-1;g>=0;--g)this.insertVertex_.apply(this,n[g])}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var r=this.dragSegments_[e][0],n=r.geometry;if(n.getType()===hr.CIRCLE){var i=n.getCenter(),o=r.featureSegments[0],a=r.featureSegments[1];o.segment[0]=o.segment[1]=i,a.segment[0]=a.segment[1]=i,this.rBush_.update(We(i),o),this.rBush_.update(n.getExtent(),a)}else this.rBush_.update(Oe(r.segment),r)}return this.modified_&&(this.dispatchEvent(new of(nf,this.features_,t)),this.modified_=!1),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)},e.prototype.handlePointerAtPixel_=function(t,e){var r=e.getCoordinateFromPixel(t),n=Ne(We(r),e.getView().getResolution()*this.pixelTolerance_),i=this.rBush_.getInExtent(n);if(i.length>0){i.sort(function(t,e){return sf(r,t)-sf(r,e)});var a=i[0],s=a.segment,l=lf(r,a),c=e.getPixelFromCoordinate(l),u=we(t,c);if(u<=this.pixelTolerance_){var h={};if(a.geometry.getType()===hr.CIRCLE&&a.index===rf)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{var p=e.getPixelFromCoordinate(s[0]),d=e.getPixelFromCoordinate(s[1]),f=Le(c,p),g=Le(c,d);u=Math.sqrt(Math.min(f,g)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(l=f>g?s[1]:s[0]),this.createOrUpdateVertexFeature_(l);for(var y=1,m=i.length;y<m;++y){var C=i[y].segment;if(!(_e(s[0],C[0])&&_e(s[1],C[1])||_e(s[0],C[1])&&_e(s[1],C[0])))break;h[o(C)]=!0}}return h[o(s)]=!0,void(this.vertexSegments_=h)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var r,n=t.segment,i=t.feature,o=t.geometry,a=t.depth,s=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case hr.MULTI_LINE_STRING:case hr.POLYGON:(r=o.getCoordinates())[a[0]].splice(s+1,0,e);break;case hr.MULTI_POLYGON:(r=o.getCoordinates())[a[1]][a[0]].splice(s+1,0,e);break;case hr.LINE_STRING:(r=o.getCoordinates()).splice(s+1,0,e);break;default:return}this.setGeometryCoordinates_(o,r);var l=this.rBush_;l.remove(t),this.updateSegmentIndices_(o,s,a,1);var c={segment:[n[0],e],feature:i,geometry:o,depth:a,index:s};l.insert(Oe(c.segment),c),this.dragSegments_.push([c,1]);var u={segment:[e,n[1]],feature:i,geometry:o,depth:a,index:s+1};l.insert(Oe(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Z.POINTERDRAG){var t=this.lastPointerEvent_;return this.willModifyFeatures_(t),this.removeVertex_(),this.dispatchEvent(new of(nf,this.features_,t)),this.modified_=!1,!0}return!1},e.prototype.removeVertex_=function(){var t,e,r,n,i,a,s,l,c,u,h,p=this.dragSegments_,d={},f=!1;for(i=p.length-1;i>=0;--i)h=o((u=(r=p[i])[0]).feature),u.depth&&(h+="-"+u.depth.join("-")),h in d||(d[h]={}),0===r[1]?(d[h].right=u,d[h].index=u.index):1==r[1]&&(d[h].left=u,d[h].index=u.index+1);for(h in d){switch(c=d[h].right,s=d[h].left,(l=(a=d[h].index)-1)<0&&(l=0),t=e=(n=(u=void 0!==s?s:c).geometry).getCoordinates(),f=!1,n.getType()){case hr.MULTI_LINE_STRING:e[u.depth[0]].length>2&&(e[u.depth[0]].splice(a,1),f=!0);break;case hr.LINE_STRING:e.length>2&&(e.splice(a,1),f=!0);break;case hr.MULTI_POLYGON:t=t[u.depth[1]];case hr.POLYGON:(t=t[u.depth[0]]).length>4&&(a==t.length-1&&(a=0),t.splice(a,1),f=!0,0===a&&(t.pop(),t.push(t[0]),l=t.length-1))}if(f){this.setGeometryCoordinates_(n,e);var g=[];if(void 0!==s&&(this.rBush_.remove(s),g.push(s.segment[0])),void 0!==c&&(this.rBush_.remove(c),g.push(c.segment[1])),void 0!==s&&void 0!==c){var y={depth:u.depth,feature:u.feature,geometry:u.geometry,index:l,segment:g};this.rBush_.insert(Oe(y.segment),y)}this.updateSegmentIndices_(n,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),p.length=0}}return f},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,r,n){this.rBush_.forEachInExtent(t.getExtent(),function(i){i.geometry===t&&(void 0===r||void 0===i.depth||Ut(i.depth,r))&&i.index>e&&(i.index+=n)})},e}(Xi),hf=function(t){function e(e,r,n,i){t.call(this,e),this.features=n,this.file=r,this.projection=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function pf(t){for(var e=t.dataTransfer.files,r=0,n=e.length;r<n;++r){var i=e.item(r),o=new FileReader;o.addEventListener(I.LOAD,this.handleResult_.bind(this,i)),o.readAsText(i)}}function df(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}var ff=function(t){function e(e){var r=e||{};t.call(this,{handleEvent:L}),this.formatConstructors_=r.formatConstructors?r.formatConstructors:[],this.projection_=r.projection?jr(r.projection):null,this.dropListenKeys_=null,this.source_=r.source||null,this.target=r.target?r.target:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleResult_=function(t,e){var r=e.target.result,n=this.getMap(),i=this.projection_;i||(i=n.getView().getProjection());for(var o=this.formatConstructors_,a=[],s=0,l=o.length;s<l;++s){var c=new o[s];if((a=this.tryReadFeatures_(c,r,{featureProjection:i}))&&a.length>0)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(a)),this.dispatchEvent(new hf("addfeatures",t,a,i))},e.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[C(e,I.DROP,pf,this),C(e,I.DRAGENTER,df,this),C(e,I.DRAGOVER,df,this),C(e,I.DROP,df,this)]}},e.prototype.setActive=function(e){t.prototype.setActive.call(this,e),e?this.registerListeners_():this.unregisterListeners_()},e.prototype.setMap=function(e){this.unregisterListeners_(),t.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},e.prototype.tryReadFeatures_=function(t,e,r){try{return t.readFeatures(e,r)}catch(t){return null}},e.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(_),this.dropListenKeys_=null)},e}(Ii),gf="preload",yf="useInterimTilesOnError",mf=function(t){function e(e){var r=e||{},n=u({},r);delete n.preload,delete n.useInterimTilesOnError,t.call(this,n),this.setPreload(void 0!==r.preload?r.preload:0),this.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),this.type=yo.TILE}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPreload=function(){return this.get(gf)},e.prototype.setPreload=function(t){this.set(gf,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(yf)},e.prototype.setUseInterimTilesOnError=function(t){this.set(yf,t)},e}(Ci);mf.prototype.getSource;var Cf=mf,vf=function(t){function e(e){var r=e||{};t.call(this,r),this.type=yo.IMAGE}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ci);vf.prototype.getSource;var Tf=vf,_f=function(t){function e(e){t.call(this,{attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.features=[],this.geometryFunction=e.geometryFunction||function(t){var e=t.getGeometry();return te(e.getType()==hr.POINT,10),e},this.source=e.source,C(this.source,I.CHANGE,this.refresh,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDistance=function(){return this.distance},e.prototype.getSource=function(){return this.source},e.prototype.loadFeatures=function(t,e,r){this.source.loadFeatures(t,e,r),e!==this.resolution&&(this.clear(),this.resolution=e,this.cluster(),this.addFeatures(this.features))},e.prototype.setDistance=function(t){this.distance=t,this.refresh()},e.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features),t.prototype.refresh.call(this)},e.prototype.cluster=function(){if(void 0!==this.resolution){this.features.length=0;for(var t=[1/0,1/0,-1/0,-1/0],e=this.distance*this.resolution,r=this.source.getFeatures(),n={},i=0,a=r.length;i<a;i++){var s=r[i];if(!(o(s)in n)){var l=this.geometryFunction(s);if(l){We(l.getCoordinates(),t),Ne(t,e,t);var c=this.source.getFeaturesInExtent(t);c=c.filter(function(t){var e=o(t);return!(e in n||(n[e]=!0,0))}),this.features.push(this.createCluster(c))}}}}},e.prototype.createCluster=function(t){for(var e=[0,0],r=t.length-1;r>=0;--r){var n=this.geometryFunction(t[r]);n?ve(e,n.getCoordinates()):t.splice(r,1)}Ee(e,1/t.length);var i=new ps(new Pn(e));return i.set("features",t),i},e}(qd),Sf=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,n,fo.IDLE),this.src_=i,this.image_=new Image,null!==o&&(this.image_.crossOrigin=o),this.imageListenerKeys_=null,this.state=fo.IDLE,this.imageLoadFunction_=a}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=fo.ERROR,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=nr(this.extent)/this.image_.height),this.state=fo.LOADED,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=fo.IDLE&&this.state!=fo.ERROR||(this.state=fo.LOADING,this.changed(),this.imageListenerKeys_=[v(this.image_,I.ERROR,this.handleImageError_,this),v(this.image_,I.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},e.prototype.setImage=function(t){this.image_=t},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(po);function Ef(t,e,r,n){var i=Kr(r,e,t),o=qr(e,n,r),a=e.getMetersPerUnit();void 0!==a&&(o*=a);var s=t.getMetersPerUnit();void 0!==s&&(o/=s);var l=t.getExtent();if(!l||Fe(l,i)){var c=qr(t,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function Lf(t,e,r,n){var i=r-t,o=n-e,a=Math.sqrt(i*i+o*o);return[Math.round(r+i/a),Math.round(n+o/a)]}function wf(t,e,r,n,i,o,a,s,l,c,u){var h=Kn(Math.round(r*t),Math.round(r*e));if(0===l.length)return h.canvas;h.scale(r,r);var p=[1/0,1/0,-1/0,-1/0];l.forEach(function(t,e,r){Ye(p,t.extent)});var d=sr(p),f=nr(p),g=Kn(Math.round(r*d/n),Math.round(r*f/n)),y=r/n;l.forEach(function(t,e,r){var n=t.extent[0]-p[0],i=-(t.extent[3]-p[3]),o=sr(t.extent),a=nr(t.extent);g.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,n*y,i*y,o*y,a*y)});var m=or(a);return s.getTriangles().forEach(function(t,e,i){var a=t.source,s=t.target,l=a[0][0],c=a[0][1],u=a[1][0],d=a[1][1],f=a[2][0],y=a[2][1],C=(s[0][0]-m[0])/o,v=-(s[0][1]-m[1])/o,T=(s[1][0]-m[0])/o,_=-(s[1][1]-m[1])/o,S=(s[2][0]-m[0])/o,E=-(s[2][1]-m[1])/o,L=l,w=c;l=0,c=0;var b=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),o=r+1;o<e;o++){var a=Math.abs(t[o][r]);a>i&&(i=a,n=o)}if(0===i)return null;var s=t[n];t[n]=t[r],t[r]=s;for(var l=r+1;l<e;l++)for(var c=-t[l][r]/t[r][r],u=r;u<e+1;u++)r==u?t[l][u]=0:t[l][u]+=c*t[r][u]}for(var h=new Array(e),p=e-1;p>=0;p--){h[p]=t[p][e]/t[p][p];for(var d=p-1;d>=0;d--)t[d][e]-=t[d][p]*h[p]}return h}([[u-=L,d-=w,0,0,T-C],[f-=L,y-=w,0,0,S-C],[0,0,u,d,_-v],[0,0,f,y,E-v]]);if(b){h.save(),h.beginPath();var A=(C+T+S)/3,x=(v+_+E)/3,P=Lf(A,x,C,v),R=Lf(A,x,T,_),I=Lf(A,x,S,E);h.moveTo(R[0],R[1]),h.lineTo(P[0],P[1]),h.lineTo(I[0],I[1]),h.clip(),h.transform(b[0],b[2],b[1],b[3],C,v),h.translate(p[0]-L,p[3]-w),h.scale(n/r,-n/r),h.drawImage(g.canvas,0,0),h.restore()}}),u&&(h.save(),h.strokeStyle="black",h.lineWidth=1,s.getTriangles().forEach(function(t,e,r){var n=t.target,i=(n[0][0]-m[0])/o,a=-(n[0][1]-m[1])/o,s=(n[1][0]-m[0])/o,l=-(n[1][1]-m[1])/o,c=(n[2][0]-m[0])/o,u=-(n[2][1]-m[1])/o;h.beginPath(),h.moveTo(s,l),h.lineTo(i,a),h.lineTo(c,u),h.closePath(),h.stroke()}),h.restore()),h.canvas}var bf=function(t,e,r,n,i){this.sourceProj_=t,this.targetProj_=e;var o={},a=Xr(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&sr(n)==sr(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?sr(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?sr(this.targetProj_.getExtent()):null;var s=or(r),l=ar(r),c=Qe(r),u=Ze(r),h=this.transformInv_(s),p=this.transformInv_(l),d=this.transformInv_(c),f=this.transformInv_(u);if(this.addQuad_(s,l,c,u,h,p,d,f,10),this.wrapsXInSource_){var g=1/0;this.triangles_.forEach(function(t,e,r){g=Math.min(g,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-g>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-g>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-g>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-g>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var r=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-r<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}o={}};bf.prototype.addTriangle_=function(t,e,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[t,e,r]})},bf.prototype.addQuad_=function(t,e,r,n,i,o,a,s,l){var c=Oe([i,o,a,s]),u=this.sourceWorldWidth_?sr(c)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&u>.5&&u<1,d=!1;if(l>0){this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(d=sr(Oe([t,e,r,n]))/this.targetWorldWidth_>.25||d);!p&&this.sourceProj_.isGlobal()&&u&&(d=u>.25||d)}if(d||!this.maxSourceExtent_||lr(c,this.maxSourceExtent_)){if(!(d||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1]))){if(!(l>0))return;d=!0}if(l>0){if(!d){var f,g=[(t[0]+r[0])/2,(t[1]+r[1])/2],y=this.transformInv_(g);f=p?(ue(i[0],h)+ue(a[0],h))/2-ue(y[0],h):(i[0]+a[0])/2-y[0];var m=(i[1]+a[1])/2-y[1];d=f*f+m*m>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var C=[(e[0]+r[0])/2,(e[1]+r[1])/2],v=this.transformInv_(C),T=[(n[0]+t[0])/2,(n[1]+t[1])/2],_=this.transformInv_(T);this.addQuad_(t,e,C,T,i,o,v,_,l-1),this.addQuad_(T,C,r,n,_,v,a,s,l-1)}else{var S=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(S),L=[(r[0]+n[0])/2,(r[1]+n[1])/2],w=this.transformInv_(L);this.addQuad_(t,S,L,n,i,E,w,s,l-1),this.addQuad_(S,e,r,L,E,o,a,w,l-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,r,n,i,a,s),this.addTriangle_(t,e,r,i,o,a)}},bf.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,r,n){var i=e.source;ze(t,i[0]),ze(t,i[1]),ze(t,i[2])}),t},bf.prototype.getTriangles=function(){return this.triangles_};var Af=bf,xf=function(t){function e(e,r,n,i,o,a){var s=e.getExtent(),l=r.getExtent(),c=l?ir(n,l):n,u=Ef(e,r,tr(c),i),h=new Af(e,r,c,s,u*ho),p=a(h.calculateSourceExtent(),u,o),d=fo.LOADED;p&&(d=fo.IDLE);var f=p?p.getPixelRatio():1;t.call(this,n,i,f,d),this.targetProj_=r,this.maxSourceExtent_=s,this.triangulation_=h,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=p,this.sourcePixelRatio_=f,this.canvas_=null,this.sourceListenerKey_=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==fo.LOADING&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==fo.LOADED){var e=sr(this.targetExtent_)/this.targetResolution_,r=nr(this.targetExtent_)/this.targetResolution_;this.canvas_=wf(e,r,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==fo.IDLE){this.state=fo.LOADING,this.changed();var t=this.sourceImage_.getState();t==fo.LOADED||t==fo.ERROR?this.reproject_():(this.sourceListenerKey_=C(this.sourceImage_,I.CHANGE,function(t){var e=this.sourceImage_.getState();e!=fo.LOADED&&e!=fo.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){_(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(po),Pf=function(t){function e(e,r){t.call(this,e),this.image=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P);function Rf(t,e){t.getImage().src=e}var If=function(t){function e(e){t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state}),this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Dt(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,r,n){var i=this.getProjection();if(i&&n&&!Yr(i,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Yr(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Ve(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new xf(i,n,t,e,r,function(t,e,r){return this.getImageInternal(t,e,r,i)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return i&&(n=i),this.getImageInternal(t,e,r,n)},e.prototype.getImageInternal=function(t,e,r,i){return n()},e.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case fo.LOADING:this.loading=!0,this.dispatchEvent(new Pf("imageloadstart",e));break;case fo.LOADED:this.loading=!1,this.dispatchEvent(new Pf("imageloadend",e));break;case fo.ERROR:this.loading=!1,this.dispatchEvent(new Pf("imageloaderror",e))}},e}(Fd);function Mf(t,e){var r=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&r.push(t+"="+encodeURIComponent(e[t]))});var n=r.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+n}var Of=[101,101],Nf=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:r.projection,resolutions:r.resolutions}),this.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,this.url_=r.url,this.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:Rf,this.params_=r.params||{},this.v13_=!0,this.updateV13_(),this.serverType_=r.serverType,this.hidpi_=void 0===r.hidpi||r.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==r.ratio?r.ratio:1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getGetFeatureInfoUrl=function(t,e,r,n){if(void 0!==this.url_){var i=jr(r),o=this.getProjection();o&&o!==i&&(e=Ef(o,i,t,e),t=Kr(t,i,o));var a=rr(t,e,0,Of),s={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};u(s,this.params_,n);var l=Math.floor((t[0]-a[0])/e),c=Math.floor((a[3]-t[1])/e);return s[this.v13_?"I":"X"]=l,s[this.v13_?"J":"Y"]=c,this.getRequestUrl_(a,Of,1,o||i,s)}},e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,r,n){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==r||this.hidpi_&&void 0!==this.serverType_||(r=1);var i=e/r,o=tr(t),a=rr(o,i,0,[Math.ceil(sr(t)/i),Math.ceil(nr(t)/i)]),s=rr(o,i,0,[Math.ceil(this.ratio_*sr(t)/i),Math.ceil(this.ratio_*nr(t)/i)]),l=this.image_;if(l&&this.renderedRevision_==this.getRevision()&&l.getResolution()==e&&l.getPixelRatio()==r&&Be(l.getExtent(),a))return l;var c={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};u(c,this.params_),this.imageSize_[0]=Math.round(sr(s)/i),this.imageSize_[1]=Math.round(nr(s)/i);var h=this.getRequestUrl_(s,this.imageSize_,r,n,c);return this.image_=new Sf(s,e,r,h,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),C(this.image_,I.CHANGE,this.handleImageChange,this),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,r,n,i){if(te(void 0!==this.url_,9),i[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(i.STYLES=""),1!=r)switch(this.serverType_){case"geoserver":var o=90*r+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+o:i.FORMAT_OPTIONS="dpi:"+o;break;case"mapserver":i.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":i.DPI=90*r;break;default:te(!1,8)}i.WIDTH=e[0],i.HEIGHT=e[1];var a,s=n.getAxisOrientation();return a=this.v13_&&"ne"==s.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,i.BBOX=a.join(","),Mf(this.url_,i)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){u(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},e.prototype.updateV13_=function(){var t=this.params_.VERSION||"1.3.0";this.v13_=function(t,e){for(var r=(""+t).split("."),n="1.3".split("."),i=0;i<Math.max(r.length,n.length);i++){var o=parseInt(r[i]||"0",10),a=parseInt(n[i]||"0",10);if(o>a)return 1;if(a>o)return-1}return 0}(t)>=0},e}(If);function kf(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function Df(t,e,r){return t+"/"+e+"/"+r}function Ff(t){return Df(t[0],t[1],t[2])}function Bf(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){return a?t.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,function(){return(-a[2]-1).toString()}).replace(o,function(){var t=a[0],r=e.getFullTileRange(t);return te(r,55),(r.getHeight()+a[2]).toString()}):void 0}}function Gf(t){return 1===t.length?t[0]:function(e,r,n){if(e){var i=ue(function(t){return(t[1]<<t[0])+t[2]}(e),t.length);return t[i](e,r,n)}}}function Uf(t,e,r){}function jf(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n,i=r[1].charCodeAt(0),o=r[2].charCodeAt(0);for(n=i;n<=o;++n)e.push(t.replace(r[0],String.fromCharCode(n)));return e}if(r=r=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}var qf=function(t){function e(e,r,n){t.call(this);var i=n||{};this.tileCoord=e,this.state=r,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.changed=function(){this.dispatchEvent(I.CHANGE)},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Qt.LOADED)return t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==Qt.LOADED){t.interimTile=null;break}t.getState()==Qt.LOADING?e=t:t.getState()==Qt.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){this.state=t,this.changed()},e.prototype.load=function(){},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n=e-r+1e3/60;return n>=this.transition_?1:Ae(n/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(R);function Wf(){var t=Kn(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}var Hf=function(t){function e(e,r,n,i,o,a){t.call(this,e,r,a),this.crossOrigin_=i,this.src_=n,this.image_=new Image,null!==i&&(this.image_.crossOrigin=i),this.imageListenerKeys_=null,this.tileLoadFunction_=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==Qt.LOADING&&(this.unlistenImage_(),this.image_=Wf()),this.interimTile&&this.interimTile.dispose(),this.state=Qt.ABORT,this.changed(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.image_},e.prototype.getKey=function(){return this.src_},e.prototype.handleImageError_=function(){this.state=Qt.ERROR,this.unlistenImage_(),this.image_=Wf(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Qt.LOADED:this.state=Qt.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==Qt.ERROR&&(this.state=Qt.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Qt.IDLE&&(this.state=Qt.LOADING,this.changed(),this.imageListenerKeys_=[v(this.image_,I.ERROR,this.handleImageError_,this),v(this.image_,I.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},e.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(_),this.imageListenerKeys_=null},e}(qf),Vf=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast(),r=e.tileCoord[0].toString();if(r in t&&t[r].contains(e.tileCoord))break;this.pop().dispose()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(Ff(e.tileCoord)),e.dispose())},this)}},e}(vo),Yf=function(t){function e(e,r,n,i,o,a,s,l,c,u,h){t.call(this,o,Qt.IDLE),this.renderEdges_=void 0!==h&&h,this.pixelRatio_=s,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=a||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;var p=i.getTileCoordExtent(this.wrappedTileCoord_),d=this.targetTileGrid_.getExtent(),f=this.sourceTileGrid_.getExtent(),g=d?ir(p,d):p;if(0!==Je(g)){var y=e.getExtent();y&&(f=f?ir(f,y):y);var m=i.getResolution(this.wrappedTileCoord_[0]),C=Ef(e,n,tr(g),m);if(!isFinite(C)||C<=0)this.state=Qt.EMPTY;else{var v=void 0!==u?u:ho;if(this.triangulation_=new Af(e,n,g,f,C*v),0!==this.triangulation_.getTriangles().length){this.sourceZ_=r.getZForResolution(C);var T=this.triangulation_.calculateSourceExtent();if(f&&(e.canWrapX()?(T[1]=oe(T[1],f[1],f[3]),T[3]=oe(T[3],f[1],f[3])):T=ir(T,f)),Je(T)){for(var _=r.getTileRangeForExtentAndZ(T,this.sourceZ_),S=_.minX;S<=_.maxX;S++)for(var E=_.minY;E<=_.maxY;E++){var L=c(this.sourceZ_,S,E,s);L&&this.sourceTiles_.push(L)}0===this.sourceTiles_.length&&(this.state=Qt.EMPTY)}else this.state=Qt.EMPTY}else this.state=Qt.EMPTY}}else this.state=Qt.EMPTY}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.disposeInternal=function(){this.state==Qt.LOADING&&this.unlistenSources_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,n){e&&e.getState()==Qt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=Qt.ERROR;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=wf(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,t,this.gutter_,this.renderEdges_),this.state=Qt.LOADED}this.changed()},e.prototype.load=function(){if(this.state==Qt.IDLE){this.state=Qt.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,n){var i=e.getState();if(i==Qt.IDLE||i==Qt.LOADING){t++;var o=C(e,I.CHANGE,function(r){var n=e.getState();n!=Qt.LOADED&&n!=Qt.ERROR&&n!=Qt.EMPTY||(_(o),0==--t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach(function(t,e,r){t.getState()==Qt.IDLE&&t.load()}),0===t&&setTimeout(this.reproject_.bind(this),0)}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(_),this.sourcesListenerKeys_=null},e}(qf),zf=[0,0,0],Xf=function(t){var e,r,n;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,te((e=this.resolutions_,!0,r=function(t,e){return e-t}||Nt,e.every(function(t,n){if(0===n)return!0;var i=r(e[n-1],t);return!(i>0||0===i)})),17),!t.origins)for(var i=0,o=this.resolutions_.length-1;i<o;++i)if(n){if(this.resolutions_[i]/this.resolutions_[i+1]!==n){n=void 0;break}}else n=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,te(this.origins_.length==this.resolutions_.length,20));var a=t.extent;void 0===a||this.origin_||this.origins_||(this.origin_=or(a)),te(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,te(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:ie,te(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==a?a:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new sa(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):a&&this.calculateTileRanges_(a)};Xf.prototype.forEachTileCoord=function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),i=n.minX,o=n.maxX;i<=o;++i)for(var a=n.minY,s=n.maxY;a<=s;++a)r([e,i,a])},Xf.prototype.forEachTileCoordParentTileRange=function(t,e,r,n,i){var o,a,s,l=null,c=t[0]-1;for(2===this.zoomFactor_?(a=t[1],s=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(o=2===this.zoomFactor_?aa(a=Math.floor(a/2),a,s=Math.floor(s/2),s,n):this.getTileRangeForExtentAndZ(l,c,n),e.call(r,c,o))return!0;--c}return!1},Xf.prototype.getExtent=function(){return this.extent_},Xf.prototype.getMaxZoom=function(){return this.maxZoom},Xf.prototype.getMinZoom=function(){return this.minZoom},Xf.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},Xf.prototype.getResolution=function(t){return this.resolutions_[t]},Xf.prototype.getResolutions=function(){return this.resolutions_},Xf.prototype.getTileCoordChildTileRange=function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],i=2*t[2];return aa(n,n+1,i,i+1,e)}var o=this.getTileCoordExtent(t,r);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null},Xf.prototype.getTileRangeExtent=function(t,e,r){var n=this.getOrigin(t),i=this.getResolution(t),o=ai(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*i,s=n[0]+(e.maxX+1)*o[0]*i;return je(a,n[1]+e.minY*o[1]*i,s,n[1]+(e.maxY+1)*o[1]*i,r)},Xf.prototype.getTileRangeForExtentAndZ=function(t,e,r){var n=zf;this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n);var i=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[3],e,!0,n),aa(i,n[1],o,n[2],r)},Xf.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=ai(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]+(t[2]+.5)*n[1]*r]},Xf.prototype.getTileCoordExtent=function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=ai(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*i[0]*n,a=r[1]+t[2]*i[1]*n;return je(o,a,o+i[0]*n,a+i[1]*n,e)},Xf.prototype.getTileCoordForCoordAndResolution=function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)},Xf.prototype.getTileCoordForXYAndResolution_=function(t,e,r,n,i){var o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),l=ai(this.getTileSize(o),this.tmpSize_),c=n?.5:0,u=n?0:.5,h=Math.floor((t-s[0])/r+c),p=Math.floor((e-s[1])/r+u),d=a*h/l[0],f=a*p/l[1];return n?(d=Math.ceil(d)-1,f=Math.ceil(f)-1):(d=Math.floor(d),f=Math.floor(f)),kf(o,d,f,i)},Xf.prototype.getTileCoordForXYAndZ_=function(t,e,r,n,i){var o=this.getOrigin(r),a=this.getResolution(r),s=ai(this.getTileSize(r),this.tmpSize_),l=n?.5:0,c=n?0:.5,u=Math.floor((t-o[0])/a+l),h=Math.floor((e-o[1])/a+c),p=u/s[0],d=h/s[1];return n?(p=Math.ceil(p)-1,d=Math.ceil(d)-1):(p=Math.floor(p),d=Math.floor(d)),kf(r,p,d,i)},Xf.prototype.getTileCoordForCoordAndZ=function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)},Xf.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},Xf.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},Xf.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},Xf.prototype.getZForResolution=function(t,e){return oe(Dt(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},Xf.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r};var Kf=Xf;function $f(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,r,n){return function(t,e,r,n){var i=Ie.TOP_LEFT,o=function(t,e,r){for(var n=void 0!==e?e:ne,i=nr(t),o=sr(t),a=ai(void 0!==r?r:ie),s=Math.max(o/a[0],i/a[1]),l=n+1,c=new Array(l),u=0;u<l;++u)c[u]=s/Math.pow(2,u);return c}(t,void 0,r);return new Kf({extent:t,origin:er(t,i),resolutions:o,tileSize:r})}(Jf(t),0,void 0)}(t),t.setDefaultTileGrid(e)),e}function Jf(t){var e=(t=jr(t)).getExtent();if(!e){var r=180*mr[Cr.DEGREES]/t.getMetersPerUnit();e=je(-r,-r,r,r)}return e}var Zf=function(t){function e(e){t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX}),this.opaque_=void 0!==e.opaque&&e.opaque,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null,this.tileCache=new Vf(e.cacheSize),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,r,n){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var o,a,s,l=!0,c=r.minX;c<=r.maxX;++c)for(var u=r.minY;u<=r.maxY;++u)a=Df(e,c,u),s=!1,i.containsKey(a)&&(s=(o=i.get(a)).getState()===Qt.LOADED)&&(s=!1!==n(o)),s||(l=!1);return l},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},e.prototype.getTile=function(t,e,r,i,o){return n()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:$f(t)},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!Yr(e,t)?null:this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,r){var n,i,o,a=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),l=ai(a.getTileSize(t),this.tmpSize);return 1==s?l:(n=l,i=s,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*i+.5|0,o[1]=n[1]*i+.5|0,o)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n=e[0],i=t.getTileCoordCenter(e),o=Jf(r);if(Fe(o,i))return e;var a=sr(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,t.getTileCoordForCoordAndZ(i,n)}(n,t,r)),function(t,e){var r=t[0],n=t[1],i=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var o,a=e.getExtent();return!(o=a?e.getTileRangeForExtentAndZ(a,r):e.getFullTileRange(r))||o.containsXY(n,i)}(t,n)?t:null},e.prototype.refresh=function(){this.tileCache.clear(),this.changed()},e.prototype.useTile=function(t,e,r,n){},e}(Fd),Qf=function(t){function e(e,r){t.call(this,e),this.tile=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(P),tg={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function eg(t,e){t.getImage().src=e}var rg=function(t){function e(e){t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:eg,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:Hf,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var r=this.getTileCacheForProjection(t);for(var n in this.tileCache.expireCache(this.tileCache==r?e:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[n];i.expireCache(i==r?e:{})}},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Yr(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!Yr(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Yr(e,t)){var r=o(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=$f(t)),this.tileGridForProjection[r]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Yr(e,t))return this.tileCache;var r=o(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new Vf(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},e.prototype.createTile_=function(t,e,r,n,i,o){var a=[t,e,r],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,n,i):void 0,c=new this.tileClass(a,void 0!==l?Qt.IDLE:Qt.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,C(c,I.CHANGE,this.handleTileChange,this),c},e.prototype.getTile=function(t,e,r,n,i){var o=this.getProjection();if(o&&i&&!Yr(o,i)){var a,s=this.getTileCacheForProjection(i),l=[t,e,r],c=Ff(l);s.containsKey(c)&&(a=s.get(c));var u=this.getKey();if(a&&a.key==u)return a;var h=this.getTileGridForProjection(o),p=this.getTileGridForProjection(i),d=this.getTileCoordForTileUrlFunction(l,i),f=new Yf(o,h,i,p,l,d,this.getTilePixelRatio(n),this.getGutter(),function(t,e,r,n){return this.getTileInternal(t,e,r,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return f.key=u,a?(f.interimTile=a,f.refreshInterimChain(),s.replace(c,f)):s.set(c,f),f}return this.getTileInternal(t,e,r,n,o||i)},e.prototype.getTileInternal=function(t,e,r,n,i){var o=null,a=Df(t,e,r),s=this.getKey();if(this.tileCache.containsKey(a)){if((o=this.tileCache.get(a)).key!=s){var l=o;o=this.createTile_(t,e,r,n,i,s),l.getState()==Qt.IDLE?o.interimTile=l.interimTile:o.interimTile=l,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(t,e,r,n,i,s),this.tileCache.set(a,o);return o},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var r=jr(t);if(r){var n=o(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}},e}(function(t){function e(e){t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,key:e.key,attributionsCollapsible:e.attributionsCollapsible}),this.generateTileUrlFunction_=!e.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,this.tileUrlFunction=e.tileUrlFunction?e.tileUrlFunction.bind(this):Uf,this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction,this.key_),this.tileLoadingKeys_={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,r=t.target,n=o(r),i=r.getState();i==Qt.LOADING?(this.tileLoadingKeys_[n]=!0,e=tg.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==Qt.ERROR?tg.TILELOADERROR:i==Qt.LOADED||i==Qt.ABORT?tg.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new Qf(e,r))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=this.urls=jf(t);this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=Bf(t[i],e);return Gf(n)}(t,this.tileGrid),e):this.setKey(e)},e.prototype.useTile=function(t,e,r){var n=Df(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},e}(Zf)),ng={KVP:"KVP",REST:"REST"},ig=function(t){function e(e){t.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getMatrixId=function(t){return this.matrixIds_[t]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}(Kf),og=function(t){function e(e){var r=void 0!==e.requestEncoding?e.requestEncoding:ng.KVP,n=e.tileGrid,i=e.urls;void 0===i&&void 0!==e.url&&(i=jf(e.url)),t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:Uf,urls:i,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=r,this.setKey(this.getKeyForDimensions_()),i&&i.length>0&&(this.tileUrlFunction=Gf(i.map(ag.bind(this))))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction(Gf(t.map(ag.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var r in this.dimensions_)e[t++]=r+"-"+this.dimensions_[r];return e.join("/")},e.prototype.updateDimensions=function(t){u(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e}(rg);function ag(t){var e=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e==ng.KVP&&u(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e==ng.KVP?Mf(t,r):t.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in r?r[e.toLowerCase()]:t});var n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(r){var s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:-r[2]-1};u(s,i);var l=t;return e==ng.KVP?Mf(l,s):l.replace(/\{(\w+?)\}/g,function(t,e){return s[e]})}}}var sg=function(t){function e(e){var r=e||{};t.call(this,{attributions:r.attributions,projection:r.projection,resolutions:r.resolutions,state:r.state}),this.canvasFunction_=r.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==r.ratio?r.ratio:1.5}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getImageInternal=function(t,e,r,n){e=this.findNearestResolution(e);var i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==e&&i.getPixelRatio()==r&&Be(i.getExtent(),t))return i;ur(t=t.slice(),this.ratio_);var o=[sr(t)/e*r,nr(t)/e*r],a=this.canvasFunction_.call(this,t,e,r,o,n);return a&&(i=new go(t,e,r,a)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i},e}(If);r.d(e,"array",function(){return lg}),r.d(e,"asserts",function(){return cg}),r.d(e,"color",function(){return ug}),r.d(e,"math",function(){return hg}),r.d(e,"string",function(){return pg}),r.d(e,"control",function(){return dg}),r.d(e,"events",function(){return fg}),r.d(e,"extent",function(){return gg}),r.d(e,"geom",function(){return yg}),r.d(e,"featureloader",function(){return mg}),r.d(e,"format",function(){return Cg}),r.d(e,"interaction",function(){return vg}),r.d(e,"layer",function(){return Tg}),r.d(e,"Observable",function(){return _g}),r.d(e,"Object",function(){return Sg}),r.d(e,"proj",function(){return Eg}),r.d(e,"render",function(){return Lg}),r.d(e,"source",function(){return wg}),r.d(e,"style",function(){return bg}),r.d(e,"xml",function(){return Ag}),r.d(e,"VERSION",function(){return a}),r.d(e,"Map",function(){return $a}),r.d(e,"View",function(){return Xn}),r.d(e,"Overlay",function(){return Qa}),r.d(e,"OverlayPositioning",function(){return Ja}),r.d(e,"Feature",function(){return ps}),r.d(e,"Collection",function(){return G}),r.d(e,"MapEventType",function(){return $t}),r.d(e,"MapBrowserEventType",function(){return Z}),r.d(e,"Image",function(){return Sf}),ps.createStyleFunction=hs;const lg={};lg.extend=Bt,lg.includes=kt;const cg={};cg.assert=te;const ug={};ug.asArray=jo,ug.asString=Go;const hg={};hg.toRadians=ce;const pg={};pg.padNumber=Ce;const dg={};dg.OverviewMap=es,dg.ScaleLine=as,dg.Zoom=Ei,dg.ZoomSlider=cs,dg.ZoomSlider.render=ls,dg.ZoomToExtent=us;const fg={};fg.EventType=I,fg.listen=C,fg.unlisten=T,fg.condition={shiftKeyOnly:Wi};const gg={};gg.getWidth=sr,gg.getHeight=nr,gg.containsCoordinate=Fe,gg.containsExtent=Be,gg.buffer=Ne,gg.boundingExtent=Oe;const yg={};yg.Point=Pn,yg.MultiPoint=ds,yg.LineString=ys,yg.MultiLineString=ms,yg.Polygon=Wn,yg.MultiPolygon=Cs,yg.GeometryCollection=Ss,yg.Circle=Ts,yg.GeometryType=hr,yg.GeometryLayout=pr,yg.flat={deflateCoordinates:vn,inflateCoordinates:_n,linearRingLength:function(t,e,r,n){var i=ga(t,e,r,n),o=t[r-n]-t[e],a=t[r-n+1]-t[e+1];return i+Math.sqrt(o*o+a*a)}};const mg={};mg.xhr=Ls;const Cg={};Cg.Feature=ps,Cg.Feature.transformWithOptions=As,Cg.GeoJSON=Ms,Cg.GMLBase=il,Cg.GML=El,Cg.GML2=bh,Cg.GML3=_l,Cg.GPX=ic,Cg.KML=Sh,Cg.WFS=tp,Cg.WKT=yp,Cg.WMSCapabilities=Hp,Cg.WMSGetFeatureInfo=Vp,Cg.WMTSCapabilities=Ld,Cg.TopoJSON=Id,Cg.xsd={readDecimal:ll,readBoolean:ol,readString:pl,readNonNegativeInteger:ul,readDateTime:sl,writeStringTextNode:ml,writeCDATASection:fl,writeDecimalTextNode:gl,writeBooleanTextNode:dl,writeNonNegativeIntegerTextNode:yl};const vg={};vg.defaults=uo,vg.Draw=Yd,vg.Pointer=Xi,vg.Translate=Xd,vg.Snap=$d,vg.Select=ef,vg.Modify=uf,vg.DragAndDrop=ff,vg.DoubleClickZoom=Oi;const Tg={};Tg.Layer=Ci,Tg.Tile=Cf,Tg.Image=Tf,Tg.Vector=Nd;const _g={unByKey:function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)_(t[e]);else _(t)}},Sg={};Sg.getChangeEventType=k;const Eg={};Eg.METERS_PER_UNIT=mr,Eg.Projection=Tr,Eg.addEquivalentProjections=Wr,Eg.get=jr,Eg.transform=Kr,Eg.transformExtent=$r,Eg.getTransform=Xr,Eg.Units=Cr,Eg.proj4={register:function(t){var e,r,n,i,o,a,s,l,c=Object.keys(t.defs),u=c.length;for(e=0;e<u;++e){var h=c[e];if(!jr(h)){var p=t.defs(h);Ur(new Tr({code:h,axisOrientation:p.axis,metersPerUnit:p.to_meter,units:p.units}))}}for(e=0;e<u;++e){var d=c[e],f=jr(d);for(r=0;r<u;++r){var g=c[r],y=jr(g);if(!Fr(d,g))if(t.defs[d]===t.defs[g])Wr([f,y]);else{var m=t(d,g);n=f,i=y,o=m.forward,a=m.inverse,void 0,void 0,Dr(s=jr(n),l=jr(i),Vr(o)),Dr(l,s,Vr(a))}}}}},Eg.EPSG4326={METERS_PER_UNIT:Ir,PROJECTIONS:Or};const Lg={toContext:function(t,e){var r=t.canvas,n=e||{},i=n.pixelRatio||z,o=n.size;o&&(r.width=o[0]*i,r.height=o[1]*i,r.style.width=o[0]+"px",r.style.height=o[1]+"px");var a=[0,0,r.width,r.height],s=nn([1,0,0,1,0,0],i,i);return new zo(t,i,a,s,0)}};Lg.EventType=Zt;const wg={};wg.Vector=qd,wg.Cluster=_f,wg.ImageWMS=Nf,wg.WMTS=og,wg.WMTS.optionsFromCapabilities=function(t,e){var r=Gt(t.Contents.Layer,function(t,r,n){return t.Identifier==e.layer});if(null===r)return null;var n,i=t.Contents.TileMatrixSet;(n=r.TileMatrixSetLink.length>1?jt(r.TileMatrixSetLink,"projection"in e?function(t,r,n){var o=Gt(i,function(e){return e.Identifier==t.TileMatrixSet}).SupportedCRS,a=jr(o.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(o),s=jr(e.projection);return a&&s?Yr(a,s):o==e.projection}:function(t,r,n){return t.TileMatrixSet==e.matrixSet}):0)<0&&(n=0);var o=r.TileMatrixSetLink[n].TileMatrixSet,a=r.TileMatrixSetLink[n].TileMatrixSetLimits,s=r.Format[0];"format"in e&&(s=e.format),(n=jt(r.Style,function(t,r,n){return"style"in e?t.Title==e.style:t.isDefault}))<0&&(n=0);var l=r.Style[n].Identifier,c={};"Dimension"in r&&r.Dimension.forEach(function(t,e,r){var n=t.Identifier,i=t.Default;void 0===i&&(i=t.Value[0]),c[n]=i});var u,h=Gt(t.Contents.TileMatrixSet,function(t,e,r){return t.Identifier==o}),p=h.SupportedCRS;if(p&&(u=jr(p.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(p)),"projection"in e){var d=jr(e.projection);d&&(u&&!Yr(d,u)||(u=d))}var f,g,y=r.WGS84BoundingBox;if(void 0!==y){var m=jr("EPSG:4326").getExtent();g=y[0]==m[0]&&y[2]==m[2],f=$r(y,"EPSG:4326",u);var C=u.getExtent();C&&(Be(C,f)||(f=void 0))}var v=function(t,e,r){var n=[],i=[],o=[],a=[],s=[],l=void 0!==r?r:[],c=t.SupportedCRS,u=jr(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||jr(c),h=u.getMetersPerUnit(),p="ne"==u.getAxisOrientation().substr(0,2);return t.TileMatrix.sort(function(t,e){return e.ScaleDenominator-t.ScaleDenominator}),t.TileMatrix.forEach(function(e){if(!(l.length>0)||Gt(l,function(r){return e.Identifier==r.TileMatrix||-1===e.Identifier.indexOf(":")&&t.Identifier+":"+e.Identifier===r.TileMatrix})){i.push(e.Identifier);var r=28e-5*e.ScaleDenominator/h,c=e.TileWidth,u=e.TileHeight;p?o.push([e.TopLeftCorner[1],e.TopLeftCorner[0]]):o.push(e.TopLeftCorner),n.push(r),a.push(c==u?c:[c,u]),s.push([e.MatrixWidth,-e.MatrixHeight])}}),new ig({extent:e,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}(h,f,a),T=[],_=e.requestEncoding;if(_=void 0!==_?_:"","OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var S=t.OperationsMetadata.GetTile.DCP.HTTP.Get,E=0,L=S.length;E<L;++E)if(S[E].Constraint){var w=Gt(S[E].Constraint,function(t){return"GetEncoding"==t.name}).AllowedValues.Value;if(""===_&&(_=w[0]),_!==ng.KVP)break;kt(w,ng.KVP)&&T.push(S[E].href)}else S[E].href&&(_=ng.KVP,T.push(S[E].href));return 0===T.length&&(_=ng.REST,r.ResourceURL.forEach(function(t){"tile"===t.resourceType&&(s=t.format,T.push(t.template))})),{urls:T,layer:e.layer,matrixSet:o,format:s,projection:u,requestEncoding:_,tileGrid:v,style:l,dimensions:c,wrapX:g,crossOrigin:e.crossOrigin}},wg.TileEventType=tg,wg.VectorEventType=Bd,wg.ImageCanvas=sg,wg.Image={defaultImageLoadFunction:Rf};const bg={};bg.Style=Sc,bg.RegularShape=gc,bg.Circle=yc,bg.Fill=ac,bg.Icon=pc,bg.Stroke=fc,bg.Style=Sc,bg.Text=Oc,bg.IconAnchorUnits=sc,bg.IconOrigin=cc;const Ag={};Ag.parse=Bs,Ag.parseNode=$s,Ag.createElementNS=ks,Ag.pushParseAndPop=Js,Ag.pushSerializeAndPop=Qs,Ag.makeStructureNS=Ks,Ag.getAllTextContent=Ds,Ag.makeChildAppender=Hs,Ag.makeReplacer=js,Ag.makeSequence=Xs,Ag.makeArrayPusher=Us,Ag.makeArrayExtender=Gs,Ag.makeArraySerializer=Vs,Ag.makeObjectPropertySetter=Ws,Ag.makeSimpleNodeFactory=Ys,Ag.OBJECT_PROPERTY_NODE_FACTORY=zs,Ag.XML_SCHEMA_INSTANCE_URI=Ns,Ag.DOCUMENT=Os}]),TC=TC||{},QRCode;TC.UI=TC.UI||{};!function(){var t=function(t){return"[object Object]"===Object.prototype.toString.call(t)},e=function(){var t={},r=!1,n=0;if("[object Boolean]"===Object.prototype.toString.call(arguments[0])){r=arguments[0];n++}for(var i=function(n){for(var i in n)n.hasOwnProperty(i)&&(r&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=e(t[i],n[i]):t[i]=n[i])};n<arguments.length;n++)i(arguments[n]);return t},r=function(e,r,i){var o=[];if(r)if(i.buildHTML)i.target.innerHTML=i.buildHTML({results:r});else{for(var a=0;a<r.length;a++){var s=r[a];t(s)?o[o.length]='<li><a href="'+i.link+encodeURIComponent(s.id)+'">'+s.label+"</a></li>":o[o.length]='<li><a href="'+i.link+encodeURIComponent(s)+'">'+s+"</a></li>"}var l=document.createElement("template");l.innerHTML=o.join("");i.target.appendChild(l.content?l.content.firstChild:l.firstChild)}null!==i.callback&&"function"==typeof i.callback&&n(i);e.value.length>0?e.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")):e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},n=function(t){t.target.querySelectorAll("li a").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})})},i=function(t,e){e.innerHTML="";t.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},o=function(e){var n,o,a,s,l=e.target,c=l.getAttribute("id"),u=l.getAttribute("autocomplete");if(u){var h=this.settings,p=u.openXHR;if((n=l.value).length<h.minLength)i(l,h.target);else if(Array.isArray(h.source)){o=h.source.sort().filter(function(e){s=h.matchFromStart?new RegExp("^"+n,"i"):new RegExp(n,"i");a=t(e)?e.label:e;return s.test(a)});r(l,o,h)}else if("function"==typeof h.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;h.source(n,function(t){r(l,t,h)})}else{const t=function(t){if(h.cancelRequests){p[c]?p[c].abort():h.target.innerHTML='<li><a href="#">Searching...</a></li>';p[c]=t}},e=function(){h.cancelRequests&&(p[c]=null)};var d=new XMLHttpRequest;d.overrideMimeType("application/json");d.open("GET",url,!0);d.onload=function(){e();var t=JSON.parse(req.responseText);r(l,t,h)};d.onerror=function(t){e()};t(d);d.send(null)}}},a={init:function(t){var r=this,n={settings:null};n.settings=e({},n.defaults,t);r.setAttribute("autocomplete",!0);var a=n.settings;r.removeEventListener("keyup",o);r.addEventListener("keyup",o);r.parentNode.querySelector(".ui-input-clear")&&r.parentNode.querySelector(".ui-input-clear").addEventListener("click",function(t){i(r,a.target)});return r},update:function(t,r){this.getAttribute("autocomplete")&&(this.settings=e(this.settings,r));return this},clear:function(t){this.getAttribute("autocomplete")&&i(this,this.settings.target);return this},destroy:function(){if(this.getAttribute("autocomplete")){i(this,this.settings.target);this.removeAttribute("autocomplete");this.removeEventListener("keyup",o)}return this}};TC.UI.autocomplete=function(t){if(a[t])return a[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof t||!t){this.settings=arguments[0];return a.init.apply(this,arguments)}}}();!function(t,e){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("jquery")):t.jQueryBridget=e(t,t.jQuery)}(window,function(t,e){"use strict";var r=Array.prototype.slice,n=t.console,i=void 0===n?function(){}:function(t){n.error(t)};function o(n,o,s){(s=s||e||t.jQuery)&&(o.prototype.option||(o.prototype.option=function(t){s.isPlainObject(t)&&(this.options=s.extend(!0,this.options,t))}),s.fn[n]=function(t){if("string"==typeof t){var e=r.call(arguments,1);return c=e,h="$()."+n+'("'+(l=t)+'")',(a=this).each(function(t,e){var r=s.data(e,n);if(r){var o=r[l];if(o&&"_"!=l.charAt(0)){var a=o.apply(r,c);u=void 0===u?a:u}else i(h+" is not a valid method")}else i(n+" not initialized. Cannot call methods, i.e. "+h)}),void 0!==u?u:a}var a,l,c,u,h,p;return p=t,this.each(function(t,e){var r=s.data(e,n);r?(r.option(p),r._init()):(r=new o(e,p),s.data(e,n,r))}),this},a(s))}function a(t){!t||t&&t.bridget||(t.bridget=o)}return a(e||t.jQuery),o}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return e()}):"object"==typeof module&&module.exports?module.exports=e():t.getSize=e()}(window,function(){"use strict";function t(t){var e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}var e="undefined"==typeof console?function(){}:function(t){console.error(t)},r=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],n=r.length;function i(t){var r=getComputedStyle(t);return r||e("Style returned "+r+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),r}var o,a=!1;return function e(s){if(function(){if(!a){a=!0;var r=document.createElement("div");r.style.width="200px",r.style.padding="1px 2px 3px 4px",r.style.borderStyle="solid",r.style.borderWidth="1px 2px 3px 4px",r.style.boxSizing="border-box";var n=document.body||document.documentElement;n.appendChild(r);var s=i(r);e.isBoxSizeOuter=o=200==t(s.width),n.removeChild(r)}}(),"string"==typeof s&&(s=document.querySelector(s)),s&&"object"==typeof s&&s.nodeType){var l=i(s);if("none"==l.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;e<n;e++)t[r[e]]=0;return t}();var c={};c.width=s.offsetWidth,c.height=s.offsetHeight;for(var u=c.isBorderBox="border-box"==l.boxSizing,h=0;h<n;h++){var p=r[h],d=l[p],f=parseFloat(d);c[p]=isNaN(f)?0:f}var g=c.paddingLeft+c.paddingRight,y=c.paddingTop+c.paddingBottom,m=c.marginLeft+c.marginRight,C=c.marginTop+c.marginBottom,v=c.borderLeftWidth+c.borderRightWidth,T=c.borderTopWidth+c.borderBottomWidth,_=u&&o,S=t(l.width);!1!==S&&(c.width=S+(_?0:g+v));var E=t(l.height);return!1!==E&&(c.height=E+(_?0:y+T)),c.innerWidth=c.width-(g+v),c.innerHeight=c.height-(y+T),c.outerWidth=c.width+m,c.outerHeight=c.height+C,c}}}),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var r=this._events=this._events||{},n=r[t]=r[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var r=this._onceEvents=this._onceEvents||{};return(r[t]=r[t]||{})[e]=!0,this}},e.off=function(t,e){var r=this._events&&this._events[t];if(r&&r.length){var n=r.indexOf(e);return-1!=n&&r.splice(n,1),this}},e.emitEvent=function(t,e){var r=this._events&&this._events[t];if(r&&r.length){r=r.slice(0),e=e||[];for(var n=this._onceEvents&&this._onceEvents[t],i=0;i<r.length;i++){var o=r[i];n&&n[o]&&(this.off(t,o),delete n[o]),o.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t}),function(t,e){"function"==typeof define&&define.amd?define("unipointer/unipointer",["ev-emitter/ev-emitter"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.Unipointer=e(t,t.EvEmitter)}(window,function(t,e){function r(){}var n=r.prototype=Object.create(e.prototype);n.bindStartEvent=function(t){this._bindStartEvent(t,!0)},n.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},n._bindStartEvent=function(e,r){var n=(r=void 0===r||r)?"addEventListener":"removeEventListener",i="mousedown";t.PointerEvent?i="pointerdown":"ontouchstart"in t&&(i="touchstart"),e[n](i,this)},n.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},n.getTouch=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.identifier==this.pointerIdentifier)return r}},n.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this._pointerDown(t,t)},n.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},n.onpointerdown=function(t){this._pointerDown(t,t)},n._pointerDown=function(t,e){t.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDown(t,e))},n.pointerDown=function(t,e){this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e])};var i={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return n._bindPostStartEvents=function(e){if(e){var r=i[e.type];r.forEach(function(e){t.addEventListener(e,this)},this),this._boundPointerEvents=r}},n._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(e){t.removeEventListener(e,this)},this),delete this._boundPointerEvents)},n.onmousemove=function(t){this._pointerMove(t,t)},n.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},n.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerMove(t,e)},n._pointerMove=function(t,e){this.pointerMove(t,e)},n.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])},n.onmouseup=function(t){this._pointerUp(t,t)},n.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},n.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerUp(t,e)},n._pointerUp=function(t,e){this._pointerDone(),this.pointerUp(t,e)},n.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])},n._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},n._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},n.pointerDone=function(){},n.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},n.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerCancel(t,e)},n._pointerCancel=function(t,e){this._pointerDone(),this.pointerCancel(t,e)},n.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])},r.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},r}),function(t,e){"function"==typeof define&&define.amd?define("unidragger/unidragger",["unipointer/unipointer"],function(r){return e(t,r)}):"object"==typeof module&&module.exports?module.exports=e(t,require("unipointer")):t.Unidragger=e(t,t.Unipointer)}(window,function(t,e){function r(){}var n=r.prototype=Object.create(e.prototype);n.bindHandles=function(){this._bindHandles(!0)},n.unbindHandles=function(){this._bindHandles(!1)},n._bindHandles=function(e){for(var r=(e=void 0===e||e)?"addEventListener":"removeEventListener",n=e?this._touchActionValue:"",i=0;i<this.handles.length;i++){var o=this.handles[i];this._bindStartEvent(o,e),o[r]("click",this),t.PointerEvent&&(o.style.touchAction=n)}},n._touchActionValue="none",n.pointerDown=function(t,e){this.okayPointerDown(t)&&(this.pointerDownPointer=e,t.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e]))};var i={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},o={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return n.okayPointerDown=function(t){var e=i[t.target.nodeName],r=o[t.target.type],n=!e||r;return n||this._pointerReset(),n},n.pointerDownBlur=function(){var t=document.activeElement;t&&t.blur&&t!=document.body&&t.blur()},n.pointerMove=function(t,e){var r=this._dragPointerMove(t,e);this.emitEvent("pointerMove",[t,e,r]),this._dragMove(t,e,r)},n._dragPointerMove=function(t,e){var r={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this._dragStart(t,e),r},n.hasDragStarted=function(t){return 3<Math.abs(t.x)||3<Math.abs(t.y)},n.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e]),this._dragPointerUp(t,e)},n._dragPointerUp=function(t,e){this.isDragging?this._dragEnd(t,e):this._staticClick(t,e)},n._dragStart=function(t,e){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(t,e)},n.dragStart=function(t,e){this.emitEvent("dragStart",[t,e])},n._dragMove=function(t,e,r){this.isDragging&&this.dragMove(t,e,r)},n.dragMove=function(t,e,r){t.preventDefault(),this.emitEvent("dragMove",[t,e,r])},n._dragEnd=function(t,e){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(t,e)},n.dragEnd=function(t,e){this.emitEvent("dragEnd",[t,e])},n.onclick=function(t){this.isPreventingClicks&&t.preventDefault()},n._staticClick=function(t,e){this.isIgnoringMouseUp&&"mouseup"==t.type||(this.staticClick(t,e),"mouseup"!=t.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},n.staticClick=function(t,e){this.emitEvent("staticClick",[t,e])},r.getPointerPoint=e.getPointerPoint,r}),function(t,e){"function"==typeof define&&define.amd?define(["get-size/get-size","unidragger/unidragger"],function(r,n){return e(t,r,n)}):"object"==typeof module&&module.exports?module.exports=e(t,require("get-size"),require("unidragger")):t.Draggabilly=e(t,t.getSize,t.Unidragger)}(window,function(t,e,r){function n(t,e){for(var r in e)t[r]=e[r];return t}var i=t.jQuery;function o(t,e){this.element="string"==typeof t?document.querySelector(t):t,i&&(this.$element=i(this.element)),this.options=n({},this.constructor.defaults),this.option(e),this._create()}var a=o.prototype=Object.create(r.prototype);o.defaults={},a.option=function(t){n(this.options,t)};var s={relative:!0,absolute:!0,fixed:!0};function l(t,e,r){return r=r||"round",e?Math[r](t/e)*e:t}return a._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=n({},this.position);var t=getComputedStyle(this.element);s[t.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},a.dispatchEvent=function(t,e,r){var n=[e].concat(r);this.emitEvent(t,n),this.dispatchJQueryEvent(t,e,r)},a.dispatchJQueryEvent=function(e,r,n){var i=t.jQuery;if(i&&this.$element){var o=i.Event(r);o.type=e,this.$element.trigger(o,n)}},a._getPosition=function(){var t=getComputedStyle(this.element),e=this._getPositionCoord(t.left,"width"),r=this._getPositionCoord(t.top,"height");this.position.x=isNaN(e)?0:e,this.position.y=isNaN(r)?0:r,this._addTransformPosition(t)},a._getPositionCoord=function(t,r){if(-1!=t.indexOf("%")){var n=e(this.element.parentNode);return n?parseFloat(t)/100*n[r]:0}return parseInt(t,10)},a._addTransformPosition=function(t){var e=t.transform;if(0===e.indexOf("matrix")){var r=e.split(","),n=0===e.indexOf("matrix3d")?12:4,i=parseInt(r[n],10),o=parseInt(r[n+1],10);this.position.x+=i,this.position.y+=o}},a.onPointerDown=function(t,e){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",t,[e])},a.dragStart=function(t,e){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",t,[e]),this.animate())},a.measureContainment=function(){var t=this.getContainer();if(t){var r=e(this.element),n=e(t),i=this.element.getBoundingClientRect(),o=t.getBoundingClientRect(),a=n.borderLeftWidth+n.borderRightWidth,s=n.borderTopWidth+n.borderBottomWidth,l=this.relativeStartPosition={x:i.left-(o.left+n.borderLeftWidth),y:i.top-(o.top+n.borderTopWidth)};this.containSize={width:n.width-a-l.x-r.width,height:n.height-s-l.y-r.height}}},a.getContainer=function(){var t=this.options.containment;if(t)return t instanceof HTMLElement?t:"string"==typeof t?document.querySelector(t):this.element.parentNode},a.onPointerMove=function(t,e,r){this.dispatchJQueryEvent("pointerMove",t,[e,r])},a.dragMove=function(t,e,r){if(this.isEnabled){var n=r.x,i=r.y,o=this.options.grid,a=o&&o[0],s=o&&o[1];n=l(n,a),i=l(i,s),n=this.containDrag("x",n,a),i=this.containDrag("y",i,s),n="y"==this.options.axis?0:n,i="x"==this.options.axis?0:i,this.position.x=this.startPosition.x+n,this.position.y=this.startPosition.y+i,this.dragPoint.x=n,this.dragPoint.y=i,this.dispatchEvent("dragMove",t,[e,r])}},a.containDrag=function(t,e,r){if(!this.options.containment)return e;var n="x"==t?"width":"height",i=l(-this.relativeStartPosition[t],r,"ceil"),o=this.containSize[n];return o=l(o,r,"floor"),Math.max(i,Math.min(o,e))},a.onPointerUp=function(t,e){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",t,[e])},a.dragEnd=function(t,e){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",t,[e]))},a.animate=function(){if(this.isDragging){this.positionDrag();var t=this;requestAnimationFrame(function(){t.animate()})}},a.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},a.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},a.staticClick=function(t,e){this.dispatchEvent("staticClick",t,[e])},a.setPosition=function(t,e){this.position.x=t,this.position.y=e,this.setLeftTop()},a.enable=function(){this.isEnabled=!0},a.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},a.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},a._init=function(){},i&&i.bridget&&i.bridget("draggabilly",o),o});!function(t){"use strict";"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&void 0!==module.exports?module.exports=t():window.Sortable=t()}(function(){"use strict";if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var t,e,r,n,i,o,a,s,l,c,u,h,p,d,f,g,y,m,C,v,T,_,S,E,L,w=[],b=!1,A=!1,x=!1,P=[],R=!1,I=!1,M=/\s+/g,O="Sortable"+(new Date).getTime(),N=window,k=N.document,D=N.parseInt,F=N.setTimeout,B=N.jQuery||N.Zepto,G=N.Polymer,U={capture:!1,passive:!1},j=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),q=!!navigator.userAgent.match(/Edge/i),W=q||j?"cssFloat":"float",H="draggable"in k.createElement("div"),V=function(){if(j)return!1;var t=k.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}(),Y=!1,z=!1,X=Math.abs,K=Math.min,$=[],J=function(t,e){var r=ft(t),n=D(r.width),i=_t(t,0,e),o=_t(t,1,e),a=i&&ft(i),s=o&&ft(o),l=a&&D(a.marginLeft)+D(a.marginRight)+It(i).width,c=s&&D(s.marginLeft)+D(s.marginRight)+It(o).width;if("flex"===r.display)return"column"===r.flexDirection||"column-reverse"===r.flexDirection?"vertical":"horizontal";if(i&&"none"!==a.float){var u="left"===a.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==u?"horizontal":"vertical"}return i&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||n<=l&&"none"===r[W]||o&&"none"===r[W]&&n<l+c)?"vertical":"horizontal"},Z=function(t,e){if(!t||!t.getBoundingClientRect)return N;var r=t,n=!1;do{if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var i=ft(r);if(r.clientWidth<r.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||r.clientHeight<r.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!r||!r.getBoundingClientRect||r===k.body)return N;if(n||e)return r;n=!0}}}while(r=r.parentNode);return N},Q=bt(function(t,e,r,n){if(e.scroll){var i=r?r[O]:window,o=e.scrollSensitivity,a=e.scrollSpeed,u=t.clientX,h=t.clientY,p=(window.innerWidth,window.innerHeight,!1);l!==r&&(tt(),s=e.scroll,c=e.scrollFn,!0===s&&(s=Z(r,!0),l=s));var d=0,f=s;do{var g,y,m,v,T,_,S,E,L,A=f,x=It(A),P=x.top,R=x.bottom,I=x.left,M=x.right,D=x.width,F=x.height;if(L=A!==N?(g=A.scrollWidth,y=A.scrollHeight,m=ft(A),_=D<g&&("auto"===m.overflowX||"scroll"===m.overflowX),S=F<y&&("auto"===m.overflowY||"scroll"===m.overflowY),E=A.scrollLeft,A.scrollTop):(g=k.documentElement.scrollWidth,y=k.documentElement.scrollHeight,m=ft(k.documentElement),_=D<g&&("auto"===m.overflowX||"scroll"===m.overflowX||"visible"===m.overflowX),S=F<y&&("auto"===m.overflowY||"scroll"===m.overflowY||"visible"===m.overflowY),E=k.documentElement.scrollLeft,k.documentElement.scrollTop),v=_&&(X(M-u)<=o&&E+D<g)-(X(I-u)<=o&&!!E),T=S&&(X(R-h)<=o&&L+F<y)-(X(P-h)<=o&&!!L),!w[d])for(var B=0;B<=d;B++)w[B]||(w[B]={});w[d].vx==v&&w[d].vy==T&&w[d].el===A||(w[d].el=A,w[d].vx=v,w[d].vy=T,clearInterval(w[d].pid),!A||0==v&&0==T||(p=!0,w[d].pid=setInterval(function(){n&&0===this.layer&&ct.active._emulateDragOver(!0);var e=w[this.layer].vy?w[this.layer].vy*a:0,r=w[this.layer].vx?w[this.layer].vx*a:0;"function"==typeof c&&"continue"!==c.call(i,r,e,t,C,w[this.layer].el)||(w[this.layer].el===N?N.scrollTo(N.pageXOffset+r,N.pageYOffset+e):(w[this.layer].el.scrollTop+=e,w[this.layer].el.scrollLeft+=r))}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&f!==N&&(f=Z(f,!1)));b=p}},30),tt=function(){w.forEach(function(t){clearInterval(t.pid)}),w=[]},et=function(t){function e(t,r){return function(n,i,o,a){var s=n.options.group.name&&i.options.group.name&&n.options.group.name===i.options.group.name;if(null==t&&(r||s))return!0;if(null==t||!1===t)return!1;if(r&&"clone"===t)return t;if("function"==typeof t)return e(t(n,i,o,a),r)(n,i,o,a);var l=(r?n:i).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&-1<t.indexOf(l)}}var r={},n=t.group;n&&"object"==typeof n||(n={name:n}),r.name=n.name,r.checkPull=e(n.pull,!0),r.checkPut=e(n.put),r.revertClone=n.revertClone,t.group=r},rt=function(e){t&&t.parentNode&&t.parentNode[O]&&t.parentNode[O]._computeIsAligned(e)},nt=function(t,e){for(var r=e;!r[O];)r=r.parentNode;return t===r},it=function(t,e,r){for(var n=t.parentNode;n&&!n[O];)n=n.parentNode;n&&n[O][r](At(e,{artificialBubble:!0}))},ot=function(){!V&&r&&ft(r,"display","none")},at=function(){!V&&r&&ft(r,"display","")};k.addEventListener("click",function(t){if(x)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),x=!1},!0);var st,lt=function(e){if(e=e.touches?e.touches[0]:e,t){var r=function(t,e){for(var r=0;r<P.length;r++)if(!P[r].children.length){var n=It(P[r]),i=P[r][O].options.emptyInsertThreshold,o=t>=n.left-i&&t<=n.right+i,a=e>=n.top-i&&e<=n.bottom+i;if(o&&a)return P[r]}}(e.clientX,e.clientY);r&&r[O]._onDragOver({clientX:e.clientX,clientY:e.clientY,target:r,rootEl:r})}};function ct(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(t);this.el=t,this.options=e=At({},e),t[O]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return J(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:D(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ct.supportPointer&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var n in r)!(n in e)&&(e[n]=r[n]);for(var i in et(e),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!e.forceFallback&&H,e.supportPointer?ht(t,"pointerdown",this._onTapStart):(ht(t,"mousedown",this._onTapStart),ht(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(ht(t,"dragover",this),ht(t,"dragenter",this)),P.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[])}function ut(t,e,r,n){if(t){r=r||k;do{if(null!=e&&(">"===e[0]&&t.parentNode===r&&wt(t,e.substring(1))||wt(t,e))||n&&t===r)return t;if(t===r)break}while(t=(i=t).host&&i!==k&&i.host.nodeType?i.host:i.parentNode)}var i;return null}function ht(t,e,r){t.addEventListener(e,r,U)}function pt(t,e,r){t.removeEventListener(e,r,U)}function dt(t,e,r){if(t&&e)if(t.classList)t.classList[r?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(M," ").replace(" "+e+" "," ");t.className=(n+(r?" "+e:"")).replace(M," ")}}function ft(t,e,r){var n=t&&t.style;if(n){if(void 0===r)return k.defaultView&&k.defaultView.getComputedStyle?r=k.defaultView.getComputedStyle(t,""):t.currentStyle&&(r=t.currentStyle),void 0===e?r:r[e];e in n||-1!==e.indexOf("webkit")||(e="-webkit-"+e),n[e]=r+("string"==typeof r?"":"px")}}function gt(t){var e="";do{var r=ft(t,"transform");r&&"none"!==r&&(e=r+" "+e)}while(t=t.parentNode);return window.DOMMatrix?new DOMMatrix(e):window.WebKitCSSMatrix?new WebKitCSSMatrix(e):window.CSSMatrix?new CSSMatrix(e):void 0}function yt(t,e,r){if(t){var n=t.getElementsByTagName(e),i=0,o=n.length;if(r)for(;i<o;i++)r(n[i],i);return n}return[]}function mt(t,e,r,i,o,a,s,l,c){var u,h=(t=t||e[O]).options,p="on"+r.charAt(0).toUpperCase()+r.substr(1);!window.CustomEvent||j||q?(u=k.createEvent("Event")).initEvent(r,!0,!0):u=new CustomEvent(r,{bubbles:!0,cancelable:!0}),u.to=o||e,u.from=a||e,u.item=i||e,u.clone=n,u.oldIndex=s,u.newIndex=l,u.originalEvent=c,e&&e.dispatchEvent(u),h[p]&&h[p].call(t,u)}function Ct(t,e,r,n,i,o,a,s){var l,c,u=t[O],h=u.options.onMove;return!window.CustomEvent||j||q?(l=k.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=r,l.draggedRect=n,l.related=i||e,l.relatedRect=o||It(e),l.willInsertAfter=s,l.originalEvent=a,t.dispatchEvent(l),h&&(c=h.call(u,l,a)),c}function vt(t){t.draggable=!1}function Tt(){Y=!1}function _t(e,n,i){for(var o=0,a=0,s=e.children;a<s.length;){if("none"!==s[a].style.display&&s[a]!==r&&s[a]!==t&&ut(s[a],i.draggable,e,!1)){if(o===n)return s[a];o++}a++}return null}function St(t){for(var e=t.lastElementChild;(e===r||"none"===e.style.display)&&(e=e.previousElementSibling););return e||null}function Et(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,r=e.length,n=0;r--;)n+=e.charCodeAt(r);return n.toString(36)}function Lt(t,e){var r=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)"TEMPLATE"!==t.nodeName.toUpperCase()&&t!==n&&r++;return r}function wt(t,e){if(t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}function bt(t,e){return function(){if(!st){var r=arguments,n=this;st=F(function(){1===r.length?t.call(n,r[0]):t.apply(n,r),st=void 0},e)}}}function At(t,e){if(t&&e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function xt(t){return G&&G.dom?G.dom(t).cloneNode(!0):B?B(t).clone(!0)[0]:t.cloneNode(!0)}function Pt(t){return F(t,0)}function Rt(t){return clearTimeout(t)}function It(t,e,r){if(t.getBoundingClientRect||t===N){var n,i,o,a,s,l,c;if(c=t!==N?(i=(n=t.getBoundingClientRect()).top,o=n.left,a=n.bottom,s=n.right,l=n.height,n.width):(o=i=0,a=window.innerHeight,s=window.innerWidth,l=window.innerHeight,window.innerWidth),r&&t!==N){if(e=e||t.parentNode,!j)do{if(e&&e.getBoundingClientRect&&"none"!==ft(e,"transform")){var u=e.getBoundingClientRect();i-=u.top+D(ft(e,"border-top-width")),o-=u.left+D(ft(e,"border-left-width")),a=i+n.height,s=o+n.width;break}}while(e=e.parentNode);var h=gt(t),p=h&&h.a,d=h&&h.d;h&&(a=(i/=d)+(l/=d),s=(o/=p)+(c/=p))}return{top:i,left:o,bottom:a,right:s,width:c,height:l}}}return ht(k,"dragover",lt),ht(k,"mousemove",lt),ht(k,"touchmove",lt),ct.prototype={constructor:ct,_computeIsAligned:function(e){var n;if(r&&!V?(ot(),n=k.elementFromPoint(e.clientX,e.clientY),at()):n=e.target,n=ut(n,this.options.draggable,this.el,!1),!z&&t&&t.parentNode===this.el){for(var i,o,a,s,l,c,u,h,p=this.el.children,d=0;d<p.length;d++)ut(p[d],this.options.draggable,this.el,!1)&&p[d]!==n&&(p[d].sortableMouseAligned=(i=e.clientX,o=e.clientY,a=p[d],s=this._getDirection(e,null),this.options,l=It(a),c="vertical"===s?l.left:l.top,u="vertical"===s?l.right:l.bottom,c<(h="vertical"===s?i:o)&&h<u));ut(n,this.options.draggable,this.el,!0)||(T=null),z=!0,F(function(){z=!1},30)}},_getDirection:function(e,r){return"function"==typeof this.options.direction?this.options.direction.call(this,e,r,t):this.options.direction},_onTapStart:function(e){if(e.cancelable){var r,n=this,i=this.el,o=this.options,s=o.preventOnFilter,l=e.type,c=e.touches&&e.touches[0],u=(c||e).target,h=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||u,p=o.filter;if(function(t){$.length=0;for(var e=t.getElementsByTagName("input"),r=e.length;r--;){var n=e[r];n.checked&&$.push(n)}}(i),(!j||e.artificialBubble||nt(i,u))&&!t&&!(/mousedown|pointerdown/.test(l)&&0!==e.button||o.disabled||h.isContentEditable))if(u=ut(u,o.draggable,i,!1)){if(a!==u){if(r=Lt(u,o.draggable),"function"==typeof p){if(p.call(this,e,u,this))return mt(n,h,"filter",u,i,i,r),void(s&&e.cancelable&&e.preventDefault())}else if(p&&(p=p.split(",").some(function(t){if(t=ut(h,t.trim(),i,!1))return mt(n,t,"filter",u,i,i,r),!0})))return void(s&&e.cancelable&&e.preventDefault());o.handle&&!ut(h,o.handle,i,!1)||this._prepareDragStart(e,c,u,r)}}else j&&it(i,e,"_onTapStart")}},_handleAutoScroll:function(e,r){if(t&&this.options.scroll){var n=e.clientX,i=e.clientY,o=k.elementFromPoint(n,i),a=this;if(r||q||j){Q(e,a.options,o,r);var s=Z(o,!0);!b||f&&n===g&&i===y||(f&&clearInterval(f),f=setInterval(function(){if(t){var o=Z(k.elementFromPoint(n,i),!0);o!==s&&(s=o,tt(),Q(e,a.options,s,r))}},10),g=n,y=i)}else{if(!a.options.bubbleScroll||Z(o,!0)===window)return void tt();Q(e,a.options,Z(o,!1),!1)}}},_prepareDragStart:function(r,n,s,l){var c,h=this,d=h.el,f=h.options,g=d.ownerDocument;s&&!t&&s.parentNode===d&&(i=d,e=(t=s).parentNode,o=t.nextSibling,a=s,p=f.group,u=l,m={target:t,clientX:(n||r).clientX,clientY:(n||r).clientY},this._lastX=(n||r).clientX,this._lastY=(n||r).clientY,t.style["will-change"]="all",t.style.transition="",t.style.transform="",c=function(){h._disableDelayedDrag(),t.draggable=h.nativeDraggable,h._triggerDragStart(r,n),mt(h,i,"choose",t,i,i,u),dt(t,f.chosenClass,!0)},f.ignore.split(",").forEach(function(e){yt(t,e.trim(),vt)}),f.supportPointer?ht(g,"pointerup",h._onDrop):(ht(g,"mouseup",h._onDrop),ht(g,"touchend",h._onDrop),ht(g,"touchcancel",h._onDrop)),f.delay?(ht(g,"mouseup",h._disableDelayedDrag),ht(g,"touchend",h._disableDelayedDrag),ht(g,"touchcancel",h._disableDelayedDrag),ht(g,"mousemove",h._delayedDragTouchMoveHandler),ht(g,"touchmove",h._delayedDragTouchMoveHandler),f.supportPointer&&ht(g,"pointermove",h._delayedDragTouchMoveHandler),h._dragStartTimer=F(c,f.delay)):c())},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;K(X(e.clientX-this._lastX),X(e.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),pt(t,"mouseup",this._disableDelayedDrag),pt(t,"touchend",this._disableDelayedDrag),pt(t,"touchcancel",this._disableDelayedDrag),pt(t,"mousemove",this._delayedDragTouchMoveHandler),pt(t,"touchmove",this._delayedDragTouchMoveHandler),pt(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,r){r=r||("touch"==e.pointerType?e:null),!this.nativeDraggable||r?this.options.supportPointer?ht(k,"pointermove",this._onTouchMove):ht(k,r?"touchmove":"mousemove",this._onTouchMove):(ht(t,"dragend",this),ht(i,"dragstart",this._onDragStart));try{k.selection?Pt(function(){k.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e){if(A=!1,i&&t){this.nativeDraggable&&(ht(k,"dragover",this._handleAutoScroll),ht(k,"dragover",rt));var r=this.options;!e&&dt(t,r.dragClass,!1),dt(t,r.ghostClass,!0),ft(t,"transform",""),ct.active=this,e&&this._appendGhost(),mt(this,i,"start",t,i,i,u)}else this._nulling()},_emulateDragOver:function(e){if(C){if(this._lastX===C.clientX&&this._lastY===C.clientY&&!e)return;this._lastX=C.clientX,this._lastY=C.clientY,ot();for(var r=k.elementFromPoint(C.clientX,C.clientY),n=r;r&&r.shadowRoot;)n=r=r.shadowRoot.elementFromPoint(C.clientX,C.clientY);if(n)do{if(n[O]&&n[O]._onDragOver({clientX:C.clientX,clientY:C.clientY,target:r,rootEl:n})&&!this.options.dragoverBubble)break;r=n}while(n=n.parentNode);t.parentNode[O]._computeIsAligned(C),at()}},_onTouchMove:function(t){if(m){var e=this.options,n=e.fallbackTolerance,i=e.fallbackOffset,o=t.touches?t.touches[0]:t,a=r&&gt(r),s=r&&a&&a.a,l=r&&a&&a.d,c=(o.clientX-m.clientX+i.x)/(s||1),u=(o.clientY-m.clientY+i.y)/(l||1),h=t.touches?"translate3d("+c+"px,"+u+"px,0)":"translate("+c+"px,"+u+"px)";if(!ct.active&&!A){if(n&&K(X(o.clientX-this._lastX),X(o.clientY-this._lastY))<n)return;this._onDragStart(t,!0)}this._handleAutoScroll(o,!0),v=!0,C=o,ft(r,"webkitTransform",h),ft(r,"mozTransform",h),ft(r,"msTransform",h),ft(r,"transform",h),t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!r){var e=It(t,this.options.fallbackOnBody?k.body:i,!0),n=(ft(t),this.options);dt(r=t.cloneNode(!0),n.ghostClass,!1),dt(r,n.fallbackClass,!0),dt(r,n.dragClass,!0),ft(r,"box-sizing","border-box"),ft(r,"margin",0),ft(r,"top",e.top),ft(r,"left",e.left),ft(r,"width",e.width),ft(r,"height",e.height),ft(r,"opacity","0.8"),ft(r,"position","fixed"),ft(r,"zIndex","100000"),ft(r,"pointerEvents","none"),n.fallbackOnBody&&k.body.appendChild(r)||i.appendChild(r)}},_onDragStart:function(e,r){var o=this,a=e.dataTransfer,s=o.options;(n=xt(t)).draggable=!1,n.style["will-change"]="",this._hideClone(),dt(n,o.options.chosenClass,!1),o._cloneId=Pt(function(){o.options.removeCloneOnHide||i.insertBefore(n,t),mt(o,i,"clone",t)}),!r&&dt(t,s.dragClass,!0),r?(x=!0,o._loopId=setInterval(o._emulateDragOver,50)):(pt(k,"mouseup",o._onDrop),pt(k,"touchend",o._onDrop),pt(k,"touchcancel",o._onDrop),a&&(a.effectAllowed="move",s.setData&&s.setData.call(o,a,t)),ht(k,"drop",o),ft(t,"transform","translateZ(0)")),A=!0,o._dragStartId=Pt(o._dragStarted.bind(o,r)),ht(k,"selectstart",o)},_onDragOver:function(n){var a,s,l,c=this.el,h=n.target,f=this.options,g=f.group,y=ct.active,m=p===g,C=f.sort,w=this;if(!Y&&(!j||n.rootEl||n.artificialBubble||nt(c,h))){if(void 0!==n.preventDefault&&n.cancelable&&n.preventDefault(),v=!0,h=ut(h,f.draggable,c,!0),ut(n.target,null,t,!0)||h.animated)return Et();if(h!==t&&(x=!1),y&&!f.disabled&&(m?C||(l=!i.contains(t)):d===this||(this.lastPutMode=p.checkPull(this,y,t,n))&&g.checkPut(this,y,t,n))){var A=this._getDirection(n,h);if(a=It(t),l)return this._hideClone(),e=i,o?i.insertBefore(t,o):i.appendChild(t),Et();if(0===c.children.length||c.children[0]===r||(lt=n,ht=A,pt=It(St(c)),ft="vertical"===ht?lt.clientY:lt.clientX,gt="vertical"===ht?lt.clientX:lt.clientY,yt="vertical"===ht?pt.bottom:pt.right,vt="vertical"===ht?pt.left:pt.top,_t="vertical"===ht?pt.right:pt.bottom,("vertical"===ht?_t+10<gt||gt<=_t&&yt<ft&&vt<=gt:yt<ft&&vt<gt||ft<=yt&&_t+10<gt)&&!t.animated)){if(0!==c.children.length&&c.children[0]!==r&&c===n.target&&(h=St(c)),h&&(s=It(h)),m?y._hideClone():y._showClone(this),!1!==Ct(i,c,t,a,h,s,n,!!h))return c.appendChild(t),e=c,L=null,wt(),this._animate(a,t),h&&this._animate(s,h),Et()}else if(h&&h!==t&&h.parentNode===c){var P,M=0,D=h.sortableMouseAligned,B=t.parentNode!==c,G=function(t,e){for(var r=Z(r,!0),n=It(t)[e];r;){var i=It(r)[e];if(!("top"===e||"left"===e?i<=n:n<=i))return!0;if(r===N)break;r=Z(r,!1)}return!1}(h,"vertical"===A?"top":"left");if(T!==h&&(S=null,P=It(h)["vertical"===A?"top":"left"],R=!1),K=h,$=A,J=(z=t)===t&&L||It(z),Q=K===t&&L||It(K),tt="vertical"===$?J.left:J.top,et="vertical"===$?J.right:J.bottom,rt="vertical"===$?J.width:J.height,ot="vertical"===$?Q.left:Q.top,at="vertical"===$?Q.right:Q.bottom,st="vertical"===$?Q.width:Q.height,S=(tt===ot||et===at||tt+rt/2===ot+st/2)&&D||B||G||f.invertSwap||"insert"===S||"swap"===S?("swap"!==S&&(I=f.invertSwap||B||b||G),M=function(e,r,n,i,o,a,s){var l=It(r),c="vertical"===n?e.clientY:e.clientX,u="vertical"===n?l.height:l.width,h="vertical"===n?l.top:l.left,p="vertical"===n?l.bottom:l.right,d=It(t),f=!1;if(!a)if(s&&E<u*i)if(!R&&(1===_?h+u*o/2<c:c<p-u*o/2)&&(R=!0),R)f=!0;else{"vertical"===n?d.top:d.left,"vertical"===n?d.bottom:d.right;if(1===_?c<h+E:p-E<c)return-1*_}else if(h+u*(1-i)/2<c&&c<p-u*(1-i)/2)return h+u/2<c?-1:1;return(f=f||a)&&(c<h+u*o/2||p-u*o/2<c)?h+u/2<c?1:-1:0}(n,h,A,f.swapThreshold,null==f.invertedSwapThreshold?f.swapThreshold:f.invertedSwapThreshold,I,T===h),"swap"):(H=h,M=Lt(t,(V=f).draggable)<Lt(H,V.draggable)?1:-1,"insert"),0===M)return Et();L=null,_=M,s=It(T=h);var U=h.nextElementSibling,q=!1,W=Ct(i,c,t,a,h,s,n,q=1===M);if(!1!==W)return 1!==W&&-1!==W||(q=1===W),Y=!0,F(Tt,30),m?y._hideClone():y._showClone(this),q&&!U?c.appendChild(t):h.parentNode.insertBefore(t,q?U:h),e=t.parentNode,void 0===P||I||(E=X(P-It(h)["vertical"===A?"top":"left"])),wt(),!B&&this._animate(s,h),this._animate(a,t),Et()}if(c.contains(t))return Et()}var H,V,z,K,$,J,Q,tt,et,rt,ot,at,st,lt,ht,pt,ft,gt,yt,vt,_t;return j&&!n.rootEl&&it(c,n,"_onDragOver"),!1}function Et(){return y&&(dt(t,d?d.options.ghostClass:y.options.ghostClass,!1),dt(t,f.ghostClass,!0)),d!==w&&w!==ct.active?d=w:w===ct.active&&(d=null),(h===t&&!t.animated||h===c&&!h.animated)&&(T=null),f.dragoverBubble||n.rootEl||h===k||(w._handleAutoScroll(n),t.parentNode[O]._computeIsAligned(n)),!f.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),!0}function wt(){mt(w,i,"change",h,c,i,u,Lt(t,f.draggable),n)}},_animate:function(e,r){var n=this.options.animation;if(n){var i=It(r);if(r===t&&(L=i),1===e.nodeType&&(e=It(e)),e.left+e.width/2!==i.left+i.width/2||e.top+e.height/2!==i.top+i.height/2){var o=gt(this.el),a=o&&o.a,s=o&&o.d;ft(r,"transition","none"),ft(r,"transform","translate3d("+(e.left-i.left)/(a||1)+"px,"+(e.top-i.top)/(s||1)+"px,0)"),r.offsetWidth,ft(r,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),ft(r,"transform","translate3d(0,0,0)")}"number"==typeof r.animated&&clearTimeout(r.animated),r.animated=F(function(){ft(r,"transition",""),ft(r,"transform",""),r.animated=!1},n)}},_offUpEvents:function(){var t=this.el.ownerDocument;pt(k,"touchmove",this._onTouchMove),pt(k,"pointermove",this._onTouchMove),pt(t,"mouseup",this._onDrop),pt(t,"touchend",this._onDrop),pt(t,"pointerup",this._onDrop),pt(t,"touchcancel",this._onDrop),pt(k,"selectstart",this)},_onDrop:function(a){var s=this.el,l=this.options;R=I=b=A=!1,clearInterval(this._loopId),clearInterval(f),tt(),clearTimeout(st),st=void 0,clearTimeout(this._dragStartTimer),Rt(this._cloneId),Rt(this._dragStartId),pt(k,"mousemove",this._onTouchMove),this.nativeDraggable&&(pt(k,"drop",this),pt(s,"dragstart",this._onDragStart),pt(k,"dragover",this._handleAutoScroll),pt(k,"dragover",rt)),this._offUpEvents(),a&&(v&&(a.cancelable&&a.preventDefault(),!l.dropBubble&&a.stopPropagation()),r&&r.parentNode&&r.parentNode.removeChild(r),(i===e||d&&"clone"!==d.lastPutMode)&&n&&n.parentNode&&n.parentNode.removeChild(n),t&&(this.nativeDraggable&&pt(t,"dragend",this),vt(t),t.style["will-change"]="",dt(t,d?d.options.ghostClass:this.options.ghostClass,!1),dt(t,this.options.chosenClass,!1),mt(this,i,"unchoose",t,e,i,u,null,a),i!==e?(0<=(h=Lt(t,l.draggable))&&(mt(null,e,"add",t,e,i,u,h,a),mt(this,i,"remove",t,e,i,u,h,a),mt(null,e,"sort",t,e,i,u,h,a),mt(this,i,"sort",t,e,i,u,h,a)),d&&d.save()):t.nextSibling!==o&&0<=(h=Lt(t,l.draggable))&&(mt(this,i,"update",t,e,i,u,h,a),mt(this,i,"sort",t,e,i,u,h,a)),ct.active&&(null!=h&&-1!==h||(h=u),mt(this,i,"end",t,e,i,u,h,a),this.save()))),this._nulling()},_nulling:function(){i=t=e=r=o=n=a=s=l=w.length=f=g=y=m=C=v=h=u=T=_=L=d=p=ct.active=null,$.forEach(function(t){t.checked=!0}),$.length=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":t&&(this._onDragOver(e),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="none");t.cancelable&&t.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var t,e=[],r=this.el.children,n=0,i=r.length,o=this.options;n<i;n++)ut(t=r[n],o.draggable,this.el,!1)&&e.push(t.getAttribute(o.dataIdAttr)||Et(t));return e},sort:function(t){var e={},r=this.el;this.toArray().forEach(function(t,n){var i=r.children[n];ut(i,this.options.draggable,r,!1)&&(e[t]=i)},this),t.forEach(function(t){e[t]&&(r.removeChild(e[t]),r.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return ut(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var r=this.options;if(void 0===e)return r[t];r[t]=e,"group"===t&&et(r)},destroy:function(){var t=this.el;t[O]=null,pt(t,"mousedown",this._onTapStart),pt(t,"touchstart",this._onTapStart),pt(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(pt(t,"dragover",this),pt(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),P.splice(P.indexOf(this.el),1),this.el=t=null},_hideClone:function(){n.cloneHidden||(ft(n,"display","none"),n.cloneHidden=!0,n.parentNode&&this.options.removeCloneOnHide&&n.parentNode.removeChild(n))},_showClone:function(e){"clone"===e.lastPutMode?n.cloneHidden&&(i.contains(t)&&!this.options.group.revertClone?i.insertBefore(n,t):o?i.insertBefore(n,o):i.appendChild(n),this.options.group.revertClone&&this._animate(t,n),ft(n,"display",""),n.cloneHidden=!1):this._hideClone()}},ht(k,"touchmove",function(t){(ct.active||A)&&t.cancelable&&t.preventDefault()}),ct.utils={on:ht,off:pt,css:ft,find:yt,is:function(t,e){return!!ut(t,e,t,!1)},extend:At,throttle:bt,closest:ut,toggleClass:dt,clone:xt,index:Lt,nextTick:Pt,cancelNextTick:Rt,detectDirection:J,getChild:_t},ct.create=function(t,e){return new ct(t,e)},ct.version="1.8.2",ct});!function(){function t(t){this.mode=s.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=[],r=0,n=this.data.length;n>r;r++){var i=this.data.charCodeAt(r);i>65536?(e[0]=240|(1835008&i)>>>18,e[1]=128|(258048&i)>>>12,e[2]=128|(4032&i)>>>6,e[3]=128|63&i):i>2048?(e[0]=224|(61440&i)>>>12,e[1]=128|(4032&i)>>>6,e[2]=128|63&i):i>128?(e[0]=192|(1984&i)>>>6,e[1]=128|63&i):e[0]=i,this.parsedData=this.parsedData.concat(e)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var n=0;n<t.length-r;n++)this.num[n]=t[n+r]}function n(t,e){this.totalCount=t,this.dataCount=e}function i(){this.buffer=[],this.length=0}function o(){var t=!1,e=navigator.userAgent;return/android/i.test(e)&&(t=!0,aMat=e.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(t=parseFloat(aMat[1]))),t}function a(t,e){for(var r=1,n=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),i=0,o=d.length;o>=i;i++){var a=0;switch(e){case l.L:a=d[i][0];break;case l.M:a=d[i][1];break;case l.Q:a=d[i][2];break;case l.H:a=d[i][3]}if(a>=n)break;r++}if(r>d.length)throw new Error("Too long data");return r}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var n=-1;7>=n;n++)-1>=e+n||this.moduleCount<=e+n||(this.modules[t+r][e+n]=r>=0&&6>=r&&(0==n||6==n)||n>=0&&6>=n&&(0==r||6==r)||r>=2&&4>=r&&n>=2&&4>=n)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;8>r;r++){this.makeImpl(!0,r);var n=u.getLostPoint(this);(0==r||t>n)&&(t=n,e=r)}return e},createMovieClip:function(t,e,r){var n=t.createEmptyMovieClip(e,r);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,a=0;a<this.modules[i].length;a++){var s=1*a;this.modules[i][a]&&(n.beginFill(0,100),n.moveTo(s,o),n.lineTo(s+1,o),n.lineTo(s+1,o+1),n.lineTo(s,o+1),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=0==t%2);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=0==e%2)},setupPositionAdjustPattern:function(){for(var t=u.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var n=t[e],i=t[r];if(null==this.modules[n][i])for(var o=-2;2>=o;o++)for(var a=-2;2>=a;a++)this.modules[n+o][i+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a}},setupTypeNumber:function(t){for(var e=u.getBCHTypeNumber(this.typeNumber),r=0;18>r;r++){var n=!t&&1==(1&e>>r);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;18>r;r++){n=!t&&1==(1&e>>r);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,n=u.getBCHTypeInfo(r),i=0;15>i;i++){var o=!t&&1==(1&n>>i);6>i?this.modules[i][8]=o:8>i?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;15>i;i++){o=!t&&1==(1&n>>i);8>i?this.modules[8][this.moduleCount-i-1]=o:9>i?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,n=this.moduleCount-1,i=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[n][a-s]){var l=!1;o<t.length&&(l=1==(1&t[o]>>>i));u.getMask(e,n,a-s)&&(l=!l),this.modules[n][a-s]=l,-1==--i&&(o++,i=7)}if(0>(n+=r)||this.moduleCount<=n){n-=r,r=-r;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,r,o){for(var a=n.getRSBlocks(t,r),s=new i,l=0;l<o.length;l++){var c=o[l];s.put(c.mode,4),s.put(c.getLength(),u.getLengthInBits(c.mode,t)),c.write(s)}var h=0;for(l=0;l<a.length;l++)h+=a[l].dataCount;if(s.getLengthInBits()>8*h)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*h+")");for(s.getLengthInBits()+4<=8*h&&s.put(0,4);0!=s.getLengthInBits()%8;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*h)&&(s.put(e.PAD0,8),!(s.getLengthInBits()>=8*h));)s.put(e.PAD1,8);return e.createBytes(s,a)},e.createBytes=function(t,e){for(var n=0,i=0,o=0,a=new Array(e.length),s=new Array(e.length),l=0;l<e.length;l++){var c=e[l].dataCount,h=e[l].totalCount-c;i=Math.max(i,c),o=Math.max(o,h),a[l]=new Array(c);for(var p=0;p<a[l].length;p++)a[l][p]=255&t.buffer[p+n];n+=c;var d=u.getErrorCorrectPolynomial(h),f=new r(a[l],d.getLength()-1).mod(d);s[l]=new Array(d.getLength()-1);for(p=0;p<s[l].length;p++){var g=p+f.getLength()-s[l].length;s[l][p]=g>=0?f.get(g):0}}var y=0;for(p=0;p<e.length;p++)y+=e[p].totalCount;var m=new Array(y),C=0;for(p=0;i>p;p++)for(l=0;l<e.length;l++)p<a[l].length&&(m[C++]=a[l][p]);for(p=0;o>p;p++)for(l=0;l<e.length;l++)p<s[l].length&&(m[C++]=s[l][p]);return m};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;u.getBCHDigit(e)-u.getBCHDigit(u.G15)>=0;)e^=u.G15<<u.getBCHDigit(e)-u.getBCHDigit(u.G15);return(t<<10|e)^u.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;u.getBCHDigit(e)-u.getBCHDigit(u.G18)>=0;)e^=u.G18<<u.getBCHDigit(e)-u.getBCHDigit(u.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return u.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case c.PATTERN000:return 0==(e+r)%2;case c.PATTERN001:return 0==e%2;case c.PATTERN010:return 0==r%3;case c.PATTERN011:return 0==(e+r)%3;case c.PATTERN100:return 0==(Math.floor(e/2)+Math.floor(r/3))%2;case c.PATTERN101:return 0==e*r%2+e*r%3;case c.PATTERN110:return 0==(e*r%2+e*r%3)%2;case c.PATTERN111:return 0==(e*r%3+(e+r)%2)%2;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new r([1],0),n=0;t>n;n++)e=e.multiply(new r([1,h.gexp(n)],0));return e},getLengthInBits:function(t,e){if(e>=1&&10>e)switch(t){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,n=0;e>n;n++)for(var i=0;e>i;i++){for(var o=0,a=t.isDark(n,i),s=-1;1>=s;s++)if(!(0>n+s||n+s>=e))for(var l=-1;1>=l;l++)0>i+l||i+l>=e||(0!=s||0!=l)&&a==t.isDark(n+s,i+l)&&o++;o>5&&(r+=3+o-5)}for(n=0;e-1>n;n++)for(i=0;e-1>i;i++){var c=0;t.isDark(n,i)&&c++,t.isDark(n+1,i)&&c++,t.isDark(n,i+1)&&c++,t.isDark(n+1,i+1)&&c++,(0==c||4==c)&&(r+=3)}for(n=0;e>n;n++)for(i=0;e-6>i;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(r+=40);for(i=0;e>i;i++)for(n=0;e-6>n;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(r+=40);var u=0;for(i=0;e>i;i++)for(n=0;e>n;n++)t.isDark(n,i)&&u++;return r+10*(Math.abs(100*u/e/e-50)/5)}},h={glog:function(t){if(1>t)throw new Error("glog("+t+")");return h.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return h.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;8>p;p++)h.EXP_TABLE[p]=1<<p;for(p=8;256>p;p++)h.EXP_TABLE[p]=h.EXP_TABLE[p-4]^h.EXP_TABLE[p-5]^h.EXP_TABLE[p-6]^h.EXP_TABLE[p-8];for(p=0;255>p;p++)h.LOG_TABLE[h.EXP_TABLE[p]]=p;r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<t.getLength();i++)e[n+i]^=h.gexp(h.glog(this.get(n))+h.glog(t.get(i)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=h.glog(this.get(0))-h.glog(t.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(i=0;i<t.getLength();i++)n[i]^=h.gexp(h.glog(t.get(i))+e);return new r(n,0).mod(t)}},n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],n.getRSBlocks=function(t,e){var r=n.getRsBlockTable(t,e);if(null==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var i=r.length/3,o=[],a=0;i>a;a++)for(var s=r[3*a+0],l=r[3*a+1],c=r[3*a+2],u=0;s>u;u++)o.push(new n(l,c));return o},n.getRsBlockTable=function(t,e){switch(e){case l.L:return n.RS_BLOCK_TABLE[4*(t-1)+0];case l.M:return n.RS_BLOCK_TABLE[4*(t-1)+1];case l.Q:return n.RS_BLOCK_TABLE[4*(t-1)+2];case l.H:return n.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},i.prototype={get:function(t){var e=Math.floor(t/8);return 1==(1&this.buffer[e]>>>7-t%8)},put:function(t,e){for(var r=0;e>r;r++)this.putBit(1==(1&t>>>e-r-1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var d=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],f=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)e.hasOwnProperty(n)&&r.setAttribute(n,e[n]);return r}var r=this._htOption,n=this._el,i=t.getModuleCount();Math.floor(r.width/i),Math.floor(r.height/i),this.clear();var o=e("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:r.colorLight});o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(o),o.appendChild(e("rect",{fill:r.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;i>a;a++)for(var s=0;i>s;s++)if(t.isDark(a,s)){var l=e("use",{x:String(a),y:String(s)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),o.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),g="svg"===document.documentElement.tagName.toLowerCase()?f:"undefined"!=typeof CanvasRenderingContext2D?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,n,i,o,a,s,l,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===c&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);r.apply(this,arguments)}}var n=function(t,e){this._bIsPainted=!1,this._android=o(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(t){var e=this._elImage,r=this._oContext,n=this._htOption,i=t.getModuleCount(),o=n.width/i,a=n.height/i,s=Math.round(o),l=Math.round(a);e.style.display="none",this.clear();for(var c=0;i>c;c++)for(var u=0;i>u;u++){var h=t.isDark(c,u),p=u*o,d=c*a;r.strokeStyle=h?n.colorDark:n.colorLight,r.lineWidth=1,r.fillStyle=h?n.colorDark:n.colorLight,r.fillRect(p,d,o,a),r.strokeRect(Math.floor(p)+.5,Math.floor(d)+.5,s,l),r.strokeRect(Math.ceil(p)-.5,Math.ceil(d)-.5,s,l)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var r=this;if(r._fFail=e,r._fSuccess=t,null===r._bSupportDataURI){var n=document.createElement("img"),i=function(){r._bSupportDataURI=!1,r._fFail&&_fFail.call(r)};return n.onabort=i,n.onerror=i,n.onload=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)},void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===r._bSupportDataURI&&r._fSuccess?r._fSuccess.call(r):!1===r._bSupportDataURI&&r._fFail&&r._fFail.call(r)}.call(this,t)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},n}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,r=this._el,n=t.getModuleCount(),i=Math.floor(e.width/n),o=Math.floor(e.height/n),a=['<table style="border:0;border-collapse:collapse;">'],s=0;n>s;s++){a.push("<tr>");for(var l=0;n>l;l++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+o+"px;background-color:"+(t.isDark(s,l)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),r.innerHTML=a.join("");var c=r.childNodes[0],u=(e.width-c.offsetWidth)/2,h=(e.height-c.offsetHeight)/2;u>0&&h>0&&(c.style.margin=h+"px "+u+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();(QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof e&&(e={text:e}),e)for(var r in e)this._htOption[r]=e[r];"string"==typeof t&&(t=document.getElementById(t)),this._android=o(),this._el=t,this._oQRCode=null,this._oDrawing=new g(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(a(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();(void 0!==define&&define.amd?define:function(t,e){var r,n=e();if(void 0!==exports)for(r in n)exports[r]=n[r];else window.jsonpack=n})([],function(){var t=-4,e=function(t){return"string"!=typeof t?t:t.replace(/[\+ \|\^\%]/g,function(t){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[t]})},r=function(t){return"string"!=typeof t?t:t.replace(/\+|%2B|%7C|%5E|%25/g,function(t){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[t]})},n=function(t){return Number.prototype.toString.call(t,36).toUpperCase()},i=function(t){return parseInt(t,36)},o=Array.prototype.indexOf||function(t,e){for(var r=e||0,n=this.length;r<n;r++)if(this[r]===t)return r;return-1};return{JSON:JSON,pack:function(r,i){var a,s,l;(a=(i=i||{}).verbose||!1)&&console.log("Normalize the JSON Object");r="string"==typeof r?this.JSON.parse(r):r;a&&console.log("Creating a empty dictionary");s={strings:[],integers:[],floats:[]};a&&console.log("Creating the AST");var c=function r(i){var l,c,u,h,p;if(a&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(i)),l=typeof i,null===i)return{type:"null",index:-3};if(void 0===i)return{type:"undefined",index:-5};if(i instanceof Array){u=["@"];for(c in i)i.hasOwnProperty(c)&&u.push(r(i[c]));return u}if("object"===l){u=["$"];for(h in i)i.hasOwnProperty(h)&&(u.push(r(h)),u.push(r(i[h])));return u}if(""===i)return{type:"empty",index:t};if("string"===l)return-1==(p=o.call(s.strings,i))&&(s.strings.push(e(i)),p=s.strings.length-1),{type:"strings",index:p};if("number"===l&&i%1==0)return-1==(p=o.call(s.integers,i))&&(s.integers.push(n(i)),p=s.integers.length-1),{type:"integers",index:p};if("number"===l)return-1==(p=o.call(s.floats,i))&&(s.floats.push(i),p=s.floats.length-1),{type:"floats",index:p};if("boolean"===l)return{type:"boolean",index:i?-1:-2};throw new Error("Unexpected argument of type "+typeof i)}(r),u=s.strings.length,h=s.integers.length;s.floats.length;return a&&console.log("Parsing the dictionary"),l=s.strings.join("|"),l+="^"+s.integers.join("|"),l+="^"+s.floats.join("|"),a&&console.log("Parsing the structure"),l+="^"+function e(r){var i,o,s,l;if(a&&console.log("Calling a recursiveParser with "+this.JSON.stringify(r)),r instanceof Array){i=r.shift();for(o in r)r.hasOwnProperty(o)&&(i+=e(r[o])+"|");return("|"===i[i.length-1]?i.slice(0,-1):i)+"]"}if(s=r.type,l=r.index,"strings"===s)return n(l);if("integers"===s)return n(u+l);if("floats"===s)return n(u+h+l);if("boolean"===s)return r.index;if("null"===s)return-3;if("undefined"===s)return-5;if("empty"===s)return t;throw new TypeError("The item is alien!")}(c),a&&console.log("Ending parser"),i.debug?{dictionary:s,ast:c,packed:l}:l},unpack:function(e,n){var o,a,s,l,c,u,h,p;if(n=n||{},o=e.split("^"),n.verbose&&console.log("Building dictionary"),a=[],""!==(s=o[0]))for(s=s.split("|"),n.verbose&&console.log("Parse the strings dictionary"),c=0,l=s.length;c<l;c++)a.push(r(s[c]));if(""!==(s=o[1]))for(s=s.split("|"),n.verbose&&console.log("Parse the integers dictionary"),c=0,l=s.length;c<l;c++)a.push(i(s[c]));if(""!==(s=o[2]))for(s=s.split("|"),n.verbose&&console.log("Parse the floats dictionary"),c=0,l=s.length;c<l;c++)a.push(parseFloat(s[c]));s=null;n.verbose&&console.log("Tokenizing the structure");var d="",f=[],g=o[3].length;for(c=0;c<g;c++)"|"===(u=o[3].charAt(c))||"$"===u||"@"===u||"]"===u?(d&&(f.push(i(d)),d=""),"|"!==u&&f.push(u)):d+=u;return h=f.length,p=0,n.verbose&&console.log("Starting recursive parser"),function e(){var r,i,o,s=f[p++];if(n.verbose&&console.log("Reading collection type "+("$"===s?"object":"Array")),"@"===s){for(r=[];p<h;p++){if(o=f[p],n.verbose&&console.log("Read "+o+" symbol"),"]"===o)return r;if("@"===o||"$"===o)r.push(e());else switch(o){case-1:r.push(!0);break;case-2:r.push(!1);break;case-3:r.push(null);break;case-5:r.push(void 0);break;case t:r.push("");break;default:r.push(a[o])}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(r)),r}if("$"===s){for(r={};p<h;p++){if("]"===(i=f[p]))return r;if(i=i===t?"":a[i],"@"===(o=f[++p])||"$"===o)r[i]=e();else switch(o){case-1:r[i]=!0;break;case-2:r[i]=!1;break;case-3:r[i]=null;break;case-5:r[i]=void 0;break;case t:r[i]="";break;default:r[i]=a[o]}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(r)),r}throw new TypeError("Bad token "+s+" isn't a type")}()}}});!function(t,e){"use strict";var r="model",n="name",i="type",o="vendor",a="version",s="mobile",l="tablet",c={extend:function(t,e){var r={};for(var n in t)e[n]&&e[n].length%2==0?r[n]=e[n].concat(t[n]):r[n]=t[n];return r},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},u={rgx:function(t,e){for(var r,n,i,o,a,s,l=0;l<e.length&&!a;){var c=e[l],u=e[l+1];r=n=0;for(;r<c.length&&!a;)if(a=c[r++].exec(t))for(i=0;i<u.length;i++){s=a[++n];"object"==typeof(o=u[i])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0}l+=2}},str:function(t,e){for(var r in e)if("object"==typeof e[r]&&e[r].length>0){for(var n=0;n<e[r].length;n++)if(c.has(e[r][n],t))return"?"===r?void 0:r}else if(c.has(e[r],t))return"?"===r?void 0:r;return t}},h={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[n,a],[/(opios)[\/\s]+([\w\.]+)/i],[[n,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[n,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[n,a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[n,"IE"],a],[/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i],[[n,"Edge"],a],[/(yabrowser)\/([\w\.]+)/i],[[n,"Yandex"],a],[/(puffin)\/([\w\.]+)/i],[[n,"Puffin"],a],[/(focus)\/([\w\.]+)/i],[[n,"Firefox Focus"],a],[/(opt)\/([\w\.]+)/i],[[n,"Opera Touch"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[n,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[n,/_/g," "],a],[/(micromessenger)\/([\w\.]+)/i],[[n,"WeChat"],a],[/(brave)\/([\w\.]+)/i],[[n,"Brave"],a],[/(qqbrowserlite)\/([\w\.]+)/i],[n,a],[/(QQ)\/([\d\.]+)/i],[n,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[n,a],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[n,a],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[n,a],[/(MetaSr)[\/\s]?([\w\.]+)/i],[n],[/(LBBROWSER)/i],[n],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[n,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[n,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[n,a],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[n,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[n,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[n,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[n,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[n,a],[/(dolfin)\/([\w\.]+)/i],[[n,"Dolphin"],a],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[n,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[n,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[n,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[n,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,n],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[n,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[n,[a,u.str,h.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[n,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[n,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[n,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",c.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",c.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",c.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,o,[i,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[o,"Apple"],[i,l]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[o,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,r,[i,l]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[r,[o,"Amazon"],[i,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[r,u.str,h.device.amazon.model],[o,"Amazon"],[i,s]],[/android.+aft([bms])\sbuild/i],[r,[o,"Amazon"],[i,"smarttv"]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,o,[i,s]],[/\((ip[honed|\s\w*]+);/i],[r,[o,"Apple"],[i,s]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,r,[i,s]],[/\(bb10;\s(\w+)/i],[r,[o,"BlackBerry"],[i,s]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[o,"Asus"],[i,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[r,"Xperia Tablet"],[i,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[r,[o,"Sony"],[i,s]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,r,[i,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[o,"Nvidia"],[i,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[o,"Sony"],[i,"console"]],[/(sprint\s(\w+))/i],[[o,u.str,h.device.sprint.vendor],[r,u.str,h.device.sprint.model],[i,s]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[o,r,[i,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[o,[r,/_/g," "],[i,s]],[/(nexus\s9)/i],[r,[o,"HTC"],[i,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[r,[o,"Huawei"],[i,s]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,r,[i,s]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[o,"Microsoft"],[i,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[o,"Microsoft"],[i,s]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[o,"Motorola"],[i,s]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[o,"Motorola"],[i,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,c.trim],[r,c.trim],[i,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[o,"Samsung"],[i,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[o,"Sharp"],[i,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],r,[i,l]],[/smart-tv.+(samsung)/i],[o,[i,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[o,"Samsung"],r,[i,s]],[/sie-(\w*)/i],[r,[o,"Siemens"],[i,s]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[o,"Nokia"],r,[i,s]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[o,"Acer"],[i,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[o,"LG"],[i,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],r,[i,l]],[/(lg) netcast\.tv/i],[o,r,[i,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[o,"LG"],[i,s]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[o,"Lenovo"],[i,l]],[/linux;.+((jolla));/i],[o,r,[i,s]],[/((pebble))app\/[\d\.]+\s/i],[o,r,[i,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,r,[i,s]],[/crkey/i],[[r,"Chromecast"],[o,"Google"]],[/android.+;\s(glass)\s\d/i],[r,[o,"Google"],[i,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[r,[o,"Google"],[i,l]],[/android.+;\s(pixel( [23])?( xl)?)\s/i],[r,[o,"Google"],[i,s]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[o,"Xiaomi"],[i,s]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[r,/_/g," "],[o,"Xiaomi"],[i,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[o,"Meizu"],[i,l]],[/(mz)-([\w-]{2,})/i],[[o,"Meizu"],r,[i,s]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[r,[o,"OnePlus"],[i,s]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[o,"RCA"],[i,l]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[r,[o,"Dell"],[i,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[o,"Verizon"],[i,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],r,[i,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[o,"NuVision"],[i,l]],[/android.+;\s(k88)\sbuild/i],[r,[o,"ZTE"],[i,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[o,"Swiss"],[i,s]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[o,"Swiss"],[i,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[o,"Zeki"],[i,l]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[o,"Dragon Touch"],r,[i,l]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[r,[o,"Insignia"],[i,l]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[r,[o,"NextBook"],[i,l]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],r,[i,s]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[o,"LvTel"],r,[i,s]],[/android.+;\s(PH-1)\s/i],[r,[o,"Essential"],[i,s]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[o,"Envizen"],[i,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[o,r,[i,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[o,"MachSpeed"],[i,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,r,[i,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[o,"Rotor"],[i,l]],[/android.+(KS(.+))\s+build/i],[r,[o,"Amazon"],[i,l]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[o,r,[i,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,c.lowerize],o,r],[/(android[\w\.\s\-]{0,9});.+build/i],[r,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[n,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,a],[/rv\:([\w\.]{1,9}).+(gecko)/i],[a,n]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[n,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[a,u.str,h.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[a,u.str,h.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[n,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[n,"Symbian"],a],[/\((series40);/i],[n],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[n,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],a],[/(sunos)\s?([\w\.\d]*)/i],[[n,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[n,a],[/(haiku)\s(\w+)/i],[n,a],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[n,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[n,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[n,a]]},d=function(e,r){if("object"==typeof e){r=e;e=void 0}if(!(this instanceof d))return new d(e,r).getResult();var n=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),i=r?c.extend(p,r):p;this.getBrowser=function(){var t={name:void 0,version:void 0};u.rgx.call(t,n,i.browser);t.major=c.major(t.version);return t};this.getCPU=function(){var t={architecture:void 0};u.rgx.call(t,n,i.cpu);return t};this.getDevice=function(){var t={vendor:void 0,model:void 0,type:void 0};u.rgx.call(t,n,i.device);return t};this.getEngine=function(){var t={name:void 0,version:void 0};u.rgx.call(t,n,i.engine);return t};this.getOS=function(){var t={name:void 0,version:void 0};u.rgx.call(t,n,i.os);return t};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return n};this.setUA=function(t){n=t;return this};return this};d.VERSION="0.7.19";d.BROWSER={NAME:n,MAJOR:"major",VERSION:a};d.CPU={ARCHITECTURE:"architecture"};d.DEVICE={MODEL:r,VENDOR:o,TYPE:i,CONSOLE:"console",MOBILE:s,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"};d.ENGINE={NAME:n,VERSION:a};d.OS={NAME:n,VERSION:a};if(void 0!==exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=d);exports.UAParser=d}else"function"==typeof define&&define.amd?define(function(){return d}):t&&(t.UAParser=d);var f=t&&(t.jQuery||t.Zepto);if(void 0!==f&&!f.ua){var g=new d;f.ua=g.getResult();f.ua.get=function(){return g.getUA()};f.ua.set=function(t){g.setUA(t);var e=g.getResult();for(var r in e)f.ua[r]=e[r]}}}("object"==typeof window?window:this);!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.proj4=e()}(this,function(){"use strict";function t(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(W,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(W,"")===i)return t[r]}function e(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=V}function r(t){return new e(t).output()}function n(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=e?{}:t,o=r.reduce(function(t,e){return i(e,t),t},n);e&&(t[e]=o)}function i(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void i(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){Array.isArray(r)||(e[r]={});var o;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&i(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&i(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void n(e,r,t);default:for(o=-1;++o<t.length;)if(!Array.isArray(t[o]))return i(t,e[r]);return n(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}function o(t){return t*J}function a(t){function e(e){return e*(t.to_meter||1)}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var r=t.GEOGCS;"GEOGCS"===t.type&&(r=t),r&&(r.DATUM?t.datumCode=r.DATUM.name.toLowerCase():t.datumCode=r.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),r.DATUM&&r.DATUM.SPHEROID&&(t.ellps=r.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=r.DATUM.SPHEROID.a,t.rf=parseFloat(r.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",o],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["alpha","azimuth",o],["srsCode","name"]].forEach(function(e){return function(t,e){var r=e[0],n=e[1];!(r in t)&&n in t&&(t[r]=t[n],3===e.length&&(t[r]=e[2](t[r])))}(t,e)}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=o(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function s(t){var e=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?s[t]=H(arguments[1]):s[t]=Z(arguments[1]):s[t]=r}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?s.apply(e,t):s(t)});if("string"==typeof t){if(t in s)return s[t]}else"EPSG"in t?s["EPSG:"+t.EPSG]=t:"ESRI"in t?s["ESRI:"+t.ESRI]=t:"IAU2000"in t?s["IAU2000:"+t.IAU2000]=t:console.log(t);return}}function l(t){return function(t){return"string"==typeof t}(t)?function(t){return t in s}(t)?s[t]:function(t){return Q.some(function(e){return t.indexOf(e)>-1})}(t)?Z(t):function(t){return"+"===t[0]}(t)?H(t):void 0:t}function c(t){return t}function u(t,e){var r=lt.length;return t.names?(lt[r]=t,t.names.forEach(function(t){st[t.toLowerCase()]=r}),this):(console.log(e),!0)}function h(e,r){if(!(this instanceof h))return new h(e);r=r||function(t){if(t)throw t};var n=l(e);if("object"==typeof n){var i=h.projections.get(n.projName);if(i){if(n.datumCode&&"none"!==n.datumCode){var o=t(pt,n.datumCode);o&&(n.datum_params=o.towgs84?o.towgs84.split(","):null,n.ellps=o.ellipse,n.datumName=o.datumName?o.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84";var a=function(e,r,n,i,o){if(!e){var a=t(ut,i);a||(a=ht),e=a.a,r=a.b,n=a.rf}return n&&!r&&(r=(1-1/n)*e),(0===n||Math.abs(e-r)<D)&&(o=!0,r=e),{a:e,b:r,rf:n,sphere:o}}(n.a,n.b,n.rf,n.ellps,n.sphere),s=function(t,e,r,n){var i=t*t,o=e*e,a=(i-o)/i,s=0;n?(i=(t*=1-a*(O+a*(N+a*k)))*t,a=0):s=Math.sqrt(a);return{es:a,e:s,ep2:(i-o)/o}}(a.a,a.b,a.rf,n.R_A),c=n.datum||function(t,e,r,n,i,o){var a={};return a.datum_type=void 0===t||"none"===t?R:P,e&&(a.datum_params=e.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=A),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=x,a.datum_params[3]*=I,a.datum_params[4]*=I,a.datum_params[5]*=I,a.datum_params[6]=a.datum_params[6]/1e6+1))),a.a=r,a.b=n,a.es=i,a.ep2=o,a}(n.datumCode,n.datum_params,a.a,a.b,s.es,s.ep2);tt(this,n),tt(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=c,this.init(),r(null,this)}else r(e)}else r(e)}function p(t){return t===A||t===x}function d(t,e,r){var n;return Array.isArray(r)&&(r=gt(r)),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===A||t.datum.datum_type===x)&&"WGS84"!==e.datumCode||(e.datum.datum_type===A||e.datum.datum_type===x)&&"WGS84"!==t.datumCode}(t,e)&&(r=d(t,n=new h("WGS84"),r),t=n),"enu"!==t.axis&&(r=ft(t,!1,r)),"longlat"===t.projName?r={x:r.x*F,y:r.y*F}:(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter}),r=t.inverse(r)),t.from_greenwich&&(r.x+=t.from_greenwich),r=dt(t.datum,e.datum,r),e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y}),"longlat"===e.projName?r={x:r.x*B,y:r.y*B}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter})),"enu"!==e.axis?ft(e,!0,r):r}function f(t,e,r){var n;return Array.isArray(r)?(n=d(t,e,r),3===r.length?[n.x,n.y,n.z]:[n.x,n.y]):d(t,e,r)}function g(t){return t instanceof h?t:t.oProj?t.oProj:h(t)}function y(t,e,r){t=g(t);var n,i=!1;return void 0===e?(e=t,t=yt,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=yt,i=!0),e=g(e),r?f(t,e,r):(n={forward:function(r){return f(t,e,r)},inverse:function(r){return f(e,t,r)}},i&&(n.oProj=e),n)}function m(t,e){return e=e||5,function(t,e){var r="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+function(t,e,r){var n=E(r),i=Math.floor(t/1e5),o=Math.floor(e/1e5)%20;return function(t,e,r){var n=r-1,i=Ct.charCodeAt(n),o=vt.charCodeAt(n),a=i+t-1,s=o+e,l=!1;a>Lt&&(a=a-Lt+Tt-1,l=!0),(a===_t||i<_t&&a>_t||(a>_t||i<_t)&&l)&&a++,(a===St||i<St&&a>St||(a>St||i<St)&&l)&&++a===_t&&a++,a>Lt&&(a=a-Lt+Tt-1),s>Et?(s=s-Et+Tt-1,l=!0):l=!1,(s===_t||o<_t&&s>_t||(s>_t||o<_t)&&l)&&s++,(s===St||o<St&&s>St||(s>St||o<St)&&l)&&++s===_t&&s++,s>Et&&(s=s-Et+Tt-1);return String.fromCharCode(a)+String.fromCharCode(s)}(i,o,n)}(t.easting,t.northing,t.zoneNumber)+r.substr(r.length-5,e)+n.substr(n.length-5,e)}(function(t){var e,r,n,i,o,a,s,l,c=t.lat,u=t.lon,h=6378137,p=.00669438,d=v(c),f=v(u);l=Math.floor((u+180)/6)+1,180===u&&(l=60),c>=56&&c<64&&u>=3&&u<12&&(l=32),c>=72&&c<84&&(u>=0&&u<9?l=31:u>=9&&u<21?l=33:u>=21&&u<33?l=35:u>=33&&u<42&&(l=37)),s=v(6*(l-1)-180+3),e=p/(1-p),r=h/Math.sqrt(1-p*Math.sin(d)*Math.sin(d)),n=Math.tan(d)*Math.tan(d),i=e*Math.cos(d)*Math.cos(d),o=Math.cos(d)*(f-s),a=h*(.9983242984503243*d-.002514607064228144*Math.sin(2*d)+2639046602129982e-21*Math.sin(4*d)-35*p*p*p/3072*Math.sin(6*d));var g=.9996*r*(o+(1-n+i)*o*o*o/6+(5-18*n+n*n+72*i-58*e)*o*o*o*o*o/120)+5e5,y=.9996*(a+r*Math.tan(d)*(o*o/2+(5-n+9*i+4*i*i)*o*o*o*o/24+(61-58*n+n*n+600*i-330*e)*o*o*o*o*o*o/720));return c<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(g),zoneNumber:l,zoneLetter:S(c)}}({lat:t[1],lon:t[0]}),e)}function C(t){var e=_(L(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function v(t){return t*(Math.PI/180)}function T(t){return t/Math.PI*180}function _(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,h,p,d,f=6378137,g=.00669438,y=(1-Math.sqrt(1-g))/(1+Math.sqrt(1-g)),m=r-5e5,C=e;n<"N"&&(C-=1e7),h=6*(i-1)-180+3,o=g/(1-g),d=(p=C/.9996/6367449.145945056)+(3*y/2-27*y*y*y/32)*Math.sin(2*p)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*p)+151*y*y*y/96*Math.sin(6*p),a=f/Math.sqrt(1-g*Math.sin(d)*Math.sin(d)),s=Math.tan(d)*Math.tan(d),l=o*Math.cos(d)*Math.cos(d),c=f*(1-g)/Math.pow(1-g*Math.sin(d)*Math.sin(d),1.5),u=m/(.9996*a);var v=d-a*Math.tan(d)/c*(u*u/2-(5+3*s+10*l-4*l*l-9*o)*u*u*u*u/24+(61+90*s+298*l+45*s*s-252*o-3*l*l)*u*u*u*u*u*u/720);v=T(v);var S,E=(u-(1+2*s+l)*u*u*u/6+(5-2*l+28*s-3*l*l+8*o+24*s*s)*u*u*u*u*u/120)/Math.cos(d);E=h+T(E);if(t.accuracy){var L=_({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});S={top:L.lat,right:L.lon,bottom:v,left:E}}else S={lat:v,lon:E};return S}function S(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function E(t){var e=t%mt;return 0===e&&(e=mt),e}function L(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,o++}var a=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(o,o+=2);for(var l=E(a),c=function(t,e){for(var r=Ct.charCodeAt(e-1),n=1e5,i=!1;r!==t.charCodeAt(0);){if(++r===_t&&r++,r===St&&r++,r>Lt){if(i)throw"Bad character: "+t;r=Tt,i=!0}n+=1e5}return n}(n.charAt(0),l),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=vt.charCodeAt(e-1),n=0,i=!1;r!==t.charCodeAt(0);){if(++r===_t&&r++,r===St&&r++,r>Et){if(i)throw"Bad character: "+t;r=Tt,i=!0}n+=1e5}return n}(n.charAt(1),l);u<w(s);)u+=2e6;var h=r-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var p,d,f,g=h/2,y=0,m=0;return g>0&&(p=1e5/Math.pow(10,g),d=t.substring(o,o+g),y=parseFloat(d)*p,f=t.substring(o+g),m=parseFloat(f)*p),{easting:y+c,northing:m+u,zoneLetter:s,zoneNumber:a,accuracy:p}}function w(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function b(t,e,r){if(!(this instanceof b))return new b(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var A=1,x=2,P=4,R=5,I=484813681109536e-20,M=Math.PI/2,O=.16666666666666666,N=.04722222222222222,k=.022156084656084655,D=void 0===Number.EPSILON?1e-10:Number.EPSILON,F=.017453292519943295,B=57.29577951308232,G=Math.PI/4,U=2*Math.PI,j={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},q={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},W=/[\s_\-\/\(\)]/g,H=function(e){var r,n,i,o={},a=e.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t},{}),s={proj:"projName",datum:"datumCode",rf:function(t){o.rf=parseFloat(t)},lat_0:function(t){o.lat0=t*F},lat_1:function(t){o.lat1=t*F},lat_2:function(t){o.lat2=t*F},lat_ts:function(t){o.lat_ts=t*F},lon_0:function(t){o.long0=t*F},lon_1:function(t){o.long1=t*F},lon_2:function(t){o.long2=t*F},alpha:function(t){o.alpha=parseFloat(t)*F},lonc:function(t){o.longc=t*F},x_0:function(t){o.x0=parseFloat(t)},y_0:function(t){o.y0=parseFloat(t)},k_0:function(t){o.k0=parseFloat(t)},k:function(t){o.k0=parseFloat(t)},a:function(t){o.a=parseFloat(t)},b:function(t){o.b=parseFloat(t)},r_a:function(){o.R_A=!0},zone:function(t){o.zone=parseInt(t,10)},south:function(){o.utmSouth=!0},towgs84:function(t){o.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){o.to_meter=parseFloat(t)},units:function(e){o.units=e;var r=t(q,e);r&&(o.to_meter=r.to_meter)},from_greenwich:function(t){o.from_greenwich=t*F},pm:function(e){var r=t(j,e);o.from_greenwich=(r||parseFloat(e))*F},nadgrids:function(t){"@null"===t?o.datumCode="none":o.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(o.axis=t)}};for(r in a)n=a[r],r in s?"function"==typeof(i=s[r])?i(n):o[i]=n:o[r]=n;return"string"==typeof o.datumCode&&"WGS84"!==o.datumCode&&(o.datumCode=o.datumCode.toLowerCase()),o},V=1,Y=/\s/,z=/[A-Za-z]/,X=/[A-Za-z84]/,K=/[,\]]/,$=/[\d\.E\-\+]/;e.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Y.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case V:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},e.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(K.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},e.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=V)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=V,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},e.prototype.number=function(t){if(!$.test(t)){if(K.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},e.prototype.quoted=function(t){return'"'===t?void(this.state=5):void(this.word+=t)},e.prototype.keyword=function(t){if(X.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=V)}if(!K.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},e.prototype.neutral=function(t){if(z.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if($.test(t))return this.word=t,void(this.state=3);if(!K.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},e.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var J=.017453292519943295,Z=function(t){var e=r(t),n=e.shift(),o=e.shift();e.unshift(["name",o]),e.unshift(["type",n]);var s={};return i(e,s),a(s),s};!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(s);var Q=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],tt=function(t,e){t=t||{};var r,n;if(!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t},et=function(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)},rt=function(t){return t<0?-1:1},nt=function(t){return Math.abs(t)<=3.14159265359?t:t-rt(t)*U},it=function(t,e,r){var n=t*r,i=.5*t;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(M-e))/n},ot=function(t,e){for(var r,n,i=.5*t,o=M-2*Math.atan(e),a=0;a<=15;a++)if(r=t*Math.sin(o),o+=n=M-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999},at=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=et(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,r,n=t.x,i=t.y;if(i*B>90&&i*B<-90&&n*B>180&&n*B<-180)return null;if(Math.abs(Math.abs(i)-M)<=D)return null;if(this.sphere)e=this.x0+this.a*this.k0*nt(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(G+.5*i));else{var o=Math.sin(i),a=it(this.e,i,o);e=this.x0+this.a*this.k0*nt(n-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=M-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=ot(this.e,o)))return null}return e=nt(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:c,inverse:c,names:["longlat","identity"]}],st={},lt=[],ct={start:function(){at.forEach(u)},add:u,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==st[e]&&lt[st[e]]?lt[st[e]]:void 0}},ut={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ht=ut.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ut.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var pt={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};h.projections=ct,h.projections.start();var dt=function(t,e,r){return function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===A?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==x||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e)?r:t.datum_type===R||e.datum_type===R?r:t.es!==e.es||t.a!==e.a||p(t.datum_type)||p(e.datum_type)?(r=function(t,e,r){var n,i,o,a,s=t.x,l=t.y,c=t.z?t.z:0;if(l<-M&&l>-1.001*M)l=-M;else if(l>M&&l<1.001*M)l=M;else if(l<-M||l>M)return null;return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(l),a=Math.cos(l),o=i*i,{x:((n=r/Math.sqrt(1-e*o))+c)*a*Math.cos(s),y:(n+c)*a*Math.sin(s),z:(n*(1-e)+c)*i}}(r,t.es,t.a),p(t.datum_type)&&(r=function(t,e,r){if(e===A)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===x){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6];return{x:c*(t.x-l*t.y+s*t.z)+n,y:c*(l*t.x+t.y-a*t.z)+i,z:c*(-s*t.x+a*t.y+t.z)+o}}}(r,t.datum_type,t.datum_params)),p(e.datum_type)&&(r=function(t,e,r){if(e===A)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===x){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=(t.x-n)/c,h=(t.y-i)/c,p=(t.z-o)/c;return{x:u+l*h-s*p,y:-l*u+h+a*p,z:s*u-a*h+p}}}(r,e.datum_type,e.datum_params)),function(t,e,r,n){var i,o,a,s,l,c,u,h,p,d,f,g,y,m,C,v=1e-12,T=t.x,_=t.y,S=t.z?t.z:0;if(i=Math.sqrt(T*T+_*_),o=Math.sqrt(T*T+_*_+S*S),i/r<v){if(m=0,o/r<v)return C=-n,{x:t.x,y:t.y,z:t.z}}else m=Math.atan2(_,T);a=S/o,h=(s=i/o)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*s*s)),p=a*l,y=0;do{y++,c=e*(u=r/Math.sqrt(1-e*p*p))/(u+(C=i*h+S*p-u*(1-e*p*p))),g=(f=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(d=s*(1-c)*l)*p,h=d,p=f}while(g*g>1e-24&&y<30);return{x:m,y:Math.atan(f/Math.abs(d)),z:C}}(r,e.es,e.a,e.b)):r},ft=function(t,e,r){var n,i,o,a=r.x,s=r.y,l=r.z||0,c={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==r.z)switch(0===o?(n=a,i="x"):1===o?(n=s,i="y"):(n=l,i="z"),t.axis[o]){case"e":c[i]=n;break;case"w":c[i]=-n;break;case"n":c[i]=n;break;case"s":c[i]=-n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c},gt=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e},yt=h("WGS84"),mt=6,Ct="AJSAJS",vt="AFAFAF",Tt=65,_t=73,St=79,Et=86,Lt=90,wt={forward:m,inverse:function(t){var e=_(L(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:C};b.fromMGRS=function(t){return new b(C(t))},b.prototype.toMGRS=function(t){return m([this.x,this.y],t)};var bt,At=.01953125,xt=.01068115234375,Pt=function(t){var e=[];e[0]=1-t*(.25+t*(.046875+t*(At+t*xt))),e[1]=t*(.75-t*(.046875+t*(At+t*xt)));var r=t*t;return e[2]=r*(.46875-t*(.013020833333333334+.007120768229166667*t)),r*=t,e[3]=r*(.3645833333333333-.005696614583333333*t),e[4]=r*t*.3076171875,e},Rt=function(t,e,r,n){return r*=e,e*=e,n[0]*t-r*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))},It=function(t,e,r){for(var n=1/(1-e),i=t,o=20;o;--o){var a=Math.sin(i),s=1-e*a*a;if(i-=s=(Rt(i,a,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<D)return i}return i},Mt={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Pt(this.es),this.ml0=Rt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,n,i=t.x,o=t.y,a=nt(i-this.long0),s=Math.sin(o),l=Math.cos(o);if(this.es){var c=l*a,u=Math.pow(c,2),h=this.ep2*Math.pow(l,2),p=Math.pow(h,2),d=Math.abs(l)>D?Math.tan(o):0,f=Math.pow(d,2),g=Math.pow(f,2);e=1-this.es*Math.pow(s,2),c/=Math.sqrt(e);var y=Rt(o,s,l,this.en);r=this.a*(this.k0*c*(1+u/6*(1-f+h+u/20*(5-18*f+g+14*h-58*f*h+u/42*(61+179*g-g*f-479*f)))))+this.x0,n=this.a*(this.k0*(y-this.ml0+s*a*c/2*(1+u/12*(5-f+9*h+4*p+u/30*(61+g-58*f+270*h-330*f*h+u/56*(1385+543*g-g*f-3111*f))))))+this.y0}else{var m=l*Math.sin(a);if(Math.abs(Math.abs(m)-1)<D)return 93;if(r=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,n=l*Math.cos(a)/Math.sqrt(1-Math.pow(m,2)),(m=Math.abs(n))>=1){if(m-1>D)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t},inverse:function(t){var e,r,n,i,o=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,r=It(e,this.es,this.en),Math.abs(r)<M){var s=Math.sin(r),l=Math.cos(r),c=Math.abs(l)>D?Math.tan(r):0,u=this.ep2*Math.pow(l,2),h=Math.pow(u,2),p=Math.pow(c,2),d=Math.pow(p,2);e=1-this.es*Math.pow(s,2);var f=o*Math.sqrt(e)/this.k0,g=Math.pow(f,2);n=r-(e*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*p-9*u*p+u-4*h-g/30*(61+90*p-252*u*p+45*d+46*u-g/56*(1385+3633*p+4095*d+1574*d*p)))),i=nt(this.long0+f*(1-g/6*(1+2*p+u-g/20*(5+28*p+24*d+8*u*p+6*u-g/42*(61+662*p+1320*d+720*d*p))))/l)}else n=M*rt(a),i=0;else{var y=Math.exp(o/this.k0),m=.5*(y-1/y),C=this.lat0+a/this.k0,v=Math.cos(C);e=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(m,2))),n=Math.asin(e),a<0&&(n=-n),i=0===m&&0===v?0:nt(Math.atan2(m,v)+this.long0)}return t.x=i,t.y=n,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Ot=function(t){var e=Math.exp(t);return(e-1/e)/2},Nt=function(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))},kt=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(Nt(1,e)+1))),t<0?-e:e},Dt=function(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return e+r*Math.sin(2*e)},Ft=function(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,o=t[i],a=0;--i>=0;)r=n*o-a+t[i],a=o,o=r;return Math.sin(e)*r},Bt=function(t,e,r){for(var n,i,o=Math.sin(e),a=Math.cos(e),s=Ot(r),l=function(t){var e=Math.exp(t);return(e+1/e)/2}(r),c=2*a*l,u=-2*o*s,h=t.length-1,p=t[h],d=0,f=0,g=0;--h>=0;)n=f,i=d,p=c*(f=p)-n-u*(d=g)+t[h],g=u*f-i+c*d;return[(c=o*l)*p-(u=a*s)*g,c*g+u*p]},Gt={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),r*=e,this.cgb[1]=r*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),r*=e,this.cgb[2]=r*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),r*=e,this.cgb[3]=r*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),r*=e,this.cgb[4]=r*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),r*=e,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),r*=e,this.utg[2]=r*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),r*=e,this.utg[3]=r*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),r*=e,this.utg[4]=r*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),r*=e,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var n=Dt(this.cbg,this.lat0);this.Zb=-this.Qn*(n+Ft(this.gtu,2*n))},forward:function(t){var e=nt(t.x-this.long0),r=t.y;r=Dt(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(e),a=Math.cos(e);r=Math.atan2(n,a*i),e=Math.atan2(o*i,Nt(n,i*a)),e=kt(Math.tan(e));var s,l,c=Bt(this.gtu,2*r,2*e);r+=c[0],e+=c[1];return Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),t.x=s,t.y=l,t},inverse:function(t){var e,r,n=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,n/=this.Qn;if(Math.abs(n)<=2.623395162778){var o=Bt(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(Ot(n));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(n),c=Math.cos(n);i=Math.atan2(a*c,Nt(l,c*s)),n=Math.atan2(l,c*s),e=nt(n+this.long0),r=Dt(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Ut=function(t,e){if(void 0===t){if((t=Math.floor(30*(nt(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t},jt={init:function(){var t=Ut(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*F,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Gt.init.apply(this),this.forward=Gt.forward,this.inverse=Gt.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},qt=function(t,e){return Math.pow((1-t)/(1+t),e)},Wt=20,Ht={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+G)/(Math.pow(Math.tan(.5*this.lat0+G),this.C)*qt(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+G),this.C)*qt(this.e*Math.sin(r),this.ratexp))-M,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+G)/this.K,1/this.C),i=Wt;i>0&&(r=2*Math.atan(n*qt(this.e*Math.sin(t.y),-.5*this.e))-M,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]},Vt={init:function(){Ht.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,n,i;return t.x=nt(t.x-this.long0),Ht.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n),t.x=i*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,n,i,o;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,o=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(o,this.R2);e=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/o),n=Math.atan2(t.x*e,o*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,Ht.inverse.apply(this,[t]),t.x=nt(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},Yt={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*(1+rt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=D&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*this.cons*et(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/it(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=et(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-M,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,n,i,o,a,s=t.x,l=t.y,c=Math.sin(l),u=Math.cos(l),h=nt(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=D&&Math.abs(l+this.lat0)<=D?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(h)),t.x=this.a*e*u*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*c-this.sinlat0*u*Math.cos(h))+this.y0,t):(r=2*Math.atan(this.ssfn_(l,c,this.e))-M,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=D?(o=it(this.e,l*this.con,this.con*c),a=2*this.a*this.k0*o/this.cons,t.x=this.x0+a*Math.sin(s-this.long0),t.y=this.y0-this.con*a*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<D?(e=2*this.a*this.k0/(1+i*Math.cos(h)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),t.x=e*i*Math.sin(h)+this.x0,t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var s=2*Math.atan(a/(.5*this.a*this.k0));return e=this.long0,r=this.lat0,a<=D?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/a),e=nt(Math.abs(this.coslat0)<D?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(s),a*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=D){if(a<=D)return r=this.lat0,e=this.long0,t.x=e,t.y=r,t;t.x*=this.con,t.y*=this.con,n=a*this.cons/(2*this.a*this.k0),r=this.con*ot(this.e,n),e=this.con*nt(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=D?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+t.y*Math.sin(i)*this.cosX0/a),e=nt(this.long0+Math.atan2(t.x*Math.sin(i),a*this.cosX0*Math.cos(i)-t.y*this.sinX0*Math.sin(i)))),r=-1*ot(this.e,Math.tan(.5*(M+o)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(M+t))*Math.pow((1-e)/(1+e),.5*r)}},zt={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+o*e)/(1-o*e));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,r=t.y-this.y0,n=e/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=s,t.y=c,t},names:["somerc"]},Xt={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),r=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-r*r);var n,i,o=it(this.e,this.lat0,t),a=this.bl/e*Math.sqrt((1-this.es)/(1-r*r));a*a<1&&(a=1);if(isNaN(this.longc)){var s=it(this.e,this.lat1,Math.sin(this.lat1)),l=it(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var c=Math.pow(s,this.bl),u=Math.pow(l,this.bl);i=.5*((n=this.el/c)-1/n);var h=(this.el*this.el-u*c)/(this.el*this.el+u*c),p=(u-c)/(u+c),d=nt(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(h*Math.tan(.5*this.bl*d)/p)/this.bl,this.long0=nt(this.long0);var f=nt(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*f)/i),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else n=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=n*Math.pow(o,this.bl),i=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},forward:function(t){var e,r,n,i=t.x,o=t.y,a=nt(i-this.long0);if(Math.abs(Math.abs(o)-M)<=D)n=o>0?-1:1,r=this.al/this.bl*Math.log(Math.tan(G+n*this.gamma0*.5)),e=-1*n*M*this.al/this.bl;else{var s=it(this.e,o,Math.sin(o)),l=this.el/Math.pow(s,this.bl),c=.5*(l-1/l),u=.5*(l+1/l),h=Math.sin(this.bl*a),p=(c*Math.sin(this.gamma0)-h*Math.cos(this.gamma0))/u;r=Math.abs(Math.abs(p)-1)<=D?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-p)/(1+p))/this.bl,e=Math.abs(Math.cos(this.bl*a))<=D?this.al*this.bl*a:this.al*Math.atan2(c*Math.cos(this.gamma0)+h*Math.sin(this.gamma0),Math.cos(this.bl*a))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+r):(e-=this.uc,t.x=this.x0+r*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-r*Math.sin(this.alpha)),t},inverse:function(t){var e,r;this.no_rot?(r=t.y-this.y0,e=t.x-this.x0):(r=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*r/this.al),i=.5*(n-1/n),o=.5*(n+1/n),a=Math.sin(this.bl*e/this.al),s=(a*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/o,l=Math.pow(this.el/Math.sqrt((1+s)/(1-s)),1/this.bl);return Math.abs(s-1)<D?(t.x=this.long0,t.y=M):Math.abs(s+1)<D?(t.x=this.long0,t.y=-1*M):(t.y=ot(this.e,l),t.x=nt(this.long0-Math.atan2(i*Math.cos(this.gamma0)-a*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},Kt={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<D)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=et(this.e,e,r),i=it(this.e,this.lat1,e),o=Math.sin(this.lat2),a=Math.cos(this.lat2),s=et(this.e,o,a),l=it(this.e,this.lat2,o),c=it(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>D?this.ns=Math.log(n/s)/Math.log(i/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=D&&(r=rt(r)*(M-2*D));var n,i,o=Math.abs(Math.abs(r)-M);if(o>D)n=it(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var a=this.ns*nt(e-this.long0);return t.x=this.k0*(i*Math.sin(a))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,t},inverse:function(t){var e,r,n,i,o,a=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+s*s),r=1):(e=-Math.sqrt(a*a+s*s),r=-1);var l=0;if(0!==e&&(l=Math.atan2(r*a,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=ot(this.e,n)))return null}else i=-M;return o=nt(l/this.ns+this.long0),t.x=o,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},$t={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y,u=nt(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),n=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(a)/1,t.x=s*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,n,i,o,a,s,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,a=e,s=0;var c=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(s=1),a=t.y,c+=1}while(0===s&&c<15);return c>=15?null:t},names:["Krovak","krovak"]},Jt=function(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)},Zt=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},Qt=function(t){return.375*t*(1+.25*t*(1+.46875*t))},te=function(t){return.05859375*t*t*(1+.75*t)},ee=function(t){return t*t*t*(35/3072)},re=function(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)},ne=function(t){return Math.abs(t)<M?t:t-rt(t)*Math.PI},ie=function(t,e,r,n,i){var o,a;o=t/e;for(var s=0;s<15;s++)if(o+=a=(t-(e*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(e-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN},oe={init:function(){this.sphere||(this.e0=Zt(this.es),this.e1=Qt(this.es),this.e2=te(this.es),this.e3=ee(this.es),this.ml0=this.a*Jt(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,n=t.x,i=t.y;if(n=nt(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=re(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),u=c*c,h=this.es*a*a/(1-this.es);e=s*c*(1-u*l*(1/6-(8-l+8*h)*u/120)),r=this.a*Jt(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*u*(.5+(5-l+6*h)*u/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var o=i+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var a=this.ml0/this.a+i,s=ie(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-M)<=D)return t.x=this.long0,t.y=M,i<0&&(t.y*=-1),t;var l=re(this.a,this.e,Math.sin(s)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),h=n*this.a/l,p=h*h;e=s-l*Math.tan(s)/c*h*h*(.5-(1+3*u)*h*h/24),r=h*(1-p*(u/3+(1+3*u)*u*p/15))/Math.cos(s)}return t.x=nt(r+this.long0),t.y=ne(e),t},names:["Cassini","Cassini_Soldner","cass"]},ae=function(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e},se=.3333333333333333,le=.17222222222222222,ce=.10257936507936508,ue=.06388888888888888,he=.0664021164021164,pe=.016415012942191543,de={init:function(){var t=Math.abs(this.lat0);if(Math.abs(t-M)<D?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<D?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=ae(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=t*se,e=t*t,r[0]+=e*le,r[1]=e*ue,e*=t,r[0]+=e*ce,r[1]+=e*he,r[2]=e*pe,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=ae(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,n,i,o,a,s,l,c,u,h=t.x,p=t.y;if(h=nt(h-this.long0),this.sphere){if(o=Math.sin(p),u=Math.cos(p),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+u*n:1+this.sinph0*o+this.cosph0*u*n)<=D)return null;e=(r=Math.sqrt(2/r))*u*Math.sin(h),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*u*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.phi0)<D)return null;r=G-.5*p,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(s=0,l=0,c=0,n=Math.cos(h),i=Math.sin(h),o=Math.sin(p),a=ae(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:c=1+this.sinb1*s+this.cosb1*l*n;break;case this.EQUIT:c=1+l*n;break;case this.N_POLE:c=M+p,a=this.qp-a;break;case this.S_POLE:c=p-M,a=this.qp+a}if(Math.abs(c)<D)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),r=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*s-this.sinb1*l*n):(c=Math.sqrt(2/(1+l*n)))*s*this.ymf,e=this.xmf*c*l*i;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(c=Math.sqrt(a))*i,r=n*(this.mode===this.S_POLE?c:-c)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a,s,l=t.x/this.a,c=t.y/this.a;if(this.sphere){var u,h=0,p=0;if((r=.5*(u=Math.sqrt(l*l+c*c)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=Math.sin(r),h=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(u)<=D?0:Math.asin(c*p/u),l*=p,c=h*u;break;case this.OBLIQ:r=Math.abs(u)<=D?this.phi0:Math.asin(h*this.sinph0+c*p*this.cosph0/u),l*=p*this.cosph0,c=(h-Math.sin(r)*this.sinph0)*u;break;case this.N_POLE:c=-c,r=M-r;break;case this.S_POLE:r-=M}e=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(a=Math.sqrt(l*l+c*c))<D)return t.x=0,t.y=this.phi0,t;i=2*Math.asin(.5*a/this.rq),n=Math.cos(i),l*=i=Math.sin(i),this.mode===this.OBLIQ?(s=n*this.sinb1+c*i*this.cosb1/a,o=this.qp*s,c=a*this.cosb1*n-c*this.sinb1*i):(s=c*i/a,o=this.qp*s,c=a*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(o=l*l+c*c))return t.x=0,t.y=this.phi0,t;s=1-o/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(l,c),r=function(t,e){var r=t+t;return t+e[0]*Math.sin(r)+e[1]*Math.sin(r+r)+e[2]*Math.sin(r+r+r)}(Math.asin(s),this.apa)}return t.x=nt(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},fe=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)},ge={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=et(this.e3,this.sin_po,this.cos_po),this.qs1=ae(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=et(this.e3,this.sin_po,this.cos_po),this.qs2=ae(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ae(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>D?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=ae(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*nt(e-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),i=0,0!==e&&(i=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,r)),o=nt(i/this.ns0+this.long0),t.x=o,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,n,i,o,a=fe(.5*e);if(t<D)return a;for(var s=t*t,l=1;l<=25;l++)if(a+=o=.5*(i=1-(n=t*(r=Math.sin(a)))*n)*i/Math.cos(a)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return a;return null}},ye={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y;return n=nt(l-this.long0),e=Math.sin(c),r=Math.cos(c),i=Math.cos(n),(o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=D?(a=this.x0+1*this.a*r*Math.sin(n)/o,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/o):(a=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),n=Math.cos(i),a=fe(n*this.sin_p14+t.y*r*this.cos_p14/e),o=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),o=nt(this.long0+o)):(a=this.phic0,o=0),t.x=o,t.y=a,t},names:["gnom"]},me=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*M:M;for(var n,i,o,a,s=Math.asin(.5*e),l=0;l<30;l++)if(i=Math.sin(s),o=Math.cos(s),a=t*i,s+=n=Math.pow(1-a*a,2)/(2*o)*(e/(1-t*t)-i/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(n)<=1e-10)return s;return NaN},Ce={init:function(){this.sphere||(this.k0=et(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,n=t.x,i=t.y,o=nt(n-this.long0);if(this.sphere)e=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=ae(this.e,Math.sin(i));e=this.x0+this.a*this.k0*o,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r;return this.sphere?(e=nt(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=me(this.e,2*t.y*this.k0/this.a),e=nt(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]},ve={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,r=t.y,n=nt(e-this.long0),i=ne(r-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*i,t},inverse:function(t){var e=t.x,r=t.y;return t.x=nt(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ne(this.lat0+(r-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Te=20,_e={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zt(this.es),this.e1=Qt(this.es),this.e2=te(this.es),this.e3=ee(this.es),this.ml0=this.a*Jt(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,n,i=t.x,o=t.y,a=nt(i-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=D?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(o),r=this.a*(ne(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=D)e=this.a*a,r=-1*this.ml0;else{var s=re(this.a,this.e,Math.sin(o))/Math.tan(o);e=s*Math.sin(n),r=this.a*Jt(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+s*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,n,i,o,a,s,l,c;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=D)e=nt(n/this.a+this.long0),r=0;else{a=this.lat0+i/this.a,s=n*n/this.a/this.a+a*a,l=a;var u;for(o=Te;o;--o)if(l+=c=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+s)*u)/((l-a)/u-1),Math.abs(c)<=D){r=l;break}e=nt(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=D)r=0,e=nt(this.long0+n/this.a);else{a=(this.ml0+i)/this.a,s=n*n/this.a/this.a+a*a,l=a;var h,p,d,f,g;for(o=Te;o;--o)if(g=this.e*Math.sin(l),h=Math.sqrt(1-g*g)*Math.tan(l),p=this.a*Jt(this.e0,this.e1,this.e2,this.e3,l),d=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(a*(h*(f=p/this.a)+1)-f-.5*h*(f*f+s))/(this.es*Math.sin(2*l)*(f*f+s-2*a*f)/(4*h)+(a-f)*(h*d-2/Math.sin(2*l))-d),Math.abs(c)<=D){r=l;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=nt(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]},Se={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=t.x,n=t.y-this.lat0,i=r-this.long0,o=n/I*1e-5,a=i,s=1,l=0;for(e=1;e<=10;e++)s*=o,l+=this.A[e]*s;var c,u=l,h=a,p=1,d=0,f=0,g=0;for(e=1;e<=6;e++)c=d*u+p*h,p=p*u-d*h,d=c,f=f+this.B_re[e]*p-this.B_im[e]*d,g=g+this.B_im[e]*p+this.B_re[e]*d;return t.x=g*this.a+this.x0,t.y=f*this.a+this.y0,t},inverse:function(t){var e,r,n=t.x,i=t.y,o=n-this.x0,a=(i-this.y0)/this.a,s=o/this.a,l=1,c=0,u=0,h=0;for(e=1;e<=6;e++)r=c*a+l*s,l=l*a-c*s,c=r,u=u+this.C_re[e]*l-this.C_im[e]*c,h=h+this.C_im[e]*l+this.C_re[e]*c;for(var p=0;p<this.iterations;p++){var d,f=u,g=h,y=a,m=s;for(e=2;e<=6;e++)d=g*u+f*h,f=f*u-g*h,g=d,y+=(e-1)*(this.B_re[e]*f-this.B_im[e]*g),m+=(e-1)*(this.B_im[e]*f+this.B_re[e]*g);f=1,g=0;var C=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)d=g*u+f*h,f=f*u-g*h,g=d,C+=e*(this.B_re[e]*f-this.B_im[e]*g),v+=e*(this.B_im[e]*f+this.B_re[e]*g);var T=C*C+v*v;u=(y*C+m*v)/T,h=(m*C-y*v)/T}var _=u,S=h,E=1,L=0;for(e=1;e<=9;e++)E*=_,L+=this.D[e]*E;var w=this.lat0+L*I*1e5,b=this.long0+S;return t.x=b,t.y=w,t},names:["New_Zealand_Map_Grid","nzmg"]},Ee={init:function(){},forward:function(t){var e=t.x,r=t.y,n=nt(e-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return t.x=i,t.y=o,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=nt(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]},Le=20,we={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Pt(this.es)},forward:function(t){var e,r,n=t.x,i=t.y;if(n=nt(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=Le;a;--a){var s=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<D)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);r=this.a*Rt(i,l,c,this.en),e=this.a*n*c/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i;return t.x-=this.x0,n=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,n/=this.C_x*(this.m+Math.cos(e)),this.m?e=fe((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=fe(Math.sin(e)/this.n)),n=nt(n+this.long0),e=ne(e)):(e=It(t.y/this.a,this.es,this.en),(i=Math.abs(e))<M?(i=Math.sin(e),r=this.long0+t.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(e)),n=nt(r)):i-D<M&&(n=this.long0)),t.x=n,t.y=e,t},names:["Sinusoidal","sinu"]},be={init:function(){},forward:function(t){for(var e=t.x,r=t.y,n=nt(e-this.long0),i=r,o=Math.PI*Math.sin(r),a=0;;a++){var s=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=s,Math.abs(s)<D)break}i/=2,Math.PI/2-Math.abs(r)<D&&(n=0);var l=.900316316158*this.a*n*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;return t.x=l,t.y=c,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=nt(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t},names:["Mollweide","moll"]},Ae={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Zt(this.es),this.e1=Qt(this.es),this.e2=te(this.es),this.e3=ee(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=et(this.e,this.sinphi,this.cosphi),this.ml1=Jt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<D?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=et(this.e,this.sinphi,this.cosphi),this.ml2=Jt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Jt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=Jt(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var o=this.ns*nt(r-this.long0),a=this.x0+e*Math.sin(o),s=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,r,n,i;this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==r&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return i=nt(this.long0+o/this.ns),n=ne(this.g-r/this.a),t.x=i,t.y=n,t;var a=this.g-r/this.a;return n=ie(a,this.e0,this.e1,this.e2,this.e3),i=nt(this.long0+o/this.ns),t.x=i,t.y=n,t},names:["Equidistant_Conic","eqdc"]},xe={init:function(){this.R=this.a},forward:function(t){var e,r,n=t.x,i=t.y,o=nt(n-this.long0);Math.abs(i)<=D&&(e=this.x0+this.R*o,r=this.y0);var a=fe(2*Math.abs(i/Math.PI));(Math.abs(o)<=D||Math.abs(Math.abs(i)-M)<=D)&&(e=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var s=.5*Math.abs(Math.PI/o-o/Math.PI),l=s*s,c=Math.sin(a),u=Math.cos(a),h=u/(c+u-1),p=h*h,d=h*(2/c-1),f=d*d,g=Math.PI*this.R*(s*(h-f)+Math.sqrt(l*(h-f)*(h-f)-(f+l)*(p-f)))/(f+l);o<0&&(g=-g),e=this.x0+g;var y=l+h;return g=Math.PI*this.R*(d*y-s*Math.sqrt((f+l)*(l+1)-y*y))/(f+l),r=i>=0?this.y0+g:this.y0-g,t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i,o,a,s,l,c,u,h,p;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,o=(n=t.x/h)*n+(i=t.y/h)*i,h=3*(i*i/(l=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(s=a-2*i*i+n*n)*s*s/l/l/l-9*a*s/l/l)/27)/(c=(a-s*s/3/l)/l)/(u=2*Math.sqrt(-c/3)),Math.abs(h)>1&&(h=h>=0?1:-1),p=Math.acos(h)/3,r=t.y>=0?(-u*Math.cos(p+Math.PI/3)-s/3/l)*Math.PI:-(-u*Math.cos(p+Math.PI/3)-s/3/l)*Math.PI,e=Math.abs(n)<D?this.long0:nt(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Pe={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l,c,u,h,p,d,f,g,y,m,C,v,T,_,S,E=t.x,L=t.y,w=Math.sin(t.y),b=Math.cos(t.y),A=nt(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=D?(t.x=this.x0+this.a*(M-L)*Math.sin(A),t.y=this.y0-this.a*(M-L)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=D?(t.x=this.x0+this.a*(M+L)*Math.sin(A),t.y=this.y0+this.a*(M+L)*Math.cos(A),t):(C=this.sin_p12*w+this.cos_p12*b*Math.cos(A),m=(y=Math.acos(C))/Math.sin(y),t.x=this.x0+this.a*m*b*Math.sin(A),t.y=this.y0+this.a*m*(this.cos_p12*w-this.sin_p12*b*Math.cos(A)),t):(e=Zt(this.es),r=Qt(this.es),n=te(this.es),i=ee(this.es),Math.abs(this.sin_p12-1)<=D?(o=this.a*Jt(e,r,n,i,M),a=this.a*Jt(e,r,n,i,L),t.x=this.x0+(o-a)*Math.sin(A),t.y=this.y0-(o-a)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=D?(o=this.a*Jt(e,r,n,i,M),a=this.a*Jt(e,r,n,i,L),t.x=this.x0+(o+a)*Math.sin(A),t.y=this.y0+(o+a)*Math.cos(A),t):(s=w/b,l=re(this.a,this.e,this.sin_p12),c=re(this.a,this.e,w),u=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(c*b)),v=0===(h=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(h)-Math.PI)<=D?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(A)*Math.cos(u)/Math.sin(h)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),y=l*v*(1-(T=v*v)*(g=(d=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*d)*(1-g)/6+(_=T*v)/8*(f=p*d)*(1-2*g)+(S=_*v)/120*(g*(4-7*g)-3*p*p*(1-7*g))-S*v/48*f),t.x=this.x0+y*Math.sin(h),t.y=this.y0+y*Math.cos(h),t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,o,a,s,l,c,u,h,p,d,f,g,y,m,C,v,T,_,S;if(this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*M*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=D?a=this.lat0:(a=fe(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-M,o=nt(Math.abs(s)<=D?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=o,t.y=a,t}return l=Zt(this.es),c=Qt(this.es),u=te(this.es),h=ee(this.es),Math.abs(this.sin_p12-1)<=D?(p=this.a*Jt(l,c,u,h,M),e=Math.sqrt(t.x*t.x+t.y*t.y),a=ie((p-e)/this.a,l,c,u,h),o=nt(this.long0+Math.atan2(t.x,-1*t.y)),t.x=o,t.y=a,t):Math.abs(this.sin_p12+1)<=D?(p=this.a*Jt(l,c,u,h,M),e=Math.sqrt(t.x*t.x+t.y*t.y),a=ie((e-p)/this.a,l,c,u,h),o=nt(this.long0+Math.atan2(t.x,t.y)),t.x=o,t.y=a,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),g=Math.atan2(t.x,t.y),d=re(this.a,this.e,this.sin_p12),y=Math.cos(g),C=-(m=this.e*this.cos_p12*y)*m/(1-this.es),v=3*this.es*(1-C)*this.sin_p12*this.cos_p12*y/(1-this.es),S=1-C*(_=(T=e/d)-C*(1+C)*Math.pow(T,3)/6-v*(1+3*C)*Math.pow(T,4)/24)*_/2-T*_*_*_/6,f=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*y),o=nt(this.long0+Math.asin(Math.sin(g)*Math.sin(_)/Math.cos(f))),a=Math.atan((1-this.es*S*this.sin_p12/Math.sin(f))*Math.tan(f)/(1-this.es)),t.x=o,t.y=a,t)},names:["Azimuthal_Equidistant","aeqd"]},Re={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,o,a,s,l=t.x,c=t.y;return n=nt(l-this.long0),e=Math.sin(c),r=Math.cos(c),i=Math.cos(n),((o=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(o)<=D)&&(a=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=a,t.y=s,t},inverse:function(t){var e,r,n,i,o,a,s;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),r=fe(e/this.a),n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=D?(s=this.lat0,t.x=a,t.y=s,t):(s=fe(i*this.sin_p14+t.y*n*this.cos_p14/e),o=Math.abs(this.lat0)-M,Math.abs(o)<=D?(a=nt(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=a,t.y=s,t):(a=nt(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=a,t.y=s,t))},names:["ortho"]};return y.defaultDatum="WGS84",y.Proj=h,y.WGS84=new y.Proj("WGS84"),y.Point=b,y.toPoint=gt,y.defs=s,y.transform=d,y.mgrs=wt,y.version="2.4.3",(bt=y).Proj.projections.add(Mt),bt.Proj.projections.add(Gt),bt.Proj.projections.add(jt),bt.Proj.projections.add(Vt),bt.Proj.projections.add(Yt),bt.Proj.projections.add(zt),bt.Proj.projections.add(Xt),bt.Proj.projections.add(Kt),bt.Proj.projections.add($t),bt.Proj.projections.add(oe),bt.Proj.projections.add(de),bt.Proj.projections.add(ge),bt.Proj.projections.add(ye),bt.Proj.projections.add(Ce),bt.Proj.projections.add(ve),bt.Proj.projections.add(_e),bt.Proj.projections.add(Se),bt.Proj.projections.add(Ee),bt.Proj.projections.add(we),bt.Proj.projections.add(be),bt.Proj.projections.add(Ae),bt.Proj.projections.add(xe),bt.Proj.projections.add(Pe),bt.Proj.projections.add(Re),y});var TC=TC||{};TC.tool=TC.tool||{};TC.tool.Proxification=function(t,e){this.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}};if(void 0===t)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");this.proxy="function"==typeof t?t:function(e){var r=t;"http"!=e.substr(0,4)&&(r+=window.location.protocol);return r+=encodeURIComponent(e)};e=e||{};this._location=e.location||window.location;this.preventMixedContent=void 0===e.allowedMixedContent||!e.allowedMixedContent};!function(){window.fetch||function(t){"use strict";if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{new Blob;return!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&r.indexOf(Object.prototype.toString.call(t))>-1};u.prototype.append=function(t,e){t=s(t);e=l(e);var r=this.map[t];this.map[t]=r?r+","+e:e};u.prototype.delete=function(t){delete this.map[s(t)]};u.prototype.get=function(t){t=s(t);return this.has(t)?this.map[t]:null};u.prototype.has=function(t){return this.map.hasOwnProperty(s(t))};u.prototype.set=function(t,e){this.map[s(t)]=l(e)};u.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)};u.prototype.keys=function(){var t=[];this.forEach(function(e,r){t.push(r)});return c(t)};u.prototype.values=function(){var t=[];this.forEach(function(e){t.push(e)});return c(t)};u.prototype.entries=function(){var t=[];this.forEach(function(e,r){t.push([r,e])});return c(t)};e.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})};g.call(y.prototype);g.call(v.prototype);v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})};v.error=function(){var t=new v(null,{status:0,statusText:""});t.type="error";return t};var a=[301,302,303,307,308];v.redirect=function(t,e){if(-1===a.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})};t.Headers=u;t.Request=y;t.Response=v;t.fetch=function(t,r){return new Promise(function(n,i){var o=new y(t,r);r=r||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new v(null,{status:a.status});var t={status:a.status,statusText:a.statusText,headers:C(a.getAllResponseHeaders()||"")};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e="response"in a?a.response:a.responseText;n(new v(e,t))};a.onerror=function(){i(new TypeError("Network request failed"))};a.ontimeout=function(){i(new TypeError("Network request failed"))};a.open(o.method,o.url,!r.sync);"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1);!r.sync&&"responseType"in a&&e.blob&&(a.responseType="blob");o.headers.forEach(function(t,e){a.setRequestHeader(e,t)});a.send(void 0===o._bodyInit?null:o._bodyInit)})};t.fetch.polyfill=!0}function s(t){"string"!=typeof t&&(t=String(t));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function l(t){"string"!=typeof t&&(t=String(t));return t}function c(t){var r={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};e.iterable&&(r[Symbol.iterator]=function(){return r});return r}function u(t){this.map={};t instanceof u?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function h(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function p(t){return new Promise(function(e,r){t.onload=function(){e(t.result)};t.onerror=function(){r(t.error)}})}function d(t){var e=new FileReader,r=p(e);e.readAsArrayBuffer(t);return r}function f(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);e.set(new Uint8Array(t));return e.buffer}function g(){this.bodyUsed=!1;this._initBody=function(t){this._bodyInit=t;if(t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&n(t)){this._bodyArrayBuffer=f(t.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};if(e.blob){this.blob=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))};this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(d)}}this.text=function(){var t=h(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,r=p(e);e.readAsText(t);return r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};e.formData&&(this.formData=function(){return this.text().then(m)});this.json=function(){return this.text().then(JSON.parse)};return this}function y(t,e){var r,n,i=(e=e||{}).body;if(t instanceof y){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url;this.credentials=t.credentials;e.headers||(this.headers=new u(t.headers));this.method=t.method;this.mode=t.mode;if(!i&&null!=t._bodyInit){i=t._bodyInit;t.bodyUsed=!0}}else this.url=String(t);this.credentials=e.credentials||this.credentials||"omit";!e.headers&&this.headers||(this.headers=new u(e.headers));this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),o.indexOf(n)>-1?n:r);this.mode=e.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(t){var e=new FormData;t.trim().split("&").forEach(function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(i))}});return e}function C(t){var e=new u;t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var r=t.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();e.append(n,i)}});return e}function v(t,e){e||(e={});this.type="default";this.status=void 0===e.status?200:e.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in e?e.statusText:"OK";this.headers=new u(e.headers);this.url=e.url||"";this._initBody(t)}}("undefined"!=typeof self?self:this);var t=function(t){var e=document.createElement("a");e.href=t;if(!e.origin){if(!e.protocol||!e.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(e.href);e.protocol=r[1];if(r[4].indexOf(":")>-1){var n=r[4].split(":");e.hostname=n[0];e.port=n[1]}else e.hostname=r[4]}e.origin=(0===e.protocol.length?window.location.protocol:e.protocol)+"//"+e.hostname+(e.port&&t.indexOf(e.port)>-1?":"+e.port:"")}return e};var e=TC.tool.Proxification.prototype;e.cacheHost=new function(){var e=function(e){var r=t(e);return r?r.origin:null};this._hosts=[];this._hostsImage=[];this.is=function(t,r){var n=e(t);return null!==this.get(n,r)};this.get=function(t,e){if(0===this.getList(e).length)return null;var r=this.getList(e).filter(function(r){return r.key===t&&e.exportable==r.exportable});return 0===r.length?null:r[0]};this.getList=function(t){return t.forImage?this._hostsImage:this._hosts};this.addKey=function(t,r){var n={key:e(t),action:null};r.exportable&&(n.exportable=r.exportable);this.getList(r).push(n);return this.getList(r)[this.getList(r).length-1]};this.removeKey=function(t,r){for(var n=e(t),i=0;i<this.getList(r).length;i++)if(this.getList(r)[i].key===n&&r.exportable==this.getList(r)[i].exportable){this.getList(r).splice(i,1);break}};this.getAction=function(t,r){r=r||{};var n=e(t),i=this.get(n,r);return i?i._actionPromise:Promise.reject(new Error("Cache null"))}};e._isServiceWorker=function(){if(navigator.serviceWorker){if(navigator.serviceWorker.controller&&"activated"===navigator.serviceWorker.controller.state)return!0;navigator.serviceWorker.ready.then(function(t){return!!t.active});return!1}return!1};e._isSameOrigin=function(t){var e=0!==t.indexOf("http")&&0!==t.indexOf("//"),r=!e&&t.match(this.Consts.url.SPLIT_REGEX);if(r){var n=r[1];e=(n==this._location.protocol||null==n)&&r[3]==this._location.hostname;var i=r[4],o=this._location.port;(80!=i&&""!==i||"80"!=o&&""!==o)&&(e=e&&i==o)}return e};e._isSameProtocol=function(t){var e=/^(https?:\/\/)/i,r=t.match(e);if(r&&r.length>1){var n=self._location.match(e);if(n&&n.length>1)return r[0].trim()===n[0].trim()}return!1};e._isSecureURL=function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)};const r=function(t,e,r){this.status=t;this.text=e;this.url=r};var n=function(e,r){var n=t(e);return e.replace(n.protocol,r)},i=function(t){return n(t,"https:")},o=function(t){return n(t,"http:")},a=function(t,e,r,n){var a=this;t=i(t);a._image.getImgTag(t,e).then(function(t){r(t,a._actionHTTPS)},function(i){i===a._image.ErrorType.PROTOCOL?n(i):s.call(a,o(t),e,r,n)})},s=function(t,e,r,n){var i=this;e.sameOrigin=i._isSameOrigin(i._actionProxy.call(i,t));i._image.getImgTagByAction(t,e,i._actionProxy.bind(i)).then(function(t){r(t,i._actionProxy)},function(t){n(t)})};e._actionDirect=function(t){return t};e._actionHTTP=function(t){return n(t,"http:")};e._actionHTTPS=function(t){return n(t,"https:")};e._actionProxy=function(t){return this.proxy(t)};e._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected"},checkHttpStatus:function(t){const e=this;return fetch(t,{credentials:"omit"}).then(function(t){return{status:t.status,statusText:t.statusText}}).catch(function(t){return e.ErrorType.UNEXPECTED})},getImgTag:function(t,r){return new Promise(function(e,n){var i=this,o=document.createElement("img");if(r.exportable&&!r.sameOrigin){o.dataset.checkCORSHeaders=!0;o.crossOrigin="anonymous"}o.onload=function(){console.log("Load OK: "+o.src);o.onload=o.onerror=void 0;if(r.exportable&&!r.sameOrigin){try{var t=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e}(o);result=t.toDataURL("image/png");e(o)}catch(t){18===t.code?n(i.ErrorType.CORS):e(o)}}else e(o)};o.onerror=function(e){console.log("Load crossOrigin ERROR: "+o.src);if(o.dataset.checkCORSHeaders){o.crossOrigin=null;o.onerror=void 0;o.onerror=function(t){console.log("Load ERROR: "+o.src);i.checkHttpStatus(o.src).then(function(t){r.ignoreProxification?n(i.ErrorType.PROTOCOL):400===t.status?n(i.ErrorType.PROTOCOL):n(t)}).catch(n);o.onload=o.onerror=void 0};o.src=t}else{console.log("Load ERROR: "+o.src);o.onload=o.onerror=void 0;i.checkHttpStatus(o.src).then(function(t){r.ignoreProxification?n(i.ErrorType.PROTOCOL):400===t.status?n(i.ErrorType.PROTOCOL):n(t)}).catch(n)}};try{o.src=t}catch(t){console.log("Load ERROR: "+o.src);n(i.ErrorType.UNEXPECTED)}}.bind(e._image))},getImgTagByAction:function(t,r,n){return new Promise(function(e,i){var o=this,a=document.createElement("img");r.sameOrigin||r.exportable&&(a.crossOrigin="anonymous");a.onload=function(){a.onload=a.onerror=void 0;e(a)};a.onerror=function(t){console.log("Load ERROR: "+a.src);a.onload=a.onerror=void 0;o.checkHttpStatus(a.src).then(function(t){r.ignoreProxification?i(o.ErrorType.PROTOCOL):400===t.status?i(o.ErrorType.PROTOCOL):i(t)}).catch(i)};a.src=n(t)}.bind(e._image))}};e._fetch={Headers:{CONTENTTYPE:"content-type"},ErrorType:{CORS:"cors",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(t){if(!t.ok)throw new r(t.status,t.statusText,t.url);return t},validateContentType:function(t,e){const r=this;if(!t)return e;var n=e.headers.get(r._fetch.Headers.CONTENTTYPE);if(n&&-1===n.indexOf(t))throw Error(r._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return e}};e.fetchImage=function(t,e){var r=this;(e=e||{}).forImage=!0;return new Promise(function(n,l){if(r.cacheHost.is(t,e))r.cacheHost.getAction(t,e).then(function(i){e.sameOrigin=r._isSameOrigin(i.action(t));r._image.getImgTagByAction(t,e,i.action).then(function(t){n(t)},function(t){l(t)})});else{var c=r.cacheHost.addKey(t,e);c._actionPromise=new Promise(function(u,h){const p=function(t,i){c.action=i.bind(r);c.exportable=e.exportable;u({action:c.action});n(t)},d=function(n){if(200==n.status){r.cacheHost.removeKey(t,e);l(n)}else{r.cacheHost.removeKey(t,e);l(n)}};!function(e){if(r._isSameOrigin(t)){e.sameOrigin=!0;r._image.getImgTag(t,e).then(function(t){p(t,r._actionDirect)},d)}else r._isSecureURL(t)?r._image.getImgTag(t,e).then(function(t){p(t,r._actionDirect)},function(n){e.exportable&&n===r._image.ErrorType.CORS||r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?n===r._image.ErrorType.PROTOCOL&&e.ignoreProxification?d(n):s.call(r,t,e,p,d):function(t,e,r,n){var a=this;t=o(t);a._image.getImgTag(t,e).then(function(t){r(t,a._actionHTTP)},function(o){o===a._image.ErrorType.PROTOCOL?n(o):s.call(a,i(t),e,r,n)})}.call(r,t,e,p,d)}):r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?a.call(r,t,e,p,d):r._image.getImgTag(t,e).then(function(t){p(t,r._actionDirect)},function(n){e.exportable&&n===r._image.ErrorType.CORS||!r._isSecureURL(r._location)?n===r._image.ErrorType.PROTOCOL&&e.ignoreProxification?d(n):s.call(r,t,e,p,d):a.call(r,t,e,p,d)})}(e)})}})};e.fetchRetry=function(t,e,r){const n=this;var i=fetch;e.sync&&(i=n.fetchSync);return i(t,e).catch(function(i){if(1===r)throw i;return n.fetchRetry(t,e,r-1)})};e.fetchSync=function(t,e){var r=this;return new Promise(function(n,i){"Symbol"in r&&Symbol;var o="FileReader"in r&&"Blob"in r&&function(){try{new Blob;return!0}catch(t){return!1}}();if("ArrayBuffer"in r){var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];ArrayBuffer.isView}function s(t){var e=new Headers;t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var r=t.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();e.append(n,i)}});return e}var l=new Request(t,e),c=new XMLHttpRequest;c.onload=function(){var t={status:c.status,statusText:c.statusText,headers:s(c.getAllResponseHeaders()||"")};t.url="responseURL"in c?c.responseURL:t.headers.get("X-Request-URL");var e="response"in c?c.response:c.responseText;n(new Response(e,t))};c.onerror=function(){i(new TypeError("Network request failed"))};c.ontimeout=function(){i(new TypeError("Network request failed"))};c.open(l.method,l.url,!1);"include"===l.credentials?c.withCredentials=!e.sync:"omit"===l.credentials&&(c.withCredentials=!1);!e.sync&&"responseType"in c&&o&&(c.responseType="blob");l.headers.forEach(function(t,e){c.setRequestHeader(e,t)});c.send(void 0===l._bodyInit?null:l._bodyInit)})};e.fetchXML=function(t,e){(e=e||{}).responseType="xml";return this.fetch(t,e)};e.fetchJSON=function(t,e){(e=e||{}).responseType=TC.Consts.mimeType.JSON;return this.fetch(t,e)};e.fetchBlob=function(t,e){(e=e||{}).responseType="blob";return this.fetch(t,e)};e.fetchImageAsBlob=function(t,e){(e=e||{}).responseType="image";return this.fetch(t,e)};e.fetch=function(e,r){const n=this;if((r=r||{}).type){r.method=r.type;delete r.type}if(r.data){r.body=r.data;delete r.data}if(r.contentType){r.headers=new Headers;r.headers.append("Content-Type",r.contentType);delete r.contentType}r.responseType||(r.responseType="");var i=function(t,e,r,o){return(e.retryAttempts?n.fetchRetry(r[0].call(n,t),e,e.retryAttempts):fetch(r[0].call(n,t),e)).then(n._fetch.validateResponse).then(n._fetch.validateContentType.bind(n,e.responseType)).then(function(t){o&&(o.action=r[0].bind(n));const i=t.headers.get(n._fetch.Headers.CONTENTTYPE),a=function(e){return t.blob().then(function(t){const r=new FileReader;return new Promise(function(n,i){r.addEventListener("error",function(){r.abort();i(new DOMException("Problem decoding"))});r.addEventListener("loadend",function(){n(r.result)});r.readAsText(t,e)})})};switch(!0){case e.responseType.indexOf("xml")>-1:case e.responseType.indexOf("text/xml")>-1:case e.responseType.indexOf(TC.Consts.mimeType.XML)>-1:return(s=/charset=([^;]*)/i.exec(i))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(t){return(new window.DOMParser).parseFromString(t,"text/xml")}):t.text().then(function(t){return(new window.DOMParser).parseFromString(t,"text/xml")});case e.responseType.indexOf("arraybuffer")>-1:return t.arrayBuffer();case e.responseType.indexOf("image")>-1:case e.responseType.indexOf("blob")>-1:return t.blob().then(function(t){return new Blob([t],{type:i})});case e.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+e.responseType);case e.responseType.indexOf(TC.Consts.mimeType.JSON)>-1:return t.json();case""==e.responseType:case e.responseType.indexOf("text")>-1:default:var s;return(s=/charset=([^;]*)/i.exec(i))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(t){return""==e.responseType?{responseText:t,contentType:i}:t}):t.text().then(function(t){return""==e.responseType?{responseText:t,contentType:i}:t})}}).catch(function(n){if(1===r.length){console.log("request failed",n);return Promise.reject(n)}r.shift();return i(t,e,r,o)})};if(n.cacheHost.is(e,r))return new Promise(function(t,o){n.cacheHost.getAction(e,r).then(function(n){t(i(e,r,[n.action]))}).catch(function(i){i.status>400?o(new Error(i.text)):t(n.fetch(e,r))})});var o=n.cacheHost.addKey(e,r);return new Promise(function(a,s){o._actionPromise=new Promise(function(l,c){e=t(e).href;const u=function(t){l({action:o.action});a(t)},h=function(t){n.cacheHost.removeKey(e,r);c(t);s(new Error(t.text))};n._isSameOrigin(e)?i(e,r,[n._actionDirect,n._actionProxy],o).then(u).catch(h):n._isSecureURL(e)?n._isServiceWorker()?i(e,r,[n._actionDirect,n._actionProxy],o).then(u).catch(h):i(e,r,[n._actionDirect,n._actionHTTP,n._actionProxy],o).then(u).catch(h):n._isServiceWorker()?i(e,r,[n._actionHTTPS,n._actionProxy],o).then(u).catch(h):i(e,r,n._isSecureURL(n._location)?[n._actionHTTPS,n._actionProxy]:[n._actionDirect,n._actionHTTPS,n._actionProxy],o).then(u).catch(h)});o._actionPromise.catch(function(t){t.status>400?s(new Error(t.text)):a(n.fetch(e,r))})})}}();var TC=TC||{};TC.inherit=function(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t;t._super=e.prototype};!function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(t){e.prototype=new e("").constructor.prototype;return e;function e(t,e){e||(e={});var r=document.createEvent("CustomEvent");r.initCustomEvent(t,!!e.bubbles,!!e.cancelable,e.detail);return r}}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);const t=function(t,e,r){const n=this;t.split(" ").forEach(function(t){n.$events.addEventListener(t,function(t,e){const r=function(t){const r={type:t.type,target:this,currentTarget:this};t.detail&&Object.keys(t.detail).forEach(function(e){e in r||(r[e]=t.detail[e])});return e.call(this,r)}.bind(this);(this._listeners[t]=this._listeners[t]||new Map).set(e,r);return r}.call(n,t,e),r)});return n};TC.EventTarget=function(){const t=this;t._listeners={};t.$events=document.createDocumentFragment();const e=["addEventListener","dispatchEvent","removeEventListener"];e.forEach(function(e){this[e]=t.$events[e].bind(t.$events)},t);e.push("on");e.push("one");e.push("off");e.push("trigger");e.forEach(function(e){t.$events[e]=t[e].bind(t)},t)};const e=TC.EventTarget.prototype;e.on=function(e,r){return t.call(this,e,r)};navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0?e.one=function(t,e){const r=this,n=function(i){r.off(t,n);e.call(this,i)};r.on(t,n);return r}:e.one=function(e,r){return t.call(this,e,r,{once:!0})};e.off=function(t,e){const r=this,n=t.split(" ");e?n.forEach(function(t){const n=r._listeners[t];n&&n.has(e)&&r.$events.removeEventListener(t,n.get(e))}):n.forEach(function(t){const e=r._listeners[t];if(e){e.forEach(function(e){r.$events.removeEventListener(t,e)});e.clear()}});return r};e.trigger=function(t,e){if(window.$&&$.Event&&t instanceof $.Event){e={};Object.keys(t).forEach(function(r){"type"!==r&&(e[r]=t[r])});t=t.type}var r;e&&(r={detail:e});const n=new CustomEvent(t,r);this.dispatchEvent(n)};TC.EventTarget._onBySelectorMap=new WeakMap;TC.EventTarget.listenerBySelector=function(t,e){return function(r){const n=this,i=r.type;var o=TC.EventTarget._onBySelectorMap.get(n);if(!o){o={};TC.EventTarget._onBySelectorMap.set(n,o)}var a=o[i];a||(o[i]=a={});a[t]||(a[t]=e);if(!r._listenerBySelectorCalled)for(var s,l=!1,c=r.target;c&&c!==n;){for(t in a)if(c.matches&&c.matches(t)){l=!0;s=a[t].call(n,r);r._listenerBySelectorCalled=!0}if(l)return s;c=c.parentNode}}};var r=null,n=null;const i=function(t){const e=this;var i=o.call(e);if(e.replaceCurrent){window.history.replaceState(i,null,null);delete e.replaceCurrent}else{e.lastEventType=t.type;var a=function(){n=r;(r=TC.Util.utf8ToBase64(i))!==n&&window.history.pushState(i,null,window.location.href.split("#").shift()+"#"+r)};if(t)switch(!0){case t.type==TC.Consts.event.BASELAYERCHANGE:case t.type==TC.Consts.event.LAYERORDER:case t.type==TC.Consts.event.ZOOM:a();break;case t.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:t.layer.type==TC.Consts.layerType.WMS&&a()}}},o=function(t){const e=this;var r={};e.crs!==e.options.crs&&(r.crs=e.crs);for(var n=e.getExtent(),i=0;i<n.length;i++)Math.abs(n[i])>180&&(n[i]=Math.floor(1e3*n[i])/1e3);r.ext=n;var o,a,s=[];e.baseLayers&&(s=e.baseLayers.filter(function(t){return t.isRaster()&&t.fallbackLayer}).map(function(t){return{baseLayer:t,fallbackLayerID:t.fallbackLayer.id}}).filter(function(t){return t.fallbackLayerID===(e.baseLayer?e.baseLayer.id:e.baseLayers[0].id)}));s.length>0?r.base=s[0].baseLayer.id:r.base=(e.baseLayer||e.baseLayers[0]).id;r.layers=[];for(i=0;i<e.workLayers.length;i++)if("WMS"==(o=e.workLayers[i]).type&&!o.options.stateless&&o.layerNames&&o.layerNames.length){a={u:TC.Util.isOnCapabilities(o.url),n:Array.isArray(o.names)?o.names.join(","):o.names,o:o.getOpacity(),v:o.getVisibility(),h:o.options.hideTitle,ur:o.unremovable,t:o.title};r.layers.push(a)}e.on3DView&&e.view3D.cameraControls&&(r.vw3=e.view3D.cameraControls.getCameraState());window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);t&&TC.Util.extend(r,t);return jsonpack.pack(r)},a=function(t){const e=this,r=[];e.loadingctrl||(e.loadingCtrl=e.getControlsByClass("TC.control.LoadingIndicator")[0]);e.hasWait||(e.hasWait=e.loadingCtrl&&e.loadingCtrl.addWait());return new Promise(function(n,i){var o,a=function(){e.loadingCtrl&&e.loadingCtrl.removeWait(e.hasWait);delete e.hasWait;n()};if("string"==typeof t)try{o=jsonpack.unpack(t)}catch(r){try{o=JSON.parse(t)}catch(t){TC.error(TC.Util.getLocaleString(e.options.locale,"mapStateNotValid"))}}else o=t;if(o){if(o.crs&&o.crs!==e.crs||void 0===o.crs&&e.crs!==e.options.crs)r.push(e.setProjection({crs:o.crs||e.options.crs,oldCrs:e.crs,extent:o.ext,baseLayer:e.getLayer(o.base)}));else{if(o.base!=e.getBaseLayer().id){e.getLayer(o.base)&&e.setBaseLayer(o.base);const t=e.baseLayers.filter(function(t){return t.options.fallbackLayer===o.base})[0];if(t){const n=e.addLayer(t.getFallbackLayer());r.push(n);n.then(function(t){e.setBaseLayer(t)})}}o.ext&&r.push(e.setExtent(o.ext,{animate:!1}))}(function(){const t=this;t.workLayers.filter(function(t){return!(t instanceof TC.layer.Vector)}).forEach(function(e){e.unremovable&&(e.unremovable=!1);t.removeLayer(e)})}).call(e);o.layers=o.layers||o.capas||[];if(o.layers.length>0)for(var s=0;s<o.layers.length;s++){var l=o.layers[s],c=!1;for(j=0;j<e.options.workLayers.length;j++){var u=TC.Util.extend({},e.options.workLayers[j],{map:e});if(l.u===u.url&&u.layerNames.indexOf(l.n)>=0){c=!0;u.renderOptions={opacity:l.o,hide:!l.v};u.unremovable=l.ur;u.title=l.t;r.push(e.addLayer(u).then(function(t){t.setVisibility(this.v);t.setOpacity(this.o,!0)}.bind(l)))}}c||r.push(e.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:l.n?l.n.split(","):"",unremovable:l.ur,title:l.t,renderOptions:{opacity:l.o,hide:!l.v}}).then(function(t){var e=t.wrap.getRootLayerNode();t.title=e.Title||e.title;t.setOpacity(this.o,!0);t.setVisibility(this.v)}.bind(l)))}Promise.all(r).then(function(){a()}).catch(function(){a()})}})},s=function(t){return function(e,r,n,i){return r.id===t?n:e}},l=function(t){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(e){return e.id===t})[0]};TC.Map=TC.Map||function(t,e){const r=this;TC.EventTarget.call(r);TC.Map._instances.push(r);r.isReady=!1;r.isLoaded=!1;r.controls=[];r.activeControl=null;r.layers=[];r.baseLayers=[];r.workLayers=[];r.baseLayer=null;r.vectors=null;var u=0;r.div=TC.Util.getDiv(t);TC._jQueryIsLoaded&&(r._$div=$(r.div));r.div.classList.add(TC.Consts.classes.LOADING,TC.Consts.classes.MAP);r._markerPromises=[];r._layerBuffer={layers:[],contains:function(t){return this.layers.some(function(e){return e.id===t})},getIndex:function(t){return this.layers.reduce(s(t),-1)},add:function(t,e,r){var n;const i={id:t,pending:!0,isRaster:e,isBase:r};if(e){n=this.getRasterIndex();this.layers.splice(n,0,i)}else{n=this.layers.length;this.layers[n]=i}},remove:function(t){this.layers.splice(this.getIndex(t),1)},getMapLayers:function(){return this.layers.filter(t=>!1===t.pending).filter(t=>!t.rejected).map(t=>t.mapLayer)},resolve:function(t,e,r){const n=this.layers[this.getIndex(e.id)];n.mapLayer=e;n.pending=!1;t.layers=this.getMapLayers();if(r){0===t.baseLayers.length&&(t.baseLayers=new Array(t.options.baseLayers.length));if((i=t.options.baseLayers.map(function(t){return t.id}).indexOf(e.id))<0){var i;(i=t.baseLayers.map(function(t){return t.type}).indexOf(TC.Consts.layerType.VECTOR))<0?t.baseLayers.push(e):t.baseLayers.splice(i,0,e)}else t.baseLayers.splice(i,1,e)}else t.workLayers=t.layers.filter(function(t){return!t.isBase})},reject:function(t,e){const r=this.layers[this.getIndex(e.layerId)];r.mapLayer=null;r.pending=!1;r.rejected=!0;var n=t.options.baseLayers.map(t=>t.id).indexOf(e.layerId);n>=0&&t.baseLayers.splice(n,1)},getResolvedWorkLayerIndex:function(t,e){return this.layers.filter(function(t){return t.id===e||!t.isBase&&!1===t.pending}).reduce(s(e),-1)},getResolvedVisibleLayerIndex:function(t,e){var r=this.getResolvedWorkLayerIndex(t,e);t.baseLayer&&(r+=1);return r},getRasterIndex:function(){return this.layers.reduce((t="isRaster",function(e,r,n){return r[t]?n:e}),-1)+1;var t},checkMapLoad:function(t){const e=this;if(t.options.baseLayers.concat(t.options.workLayers).every(function(t){return e.contains(t.id||t)})&&!this.layers.some(function(t){return!0===t.pending})){const e=function(){if(!t.isLoaded){const e=function(){t.options.stateful&&function(){const t=this;var e=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");t.replaceCurrent=!0;i.call(t);const r=i.bind(t);t.on(e,r);var n;t.on(TC.Consts.event.LAYEROPACITY,function(e){clearTimeout(n);n=setTimeout(function(){i.call(t,e)},500)});window.addEventListener("popstate",function(n){var i;i=t.loadingCtrl&&t.loadingCtrl.addWait();setTimeout(function(){if(n){t.off(e,r);var o=n.state;"[object Object]"===Object.prototype.toString.call(o)&&(o=t.checkLocation());a.call(t,o).then(function(){setTimeout(function(){t.on(e,r)},200);t.loadingCtrl&&t.loadingCtrl.removeWait(i)})}},4)})}.call(t);t.isLoaded=!0;t.div.classList.remove(TC.Consts.classes.LOADING);t.trigger(TC.Consts.event.MAPLOAD)};if(t.state&&t.state.vw3){if(!t.div.classList.contains(TC.Consts.classes.THREED)){t.div.classList.add(TC.Consts.classes.THREED);TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:t,state:t.state.vw3,callback:function(){e();t.getControlsByClass(TC.control.ThreeD)[0].button.removeAttribute("disabled")}})})}}else e()}};if(t.baseLayer)e();else{var r=[];t.state&&t.state.base&&(r=TC.Cfg.availableBaseLayers.filter(function(e){return e.id===t.state.base}));if(r.length>0){r[0].isBase=!0;t.addLayer(r[0]).then(function(t){e()})}else{const r=t.baseLayers.filter(function(t){return!t.mustReproject}).filter(function(t){return t.wrap&&t.wrap.layer});if(r.length>0){t.wrap.setBaseLayer(r[0].wrap.layer);t.baseLayer=r[0]}e()}}}}};r._layerBuffer.layers=[];if(!TC.ready){TC.Cfg=TC.Util.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(e&&e.controls&&e.controls.search&&e.controls.search.allowedSearchTypes)for(var d in TC.Cfg.controls.search.allowedSearchTypes)e.controls.search.allowedSearchTypes.hasOwnProperty(d)||(e.controls.search.allowedSearchTypes[d]=!1);e=e||{};h.call(r,e);var f=function(){TC.loadJS(r.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){r.options.stateful&&(r.state=r.checkLocation());r.options.layout&&r.trigger(TC.Consts.event.LAYOUTLOAD,{map:r});e&&void 0!==e.workLayers&&(r.options.workLayers=e.workLayers);e&&void 0!==e.baseLayers&&(r.options.baseLayers=e.baseLayers);if(r.options.zoomToFeatures){r.on(TC.Consts.event.FEATURESADD,function t(e){clearTimeout(r._zoomToFeaturesTimeout);r._zoomToFeaturesTimeout=setTimeout(function(){r.zoomToFeatures(e.layer.features,{animate:!1});r.off(TC.Consts.event.FEATURESADD,t)},100)})}r.on(TC.Consts.event.LAYERADD,function t(e){if(e.layer.isBase&&(e.layer===r.baseLayer||r.baseLayer&&e.layer.fallbackLayer&&e.layer.fallbackLayer.id===r.baseLayer.id)){void 0!==r.state&&(r.state.crs?r.loaded(function(){r.setProjection({crs:r.state.crs,extent:r.state.ext})}):r.setExtent(r.state.ext,{animate:!1}));r.off(TC.Consts.event.LAYERADD,t)}});r.crs=r.options.crs;r.initialExtent=r.options.initialExtent;r.maxExtent=r.options.maxExtent;r.wrap=new TC.wrap.Map(r);TC.loadJS(!window[TC.Consts.PROJ4JSOBJ],[TC.url.proj4js],function(){TC.loadJSInOrder(!window[TC.Consts.OLNS],[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:r.options.crs,callback:function(){r.wrap.setMap();const t=[];for(var e in r.options.controls){var n=r.options.controls[e];if(n){"string"==typeof(n="boolean"==typeof n?{}:TC.Util.extend(!0,{},n)).div&&(n.div=r.div.querySelector("#"+n.div)||n.div);t.push(r.addControl(e,n))}}r.on(TC.Consts.event.BEFORELAYERUPDATE,g);r.on(TC.Consts.event.LAYERUPDATE,y);var i,o;for(i=0;i<r.options.baseLayers.length;i++){"string"==typeof(o=r.options.baseLayers[i])&&(o=l.call(r,o));r.addLayer(TC.Util.extend({},o,{isBase:!0,map:r}))}var a=function(t){t.isRaster()&&!t.names&&t.setVisibility(!1)};r.options.workLayers.map(function(t){return TC.Util.extend({},t,{map:r})}).filter(function(t){return!r.state||!r.state.layers||!r.state.layers.some(function(e){const r=e.u===t.url&&t.layerNames.indexOf(e.n)>=0;r&&(e.id=t.id);return r})}).forEach(function(t){r.addLayer(t).then(a)});r.state&&r.state.layers&&r.state.layers.forEach(function(t){r.addLayer({id:t.id||TC.getUID(),url:TC.Util.isOnCapabilities(t.u,t.u.indexOf(window.location.protocol)<0)||t.u,hideTitle:t.h,layerNames:t.n?t.n.split(","):"",unremovable:t.ur,title:t.t,renderOptions:{opacity:t.o,hide:!t.v}}).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)});var r=e.wrap.getRootLayerNode();e.title=t.t||r.Title||r.title;this.o<1&&e.setOpacity(this.o);this.v||e.setVisibility(this.v)}.bind(t))});Promise.all(t).finally(function(){r.isReady=!0;r.trigger(TC.Consts.event.MAPREADY)});C(r.div)}})})});r.on(TC.Consts.event.FEATURECLICK,function(t){r.activeControl&&r.activeControl.isExclusive()||(r.on3DView?t.feature.showResultsPanel():t.feature.showPopup())});r.on(TC.Consts.event.NOFEATURECLICK,function(t){t.layer._noFeatureClicked=!0;for(var e=!0,n=0,i=r.workLayers.length;n<i;n++)if(!r.workLayers[n]._noFeatureClicked){e=!1;break}if(e){r.workLayers.forEach(function(t){delete t._noFeatureClicked});r.getControlsByClass(TC.control.Popup).forEach(function(t){t.hide()})}})})};p.getMapState=function(t){var e=o.call(this,t);return TC.Util.utf8ToBase64(e)};p.getPreviousMapState=function(){return n};p.checkLocation=function(){var t=window.location.hash;if(t&&t.length>1){t=t.substr(1);var e;try{e=jsonpack.unpack(TC.Util.base64ToUtf8(t))}catch(n){try{e=JSON.parse(TC.Util.base64ToUtf8(t))}catch(t){TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValidForEdge"),TC.Consts.msgErrorMode.TOAST);if(e){var n=!1;if(!e.hasOwnProperty("ext")){n=!0;e.ext=r.options.initialExtent}if(!e.hasOwnProperty("base")){n=!0;e.base=r.options.defaultBaseLayer}if(e.hasOwnProperty("layers"))for(var i=e.layers.length-1;i>=0;i--)if(e.layers[i]&&e.layers[i].hasOwnProperty("u")&&e.layers[i].hasOwnProperty("n")){if(!e.layers[i].hasOwnProperty("o")||!e.layers[i].hasOwnProperty("v")||!e.layers[i].hasOwnProperty("h")){n=!0;TC.Util.extend(e.layers[i],{o:e.layers[i].o||1,v:e.layers[i].v||!0,h:e.layers[i].h||!1})}}else{n=!0;e.layers.length=e.layers.length-1}else{n=!0;e.layers=[]}e.hasOwnProperty("vw3")&&(e.vw3?(!e.vw3.cp||e.vw3.cp&&3!=e.vw3.cp.length||!e.vw3.chpr||e.vw3.chpr&&3!=e.vw3.chpr.length||!e.vw3.bcpd)&&(n=!0):n=!0);n&&TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return e}TC.error(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var g=function(t){if(u<=0){u=0;r.trigger(TC.Consts.event.BEFOREUPDATE)}u+=1},y=function(t){if((u-=1)<=0){u=0;r.trigger(TC.Consts.event.UPDATE)}};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(t,e,r){var n;if(t)n=new Promise(function(t,n){TC.ajax({url:e+r+".json",method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){const n=e.data;TC.i18n[r]=TC.i18n[r]||{};TC.Util.extend(TC.i18n[r],n);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(r,TC.i18n[r]);t()})}).catch(function(t){n(t)})});else{dust.i18n.add(r,TC.i18n[r]);n=Promise.resolve()}return n};var m=[],v=r.options.locale;m.push(new Promise(function(t,e){TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(v){dust.i18n.setLanguages([v]);m.push(TC.i18n.loadResources(!TC.i18n[v],TC.apiLocation+"TC/resources/",v))}t()})}));Promise.all(m).finally(function(){if(r.options.layout){var t=r.options.layout;r.trigger(TC.Consts.event.BEFORELAYOUTLOAD,{map:r});var n={},i=!1;if("string"==typeof t){var o=t.trim();o+=o.match(/\/$/)?"":"/";n.config=o+"config.json";n.markup=o+"markup.html";n.style=o+"style.css";n.script=o+"script.js";n.i18n=o+"resources";i=!0}else(t.hasOwnProperty("config")||t.hasOwnProperty("markup")||t.hasOwnProperty("style")||t.hasOwnProperty("script")||t.hasOwnProperty("href")||t.hasOwnProperty("i18n"))&&(n=TC.Util.extend({},t));n.i18n&&(n.i18n+=n.i18n.match(/\/$/)?"":"/");r.layout=n;const a=[],s=function(t,e){this.status=t;this.url=e},l=function(t){if(!i||"404"!==t.status.toString()){const e=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.error(TC.Util.getLocaleString(e.options.locale,"urlFailedToLoad",{url:t.url}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+t.url)}},c=new Promise(function(t,i){n.config?a.push(fetch(n.config).then(function(t){if(!t.ok)throw new s(t.status,n.config);return t.json()}).then(function(n){t(n.i18n);h.call(r,n,e)}).catch(function(e){l(e);t(!1)})):t(!1)});a.push(c);if(n.style){r.div.classList.add("tc-lo");fetch(n.style,{method:navigator.onLine?"HEAD":"GET"}).then(function(t){if(!t.ok)throw new s(t.status,n.style);return t}).then(function(){var t=document.createElement("link");t.rel="stylesheet";t.href=n.style;document.head.appendChild(t)}).catch(function(t){l(t)})}n.markup&&a.push(new Promise(function(t,e){fetch(n.markup).then(function(t){if(!t.ok)throw new s(t.status,n.markup);return t.text()}).then(function(e){c.then(function(i){if(i&&v&&n.i18n)TC.i18n.loadResources(!0,n.i18n,v).finally(function(){e=e.replace(/(?:\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\})/g,function(t,e,r){return TC.Util.getLocaleString(v,e||r)});r.div.insertAdjacentHTML("beforeend",e);t()});else{r.div.insertAdjacentHTML("beforeend",e);t()}})}).catch(function(t){l(t);e(Error(t))})}));Promise.all(a).finally(function(){n.script?fetch(n.script).then(function(t){if(!t.ok)throw new s(t.status,n.script);return t.blob()}).then(function(t){var e=URL.createObjectURL(t),n=document.createElement("script");n.src=e;n.onload=function(){C(r.div);f()};document.head.appendChild(n)}).catch(function(t){l(t);f()}):f()})}else f()});r.on(TC.Consts.event.UPDATEPARAMS,function(t){c(t.layer)});r.on(TC.Consts.event.ZOOM,function(){for(var t=0;t<r.workLayers.length;t++)c(r.workLayers[t])});var T=TC.error;TC.error=function(t,e,n){TC.isDebug&&console.trace&&console.trace();if(e){var i=function(t,e,n){switch(e){case TC.Consts.msgErrorMode.TOAST:if(!r.toast){console.warn("No existe el objeto Toast");return}r.toast(t,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(n?{msg:n,errorMsg:t}:t,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(t)}};if(Array.isArray(e))for(var o=0;o<e.length;o++)i(t,e[o],n);else i(t,e,n)}else{T(t);r.toast(t,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};TC.Map._instances=[];TC.Map.get=function(t){for(var e=0,r=TC.Map._instances.length;e<r;e++){const r=TC.Map._instances[e];if(r.div===t)return r}};TC.inherit(TC.Map,TC.EventTarget);var c=function(t){t.type===TC.Consts.layerType.WMS&&(t.tree=null)},u=function(t,e){var r=Array.prototype.slice.call(t).map(function(t){var r={};t&&(r[e]=t[e]);return r});"availableBaseLayers"===e&&console.log("layerOptions",r);var n={};n[e]=TC.Cfg[e];r.unshift(n);if("baseLayers"===e&&r[1].baseLayers){n=r[1];for(var i=0;i<n.baseLayers.length;i++)"object"==typeof n.baseLayers[i]&&TC.Util.extend(n.baseLayers[i],l.call(this,n.baseLayers[i].id))}else{r.unshift(!0);n=TC.Util.extend.apply(this,r);"availableBaseLayers"===e&&console.log("layerOption",n)}return n[e]};const h=function(){const t=[!0,{},TC.Cfg].concat(Array.prototype.slice.call(arguments)),e=this.options=TC.Util.extend.apply(this,t);e.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(t){return t.availableBaseLayers||[]}));e.baseLayers=u.call(this,arguments,"baseLayers");e.workLayers=u.call(this,arguments,"workLayers");Array.prototype.slice.call(arguments).filter(t=>t.controls).map(t=>t.controls).length>0&&(e.controls=function(t){t.controlContainer&&Object.keys(t).filter(function(e){return Object.keys(t.controlContainer.controls).indexOf(e)>-1}).forEach(function(e){const r=t.controlContainer.controls[e];"boolean"==typeof r.options&&(r.options={});TC.Util.extend(r.options,t[e]);delete t[e]});return t}(e.controls));return e};var p=TC.Map.prototype,d=function(t,e){var r,n='Layer "'+e.title+'" ("'+e.names+'"): ';r=e.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";n+=TC.Util.getLocaleString(t.options.locale,r);TC.error(n);t.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:r})};p.getCRS=function(){const t=this;return t.on3DView?t.view3D.crs:t.crs};p.addLayer=function(t,e){const r=this,n=new Promise(function(e,n){const o=v(t);"object"!=typeof t||t.id||(t.id=TC.getUID());r._layerBuffer.add(t.id||t,o,t.isBase);if(r.getLayer(t.id)){const e=Error(`Layer "${t.id}" already exists`);e.layerId=t.id;n(e)}else{var a,s,c;if(o){s=!TC.layer||!TC.layer.Raster;c=TC.apiLocation+"TC/layer/Raster"}else{s=!TC.layer||!TC.layer.Vector;c=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(s,[c],function(){if("string"==typeof t)a=new TC.layer.Raster(TC.Util.extend({},l.call(r,t),{map:r}));else if(t instanceof TC.Layer)(a=t).map=r;else{t.map=r;a=t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t)}Promise.all([r.wrap.getMap(),a.wrap.getLayer()]).then(function(){r.trigger(TC.Consts.event.BEFORELAYERADD,{layer:a});var o;v(a)&&(o=r.wrap.indexOfFirstVector());-1===o&&(o=r.wrap.getLayerCount());const s=r.state&&r.state.crs?r.state.crs:r.getCRS();TC.loadProjDef({crs:s,callback:function(){const o=a.isCompatible(s);if(a.isBase){if(!o)if(!a.type===TC.Consts.layerType.WMTS)a.mustReproject=!0;else{const t=a.wrap.getCompatibleMatrixSets(s)[0];t?a.wrap.setMatrixSet(t):a.mustReproject=!0}r.state?a.isDefault=r.state.base===a.id||r.state.base===a.options.fallbackLayer:"string"==typeof r.options.defaultBaseLayer?a.isDefault=r.options.defaultBaseLayer===a.id:"number"==typeof r.options.defaultBaseLayer&&(a.isDefault=r.options.defaultBaseLayer===r.baseLayers.length);if(a.isDefault){var l;if(a.mustReproject&&!a.type===TC.Consts.layerType.WMTS||a.mustReproject&&a.type===TC.Consts.layerType.WMTS&&!a.wrap.getCompatibleMatrixSets(s)[0])if(a.options.fallbackLayer&&a.getFallbackLayer)r.addLayer(a.getFallbackLayer()).then(function(t){r.wrap.setBaseLayer(t.wrap.layer);r.baseLayer=t.wrap.parent;i(l);e(a)});else{d(r,a);const e=Error("Layer "+a.id+" incompatible with CRS");e.layerId=t.id;n(e)}else{l=null===r.baseLayer;a.wrap.getLayer().then(function(t){r.wrap.setBaseLayer(t);r.baseLayer=a;i(l);e(a)})}}else e(a)}else if(o)a.wrap.getLayer().then(function(t){e(a)});else{d(r,a);const e=Error("Layer "+a.id+" incompatible with CRS");e.layerId=t.id;n(e)}}})},function(e){e.layerId=t.id;n(e)})})}});n.then(function(t){r._layerBuffer.resolve(r,t,t.isBase);t.isBase||r.wrap.insertLayer(t.wrap.layer,r._layerBuffer.getResolvedVisibleLayerIndex(r,t.id));r.trigger(TC.Consts.event.LAYERADD,{layer:t});r._layerBuffer.checkMapLoad(r);TC.Util.isFunction(e)&&e(t)}).catch(function(t){r._layerBuffer.reject(r,t);r._layerBuffer.checkMapLoad(r)});const i=function(t){if(t){var e={projection:r.wrap.map.getView().getProjection(),extent:r.initialExtent},n=r.baseLayer.getResolutions();if(n&&n.length)e.resolutions=n;else{e.minZoom=r.wrap.map.getView().getMinZoom();e.maxZoom=r.wrap.map.getView().getMaxZoom();var i=r.baseLayer.wrap.layer.getMinResolution();0!==i&&(e.minResolution=i);var o=r.baseLayer.wrap.layer.getMaxResolution();o!==Number.POSITIVE_INFINITY&&(e.maxResolution=o)}r.wrap.map.setView(new ol.View(e));r.wrap.map.getView().fit(r.initialExtent)}};return n};p.removeLayer=function(t){const e=this;return new Promise(function(r,n){if(t.unremovable)return n("Unremovable");t.wrap.getLayer().then(function(n){for(var i=0;i<e.layers.length;i++)if(e.layers[i]===t){e.layers.splice(i,1);break}if(t.isBase){for(i=0;i<e.baseLayers.length;i++)if(e.baseLayers[i]===t){e.baseLayers.splice(i,1);e.baseLayer===t&&e.setBaseLayer(e.baseLayers[0]);break}}else{for(i=0;i<e.workLayers.length;i++)if(e.workLayers[i]===t){e.workLayers.splice(i,1);break}t===e.vectors&&(e.vectors=null)}e.wrap.removeLayer(n);e._layerBuffer.remove(t.id);e.trigger(TC.Consts.event.LAYERREMOVE,{layer:t});e._layerBuffer.checkMapLoad(e);r(t)})})};p.insertLayer=function(t,e,r){for(var n=this,i=-1,o=0;o<n.layers.length;o++)if(t===n.layers[o]){i=o;break}var a=[];a.push(t.wrap.getLayer());var s=n.layers[e];s&&a.push(s.wrap.getLayer());Promise.all(a).then(function(o){const a=o[0],s=o[1];var l=-1;if((l=s?n.wrap.getLayerIndex(s):n.wrap.getLayerCount())>=0){t.map=n;n.wrap.insertLayer(a,l);i>-1&&n.layers.splice(i,1);n.layers.splice(e,0,t);n.workLayers=n.layers.filter(function(t){return!t.isBase});n.trigger(TC.Consts.event.LAYERORDER,{layer:t,oldIndex:i,newIndex:e})}TC.Util.isFunction(r)&&r()})};p.setLayerIndex=function(t,e){this.wrap.setLayerIndex(t.wrap.layer,e)};p.putLayerOnTop=function(t){var e=this.wrap.getLayerCount();this.setLayerIndex(t,e-1)};p.setBaseLayer=function(t,e){var r=this,n=null,i=!1;if("string"==typeof t){var o;for(o=0;o<r.layers.length;o++)if(r.layers[o].id===t){t=r.layers[o];i=!0;break}if(!i&&(t=l.call(r,t))){t=r.addLayer(TC.Util.extend(!0,{},t,{isDefault:!0,map:r}));i=!0}}else{if(r.layers.indexOf(t)<0){t.isDefault=!0;t.map=r;r.addLayer(t)}i=!0}if(i)if(t.isCompatible(r.getCRS())||t.fallbackLayer&&(!t.fallbackLayer||t.fallbackLayer.isCompatible(r.getCRS()))){r.trigger(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:t});n=t;r.wrap.getMap().then(function(n){t.wrap.getLayer().then(function(n){r.wrap.setBaseLayer(n).then(function(){r.baseLayer=t;r.trigger(TC.Consts.event.BASELAYERCHANGE,{layer:t});TC.Util.isFunction(e)&&e()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return n};p.setView=function(t){this.view=t;this.trigger(TC.Consts.event.VIEWCHANGE,{view:t})};p.ready=function(t){TC.Util.isFunction(t)&&(this.isReady?t():this.one(TC.Consts.event.MAPREADY,t))};p.loaded=function(t){TC.Util.isFunction(t)&&(this.isLoaded?t():this.one(TC.Consts.event.MAPLOAD,t))};p.getLayerTree=function(){var t={baseLayers:[],workLayers:[]};this.baseLayer&&(t.baseLayers[0]=this.baseLayer.getTree());for(var e=0;e<this.workLayers.length;e++){var r=this.workLayers[e].getTree();r&&t.workLayers.unshift(r)}return t};p.addControl=function(t,e){const r=this;return new Promise(function(n,i){const o=function(t){r.controls.push(t);return Promise.resolve(t.register(r)).then(function(e){t.div.parentElement||r.div.appendChild(t.div);r.trigger(TC.Consts.event.CONTROLADD,{control:t});return e}).catch(function(t){i(t instanceof Error?t:Error(t))})};if("string"==typeof t){t=t.substr(0,1).toUpperCase()+t.substr(1);TC.loadJS(!TC.Control||!TC.control[t],[TC.apiLocation+"TC/control/"+t],function(){o(new TC.control[t](null,e)).then(function(t){n(t)})})}else o(t).then(function(t){n(t)})})};p.getControlsByClass=function(t){var e=[],r=t;if("string"==typeof t){r=window;for(var n=t.split("."),i=0;i<n.length&&(r=r[n[i]]);i++);}if(TC.Util.isFunction(r))for(i=0;i<this.controls.length;i++){var o=this.controls[i];o instanceof r&&e.push(o)}return e};p.getControlById=function(t){const e=this;for(var r=0,n=e.controls.length;r<n;r++){const n=e.controls[r];if(n.id===t)return n}return null};p.getDefaultControl=function(){const t=this;var e;t.options.defaultActiveControl&&(e=t.getControlsByClass("TC.control."+t.options.defaultActiveControl.substr(0,1).toUpperCase()+t.options.defaultActiveControl.substr(1))[0]);e||(e=(e=t.getControlsByClass("TC.control.MultiFeatureInfo")[0])?e.lastCtrlActive:t.getControlsByClass("TC.control.FeatureInfo")[0]);return e};p.getLoadingIndicator=function(){var t=null,e=this.getControlsByClass("TC.control.LoadingIndicator");e.length&&(t=e[0]);return t};p.setExtent=function(t,e){return this.wrap.setExtent(t,e)};p.getExtent=function(){return this.wrap.getExtent()};p.setCenter=function(t,e){return this.wrap.setCenter(t,e)};p.getCenter=function(){return this.wrap.getCenter()};p.setRotation=function(t){this.wrap.setRotation(t)};p.getRotation=function(){return this.wrap.getRotation()};p.getViewHTML=function(){return this.wrap.getViewport()};p.getCompatibleCRS=function(t){const e=((t=t||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(t){return t.isRaster()}).map(function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:t.includeFallbacks})}),r=e.slice(1);return e[0].filter(function(t){return r.every(function(e){return e.indexOf(t)>=0})})};p.loadProjections=function(t){t=t||{};return new Promise(function(e,r){const n=t.crsList||[];Promise.all(n.map(function(t){return TC.getProjectionData({crs:TC.Util.getCRSCode(t)})})).then(function(r){var n=r.filter(function(t){return"ok"===t.status&&t.number_result>0}).map(function(t){const e=t.results[0],r="EPSG:"+e.code;TC.loadProjDef({crs:r,def:e.def,name:e.name});return{code:r,name:e.name,proj4:e.proj4,unit:e.unit}});t.orderBy&&(n=n.sort(TC.Util.getSorterByProperty(t.orderBy)));e(n)},function(t){r(t)})})};p.setProjection=function(t){const e=this;t=t||{};return new Promise(function(r,n){var i;if(t.crs){t.baseLayer?i=t.baseLayer:t.allowFallbackLayer&&(e.baseLayer.isCompatible(t.crs)||0!==e.baseLayer.wrap.getCompatibleMatrixSets(t.crs).length?e.baseLayer.firstOption&&(e.baseLayer.firstOption.isCompatible(t.crs)||e.baseLayer.firstOption.wrap.getCompatibleMatrixSets(t.crs).length>0)&&(i=e.baseLayer.firstOption):e.baseLayer.options.fallbackLayer&&(i=e.baseLayer.getFallbackLayer()));i||(i=e.baseLayer);const o=function(){TC.loadProjDef({crs:t.crs,callback:function(){const o=function(i){const a=function(){const a=TC.Util.extend({},t,{oldCrs:e.crs}),s=function(t){t.setProjection(a)};if(i.isCompatible(t.crs)||i.wrap.getCompatibleMatrixSets(t.crs).length>0){i.setProjection(a);e.wrap.setProjection(TC.Util.extend({},t,{baseLayer:i}));e.crs=t.crs;e.baseLayers.filter(function(t){return t!==i}).forEach(s);e.workLayers.forEach(s);const n=function(){e.trigger(TC.Consts.event.PROJECTIONCHANGE,{crs:t.crs});r()};i&&i!==e.baseLayer?e.setBaseLayer(i,n):n()}else i.fallbackLayer?o(i.fallbackLayer):n()};i.type===TC.Consts.layerType.WMS||i.type===TC.Consts.layerType.WMTS?i.getCapabilitiesPromise().then(a):a()};o(i)}})};e.baseLayers.indexOf(i)<0?e.addLayer(i).then(o):o()}})};p.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};p.getCoordinateFromPixel=function(t){return this.wrap.getCoordinateFromPixel(t)};p.getPixelFromCoordinate=function(t){return this.wrap.getPixelFromCoordinate(t)};p.zoomToFeatures=function(t,e){if(t.length>0){var r=[1/0,1/0,-1/0,-1/0],n=e||{},i=n.pointBoundsRadius||this.options.pointBoundsRadius;i/=this.getMetersPerUnit();var o=n.extentMargin;"number"!=typeof o&&(o=this.options.extentMargin);for(var a=0;a<t.length;a++){var s=t[a].getBounds();if(s){r[0]=Math.min(r[0],s[0]);r[1]=Math.min(r[1],s[1]);r[2]=Math.max(r[2],s[2]);r[3]=Math.max(r[3],s[3])}}if(r[2]-r[0]==0){r[0]=r[0]-i;r[2]=r[2]+i}if(r[3]-r[1]==0){r[1]=r[1]-i;r[3]=r[3]+i}if(this.options.extentMargin){var l=(r[2]-r[0])*o/2,c=(r[3]-r[1])*o/2;r[0]=r[0]-l;r[1]=r[1]-c;r[2]=r[2]+l;r[3]=r[3]+c}if(this.options.maxExtent){r[0]=Math.max(r[0],this.options.maxExtent[0]);r[1]=Math.max(r[1],this.options.maxExtent[1]);r[2]=Math.min(r[2],this.options.maxExtent[2]);r[3]=Math.min(r[3],this.options.maxExtent[3])}this.wrap.setExtent(r,n);this.trigger(TC.Consts.event.ZOOMTO,{extent:r})}};p.zoomToMarkers=function(t){var e=this;Promise.all(e._markerPromises).then(function(){for(var r=[],n=0;n<e.workLayers.length;n++){var i=e.workLayers[n];if(i.type===TC.Consts.layerType.VECTOR)for(var o=0;o<i.features.length;o++){var a=i.features[o];a instanceof TC.feature.Marker&&(r[r.length]=a)}}e.zoomToFeatures(r,t);e._markerPromises=[]})};p.getLayer=function(t){const e=this;var r=null;if("string"==typeof t){for(var n=0;n<e.layers.length;n++)if(e.layers[n].id===t){r=e.layers[n];break}}else TC.Layer&&t instanceof TC.Layer&&t.map===e&&(r=t);return r};var f=function(t){var e;if(t.vectors)e=Promise.resolve(t.vectors);else{e=t.addLayer({id:TC.getUID(),title:TC.i18n[t.options.locale].vectors,type:TC.Consts.layerType.VECTOR});t.vectors=e;e.then(function(e){t.vectors=e})}return e};p.addPoint=function(t,e){if(e&&e.layer){var r=this.getLayer(e.layer);if(!r)throw new Error('Layer "'+e.layer+'" not found');r.addPoint(t,e)}else f(this).then(function(r){r.addPoint(t,e)})};p.addMarker=function(t,e){var r=this;if(e&&e.layer){var n=r.getLayer(e.layer);n?r._markerPromises.push(n.addMarker(t,e)):r._markerPromises.push(Promise.reject(new Error('Layer "'+e.layer+'" not found')))}else r._markerPromises.push(new Promise(function(n,i){f(r).then(function(r){r.addMarker(t,e).then(function(t){n(t)})})}))};p.addPolyline=function(t,e){if(e&&e.layer){if(!this.getLayer(e.layer))throw new Error('Layer "'+e.layer+'" not found');e.layer.addPolyline(t,e)}else f(this).then(function(r){r.addPolyline(t,e)})};p.addPolygon=function(t,e){if(e&&e.layer){if(!this.getLayer(e.layer))throw new Error('Layer "'+e.layer+'" not found');e.layer.addPolygon(t,e)}else f(this).then(function(r){r.addPolygon(t,e)})};p.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};p.getResolutions=function(){return this.wrap.getResolutions()};p.getResolution=function(){return this.wrap.getResolution()};p.setResolution=function(t){this.wrap.setResolution(t)};p.exportFeatures=function(t,e){e=e||{};var r=this.getLoadingIndicator(),n=r&&r.addWait();const i=e.format===TC.Consts.format.GPX?Number.NaN:0;t.forEach(function(e,r){var n=e.getCoords({pointArray:!0});if(n.some(function(t){return null===t[2]})){t[r]=e=e.clone();(n=e.getCoords({pointArray:!0})).forEach(function(t){null===t[2]&&(t[2]=i)})}});const o=this.wrap.exportFeatures(t,e),a=TC.Consts.mimeType[e.format],s=e.format||"";TC.Util.downloadFile((e.fileName||TC.getUID())+"."+s.toLowerCase(),a,o);r&&r.removeWait(n)};var g={},y=function(){const t=this;var e=t;do{e=e.parentElement}while(e&&!e.matches(".tc-toast-container"));const r=t.innerHTML;t.classList.add(TC.Consts.classes.HIDDEN);void 0!==g[r]&&(g[r]=void 0);setTimeout(function(){t.parentElement&&t.parentElement.removeChild(t);e&&!e.querySelector(".tc-toast")&&e.parentElement&&e.parentElement.removeChild(e)},1e3)};p.toastHide=function(t){var e=g[t];if(e){clearTimeout(e.timeout);e.toast&&e.toast.parentElement&&e.toast.parentElement.removeChild(e.toast);e.toast=null}};p.toast=function(t,e){const r=this;var n=e||{},i=n.duration||TC.Cfg.toastDuration,o=g[t];if(o){clearTimeout(o.timeout);o.toast&&o.toast.parentElement&&o.toast.parentElement.removeChild(o.toast);o.toast=null}var a=r.div.querySelector(".tc-toast-container");if(!a){(a=document.createElement("div")).classList.add("tc-toast-container");(n.container?n.container:r.div).appendChild(a)}const s=document.createElement("div"),l=document.createElement("span");s.classList.add("tc-toast");s.appendChild(l);const c=document.createElement("p");c.innerHTML=t;s.appendChild(c);s.addEventListener(TC.Consts.event.CLICK,y);a.appendChild(s);o=g[t]={toast:s};var u="";switch(n.type){case TC.Consts.msgType.INFO:u=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:u=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:u=TC.Consts.classes.ERROR}u.length&&o.toast.classList.add(u);o.timeout=setTimeout(function(){y.call(o.toast)},i)};var m=!1,C=function(t){if(/iPad/i.test(navigator.userAgent)){var e=window.innerHeight;t.getBoundingClientRect.height===e+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(m=!0)}var r=function(){t.classList.toggle(TC.Consts.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};if(m){r();window.addEventListener("resize",r)}else window.removeEventListener("resize",r)},v=function(t){return"string"==typeof t||t.type!==TC.Consts.layerType.VECTOR&&t.type!==TC.Consts.layerType.KML&&t.type!==TC.Consts.layerType.WFS};p.exportImage=function(){var t=null,e="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",r=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(r&&this.options.crossOrigin)try{t=r.toDataURL()}catch(t){TC.error(e+": "+t.message)}else TC.error(e);return t}}();var TC=TC||{};!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Util=e()}(TC,function(){String.prototype.soundex=function(){var t=this.toLowerCase().split("");f=t.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+t.map(function(t,e,r){return codes[t]}).filter(function(t,e,r){return 0===e?t!==codes[f]:t!==r[e-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};var t=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(e,r){if("eu-ES"!=e||TC.Util.detectIE())return t.apply(this,arguments);var n=t.apply(this,arguments);n=n.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1"));return n};var e={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(t,e,r){return r<e.length-1?t.hasOwnProperty(e[r])?l(t[e[r]],e,++r):null:t[e[r]]};const c=new WeakMap,u=new WeakMap,h={}.hasOwnProperty;var p={isPlainObject:function(t){return"object"==typeof t&&!t.nodeType&&t.window!==t&&!(t.constructor&&!h.call(t.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isFunction:function(t){return"function"==typeof t},extend:function(){var t,e=arguments[0]||{},r=1,n=!1;if("boolean"==typeof e){n=e;e=arguments[r]||{};r++}"object"==typeof e||p.isFunction(e)||(e={});for(var i=arguments.length;r<i;r++){const i=arguments[r];if(null!=i)for(var o in i){const r=e[o],a=i[o];if(e===a)continue;const s=Array.isArray(a);if(n&&a&&(p.isPlainObject(a)||s)){t=s?r&&Array.isArray(r)?r:[]:r&&p.isPlainObject(r)?r:{};e[o]=p.extend(n,t,a)}else void 0!==a&&(e[o]=a)}}return e},getMapLocale:function(t){return t.options&&t.options.locale&&t.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(t){var e=2!=arguments.length||arguments[1],r=e?t:t.replace(TC.Util.regex.PROTOCOL,"");if(e){if(TC.capabilities[r])return t}else for(var n in TC.capabilities)if(n.replace(TC.Util.regex.PROTOCOL,"")==r)return n;for(n in TC.capabilities){var i=l(TC.capabilities[n],a,0)||l(TC.capabilities[n],s,0);if(i&&e&&t==i)return i;if(i&&t.replace(TC.Util.regex.PROTOCOL,"")==i.replace(TC.Util.regex.PROTOCOL,""))return i}return t},reqGetMapOnCapabilities:function(t){var e,r,n=2!=arguments.length||arguments[1];n||t.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[t]?(e=TC.capabilities[t],(r=l(e,a,0)||l(e,s,0))?n?r.split("?")[0]:r.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(t){var e=window,r=t.split(".");for(i=0;i<r.length-1;i++)if(null==(e=e[r[i]]))return;return e[r[r.length-1]]},isURL:function(t){return/^(http|https|ftp|mailto)\:\/\//i.test(t)},isSecureURL:function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)},isSameOrigin:function(t){var e=0!==t.indexOf("http")&&0!==t.indexOf("//"),r=!e&&t.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,i=r[1];e=(i==n.protocol||null==i)&&r[3]==n.hostname;var o=r[4],a=n.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(e=e&&o==a)}return e},formatNumber:function(t,e){var r=typeof t;if("number"===r)return t.toLocaleString(e);if("string"===r){n=parseFloat(t);if(n===new Number(t).valueOf())return n.toLocaleString(e)}return t},addProtocol:function(t){var e=t;t&&0===t.indexOf("//")&&(e=location.protocol+t);return e},getDiv:function(t){return"string"==typeof t?document.getElementById(t):t instanceof HTMLElement?t:"$"in window&&t instanceof $&&t.length?t[0]:document.createElement("div")},getScriptLocation:function(){var t,e;if(document.currentScript)e=document.currentScript;else{var r=document.getElementsByTagName("script");e=r[r.length-1]}return(t=e.getAttribute("src"))?t.substr(0,t.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(t){var r="";if(t)if(void 0!==e[t])r=e[t];else{const i=document.createElement("div");i.style.display="none";i.classList.add(t);document.body.appendChild(i);var n=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(i,null).backgroundImage);n&&n.length>1&&(r=n[n.length-1]);i.parentElement.removeChild(i);e[t]=r}return r},getPointIconUrl:function t(e){var r=null;if(e.url)r=e.url;else{var n;if("string"==typeof e.cssClass)n=e.cssClass;else{var i=e.classes||TC.Cfg.styles.marker.classes;n=i[0];if(e.group){if(void 0===o[e.group]){var a=0;for(var s in o)a++;a%=i.length;o[e.group]=i[a]}n=o[e.group]}}r=TC.Util.getBackgroundUrlFromCss(n)}r||e===TC.Cfg.styles.point||""===e.cssClass||(r=t(TC.Cfg.styles.point));return r},addArrayToTree:function t(e,r,n){var i=null,o=!1,a=e[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){o=!0;var u=t(e,s,n+1);u&&(i=u);break}if(!o){s={name:a,title:a,uid:"/"+e.slice(0,n+1).join("/"),children:[]};r.children.push(s);i=s}}return i},parseCoords:function(t){var e=null,r=function(t){var e=t,r={};r.type=TC.Consts.GEOGRAPHIC;var n=e.indexOf("\xb0");r.value=parseFloat(e.substr(0,n));if((n=(e=e.substr(n+1)).indexOf("'"))>=0){var i=parseFloat(e.substr(0,n))/60;r.value>=0?r.value+=i:r.value-=i;if((n=(e=e.substr(n+1)).indexOf("'"))>=0){i=parseFloat(e.substr(0,n).replace(",","."))/3600;r.value>=0?r.value+=i:r.value-=i}}return r},n=function(t){var e=t.trim();if(e.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(e[e.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":e="-"+e}e=e.substr(0,e.length-1);return r(e)}if(e.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(e);if(e.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(e.substr(0,e.length-1).replace(",","."))};e.match(/[SsWwOo]$/)&&(n.value=-n.value);return n}return e.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(e.replace(",","."))}:e.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(e.replace(",","."))}:null},i=(t=t.trim().toUpperCase()).split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:1!==i.length&&3!==i.length||(i=t.split(" "));if(2===i.length){var o=n(i[0]),a=n(i[1]);null!==o&&null!==a&&(e=[o,a])}return e},reproject:function(t,e,r){var n,i=!0,o=!0,a=!0;if(Array.isArray(t[0]))if(Array.isArray(t[0][0])){if(!Array.isArray(t[0][0][0])){a=!1;t=[t]}}else{o=!1;t=[[t]]}else{i=!1;o=!1;a=!1;t=[[[t]]]}TC.loadProjDef({crs:e,sync:!0});TC.loadProjDef({crs:r,sync:!0});var s=proj4(proj4.defs[e]),l=proj4(proj4.defs[r]);n=new Array(t.length);t.forEach(function(t,e){const r=n[e]=[];t.forEach(function(t,e){const n=r[e]=[];t.forEach(function(t,e){var r=proj4(s,l,{x:t[0],y:t[1]});n[e]=[r.x,r.y];t.length>2&&(n[e][2]=t[2])})})});i?o?a||(n=n[0]):n=n[0][0]:n=n[0][0][0];return n},getMetersPerDegree:function(t){var e=void 0;if(Array.isArray(t)&&t.length>=4){var r=this.degToRad(t[3]-t[1]),n=Math.sin(r/2),i=n*n;e=6370997*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(t[3]-t[1])}return e},radToDeg:function(t){return 180*t/Math.PI},degToRad:function(t){return t*Math.PI/180},mod:function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(t){var e=null;t=t.trim();if(/^EPSG:\d{4,6}$/g.test(t)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(t)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(t)){var r=t.trim().match(/^.+[:#](\d{4,6})$/);r&&(e=r[1])}return e},CRSCodesEqual:function(t,e){if(t===e)return!0;var r=this.getCRSCode(t),n=this.getCRSCode(e);return null!==r&&null!==n&&r===n},getLocaleString:function(t,e,r){var n=e;if(TC.i18n&&TC.i18n[t]){var i=TC.i18n[t][e];if(i){n=i;if(r)for(var o in r)n=n.replace("{"+o+"}",r[o])}}return n},getSimpleMimeType:function(t){var e="";if(t){var r=t.indexOf(";");r>0&&(t=t.substring(0,r));e=t}return e},getQueryStringParams:function(t){var e;if(t){var r=t.indexOf("?");if(r>=0){var n=(e=t.substr(r)).indexOf("#");n>=0&&(e=e.substr(0,n))}else e="?"}else e=location.search;var i=e.replace(/(^\?)/,"").split("&").map(function(t){return this[(t=t.split("="))[0]]=t[1],this}.bind({}))[0];delete i[""];return i},getParamString:function(t){const e=[];for(var r in t)e[e.length]=encodeURIComponent(r)+"="+encodeURIComponent(t[r]);return e.join("&").replace(/%20/g,"+")},fastUnshift:function(t,e){for(var r=t.length;r;){t[r]=t[r-1];r--}t[0]=e},storage:{getCookie:function(t){return TC.cookie(t)},setCookie:function(t,e,r){return TC.cookie(t,e,r)},getLocalValue:function(t){return localStorage&&localStorage instanceof Storage?localStorage.getItem(t):TC.Util.storage.getCookie(t)},setLocalValue:function(t,e){if(localStorage&&localStorage instanceof Storage)void 0===e?localStorage.removeItem(t):localStorage.setItem(t,e);else if(void 0===e){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(t,"",{expires:r})}else TC.Util.storage.setCookie(t,e);return t},getSessionLocalValue:function(t){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(t):TC.Util.storage.getCookie(t)},setSessionLocalValue:function(t,e){if(sessionStorage&&sessionStorage instanceof Storage)void 0===e?sessionStorage.removeItem(t):sessionStorage.setItem(t,e);else if(void 0===e){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(t,"",{expires:r})}else TC.Util.storage.setCookie(t,e);return t}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var r=t.indexOf("rv:");return parseInt(t.substring(r+3,t.indexOf(".",r)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const t=matchMedia("(pointer:coarse)").matches,e=matchMedia("(pointer:fine)").matches;if(t&&e)return!0;if(t&&!e){return!!function(){var t,e="(hover: hover)",r=!TC.browserFeatures.touch();(t=window.matchMedia(e)).media===e&&(r=t.matches);return r}()}return!(t||!e)||!matchMedia("(pointer:none)").matches&&(!TC.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var t=(new UAParser).getBrowser();return{name:t.name,version:t.major}},getElementByNodeName:function(t,e){for(var r=e.indexOf(":"),n=e.substr(r+1),i=t.getElementsByTagNameNS("*",n),o=0;o<i.length;o++)if(i[o].nodeName==e)return i},addURLParameters:function(t,e){if(!e)return t;var r=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+(e[t]?encodeURIComponent(e[t]):"")}).join("&"),n=t.split("?");if(n.length>=2){var i=n[1].split(/[&;]/g);i.push(r);return t=n[0]+"?"+i.join("&")}if((n=t.split("#")).length>=2){n.shift();return t=n[0]+"?"+r+"#"+n.join("#")}return t=t+"?"+r},removeURLParameter:function(t,e){var r=t.split("?");if(r.length>=2){for(var n=encodeURIComponent(e.toLowerCase())+"=",i=r[1].toLowerCase().split(/[&;]/g),o=i.length;o-- >0;)-1!==i[o].lastIndexOf(n,0)&&i.splice(o,1);return t=r[0]+"?"+i.join("&")}return t},showModal:function(t,e){e=e||{};t.hidden=!1;window.$&&t instanceof $&&(t=t.get(0));t.classList.add(TC.Consts.classes.VISIBLE);const r=t.querySelectorAll(".tc-modal-close");if(r&&r.length>0)for(var n=0;n<r.length;n++){var i=u.get(r[n]);if(i)u.delete(r[n]);else{i=function(t){t.stopPropagation();return TC.Util.closeModal(e.closeCallback,t.target)};u.set(r[n],i)}u.set(r[n],i);r[n].addEventListener("click",i);p.isFunction(e.openCallback)&&e.openCallback()}},closeModal:function(t,e){const r=function(t){t.classList.remove(TC.Consts.classes.VISIBLE)};var n;if(e){n=e;for(;n&&!n.matches(".tc-modal");)n=n.parentElement;r(n)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(t){r(t)});t&&t()},closeAlert:function(t){var e=t;do{(e=e.parentElement).matches(".tc-alert")&&(e.style.display="none")}while(e)},swipe:function(t,e){const r=function(e){t.addEventListener("mousedown",e.start);t.addEventListener("touchstart",e.start);t.addEventListener("mouseup",e.end);t.addEventListener("touchend",e.end)};if("disable"===e){const e=c.get(t);if(e){t.removeEventListener("mousedown",e.start);t.removeEventListener("touchstart",e.start);t.removeEventListener("mouseup",e.end);t.removeEventListener("touchend",e.end)}return}if("enable"===e){const e=c.get(t);e&&r(e);return}const n=(e=e||{}).minDistance||30,i=e.maxCrossDistance||30,o=e.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const u={start:function(r){if(function(r){if(e.noSwipe)for(var n=r.target;n&&n!==t;){if(n.matches&&n.matches(e.noSwipe))return!1;n=n.parentNode}return!0}(r)){r="changedTouches"in r?r.changedTouches[0]:r;a.x=r.pageX;a.y=r.pageY;l=(new Date).getTime()}},end:function(r){if(l){r="changedTouches"in r?r.changedTouches[0]:r;s.x=r.pageX;s.y=r.pageY;if((new Date).getTime()-l<=o){const r=e[function(t,e){const r=e.x-t.x,o=e.y-t.y,a=Math.abs(r),s=Math.abs(o);return a>s&&a>n&&s<=i?r<0?"left":"right":s>a&&s>n&&a<=i?o<0?"up":"down":"none"}(a,s)];r&&r.call(t)}l=0}}};c.set(t,u);r(u)},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)","i").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},getLocaleUserChoice:function(t){var e="en-US",r=(t=t||{}).cookieName||"SITNA.language",n=t.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,o=TC.Util.getParameterByName(n)||TC.Util.storage.getCookie(r)||i,a=o.indexOf("-");a>=0&&(o=o.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(r,o,{expires:s});switch(o){case"eu":e="eu-ES";break;case"es":e="es-ES";break;default:e="en-US"}return e},getValidFilename:function(t){return(t||"").replace(/[\/\\?%*:|"<>]/g,"-")},downloadBlob:function(t,e){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(e);r.setAttribute("href",n);r.setAttribute("download",TC.Util.getValidFilename(t));r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}},downloadFile:function(t,e,r){var n=new Blob([r],{type:e});t=TC.Util.getValidFilename(t);navigator.msSaveBlob?navigator.msSaveBlob(n,t):TC.Util.downloadBlob(t,n)},downloadDataURI:function(t,e,r){for(var n=atob(r.split(",")[1]),i=[],o=0;o<n.length;o++)i.push(n.charCodeAt(o));var a=new Blob([new Uint8Array(i)],{type:e});t=TC.Util.getValidFilename(t);navigator.msSaveBlob?navigator.msSaveBlob(a,t):TC.Util.downloadBlob(t,a)},shortenUrl:function(t){return new Promise(function(e,r){TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:t}}).then(function(t){e(t.data)}).catch(function(t){r(t)})})},utf8ToBase64:function(t){return window.btoa(unescape(encodeURIComponent(t)))},base64ToUtf8:function(t){var e;try{e=decodeURIComponent(escape(window.atob(t)))}catch(t){e=null}return e},colorArrayToString:function(t){Array.isArray(t)&&(t=t.slice(0,3).reduce(function(t,e){const r=e.toString(16);return t+"00".substring(0,2-r.length)+r},"#"));return t},operation:function(t,e,r,n){for(var i=[],o=0;o<t.length;o++){for(var a=t[o],s=!1,l=0;l<e.length;l++)if(r(a,e[l])){s=!0;break}s===n&&i.push(a)}return i},isSecureURL:function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)},inBoth:function(t,e,r){return this.operation(t,e,r,!0)},inFirstOnly:function(t,e,r){return this.operation(t,e,r,!1)},inSecondOnly:function(t,e,r){return this.inFirstOnly(e,t,r)},toDataUrl:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},n=r.type,i=r.encoderOptions,o=t.getContext("2d");if(!o)return"";var a=t.width,s=t.height,l=o.getImageData(0,0,a,s),c=o.globalCompositeOperation;if(e){o.globalCompositeOperation="destination-over";o.fillStyle=e;o.fillRect(0,0,a,s)}var u=t.toDataURL(n,i);if(e){o.clearRect(0,0,a,s);o.putImageData(l,0,0);o.globalCompositeOperation=c}return u},imgToDataUrl:function(t,e){var r=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e};return new Promise(function(n,i){var o=new Image;o.crossOrigin="anonymous";o.onload=function(){var i,a=r(o);try{i=TC.Util.toDataUrl(a,"#ffffff",{type:e||"image/jpeg",encoderOptions:1});n({dataUrl:i,canvas:a})}catch(e){o.src=TC.proxify(t)}};o.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(t),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(t){if(200===this.status){for(var i=new Uint8Array(this.response),a=i.length,l=new Array(a);a--;)l[a]=String.fromCharCode(i[a]);var c=l.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){o.src="data:"+u+";base64,"+window.btoa(c);o.onload=function(){var t=r(o);dataURL=TC.Util.toDataUrl(t,"#ffffff",{type:e||"image/jpeg",encoderOptions:1});n({dataUrl:dataURL,canvas:t})}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&i()};s.send()};o.src=t;if(o.complete||void 0===o.complete){o.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";o.src=t}})},imgTagToDataUrl:function(t,e){var r=function(t){var e=document.createElement("CANVAS"),r=e.getContext("2d");e.height=t.height;e.width=t.width;r.drawImage(t,0,0);return e}(t);try{return{base64:TC.Util.toDataUrl(r,"#ffffff",{type:e||"image/jpeg",encoderOptions:1}),canvas:r}}catch(t){return null}},addToCanvas:function(t,e,r,n){var i=TC.Util.cloneCanvas(t),o=i.getContext("2d");return new Promise(function(t,a){var s=new Image;e.crossOrigin="anonymous";s.src=e;s.onload=function(){n?o.drawImage(s,r.x||0,r.y||0,n.width,n.height):o.drawImage(s,r.x||0,r.y||0);t(i)}})},cloneCanvas:function(t){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=t.width;e.height=t.height;r.drawImage(t,0,0);return e},calculateAspectRatioFit:function(t,e,r,n){var i=Math.min(r/t,n/e);return{width:t*i,height:e*i}},getFormattedDate:function(t,e){function r(t){return t<10?"0"+t:t}var n=new Date(t);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(e?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceAccent:function(t){var e={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return t.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(t){return e[t]})},downloadFileForm:function(t,e){var r=function(t,e){new Promise(function(r,n){const i=new XMLHttpRequest;i.responseType="blob";i.open("POST",t);i.setRequestHeader("Content-Type","application/xml; charset=UTF-8");i.onreadystatechange=function(t){if(4===i.readyState)if(200!==i.status)n({status:i.status,msg:i.statusText,url:options.url});else try{const t=i.getResponseHeader("Content-disposition");var e="";if(t){e=t.split("; ")[1].substring(9);"attachment"!==t.split("; ")[0]&&(e=e.substring(0,e.lastIndexOf(".")))}r({data:i.response,contentType:i.getResponseHeader("Content-type"),filename:e})}catch(t){n(t)}};try{i.send(e)}catch(t){n(t)}}).then(function(t){var e="";t.data.type.indexOf("kml")>=0?e=".kml":t.data.type.indexOf("json")>=0?e=".geojson":t.data.type.indexOf("xml")>=0&&(e=".gml");TC.Util.downloadFile((t.filename?t.filename:TC.getUID())+e,t.contentType,t.data)})};if(Array.isArray(t))for(var n=t,i=0;i<n.length;i++)r(n[i].url,n[i].data);else r(t,e)},WFSQueryBuilder:function(t,e,r,n,i,o){Array.isArray(t)||(t=[t]);var a='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(r.version){case"1.0.0":case"1.1.0":a+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":a+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var s in r)"string"==typeof r[s]&&s.indexOf("gml")<0&&r[s].indexOf("wfs")<0&&(a+=s+'="'+r[s]+'" ');var l="<wfs:GetFeature "+a.format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+n+'"'})+">",c="",u="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+(o?' srsName="'+o+'"':"")+">{filter}</wfs:Query>";t.forEach(function(t){c+=u.format({typeName:t,filter:e?e.getText(r.version):""})});return l+=c+"</wfs:GetFeature>"},WFSFilterBuilder:function(t,e,r){var n="";if(p.isPlainObject(t))n='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===e?"fes":"ogc",clipLayer:t.clipLayer,geometryName:t.geometryName,where:t.where});else switch(!0){case!t:break;case Array.isArray(t):var i="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:t[0]+" "+t[1],upperCorner:t[2]+" "+t[3]});switch(!0){case"1.0.0"===e:case"1.1.0"===e:n+="<ogc:Filter><ogc:BBOX>"+i+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===e:n+="<fes:Filter><fes:BBOX>"+i+"</fes:BBOX></fes:Filter>"}break;case t instanceof TC.Feature:switch(!0){case"1.0.0"===e:case"1.1.0"===e:n+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(t,{version:"2.0",srsName:r})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===e:n+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(t,{version:"3.2",srsName:r})+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return n},writeGMLGeometry:function(t,e){const r=(e=e||{}).version,n=function(){return e.srsName?' srsName="'+e.srsName+'"':""};var i=function(t){var e;if(0===r.indexOf("3")){e=t.toString();for(;e.indexOf(",")>=0;)e=e.replace(","," ")}else e=t.map(function(t){return t.join(",")}).join(" ");return e};switch(r){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&t instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"'+n()+"><gml:posList>"+i(t.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"'+n()+"><gml:exterior><gml:LinearRing><gml:posList>"+i(t.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&t instanceof TC.feature.Polyline:return"<gml:LineString"+n()+"><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon"+n()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(t,e){var r=0!==t.indexOf("http")&&0!==t.indexOf("//"),n=!r&&t.match(TC.Consts.url.SPLIT_REGEX);if(n){var i=n[1];r=(i==e.protocol||null==i)&&n[3]==e.hostname;var o=n[4],a=e.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(r=r&&o==a)}return r},isSameProtocol:function(t,e){if(t.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=t.match(r);if(n&&n.length>1){var i=e.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},consoleRegister:function(t){TC.isDebug&&console.log(t)},getSorterByProperty:function(t){return function(e,r){return e[t]>r[t]?1:e[t]<r[t]?-1:0}},getSoundexDifference:function(t,e){for(var r=0,n=0;n<t.length;n++)t.charAt(n)==e.charAt(n)&&r++;return r},toAbsolutePath:function(t){var e=document.createElement("a");e.href=t;return e.href},getRenderedHtml:function(t,e,r,n){return new Promise(function(i,o){var a=function(){dust.cache[t]&&dust.render(t,r,function(t,e){if(t){TC.error(t);o(Error(t))}else{p.isFunction(n)&&n(e);i(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])a();else if("string"==typeof e)TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){const r=e.data;var n=dust.compile(r,t);dust.loadSource(n);a()}).catch(function(t){console.log("Error fetching template: "+t)});else if(p.isFunction(e)){e();a()}})})},explodeGeometry:function(t){const e=t.origin,r=function(t,n,i){if(Array.isArray(t))t.forEach(r);else{0===n&&(i[0]=t+e[0]);1===n&&(i[1]=t+e[1])}};t.geom.forEach(r);return t.geom},cloneMappingFunction:function(t){return Array.isArray(t)?t.map(TC.Util.cloneMappingFunction):t},compactGeometry:function(t,e){const r=[Number.MAX_VALUE,Number.MAX_VALUE],n=t.map(TC.Util.cloneMappingFunction),i=function(t,e){Array.isArray(t)?t.forEach(i):0===e&&t<r[0]?r[0]=t:1===e&&t<r[1]&&(r[1]=t)};n.forEach(i);const o=function(t){return Math.round(t*e)/e};r[0]=o(r[0]);r[1]=o(r[1]);const a=function(t,e,n){if(Array.isArray(t))t.forEach(a);else{0===e&&(n[0]=o(t-r[0]));1===e&&(n[1]=o(t-r[1]))}};n.forEach(a);return{origin:r,geom:n}}};String.prototype.format=function(){var t=this.toString();if(!arguments.length)return t;var e="string"==(e=typeof arguments[0])||"number"==e?arguments:arguments[0];for(arg in e)t=t.replace(RegExp("\\{"+arg+"\\}","gi"),e[arg]);return t};var d=function(t,e,r){return r(t.getBoundingClientRect(),e.getBoundingClientRect())};if(this.HTMLElement){HTMLElement.prototype.colliding=function(t){return d(this,t,function(t,e){return!(t.top>e.bottom||t.right<e.left||t.bottom<e.top||t.left>e.right)})};HTMLElement.prototype.containing=function(t){d(this,t,function(t,e){return!(t.left<=e.left&&e.left<t.width&&t.top<=e.top&&e.top<t.height)})};HTMLElement.prototype.inside=function(t){return d(this,t,function(t,e){return e.top<=t.top&&t.top<=e.bottom&&e.top<=t.bottom&&t.bottom<=e.bottom&&e.left<=t.left&&t.left<=e.right&&e.left<=t.right&&t.right<=e.right})}}return p});loadjs=function(){var t=function(){},e={},r={},n={};function i(t,e){if(t){var i=n[t];if(r[t]=e,i)for(;i.length;)i[0](t,e),i.splice(0,1)}}function o(e,r){e.call&&(e={success:e}),r.length?(e.error||t)(r):(e.success||t)(e)}function a(e,r,n,i){var o,s,l=document,c=n.async,u=(n.numRetries||0)+1,h=n.before||t,p=e.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(e)?(o=!0,(s=l.createElement("link")).rel="stylesheet",s.href=p):/(^img!|\.(png|gif|jpg|svg)$)/.test(e)?(s=l.createElement("img")).src=p:((s=l.createElement("script")).src=e,s.async=void 0===c||c),!(s.onload=s.onerror=s.onbeforeload=function(t){var l=t.type[0];if(o&&"hideFocus"in s)try{s.sheet.cssText.length||(l="e")}catch(t){18!=t.code&&(l="e")}if("e"==l&&(i+=1)<u)return a(e,r,n,i);r(e,l,t.defaultPrevented)})!==h(e,s)&&l.head.appendChild(s)}function s(t,r,n){var s,l;if(r&&r.trim&&(s=r),l=(s?n:r)||{},s){if(s in e)throw"LoadJS";e[s]=!0}!function(t,e,r){var n,i,o=(t=t.push?t:[t]).length,s=o,l=[];for(n=function(t,r,n){if("e"==r&&l.push(t),"b"==r){if(!n)return;l.push(t)}--o||e(l)},i=0;i<s;i++)a(t[i],n,r)}(t,function(t){o(l,t),i(s,t)},l)}return s.ready=function(t,e){return function(t,e){t=t.push?t:[t];var i,o,a,s=[],l=t.length,c=l;for(i=function(t,r){r.length&&s.push(t),--c||e(s)};l--;)o=t[l],(a=r[o])?i(o,a):(n[o]=n[o]||[]).push(i)}(t,function(t){o(e,t)}),s},s.done=function(t){i(t,[])},s.reset=function(){e={},r={},n={}},s.isDefined=function(t){return t in e},s}();var TC=TC||{};TC.version="2.0.0 [2019-10-4 14:25:49]";!function(){if(!TC.apiLocation){var t;if(document.currentScript)t=document.currentScript;else{var e=document.getElementsByTagName("script");t=e[e.length-1]}var r=t.getAttribute("src");TC.apiLocation=r.substr(0,r.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.SRSDOWNLOAD_GEOJSON_KML="EPSG:4326";TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,OL:"lib/ol/build/ol-sitna",OL_CONNECTOR:"TC/ol/ol",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",PROJ4JS:"lib/proj4js/proj4-src.js",EPSG:"https://epsg.io/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js",UA_PARSER:"lib/ua-parser/ua-parser.min.js",HASH:"lib/jshash/md5-min.js",DRAGGABILLY:"lib/draggabilly/draggabilly.pkgd",URL_POLYFILL:"lib/polyfill/url.js",PROMISE_POLYFILL:"lib/polyfill/promise/polyfill.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-threed"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_LIDAR:"ign-lidar",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_ES_DYNLIDAR:"ign-lidar-dyn",IGN_FR_CARTO:"ign-fr-cartes",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNCARTO:"ign-fr-cartes-dyn",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"};TC.Consts.logicalOperator={AND:"and",OR:"or"};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.WFSErrors={GetFeatureNotAvailable:"GetFeatureNotAvailable",LayersNotAvailable:"LayersNotAvailable",NoLayers:"NoLayers",NoValidLayers:"noValidLayers",QueryNotAvailable:"QueryNotAvailable",CapabilitiesParseError:"CapabilitiesParseError",NumMaxFeatures:"NumMaxFeatures",GetCapabilities:"GetCapabilities",Indeterminate:"Indeterminate",NoFeatures:"NoFeatures"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.view={DEFAULT:0,THREED:1,PRINTING:2};TC.Consts.units={DEGREES:"degrees",METERS:"m"};TC.Consts.MARKER="marker";TC.Defaults=function(){var t={};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,locale:"es-ES",view:TC.Consts.view.DEFAULT,screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:TC.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto m\xe1xima actualidad",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"mapaTopografico",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:TC.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IGN_ES_CARTO,type:TC.Consts.layerType.WMTS,title:"Cartograf\xeda raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_grey_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/mdt",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_LIDAR,title:"Modelo digital LIDAR (IGN ES)",type:TC.Consts.layerType.WMTS,url:"http://wmts-mapa-lidar.idee.es/lidar",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"EL.GridCoverageDSM",matrixSet:"GoogleMapsCompatible",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNLIDAR,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_grey_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:TC.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mdt",layerNames:"relieve",thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNLIDAR,title:"Modelo digital LIDAR (IGN ES)",type:TC.Consts.layerType.WMS,url:"//wms-mapa-lidar.idee.es/lidar",layerNames:"EL.GridCoverage",thumbnail:TC.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_FR_CARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNCARTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNCARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"HR.ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.OSM,title:"OSM",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:TC.Consts.layer.OSM},{id:TC.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_DARK,title:"CARTO dark",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!1,featureInfo:!0,featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(e){var r=e.features.length,n=t[r];if(!n){n=2+Math.round(5*Math.sqrt(r));t[r]=n}return n},label:"${features.length}",fontColor:"#fff",fontSize:9}},selection:{point:{fillColor:"#0000ff",fillOpacity:.5,strokeColor:"#0000ff",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},line:{strokeColor:"#0000ff",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#0000ff",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=new Array(r),i=arguments.length>=2?arguments[1]:void 0,o=0;o<r;o++)o in e&&(n[o]=t.call(i,e[o],o,e));return n});TC.proxify=function(t){var e=t=t.trim();if(TC.Cfg.proxy){var r=!1;if(TC.Cfg.proxyExceptions)for(var n=0;n<TC.Cfg.proxyExceptions.length;n++)if(t.indexOf(TC.Cfg.proxyExceptions[n])>-1){r=!0;break}if(!r&&!TC.Util.isSameOrigin(t))if("function"==typeof TC.Cfg.proxy)e=TC.Cfg.proxy(t);else{e=TC.Cfg.proxy;"http"!=t.substr(0,4)&&(e+=window.location.protocol);e+=encodeURIComponent(t)}}return e};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);var t=function(t){const e=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.error(TC.Util.getLocaleString(e.options.locale,"urlFailedToLoad",{url:t}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+t)};TC.syncLoadJS=function(e){var r=function(t,e){var r,n=new XMLHttpRequest;n.open("GET",t,!1);n.onreadystatechange=function(t){if(4===n.readyState)if(404===n.status){r=!1;e(!0)}else if(200!==n.status){e();r=!1}else r=n.responseText};try{n.send(null)}catch(t){r=!1;e()}return r};/(\.js|\/)$/i.test(e)||(e+=TC.isDebug?".js":".min.js");var n=r(e,function(n){if(n){t(e);return!1}return r(e,function(){t(e)})});if(n){var i=document.createElement("script");i.type="text/javascript";i.text=n;(function(){var t,e=document,r=e.getElementsByTagName("head");if(0===r.length){t=e.createElement("head");e.documentElement.insertBefore(t,document.body)}else t=r[0];return t})().appendChild(i)}};const e=["","-webkit-","-moz-","-o-","-ms-"];var r,n,i;TC.browserFeatures={touch:function(){if(void 0===r){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch){r=!0;return!0}const t=e.map(function(t){return"("+t+"touch-enabled)"}).join();r=matchMedia(t).matches}return r},inputTypeColor:function(){if(void 0===n){const t=document.createElement("input");t.setAttribute("type","color");if(n="text"!==t.type&&"style"in t){t.value=":-)";n=":-)"!==t.value}}return n},urlParser:function(){if(void 0===i)try{const t=new URL("http://sitna.tracasa.es/");i="http://sitna.tracasa.es/"===t.href}catch(t){i=!1}return i}};if(window.jQuery){TC._jQueryIsLoaded=!0;!function(){$._oldWhen=$.when;$.when=function(){const t=new Array(arguments.length);for(var e=0;e<arguments.length;e++){const r=t[e]=arguments[e];if(r instanceof Promise){const n=$.Deferred();r.then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)});t[e]=n}}return $._oldWhen.apply(this,t)}}()}"Promise"in window||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.PROMISE_POLYFILL);window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);"finally"in Promise.prototype||(Promise.prototype.finally=function(t){const e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return value})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})});TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");TC.ajax=function(t){return new Promise(function(e,r){const n=(t=t||{}).method||"GET";var i;if(t.data)if("string"==typeof t.data)i=t.data;else if("object"==typeof t.data){const e=[];for(var o in t.data)e[e.length]=o+"="+t.data[o].toString();i=e.join("&")}var a=t.url;"GET"===n&&(a=a+"?"+i);!1===t.cache&&(a+=(a.indexOf("?")<0?"&":"?")+"ts="+Date.now());const s=new XMLHttpRequest;s.open(n,t.url);t.contentType||"boolean"==typeof t.contentType?t.contentType&&s.setRequestHeader("Content-Type",t.contentType+"; charset=UTF-8"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");s.onreadystatechange=function(n){if(4===s.readyState)if(200!==s.status)r({status:s.status,msg:s.statusText,url:t.url});else{var i;try{switch(t.responseType){case TC.Consts.mimeType.JSON:i=JSON.parse(s.responseText);break;case TC.Consts.mimeType.XML:i=(new DOMParser).parseFromString(s.responseText,"application/xml");break;default:i=s.responseText}e({data:i,contentType:s.getResponseHeader("Content-type")})}catch(t){r(t)}}};try{s.send("POST"===n?i:null)}catch(t){r(t)}})};document.addEventListener("DOMContentLoaded",function(){var t,e="Unknown library",r="OpenLayers";if(TC.Control){t="Compiled";window.ol&&(e=r+" "+ol.VERSION)}else{t="On demand";e=r}TC.version=TC.version+" ("+t+"; "+e+"; @ "+TC.apiLocation+")"});TC.loadJSInOrder=function(t,e,r){TC.loadJS(t,e,r,!0)};const o=function(t,e){TC.Util.isSameOrigin(t)||(e.crossOrigin="anonymous")};TC.loadJS=function(e,r,n,i,a){arguments.length<4&&(i=!1);var s=Array.isArray(r)?r:[r];s=s.map(function(t){return/\.js$/i.test(t)||0!==t.indexOf(TC.apiLocation)?t:t+(TC.isDebug?".js":".min.js")});if(e){s=s instanceof Array?s:[s];var l="";const e=function(t){return t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if(s.length>1){var c=s.slice(0).filter(function(t,r){if(loadjs.isDefined(e(t))){s.splice(r,1);loadjs.ready(e(t),n);return!1}return!0});1===c.length?l=e(c[0]):c.length>0&&(l=c.reduce(function(t,r){return e(t)+"_"+e(r)}))}else l=e(s[0]);if(l.length>0)if(loadjs.isDefined(l)){s.forEach(function(t){const e=new URL(t,location.href),r=Array.from(document.scripts).filter(t=>t.src===e.href)[0];r&&document.head.appendChild(r.cloneNode())});loadjs.ready(l,n)}else{var u={async:!i,numRetries:1};a||TC.Util.detectIE()||(u.before=o);loadjs(s,l,u);loadjs.ready(l,{success:function(){n()},error:function(e){t(e)}})}}else n()};TC.loadCSS=function(e){const r=e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();loadjs.isDefined(r)?loadjs.ready(r,{}):loadjs(e,r,{error:function(e){t(e)},numRetries:1})};var a={};TC.getProjectionData=function(t){return new Promise(function(e,r){var n=(t=t||{}).crs.substr(t.crs.indexOf(":")+1);Number.isNaN(parseInt(n))&&(n=t.crs.substr(t.crs.lastIndexOf("/")+1));var i=a[n];if(i)e(i);else{var o=TC.Consts.url.EPSG+"?format=json&q="+n;new TC.tool.Proxification(TC.proxify).fetchJSON(o,t).then(function(t){a[n]=t;e(t)}).catch(function(t){r(Error(t))})}})};TC.loadProjDef=function(t){const e=(t=t||{}).crs;var r;window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);r=function(t){t=function(t){var e=/http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/\d\/(\d{4})/.exec(t);return e&&2===e.length?"urn:ogc:def:crs:EPSG::"+e[1]:t}(t);return proj4.defs(t)};const n=function(t,e){proj4.defs(t,e);window.ol&&window.ol.proj&&window.ol.proj.proj4.register(proj4)},i=function(t){return"function"==typeof t},o=function(t,i,o){const a="EPSG:"+t,s="urn:ogc:def:crs:EPSG::"+t,l="urn:x-ogc:def:crs:EPSG:"+t,c="http://www.opengis.net/gml/srs/epsg.xml#"+t;var u;if("object"==typeof i){u=TC.Util.extend({},i);i=TC.Util.extend({},i);u.axis&&delete u.axis}else"string"==typeof i&&(u=i.replace("+axis=neu",""));n(a,i);n(s,i);n(l,i);n(c,u);if(0===e.indexOf("http")){n(e,u);r(e).name=o}r(a).name=o;r(c).name=o};var a=e.lastIndexOf("#");a<0&&(a=e.lastIndexOf("/"));a<0&&(a=e.lastIndexOf(":"));var s=e.substr(a+1),l=r(e);if(l){o(s,l,t.name);i(t.callback)&&t.callback()}else if(t.def){o(s,t.def,t.name);i(t.callback)&&t.callback()}else TC.getProjectionData(t).then(function(e){(function(t){var e="ok"===t.status&&1===t.number_result;if(e){var r=t.results[0];o(r.code,r.proj4,r.name)}return e})(e)&&i(t.callback)&&t.callback()})};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES]};TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS;TC.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"});TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");TC.Cfg=TC.Util.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.alert=function(t){alert(t)};TC.prompt=function(t,e,r){var n=prompt(t,e);TC.Util.isFunction(r)&&r(n)};TC.confirm=function(t,e,r){confirm(t)?TC.Util.isFunction(e)&&e():TC.Util.isFunction(r)&&r()};TC.error=function(t){window.console&&console.error(t)};TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.wrap={Map:function(t){var e=this;e.parent=t;e.map=null;e.getMap=function(){return e._promise}},Layer:function(t){var e=this;e.parent=t;e.layer=null;TC.EventTarget.call(e);e.getLayer=function(){return e.layer?Promise.resolve(e.layer):e._promise};e.setLayer=function(t){e.layer=t}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(t){this.parent=t},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},NavBarHome:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},Modify:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)},ResultsPanel:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};TC.inherit(TC.wrap.Layer,TC.EventTarget);TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBarHome,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.inherit(TC.wrap.control.ResultsPanel,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.loadJS(!TC.browserFeatures.urlParser(),TC.apiLocation+TC.Consts.url.URL_POLYFILL,function(){});var s={};TC.getUID=function(t){var e=s[t=t||""];e||(e=s[t]=1);var r=t+e;s[t]=e+1;return r};const l=/\+/g;function c(t){return t}function u(t){return decodeURIComponent(t.replace(l," "))}TC.cookie=function(t,e,r){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(e))||null===e)){r=TC.Util.extend({},r);null===e&&(r.expires=-1);if("number"==typeof r.expires){var n=r.expires,i=r.expires=new Date;i.setDate(i.getDate()+n)}e=String(e);return document.cookie=[encodeURIComponent(t),"=",r.raw?e:encodeURIComponent(e),r.expires?";expires="+r.expires.toUTCString():"",r.path?";path="+r.path:"",r.domain?";domain="+r.domain:"",r.secure?";secure":""].join("")}for(var o,a=(r=e||{}).raw?c:u,s=document.cookie.split("; "),l=0;o=s[l]&&s[l].split("=");l++)if(a(o.shift())===t)return a(o.join("="));return null}}()}document.addEventListener("DOMContentLoaded",function(){TC.browser=TC.Util.getBrowser();TC.loadJS(!TC.Cfg.acceptedBrowserVersions,TC.apiLocation+"TC/config/browser-versions.js",function(t){var e=!0,r=TC.Cfg.acceptedBrowserVersions.filter(function(t){return t.name.toLowerCase()===TC.browser.name.toLowerCase()});if(r.length>0&&r[0].expired)TC.Cfg.loggingErrorsEnabled=!1;else{r.length>0&&!isNaN(r[0].version)&&TC.browser.version<r[0].version&&(e=!1);if(TC.Cfg.oldBrowserAlert&&!e){TC.Cfg.loggingErrorsEnabled=!1;const t=TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale).then(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"outdatedBrowser"),TC.Consts.msgErrorMode.TOAST)})}}});/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;const t=(r=0,function(t){e=e||TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));var n,i,o,a="",s=-1,l=-1;if("unhandledrejection"===t.type){n=t.reason?t.reason.message:"";o=!t.reason||!t.reason.stack||t.reason.stack.indexOf(TC.apiLocation)>=0;i=t.reason}else{n=t.message;a=t.filename;s=t.lineno;l=t.colno;i=t.error;o=a.indexOf(TC.apiLocation)>=0}if((TC.Cfg.notifyApplicationErrors||o)&&r<TC.Cfg.maxErrorCount&&TC.Cfg.loggingErrorsEnabled){var c=o?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:n,url:a,lineNumber:s,column:l,appUrl:location.href,apiVersion:TC.version,prevState:e.getPreviousMapState(),userAgent:navigator.userAgent},i);r++;TC.isDebug||TC.i18n.loadResources(!TC.i18n[e.options.locale],TC.apiLocation+"TC/resources/",e.options.locale).then(function(){TC.error(TC.Util.getLocaleString(e.options.locale,"genericError")+(e.options.contactEmail||"webmaster@itracasa.es"),{type:TC.Consts.msgType.ERROR})})}return!1});var e,r;window.addEventListener("error",t,!1);window.addEventListener("unhandledrejection",t,!1)});!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}}(function(){return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};e[a][0].call(u.exports,function(t){return i(e[a][1][t]||t)},u,u.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){(function(t){"use strict";function r(){c=!0;for(var t,e,r=u.length;r;){for(e=u,u=[],t=-1;++t<r;)e[t]();r=u.length}c=!1}var n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,a=new i(r),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){r(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(r,0)};else{var l=new t.MessageChannel;l.port1.onmessage=r,n=function(){l.port2.postMessage(0)}}var c,u=[];e.exports=function(t){1!==u.push(t)||c||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){"use strict";function n(){}function i(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,t!==n&&l(this,t)}function o(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function a(t,e,r){u(function(){var n;try{n=e(r)}catch(e){return h.reject(t,e)}n===t?h.reject(t,new TypeError("Cannot resolve promise with itself")):h.resolve(t,n)})}function s(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function l(t,e){function r(e){i||(i=!0,h.reject(t,e))}function n(e){i||(i=!0,h.resolve(t,e))}var i=!1,o=c(function(){e(n,r)});"error"===o.status&&r(o.value)}function c(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}var u=t(1),h={},p=["REJECTED"],d=["FULFILLED"],f=["PENDING"];e.exports=r=i,i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){if("function"!=typeof t&&this.state===d||"function"!=typeof e&&this.state===p)return this;var r=new this.constructor(n);this.state!==f?a(r,this.state===d?t:e,this.outcome):this.queue.push(new o(r,t,e));return r},o.prototype.callFulfilled=function(t){h.resolve(this.promise,t)},o.prototype.otherCallFulfilled=function(t){a(this.promise,this.onFulfilled,t)},o.prototype.callRejected=function(t){h.reject(this.promise,t)},o.prototype.otherCallRejected=function(t){a(this.promise,this.onRejected,t)},h.resolve=function(t,e){var r=c(s,e);if("error"===r.status)return h.reject(t,r.value);var n=r.value;if(n)l(t,n);else{t.state=d,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},h.reject=function(t,e){t.state=p,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},r.resolve=function(t){return t instanceof this?t:h.resolve(new this(n),t)},r.reject=function(t){var e=new this(n);return h.reject(e,t)},r.all=function(t){function e(t,e){r.resolve(t).then(function(t){a[e]=t,++s!==i||o||(o=!0,h.resolve(c,a))},function(t){o||(o=!0,h.reject(c,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,o=!1;if(!i)return this.resolve([]);for(var a=new Array(i),s=0,l=-1,c=new this(n);++l<i;)e(t[l],l);return c},r.race=function(t){function e(t){r.resolve(t).then(function(t){o||(o=!0,h.resolve(s,t))},function(t){o||(o=!0,h.reject(s,t))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,o=!1;if(!i)return this.resolve([]);for(var a=-1,s=new this(n);++a<i;)e(t[a]);return s}},{1:1}],3:[function(t,e,r){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,r){"use strict";function n(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)r.append(t[n]);return r.getBlob(e.type)}}function i(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function o(t,e,r){"function"==typeof e&&t.then(e),"function"==typeof r&&t.catch(r)}function a(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function s(t){for(var e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r),i=0;i<e;i++)n[i]=t.charCodeAt(i);return r}function l(t){return"boolean"==typeof E?w.resolve(E):function(t){return new w(function(e){var r=t.transaction(b,P),i=n([""]);r.objectStore(b).put(i,"key"),r.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},r.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);e(r||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return E=t})}function c(t){var e=L[t.name],r={};r.promise=new w(function(t){r.resolve=t}),e.deferredOperations.push(r),e.dbReady?e.dbReady=e.dbReady.then(function(){return r.promise}):e.dbReady=r.promise}function u(t,e){return new w(function(r,n){if(t.db){if(!e)return r(t.db);c(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var o=S.open.apply(S,i);e&&(o.onupgradeneeded=function(e){var r=o.result;try{r.createObjectStore(t.storeName),e.oldVersion<=1&&r.createObjectStore(b)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),o.onerror=function(t){t.preventDefault(),n(o.error)},o.onsuccess=function(){r(o.result),function(t){var e=L[t.name].deferredOperations.pop();e&&e.resolve()}(t)}})}function h(t){return n([s(atob(t.data))],{type:t.type})}function p(t){return t&&t.__local_forage_encoded_blob}function d(t){var e=this,r=e._initReady().then(function(){var t=L[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return o(r,t,t),r}function f(t){c(t);for(var e=L[t.name].forages,r=0;r<e.length;r++)e[r]._dbInfo.db&&(e[r]._dbInfo.db.close(),e[r]._dbInfo.db=null);return u(t,!1).then(function(t){for(var r=0;r<e.length;r++)e[r]._dbInfo.db=t}).catch(function(e){throw function(t,e){var r=L[t.name].deferredOperations.pop();r&&r.reject(e)}(t,e),e})}function g(t,e,r){try{var n=t.db.transaction(t.storeName,e);r(null,n)}catch(n){if(!t.db||"InvalidStateError"===n.name)return f(t).then(function(){var n=t.db.transaction(t.storeName,e);r(null,n)});r(n)}}function y(t){var e,r,n,i,o,a=.75*t.length,s=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(e=0;e<s;e+=4)r=I.indexOf(t[e]),n=I.indexOf(t[e+1]),i=I.indexOf(t[e+2]),o=I.indexOf(t[e+3]),u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function m(t){var e,r=new Uint8Array(t),n="";for(e=0;e<r.length;e+=3)n+=I[r[e]>>2],n+=I[(3&r[e])<<4|r[e+1]>>4],n+=I[(15&r[e+1])<<2|r[e+2]>>6],n+=I[63&r[e+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function C(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}function v(t,e){t[e]=function(){var r=arguments;return t.ready().then(function(){return t[e].apply(t,r)})}}function T(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var r in e)e.hasOwnProperty(r)&&(Z(e[r])?arguments[0][r]=e[r].slice():arguments[0][r]=e[r])}return arguments[0]}var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();"undefined"==typeof Promise&&t(3);var E,L,w=Promise,b="local-forage-detect-blob-support",A=Object.prototype.toString,x="readonly",P="readwrite",R={_driver:"asyncStorage",_initStorage:function(t){function e(){return w.resolve()}var r=this,n={db:null};if(t)for(var i in t)n[i]=t[i];L||(L={});var o=L[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},L[n.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=d);for(var a=[],s=0;s<o.forages.length;s++){var l=o.forages[s];l!==r&&a.push(l._initReady().catch(e))}var c=o.forages.slice(0);return w.all(a).then(function(){return n.db=o.db,u(n,!1)}).then(function(t){return n.db=t,function(t,e){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,i=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),i||r){if(r){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}(n,r._defaultConfig.version)?function(t){return u(t,!0)}(n):t}).then(function(t){n.db=o.db=t,r._dbInfo=n;for(var e=0;e<c.length;e++){var i=c[e];i!==r&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})},_support:function(){try{if(!S)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var r=this,n=new w(function(e,n){r.ready().then(function(){g(r._dbInfo,x,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;p(n)&&(n=h(n));var i=t(n,r.key,s++);void 0!==i?e(i):r.continue()}else e()},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=new w(function(e,n){r.ready().then(function(){g(r._dbInfo,x,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),p(t)&&(t=h(t)),e(t)},a.onerror=function(){n(a.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},setItem:function(t,e,r){var n=this;t=a(t);var o=new w(function(r,i){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===A.call(e)?l(o.db).then(function(t){return t?e:function(t){return new w(function(e,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:t.type})},n.readAsBinaryString(t)})}(e)}):e}).then(function(e){g(n._dbInfo,P,function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),r(e)},a.onabort=a.onerror=function(){var t=l.error?l.error:l.transaction.error;i(t)}}catch(t){i(t)}})}).catch(i)});return i(o,r),o},removeItem:function(t,e){var r=this;t=a(t);var n=new w(function(e,n){r.ready().then(function(){g(r._dbInfo,P,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(a.error)},o.onabort=function(){var t=a.error?a.error:a.transaction.error;n(t)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},clear:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){g(e._dbInfo,P,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=o.error?o.error:o.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r},length:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){g(e._dbInfo,x,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){r(o.error)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r},key:function(t,e){var r=this,n=new w(function(e,n){t<0?e(null):r.ready().then(function(){g(r._dbInfo,x,function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,l=a.openCursor();l.onsuccess=function(){var r=l.result;r?0===t?e(r.key):s?e(r.key):(s=!0,r.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(t){n(t)}})}).catch(n)});return i(n,e),n},keys:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){g(e._dbInfo,x,function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var e=o.result;e?(a.push(e.key),e.continue()):t(a)},o.onerror=function(){r(o.error)}}catch(t){r(t)}})}).catch(r)});return i(r,t),r}},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M="~~local_forage_type~",O=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:",k=N.length,D="arbf",F="blob",B="si08",G="ui08",U="uic8",j="si16",q="si32",W="ur16",H="ui32",V="fl32",Y="fl64",z=k+D.length,X=Object.prototype.toString,K={serialize:function(t,e){var r="";if(t&&(r=X.call(t)),t&&("[object ArrayBuffer]"===r||t.buffer&&"[object ArrayBuffer]"===X.call(t.buffer))){var n,i=N;t instanceof ArrayBuffer?(n=t,i+=D):(n=t.buffer,"[object Int8Array]"===r?i+=B:"[object Uint8Array]"===r?i+=G:"[object Uint8ClampedArray]"===r?i+=U:"[object Int16Array]"===r?i+=j:"[object Uint16Array]"===r?i+=W:"[object Int32Array]"===r?i+=q:"[object Uint32Array]"===r?i+=H:"[object Float32Array]"===r?i+=V:"[object Float64Array]"===r?i+=Y:e(new Error("Failed to get type for BinaryArray"))),e(i+m(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=M+t.type+"~"+m(this.result);e(N+F+r)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(r){console.error("Couldn't convert value into a JSON string: ",t),e(null,r)}},deserialize:function(t){if(t.substring(0,k)!==N)return JSON.parse(t);var e,r=t.substring(z),i=t.substring(k,z);if(i===F&&O.test(r)){var o=r.match(O);e=o[1],r=r.substring(o[0].length)}var a=y(r);switch(i){case D:return a;case F:return n([a],{type:e});case B:return new Int8Array(a);case G:return new Uint8Array(a);case U:return new Uint8ClampedArray(a);case j:return new Int16Array(a);case W:return new Uint16Array(a);case q:return new Int32Array(a);case H:return new Uint32Array(a);case V:return new Float32Array(a);case Y:return new Float64Array(a);default:throw new Error("Unkown type: "+i)}},stringToBuffer:y,bufferToString:m},$={_driver:"webSQLStorage",_initStorage:function(t){var e=this,r={db:null};if(t)for(var n in t)r[n]="string"!=typeof t[n]?t[n].toString():t[n];var i=new w(function(t,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(t){return n(t)}r.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){e._dbInfo=r,t()},function(t,e){n(e)})})});return r.serializer=K,i},_support:"function"==typeof openDatabase,iterate:function(t,e){var r=this,n=new w(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName,[],function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var l=o.item(s),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=t(c,l.key,s+1)))return void e(c)}e()},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=new w(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],function(t,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),e(n)},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},setItem:function(t,e,r){return function t(e,r,n,o){var s=this;e=a(e);var l=new w(function(i,a){s.ready().then(function(){void 0===r&&(r=null);var l=r,c=s._dbInfo;c.serializer.serialize(r,function(r,u){u?a(u):c.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,r],function(){i(l)},function(t,e){a(e)})},function(r){if(r.code===r.QUOTA_ERR){if(o>0)return void i(t.apply(s,[e,l,n,o-1]));a(r)}})})}).catch(a)});return i(l,n),l}.apply(this,[t,e,r,1])},removeItem:function(t,e){var r=this;t=a(t);var n=new w(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},clear:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){e.executeSql("DELETE FROM "+n.storeName,[],function(){t()},function(t,e){r(e)})})}).catch(r)});return i(r,t),r},length:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){e.executeSql("SELECT COUNT(key) as c FROM "+n.storeName,[],function(e,r){var n=r.rows.item(0).c;t(n)},function(t,e){r(e)})})}).catch(r)});return i(r,t),r},key:function(t,e){var r=this,n=new w(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,r){var n=r.rows.length?r.rows.item(0).key:null;e(n)},function(t,e){n(e)})})}).catch(n)});return i(n,e),n},keys:function(t){var e=this,r=new w(function(t,r){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){e.executeSql("SELECT key FROM "+n.storeName,[],function(e,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);t(n)},function(t,e){r(e)})})}).catch(r)});return i(r,t),r}},J={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var r in t)e[r]=t[r];return e.keyPrefix=e.name+"/",e.storeName!==this._defaultConfig.storeName&&(e.keyPrefix+=e.storeName+"/"),C()?(this._dbInfo=e,e.serializer=K,w.resolve()):w.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var r=this,n=r.ready().then(function(){for(var e=r._dbInfo,n=e.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var l=localStorage.key(s);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(i),a++)))return c}}});return i(n,e),n},getItem:function(t,e){var r=this;t=a(t);var n=r.ready().then(function(){var e=r._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return i(n,e),n},setItem:function(t,e,r){var n=this;t=a(t);var o=n.ready().then(function(){void 0===e&&(e=null);var r=e;return new w(function(i,o){var a=n._dbInfo;a.serializer.serialize(e,function(e,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+t,e),i(r)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})});return i(o,r),o},removeItem:function(t,e){var r=this;t=a(t);var n=r.ready().then(function(){var e=r._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return i(n,e),n},clear:function(t){var e=this,r=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(t)&&localStorage.removeItem(n)}});return i(r,t),r},length:function(t){var e=this.keys().then(function(t){return t.length});return i(e,t),e},key:function(t,e){var r=this,n=r.ready().then(function(){var e,n=r._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e});return i(n,e),n},keys:function(t){var e=this,r=e.ready().then(function(){for(var t=e._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(t.keyPrefix)&&n.push(o.substring(t.keyPrefix.length))}return n});return i(r,t),r}},Z=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Q={},tt={},et={INDEXEDDB:R,WEBSQL:$,LOCALSTORAGE:J},rt=[et.INDEXEDDB._driver,et.WEBSQL._driver,et.LOCALSTORAGE._driver],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],it={description:"",driver:rt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},ot=new(function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r in et)if(et.hasOwnProperty(r)){var n=et[r],i=n._driver;this[r]=i,Q[i]||this.defineDriver(n)}this._defaultConfig=T({},it),this._config=T({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":_(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,r){var n=new w(function(e,r){try{var n=t._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void r(i);for(var o=nt.concat("_initStorage"),a=0,s=o.length;a<s;a++){var l=o[a];if(!l||!t[l]||"function"!=typeof t[l])return void r(i)}var c=function(r){Q[n]&&console.info("Redefining LocalForage driver: "+n),Q[n]=t,tt[n]=r,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(c,r):c(!!t._support):c(!0)}catch(t){r(t)}});return o(n,e,r),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,r){var n=Q[t]?w.resolve(Q[t]):w.reject(new Error("Driver not found."));return o(n,e,r),n},t.prototype.getSerializer=function(t){var e=w.resolve(K);return o(e,t),e},t.prototype.ready=function(t){var e=this,r=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return o(r,t,t),r},t.prototype.setDriver=function(t,e,r){function n(){a._config.driver=a.driver()}function i(t){return a._extend(t),n(),a._ready=a._initStorage(a._config),a._ready}var a=this;Z(t)||(t=[t]);var s=this._getSupportedDrivers(t),l=null!==this._driverSet?this._driverSet.catch(function(){return w.resolve()}):w.resolve();return this._driverSet=l.then(function(){var t=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,n(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(t){return function(){var e=0;return function r(){for(;e<t.length;){var o=t[e];return e++,a._dbInfo=null,a._ready=null,a.getDriver(o).then(i).catch(r)}n();var s=new Error("No available storage method found.");return a._driverSet=w.reject(s),a._driverSet}()}}(s)})}).catch(function(){n();var t=new Error("No available storage method found.");return a._driverSet=w.reject(t),a._driverSet}),o(this._driverSet,e,r),this._driverSet},t.prototype.supports=function(t){return!!tt[t]},t.prototype._extend=function(t){T(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];this.supports(i)&&e.push(i)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=nt.length;t<e;t++)v(this,nt[t])},t.prototype.createInstance=function(e){return new t(e)},t}());e.exports=ot},{3:3}]},{},[4])(4)});TC.Layer=function(t){this.options=t||{};TC.Util.extend(this,this.options);this.id=this.options.id||TC.getUID();this.map=this.options.map;this.type=this.options.type||TC.Consts.layerType.WMS;this.customLegend=this.options.customLegend;var e=this.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;this.options.format=this.options.format||e;void 0===this.options.hideTree&&(this.options.hideTree=!0);void 0===this.options.hideTitle&&(this.options.hideTitle=!1);this._cache={visibilityStates:{}};this.tree=null;this.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(t){this.wrap.setVisibility(t)};TC.Layer.prototype.getVisibility=function(){var t=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(t=this.wrap.getVisibility()));return t};TC.Layer.prototype.getOpacity=function(){var t=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(t=this.wrap.layer.getOpacity()));return t};TC.Layer.prototype.setOpacity=function(t,e){var r=this;this.wrap.getLayer().then(function(n){n.setOpacity(t);r.opacity=t;r.map&&!e&&r.map.trigger(TC.Consts.event.LAYEROPACITY,{layer:r,opacity:t})})};TC.Layer.prototype.isCompatible=function(t){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var t=!0;switch(this.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:t=!1}return t};TC.Layer.prototype.isVisibleByScale=function(t){return!0};TC.Layer.prototype.isVisibleByName=function(t){return!0};TC.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}};TC.Layer.prototype.findNode=function t(e,r){var n=null;if(r.uid==e)n=r;else for(var i=0;i<r.children.length;i++){var o=t(e,r.children[i]);if(o){n=o;break}}return n};TC.Layer.prototype.setNodeVisibility=function(t,e){this.setVisibility(e)};TC.Layer.prototype.getNodeVisibility=function(t){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.Layer.prototype.setProjection=function(){};TC.control=TC.control||{};TC.Control=function(){const t=this;TC.EventTarget.call(t);t.map=null;t.isActive=!1;t.isDisabled=!1;var e=arguments.length;t.options=TC.Util.extend({},e>1?arguments[1]:arguments[0]);t.id=t.options.id||TC.getUID(t.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]);TC._jQueryIsLoaded&&(t._$div=$(t.div));t.div.classList.add(TC.Control.prototype.CLASS,t.CLASS);t.template=t.options.template||t.template;t.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template="";t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};const e=function(t,e,r){return new Promise(function(n,i){const o=[],a=[];for(var s in r){var l=r[s];if("string"==typeof l)if(dust.cache[t.CLASS])dust.render(t.CLASS,e,function(e,r){t.div.innerHTML=r;e&&TC.error(e)});else{var c=TC.ajax({url:l,method:"GET",responseType:"text"});o.push(c);a.push(s)}else TC.Util.isFunction(l)&&l()}0===o.length?n():Promise.all(o).then(function(t){t.map(t=>t.data).forEach(function(t,e){const r=dust.compile(t,a[e]);dust.loadSource(r)});n()}).catch(function(t){console.error("Error fetching templates: "+t);i(t instanceof Error?t:Error(t))})})};t.renderData=function(t,r){const n=this;return new Promise(function(i,o){n.map&&n.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});n.div.classList.toggle(TC.Consts.classes.DISABLED,n.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var a;if("object"==typeof n.template)a=e(n,t,n.template);else{var s={};n.template&&(s[n.CLASS]=n.template);a=e(n,t,s)}a.then(function(){dust.cache[n.CLASS]&&dust.render(n.CLASS,t,function(t,e){n.div.innerHTML=e;if(t){o(Error(t));TC.error(t)}});n.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(r)&&r();i()}).catch(function(t){o(Error(t))})})})};t.getRenderedHtml=function(t,e,r){const n=this;return new Promise(function(i,o){var a=function(){dust.cache[t]&&dust.render(t,e,function(t,e){if(t){TC.error(t);o(Error(t))}else{TC.Util.isFunction(r)&&r(e);i(e)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])a();else{var e=n.template[t];if("string"==typeof e)TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){const r=e.data;var n=dust.compile(r,t);dust.loadSource(n);a()}).catch(function(t){console.log("Error fetching template: "+t)});else if(TC.Util.isFunction(e)){e();a()}}})})};t.register=function(t){const e=this;return new Promise(function(r,n){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();r(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,r){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,r){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,r)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var r=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(r,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){}}();TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if(this.wrap.isNative(t)){this.wrap.feature=t;t._wrap=this.wrap;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();t._folders&&(this.folders=t._folders);this.data=this.wrap.getData()}var r=this.options=TC.Util.extend(!0,{},e);this.id=this.id||r.id||TC.getUID();this.data=r.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===r.showsPopup?this.showsPopup=!0:this.showsPopup=r.showsPopup;this.layer=r.layer||null;this._selected=!1;r.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var r=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});r.length>0&&r[0].hide()}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){this.wrap.toggleSelectedStyle(t)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(r,[])},r=function(r,n){t(n)?r[r.length]=n:r=r.concat(e(n));return r};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach(function(r,n){if(Array.isArray(r))e(r);else if("number"!=typeof r){console.log("Warning: coordinate does not have number type");t[n]=parseFloat(r)}})};Array.isArray(t)&&e(t);this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=TC.Util.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,r=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),n=this.getData();if("object"==typeof n){var i=this.wrap.getTemplate();if(i)e=i.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return n[e]});else{var o=[];const t=[],i=TC.Util.getLocaleString(r,"open"),s=TC.Util.getLocaleString(r,"linkInNewWindow");for(var a in n){const e=n[a],l=a.match(/^h(\d)_/i);if(l)t[l[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e){o[o.length]="<tr><th>";o[o.length]=a;o[o.length]="</th><td>";if(TC.Util.isURL(e)){o[o.length]='<a href="';o[o.length]=e;o[o.length]='" target="_blank" title="';o[o.length]=s;o[o.length]='">';o[o.length]=i;o[o.length]="</a>"}else o[o.length]=void 0!==e?TC.Util.formatNumber(e,r):"&mdash;";o[o.length]="</td></tr>"}}const l=t.map(function(t,e){if(t)return"<h"+e+">"+t+"</h"+e+">"}).filter(function(t){return t});l.length&&(o=l.concat(o));if(o.length>0){o.unshift('<table class="tc-attr">');o[o.length]="</table>";e=o.join("")}}}else"string"==typeof n&&(e=n);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(r,"noData"));return e};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var n,i=t||e.popup;if(!i)for(var o=r.getControlsByClass("TC.control.Popup"),a=0,s=o.length;a<s;a++){var l=o[a];if(!l.caller){i=l;break}}if(i){i.currentFeature=e;n=Promise.resolve(i)}else n=r.addControl("popup");n.then(function(t){t.currentFeature=e;r.getControlsByClass(TC.control.Popup).forEach(function(t){t.isVisible()&&t.hide()});e.wrap.showPopup(t);const n=t.contentDiv.querySelector("table.tc-attr"),i=t.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(n&&i.length){const t=n.getBoundingClientRect().width+"px";i.forEach(function(e){e.style.maxWidth=t})}r.trigger(TC.Consts.event.POPUP,{control:t});t.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(t){const e=this,r=e.layer&&e.layer.map||t&&t.map;if(r){var n,i=t;if(!i)for(var o=r.getControlsByClass("TC.control.ResultsPanel").filter(function(t){return"table"===t.options.content}),a=0,s=o.length;a<s;a++){var l=o[a];if(!l.caller){i=l;break}}if(i){i.currentFeature=e;n=Promise.resolve(i)}else{var c={content:"table"},u=r.getControlsByClass("TC.control.ControlContainer")[0];if(u){c.side=u.SIDE.RIGHT;n=u.addControl("resultsPanel",c)}else{c.div=document.createElement("div");r.div.appendChild(c.div);n=r.addControl("resultsPanel",c)}}n.then(function(t){t.currentFeature=e;0===r.getControlsByClass(TC.control.ControlContainer).length&&r.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});r.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&t.close()});t.div.querySelector(".tc-ctl-print-btn")&&t.div.querySelector(".tc-ctl-print-btn").remove();t.menuDiv.innerHTML="";t.open(e.getInfo({locale:r.options.locale}),t.getInfoContainer());var n=function(e){r.off(TC.Consts.event.VIEWCHANGE,n);t.close()};r.on(TC.Consts.event.VIEWCHANGE,n)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle(TC.Util.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){const t=this;t._selected=!1;t.setStyle(t.options);if(t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(t,e){TC.Feature.apply(this,arguments);if(!this.wrap.isNative(t)){this.wrap.feature=t;e=this.options=TC.Util.extend(!0,this.options,TC.Cfg.styles.point,e);this.wrap.createPoint(t,e)}};TC.inherit(TC.feature.Point,TC.Feature);TC.feature.Point.prototype.STYLETYPE=TC.Consts.geom.POINT;TC.feature.Point.prototype.CLASSNAME="TC.feature.Point";TC.feature.Point.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[e]:e};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.polygon,e);r.wrap.createCircle(t,e)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var t=TC.feature.Circle.prototype;t.STYLETYPE=TC.Consts.geom.POLYGON;t.CLASSNAME="TC.feature.Circle";t.getCoords=function(){return this.wrap.getGeometry()};t.setCoords=function(t){const e=this;if(!Array.isArray(t)||!Array.isArray(t[0])||Array.isArray(t[0][0])||Array.isArray(t[0][1])||Array.isArray(t[1]))throw new Error("Coordinates not valid for circle");return TC.Feature.prototype.setCoords.call(e,t)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.marker,e);var n=r.layer&&r.layer.map?r.layer.map.options.locale:TC.Cfg.locale;r.title=e.title||TC.i18n[n][TC.Consts.MARKER];r.wrap.createMarker(t,e)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.polygon,e);r.wrap.createMultiPolygon(t,e)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature.MultiPolygon.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],[].concat.apply([],e)):e};TC.feature.MultiPolygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for multipolygon");Array.isArray(t[0][0])?Array.isArray(t[0][0][0])||(t=[t]):t=[[t]];t.forEach(function(t){t.forEach(function(t){const e=t[0],r=t[t.length-1];e[0]===r[0]&&e[1]===r[1]||(t[t.length]=e)})});return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.MultiPolygon.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.line,e);r.wrap.createMultiPolyline(t,e)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE="line";TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature.MultiPolyline.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e};TC.feature.MultiPolyline.prototype.setCoords=function(t){Array.isArray(t)&&Array.isArray(t[0])&&!Array.isArray(t[0][0])&&(t=[t]);return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.MultiPolyline.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.polygon,e);r.wrap.createPolygon(t,e)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature.Polygon.prototype.getCoords=function(t){t=t||{};const e=TC.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e};TC.feature.Polygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for polygon");Array.isArray(t[0][0])||(t=[t]);t.forEach(function(t){const e=t[0],r=t[t.length-1];e[0]===r[0]&&e[1]===r[1]||(t[t.length]=e)});return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.Polygon.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.feature.Polygon.prototype.getArea=function(t){return this.wrap.getArea(t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(t,e){const r=this;TC.Feature.apply(r,arguments);if(!r.wrap.isNative(t)){e=r.options=TC.Util.extend(!0,r.options,TC.Cfg.styles.line,e);r.wrap.createPolyline(t,e)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE="line";TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.feature.Polyline.prototype.setCoords=function(t){Array.isArray(t)&&!Array.isArray(t[0])&&(t=[t]);return TC.Feature.prototype.setCoords.call(this,t)};TC.feature.Polyline.prototype.getLength=function(t){return this.wrap.getLength(t)};TC.filter={};TC.filter.Filter=function(t){this.tagName_=t;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(t){if(t!=this){t._defaultNSURL=this._defaultNSURL;t._defaultPrefixNS=this._defaultPrefixNS}return t instanceof TC.filter.LogicalNary?t.write():t instanceof TC.filter.ComparisonBinary?t.write():t instanceof TC.filter.Comparison?t.write():t instanceof TC.filter.Spatial?t.write():(TC.filter.Function,t.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(t){return t.reduce(function(t,e,r){return(t instanceof TC.filter.Filter?t.writeInnerCondition_(t):t)+e.writeInnerCondition_(e)})};TC.filter.Filter.prototype.getText=function(t){if(t&&parseFloat(t,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,e))};TC.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,e))};TC.filter.not=function(t){return new TC.filter.Not(t)};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(t,e,r){return new TC.filter.EqualTo(t,e,r)};TC.filter.notEqualTo=function(t,e,r){return new TC.filter.NotEqualTo(t,e,r)};TC.filter.lessThan=function(t,e){return new TC.filter.LessThan(t,e)};TC.filter.lessThanOrEqualTo=function(t,e){return new TC.filter.LessThanOrEqualTo(t,e)};TC.filter.greaterThan=function(t,e){return new TC.filter.GreaterThan(t,e)};TC.filter.greaterThanOrEqualTo=function(t,e){return new TC.filter.GreaterThanOrEqualTo(t,e)};TC.filter.isNull=function(t){return new TC.filter.IsNull(t)};TC.filter.between=function(t,e,r){return new TC.filter.IsBetween(t,e,r)};TC.filter.function=function(t,e){return new TC.filter.Function(t,e)};TC.filter.like=function(t,e,r,n,i,o){return new TC.filter.IsLike(t,e,r,n,i,o)};TC.filter.LogicalNary=function(t,e){TC.filter.Filter.call(this,t);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(t){var e=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(t){var e=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(t){this.condition=t;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Bbox=function(t,e,r){TC.filter.Filter.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=r};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(t,e){TC.filter.Filter.call(this,t);this.propertyName=e};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var t="";this.lowerBoundary&&this.upperBoundary&&(t="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(t="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(t=Array.isArray(this.params)?this.params.reduce(function(t,e,r){var n=function(t){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:t})};return(r>0?t:n(t))+n(e)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:t,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(t,e,r,n){TC.filter.Comparison.call(this,t,e);this.expression=r;this.matchCase=n};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(t,e,r){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",t,e,r)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",t,e)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",t,e)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",t,e)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(t,e,r){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",t,e,r)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(t,e,r,n,i,o){TC.filter.Comparison.call(this,"PropertyIsLike",t);this.pattern=e;this.wildCard=void 0!==r?r:"*";this.singleChar=void 0!==n?n:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=o};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(t){TC.filter.Comparison.call(this,"PropertyIsNull",t)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(t,e,r){TC.filter.Comparison.call(this,"PropertyIsBetween",t);this.lowerBoundary=e;this.upperBoundary=r};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(t,e){TC.filter.Filter.call(this,t);this.params=e};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var t="";if(this.params){var e=function(t,e){if("string"==typeof t)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:e,value:t});if("object"==typeof t){var r="";for(var n in t)r+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:e,value:t[n],key:n});return r}};if(Array.isArray(this.params)){var r=this._defaultPrefixNS;t=this.params.reduce(function(t,n,i){var o=function(t){return e(t,r)};return(i>1?t:o(t))+o(n)})}else t=e(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:t})};TC.filter.Spatial=function(t,e,r,n){TC.filter.Filter.call(this,t);this.geometryName=e;this.geometry=r;this.srsName=n;this.wrap=new TC.wrap.Filter(this)};TC.wrap.Filter=function(t){this.parent=t};TC.wrap.Filter.prototype.getAxisOrientation=function(){var t=this.parent.srsName;if(t){const e=t.match(/\d{4,6}$/);if(e){const r=e[0],n=ol.proj.get(t);if(n)return("neu"===n.axisOrientation_?"urn:x-ogc:def:crs:EPSG:":"EPSG:")+r}}return t};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.wrap.getAxisOrientation()),fieldTitle:this._fieldTitle})};TC.filter.Bbox=function(t,e,r){TC.filter.Filter.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=r};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var t="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:t})};TC.filter.Intersects=function(t,e,r){TC.filter.Spatial.call(this,"Intersects",t,e,r)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(t,e,r){TC.filter.Spatial.call(this,"Within",t,e,r)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var t=TC.control.MapContents.prototype;t.CLASS="tc-ctl-mc";t.render=function(t,e){const r=this;return r._set1stRenderPromise(r.map?r.renderData(e?TC.Util.extend(r.map.getLayerTree(),e):r.map.getLayerTree(),function(){r.addUIEventListeners();"function"==typeof t&&t()}):Promise.reject())};t.register=function(t){const e=this;return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),e.renderPromise()]).then(function(){for(var n=0,i=t.layers.length;n<i;n++)e.updateLayerTree(t.layers[n]);t.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){e.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(t){const r=t.layer;var n=r.names;!function t(e){var r=!1;if(e)if(n.indexOf(e.name)>=0)r=!0;else for(var i=0;i<e.children.length;i++)if(t(e.children[i])){r=!0;break}return r}(e.layerTrees[r.id])&&0!==n.length?e.updateLayerTree(r):e.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(t){e.updateLayerVisibility(t.layer)}).on(TC.Consts.event.LAYERADD,function(t){e.updateLayerTree(t.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){const r=t.layer;e._updateLayerTreeTimeout&&clearTimeout(e._updateLayerTreeTimeout);e._updateLayerTreeTimeout=setTimeout(function(){if(e.map.workLayers.indexOf(r)>-1){e.updateLayerTree(r);delete e._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(t){e.removeLayer(t.layer)}).on(TC.Consts.event.LAYERORDER,function(t){e.updateLayerOrder(t.layer,t.oldIndex,t.newIndex)}).on(TC.Consts.event.LAYERERROR,function(t){e.onErrorLayer(t.layer)});r(e)}).catch(function(t){n(t instanceof Error?t:Error(t))})})};t.updateScale=function(){};t.updateLayerVisibility=function(t){};t.updateLayerTree=function(t){this.layerTrees[t.id]=t.getTree()};t.updateLayerOrder=function(t,e,r,n){const i=this;if(e>=0&&e!==r){var o,a;const e=i.getLayerUIElements();for(var s=(n=n||i.map.workLayers).length-1;s>=0;s--){const r=n[s];a=o;for(var l=0,c=e.length;l<c;l++){const t=e[l];if(t.dataset.layerId===r.id){o=t;break}}if(r===t){a?a.insertAdjacentElement("afterend",o):o.parentElement.firstChild.insertAdjacentElement("beforebegin",o);break}}}};t.removeLayer=function(t){const e=this,r=e.getLayerUIElements();for(var n=0,i=r.length;n<i;n++){const e=r[n];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}0===e.getLayerUIElements().length&&e.div.querySelector("."+e.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};t.onErrorLayer=function(t){};t.getLayerUIElements=function(){return this.div.querySelector("ul").children};t.styleLegendImage=function(t,e){if(!t.getAttribute("src")){var r=t.dataset.img;const l=new TC.tool.Proxification(TC.proxify);if(e&&e.options.method&&"POST"===e.options.method)e.getLegendGraphicImage().then(function(e){t.src=e}).catch(function(t){TC.error(t)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const c=t.parentElement;var n=c.style.color,i=n.indexOf("("),o=n.indexOf(")");if(i>=0&&o>i){color=n.substr(0,o).substr(i+1).split(",");n="0x";for(var a=0;a<3;a++){var s=parseInt(color[a]).toString(16);n+=1===s.length?"0"+s:s}}else n.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+c.style.fontFamily+";fontSize:"+parseInt(c.style.fontSize)+";fontColor:"+n+";fontAntiAliasing:true";e.params&&e.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:e.params.sld_body}));l.fetchImage(r).then(function(t){t.dataset.img=t.src}).catch(function(t){TC.error(t)})}l.fetchImage(r).then(function(e){t.src=e.src}).catch(function(t){TC.error(t.statusText)})}}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapInfo=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.MapInfo,TC.Control);!function(){var t=TC.control.MapInfo.prototype;t.CLASS="tc-ctl-mi";t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.QR_MAX_URL_LENGTH=150;e.SHORTEN_URL_LENGTH=32715;e.exportsState=!1;e.includeControls=void 0===e.options.includeControls||e.options.includeControls;t.ready(function(){const r=t.state&&t.state.ctl;if(r&&!t._controlStatesLoaded){e.importControlStates(r);t._controlStatesLoaded=!0}});return r};t.exportControlStates=function(){const t=this;return t.map?t.map.controls.map(function(t){return t.exportState()}).filter(function(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!0;return!1}):[]};t.importControlStates=function(t){const e=this;e.map&&t.forEach(function(t){const r=e.map.getControlById(t.id);r&&e.map.loaded(function(){r.importState(t)})})};t.exportState=function(){const t=this;if(t.exportsState){const r={};if(t.featureToShare||t.sharedFeaturesLayer){var e;r.id=t.id;if(t.featureToShare){const r=t.featureToShare.clone();r.showsPopup=!0;e=t.featureToShare.layer.exportState({features:[r]})}else e=t.sharedFeaturesLayer.exportState();r.features=e.features;e.crs&&(r.crs=e.crs)}return r}return null};t.importState=function(t){const e=this;e.map&&t.features.length&&e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then(function(r){e.sharedFeaturesLayer=r;r.importState({features:t.features,crs:t.crs}).then(function(){e.map.zoomToFeatures(r.features)})})};t.manageMaxLengthExceed=function(){throw"Falta implementaci\xf3n del m\xe9todo manageMaxLengthExceed"};t.generateLink=function(){var t=window.location.href,e=t.indexOf("#");e>0&&(t=t.substring(0,e));if(this.extraParams){var r=TC.Util.getQueryStringParams(t);TC.Util.extend(r,this.extraParams);var n=t.indexOf("?");n>=0&&(t=t.substring(0,n));t=t.concat("?",TC.Util.getParamString(r))}TC.Util.getParameterByName("lang").length>0&&(t=t.indexOf("&")>-1?t.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):t.replace("?lang="+TC.Util.getParameterByName("lang"),""));const i=this.includeControls?this.exportControlStates():[];this.exportsState&&(this.featureToShare||this.sharedFeaturesLayer)&&i.push(this.exportState());const o=i.length?{ctl:i}:void 0;var a=this.map.getMapState(o),s=t.concat("#",a);this.manageMaxLengthExceed({browser:s.length>TC.Consts.URL_MAX_LENGTH,qr:s.length>this.SHORTEN_URL_LENGTH});return s};t.shortenedLink=function(){const t=this;var e;return new Promise(function(r,n){const i=function(){t.map.toast(t.getLocaleString("urlTooLongForShortener"),{type:TC.Consts.msgType.ERROR});t.map.getLoadingIndicator().removeWait(e);r("")};var o=function(){var e=t.generateLink(),r=e.indexOf("?"),n=e.indexOf("#");r>0&&(e=r<n?e.replace(e.substring(r,n),""):e.replace(e.substring(r,e.length-1),""));return e}();if(o.length>t.QR_MAX_URL_LENGTH&&o.length<t.SHORTEN_URL_LENGTH){e=t.map.getLoadingIndicator().addWait();(function(t){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");var e=new FormData;e.append("url",t);return new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:e}).then(function(t){return t}).catch(function(t){return null})})(o).then(function(n){if(n&&n.responseText){t.map.getLoadingIndicator().removeWait(e);r(n.responseText.replace("http://","https://"))}else i()},i)}else{o.length>=t.SHORTEN_URL_LENGTH&&i();r("")}})};t.makeQRCode=function(t,e,r){const n=this;return new Promise(function(i,o){TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){n.shortenedLink().then(function(n){if((n=n||"").length>0){var o={text:n};if(e&&r){o.width=e;o.height=r}new MutationObserver(function(t,e){var r=t.filter(function(t){return"attributes"===t.type}).filter(function(t){return t.attributeName.indexOf("src")>-1});if(r.length>0){e.disconnect();i(r[0].target.src)}}).observe(t,{attributes:!0,childList:!0,subtree:!0});new QRCode(t,o)}else i()})})})};t.drawScaleBarIntoCanvas=function(t){var e,r=this.map.getControlsByClass(TC.control.ScaleBar);if(0==r.length)return null;var n=(e=(t=t||{}).canvas?t.canvas:document.createElement("CANVAS")).getContext("2d");n.save();var i,o,a=document.getElementsByClassName("ol-scale-line-inner").item(0),s=TC.Util.extend({},a.getBoundingClientRect()),l=a.textContent;n.beginPath();n.strokeStyle=window.getComputedStyle(a).borderColor;if(s.width>s.height){i=s.width;o=s.height}else{i=s.height;o=s.width}if(t.setSize){e.width=i;e.height=o}s.left=null!=t.left?t.left:15;s.top=null!=t.top?t.top:15;n.moveTo(s.left,s.top);n.lineTo(s.left,s.top+o);n.lineTo(s.left+i,s.top+o);n.lineTo(s.left+i,s.top);n.stroke();n.measureText(l);var c={x:s.left+i/2,y:s.top+o/2};t.fill&&function(e,n,i){var o=document.getElementsByClassName(r[0].CLASS).item(0),a=TC.Util.extend({},o.getBoundingClientRect());a.left=(t.left||15)-2;a.top=t.top||15;a.top--;e.globalAlpha=.5;e.fillStyle=window.getComputedStyle(o).backgroundColor;n+=4;i+=4;e.fillRect(a.left,a.top,n,i)}(n,i,o);n.globalAlpha=1;n.fillStyle=null!=t.textColor?t.textColor:window.getComputedStyle(a).color;n.font=null!=t.font?t.font:window.getComputedStyle(a).fontSize+" "+window.getComputedStyle(a).fontFamily;n.textAlign="center";n.textBaseline="middle";n.fillText(l,c.x,c.y);return e};t.registerListeners=function(){const t=this;if(!t.registeredListeners){t.map.on(TC.Consts.event.LAYERADD,t.generateLink.bind(t)).on(TC.Consts.event.LAYERREMOVE,t.generateLink.bind(t)).on(TC.Consts.event.FEATUREADD,t.generateLink.bind(t)).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,t.generateLink.bind(t));t.registeredListeners=!0}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var t=TC.control.TOC.prototype;t.CLASS="tc-ctl-toc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/TOC.html";t.template[t.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(e.get(["workLayers"],!1),e,{block:r},{}).w("</ul></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-toc-wlbranch",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:i},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:o},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node"')}n.__dustBody=!0;function i(t,e){return t.w(" checked")}i.__dustBody=!0;function o(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:i},{}).w('<input type="checkbox" name="toc" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["isVisible"],!1),e,{block:o},{}).w(" /><span>").f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-toc-branch">').s(e.get(["children"],!1),e,{block:a},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-toc-node"')}n.__dustBody=!0;function i(t,e){return t.w('<button class="tc-ctl-toc-collapse-btn"></button>')}i.__dustBody=!0;function o(t,e){return t.w(" checked")}o.__dustBody=!0;function a(t,e){return t.p("tc-ctl-toc-node",e,e.rebase(e.getPath(!0,[])),{})}a.__dustBody=!0;return e}}t.register=function(t){const e=this,r=TC.control.MapContents.prototype.register.call(e,t);t.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){e.onExternalServiceAdded(t)});return r};t.onExternalServiceAdded=function(t){const e=this;if(t&&t.layer){t.layer.map=e.map;e.map.addLayer(t.layer).then(function(r){e.updateLayerTree(t.layer)})}};t.addUIEventListeners=function(){const t=this;t.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const r=e.target;for(var n=r;n&&!n.matches("ul."+t.CLASS+"-wl");)n=n.parentElement;const i=[];for(var o=0,a=n.children.length;o<a;o++){child=n.children[o];"LI"===child.tagName&&i.push(child)}for(o=0,a=i.length;o<a;o++){const e=i[o];if(e.contains(r)){const n=t.map.getLayer(e.dataset.layerId);var s=r;do{s=s.parentElement}while(s&&"LI"!==s.tagName);const i=s.dataset.layerUid;n.setNodeVisibility(i,r.checked);break}}e.stopPropagation()}));t.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",function(e){e.target.blur();const r=e.target.parentElement;if(!r.classList.contains(t.CLASS+"-leaf")){r.classList.toggle(TC.Consts.classes.COLLAPSED);r.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED);e.stopPropagation()}}))};t.update=function(){var t=this,e=function(t){for(var e=0,r=t.children.length;e<r;e++){const r=t.children[e];if(r.matches("input[type=checkbox]"))return r}return null};t.getLayerUIElements().forEach(function(r){const n=t.map.getLayer(r.dataset.layerId);if(n){e(r).checked=n.getVisibility();n.tree=null;r.querySelectorAll("li").forEach(function(t){const r=e(t),i=t.dataset.layerUid;switch(n.getNodeVisibility(i)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:r.checked=!0;r.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:r.checked=!1;r.indeterminate=!0;break;default:r.checked=!1;r.indeterminate=!1}})}});t.updateScale()};t.updateScale=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);e.querySelectorAll("li").forEach(function(e){const n=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!r.isVisibleByScale(n))})})};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var r=e.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r,e.layerTrees[t.id],function(r,n){const i=(new DOMParser).parseFromString(n,"text/html").body.firstChild,o=i.dataset.layerUid,a=e.div.querySelector("."+e.CLASS+'-wl li[data-layer-uid="'+o+'"]');if(a){a.innerHTML=i.innerHTML;a.setAttribute("class",i.getAttribute("class"));a.dataset.layerId||(a.dataset.layerId=t.id)}else{i.dataset.layerId=t.id;const r=e.div.querySelector("."+e.CLASS+"-wl");r.insertBefore(i,r.firstChild)}r&&TC.error(r)});var n="ul."+e.CLASS+"-wl",i="ul."+e.CLASS+"-branch",o="li."+e.CLASS+"-node",a="li."+e.CLASS+"-leaf";e.div.querySelectorAll(n+" "+i+" "+i+","+n+" "+i+" "+o).forEach(function(t){t.matches(a)||t.classList.add(TC.Consts.classes.COLLAPSED)});e.update()})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(r){if(r.dataset.layerId===t.id){var n=!t.getVisibility();r.querySelectorAll("input[type=checkbox]").forEach(function(t){t.matches("."+e.CLASS+"-branch-cb")?t.checked=!n:t.disabled=n})}})};t.updateLayerOrder=function(t,e,r){};t.render=function(t){const e=this;return TC.Control.prototype.render.call(e,function(){var r=e.options.controls||[];if(r.length>0){var n=r[0],i=document.createElement("div");e.div.appendChild(i);e.map.addControl(n.name,TC.Util.extend({div:i},n.options))}TC.Util.isFunction(t)&&t()})};t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var r=0,n=e.length;r<n;r++){child=e[r];"LI"===child.tagName&&(t[t.length]=child)}return t}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(t){TC.control.TOC.apply(this,arguments);this.layers=[];this.queries=this.options.queries};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var t=TC.control.WorkLayerManager.prototype;t.CLASS="tc-ctl-wlm";t.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/WorkLayerManager.html";t.template[t.CLASS+"-elm"]=TC.apiLocation+"TC/templates/WorkLayerManagerElement.html";t.template[t.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipSingle.html";t.template[t.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroup.html";t.template[t.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroupNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="').h("i18n",e,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-wlm-empty">').h("i18n",e,{},{$key:"noData"}).w('</div><div class="tc-ctl-wlm-content tc-hidden"><form><ul>').s(e.get(["workLayers"],!1),e,{block:r},{}).w("</ul></form></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-elm",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-elm"]=function(){dust.register(t.CLASS+"-elm",e);function e(t,e){return t.w('<li class="tc-ctl-wlm-elm" tabindex="-1"><div class="tc-ctl-wlm-lyr">').x(e.get(["path"],!1),e,{block:r},{}).w('</div><div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="').s(e.get(["path"],!1),e,{else:n,block:i},{}).w('">').s(e.get(["path"],!1),e,{else:a,block:s},{}).w('</div><div class="tc-ctl-wlm-buttons"><div class="tc-ctl-wlm-btn-info" title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(e.get(["opacity"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(e.get(["hide"],!1),e,{block:c},{}).w(' title="').h("i18n",e,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-wlm-info tc-hidden">').x(e.get(["abstract"],!1),e,{block:u},{}).x(e.get(["customLegend"],!1),e,{else:h,block:f},{}).x(e.get(["metadata"],!1),e,{block:g},{}).w('</div><div class="tc-ctl-wlm-dd ').x(e.get(["hide"],!1),e,{block:m},{}).w('" title="').h("i18n",e,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-wlm-del ').x(e.get(["unremovable"],!1),e,{block:C},{}).w(" ").nx(e.get(["hide"],!1),e,{block:v},{}).w('" ').nx(e.get(["unremovable"],!1),e,{block:T},{}).w("></div></li>")}e.__dustBody=!0;function r(t,e){return t.f(e.get(["title"],!1),e,"h")}r.__dustBody=!0;function n(t,e){return t.f(e.get(["title"],!1),e,"h")}n.__dustBody=!0;function i(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:o},{})}i.__dustBody=!0;function o(t,e){return t.w(" &bull; ")}o.__dustBody=!0;function a(t,e){return t.f(e.get(["title"],!1),e,"h")}a.__dustBody=!0;function s(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:l},{})}s.__dustBody=!0;function l(t,e){return t.w(" &bull; ")}l.__dustBody=!0;function c(t,e){return t.w('checked="checked"')}c.__dustBody=!0;function u(t,e){return t.w('<div class="tc-ctl-wlm-abstract"><h4>').h("i18n",e,{},{$key:"abstract"}).w("</h4><div><pre>").f(e.get(["abstract"],!1),e,"h",["s"]).w("</pre></div></div>")}u.__dustBody=!0;function h(t,e){return t.x(e.get(["legend"],!1),e,{block:p},{})}h.__dustBody=!0;function p(t,e){return t.w('<div class="tc-ctl-wlm-legend" data-layer-name="').f(e.get(["layerNames"],!1),e,"h").w('"><h4>').h("i18n",e,{},{$key:"content"}).w("</h4>").s(e.get(["legend"],!1),e,{block:d},{}).w("</div>")}p.__dustBody=!0;function d(t,e){return t.w("<div><p>").f(e.get(["title"],!1),e,"h").w('</p><img data-img="').f(e.get(["src"],!1),e,"h").w('" /></div>')}d.__dustBody=!0;function f(t,e){return t.w('<ul class="tc-ctl-wlm-custom-legend">').f(e.get(["customLegend"],!1),e,"h",["s"]).w("</ul>")}f.__dustBody=!0;function g(t,e){return t.w('<div class="tc-ctl-wlm-metadata"><h4>').h("i18n",e,{},{$key:"metadata"}).w("</h4><ul>").s(e.get(["metadata"],!1),e,{block:y},{}).w("</ul></div>")}g.__dustBody=!0;function y(t,e){return t.w('<li><a href="').f(e.get(["url"],!1),e,"h",["s"]).w('" type="').f(e.get(["format"],!1),e,"h").w('" title="').f(e.get(["formatDescription"],!1),e,"h").w('" target="_blank">').f(e.get(["formatDescription"],!1),e,"h").w("</a></li>")}y.__dustBody=!0;function m(t,e){return t.w("tc-hidden")}m.__dustBody=!0;function C(t,e){return t.w("disabled")}C.__dustBody=!0;function v(t,e){return t.w("tc-hidden")}v.__dustBody=!0;function T(t,e){return t.w('title="').h("i18n",e,{},{$key:"removeLayerFromMap"}).w('"')}T.__dustBody=!0;return e};t.template[t.CLASS+"-type-sgl"]=function(){dust.register(t.CLASS+"-type-sgl",e);function e(t,e){return t.h("i18n",e,{},{$key:"singleLayer"})}e.__dustBody=!0;return e};t.template[t.CLASS+"-type-grp"]=function(){dust.register(t.CLASS+"-type-grp",e);function e(t,e){return t.w("<div>").h("i18n",e,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(e.get(["Layer"],!1),e,{block:r},{}).w("</ul>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-type-grp-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e};t.template[t.CLASS+"-type-grp-node"]=function(){dust.register(t.CLASS+"-type-grp-node",e);function e(t,e){return t.w('<li class="tc-ctl-wlm-tip-grp-elm"><span>').f(e.get(["Title"],!1),e,"h").w("</span><ul>").s(e.get(["Layer"],!1),e,{block:r},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-wlm-type-grp-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;return e}}const e=function(t,e){return t.getLayerUIElements().filter(function(t){return t.dataset.layerId===e.id})[0]};var r=function(t){return t.layers.length};const n=function(t){return!t.layers.some(function(t){return t.unremovable})},i=function(t,e,r,n,i){const o=t.getLayerUIElements();var a;if(n>r)a=o[n-1];else{if(!(n<r))return;a=o[n+1]}const s=t.map.getLayer(e.dataset.layerId),l=t.map.getLayer(a.dataset.layerId);for(var c=-1,u=0;u<t.map.layers.length;u++)if(l===t.map.layers[u]){c=u;break}c>=1&&c<t.map.layers.length&&t.map.insertLayer(s,c,i)};t.render=function(t,e){const r=this;return r._set1stRenderPromise(r.map?r.renderData(e?TC.Util.extend(r.map.getLayerTree(),e):r.map.getLayerTree(),function(){r.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){r.map.workLayers.filter(function(t){return!t.stealth}).forEach(function(t){r.updateLayerTree(t)});const e=r.div.querySelector("ul");r._sortable=Sortable.create(e,{handle:"."+r.CLASS+"-dd",animation:150,onSort:function(t){i(r,t.item,t.oldIndex,t.newIndex)}});e.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(t){for(var e=t.target;"LI"!==e.tagName;)if(!(e=e.parentElement))return;const n=function(t,n){const o=r._sortable.toArray(),a=o[t];o[t]=o[n];o[n]=a;r._sortable.sort(o);i(r,e,t,n)},o=r.getLayerUIElements(),a=o.indexOf(e);switch(!0){case/Up$/.test(t.key):if(a>0){n(a,a-1);e.focus();t.stopPropagation()}break;case/Down$/.test(t.key):if(a<o.length-1){n(a,a+1);e.focus();t.stopPropagation()}break;case/Enter$/.test(t.key):e.blur();t.stopPropagation()}}));"function"==typeof t&&t()})}):Promise.reject())};t.register=function(r){const n=this;return new Promise(function(i,o){TC.control.TOC.prototype.register.call(n,r).then(function(){r.loaded(function(){n.updateScale()});r.on(TC.Consts.event.LAYEROPACITY,function(t){const r=e(n,t.layer);r&&(r.querySelector("input[type=range]").value=Math.round(100*t.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(t){var e=t.fileName;if(t.features&&t.features.length>0){var i="."+TC.Consts.format.GPX.toLowerCase();if(t.fileName.toLowerCase().indexOf(i)===t.fileName.length-i.length)return;r.one(TC.Consts.event.LAYERADD,function(t){if(t&&t.layer&&t.layer.title==e){n.map&&n.map.layout&&n.map.layout.accordion&&n.div.classList.contains(TC.Consts.classes.COLLAPSED)&&n.map.controls.filter(function(t){return t!==n&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});n.map.trigger(TC.Consts.event.TOOLSOPEN);n.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});if(n.queries){TC.control.WFSQuery||TC.syncLoadJS(TC.apiLocation+"TC/Control/WFSQuery");t.queryControl=new TC.control.WFSQuery(null,n.queries instanceof Object?n.queries:null);n.map.addControl(t.queryControl)}i(n)})})};t.onExternalServiceAdded=function(t){};t.addUIEventListeners=function(){const t=this;t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&!n.matches("li."+t.CLASS+"-elm"));t.map.getLayer(n.dataset.layerId).setVisibility(r.checked);e.stopPropagation()}));const e=function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);t.map.getLayer(n.dataset.layerId).setOpacity(r.value/100)};t.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",e));t.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",e));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-del:not(.disabled)",function(e){var r=e.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=t.map.getLayer(r.dataset.layerId);t.map.removeLayer(n)}));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-del-all",function(e){TC.confirm(t.getLocaleString("layersRemove.confirm"),function(){t.getLayerUIElements().map(function(e){return t.map.getLayer(e.dataset.layerId)}).forEach(function(e){t.map.removeLayer(e)})})}));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-btn-info",function(e){const r=e.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const i=n.querySelector("."+t.CLASS+"-info"),o=t.map.getLayer(n.dataset.layerId);i.querySelectorAll("."+t.CLASS+"-legend img").forEach(function(e){t.styleLegendImage(e,o)});i.classList.toggle(TC.Consts.classes.HIDDEN);if(n.querySelector('input[type="checkbox"]').checked){n.querySelector("."+t.CLASS+"-dd").classList.toggle(TC.Consts.classes.HIDDEN,!i.classList.contains(TC.Consts.classes.HIDDEN))}r.classList.toggle(TC.Consts.classes.CHECKED)}));t.div.addEventListener(t.CLICKEVENT,TC.EventTarget.listenerBySelector("."+t.CLASS+"-btn-query",function(e){if(e.target.classList.contains("tc-unavailable")||e.target.classList.contains("tc-loading"))return;var r=e.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=t.map.getLayer(r.dataset.layerId);t.queryControl.renderModalDialog(n)}))};t.updateLayerVisibility=function(t){const r=this,n=e(r,t);if(n){const e=t.getVisibility();n.querySelector('input[type="checkbox"]').checked=e;const i=n.querySelector("."+r.CLASS+"-del"),o=n.querySelector("."+r.CLASS+"-info"),a=n.querySelector("."+r.CLASS+"-dd");if(e){i.classList.add(TC.Consts.classes.HIDDEN);o.classList.contains(TC.Consts.classes.HIDDEN)&&a.classList.remove(TC.Consts.classes.HIDDEN)}else{i.classList.remove(TC.Consts.classes.HIDDEN);o.classList.contains(TC.Consts.classes.HIDDEN)&&a.classList.add(TC.Consts.classes.HIDDEN)}}};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);for(var i=!1,a=0,s=e.layers.length;a<s;a++)if(t===e.layers[a]){i=!0;break}if(!i){var l=e.CLASS+"-elm";e.layers.push(t);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r,n=t.title||t.wrap.getServiceTitle(),i={title:t.options.hideTitle?"":n,hide:!(!t.renderOptions||!t.renderOptions.hide),opacity:t.renderOptions&&t.renderOptions.opacity?100*t.renderOptions.opacity:100,customLegend:t.customLegend,unremovable:t.unremovable},a=t.isRaster();if(a){i.layerNames=t.layerNames;var s=t.getPath();s.shift();i.path=s;var c=t.names[0],u=t.wrap.getInfo(c);i.legend=u.legend;i.abstract=u.abstract;var h,p=u.hasOwnProperty("abstract")||u.hasOwnProperty("legend")||u.hasOwnProperty("metadata");if(t.tree&&t.tree.children&&t.tree.children.length&&t.tree.children[0].children&&t.tree.children[0].children.length)h=null;else if(h=u.metadata)for(var d=0,f=h.length;d<f;d++){var g=h[d];g.formatDescription=e.getLocaleString(TC.Util.getSimpleMimeType(g.format))||e.getLocaleString("viewMetadata")}i.metadata=h;e.queries&&(r=o(t))}(function(t){return new Promise(function(e,r){t&&t.options.method&&"POST"===t.options.method?t.getLegendGraphicImage().then(function(t){e(t)}).catch(function(t){TC.error(t)}):e()})})(t).then(function(n){n&&(legend.src=n);dust.render(l,i,function(n,i){const o=(new DOMParser).parseFromString(i,"text/html").body.firstChild;var s,l=!1;if(a&&!(l=t.names.length>1))for(var u=t.wrap.getAllLayerNodes(),h=0;h<u.length;h++){var d=u[h];if(t.wrap.getName(d)===c){s=d;t.wrap.getLayerNodes(d).length>0&&(l=!0);break}}const f=o.querySelector("."+e.CLASS+"-type"),g=l?e.CLASS+"-type-grp":e.CLASS+"-type-sgl";f.classList.add(g);p||o.querySelector("."+e.CLASS+"-btn-info").classList.add(TC.Consts.classes.HIDDEN);if(s){t.wrap.normalizeLayerNode(s);dust.render(g,s,function(t,r){var n;f.addEventListener("mouseover",function(t){const i=e.map.div,o=f.getBoundingClientRect();(n=document.createElement("div")).classList.add(e.CLASS+"-tip");n.innerHTML=r;n.style.top=o.top-i.offsetTop+"px";n.style.right=i.offsetWidth-(o.left-i.offsetLeft)+"px";i.appendChild(n)});f.addEventListener("mouseout",function(t){n.parentElement.removeChild(n)})})}const y=e.div.querySelector("ul");o.dataset.layerId=t.id;const m=e.getLayerUIElements(),C=e.map.workLayers.filter(function(t){return!t.stealth}),v=C.indexOf(t);for(var T=!1,_=(h=0,m.length);h<_;h++){const t=m[h];if(C.indexOf(e.map.getLayer(t.dataset.layerId))<v){t.insertAdjacentElement("beforebegin",o);T=!0;break}}T||y.appendChild(o);r&&r(o);e.updateScale()})})});var c=r(e);const i=e.div.querySelector("."+e.CLASS+"-n"),a=e.div.querySelector("."+e.CLASS+"-empty"),s=e.div.querySelector("."+e.CLASS+"-content");i.textContent=c;if(c>0){i.classList.add(TC.Consts.classes.VISIBLE);a.classList.add(TC.Consts.classes.HIDDEN);s.classList.remove(TC.Consts.classes.HIDDEN)}else{i.classList.remove(TC.Consts.classes.VISIBLE);a.classList.remove(TC.Consts.classes.HIDDEN);s.classList.add(TC.Consts.classes.HIDDEN)}e.div.querySelector("."+e.CLASS+"-del-all").classList.toggle(TC.Consts.classes.HIDDEN,!n(e))}}};t.updateScale=function(){var t=this;t.getLayerUIElements().forEach(function(e){var r=t.map.getLayer(e.dataset.layerId);if(r.names){for(var n=!1,i=0;i<r.names.length;i++)if(r.isVisibleByScale(r.names[i])){n=!0;break}e.classList.toggle(t.CLASS+"-elm-notvisible",!n)}})};t.updateLayerOrder=function(t,r,n){const i=this;i.map.workLayers.filter(function(t){return!t.stealth}).forEach(function(t){const r=e(i,t);r&&r.parentElement.firstChild.insertAdjacentElement("beforebegin",r)})};t.removeLayer=function(t){var e=this.layers.indexOf(t);e>=0&&this.layers.splice(e,1);this.getLayerUIElements().forEach(function(e){e.dataset.layerId===t.id&&e.parentElement.removeChild(e)});const i=this.div.querySelector("."+this.CLASS+"-content"),o=this.div.querySelector("."+this.CLASS+"-empty"),a=this.div.querySelector("."+this.CLASS+"-n");var s=r(this);a.textContent=s;if(s>0){i.classList.remove(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.VISIBLE)}else{n(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);i.classList.add(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.VISIBLE)}};t.getLayerUIElements=function(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))};const o=function(e){var r,n=null,i=new Promise(function(t,e){n=t});i.then(function(e){(r=document.createElement("div")).classList.add(t.CLASS+"-btn-query");r.classList.add(TC.Consts.classes.LOADING);r.setAttribute("title",t.getLocaleString("query.tooltipMagnifBtn"));e.querySelector("."+t.CLASS+"-btn-info").insertAdjacentElement("afterend",r)});var o=e.getWFSCapabilitiesPromise();const a=function(){if(r){r.classList.remove(TC.Consts.classes.LOADING);r.classList.add("tc-unavailable")}console.log("El servicio "+(e.title||e.tree.title)+" no tiene disponible el WFS")};Promise.all([o,i]).then(function(){var t=arguments[0][0];if(r){r.classList.remove(TC.Consts.classes.LOADING);var n=e.getDisgregatedLayerNames();if(1===n.length&&!t.FeatureTypes.hasOwnProperty(n[0].substring(n[0].indexOf(":")+1))){r.classList.add("tc-unavailable");console.log("El servicio WFS de "+(e.title||e.tree.title)+" no dispone de la capa "+n[0])}}}).catch(a);o.catch(a);return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){TC.Control.apply(this,arguments);this.options&&this.options.callback&&(this.callback=this.options.callback);this.wrap=new TC.wrap.control.Click(this)};TC.inherit(TC.control.Click,TC.Control);!function(){var t=TC.control.Click.prototype;t.CLASS="tc-ctl-click";t.register=function(t){this.wrap.register(t);return TC.Control.prototype.register.call(this,t)};t.activate=function(){TC.Control.prototype.activate.call(this);this.wrap.activate()};t.deactivate=function(){this.wrap.deactivate();TC.Control.prototype.deactivate.call(this)};t.callback=function(t,e){console.log("[Click]["+t[0]+", "+t[1]+"]["+e[0]+", "+e[1]+"]")}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);const t=this._classSelector="."+this.CLASS;this._selectors={LIST_ITEM:"ul"+t+"-features li"};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var t=TC.control.FeatureInfoCommons.prototype;t.CLASS="tc-ctl-finfo";t.TITLE_SEPARATOR=" \u2022 ";TC.isDebug?t.template=TC.apiLocation+"TC/templates/FeatureInfo.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.x(e.get(["displayElevation"],!1),e,{block:r},{}).w('<ul class="tc-ctl-finfo-services">').s(e.get(["services"],!1),e,{else:o,block:s},{}).w("</ul>").x(e.get(["featureCount"],!1),e,{block:I},{})}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(e.get(["crs"],!1),e,"h").w("</span></span> ").x(e.get(["isGeo"],!1),e,{else:n,block:i},{}).w(' <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-elev">').h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val"></span></span></div>')}r.__dustBody=!0;function n(t,e){return t.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","0"]),e,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","1"]),e,"h").w("</span></span> ")}n.__dustBody=!0;function i(t,e){return t.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","1"]),e,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(e.getPath(!1,["coords","0"]),e,"h").w("</span></span> ")}i.__dustBody=!0;function o(t,e){return t.nx(e.get(["displayElevation"],!1),e,{block:a},{})}o.__dustBody=!0;function a(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noData"}).w("</li>")}a.__dustBody=!0;function s(t,e){return t.w("<li><h3>").x(e.get(["title"],!1),e,{else:l,block:h},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(e.get(["hasLimits"],!1),e,{else:p,block:R},{}).w("</div></li>")}s.__dustBody=!0;function l(t,e){return t.x(e.getPath(!1,["layers","0","title"]),e,{else:c,block:u},{})}l.__dustBody=!0;function c(t,e){return t.f(e.getPath(!1,["layer","name"]),e,"h")}c.__dustBody=!0;function u(t,e){return t.f(e.getPath(!1,["layers","0","title"]),e,"h")}u.__dustBody=!0;function h(t,e){return t.f(e.get(["title"],!1),e,"h")}h.__dustBody=!0;function p(t,e){return t.w('<ul class="tc-ctl-finfo-layers">').s(e.get(["layers"],!1),e,{else:d,block:f},{}).w("</ul>")}p.__dustBody=!0;function d(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noDataAtThisService"}).w("</li>")}d.__dustBody=!0;function f(t,e){return t.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(e.getPath(!1,["features","length"]),e,"h").w("</span> ").s(e.get(["path"],!1),e,{block:g},{}).w('</h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(e.get(["features"],!1),e,{else:m,block:C},{}).w("</ul></div></li>")}f.__dustBody=!0;function g(t,e){return t.f(e.getPath(!0,[]),e,"h").h("sep",e,{block:y},{})}g.__dustBody=!0;function y(t,e){return t.w(" &bull; ")}y.__dustBody=!0;function m(t,e){return t.w('<li class="tc-ctl-finfo-empty">').h("i18n",e,{},{$key:"noDataInThisLayer"}).w("</li>")}m.__dustBody=!0;function C(t,e){return t.w("<li>").x(e.get(["rawContent"],!1),e,{else:v,block:L},{}).w("</li>")}C.__dustBody=!0;function v(t,e){return t.x(e.get(["error"],!1),e,{else:T,block:E},{})}v.__dustBody=!0;function T(t,e){return t.w("<h5>").f(e.get(["id"],!1),e,"h").w("</h5><table").x(e.get(["geometry"],!1),e,{block:_},{}).w("><tbody>").s(e.get(["attributes"],!1),e,{block:S},{}).w("</tbody></table>")}T.__dustBody=!0;function _(t,e){return t.w(' title="').h("i18n",e,{},{$key:"clickToShowOnMap"}).w('"')}_.__dustBody=!0;function S(t,e){return t.w('<tr><th class="tc-ctl-finfo-attr">').f(e.get(["name"],!1),e,"h").w('</th><td class="tc-ctl-finfo-val">').f(e.get(["value"],!1),e,"h").w("</td></tr>")}S.__dustBody=!0;function E(t,e){return t.w('<span class="tc-ctl-finfo-errors">').h("i18n",e,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(e.get(["error"],!1),e,"h").w("</span></span>")}E.__dustBody=!0;function L(t,e){return t.w("<h5>").h("i18n",e,{},{$key:"feature"}).w("</h5>").h("eq",e,{else:w,block:b},{key:e.get(["rawFormat"],!1),value:"text/html"})}L.__dustBody=!0;function w(t,e){return t.w("<pre>").f(e.get(["rawContent"],!1),e,"h").w("</pre>")}w.__dustBody=!0;function b(t,e){return t.w(" ").x(e.get(["expandUrl"],!1),e,{block:A},{})}b.__dustBody=!0;function A(t,e){return t.h("ne",e,{else:x,block:P},{key:e.get(["expandUrl"],!1),value:""})}A.__dustBody=!0;function x(t,e){return t.w('<iframe src="').f(e.get(["rawUrl"],!1),e,"h").w('"></iframe>')}x.__dustBody=!0;function P(t,e){return t.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(e.get(["rawUrl"],!1),e,"h").w('"></iframe><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(e.get(["expandUrl"],!1),e,"h").w("', '_blank')\" title=\"").h("i18n",e,{},{$key:"expand"}).w('"></a></div>')}P.__dustBody=!0;function R(t,e){return t.w('<span class="tc-ctl-finfo-errors">').f(e.get(["hasLimits"],!1),e,"h").w("</span>")}R.__dustBody=!0;function I(t,e){return t.h("gt",e,{block:M},{key:e.get(["featureCount"],!1),value:"1",type:"number"})}I.__dustBody=!0;function M(t,e){return t.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",e,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(e.get(["featureCount"],!1),e,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",e,{},{$key:"next"}).w("</a>")}M.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.control.Click.prototype.register.call(e,t);e._createLayers();t.loaded(function(){const r=t.getControlsByClass("TC.control.Share")[0];r&&e.loadSharedFeature(r.loadParamFeature())});e.displayMode=e.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;e.setDisplayMode(e.displayMode);t.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===e.getDisplayControl()&&e.resultsLayer){if(e.highlightedFeature){e.resultsLayer.removeFeature(e.highlightedFeature);e.highlightedFeature=null}!e.querying&&t.feature&&e.filterLayer.removeFeature(t.feature)}}).on(TC.Consts.event.RESULTSPANELCLOSE,function(t){e.highlightedFeature=null}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(t){const r=t.control;r.currentFeature!==e.filterFeature&&(e.highlightedFeature=r.currentFeature);t.control.currentFeature&&t.control.currentFeature.layer&&e.filterLayer&&e.resultsLayer&&[e.filterLayer.id,e.resultsLayer.id].indexOf(t.control.currentFeature.layer.id)>-1&&e._decorateDisplay(r)}).on(TC.Consts.event.DRAWCHART,function(t){setTimeout(function(){e.highlightedFeature=t.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(e.info&&e.info.services){const n={};e.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS}).forEach(function(t){const e=n[t.url]||[];n[t.url]=e.concat(t.getDisgregatedLayerNames())});for(var t=0,r=e.info.services.length;t<r;t++){const r=e.info.services[t],i=n[r.mapLayers[0].url]||[];if(!r.layers.reduce(function(t,e){return t.concat(e.name)},[]).every(function(t){return i.indexOf(t)>=0})){e.downplayFeatures();e.info=null;e.closeResults();break}}}}).on(TC.Consts.event.VIEWCHANGE,function(t){e.closeResults()});return r};t.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};t.responseCallback=function(t){const e=this;e.querying=!1;e.filterFeature&&(e.info={services:t.services});if(t.featureCount){e._addSourceAttributes();e.lastFeatureCount=t.featureCount;e.map.trigger(TC.Consts.event.FEATUREINFO,TC.Util.extend({control:e},t))}else{e.lastFeatureCount=0;e.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:e});e.closeResults()}};t.responseError=function(t){const e=this;404===t.status&&e.map.toast(e.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});e.responseCallback({})};t.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};t.setDisplayMode=function(t){var e=this;e.displayMode=t;var r=e.map;switch(t){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!e.resultsPanel){var n=r.getControlsByClass("TC.control.ResultsPanel").filter(function(t){return"table"===t.options.content})[0];if(n){e.resultsPanel=n;n.caller=e}else{r.on(TC.Consts.event.CONTROLADD,function t(n){const i=n.control;if(TC.control.ResultsPanel&&i instanceof TC.control.ResultsPanel){e.resultsPanel=i;i.caller=e;r.off(TC.Consts.event.CONTROLADD,t)}})}}break;default:e.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;e.popup||r.addControl("popup",{closeButton:!0,draggable:e.options.draggable}).then(function(t){e.popup=t;t.caller=e;r.on(TC.Consts.event.POPUP,function(t){e.onShowPopup(t)});r.on(TC.Consts.event.POPUPHIDE,function(r){r.control===t&&e._resetSize()})})}};t.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};t.getDisplayTarget=function(t){if((t=t||{}).control)switch(!0){case TC.control.Popup&&t.control instanceof TC.control.Popup:return t.control.getContainerElement();case TC.control.ResultsPanel&&t.control instanceof TC.control.ResultsPanel:return t.control.getTableContainer();default:return null}switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getTableContainer();default:return this.popup.getContainerElement()}};t.getMenuTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};t.displayResults=function(){var t=this;const e=t.div.cloneNode(!0);e.classList.remove(TC.Consts.classes.HIDDEN);t.filterFeature.data=e.outerHTML;switch(t.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(t.resultsPanel){if(0===t.map.getControlsByClass(TC.control.ControlContainer).length)t.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(t){t.isVisible()&&t.close()});else{t.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(e){e!==t.resultsPanel&&e.currentFeature&&e.close()})}t.resultsPanel.currentFeature=t.filterFeature;t.resultsPanel.open(t.filterFeature.data,t.resultsPanel.getInfoContainer());t.displayResultsCallback()}break;default:t.popup&&t.filterFeature.showPopup(t.popup)}};const e=function(t){return Array.from(t.parentElement.childNodes).indexOf(t)},r=function(t,e){var r=t;do{r=r.parentElement}while(r&&r.tagName!==e);return r};t.getFeatureElement=function(t){const n=this;var i;n.getDisplayTarget().querySelectorAll(n._selectors.LIST_ITEM).forEach(function(o){const a=o,s=r(o,"LI"),l=r(s,"LI");n.getFeature(e(l),e(s),e(a))===t&&(i=a)});return i};t.getNextFeatureElement=function(t){const e=this.getDisplayTarget().querySelectorAll("ul."+this.CLASS+"-features > li"),r=e.length;for(var n=0;n<r;n++)if(e[n].matches("."+TC.Consts.classes.CHECKED))return e[(n+t+r)%r];return null};t.getFeaturePath=function(t){const e=this;if(e.info&&e.info.services)for(var r=0,n=e.info.services.length;r<n;r++){const n=e.info.services[r];for(var i=0,o=n.layers.length;i<o;i++){const e=n.layers[i];for(var a=0,s=e.features.length;a<s;a++)if(e.features[a]===t)return{service:n.title||n.mapLayers.reduce(function(t,e){return t||e.title},""),layer:e.path}}}return null};t.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};t.displayResultsCallback=function(){var t=this;const e=t.getDisplayTarget().querySelector("."+t.CLASS);var n,i,o="click";e.addEventListener(o,TC.EventTarget.listenerBySelector(t._selectors.LIST_ITEM,function(e){t.highlightFeature(e.target)}));o=TC.Consts.event.CLICK;n="."+t.CLASS+"-btn-next";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.highlightFeature(t.getNextFeatureElement(1),1);return!1}));n="."+t.CLASS+"-btn-prev";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.highlightFeature(t.getNextFeatureElement(-1),-1);return!1}));n="ul."+t.CLASS+"-layers h4";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(n){const i=r(n.target,"LI");if(i.classList.contains(TC.Consts.classes.CHECKED)){const r=e.querySelector(".tc-ctl-finfo-layers li:not(.tc-checked)");r&&"none"!==getComputedStyle(r).display&&t.downplayFeatures()}else{t.highlightFeature(i.querySelector(t._selectors.LIST_ITEM));t.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&t.popup.fitToView(!0)}}));n="."+t.CLASS+"-del-btn";e.addEventListener(o,TC.EventTarget.listenerBySelector(n,function(e){t.downplayFeatures();t.closeResults()}));if(t.info)if(t.info.defaultFeature&&t.getFeatureElement(t.info.defaultFeature)){t.getFeatureElement(t.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);t.highlightFeature(t.info.defaultFeature)}else e.querySelector(t._selectors.LIST_ITEM)&&t.highlightFeature(e.querySelector(t._selectors.LIST_ITEM));e.querySelectorAll("table").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){const r=this.parentElement;if(!r.classList.contains(TC.Consts.classes.DISABLED)){if(r.classList.contains(TC.Consts.classes.CHECKED)){if(t.resultsLayer.features[0]&&window.getSelection()&&0===window.getSelection().toString().trim().length){t.map.on(TC.Consts.event.ZOOM,function e(){t._zooming=!1;t.map.off(TC.Consts.event.ZOOM,e)});t._zooming=!0;t.map.zoomToFeatures([t.resultsLayer.features[0]],{animate:!0})}}else t.highlightFeature(r);e.stopPropagation()}})});e.querySelectorAll("table a").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation()})});if(TC.browserFeatures.touch()&&t.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&"none"!==e.querySelector("."+t.CLASS+"-btn-prev").style.display){t.resultsPanel&&TC.Util.swipe(t.resultsPanel.div,"disable");((i=t).info.services?i.info.services.reduce(function(t,e){return t+e.layers.reduce(function(t,e){return t+1},0)},0):0)>1&&TC.Util.swipe(e,{left:function(){t.highlightFeature(t.getNextFeatureElement(1),1)},right:function(){t.highlightFeature(t.getNextFeatureElement(-1),-1)}})}};t.onShowPopup=function(t){const e=this;if(t.control===e.popup){e.displayResultsCallback();e._fitSize()}};t.loadSharedFeature=function(t){};t.insertLinks=function(){const t=this.getLocaleString("open"),e=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(r){const n=r.textContent;TC.Util.isURL(n)&&(r.innerHTML='<a href="'+n+'" target="_blank" title="'+e+'">'+t+"</a>")})};t.highlightFeature=function(t,n){const i=this;var o;if(!i._zooming){var a;if(t instanceof TC.Feature){o=t;a=i.getFeatureElement(o)}else{a=t;for(;a&&"LI"!==a.tagName;)a=a.parentElement}const u=r(a,"LI"),h=r(u,"LI"),p=e(h),d=e(u),f=e(a);o=o||i.getFeature(p,d,f);i.downplayFeatures({exception:o});a.classList.add(TC.Consts.classes.CHECKED);u.classList.add(TC.Consts.classes.CHECKED);h.classList.add(TC.Consts.classes.CHECKED);if(n>0){a.classList.add(TC.Consts.classes.FROMLEFT);u.classList.add(TC.Consts.classes.FROMLEFT);h.classList.add(TC.Consts.classes.FROMLEFT)}else if(n<0){a.classList.add(TC.Consts.classes.FROMRIGHT);u.classList.add(TC.Consts.classes.FROMRIGHT);h.classList.add(TC.Consts.classes.FROMRIGHT)}a.querySelector("table")&&a.querySelector("table").setAttribute("title",i.getLocaleString("clickToCenter"));i.highlightedFeature=o;i.getDisplayTarget().querySelector("."+i.CLASS+"-counter-current")&&(i.getDisplayTarget().querySelector("."+i.CLASS+"-counter-current").innerHTML=i.getFeatureIndex(p,d,f)+1);var s=i.resultsLayer.features.slice();if(s.filter(function(t){return o&&o.id===t.id}).length>0)return;for(var l=0;l<s.length;l++){var c=s[l];c!==i.filterFeature&&i.resultsLayer.removeFeature(c)}o&&o.geometry?i.resultsLayer.addFeature(o):a.classList.add(TC.Consts.classes.DISABLED)}};t.downplayFeatures=function(t){const e=this;t=t||{};e.highlightedFeature!==t.exception&&(e.highlightedFeature=null);const n=t.exception?e.getFeatureElement(t.exception):void 0;var i,o;if(n){i=r(n,"LI");o=r(i,"LI")}e.resultsLayer.clearFeatures();const a=e.getDisplayTarget();Array.from(a.querySelectorAll("ul."+e.CLASS+"-services li")).filter(function(t){return t!==n&&t!==i&&t!==o}).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED,TC.Consts.classes.DISABLED,TC.Consts.classes.FROMLEFT,TC.Consts.classes.FROMRIGHT)});a.querySelectorAll("."+e.CLASS+"-features table").forEach(function(t){t.setAttribute("title",e.getLocaleString("clickToShowOnMap"))})};t._fitSize=function(){const t=this.getDisplayTarget();var e=0;t.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(t){e=Math.max(e,t.offsetLeft+t.offsetWidth)});e&&(t.style.width=e+50+"px")};t._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};t.getFeature=function(t,e,r){var n;const i=this.info;i&&i.services&&(n=i.services[t])&&(n=n.layers[e])&&(n=n.features[r]);return n};t.getFeatureIndex=function(t,e,r){var n=-1;const i=this.info;if(i)for(var o=0;o<=t;o++)for(var a=i.services[o],s=o===t?e:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===e?r:c.features.length-1,h=0;h<=u;h++)n+=1;return n};t.beforeRequest=function(t){var e=this;e.querying=!0;e.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:t.xy,control:e});e.closeResults();if(e.map&&e.resultsLayer){e.lastFeatureCount=null;e.resultsLayer.features.forEach(function(t){e.resultsLayer.removeFeature(t)});e.info=null}};t.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};t.deactivate=function(t){this.popup&&this.popup.hide();this.resultsLayer.clearFeatures();this.filterLayer.clearFeatures();this.filterFeature=null;this.wrap&&this.wrap.deactivate();TC.Control.prototype.deactivate.call(this,t)};t.exportState=function(){const t=this;return t.exportsState&&t.resultsLayer?{id:t.id,layer:t.resultsLayer.exportState()}:null};t.importState=function(t){const e=this;e._layersPromise.then(function(){e.resultsLayer.importState(t.layer)})};t._createLayers=function(){const t=this;var e,r;e=t.options.resultsLayer?t.options.resultsLayer:{id:t.getUID(),title:t.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};r=t.options.filterLayer?t.options.filterLayer:{id:t.getUID(),title:t.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:t.lineColor,strokeWidth:2},polygon:{strokeColor:t.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};const n=t.map;t._layersPromise=new Promise(function(i,o){n.loaded(function(){Promise.all([n.addLayer(e),n.addLayer(r)]).then(function(e){t.resultsLayer=e[0];t.filterLayer=e[1];i()})})});return t._layersPromise};t._decorateDisplay=function(t){const e=this,r=e.getDisplayTarget({control:t});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!r.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var n=e.getLocaleString("feature");if(t===e.getDisplayControl())if(TC.feature.Point&&e.filterFeature instanceof TC.feature.Point){const t=e.filterFeature.geometry;n=e.getLocaleString("featuresAt",{crs:e.map.crs,x:TC.Util.formatNumber(t[0],e.map.locale),y:TC.Util.formatNumber(t[1],e.map.locale)})}else n=e.getLocaleString("spatialQueryResults");else t.currentFeature&&(n=t.currentFeature.id);(e.lastFeatureCount||t.currentFeature&&!0===t.currentFeature.showsPopup)&&new TC.control.Print({target:r,title:n})}})};t._addSourceAttributes=function(){const t=this,e="h3_"+t.getLocaleString("service"),r="h4_"+t.getLocaleString("layer");t.info&&t.info.services&&t.info.services.forEach(function(n){n.layers.forEach(function(n){n.features.forEach(function(n){if(n instanceof TC.Feature){const i=t.getFeaturePath(n);if(i){const o={};o[e]=i.service;i.layer&&(o[r]=i.layer.join(t.TITLE_SEPARATOR));const a=TC.Util.extend(o,n.getData());n.clearData();n.setData(a)}}})})})}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var t=TC.control.Scale.prototype;t.CLASS="tc-ctl-scl";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Scale.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",e,{},{key:r,method:"round"}).w('</span> <input type="button" value="').f(e.get(["screenSize"],!1),e,"h").w("''\" title=\"").h("i18n",e,{},{$key:"estimatedMapSize"}).w('" /></div>')}e.__dustBody=!0;function r(t,e){return t.f(e.get(["scale"],!1),e,"h")}r.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({scale:e.getScale(),screenSize:TC.Cfg.screenSize},function(){const r=e.div.querySelector("span");r.textContent="1:"+e.format(r.textContent.substr(2));e.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){e.setScreenSize()});TC.Util.isFunction(t)&&t()}))};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);var n=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);n&&(TC.Cfg.screenSize=n);e.render(function(){t.on(TC.Consts.event.ZOOM,function(){delete e.metersPerDegree;e.update()})});return r};t.update=function(){this.render()};t.setScreenSize=function(){var t=this;TC.prompt(t.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(e){if(e){TC.Cfg.screenSize=parseFloat(e);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);t.update()}})};t.getScale=function(t){var e=0,r=!t&&this.map?this.map.wrap.getResolution():t;if(r){e=r*this.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(e*=window.devicePixelRatio)}if(this.map&&this.map.wrap.isGeo()){if(!this.metersPerDegree){var n=this.map.getExtent();n&&(this.metersPerDegree=TC.Util.getMetersPerDegree(n))}this.metersPerDegree&&(e*=this.metersPerDegree)}return e};t.getDpi=function(t){this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/t;return this.dpi};t.format=function(t){for(var e=new Number(t).toFixed(0),r=[];e.length>3;){var n=e.length-3;r.unshift(e.substr(n));e=e.substr(0,n)}e&&r.unshift(e);return r.join(".")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){TC.Control.apply(this,arguments);this.serviceWorkerEnabled=!1};TC.inherit(TC.control.SWCacheClient,TC.Control);var t=TC.control.SWCacheClient.prototype;t.CLASS="tc-ctl-swcc";t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e._swPromise=new Promise(function(t,r){navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(r){e.serviceWorkerEnabled=!0;r.installing?t(r.installing):r.waiting?t(r.waiting):r.active&&t(r.active);console.log(r.scope,"register")},function(t){e.serviceWorkerEnabled=!1;r();console.error("Could not register service worker: "+t)}):r(new Error("Browser does not support service workers"))});return r};t.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var e=function(t,e,r,n,i){navigator.serviceWorker.addEventListener("message",function o(a){if(a.data.name===r){a.data.action===n&&a.data.event===i?t(r):"error"===a.data.event&&e();navigator.serviceWorker.removeEventListener("message",o)}})};t.createCache=function(t,r){var n=this;return new Promise(function(i,o){n.getServiceWorker().then(function(n){var a=r||{};e(i,o,t,"create","cached");n.postMessage({action:"create",name:t,list:a.urlList||[],silent:a.silent})},function(){i(!1)})})};t.deleteCache=function(t,r){var n=this;return new Promise(function(i,o){n.getServiceWorker().then(function(n){var a=r||{};e(i,o,t,"delete","deleted");n.postMessage({action:"delete",name:t,silent:a.silent})},function(){i(!1)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var t=this;TC.Control.apply(t,arguments);t.drawControls=[];t.persistentDrawControls=!1;t.NOMEASURE="-";t.exportsState=!0;this.renderPromise().then(function(){t.measureMode=t.options.mode;t.history=[];t.historyIndex=0;t.reset=!0;t.wrap=new TC.wrap.control.Measure(t);t._len=t.div.querySelector(".tc-ctl-meas-val-len");t._area=t.div.querySelector(".tc-ctl-meas-val-area");t._peri=t.div.querySelector(".tc-ctl-meas-val-peri");t.setMode(t.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var t=TC.control.Measure.prototype;t.CLASS="tc-ctl-meas";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Measure.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",e,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",e,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",e,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}e.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(TC.Control.prototype.render.call(e,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){e.options.mode&&e.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(`.${TC.control.Measure.prototype.CLASS}-select span`).forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var r=this;r&&"LABEL"!==r.tagName;)r=r.parentElement;var n=r.querySelector("input[type=radio][name=mode]"),i=n.value;n.checked=!0;e.setMode(i,!0)})});TC.Util.isFunction(t)&&t()})}))};t.register=function(t){const e=this;return new Promise(function(r,n){TC.Control.prototype.register.call(e,t).then(function(){e.map.on(TC.Consts.event.VIEWCHANGE,function(){e.map.view===TC.Consts.view.PRINTING&&e.trigger(TC.Consts.event.DRAWEND)});const i=e.getUID(),o=e.getUID(),a=e.getUID();e.layerPromise=t.addLayer({id:i,title:e.getLocaleString("measure"),stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:t.options.styles.point,line:t.options.styles.line,polygon:t.options.styles.polygon}});Promise.all([e.layerPromise,e.renderPromise()]).then(function(i){const s=i[0];e.layer=s;e.layer.map.putLayerOnTop(e.layer);e._drawLinesPromise=t.addControl("draw",{id:o,div:e.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:e.persistentDrawControls,styleTools:e.persistentDrawControls,layer:e.layer});e._drawPolygonsPromise=t.addControl("draw",{id:a,div:e.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:e.persistentDrawControls,styleTools:e.persistentDrawControls,layer:e.layer});Promise.all([e._drawLinesPromise,e._drawPolygonsPromise]).then(function(t){e.drawLines=t[0];e.drawPolygons=t[1];t.forEach(function(t){t.containerControl=e;e.drawControls.push(t);t.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e.showMeasures(t)}).on(TC.Consts.event.DRAWCANCEL,function(t){setTimeout(function(){e.cancel()},100)});t.exportsState=!1});r(e);e.setMode(e.options.mode)}).catch(n)}).catch(n)})})};t.displayMode=function(t){const e=this,r=[];e.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(t){r.push(t)});switch(t){case TC.Consts.geom.POLYLINE:e._activeMode=r.filter(function(t){return t.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:e._activeMode=r.filter(function(t){return t.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:e._activeMode=null}const n=r.filter(function(t){return t!==e._activeMode});if(t){e.div.querySelector("input[type=radio][name=mode][value="+t+"]").checked=!0}else e.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(t){t.checked=!1});if(e._activeMode){e._activeMode.classList.remove(TC.Consts.classes.HIDDEN);e._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}n.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});return e};t.setMode=function(t){const e=this;e.mode=t;e.displayMode(t);var r;switch(t){case TC.Consts.geom.POLYLINE:e.drawLines.activate();r=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:e.drawPolygons.activate();r=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:e.drawControls.forEach(function(t){t.isActive&&t.cancel()});r=TC.Consts.event.CONTROLDEACTIVATE;break;default:r=TC.Consts.event.CONTROLACTIVATE}e.resetValues();r&&e.map&&e.map.trigger(r,{control:e});return e};t.cancel=function(){this.setMode(null,!1);return this};t.showMeasures=function(t){const e=this;var r,n=(t=t||{}).units;const i=e.map.options.locale||TC.Cfg.locale;if(t.area){var o=t.area;if(o>1e4){o/=1e6;n="km"}r="m"===n?0:3;e._area.innerHTML=TC.Util.formatNumber(o.toFixed(r),i)+" "+n+"&sup2;"}if(t.perimeter){var a=t.perimeter;if(a>1e3){a/=1e3;n="km"}r="m"===n?0:3;e._peri.innerHTML=TC.Util.formatNumber(a.toFixed(r),i)+" "+n}if(t.length){var s=t.length;if(s>1e3){s/=1e3;n="km"}r="m"===n?0:3;e._len.innerHTML=TC.Util.formatNumber(s.toFixed(r),i)+" "+n}return e};t.resetValues=function(){const t=this;if(t._len){t._len.textContent=t.NOMEASURE;t._area.textContent=t.NOMEASURE;t._peri.textContent=t.NOMEASURE}return t};t.getDrawLines=function(){};t.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null};t.importState=function(t){this.layerPromise.then(function(e){e.importState(t.layer)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const t=this;TC.Control.apply(t,arguments);t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code",CHANGE:t.CLASS+"-change",NO_CHANGE:t.CLASS+"-no-change"};t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+t._cssClasses.LOAD_CRS_BUTTON+")",function(e){const r=e.target.dataset.crsCode;r&&t.setProjection({crs:r,allowFallbackLayer:!0})}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+t._cssClasses.LOAD_CRS_BUTTON,function(e){t.loadFallbackProjections()}))};TC.inherit(TC.control.ProjectionSelector,TC.Control);const t=TC.control.ProjectionSelector.prototype;t.CLASS="tc-ctl-projs";t.render=function(t){const e=this,r=TC.Control.prototype.render.call(e,t);e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t});return r};t.getAvailableCRS=function(t){return this.map.getCompatibleCRS(TC.Util.extend(t||{},{includeFallbacks:!0}))};t.showProjectionChangeDialog=function(t){const e=this,r=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG),n=r.querySelector(".tc-modal-body");n.classList.add(TC.Consts.classes.LOADING);const i=n.querySelector("ul."+e._cssClasses.CRS_LIST);i.innerHTML="";const o=e.map.baseLayer.firstOption||e.map.baseLayer,a=o.isRaster()?o.getFallbackLayer():null,s=function(){var a=[],s=[];t=t||{};if(o.isRaster()){s=o.getCompatibleCRS();a=e.getAvailableCRS(TC.Util.extend(t,{}))}else{s=e.map.baseLayers.filter(t=>t.isRaster()).map(t=>t.getCompatibleCRS({normalized:!0,includeFallback:!0})).reduce((t,e,r,n)=>t.concat(e.filter(e=>t.indexOf(e)<0)));const r=(t.layer?e.map.workLayers.concat(t.layer):e.map.workLayers).filter(function(t){return t.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:!0})});a=s.filter(t=>r.every(e=>e.indexOf(t)>-1))}e.map.loadProjections({crsList:a,orderBy:"name"}).then(function(t){var o=!1,a=r.querySelector("."+e._cssClasses.CURRENT_CRS_NAME),l=r.querySelector("."+e._cssClasses.CURRENT_CRS_CODE);t.forEach(function(t){if(a&&l&&TC.Util.CRSCodesEqual(e.map.crs,t.code)){a.textContent=t.name;l.textContent=t.code}else{const e=document.createElement("button");e.textContent=t.name+" ("+t.code+")";e.dataset.crsCode=t.code;const r=document.createElement("li");r.appendChild(e);if(0===s.filter(function(e){return TC.Util.CRSCodesEqual(e,t.code)}).length){o=!0;r.classList.add(TC.Consts.classes.HIDDEN);e.classList.add(TC.Consts.classes.WARNING)}i.appendChild(r)}});if(o){const t=document.createElement("li"),r=document.createElement("button");r.classList.add(e._cssClasses.LOAD_CRS_BUTTON);r.innerHTML=e.getLocaleString("showOnTheFlyProjections");t.appendChild(r);i.appendChild(t)}if(0===i.querySelectorAll("li").length){const t=document.createElement("li");t.innerHTML=e.getLocaleString("thereAreNoCompatibleCRS");i.appendChild(t)}const c=i.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");r.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(t){t.style.display=c.length>1?"":"none"});r.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(t){t.style.display=c.length>1?"none":""});r.querySelector("ul."+e._cssClasses.CRS_LIST).style.display=c.length>0||o?"":"none";n.classList.remove(TC.Consts.classes.LOADING)})};a?a.getCapabilitiesPromise().then(s):s();TC.Util.showModal(r,t)};t.setProjection=function(t){const e=this;t=t||{};TC.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t)}})};t.loadFallbackProjections=function(){const t=this,e=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li");e.forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(TC.Consts.classes.HIDDEN)});t._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN)});t._dialogDiv.querySelectorAll("."+t._cssClasses.CHANGE).forEach(function(t){t.style.display=e.length>1?"":"none"});t._dialogDiv.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach(function(t){t.style.display=e.length>1?"none":""})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Container=function(){TC.Control.apply(this,arguments);this.controlOptions=this.options.controls||[];this.ctlCount=this.controlOptions instanceof Array?this.controlOptions.length:Object.keys(this.controlOptions).length;this.defaultSelection=this.options.defaultSelection};TC.inherit(TC.control.Container,TC.Control);!function(){var t=TC.control.Container.prototype;t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.uids=new Array(e.ctlCount);e.uids.forEach(function(t,r,n){n[r]=e.getUID()});return new Promise(function(t,n){Promise.all([r,e.renderPromise()]).then(function(){e.onRenderPromise();t()})})};t.onRenderPromise=function(){};t.render=function(t){};t.getControl=function(t){var e=this._ctlPromises[t];return e||new Promise(function(t,e){e()})}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.TabContainer=function(){TC.control.Container.apply(this,arguments);var t=this._classSelector="."+this.CLASS;this._selectors={TAB:t+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:t+"-elm"}};TC.inherit(TC.control.TabContainer,TC.control.Container);!function(){var t=TC.control.TabContainer.prototype;t.CLASS="tc-ctl-tctr";TC.isDebug?t.template=TC.apiLocation+"TC/templates/TabContainer.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").f(e.get(["title"],!1),e,"h").w('</h2><div class="tc-ctl-tctr-select"><form>').s(e.get(["controls"],!1),e,{block:r},{}).w("</form></div>").s(e.get(["controls"],!1),e,{block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-').f(e.get(["$idx"],!1),e,"h").w('" style="width:calc(100%/').f(e.get(["$len"],!1),e,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(e.get(["$idx"],!1),e,"h").w('" /><span>').f(e.get(["title"],!1),e,"h").w("</span></label>")}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-').f(e.get(["$idx"],!1),e,"h").w(' tc-hidden"></div>')}n.__dustBody=!0;return e};t.onRenderPromise=function(){const t=this;t.title=t.title||t.getLocaleString(t.options.title||"moreControls");t.div.querySelector("h2").innerHTML=t.title;for(var e=new Array(t.ctlCount),r=0,n=t.controlOptions.length;r<n;r++){var i=t.controlOptions[r];e[r]=t.map.addControl(i.name,TC.Util.extend({id:t.uids[r],div:t.div.querySelector("."+t.CLASS+"-elm-"+r)},i.options))}var o=function(e,r){e.renderPromise().then(function(){const n=t.getLocaleString(t.controlOptions[r].title)||e.div.querySelector("h2").innerHTML;var i=e.div;do{i=i.parentElement}while(i&&!i.matches(t._classSelector));i.querySelector(t._selectors.TAB+"-"+r+" span").innerHTML=n})};Promise.all(e).then(function(e){for(var r=0,n=e.length;r<n;r++){var i=e[r];i.containerControl=t;o(i,r)}})};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({title:e.title,controls:e.controlOptions},function(){var t=function(t){for(var r=this;r&&!r.matches(e._selectors.TAB);)r=r.parentElement;var n,i=[];const o=r.querySelector(e._selectors.RADIOBUTTON),a=o.value,s=e.div.querySelectorAll(e._selectors.ELEMENT);if(e._oldValue===a&&e.options.deselectable){setTimeout(function(){o.checked=!1},0);e._oldValue=null;n=null;i=s}else{s.forEach(function(t){t.matches(e._selectors.ELEMENT+"-"+a)?n=t:i.push(t)});e._oldValue=a}n&&n.classList.remove(TC.Consts.classes.HIDDEN);i.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});o.checked=!0};e.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,t)});"number"==typeof e.defaultSelection&&t.call(e.div.querySelectorAll(e._selectors.RADIOBUTTON)[e.defaultSelection])}))}}();!function(){let t=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const e=function(t){for(var e=[],r=[],n=Math.pow(2,t.length),i=0;i<n;i++){r=[];for(var o=0;o<t.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(t[o])&&r.push(t[o]);r.length>0&&-1==e.indexOf(r.join(" "))&&e.push(r.join(" "))}return e}(t.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var r=0;r<e.length;r++){var n=t.indexOf(e[r]);n>-1&&t.splice(n,1)}}(e,t);t=t.concat(e);const r=function(t){return 1e3*ol.format.xsd.readDateTime(t)},n="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",i={rte:I,trk:M,wpt:O},o=ol.xml.makeStructureNS(t,{rte:ol.xml.makeArrayPusher(I),trk:ol.xml.makeArrayPusher(M),wpt:ol.xml.makeArrayPusher(O)}),a=ol.xml.makeStructureNS(t,{text:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkText"),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString,"linkType")}),s=ol.xml.makeStructureNS(t,{rte:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=e.getProperties(),o={node:t};o.properties=i;const a=e.getGeometry();if(a.getType()==ol.geom.GeometryType.LINE_STRING){const t=ol.format.Feature.transformWithOptions(a,!0,n);o.geometryLayout=t.getLayout();i.rtept=t.getCoordinates()}const s=r[r.length-1].node,l=y[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(o,m,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),trk:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=e.getProperties(),o={node:t};o.properties=i;const a=e.getGeometry();if(a.getType()==ol.geom.GeometryType.MULTI_LINE_STRING){const t=ol.format.Feature.transformWithOptions(a,!0,n);i.trkseg=t.getLineStrings()}const s=r[r.length-1].node,l=v[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(o,T,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),wpt:ol.xml.makeChildAppender(function(t,e,r){const n=r[0],i=r[r.length-1];i.properties=e.getProperties();const o=e.getGeometry();if(o.getType()==ol.geom.GeometryType.POINT){const e=ol.format.Feature.transformWithOptions(o,!0,n);i.geometryLayout=e.getLayout();k(t,e.getCoordinates(),r)}})});const l=ol.xml.makeStructureNS(t,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:R,type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),rtept:function(t,e){const r=ol.xml.pushParseAndPop({},c,t,e);if(r){const n=e[e.length-1],i=n.flatCoordinates,o=n.layoutOptions;A(i,o,t,r)}}}),c=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r)}),u=ol.xml.makeStructureNS(t,{name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,number:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),extensions:R,trkseg:function(t,e){const r=e[e.length-1];ol.xml.parseNode(h,t,e);const n=r.flatCoordinates;r.ends.push(n.length)}}),h=ol.xml.makeStructureNS(t,{trkpt:function(t,e){const r=ol.xml.pushParseAndPop({},p,t,e);if(r){const n=e[e.length-1],i=n.flatCoordinates,o=n.layoutOptions;A(i,o,t,r)}}}),p=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r)}),d=ol.xml.makeStructureNS(t,{ele:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),time:ol.xml.makeObjectPropertySetter(r),magvar:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),geoidheight:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),src:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),link:P,sym:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),type:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),fix:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),sat:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),hdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),vdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),pdop:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),ageofdgpsdata:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),dgpsid:ol.xml.makeObjectPropertySetter(ol.format.xsd.readNonNegativeInteger),extensions:R}),f=["text","type"],g=ol.xml.makeStructureNS(t,{text:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode)}),y=ol.xml.makeStructureNS(t,["name","cmt","desc","src","link","number","type","rtept"]),m=ol.xml.makeStructureNS(t,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(N),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),rtept:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(k))}),C=ol.xml.makeStructureNS(t,["ele","time"]),v=ol.xml.makeStructureNS(t,["name","cmt","desc","src","link","number","type","trkseg"]),T=ol.xml.makeStructureNS(t,{name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(N),number:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),trkseg:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(function(t,e,r){const n={node:t};n.geometryLayout=e.getLayout();n.properties={};ol.xml.pushSerializeAndPop(n,S,_,e.getCoordinates(),r)}))}),_=ol.xml.makeSimpleNodeFactory("trkpt"),S=ol.xml.makeStructureNS(t,{trkpt:ol.xml.makeChildAppender(k)}),E=ol.xml.makeStructureNS(t,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),L=ol.xml.makeStructureNS(t,{ele:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),time:ol.xml.makeChildAppender(function(t,e){var r=new Date(e),n=r.getUTCFullYear()+"-"+ol.string.padNumber(r.getUTCMonth()+1,2)+"-"+ol.string.padNumber(r.getUTCDate(),2)+"T"+ol.string.padNumber(r.getUTCHours(),2)+":"+ol.string.padNumber(r.getUTCMinutes(),2)+":"+ol.string.padNumber(r.getUTCSeconds(),2)+"Z";t.appendChild(ol.xml.DOCUMENT.createTextNode(n))}),magvar:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),geoidheight:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),link:ol.xml.makeChildAppender(N),sym:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),fix:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),sat:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode),hdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),vdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),pdop:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),ageofdgpsdata:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),dgpsid:ol.xml.makeChildAppender(ol.format.xsd.writeNonNegativeIntegerTextNode)}),w={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function b(t,e,r){const n=t.getGeometry();if(n){const t=w[n.getType()];if(t){const r=e[e.length-1].node;return ol.xml.createElementNS(r.namespaceURI,t)}}}function A(t,e,r,n){t.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat")));if("ele"in n){t.push(n.ele);delete n.ele;e.hasZ=!0}else t.push(0);if("time"in n){t.push(n.time);delete n.time;e.hasM=!0}else t.push(0);return t}function x(t,e,r){let n=ol.geom.GeometryLayout.XY,i=2;if(t.hasZ&&t.hasM){n=ol.geom.GeometryLayout.XYZM;i=4}else if(t.hasZ){n=ol.geom.GeometryLayout.XYZ;i=3}else if(t.hasM){n=ol.geom.GeometryLayout.XYM;i=3}if(4!==i){for(let r=0,n=e.length/4;r<n;r++){e[r*i]=e[4*r];e[r*i+1]=e[4*r+1];t.hasZ&&(e[r*i+2]=e[4*r+2]);t.hasM&&(e[r*i+2]=e[4*r+3])}e.length=e.length/4*i;if(r)for(let t=0,e=r.length;t<e;t++)r[t]=r[t]/4*i}return n}function P(t,e){const r=e[e.length-1],n=t.getAttribute("href");null!==n&&(r.link=n);ol.xml.parseNode(a,t,e)}function R(t,e){e[e.length-1].extensionsNode_=t}function I(t,e){const r=e[0],n=ol.xml.pushParseAndPop({flatCoordinates:[],layoutOptions:{}},l,t,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.layoutOptions;delete n.layoutOptions;const a=x(o,i),s=new ol.geom.LineString(i,a);ol.format.Feature.transformWithOptions(s,!1,r);const c=new ol.Feature(s);c.setProperties(n,!0);return c}function M(t,e){const r=e[0],n=ol.xml.pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},u,t,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.ends;delete n.ends;const a=n.layoutOptions;delete n.layoutOptions;const s=x(a,i,o),l=new ol.geom.MultiLineString(i,s,o);ol.format.Feature.transformWithOptions(l,!1,r);const c=new ol.Feature(l);c.setProperties(n,!0);return c}function O(t,e){const r=e[0],n=ol.xml.pushParseAndPop({},d,t,e);if(!n)return;const i={},o=A([],i,t,n),a=x(i,o),s=new ol.geom.Point(o,a);ol.format.Feature.transformWithOptions(s,!1,r);const l=new ol.Feature(s);l.setProperties(n,!0);return l}function N(t,e,r){t.setAttribute("href",e);const n=r[r.length-1].properties,i=[n.linkText,n.linkType];ol.xml.pushSerializeAndPop({node:t},g,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,i,r,f)}function k(t,e,r){const n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;t.setAttributeNS(null,"lat",String(e[1]));t.setAttributeNS(null,"lon",String(e[0]));switch(n.geometryLayout){case ol.geom.GeometryLayout.XYZM:0!==e[3]&&(o.time=e[3]);case ol.geom.GeometryLayout.XYZ:0!==e[2]&&(o.ele=e[2]);break;case ol.geom.GeometryLayout.XYM:0!==e[2]&&(o.time=e[2])}const a="rtept"==t.nodeName?C[i]:E[i],s=ol.xml.makeSequence(o,a);ol.xml.pushSerializeAndPop({node:t,properties:o},L,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,r,a)}ol.format.GPXCustom=class extends ol.format.GPX{constructor(t){super(t)}readFeatureFromNode(e,r){if(!ol.array.includes(t,e.namespaceURI))return null;const n=i[e.localName];if(!n)return null;const o=n(e,[this.getReadOptions(e,r)]);if(!o)return null;this.handleReadExtensions_([o]);return o}readFeaturesFromNode(e,r){if(!ol.array.includes(t,e.namespaceURI))return[];if("gpx"==e.localName){const t=ol.xml.pushParseAndPop([],o,e,[this.getReadOptions(e,r)]);if(t){this.handleReadExtensions_(t);return t}return[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const r=ol.xml.createElementNS("http://www.topografix.com/GPX/1/1","gpx");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",ol.xml.XML_SCHEMA_INSTANCE_URI);r.setAttributeNS(ol.xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",n);r.setAttribute("version","1.1");r.setAttribute("creator","OpenLayers");ol.xml.pushSerializeAndPop({node:r},s,b,t,[e]);return r}}}();!function(){const t=["http://www.google.com/kml/ext/2.2"];let e=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];const r=function(t){for(var e=[],r=[],n=Math.pow(2,t.length),i=0;i<n;i++){r=[];for(var o=0;o<t.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(t[o])&&r.push(t[o]);r.length>0&&-1==e.indexOf(r.join(" "))&&e.push(r.join(" "))}return e}(e.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var r=0;r<e.length;r++){var n=t.indexOf(e[r]);n>-1&&t.splice(n,1)}}(r,e);e=e.concat(r);const n={fraction:ol.style.IconAnchorUnits.FRACTION,pixels:ol.style.IconAnchorUnits.PIXELS,insetPixels:ol.style.IconAnchorUnits.PIXELS},i=ol.xml.makeStructureNS(e,{ExtendedData:function(t,e){ol.xml.parseNode(tt,t,e)},Region:function(t,e){ol.xml.parseNode(o,t,e)},MultiGeometry:ol.xml.makeObjectPropertySetter(Y,"geometry"),LineString:ol.xml.makeObjectPropertySetter(W,"geometry"),LinearRing:ol.xml.makeObjectPropertySetter(H,"geometry"),Point:ol.xml.makeObjectPropertySetter(z,"geometry"),Polygon:ol.xml.makeObjectPropertySetter(K,"geometry"),Style:ol.xml.makeObjectPropertySetter(J),StyleMap:function(t,e){const r=function(t,e){return ol.xml.pushParseAndPop(void 0,x,t,e)}(t,e);if(!r)return;const n=e[e.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:assert(!1,38)},address:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),description:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),name:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),open:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),styleUrl:ol.xml.makeObjectPropertySetter(b),visibility:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean)},ol.xml.makeStructureNS(t,{MultiTrack:ol.xml.makeObjectPropertySetter(function(t,e){const r=ol.xml.pushParseAndPop([],D,t,e);if(!r)return;return new ol.geom.MultiLineString(r)},"geometry"),Track:ol.xml.makeObjectPropertySetter(B,"geometry")})),o=(ol.xml.makeStructureNS(e,{href:ol.xml.makeObjectPropertySetter(b)}),ol.xml.makeStructureNS(e,{LatLonAltBox:function(t,e){const r=ol.xml.pushParseAndPop({},nt,t,e);if(!r)return;const n=e[e.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i;n.altitudeMode=r.altitudeMode;n.minAltitude=parseFloat(r.minAltitude);n.maxAltitude=parseFloat(r.maxAltitude)},Lod:function(t,e){const r=ol.xml.pushParseAndPop({},it,t,e);if(!r)return;const n=e[e.length-1];n.minLodPixels=parseFloat(r.minLodPixels);n.maxLodPixels=parseFloat(r.maxLodPixels);n.minFadeExtent=parseFloat(r.minFadeExtent);n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}));let a,s,l,c,u,h,p,d=null;let f,g=null;let y,m=null;let C=null;let v=null,T=null;const _=function(t,e){var r;if(t){r=(r=ol.color.asArray(t)).slice();void 0!==e&&(r[3]=e)}else r=[0,0,0,1];return r};const S=function(t,r){const n=ol.xml.parse(t).getElementsByTagName(r.toLowerCase());if(n&&n.length>0){var i=n[0].getAttribute("xmlns");if(i&&i.indexOf(" ")>-1&&e.indexOf(i)>-1){const t=i.split(" "),e=[];for(var o=0;o<t.length;o++)e.push("xmlns:"+r.toLowerCase()+o+'="'+t[o].trim()+'"')}}return t};function E(t,e){let r=null;const n=[0,0];let i="start";if(t.getImage()){let e=t.getImage().getImageSize();null===e&&(e=u);if(2==e.length){const r=t.getImage().getScale();n[0]=r*e[0]/2;n[1]=-r*e[1]/2;i="left"}}if(null!==t.getText()){const e=t.getText();(r=e.clone()).setFont(e.getFont()||C.getFont());r.setScale(e.getScale()||C.getScale());r.setFill(e.getFill()||C.getFill());r.setStroke(e.getStroke()||y)}else r=C.clone();r.setText(e);r.setOffsetX(n[0]);r.setOffsetY(n[1]);r.setTextAlign(i);return new ol.style.Style({text:r})}function L(t){const e=ol.xml.getAllTextContent(t,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(r){const t=r[1];return[parseInt(t.substr(6,2),16),parseInt(t.substr(4,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(0,2),16)/255]}}function w(t){let e=ol.xml.getAllTextContent(t,!1);const r=[],n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;let i;for(;i=n.exec(e);){const t=parseFloat(i[1]),n=parseFloat(i[2]),o=i[3]?parseFloat(i[3]):0;r.push(t,n,o);e=e.substr(i[0].length)}if(""===e)return r}function b(t){const e=ol.xml.getAllTextContent(t,!1).trim();let r=t.baseURI;r&&"about:blank"!=r||(r=window.location.href);if(r){"https:"===location.protocol&&0===r.indexOf("http://")&&(r=r.substr(5));return new URL(e,r).href}return e}function A(t){return ol.format.xsd.readDecimal(t)}const x=ol.xml.makeStructureNS(e,{Pair:function(t,e){const r=ol.xml.pushParseAndPop({},et,t,e);if(!r)return;const n=r.key;if(n&&"normal"==n){const t=r.styleUrl;t&&(e[e.length-1]=t);const n=r.Style;n&&(e[e.length-1]=n)}}});const P=ol.xml.makeStructureNS(e,{Icon:ol.xml.makeObjectPropertySetter(function(t,e){const r=ol.xml.pushParseAndPop({},G,t,e);return r||null}),heading:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),hotSpot:ol.xml.makeObjectPropertySetter(function(t){const e=t.getAttribute("xunits"),r=t.getAttribute("yunits");let i;i="insetPixels"!==e?"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_LEFT:ol.style.IconOrigin.TOP_LEFT:"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_RIGHT:ol.style.IconOrigin.TOP_RIGHT;return{x:parseFloat(t.getAttribute("x")),xunits:n[e],y:parseFloat(t.getAttribute("y")),yunits:n[r],origin:i}}),scale:ol.xml.makeObjectPropertySetter(A)}),R=ol.xml.makeStructureNS(e,{text:ol.xml.makeObjectPropertySetter(function(t,e){ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE);ol.asserts.assert("text"==t.localName);return ol.format.xsd.readString(t).trim()})});const I=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(L),scale:ol.xml.makeObjectPropertySetter(A)});const M=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(L),width:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const O=ol.xml.makeStructureNS(e,{color:ol.xml.makeObjectPropertySetter(L),fill:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),outline:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean)});const N=ol.xml.makeStructureNS(e,{coordinates:ol.xml.makeReplacer(w)});function k(t,e){return ol.xml.pushParseAndPop(null,N,t,e)}const D=ol.xml.makeStructureNS(t,{Track:ol.xml.makeArrayPusher(B)});const F=ol.xml.makeStructureNS(e,{when:function(t,e){const r=e[e.length-1].whens,n=ol.xml.getAllTextContent(t,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},ol.xml.makeStructureNS(t,{coord:function(t,e){const r=e[e.length-1].flatCoordinates,n=ol.xml.getAllTextContent(t,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){const t=parseFloat(i[1]),e=parseFloat(i[2]),n=parseFloat(i[3]);r.push(t,e,n,0)}else r.push(0,0,0,0)}}));function B(t,e){const r=ol.xml.pushParseAndPop({flatCoordinates:[],whens:[]},F,t,e);if(!r)return;const n=r.flatCoordinates,i=r.whens;for(let t=0,e=Math.min(n.length,i.length);t<e;++t)n[4*t+3]=i[t];return new ol.geom.LineString(n,ol.geom.GeometryLayout.XYZM)}const G=ol.xml.makeStructureNS(e,{href:ol.xml.makeObjectPropertySetter(b)},ol.xml.makeStructureNS(t,{x:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),y:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),w:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),h:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)}));const U=ol.xml.makeStructureNS(e,{coordinates:ol.xml.makeReplacer(w)});function j(t,e){return ol.xml.pushParseAndPop(null,U,t,e)}const q=ol.xml.makeStructureNS(e,{extrude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),tessellate:ol.xml.makeObjectPropertySetter(ol.format.xsd.readBoolean),altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString)});function W(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.LineString(n,ol.geom.GeometryLayout.XYZ);t.setProperties(r,!0);return t}}function H(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.Polygon(n,ol.geom.GeometryLayout.XYZ,[n.length]);t.setProperties(r,!0);return t}}const V=ol.xml.makeStructureNS(e,{LineString:ol.xml.makeArrayPusher(W),LinearRing:ol.xml.makeArrayPusher(H),MultiGeometry:ol.xml.makeArrayPusher(Y),Point:ol.xml.makeArrayPusher(z),Polygon:ol.xml.makeArrayPusher(K)});function Y(t,e){const r=ol.xml.pushParseAndPop([],V,t,e);if(!r)return null;if(0===r.length)return new ol.geom.GeometryCollection(r);let n,i=!0;const o=r[0].getType();let a;for(let t=1,e=r.length;t<e;++t)if((a=r[t]).getType()!=o){i=!1;break}if(i){let t,e;if(o==ol.geom.GeometryType.POINT){const i=r[0];t=i.getLayout();e=i.getFlatCoordinates();for(let t=1,n=r.length;t<n;++t){a=r[t];ol.array.extend(e,a.getFlatCoordinates())}Z(n=new ol.geom.MultiPoint(e,t),r)}else o==ol.geom.GeometryType.LINE_STRING?Z(n=new ol.geom.MultiLineString(r),r):o==ol.geom.GeometryType.POLYGON?Z(n=new ol.geom.MultiPolygon(r),r):o==ol.geom.GeometryType.GEOMETRY_COLLECTION?n=new ol.geom.GeometryCollection(r):assert(!1,37)}else n=new ol.geom.GeometryCollection(r);return n}function z(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=j(t,e);if(n){const t=new ol.geom.Point(n,ol.geom.GeometryLayout.XYZ);t.setProperties(r,!0);return t}}const X=ol.xml.makeStructureNS(e,{innerBoundaryIs:function(t,e){const r=ol.xml.pushParseAndPop(void 0,ot,t,e);if(r){const t=e[e.length-1];t.push(r)}},outerBoundaryIs:function(t,e){const r=ol.xml.pushParseAndPop(void 0,at,t,e);if(r){const t=e[e.length-1];t[0]=r}}});function K(t,e){const r=ol.xml.pushParseAndPop({},q,t,e),n=ol.xml.pushParseAndPop([null],X,t,e);if(n&&n[0]){const t=n[0],e=[t.length];for(let r=1,i=n.length;r<i;++r){ol.array.extend(t,n[r]);e.push(t.length)}const i=new ol.geom.Polygon(t,ol.geom.GeometryLayout.XYZ,e);i.setProperties(r,!0);return i}}const $=ol.xml.makeStructureNS(e,{IconStyle:function(t,e){const r=ol.xml.pushParseAndPop({},P,t,e);if(!r)return;const n=e[e.length-1],i="Icon"in r?r.Icon:{},o=!("Icon"in r)||Object.keys(i).length>0;let a;const d=i.href;d?a=d:o&&(a=h);let g,y,m,C=ol.style.IconOrigin.BOTTOM_LEFT;const v=r.hotSpot;if(v){g=[v.x,v.y];y=v.xunits;m=v.yunits;C=v.origin}else if(a===h){g=s;y=l;m=c}else if(/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)){g=[.5,0];y=ol.style.IconAnchorUnits.FRACTION;m=ol.style.IconAnchorUnits.FRACTION}let T;const _=i.x,S=i.y;void 0!==_&&void 0!==S&&(T=[_,S]);let E;const L=i.w,w=i.h;void 0!==L&&void 0!==w&&(E=[L,w]);let b;const A=r.heading;void 0!==A&&(b=ol.math.toRadians(A));let x=r.scale;if(o){if(a==h){E=u;void 0===x&&(x=p)}const t=new ol.style.Icon({anchor:g,anchorOrigin:C,anchorXUnits:y,anchorYUnits:m,crossOrigin:"anonymous",offset:T,offsetOrigin:ol.style.IconOrigin.BOTTOM_LEFT,rotation:b,scale:x,size:E,src:a});n.imageStyle=t}else n.imageStyle=f},LabelStyle:function(t,e){const r=ol.xml.pushParseAndPop({},I,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Text({fill:new ol.style.Fill({color:"color"in r?r.color:a}),scale:r.scale});n.textStyle=i},LineStyle:function(t,e){const r=ol.xml.pushParseAndPop({},M,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Stroke({color:"color"in r?r.color:a,width:"width"in r?r.width:1});n.strokeStyle=i},PolyStyle:function(t,e){const r=ol.xml.pushParseAndPop({},O,t,e);if(!r)return;const n=e[e.length-1],i=new ol.style.Fill({color:"color"in r?r.color:a});n.fillStyle=i;const o=r.fill;void 0!==o&&(n.fill=o);const s=r.outline;void 0!==s&&(n.outline=s)},BalloonStyle:function(t,e){ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE);ol.asserts.assert("BalloonStyle"==t.localName);var r=ol.xml.pushParseAndPop({},R,t,e);if(!r)return;const n=e[e.length-1],i=typeof n;ol.asserts.assert("object"==i&&null!=n||"function"==i);var o=new ol.style.Text({text:r.text});n.balloonStyle=o}});function J(t,e){const r=ol.xml.pushParseAndPop({},$,t,e);if(!r)return null;let n="fillStyle"in r?r.fillStyle:d;const i=r.fill;void 0===i||i||(n=null);let o;"imageStyle"in r?r.imageStyle!=f&&(o=r.imageStyle):o=g;const a="textStyle"in r?r.textStyle:C;let s="strokeStyle"in r?r.strokeStyle:m;const l=r.balloonStyle,c=new ol.style.Style({fill:n,image:o,stroke:s,text:a,zIndex:void 0});l&&(c._balloon=l);return[c]}function Z(t,e){const r=e.length,n=new Array(e.length),i=new Array(e.length),o=new Array(e.length);let a,s,l;a=s=l=!1;for(let t=0;t<r;++t){const r=e[t];n[t]=r.get("extrude");i[t]=r.get("tessellate");o[t]=r.get("altitudeMode");a=a||void 0!==n[t];s=s||void 0!==i[t];l=l||o[t]}a&&t.set("extrude",n);s&&t.set("tessellate",i);l&&t.set("altitudeMode",o)}const Q=ol.xml.makeStructureNS(e,{displayName:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),value:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString)});const tt=ol.xml.makeStructureNS(e,{Data:function(t,e){const r=t.getAttribute("name");ol.xml.parseNode(Q,t,e);const n=e[e.length-1];null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value);delete n.value},SchemaData:function(t,e){ol.xml.parseNode(rt,t,e)}});const et=ol.xml.makeStructureNS(e,{Style:ol.xml.makeObjectPropertySetter(J),key:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),styleUrl:ol.xml.makeObjectPropertySetter(b)});const rt=ol.xml.makeStructureNS(e,{SimpleData:function(t,e){const r=t.getAttribute("name");if(null!==r){const n=ol.format.xsd.readString(t),i=e[e.length-1];i[r]=n}}});const nt=ol.xml.makeStructureNS(e,{altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.xsd.readString),minAltitude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxAltitude:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),north:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),south:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),east:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),west:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const it=ol.xml.makeStructureNS(e,{minLodPixels:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxLodPixels:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),minFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal),maxFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.xsd.readDecimal)});const ot=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeReplacer(k)});const at=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeReplacer(k)});function st(t,e){const r=asArray(e),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]];for(let t=0;t<4;++t){const e=Math.floor(n[t]).toString(16);n[t]=1==e.length?"0"+e:e}ol.format.xsd.writeStringTextNode(t,n.join(""))}const lt=ol.xml.makeStructureNS(e,{Data:ol.xml.makeChildAppender(function(t,e,r){t.setAttribute("name",e.name);const n={node:t},i=e.value;if("object"==typeof i){null!==i&&i.displayName&&ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.displayName],r,["displayName"]);null!==i&&i.value&&ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.value],r,["value"])}else ol.xml.pushSerializeAndPop(n,lt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i],r,["value"])}),value:ol.xml.makeChildAppender(function(t,e){ol.format.xsd.writeStringTextNode(t,e)}),displayName:ol.xml.makeChildAppender(function(t,e){ol.format.xsd.writeCDATASection(t,e)})});ol.xml.makeStructureNS(e,{Placemark:ol.xml.makeChildAppender(function(t,e,r){const n={node:t};e.getId()&&t.setAttribute("id",e.getId());const i=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;const a=Object.keys(i||{}).sort().filter(function(t){return!o[t]});if(a.length>0){const t=ol.xml.makeSequence(i,a),e={names:a,values:t};ol.xml.pushSerializeAndPop(n,Pt,It,[e],r)}const s=e.getStyleFunction();if(s){const t=s(e,0);if(t){const e=Array.isArray(t)?t[0]:t;this.writeStyles_&&(i.Style=e);const r=e.getText();r&&(i.name=r.getText())}}const l=r[r.length-1].node,c=Rt[l.namespaceURI],u=ol.xml.makeSequence(i,c);ol.xml.pushSerializeAndPop(n,Pt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,u,r,c);const h=r[0];let p=e.getGeometry();p&&(p=ol.format.Feature.transformGeometryWithOptions(p,!0,h));ol.xml.pushSerializeAndPop(n,Pt,Tt,[p],r)})});const ct=ol.xml.makeSimpleNodeFactory("Data");const ut=ol.xml.makeStructureNS(e,["href"],ol.xml.makeStructureNS(t,["x","y","w","h"])),ht=ol.xml.makeStructureNS(e,{href:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode)},ol.xml.makeStructureNS(t,{x:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),y:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),w:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),h:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode)})),pt=function(e,r,n){return ol.xml.createElementNS(t[0],"gx:"+n)};const dt=ol.xml.makeStructureNS(e,["scale","heading","Icon","hotSpot"]),ft=ol.xml.makeStructureNS(e,{Icon:ol.xml.makeChildAppender(function(e,r,n){const i={node:e},o=n[n.length-1].node;let a=ut[o.namespaceURI],s=ol.xml.makeSequence(r,a);ol.xml.pushSerializeAndPop(i,ht,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,n,a);a=ut[t[0]];s=ol.xml.makeSequence(r,a);ol.xml.pushSerializeAndPop(i,ht,pt,s,n,a)}),heading:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode),hotSpot:ol.xml.makeChildAppender(function(t,e){t.setAttribute("x",String(e.x));t.setAttribute("y",String(e.y));t.setAttribute("xunits",e.xunits);t.setAttribute("yunits",e.yunits)}),scale:ol.xml.makeChildAppender(jt)});const gt=ol.xml.makeStructureNS(e,["color","scale"]),yt=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st),scale:ol.xml.makeChildAppender(jt)});const mt=ol.xml.makeStructureNS(e,["color","width"]),Ct=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st),width:ol.xml.makeChildAppender(ol.format.xsd.writeDecimalTextNode)});const vt={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Tt=function(t,e,r){if(t){const r=e[e.length-1].node;return ol.xml.createElementNS(r.namespaceURI,vt[t.getType()])}},_t=ol.xml.makeSimpleNodeFactory("Point"),St=ol.xml.makeSimpleNodeFactory("LineString"),Et=ol.xml.makeSimpleNodeFactory("LinearRing"),Lt=ol.xml.makeSimpleNodeFactory("Polygon"),wt=ol.xml.makeStructureNS(e,{LineString:ol.xml.makeChildAppender(Nt),Point:ol.xml.makeChildAppender(Nt),Polygon:ol.xml.makeChildAppender(Bt),GeometryCollection:ol.xml.makeChildAppender(bt)});function bt(t,e,r){const n={node:t},i=e.getType();let o,a;if(i==ol.geom.GeometryType.GEOMETRY_COLLECTION){o=e.getGeometries();a=Tt}else if(i==ol.geom.GeometryType.MULTI_POINT){o=e.getPoints();a=_t}else if(i==ol.geom.GeometryType.MULTI_LINE_STRING){o=e.getLineStrings();a=St}else if(i==ol.geom.GeometryType.MULTI_POLYGON){o=e.getPolygons();a=Lt}else assert(!1,39);ol.xml.pushSerializeAndPop(n,wt,a,o,r)}const At=ol.xml.makeStructureNS(e,{LinearRing:ol.xml.makeChildAppender(Nt)});function xt(t,e,r){const n={node:t};ol.xml.pushSerializeAndPop(n,At,Et,[e],r)}const Pt=ol.xml.makeStructureNS(e,{ExtendedData:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i=e.names,o=e.values,a=i.length;for(let t=0;t<a;t++)ol.xml.pushSerializeAndPop(n,lt,ct,[{name:i[t],value:o[t]}],r)}),MultiGeometry:ol.xml.makeChildAppender(bt),LineString:ol.xml.makeChildAppender(Nt),LinearRing:ol.xml.makeChildAppender(Nt),Point:ol.xml.makeChildAppender(Nt),Polygon:ol.xml.makeChildAppender(Bt),Style:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getFill(),a=e.getStroke(),s=e.getImage(),l=e.getText();s&&"function"==typeof s.getSrc&&(i.IconStyle=s);l&&(i.LabelStyle=l);a&&(i.LineStyle=a);o&&(i.PolyStyle=o);const c=r[r.length-1].node,u=qt[c.namespaceURI],h=ol.xml.makeSequence(i,u);ol.xml.pushSerializeAndPop(n,Wt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,h,r,u)}),address:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),description:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),name:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),open:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),phoneNumber:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),styleUrl:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),visibility:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode)}),Rt=ol.xml.makeStructureNS(e,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),It=ol.xml.makeSimpleNodeFactory("ExtendedData");const Mt=ol.xml.makeStructureNS(e,["extrude","tessellate","altitudeMode","coordinates"]),Ot=ol.xml.makeStructureNS(e,{extrude:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),tessellate:ol.xml.makeChildAppender(ol.format.xsd.writeBooleanTextNode),altitudeMode:ol.xml.makeChildAppender(ol.format.xsd.writeStringTextNode),coordinates:ol.xml.makeChildAppender(function(t,e,r){const n=r[r.length-1],i=n.layout,o=n.stride;let a;i==ol.geom.GeometryLayout.XY||i==ol.geom.GeometryLayout.XYM?a=2:i==ol.geom.GeometryLayout.XYZ||i==ol.geom.GeometryLayout.XYZM?a=3:assert(!1,34);const s=e.length;let l="";if(s>0){l+=e[0];for(let t=1;t<a;++t)l+=","+e[t];for(let t=o;t<s;t+=o){l+=" "+e[t];for(let r=1;r<a;++r)l+=","+e[t+r]}}ol.format.xsd.writeStringTextNode(t,l)})});function Nt(t,e,r){const n=e.getFlatCoordinates(),i={node:t};i.layout=e.getLayout();i.stride=e.getStride();const o=e.getProperties();o.coordinates=n;const a=r[r.length-1].node,s=Mt[a.namespaceURI],l=ol.xml.makeSequence(o,s);ol.xml.pushSerializeAndPop(i,Ot,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,r,s)}const kt=ol.xml.makeStructureNS(e,{outerBoundaryIs:ol.xml.makeChildAppender(xt),innerBoundaryIs:ol.xml.makeChildAppender(xt)}),Dt=ol.xml.makeSimpleNodeFactory("innerBoundaryIs"),Ft=ol.xml.makeSimpleNodeFactory("outerBoundaryIs");function Bt(t,e,r){const n=e.getLinearRings(),i=n.shift(),o={node:t};ol.xml.pushSerializeAndPop(o,kt,Dt,n,r);ol.xml.pushSerializeAndPop(o,kt,Ft,[i],r)}const Gt=ol.xml.makeStructureNS(e,{color:ol.xml.makeChildAppender(st)}),Ut=ol.xml.makeSimpleNodeFactory("color");function jt(t,e){ol.format.xsd.writeDecimalTextNode(t,Math.round(1e6*e)/1e6)}const qt=ol.xml.makeStructureNS(e,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Wt=ol.xml.makeStructureNS(e,{IconStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:o};if(a){l.w=a[0];l.h=a[1];const t=e.getAnchor(),r=e.getOrigin();if(r&&s&&0!==r[0]&&r[1]!==a[1]){l.x=r[0];l.y=s[1]-(r[1]+a[1])}if(t&&(t[0]!==a[0]/2||t[1]!==a[1]/2)){const e={x:t[0],xunits:ol.style.IconAnchorUnits.PIXELS,y:a[1]-t[1],yunits:ol.style.IconAnchorUnits.PIXELS};i.hotSpot=e}}i.Icon=l;const c=e.getScale();1!==c&&(i.scale=c);const u=e.getRotation();0!==u&&(i.heading=u);const h=r[r.length-1].node,p=dt[h.namespaceURI],d=ol.xml.makeSequence(i,p);ol.xml.pushSerializeAndPop(n,ft,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,d,r,p)}),LabelStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={},o=e.getFill();o&&(i.color=o.getColor());const a=e.getScale();a&&1!==a&&(i.scale=a);const s=r[r.length-1].node,l=gt[s.namespaceURI],c=ol.xml.makeSequence(i,l);ol.xml.pushSerializeAndPop(n,yt,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,l)}),LineStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t},i={color:e.getColor(),width:e.getWidth()},o=r[r.length-1].node,a=mt[o.namespaceURI],s=ol.xml.makeSequence(i,a);ol.xml.pushSerializeAndPop(n,Ct,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,r,a)}),PolyStyle:ol.xml.makeChildAppender(function(t,e,r){const n={node:t};ol.xml.pushSerializeAndPop(n,Gt,Ut,[e.getColor()],r)})});ol.format.KMLCustom=class extends ol.format.KML{constructor(t){super(t);const e=t||{};T||function(){a=[255,255,255,1];d=new ol.style.Fill({color:_(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity)});s=[20,2];l=ol.style.IconAnchorUnits.PIXELS;c=ol.style.IconAnchorUnits.PIXELS;u=[64,64];h="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";p=.5;g=new ol.style.Icon({anchor:s,anchorOrigin:ol.style.IconOrigin.BOTTOM_LEFT,anchorXUnits:l,anchorYUnits:c,crossOrigin:"anonymous",rotation:0,scale:p,size:u,src:h});f="NO_IMAGE";m=new ol.style.Stroke({color:_(TC.Cfg.styles.line.strokeColor,1),width:TC.Cfg.styles.line.strokeWidth||1});y=new ol.style.Stroke({color:[51,51,51,1],width:2});C=new ol.style.Text({font:"bold 16px Helvetica",fill:d,stroke:y,scale:.8});v=new ol.style.Style({fill:d,image:g,text:C,stroke:m,zIndex:0});T=[v]}();this.defaultStyle_=e.defaultStyle?e.defaultStyle:T}readFeatures(t,e){if("string"==typeof t){const e="<kml";let r=t.indexOf(e);if(r>=0){r+=e.length;t.indexOf("xmlns:xsi=")<0&&(t=t.substr(0,r)+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+t.substr(r));t=S(t,"KML")}}return ol.format.KML.prototype.readFeatures.call(this,t,e)}readDocumentOrFolder_(t,r){const n=ol.xml.makeStructureNS(e,{Document:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Folder:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:ol.xml.makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),i=ol.xml.pushParseAndPop([],n,t,r,this);if(i){if("Folder"==t.localName)for(let e=0,r=i.length;e<r;e++){const r=i[e];Array.isArray(r._folders)||(r._folders=[]);var o=t.getElementsByTagName("name")[0];o&&TC.Util.fastUnshift(r._folders,o.innerHTML||o.textContent)}return i}}readPlacemark_(t,e){const r=ol.xml.pushParseAndPop({geometry:null},i,t,e);if(!r)return;const n=new ol.Feature,o=t.getAttribute("id");null!==o&&n.setId(o);const a=e[0],s=r.geometry;s&&ol.format.Feature.transformWithOptions(s,!1,a);n.setGeometry(s);delete r.geometry;if(this.extractStyles_){const t=function(t,e,r,n,i){return function(o,a){let s,l=i,c="";if(l){const t=o.getGeometry();t&&(l=t.getType()===ol.geom.GeometryType.POINT)}if(l){c=o.get("name");l=l&&!!c}if(t){if(l){s=E(t[0],c);return t.concat(s)}return t}if(e){const t=function t(e,r,n){if(Array.isArray(e))return e;if("string"==typeof e){!(e in n)&&"#"+e in n&&(e="#"+e);return t(n[e],r,n)}return r}(e,r,n);if(l){s=E(t[0],c);return t.concat(s)}return t}if(l){s=E(r[0],c);return r.concat(s)}return r}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(t)}delete r.Style;n.setProperties(r,!0);return n}readSharedStyle_(t,e){const r=t.getAttribute("id");if(null!==r){const n=J(t,e);if(n){let e,i=t.baseURI;i&&"about:blank"!=i||(i=window.location.href);e=i?new URL("#"+r,i).href:"#"+r;this.sharedStyles_[e]=n}}}readFeatureFromNode(t,r){if(!ol.array.includes(e,t.namespaceURI))return null;const n=this.readPlacemark_(t,[this.getReadOptions(t,r)]);return n||null}readFeaturesFromNode(t,r){if(!ol.array.includes(e,t.namespaceURI))return[];let n;const i=t.localName;if("Document"==i||"Folder"==i)return(n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,r)]))||[];if("Placemark"==i){const e=this.readPlacemark_(t,[this.getReadOptions(t,r)]);return e?[e]:[]}if("kml"==i){n=[];for(let e=t.firstElementChild;e;e=e.nextElementSibling){const t=this.readFeaturesFromNode(e,r);t&&ol.array.extend(n,t)}return n}return[]}}}();!function(t,e){"function"==typeof define&&define.amd?define(["../../lib/ol/build/ol-sitna"],e):"object"==typeof exports?module.exports=e(require("../../lib/ol/build/ol-sitna")):t.ol=e(t.ol)}(this,function(t){Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,r=0;r<e;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;t+=arguments[r]*arguments[r]}return Math.sqrt(t)};for(var e=0,r=["ms","moz","webkit","o"],n=0;n<r.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[r[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[r[n]+"CancelAnimationFrame"]||window[r[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+i)},i);e=n+i;return o});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});const i=t.events.EventType.RESIZE,o=t.events.EventType.DRAGENTER,a=t.events.EventType.DRAGOVER,s=t.events.EventType.DROP,l=t.events.EventType.CHANGE,c=t.MapBrowserEventType.SINGLECLICK,u=t.MapBrowserEventType.POINTERMOVE,h=t.MapEventType.MOVEEND,p=t.MapEventType.POSTRENDER,d=t.render.EventType.POSTCOMPOSE,f=t.source.VectorEventType.ADDFEATURE,g=t.source.VectorEventType.REMOVEFEATURE,y=t.source.VectorEventType.CLEAR,m=t.source.TileEventType.TILELOADSTART,C=t.source.TileEventType.TILELOADEND,v=t.source.TileEventType.TILELOADERROR,T=TC.Util.detectMouse()?3:10;var _=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/"));_=_.substr(0,_.lastIndexOf("/")+1)+"css/ol.css";t.format.KMLCustom||TC.syncLoadJS(TC.apiLocation+"TC/ol/format/KMLCustom");t.format.GPXCustom||TC.syncLoadJS(TC.apiLocation+"TC/ol/format/GPXCustom");t.View.prototype.getValueForResolutionFunction=function(t){const e=t||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(e);return function(t){var n=Math.log(r/t)/Math.log(e)/i;return n=Math.max(Math.min(1,n),0)}};TC.Util.detectMobile()||(t.Overlay.prototype.updateRenderedPosition=function(e,r){const n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var a=i[0],s=i[1];if(o==t.OverlayPositioning.BOTTOM_RIGHT||o==t.OverlayPositioning.CENTER_RIGHT||o==t.OverlayPositioning.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=n.left="");const t=Math.round(r[0]-e[0]-a)/window.devicePixelRatio+"px";this.rendered.right_!=t&&(this.rendered.right_=n.right=t)}else{""!==this.rendered.right_&&(this.rendered.right_=n.right="");o!=t.OverlayPositioning.BOTTOM_CENTER&&o!=t.OverlayPositioning.CENTER_CENTER&&o!=t.OverlayPositioning.TOP_CENTER||(a-=this.element.offsetWidth/2);const r=Math.round(e[0]+a)/window.devicePixelRatio+"px";this.rendered.left_!=r&&(this.rendered.left_=n.left=r)}if(o==t.OverlayPositioning.BOTTOM_LEFT||o==t.OverlayPositioning.BOTTOM_CENTER||o==t.OverlayPositioning.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=n.top="");const t=Math.round(r[1]-e[1]-s)/window.devicePixelRatio+"px";this.rendered.bottom_!=t&&(this.rendered.bottom_=n.bottom=t)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=n.bottom="");o!=t.OverlayPositioning.CENTER_LEFT&&o!=t.OverlayPositioning.CENTER_CENTER&&o!=t.OverlayPositioning.CENTER_RIGHT||(s-=this.element.offsetHeight/2);const r=Math.round(e[1]+s)/window.devicePixelRatio+"px";this.rendered.top_!=r&&(this.rendered.top_=n.top=r)}});t.control.OverviewMap.prototype._validateExtent_=t.control.OverviewMap.prototype.validateExtent_;t.control.OverviewMap.prototype.validateExtent_=function(){this._validateExtent_();this._wrap&&this._wrap.parent.options.alwaysCentered&&this.recenter_()};t.control.OverviewMap.prototype._resetExtent_=t.control.OverviewMap.prototype.resetExtent_;t.control.OverviewMap.prototype.resetExtent_=function(){this._resetExtent_.call(this);var e=this._wrap;if(e.is3D){var r=this.ovmap_.getView(),n=r.calculateExtent(),i=e.get3DCameraLayer().getSource().getFeatures()[0];if(i){coordinates=i.getGeometry().getCoordinates();var o=coordinates[0][0],a=coordinates[0][1];if(!t.extent.containsCoordinate(n,o)||!t.extent.containsCoordinate(n,a)){var s=Math.max(n[0]-o[0],n[1]-o[1],o[0]-n[2],o[1]-n[3],n[0]-a[0],n[1]-a[1],a[0]-n[2],a[1]-n[3]);r.fit(t.extent.buffer(n,s))}}}};t.format.GML3CRS84=function(){t.format.GML3.call(this,{srsName:"CRS:84"})};TC.inherit(t.format.GML3CRS84,t.format.GML3);t.format.GML2CRS84=function(){t.format.GML2.call(this,{srsName:"CRS:84"})};TC.inherit(t.format.GML2CRS84,t.format.GML2);const S="http://www.opengis.net/gml",E="http://www.opengis.net/gml/3.2";t.format.GMLBase.prototype.MULTIPOINT_PARSERS_[E]=t.format.GMLBase.prototype.MULTIPOINT_PARSERS_[S];t.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[E]=t.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[S];t.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[E]=t.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[S];t.format.GMLBase.prototype.POINTMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.POINTMEMBER_PARSERS_[S];t.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[S];t.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[E]=t.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[S];t.format.GMLBase.prototype.RING_PARSERS[E]=t.format.GMLBase.prototype.RING_PARSERS[S];t.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[E]=t.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[S];t.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[E]=t.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[S];t.format.GML3.prototype.GEOMETRY_PARSERS[E]=t.format.GML3.prototype.GEOMETRY_PARSERS[S];t.format.GML3.prototype.MULTICURVE_PARSERS_[E]=t.format.GML3.prototype.MULTICURVE_PARSERS_[S];t.format.GML3.prototype.MULTISURFACE_PARSERS_[E]=t.format.GML3.prototype.MULTISURFACE_PARSERS_[S];t.format.GML3.prototype.CURVEMEMBER_PARSERS_[E]=t.format.GML3.prototype.CURVEMEMBER_PARSERS_[S];t.format.GML3.prototype.SURFACEMEMBER_PARSERS_[E]=t.format.GML3.prototype.SURFACEMEMBER_PARSERS_[S];t.format.GML3.prototype.SURFACE_PARSERS_[E]=t.format.GML3.prototype.SURFACE_PARSERS_[S];t.format.GML3.prototype.CURVE_PARSERS_[E]=t.format.GML3.prototype.CURVE_PARSERS_[S];t.format.GML3.prototype.ENVELOPE_PARSERS_[E]=t.format.GML3.prototype.ENVELOPE_PARSERS_[S];t.format.GML3.prototype.PATCHES_PARSERS_[E]=t.format.GML3.prototype.PATCHES_PARSERS_[S];t.format.GML3.prototype.SEGMENTS_PARSERS_[E]=t.format.GML3.prototype.SEGMENTS_PARSERS_[S];t.format.GMLBase.prototype.readFeaturesInternal=function(e,r){const n=e.localName;let i=null;if("FeatureCollection"==n){var o=this.FEATURE_COLLECTION_PARSERS[t.format.GMLBase.prototype.namespace];o.member||(o.member=t.xml.makeArrayPusher(t.format.GMLBase.prototype.readFeaturesInternal));if("http://www.opengis.net/wfs"===e.namespaceURI)i=t.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,r,this);else{this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[t.format.GMLBase.prototype.namespace];i=t.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,r,this)}}else if("featureMembers"==n||"featureMember"==n||"member"==n){const o=r[0];let a=o.featureType,s=o.featureNS;const l="p",c="p0";if(e.childNodes){a=[],s={};for(let t=0,r=e.childNodes.length;t<r;++t){const r=e.childNodes[t];if(1===r.nodeType){const t=r.nodeName.split(":").pop();if(-1===a.indexOf(t)){let e="",n=0;const i=r.namespaceURI;for(const t in s){if(s[t]===i){e=t;break}++n}e||(s[e=l+n]=i);a.push(e+":"+t)}}}if("featureMember"!=n){o.featureType=a;o.featureNS=s}}if("string"==typeof s){const t=s;(s={})[c]=t}const u={},h=Array.isArray(a)?a:[a];for(const e in s){const r={};for(let i=0,o=h.length;i<o;++i){(-1===h[i].indexOf(":")?c:h[i].split(":")[0])===e&&(r[h[i].split(":").pop()]="featureMembers"==n?t.xml.makeArrayPusher(this.readFeatureElement,this):t.xml.makeReplacer(this.readFeatureElement,this))}u[s[e]]=r}i="featureMember"==n?t.xml.pushParseAndPop(void 0,u,e,r):t.xml.pushParseAndPop([],u,e,r)}null===i&&(i=[]);return i};t.proj.proj4.register(proj4);t.proj.get("EPSG:4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.get("urn:ogc:def:crs:EPSG::4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.get("http://www.opengis.net/gml/srs/epsg.xml#4258").metersPerUnit_=t.proj.EPSG4326.METERS_PER_UNIT;t.proj.oldGet=t.proj.get;t.proj.get=function(e){if("string"==typeof e){e=e.trim();TC.loadProjDef({crs:e,sync:!0})}return t.proj.oldGet.call(this,e)};t.format.GMLBase.prototype.readGeometryElement=function(e,r){var n=r[0];n.srsName=e.firstElementChild.getAttribute("srsName");n.srsDimension=e.firstElementChild.getAttribute("srsDimension");if((this instanceof t.format.GML2CRS84||this instanceof t.format.GML3CRS84)&&("EPSG:4326"!==n.srsName||!n.srsName))throw new Error("Conflicto de CRS");n.srsName||(n.srsName=this.srsName);n.dataProjection=t.proj.get(n.srsName);const i=t.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS,e,r,this);return i?t.format.Feature.transformWithOptions(i,!1,n):void 0};const L=/^[\s\xa0]*$/;t.format.GMLBase.prototype.readFeatureElementInternal=function(e,r,n){let i;const o={};for(let a=e.firstElementChild;a;a=a.nextElementSibling){let e;const s=a.localName;if(0===a.childNodes.length||1===a.childNodes.length&&(3===a.firstChild.nodeType||4===a.firstChild.nodeType)){e=t.xml.getAllTextContent(a,!1);L.test(e)&&(e=void 0)}else{n&&(e=this.readGeometryElement(a,r));e?"boundedBy"!==s&&"referencePoint"!==s&&(i=s):e=this.readFeatureElementInternal(a,r,!1)}if(o[s]){o[s]instanceof Array||(o[s]=[o[s]]);o[s].push(e)}else o[s]=e;const l=a.attributes.length;if(l>0){o[s]={_content_:o[s]};for(let t=0;t<l;t++){const e=a.attributes[t].name;o[s][e]=a.attributes[t].value}}}if(n){const r=new t.Feature(o);i&&r.setGeometryName(i);const n=e.getAttribute("fid")||e.getAttributeNS(this.namespace,"id");n&&r.setId(n);return r}return o};const w=function(e,r){var n;if(e){n=(n=t.color.asArray(e)).slice();void 0!==r&&(n[3]=r)}else n=[0,0,0,1];return n};var b=function(t,e){var r=t.map.getView(),n=r.getResolution(),i={projection:r.getProjection(),center:r.getCenter(),resolution:n,enableRotation:!1};t.parent.maxExtent&&(i.extent=t.parent.maxExtent);var o=e;e.type===TC.Consts.layerType.VECTOR&&t.parent.getBaseLayer()&&(o=t.parent.getBaseLayer());var a,s,l=o.getResolutions?o.getResolutions():[];if(l&&l.length){a=o.maxResolution||l[0];s=o.minResolution||l[l.length-1];var c=l.indexOf(s),u=l.indexOf(a);i.resolutions=l.slice(u,c+1)}else{a=o.maxResolution;s=o.minResolution}if(s){i.minResolution=s;n<s&&(i.resolution=s)}if(a){i.maxResolution=a;n>a&&(i.resolution=a)}return i};TC.wrap.Map.prototype.setMap=function(){var e=this,r=[(e.parent.initialExtent[0]+e.parent.initialExtent[2])/2,(e.parent.initialExtent[1]+e.parent.initialExtent[3])/2],n=proj4(e.parent.crs);!function(){var r=e.parent.crs.substr(e.parent.crs.lastIndexOf(":")+1),i={units:n.oProj.units,global:!0},o=[];if("4326"!==r){i.code="EPSG:"+r;o.push(new t.proj.Projection(i));i.code="urn:ogc:def:crs:EPSG::"+r;o.push(new t.proj.Projection(i));t.proj.addEquivalentProjections(o)}t.proj.proj4.register(proj4)}();var o={code:e.parent.crs,units:n.oProj.units};"EPSG:4326"===e.parent.crs&&(o.axisOrientation="neu");var a=new t.proj.Projection(o),s=t.interaction.defaults({constrainResolution:!0}),l={projection:a,center:r,enableRotation:!1};if(e.parent.maxExtent){var u=e.parent.maxExtent;l.extent=u;var p=e.parent.div.getBoundingClientRect(),d=(p.width,p.height,u[2]-u[0]),f=u[3]-u[1];p.width/p.height>d/f?l.resolution=d/p.width:l.resolution=f/p.height}else l.zoom=2;e.map=new t.Map({target:e.parent.div,view:new t.View(l),controls:[],interactions:s,pixelRatio:1});TC.Util.detectMobile()||(e.map.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),r=t.changedTouches?t.changedTouches[0]:t;return[((r=r.clientX?r:r.pointerEvent?r.pointerEvent:r).clientX-e.left)*window.devicePixelRatio,(r.clientY-e.top)*window.devicePixelRatio]});e.map._wrap=e;e._promise=Promise.resolve(e.map);e.manageSize.call(e.map);var g=function(){e.map.updateSize()};e.parent.div.addEventListener(i,g);e.parent.one(TC.Consts.event.MAPLOAD,g);e.map.on(c,function(t){if(e.parent.view!==TC.Consts.view.PRINTING){e.parent.workLayers.forEach(function(t){delete t._noFeatureClicked});var r=e.parent.workLayers.map(function(){return!1});e.map.forEachFeatureAtPixel(t.pixel,function(t,n){if(t._wrap&&t._wrap.parent.showsPopup){for(var i=0;i<e.parent.workLayers.length;i++){if(e.parent.workLayers[i].wrap.layer===n){r[i]=!0;break}}e.parent.trigger(TC.Consts.event.FEATURECLICK,{feature:t._wrap.parent});return t}},{hitTolerance:T});for(var n=0;n<r.length;n++)r[n]||e.parent.trigger(TC.Consts.event.NOFEATURECLICK,{layer:e.parent.workLayers[n]})}});const y=function(){e.map.on(h,function(){e.parent.trigger(TC.Consts.event.ZOOM)})};e.map.getView().on("change:resolution",function(){e.map.hasListener(h)||e.map.once(h,function(){y()});e.parent.trigger(TC.Consts.event.BEFOREZOOM)},e.parent);const m=function(){if(!e.map.hasListener(h)){e.map.un("change:view",m);y()}};e.map.on("change:view",m);var C=function(r){e.map.getView().getResolution(),e.map.getView().getZoom();var n=b(e,r),i=new t.View(n);e.map.setView(i);e.map.render()};e.parent.on(TC.Consts.event.BASELAYERCHANGE,function(t){e.parent.crs!==e.parent.options.crs||e.parent.on3DView||t.layer.type===TC.Consts.layerType.VECTOR||C(t.layer)});e.parent.on(TC.Consts.event.MAPLOAD,function(t){C(e.parent.getBaseLayer())});e.map.getViewport().addEventListener(TC.Consts.event.MOUSEMOVE,function(t){var r=e.map.getTarget(),n=!1;if(!e.parent.activeControl||!e.parent.activeControl.isExclusive()){if(e.parent.view===TC.Consts.view.PRINTING)return;var i=e.map.getEventPixel(t);n=e.map.forEachFeatureAtPixel(i,function(t,r){var n=!0;!t._wrap||t._wrap.parent.showsPopup||t._wrap.parent.options.selectable||(n=!1);n&&t._wrap&&e.parent.trigger(TC.Consts.event.FEATUREOVER,{feature:t._wrap.parent});return n},{hitTolerance:T})}r.style.cursor=n?"pointer":""})};var A=function(e,r){var n=e.getUnits();return n&&n!==t.proj.Units.DEGREES?t.proj.METERS_PER_UNIT[n]:TC.Util.getMetersPerDegree(r)};TC.wrap.Map.prototype.getMetersPerUnit=function(){return A(t.proj.get(this.parent.crs),this.getExtent())};var x=function(e){e=e||{};var r=this.parent.options.crs||TC.Cfg.crs,n=t.proj.get(r),i=t.proj.get(e.crs);return A(i,e.extentInDegrees)/A(n,e.extentInDegrees)},P=function(e){var r;(r=e.axisOrientation?new t.proj.Projection({code:e.crs,axisOrientation:e.axisOrientation}):t.proj.get(e.crs)).getUnits()||(r.units_=t.proj.Units.DEGREES);return r};TC.wrap.Map.prototype.setProjection=function(e){const r=this,n=(e=e||{}).baseLayer||r.parent.baseLayer;var i;i=e.extent?e.extent:t.proj.transformExtent(r.getExtent(),r.parent.crs,e.crs);const o=t.proj.transformExtent(i,e.crs,"EPSG:4326"),a=x.call(r,{crs:e.crs,extentInDegrees:o}),s=P(e),l=r.map.getView(),c={projection:s,enableRotation:!1},u=n.getResolutions();if(u&&u.length)c.resolutions=u;else{c.minZoom=l.getMinZoom();c.maxZoom=l.getMaxZoom();const t=n.wrap.layer.getMinResolution(),e=n.wrap.layer.getMaxResolution();var h=1;if(0===t||e===Number.POSITIVE_INFINITY){h=x.call(r,{crs:r.parent.crs,extentInDegrees:o})/a}c.minResolution=0===t?l.getMinResolution()*h:t;e===Number.POSITIVE_INFINITY?c.maxResolution=l.getMaxResolution()*h:c.maxResolution=e}c.center=t.proj.transform(r.getCenter(),r.parent.crs,e.crs);var p=new t.View(c);r.map.setView(p);r.parent.initialExtent=1!==a?t.proj.transformExtent(r.parent.initialExtent,r.parent.crs,e.crs):r.parent.options.initialExtent;r.parent.options.maxExtent&&(r.parent.options.maxExtent=r.parent.maxExtent=1!==a?t.proj.transformExtent(r.parent.maxExtent,r.parent.crs,e.crs):r.parent.options.maxExtent);p.fit(i,{nearest:!0})};TC.wrap.Map.prototype.insertLayer=function(e,r){for(var n=this,i=n.map.getLayers(),o=!1,a=0;a<i.getLength();a++)if(i.item(a)===e){o=!0;break}if(o){i.remove(e);i.insertAt(r,e)}else{r<0?i.push(e):i.insertAt(r,e);var s=n.map.getView();if(n.parent.crs===n.parent.options.crs){if(e instanceof t.layer.Tile){var l=e.getSource().getResolutions();s.maxResolution_=l[0];s.minResolution_=l[l.length-1]}}else if(e instanceof t.layer.Tile){e.setMaxResolution(s.getMaxResolution());e.setMinResolution(s.getMinResolution())}var c=e._wrap,u=0,h=function(t){c.parent.state=TC.Layer.state.LOADING;if(u<=0){u=0;n.parent.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent})}e._loadingTileCount=e._loadingTileCount+1};c.parent.state===TC.Layer.state.LOADING&&c.parent.isRaster()&&h();c.$events.on(TC.Consts.event.BEFORETILELOAD,h);c.$events.on(TC.Consts.event.TILELOAD,function(t){if((u-=1)<=0){u=0;c.parent.state=TC.Layer.state.IDLE;n.parent.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent})}})}};TC.wrap.Map.prototype.removeLayer=function(t){this.map.removeLayer(t)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()};TC.wrap.Map.prototype.indexOfFirstVector=function(){var e=-1;this.map.getLayerGroup().getLayers().forEach(function(r,n){r instanceof t.layer.Vector&&-1===e&&(e=n)});return e};TC.wrap.Map.prototype.getLayerIndex=function(t){var e=-1;this.map.getLayerGroup().getLayers().forEach(function(r,n){r===t&&(e=n)});return e};TC.wrap.Map.prototype.setLayerIndex=function(t,e){var r=this.map.getLayers().getArray().indexOf(t);if(r>-1&&r!=e){this.map.removeLayer(t);this.insertLayer(t,e)}};TC.wrap.Map.prototype.setBaseLayer=function(e){var r=this;return new Promise(function(n,i){var o=function(i){if(i=i||r.parent.getBaseLayer()){r.map.removeLayer(i.wrap.layer);e instanceof t.layer.Image&&e._wrap.setProjection({crs:r.parent.crs});if(e._wrap.parent.type===TC.Consts.layerType.WMTS){var o={crs:r.parent.crs,oldCrs:e.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&e._wrap.parent.setProjection(o)}}r.insertLayer(e,0);r.map.getControls().forEach(function(e){e instanceof t.control.ZoomSlider&&e.initSlider_()});n()},a=b(r,e._wrap.parent),s=r.map.getView(),l=s.getResolution();if(a.resolutions){var c=a.resolutions.sort(function(t,e){return t-e}).reduce(function(t,e){return 0===t&&(e>l||Math.abs(1-l/e)<r.parent.options.maxResolutionError)?e:t},0);if(c!==l)if(r.parent.isLoaded)s.animate({resolution:c,duration:TC.Consts.ZOOM_ANIMATION_DURATION},o.bind(r,r.parent.getBaseLayer()));else{s.setResolution(c);o()}else o()}else o()})};TC.wrap.Map.prototype.setExtent=function(e,r){const n=this;r=r||{};const i=function(t,n,i,o){var a=t.getResolutionForExtent(e,n);if(t.constrainResolution){var s=t.constrainResolution(a,0,0);s<a&&s/a<TC.Consts.EXTENT_TOLERANCE&&(s=t.constrainResolution(s,-1,0));a=s}const l=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(void 0===r.animate||r.animate)t.animate({resolution:a,center:l,duration:TC.Consts.ZOOM_ANIMATION_DURATION},i);else{t.setCenter(l);t.setResolution(a);i()}};Promise.resolve(n._setExtentPromise).finally(function(){!function(e){n._setExtentPromise=new Promise(function(r,o){clearTimeout(n._timeout);n._timeout=setTimeout(function(){var o=n.map.getSize(),a=n.map.getView();n.parent.baseLayer?n.parent.baseLayer.wrap.getLayer().then(function(s){const l=a.getResolutionForExtent(e,o),c=n.getResolutions(),u=a.getMaxZoom();u<c.length-1&&(c.length=u+1);if(c.length>0){var h=Math.min.apply(n,c);if(h>l){var p=.5*(h/l-1),d=t.extent.getWidth(e)*p,f=t.extent.getHeight(e)*p;(e=e.slice(0))[0]=e[0]-d;e[1]=e[1]-f;e[2]=e[2]+d;e[3]=e[3]+f}}i(a,o,r)}):i(a,o,r)},50)})}(e)});return n._setExtentPromise};TC.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())};TC.wrap.Map.prototype.setCenter=function(t,e){const r=this;return new Promise(function(n,i){const o=function(){n()},a=e||{},s=r.map.getView();if(a.animate)s.animate({center:t,duration:TC.Consts.ZOOM_ANIMATION_DURATION},o);else{s.setCenter(t);n()}})};TC.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()};TC.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()};TC.wrap.Map.prototype.setResolution=function(t){this.getMap().then(function(e){e.getView().setResolution(t)})};TC.wrap.Map.prototype.setRotation=function(t){this.getMap().then(function(e){e.getView().setRotation(t)})};TC.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()};TC.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]};TC.wrap.Map.prototype.getCoordinateFromPixel=function(t){return this.map.getCoordinateFromPixel(t)};TC.wrap.Map.prototype.getPixelFromCoordinate=function(t){return this.map.getPixelFromCoordinate(t)};TC.wrap.Map.prototype.getViewport=function(t){const e=this;return(t||{}).synchronous?e.map.getViewport():new Promise(function(t,r){e.getMap().then(function(e){t(e.getViewport())})})};TC.wrap.Map.prototype.isNative=function(e){return e instanceof t.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this.map.getView().getProjection().getUnits();return!e||e===t.proj.Units.DEGREES};TC.wrap.Map.prototype.addPopup=function(e){const r=this;return new Promise(function(n,i){var o=void 0===e.options.draggable||e.options.draggable;TC.loadJS(o&&!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){r.getMap().then(function(n){if(!e.popupDiv){const a=TC.Util.getDiv();e.popupDiv=a;window.$&&(e.$popupDiv=$(a));a.classList.add(TC.control.Popup.prototype.CLASS);e.contentDiv=TC.Util.getDiv();e.contentDiv.classList.add(TC.control.Popup.prototype.CLASS+"-content");e.popupDiv.appendChild(e.contentDiv);e.menuDiv=TC.Util.getDiv();e.menuDiv.classList.add(TC.control.Popup.prototype.CLASS+"-menu");e.popupDiv.appendChild(e.menuDiv);r.parent.div.appendChild(a);var i=new t.Overlay({element:a,positioning:t.OverlayPositioning.BOTTOM_LEFT});n.addOverlay(i);e.wrap.popup=i;const s=n.getViewport();if(o){const t=e.popupDiv.parentElement;e.popupDiv.classList.add(TC.Consts.classes.DRAGGABLE);t.addEventListener("touchmove",function(t){var e=t.target;do{if(e.matches(".tc-ctl-finfo-layer-content")){t.stopPropagation();break}e=e.parentElement}while(e)});const r=new Draggabilly(t,{});r.handleEvent=function(t){this.options.not&&t.target.matches(this.options.not)||Draggabilly.prototype.handleEvent.call(this,t)};r.on("pointerDown",function(t,e){var n=t.target.getBoundingClientRect();if(n.left+t.target.clientWidth<e.pageX||n.top+t.target.clientHeight<e.pageY){r._pointerCancel(t,e);return!1}});r.on("dragStart",function(t,r){e.setDragging(!0);e._currentOffset=i.getOffset();if(e._previousContainerPosition){var o=n.getSize();i.setPosition(n.getCoordinateFromPixel([e._previousContainerPosition[0],o[1]-e._previousContainerPosition[1]]));e._currentOffset=[0,0];i.setOffset(e._currentOffset);delete e._previousContainerPosition}else e._currentOffset=i.getOffset()});r.on("dragEnd",function(r){e.setDragging(!1);var o=n.getCoordinateFromPixel([0,0]),a=n.getCoordinateFromPixel(i.getOffset()),s=[a[0]-o[0],a[1]-o[1]],l=i.getPosition();i.setPosition([l[0]+s[0],l[1]+s[1]]);i.setOffset([0,0]);e._currentOffset=[0,0];const c=t.getBoundingClientRect();e._previousContainerPosition=[c.left,c.bottom]})}const l=function(t){var e=n.getTarget(),i=!1;if(!r.parent.activeControl||!r.parent.activeControl.isExclusive()){var o=n.getEventPixel(t);i=n.forEachFeatureAtPixel(o,function(t,e){var r=!0;t._wrap&&!t._wrap.parent.showsPopup&&(r=!1);return r},{hitTolerance:T})}e.style.cursor=i?"pointer":""};s.removeEventListener("mousemove",l);s.addEventListener("mousemove",l)}});n()})})};TC.wrap.Map.prototype.hidePopup=function(t){this.parent.currentFeature=null;t.popupDiv&&t.popupDiv.classList.remove(TC.Consts.classes.VISIBLE)};TC.wrap.Map.prototype.manageSize=function(){const t=this,e=function(t){var e=window.devicePixelRatio||1,r=t.context.canvas.getBoundingClientRect(),n=e*r.width,i=e*r.height;n===r.width&&Number.isInteger(n)||(n=Math.round(n));i===r.height&&Number.isInteger(i)||(i=Math.round(i));if(n!==r.width||i!==r.height){var o=[n,i];t.target.setSize(o)}};TC.Util.detectMobile()||t.on(d,e)};var R=function(e){switch(e){case TC.Consts.layerType.KML:case TC.Consts.mimeType.KML:return new t.format.KMLCustom({showPointNames:!1});case TC.Consts.layerType.GPX:case TC.Consts.mimeType.GPX:return new t.format.GPXCustom;case TC.Consts.layerType.GEOJSON:case TC.Consts.mimeType.GEOJSON:case TC.Consts.mimeType.JSON:case TC.Consts.format.JSON:return new t.format.GeoJSON;case TC.Consts.format.GML2:return new t.format.GML2;case TC.Consts.format.GML3:return new t.format.GML3;case TC.Consts.mimeType.GML:case TC.Consts.format.GML:return new t.format.GML;case TC.Consts.format.TOPOJSON:return new t.format.TopoJSON;case TC.Consts.format.WKT:return new t.format.WKT;default:return null}};TC.wrap.Map.prototype.exportFeatures=function(e,r){r=r||{};var n=F({styles:this.parent.options.styles}),i=e.map(function(t){var e=t.wrap.feature;e.getStyle()||e.setStyle(n);const r=nt(e).getText();r&&(e=e.clone()).setProperties({name:r.getText()});return e}),o=R(r.format);if(o instanceof t.format.KML){i=i.map(function(e){const r=e.getGeometry();if(r instanceof t.geom.Point){var n=nt(e);const i=n.getImage();if(i instanceof t.style.RegularShape){const o=2*i.getRadius()+i.getStroke().getWidth()+1,a=o/2,s=document.createElement("canvas");s.width=o;s.height=o;const l=t.render.toContext(s.getContext("2d"),{size:[o,o]}),c=n.getText();(n=n.clone()).setText();l.setStyle(n);l.drawGeometry(new t.geom.Point([a,a]));const u=new t.Feature(r);u.setProperties(e.getProperties());u.setStyle(new t.style.Style({image:new t.style.Icon({src:s.toDataURL("image/png")}),text:c}));return u}}return e});const e=[];i.forEach(function(r){var n=nt(r);const i=r.getGeometry(),o=n.getText();var a;if(o){switch(!0){case i instanceof t.geom.LineString:a=new t.geom.Point(i.getCoordinateAt(.5));break;case i instanceof t.geom.Polygon:a=i.getInteriorPoint();break;case i instanceof t.geom.MultiLineString:const e=i.getLineStrings();var s=-1;a=new t.geom.Point(e[e.map(function(t){return t.getLength()}).reduce(function(t,e,r){if(e>s){s=e;return r}return t},-1)].getCoordinateAt(.5));break;case i instanceof t.geom.MultiPolygon:const r=i.getPolygons();var l=-1;a=r[r.map(function(t){return t.getArea()}).reduce(function(t,e,r){if(e>l){l=e;return r}return t},-1)].getInteriorPoint()}if(a){const r=new t.Feature(a);r.setStyle(new t.style.Style({text:o.clone(),image:new t.style.Icon({crossOrigin:"anonymous",src:TC.apiLocation+"TC/css/img/transparent.gif"})}));e.push(r)}}});e.length&&(i=i.concat(e))}if(o instanceof t.format.GMLBase){(i=i.map(function(t){return t.clone()})).forEach(function(t){const e=t.values_,r=[];for(var n in e)n.indexOf(" ")>=0&&r.push(n);r.forEach(function(t){var r=t.replace(/ /g,"_");/^\d/.test(r)&&(r="_"+r);if(t!==r)for(;void 0!==e[r];)r+="_";e[r]=e[t];delete e[t]})});o.featureNS="sitna";o.featureType="feature";var a=o.writeFeaturesNode(i,{featureProjection:this.parent.crs}),s=t.xml.createElementNS("http://www.opengis.net/gml","FeatureCollection");s.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",o.schemaLocation);a.removeAttribute("xmlns:xsi");a.removeAttribute("xsi:schemaLocation");s.appendChild(a)}o instanceof t.format.GPX&&(i=i.map(function(e){const r=e.getGeometry();r instanceof t.geom.LineString&&(e=e.clone()).setGeometry(new t.geom.MultiLineString([r.getCoordinates()]));return e}));var l=o.writeFeatures(i,{dataProjection:"EPSG:4326",featureProjection:this.parent.crs});o instanceof t.format.GPX&&(l=l.replace(/<ele>NaN<\/ele>/g,""));return l};var I=function(t){for(var e=0,r=t.dataTransfer.types.length;e<r;e++)if("Files"===t.dataTransfer.types[e])return!0;return!1},M=function(t){if(I(t)){this.getMap()._wrap.parent.div.classList.add(TC.Consts.classes.DROP);t.preventDefault();t.stopPropagation()}},O=function(t){if(I(t)){var e=this.getMap()._wrap.parent;t.target===this.target&&e.div.classList.remove(TC.Consts.classes.DROP)}};TC.wrap.Map.prototype.enableDragAndDrop=function(e){var r=this,n=e||{},i={formatConstructors:[t.format.KMLCustom,t.format.GPXCustom,t.format.GML3CRS84,t.format.GML2CRS84,t.format.GML3,t.format.GML2,t.format.GeoJSON,function(){return new t.format.WKT({splitCollection:!0})},t.format.TopoJSON]};n.dropTarget?i.target=TC.getDiv(n.dropTarget):i.target=r.parent.div;var l=new t.interaction.DragAndDrop(i);l.on("addfeatures",function(t){var e=t.features?t.features.map(function(t){return TC.wrap.Feature.createFeature(t)}):[];Promise.all(e).then(function(e){var n=r.parent.getLoadingIndicator();n&&n.removeWait(r._featureImportWaitId);e.length&&!e.some(function(t){return!t.geometry})?r.parent.trigger(TC.Consts.event.FEATURESIMPORT,{features:e,fileName:t.file.name,dropTarget:t.target.target}):r.parent.trigger(TC.Consts.event.FEATURESIMPORTERROR,{file:t.file})})});if(n.once)l.map_=r.map;else{r.map.addInteraction(l);var c=l.target?l.target:r.map.getViewport(),u=function(t){if(I(t)){var e=r.parent;if(l.target===t.target){var n=e.getLoadingIndicator();n&&(r._featureImportWaitId=n.addWait());t.stopPropagation()}else t.preventDefault();e.div.classList.remove(TC.Consts.classes.DROP)}};l.dropListenKeys_.push(t.events.listen(c,o,M,l));l.dropListenKeys_.push(t.events.listen(document.body,o,M,l));l.dropListenKeys_.push(t.events.listen(c,a,M,l));l.dropListenKeys_.push(t.events.listen(document.body,a,M,l));l.dropListenKeys_.push(t.events.listen(c,s,u,l));l.dropListenKeys_.push(t.events.listen(document.body,s,u,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragleave",O,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragend",O,l));l.dropListenKeys_.push(t.events.listen(document.body,"dragexit",O,l));document.addEventListener("mouseenter",function(t){t.buttons||r.parent.div.classList.remove(TC.Consts.classes.DROP)},!1);r.ddEnabled=!0}return l};TC.wrap.Map.prototype.loadFiles=function(e,r){var n,i=this;i.ddEnabled?i.map.getInteractions().forEach(function(e){e instanceof t.interaction.DragAndDrop&&(n=e)}):n=i.enableDragAndDrop({once:!0});if(n&&r){var o=n.target;n.target=r.control;const t=function(e){n.target=o;i.parent.off(TC.Consts.event.FEATURESIMPORT,t)};i.parent.on(TC.Consts.event.FEATURESIMPORT,t)}var a=i.parent.getLoadingIndicator();a&&(i._featureImportWaitId=a.addWait());for(let r=0,i=e.length;r<i;++r){const i=e.item(r),o=new FileReader;o.addEventListener(t.events.EventType.LOAD,n.handleResult_.bind(n,i));o.readAsText(i)}};TC.wrap.Layer.prototype.getVisibility=function(){const t=this;var e=!1;t.layer&&(e=t.layer.getVisible());return e};TC.wrap.Layer.prototype.setVisibility=function(t){this.getLayer().then(function(e){e.setVisible(t)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof t.layer.Layer};TC.wrap.Layer.prototype.setProjection=function(e){const r=this;e=e||{};const n=r.parent;if(n.map){const a=x.call(r,{crs:e.crs,extentInDegrees:t.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326")});var i=n.getResolutions();if(i&&i.length){i=i.map(function(t){return t/a});n.wrap.layer.setMaxResolution(i[0]);n.wrap.layer.setMinResolution(i[i.length-1])}else if(!e.oldCrs||t.proj.get(e.oldCrs).getUnits()!==t.proj.Units.METERS||t.proj.get(e.crs).getUnits()&&t.proj.get(e.crs).getUnits()!==t.proj.Units.DEGREES){if(e.oldCrs&&t.proj.get(e.oldCrs).getUnits()===t.proj.Units.DEGREES&&t.proj.get(e.crs).getUnits()===t.proj.Units.METERS){var o=TC.Util.getMetersPerDegree(t.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326"));if(n.minResolution){n.minResolution=n.minResolution*o;r.layer.setMinResolution(n.minResolution)}if(n.maxResolution){n.maxResolution=n.maxResolution*o;r.layer.setMaxResolution(n.maxResolution)}}}else{if(n.minResolution){n.minResolution=n.minResolution/a;r.layer.setMinResolution(n.minResolution)}if(n.maxResolution){n.maxResolution=n.maxResolution/a;r.layer.setMaxResolution(n.maxResolution)}}}};TC.wrap.layer.Raster.prototype.WmsParser=t.format.WMSCapabilities;TC.wrap.layer.Raster.prototype.WmtsParser=t.format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(t){var e=this;t.on("change:visible",function(){e.parent.map&&e.parent.map.trigger(TC.Consts.event.LAYERVISIBILITY,{layer:e.parent})},e.parent.map)};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var t=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:for(var e=this.parent.capabilities.Capability.Request.GetMap.DCPType,r=0;r<e.length;r++)if(e[r].HTTP&&e[r].HTTP.Get){t=e[r].HTTP.Get.OnlineResource;break}break;case TC.Consts.layerType.WMTS:t=this.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const n=document.createDocumentFragment(),i=document.createElement("textarea");n.appendChild(i);i.innerHTML=t;return t=i.textContent};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Capability.Request.GetFeatureInfo&&(t=e.Capability.Request.GetFeatureInfo.Format);return t};TC.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var t=null,e=this.parent.capabilities;if(e&&e.Contents)for(var r=0;r<e.Contents.Layer.length;r++)for(var n=e.Contents.Layer[r],i=0;i<n.TileMatrixSetLink.length;i++)if(this.parent.options.matrixSet===n.TileMatrixSetLink[i].TileMatrixSet){t=n;break}return t};TC.wrap.layer.Raster.prototype.getTileMatrix=function(t){var e=null,r=this.parent.capabilities;if(r&&r.Contents&&r.Contents.TileMatrixSet)for(var n=0;n<r.Contents.TileMatrixSet.length;n++){var i=r.Contents.TileMatrixSet[n];if(i.Identifier===t){e=i.TileMatrix;break}}return e};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(t){var e=[];t.ScaleDenominator?e=[t.ScaleDenominator,t.ScaleDenominator]:(t.MinScaleDenominator||t.MaxScaleDenominator)&&(e=[t.MaxScaleDenominator,t.MinScaleDenominator]);if(!e.length&&!this.getName(t)){for(var r=this.getLayerNodes(t),n=-1/0,i=1/0,o=0,a=r.length;o<a;o++){var s=this.getScaleDenominators(r[o]);s[0]>n&&(n=s[0]);s[1]<i&&(i=s[1])}n>-1/0&&i<1/0&&(e=[n,i])}return e};TC.wrap.layer.Raster.prototype.getAttribution=function(){const t={},e=TC.capabilities[this.parent.url];if(e)if(e.ServiceProvider){t.name=e.ServiceProvider.ProviderName.trim();t.site=e.ServiceProvider.ProviderSite;t.site.href&&t.site.href.trim().length>0&&(t.site=t.site.href)}else e.ServiceIdentification?t.name=e.ServiceIdentification.Title.trim():t.name=e.Service.Title.trim();return t};TC.wrap.layer.Raster.prototype.getInfo=function(t){var e=this,r={},n=e.parent.capabilities;if(n&&n.Capability)for(var i=e.getAllLayerNodes(),o=0;o<i.length;o++){var a=i[o];if(e.parent.compareNames(e.getName(a),t)){a.Title&&(r.title=a.Title);a.Abstract&&(r.abstract=a.Abstract);r.legend=[];var s=function(t,r){if(t.Layer&&t.Layer.length>0)for(var n in t.Layer)s(t.Layer[n],r);else r.apply(e,[t])};s(a,function(t){var e=this.getLegend(t);e.src&&r.legend.push({src:e.src,title:t.Title})});if(a.MetadataURL&&a.MetadataURL.length){r.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];r.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}r.queryable=a.queryable;break}}return r};TC.wrap.layer.Raster.prototype.getServiceType=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Capability.Request&&e.Capability.Request.GetMap?t=TC.Consts.layerType.WMS:e.OperationsMetadata&&e.OperationsMetadata.GetTile&&(t=TC.Consts.layerType.WMTS);return t};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var t=null,e=this.parent.capabilities;e.Capability&&e.Service?t=e.Service.Title:e.ServiceIdentification&&(t=e.ServiceIdentification.Title);return t};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var t;this.getServiceType()===TC.Consts.layerType.WMS&&(t=this.parent.capabilities.Capability.Layer);return t};TC.wrap.layer.Raster.prototype.getName=function(t,e){var r=t.Name;if(r&&e){var n=r.indexOf(":");n>=0&&(r=r.substr(n+1))}return r};TC.wrap.layer.Raster.prototype.getIdentifier=function(t){return t.Identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(t){var e=t.Layer;Array.isArray(e)||(e=e?[e]:[]);return e};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var t=this;if(!t._layerList)switch(t.getServiceType()){case TC.Consts.layerType.WMS:var e=t.getRootLayerNode();t._layerList=e?function e(r){for(var n=[r],i=t.getLayerNodes(r),o=0;o<i.length;o++)n=n.concat(e(i[o]));return n}(e):[];break;case TC.Consts.layerType.WMTS:t._layerList=t.parent.capabilities.Contents.Layer.slice();break;default:t._layerList=[]}return t._layerList};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(t){return t};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(t){return t};TC.wrap.layer.Raster.prototype.getLegend=function(t){var e={},r=t.Style;if(r&&r.length&&r.length&&r[0].LegendURL&&r[0].LegendURL.length){var n=r[0].LegendURL[0];const t=document.createDocumentFragment(),i=document.createElement("textarea");t.appendChild(i);i.innerHTML=n.OnlineResource;e.src=i.textContent}return e};TC.wrap.layer.Raster.prototype.isCompatible=function(t){var e=this,r=!0,n=e.parent;switch(e.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.Capability&&n.capabilities.Capability.Layer&&n.names.length>0)for(var i=n.names.slice(0),o=function r(i,o,a){var s=!1;if(i)for(var l=0;l<i.length;l++){var c=i[l];const h=c.CRS||c.SRS,p=Array.isArray(h)?h:[h];var u=a||p.indexOf(t)>=0;if(n.compareNames(e.getName(c),o)){u&&(s=!0);break}if(r(c.Layer,o,u)){s=!0;break}}return s};i.length>0;)if(!o([n.capabilities.Capability.Layer],i.pop())){r=!1;break}break;case TC.Consts.layerType.WMTS:r=!1;if(n.capabilities&&n.capabilities.Contents&&n.capabilities.Contents.TileMatrixSet)for(var a=n.capabilities.Contents.TileMatrixSet,s=0;s<a.length;s++)if(a[s].Identifier===n.options.matrixSet){r=TC.Util.CRSCodesEqual(t,a[s].SupportedCRS);break}}return r};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var t=[],e=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0){const r=e.names.map(function(t){return e.getNodePath(t).map(function(t){const e=t.CRS||t.SRS||[],r=Array.isArray(e)?e:[e];return Array.isArray(r)?r:[r]}).reduce(function(t,e){if(0===t.length)return e;e.forEach(function(e){t.indexOf(e)<0&&(t[t.length-1]=e)});return t},[])});if(1===r.length)t=r[0];else{const e=r.slice(1);t=r[0].filter(function(t){return e.every(function(e){return e.indexOf(t)>=0})})}}break;case TC.Consts.layerType.WMTS:e.capabilities&&e.capabilities.Contents&&e.capabilities.Contents.Layer.filter(function(t){return t.Identifier===e.layerNames}).forEach(function(r){const n=r.TileMatrixSetLink.map(function(t){return t.TileMatrixSet});t=e.capabilities.Contents.TileMatrixSet.filter(function(t){return n.indexOf(t.Identifier)>=0}).map(function(t){return t.SupportedCRS})})}return t};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(t){var e=[],r=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer){var n=function(t,r,i){var o=t.CRS||t.SRS,a=Array.isArray(o)?o:[o],s=i||a.indexOf(r)>=0;s&&t.Name&&(e[e.length]=t.Name);if(t.Layer)for(var l=0;l<t.Layer.length;l++)n(t.Layer[l],r,s)};n(r.capabilities.Capability.Layer,t)}break;case TC.Consts.layerType.WMTS:if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var i=r.capabilities.Contents.TileMatrixSet,o=0,a=i.length;o<a;o++){var s=i[o];if(TC.Util.CRSCodesEqual(t,s.SupportedCRS))for(var l=s.Identifier,c=r.capabilities.Contents.Layer,u=0,h=c.length;u<h;u++)for(var p=c[u].TileMatrixSetLink,d=0,f=p.length;d<f;d++)if(p[d].TileMatrixSet===l){e[e.length]=c[u].Identifier;break}}}return e};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(t){var e=[];P({crs:t});var r=this.parent;if(this.getServiceType()===TC.Consts.layerType.WMTS)for(var n=r.capabilities.Contents.Layer,i=r.capabilities.Contents.TileMatrixSet,o=0,a=n.length;o<a;o++)if(r.layerNames===n[o].Identifier)for(var s=n[o].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],h=0,p=i.length;h<p;h++){var d=i[h];if(d.Identifier===u.TileMatrixSet){TC.Util.CRSCodesEqual(t,d.SupportedCRS)&&(e[e.length]=d.Identifier);break}}return e};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){var t=this;t.getLayer().then(function(e){t.parent.options=t.parent.options||{};var r=e.getSource().getUrls();t.parent.options.urlPattern=r[r.length-1]})};TC.wrap.layer.Raster.prototype.createWMSLayer=function(e,r,n){const i=this;var o=null,a=new t.source.ImageWMS({url:e,crossOrigin:n.map?n.map.options.crossOrigin:void 0,params:r,extent:TC.Cfg.initialExtent,ratio:TC.Cfg.imageRatio,imageLoadFunction:i.parent.getImageLoad.bind(i.parent)});a.on("imageloadstart",function(t){i.trigger(TC.Consts.event.BEFORETILELOAD,{tile:t.image.getImage()})});a.on("imageloadend",function(t){i.trigger(TC.Consts.event.TILELOAD,{tile:t.image.getImage()})});a.on("imageloaderror",function(t){i.trigger(TC.Consts.event.TILELOAD,{tile:t.image.getImage()})});var s={visible:!!r.LAYERS.length||n&&n.method&&"POST"===n.method,source:a};n.minResolution&&(s.minResolution=n.minResolution);n.maxResolution&&(s.maxResolution=n.maxResolution);(o=new t.layer.Image(s))._wrap=i;i.addCommonEvents(o);return o};var N=function(e){var r=this,n=null,i=t.source.WMTS.optionsFromCapabilities(r.parent.capabilities,{layer:e.layerNames,matrixSet:e.matrixSet,crossOrigin:e.map?e.map.options.crossOrigin:void 0,requestEncoding:e.encoding,format:e.format});if(i){"https:"===location.protocol&&(i.urls=i.urls.map(function(t){return t.replace("http:","https:")}));i.crossOrigin=e.map?e.map.options.crossOrigin:void 0;(n=new t.source.WMTS(i)).setTileLoadFunction(r.parent.getImageLoad.bind(r.parent));n.on(m,function(t){r.trigger(TC.Consts.event.BEFORETILELOAD,{tile:t.tile.getImage()})});n.on(C,function(t){r.trigger(TC.Consts.event.TILELOAD,{tile:t.tile.getImage()})});n.on(v,function(t){r.trigger(TC.Consts.event.TILELOAD,{tile:t.tile.getImage()})});var o=n.getResolutions.bind(n);n.getResolutions=function(){var t=o(),e=r.parent.getLimitedMatrixSet();if(e&&e.length){var n=e[0].matrixIndex;t=t.slice(n,e.length+n)}return t}}return n};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(e){const r=this;var n=null,i=N.call(r,e);if(i){var o={source:i};e.minResolution&&(o.minResolution=e.minResolution);e.maxResolution&&(o.maxResolution=e.maxResolution);(n=new t.layer.Tile(o))._wrap=r;r.addCommonEvents(n);var a=i.getResolutions();n.setMaxResolution(a[0]+1);n.setMinResolution(a[a.length-1])}return n};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()};TC.wrap.layer.Raster.prototype.setParams=function(t){this.layer.getSource().updateParams(t)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(t){const e=this;e.layer.getSource().getResolutions();if(e.parent.type===TC.Consts.layerType.WMTS){const r=N.call(e,TC.Util.extend({},e.parent.options,{matrixSet:t})),n=r.getResolutions(),i=n[0],o=n[n.length-1];e.layer.setMaxResolution(i);e.layer.setMinResolution(o);e.parent.minResolution&&(e.parent.minResolution=o);e.parent.maxResolution&&(e.parent.maxResolution=i);e.layer.setSource(r)}};TC.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var t=this.layer.getSource();return t.getResolutions?t.getResolutions():[]}return[]};TC.wrap.layer.Raster.prototype.setResolutions=function(t){if(this.layer.getSource){var e=this.layer.getSource();e.resolutions_?e.resolutions_=t:e.tileGrid&&(e.tileGrid.resolutions_=t)}};TC.wrap.Geometry={getNearest:function(e,r){return new t.geom.LineString(r).getClosestPoint(e)}};var k=function(t,e,r){if(t){var n=function(n){var i=(r&&r._wrap?r._wrap.parent.options.width:null)||e;if(i<n){var o=i/n;t.setScale(o)}},i=t.getSize();if(i)n(i[0]);else{var o=t.getImage();if(o.naturalWidth)n(o.naturalWidth);else{const e=document.createDocumentFragment(),r=document.createElement("img");r.src=t.getSrc();r.addEventListener("load",function(){n(this.naturalWidth)});e.appendChild(r)}}}},D=function(t,e){var r=t,n=e&&e.wrap&&e.wrap.feature;if("string"==typeof t){var i=t.match(/^\$\{(.+)\}$/);if(i&&n){for(var o=i[1].split("."),a=n.getProperties(),s=0;s<o.length&&void 0!==a;s++)a=a[o[s]];if(void 0===a){a=e.data;for(s=0;s<o.length&&void 0!==a;s++)a=a[o[s]]}r=a}}else TC.Util.isFunction(t)&&(r=t(e));return r},F=function(e,r){var n,i,o,a,s,l={};if(r){switch(r.getGeometry().getType()){case"Point":case"MultiPoint":i=!0;break;case"LineString":case"MultiLineString":o=!0;break;case"Polygon":case"MultiPolygon":a=!0}n=r._wrap?r._wrap.parent:{id:TC.wrap.Feature.prototype.getId.call({feature:r}),features:r.get("features"),getData:function(){return TC.wrap.Feature.prototype.getData.call({feature:r})}}}var c={};if((s=n&&Array.isArray(n.features)&&n.features.length>1&&e.cluster?TC.Util.extend(!0,{},TC.Cfg.styles.cluster,e.cluster.styles):e.styles||TC.Cfg.styles).line&&(o||!r)){c=s.line;l.stroke=new t.style.Stroke({color:D(s.line.strokeColor,n),width:D(s.line.strokeWidth,n),lineDash:s.line.lineDash})}if(s.polygon&&(a||!r)){c=s.polygon;l.fill=new t.style.Fill({color:w(D(s.polygon.fillColor,n),D(s.polygon.fillOpacity,n))});l.stroke=new t.style.Stroke({color:D(s.polygon.strokeColor,n),width:D(s.polygon.strokeWidth,n),lineDash:s.polygon.lineDash})}if(s.point&&(i||!r)){c=s.point;var u={radius:D(c.radius,n)||(D(c.height,n)+D(c.width,n))/4};c.fillColor&&(u.fill=new t.style.Fill({color:w(D(c.fillColor,n),D(c.fillOpacity,n))}));c.strokeColor&&(u.stroke=new t.style.Stroke({color:D(c.strokeColor,n),width:D(c.strokeWidth,n),lineDash:c.lineDash}));isNaN(u.radius)||(l.image=new t.style.Circle(u))}c.label&&(l.text=B(c,n));if(s.marker&&(i||!r)){if((c=s.marker).url){l.image=new t.style.Icon({crossOrigin:"anonymous",anchor:c.anchor,anchorXUnits:c.anchorXUnits||"fraction",anchorYUnits:c.anchorYUnits||"fraction",src:c.url});l.text=B(c,n)}}return[new t.style.Style(l)]};const B=function(e,r){if(!e||!e.label)return;const n={text:""+D(e.label,r)};e.fontSize&&(n.font=D(e.fontSize,r)+"pt sans-serif");e.angle&&(n.rotation=-Math.PI*D(e.angle,r)/180);e.fontColor&&(n.fill=new t.style.Fill({color:w(D(e.fontColor,r),1)}));e.labelOutlineColor&&(n.stroke=new t.style.Stroke({color:w(D(e.labelOutlineColor,r),1),width:D(e.labelOutlineWidth,r)}));if(e.labelOffset){n.offsetX=e.labelOffset[0];n.offsetY=e.labelOffset[1]}return new t.style.Text(n)};var G=function(t){var e=t.toString(16);1===e.length&&(e="0"+e);return e},U=function(t){return"#"+G(t[0])+G(t[1])+G(t[2])},j=function(e,r){var n={};TC.Util.isFunction(e)&&r&&(e=e(r));Array.isArray(e)&&(e=e[0]);if(!TC.Util.isFunction(e)){var i,o,a,s=e.getImage();if(s)if(s instanceof t.style.RegularShape){if(i=(o=s.getStroke()).getColor()){i=t.color.asArray(i);n.strokeColor=U(i)}n.strokeWidth=o.getWidth();if(a=s.getFill()){if(i=a.getColor()){i=t.color.asArray(i);n.fillColor=U(i)}n.fillOpacity=i[3]}}else{n.url=s.getSrc();var l=s.getSize();if(l){n.width=l[0];n.height=l[1];n.anchor=s.getAnchor();if(n.anchor){n.anchor[0]=n.anchor[0]/n.width;n.anchor[1]=n.anchor[1]/n.height}}}else{if(o=e.getStroke()){if(i=o.getColor()){i=t.color.asArray(i);n.strokeColor=U(i)}n.strokeWidth=o.getWidth();n.lineDash=o.getLineDash()}if(a=e.getFill()){if(i=a.getColor()){i=t.color.asArray(i);n.fillColor=U(i)}n.fillOpacity=i[3]}}}return n};TC.wrap.layer.Vector.prototype.getStyle=function(){return j(this.layer.getStyle())};TC.wrap.layer.Vector.prototype.reloadSource=function(){const e=this;return new Promise(function(r,n){const i=e.createVectorSource(e.parent,e.createStyles(e.parent));if(e.parent.type===TC.Consts.layerType.WFS)var o=i.source.on("change",function(e){if("ready"==i.source.getState()){t.Observable.unByKey(o);r()}});var a=e.layer.getSource().getFeatures();e.layer.setSource(i.source);i.style&&e.layer.setStyle(i.style);if(e.parent.type!=TC.Consts.layerType.WFS){i.source.addFeatures(a);r()}})};TC.wrap.layer.Vector.prototype.import=function(t){var e=TC.Util.extend({},t);e.type=t.format;var r=this.layer.getSource().getFeatures(),n=this.createVectorSource(e,this.createStyles(this.parent));this.layer.setSource(n.source);n.style&&this.layer.setStyle(n.style);n.source.addFeatures(r)};const q=function(e){e._wrapPromise||(e._wrapPromise=new Promise(function(r,n){var i,o=e.getGeometry();const a=e.getStyle();a&&(i=j(a,e));const s=function(t){t?TC.loadJS(!TC.feature||!TC.feature[t],TC.apiLocation+"TC/feature/"+t,function(){r(new TC.feature[t](e,i))}):r(new TC.Feature(e,i))};o instanceof t.geom.Point?!function(e){var r=null,n=nt(e,!0);if(n){var i=n.getImage();i instanceof t.style.Icon&&(r=i.getSrc())}return r}(e)?s("Point"):s("Marker"):o instanceof t.geom.LineString?s("Polyline"):o instanceof t.geom.Polygon?s("Polygon"):o instanceof t.geom.MultiLineString?s("MultiPolyline"):o instanceof t.geom.MultiPolygon?s("MultiPolygon"):s()}));return e._wrapPromise};TC.wrap.layer.Vector.prototype.createVectorSource=function(e,r){var n,i,o,a,s,c=this,u=!1;if(Array.isArray(e.url)||e.urls){var h=e.urls||e.url;i={url:h=h.map(function(t,e){return TC.proxify(t)}),format:new t.format.KMLCustom({showPointNames:!1}),projection:e.crs}}else if(e.url&&e.type!==TC.Consts.layerType.WFS){(i={url:TC.proxify(e.url),projection:e.crs}).format=R(e.format)||R(function(t){var e=t.indexOf("?");e>=0?t=t.substr(0,e):(e=t.indexOf("#"))>=0&&(t=t.substr(0,e));switch(t.substr(t.lastIndexOf(".")+1).toLowerCase()){case"kml":return TC.Consts.mimeType.KML;case"json":case"geojson":return TC.Consts.mimeType.GEOJSON;case"gml":return TC.Consts.mimeType.GML;case"gpx":return TC.Consts.mimeType.GPX;default:return null}}(e.url))||R(e.type);i.loader=(o=i.url,a=i.format,s=t.featureloader.xhr(o,a),function(t,e,r){c.parent.state=TC.Layer.state.LOADING;c.parent.map&&c.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent});s.call(this,t,e,r)});u=!0}else if(e.data)(i={projection:e.crs,loader:function(t,r,n){c.parent.state=TC.Layer.state.LOADING;c.parent.map&&c.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent});var i=this.getFormat();try{var o=i.readFeatures(e.data,{featureProjection:n});this.addFeatures(o);c.parent.state=TC.Layer.state.IDLE;c.parent.map&&c.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent,newData:data})}catch(t){c.parent.state=TC.Layer.state.IDLE;c.parent.map&&c.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:c.parent,reason:t.message})}}}).format=R(e.format)||R(e.type);else if(e.type==TC.Consts.layerType.WFS){var p,d;switch(e.outputFormat){case TC.Consts.format.JSON:p=new t.format.GeoJSON({geometryName:e.geometryName});d="json";break;case TC.Consts.format.GML3:p=new t.format.GML3;d=TC.Consts.mimeType.GML;break;default:p=new t.format.GML2;d=TC.Consts.mimeType.GML}i={format:p,loader:function(t,r,n){var i=this,o=e.url;if(o){c.parent.state=TC.Layer.state.LOADING;c.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent});var a={},s=n.getCode(),l=e.version||"1.1.0",u=o,h=Array.isArray(e.featureType)?e.featureType:[e.featureType];if(!e.properties||e.properties instanceof Array&&!e.properties.length||!Object.keys(e.properties).length){u=u+"?service=WFS&version="+l+"&request=GetFeature&typename="+h.join(",")+"&outputFormat="+d+"&srsname="+s;t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0&&(u=u+"&bbox="+t.join(",")+","+s);e.maxFeatures&&(u=u+"maxFeatures="+e.maxFeatures)}else{a.method="POST";switch(d){case"json":a.responseType=TC.Consts.mimeType.JSON;break;default:a.responseType=TC.Consts.mimeType.XML}var f=[];f[f.length]='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="';f[f.length]=l;f[f.length]='" outputFormat="';f[f.length]=e.outputFormat;if(e.maxFeatures){f[f.length]='" maxFeatures="';f[f.length]=e.maxFeatures}f[f.length]='" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/';f[f.length]=l;f[f.length]='/wfs.xsd">';for(var g=0;g<h.length;g++){f[f.length]='<wfs:Query typeName="feature:';f[f.length]=h[g];f[f.length]='" srsName="';f[f.length]=s;f[f.length]='">';if(e.propertynames){var y="1.1.0"===l?"wfs":"ogc",m="string"==typeof e.propertynames?e.propertynames.split(","):e.propertynames;e.geometryName&&m.push(e.geometryName);for(;g<m.length;g++)f[f.length]="<"+y+":PropertyName>"+m[g].trim()+"</"+y+":PropertyName>"}f[f.length]=e.properties.getText();f[f.length]="</wfs:Query>"}f[f.length]="</wfs:GetFeature>";a.data=f.join("");a.contentType=TC.Consts.mimeType.XML}a.url=u;c._requestUrl=u;TC.ajax(a).then(function(t){const e=t.data,r=p.readFeatures(e),n=function(){c.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent,newData:e})},o=function(t){if(t.layer===c.parent){c.parent.map.off(TC.Consts.event.FEATURESADD,o);n()}};if(r.length){i.addFeatures(r);c.parent.map.on(TC.Consts.event.FEATURESADD,o)}else n();c.parent.state=TC.Layer.state.IDLE})}},projection:e.crs}}n=new t.source.Vector(i);u&&n.on(l,function(t){c.parent.map&&c.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent})});n._tcLayer=c.parent;var m=e.style&&e.style.marker?e.style.marker:TC.Cfg.styles.marker;e.style&&e.style.marker||(m=TC.Util.extend({},m,{anchor:TC.Cfg.styles.point.anchor}));if(e.cluster){n=new t.source.Cluster({projection:e.crs,distance:e.cluster.distance,source:n});if(e.cluster.animate){var C=function(e,r){var n=Date.now(),i=e.getGeometry().getCoordinates(),o=r.getGeometry().getCoordinates();r.setGeometry(new t.geom.Point(i));requestAnimationFrame(function a(){var s=function(t,e,r,n){var i=Math.min((Date.now()-n)/r,1),o=(e[0]-t[0])*i,a=(e[1]-t[1])*i;return[t[0]+o,t[1]+a]}(i,o,TC.Consts.CLUSTER_ANIMATION_DURATION,n);r.setGeometry(new t.geom.Point(s));s[0]!==o[0]&&s[1]!==o[1]?requestAnimationFrame(a):v.splice(v.indexOf(e),1)})},v=[];n.addEventListener(g,function(t){var e=t.feature.get("features");e&&e.length>1&&v.push(t.feature)});n.addEventListener(f,function(t){var e=t.feature.get("features");if(e){var r=e[0].getGeometry().getCoordinates();if(e.length>1){var n=v.filter(function(t){var e=t.getGeometry().getCoordinates();return e[0]===r[0]&&e[1]===r[1]});n.length&&v.splice(v.indexOf(n[0]),1)}var i=v.filter(function(t){var e=t.get("features");if(e&&e.length>0){return e.filter(function(t){var e=t.getGeometry().getCoordinates();return e[0]===r[0]&&e[1]===r[1]}).length>0}});i.length&&C(i[i.length-1],t.feature)}})}}var T=n;do{T.addEventListener(f,function(t){var e=t.feature,r=nt(e,!0);r&&k(r.getImage(),m.width,e)});T=TC.Util.isFunction(T.getSource)?T.getSource():null}while(T);n.addEventListener(f,function(t){const e=t.feature,r=function(t){var r;switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:r=c.parent.addPoint;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:r=c.parent.addPolyline;break;case TC.feature.Polygon&&t instanceof TC.feature.Polygon:r=c.parent.addPolygon;break;case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:r=c.parent.addMultiPolygon;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:r=c.parent.addMultiPolyline;break;default:r=c.parent.addFeature}if(r){var n;r.call(c.parent,e).then(function(r){var i=e.get("features");Array.isArray(i)&&(r.features=i.map(function(e){return new t.constructor(e)}));clearTimeout(n);n=setTimeout(function(){c.parent.map.trigger(TC.Consts.event.FEATURESADD,{layer:c.parent,features:[r]})},50)})}};e._wrap&&e._wrap.parent.layer||q(e).then(r)});n.addEventListener(g,function(t){var e=t.feature;if(e._wrap){var r=c.parent.features.indexOf(e._wrap.parent);if(r>-1){c.parent.features.splice(r,1);c.parent.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:c.parent,feature:e._wrap.parent})}}});n.addEventListener(f,function(t){c.parent.map&&c.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:c.parent})});n.addEventListener(g,function(){c.parent.map&&c.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:c.parent})});n.addEventListener(y,function(){c.parent.map&&c.parent.map.trigger(TC.Consts.event.FEATURESCLEAR,{layer:c.parent})});var _={source:n};e.minResolution&&(_.minResolution=e.minResolution);e.maxResolution&&(_.maxResolution=e.maxResolution);i&&i.format instanceof t.format.KML&&!e.cluster||(_.style=r||e.styles);return _};TC.wrap.layer.Vector.prototype.createStyles=function(t){var e=this,r=!1;if(TC.Util.isFunction(t)){r=!0;e.styleFunction=function(e){return F(t(e))}}else{(t=TC.Util.extend({},t)).crs=t.crs||TC.Cfg.crs;t.styles=t.styles||TC.Cfg.styles;r=!(!t.cluster||!t.cluster.styles)||function t(e){for(var r in e){var n=e[r];switch(typeof n){case"string":if(/^\$\{(.+)\}$/.test(n))return!0;break;case"object":if(t(n))return!0;break;case"function":return!0}}return!1}(t.styles);e.styleFunction=function(t){return F(e.parent.options,t)}}return r?e.styleFunction:e.styleFunction()};TC.wrap.layer.Vector.prototype.setStyles=function(t){const e=this;e.getLayer().then(function(r){r.setStyle(e.createStyles(t))})};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=null,r=this.parent.options,n=this.createVectorSource(r,this.createStyles(r));n.declutter=this.parent.options.declutter||!1;(e=new t.layer.Vector(n))._wrap=this;this.addCommonEvents(e);return e};TC.wrap.layer.Vector.prototype.addFeatures=function(t){const e=this,r=function(e){for(var r=e;TC.Util.isFunction(r.getSource);)r=r.getSource();r.addFeatures(t)};e.layer?r(e.layer):e.getLayer().then(r)};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();return e instanceof t.layer.Layer?e.getSource().getFeatures():[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var r=this.layer;return r instanceof t.layer.Layer?r.getSource().getFeatureById(e):null};TC.wrap.layer.Vector.prototype.removeFeature=function(t){const e=this,r=function(e){if(t.wrap.feature){e.getSource().removeFeature(t.wrap.feature)}};e.layer?r(e.layer):e.getLayer().then(r)};TC.wrap.layer.Vector.prototype.clearFeatures=function(){const t=this,e=function(t){var e=t.getSource();e.clearFeatures?e.clearFeatures():e.clear()};t.layer?e(t.layer):t.getLayer().then(e)};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,r){var n=this,i={color:"rgba(0, 0, 0, 0)"},o={color:"rgba(0, 0, 0, 0)"},a=new t.style.Style({image:new t.style.Circle({radius:0,fill:new t.style.Fill(i),stroke:new t.style.Stroke(o)}),fill:new t.style.Fill(i),stroke:new t.style.Stroke(o)});if(n.parent.features.indexOf(e)>=0){var s=e.wrap.feature;n.getLayer().then(function(t){if(r&&s._originalStyle)s.setStyle(s._originalStyle);else{s._originalStyle=s.getStyle()||t.getStyle();s.setStyle(a)}n.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:n.parent})})}};TC.wrap.layer.Vector.prototype.getRGBA=function(t,e){return w(t,e)};TC.wrap.layer.Vector.prototype.findFeature=function(t){};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl};TC.wrap.layer.Vector.prototype.getDescribeFeatureTypeUrl=function(){var t=this.parent,e=t.options.version||"1.1.0",r=t.url;return r=r+"?service=WFS&version="+e+"&request=DescribeFeatureType&typename="+(Array.isArray(t.options.featureType)?t.options.featureType:[t.options.featureType]).join(",")+"&outputFormat=XMLSCHEMA"};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,r,n){const i=this,o=function(t){return t.wrap.feature};return new Promise(function(a,s){const l=e.map(o),c=r.map(o),u=n.map(o);e.length||r.length||n.length?i.getLayer().then(function(e){e.getSource();var r=new t.format.WFS,n=i.parent.options,o=r.writeTransaction(l,c,u,{featurePrefix:n.featurePrefix,featureNS:n.featureNS,featureType:n.featureType[0]}),h={url:i.parent.url,method:"POST",responseType:TC.Consts.mimeType.XML,data:o.outerHTML};TC.ajax(h).then(function(t){const e=t.data;var n=e.getElementsByTagName("ExceptionReport")[0],i={reason:""};if(n){var o=n.getElementsByTagName("Exception")[0];if(o){i.code=o.getAttribute("exceptionCode");for(var l=o.getElementsByTagName("ExceptionText"),c=0,u=l.length;c<u;c++)i.reason+="\n"+l[c].innerHTML}s(i)}else{var h=r.readTransactionResponse(e);a(h)}}).catch(function(){s({code:"",reason:"unknown"})})}):a(i.parent)})};TC.wrap.layer.Vector.prototype.setDraggable=function(e,r,n){var i=this;Promise.all([i.parent.map.wrap.getMap(),i.getLayer()]).then(function(o){const a=o[0],s=o[1];if(e){var l={layers:[s],features:new t.Collection(s.getSource().getFeatures())};i.interaction=new t.interaction.Translate(l);TC.Util.isFunction(r)&&i.interaction.on("translateend",function(t){t.features.getLength()&&r(t.features.item(0)._wrap.parent)});TC.Util.isFunction(n)&&i.interaction.on("translatestart",function(t){t.features.getLength()&&n(t.features.item(0)._wrap.parent)});a.addInteraction(i.interaction)}else if(i.interaction){a.removeInteraction(i.interaction);if(TC.Util.detectIE()&&i._handlerDraggablePointerMove&&TC.Util.isFunction(i._handlerDraggablePointerMove)){a.un("pointermove",i._handlerDraggablePointerMove);delete i._handlerDraggablePointerMove}}})};TC.wrap.layer.Vector.prototype.getFeaturesInExtent=function(e,r){var n=this.layer.getSource().getFeatures(),i=[];if(r){var o=this.parent.map.getPixelFromCoordinate([e[0],e[1]]),a=this.parent.map.getPixelFromCoordinate([e[2],e[3]]);o[0]-=r[0]/2;o[1]+=r[1];a[0]+=r[0]/2;e=this.parent.map.getCoordinateFromPixel(o).concat(this.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<n.length;s++){var l=n[s],c=l.getGeometry().getCoordinates();t.extent.containsCoordinate(e,c)&&i.push(l._wrap.parent)}return i};TC.wrap.layer.Vector.prototype.getAttribution=function(){return null};TC.wrap.control.Click.prototype.register=function(t){var e=this;e._trigger=function(r){if(t.view!==TC.Consts.view.PRINTING){var n=0;t.wrap.map.forEachFeatureAtPixel(r.pixel,function(t,e){t._wrap&&t._wrap.parent.showsPopup&&n++},{hitTolerance:T});if(!n){e.parent.map.trigger(TC.Consts.event.CLICK,{coordinate:r.coordinate,pixel:r.pixel});e.parent.callback(r.coordinate,r.pixel)}return 0===n}}};TC.wrap.control.Click.prototype.activate=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){e.on(c,t._trigger)})};TC.wrap.control.Click.prototype.deactivate=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){e.un(c,t._trigger)})};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.updateElement_():this.ctl=new t.control.ScaleLine({target:this.parent.div})};TC.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_};TC.wrap.control.NavBar.prototype.register=function(e){var r=this;e.wrap.getMap().then(function(n){const i=r.parent.div;r.zCtl=new t.control.Zoom({target:i});r.zsCtl=new t.control.ZoomSlider({render:function(e){if(!e.frameState||!e.frameState.viewState||n.getView().getMinResolution()<=e.frameState.viewState.resolution){var i=function(){if(this.element.offsetWidth>this.element.offsetHeight){r.requestSliderSize||(r.requestSliderSize=window.requestAnimationFrame(i.bind(this)));window.requestAnimationFrame(i.bind(this))}else if(this.element.offsetWidth<this.element.offsetHeight){if(r.requestSliderSize){window.cancelAnimationFrame(r.requestSliderSize);delete r.requestSliderSize}t.control.ZoomSlider.render.call(this,e)}};i.call(this)}}});r.zsCtl.setTarget(i);n.addControl(r.zsCtl);n.addControl(r.zCtl);i.querySelectorAll("button").forEach(function(t){t.classList.add("tc-ctl-btn",r.parent.CLASS+"-btn");t.style.display="block";t.innerHTML="";if(t.matches(".ol-zoom-in")){t.classList.add(r.parent.CLASS+"-btn-zoomin");t.setAttribute("title",r.parent.getLocaleString("zoomIn"))}if(t.matches(".ol-zoom-out")){t.classList.add(r.parent.CLASS+"-btn-zoomout");t.setAttribute("title",r.parent.getLocaleString("zoomOut"))}});const o=i.querySelector(".ol-zoomslider");o.classList.add(r.parent.CLASS+"-bar");o.querySelector(".ol-zoomslider-thumb").classList.add(r.parent.CLASS+"-slider");e.on(TC.Consts.event.BASELAYERCHANGE,r.refresh.bind(r))})};TC.wrap.control.NavBar.prototype.refresh=function(){var t=this,e=t.parent.map.wrap.map;t.parent.renderPromise().then(function(){if(t.zsCtl.sliderInitialized_){var r=e.getView().getResolution();t.zsCtl.setThumbPosition_(r)}else e.once(p,function(e){t.zsCtl.render(e)})})};TC.wrap.control.NavBarHome.prototype.register=function(e){var r=this;e.wrap.getMap().then(function(n){const i=r.parent.div;r.z2eCtl=new t.control.ZoomToExtent({target:i,extent:e.initialExtent,tipLabel:""});n.addControl(r.z2eCtl);i.querySelectorAll("button").forEach(function(t){t.style.display="block";t.innerHTML=""});const o=i.querySelector(".ol-zoom-extent button");o.classList.add("tc-ctl-btn",r.parent.CLASS+"-btn");o.setAttribute("title",r.parent.getLocaleString("zoomToInitialExtent"))})};TC.wrap.control.NavBarHome.prototype.setInitialExtent=function(t){this.z2eCtl.extent=t};TC.wrap.control.Coordinates.prototype.register=function(e){const r=this;r.map=e;return new Promise(function(n,i){r._coordsTrigger=function(t){r.parent.coordsToClick(t)};e.wrap.getMap().then(function(e){r.olMap=e;if(r.parent.map.on3DView){r.parent.crs=r.parent.map.view3D.crs;r.parent.units=TC.Consts.units.DEGREES}else{var i=e.getView().getProjection();r.parent.crs=i.getCode();r.parent.units=i.getUnits()}r.parent.isGeo=r.parent.units===t.proj.Units.DEGREES;n()})})};TC.wrap.control.Coordinates.prototype.onMouseMove=function(t){if(this.map.wrap.map){var e=this.map.wrap.map.getEventCoordinate(t);if(e){this.parent.isGeo?this.parent.latLon=e.reverse():this.parent.xy=e;this.parent.update.apply(this.parent,arguments)}}};TC.wrap.control.Geolocation.prototype.register=function(t){var e=this;e.map=t;e._snapTrigger=function(t){t.dragging||e.initSnap(e.olMap.getEventCoordinate(t),t.pixel)};e._postcomposeTrigger=function(t){e.duringTrackSnap(t)};t.wrap.getMap().then(function(t){e.olMap=t})};var W=function(){return this.parent.layerTracking.features.filter(function(t){return t instanceof TC.feature.Polyline})[0]};TC.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.layerTracking.features.length>0&&this.parent.layerTracking.features[0].geometry.length>=1};TC.wrap.control.Geolocation.prototype.showElevationMarker=function(t){TC.wrap.control.ResultsPanel.prototype.showElevationMarker.call(this,{data:t,layer:this.parent.layerTrack,coords:this.parent.chart.coordinates})};TC.wrap.control.Geolocation.prototype.hideElevationMarker=function(){TC.wrap.control.ResultsPanel.prototype.hideElevationMarker.call(this)};TC.wrap.control.Geolocation.prototype.addWaypoint=function(e,r){var n=new t.Feature({geometry:new t.geom.Point([e[0],e[1],r.ele,r.time],"XYZM")});n.setProperties(r);this.parent.layerTracking.wrap.layer.getSource().addFeature(n)};TC.wrap.control.Geolocation.prototype.addPosition=function(t,e,r,n,i,o,a){var s=Math.round(t[0]),l=Math.round(t[1]),c=W.call(this);if(this.parent.layerTracking.features&&c){var u=c.geometry.length>0&&c.geometry[c.geometry.length-1];if(u&&0==u.length){this.parent.layerTracking.features[0].geometry.push([s,l,a,r]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,r])}else{var h=Math.round(u[0]),p=Math.round(u[1]);if(s!=h||l!=p){this.parent.layerTracking.features[0].geometry.push([s,l,a,r]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,r])}}TC.Util.storage.setSessionLocalValue(this.parent.Const.LocalStorageKey.TRACKINGTEMP,this.formattedToStorage(this.parent.layerTracking).features)}this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:null!=e&&null!=n&&n>0&&e>0})};TC.wrap.control.Geolocation.prototype.positionChangehandler=function(t){const e=this;var r,n,i,o,a;W.call(this)||e.parent.setTracking(!1);return new Promise(function(s,l){if(t&&t.coords){e.parent.layerGPS.clearFeatures();r=t.coords.accuracy/e.parent.map.getMetersPerUnit()||0;n=t.coords.heading||t[2]||0;i=t.coords.speed?3.6*t.coords.speed:0;o=t.coords.altitude||0;a=t.coords.altitudeAccuracy||0;if(e.parent.layerTracking){var c=[t.coords&&t.coords.longitude||t[0],t.coords&&t.coords.latitude||t[1]],u=TC.Util.reproject(c,"EPSG:4326",e.parent.map.crs);e.addPosition(u,n,(new Date).getTime(),i,r,a,o);var h=W.call(e).geometry,p=h.length;p>=2&&(e.parent.deltaMean=(h[p-1][3]-h[0][3])/(p-1));e.parent.trigger(e.parent.Const.Event.POSITIONCHANGE,{pd:{position:u,altitude:o,accuracy:r,heading:TC.Util.radToDeg(n),speed:i}});Promise.all([e.parent.layerGPS.addPoint(u,{radius:4,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),e.parent.layerGPS.addCircle([u,r],{strokeColor:"#00CED1",strokeWidth:.4,fillColor:"#ffffff",fillOpacity:.2,showsPopup:!1})]).then(function(t){const r=t[0],n=t[1];e.parent.geopositionTracking=!0;if(0==e.parent.firstPosition){e.parent.firstPosition=!0;if(!e.parent.trackCenterButton){e.parent.trackCenterButton=e.parent.div.querySelector("."+e.parent.CLASS+"-track-center");e.parent.trackCenterButton.querySelector("button").addEventListener("click",function(){e.parent.layerGPS.map.zoomToFeatures(e.parent.layerGPS.features);e.parent.track.infoPanel.isVisible()||e.parent.track.infoPanel.doVisible();e.parent.track.infoPanel.isMinimized()&&e.parent.track.infoPanel.maximize()});var i=e.parent.map.getControlsByClass("TC.control.ControlContainer")[0];i?e.parent.trackCenterButton=i.addElement({side:i.SIDE.LEFT,htmlElement:e.parent.trackCenterButton}):e.parent.map.div.appendChild(e.parent.trackCenterButton)}e.parent.trackCenterButton.classList.remove(TC.Consts.classes.HIDDEN);e.parent.layerGPS.map.zoomToFeatures(e.parent.layerGPS.features)}s({marker:r,accuracy:n})})}else s(null)}else s(null)})};TC.wrap.control.Geolocation.prototype.setTracking=function(e){var r=this;if(e){r.parent.firstPosition=!1;var n,i=[];if(r.parent.sessionTracking){var o=(new TC.wrap.parser.JSON).parser.readFeatures(r.parent.sessionTracking);o&&r.parent.storageCRS!==r.parent.map.crs&&(o=o.map(function(t){var e=t.clone();e.getGeometry().transform(r.parent.storageCRS,r.parent.map.crs);return e}));var a=o.filter(function(t){var e=t.getGeometry().getType().toLowerCase();"point"===e&&i.push(t);return"linestring"===e||"multilinestring"===e})[0].getGeometry().getCoordinates();n=new t.Feature({geometry:new t.geom.LineString(a,"XYZM"),tracking:!0})}else n=new t.Feature({geometry:new t.geom.LineString([],"XYZM"),tracking:!0});n&&TC.wrap.Feature.createFeature(n).then(function(t){r.parent.layerTracking.addFeature(t);t.geometry.length>1&&r.parent.map.zoomToFeatures(r.parent.layerTracking.features);i.length>0&&Promise.all(i.map(function(t){return TC.wrap.Feature.createFeature(t)})).then(function(t){t&&t.forEach(function(t){r.parent.layerTracking.addFeature(t)})});r.parent.currentPositionWaiting=r.parent.getLoadingIndicator().addWait();r.currentPositionTrk||(r.currentPositionTrk=[]);var e,n=0,o=0,a=!1,s={enableHighAccuracy:!0,timeout:6e5};e=setInterval(function t(i){var l=n++;navigator.geolocation.getCurrentPosition(function(t){clearInterval(e);r.parent.getLoadingIndicator().removeWait(r.parent.currentPositionWaiting);r.positionChangehandler(t).then(function(t){1==r.parent.geopositionTracking&&t&&t.marker&&t.accuracy&&r.currentPositionTrk.push(navigator.geolocation.watchPosition(r.positionChangehandler.bind(r),r.parent.onGeolocateError.bind(r.parent),s))})},i||function(n){switch(n.code){case n.TIMEOUT:if(o>10){clearInterval(e);r.parent.onGeolocateError.call(r.parent,n)}else{o++;t(function(){clearInterval(e);if(!a){a=!0;r.parent.onGeolocateError.call(r.parent,n)}})}break;default:clearInterval(e);r.parent.onGeolocateError.call(r.parent,n)}},{timeout:5e3+l,maximumAge:10,enableHighAccuracy:!0})},1e3);setTimeout(function(){if(r.parent.layerTracking&&r.parent.layerTracking.features&&r.parent.layerTracking.features.length>0&&0==r.parent.layerTracking.features[0].geometry.length){clearInterval(e);r.parent.getLoadingIndicator().removeWait(r.parent.currentPositionWaiting);r.map.toast(r.parent.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});r.parent.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);r.parent.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}},s.timeout+1e3)})}else{r.parent.firstPosition=!1;if(r.currentPositionTrk){r.currentPositionTrk=r.currentPositionTrk instanceof Array?r.currentPositionTrk:[r.currentPositionTrk];r.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});r.currentPositionTrk=[]}r.parent.trackCenterButton&&r.parent.trackCenterButton.classList.add(TC.Consts.classes.HIDDEN)}};TC.wrap.control.Geolocation.prototype.activateSnapping=function(){if(!TC.Util.detectMobile()){this.olMap.on([u,c],this._snapTrigger);this.olMap.on(d,this._postcomposeTrigger)}};TC.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){if(!TC.Util.detectMobile()){e.un([u,c],t._snapTrigger);e.un(d,t._postcomposeTrigger)}t.snapInfo&&e.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");if(t.snapLine){delete t.snapLine;e.render()}})};TC.wrap.control.Geolocation.prototype.clear=function(t){t&&t.clearFeatures();attachedDTD=!1;this.deactivateSnapping.call(this)};TC.wrap.control.Geolocation.prototype.duringTrackSnap=function(e){var r=e.vectorContext;if(r&&this.snapLine){"function"==typeof r.setFillStrokeStyle&&r.setFillStrokeStyle(null,new t.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1}));"function"==typeof r.drawGeometry&&r.drawGeometry(this.snapLine.wrap.feature.getGeometry())}};TC.wrap.control.Geolocation.prototype.endSnap=function(){var t=this;t.parent.map.wrap.getMap().then(function(e){t.snapInfo&&e.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");t.snapLine&&delete t.snapLine})};TC.wrap.control.Geolocation.prototype.initSnap=function(e,r){var n=this;if(n.parent.layerTrack){var i=n.parent.layerTrack.wrap.layer.getSource().getClosestFeatureToCoordinate(e);if(null!==i){var o=i.getGeometry().getClosestPoint(e);const h=n.parent.map.getPixelFromCoordinate(o);if(Math.sqrt(Math.pow(r[0]-h[0],2)+Math.pow(r[1]-h[1],2))>n.parent.snappingTolerance)n.endSnap();else{var a=[e,[o[0],o[1]]];n.snapLine?n.snapLine.wrap.feature.getGeometry().setCoordinates(a):n.snapLine=new TC.feature.Polyline(a);n.snapInfoElement||(n.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]);n.snapInfoElement.style.display="block";if(!n.snapInfo){n.snapInfo=new t.Overlay({element:n.snapInfoElement,offset:[5,18]});n.olMap.addOverlay(n.snapInfo)}null==n.snapInfo.getMap()&&n.snapInfo.setMap(n.olMap);n.snapInfo.setPosition(e);var s={};"LineString"!=i.getGeometry().getType()&&i.getKeys().indexOf("name")>-1&&(s.n=i.get("name"));var l=n.parent.map.options.locale&&n.parent.map.options.locale.replace("_","-")||void 0;s.x=n.map.wrap.isGeo()?o[0].toLocaleString(l,{minimumFractionDigits:5}):Math.round(o[0]).toLocaleString(l);s.y=n.map.wrap.isGeo()?o[1].toLocaleString(l,{minimumFractionDigits:5}):Math.round(o[1]).toLocaleString(l);n.map.wrap.isGeo()&&(s.isGeo=!0);var c=function(t){return o[t]?(Math.round(100*o[t])/100).toLocaleString(l):void 0},u=function(t){return o[t]>0?new Date(o[t]).toLocaleString(l):void 0};if(i.getGeometry().getLayout()===t.geom.GeometryLayout.XYZM){s.z=c(2);s.m=u(3)}else i.getGeometry().getLayout()===t.geom.GeometryLayout.XYZ?s.z=c(2):i.getGeometry().getLayout()===t.geom.GeometryLayout.XYM&&(s.m=u(2));s&&n.parent.getRenderedHtml(n.parent.CLASS+"-track-snapping-node",s,function(t){n.snapInfoElement.innerHTML=t})}}}n.olMap.render()};TC.wrap.control.Geolocation.prototype.drawTrackingData=function(t){const e=this;return new Promise(function(r,n){const i=[],o=(new TC.wrap.parser.JSON).parser.readFeatures(t.data);o.filter(function(t){return"linestring"===t.getGeometry().getType().toLowerCase()||"multilinestring"===t.getGeometry().getType().toLowerCase()}).forEach(function(e){e.getGeometry().setCoordinates(e.getGeometry().getCoordinates(),t.layout)});e.activateSnapping.call(e);for(var a=0,s=o.length;a<s;a++)i.push(TC.wrap.Feature.createFeature(o[a]));Promise.all(i).then(function(t){t.forEach(function(t){t&&e.parent.layerTrack.addFeature(t)});e.parent.map.zoomToFeatures(e.parent.layerTrack.features);r()})})};TC.wrap.control.Geolocation.prototype.formattedFromStorage=function(e){const r=this;if(r.parent.storageCRS!==r.parent.map.crs){var n=(new t.format.GeoJSON).readFeatures(e);if(n){n=n.map(function(t){var e=t.clone();e.getGeometry().transform(r.parent.storageCRS,r.parent.map.crs);return e});return(new t.format.GeoJSON).writeFeatures(n)}}return e};TC.wrap.control.Geolocation.prototype.formattedToStorage=function(e,r,n){var i=this,o=new TC.wrap.parser.JSON;o=o.parser;var a,s=e.wrap.layer.getSource().getFeatures();s=s.map(function(e){e.getGeometry()instanceof t.geom.LineString&&(a=e.getGeometry().getLayout());r&&e.getProperties().tracking&&e.unset("tracking");if(!n&&i.parent.map.crs!==i.parent.storageCRS){var o=e.clone();o.getGeometry().transform(i.parent.map.crs,i.parent.storageCRS);return o}return e}).sort(function(e,r){return e.getGeometry()instanceof t.geom.Point&&!(r.getGeometry()instanceof t.geom.Point)?-1:r.getGeometry()instanceof t.geom.Point&&!(e.getGeometry()instanceof t.geom.Point)?2:e.getProperties().name<r.getProperties().name?-1:e.getProperties().name>r.getProperties().name?1:0});return{features:o.writeFeatures(s),layout:a}};TC.wrap.control.Geolocation.prototype.export=function(e,r){const n=this;return new Promise(function(i,o){var a=[];n.parent.getTrackingData(r).then(function(o){if(o){var s=(new t.format.GeoJSON).readFeatures(o.data);if(0===s.length){var l=n.parent.getTrackingData(r);s=(new t.format.GeoJSON).readFeatures(l)}a=s.map(function(e){var r=e.clone();r.getGeometry().transform(n.parent.map.crs,"EPSG:4326");return r.getGeometry()instanceof t.geom.LineString?new t.Feature({geometry:new t.geom.MultiLineString([r.getGeometry().getCoordinates()],"XYZM")}):r})}switch(e){case"GPX":i(a?(new t.format.GPXCustom).writeFeatures(a):null);break;case"KML":i(a?(new t.format.KMLCustom).writeFeatures(a):null)}})})};var H,V,Y=function(t){var e=[],r=[];if(t.length>1){4==t[0].length&&(t=t.sort(function(t,e){return t[0][3]==e[0][3]?0:t[0][3]<e[0][3]?-1:1}));for(var n=0;n<t.length;n++){for(var i=t[n],o=-1,a=1/0,s=i.getLastCoordinate(),l=n+1;l<t.length;l++){var c=t[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);if(u<a){o=l;a=u}}if(e.length<t.length){if(-1==e.indexOf(n)){e.push(n);r=r.concat(i.getCoordinates())}if(-1==e.indexOf(o)){e.push(o);r=r.concat(t[o].getCoordinates())}}}return r}return t[0].getCoordinates()};TC.wrap.control.Geolocation.prototype.processImportedFeatures=function(e){for(var r=this,n=r.parent.layerTrack.wrap.layer.getSource(),i=r.parent.importedFileName,o=[],a=[],s=[],l=[],c=n.getFeatures(),u=[],h=[],p=function(t){t.getProperties().hasOwnProperty("name")&&t.getProperties().name.trim().length>0?o.push(t.getProperties().name):o.push(i)},d=0;d<c.length;d++){var f=c[d];f instanceof TC.Feature&&(f=c[d].wrap.feature);if(f.getGeometry()instanceof t.geom.Point){h.push(f.getGeometry().getCoordinates());l.push(f)}else if(f.getGeometry()instanceof t.geom.LineString){p(f);a.push(new t.Feature({geometry:new t.geom.LineString(f.getGeometry().getCoordinates(),f.getGeometry().getLayout())}));s.push(f)}else if(f.getGeometry()instanceof t.geom.MultiLineString){var g=f.clone();p(g);var y=g.getGeometry().getLineStrings(),m=Y(y);a.push(new t.Feature({geometry:new t.geom.LineString(m,f.getGeometry().getLayout())}));s.push(f)}}if(u.length>0){m=Y(u);a.push(new t.Feature({geometry:new t.geom.LineString(m)}))}h.length>0&&l.length==c.length&&a.push(new t.Feature({geometry:new t.geom.LineString(h)}));if(s.length>0)for(var C=0;C<s.length;C++)n.removeFeature(s[C]);if(a.length>0){var v,T=0;(function(){const t=a.map(function(t,s){return new Promise(function(t,l){v&&n.removeFeature(v);if(o.length>s){var c=o[s];(function(t,e){for(var r=[],n=t.indexOf(e);-1!=n;){r.push(n);n=t.indexOf(e,n+1);if(r.length>1)return!0}return r.length>1})(o,c)&&(c="["+(s+1)+"] "+c)}r.parent.importedFileName=c||i;v=a[s];n.addFeature(v);r.parent.saveTrack({message:r.parent.getLocaleString("geo.trk.upload.ok",{trackName:c||i}),importedFileName:c||i,notReproject:e.notReproject}).then(function(e){0==s&&(T=e);t()})})});return Promise.all(t)})().then(function(){r.parent.layerTrack.setVisibility(!1);r.parent.layerTrack.clearFeatures();r.parent.trigger(r.parent.Const.Event.IMPORTEDTRACK,{index:T});delete r.parent.importedFileName;r.parent.getLoadingIndicator().removeWait(e.wait)})}else{if(r.parent.layerTrack){r.parent.map.removeLayer(r.parent.layerTrack);r.parent.layerTrack=void 0}delete r.parent.importedFileName;r.parent.getLoadingIndicator().removeWait(e.wait);TC.alert(r.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.import=function(e,r,n){var i,o,a=this;if(r&&r.text){var s=a.parent.layerTrack.wrap.createVectorSource({data:r.text,type:n});i=s.source;o=i.on("change",function(r){if("ready"==i.getState()){t.Observable.unByKey(o);a.processImportedFeatures(e)}});a.parent.layerTrack.wrap.layer.setSource(i)}else{if(a.parent.layerTrack){a.parent.map.removeLayer(a.parent.layerTrack);a.parent.layerTrack=void 0}delete a.parent.importedFileName;a.parent.getLoadingIndicator().removeWait(e);TC.alert(a.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.simulateTrackEnd=function(){this.parent.chartProgressClear();if(this.simulateMarker){window.cancelAnimationFrame(H);this.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&this.simulateMarker.layer.removeFeature(this.simulateMarker);delete this.simulateMarker}};TC.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var e,r=this,n=r.parent.layerTrack.wrap.layer.getSource().getFeatures(),i=0;i<n.length;i++)if(n[i].getGeometry()instanceof t.geom.LineString){e=n[i].getGeometry().getCoordinates();break}if(e&&e.length>0){var o=e[0];new Promise(function(t,e){if(r.simulateMarker){r.simulateMarker.setCoords(o.slice(0,2));t(r.simulateMarker)}else r.parent.layerTrack.addPoint(o.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}).then(function(e){t(e)})}).then(function(n){r.simulateMarker=n;var i=function(){e.length;var n,i=!1;const o=function(t){return r.parent.map.crs!==r.parent.map.options.utmCrs?TC.Util.reproject(t,r.parent.map.crs,r.parent.map.options.utmCrs):t};var a=e;if(4==a[0].length&&a[0][3]>0){n=a[0][3];a[a.length-1][3];i=!0}else{a[0][3]=Date.now();for(var s=1;s<a.length;s++){a[s][3]=0;h=s+1<a.length?new t.geom.LineString(o(a.slice(s-1,s+1))).getLength():new t.geom.LineString(o(a.slice(s-1))).getLength();a[s][3]=a[s-1][3]+36e5*h/r.parent.walkingSpeed}n=a[0][3];a[a.length-1][3]}var l=new t.geom.LineString(a),c=n,u=0;u=r.parent.map.crs!==r.parent.map.options.utmCrs?new t.geom.LineString(o(JSON.parse(JSON.stringify(a)))).getLength():l.getLength();var h=0,p=function(){if(!r.parent.simulate_paused){var e=l.getCoordinateAtM(c),n=function(e){for(var r=0;r<a.length;r++)if(a[r][3]>e)return{d:new t.geom.LineString(o(a.slice(0,r))).getLength(),p:a[r-1].slice(0,2)}}(c);if(!e||!n){r.simulateTrackEnd();var s=r.parent.getSelectedTrack();s&&r.parent.uiSimulate(!1,s);r.parent.hasElevation&&r.parent.chartProgressClear();return}r.parent.hasElevation&&r.parent.chartSetProgress(n,e,u,!!i&&r.parent._getTime(a[0][3],e[3]));if(r.simulateMarker){var h=r.simulateMarker.getCoords(),d=e;Math.atan2(d[1]-h[1],d[0]-h[0]),Math.PI;r.simulateMarker.setCoords(e)}1!==r.parent.simulate_speed?c+=r.parent.delta*r.parent.simulate_speed:c+=r.parent.delta}H=requestAnimationFrame(p)};H=requestAnimationFrame(p)};new Promise(function(t,e){window.d3?t():TC.loadJS(!window.d3,[TC.Consts.url.D3C3],function(){t()})}).then(function(){H=requestAnimationFrame(i)})})}};TC.wrap.control.Geolocation.prototype.headingChangehandler=function(t){var e=this;if(!e.parent.track.infoOnMap){e.parent.track.infoOnMap=document.createElement("div");const t=e.parent.track.infoOnMap.style;t.overFlowY="scroll";t.height="200px";t.width="200px";t.top="0";t.left="100px";t.backgroundColor="fuchsia";t.position="absolute";e.parent.map.div.appendChild(e.parent.track.infoOnMap)}e.parent.track.infoOnMap.style.display="";e.heading=t.target.getHeading();e.parent.track.infoOnMap.innerHTML=e.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+e.heading+" </p>";e.map.wrap.getMap().then(function(t){t.getView().setRotation(-e.heading)});e.parent.trigger(e.parent.Const.Event.STATEUPDATED,{moving:null!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.orientationChangehandler=function(t){var e=this.map.wrap.map.getView(),r=e.getCenter(),n=e.getResolution(),i=t.target.getBeta()||0,o=t.target.getGamma()||0;r[0]-=n*o*25;r[1]+=n*i*25;e.setCenter(e.constrainCenter(r));this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:null!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.pulsate=function(e){this.pulsated=!0;var r,n=e.wrap.feature.getGeometry().getRadius(),i=(new Date).getTime();r=this.olMap.on(d,function(o){var a=o.vectorContext,s=o.frameState,l=s.time-i,c=e.wrap.feature.getGeometry().clone(),u=function(t){switch(!0){case t<=50:return n;case t>50&&t<=100:return 1.02*n;case t>100&&t<=150:return 1.05*n;case t>150&&t<=200:return 1.02*n;case t>200&&t<=300:return n;case t>300&&t<=350:return 1.02*n;case t>350&&t<=400:return 1.05*n;case t>400&&t<=450:return 1.02*n;case t>450&&t<=500:return 1*n;default:return n}}(l);c.setRadius(u);a.setFillStrokeStyle(new t.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new t.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1}));a.drawCircleGeometry(c);l>500?t.Observable.unByKey(r):s.animate=!0})};TC.wrap.control.ResultsPanel.prototype.register=function(t){const e=this;e.map=t;t.wrap.getMap().then(function(t){e.olMap=t})};TC.wrap.control.ResultsPanel.prototype.showElevationMarker=function(e){const r=this,n=(e=e||{}).data,i=e.layer,o=e.coords;if(!r.elevationMarker){const e=document.createElement("div");e.style.display="none";e.classList.add("tc-ctl-geolocation-trackMarker","elevation");r.elevationMarker=new t.Overlay({element:e,offset:[0,-11],positioning:t.OverlayPositioning.CENTER_CENTER,stopEvent:!1})}if(i.getVisibility()&&i.getOpacity()>0){r.elevationMarker.getElement().style.display="";r.olMap.addOverlay(r.elevationMarker);r.elevationMarker.setPosition(o[n[0].index])}};TC.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){this.elevationMarker&&(this.elevationMarker.getElement().style.display="none")};TC.wrap.control.Coordinates.prototype.coordsActivate=function(){this.olMap.on(c,this._coordsTrigger)};TC.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(c,this._coordsTrigger)};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(t){var e=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");e=this.parser.readFeatures(t).map(function(t){return new TC.Feature(null,{id:t.getId(),data:t.getProperties()})})}return e};TC.wrap.parser={WFS:function(e){this.parser=new t.format.WFS(e)},JSON:function(e){this.parser=new t.format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.OverviewMap.prototype.register=function(e){var r=this;r.parent.layer.wrap.getLayer().then(function(n){r.ovMap=new t.control.OverviewMap({target:r.parent.div,collapsed:!1,collapsible:!1,className:r.parent.CLASS+" ol-overviewmap",layers:[n]});r.ovMap._wrap=r;r.ovMap.getOverviewMap().pixelRatio_=1;r.ovMap.ovmap_.removeOverlay(r.ovMap.boxOverlay_);var i=document.createElement("DIV");i.className="ol-overviewmap-box";i.style.boxSizing="border-box";r.ovMap.boxOverlay_=new t.Overlay({position:[0,0],positioning:t.OverlayPositioning.BOTTOM_LEFT,element:i});r.ovMap.ovmap_.addOverlay(r.ovMap.boxOverlay_);r.manageSize.call(r.ovMap.ovmap_);r._boxElm=r.ovMap.boxOverlay_.getElement();TC.loadJS(!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){var t=r.ovMap.ovmap_;const n=new Draggabilly(r._boxElm);n.positionDrag=function(){const t=this.element.style,e="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(t.transform.length){const r=t.transform.indexOf("translate3d");if(r>=0){const n=t.transform.indexOf(")",r);t.transform=t.transform.replace(t.transform.substring(r,n+1),e)}else t.transform=e+" "+t.transform}else t.transform=e};n.on("pointerDown",function(i){n.dragged=r._boxElm.cloneNode();n.dragged.classList.add(TC.Consts.classes.ACTIVE);n.dragged.style.position="absolute";r._boxElm.insertAdjacentElement("beforebegin",n.dragged);if(e.maxExtent){var o=t.getPixelFromCoordinate([e.maxExtent[0],e.maxExtent[1]]),a=t.getPixelFromCoordinate([e.maxExtent[2],e.maxExtent[3]]),s=t.getSize();const r=document.createElement("div");r.style.position="absolute";r.style.bottom=Math.round(s[1]-o[1])+"px";r.style.left=Math.round(o[0])+"px";r.style.top=Math.round(a[1])+"px";r.style.right=Math.round(s[0]-a[0])+"px";const i=t.getViewport();i.insertBefore(r,i.firstElementChild);n.options.containment=r}});n.on("pointerUp",function(r){n.dragged.parentElement.removeChild(n.dragged);if(e.maxExtent){t.getViewport().removeChild(n.options.containment);n.options.containment=null}});n.on("dragMove",function(t,e,r){n._delta=r});n.on("dragEnd",function(i,o){var a=r.ovMap.getMap().getView(),s=t.getPixelFromCoordinate(a.getCenter()),l=t.getCoordinateFromPixel([s[0]+n._delta.x,s[1]+n._delta.y]),c=e.getExtent(),u=(c[2]-c[0])/2,h=(c[3]-c[1])/2;l[0]+u>e.maxExtent[2]?l[0]=e.maxExtent[2]-u:l[0]-u<e.maxExtent[0]&&(l[0]=e.maxExtent[0]+u);l[1]+h>e.maxExtent[3]?l[1]=e.maxExtent[3]-h:l[1]-h<e.maxExtent[1]&&(l[1]=e.maxExtent[1]+h);n.setPosition(0,0);delete n._delta;e.setCenter(l,{animate:!0})})});e.wrap.getMap().then(function(t){r.reset();const e=r.parent.div.querySelector("."+r.parent.CLASS+"-load");n._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){e.classList.remove(TC.Consts.classes.HIDDEN);e.classList.add(TC.Consts.classes.VISIBLE)});n._wrap.$events.on(TC.Consts.event.TILELOAD,function(){e.classList.remove(TC.Consts.classes.VISIBLE);e.classList.add(TC.Consts.classes.HIDDEN)});t.addControl(r.ovMap);r.parent.isLoaded=!0;r.parent.trigger(TC.Consts.event.MAPLOAD)})})};TC.wrap.control.OverviewMap.prototype.reset=function(e){const r=this;return new Promise(function(n,i){const o=function(e,i){if(e.type===TC.Consts.layerType.WMTS){var o={crs:i||r.parent.map.crs,oldCrs:e.wrap.layer.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&e.setProjection(o)}e.wrap.getLayer().then(function(i){var o=new t.View(b(r.parent.map.wrap,i._wrap.parent));if(o.getResolutions()){o.setResolution(o.getResolutions().filter(function(t){return t>o.getResolutionForExtent(r.parent.map.getExtent(),s.getSize())}).reverse()[0]);s.setView(o)}else o.getProjection().getCode()!==s.getView().getProjection().getCode()&&s.setView(o);i._wrap.$events.one(TC.Consts.event.TILELOAD,function(){s.getLayers().getArray()[0].getSource().refresh()});if(e!==r.parent.layer||-1===s.getLayers().getArray().indexOf(e)){r.parent.map.trigger(TC.Consts.event.OVERVIEWBASELAYERCHANGE,{oldLayer:e!==r.parent.layer?r.parent.layer:null,newLayer:e});s.getLayers().forEach(function(e){(e instanceof t.layer.Image||e instanceof t.layer.Tile)&&s.removeLayer(e)});const n=r.parent.div.querySelector("."+r.parent.CLASS+"-load");i._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){n.classList.remove(TC.Consts.classes.HIDDEN);n.classList.add(TC.Consts.classes.VISIBLE)});i._wrap.$events.on(TC.Consts.event.TILELOAD,function(){n.classList.remove(TC.Consts.classes.VISIBLE);n.classList.add(TC.Consts.classes.HIDDEN)});s.getLayers().insertAt(0,i)}n(e)})};var a=(e=e||{}).layer||r.parent.layer;if(r.parent.map&&a&&r.ovMap){var s=r.ovMap.ovmap_;a.getCapabilitiesPromise().then(function(){var t=a;a.isCompatible(r.parent.map.crs)||0!==a.wrap.getCompatibleMatrixSets(r.parent.map.crs).length?o(a):(a=a.getFallbackLayer()||r.parent.defaultLayer).getCapabilitiesPromise().then(function(){r.parent.map.on3DView&&!a.isCompatible(r.parent.map.crs)?r.parent.map.loadProjections({crsList:t.getCompatibleCRS(),orderBy:"name"}).then(function(e){o(t,e[0].code)}):a.isCompatible(r.parent.map.crs)&&o(a)})})}})};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var e=null;if(this.ovMap){(r=this.ovMap.getOverviewMap()).getLayers().forEach(function(t){"3DCamera"===t.get("id")&&(e=t)});if(!e){var r=this.ovMap.getOverviewMap(),n=F({});n[0].getFill().setColor([0,0,0,0]);e=new t.layer.Vector({id:"3DCamera",source:new t.source.Vector,style:n});r.addLayer(e)}}return e};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){if(this.parent.map.isLoaded){this.is3D=!!e;var r=this.get3DCameraLayer();if(r){var n,i=(e=e||{}).fov,o=r.getSource();if(i&&i.length){var a=o.getFeatures();if(a.length)n=a[0];else{n=new t.Feature;o.addFeature(n)}n.setGeometry(new t.geom.Polygon([i]))}else o.clear();var s="number"==typeof e.heading?e.heading:0;this._boxElm.style.transform="rotate("+s+"rad)"}}};TC.wrap.control.OverviewMap.prototype.enable=function(){if(this.parent.layer&&this.parent.layer.setVisibility){this.parent.layer.setVisibility(!0);this.parent.wrap.ovMap.ovmap_.updateSize();const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1);this.parent.map.div.dispatchEvent(t)}};TC.wrap.control.OverviewMap.prototype.disable=function(){this.parent.layer&&this.parent.layer.setVisibility&&this.parent.layer.setVisibility(!1)};TC.wrap.control.OverviewMap.prototype.manageSize=function(){TC.wrap.Map.prototype.manageSize.call(this)};TC.wrap.control.FeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then(function(r){TC.wrap.control.Click.prototype.register.call(e,t);var n=e._trigger;e._trigger=function(r){var i=n.call(e,r);i?e.parent.beforeRequest({xy:r.pixel}):t.trigger(TC.Consts.event.NOFEATUREINFO,{control:e.parent});return i}})};var z=function(t){var e=t.innerHTML||t.textContent;(V=V||document.createElement("textarea")).innerHTML=e;return V.value},X={readFeatures:function(e){var r=[],n=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===n.documentElement.tagName)for(var i=n.documentElement.getElementsByTagName("FeatureInfoCollection"),o=0,a=i.length;o<a;o++)for(var s=i[o],l=s.getAttribute("layername"),c=s.getElementsByTagName("FeatureInfo"),u=0,h=c.length;u<h;u++){for(var p=c[u].getElementsByTagName("Field"),d={},f=0,g=p.length;f<g;f++){var y=p[f];d[z(y.getElementsByTagName("FieldName")[0])]=z(y.getElementsByTagName("FieldValue")[0])}var m=new t.Feature(d);m.setId(l+"."+TC.getUID());r[r.length]=m}return r}},K=function(t,e,r){var n=e.getPath(r);t.layers.push({name:r,title:n[n.length-1],path:n.slice(1),features:[]})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,r,n){var i=this,o=n||{},a=i.parent.map;a.wrap.getMap().then(function(n){var s={},l={};const c=[],u=[];var h=[],p=[];T=(T=n.getLayers().getArray()).filter(function(e){return e instanceof t.layer.Image&&e.getVisible()});for(var d=0;d<T.length;d++){var f=T[d],g=f._wrap.parent;if((S=f.getSource()).getGetFeatureInfoUrl&&a.workLayers.indexOf(g)>=0&&g.names.length>0&&(!o.serviceUrl||o.serviceUrl===g.url)){if(s[g.url]){_=s[g.url];l[g.url].source.updateParams(TC.Util.extend(l[g.url].source.getParams(),S.getParams()))}else{_={layers:[],mapLayers:[],title:g.title,request:null};s[g.url]=_;l[g.url]={source:TC.Util.extend(!0,{},S),layers:[]}}_.mapLayers.push(g);var y=g.getDisgregatedLayerNames();if(o.layerName){if(y.indexOf(o.layerName)>=0&&f._wrap.getInfo(o.layerName).queryable){K(_,g,o.layerName);l[g.url].layers.push(o.layerName)}}else{for(var m=0;m<y.length;m++){var C=y[m];if(f._wrap.getInfo(C).queryable)K(_,g,C);else{TC.Util.consoleRegister('Capa "'+y[m]+'" no queryable, la eliminamos de la petici\xf3n GFI');y.splice(m,1);m-=1}}y.length>0&&(l[g.url].layers=l[g.url].layers.concat(y))}}}for(var v in s){p.push(s[v]);var T,_=s[v],S=l[v].source;if(!(T=l[v].layers)||T&&0===T.length)continue;var E=S.getParams();S.params_.LAYERS=T.join(",");var L=S.getGetFeatureInfoUrl(e,r,a.crs,{QUERY_LAYERS:T.join(","),INFO_FORMAT:E.INFO_FORMAT,FEATURE_COUNT:1e3,radius:a.options.pixelTolerance,buffer:a.options.pixelTolerance}),w=L=L.replace(/sld_body=[a-zA-Z%0-9._]*/);const t={serviceUrl:v,requestedFormat:E.INFO_FORMAT,expandUrl:w};u.push(t);c.push(new Promise(function(e,r){const n=_.mapLayers[0];n.toolProxification.fetch(L).then(function(r){n.toolProxification.cacheHost.getAction(t.expandUrl).then(function(i){t.originalUrl=i.action.call(n.toolProxification,t.expandUrl);e(TC.Util.extend({},r,t))})}).catch(function(t){r(Error(t))})}));TC.Util.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then(function(n){for(var l=!1,c=0,p=[],d=0;d<n.length;d++){var f,g=n[d],y=s[u[d].serviceUrl];l=!0;y.text=g.responseText;var m=g.contentType;m&&m.indexOf(";")>-1&&(m=m.substr(0,m.indexOf(";")).trim());m||(m=g.requestedFormat);if(m===g.requestedFormat){switch(m){case"application/json":f=new t.format.GeoJSON;break;case"application/vnd.ogc.gml":f=g.responseText.indexOf("FeatureCollection")>-1?new t.format.WFS({gmlFormat:new t.format.GML2({srsName:a.crs})}):new t.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":f=new t.format.GML3({srsName:a.crs});break;case"application/vnd.esri.wms_featureinfo_xml":f=X;break;default:f=null}if(f){var C;try{C=f.readFeatures(g.responseText,{featureProjection:t.proj.get(a.crs)})}catch(t){TC.error(i.parent.getLocaleString("featureInfo.error.badResponse",{url:g.serviceUrl})+": "+t.message);C=[];continue}c+=C.length;for(var v=function(t,e,r){var n=!1;if(e===r)n=!0;else{var i=t.getNodePath(e),o=t.getNodePath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(t.wrap.getName(i[a])!==t.wrap.getName(o[a])){n=!1;break}}}return n},T={},_=0;_<C.length;_++){var S=C[_];if(S instanceof t.Feature){for(var E=S.getId()||TC.getUID(),L=!1,w=E.substr(0,E.lastIndexOf(".")),b=0;b<y.layers.length;b++){var A=y.layers[b],x=A.name.substr(A.name.indexOf(":")+1);if(y.mapLayers.some(function(t){return v(t,x,w)})){L=!0;if(!o.featureId||S.getId()===o.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));p.push(A.features)}break}}if(!L){var P;if(T[w])P=T[w];else{P={name:w,title:w,path:[w],features:[]};T[w]=P;y.layers.push(P)}if(!o.featureId||S.getId()===o.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));p.push(P.features)}}}}}else{var R={name:"layer"+TC.getUID(),title:"Datos en el punto",features:[]};y.layers[y.layers.length]=R;R.features[0]={rawUrl:g.originalUrl,expandUrl:g.expandUrl,rawContent:g.responseText,rawFormat:m};c+=1}}else{TC.Util.consoleRegister("Respuesta GFI: lo m\xe1s probable es que el servidor est\xe9 devolviendo una excepci\xf3n");TC.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada");i.parent.responseError({message:g.responseText,status:g.status});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})}}if(l){var I=h;h.length&&(I=I.concat(new Promise(function(t,e){TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){t()})})));Promise.all(I).then(function(t){var n;t.forEach(function(t,r){if(t){t.attributes=[];for(var o in t.data){var a=t.data[o];"object"!=typeof a&&t.attributes.push({name:o,value:"number"==typeof a?a.toLocaleString(TC.Util.getMapLocale(i.parent.map)):a})}!n&&TC.Geometry.isInside(e,t.geometry)&&(n=t);p[r].push(t)}});var o=[];for(var a in s)s.hasOwnProperty(a)&&o.push(s[a]);i.parent.responseCallback({coords:e,resolution:r,services:o,featureCount:c,defaultFeature:n})})}},function(t,n,o){if(p&&0==p.length)for(var l in s)p.push(s[l]);i.parent.responseCallback({coords:e,resolution:r,services:p,featureCount:0});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})});else{a.workLayers.filter(function(t){return t instanceof TC.layer.Raster}).length>0&&a.toast(i.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:TC.Consts.msgType.INFO});if(p&&0==p.length)for(var v in s)p.push(s[v]);a.on(TC.Consts.event.BEFOREFEATUREINFO,function(){i.parent.responseCallback({coords:e,resolution:r,services:p,featureCount:0})});i.parent.responseCallback({coords:e,resolution:r,services:p,featureCount:0})}})};TC.wrap.control.GeometryFeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then(function(r){TC.wrap.control.Click.prototype.register.call(e,t);var n=e._trigger;e._trigger=function(t){e.hasEligibleLayers().then(function(r){r&&(e.parent._isSearching||t.type!=c||e.parent._isDrawing||e.parent._isSearching||n.call(e,t))})}})};TC.wrap.control.GeometryFeatureInfo.prototype.hasEligibleLayers=function(){const t=this;return new Promise(function(e,r){const n=t.parent.map;var i=!1;n.wrap.getMap().then(function(t){t.getLayers().forEach(function(t){var e=t._wrap.parent;if(t.getSource().getGetFeatureInfoUrl&&n.workLayers.indexOf(e)>=0){i=!0;return!1}});e(i)})})};TC.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(e){var r=this,n=(e=e||{}).xy,i=e.layer,o=e.callback,a=e.geometryType,s=!1;if(r.drawCtrl){r.drawCtrl.setActive(!0);r.drawCtrl.startDrawing_({coordinate:n})}else i.wrap.getLayer().then(function(e){var i;switch(a){case TC.Consts.geom.POLYLINE:i=t.geom.GeometryType.LINE_STRING;break;default:i=t.geom.GeometryType.POLYGON}r.drawCtrl=new t.interaction.Draw({source:e.getSource(),type:i,style:e.getStyle()});var l=function(t){t.parent.showsPopup=!1};e.getSource().on(f,function(t){t.feature._wrap?l(t.feature._wrap):t.feature._wrapPromise.then(l)});r.drawCtrl.handleEvent=function(e){if(e.type==c){var r=i===t.geom.GeometryType.POLYGON?this.sketchCoords_[0]:this.sketchCoords_;s&&2==r.length&&null!==this.sketchFeature_?this.addToDrawing_(e):s=!0}return t.interaction.Draw.prototype.handleEvent.call(this,e)};const u=r.parent.map.wrap.map;u.addInteraction(r.drawCtrl);r.drawCtrl.on("drawstart",function(e){r.parent._isDrawing=!0;u.getInteractions().forEach(function(e,r){e instanceof t.interaction.DoubleClickZoom&&e.setActive(!1)})});r.drawCtrl.startDrawing_({coordinate:n});r.drawCtrl.on("drawend",function(n){r.parent._isDrawing=!1;u.getInteractions().forEach(function(e,r){e instanceof t.interaction.DoubleClickZoom&&e.setActive(!1)});u.removeInteraction(r.drawCtrl);this.setActive(!1);r.drawCtrl=null;e.getSource().clear();r.parent._drawToken=!0;setTimeout(function(){r.parent._drawToken=!1},500);o&&TC.wrap.Feature.createFeature(n.feature,{showsPopup:!1}).then(function(t){o(t)})})})};TC.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(t,e,r){if(this.drawCtrl&&this.parent._isDrawing){this.parent._isDrawing=!1;this.drawCtrl.setActive(!1);this.drawCtrl.source_.clear()}};var J=function(t,e,r,n){const i=[];var o={};const a=function(t){const e=t.mapLayers[0];return t.title||t.mapLayers.reduce(function(t,e){return t||e.title},"")||e.tree&&e.tree.title||e.capabilities.Service.Title},s=t.wrap.map,l=function(){return!n||r!==TC.Consts.mimeType.JSON&&r!==TC.Consts.mimeType.KML?t.getCRS():TC.Consts.SRSDOWNLOAD_GEOJSON_KML},c=function(t,e){return new Promise(function(r){n?r({url:t,data:e}):function(t,e){return new Promise(function(r){TC.ajax({url:t,data:e,cache:!1,contentType:"application/xml",method:"POST"}).then(function(t){const e=t.data;if(e instanceof XMLDocument){var n=xml2json(e);if(n.Exception){r({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText}}]});return}}r({response:t})},function(t){r({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:t.name,errorThrown:t.message}}]})})})}(t,e).then(function(t){if(t.errors&&t.errors.length>0){t.errors[0].params.serviceTitle=service.mapLayers.reduce(function(t,e){return t||e.title},"")||a(service);r(t)}else r(t)})})};s.getLayers().forEach(function(s){var u=s._wrap.parent;if(s.getVisible()&&!(t.workLayers.indexOf(u)<0)&&u.type===TC.Consts.layerType.WMS){var h=u.getDisgregatedLayerNames()||u.availableNames,p=o[u.url.toLowerCase()];p||(p=o[u.url.toLowerCase()]={layers:[],mapLayers:[u],layerNames:[]});for(var d=0;d<h.length;d++){var f=h[d];if(u.wrap.getInfo(f).queryable){p.layerNames.push(f);var g=u.getPath(f);p.layers.push({name:f,title:g[g.length-1],path:g.slice(1),features:[]})}}if(0!=p.layerNames.length&&void 0===p.request){p.request=p.request||u.getWFSCapabilitiesPromise();i.push(new Promise(function(t,i){p.request.then(function(i){var s=null,u=[];for(var h in o)o[h].request&&o[h].request==p.request&&(s=o[h]);var d=null,f=s.layerNames;if(f instanceof Array&&f.length)if(void 0!==i.Operations.GetFeature){for(var g=[],y=0;y<f.length;y++){for(var m=f[y].substring(f[y].indexOf(":")+1);"_"===m[m.length-1];)m=m.substring(0,m.lastIndexOf("_"));if(i.FeatureTypes.hasOwnProperty(m))g.indexOf(m)<0&&g.push(m);else{var C=s.mapLayers[0].getPath(m);u.push({key:TC.Consts.WFSErrors.LayersNotAvailable,params:{serviceTitle:a(s),layerName:C[C.length-1]}})}}if(0!=g.length){i.Operations.GetFeature.CountDefault&&(d=i.Operations.GetFeature.CountDefault.DefaultValue);if("1.0.0"===i.version&&!i.Operations.GetFeature.Operations.hasOwnProperty("Query")||("2.0.0"===i.version||"1.1.0"===i.version)&&i.Operations.QueryExpressions.AllowedValues.Value.indexOf("wfs:Query")<0){u.push({key:TC.Consts.WFSErrors.QueryNotAvailable,params:{serviceTitle:a(s)}});t({errors:u})}else{h=i.Operations.GetFeature.DCPType?i.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:i.Operations.GetFeature.DCP.HTTP.Post["xlink:href"];s.mapLayers[0].getFeatureUrl(h).then(function(o){d?(h=d,p=o,f=TC.Util.WFSQueryBuilder(g,e,i,r,!0,l()),new Promise(function(t){TC.ajax({url:p,data:f,cache:!1,contentType:"application/xml",responseType:"application/xml",method:"POST"}).then(function(e){const r=e.data;if(r instanceof XMLDocument){var n=xml2json(r);if(n.Exception){t({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText}}]});return}}var i=parseInt(n.numberMatched||n.numberOfFeatures,10);isNaN(i)||i>parseInt(h,10)?t({errors:[{key:TC.Consts.WFSErrors.NumMaxFeatures}]}):t(0!==i?i:{errors:[{key:TC.Consts.WFSErrors.NoFeatures}]})},function(e){t({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:e.name,errorThrown:e.message}}]})})})).then(function(h){if(h.errors&&h.errors.length>0){switch(h.errors[0].key){case TC.Consts.WFSErrors.Indeterminate:h.errors[0].params.serviceTitle=s.mapLayers.reduce(function(t,e){return t||e.title},"")||a(s);break;case TC.Consts.WFSErrors.NumMaxFeatures:h.errors[0].params={limit:d,serviceTitle:a(s)};break;case TC.Consts.WFSErrors.NoFeatures:h.errors[0].params={serviceTitle:a(s)}}t(h)}else c(o,TC.Util.WFSQueryBuilder(g,e,i,n?r:TC.Consts.mimeType.JSON,!1,l())).then(function(e){t(Object.assign({service:s,errors:u},e))})}):c(o,TC.Util.WFSQueryBuilder(g,e,i,n?r:TC.Consts.mimeType.JSON,!1,l())).then(function(e){t(Object.assign({service:s,errors:u},e))});var h,p,f}).catch(function(e){t({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:e.name,errorThrown:e.message,serviceTitle:a(s)}}]})})}}else{u.push({key:TC.Consts.WFSErrors.NoValidLayers,params:{serviceTitle:a(s)}});t({errors:u})}}else{u.push({key:TC.Consts.WFSErrors.GetFeatureNotAvailable,params:{serviceTitle:a(s)}});t({errors:u})}},function(e){var r=null;for(var n in o)o[n].request&&o[n].request===p.request&&(r=o[n]);t({errors:[{key:TC.Consts.WFSErrors.GetCapabilities,params:{err:e.name,serviceTitle:a(r)}}]})})}))}}});return i};TC.WFSGetFeatureBuilder=J;var Z=function(e,r,n){var i,o=n;o&&o.indexOf(";")>-1&&(o=o.substr(0,o.indexOf(";")).trim());o||(o=r.requestedFormat);switch(o){case"application/json":i=new t.format.GeoJSON;break;case"application/vnd.ogc.gml":i=r.responseText.indexOf("FeatureCollection")>-1?new t.format.WFS({gmlFormat:new t.format.GML2({srsName:e.crs})}):new t.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":i=new t.format.GML3({srsName:e.crs});break;case"text/xml":case"application/xml":var a=xml2json(r);a.ServiceException&&TC.error(a.ServiceException);i=null;break;default:i=null}return i?i.readFeatures(r,{featureProjection:t.proj.get(e.crs)}):null},Q=function(e,r){for(var n=[],i=[],o=function(t,e,r){var n=!1;if(e===r||0===e.indexOf(r))n=!0;else{var i=t.getPath(e),o=t.getPath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(i[a]!==o[a]){n=!1;break}}}return n},a=0;a<e.length;a++){var s=e[a];if(s instanceof t.Feature){for(var l=s.getId()||TC.getUID(),c=!1,u=l.substr(0,l.lastIndexOf(".")),h=0;h<r.layers.length;h++){var p=r.layers[h],d=p.name.substr(p.name.indexOf(":")+1);if(r.mapLayers.some(function(t){return o(t,d,u)})){c=!0;n.push(TC.wrap.Feature.createFeature(s));i[s.id_]=p.features;break}}if(!c){var f;if(fakeLayers[u])f=fakeLayers[u];else{f={name:u,title:u,features:[]};fakeLayers[u]=f;r.layers.push(f)}if(!opts.featureId||s.getId()===opts.featureId){n.push(TC.wrap.Feature.createFeature(s));i.push(f.features)}}}}return new Promise(function(t,e){Promise.all(n).then(function(e){e.forEach(function(t){t.attributes=[];for(var e in t.data){var r=t.data[e];"object"!=typeof r&&t.attributes.push({name:e,value:r})}i[t.id].push(t)});t({service:r})})})};TC.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(e,r){var n=this,i=n.parent.map;n.parent.filterFeature=e;e.layer=n.parent.filterLayer;i.wrap.getMap().then(function(o){var a=e.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!r){for(var c=null,u=1,h=l.length;u<h;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);r=o.getPixelFromCoordinate(new t.geom.Point(c).getCoordinates())}n.parent.beforeRequest({xy:r});var p=J(i,new TC.filter.intersects(e,i.crs),TC.Consts.format.JSON);const d=[];Promise.all(p).then(function(t){for(var e=[],o=0,a=0;a<t.length;a++){const r=t[a];if(r){d[d.length]=new Promise(function(t,e){if(r.errors&&r.errors.length){for(var o=0;o<r.errors.length;o++){var a,s=TC.Consts.msgType.WARNING;!0;var l=r.errors[o];switch(l.key){case TC.Consts.WFSErrors.NumMaxFeatures:a=n.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case TC.Consts.WFSErrors.GetCapabilities:a=n.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case TC.Consts.WFSErrors.NoFeatures:!1;continue;case TC.Consts.WFSErrors.Indeterminate:a=n.parent.getLocaleString("wfs.IndeterminateError");TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:l.params.err,descripcion:l.params.errorThrown,serviceName:l.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);s=TC.Consts.msgType.ERROR;break;default:a=n.parent.getLocaleString("wfsGFI."+l.key,l.params)}i.toast(a,{type:s})}r.response||t()}});var s=r.response?Z(i,r.response.data,r.response.contentType):[];d[d.length-1]=Q(s,r.service);r.service&&e.push(r.service);o+=s.length}}Promise.all(d).then(function(){n.parent.responseCallback({xy:r||null,services:e,featureCount:o})})},function(t){n.parent.responseCallback({})})})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.Consts.event.PANANIMATIONSTART="pananimationstart.tc";TC.Consts.event.PANANIMATIONEND="pananimationend.tc";TC.wrap.control.Popup.prototype.fitToView=function(){var e=this,r=e.parent.map,n=e.parent.map.wrap.map,i=e.parent.popupDiv.getBoundingClientRect(),o=r.div.getBoundingClientRect(),a=n.getCoordinateFromPixel([i.left-o.left,i.top-o.top]),s=n.getCoordinateFromPixel([i.right-o.left,i.bottom-o.top]),l=a[0],c=a[1],u=s[0],h=[l,s[1],u,c],p=r.getExtent();if(!t.extent.containsExtent(p,h)){var d={left:Math.max(p[0]-h[0],0),bottom:Math.max(p[1]-h[1],0),right:Math.max(h[2]-p[2],0),top:Math.max(h[3]-p[3],0)};if(e.parent.dragged){var f=e.popup.getPosition();d.right?f[0]=f[0]-d.right:d.left&&(f[0]=f[0]+d.left);d.top?f[1]=f[1]-d.top:d.bottom&&(f[1]=f[1]+d.bottom);var g=n.getPixelFromCoordinate(f);g[1]=n.getSize()[1]-g[1];e.parent._previousContainerPosition=g;e.popup._oldUpdatePixelPosition(f)}else if(e.parent.isVisible()){var y=n.getView(),m=y.getCenter().slice();d.top?m[1]+=d.top:d.bottom&&(m[1]-=d.bottom);d.right?m[0]+=d.right:d.left&&(m[0]-=d.left);y.animate({center:m,easing:function(t){0===t&&e.parent.map.trigger(TC.Consts.event.PANANIMATIONSTART);1===t&&e.parent.map.trigger(TC.Consts.event.PANANIMATIONEND);return t}})}}};TC.wrap.control.Popup.prototype.setDragged=function(e){var r=this.popup;if(e){if(!r._oldUpdatePixelPosition){r._oldUpdatePixelPosition=r.updatePixelPosition;r.updatePixelPosition=function(){}}if(!r._newHandleOffsetChanged){r._newHandleOffsetChanged=function(){this._oldUpdatePixelPosition()};t.events.unlisten(r,t.Object.getChangeEventType("offset"),r.handleOffsetChanged,r);t.events.listen(r,t.Object.getChangeEventType("offset"),r._newHandleOffsetChanged,r)}}else{const e=r.getElement().parentElement.style;e.setProperty("top",r.rendered.top_);e.setProperty("bottom",r.rendered.bottom_);e.setProperty("left",r.rendered.left_);e.setProperty("right",r.rendered.right_);delete this.parent._previousContainerPosition;if(r._oldUpdatePixelPosition){r.updatePixelPosition=r._oldUpdatePixelPosition;delete r._oldUpdatePixelPosition}if(r._newHandleOffsetChanged){t.events.unlisten(r,t.Object.getChangeEventType("offset"),r._newHandleOffsetChanged,r);t.events.listen(r,t.Object.getChangeEventType("offset"),r.handleOffsetChanged,r);delete r._newHandleOffsetChanged}}};TC.wrap.Feature.prototype.getLegend=function(){var e={},r=nt(this.feature,!0);if(r){var n=r.getImage();if(n){if(n instanceof t.style.Icon){e.src=n.getSrc();var i=n.getScale();if(i){e.scale=i;var o=n.getImage();if(o.width){e.width=o.width*i;e.height=o.height*i}}}else n instanceof t.style.Circle&&(e.src=n.canvas_.toDataURL());if(this.parent.options.radius)e.height=e.width=2*this.parent.options.radius;else{e.width=e.width||this.parent.options.width;e.height=e.height||this.parent.options.height}}else{var a=r.getStroke(),s=r.getFill();if(a){var l=a.getColor();l&&(e.strokeColor=t.color.asString(l));var c=a.getWidth();c&&(e.strokeWidth=c)}if(s){var u=s.getColor();u&&(e.fillColor=t.color.asString(u))}}}return e};var tt=function(e){const r=new t.Feature;e&&r.setGeometryName(e);return r};TC.wrap.Feature.prototype.createPoint=function(t,e){this.feature=tt(e.geometryName);this.feature._wrap=this;this.parent.setCoords(t);this.feature.setStyle(F({styles:{point:e}}));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMarker=function(t,e){const r=this;var n=TC.Util.getPointIconUrl(e);if(n){e.url=n;r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);r.feature.setStyle(F({styles:{marker:e}}));r.setData(r.parent.data)}else r.createPoint(t,e)};TC.wrap.Feature.prototype.createPolyline=function(t,e){this.feature=tt(e.geometryName);this.feature._wrap=this;this.parent.setCoords(t);this.feature.setStyle(F({styles:{line:e}}));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createPolygon=function(t,e){const r=this;e=e||{};r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);(e.strokeColor||e.strokeWidth||e.fillColor||e.fillOpacity)&&r.feature.setStyle(F({styles:{polygon:e}}));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createMultiPolyline=function(t,e){this.feature=tt(e.geometryName);this.feature._wrap=this;this.parent.setCoords(t);this.feature.setStyle(F({styles:{line:e}}));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMultiPolygon=function(t,e){const r=this;e=e||{};r.feature=tt(e.geometryName);r.feature._wrap=r;r.parent.setCoords(t);(e.strokeColor||e.strokeWidth||e.fillColor||e.fillOpacity)&&r.feature.setStyle(F({styles:{polygon:e}}));r.setData(r.parent.data)};TC.wrap.Feature.prototype.createCircle=function(e,r){const n=this;n.feature=tt(r.geometryName);n.feature._wrap=n;n.parent.setCoords(e);r&&n.feature.setStyle(new t.style.Style({stroke:new t.style.Stroke({color:r.strokeColor,width:r.strokeWidth,lineDash:r.lineDash}),fill:new t.style.Fill({color:w(r.fillColor,r.fillOpacity)})}));n.setData(n.parent.data)};TC.wrap.Feature.createFeature=function(e,r){return new Promise(function(n,i){var o,a=e.getGeometry();(r=r||{}).id=e.getId();switch(!0){case a instanceof t.geom.Point:var s=e.getStyle();TC.Util.isFunction(s)&&(s=s(e));for(var l=s?Array.isArray(s)?s:[s]:[],c=0,u=l.length;c<u;c++)if((s=l[c]).getImage()instanceof t.style.Icon){o="Marker";break}o=o||"Point";break;case a instanceof t.geom.LineString:o="Polyline";break;case a instanceof t.geom.Polygon:o="Polygon";break;case a instanceof t.geom.MultiLineString:o="MultiPolyline";break;case a instanceof t.geom.MultiPolygon:o="MultiPolygon"}o?TC.loadJS(!TC.feature||TC.feature&&!TC.feature[o],[TC.apiLocation+"TC/feature/"+o],function(){var t=new TC.feature[o](e,r);t.data=t.wrap.getData();n(t)}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){var t=new TC.Feature(e,r);t.data=t.wrap.getData();n(t)})})};TC.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()};TC.wrap.Feature.prototype.getStyle=function(){var e={},r=this.feature.getStyle();TC.Util.isFunction(r)&&(r=r(this.feature));var n=r?Array.isArray(r)?r:[r]:[];const i=function(t,e){if(t){const r=t.getFill();if(r){e.fillColor=r.getColor();Array.isArray(e.fillColor)&&(e.fillOpacity=e.fillColor[3])}}},o=function(t,e){if(t){const r=t.getStroke();if(r){e.strokeColor=r.getColor();e.strokeWidth=r.getWidth()}}};for(var a=0,s=n.length;a<s;a++){i(r=n[a],e);o(r,e);const s=r.getImage();if(s instanceof t.style.Icon){e.url=s.getSrc();const t=s.getSize(),r=s.getScale()||1;if(t){e.width=t[0]*r;e.height=t[1]*r}var l=s.getAnchor();if(l){e.anchor=[l[0]*r,l[1]*r];if(t){e.anchor[0]=e.anchor[0]/e.width;e.anchor[1]=e.anchor[1]/e.height}}}else{i(s,e);o(s,e)}var c=r.getText();if(c){e.label=c.getText();var u=c.getFont();u&&(e.fontSize=parseInt(u.match(/\d+pt/))||.75*parseInt(u.match(/\d+px/)));var h=c.getRotation();h&&(e.angle=-180*h/Math.PI);e.labelOffset=[c.getOffsetX(),c.getOffsetY()];fill=c.getFill();fill&&(e.fontColor=fill.getColor());stroke=c.getStroke();if(stroke){e.labelOutlineColor=stroke.getColor();e.labelOutlineWidth=stroke.getWidth()}}}TC.Util.extend(this.parent.options,e);return e};TC.wrap.Feature.prototype.getGeometry=function(){var e;if(this.feature&&this.feature.getGeometry){var r=this.feature.getGeometry();r&&(r.getCoordinates?e=r.getCoordinates():r instanceof t.geom.Circle&&(e=[r.getCenter(),r.getRadius()]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){const r=this;if(r.feature&&r.feature.getGeometry){var n,i,o,a,s,l,c,u,h=r.feature.getGeometry();switch(!0){case TC.feature.MultiPolygon&&r.parent instanceof TC.feature.MultiPolygon:l=!0;n=t.geom.MultiPolygon;s=e;Array.isArray(s)&&(a=e[0]);case TC.feature.Polygon&&r.parent instanceof TC.feature.Polygon||TC.feature.MultiPolyline&&r.parent instanceof TC.feature.MultiPolyline:c=!0;n=n||(TC.feature.Polygon&&r.parent instanceof TC.feature.Polygon?t.geom.Polygon:t.geom.MultiLineString);a=l?a:e;Array.isArray(a)&&(o=a[0]);case TC.feature.Polyline&&r.parent instanceof TC.feature.Polyline:u=!0;n=n||t.geom.LineString;o=c?o:e;Array.isArray(o)&&(i=o[0]);case TC.feature.Point&&r.parent instanceof TC.feature.Point:n=n||t.geom.Point;i=u?i:e;if(Array.isArray(i)&&"number"==typeof i[0]&&"number"==typeof i[1]){switch(i.length){case 3:p=t.geom.GeometryLayout.XYZ;break;case 4:p=t.geom.GeometryLayout.XYZM;break;default:p=t.geom.GeometryLayout.XY}if(h)h.setCoordinates(e,p);else{h=new n(e,p);r.feature.setGeometry(h)}}break;case TC.feature.Circle&&r.parent instanceof TC.feature.Circle:if(Array.isArray(e)&&Array.isArray(e[0])&&"number"==typeof e[0][0]&&"number"==typeof e[0][1]&&"number"==typeof e[1]){var p;switch(e[0].length){case 3:p=t.geom.GeometryLayout.XYZ;break;case 4:p=t.geom.GeometryLayout.XYZM;break;default:p=t.geom.GeometryLayout.XY}if(h)h.setCenterAndRadius(e[0],e[1],p);else{h=new t.geom.Circle(e[0],e[1],p);r.feature.setGeometry(h)}}}}};TC.wrap.Feature.prototype.getId=function(){var t;this.feature&&(t=this.feature.getId());return t};TC.wrap.Feature.prototype.setId=function(t){this.feature&&this.feature.setId(t)};const et=function(e,r){const n=this;var i=0;e.getLinearRings().forEach(function(e){coordinates=e.getCoordinates();r.crs&&(coordinates=TC.Util.reproject(coordinates,n.parent.layer.map.crs,r.crs));const o=new t.geom.Polygon([coordinates]).getLinearRing(0);i+=t.geom.flat.linearRingLength(o.flatCoordinates,0,o.flatCoordinates.length,o.stride)});return i},rt=function(e,r){const n=this;coordinates=e.getCoordinates();r.crs&&(coordinates=TC.Util.reproject(coordinates,n.parent.layer.map.crs,r.crs));return new t.geom.LineString(coordinates).getLength()};TC.wrap.Feature.prototype.getLength=function(e){const r=this;e=e||{};var n=0;const i=r.feature.getGeometry();switch(!0){case i instanceof t.geom.Polygon:n=et.call(r,i,e);break;case i instanceof t.geom.LineString:n=rt.call(r,i,e);break;case i instanceof t.geom.MultiPolygon:i.getPolygons().forEach(function(t){n+=et.call(r,t,e)});break;case i instanceof t.geom.MultiPolygon:i.getLineStrings().forEach(function(t){n+=rt.call(r,t,e)})}return n};TC.wrap.Feature.prototype.getArea=function(e){const r=this;e=e||{};const n=r.feature.getGeometry();var i;if(n instanceof t.geom.Polygon){i=n.getLinearRing(0).getCoordinates();e.crs&&(i=TC.Util.reproject(i,r.parent.layer.map.crs,e.crs));return new t.geom.Polygon([i]).getArea()}};const nt=function(e,r){var n=e.getStyle();TC.Util.isFunction(n)&&(n=n(e));Array.isArray(n)&&(n=n[n.length-1]);if(!n&&!r){n=new t.style.Style;e.setStyle(n)}return n};TC.wrap.Feature.prototype.setStyle=function(e){const r=this.feature;if(null===e){r.setStyle(null);return}const n=this.parent,i=r.getGeometry();var o,a=nt(r);n.layer&&(o=function(e){var r=this.getStyle();TC.Util.isFunction(r)&&(r=r(e));Array.isArray(r)&&(r=r[r.length-1]);r||(r=new t.style.Style);return r}.call(n.layer.wrap.layer,n.wrap.feature));if(i instanceof t.geom.Point||i instanceof t.geom.MultiPoint){var s;if(e.anchor||e.url||e.cssClass){s=a.getImage();const r={};if(s instanceof t.style.Icon){r.src=e.url||TC.Util.getBackgroundUrlFromCss(e.cssClass)||s.getSrc();e.width&&e.height?r.size=[D(e.width,n),D(e.height,n)]:r.size=s.getSize();r.anchor=D(e.anchor,n)||s.getAnchor().map(function(t,e){return t/r.size[e]})}else{r.src=TC.Util.getPointIconUrl(e);r.anchor=D(e.anchor,n);r.size=[D(e.width,n),D(e.height,n)]}e.angle&&(r.angle=e.angle);s=new t.style.Icon(r)}else if(!a.getImage()&&a.getText())if(void 0!==e.label){a=nt(r);e.label.length?a.setText(B(e,n)):a.setText()}else a.setText();else{(s=a.getImage())||(s=new t.style.Circle);const r={radius:D(e.radius,n)||(D(e.height,n)+D(e.width,n))/4};isNaN(r.radius)&&(r.radius=s.getRadius());e.fillColor?r.fill=new t.style.Fill({color:w(D(e.fillColor,n),D(e.fillOpacity,n))}):r.fill=s.getFill();r.stroke=s.getStroke();const i=o&&o.getStroke();if(e.strokeColor||e.strokeWidth){r.stroke||(r.stroke=new t.style.Stroke);if(e.strokeColor)r.stroke.setColor(D(e.strokeColor,n));else{const t=r.stroke.getColor()||i&&i.getColor()||TC.Cfg.styles.point.strokeColor;r.stroke.setColor(D(t,n))}if(e.strokeWidth)r.stroke.setWidth(D(e.strokeWidth,n));else{const t=r.stroke.getWidth()||i&&i.getWidth()||TC.Cfg.styles.point.strokeWidth;r.stroke.setWidth(D(t,n))}}s=new t.style.Circle(r)}a.setImage(s)}else{var l=a.getStroke(),c=!1;l||(l=new t.style.Stroke);if(e.strokeColor){l.setColor(D(e.strokeColor,n));c=!0}if(e.strokeWidth){l.setWidth(D(e.strokeWidth,n));c=!0;a.setStroke(l)}if(e.lineDash){l.setLineDash(e.lineDash);c=!0;a.setStroke(l)}c&&a.setStroke(l);if((i instanceof t.geom.Polygon||i instanceof t.geom.MultiPolygon)&&(e.fillColor||e.fillOpacity)){var u=a.getFill()||new t.style.Fill;u.setColor(w(D(e.fillColor,n),D(e.fillOpacity,n)));a.setFill(u)}}if(void 0!==e.label){a=nt(r);e.label.length?a.setText(B(e,n)):a.setText()}r.changed()};TC.wrap.Feature.prototype.toggleSelectedStyle=function(t){const e=this.feature;(void 0===t?!e._originalStyle:t)?st(e):lt(e)};TC.wrap.Feature.prototype.getInnerPoint=function(e){var r,n=e||{},i=this.feature.getGeometry();const o=function(t){const e=n.clipBox;t[0]=Math.min(Math.max(t[0],e[0]),e[2]);t[1]=Math.min(Math.max(t[1],e[1]),e[3])};r=i.getFirstCoordinate();switch(i.getType()){case t.geom.GeometryType.MULTI_POLYGON:var a=0;i=i.getPolygons().reduce(function(t,e){const r=e.getArea(),n=r>a?e:t;a=r;return n});case t.geom.GeometryType.POLYGON:var s=function(t,e){for(var r=!1,n=0,i=e.length-1;n<e.length;i=n++){var o=e[n][0],a=e[n][1],s=e[i][0],l=e[i][1];a>t[1]!=l>t[1]&&t[0]<(s-o)*(t[1]-a)/(l-a)+o&&(r=!r)}return r},l=i.getCoordinates();d=l,n.clipBox&&d[0].forEach(o);r=(i=new t.geom.Polygon(l)).getInteriorPoint().getCoordinates();for(var c=i.getLinearRings(),u=1;u<c.length;u++)if(s(r,c[u].getCoordinates())){r=i.getClosestPoint(r);break}break;case t.geom.GeometryType.MULTI_LINE_STRING:var h=0;i=i.getLineStrings().reduce(function(t,e){const r=e.getLength(),n=r>h?e:t;h=r;return n});case t.geom.GeometryType.LINE_STRING:var p=[0,0];!function(t){const e=n.clipBox;if(e)for(var r=t.length-1;r>=0;r--){const n=t[r],i=n[0],o=n[1];(i<e[0]||i>e[2]||o<e[1]||o>e[3])&&t.splice(r,1)}}(l=i.getCoordinates());i=new t.geom.LineString(l);for(u=0;u<l.length;u++){p[0]+=l[u][0];p[1]+=l[u][1]}p[0]/=l.length;p[1]/=l.length;r=i.getClosestPoint(p)}var d;return r};TC.wrap.Feature.prototype.showPopup=function(e){var r=e.map;if(r){var n=this.feature;if(n){r.currentFeature=this.parent;var i=r.getExtent();this._innerCentroid=this.getInnerPoint({clipBox:i});e.contentDiv.innerHTML=this.parent.getInfo({locale:r.options.locale});e.menuDiv.innerHTML="";if(e.options.closeButton||void 0===e.options.closeButton){const t=document.createElement("div");t.classList.add(e.CLASS+"-close");t.setAttribute("title",e.getLocaleString("close"));e.menuDiv.appendChild(t);t.addEventListener(TC.Consts.event.CLICK,function(){e.hide()});e.contentDiv.classList.add(e.CLASS+"-has-btn");const r=e.contentDiv.querySelector(".tc-ctl-finfo");if(r){r.width="auto";r.height="auto"}}var o,a=this.parent.options;if(TC.Util.isEmptyObject(a)&&this.parent.layer&&this.parent.layer.options&&this.parent.layer.options.styles)switch(this.parent.CLASSNAME){case"TC.feature.Point":(a=this.parent.layer.options.styles.point)&&!TC.Util.isEmptyObject(a)||(a=this.parent.layer.options.styles.marker);break;case"TC.feature.Marker":a=this.parent.layer.options.styles.marker;break;case"TC.feature.Circle":a=this.parent.layer.options.styles.circle;break;case"TC.feature.MultiPolygon":case"TC.feature.Polygon":a=this.parent.layer.options.styles.polygon;break;case"TC.feature.MultiPolyline":case"TC.feature.Polyline":a=this.parent.layer.options.styles.line}if(a.anchor)o=D(a.anchor,this.parent);else{for(var s,l=n._wrap.parent,c=0;c<r.workLayers.length;c++){var u=r.workLayers[c];if(!u.isRaster()&&u.features.indexOf(l)>=0){s=u.wrap.styleFunction(n);break}}if(Array.isArray(s)){const e=s[0].getImage();o=!e||e instanceof t.style.Icon?[.5,0]:[.5,.5]}}const p=[0,0];if(o)if(a.height)p[1]=-(D(a.height,this.parent)||0)*o[1];else{var h=nt(n,!0);if(h){const e=h.getImage();e instanceof t.style.Icon&&(p[1]=e.getImageSize()[1]*-e.getScale())}}e.wrap.setDragged(!1);e.wrap.popup.setOffset(p);e.wrap.popup.setPosition(this._innerCentroid);e.popupDiv.classList.add(TC.Consts.classes.VISIBLE)}else r.wrap.hidePopup(e)}};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof t.Feature};TC.wrap.Feature.prototype.getPath=function(){var t=[];this.feature&&this.feature._folders&&(t=this.feature._folders);return t};TC.wrap.Feature.prototype.getBounds=function(){var t=null;this.feature&&(t=this.feature.getGeometry().getExtent());return t};TC.wrap.Feature.prototype.getTemplate=function(){var t=null,e=this.feature.getStyle();TC.Util.isFunction(e)&&(e=e(this.feature));if(Array.isArray(e))for(var r=0;r<e.length;r++)if(e[r]._balloon){if(e[r]._balloon.getText()){e=e[r]._balloon;break}}e&&!Array.isArray(e)&&e.getText&&(t=e.getText());return t};TC.wrap.Feature.prototype.getData=function(){var t=this.feature.getProperties();Array.isArray(t.features)&&(t=1===t.features.length?t.features[0].getProperties():t.features.length+" elementos");var e=this.feature.getGeometryName();t[e]&&delete t[e];return t};TC.wrap.Feature.prototype.setData=function(t){this.feature.setProperties(t)};TC.wrap.Feature.prototype.clearData=function(){const t=this.feature,e=t.getGeometryName();t.getKeys().forEach(function(r){r!==e&&t.unset(r)})};TC.wrap.control.Draw.prototype.mouseMoveHandler=function(t){const e=this;e.sketch&&e.parent.trigger(TC.Consts.event.MEASUREPARTIAL,e.getMeasureData())};TC.wrap.control.Draw.prototype.mouseOverHandler=function(t){const e=this;if(e.sketch&&e.hoverCoordinate){e.pushCoordinate(e.hoverCoordinate);e.hoverCoordinate=null}};TC.wrap.control.Draw.prototype.clickHandler=function(t){const e=this;if(e.parent.map.view!==TC.Consts.view.PRINTING){if(e._mdPx){const r=e._mdPx[0]-t.clientX,n=e._mdPx[1]-t.clientY;if(r*r+n*n>e.interaction.squaredClickTolerance_)return}if(e.sketch){var r=e.sketch.getGeometry().getCoordinates();e.parent.trigger(TC.Consts.event.POINT,{point:r[r.length-1]})}}};TC.wrap.control.Draw.prototype.mousedownHandler=function(t){this._mdPx=[t.clientX,t.clientY]};TC.wrap.control.Draw.prototype.getMeasureData=function(){var e=this,r={units:t.proj.Units.METERS};if(this.sketch){var n=this.sketch.getGeometry();n instanceof t.geom.Polygon?function(r,n){r=new t.geom.Polygon([TC.Util.reproject(r.getLinearRing(0).getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs)]);n.area=r.getArea();var i=r.getLinearRing(0);n.perimeter=t.geom.flat.linearRingLength(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)}(n,r):n instanceof t.geom.LineString&&function(r,n){r=new t.geom.LineString(TC.Util.reproject(r.getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs));n.length=r.getLength()}(n,r)}return r};TC.wrap.control.Draw.prototype.activate=function(e){var r,n=this;switch(e){case TC.Consts.geom.POLYGON:r=t.geom.GeometryType.POLYGON;break;case TC.Consts.geom.POINT:r=t.geom.GeometryType.POINT;break;default:r=t.geom.GeometryType.LINE_STRING}n.parent.map&&Promise.all([n.parent.map.wrap.getMap(),n.parent.getLayer()]).then(function(i){const o=i[0],a=i[1];a&&a.wrap.getLayer().then(function(i){n.viewport||(n.viewport=o.getViewport());if(n.interaction){o.removeInteraction(n.interaction);if(n._mousedownHandler){n.viewport.removeEventListener("mousedown",n._mousedownHandler);n._mousedownHandler=null}if(n._clickHandler){n.viewport.removeEventListener(TC.Consts.event.CLICK,n._clickHandler);n._clickHandler=null}if(n._mouseMoveHandler&&n._mouseOverHandler){n.viewport.removeEventListener("mousemove",n._mouseMoveHandler);n.viewport.removeEventListener("mouseover",n._mouseOverHandler)}}n.snapInteraction&&o.removeInteraction(n.snapInteraction);if(e){n._mousedownHandler=n.mousedownHandler.bind(n);n._clickHandler=n.clickHandler.bind(n);n.viewport.addEventListener("mousedown",n._mousedownHandler);n.viewport.addEventListener(TC.Consts.event.CLICK,n._clickHandler);if(n.parent.measure){n._mouseMoveHandler=n.mouseMoveHandler.bind(n);n._mouseOverHandler=n.mouseOverHandler.bind(n);n.viewport.addEventListener("mousemove",n._mouseMoveHandler);n.viewport.addEventListener("mouseover",n._mouseOverHandler)}var a={type:r,snapTolerance:0,condition:function(){t.events.condition.shiftKeyOnly(arguments[0])&&(hole=o.forEachFeatureAtPixel(o.getPixelFromCoordinate(arguments[0].coordinate),function(e){return t.geom.GeometryType.POLYGON==e.getGeometry().getType()||t.geom.GeometryType.MULTI_POLYGON==e.getGeometry().getType()?e:null},{hitTolerance:T}));return n.parent.map.view!==TC.Consts.view.PRINTING||null}};i&&(a.source=i.getSource());switch(e){case TC.Consts.geom.RECTANGLE:a.style=F({styles:{line:n.parent.styles.line}});a.type=t.geom.GeometryType.LINE_STRING;a.maxPoints=2;a.geometryFunction=function(e,r){const n=e[0],i=e[1],o=[[n,[n[0],i[1]],i,[i[0],n[1]],n]];r?r.setCoordinates(o):r=new t.geom.Polygon(o);return r};break;case TC.Consts.geom.POLYGON:a.style=F({styles:{polygon:n.parent.styles.polygon}});break;case TC.Consts.geom.POINT:a.style=F({styles:{point:n.parent.styles.point}});break;default:a.style=F({styles:{line:n.parent.styles.line}})}n.interaction=new t.interaction.Draw(a);n.interaction.on("drawstart",function(t){n.sketch=t.feature;n.parent.trigger(TC.Consts.event.DRAWSTART)},this);n.interaction.on("drawend",function(t){t.feature.setStyle(t.target.overlay_.getStyle().map(function(t){return t.clone()}));n.parent.measure&&n.parent.trigger(TC.Consts.event.MEASURE,n.getMeasureData());q(n.sketch).then(function(t){n.parent.trigger(TC.Consts.event.DRAWEND,{feature:t});n.sketch=null})},this);n._projectionChangeHandler=function(e){!function(e,r){if(e.sketch){const i=r.oldValue.getProjection(),o=r.target.get(r.key).getProjection();if(i.getCode()!==o.getCode()){const r=e.sketch.getGeometry();r.transform(i,o);e.interaction.sketchPoint_.getGeometry().transform(i,o);const a=[];var n;n="Polygon"===e.interaction.getMode()?e.interaction.sketchCoords_[0]:e.interaction.sketchCoords_;t.geom.flat.deflateCoordinates(a,0,n,r.stride);t.proj.getTransform(i,o)(a,a,r.stride);n=t.geom.flat.inflateCoordinates(a,0,a.length,r.stride);"Polygon"===e.interaction.getMode()?e.interaction.sketchCoords_=[n]:e.interaction.sketchCoords_=n}}}(n,e)};o.on("change:view",n._projectionChangeHandler);o.addInteraction(n.interaction);if(n.parent.snapping){var s={};i?s.source=i.getSource():n.parent.snapping instanceof TC.Layer&&(s.source=n.parent.snapping.wrap.layer.getSource());n.snapInteraction=new t.interaction.Snap(s);o.addInteraction(n.snapInteraction)}}n.redoStack=[]})})};TC.wrap.control.Draw.prototype.deactivate=function(){var t=this;t.parent.map&&Promise.all([t.parent.map.wrap.getMap(),t.parent.getLayer()]).then(function(e){const r=e[0],n=e[1];if(t.viewport){if(t._mousedownHandler){t.viewport.removeEventListener("mousedown",t._mousedownHandler);t._mousedownHandler=null}if(t._clickHandler){t.viewport.removeEventListener(TC.Consts.event.CLICK,t._clickHandler);t._clickHandler=null}}n&&!t.parent.persistent&&n.clearFeatures();if(t.interaction){r.removeInteraction(t.interaction);t.interaction=null}r.un("change:view",t._projectionChangeHandler)})};TC.wrap.control.Draw.prototype.popCoordinate=function(){var e=null;if(this.interaction){var r=this.interaction.sketchFeature_;if(r){var n,i=r.getGeometry();i instanceof t.geom.Polygon?n=i.getCoordinates()[0]:i instanceof t.geom.LineString&&(n=i.getCoordinates());if(n.length>1){var o;i instanceof t.geom.Polygon?o=this.interaction.sketchCoords_[0]:i instanceof t.geom.LineString&&(o=this.interaction.sketchCoords_);var a,s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<n.length;c++)if(n[c][0]==l[0]&&n[c][1]==l[1]){s=!0;break}e=o[a=s?o.length-2:o.length-1];o.splice(a,1);if(i instanceof t.geom.Polygon){i.setCoordinates([o]);this.interaction.sketchLine_.getGeometry().setCoordinates(o)}else i.setCoordinates(o);r.setGeometry(i)}}}return e};TC.wrap.control.Draw.prototype.pushCoordinate=function(e){var r=!1;if(this.interaction){var n=this.interaction.sketchFeature_;if(n){var i,o=n.getGeometry();o instanceof t.geom.Polygon?i=o.getCoordinates()[0]:o instanceof t.geom.LineString&&(i=o.getCoordinates());var a;o instanceof t.geom.Polygon?a=this.interaction.sketchCoords_[0]:o instanceof t.geom.LineString&&(a=this.interaction.sketchCoords_);var s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<i.length;c++)if(i[c][0]==l[0]&&i[c][1]==l[1]){s=!0;break}index=s?a.length-1:a.length;a.splice(index,0,e);if(o instanceof t.geom.LineString)o.setCoordinates(a,t.geom.GeometryLayout.XY);else{o.setCoordinates([a],t.geom.GeometryLayout.XY);this.interaction.sketchLine_.getGeometry().setCoordinates(a)}r=!0}}return r};TC.wrap.control.Draw.prototype.undo=function(){var t=!1,e=this.popCoordinate();if(e){this.redoStack.push(e);t=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return t};TC.wrap.control.Draw.prototype.redo=function(){var t=!1;if(this.redoStack.length>0){this.pushCoordinate(this.redoStack.pop());t=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return t};TC.wrap.control.Draw.prototype.end=function(){this.interaction&&this.interaction.sketchFeature_&&this.interaction.finishDrawing()};TC.wrap.control.Draw.prototype.setStyle=function(t){const e=this;e.interaction&&e.interaction.overlay_.setStyle(F({styles:t}))};TC.wrap.control.CacheBuilder.prototype.getRequestSchemas=function(t){for(var e=t.extent,r=t.layers,n=new Array(r.length),i=0,o=n.length;i<o;i++){var a=r[i],s={layerId:a.id},l=a.wrap.layer.getSource();l.getUrls&&(s.url=l.getUrls()[0]);if(l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),h=c.getMatrixIds(),p=a.getLayerNodeByName(a.layerNames),d=null,f=0,g=p.TileMatrixSetLink.length;f<g;f++){var y=p.TileMatrixSetLink[f];if(y.TileMatrixSet===a.matrixSet){d=y.TileMatrixSetLimits;break}}s.tileMatrixLimits=[];f=0;for(var m=u.length;f<m;f++){var C=c.getOrigin(f),v=c.getTileSize(f),T=u[f],_=v*T,S={mId:h[f],res:T,origin:C,tSize:v,cl:Math.floor((e[0]-C[0])/_),cr:Math.floor((e[2]-C[0])/_),rt:Math.floor((C[1]-e[3])/_),rb:Math.floor((C[1]-e[1])/_)};if(d){var E=d[f];if(E){S.cl=Math.max(S.cl,E.MinTileCol);S.cr=Math.min(S.cr,E.MaxTileCol);S.rt=Math.max(S.rt,E.MinTileRow);S.rb=Math.min(S.rb,E.MaxTileRow)}}S.cl<=S.cr&&S.rt<=S.rb&&s.tileMatrixLimits.push(S)}}n[i]=s}return n};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(t){var e="",r=t.wrap.layer.getSource();r.getUrls&&(e=r.getUrls()[0]);if(t.options.encoding!==TC.Consts.WMTSEncoding.RESTFUL){e.indexOf("?")<0&&(e+="?");e.indexOf("?")===e.length-1&&(e=e+"layer="+t.layerNames+"&style=default&tilematrixset="+encodeURIComponent(t.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(t.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")}return e};const it=function(e){return new t.style.Stroke({color:"#ffffff",width:e+4})},ot=function(e){return new t.style.Stroke({color:"#000000",width:e+6})},at=function(e){void 0===e&&(e=[]);e instanceof t.style.Style&&(e=[e]);const r=(e=e.slice())[0];if(r){const i=r.getImage();var n;if(i instanceof t.style.RegularShape){n=i.getStroke().getWidth();const o=i.getRadius(),a=r.clone();a.setImage(new t.style.Circle({radius:o,stroke:it(n)}));e.unshift(a);const s=r.clone();s.setImage(new t.style.Circle({radius:o,stroke:ot(n)}));e.unshift(s)}const o=r.getStroke();if(o){n=o.getWidth();e.unshift(new t.style.Style({stroke:it(n)}));e.unshift(new t.style.Style({stroke:ot(n)}))}return e}return null},st=function(e){ct.call(e);e.changed();t.events.listen(e,l,ct,e)},lt=function(e){t.events.unlisten(e,l,ct,e);if(e._originalStyle){e.setStyle(null);e.setStyle(e._originalStyle)}e._originalStyle=null},ct=function(){this.style_=function(t){t._originalStyle=t._originalStyle||t.getStyle();return TC.Util.isFunction(t._originalStyle)?function(e,r){return at(t._originalStyle(e,r))}:at(t._originalStyle)}(this);this.styleFunction_=this.style_?t.Feature.createStyleFunction(this.style_):void 0};TC.wrap.control.Modify.prototype.activate=function(){const e=this;e.parent.map&&Promise.all([e.parent.map.wrap.getMap(),e.parent.layer.wrap.getLayer()]).then(function(r){const n=r[0],i=r[1];e.selectInteraction&&n.removeInteraction(e.selectInteraction);var o=new t.interaction.Select({layers:[i],hitTolerance:T});e.selectInteraction=o;n.addInteraction(o);var a=function(t){return t._wrap.parent};o.on("select",function(t){t.selected.length>0&&e.parent.trigger(TC.Consts.event.FEATURESSELECT,{ctrl:e,features:t.selected.map(a)});t.deselected.length>0&&0==t.selected.length&&e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:e.parent,features:t.deselected.map(a)})});e.modifyInteraction&&n.removeInteraction(e.modifyInteraction);var s=new t.interaction.Modify({features:o.getFeatures()});s.on("modifyend",function(t){t.features.forEach(function(t){t._wrap.parent.geometry=t._wrap.getGeometry();e.parent.trigger(TC.Consts.event.FEATUREMODIFY,{feature:t._wrap.parent,layer:e.parent.layer})})});e.modifyInteraction=s;n.addInteraction(s);e.snapInteraction&&n.removeInteraction(e.snapInteraction);if(e.parent.snapping){e.snapInteraction=new t.interaction.Snap({source:i.getSource()});n.addInteraction(e.snapInteraction)}e._onMouseMove||(e._onMouseMove=function(t){const r=n.getTarget();var i,o=n.getEventPixel(t);i=n.forEachFeatureAtPixel(o,function(t,r){return r===e.parent.layer.wrap.layer},{hitTolerance:T});r.style.cursor=i?"pointer":""});n.getViewport().addEventListener("mousemove",e._onMouseMove)})};TC.wrap.control.Modify.prototype.deactivate=function(){const t=this;if(t.modifyInteraction){t.modifyInteraction.setActive(!1);t.selectInteraction.setActive(!1);t.parent.map.wrap.getMap().then(function(e){e.getViewport().removeEventListener("mousemove",t._onMouseMove);e.removeInteraction(t.modifyInteraction);e.removeInteraction(t.selectInteraction);t.modifyInteraction=null;t.selectInteraction=null})}};TC.wrap.control.Modify.prototype.getSelectedFeatures=function(){var t=[];this.selectInteraction&&this.selectInteraction.getFeatures().forEach(function(e){t[t.length]=e._wrap.parent});return t};TC.wrap.control.Modify.prototype.setSelectedFeatures=function(t){if(this.selectInteraction){var e=this.selectInteraction.featureOverlay_.getSource();e.clear();e.addFeatures(t.map(function(t){return t.wrap.feature}))}};TC.wrap.control.Modify.prototype.unselectFeatures=function(t){t=t||[];const e=this,r=e.selectInteraction?e.selectInteraction.getFeatures():null;if(r){const n=[];r.getArray().slice().forEach(function(e){if(!t.length||t.indexOf(e)>=0){r.remove(e);n[n.length]=e._wrap.parent}});n.length&&e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{features:n})}};TC.wrap.control.Edit.prototype.activate=function(t){this.cancel(!0);t===TC.Consts.editMode.SELECT&&TC.wrap.control.Modify.prototype.activate.call(this)};TC.wrap.control.Edit.prototype.deactivate=function(){var t=this;TC.wrap.control.Modify.prototype.deactivate.call(t);if(t.drawInteraction){t.drawInteraction.abortDrawing_();t.drawInteraction.setActive(!1);t.parent.map.wrap.getMap().then(function(e){e.removeInteraction(t.drawInteraction);t.drawInteraction=null})}t.parent.trigger(TC.Consts.event.CONTROLDEACTIVATE,{ctrl:t})};TC.wrap.control.Edit.prototype.cancel=function(t,e){this.points=[];this.histPoints=[];this.control&&this.control.layer||this.modifyInteraction&&this.modifyInteraction.layer;if(this.selectInteraction){var r=this.selectInteraction.getFeatures();this.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:this.parent,feature:r.get(0)});r.clear();this.selectInteraction.setActive(!1)}};TC.wrap.control.Edit.prototype.getSelectedFeatures=function(){return TC.wrap.control.Modify.prototype.getSelectedFeatures.call(this)};TC.wrap.control.Edit.prototype.setSelectedFeatures=function(t){TC.wrap.control.Modify.prototype.setSelectedFeatures.call(this,t)};TC.wrap.control.Edit.prototype.deleteFeatures=function(t){var e=this;if(Array.isArray(t)){var r=t.map(function(t){return t.wrap.feature});e.parent.layer.wrap.getLayer().then(function(t){for(var n=e.selectInteraction?e.selectInteraction.getFeatures():null,i=0,o=r.length;i<o;i++){var a=r[i];if(n){n.remove(a);e.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{feature:a._wrap.parent})}t.getSource().removeFeature(a);e.parent.trigger(TC.Consts.event.FEATUREREMOVE,{feature:a._wrap.parent})}})}};TC.wrap.Feature.prototype.toGML=function(e,r){var n=new t.format.GML({srsName:r}).writeGeometryNode(this.feature.getGeometry());return(new XMLSerializer).serializeToString(n.firstChild).replace(/\<\/?\w/gm,function(t){var e=t.indexOf("/")>0?t.indexOf("/")+1:1;return t.substring(0,e)+"gml:"+t.substring(e)})};TC.wrap.Feature.prototype.toGeoJSON=function(){return(new t.format.GeoJSON).writeGeometry(this.feature.getGeometry())};TC.wrap.Geometry.write=function(e){var r;(e=e||{}).format;e.parser=new t.format.GeoJSON;switch(e.type){case TC.Consts.geom.POLYLINE:r=new t.geom.LineString(e.coordinates);break;case TC.Consts.geom.POLYGON:r=new t.geom.Polygon(e.coordinates);break;case TC.Consts.geom.MULTIPOINT:r=new t.geom.MultiPoint(e.coordinates);break;case TC.Consts.geom.MULTIPOLYLINE:r=new t.geom.MultiLineString(e.coordinates);break;case TC.Consts.geom.MULTIPOLYGON:r=new t.geom.MultiPolygon(e.coordinates);break;case TC.Consts.geom.POINT:default:r=new t.geom.Point(e.coordinates)}return e.parser.writeGeometry(r)};TC.wrap.Geometry.toGeoJSON=function(t){return TC.wrap.Geometry.write(t)};return t});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const t=this;TC.Control.apply(t,arguments);t.apiAttribution="";t.mainDataAttribution=null;t.dataAttributions=[];t.options.dataAttributions&&(t.dataAttributions=t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Attribution.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<div><span>&copy; ").f(e.get(["api"],!1),e,"h",["s"]).w("</span>").x(e.get(["mainData"],!1),e,{block:r},{}).x(e.get(["otherData"],!1),e,{block:a},{}).w('<div class="tc-ctl-attrib-other ').x(e.get(["isCollapsed"],!1),e,{block:s},{}).w('">').s(e.get(["otherData"],!1),e,{block:l},{}).w("</div></div>")}e.__dustBody=!0;function r(t,e){return t.w(" - ").h("i18n",e,{},{$key:"data"}).w(":").x(e.getPath(!1,["mainData","site"]),e,{else:n,block:o},{})}r.__dustBody=!0;function n(t,e){return t.x(e.getPath(!1,["mainData","name"]),e,{block:i},{})}n.__dustBody=!0;function i(t,e){return t.w("<span> &copy; ").f(e.getPath(!1,["mainData","name"]),e,"h").w("</span>")}i.__dustBody=!0;function o(t,e){return t.w('<span> &copy; <a href="').f(e.getPath(!1,["mainData","site"]),e,"h").w('" target="_blank">').f(e.getPath(!1,["mainData","name"]),e,"h").w("</a></span>")}o.__dustBody=!0;function a(t,e){return t.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",e,{},{$key:"others"}).w("...</span>")}a.__dustBody=!0;function s(t,e){return t.w(" tc-collapsed ")}s.__dustBody=!0;function l(t,e){return t.x(e.getPath(!1,["otherData",e.get(["$idx"],!1),"site"]),e,{else:c,block:u},{}).h("sep",e,{block:h},{})}l.__dustBody=!0;function c(t,e){return t.w("<span>&copy; ").f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"name"]),e,"h").w("</span>")}c.__dustBody=!0;function u(t,e){return t.w('<span>&copy; <a href="').f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"site"]),e,"h").w('" target="_blank">').f(e.getPath(!1,["otherData",e.get(["$idx"],!1),"name"]),e,"h").w("</a></span>")}u.__dustBody=!0;function h(t,e){return t.w(", ")}h.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.apiAttribution=e.map.options.attribution||e.apiAttribution;var n=function(t){if(t){var r=t.getAttribution();if(r)if(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))e.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var n=!1,i=0;i<e.dataAttributions.length;i++)if(r.name===e.dataAttributions[i].name){n=!0;break}n||e.dataAttributions.push(r)}}},i=function(t){if(t){if(!(t instanceof TC.Layer)||function(){if(t.map.workLayers.length>0){for(var e=t.map.workLayers.slice().reverse(),r=0;r<e.length;r++)if(e[r].url==t.url&&e[r].getVisibility())return!1;return!0}return!0}()){var r=t.getAttribution();if(r){var n=e.dataAttributions.reduce(function(t,e,n){return e.name===r.name?n:t},-1);const t=function(t){return(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(/IDENA/.test(t)||/Tracasa Instrumental/.test(t))||r.name===t};if(e.map.baseLayer&&e.map.baseLayer.wrap.getAttribution()&&t(e.map.baseLayer.wrap.getAttribution().name))return;if(e.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).some(function(e){var r=e.wrap.getAttribution();return r&&t(r.name)}))return;n>-1?e.dataAttributions.splice(n,1):(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(e.mainDataAttribution=null)}}}};e.render();t.loaded(function(){if(t.baseLayer.wrap.getAttribution){n(t.baseLayer.wrap);e.render()}});t.on(TC.Consts.event.LAYERADD,function(t){const r=t.layer;if(!r.isBase&&r.wrap.getAttribution){n(r.wrap);e.render()}});t.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(t){const r=t.type,o=t.newLayer,a=t.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(r)>-1&&(e.ignoreLayer=o);a&&a.wrap.getAttribution&&i(a.wrap);o&&o.wrap.getAttribution&&n(o.wrap);e.render()});t.on(TC.Consts.event.LAYERREMOVE,function(t){const r=t.layer;if(r.wrap.getAttribution){i(r.wrap);e.render()}});t.on(TC.Consts.event.TERRAINPROVIDERADD,function(t){const r=t.terrainProvider;if(r.getAttribution){n(r);e.render()}});t.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(t){const r=t.terrainProvider;if(r.getAttribution){i(r);e.render()}});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){const r=t.layer;if(e.ignoreLayer!==r&&r.wrap.getAttribution){r.getVisibility()?n(r.wrap):i(r.wrap);e.render()}});return r};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({api:e.apiAttribution,mainData:e.mainDataAttribution,otherData:e.dataAttributions,isCollapsed:!e.div.querySelector("."+e.CLASS+"-other")||e.div.querySelector("."+e.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const r=e.div.querySelector("."+e.CLASS+"-cmd");r&&r.addEventListener(TC.Consts.event.CLICK,function(){e.toggleOtherAttributions()});"function"==typeof t&&t()}))};t.toggleOtherAttributions=function(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(TC.Consts.classes.COLLAPSED)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var t=this;TC.control.MapContents.apply(t,arguments);t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code"};t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(.tc-modal-close)",function(e){if(e.target.classList.contains(t._cssClasses.LOAD_CRS_BUTTON)){t.loadFallbackProjections();return}TC.Util.closeModal();const r=e.target,n=r.dataset.crsCode,i=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog");i.classList.add(TC.Consts.classes.HIDDEN);const o=t.getLayer(i.dataset.layerId);if(o)if(n)TC.loadProjDef({crs:n,callback:function(){t.map.setProjection({crs:n,baseLayer:o})}});else{const e=t.getFallbackLayer(r.dataset.fallbackLayerId);e&&t.map.setBaseLayer(e)}}))};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var t=TC.control.BasemapSelector.prototype;t.CLASS="tc-ctl-bms";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/BasemapSelectorDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(e.get(["baseLayers"],!1),e,{block:r},{}).s(e.get(["dialogMore"],!1),e,{block:n},{}).w("</ul></form></div>")}e.__dustBody=!0;function r(t,e){return t.p("tc-ctl-bms-node",e,e.rebase(e.getPath(!0,[])),{})}r.__dustBody=!0;function n(t,e){return t.w('<li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="').h("i18n",e,{},{$key:"moreBackgroundMaps"}).w('"><input type="radio" name="bms" value="moreLayers"><span></span></label></li>')}n.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w('<li class="tc-ctl-bms-node" data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('" ><label').x(e.get(["legend"],!1),e,{block:r},{}).x(e.get(["thumbnail"],!1),e,{block:n},{}).w('><input type="radio" name="bms" value="').f(e.get(["name"],!1),e,"h").w('"').x(e.get(["mustReproject"],!1),e,{block:i},{}).w("><span>").f(e.get(["title"],!1),e,"h").w("</span></label></li>")}e.__dustBody=!0;function r(t,e){return t.w(' style="background-image: url(').f(e.getPath(!1,["legend","src"]),e,"h").w(')"')}r.__dustBody=!0;function n(t,e){return t.w(' style="background-image: url(').f(e.get(["thumbnail"],!1),e,"h").w(')"')}n.__dustBody=!0;function i(t,e){return t.w(' class="tc-disabled"')}i.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"backgroundMaps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w('</button></div></div></div><div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"baseLayerNotCompatible"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"baseLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-bms-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}const e=function(t,e){for(;t&&!t.matches(e);)t=t.parentElement;return t},r=function(t,r){const n=this;var i=!0,o=t.target,a=n.getLayer(e(o,"li").dataset.layerId);if(n.options.dialogMore&&e(o,"."+n.CLASS+"-more-dialog")){const t=n.div.querySelectorAll("input[type=radio]");for(var s=0,l=t.length;s<l;s++){const r=n.getLayer(e(t[s],"li").dataset.layerId);if(r)switch(!0){case r.id===a.id:a=r}}}if(a!=n.map.getBaseLayer())if(a.mustReproject)if(n.map.on3DView){if(!a.getFallbackLayer()){n._currentSelection.checked=!0;t.stopPropagation();return}if(a.getFallbackLayer()){const t=a.getFallbackLayer();t&&t._capabilitiesPromise.then(function(){t.isCompatible(n.map.getCRS())&&n.map.setBaseLayer(a)});i=!0}}else{n._currentSelection&&(n._currentSelection.checked=!0);const t={layer:a},e=a.getFallbackLayer();e?e._capabilitiesPromise.then(function(){e.isCompatible(n.map.getCRS())&&(t.fallbackLayer=e);n.showProjectionChangeDialog(t)}):n.showProjectionChangeDialog(t);i=!1}else{(a.type===TC.Consts.layerType.WMS||a.type===TC.Consts.layerType.WMTS&&a.getProjection()!==n.map.crs)&&a.setProjection({crs:n.map.crs});n.map.setBaseLayer(a)}this._currentSelection&&(this._currentSelection.checked=!0);r&&r(i)};t.register=function(t){const e=this,n=TC.control.MapContents.prototype.register.call(e,t);e.options.dialogMore&&t.on(TC.Consts.event.VIEWCHANGE,function(){e._getMoreBaseLayers()});t.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(t){e.update(e.div,t.layer)});e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(t){"moreLayers"===t.target.value?e.showMoreLayersDialog():r.call(e,t);t.stopPropagation()}));return n};t.render=function(t){const e=this,n=TC.control.MapContents.prototype.render.call(e,t,e.options);e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t;if(e.options.dialogMore){e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog").addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(t){r.call(e,t,function(t){t&&TC.Util.closeModal()});t.stopPropagation()}))}});return n};t.update=function(t,e){const r=this;(t=t||r.div).querySelector("ul."+r.CLASS+"-branch").querySelectorAll("li").forEach(function(t){const n=r.getLayer(t.dataset.layerId);if(n){const i=e||r.map.baseLayer,o=t.querySelector("input[type=radio]"),a=i&&(i===n||i.id===n.id||n.getFallbackLayer&&(i===n.getFallbackLayer()||n.getFallbackLayer()&&i.id===n.getFallbackLayer().id));if(r.map.on3DView&&n.mustReproject&&n.fallbackLayer&&n.getFallbackLayer)n.getFallbackLayer().getCapabilitiesPromise().then(function(){var e=!n.getFallbackLayer().isCompatible(r.map.getCRS());o.checked=a;if(e){o.classList.add(TC.Consts.classes.DISABLED);t.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);t.removeAttribute("title")}});else{o.checked=a;if(n.mustReproject){o.classList.add(TC.Consts.classes.DISABLED);t.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);t.removeAttribute("title")}}a&&(r._currentSelection=o)}});r.updateScale()};t.updateLayerTree=function(t){const e=this;if(t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);var r=e.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r,e.layerTrees[t.id],function(r,n){const i=(new DOMParser).parseFromString(n,"text/html").body.firstChild;var o=i.dataset.layerUid;const a=e.div.querySelector("."+e.CLASS+"-branch"),s=a.querySelector('li[data-layer-uid="'+o+'"]');if(s)s.innerHTML=i.innerHTML;else{i.dataset.layerId=t.id;var l=e.map.baseLayers.filter(function(t){return!t.stealth}).map(function(t){return t.id}).indexOf(t.id);const r=a.querySelectorAll("li");l<0||l>=r.length?a.appendChild(i):a.insertBefore(i,r[l])}r&&TC.error(r)});e.update()})}};t.updateLayerOrder=function(t,e,r){};t.removeLayer=function(t){const e=this;if(t.isBase){const i=e.div.querySelector("."+e.CLASS+"-branch").querySelectorAll("li");for(var r=0,n=i.length;r<n;r++){const e=i[r];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}}};t.onErrorLayer=function(t){const e=this;t.isBase&&!t.options.stealth&&e.map.toast(e.getLocaleString("baseLayerNotAvailable",{mapName:t.title}),{type:TC.Consts.msgType.ERROR})};t.getFallbackLayer=function(t){const e=this,r=function(e){return e.fallbackLayer&&e.fallbackLayer.id===t};var n=e.map.baseLayers.filter(r)[0].fallbackLayer;!n&&e._moreBaseLayers&&(n=e._moreBaseLayers.filter(r)[0].fallbackLayer);return n};t.loadFallbackProjections=function(){const t=this;t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li").forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(TC.Consts.classes.HIDDEN)})};t.showProjectionChangeDialog=function(t){const e=this,r=(t=t||{}).layer,n=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog"),i=n.querySelector(".tc-modal-body");i.classList.add(TC.Consts.classes.LOADING);const o=r.getCompatibleCRS();n.classList.remove(TC.Consts.classes.HIDDEN);n.dataset.layerId=r.id;const a=n.querySelector("ul."+e.CLASS+"-crs-list");a.innerHTML="";e.map.loadProjections({crsList:e.map.getCompatibleCRS({layers:e.map.workLayers.concat(r),includeFallbacks:!0}),orderBy:"name"}).then(function(r){var n=!1;const s=document.createDocumentFragment();r.forEach(function(r){const i=document.createElement("li"),a=document.createElement("button");if(0===o.filter(function(t){return TC.Util.CRSCodesEqual(t,r.code)}).length){n=!0;a.innerHTML=r.name+" ("+r.code+")";t.layer.fallbackLayer&&(a.dataset.fallbackLayerId=t.layer.fallbackLayer.id);a.dataset.crsCode=r.code;a.classList.add(TC.Consts.classes.WARNING);i.classList.add(TC.Consts.classes.HIDDEN)}else{a.innerHTML=e.getLocaleString("changeMapToCrs",{crs:r.name+" ("+r.code+")"});a.dataset.crsCode=r.code}i.appendChild(a);s.appendChild(i)});if(t.fallbackLayer){const r=document.createElement("li"),n=document.createElement("button");n.innerHTML=e.getLocaleString("reprojectOnTheFly");n.dataset.fallbackLayerId=t.fallbackLayer.id;r.appendChild(n);s.appendChild(r)}if(n){const t=document.createElement("li"),r=document.createElement("button");r.classList.add(e._cssClasses.LOAD_CRS_BUTTON);r.innerHTML=e.getLocaleString("showOnTheFlyProjections");t.appendChild(r);s.appendChild(t)}a.appendChild(s);i.classList.remove(TC.Consts.classes.LOADING)});n.querySelector("."+e.CLASS+"-name").innerHTML=r.title||r.name;TC.Util.showModal(n)};t.showMoreLayersDialog=function(){const t=this,e=t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog");e.classList.toggle(TC.Consts.classes.THREED,!!t.map.on3DView);const r=e.querySelector(".tc-modal-body");r.innerHTML="";r.classList.add(TC.Consts.classes.LOADING);e.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(e,{closeCallback:function(){this._currentSelection.checked=!0;this.update()}.bind(t)});e.querySelector(".tc-modal-window").classList.add(t.CLASS+"-more-dialog");t._getMoreBaseLayers().then(function(){t.getRenderedHtml(t.CLASS,{baseLayers:t._moreBaseLayers},function(e){r.innerHTML=e;r.classList.remove(TC.Consts.classes.LOADING);r.querySelectorAll("li").forEach(function(e,r){e.dataset.layerId=t._moreBaseLayers[r].id});t.update(r)})})};t.getLayer=function(t){return this.map&&(this.map.getLayer(t)||this._moreBaseLayers&&this._moreBaseLayers.filter(function(e){return e.id===t})[0])};const n=function(t){return new Promise(function(e,r){Promise.all([t.getCapabilitiesPromise(),t.getFallbackLayer()?t.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then(function(){e()})})};t._getMoreBaseLayers=function(){const t=this;if(t._moreBaseLayers||t._moreBaseLayersPromise){if(t._moreBaseLayers)return new Promise(function(e,r){Promise.all(t._moreBaseLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).map(function(e){return t.map.on3DView?n(e):e.getCapabilitiesPromise()})).then(function(){t._moreBaseLayers=t._moreBaseLayers.map(function(e){if(e.type===TC.Consts.layerType.WMTS){var r=e.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];e.mustReproject=!r}else e.type===TC.Consts.layerType.WMS&&(e.mustReproject=!e.isCompatible(t.map.getCRS()));if(t.map.on3DView&&e.mustReproject&&e.getFallbackLayer&&e.getFallbackLayer()){e.mustReproject=!e.getFallbackLayer().isCompatible(t.map.getCRS());return e}return e});e(t._moreBaseLayers)})})}else t._moreBaseLayersPromise=new Promise(function(e,r){var i=TC.Cfg.availableBaseLayers.filter(function(t){return-1==TC.Cfg.availableBaseLayers.filter(function(t){return t.fallbackLayer}).map(function(t){return t.fallbackLayer}).indexOf(t.id)}).map(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(t):t.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(t):void 0});Promise.all(i).then(function(r){t._moreBaseLayers=new Array(r.length);var i=r.length;const o=function(){t._moreBaseLayers=t._moreBaseLayers.filter(function(t){return null!==t});e(t._moreBaseLayers)},a=function(e){const r=this;r.map=t.map;r.isBase=r.options.isBase=!0;if(r.type===TC.Consts.layerType.WMTS){var n=r.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];r.mustReproject=!n}else r.type===TC.Consts.layerType.WMS&&(r.mustReproject=!r.isCompatible(t.map.getCRS()));t.map.on3DView&&r.mustReproject&&r.getFallbackLayer&&r.getFallbackLayer()&&(r.mustReproject=!r.getFallbackLayer().isCompatible(t.map.getCRS()));t._moreBaseLayers.splice(e,1,r);0===--i&&o()};r.forEach(function(e,r){if(e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS){(t.map.on3DView?n(e):e.getCapabilitiesPromise()).then(a.bind(e,r),function(e){t._moreBaseLayers.splice(r,1,null);0===--i&&o()})}else a.call(e,r)})})});return t._moreBaseLayersPromise}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";TC.control.CacheBuilder=function(){var t=this;TC.control.SWCacheClient.apply(this,arguments);var r=t._classSelector="."+t.CLASS;t._selectors={DRAW:r+"-draw",DRAWING:r+"-drawing",PROGRESS:r+"-progress",NEW:r+"-new",LIST:r+"-list",LISTITEM:r+"-list > li",OKBTN:r+"-btn-ok",NEWBTN:r+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:r+"-tile-count",NAMETB:r+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:r+"-link-exit",OFFPANEL:r+"-off-panel",BLLIST:r+"-bl-list",BLLISTITEM:r+"-bl-list > li",BLLISTTEXT:r+"-bl-panel-txt",RNGMAXRES:r+"-rng-maxres",SEARCH:r+"-map-available-srch",EMPTYLIST:r+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};t.storedMaps=[];const n=TC.Util.getParameterByName(t.MAP_DEFINITION_PARAM_NAME),i=TC.Util.getParameterByName(t.MAP_EXTENT_PARAM_NAME);t.mapIsOffline=!!n;n&&(t.currentMapDefinition=JSON.parse(window.atob(decodeURIComponent(n))));i&&(t.currentMapExtent=e(i));try{t.localStorage=window.localStorage;const e="__delete_me__";t.localStorage.setItem(e,e);t.localStorage.removeItem(e)}catch(e){t.localStorage=null;TC.error(t.getLocaleString("couldNotAccessLocalStorage"))}if(t.localStorage){for(var o=0,a=t.localStorage.length;o<a;o++){var s=t.localStorage.key(o);if(0===s.indexOf(t.LOCAL_STORAGE_KEY_PREFIX)&&s!==t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash"){var l=t.localStorage.getItem(s).split(" "),c=e(l.shift()),u={name:l.join(" "),extent:c,url:decodeURIComponent(s.substr(t.LOCAL_STORAGE_KEY_PREFIX.length))};t.storedMaps.push(u)}}t.storedMaps.sort(function(t,e){return t.name>e.name?1:t.name<e.name?-1:0})}var h=TC.Util.extend({},a>1?arguments[1]:arguments[0]);t._dialogDiv=TC.Util.getDiv(h.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));h.dialogDiv||document.body.appendChild(t._dialogDiv);t.mapIsOffline&&document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)});TC.Control.apply(t,arguments);t.wrap=new TC.wrap.control.CacheBuilder(t);t.isDownloading=!1;t.baseLayers=[];t.options.avgTileSize=t.options.avgTileSize||TC.Cfg.avgTileSize;t.requestSchemas=[];t.minResolution=0;t.currentMap=null;t._loadedCount=0;var p=history.pushState;history.pushState=function(e){var r;r=p.apply(history,arguments);if(t._offlinePanelDiv){const e=TC.Util.getQueryStringParams();delete e[t.MAP_DEFINITION_PARAM_NAME];delete e[t.MAP_EXTENT_PARAM_NAME];delete e[t.SERVICE_WORKER_FLAG];var n=TC.Util.getParamString(e);n.length&&(n="?"+n);const r=location.pathname+n+location.hash;t._offlinePanelDiv.querySelector(t._selectors.EXIT).setAttribute("href",r)}return r};var d=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},f=function(){if(t._offlinePanelDiv){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.remove(TC.Consts.classes.CONNECTION_OFFLINE,TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI);switch(d.type){case 1:case 2:case void 0:e.classList.add(TC.Consts.classes.CONNECTION_WIFI);break;default:e.classList.add(TC.Consts.classes.CONNECTION_MOBILE)}}};d.addEventListener&&d.addEventListener("typechange",f);window.addEventListener("online",f);window.addEventListener("offline",function(){if(t._offlinePanelDiv){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);e.classList.remove(TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI)}})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var t=TC.control.CacheBuilder.prototype;t.CLASS="tc-ctl-cbuild";t.MAP_DEFINITION_PARAM_NAME="map-def";t.MAP_EXTENT_PARAM_NAME="map-extent";t.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";t.ROOT_CACHE_NAME="root";t.SERVICE_WORKER_FLAG="sw";t._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};t._actions={CREATE:"create",DELETE:"delete"};t.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";t.template[t.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";t.template[t.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";t.template[t.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(e.get(["listId"],!1),e,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",e,{},{$key:"cb.filter.plhr"}).w('"').x(e.get(["storedMaps"],!1),e,{else:r,block:n},{}).w(' maxlength="200" /> <ul id="').f(e.get(["listId"],!1),e,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(e.get(["storedMaps"],!1),e,{block:i},{}).w("><span>").h("i18n",e,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",e,{},{$key:"noMatches"}).w("</span></li>").s(e.get(["storedMaps"],!1),e,{block:o},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",e,{},{$key:"newofflinemap"}).w('">').h("i18n",e,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",e,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.w(" disabled")}r.__dustBody=!0;function n(t,e){return t}n.__dustBody=!0;function i(t,e){return t.w(" hidden")}i.__dustBody=!0;function o(t,e){return t.p("tc-ctl-cbuild-map-node",e,e.rebase(e.getPath(!0,[])),{})}o.__dustBody=!0;return e};t.template[t.CLASS+"-map-node"]=function(){dust.register(t.CLASS+"-map-node",e);function e(t,e){return t.w('<li data-extent="').f(e.get(["extent"],!1),e,"h").w('"><span><a href="').f(e.get(["url"],!1),e,"h").w('" title="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(e.get(["name"],!1),e,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",e,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",e,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",e,{},{$key:"editMapName"}).w('">').h("i18n",e,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",e,{},{$key:"viewMapExtent"}).w('">').h("i18n",e,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",e,{},{$key:"deleteMap"}).w('">').h("i18n",e,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-bl-node"]=function(){dust.register(t.CLASS+"-bl-node",e);function e(t,e){return t.w('<li class="tc-ctl-cbuild-bl-node" data-layer-uid="').f(e.get(["id"],!1),e,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(e.get(["thumbnail"],!1),e,"h").w(')"><input type="checkbox" name="cbbl" value="').f(e.get(["id"],!1),e,"h").w('" disabled><span>').f(e.get(["title"],!1),e,"h").w("</span></label></li>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",e,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",e,{},{$key:"availableOfflineMaps"}).w('</h4><p class="tc-ctl-cbuild-bl-panel-txt">').h("i18n",e,{},{$key:"selectAtLeastOne"}).w('</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",e,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",e,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",e,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",e,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-off-panel"]=function(){dust.register(t.CLASS+"-off-panel",e);function e(t,e){return t.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",e,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",e,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",e,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e}}const e=function(t){return decodeURIComponent(t).split(",").map(function(t){return parseFloat(t)})},r=function(t,e){e.querySelector("span").classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.TEXTBOX).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.SAVEBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.CANCELBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.EDITBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.VIEWBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.DELETEBTN).classList.remove(TC.Consts.classes.HIDDEN)};var n=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},i=function(t,e){var r=e||{};const n=t._dialogDiv.querySelector(t._classSelector+"-res"),i=t._dialogDiv.querySelector(t._selectors.RNGMAXRES);var o,a,s,l=t.getResolutions();if(l.length){i.setAttribute("max",l.length-1);if(t.minResolution){if(void 0===r.rangeValue)for(var c=0,u=l.length;c<u;c++)if(t.minResolution>=l[c]){i.value=c;break}}else if(void 0===r.rangeValue){const e=t.map.getResolution();i.value=l.filter(t=>t>e).length}a=parseInt(i.value);var h=Math.floor(1e3*new Number(l[a]))/1e3;o=t.getLocaleString("metersPerPixel",{value:h.toLocaleString((t.map?t.map.options.locale:TC.Cfg.locale).replace("_","-"))});s=100*(a+1)/(l.length+1)+"%";i.disabled=!1;t.minResolution=l[i.value]}else{a=0;o="";i.value=0;s="0";t.minResolution=0;i.disabled=!0}n.style.left=s;n.innerHTML=o};const o=function(t){t._dialogDiv.querySelectorAll(t._classSelector+"-bl-node input[type=checkbox]").forEach(function(e,r){if(e.checked){var n=t.requestSchemas.filter(function(t){return t.layerId===e.value})[0];if(n){var i=function(t,e){for(var r=null,n=0,i=t.tileMatrixLimits.length;n<i&&!((r=t.tileMatrixLimits[n]).res<=e);n++);return r}(n,t.minResolution);if(i){var o=n.url;if(o.indexOf("{TileMatrix}")<0){var a=o.indexOf("?");a>=0&&(o=o.substr(0,a));for(var s=0,l=t.baseLayers.length;s<l;s++){var c=t.baseLayers[s];if(c.id===n.layerId){o=o+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}for(;e&&"LABEL"!==e.tagName;)e=e.parentElement;if(e){e.style.backgroundSize="auto";e.style.backgroundPosition="left bottom";e.style.backgroundImage="url("+o.replace("{TileMatrix}",i.mId).replace("{TileRow}",i.rt).replace("{TileCol}",i.cl)+")"}}}}})},a=function(t,e){return e<1?t.getLocaleString("lessThan1Mb"):t.getLocaleString("approxXMb",{quantity:n(e)})},s=function(t){var e="";t.tileCount=0;for(var r=0,i=t.requestSchemas.length;r<i;r++)for(var o=t.requestSchemas[r],s=0,l=o.tileMatrixLimits.length;s<l;s++){var c=o.tileMatrixLimits[s];t.tileCount+=(c.cr-c.cl+1)*(c.rb-c.rt+1);if(c.res<t.minResolution)break}if(t.tileCount){t.estimatedMapSize=Math.round(t.tileCount*t.options.avgTileSize/1048576);e=t.getLocaleString("xTiles",{quantity:n(t.tileCount)})+" ("+a(t,t.estimatedMapSize)+")"}t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML=e},l=function(t,e){var r=e.indexOf("#");r>=0&&(e=e.substr(0,r));const n=t.div.querySelectorAll(t._selectors.LISTITEM);for(var i=0,o=n.length;i<o;i++){const t=n[i],r=t.querySelector("a");if(r&&r.getAttribute("href")===e)return t}return null};var c=function(t,e){var r=!1;if(t.localStorage){t.localStorage.setItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e.url),e.extent+" "+e.name);r=!0}return r};const u=function(t,e){const r=t.findStoredMap({url:e});if(r){if(function(t,e){var r=!1;if(t.localStorage){t.localStorage.removeItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e));r=!0}return r}(t,e)){const e=function(t,e){const r=t.div.querySelectorAll(t._selectors.LISTITEM);for(var n=0,i=r.length;n<i;n++){const t=r[n],i=t.querySelector("a");if(i&&i.innerHTML===e)return t}return null}(t,r.name);e&&e.parentElement.removeChild(e)}var n=t.storedMaps.indexOf(r);t.storedMaps.splice(n,1);if(!t.storedMaps.length){t.div.querySelector(t._selectors.SEARCH).disabled=!0;t.div.querySelector(t._selectors.EMPTYLIST).removeAttribute("hidden")}return r.name}return null};t.render=function(t){const n=this;return n._set1stRenderPromise(new Promise(function(a,u){var h={storedMaps:n.storedMaps,listId:n.CLASS+"-list-"+TC.getUID()};n.getRenderedHtml(n.CLASS+"-dialog",null,function(t){n._dialogDiv.innerHTML=t;n._dialogDiv.querySelector(n._selectors.NAMETB).addEventListener(TC.Consts.event.CLICK,function(t){t.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){n.renderData(h,function(){n._dialogDiv.querySelector(n._selectors.OKBTN).addEventListener(TC.Consts.event.CLICK,function(){n.generateCache()});n._dialogDiv.querySelector(n._selectors.NAMETB).addEventListener("input",function(){n._updateReadyState()});n.div.querySelector(n._selectors.NEWBTN).addEventListener(TC.Consts.event.CLICK,function(){n.setEditState()});n.div.querySelector(n._classSelector+"-btn-cancel-draw").addEventListener(TC.Consts.event.CLICK,function(){n.setReadyState()});n.div.querySelector(n._classSelector+"-btn-cancel-dl").addEventListener(TC.Consts.event.CLICK,function(){n.cancelCacheRequest()});const a=n.div.querySelector(n._selectors.LIST);a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.DELETEBTN,function(t){n.startDeleteMap(t.target.parentElement.querySelector("a").innerHTML)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.EDITBTN,function(t){!function(t,e){e.querySelector("span").classList.add(TC.Consts.classes.HIDDEN);const r=e.querySelector(t._selectors.TEXTBOX);r.classList.remove(TC.Consts.classes.HIDDEN);r.value=e.querySelector("span a").innerHTML;r.focus();e.querySelector(t._selectors.SAVEBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.CANCELBTN).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.EDITBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.VIEWBTN).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(t._selectors.DELETEBTN).classList.add(TC.Consts.classes.HIDDEN)}(n,t.target.parentElement)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.CANCELBTN,function(t){const e=t.target.parentElement;e.querySelector(n._selectors.TEXTBOX).value=e.querySelector("a").innerHTML;r(n,e)}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.SAVEBTN,function(t){const e=t.target.parentElement;r(n,e);const i=e.querySelector("a"),o=(i.innerHTML,e.querySelector(n._selectors.TEXTBOX).value),a=n.findStoredMap({url:i.getAttribute("href")});if(a){a.name=o;i.innerHTML=o;i.setAttribute("title",o);c(n,a)}}));a.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(n._selectors.VIEWBTN,function(t){const r=t.target;var i=!r.classList.contains(TC.Consts.classes.ACTIVE);const o=n.div.querySelector(n._selectors.VIEWBTN);o.classList.remove(TC.Consts.classes.ACTIVE);o.parentElement.classList.remove(TC.Consts.classes.ACTIVE);const a=r.parentElement.querySelector("a").innerHTML;if(a){var s=n.findStoredMap({name:a});if(s){var l=e(s.extent);n.layer.clearFeatures();if(i){n.layer.addPolygon([[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]],{showsPopup:!1}).then(function(){n.layer.map.zoomToFeatures(n.layer.features)});r.classList.add(TC.Consts.classes.ACTIVE);r.parentElement.classList.add(TC.Consts.classes.ACTIVE);r.setAttribute("title",n.getLocaleString("removeMapExtent"))}}}}));const u=n.div.querySelector(n._selectors.SEARCH),h=function(){!function(t){t=t.toLowerCase();const e=n.div.querySelectorAll(n._selectors.LISTITEM);e.forEach(function(t){t.style.display="none"});const r=[];e.forEach(function(t){t.matches("li:not([class]),li."+TC.Consts.classes.ACTIVE)&&r.push(t)});if(0===t.length){r.forEach(function(t){t.style.removeProperty("display")});n.div.querySelector(n._classSelector+"-map-search-icon").style.visibility="visible"}else{n.div.querySelector(n._classSelector+"-map-search-icon").style.visibility="hidden";var i=new RegExp(t,"i");r.forEach(function(t){t.style.display=i.test(t.querySelector("a").textContent)?"":"none"});r.some(function(t){return!t.hidden})||e.forEach(function(t){t.matches('[class^="tc-ctl-cbuild-map-not"]')&&t.style.removeProperty("display")})}}(this.value.toLowerCase().trim())};u.addEventListener("keyup",h);u.addEventListener("search",h);n._dialogDiv.querySelector(n._selectors.BLLIST).addEventListener("change",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(t){const e=t.target;if(e.checked)n.baseLayers.push(n.map.getLayer(e.value));else for(var r=0,a=n.baseLayers.length;r<a;r++){if(n.baseLayers[r].id===e.value){n.baseLayers.splice(r,1);break}}n.updateRequestSchemas();i(n);o(n);n._updateReadyState();s(n)}));const p=n._dialogDiv.querySelector(n._selectors.RNGMAXRES),d=function(t){i(n,{rangeValue:t.target.value});o(n);s(n)};p.addEventListener("input",d);p.addEventListener("change",d);const f=l(n,location.href);f&&f.classList.add(TC.Consts.classes.ACTIVE);TC.Util.isFunction(t)&&t()}).then(function(){a()}).catch(function(t){u(t instanceof Error?t:Error(t))})});window.addEventListener("beforeunload",function(t){if(n.isDownloading){var e=n.getLocaleString("cb.mapDownloading.warning");t.returnValue=e;return e}},!0)}))};t.register=function(t){var e=this;const r=TC.control.SWCacheClient.prototype.register.call(e,t);if(navigator.serviceWorker){navigator.serviceWorker.ready.then(function(){navigator.serviceWorker.addEventListener("message",function(t){switch(t.data.event){case"progress":e.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:t.data.name,loaded:t.data.count,total:t.data.total});break;case"cached":e.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t.data.name});break;case"deleted":e.trigger(TC.Consts.event.MAPCACHEDELETE,{url:t.data.name});break;case"error":t.data.action===e._actions.CREATE&&TC.error(e.getLocaleString("cb.resourceDownload.error",{url:t.data.url}))}})});navigator.onLine&&new Promise(function(t,e){var r=document.documentElement.getAttribute("manifest")||"manifest.appcache";r?TC.ajax({url:r,method:"GET",responseType:"text"}).then(function(e){var r=e.data;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var e=hex_md5(r),n=r.indexOf("NETWORK:");n>=0&&(r=r.substr(0,n));(n=r.indexOf("FALLBACK:"))>=0&&(r=r.substr(0,n));(n=r.indexOf("SETTINGS:"))>=0&&(r=r.substr(0,n));var i=r.split(/[\n\r]/).filter(function(t){return t.length>0&&0!==t.indexOf("#")&&"CACHE:"!==t});i.shift();t({hash:e,urls:i})})}).catch(function(){e()}):e()}).then(function(t){const r=e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash";var n;e.localStorage&&(n=e.localStorage.getItem(r));if(n!==t.hash){e.cacheUrlList(t.urls);e.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){const i=!n;e.localStorage&&e.localStorage.setItem(r,t.hash);i||TC.confirm(e.getLocaleString("newAppVersionAvailable"),function(){location.reload()})})}})}if(e.mapIsOffline){t.div.classList.add(TC.Consts.classes.OFFLINE);e._offlinePanelDiv=TC.Util.getDiv(e.options.offlinePanelDiv);e.options.offlinePanelDiv||t.div.appendChild(e._offlinePanelDiv);e.getRenderedHtml(e.CLASS+"-off-panel",null,function(t){e._offlinePanelDiv.innerHTML=t;if(!navigator.onLine){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE,TC.Consts.classes.CONNECTION_WIFI)}e._offlinePanelDiv.querySelector(e._selectors.EXIT).addEventListener(TC.Consts.event.CLICK,function(t){TC.confirm(e.getLocaleString("offlineMapExit.confirm"),null,function(){t.preventDefault()})})})}const n=e.getUID(),i=e.getUID();e.layerPromise=t.addLayer({id:i,type:TC.Consts.layerType.VECTOR,stealth:!0,styles:{line:t.options.styles.line}});e.layer=null;Promise.all([e.layerPromise,e.renderPromise(),t.addControl("draw",{id:n,div:e.div.querySelector(e._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1})]).then(function(r){const n=e.layer=r[0],i=e.boxDraw=r[2];i.setLayer(n);i.on(TC.Consts.event.DRAWSTART,function(t){e.map.toast(e.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(t){var r=t.feature.geometry[0],n=r[0],i=r[2],a=Math.min(n[0],i[0]),l=Math.max(n[0],i[0]),c=Math.min(n[1],i[1]),u=Math.max(n[1],i[1]);e.setExtent([a,c,l,u]);const h=e._dialogDiv.querySelectorAll("input[type=checkbox]");h.forEach(function(t){const r=e.map.getLayer(t.value);for(var n=t;n&&"LI"!==n.tagName;)n=n.parentElement;const i=e.wrap.getRequestSchemas({extent:e.extent,layers:[r]})[0].tileMatrixLimits;n.classList.toggle(TC.Consts.classes.HIDDEN,!i.length)});const p=e._dialogDiv.querySelector(e._selectors.BLLISTITEM+":not(."+TC.Consts.classes.HIDDEN+")");e._dialogDiv.querySelector(e._selectors.BLLISTTEXT).innerHTML=e.getLocaleString(p?"selectAtLeastOne":"cb.noMapsAtSelectedExtent");o(e);s(e);TC.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-dialog"),{openCallback:function(){h.forEach(function(t){t.disabled=!1});var t;if(Date.prototype.toLocaleString){var r={};r.year=r.month=r.day=r.hour=r.minute=r.second="numeric";t=(new Date).toLocaleString(e.map.options.locale.replace("_","-"),r)}else t=(new Date).toString();e._dialogDiv.querySelector(e._selectors.NAMETB).value=t;e._updateReadyState()},closeCallback:function(){h.forEach(function(t){t.disabled=!0});e.boxDraw.layer.clearFeatures()}})});t.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){i===t.control&&e._state===e._states.EDITING&&e.setReadyState()})});var a=function(t){var r=!1;const n=e._dialogDiv.querySelector(e._selectors.BLLIST),i=function(){return!!n.querySelector('li[data-layer-uid="'+t.id+'"]')};var o=t.type===TC.Consts.layerType.WMTS&&!t.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(o=o&&TC.Util.isSameOrigin(t.url));if(o&&!i()){r=!0;e.getRenderedHtml(e.CLASS+"-bl-node",t,function(t){if(!i()){const e=new DOMParser;n.appendChild(e.parseFromString(t,"text/html").body.firstChild)}})}return r};t.on(TC.Consts.event.LAYERADD,function(t){if(t.layer.isBase&&e.mapIsOffline){const r=t.layer.getResolutions();if(r){const n=r.filter(t=>t>=e.currentMapDefinition.res);n.length&&t.layer.setResolutions(n)}}e.renderPromise().then(function(){a(t.layer)})}).on(TC.Consts.event.LAYERREMOVE,function(t){e.renderPromise().then(function(){const r=t.layer;if(r.type===TC.Consts.layerType.WMTS){const t=e._dialogDiv.querySelector(e._selectors.BLLIST).querySelector('li[data-layer-uid="'+r.id+'"]');t.parentElement.removeChild(t)}})});t.ready(function(){if(e.mapIsOffline){var r,n,i=[];for(r=0,n=e.offlineControls.length;r<n;r++){var o=e.offlineControls[r];o=o.substr(0,1).toUpperCase()+o.substr(1);i=i.concat(t.getControlsByClass("TC.control."+o))}for(r=0,n=t.controls.length;r<n;r++){var a=t.controls[r];i.indexOf(a)<0&&a.disable()}document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)})}});t.loaded(function(){e.layerPromise.then(function(e){t.putLayerOnTop(e)});e.renderPromise().then(function(){e.div.querySelector(e._selectors.NEWBTN).disabled=!1;for(var r=0,n=t.baseLayers.length;r<n;r++)a(t.baseLayers[r])});if(e.mapIsOffline){const r=e.currentMapDefinition,n=function(t,e){return(0===t.url.indexOf("//")?location.protocol+t.url:t.url)===r.url[e.urlIdx]&&t.layerNames===e.id&&t.matrixSet===r.tms[e.tmsIdx]},i=t.options.availableBaseLayers.filter(t=>t.type===TC.Consts.layerType.WMTS).filter(t=>r.layers.some(e=>n(t,e))).filter(e=>!t.baseLayers.some(t=>t.id===e.id));Promise.all(i.map(e=>t.addLayer(TC.Util.extend({},e,{isBase:!0})))).finally(function(){const i=[];for(var o=0,a=r.layers.length;o<a;o++)for(var s=0,l=t.baseLayers.length;s<l;s++){const e=t.baseLayers[s];if(e.type===TC.Consts.layerType.WMTS&&n(e,r.layers[o])){i.push(e);break}}i.length&&t.setBaseLayer(i[0],function(){for(var r=t.baseLayers.length-1;r>=0;r--){const e=t.baseLayers[r];e.type===TC.Consts.layerType.VECTOR||i.includes(e)||t.removeLayer(e)}t.setExtent(e.currentMapExtent,{animate:!1})})})}});e.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(r){e.isDownloading=!1;const n=function(t){const e=t.indexOf("#");return e>=0?t.substr(0,e):t}(r.url),i=l(e,n);if(i&&!e.serviceWorkerEnabled){i.classList.remove(TC.Consts.classes.DISABLED);TC.alert(e.getLocaleString("cb.delete.error"))}else if(e.currentMap&&n===e.currentMap.url){!function(t){const e=t.currentMap;if(c(t,e)){t.getRenderedHtml(t.CLASS+"-map-node",{name:e.name,url:e.url},function(e){const r=new DOMParser;t.div.querySelector(t._selectors.LIST).appendChild(r.parseFromString(e,"text/html").body.firstChild);t.div.querySelector(t._selectors.EMPTYLIST).setAttribute("hidden","hidden");t.div.querySelector(t._selectors.SEARCH).disabled=!1});t.storedMaps.push(e)}}(e);t.toast(e.getLocaleString("mapDownloaded",{mapName:e.currentMap.name}))}e.currentMap=null;e.setReadyState()}).on(TC.Consts.event.MAPCACHEDELETE,function(r){e.isDownloading=!1;var n=u(e,r.url)||e.currentMap&&e.currentMap.name;e.currentMap=null;n&&t.toast(e.getLocaleString("mapDeleted",{mapName:n}));e.setReadyState()}).on(TC.Consts.event.MAPCACHEPROGRESS,function(t){var r=t.total;!r&&e.requestSchemas&&(r=e.requestSchemas[0].tileCount);var n=t.loaded;if(n)e._loadedCount=n;else{e._loadedCount+=1;n=e._loadedCount}e.showDownloadProgress(n,r)}).on(TC.Consts.event.MAPCACHEERROR,function(t){e.isDownloading=!1;e.setReadyState();var r=e.getLocaleString("cb.mapCreation.error"),n=!0;switch(t.reason){case"quota":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==t.status&&u(e,t.url);n=!1;break;case"already_exists":r+=". "+e.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(n)if(TC.Util.detectIE()){TC.error(r);TC.alert(e.getLocaleString("cb.mapCreation.error.reasonEdge"))}else TC.alert(r);e.currentMap=null});return r};t.setExtent=function(t){if(Array.isArray(t)&&t.length>=4){this.extent=t;this.updateRequestSchemas()}};t._updateReadyState=function(){this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!this.extent||0===this._dialogDiv.querySelector(this._selectors.NAMETB).value.length||this._dialogDiv.querySelector(this._selectors.RNGMAXRES).disabled};t.setReadyState=function(){const t=this;t._state=t._states.READY;t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(t._selectors.LISTITEM).forEach(function(t){t.classList.remove(TC.Consts.classes.DISABLED)});t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!1;t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML="";t.extent=null;t._loadedCount=0;t.boxDraw&&t.boxDraw.cancel()};t.setEditState=function(){this._state=this._states.EDITING;this.showDownloadProgress(0,1);this.div.querySelector(this._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.DRAWING).classList.remove(TC.Consts.classes.HIDDEN);this.map.toast(this.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!0;this.div.querySelector(this._selectors.NEWBTN).disabled=!0;this._dialogDiv.querySelector(this._selectors.NAMETB).value="";this.boxDraw.activate()};t.generateCache=function(){const t=this,e={mapName:t._dialogDiv.querySelector(t._selectors.NAMETB).value};if(t.findStoredMap({name:e.mapName}))TC.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var r=function(){t.div.querySelector(t._classSelector+"-name").innerHTML=e.mapName;t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName}));!function(t){t._state=t._states.DOWNLOADING;TC.Util.closeModal();t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.remove(TC.Consts.classes.HIDDEN);t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!0;t.layer.clearFeatures();t.boxDraw.cancel()}(t);t.requestCache(e)};navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then(function(n){const i=(n.quota-n.usage)/1048576;t.estimatedMapSize<i?r():TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:a(t,t.estimatedMapSize),availableStorage:a(t,Math.round(i))}),r)}):r()}};t.cacheUrlList=function(t,e){var r=e||{};this.createCache(r.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:t,silent:r.silent})};t.requestCache=function(t){var e=this,r=t||{};if(e.map){var n=r.extent||e.extent||e.map.getExtent();e.updateRequestSchemas({extent:n});if(e.requestSchemas){for(var i=function(t,r,n){var i=t.res>=e.minResolution;!i&&r>0&&(i=n[r-1].res>e.minResolution);return i},o=function(t){return{mId:t.mId,cl:t.cl,cr:t.cr,rt:t.rt,rb:t.rb}},a=e.requestSchemas.map(function(t){return{layerId:t.layerId,tileMatrixLimits:t.tileMatrixLimits.filter(i)}}),s=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=a.length;l<c;l++){var u=a[l],h=(R=u.tileMatrixLimits[u.tileMatrixLimits.length-1]).res*R.tSize;s[0]=Math.min(s[0],R.origin[0]+h*R.cl);s[1]=Math.min(s[1],R.origin[1]-h*(R.rb+1));s[2]=Math.max(s[2],R.origin[0]+h*(R.cr+1));s[3]=Math.max(s[3],R.origin[1]-h*R.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(o)}var p=Math.pow(10,e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),d={bBox:s=s.map(function(t,e){return(e<3?Math.ceil:Math.floor)(t*p)/p}),res:Math.floor(1e3*e.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(e.baseLayers.length)};for(l=0,c=e.baseLayers.length;l<c;l++){var f=e.baseLayers[l],g=0===f.url.indexOf("//")?location.protocol+f.url:f.url,y=d.url.indexOf(g);y<0&&(y=d.url.push(g)-1);var m=d.tms.indexOf(f.matrixSet);m<0&&(m=d.tms.push(f.matrixSet)-1);var C=f.format.substr(f.format.indexOf("/")+1),v=d.format.indexOf(C);v<0&&(v=d.format.push(C)-1);d.layers[l]={urlIdx:y,id:f.layerNames,tmsIdx:m,formatIdx:v}}var T=TC.Util.getQueryStringParams(),_=T[e.MAP_EXTENT_PARAM_NAME]=s.toString();T[e.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(d));e.serviceWorkerEnabled&&(T[e.SERVICE_WORKER_FLAG]=1);var S=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+"?"+TC.Util.getParamString(T);e.currentMap={name:r.mapName,extent:_,url:S};e.isDownloading=!0;if(e.serviceWorkerEnabled){const t=[];for(l=0,c=a.length;l<c;l++){for(var E=a[l],L=null,w=0,b=e.baseLayers.length;w<b;w++){var A=e.baseLayers[w];if(A.id===E.layerId){L=e.wrap.getGetTilePattern(A);A.getFallbackLayer&&A.getFallbackLayer();A.thumbnail&&t.push(A.thumbnail);break}}if(L)for(var x=0,P=E.tileMatrixLimits.length;x<P;x++)for(var R,I=(R=E.tileMatrixLimits[x]).rt;I<=R.rb;I++)for(var M=R.cl;M<=R.cr;M++)t.push(L.replace("{TileMatrix}",R.mId).replace("{TileCol}",M).replace("{TileRow}",I))}t.push(S);e.cacheUrlList(t,{name:S})}}}};t.cancelCacheRequest=function(){var t=this;t.currentMap&&t.deleteCache(t.currentMap.url).then(function(e){e||(t.currentMap=null)});t.isDownloading=!1;t.setReadyState()};t.deleteMap=function(t){var e=this.findStoredMap({name:t});e&&this.deleteCache(e.url)};t.startDeleteMap=function(t){const e=this;if(navigator.onLine){if(t){var r=e.getLocaleString("cb.delete.confirm",{mapName:t});e.serviceWorkerEnabled||(r=r+" "+e.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(r))if(navigator.onLine){!function(t){t._state=t._states.DELETING;t.showDownloadProgress(0,1);t.div.querySelector(t._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);t.div.querySelector(t._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(t._selectors.LISTITEM).forEach(function(t){t.classList.add(TC.Consts.classes.DISABLED)});t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0;t.div.querySelector(t._selectors.NEWBTN).disabled=!1;t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML="";t.boxDraw.cancel()}(e);e.deleteMap(t)}else TC.alert(e.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(e.getLocaleString("cb.delete.conn.alert"))};t.findStoredMap=function(t){return this.storedMaps.filter(function(e){var r=!0;t.name&&t.name!==e.name&&(r=!1);r&&t.url&&t.url!==e.url&&(r=!1);return r})[0]};t.showDownloadProgress=function(t,e){const r=this,n=r._classSelector,i=r.div.querySelector(n+"-progress-count");if(e){var o=Math.min(Math.round(100*t/e),100)+"%";r.div.querySelector(n+"-progress-ratio").style.width=o;i.innerHTML=o}else{r.div.querySelector(n+"-progress-bar").classList.add(TC.Consts.classes.HIDDEN);i.innerHTML=r.getLocaleString("xFiles",{quantity:t})}};t.updateRequestSchemas=function(t){var e=t||{};e.extent=e.extent||this.extent;e.layers=e.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(e);return this.requestSchemas};t.getResolutions=function(){var t=[];const e=function(t){return t.res},r=this.requestSchemas.map(function(t){return t.tileMatrixLimits.map(e)});(t=t.concat.apply(t,r)).sort(function(t,e){return e-t});return t}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.ControlContainer=function(){TC.control.Container.apply(this,arguments);this._classSelector="."+this.CLASS};TC.inherit(TC.control.ControlContainer,TC.control.Container);!function(){var t=TC.control.ControlContainer.prototype;t.CLASS="tc-ctl-cctr";t.SIDE={LEFT:"left",RIGHT:"right"};t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/ControlContainer.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/ControlContainerNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.write('<ul class="tc-ctl-cctr-left">').section(e.get("controls"),e,{block:r},null).write('</ul><ul class="tc-ctl-cctr-right">').section(e.get("controls"),e,{block:i},null).write("</ul>")}function r(t,e){return t.helper("eq",e,{block:n},{key:e.get("side"),value:"left"})}function n(t,e){return t.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(e.get("index"),e,"h").write('"><div></div></li>')}function i(t,e){return t.helper("eq",e,{block:o},{key:e.get("side"),value:"right"})}function o(t,e){return t.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(e.get("index"),e,"h").write('"><div></div></li>')}return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(e.get(["index"],!1),e,"h").w('"><div></div></li>')}e.__dustBody=!0;return e}}t.onRenderPromise=function(){const t=this;var e=new Array(t.ctlCount);Object.keys(t.controlOptions).forEach(function(r,n){var i=t.controlOptions[r];e[n]=t.map.addControl(r,TC.Util.extend({id:t.uids[n],div:t.div.querySelector("."+t.CLASS+"-elm-"+n).querySelector("div")},i.options))});Promise.all(e).then(function(){for(var e=0,r=arguments.length;e<r;e++){arguments[e].containerControl=t}})};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({controls:Object.keys(e.controlOptions).map(function(t,r){return TC.Util.extend(e.controlOptions[t],{index:r})})}))};t.addControl=function(t,e){const r=this;e.side=e.side||r.SIDE.LEFT;return new Promise(function(n,i){r.getRenderedHtml(r.CLASS+"-node",{index:++r.ctlCount},function(i){var o=document.createElement("template");o.innerHTML=i.trim();r.div.querySelector("ul."+r.CLASS+"-"+e.side).appendChild(o.content?o.content.firstChild:o.firstChild);r.map.addControl(t,TC.Util.extend({id:r.getUID(),div:r.div.querySelector("."+r.CLASS+"-elm-"+r.ctlCount).querySelector("div")},e)).then(function(t){n(t)})})})};t.addElement=function(t){t.side=t.side||this.SIDE.LEFT;var e=document.createElement("li");e.setAttribute("class",this.CLASS+"-elm "+this.CLASS+"-elm-"+this.ctlCount+++" ");this.div.querySelector("ul."+this.CLASS+"-"+t.side).appendChild(e);var r=e.appendChild(t.htmlElement);r.setAttribute("class",r.getAttribute("class")+" tc-ctl");return r}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);TC.Util.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var t=TC.control.Coordinates.prototype;t.CLASS="tc-ctl-coords";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Coordinates.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CoordinatesDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(e.get(["crs"],!1),e,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",e,{},{$key:"changeCRS"}).w('">').f(e.get(["crs"],!1),e,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(e.get(["isGeo"],!1),e,{else:r,block:i},{}).w("</div>").x(e.get(["showGeo"],!1),e,{block:a},{}).w('<span class="close"></span>')}e.__dustBody=!0;function r(t,e){return t.w('x: <span class="tc-ctl-coords-x">').f(e.get(["x"],!1),e,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(e.get(["y"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w('z: <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}n.__dustBody=!0;function i(t,e){return t.h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(e.get(["lat"],!1),e,"h").w("</span> ").h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(e.get(["lon"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:o},{})}i.__dustBody=!0;function o(t,e){return t.h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}o.__dustBody=!0;function a(t,e){return t.w('<div class="tc-ctl-coords-alt"><div class="tc-ctl-coords-xy">').h("i18n",e,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(e.get(["lat"],!1),e,"h").w("</span> ").h("i18n",e,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(e.get(["lon"],!1),e,"h").w("</span> ").x(e.get(["ele"],!1),e,{block:s},{}).w("</div></div>")}a.__dustBody=!0;function s(t,e){return t.h("i18n",e,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(e.get(["ele"],!1),e,"h").w("</span> ")}s.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",e,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",e,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",e,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}t.register=function(t){var e=this;const r=TC.control.ProjectionSelector.prototype.register.call(e,t);e.crs=e.map.crs;e.clear();t.on(TC.Consts.event.VIEWCHANGE,function(t){const r=t.view;if(r===TC.Consts.view.PRINTING)return;const n=function(t){e.isPointerOver(t)||e.clear()};if(r===TC.Consts.view.THREED){e.isGeo=!0;e.units=TC.Consts.units.DEGREES;e.crs=e.map.view3D.crs;e.map.view3D.container.addEventListener("mouseout",n);e.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(t){if(t){if(TC.Util.detectMobile()){e.clear();e.coordsToClick({coordinate:[t.lon,t.lat,t.ele],cssClass:e._cssClasses.THREEDMARKER})}e.latLon=[t.lat,t.lon];if(t.ele>0){var r=TC.Util.getMapLocale(e.map);e.latLon.push(t.ele.toLocaleString(r)+"m")}e.update()}else e.clear()})}else if(r===TC.Consts.view.DEFAULT){e.isGeo=e.map.wrap.isGeo();e.units=TC.Consts.units.METERS;e.crs=e.map.crs;e.map.view3D&&e.map.view3D.container.removeEventListener("mouseout",n)}if(e.map.view3D){e.geoCrs=e.map.view3D.crs;e.render()}});t.loaded(function(){e.wrap.register(t).then(function(){e.render(function(){e.clear()})});TC.Util.detectMobile()&&e.renderPromise().then(function(){e.getLayer();e.activateCoords()});t.on(TC.Consts.event.PROJECTIONCHANGE,function(r){if(!t.on3DView){e.isGeo=t.wrap.isGeo();e.crs=r.crs;e.render()}});e.map.wrap.getViewport().then(function(t){e.renderPromise().then(function(){t.addEventListener(TC.Consts.event.MOUSEMOVE,function(t){e.map.on3DView||e.onMouseMove(t)});t.addEventListener(TC.Consts.event.MOUSELEAVE,function(t){e.onMouseLeave(t)})})})});return r};t.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.renderData.call(e,{x:e.x,y:e.y,lat:e.lat,lon:e.lon,ele:e.isGeo&&e.latLon.length>2?e.latLon[2]:!e.isGeo&&e.xy.length>2?e.xy[2]:null,crs:e.crs,geoCrs:e.geoCrs,isGeo:e.isGeo,showGeo:!e.isGeo&&e.options.showGeo},function(){e.div.querySelector("button."+e._cssClasses.CRS).addEventListener(TC.Consts.event.CLICK,function(t){e.showProjectionChangeDialog()});TC.Util.isFunction(t)&&t()})}))};t.onMouseMove=function(t){this.wrap.onMouseMove(t)};t.onMouseLeave=function(t){const e=this;setTimeout(function(){if(!e.isPointerOver(t)){e.div.style.visibility="hidden";e.clear()}},200)};t.isPointerOver=function(t){var e=this.div.getBoundingClientRect();return e.left<=t.clientX&&e.left+e.width>=t.clientX&&e.top<=t.clientY&&e.top+e.height>=t.clientY};t.formatCoord=function(t,e){var r;r=t.toFixed(e);e<=3&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));return r=r.replace(".",",").replace(/\|/g,".")};t.update=function(){const t=this;!t.isGeo&&t.options.showGeo&&(t.latLon=TC.Util.reproject(t.xy,t.crs,t.geoCrs).reverse());if(!t.isGeo){t.x=t.formatCoord(t.xy[0],TC.Consts.METER_PRECISION);t.y=t.formatCoord(t.xy[1],TC.Consts.METER_PRECISION)}if(t.isGeo||t.options.showGeo){t.lat=t.formatCoord(t.latLon[0],TC.Consts.DEGREE_PRECISION);t.lon=t.formatCoord(t.latLon[1],TC.Consts.DEGREE_PRECISION)}t.render(function(){const e=t.div.querySelector("span.close");if(TC.Util.detectMobile()){e.addEventListener("click",function(){t.div.classList.add(TC.Consts.classes.HIDDEN);t.clear()});e.style.display=""}else{t.div.classList.remove(TC.Consts.classes.HIDDEN);t.div.style.visibility="visible";e.style.display="none"}})};t.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(t){t.clearFeatures()})};t.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};t.activateCoords=function(){this.wrap.coordsActivate()};t.getCoords=function(){var t=this.map.getControlsByClass(TC.control.Popup);if(t&&t.length>0&&t[0].isVisible())this.coordsToPopup(t[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};t.coordsToPopup=function(t){t&&this.updateCoordsCtrl(t.wrap.popup.getPosition())};t.updateCoordsCtrl=function(t){if(t){if(!this.isGeo){this.x=t[0];this.y=t[1];this.xy=[this.x,this.y];t.length>2&&this.xy.push(t[2])}if(this.isGeo||this.options.showGeo){this.lat=t[0];this.lon=t[1];this.latLon=[this.lat,this.lon];t.length>2&&this.latLon.push(t[2])}this.update()}};t.coordsToClick=function(t){var e=this;if(!e.map.div.classList.contains("tc-ctl-sv-active "+TC.Consts.classes.COLLAPSED)){var r=e.div.getBoundingClientRect();if(r.left<=t.clientX&&t.clientX<=r.right&&r.top<=t.clientY&&t.clientY<=r.bottom){e.div.classList.add(TC.Consts.classes.HIDDEN);e.clear();return}e.div.classList.remove("tc-fading");setTimeout(function(){e.div.classList.add("tc-fading")},10);e.updateCoordsCtrl(t.coordinate);e.map.on3DView||e.coordsMarkerAdd(t.coordinate,t.cssClass);e.div.classList.remove(TC.Consts.classes.HIDDEN)}};t.coordsMarkerAdd=function(t,e){var r=this;r.currentCoordsMarker?r.currentCoordsMarker.setCoords(t):r.getLayer().then(function(n){n.addMarker(t,{title:"Coord",showsPopup:!1,cssClass:e||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(t){r.currentCoordsMarker=t})})};t.getLayer=function(){const t=this;return new Promise(function(e,r){null==t.layer?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"}).then(function(r){t.layer=r;t.layer.map.putLayerOnTop(t.layer);e(t.layer)}):e(t.layer)})}}();TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.DataLoader=function(){TC.control.TabContainer.apply(this,arguments);this.controlOptions=[{name:"externalWMS",title:"addWMS",options:{suggestions:this.options.wmsSuggestions}},{name:"fileImport",options:{enableDragAndDrop:this.options.enableDragAndDrop}}];this.defaultSelection=0};TC.inherit(TC.control.DataLoader,TC.control.TabContainer);TC.control.DataLoader.prototype.register=function(t){this.title=this.getLocaleString("addMaps");return TC.control.TabContainer.prototype.register.call(this,t)};TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");TC.control.Download=function(t){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this._hiddenElms=[];var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv)};TC.inherit(TC.control.Download,TC.control.MapInfo);!function(){var t=TC.control.Download.prototype;t.CLASS="tc-ctl-download";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Download.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"download"}).w(' </h2><div class="tc-ctl-tctr tc-ctl-tctr-select"><form><label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",e,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",e,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-collapsed"><div><label>').h("i18n",e,{},{$key:"format"}).w(':</label><select id="download-format-image" class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr" class="tc-ctl-download-image-qr-label" title="').h("i18n",e,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",e,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",e,{},{$key:"download"}).w('</button></div><div class="tc-ctl-download-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w('</p></div></div></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-collapsed"><div><label>').h("i18n",e,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",e,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",e,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",e,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",e,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",e,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",e,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",e,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",e,{},{$key:"noData"}).w(": </strong>").h("i18n",e,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg"><strong>').h("i18n",e,{},{$key:"noValidService"}).w(": </strong>").h("i18n",e,{},{$key:"noValidService.instructions"}).w("</p></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"downloadData"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",e,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",e,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",e,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.render.call(e,function(){const r=".tc-ctl-tctr";e._selectors={TAB:r+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:r+"-elm"};const n=function(t){for(var r=this;r&&!r.matches(e._selectors.TAB);)r=r.parentElement;if(r){const t=r.querySelector(e._selectors.RADIOBUTTON),n=t.value,i=e.div.querySelectorAll(e._selectors.ELEMENT);if(e._oldValue===n&&e.options.deselectable){setTimeout(function(){t.checked=!1},0);e._oldValue=null;e._activeElm=null;i.forEach(function(t){e._hiddenElms.push(t)})}else{i.forEach(function(t){t.matches(e._selectors.ELEMENT+"-"+n)?e._activeElm=t:e._hiddenElms.push(t)});e._oldValue=n}e._hiddenElms.forEach(function(t){t.classList.add(TC.Consts.classes.COLLAPSED)});e._activeElm&&e._activeElm.classList.remove(TC.Consts.classes.COLLAPSED);t.checked=!0}};e.div.querySelectorAll("span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,n)});t&&t()})})};t.register=function(t){var e=this;const r=TC.control.MapInfo.prototype.register.call(e,t);e.map.mustBeExportable=!0;var n=function(t,r){const n=e.div.querySelector(".alert-warning:not(."+e.CLASS+"-alert)");var i;switch(t.key){case TC.Consts.WFSErrors.NumMaxFeatures:i=n.querySelector("#zoom-msg").innerHTML.format({serviceName:t.params.serviceTitle});break;case TC.Consts.WFSErrors.NoLayers:i=e.getLocaleString("noLayersLoaded");break;case TC.Consts.WFSErrors.GetCapabilities:i=n.querySelector("#novalid-msg").innerHTML.format({serviceName:t.params.serviceTitle});break;case TC.Consts.WFSErrors.NoFeatures:i=n.querySelector("#noFeatures-msg").innerHTML;break;case TC.Consts.WFSErrors.Indeterminate:i=e.getLocaleString("wfs.IndeterminateError");e.map.toast(i,{type:TC.Consts.msgType.ERROR});TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:t.params.err,descripcion:t.params.errorThrown,serviceName:t.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);e.map.getLoadingIndicator().removeWait(r);return;default:i=e.getLocaleString("wfs."+t.key,t.params)}e.map.toast(i,{type:TC.Consts.msgType.WARNING});e.map.getLoadingIndicator().removeWait(r)};e.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-btn",function(){var t=e.map.getLoadingIndicator().addWait(),r="";e._activeElm&&(r=e._activeElm.querySelector("select").value);if(r.indexOf("image")>-1)new Promise(function(r,n){var i=e.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],o=TC.Util.cloneCanvas(i);e.map.getControlsByClass(TC.control.ScaleBar)&&e.drawScaleBarIntoCanvas({canvas:o,fill:!0});if(e._activeElm.querySelector("#"+e.CLASS+"-image-qr:checked")){const n="qrcode";var a=document.getElementById(n);if(a)a.innerHTML="";else{(a=document.createElement("div")).setAttribute("id",n);document.body.appendChild(a)}a.style.top="-200px";a.style.left="-200px";a.style.position="absolute";e.makeQRCode(a,87,87).then(function(n){if(n){var i=o.getContext("2d");i.fillStyle="#ffffff";i.fillRect(o.width-91,o.height-91,91,91);TC.Util.addToCanvas(o,n,{x:o.width-88,y:o.height-88}).then(function(t){r(t)})}else{TC.error(e.getLocaleString("dl.export.map.error")+": QR");e.map.getLoadingIndicator().removeWait(t)}})}else r(o)}).then(function(n){try{const t=n.toDataURL(r);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+r.split("/")[1],r,t)}catch(t){TC.error(e.getLocaleString("dl.export.map.error")+": "+t.message)}e.map.getLoadingIndicator().removeWait(t)});else{var i=e.map.getExtent(),o=TC.WFSGetFeatureBuilder(e.map,new TC.filter.bbox(i,e.map.getCRS()),r,!0);Promise.all(o).then(function(r){var i=r.filter(function(t){return null!=t});if(0!==i.length){for(var o=[],a=0;a<i.length;a++)if(i[a].errors&&i[a].errors.length)for(var s=0;s<i[a].errors.length;s++){var l=i[a].errors[s];n(l,t)}else{var c=i[a].data,u=i[a].url;c&&u&&o.push({url:u+"?download=zip",data:c})}TC.Util.downloadFileForm(o);e.map.getLoadingIndicator().removeWait(t)}else n({key:TC.Consts.WFSErrors.NoLayers},t)})}}));e.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-help",function(t){t.stopPropagation();TC.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-help-dialog"))}));e.div.addEventListener("change",TC.EventTarget.listenerBySelector("#"+e.CLASS+"-image-qr",function(t){t.target.checked?e.generateLink():e.div.querySelector("."+e.CLASS+"-alert").classList.add(TC.Consts.classes.HIDDEN)}));e.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){e.generateLink();e.registerListeners()}));return r};t.manageMaxLengthExceed=function(t){const e=this.div.querySelector("."+this.CLASS+"-alert");document.getElementById(this.CLASS+"-image-qr").checked?e.classList.toggle(TC.Consts.classes.HIDDEN,!t.qr):e.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change";!function(){const t=function(t){const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return e&&e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:t};TC.control.Draw=function(){var t=this;TC.Control.apply(t,arguments);if(!TC.browserFeatures.inputTypeColor()&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}t._classSelector="."+t.CLASS;t._pointClass=t.CLASS+"-point";t._lineClass=t.CLASS+"-line";t._polygonClass=t.CLASS+"-polygon";t.history=[];t.historyIndex=0;t.exportsState=!0;t.on(TC.Consts.event.DRAWSTART,function(e){t.resetValues()}).on(TC.Consts.event.POINT,function(e){t.layer&&!t.persistent&&t.layer.features&&t.layer.features.length>0&&t.layer.clearFeatures();t.history.length=t.historyIndex;t.history[t.historyIndex++]=e.point;r(t)}).on(TC.Consts.event.DRAWEND,function(e){n(t);e.feature.setId(TC.getUID(t.getLocaleString("sketch")+"."));t.callBack&&t.callBack(e.feature)});t._layerPromise=null};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var r=function(t){t._endBtn.disabled=0===t.historyIndex||t.mode===TC.Consts.geom.POLYGON&&t.historyIndex<3||t.mode===TC.Consts.geom.POLYLINE&&t.historyIndex<2;t._redoBtn.disabled=t.history.length===t.historyIndex;t._undoBtn.disabled=0===t.historyIndex},n=function(t){t.resetValues();t._endBtn.disabled=!0;t._cancelBtn.disabled=!1};TC.isDebug?e.template=TC.apiLocation+"TC/templates/Draw.html":e.template=function(){dust.register(e.CLASS,t);function t(t,e){return t.w('<div class="tc-ctl-draw-tools"><button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(e.get(["tooltip"],!1),e,"h").w('">').h("i18n",e,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",e,{},{$key:"undo"}).w('">').h("i18n",e,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",e,{},{$key:"redo"}).w('">').h("i18n",e,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="').h("i18n",e,{},{$key:"end"}).w('">').h("i18n",e,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",e,{},{$key:"cancel"}).w('">').h("i18n",e,{},{$key:"cancel"}).w("</button></div>").x(e.get(["styleTools"],!1),e,{block:r},{})}t.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-draw-style">').h("i18n",e,{},{$key:"strokeColor"}).w('<input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="').f(e.get(["strokeColor"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"selectColor"}).w('" />').h("i18n",e,{},{$key:"strokeWidth"}).w('<div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:').f(e.get(["strokeWidth"],!1),e,"h").w('px;"> </div><input type="number" class="tc-ctl-draw-str-w tc-textbox" value="').f(e.get(["strokeWidth"],!1),e,"h").w('" min="1" max="15" /></div>')}r.__dustBody=!0;return t};e.render=function(e){var r,n,i,o=this;switch(o.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:r=o.getLocaleString("drawLine");o.div.classList.add(o._lineClass);n=TC.Cfg.styles.line.strokeColor;i=TC.Cfg.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:r=o.getLocaleString("drawPolygon");o.div.classList.add(o._polygonClass);n=TC.Cfg.styles.polygon.strokeColor;i=TC.Cfg.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:r=o.getLocaleString("drawPoint");o.div.classList.add(o._pointClass);n=TC.Cfg.styles.point.strokeColor;i=TC.Cfg.styles.point.strokeWidth;break;default:r=o.getLocaleString("draw");n=TC.Cfg.styles.line.strokeColor;i=TC.Cfg.styles.line.strokeWidth}const a={tooltip:r,strokeColor:t(n),strokeWidth:i,styleTools:o.options.styleTools};return o._set1stRenderPromise(o.renderData(a,function(){if(!TC.browserFeatures.inputTypeColor()){const t=o.div.querySelector("input[type=color]");if(t){t.style.backgroundColor=t.value;t.style.color="transparent";const e=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()};t.onfocus=function(t){this.blur()};t.onchange=function(t){this.style.backgroundColor=this.value};o.map.loaded(function(){e.on("change",function(t){o.setStrokeColor("#"+t)})})}}o.reset=!0;o.callBack=null;o.measure=!1;o._cancelClick=!1;o.mode=o.options.mode||TC.Consts.geom.POLYLINE;o.options.measure&&(o.measure=o.options.measure);TC.Util.isFunction(o.options.callback)&&(o.callBack=o.options.callback);void 0===o.options.persistent?o.persistent=!0:o.persistent=o.options.persistent;o.wrap=new TC.wrap.control.Draw(o);o._newBtn=o.div.querySelector(o._classSelector+"-btn-new");o._newBtn.addEventListener(TC.Consts.event.CLICK,function(){o.new()});o._cancelBtn=o.div.querySelector(o._classSelector+"-btn-cancel");o._cancelBtn.addEventListener(TC.Consts.event.CLICK,function(){o.cancel()});o._endBtn=o.div.querySelector(o._classSelector+"-btn-end");o._endBtn.addEventListener(TC.Consts.event.CLICK,function(){o.end()});o._undoBtn=o.div.querySelector(o._classSelector+"-btn-undo");o._undoBtn.addEventListener(TC.Consts.event.CLICK,function(){o.undo()});o._redoBtn=o.div.querySelector(o._classSelector+"-btn-redo");o._redoBtn.addEventListener(TC.Consts.event.CLICK,function(){o.redo()});if(o.options.styleTools){o._strokeColorPicker=o.div.querySelector(o._classSelector+"-str-c");o._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE,function(t){o.setStrokeColor(t.target.value)});o._strokeWidthSelector=o.div.querySelector(o._classSelector+"-str-w");o._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE,function(t){o.setStrokeWidth(t.target.value)});o._strokeWidthWatch=o.div.querySelector(o._classSelector+"-str-w-watch")}TC.Util.isFunction(e)&&e()}))};e.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.map.on(TC.Consts.event.VIEWCHANGE,function(){e.map.view===TC.Consts.view.PRINTING&&e.end()});const n=function(){e.styles={};TC.Util.extend(!0,e.styles,e.options.styles||e.layer.options.styles)};e._layerPromise=new Promise(function(r,i){t.loaded(function(){if(e.options.layer){e.setLayer(e.options.layer);r(e.layer);n()}else if(!1===e.options.layer){e.setLayer(null);r(null)}else t.addLayer({id:e.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:t.options.styles.point,line:t.options.styles.line,polygon:t.options.styles.polygon}}).then(function(i){t.putLayerOnTop(i);e.setLayer(i);r(e.layer);n()})})});return r};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._cancelBtn.disabled=!1;this.setMode(this.mode,!0);return this};e.undo=function(){var t=this.wrap.undo();if(t){this.historyIndex--;r(this);this.historyIndex<=0&&this.resetValues();this.trigger(TC.Consts.event.DRAWUNDO)}return t};e.redo=function(){var t=this.wrap.redo();if(t){this.historyIndex++;r(this);this.trigger(TC.Consts.event.DRAWREDO)}return t};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();n(this);this._cancelBtn.disabled=!0;this.trigger(TC.Consts.event.DRAWCANCEL,{ctrl:this});return this};e.activate=function(){this._newBtn.classList.add(TC.Consts.classes.ACTIVE);this._cancelBtn.disabled=!1;TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this.div.classList.remove(this._pointClass,this._lineClass,this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this.div.classList.add(this._pointClass);break;case TC.Consts.geom.POLYLINE:this.div.classList.add(this._lineClass);break;case TC.Consts.geom.POLYGON:this.div.classList.add(this._polygonClass)}};e.deactivate=function(){this._newBtn&&this._newBtn.classList.remove(TC.Consts.classes.ACTIVE);this._cancelBtn&&(this._cancelBtn.disabled=!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const t=this;t.layer&&t.layer.clearFatures();t.resetValues();return t};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(t,e){const r=this;t&&(r.mode=t);if(e&&t){r.layer&&r.layer.map.putLayerOnTop(r.layer);r.activate()}else r.deactivate();return r};e.setStyle=function(t){const e=this;if(t)TC.Util.extend(e.style,t);else switch(e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t={line:e.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t={polygon:e.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t={point:e.styles.point};break;default:t={}}e.isActive&&e.wrap.setStyle(t)};e.getModeStyle=function(t){const e=this;switch(t=t||e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return e.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return e.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return e.styles.point;default:return null}};e.setStrokeColorWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeColor);const r=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);r&&r.length&&(t="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]);e._strokeColorPicker.value=t;if(!TC.browserFeatures.inputTypeColor()){const r=e._strokeColorPicker;r.style.backgroundColor=t;r.blur()}}return e};e.setStrokeColor=function(t){const e=this,r=e.getModeStyle();r&&(r.strokeColor=t);e.isActive&&e.setStyle();e.setStrokeColorWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:t});return e};e.setStrokeWidthWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeWidth);if((t=parseInt(t,10))!==Number.NaN){e._strokeWidthSelector.value=t;e._strokeWidthWatch.style.borderBottomWidth=t+"px"}}return e};e.setStrokeWidth=function(t){const e=this;if((t=parseInt(t,10))!==Number.NaN){const r=e.getModeStyle();r&&(r.strokeWidth=t);e.isActive&&e.setStyle();e.setStrokeWidthWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:t})}return e};e.getLayer=function(){return this._layerPromise};e.setLayer=function(t){this.map&&(this.layer="string"==typeof t?this.map.getLayer(t):t)};e.resetValues=function(){this.history.length=0;this.historyIndex=0;r(this);return this};e.exportState=function(){const t=this;return t.exportsState?{id:t.id,layer:t.layer.exportState()}:null};e.importState=function(t){this.getLayer().then(function(e){e.importState(t.layer)})}}();TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var t=this;TC.control.Measure.apply(t,arguments);t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv);const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]"};t.persistentDrawControls=!0;t.renderPromise().then(function(){t._1stCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-1-t");t._2ndCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-2-t");t._1stCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-1-v");t._2ndCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-2-v");t._elevationText=t.div.querySelector(".tc-ctl-meas-val-coord-ele-t");t._elevationValue=t.div.querySelector(".tc-ctl-meas-val-coord-ele-v")});if(t.options.displayElevation){t.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const e="boolean"==typeof t.options.displayElevation?{}:t.options.displayElevation;t.elevation=new TC.tool.Elevation(e)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var t=TC.control.DrawMeasureModify.prototype;t.CLASS="tc-ctl-dmm";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const e=[],r=function(t){return e.filter(function(e){return e.feature===t})[0]},n=function(t){const r=e.reduce(function(e,r,n){return r.feature===t?n:e},-1);r>=0&&e.splice(r,1)};t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",e,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",e,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",e,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",e,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",e,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",e,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",e,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",e,{},{$key:"deleteAll"}).w('">').h("i18n",e,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",e,{},{$key:"download"}).w('">').h("i18n",e,{},{$key:"download"}).w("...</button></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"downloadSketch"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(e.get(["elevation"],!1),e,{block:r},{}).w('<div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-dmm-dialog-elev"><input id="').f(e.get(["checkboxId"],!1),e,"h").w('" type="checkbox" checked /><label for="').f(e.get(["checkboxId"],!1),e,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",e,{},{$key:"includeElevations"}).w("</label></div>").x(e.get(["resolution"],!1),e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",e,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",e,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",e,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",e,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(e.get(["resolution"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;return e}}t.render=function(t){const e=this,r=e._set1stRenderPromise(TC.control.Measure.prototype.render.call(e,function(){e._clearBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");e._clearBtn.addEventListener(TC.Consts.event.CLICK,function(t){TC.confirm(e.getLocaleString("deleteAll.confirm"),function(){e.clear()})});e._downloadBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");e._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(t){e.showSketchDownloadDialog()});e._elevProfileBtn=e.div.querySelector(".tc-ctl-meas-prof-btn");e._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(t){e.elevationProfileActive?e.deactivateElevationProfile():e.activateElevationProfile()});e.options.displayElevation||(e._elevProfileBtn.style.display="none");TC.Util.isFunction(t)&&t()})),n={checkboxId:e.getUID(),elevation:e.options.displayElevation};e.getRenderedHtml(e.CLASS+"-dialog",n,function(t){const r=function(t){TC.Util.closeModal();const r={fileName:e.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:t},n=!!e.options.displayElevation&&e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX).checked;if(n){const t="1"===e._dialogDiv.querySelector("input[type=radio][name=ip-coords]:checked").value,n=e.map.getLoadingIndicator(),i=n&&n.addWait(),o={crs:e.map.crs,features:e.layer.features.map(function(e){return e.getGeometryStride()>=3&&(!t||TC.feature.Point&&e instanceof TC.feature.Point)?null:e.clone()}),maxCoordQuantity:e.options.displayElevation.maxCoordQuantity,sampleNumber:0};t&&(o.resolution=parseFloat(e._dialogDiv.querySelector("."+e.CLASS+"-dialog-ip-m input[type=number]").value)||e.options.displayElevation.resolution);e.elevation.setGeometry(o).then(function(t){t.forEach(function(r,n){r||(t[n]=e.layer.features[n])});e.map.exportFeatures(t,r)}).catch(function(t){t.message!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(e.getLocaleString("elevation.error")):TC.alert(e.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){n&&n.removeWait(i)})}else{var i;i=e.options.displayElevation&&!n?e.layer.features.map(function(t){var e=t.clone();if(e.getGeometryStride()>2){e.getCoordsArray().forEach(function(t){t.length=2});e.setCoords(e.geometry)}return e}):e.layer.features;e.map.exportFeatures(i,r)}};e._dialogDiv.innerHTML=t;e._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(e._selectors.ELEVATION_CHECKBOX,function(t){e.showSketchDownloadDialog()}));e._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio][name=ip-coords]",function(t){e._dialogDiv.querySelector("."+e.CLASS+"-dialog-ip-m").classList.toggle(TC.Consts.classes.HIDDEN,"0"===t.target.value)}));e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(t){const n=t.target.dataset.format;n===TC.Consts.format.GPX&&e.layer.features.some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon})?TC.confirm(e.getLocaleString("gpxNotCompatible.confirm"),function(){r(n)}):r(n)}))});return r};t.register=function(t){const i=this;return new Promise(function(o,a){TC.control.Measure.prototype.register.call(i,t).then(function(){const a=i.getUID(),s=i.getUID();Promise.all([i.layerPromise,i.renderPromise()]).then(function(l){const c=l[0];c.title=i.getLocaleString("sketch");i._modifyPromise=t.addControl("modify",{id:s,div:i.div.querySelector("."+i.CLASS+"-mod"),layer:c});i._modifyPromise.then(function(e){i.modify=e;e.on(TC.Consts.event.FEATURESSELECT,function(t){i.resultsPanelChart&&!t.features.some(function(t){return i.resultsPanelChart.currentFeature===t})&&i.resultsPanelChart.setCurrentFeature(null);const e=t.features[t.features.length-1];if(e){i.showMeasures(i.getFeatureMeasureData(e));const t=e._originalStyle||e.getStyle();switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:i.displayMode(TC.Consts.geom.POLYGON);i.drawPolygons.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:i.displayMode(TC.Consts.geom.POLYLINE);i.drawLines.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth);const n=r(e);if(n){i.resultsPanelChart.setCurrentFeature(e);i.renderElevationChart(n.data)}break;case TC.feature.Point&&e instanceof TC.feature.Point:i.displayMode(TC.Consts.geom.POINT);i.drawPoints.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth)}i.modify.setFontColorWatch(t.fontColor).setFontSizeWatch(t.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(t){i.modify.getSelectedFeatures().length||i.resetDrawWatches();i.resetElevationProfile();i.resultsPanelChart&&i.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(t){if(t.layer===i.layer){n(t.feature);const e=function(t){const e=i.getFeatureMeasureData(t);i.showMeasures(e);i.setFeatureMeasureData(t)};e(t.feature);i.options.displayElevation&&TC.feature.Point&&t.feature instanceof TC.feature.Point&&i.elevation.setGeometry({features:[t.feature],crs:i.map.crs}).then(function(t){e(t[0])});i.map.getControlsByClass("TC.control.Popup").forEach(function(e){e.isVisible()&&e.currentFeature===t.feature&&e.hide()})}});t.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){const e=t.control;if(e===i.modify){i.resetDrawWatches();i.resetElevationProfile();if(i.resultsPanelChart){i.resultsPanelChart.setCurrentFeature(null);i.resultsPanelChart.close()}}else if(e===i.drawLines){i.resetElevationProfile();i.resultsPanelChart&&i.resultsPanelChart.close()}}).on(TC.Consts.event.FEATURECLICK,function(e){const n=e.feature;if(!(t.activeControl instanceof TC.control.Draw||t.activeControl instanceof TC.control.Modify)&&TC.feature.Polyline&&n instanceof TC.feature.Polyline&&i.layer.features.indexOf(n)>=0){if(i.elevationProfileActive){i.resultsPanelChart&&i.resultsPanelChart.setCurrentFeature(n);t.getControlsByClass("TC.control.Popup").forEach(function(t){t.currentFeature===n&&t.hide()})}const e=r(n);i.resultsPanelChart&&i.resultsPanelChart.isMinimized()&&i.resultsPanelChart.maximize();e?i.renderElevationChart(e.data):i.displayElevationProfile(n.geometry)}})});i._drawLinesPromise.then(function(t){t.on(TC.Consts.event.DRAWSTART,function(){i.resultsPanelChart&&i.resultsPanelChart.currentFeature&&i.resultsPanelChart.setCurrentFeature(null);i.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){i.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(t){i.resultsPanelChart&&(i.resultsPanelChart.currentFeature=t.feature)}).on(TC.Consts.event.POINT,function(t){const e=this.history.slice(0,this.historyIndex),r=e[e.length-1];r[0]===t.point[0]&&r[1]===t.point[1]||e.push(t.point);i.displayElevationProfile(e)}).on(TC.Consts.event.STYLECHANGE,function(t){i.onStyleChange(t)})});i._drawPolygonsPromise.then(function(t){t.on(TC.Consts.event.DRAWSTART,function(){i.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(t){i.onStyleChange(t)})});i._drawPointsPromise=t.addControl("draw",{id:a,div:i.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:i.persistentDrawControls,styleTools:!0,layer:i.layer});i._drawPointsPromise.then(function(e){e.containerControl=i;i.drawControls.push(e);i.drawPoints=e;i.resetValues();e.on(TC.Consts.event.DRAWEND,function(e){const r=function(e){i.showMeasures({coords:e.geometry,units:t.wrap.isGeo()?"degrees":"m"});i.setFeatureMeasureData(e)};r(e.feature);i.options.displayElevation&&i.elevation.setGeometry({features:[e.feature],crs:i.map.crs}).then(function(t){r(t[0])})}).on(TC.Consts.event.DRAWCANCEL,function(t){setTimeout(function(){i.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(t){i.onStyleChange(t)});e.exportsState=!1});i.setMode(i.options.mode);t.on(TC.Consts.event.FEATUREADD,function(t){const e=t.layer,r=t.feature;if(e===i.layer){i.setFeatureMeasureData(r);i._modifyPromise.then(function(t){t.displayLabelText(r.getStyle().label)});i._clearBtn.disabled=!1;i._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){const r=t.layer,o=t.feature;if(r===i.layer)if(0===i.layer.features.length){i._clearBtn.disabled=!0;i._downloadBtn.disabled=!0;i.resetValues();e.length=0}else o&&n(o)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(t){const e=t.control;e.setCurrentFeature&&e.setCurrentFeature(null)});o(i)})}).catch(function(t){a(t)})})};t.displayMode=function(t){const e=this;t===TC.Consts.geom.POINT&&(e._activeMode=e.div.querySelector(".tc-ctl-meas-pt"));e.modify&&e.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(e,t)};t.setMode=function(t){const e=this;t===TC.Consts.geom.POINT&&e.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(e,t)};t.setFeatureMeasureData=function(t){const e=this,r={};switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:const n=e._1stCoordText.innerHTML,i=e._2ndCoordText.innerHTML,o=e._elevationText.innerHTML;if(e._1stCoordValue.textContent.trim().length>0&&e._2ndCoordValue.textContent.trim().length>0){r.CRS=e.map.crs;r[n.substr(0,n.indexOf(":"))]=parseFloat(e._1stCoordValue.dataset.value);r[i.substr(0,i.indexOf(":"))]=parseFloat(e._2ndCoordValue.dataset.value);o&&(r[e.getLocaleString("ele")]=parseFloat(e._elevationValue.dataset.value));t.setData(r)}break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:if(e._len.innerHTML.trim()!==e.NOMEASURE){r[e.getLocaleString("2dLength")]=e._len.innerHTML;t.setData(r)}break;case TC.feature.Polygon&&t instanceof TC.feature.Polygon:if(e._area.innerHTML.trim()!==e.NOMEASURE&&e._peri.innerHTML.trim()!==e.NOMEASURE){r[e.getLocaleString("area")]=e._area.innerHTML;r[e.getLocaleString("2dPerimeter")]=e._peri.innerHTML;t.setData(r)}}return e};t.getFeatureMeasureData=function(t){const e=this,n={units:"m"},i={};e.map.wrap.isGeo()&&(i.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:n.area=t.getArea(i);n.perimeter=t.getLength(i);break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:n.length=t.getLength(i);const o=r(t);o?e.renderElevationChart(o.data):e.displayElevationProfile(t.geometry);break;case TC.feature.Point&&t instanceof TC.feature.Point:n.coords=t.geometry}return n};t.showMeasures=function(t){const e=this;TC.control.Measure.prototype.showMeasures.call(e,t);(t=t||{}).units;const r=e.map.options.locale||TC.Cfg.locale;if(t.coords){var n,i,o;if("m"===t.units){n=TC.Consts.METER_PRECISION;i=t.coords[0];o=t.coords[1];e._1stCoordText.innerHTML="x: ";e._2ndCoordText.innerHTML="y: "}else{n=TC.Consts.DEGREE_PRECISION;i=t.coords[1];o=t.coords[0];e._1stCoordText.innerHTML="lat: ";e._2ndCoordText.innerHTML="lon: "}const a=Math.pow(10,n),s=function(t){return Math.round(t*a)/a};e._1stCoordValue.innerHTML=TC.Util.formatNumber(i.toFixed(n),r);e._1stCoordValue.dataset.value=s(i);e._2ndCoordValue.innerHTML=TC.Util.formatNumber(o.toFixed(n),r);e._2ndCoordValue.dataset.value=s(o);if(t.coords.length>2){const n=Math.round(t.coords[2]);e._elevationText.innerHTML=e.getLocaleString("ele").toLowerCase()+": ";e._elevationValue.innerHTML=TC.Util.formatNumber(n.toFixed(TC.Consts.METER_PRECISION),r)+" m";e._elevationValue.dataset.value=n}else{e._elevationText.innerHTML="";e._elevationValue.innerHTML="";e._elevationValue.dataset.value=""}}return e};t.resetValues=function(){const t=this;TC.control.Measure.prototype.resetValues.call(t);if(t._1stCoordText){t._1stCoordText.innerHTML=t.NOMEASURE;t._2ndCoordText.innerHTML="";t._1stCoordValue.innerHTML="";t._1stCoordValue.dataset.value="";t._2ndCoordValue.innerHTML="";t._2ndCoordValue.dataset.value="";t._elevationText.innerHTML="";t._elevationValue.innerHTML="";t._elevationValue.dataset.value=""}return t};t.resetDrawWatches=function(){this.drawControls.forEach(function(t){t.setStrokeColorWatch().setStrokeWidthWatch()})};t.clear=function(){const t=this;t.resetValues();t.layer.clearFeatures();t.modify.isActive&&t.modify.deactivate();if(t.options.displayElevation){t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}t._clearBtn.disabled=!0;t._downloadBtn.disabled=!0;return t};t.showSketchDownloadDialog=function(t){const e=this,r=e._dialogDiv.querySelector("."+e.CLASS+"-dialog"),n=e.layer.features.some(function(t){return TC.feature.Point&&t instanceof TC.feature.Point||TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint}),i=e.layer.features.some(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline}),o=e.layer.features.some(function(t){return TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon});if(e.options.displayElevation){r.querySelector("."+e.CLASS+"-dialog-ip").classList.toggle(TC.Consts.classes.HIDDEN,!e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX).checked||!i&&!o)}r.querySelector("button[data-format=GPX]").classList.toggle(TC.Consts.classes.HIDDEN,!(i||n));TC.Util.showModal(r,t);return e};t.onStyleChange=function(t){const e=this;var r;switch(t.target.mode){case TC.Consts.geom.POLYGON:r=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:r=TC.feature.Polyline;break;case TC.Consts.geom.POINT:r=TC.feature.Point}r&&e.modify.getSelectedFeatures().forEach(function(e){if(e instanceof r){const r={};r[t.property]=t.value;e.setStyle(r)}})};t.displayElevationProfile=function(t){const n=this;1===t.length&&(t=t.slice()).push(t[0]);const i=n.map.getLoadingIndicator(),o=i&&i.addWait();n.elevation.getElevation({crs:n.map.crs,coordinates:t}).then(function(a){i&&i.removeWait(o);var s=0,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const u=a.map(function(t,e,r){const n=0===e?t:r[e-1],i=t[0]-n[0],o=t[1]-n[1];s+=Math.sqrt(i*i+o*o);var a=t[2];if("number"==typeof a){l=Math.max(a,l);c=Math.min(a,c)}return[s,a]});n.elevationProfileData={x:u.map(function(t){return t[0]}),ele:u.map(function(t){return t[1]}),coords:a};const h={coords:a};"object"==typeof n.options.displayElevation&&(h.hillDeltaThreshold=n.options.displayElevation.hillDeltaThreshold);TC.Util.extend(n.elevationProfileData,TC.tool.Elevation.getElevationGain(h));const p=n.layer.features.filter(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline}).filter(function(e){for(var r=0,n=e.geometry.length;r<n;r++){const n=t[r],i=e.geometry[r];if(!n||n[0]!==i[0]||n[1]!==i[1])return!1}return!0})[0];p&&function(t,n){var i=r(t);if(!i){i={feature:t};e.push(i)}i.data=n}(p,n.elevationProfileData);n.resultsPanelChart?n.renderElevationChart():n.createChartPanel().then(function(t){n.resultsPanelChart.renderPromise().then(function(){n.renderElevationChart()})})},function(t){n.resetElevationProfile();i&&i.removeWait(o)})};t.createChartPanel=function(){const e=this,r={id:e.getUID(),content:"chart",titles:{main:e.getLocaleString("geo.trk.chart.chpe"),max:e.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:e,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};return new Promise(function(t,n){var i;const o=function(t){r.side=t.SIDE.RIGHT;i=t.addControl("resultsPanel",r)};if(e.options.displayElevation.displayOn){var a=e.map.getControlsByClass("TC.control."+e.options.displayElevation.displayOn[0].toUpperCase()+e.options.displayElevation.displayOn.substring(1))[0];a?o(a):e.map.addControl(e.options.displayElevation.displayOn).then(o)}else{r.div=document.createElement("div");e.map.div.appendChild(r.div);i=e.map.addControl("resultsPanel",r)}i.then(function(r){r.caller=e;e.resultsPanelChart=r;e._decorateChartPanel();t(r)})})};t._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(t){const e=this;e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1);e.currentFeature=t;t&&t.toggleSelectedStyle(!0)}};t.renderElevationChart=function(t){const e=this;e.elevationProfileData=t||e.elevationProfileData;if(e.resultsPanelChart&&e.elevationProfileActive){e.resultsPanelChart.openChart(e.elevationProfileData);e.resultsPanelChart.isMinimized()||e.resultsPanelChart.show()}};t.getElevationTooltip=function(t){this.resultsPanelChart.wrap.showElevationMarker({data:t,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(t)};t.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};t.activateElevationProfile=function(){const t=this;t.elevationProfileActive=!0;t._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);t._elevProfileBtn.setAttribute("title",t.getLocaleString("deactivateElevationProfile"));var e=!1;if(t.drawLines.historyIndex>1){t.displayElevationProfile(t.drawLines.history.slice(0,t.drawLines.historyIndex));e=!0}else{const r=t.modify.getActiveFeatures().filter(function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline});if(r.length){const n=r[r.length-1];t.displayElevationProfile(n.geometry);e=!0}}e||t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.show()};t.deactivateElevationProfile=function(){const t=this;t.elevationProfileActive=!1;t._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);t._elevProfileBtn.setAttribute("title",t.getLocaleString("activateElevationProfile"));t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()};t.resetElevationProfile=function(){const t=this;if(t.options.displayElevation&&t.resultsPanelChart){t.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};t.resultsPanelChart.openChart(t.elevationProfileData)}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var t=0,e=function(t,e){return new Promise(function(r,n){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var i,o;switch(!0){case e instanceof TC.feature.Polygon:o=TC.Consts.geom.POLYGON;break;case e instanceof TC.feature.Polyline:o=TC.Consts.geom.POLYLINE;break;case e instanceof TC.feature.Point:o=TC.Consts.geom.POINT;break;case e instanceof TC.feature.MultiPolygon:o=TC.Consts.geom.MULTIPOLYGON;break;case e instanceof TC.feature.MultiPolyline:o=TC.Consts.geom.MULTIPOLYLINE}i={id:e.id||e.provId,attributes:e.data,type:o,geometry:e.geometry};localforage.setItem(t,i).then(function(){r({feature:e})}).catch(function(t){n({feature:e,error:t})})})})},r=function(t){return new Promise(function(e,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(t).then(function(){e(t)}).catch(function(t){r(Error(t))})})})},n=function(t){return new Promise(function(e,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(t).then(function(r){e({key:t,feature:r})}).catch(function(t){r(t)})})})},i=function(t,e){return t.LOCAL_STORAGE_KEY_PREFIX+(e||t.layer.id)},o=function(t,e){return i(t,e)+t.LOCAL_STORAGE_ADDED_KEY_PREFIX},a=function(t,e){return i(t,e)+t.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},s=function(t,e){return i(t,e)+t.LOCAL_STORAGE_REMOVED_KEY_PREFIX},l=function(t){var e=!1;(TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)&&t.geometry.length>1&&(e=!0);return e},c=function(t,e){t._deleteBtn.disabled=0===e.length;t._joinBtn.disabled=e.length<2;t._splitBtn.disabled=0===e.filter(l).length},u=function(t,e){t._saveBtn.disabled=e;t._discardBtn.disabled=e;self.checkedOut=!e},h=function(t,e){void 0!==e?u(t,!e):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var e=i(t);localforage.keys().then(function(r){if(r){for(var n=!0,i=0,o=r.length;i<o;i++)if(0===r[i].indexOf(e)){n=!1;break}u(t,n)}})})},p=function(t,e){return new Promise(function(r,n){var i=t._changesLayers[e.id];if(i)r(i);else{i=t._changesLayers[e.id]=new TC.layer.Vector({id:TC.getUID(),title:e.title+" - cambios pendientes",stealth:!0,styles:t.getChangesLayerStyle(e)});var o=t.map.layers.indexOf(e);t.map.insertLayer(i,o+1,function(){r(i)})}})};TC.control.Edit=function(){var n=this;TC.control.SWCacheClient.apply(this,arguments);n._classSelector="."+n.CLASS;n.wrap=new TC.wrap.control.Edit(n);n.layer=null;n.checkedOut=!1;n.callback=TC.Util.isFunction(arguments[2])?arguments[2]:n.options.callback?n.options.callback:null;n.multi=!!n.options.multi&&n.options.multi;n.eraseActionConfirmTxt=n.options.eraseText?n.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";n.cancelActionConfirmTxt=n.options.cancelText?n.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";n.styles=n.options.styles;n.features={};n.attributeEditor=null;n.pointDraw=null;n.lineDraw=null;n.polygonDraw=null;n.snapping="boolean"!=typeof n.options.snapping||n.options.snapping;n._changesLayers={};n._showsChanges="boolean"!=typeof n.options.showChanges||n.options.showChanges;TC.Util.isFunction(n.options.getChangesLayerStyleFunction)&&(n.getChangesLayerStyleFunction=n.getChangesLayerStyle);n.on(TC.Consts.event.FEATUREADD,function(r){var i=r.feature;i.provId="NewFeature."+t++;var a=n._changesLayers[n.layer.id];n.features[n.layer.id].added.push(i);a.addFeature(i);e(o(n)+i.provId,i).then(function(){h(n,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(t){var i=t.feature,l=i.provId||i.id,c=function(){h(n);TC.toast("Eliminaci\xf3n guardada")},u=function(){TC.error("Fallo al guardar eliminaci\xf3n")},p=n._changesLayers[n.layer.id],d=n.features[n.layer.id],f=d.added.indexOf(i);if(f<0){var g=s(n);if((f=d.modified.indexOf(i))<0){if((f=d.removed.indexOf(i))<0){d.removed.push(i);p.addFeature(i);e(g+i.id,i).then(c,u)}}else{d.modified.splice(f,1);d.removed.push(i);r(a(n)+i.id).then(function(){c();e(g+i.id,i).then(c,u)},u)}}else{p.removeFeature(i);d.added.splice(f,1);r(o(n)+l).then(c,u)}}).on(TC.Consts.event.FEATUREMODIFY,function(t){var r=t.feature,i=r.provId||r.id,s=function(){h(n,!0);TC.toast("Modificaci\xf3n guardada")},l=function(){TC.error("Fallo al guardar modificaci\xf3n")},c=n._changesLayers[n.layer.id],u=n.features[n.layer.id],p=u.added.indexOf(r);if(p<0){if((p=u.modified.indexOf(r))<0){c.addFeature(r);u.modified.push(r)}e(a(n)+i,r).then(s,l)}else e(o(n)+i,r).then(s,l)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(t){if(n.serviceWorkerEnabled&&navigator.onLine){var e=n.layer.wrap.getGetFeatureUrl(),r=n.layer.wrap.getDescribeFeatureTypeUrl();e&&r&&n.createCache(n.LOCAL_STORAGE_KEY_PREFIX+n.layer.id,{urlList:[e,r]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(t){}).on(TC.Consts.event.FEATURESSELECT,function(t){var e=n.getSelectedFeatures();c(n,e);e.length&&e[0].showPopup(n.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(t){c(n,n.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var d=TC.control.Edit.prototype;d.CLASS="tc-ctl-edit";d.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";d.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";d.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";d.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";d.template={};if(TC.isDebug){d.template[d.CLASS]=TC.apiLocation+"TC/templates/Edit.html";d.template[d.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{d.template[d.CLASS]=function(){dust.register(d.CLASS,t);function t(t,n){return t.w("<h2>").h("i18n",n,{},{$key:"featureEdit"}).w('</h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",n,{},{$key:"selectLayerToEdit"}).w("</option>").s(n.get(["layers"],!1),n,{block:e},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(n.get(["showChanges"],!1),n,{block:r},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",n,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",n,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",n,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",n,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",n,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",n,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",n,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",n,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",n,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",n,{},{$key:"delete"}).w('">').h("i18n",n,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",n,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",n,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",n,{},{$key:"splitGeometry"}).w('">').h("i18n",n,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",n,{},{$key:"cancel"}).w('">').h("i18n",n,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",n,{},{$key:"syncChanges"}).w('">').h("i18n",n,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",n,{},{$key:"discardChanges"}).w('">').h("i18n",n,{},{$key:"discardChanges"}).w("</button></div>")}t.__dustBody=!0;function e(t,e){return t.w('<option value="').f(e.get(["id"],!1),e,"h").w('">').f(e.get(["title"],!1),e,"h").w("</option>")}e.__dustBody=!0;function r(t,e){return t.w(" checked")}r.__dustBody=!0;return t};d.template[d.CLASS+"-attr"]=function(){dust.register(d.CLASS+"-attr",e);var t={inputText:P,inputNumber:R,inputCheckbox:I,inputDate:O,inputTime:N,inputDatetime:k};function e(e,n){n=n.shiftBlocks(t);return e.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",n,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(n.get(["data"],!1),n,{block:r},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",n,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",n,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function r(e,r){r=r.shiftBlocks(t);return e.w("<tr><th>").f(r.get(["name"],!1),r,"h").w("</th><td>").x(r.get(["readOnly"],!1),r,{else:n,block:D},{}).w("</td></tr>")}r.__dustBody=!0;function n(e,r){r=r.shiftBlocks(t);return e.x(r.get(["availableValues"],!1),r,{block:i},{}).h("select",r,{block:a},{key:r.get(["type"],!1)})}n.__dustBody=!0;function i(e,r){r=r.shiftBlocks(t);return e.w('<select class="tc-combo" name="').f(r.get(["name"],!1),r,"h").w('"><option value=""></option>').s(r.get(["availableValues"],!1),r,{block:o},{}).w("</select>")}i.__dustBody=!0;function o(e,r){r=r.shiftBlocks(t);return e.w('<option value="').f(r.getPath(!0,[]),r,"h").w('">').f(r.getPath(!0,[]),r,"h").w("</option>")}o.__dustBody=!0;function a(e,r){r=r.shiftBlocks(t);return e.h("none",r,{block:s},{}).h("eq",r,{block:l},{value:"int"}).h("eq",r,{block:c},{value:"integer"}).h("eq",r,{block:u},{value:"double"}).h("eq",r,{block:h},{value:"boolean"}).h("eq",r,{block:p},{value:"date"}).h("eq",r,{block:f},{value:"time"}).h("eq",r,{block:g},{value:"dateTime"}).h("eq",r,{block:y},{value:"byte"}).h("eq",r,{block:m},{value:"long"}).h("eq",r,{block:C},{value:"negativeInteger"}).h("eq",r,{block:v},{value:"nonNegativeInteger"}).h("eq",r,{block:T},{value:"nonPositiveInteger"}).h("eq",r,{block:_},{value:"positiveInteger"}).h("eq",r,{block:S},{value:"short"}).h("eq",r,{block:E},{value:"unsignedLong"}).h("eq",r,{block:L},{value:"unsignedInt"}).h("eq",r,{block:w},{value:"unsignedShort"}).h("eq",r,{block:b},{value:"unsignedByte"}).h("eq",r,{block:A},{value:"float"}).h("eq",r,{block:x},{value:"decimal"})}a.__dustBody=!0;function s(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputText"),r,{},{})}s.__dustBody=!0;function l(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}l.__dustBody=!0;function c(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}c.__dustBody=!0;function u(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}u.__dustBody=!0;function h(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputCheckbox"),r,{},{})}h.__dustBody=!0;function p(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputDate"),r,{},{})}p.__dustBody=!0;function f(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputTime"),r,{},{})}f.__dustBody=!0;function g(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputDatetime"),r,{},{})}g.__dustBody=!0;function y(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}y.__dustBody=!0;function m(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}m.__dustBody=!0;function C(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}C.__dustBody=!0;function v(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}v.__dustBody=!0;function T(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}T.__dustBody=!0;function _(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}_.__dustBody=!0;function S(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}S.__dustBody=!0;function E(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}E.__dustBody=!0;function L(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}L.__dustBody=!0;function w(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}w.__dustBody=!0;function b(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}b.__dustBody=!0;function A(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}A.__dustBody=!0;function x(e,r){r=r.shiftBlocks(t);return e.b(r.getBlock("inputNumber"),r,{},{})}x.__dustBody=!0;function P(e,r){r=r.shiftBlocks(t);return e.w('<input type="text" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}P.__dustBody=!0;function R(e,r){r=r.shiftBlocks(t);return e.w('<input type="number" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}R.__dustBody=!0;function I(e,r){r=r.shiftBlocks(t);return e.w('<input type="checkbox" name="').f(r.get(["name"],!1),r,"h").w('"').x(r.get(["value"],!1),r,{block:M},{}).w("/>")}I.__dustBody=!0;function M(e,r){r=r.shiftBlocks(t);return e.w(" checked")}M.__dustBody=!0;function O(e,r){r=r.shiftBlocks(t);return e.w('<input type="date" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}O.__dustBody=!0;function N(e,r){r=r.shiftBlocks(t);return e.w('<input type="time" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}N.__dustBody=!0;function k(e,r){r=r.shiftBlocks(t);return e.w('<input type="datetime" class="tc-textbox" name="').f(r.get(["name"],!1),r,"h").w('" value="').f(r.get(["value"],!1),r,"h").w('" />')}k.__dustBody=!0;function D(e,r){r=r.shiftBlocks(t);return e.f(r.get(["value"],!1),r,"h")}D.__dustBody=!0;return e}}d.register=function(e){var r=this;const l=TC.control.SWCacheClient.prototype.register.call(r,e),c=r.getUID(),u=r.getUID(),h=r.getUID();e.addControl("popup",{closeButton:!0}).then(function(t){r.attributeEditor=t});e.on(TC.Consts.event.LAYERUPDATE,function(e){const l=e.layer;if(l.type===TC.Consts.layerType.WFS&&!l.options.stealth){var c=r.features[l.id]=r.features[l.id]||{added:[],modified:[],removed:[]};p(r,l).then(function(e){r.layer!==l&&e.setVisibility(!1);var u=i(r,l.id),h=o(r,l.id),p=a(r,l.id),d=s(r,l.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(r){if(r)for(var i=0,o=r.length;i<o;i++){var a=r[i];0===a.indexOf(u)&&n(a).then(function(r){var n,i=r.key;if(0===i.indexOf(d)){n=i.substr(d.length);var o=l.getFeatureById(n);l.removeFeature(o);e.addFeature(o);c.removed.push(o)}else if(0===i.indexOf(p)){n=i.substr(p.length);if(o=l.getFeatureById(n)){e.addFeature(o);c.modified.push(o);o.wrap.setGeometry(r.feature.geometry);o.setData(r.feature.attributes)}}else if(0===i.indexOf(h)){n=i.substr(h.length);var a,s=parseInt(n.substr(n.lastIndexOf(".")+1));t=Math.max(t,s+1);switch(r.feature.type){case TC.Consts.geom.POINT:a=l.addPoint(r.feature.geometry);break;case TC.Consts.geom.POLYLINE:a=l.addPolyline(r.feature.geometry);break;case TC.Consts.geom.POLYGON:a=l.addPolygon(r.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:a=l.addMultiPolyline(r.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:a=l.addMultiPolygon(r.feature.geometry)}a.then(function(t){e.addFeature(t);c.added.push(t);t.provId=n;t.setData(r.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(t){const e=t.layer;if(e.type===TC.Consts.layerType.WFS&&!e.options.stealth){r.features[e.id]=r.features[e.id]||{added:[],modified:[],removed:[]};const t=document.createElement("option");t.setAttribute("value",e.id);t.innerHTML=e.title||e.id;r._layerSelect.appendChild(t)}}).on(TC.Consts.event.LAYERREMOVE,function(t){const e=t.layer;if(e.type===TC.Consts.layerType.WFS&&!e.options.stealth){var n=r._layerSelect.querySelector("option[value="+e.id+"]");n.selected&&r.setLayer(null);n.parentElement.removeChild(n)}}).on(TC.Consts.event.POPUP,function(t){if(t.control===r.attributeEditor){for(var e=t.control.currentFeature,n=r.attributes.slice(),i={},o=r._joinedFeatureAttributes||[],a=0,s=n.length;a<s;a++){var l=e.getData()||{},c=n[a];c.value=l[c.name];"id"===c.name&&(c.readOnly=!0);c.availableValues=[];for(var u=0,h=o.length;u<h;u++){var p=o[u][c.name];void 0!==p&&""!==p&&(c.availableValues[c.availableValues.length]=p)}i[c.name]=c.type}n.sort(function(t,e){return(t.readOnly?!e.readOnly:e.readOnly)?!t.readOnly-!e.readOnly:t.name>e.name?1:t.name<e.name?-1:0});r.getRenderedHtml(r.CLASS+"-attr",{data:n},function(t){const n=r.attributeEditor.contentDiv;n.innerHTML=t;const o=n.querySelectorAll("input"),a=n.querySelectorAll("select");o.forEach(function(t){t.addEventListener("input",function(t){const e=t.target;for(var r=0,n=a.length;r<n;r++){const n=a[r];if(n.matches("[name="+t.target.getAttribute("name")+"]")&&n.value!==e.value){n.value="";break}}})});a.forEach(function(t){t.addEventListener("change",function(t){const e=t.target;for(var r=0,n=o.length;r<n;r++){const t=o[r];if(t.matches("[name="+e.getAttribute("name")+"]")){t.value=e.value;break}}})});n.querySelector("."+r.CLASS+"-btn-attr-ok").addEventListener("click",function(){var t={};o.forEach(function(e){var r=e.getAttribute("name"),n=e.value;switch(i[r]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":n=parseInt(n);Number.isNaN(n)||(t[r]=n);break;case"double":case"float":case"decimal":n=parseFloat(n);Number.isNaN(n)||(t[r]=n);break;case"date":case"time":case"dateTime":t[r]=new Date(n);break;case"boolean":t[r]=!!n;break;case void 0:break;default:t[r]=n}});e.setData(t);r.trigger(TC.Consts.event.FEATUREMODIFY,{feature:e,layer:r.layer});r.attributeEditor.hide()});n.querySelector("."+r.CLASS+"-btn-attr-cancel").addEventListener("click",function(){r.attributeEditor.hide()})})}});e.loaded(function(){if(r.options.layer)r.setLayer(r.options.layer);else{var t=e.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WFS&&!t.options.stealth});1===t.length?r.setLayer(t[0].id):r.setLayer(null)}r.showChanges(r._showsChanges);r.renderPromise().then(function(){Promise.all([e.addControl("draw",{id:c,div:r.div.querySelector("."+r.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),e.addControl("draw",{id:u,div:r.div.querySelector("."+r.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),e.addControl("draw",{id:h,div:r.div.querySelector("."+r.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(t){r.pointDraw=t[0];r.lineDraw=t[1];r.polygonDraw=t[2];var e=function(t){var e,n=t.feature;switch(r.geometryType){case TC.Consts.geom.POINT:e=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:e=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:e=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:e=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:e=TC.feature.MultiPolygon}e&&(n=new e(n.geometry,{geometryName:r.layer.options.geometryName}));r.layer.addFeature(n);r.trigger(TC.Consts.event.FEATUREADD,{feature:n})},n=function(){r.cancel()};r.pointDraw.on(TC.Consts.event.DRAWEND,e).on(TC.Consts.event.DRAWCANCEL,n);r.lineDraw.on(TC.Consts.event.DRAWEND,e).on(TC.Consts.event.DRAWCANCEL,n);r.polygonDraw.on(TC.Consts.event.DRAWEND,e).on(TC.Consts.event.DRAWCANCEL,n);r.options.modes&&Array.isArray(r.options.modes)&&1==r.options.modes.length&&r.setMode(r.options.modes[0],null)})})});return l};d.render=function(t){var e=this,r=[];if(e.map)for(var n=0,i=e.map.workLayers.length;n<i;n++){var o=e.map.workLayers[n];o.type!==TC.Consts.layerType.WFS||o.options.stealth||r.push({id:o.id,title:o.title||o.id})}return e._set1stRenderPromise(TC.Control.prototype.renderData.call(e,{layers:r,showChanges:e.showChanges},function(){e._layerDiv=e.div.querySelector(e._classSelector+"-layer");e._layerSelect=e._layerDiv.querySelector(e._classSelector+"-layer-sel");e._layerSelect.addEventListener("change",function(t){e.setLayer(e._layerSelect.value)});e._layerDiv.querySelector("#"+e.CLASS+"-view-changes-cb").addEventListener("change",function(t){e.showChanges(t.target.checked)});e._cancelBtn=e.div.querySelector(e._classSelector+"-btn-cancel");e._cancelBtn.addEventListener("click",function(){e.cancel()});e._deleteBtn=e.div.querySelector(e._classSelector+"-btn-delete");e._deleteBtn.addEventListener("click",function(){TC.confirm(e.eraseActionConfirmTxt,function(){e.deleteFeatures(e.getSelectedFeatures())})});e._joinBtn=e.div.querySelector(e._classSelector+"-btn-join");e._joinBtn.addEventListener("click",function(){e.joinFeatures(e.getSelectedFeatures())});e._splitBtn=e.div.querySelector(e._classSelector+"-btn-split");e._splitBtn.addEventListener("click",function(){e.splitFeatures(e.getSelectedFeatures())});e._saveBtn=e.div.querySelector(e._classSelector+"-btn-save");e._saveBtn.addEventListener("click",function(){e.applyEdits()});e._discardBtn=e.div.querySelector(e._classSelector+"-btn-discard");e._discardBtn.addEventListener("click",function(){e.discardEdits()});if(e.options.modes&&Array.isArray(e.options.modes)&&e.options.modes.length>0){for(var r in TC.Consts.editMode)if("string"==typeof r&&e.options.modes.indexOf(TC.Consts.editMode[r])<0){const t=e.div.querySelector("label"+e._classSelector+"-btn-"+TC.Consts.editMode[r]);t.parentElement.removeChild(t);const n=e.div.querySelector("div"+e._classSelector+"-"+TC.Consts.editMode[r]);n.parentElement.removeChild(n)}if(1===e.options.modes.length){var n=e.options.modes[0];e.div.querySelector("label"+e._classSelector+"-btn-"+n).style.display="none"}}e.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(t){t.addEventListener("change",function(){var t=this.value,r=e.mode===t?void 0:t;e.setMode(r)})});TC.Util.isFunction(t)&&t()}))};d.setLayer=function(t){var e=this;e.layer=map.getLayer(t);e.setMode(null);if(e.layer){p(e,e.layer).then(function(t){for(var r in e._changesLayers){var n=e._changesLayers[r];n.setVisibility(e._showsChanges&&n===t)}});e.layer.describeFeatureType().then(function(t){e.attributes=t.filter(function(t){switch(t.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":e.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":e.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":e.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":e.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":e.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":e.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var r=0,n=e.attributes.length;r<n;r++){var i=e.attributes[r];i.type=i.type.substr(i.type.indexOf(":")+1)}e.renderPromise().then(function(){h(e);e.div.querySelector(e._classSelector+"-layer-sel").value=e.layer.id;const t=e.div.querySelectorAll("input[type=radio][name=mode]");var r;switch(e.geometryType){case TC.Consts.geom.POINT:r="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:r="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:r="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:r="[value]"}t.forEach(function(t){t.disabled=!t.matches(r)})})})}else{e.renderPromise().then(function(){h(e,!1);e.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(t){t.disabled=!0;t.checked=!1})});e.layer=null}};d.setMode=function(t){var e=this;e.mode=t;!function(t){t._deleteBtn.disabled=!0;t._joinBtn.disabled=!0;t._splitBtn.disabled=!0}(e);var r,n,i=function(t){if(t){e.snapping&&(t.snapping=e.layer);t.activate()}};switch(t){case TC.Consts.editMode.SELECT:r=e.div.querySelector(e._classSelector+"-select");n=e.div.querySelectorAll(e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon");e.activate();break;case TC.Consts.editMode.ADDPOINT:r=e.div.querySelector(e._classSelector+"-point");n=e.div.querySelectorAll(e._classSelector+"-select,"+e._classSelector+"-line,"+e._classSelector+"-polygon");i(e.pointDraw);break;case TC.Consts.editMode.ADDLINE:r=e.div.querySelector(e._classSelector+"-line");n=e.div.querySelectorAll(e._classSelector+"-select,"+e._classSelector+"-point,"+e._classSelector+"-polygon");i(e.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:r=e.div.querySelector(e._classSelector+"-polygon");n=e.div.querySelectorAll(e._classSelector+"-select,"+e._classSelector+"-point,"+e._classSelector+"-line");i(e.polygonDraw);break;default:r=null;n=e.div.querySelectorAll(e._classSelector+"-select,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon");e.isActive&&e.deactivate();e.pointDraw&&e.pointDraw.isActive&&e.pointDraw.deactivate();e.lineDraw&&e.lineDraw.isActive&&e.lineDraw.deactivate();e.polygonDraw&&e.polygonDraw.isActive&&e.polygonDraw.deactivate()}if(t){e.div.querySelector("input[type=radio][name=mode][value="+t+"]").checked=!0}else e.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(t){t.checked=!1});r&&r.classList.remove(TC.Consts.classes.HIDDEN);n.forEach(function(t){t.classList.add(TC.Consts.classes.HIDDEN)})};d.showChanges=function(t){this._showsChanges=t;for(var e in this._changesLayers){this._changesLayers[e].setVisibility(t&&this.layer&&e===this.layer.id)}};d.cancel=function(){this.options.modes&&Array.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};d.onFeatureClick=function(t){self.activeControl&&self.activeControl.isExclusive()||t.feature.show()};d.activate=function(t){TC.Control.prototype.activate.call(this);var e=t||{};this._cancelBtn.disabled=!1;this.wrap.activate(e.mode?e.mode:this.mode);TC.Control.prototype.activate.call(this)};d.deactivate=function(){TC.Control.prototype.deactivate.call(this);this.wrap.cancel(!0);this._cancelBtn.disabled=!0;this.wrap.deactivate()};d.isExclusive=function(){return!0};d.joinFeatures=function(t){var e=this;if(e.geometryType===TC.Consts.geom.MULTIPOLYLINE||e.geometryType===TC.Consts.geom.MULTIPOLYGON||e.geometryType===TC.Consts.geom.MULTIPOINT){e._joinedFeatureAttributes=[];if(t.length>1){for(var r=t.map(function(t){e._joinedFeatureAttributes[e._joinedFeatureAttributes.length]=t.getData();return t.geometry}).reduce(function(t,e){return t.concat(e)}),n=new t[0].constructor(r),i=0,o=t.length;i<o;i++){var a=t[i];e.layer.removeFeature(a);e.trigger(TC.Consts.event.FEATUREREMOVE,{feature:a})}e.layer.addFeature(n).then(function(t){e.setSelectedFeatures([n]);e.trigger(TC.Consts.event.FEATUREADD,{feature:t});t.showPopup(e.attributeEditor)})}c(e,[n])}};d.splitFeatures=function(t){for(var e=this,r=t.filter(l),n=r.map(function(t){return t.geometry}),i=[],o=0,a=r.length;o<a;o++)for(var s=(f=r[o]).getData(),u=n[o],h=0,p=u.length;h<p;h++)i[i.length]=new f.constructor([u[h]],{data:s});o=0;for(var d=r.length;o<d;o++){var f=r[o];e.layer.removeFeature(f);e.trigger(TC.Consts.event.FEATUREREMOVE,{feature:f})}var g=new Array(i.length);for(o=0,d=i.length;o<d;o++){(g[o]=e.layer.addFeature(i[o])).then(function(t){e.trigger(TC.Consts.event.FEATUREADD,{feature:t})})}Promise.all(g).then(function(){e.setSelectedFeatures(i)});c(e,i)};d.deleteFeatures=function(t){this.wrap.deleteFeatures(t);0===this.layer.features.length&&(this._deleteBtn.disabled=!0)};d.applyEdits=function(){var t=this;if(t.layer){var e=t.features[t.layer.id];t.layer.applyEdits(e.added,e.modified,e.removed).then(function(){t.discardEdits();t.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(t){TC.error("Error ["+t.code+"] al guardar cambios: "+t.reason)})}};d.discardEdits=function(){var t=this;t._joinedFeatureAttributes=[];var e=i(t);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(r){if(r){for(var n=0,i=r.length;n<i;n++){var o=r[n];0===o.indexOf(e)&&localforage.removeItem(o)}if(t.layer){var a=t.features[t.layer.id];a.added.length=0;a.modified.length=0;a.removed.length=0;t.setSelectedFeatures([]);t.attributeEditor.hide();t._changesLayers[t.layer.id].clearFeatures();t.deleteCache(e).then(function(){t.layer.refresh()})}h(t,!1)}})})};d.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};d.setSelectedFeatures=function(t){return this.wrap.setSelectedFeatures(t)};d.getLayer=function(){return this.layer};d.getChangesLayerStyle=function(t){var e=function(e){for(var r,n=t.wrap.getRGBA(e),i=0;i<3;i++)n[i]=255-n[i];4===(r=(65536*n[0]+256*n[1]+n[2]).toString(16)).length?r="00"+r:5===r.length&&(r="0"+r);return"#"+r},r=[1,3],n=TC.Util.extend(!0,{},t.options.styles);if(n.point){n.point.strokeColor=e(n.point.strokeColor);n.point.lineDash=r}if(n.line){n.line.strokeColor=e(n.line.strokeColor);n.line.lineDash=r}if(n.polygon){n.polygon.strokeColor=e(n.polygon.strokeColor);n.polygon.lineDash=r}return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(t){this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection="boolean"!=typeof this.options.allowReprojection||this.options.allowReprojection};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var t=TC.control.ExternalWMS.prototype;t.CLASS="tc-ctl-xwms";t.markServicesAsSelected=function(t){if(t.length>0){const e=t[0];e.disabled=!0;e.classList.add("tc-ctl-xwms-option-selected")}};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.div.addEventListener("change",TC.EventTarget.listenerBySelector("select",function(t){if(""!==t.target.value){var r=t.target.value;0===r.indexOf("//")&&(r=location.protocol+r);e.div.querySelector("input").value=r;t.target.value=""}}));const n=function(){var t=e.div.querySelector("input").value.trim();if(t)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t))if(e._addedUrls.some(function(e){return e.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")}))TC.alert(e.getLocaleString("serviceAlreadyAdded"));else{var r=e.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var n=TC.Util.getQueryStringParams(t);/https?:\/\/|\/\//i.test(t)||(t="//"+t);var i=["version","service","request"],o=function(t,e){for(var r=0;r<e.length;r++)t=TC.Util.removeURLParameter(t,e[r]);t.match(/\?$/)&&(t=t.substr(0,t.length-1));return t}(t,Object.keys(n));for(var a in n)i.indexOf(a.toLowerCase())>=0&&delete n[a];const h=e.div.querySelector("button");h.disabled=!0;for(var s={id:"xwms"+ ++e.count,type:"WMS",url:o,hideTree:!1,queryParams:n},l=0;l<e.options.suggestions.length;l++){var c=e.options.suggestions[l].items.filter(function(e,r){return e.url===t});if(c.length>0&&c[0].layerNames){s.layerNames=c[0].layerNames;break}}var u=new TC.layer.Raster(s);u.getCapabilitiesPromise().then(function(n){if(void 0!==n.Capability){var i=n.Capability.Layer;if(i.CRS&&-1==i.CRS.indexOf(e.map.crs)&&!e.allowReprojection){TC.alert(e.getLocaleString("serviceSrsNotCompatible"));r.hide();h.disabled=!1;return}e.map.trigger(TC.Consts.event.EXTERNALSERVICEADDED,{layer:u});e.div.querySelector("input").value="";const o=[];e.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")&&o.push(e)});e.markServicesAsSelected(o);e._addedUrls.push(t);r.hide();h.disabled=!1}else{TC.alert(e.getLocaleString("noLayersFoundInService"));r.hide();h.disabled=!1}},function(t){TC.alert(e.getLocaleString("serviceCouldNotBeLoaded")+":\n"+t);r.hide();h.disabled=!1})}else TC.alert(e.getLocaleString("typeAValidAddress"));else TC.alert(e.getLocaleString("typeAnAddress"))};e.renderPromise().then(()=>{e.div.querySelector("input").addEventListener("keyup",t=>{t.key&&"enter"===t.key.toLowerCase()&&e.div.querySelector("input").value.trim().length>0&&n()})});e.div.addEventListener("click",TC.EventTarget.listenerBySelector('button[name="agregar"]',n));t.on(TC.Consts.event.LAYERADD,function(t){const r=t.layer;if(r&&!r.isBase){var n=r.url;if(n){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[];0===e.div.querySelectorAll("select option").length&&n&&-1===e.pending_markServicesAsSelected.indexOf(n)&&e.pending_markServicesAsSelected.push(n);const t=[];e.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")&&t.push(e)});e.markServicesAsSelected(t);e._addedUrls.push(n)}}});return r};t.template={};TC.isDebug?t.template[t.CLASS]=TC.apiLocation+"TC/templates/ExternalWMS.html":t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.x(e.get(["title"],!1),e,{block:r},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(e.get(["suggestions"],!1),e,{block:n},{}).w('</select><input type="url" class="tc-textbox" placeholder="').h("i18n",e,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",e,{},{$key:"addService"}).w("</button></div></div>")}e.__dustBody=!0;function r(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"addMaps"}).w("</h2>")}r.__dustBody=!0;function n(t,e){return t.x(e.get(["group"],!1),e,{block:i},{}).s(e.get(["items"],!1),e,{block:o},{}).x(e.get(["group"],!1),e,{block:a},{})}n.__dustBody=!0;function i(t,e){return t.w('<optgroup label="').f(e.get(["group"],!1),e,"h").w('">')}i.__dustBody=!0;function o(t,e){return t.w('<option value="').f(e.get(["url"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w("</option>")}o.__dustBody=!0;function a(t,e){return t.w("\t</optgroup>")}a.__dustBody=!0;return e};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(e.options,function(){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[];e.pending_markServicesAsSelected.forEach(function(t){const r=[];e.div.querySelectorAll("select option").forEach(function(e){TC.Util.addProtocol(e.value)===TC.Util.addProtocol(t)&&r.push(e)});e.markServicesAsSelected(r);e._addedUrls.push(t)});e.pending_markServicesAsSelected=[]}))}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){var t=this;TC.control.FeatureInfoCommons.apply(this,arguments);t.wrap=new TC.wrap.control.FeatureInfo(t);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";t.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const e="boolean"==typeof t.options.displayElevation?{}:t.options.displayElevation;t.elevation=new TC.tool.Elevation(e)})};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.FeatureInfo.prototype,e=function t(e,r){var n;if(Array.isArray(e))for(var i=0,o=(n=e.slice()).length;i<o;i++)n[i]=t(n[i]);else n="number"==typeof e?Math.round(e.toFixed(r)):e;return n};t.register=function(t){const e=TC.control.FeatureInfoCommons.prototype.register.call(this,t);document.createElement("div").appendChild(this.div);return e};t.callback=function(t,e){var r=this;if(r.elevation){r.querying=!0;r.elevationRequest=r.elevation.getElevation({crs:r.map.crs,coordinates:t})}if(r.map&&r.filterLayer){var n=r.getLocaleString("featureInfo"),i=TC.Util.extend({},r.map.options.styles.marker,r.markerStyle,{title:n,set:n,showsPopup:!1});r.filterLayer.clearFeatures();r.filterFeature=null;r.filterLayer.addMarker(t,i).then(function(e){r.map.putLayerOnTop(r.filterLayer);r.querying=!0;r.filterFeature=e;for(var n=!1,i=0;i<r.map.workLayers.length;i++){var o=r.map.workLayers[i];if(o.type===TC.Consts.layerType.WMS&&o.getVisibility()&&o.names.length>0){n=!0;break}}var a=r.map.getResolution();if(n)r.wrap.getFeatureInfo(t,a);else{r.querying=!1;setTimeout(function(){r.responseCallback({coords:t})})}})}};t.responseCallback=function(t){const r=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(r,t);if(r.filterFeature){var n=t.services;if(n)for(var i=0;i<n.length;i++){for(var o=n[i],a=0;a<o.layers.length;a++)if(!o.layers[a].features.length){o.layers.splice(a,1);a-=1}if(!o.layers.length){n.splice(i,1);i-=1}}r.info.defaultFeature=t.defaultFeature;var s=r.map.options.locale||TC.Cfg.locale;t.isGeo=r.map.wrap.isGeo();r.elevationRequest&&(t.displayElevation=!0);if(t.coords){t.crs=r.map.crs;t.coords=t.coords.map(function(e){return TC.Util.formatNumber(e.toFixed(t.isGeo?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),s)})}if(n&&n.length||r.elevationRequest)r.renderData(t,function(){r.insertLinks();if(r.sharedFeatureInfo){r.div.querySelectorAll("ul."+r.CLASS+"-services li").forEach(function(t){t.classList.add(TC.Consts.classes.CHECKED)});for(var t,n=r.sharedFeatureInfo,i=0,o=r.info.services.length;i<o;i++){var a=r.info.services[i];if(a.mapLayers.some(function(t){return t.url===n.s})){for(var s=0,l=a.layers.length;s<l;s++){var c=a.layers[s];if(c.name===n.l){for(var u=0,h=c.features.length;u<h;u++){var p=c.features[u];if(p.id===n.f){t=p;var d=hex_md5(JSON.stringify({data:p.getData(),geometry:e(p.geometry,TC.Consts.DEGREE_PRECISION)}));n.h!==d&&TC.alert(r.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}if(t){r.highlightedFeature=t;r.map.addLayer({id:r.getUID(),type:TC.Consts.layerType.VECTOR,title:r.getLocaleString("foi"),stealth:!0}).then(function(e){r.sharedFeatureLayer=e;r.filterLayer.clearFeatures();r.filterFeature=null;e.addFeature(t);r.map.zoomToFeatures([t])})}delete r.sharedFeatureInfo}else r.displayResults()});else{r.resultsLayer.clearFeatures();r.filterLayer.clearFeatures();r.filterFeature=null}}};t.displayResultsCallback=function(){const t=this;TC.control.FeatureInfoCommons.prototype.displayResultsCallback.call(t);if(t.elevationRequest){const e=t.getDisplayControl();t.getDisplayTarget().querySelector(`.${t.CLASS}-elev`).classList.add(TC.Consts.classes.HIDDEN);t.elevationRequest.then(function(r){if(e.currentFeature){const n=e.currentFeature.geometry;if(n[0]===r[0][0]&&n[1]===r[0][1]){const e=r.length?r[0][2]:null;t.displayElevation(e)}}t.elevationRequest=null})}};t.displayElevation=function(t){const e=this.map.options.locale||TC.Cfg.locale,r=null===t?"-":TC.Util.formatNumber(Math.round(t),e)+" m",n=this.getDisplayTarget().querySelector(`.${this.CLASS}-elev`);n.classList.toggle(TC.Consts.classes.HIDDEN,null===t);n.querySelector(`.${this.CLASS}-coords-val`).innerHTML=r};t.loadSharedFeature=function(t){const e=this;if(t){if(0===e.map.workLayers.filter(function(e,r){return e.type===TC.Consts.layerType.WMS&&e.url===t.s&&e.getDisgregatedLayerNames().indexOf(t.l)>=0}).length){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST);return}e.sharedFeatureInfo=t;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){const r=[-100,-100];e.beforeRequest({xy:r});e.filterLayer.clearFeatures();e.filterFeature=null;e.filterLayer.addMarker(r).then(function(r){e.filterFeature=r;e.wrap.getFeatureInfo(t.xy,t.r,{serviceUrl:t.s,layerName:t.l,featureId:t.f})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.control.FeatureTools=function(){const t=this;TC.Control.apply(t,arguments);t.layer=null;t.exportsState=!0;const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:e+"-dialog-ip-m"};t.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const e="boolean"==typeof t.options.displayElevation?{}:t.options.displayElevation;t.elevation=new TC.tool.Elevation(e)});t._dialogDiv=TC.Util.getDiv(t.options.dialogDiv);window.$&&(t._$dialogDiv=$(t._dialogDiv));t.options.dialogDiv||document.body.appendChild(t._dialogDiv)};TC.inherit(TC.control.FeatureTools,TC.Control);!function(){var t=TC.control.FeatureTools.prototype;t.CLASS="tc-ctl-ftools";t.TITLE_SEPARATOR=" \u2022 ";t.FILE_TITLE_SEPARATOR="__";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/FeatureTools.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureToolsDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-ftools"><button class="tc-ctl-ftools-dl-btn" title="').h("i18n",e,{},{$key:"download"}).w('">').h("i18n",e,{},{$key:"download"}).w('</button><button class="tc-ctl-ftools-share-btn" title="').h("i18n",e,{},{$key:"share"}).w('">').h("i18n",e,{},{$key:"share"}).w('</button><button class="tc-ctl-ftools-zoom-btn" title="').h("i18n",e,{},{$key:"zoomToFeature"}).w('">').h("i18n",e,{},{$key:"zoomToFeature"}).w('</button><button class="tc-ctl-ftools-del-btn" title="').h("i18n",e,{},{$key:"deleteFeature"}).w('">').h("i18n",e,{},{$key:"deleteFeature"}).w("</button></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-ftools-dialog tc-ctl-ftools-dl-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"feature"}).w(" - ").h("i18n",e,{},{$key:"download"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(e.get(["elevation"],!1),e,{block:r},{}).w('<div class="tc-ctl-ftools-dialog-dl"><div><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div></div><div class="tc-ctl-ftools-dialog tc-ctl-ftools-share-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"feature"}).w(" - ").h("i18n",e,{},{$key:"share"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-ftools-share-dialog-ctl"></div></div></div></div>')}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-ftools-dialog-elev"><input id="').f(e.get(["checkboxId"],!1),e,"h").w('" type="checkbox"><label for="').f(e.get(["checkboxId"],!1),e,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",e,{},{$key:"includeElevations"}).w("</label></div>").x(e.get(["resolution"],!1),e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-ftools-dialog-ip tc-hidden"><h4>').h("i18n",e,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="finfo-ip-coords" value="0" checked /><span>').h("i18n",e,{},{$key:"no"}).w('</span></label><label><input type="radio" name="finfo-ip-coords" value="1"/><span>').h("i18n",e,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-ftools-dialog-ip-m tc-hidden">').h("i18n",e,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(e.get(["resolution"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}n.__dustBody=!0;return e}}t.register=function(t){const e=this;t.on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(t){e.currentDisplay=t.control;if(e.currentDisplay.caller||!e.currentDisplay.caller&&e.currentDisplay.currentFeature){e.highlightedFeature=e.currentDisplay.caller||!e.currentDisplay.currentFeature?e.currentDisplay.caller.highlightedFeature:e.currentDisplay.currentFeature;e.highlightedFeature&&(e.highlightedFeature.showsPopup=!0);e.addUI(e.currentDisplay)}}).on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(t){e.currentDisplay=null}).on(TC.Consts.event.FEATUREADD,function(t){const r=t.feature;if(e.currentDisplay&&e.currentDisplay.caller&&r===e.currentDisplay.caller.highlightedFeature){e.highlightedFeature=r;e.highlightedFeature.showsPopup=!0}}).on(TC.Consts.event.FEATUREREMOVE,function(r){const n=r.feature;if(n===e.highlightedFeature){const r=n.clone();r.showsPopup=!0;t.getControlsByClass("TC.control.Popup").concat(t.getControlsByClass("TC.control.ResultsPanel")).forEach(function(t){t.currentFeature===e.highlightedFeature&&(t.currentFeature=r)});e.getHighlightLayer().then(function(t){t.addFeature(r)})}});return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),e.renderPromise()]).then(function(){e.map.addControl("share",{id:e.getUID(),div:e._dialogDiv.querySelector(".tc-modal-body ."+e.CLASS+"-share-dialog-ctl"),includeControls:!1}).then(function(t){e._shareCtl=t;r(e)}).catch(function(t){n(t instanceof Error?t:Error(t))})})})};t.render=function(t){const r=this;return r._set1stRenderPromise(r.getRenderedHtml(r.CLASS+"-dialog",{checkboxId:r.getUID(),elevation:r.options.displayElevation},function(n){r._dialogDiv.innerHTML=n;r._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(t){TC.Util.closeModal();const n=r.map.getLoadingIndicator(),i=n&&n.addWait(),o={};if(r.options.displayElevation&&r._dialogDiv.querySelector(r._selectors.ELEVATION_CHECKBOX).checked){const t="1"===r._dialogDiv.querySelector(r._selectors.INTERPOLATION_RADIO+":checked").value;o.elevation={resolution:t?parseFloat(r._dialogDiv.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||r.options.displayElevation.resolution:0}}e(r,o).then(function(e){r.map.exportFeatures([e],{fileName:r._getFeatureFilename(e),format:t.target.dataset.format})},function(t){TC.tool.Elevation&&t.message===TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.alert(r.getLocaleString("tooManyCoordinatesForElevation.warning")):TC.error(r.getLocaleString("elevation.error"))}).finally(function(){n&&n.removeWait(i)})}));r._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(r._selectors.ELEVATION_CHECKBOX,function(t){r.showDownloadDialog()}));r._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(r._selectors.INTERPOLATION_RADIO,function(t){r._dialogDiv.querySelector(r._selectors.INTERPOLATION_DISTANCE).classList.toggle(TC.Consts.classes.HIDDEN,"0"===t.target.value)}));r.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(t)&&t()}))};t.addUI=function(t){const e=this,r=t.getMenuElement(),n=function(){return r&&!r.querySelector("."+e.CLASS)};n()?e.getRenderedHtml(e.CLASS,null,function(i){if(n()){const n=(new DOMParser).parseFromString(i,"text/html").body.firstChild;r.appendChild(n);e.updateUI(t);if(!e.map.options.stateful){const t=n.querySelector("."+e.CLASS+"-share-btn");t.parentElement.removeChild(t)}e._setToolButtonHandlers(n);e._decorateDisplay(t.getContainerElement())}}):e.updateUI(t)};t._decorateDisplay=function(t){const e=this;if(e.highlightedFeature){const r=t.querySelector("table.tc-attr");if(r){r.addEventListener(TC.Consts.event.CLICK,function(t){e.zoomToCurrentFeature()});r.querySelectorAll("a").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation()})});r.classList.add(e.CLASS+"-zoom");r.setAttribute("title",e.getLocaleString("clickToCenter"))}TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){var r="";if(e.highlightedFeature){r=e.highlightedFeature.id;!0===e.highlightedFeature.showsPopup&&new TC.control.Print({target:t,title:r})}})}};t.updateUI=function(t){const e=this,r=t.getMenuElement().querySelector("."+e.CLASS);r.classList.remove(TC.Consts.classes.ACTIVE);clearTimeout(e._uiUpdateTimeout);e._uiUpdateTimeout=setTimeout(function(){const t=e.getCurrentFeature();r.classList.toggle(TC.Consts.classes.ACTIVE,!(!t||!t.showsPopup))},100)};t._setToolButtonHandlers=function(t){const e=this;t.querySelector("."+e.CLASS+"-dl-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.showDownloadDialog()});e.map.options.stateful&&t.querySelector("."+e.CLASS+"-share-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.showShareDialog()});t.querySelector("."+e.CLASS+"-zoom-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.zoomToCurrentFeature()});t.querySelector("."+e.CLASS+"-del-btn").addEventListener(TC.Consts.event.CLICK,function(t){e.removeCurrentFeature()})};t.getHighlightLayer=function(){const t=this;return new Promise(function(e,r){t.layer?e(t.layer):t.map.addLayer({id:t.getUID(),title:t.CLASS+": Highlighted features layer",type:TC.Consts.layerType.VECTOR,stealth:!0}).then(function(r){t.layer||(t.layer=r);e(t.layer)})})};t.showDownloadDialog=function(){const t=this,e=t._dialogDiv.querySelector("."+t.CLASS+"-dialog"),r=t.getCurrentFeature(),n=TC.feature.Polyline&&r instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&r instanceof TC.feature.MultiPolyline,i=TC.feature.Polygon&&r instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&r instanceof TC.feature.MultiPolygon;if(t.options.displayElevation){e.querySelector("."+t.CLASS+"-dialog-ip").classList.toggle(TC.Consts.classes.HIDDEN,!t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked||!n&&!i)}e.querySelector("button[data-format=GPX]").classList.toggle(TC.Consts.classes.HIDDEN,i);TC.Util.showModal(t._dialogDiv.querySelector("."+t.CLASS+"-dl-dialog"))};t.showShareDialog=function(){const t=this;TC.Util.showModal(t._dialogDiv.querySelector("."+t.CLASS+"-share-dialog"),{openCallback:function(){t.onShowShareDialog()},closeCallback:function(){t._shareCtl.featureToShare=null}})};t.getCurrentFeature=function(){return this.currentDisplay&&(this.currentDisplay.caller&&this.currentDisplay.caller.highlightedFeature||this.currentDisplay.currentFeature)};t.zoomToCurrentFeature=function(){const t=this;t.map&&t.map.zoomToFeatures([t.getCurrentFeature()],{animate:!0})};t.removeCurrentFeature=function(){const t=this,e=t.getCurrentFeature(),r=function(){t.highlightedFeature=null;e&&e.layer&&e.layer.removeFeature(e)},n=function(){t.currentDisplay&&(t.currentDisplay.close?t.currentDisplay.close():t.currentDisplay.hide())};if(t.currentDisplay&&t.currentDisplay.caller&&t.currentDisplay.caller.highlightedFeature===e||e.layer===t.layer){r();n()}else TC.confirm(t.getLocaleString("deleteFeature.confirm"),function(){r();n()})};const e=function(t,e){e=e||{};return new Promise(function(r,n){const i=t.getCurrentFeature();if(i){const a=i.clone();a.setId(i.id);a.layer=i.layer;if(e.elevation){var o=!0;!e.elevation.resolution&&a.getGeometryStride()>2&&(o=!1);if(o){const i={crs:t.map.crs,features:[a],maxCoordQuantity:t.options.displayElevation&&t.options.displayElevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:0};t.elevation.setGeometry(i).then(function(t){r(t[0])},function(t){n(t instanceof Error?t:Error(t))})}else r(a)}else{const t=a.getCoordsArray(),e=t[0];if(e&&e.length>2){t.forEach(function(t){t.length=2});a.setCoords(a.geometry)}r(a)}}else r(null)})};t.onShowShareDialog=function(){const t=this._shareCtl;t.extraParams=null;e(this).then(function(e){t.featureToShare=e;const r=t.div,n=t.generateLink();r.querySelector(".tc-url input[type=text]").value=n;r.querySelector(".tc-iframe input[type=text]").value=t.generateIframe(n)})};t.getFeatureTitle=function(t){var e="";t&&(e=t.id);return e};t._getFeatureFilename=function(t){return(this.getFeatureTitle(t).toString().replace(new RegExp(this.TITLE_SEPARATOR,"g"),this.FILE_TITLE_SEPARATOR)||this.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)};t.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null};t.importState=function(t){const e=this;t.layer&&e.getHighlightLayer().then(function(e){e.importState(t.layer)})}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){TC.Control.apply(this,arguments);Array.isArray(this.options.formats)?this.formats=this.options.formats:this.formats=[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];this.layers=[];this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[];this.exportsState=!0};TC.inherit(TC.control.FileImport,TC.Control);!function(){var t=TC.control.FileImport.prototype;t.CLASS="tc-ctl-file";TC.isDebug?t.template=TC.apiLocation+"TC/templates/FileImport.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",e,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(e.get(["formats"],!1),e,{block:r},{}).w('" />').h("i18n",e,{},{$key:"openFile"}).w("</label></div></div>")}e.__dustBody=!0;function r(t,e){return t.w(".").f(e.getPath(!0,[]),e,"h").h("sep",e,{block:n},{})}r.__dustBody=!0;function n(t,e){return t.w(",")}n.__dustBody=!0;return e};t.register=function(t){var e=this;const r=TC.Control.prototype.register.call(e,t);e.options.enableDragAndDrop&&t.wrap.enableDragAndDrop(e.options);t.on(TC.Consts.event.FEATURESIMPORT,function(r){const n=r.fileName,i=r.dropTarget,o=r.features;var a="."+TC.Consts.format.GPX.toLowerCase();n.toLowerCase().indexOf(a)===n.length-a.length||i!==e.map.div&&i!==e||t.addLayer({id:e.getUID(),title:n,type:TC.Consts.layerType.VECTOR}).then(function(r){e.layers.push(r);const n=function(t,e){return t.concat(e)};for(var i=function(t){var r=t.geometry;if(r){var i;switch(!0){case TC.feature.Point&&t instanceof TC.feature.Point:i=[r];break;case TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint:case TC.feature.Polyline&&t instanceof TC.feature.Polyline:i=r;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:case TC.feature.Polygon&&t instanceof TC.feature.Polygon:i=r.reduce(n);break;case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:i=r.reduce(n).reduce(n)}i.every(function(t){return Math.abs(t[0])<=180&&Math.abs(t[1])<=90})&&t.setCoords(TC.Util.reproject(r,"EPSG:4326",e.map.crs))}return t},a=0,s=o.length;a<s;a++){var l=i(o[a]);r.addFeature(l)}setTimeout(function(){t.zoomToFeatures(r.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(t){var r,n=t.file.name;r=".kmz"===n.toLowerCase().substr(n.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(e.getLocaleString(r,{fileName:n}),TC.Consts.msgErrorMode.TOAST);var i=new FileReader;i.onload=function(t){TC.error("Nombre del archivo: "+n+" \n Contenido del archivo: \n\n"+t.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};i.readAsText(t.file)}).on(TC.Consts.event.FEATUREREMOVE,function(t){const r=t.layer;e.layers.indexOf(r)>=0&&(r.features.length||e.map.removeLayer(r))}).on(TC.Consts.event.LAYERREMOVE,function(t){const r=e.layers.indexOf(t.layer);r>=0&&e.layers.splice(r,1)});return r};t.render=function(){const t=this;return t._set1stRenderPromise(t.renderData({formats:t.formats},function(){const e=t.div.querySelector("input[type=file]");e.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),r=this.parentElement;r.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);r.removeChild(e)});e.addEventListener("change",function(e){if(t.map){console.log("salta el change");t.map.wrap.loadFiles(e.target.files,{control:t})}})}))};t.exportState=function(){const t=this;return t.exportsState?{id:t.id,layers:t.layers.map(function(t){return{title:t.title,state:t.exportState()}})}:null};t.importState=function(t){const e=this;if(e.map){const r=[];t.layers.forEach(function(t){r.push(e.map.addLayer({id:e.getUID(),title:t.title,type:TC.Consts.layerType.VECTOR}))});Promise.all(r).then(function(r){for(var n=0,i=r.length;n<i;n++){const i=r[n];i.importState(t.layers[n].state);e.layers.push(i)}})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var t=TC.control.FullScreen.prototype;t.CLASS="tc-ctl-fscreen";TC.isDebug?t.template=TC.apiLocation+"TC/templates/FullScreen.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",e,{},{$key:"fscreen.tip"}).w('"></button>')}e.__dustBody=!0;return e};const e={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},r=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],n=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],i=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],o="undefined"!=typeof window&&void 0!==window.document?window.document:{},a="fullscreenEnabled"in o&&Object.keys(e)||r[0]in o&&r||n[0]in o&&n||i[0]in o&&i||[];t.fscreen={inFullscreen:!1,requestFullscreen:t=>t[a[e.requestFullscreen]](),requestFullscreenFunction:t=>t[a[e.requestFullscreen]],get exitFullscreen(){return o[a[e.exitFullscreen]].bind(o)},addEventListener:(t,r,n)=>o.addEventListener(a[e[t]],r,n),removeEventListener:(t,r,n)=>o.removeEventListener(a[e[t]],r,n),get fullscreenEnabled(){return Boolean(o[a[e.fullscreenEnabled]])},set fullscreenEnabled(t){},get fullscreenElement(){return o[a[e.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return o[("on"+a[e.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return o[("on"+a[e.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return o["on"+a[e.fullscreenerror].toLowerCase()]},set onfullscreenerror(t){return o["on"+a[e.fullscreenerror].toLowerCase()]=t}};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);r.then(function(){const t=e.div.querySelector("."+e.CLASS+"-btn");if(e.fscreen.fullscreenEnabled){e.fscreen.addEventListener("fullscreenchange",function(){e.fscreen.inFullscreen=null!==e.fscreen.fullscreenElement;t.classList.toggle(TC.Consts.classes.ACTIVE,e.fscreen.inFullscreen);t.setAttribute("title",e.fscreen.inFullscreen?e.getLocaleString("fscreen.tip.return"):e.getLocaleString("fscreen.tip"))},!1);t.addEventListener("click",function(){e.fscreen.inFullscreen?e.fscreen.exitFullscreen():e.fscreen.requestFullscreen(e.map.div)},!1)}else e.disable()});return r}}();Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,r=0;r<e;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;t+=arguments[r]*arguments[r]}return Math.sqrt(t)};!function(){for(var t=0,e=["ms","moz","webkit","o"],r=!(!window.performance||!window.performance.now),n=0,i=e.length;n<i&&!window.requestAnimationFrame;n+=1){window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);t=n+i;return o});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});if(!r){var o=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(t,e){o(function(e){return t(e<1e12?e:e-a)},e)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(t){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.delta=500;this.walkingSpeed=5e3;this.gapHill=this.options.gapHill||20;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var t=TC.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation";t.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:300,MEDIUM_WIDTH:310,MAX_WIDTH:445};t.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";t.template[t.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";t.template[t.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";t.template[t.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div> \x3c!-- img se insertan en el div del mapa--\x3e <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;"></div> <div class="tc-ctl-geolocation-track-panel-block" ><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",e,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",e,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" checked value="tracks" /><span>').h("i18n",e,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",e,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",e,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",e,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",e,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",e,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",e,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",e,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel"> <div class="tc-alert alert-warning tc-hidden" ><p id="panel-msg">').h("i18n",e,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",e,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",e,{},{$key:"geo.trk.render"}).w('">').h("i18n",e,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",e,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",e,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",e,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><div class="tc-ctl-geolocation-track-center tc-hidden"><button title="').h("i18n",e,{},{$key:"geo.trk.center"}).w('"></button></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-track-node"]=function(){dust.register(t.CLASS+"-track-node",e);function e(t,e){return t.w('<li data-id="').f(e.get(["id"],!1),e,"h").w('" data-uid="').f(e.get(["uid"],!1),e,"h").w('"><span class="tc-draw tc-selectable" title="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(e.get(["name"],!1),e,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",e,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",e,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",e,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",e,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",e,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",e,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",e,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",e,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",e,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",e,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",e,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",e,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-track-snapping-node"]=function(){dust.register(t.CLASS+"-track-snapping-node",e);function e(t,e){return t.w("<ul>").x(e.get(["n"],!1),e,{block:r},{}).w("<li> <span>").x(e.get(["isGeo"],!1),e,{else:n,block:i},{}).w(":</span> ").f(e.get(["x"],!1),e,"h").w("</li><li> <span>").x(e.get(["isGeo"],!1),e,{else:o,block:a},{}).w(":</span> ").f(e.get(["y"],!1),e,"h").w(" </li>").x(e.get(["z"],!1),e,{block:s},{}).x(e.get(["m"],!1),e,{block:c},{}).w("</ul>")}e.__dustBody=!0;function r(t,e){return t.w("<li><span>").h("i18n",e,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(e.get(["n"],!1),e,"h").w("</li>")}r.__dustBody=!0;function n(t,e){return t.w("X")}n.__dustBody=!0;function i(t,e){return t.h("i18n",e,{},{$key:"lon"})}i.__dustBody=!0;function o(t,e){return t.w("Y")}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"lat"})}a.__dustBody=!0;function s(t,e){return t.h("ne",e,{block:l},{key:e.get(["z"],!1),value:0})}s.__dustBody=!0;function l(t,e){return t.w("<li> <span>Z:</span> ").f(e.get(["z"],!1),e,"h").w(" </li>")}l.__dustBody=!0;function c(t,e){return t.w("<li> ").f(e.get(["m"],!1),e,"h").w(" </li>")}c.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.gps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",e,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",e,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",e,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",e,{},{$key:"ok"}).w(" </button></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-tracking-toast"]=function(){dust.register(t.CLASS+"-tracking-toast",e);function e(t,e){return t.w('<table class="tc-ctl-geolocation-info-tracking"><tr><th>').x(e.get(["isGeo"],!1),e,{else:r,block:n},{}).w(":</th><td> ").f(e.get(["x"],!1),e,"h").w(" </td>").x(e.get(["accuracy"],!1),e,{block:i},{}).w("</tr><tr><th>").x(e.get(["isGeo"],!1),e,{else:o,block:a},{}).w(":</th><td> ").f(e.get(["y"],!1),e,"h").w(" </td>").x(e.get(["speed"],!1),e,{block:s},{}).w("</tr><tr>").x(e.get(["z"],!1),e,{block:l},{}).x(e.get(["mdt"],!1),e,{block:h},{}).w("</tr> </table>")}e.__dustBody=!0;function r(t,e){return t.w("X")}r.__dustBody=!0;function n(t,e){return t.h("i18n",e,{},{$key:"lon"})}n.__dustBody=!0;function i(t,e){return t.w("<th>").h("i18n",e,{},{$key:"geo.trk.accuracy"}).w(":</th><td> ").f(e.get(["accuracy"],!1),e,"h").w(" m </td>")}i.__dustBody=!0;function o(t,e){return t.w("Y")}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"lat"})}a.__dustBody=!0;function s(t,e){return t.w("<th>").h("i18n",e,{},{$key:"geo.trk.speed"}).w(":</th><td>").f(e.get(["speed"],!1),e,"h").w(" km/h</td>")}s.__dustBody=!0;function l(t,e){return t.w("<th>").x(e.get(["isGeo"],!1),e,{else:c,block:u},{}).w(":</th><td> ").f(e.get(["z"],!1),e,"h").w(" m </td>")}l.__dustBody=!0;function c(t,e){return t.w("Z")}c.__dustBody=!0;function u(t,e){return t.h("i18n",e,{},{$key:"ele"})}u.__dustBody=!0;function h(t,e){return t.w('<th title="').h("i18n",e,{},{$key:" mdt.title"}).w('">').h("i18n",e,{},{$key:"ele"}).w(" (").h("i18n",e,{},{$key:"mdt"}).w("):</th><td>").f(e.get(["mdt"],!1),e,"h").w(" m </td>")}h.__dustBody=!0;return e}}t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap=new TC.wrap.control.Geolocation(e);e.wrap.register(t);t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"}).then(function(t){e.layerGPS=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(t){e.layerTracking=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(t){var e=t.getData().name;return e&&(e+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}}}).then(function(t){e.layerTrack=t});t.on(TC.Consts.event.FEATURESIMPORT,function(t){const e=this,r=t.fileName,n=t.dropTarget;var i="."+TC.Consts.format.KML.toLowerCase(),o="."+TC.Consts.format.GPX.toLowerCase();if(r.toLowerCase().indexOf(o)===r.length-o.length||r.toLowerCase().indexOf(i)===r.length-i.length&&n===e){e.clear(e.Const.Layers.TRACK);e.importTrack(t);/.kml$/g.test(r.toLowerCase())&&e.layerTrack&&e.layerTrack.styles&&e.layerTrack.features.forEach(function(t){t instanceof TC.feature.Point&&e.layerTrack.styles.point?t.setStyle(e.layerTrack.styles.point):t instanceof TC.feature.Polyline&&e.layerTrack.styles.line&&t.setStyle(e.layerTrack.styles.line)})}}.bind(e));return r};t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.render.call(e,t)})};t.importTrack=function(t){var e=this;if(e.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&e.map.toast(e.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var r=e.getLoadingIndicator().addWait();e.importedFileName=t.fileName;const o=[];for(var n=0,i=t.features.length;n<i;n++)o.push(e.layerTrack.addFeature(t.features[n]));Promise.all(o).then(function(){e.wrap.processImportedFeatures({wait:r,notReproject:t.notReproject});if(e.layerTrack){e.map&&e.map.layout&&e.map.layout.accordion&&e.div.classList.contains(TC.Consts.classes.COLLAPSED)&&e.map.controls.filter(function(t){return t!==e&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});e.div.classList.remove(TC.Consts.classes.COLLAPSED);e.div.querySelector("."+e.CLASS+"-btn-tracks > span").click();t.isShared||e.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};t.prepareFeaturesToShare=function(t){const e=this;return new Promise(function(r,n){if(t){var i=e.availableTracks.filter(function(e){return e.uid.toString()===t.toString()})[0].data,o=Math.pow(10,TC.Consts.DEGREE_PRECISION+1),a=(new ol.format.GeoJSON).readFeatures(i);const n=new Array(a.length);a.forEach(function(t,e){n[e]=TC.wrap.Feature.createFeature(t)});Promise.all(n).then(function(t){e.featuresToShare=t.map(function(t){const e={};switch(!0){case TC.feature.Marker&&t instanceof TC.feature.Marker:e.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&t instanceof TC.feature.Point:e.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:e.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:e.type=TC.Consts.geom.MULTIPOLYLINE}e.id=t.id;e.geom=TC.Util.compactGeometry(t.geometry,o);e.data=t.getData();return e});r()})}else r()})};var e=!0;t.renderData=function(a,s){const l=this;var c=l.Const.Selector;return TC.Control.prototype.renderData.call(l,a,function(){const a=l.div.querySelectorAll(l._classSelector+"-panel");l.div.querySelectorAll("."+l.CLASS+"-select span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=t.target;e&&"LABEL"!==e.tagName;)e=e.parentElement;const r=e.querySelector("input[type=radio][name=mode]").value;a.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches("."+l.CLASS+"-"+r))})})});l.track={activateButton:l.div.querySelector(l._classSelector+"-track-ui-activate"),deactivateButton:l.div.querySelector(l._classSelector+"-track-ui-deactivate"),trackSearch:l.div.querySelector(l._classSelector+"-track-available-srch"),trackImportFile:l.div.querySelector(l._classSelector+"-track-import"),trackSave:l.div.querySelector(l._classSelector+"-track-save"),trackAdd:l.div.querySelector(l._classSelector+"-track-add-wpt"),trackContinue:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-continue"),trackRenew:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-new"),trackClose:l._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-ok")};l.track.trackList=l.div.querySelector(l._classSelector+"-track-available-lst");l.track.trackToolPanelOpened=l.div.querySelector("#tc-ctl-geolocation-track-panel-opened");l.div.querySelector("."+t.CLASS+"-track-panel-help").addEventListener("click",function(){o.call(l)});l.track.trackName=l.div.querySelector(l._classSelector+"-track-title");l.track.trackWPT=l.div.querySelector(l._classSelector+"-track-waypoint");TC.Util.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(l.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.trackImportFile.disabled=!1;l.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),r=this.parentElement;r.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);r.removeChild(e)});l.track.trackImportFile.addEventListener("change",function(t){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,r);l.map.wrap.loadFiles(t.target.files,{control:l})}}})}else console.log("no es posible la importaci\xf3n");l.track.activateButton.addEventListener("click",function(){l.activateTracking();n.call(l)});l.track.deactivateButton.addEventListener("click",function(){l.deactivateTracking();i.call(l)});const h=function(){!function(t){t=t.toLowerCase();const e=Array.from(l.track.trackList.querySelectorAll("li"));e.forEach(function(t){t.style.display="none"});const r=e.filter(function(t){return t.matches("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK)}),n=l.div.querySelector(l._classSelector+"-track-search-icon");if(0===t.length){r.forEach(function(t){t.style.display=""});n.style.visibility="visible"}else{n.style.visibility="hidden";var i=new RegExp(t,"i");r.forEach(function(t){t.style.display=i.test(t.querySelector("span").textContent)?"":"none"});r.some(function(t){return""===t.style.display})||e.forEach(function(t){t.matches('[class^="tc-ctl-geolocation-track-not"]')&&(t.style.display="")})}}(this.value.toLowerCase().trim())};l.track.trackSearch.addEventListener("keyup",h);l.track.trackSearch.addEventListener("search",h);l.track.trackSave.addEventListener("click",l.saveTrack.bind(l));l.track.trackAdd.addEventListener("click",l.addWaypoint.bind(l));const p=l.div.querySelector(l._classSelector+"-track-available-lst");var d=function(t,e){"LI"!==e.tagName&&(e=e.parentElement);const r=e.querySelector("input"),n=e.querySelector("span");if(t){r.classList.remove(TC.Consts.classes.HIDDEN);r.focus();r.value=n.textContent;n.classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.EDIT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.DELETE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.DRAW).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT_GPX).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT_KML).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.SAVE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{r.classList.add(TC.Consts.classes.HIDDEN);n.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.EDIT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.DELETE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.DRAW).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT_GPX).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.EXPORT_KML).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(c.SAVE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(c.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(t,e){if(e){var r=[c.SIMULATE,c.EDIT,c.DELETE,c.EXPORT_GPX,c.EXPORT_KML],n=[c.STOP,c.PAUSE,c.BACKWARD,c.FORWARD,c.SPEED],i="LI"===e.tagName?e:e.parentNode;r.forEach(function(e){i.querySelector(e).hidden=t});n.forEach(function(e){i.querySelector(e).hidden=!t})}};p.addEventListener("click",TC.EventTarget.listenerBySelector(c.SIMULATE,function(t){var e=l.getLoadingIndicator().addWait();t.target.parentElement.querySelector(c.SPEED).textContent="x 1";y(l,t.target).then(function(){l.getLoadingIndicator().removeWait(e)})}));p.addEventListener("click",TC.EventTarget.listenerBySelector(c.DRAW,function(t){var e=l.getLoadingIndicator().addWait();g(l,t.target).then(function(){l.getLoadingIndicator().removeWait(e)})}));l.on(l.Const.Event.IMPORTEDTRACK,function(t){if(l.isDisabled)l.map.toast(l.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const e=l.track.trackList.querySelector('li[data-id="'+t.index+'"]');g(l,e.querySelector(c.DRAW));setTimeout(function(){l.track.trackList.scrollTop=t.index*e.offsetHeight},100)}});const f=function(t,e){t.track.trackList.querySelectorAll("li[data-id]").forEach(function(r){if(r.dataset.id!==e){const e=r.querySelector(c.SIMULATE),n=r.querySelector(c.PAUSE);e.classList.remove(t.Const.Classes.SIMULATIONACTIVATED);e.setAttribute("title",t.getLocaleString("tr.lst.simulate"));n.classList.remove("play");n.setAttribute("title",t.getLocaleString("tr.lst.pause"));t.uiSimulate(!1,r);d(!1,r)}});t.clear(t.Const.Layers.TRACK)};var g=function(t,e){return new Promise(function(r,n){const i=e.parentElement;setTimeout(function(){if(i.classList.contains(t.Const.Classes.SELECTEDTRACK)){t.uiSimulate(!1,e);t.clear(t.Const.Layers.TRACK);e.setAttribute("title",e.textContent)}else if(t.getSelectedTrack()){f(t,i.dataset.id);t.drawTrack(i)}else t.drawTrack(i);i.classList.contains(t.Const.Classes.SELECTEDTRACK)?t.prepareFeaturesToShare(i.dataset.uid).then(function(){r()}):r()},0)})},y=function(t,e){return new Promise(function(r,n){setTimeout(function(){const n=e.parentElement;f(t,n.dataset.id);t.uiSimulate(!1,t.getSelectedTrack());t.uiSimulate(!0,e);t.simulate_paused=!1;t.simulateTrack(n);r()},0)})};p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EDIT,function(t){d(!0,t.target)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.DELETE,function(t){l.removeTrack(t.target.parentElement)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.SAVE,function(t){if(0===t.target.parentElement.querySelector("input").value.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName(t.target.parentElement.dataset.id,t.target.parentElement.querySelector("input").value);d(!1,t.target)}}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.CANCEL,function(t){d(!1,t.target)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EXPORT_GPX+","+l._classSelector+" "+c.EXPORT_KML,function(t){const e=t.target.parentElement;var r=Array.from(t.target.classList).filter(function(t){return 0===t.indexOf("tc-btn-export-")})[0].replace("tc-btn-export-","").toUpperCase();l.export(r,e).then(function(t){if(t){var n=e.querySelector("span").textContent,i=new RegExp(l.Const.SupportedFileExtensions.join("|"),"gi"),o=n.replace(i,"");TC.Util.downloadFile(o+"."+r.toLowerCase(),l.Const.MimeMap[r],t)}else TC.alert(l.getLocaleString("geo.error.export"))})}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.STOP,function(t){l.uiSimulate(!1,t.target);l.wrap.simulateTrackEnd();const e=t.target.parentElement.querySelector(c.PAUSE);e.classList.remove("play");e.setAttribute("title",l.getLocaleString("tr.lst.pause"));t.target.parentElement.querySelector(c.SPEED).textContent="x 1";l.simulate_speed=1}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.PAUSE,function(t){l.simulate_paused=!t.target.classList.contains("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);t.target.setAttribute("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));t.target.classList.toggle("play",!!l.simulate_paused)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.BACKWARD,function(t){1==l.simulate_speed?l.simulate_speed=.5:l.simulate_speed=l.simulate_speed/2;t.target.parentElement.querySelector(l._classSelector+" "+c.FORWARD).disabled=!1;t.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;.000244140625==l.simulate_speed&&(t.target.disabled=!0)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.FORWARD,function(t){l.simulate_speed=l.simulate_speed/.5;t.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;t.target.parentElement.querySelector(l._classSelector+" "+c.BACKWARD).disabled=!1;4096==l.simulate_speed&&(t.target.disabled=!0)}));l.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();u.call(l)});l.track.trackRenew.addEventListener("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.trackClose.addEventListener("click",function(){i.call(l)});l.track.trackAdvertisementOK.addEventListener("click",function(){const t=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(t.length>0){new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.setItem(t[0].getAttribute("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=document.querySelector("#tc-ctl-geolocation-track-render");l.track.renderTrack.addEventListener("change",function(){l.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&l.layerTracking.setVisibility(this.checked);e=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()});TC.Util.isFunction(s)&&s()})};t.activate=function(){};t.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var r=function(){this.map.off(TC.Consts.event.LAYERERROR,r);this.clearFileInput(this.track.trackImportFile);TC.alert(this.getLocaleString("geo.trk.upload.error3"))},n=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},i=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},o=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};t.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};t.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};t.setFormatInfoNewPosition=function(t){var e={},r=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var n=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(t.position,this.map.crs,this.map.view3D.crs):t.position;e.x=n[0].toLocaleString(r);e.y=n[1].toLocaleString(r);e.mdt=Math.round(this.map.view3D.getHeightFromMDT(n)).toLocaleString(r);e.isGeo=!0}else{e.x=Math.round(t.position[0]).toLocaleString(r);e.y=Math.round(t.position[1]).toLocaleString(r)}e.z=Math.round(t.altitude).toLocaleString(r);e.accuracy=Math.round(t.accuracy).toLocaleString(r);e.speed=t.speed.toLocaleString(r,{minimumFractionDigits:1,maximumFractionDigits:1});return e};t.renderInfoNewPosition=function(t){var e=this;e.getRenderedHtml(e.CLASS+"-tracking-toast",e.setFormatInfoNewPosition(t.pd),function(t){if(e.track.infoPanel)"boolean"==typeof e.track.infoPanel||e.track.infoPanel.isMinimized()||e.track.infoPanel.renderPromise().then(function(){e.track.infoPanel.getTableContainer().innerHTML=t;e.track.infoPanel.isVisible()||e.track.infoPanel.doVisible()});else{e.track.infoPanel=!0;var r,n={content:"table",titles:{main:e.getLocaleString("geo.mylocation"),max:e.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const o=function(t){n.side=t.SIDE.RIGHT;r=t.addControl("resultsPanel",n)};if(e.options.displayOn){var i=e.map.getControlsByClass("TC.control."+e.options.displayOn[0].toUpperCase()+e.options.displayOn.substring(1))[0];i?o(i):e.map.addControl(e.options.displayOn).then(o)}else{n.div=document.createElement("div");e.map.div.appendChild(n.div);r=e.map.addControl("resultsPanel",n)}r.then(function(r){r.caller=e;e.map.getControlsByClass("TC.control.ResultsPanel").filter(function(t){return"table"===t.content&&t!==r}).forEach(function(t){t.close()});e.track.infoPanel=r;r.renderPromise().then(function(){r.open(t)})})}})};var a,s,l,c=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},u=function(){var t=this;t.activate();n.call(t);c.call(t);t.on(t.Const.Event.POSITIONCHANGE,function(e){t.currentPoint=e.pd;t.renderInfoNewPosition(e);t.track.trackName.disabled=!1;t.track.trackSave.disabled=!1;t.track.trackWPT.disabled=!1;t.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features)});t.on(t.Const.Event.STATEUPDATED,function(t){});t.clear(t.Const.Layers.TRACKING);y.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);t.wrap.setTracking(!0)},h=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();g.apply(this)},p=function(){var t=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}();document[t]||h.apply(this);console.log("video is: "+this.videoScreenOn.paused)},d=function(){l||(l=p.bind(this));a||(a=function(){f.apply(this)}.bind(this));s||(s=h.bind(this));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",a,!1);window.addEventListener("pageshow",s,!1)}else{window.addEventListener("blur",a,!1);window.addEventListener("focus",s,!1)}},f=function(){var t=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},g=function(){var t=this;localforage.getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then(function(e){null!==e&&"null"!==e&&e.length>0&&TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)})},y=function(t){var e=this;new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.getItem(t).then(function(r){if(null==r){const r=e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),n=r.querySelector('input[type="checkbox"]');n.setAttribute("name",t);n.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop");r.querySelector("h3").textContent=t==e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title");TC.Util.showModal(e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});e.map.toast(TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};t._askTracking=function(t){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){TC.Util.isFunction(t)&&t()}});return!0};t.activateTracking=function(){var t=this,e=!0;t.isActive||t.activate();t.clear(t.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(t.getLocaleString("geo.error.trackinglocalstorage")):TC.error(r);e=!1}if(e){(function(){if(!this.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var e=document.createElement("source");e.src=t.WebM;e.type="video/webm";this.videoScreenOn.appendChild(e);var r=document.createElement("source");r.src=t.MP4;r.type="video/mp4";this.videoScreenOn.appendChild(r)}this.videoScreenOn.play()}).apply(t);d.apply(t);t.sessionTracking=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP);if(t.sessionTracking){t._askTracking(function(){i.call(t)})||t.track.trackRenew.click()}else u.call(t)}else i.call(t)};t.deactivateTracking=function(){var t=this,r=function(){t.track.infoPanel.close();f.apply(t);t.wrap.setTracking(!1);delete t.geopositionTracking;e||t.div.querySelector(t._classSelector+"-track-render").querySelector("label").click();(function(){this.videoScreenOn&&this.videoScreenOn.pause()}).apply(t);(function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",a,!1);window.removeEventListener("pageshow",s,!1)}else{window.removeEventListener("blur",a,!1);window.removeEventListener("focus",s,!1)}}).apply(t);t.off(t.Const.Event.POSITIONCHANGE);t.off(t.Const.Event.STATEUPDATED);i.call(t);t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.clear(t.Const.Layers.TRACKING);t.clear(t.Const.Layers.GPS);return!0};if(t.wrap.hasCoordinates()){t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return r()}return r()};t.getStoredTracks=function(){const t=this;return new Promise(function(e,r){var n=[];localforage.keys().then(function(r){if(0==(r=r.filter(function(e){return 0!==e.indexOf(t.Const.LocalStorageKey.TRACKINGTEMP)&&0===e.indexOf(t.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(e)})).length){t.availableTracks=n;e(n)}const i=new Array(r.length);r.forEach(function(t,e){i[e]=new Promise(function(e,r){localforage.getItem(t,function(t,r){e(r)})})});Promise.all(i).then(function(r){if(r&&r.length){r.forEach(function(t){(t=JSON.parse(t))instanceof Array?n=n.concat(t):n.push(t)});var i=n.length>1?m(n):n;t.availableTracks=i;e(i)}})})})};var m=function(t){var e=[];for(var r in t)if(t[r]&&"object"==typeof t[r]){e.push(t[r]);e.sort(function(t,e){return"string"==typeof t.name&&TC.Util.isFunction(t.name.localeCompare)?t.name.localeCompare(e.name):0})}return e};t.setStoredTracks=function(t){const e=this;return new Promise(function(r,n){const i=[];t.forEach(function(t){i.push(new Promise(function(r,n){localforage.setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),function(t,e){r(e)})}))});Promise.all(i).then(function(){e.getStoredTracks().then(function(){e.bindTracks();r()})})})};t.getAvailableTracks=function(){const t=this;return new Promise(function(e,r){t.availableTracks?e(t.availableTracks):t.getStoredTracks().then(function(t){e(t)})})};t.bindTracks=function(){var t=this;t.track.trackList.querySelectorAll("li").forEach(function(t){t.style.display="none"});t.getAvailableTracks().then(function(e){if(C(e)){t.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(t){t.style.display=""});t.track.trackSearch.disabled=!0}else{const o=t.getSelectedTrack();var r;o&&(r=o.dataset.uid);t.track.trackList.querySelectorAll("li[data-id]").forEach(function(e){t.track.trackList.removeChild(e)});for(var n=0;n<e.length;n++){var i=e[n];"object"==typeof i&&t.getRenderedHtml(t.CLASS+"-track-node",{id:n,uid:i.uid,name:i.name?i.name.trim():""},function(e){const r=(new DOMParser).parseFromString(e,"text/html").body.firstChild;t.track.trackList.appendChild(r)})}r&&t.setSelectedTrack(t.track.trackList.querySelector('li[data-uid="'+r+'"]'));t.track.trackSearch.disabled=!1}})};t.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);const t=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();this.miDiv=document.createElement("div");this.miDiv.classList.add("miDiv");this.miDiv.style.width=t.width+"px";this.miDiv.style.height=t.height+"px";this.miProgressDiv=document.createElement("div");this.miProgressDiv.classList.add("miProgressDiv",this.CLASS+"-track-elevation-chart-progress",TC.Consts.classes.HIDDEN);this.miProgressDiv.style.width="0%";this.miProgressDiv.style.height=t.height+"px";this.miProgressTextDiv=document.createElement("div");this.miProgressTextDiv.classList.add("miProgressTextDiv","tc-ctl-geolocation-track-elevation-chart-progress","text");this.miProgressTextDiv.style.width=t.width+"px";this.miProgressTextDiv.style.height=t.height+"px";this.miDiv.style.top=t.top+"px";this.miDiv.style.left=t.left+"px";this.miDiv.style.bottom=t.bottom+"px";this.miDiv.style.right=t.right+"px";this.miDiv.style.position="absolute";this.miDiv.style.zIndex=10008;this.miDiv.style.display="none";this.miProgressDiv.appendChild(this.miProgressTextDiv);this.miDiv.appendChild(this.miProgressDiv);document.body.appendChild(this.miDiv)};t.chartProgressClear=function(){const t=this;if(t.miDiv){t.miDiv.parentElement.removeChild(t.miDiv);t.miDiv=null;t.miProgressDiv=null;t.miProgressTextDiv=null}};t.chartSetProgress=function(t,e,r,n){this.miDiv&&"none"===this.miDiv.style.display&&(this.miDiv.style.display="");this.miProgressDiv.classList.remove(TC.Consts.classes.HIDDEN);var i=t.d,o=(i+Math.hypot(t.p[0]-e[0],t.p[1]-e[1]))/r*100;this.miProgressDiv.style.width=o+"%";var a,s,l=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,c=parseInt(e[2].toFixed(0)).toLocaleString(l);if(i/1e3<1){a=Math.round(i/1e3*1e3);s=" m"}else{a=Math.round(i/1e3*100)/100;s=" km"}a=a.toLocaleString(l);this.miProgressTextDiv.innerHTML="<div><span>"+c+" m</span><br><span>"+a+s+"</span></div>"+(n?"<br><span>"+n.toString+"</span>":"")};t._getTime=function(t,e){var r=e-t,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60;n.h=o+24*i;var a=Math.floor(r/1e3/60);r-=1e3*a*60;n.m=a;n.s=Math.floor(r/1e3);return TC.Util.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};t.simulateTrack=function(t){var e=this;e.simulate_speed=1;e.drawTrack(t,!1).then(function(){e.wrap.simulateTrack()})};t.drawTrack=function(t,e){var r=this;c.call(r);return new Promise(function(e,n){r.setSelectedTrack(t);r.drawTrackingData(t).then(function(){r.elevationTrack(t);r.activate();e()})})};t.elevationTrack=function(e,r){var n=this;if(r){n.wrap.simulateTrackEnd();n.uiSimulate(!1,e)}else{if(!n.onResize){n.onResize=n.elevationTrack.bind(n,e,!0);window.addEventListener("resize",n.onResize,!1)}n.chart={coordinates:[]};n.track.elevationChart&&(n.track.elevationChart=n.track.elevationChart.destroy());(function(t){return new Promise(function(e,r){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){n.getTrackingData(t).then(function(t){var r=t.data;if(r){var i,o;i=[];o=[];var a,s,l,c=!0,u={},h={},p=(new ol.format.GeoJSON).readFeatures(r),d=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZ||l.getLayout()==ol.geom.GeometryLayout.XYZM){var t=0;if(n.map.crs!==n.map.options.utmCrs){line=new ol.geom.LineString(TC.Util.reproject(l.getCoordinates(),n.map.crs,n.map.options.utmCrs));t=line.getLength()}else t=l.getLength();return parseFloat((t/1e3).toFixed(2))}return null},f=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZM||l.getLayout()==ol.geom.GeometryLayout.XYM){var t=l.getLastCoordinate()[3]-l.getFirstCoordinate()[3];return{s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}return null},g=function(t){if(n.chart.coordinates.length>0){var e=0;n.chart.coordinates.forEach(function(r,i,o){var a=0===i?r:o[i-1];if(n.map.crs!==n.map.options.utmCrs){r=TC.Util.reproject(r,n.map.crs,n.map.options.utmCrs);a=TC.Util.reproject(a,n.map.crs,n.map.options.utmCrs)}const s=r[0]-a[0],l=r[1]-a[1];e+=Math.sqrt(s*s+l*l);t.push(parseFloat(e.toFixed(2)))})}},y=function(t){for(var r=0;r<n.chart.coordinates.length;r++){if(!(n.chart.coordinates[r].length>2)){e(null);return}var i=Math.round(10*n.chart.coordinates[r][2])/10;c&&i>0&&(c=!1);t.push(i);0==r&&(a=s=i);a=Math.min(a,i);s=Math.max(s,i)}};p.filter(function(t){return"linestring"===t.getGeometry().getType().toLowerCase()||"multilinestring"===t.getGeometry().getType().toLowerCase()}).forEach(function(e){switch((l=e.getGeometry()).getType().toLowerCase()){case"linestring":if(t.layout===ol.geom.GeometryLayout.XYZM||t.layout===ol.geom.GeometryLayout.XYZ){h=f();d();u=TC.tool.Elevation.getElevationGain({coords:l.getCoordinates(),hillDeltaThreshold:n.gapHill});n.chart.coordinates=n.chart.coordinates.concat(l.getCoordinates());g(i);y(o)}break;case"multilinestring":if(t.layout===ol.geom.GeometryLayout.XYZM||t.layout===ol.geom.GeometryLayout.XYZ)for(var r,a=l.getLineStrings(),s=0;s<a.length;s++){d(a[s]);a[s].getLayout()==ol.geom.GeometryLayout.XYZM&&(r+=a[s].getLastCoordinate()[3]-a[s].getFirstCoordinate()[3]);n.chart.coordinates=n.chart.coordinates.concat(a[s].getCoordinates());r&&(h=f());g(i);y(o)}break;default:return null}});o instanceof Array&&0==o.length&&(c=!0);n.chartData=c?null:TC.Util.extend({},{time:h,ele:o,x:i,miny:a,maxy:s},u);e(n.chartData)}else e(null)})})})})(e).then(function(e){TC.Util.getMapLocale(n.map);if(null!=e){e.time&&(e.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));e.coords=n.chart.coordinates;n.hasElevation=!0}else{n.hasElevation=!1;e={msg:n.getLocaleString("geo.trk.chart.chpe.empty")}}e.minHeight=n.CHART_SIZE.MIN_HEIGHT;e.maxHeight=n.CHART_SIZE.MAX_HEIGHT;e.minWidth=n.CHART_SIZE.MIN_WIDTH;e.mediumWidth=n.CHART_SIZE.MEDIUM_WIDTH;e.maxWidth=n.CHART_SIZE.MAX_WIDTH;n.map.one(TC.Consts.event.DRAWCHART,function(t){n.chartProgressInit()});if(n.resultsPanelChart){n.resultsPanelChart.open();n.map.trigger(n.Const.Event.DRAWTRACK,{data:e})}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");var r,i={content:"chart",titles:{main:n.getLocaleString("geo.trk.chart.chpe"),max:n.getLocaleString("geo.trk.chart.chpe")},openOn:n.Const.Event.DRAWTRACK,closeOn:n.Const.Event.CLEARTRACK,chart:{ctx:n,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};const a=function(t){i.side=t.SIDE.RIGHT;r=t.addControl("resultsPanel",i)};if(n.options.displayOn){var o=n.map.getControlsByClass("TC.control."+n.options.displayOn[0].toUpperCase()+n.options.displayOn.substring(1))[0];o?a(o):n.map.addControl(n.options.displayOn).then(a)}else{i.div=document.createElement("div");n.map.div.appendChild(i.div);r=n.map.addControl("resultsPanel",i)}r.then(function(t){t.caller=n;n.resultsPanelChart=t;t.renderPromise().then(function(){t.activateSnapping=function(t){n.layerTrack&&!n.layerTrack.getVisibility()&&0==n.layerTrack.getOpacity()&&n.wrap.deactivateSnapping.call(n.wrap)};t.deactivateSnapping=function(t){n.layerTrack&&n.layerTrack.getVisibility()&&n.layerTrack.getOpacity()>0&&n.wrap.activateSnapping.call(n.wrap)};t.div.addEventListener("mouseover",t.deactivateSnapping);t.div.addEventListener("mouseout",t.activateSnapping);n.map.on(TC.Consts.event.RESULTSPANELMIN,function(){n.miDiv&&(n.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELMAX,function(){n.miDiv&&(n.miDiv.style.display="")}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){n.miDiv&&(n.miDiv.style.display="none")});n.map.trigger(n.Const.Event.DRAWTRACK,{data:e})})})}})}};t.clear=function(t){var e=this;if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}if(t==e.Const.Layers.TRACK){e.layerTrack.clearFeatures();e.resultsPanelChart&&e.resultsPanelChart.close();delete e.chartData;e.wrap.simulateTrackEnd();e.wrap.clear();e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});e.map.trigger(e.Const.Event.CLEARTRACK);e.featuresToShare=[]}else{e.layerTracking.clearFeatures();e.layerGPS.clearFeatures()}};t.saveTrack=function(t){const e=this;return new Promise(function(r,n){var i=t.message||e.getLocaleString("geo.trk.save.alert"),o=function(o){var a;a=e.getLoadingIndicator().addWait();var s=t.importedFileName||e.track.trackName.value.trim(),l=e.availableTracks;l||(l=[]);var u=e.wrap.formattedToStorage(o,!0,t.notReproject),h=function(t){e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.getLoadingIndicator().removeWait(t);c.call(e)},p={name:s,data:u.features,layout:u.layout,crs:e.storageCRS};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var t=hex_md5(JSON.stringify(p)),o=l.map(function(e){var r=JSON.parse(JSON.stringify(e));delete r.uid;if(t===hex_md5(JSON.stringify(r)))return e.uid;{const o=new ol.format.GeoJSON;var n=o.readFeatures(r.data),i=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);n.forEach(function(t){var e=TC.Util.explodeGeometry(TC.Util.compactGeometry(t.getGeometry().getCoordinates(),i));t.getGeometry().setCoordinates(e)});r.data=o.writeFeatures(n);return t===hex_md5(JSON.stringify(r))?e.uid:null}}).filter(function(t){return null!==t});const s=function(t){return e.getStoredTracks().then(function(){e.bindTracks();for(var r,n=0;n<e.availableTracks.length;n++)if(e.availableTracks[n].uid===t){r=n;break}return r})};if(0===o.length){p.uid=Date.now()+Math.random();l.push(p);l=m(l);try{e.setStoredTracks(l).then(function(){e.map.toast(i,{duration:3e3});h(a);s(p.uid).then(function(t){r(t)})})}catch(t){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+t.message);h(a);n()}}else{console.log("Ya existe un track con ese mismo hash");h(a);s(o[0]).then(function(t){r(t)})}})};if(e.importedFileName)o(e.layerTrack);else if(0==e.track.trackName.value.trim().length){e.track.trackName.value=(new Date).toLocaleString();o(e.layerTracking)}else o(e.layerTracking)})};t.addWaypoint=function(){var t=this.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString());var e=this.getLoadingIndicator().addWait();c.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:t,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(e)};t.editTrackName=function(t,e){var r=this;r.getAvailableTracks().then(function(n){if(n&&n[t]){n[t].name=e;r.setStoredTracks(n)}})};t.removeTrack=function(t){var e=this;e.getAvailableTracks().then(function(r){if(r){var n=t.dataset.id;if(r[n]){var i=r[n].uid;TC.confirm(e.getLocaleString("geo.trk.delete.alert"),function(){const t=e.getSelectedTrack();t&&t.dataset.id===n&&e.clear(e.Const.Layers.TRACK);localforage.removeItem(e.Const.LocalStorageKey.TRACKING+"#"+i).then(function(){e.getStoredTracks().then(function(){e.bindTracks()})}).catch(function(t){console.log(t)})},function(){})}}})};t.setSelectedTrack=function(t){var e=this;e.isActive||e.activate();e.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(t){t.setAttribute("title",t.textContent)});e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});t.classList.add(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",e.getLocaleString("tr.lst.clear")+" "+t.querySelector("span").textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"))};t.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};t.clearSelectedTrack=function(){const t=this,e=t.getSelectedTrack();if(e){if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}e.classList.remove(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",e.textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"))}};t.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};t.drawTrackingData=function(t){const e=this;return new Promise(function(r,n){e.wrap.clear();e.getTrackingData(t).then(function(t){t.data;t.data&&e.wrap.drawTrackingData(t).then(function(){var t=e.layerTrack.features;if(t&&t.length>0){var n=t.filter(function(t){t.showsPopup=!1;return!!(TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)||t instanceof TC.feature.Polyline}).map(function(t){return TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline?t.geometry[0]:t instanceof TC.feature.Polyline?t.geometry:void 0})[0];if(n){var i=n[0],o=n[n.length-1];i&&i!==o&&e.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});o&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}e.layerTrack.setVisibility(!0);r()})})})};t.getTrackingData=function(t){const e=this;return new Promise(function(r,n){e.getAvailableTracks().then(function(n){if(n){const o=t.dataset.id;if(n[o]){var i=n[o].data;i=e.wrap.formattedFromStorage(i);r({data:i,layout:n[o].layout})}}else r()})})};t.export=function(t,e){return this.wrap.export(t,e)};t.getElevationTooltip=function(t){this.wrap.showElevationMarker(t);return this.resultsPanelChart.getElevationChartTooltip(t)};t.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};t.clearFileInput=function(t){const e=document.createElement("form"),r=t.parentElement;r.insertBefore(e,t);e.appendChild(t);e.reset();e.insertAdjacentElement("afterend",t);r.removeChild(e)};t.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};t.onGeolocateError=function(t){var e;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(t.code){case t.PERMISSION_DENIED:e=this.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:e=this.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:e=this.getLocaleString("geo.error.timeout");break;default:e=this.getLocaleString("geo.error.default")}this.map.toast(e,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var C=function(t){return!t||0===t.length};t.exportState=function(){const t=this;if(t.exportsState){const r={};if(t.layerTrack){var e=t.layerTrack.features;if(e.length>0&&t.featuresToShare&&t.featuresToShare.length>0)r.features=t.featuresToShare;else{const n=t.layerTrack.exportState({features:e});r.features=n.features}r.id=t.id;const n=t.getSelectedTrack();n&&(r.trackName=n.querySelector("span").innerHTML);return r}}return null};t.importState=function(t){const e=this;if(e.map&&t.features&&t.features.length){e.enable();if(t.features.length>0){const r=new Array(t.features.length);t.features.forEach(function(t,e){const n={data:t.data,id:t.id,showsPopup:t.showsPopup};var i=TC.Util.explodeGeometry(t.geom);switch(t.type){case TC.Consts.geom.POLYLINE:r[e]=new TC.feature.Polyline(i,n);break;case TC.Consts.geom.MULTIPOLYLINE:r[e]=new TC.feature.MultiPolyline(i,n);break;case TC.Consts.geom.MARKER:r[e]=new TC.feature.Marker(i,n);break;case TC.Consts.geom.POINT:r[e]=new TC.feature.Point(i,n)}});Promise.all(r).then(function(r){var n={features:r,fileName:t.trackName,notReproject:!0,isShared:!0};e.availableTracks?e.importTrack(n):e.getStoredTracks().then(function(){e.importTrack(n)})})}}}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");!function(){TC.control.GeometryFeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.GeometryFeatureInfo(this);this.lineColor=this.options.lineColor?this.options.lineColor:"#cc0000";this._isDrawing=!1;this._isSearching=!1;this._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.GeometryFeatureInfo.prototype;t.register=function(t){const e=this,r=TC.control.FeatureInfoCommons.prototype.register.call(e,t);e.on(TC.Consts.event.CONTROLDEACTIVATE,function(t){e.wrap.cancelDraw()});return r};t.callback=function(t,e){var r=this;if(!r._drawToken){r.closeResults();for(var n=!1,i=0;i<r.map.workLayers.length;i++){var o=r.map.workLayers[i];if(o.type===TC.Consts.layerType.WMS&&o.getVisibility()&&o.names.length>0){n=!0;break}}if(n){r.closeResults();r.wrap.beginDraw({geometryType:r.geometryType,xy:t,layer:r.filterLayer,callback:function(t){r.wrap.getFeaturesByGeometry(t)}})}}};t.responseCallback=function(t){var e=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(e,t);if(e.filterFeature){for(var r=t.services,n=0;n<r.length;n++){var i=r[n];if(i.hasLimits){delete i.layers;i.hasLimits=i.hasLimits}else{for(var o=0;o<i.layers.length;o++)if(!i.layers[o].features.length){i.layers.splice(o,1);o-=1}if(!i.layers.length){r.splice(n,1);n-=1}}}e.renderData(t,function(){r.length&&e.insertLinks();e.displayResults()})}}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var t=TC.control.LayerCatalog.prototype;t.CLASS="tc-ctl-lcat";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";t.template[t.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";t.template[t.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";t.template[t.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/LayerCatalogDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"availableLayers"}).x(e.get(["enableSearch"],!1),e,{block:r},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",e,{},{$key:"textToSearchInLayers"}).w('"></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(e.get(["layerTrees"],!1),e,{else:o,block:c},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",e,e.rebase(e.getPath(!0,[])),{}).w("</div>")}e.__dustBody=!0;function r(t,e){return t.x(e.get(["layerTrees"],!1),e,{block:n},{}).x(e.get(["layers"],!1),e,{block:i},{})}r.__dustBody=!0;function n(t,e){return t.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",e,{},{$key:"searchLayersByText"}).w('"></button>')}n.__dustBody=!0;function i(t,e){return t.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",e,{},{$key:"searchLayersByText"}).w('"></button>')}i.__dustBody=!0;function o(t,e){return t.x(e.get(["layers"],!1),e,{else:a,block:s},{})}o.__dustBody=!0;function a(t,e){return t.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",e,{},{$key:"loadingLayerTree"}).w("...</span></div>")}a.__dustBody=!0;function s(t,e){return t.w('<ul class="tc-ctl-lcat-branch">').s(e.get(["layers"],!1),e,{block:l},{}).w("</ul>")}s.__dustBody=!0;function l(t,e){return t.w('<li data-layer-id="').f(e.get(["id"],!1),e,"h").w('" title="').h("i18n",e,{},{$key:"loadingLayers"}).w('" class="tc-ctl-lcat-loading-node"> ').f(e.get(["title"],!1),e,"h").w("</li>")}l.__dustBody=!0;function c(t,e){return t.w('<ul class="tc-ctl-lcat-branch">').s(e.get(["layerTrees"],!1),e,{block:u},{}).w("</ul>")}c.__dustBody=!0;function u(t,e){return t.p("tc-ctl-lcat-branch",e,e.rebase(e.getPath(!0,[])),{})}u.__dustBody=!0;return e};t.template[t.CLASS+"-branch"]=function(){dust.register(t.CLASS+"-branch",e);function e(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:r,block:n},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><button class="tc-ctl-lcat-collapse-btn"></button><span>').f(e.get(["title"],!1),e,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:i},{}).w("</ul></li>")}e.__dustBody=!0;function r(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}n.__dustBody=!0;function i(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}i.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.x(e.get(["isVisible"],!1),e,{block:r},{})}e.__dustBody=!0;function r(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:i},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('">').x(e.get(["children"],!1),e,{block:o},{}).w('<span data-tooltip="').x(e.get(["name"],!1),e,{block:a},{}).w('">').f(e.get(["title"],!1),e,"h").w("</span>").x(e.get(["name"],!1),e,{block:s},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(e.get(["children"],!1),e,{block:l},{}).w("</ul></li>")}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}n.__dustBody=!0;function i(t,e){return t.w('class="tc-ctl-lcat-node tc-collapsed"')}i.__dustBody=!0;function o(t,e){return t.w('<button class="tc-ctl-lcat-collapse-btn"></button>')}o.__dustBody=!0;function a(t,e){return t.h("i18n",e,{},{$key:"clickToAddToMap"})}a.__dustBody=!0;function s(t,e){return t.w('<button title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('" class="tc-ctl-lcat-btn-info"></button>')}s.__dustBody=!0;function l(t,e){return t.p("tc-ctl-lcat-node",e,e.rebase(e.getPath(!0,[])),{})}l.__dustBody=!0;return e};t.template[t.CLASS+"-info"]=function(){dust.register(t.CLASS+"-info",e);function e(t,e){return t.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",e,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(e.get(["title"],!1),e,"h").w("</h3>").x(e.get(["abstract"],!1),e,{block:r},{}).x(e.get(["metadata"],!1),e,{block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",e,{},{$key:"abstract"}).w("</h4><div><pre>").f(e.get(["abstract"],!1),e,"h",["s"]).w("</pre></div></div>")}r.__dustBody=!0;function n(t,e){return t.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",e,{},{$key:"metadata"}).w("</h4><ul>").s(e.get(["metadata"],!1),e,{block:i},{}).w("</ul></div>")}n.__dustBody=!0;function i(t,e){return t.w('<li><a href="').f(e.get(["url"],!1),e,"h",["s"]).w('" type="').f(e.get(["format"],!1),e,"h").w('" title="').f(e.get(["formatDescription"],!1),e,"h").w('" target="_blank">').f(e.get(["formatDescription"],!1),e,"h",["s"]).w("</a></li>")}i.__dustBody=!0;return e};t.template[t.CLASS+"-results"]=function(){dust.register(t.CLASS+"-results",e);function e(t,e){return t.s(e.get(["servicesFound"],!1),e,{else:r,block:n},{})}e.__dustBody=!0;function r(t,e){return t.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",e,{},{$key:"noMatches"}).w("</h5></li>")}r.__dustBody=!0;function n(t,e){return t.h("gt",e,{block:i},{key:e.get(["servicesLooked"],!1),value:1}).s(e.get(["founds"],!1),e,{block:a},{}).h("gt",e,{block:u},{key:e.get(["servicesLooked"],!1),value:1})}n.__dustBody=!0;function i(t,e){return t.w('<li class="tc-ctl-lcat-search-group ').x(e.getPath(!1,["service","isCollapsed"]),e,{block:o},{}).w('" data-service-index="').f(e.getPath(!1,["service","index"]),e,"h").w('"><h5>').f(e.getPath(!1,["service","title"]),e,"h").w("</h5><ul>")}i.__dustBody=!0;function o(t,e){return t.w("tc-collapsed")}o.__dustBody=!0;function a(t,e){return t.w('<li data-layer-name="').f(e.get(["Name"],!1),e,"h").w('" ').x(e.get(["alreadyAdded"],!1),e,{block:s},{}).w('><h5 class="tc-selectable"').x(e.get(["alreadyAdded"],!1),e,{else:l,block:c},{}).w(">").f(e.get(["Title"],!1),e,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" title="').h("i18n",e,{},{$key:"infoFromThisLayer"}).w('"></button></li>')}a.__dustBody=!0;function s(t,e){return t.w(' class="tc-checked"')}s.__dustBody=!0;function l(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"clickToAddToMap"}).w('"')}l.__dustBody=!0;function c(t,e){return t.w(' data-tooltip="').h("i18n",e,{},{$key:"layerAlreadyAdded"}).w('"')}c.__dustBody=!0;function u(t,e){return t.w("</ul></li>")}u.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",e,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}const e=function(t,e){t.showProjectionChangeDialog({layer:e,closeCallback:function(){t.getLayerNodes(e).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap")})}})};t.register=function(t){const e=this,r=TC.control.ProjectionSelector.prototype.register.call(e,t),o=function(t,r){if(Array.isArray(e.options.layers)){for(var n=0;n<e.options.layers.length;n++){var i=e.options.layers[n];if(!i.type||i.type===TC.Consts.layerType.WMS){i.id||(i.id=TC.getUID());TC.Util.isPlainObject(i)&&(i=new TC.layer.Raster(i));e.layers.push(i)}}e.render(function(){t()})}else t()};e._readyPromise=new Promise(function(e,r){const n=function(r){if(r.layer===t.baseLayer){o(e);t.off(TC.Consts.event.LAYERUPDATE,n)}};t.loaded(function(){t.baseLayer.state&&t.baseLayer.state!==TC.Layer.state.IDLE?t.on(TC.Consts.event.LAYERUPDATE,n):o(e)})});var a=e.getLocaleString("clickToAddToMap");t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(t){e.getLayerNodes(t.layer).forEach(function(t){t.classList.add(TC.Consts.classes.LOADING);delete t.querySelector("span").dataset.tooltip})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(t){const r=t.layer;r.isBase||r.type!==TC.Consts.layerType.WMS||e.loaded().then(function(){if(e.getLayerRootNode(r))i.call(e,r);else{for(var t=!1,n=0,o=e.layers.length;n<o;n++){var a=e.layers[n];if(a.type===r.type&&a.options.url===r.options.url){t=!0;break}}if(t){e.layersToSetChecked||(e.layersToSetChecked=[]);e.layersToSetChecked.push(r)}else e.addLayer(new TC.layer.Raster({url:r.options.url,type:r.type,layerNames:[],title:r.title||r.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){i.call(e,r)})}})}).on(TC.Consts.event.LAYERERROR,function(t){const r=t.reason;r&&TC.alert(e.getLocaleString(r,{url:t.layer.url}));e.getLayerNodes(t.layer).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING)})}).on(TC.Consts.event.LAYERREMOVE,function(t){const r=t.layer;e.getLayerNodes(r).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=a});(function(t){const r=[];if(!t.isBase){var n=t.options.url;e.list&&e.list.querySelectorAll("li").forEach(function(i){const o=e.getLayer(i.dataset.layerId);if(o&&o.type===t.type&&o.options.url===n)for(var a=0;a<t.names.length;a++)if(i.dataset.layerName===t.names[a]){r.push(i);break}})}return r})(r).forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED);t.querySelector("h5").dataset.tooltip=a});!function(t){var r=e.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(r)for(var n=r.layers,i=0;i<n.length;i++){var o=n[i];o!==t&&e.getLayerNodes(o).forEach(function(t){t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")})}}(r);n.call(e)}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){if(t&&t.layer){e.addLayer(t.layer);e.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.update()});return r};const r=function(t){t.target.blur();t.stopPropagation();const e=t.target.parentElement;if("LI"===e.tagName&&!e.classList.contains(self.CLASS+"-leaf")){e.classList.toggle(TC.Consts.classes.COLLAPSED);e.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED)}},n=function(){const t=this;if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);t.textInput&&t.textInput.dispatchEvent(e)}else t.textInput&&t.textInput.fireEvent("keyup")},i=function(t){const e=this;e.getLayerNodes(t).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.classList.add(TC.Consts.classes.CHECKED);t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")});n.call(e)},o=function(t,e){const n=this;t.querySelectorAll("li > button."+n.CLASS+"-collapse-btn").forEach(function(t){t.addEventListener("click",r)});t.querySelectorAll("span").forEach(function(t){t.addEventListener("click",function(t){!function(t,e){const r=t.target.parentNode;if(!r.classList.contains(TC.Consts.classes.LOADING)&&!r.classList.contains(TC.Consts.classes.CHECKED)){t.preventDefault;var n,i=r.dataset.layerName;i=void 0!==i?i.toString():"";for(var o=0,a=e._roots.length;o<a;o++){const t=e._roots[o];if(t.contains(r)){n=e.getLayer(t.dataset.layerId);break}}n||(n=e.getLayer(r.dataset.layerId));if(n&&i){var s=1;/iPad/i.test(navigator.userAgent)?s=10:TC.Util.detectFirefox()&&(s=250);n.title||(n.title=n.getTree().title);r.classList.add(TC.Consts.classes.LOADING);r.querySelector("span").dataset.tooltip="";(l=r,new Promise(function(t,e){setTimeout(function(){l.offsetHeight=l.offsetHeight;l.offsetWidth=l.offsetWidth;t()},s)})).then(function(){e.addLayerToMap(n,i)});t.stopPropagation()}}var l}(t,n)})});n._roots=n.div.querySelectorAll(n._selectors.LAYER_ROOT);t.dataset.layerId=e.id;t.querySelectorAll("."+n.CLASS+"-btn-info").forEach(function(t){const r=t.parentElement.querySelector("span"),i=t.parentElement.dataset.layerName;if(i){r.classList.add(TC.Consts.classes.SELECTABLE);var o=e.wrap.getInfo(i);o.hasOwnProperty("abstract")||o.hasOwnProperty("legend")||o.hasOwnProperty("metadata")?t.addEventListener(TC.Consts.event.CLICK,function(t){t.stopPropagation();this.classList.toggle(TC.Consts.classes.CHECKED)?n.showLayerInfo(e,i):n.hideLayerInfo()}):t.parentElement.removeChild(t);if(e.compatibleLayers&&e.compatibleLayers.indexOf(i)<0){r.classList.add(TC.Consts.classes.INCOMPATIBLE);r.setAttribute("title",n.getLocaleString("reprojectionNeeded"))}if(n.map)for(var a=0,s=n.map.workLayers.length;a<s;a++){var l=n.map.workLayers[a];if(l.type===TC.Consts.layerType.WMS&&l.url===e.url&&1===l.names.length&&l.names[0]===i){r.parentElement.classList.add(TC.Consts.classes.CHECKED);r.dataset.tooltip=n.getLocaleString("layerAlreadyAdded")}}}else{r.dataset.tooltip="";t.parentElement.removeChild(t)}});(function(){const t=this;t.layersToSetChecked&&t.layersToSetChecked.length>0&&t.layersToSetChecked.forEach(function(e,r,n){if(t.getLayerRootNode(e)){i.call(t,e);n.splice(r,1)}})}).call(n);n.getRenderedHtml(n.CLASS+"-dialog",null,function(t){n._dialogDiv.innerHTML=t})};t.renderBranch=function(t,e,r){const n=this;t.getCapabilitiesPromise().then(function(i){n.sourceLayers.push(t);n.getRenderedHtml(n.CLASS+"-branch",function(t){var e=t.getTree();!function e(r){for(var n=!1,i=0;i<r.children.length;i++)e(r.children[i])&&(n=!0);r.hasOwnProperty("isVisible")&&(r.isVisible=!t.names||!t.names.length||n||r.isVisible);return r.isVisible}(e);return e}(this),function(t){var i=document.createElement("template");i.innerHTML=t;var a=i.content?i.content.firstChild:i.firstChild,s=n.div.querySelector("."+n.CLASS+"-branch").querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');s?n.div.querySelector("."+n.CLASS+"-branch").replaceChild(a,s):n.div.querySelector("."+n.CLASS+"-branch").appendChild(a);o.call(n,a,this);1===n.div.querySelector("."+n.CLASS+"-branch").childElementCount&&r();TC.Util.isFunction(e)&&e(n.sourceLayers[n.sourceLayers.map(function(t){return t.id}).indexOf(this.id)])}.bind(this))}.bind(t)).catch(function(t){var e=n.layers.map(function(t){return t.id}).indexOf(this.id);n.layers.splice(e,1);var r=n.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:this.title}),i=n.div.querySelector("."+n.CLASS+"-branch").querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');i.classList.add("error");i.setAttribute("title",r);n.map.toast(r,{type:TC.Consts.msgType.ERROR})}.bind(t))};t.render=function(t){const r=this;r.sourceLayers=[];return r._set1stRenderPromise(new Promise(function(n,i){0===r.layers.length?r.renderData({layerTrees:[],enableSearch:!1},function(){TC.Util.isFunction(t)&&t();n()}):r.renderData({layers:r.layers,enableSearch:!0},function(){(function(){const t=this;t.textInput=t.div.querySelector("."+t.CLASS+"-input");t.list=t.div.querySelector("."+t.CLASS+"-search ul");t.textInput.addEventListener("mouseup",function(e){""!==t.textInput.value&&setTimeout(function(){""===t.textInput.value&&(t.list.innerHTML="")},1)});var r=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(t.textInput,{link:"#",target:t.list,minLength:0,source:function(e,n){r=[];t._roots.forEach(function(t){t.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(t){r.push(t.dataset.layerName)})});if((e=e.trim()).length<3)t.list.innerHTML="";else if(e.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var r=[],i=0;i<t.sourceLayers.length;i++){var o=t.sourceLayers[i].searchSubLayers(e);o.length&&r.push({service:{index:i,title:t.sourceLayers[i].title||t.sourceLayers[i].id},founds:o})}n({servicesFound:r,servicesLooked:t.sourceLayers.length})},TC._search.interval)}},callback:function(e){t.textInput.value=e.target.text||e.target.innerText;TC._search.lastPattern=t.textInput.value;t.goToResult(unescape(e.target.hash).substring(1));TC.UI.autocomplete.call(t.textInput,"clear")},buildHTML:function(e){if(e.results&&e.results.servicesFound.length>0)for(var n=t.map.getLayerTree().workLayers,i=0;i<e.results.servicesFound.length;i++){for(var o=e.results.servicesFound[i].founds,a=0;a<o.length;a++){delete o[a].alreadyAdded;for(var s=0;s<n.length;s++)if(r.indexOf(o[a].Name)>=0){o[a].alreadyAdded=!0;break}if(!o[a].Name){o.splice(a,1);a--}}e.results.servicesFound[i].founds.length?t.div.querySelectorAll(".tc-ctl-lcat-search-group")[i]&&(e.results.servicesFound[i].service.isCollapsed=t.div.querySelectorAll(".tc-ctl-lcat-search-group")[i].classList.contains(TC.Consts.classes.COLLAPSED)):e.results.servicesFound.splice(i,1)}var l="";dust.render(t.CLASS+"-results",e.results,function(t,e){l=e});return l}})});if(!t.searchInit){t.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2 button",function(e){const r=t.div.classList.contains(TC.Consts.classes.COLLAPSED);t.div.classList.remove(TC.Consts.classes.COLLAPSED);const n=t.div.querySelector("."+t.CLASS+"-search"),i=t.div.querySelector("."+t.CLASS+"-tree"),o=t.div.querySelector("."+t.CLASS+"-info"),a=!(!n.classList.contains(TC.Consts.classes.HIDDEN)&&!r);n.classList.toggle(TC.Consts.classes.HIDDEN,!a);i.classList.toggle(TC.Consts.classes.HIDDEN,a);e.target.classList.toggle(t.CLASS+"-btn-tree",a);e.target.classList.toggle(t.CLASS+"-btn-search",!a);if(a){t.textInput.focus();e.target.setAttribute("title",t.getLocaleString("viewAvailableLayersTree"));0===t.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&o.classList.add(TC.Consts.classes.HIDDEN)}else{e.target.setAttribute("title",t.getLocaleString("searchLayersByText"));t.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&o.classList.remove(TC.Consts.classes.HIDDEN)}}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+t.CLASS+"-search button."+t.CLASS+"-search-btn-info",function(e){e.stopPropagation();const r=e.target;if(r.classList.contains(TC.Consts.classes.CHECKED)){r.classList.remove(TC.Consts.classes.CHECKED);t.hideLayerInfo()}else{const e=r.parentElement;var n=e;do{n=n.parentElement}while(n&&"LI"!==n.tagName);t.showLayerInfo(t.layers.length>1?t.layers[n.dataset.serviceIndex]:t.layers[0],e.dataset.layerName);r.classList.add(TC.Consts.classes.CHECKED)}}));const r="."+t.CLASS+"-search li";t.div.addEventListener("click",TC.EventTarget.listenerBySelector(r,function(n){n.stopPropagation();for(var i=n.target;i&&!i.matches(r);)i=i.parentElement;if(!i.classList.contains(t.CLASS+"-no-results"))if(i.classList.contains(t.CLASS+"-search-group"))i.classList.toggle(TC.Consts.classes.COLLAPSED);else{var o=i.dataset.layerName;if(o&&0!==(o=o.toString()).trim().length&&!i.classList.contains(TC.Consts.classes.CHECKED)){var a=i;do{a=a.parentElement}while(a&&!a.matches("li."+t.CLASS+"-search-group"));const r=a?a.dataset.serviceIndex:0,n=t.layers[r].options.url,s=t.layers[r].title,l=new TC.layer.Raster({id:t.getUID(),url:n,title:s,hideTitle:t.layers[r].hideTitle||t.layers[r].options.hideTitle,hideTree:!1,layerNames:[o]});if(l.isCompatible(t.map.crs)){t.map.addLayer(l,function(t){i.dataset.layerId=t.id;t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)})});i.classList.add(TC.Consts.classes.CHECKED);i.querySelector("h5").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")}else e(t,l)}}}));t.searchInit=!0}}).call(r);r.layers.forEach(function(e){r.renderBranch(e,t,n)})})}))};t.getLayerRootNode=function(t){const e=this;var r=null;if(!t.isBase){var n=t.options.url;e._roots&&e._roots.forEach(function(i){const o=e.getLayer(i.dataset.layerId);o&&o.type===t.type&&o.options.url===n&&(r=i)})}return r};t.getLayerNodes=function(t){const e=[],r=this.getLayerRootNode(t);if(r)for(var n=0;n<t.names.length;n++){const i=r.querySelector('li[data-layer-name="'+t.names[n]+'"]');if(i){e[e.length]=i;i.querySelectorAll("li").forEach(function(t){e[e.length]=t})}}return e};t.showLayerInfo=function(t,e){const r=this;var n=null,i=r.div.querySelector("."+r.CLASS+"-info");const o=function(t,e){var n=!1;if(e){n=!0;i.dataset.layerName=t;i.classList.remove(TC.Consts.classes.HIDDEN);dust.render(r.CLASS+"-info",e,function(t,e){i.innerHTML=e;t&&TC.error(t);i.querySelector("."+r.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){r.hideLayerInfo()})})}return n};r.div.querySelectorAll("."+r.CLASS+"-btn-info, ."+r.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});const a={};for(var s=0,l=r._roots.length;s<l;s++){const i=r._roots[s];if(i.dataset.layerId===t.id){const s=i.querySelectorAll("."+r.CLASS+"-btn-info");for(var c=0,u=s.length;c<u;c++){var h=s[c].parentElement.dataset.layerName;if(h===e){const i=t.wrap.getInfo(e);i.metadata&&i.metadata.forEach(function(t){t.formatDescription=a[t.format]=a[t.format]||r.getLocaleString(TC.Util.getSimpleMimeType(t.format))||r.getLocaleString("viewMetadata")});r.div.querySelector('li [data-layer-name="'+h+'"] > button.'+r.CLASS+"-btn-info").classList.toggle(TC.Consts.classes.CHECKED,o(h,i));n=i;break}}break}}return n};t.update=function(){const t=this;t.sourceLayers.forEach(function(e){e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);const r=t.getLayerRootNode(e);r&&r.querySelectorAll("li[data-layer-name]").forEach(function(r){const n=r.dataset.layerName,i=r.querySelector("span."+TC.Consts.classes.SELECTABLE);if(e.compatibleLayers.indexOf(n)<0){i.classList.add(TC.Consts.classes.INCOMPATIBLE);i.setAttribute("title",t.getLocaleString("reprojectionNeeded"))}else{i.classList.remove(TC.Consts.classes.INCOMPATIBLE);i.removeAttribute("title")}})})})};t.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(t){t.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};t.addLayer=function(t){const e=this;return new Promise(function(r,n){var i=[];e.options.layers&&e.options.layers.length&&(i=e.options.layers.filter(function(e){var r=TC.Util.reqGetMapOnCapabilities(e.url);return r&&r.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));0==i.length&&(i=e.layers.filter(function(e){return e.url.replace(TC.Util.regex.PROTOCOL)==t.url.replace(TC.Util.regex.PROTOCOL)}));if(0==i.length){e.layers.push(t);t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);t.title=t.title||t.wrap.getServiceTitle();e.renderBranch(t,function(){r()})})}else r()})};t.getLayer=function(t){const e=this;for(var r=0,n=e.layers.length;r<n;r++){const n=e.layers[r];if(n.id===t){var i=e.options.layers.filter(e=>e.id===t);i.length>0?n.hideTitle=n.options.hideTitle=i[0].hideTitle:n.hideTitle=n.options.hideTitle=!1;return n}}return null};t.addLayerToMap=function(t,r){const n=this,i=TC.Util.extend({},t.options);i.id=n.getUID();i.layerNames=[r];i.title=t.title;const o=new TC.layer.Raster(i);o.isCompatible(n.map.crs)?n.map.addLayer(i).then(function(t){t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(t){var e=this.parent;401!==t.error.code&&403!==t.error.code||e.map.toast(t.error.text,{type:TC.Consts.msgType.ERROR});e.map.removeLayer(e)})}):e(n,o)};t.loaded=function(){return this._readyPromise};t.getAvailableCRS=function(t){t=t||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,t.layer),includeFallbacks:!0})};t.setProjection=function(t){const e=this;t=t||{};TC.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t).then(function(){e._layerToAdd&&e.map.addLayer(e._layerToAdd);TC.Util.closeModal()})}})};t.showProjectionChangeDialog=function(t){this._layerToAdd=t.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,t)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var t=TC.control.Legend.prototype;t.CLASS="tc-ctl-legend";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Legend.html";t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(e.get(["workLayers"],!1),e,{else:r,block:n},{}).w("</ul></div>")}e.__dustBody=!0;function r(t,e){return t.w('<li class="tc-ctl-legend-empty">').h("i18n",e,{},{$key:"noData"}).w("</li>")}r.__dustBody=!0;function n(t,e){return t.p("tc-ctl-legend-node",e,e.rebase(e.getPath(!0,[])),{})}n.__dustBody=!0;return e};t.template[t.CLASS+"-node"]=function(){dust.register(t.CLASS+"-node",e);function e(t,e){return t.x(e.get(["customLegend"],!1),e,{else:r,block:p},{})}e.__dustBody=!0;function r(t,e){return t.w("<li ").x(e.get(["children"],!1),e,{else:n,block:i},{}).w(' data-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><div class="tc-ctl-legend-title">').f(e.get(["title"],!1),e,"h").w("</div>").x(e.get(["legend"],!1),e,{block:o},{}).w('<ul class="tc-ctl-legend-branch">').s(e.get(["children"],!1),e,{block:h},{}).w("</ul></li>")}r.__dustBody=!0;function n(t,e){return t.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}n.__dustBody=!0;function i(t,e){return t.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function o(t,e){return t.w('<div class="tc-ctl-legend-watch">').x(e.getPath(!1,["legend","src"]),e,{else:a,block:c},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",e,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}o.__dustBody=!0;function a(t,e){return t.x(e.getPath(!1,["legend","width"]),e,{block:s},{})}a.__dustBody=!0;function s(t,e){return t.w('<div class="tc-ctl-legend-img" style="border:solid ').f(e.getPath(!1,["legend","strokeWidth"]),e,"h").w("px ").f(e.getPath(!1,["legend","strokeColor"]),e,"h").w(";background-color:").f(e.getPath(!1,["legend","fillColor"]),e,"h").x(e.getPath(!1,["legend","width"]),e,{block:l},{}).w('"></div>')}s.__dustBody=!0;function l(t,e){return t.w(";width:").f(e.getPath(!1,["legend","width"]),e,"h").w("px;height:").f(e.getPath(!1,["legend","height"]),e,"h").w("px;border-radius:50%")}l.__dustBody=!0;function c(t,e){return t.w('<img src="" data-img="').f(e.getPath(!1,["legend","src"]),e,"h").w('" ').x(e.getPath(!1,["legend","width"]),e,{block:u},{}).w(" />")}c.__dustBody=!0;function u(t,e){return t.w('style="width:').f(e.getPath(!1,["legend","width"]),e,"h").w("px;height:").f(e.getPath(!1,["legend","height"]),e,"h").w('px;" ')}u.__dustBody=!0;function h(t,e){return t.p("tc-ctl-legend-node",e,e.rebase(e.getPath(!0,[])),{})}h.__dustBody=!0;function p(t,e){return t.f(e.get(["customLegend"],!1),e,"h",["s"])}p.__dustBody=!0;return e}}t.register=function(t){const e=this;t.on(TC.Consts.event.VIEWCHANGE,function(r){const n=r.view,i=e.loadGraphics.bind(e);n===TC.Consts.view.THREED?t.on(TC.Consts.event.LAYERADD,i):n===TC.Consts.view.DEFAULT&&t.off(TC.Consts.event.LAYERADD,i)});return TC.control.MapContents.prototype.register.call(e,t)};t.loadGraphics=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);r&&e.querySelectorAll("li."+t.CLASS+"-node-visible").forEach(function(e){const n=e.querySelector("img");n&&void 0!==n.getAttribute("src")&&0===n.getAttribute("src").length&&t.styleLegendImage(n,r)})})};t.updateScale=function(){const t=this,e=t.CLASS+"-node-inscale",r=t.CLASS+"-node-outofscale";t.getLayerUIElements().forEach(function(n){const i=t.map.getLayer(n.dataset.layerId);if(i){var o=!1;n.querySelectorAll("li").forEach(function(n){if(n.classList.contains(t.CLASS+"-node-visible")){const a=n.dataset.layerUid;if(i.isVisibleByScale(a)){o=!0;n.classList.remove(r);n.classList.add(e);const a=n.querySelector("img");a&&t.styleLegendImage(a,i)}else{n.classList.add(r);n.classList.remove(e)}}});n.classList.toggle(e,o);n.classList.toggle(r,!o)}})};t.update=function(){const t=this;t.getLayerUIElements().forEach(function(e){const r=t.map.getLayer(e.dataset.layerId);if(r){r.getTree();e.querySelectorAll("li").forEach(function(e){const n=e.dataset.layerUid;var i=t.CLASS+"-node-visible",o=t.CLASS+"-node-notvisible",a=t.CLASS+"-node-hasvisible";switch(r._cache.visibilityStates[n]){case TC.Consts.visibility.NOT_VISIBLE:e.classList.remove(i,a);e.classList.add(o);break;case TC.Consts.visibility.HAS_VISIBLE:e.classList.remove(i,o);e.classList.add(a);break;default:e.classList.remove(o,a);e.classList.add(i)}});t.updateLayerVisibility(r)}});t.updateScale()};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){if(t.hideTree||t.options.hideTree){t.tree=null;t.hideTree=t.options.hideTree=!1;t._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(e.CLASS+"-node",e.layerTrees[t.id],function(r,n){const i=(new DOMParser).parseFromString(n,"text/html").body.firstChild,o=i.dataset.layerUid,a=e.div.querySelector("ul."+e.CLASS+"-branch"),s=a.querySelectorAll('li[data-layer-uid="'+o+'"]');if(1===s.length){const t=s[0];t.innerHTML=i.innerHTML;t.setAttribute("class",i.getAttribute("class"))}else{i.dataset.layerId=t.id;a.insertBefore(i,a.firstChild)}r&&TC.error(r)});e.update()})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(r){r.dataset.layerId===t.id&&r.classList.toggle(e.CLASS+"-node-notvisible",!t.getVisibility())})};t.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYLINE};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.LineFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.control.WorkLayerManager||TC.syncLoadJS(TC.apiLocation+"TC/control/WorkLayerManager");TC.control.ListTOC=TC.control.WorkLayerManager;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){const t=this;TC.Control.apply(t,arguments);t._waits={};window.addEventListener("error",function(){t.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var t=TC.control.LoadingIndicator.prototype;t.CLASS="tc-ctl-load";TC.isDebug?t.template=TC.apiLocation+"TC/templates/LoadingIndicator.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}e.__dustBody=!0;return e};t.startWait=function(t){const e=this,r=t.layer.id;void 0===e._waits[r]&&(e._waits[r]=0);e._waits[r]=e._waits[r]+1;e.show();e.map.trigger(TC.Consts.event.STARTLOADING)};t.stopWait=function(t){const e=this,r=t.layer.id;var n=e._waits[r];n>0&&(n=e._waits[r]=n-1);n||delete e._waits[r];var i=0;for(var o in e._waits)i++;if(!i){e.hide();e.map.trigger(TC.Consts.event.STOPLOADING)}};t.endWait=function(t){const e=this,r=t.layer.id;e._waits[r]>0&&delete e._waits[r];var n=0;for(var i in e._waits)n++;if(!n){e.hide();e.map.trigger(TC.Consts.event.STOPLOADING)}};t.reset=function(t){this._waits={};this.hide();this.map.trigger(TC.Consts.event.STOPLOADING)};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(t){e.startWait(t)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(t){e.stopWait(t)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(){e.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(){e.removeWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.LAYERREMOVE,function(t){e.endWait(t)});TC.isDebug||window.addEventListener("error",function(t,r,n,i,o){e.reset();return!1});return r};t.addWait=function(t){const e=t||TC.getUID();this.startWait({layer:{id:e}});return e};t.removeWait=function(t){this.stopWait({layer:{id:t}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featuresselect.tc";TC.Consts.event.FEATURESUNSELECT="featuresunselect.tc";TC.Consts.event.CHANGE="change";!function(){TC.control.Modify=function(){TC.Control.apply(this,arguments);if(!TC.browserFeatures.inputTypeColor()&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}this.styles=TC.Util.extend(!0,TC.Cfg.styles.selection,this.options.styles);this.styles.text=this.styles.text||{fontSize:this.styles.line.fontSize,fontColor:this.styles.line.fontColor,labelOutlineColor:this.styles.line.labelOutlineColor,labelOutlineWidth:this.styles.line.labelOutlineWidth};this._classSelector="."+this.CLASS;this.wrap=new TC.wrap.control.Modify(this)};TC.inherit(TC.control.Modify,TC.Control);var t=TC.control.Modify.prototype;t.CLASS="tc-ctl-mod";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Modify.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="').h("i18n",e,{},{$key:"select"}).w('">').h("i18n",e,{},{$key:"select"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="').h("i18n",e,{},{$key:"deleteSelection"}).w('">').h("i18n",e,{},{$key:"deleteSelection"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="').h("i18n",e,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",e,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="').h("i18n",e,{},{$key:"splitGeometry"}).w('">').h("i18n",e,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="').h("i18n",e,{},{$key:"addText"}).w('">').h("i18n",e,{},{$key:"addText"}).w('</button><div class="tc-ctl-mod-style tc-hidden"><input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="').h("i18n",e,{},{$key:"writeTextForSketch"}).w('" style="font-size:').f(e.get(["fontSize"],!1),e,"h").w("pt;font-color:").f(e.get(["fontColor"],!1),e,"h").w(";text-shadow: 0 0 ").f(e.get(["labelOutlineWidth"],!1),e,"h").w("px ").f(e.get(["labelOutlineColor"],!1),e,"h").w(';" />').h("i18n",e,{},{$key:"textColor"}).w('<input type="color" class="tc-ctl-mod-fnt-c" value="').f(e.get(["fontColor"],!1),e,"h").w('" />').h("i18n",e,{},{$key:"fontSize"}).w('<input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="').f(e.get(["fontSize"],!1),e,"h").w('" min="7" max="20" /></div>')}e.__dustBody=!0;return e};const e=function(t,e){t._deleteBtn.disabled=0===e.length;t._joinBtn.disabled=e.length<2;t._splitBtn.disabled=0===e.filter(r).length;t.displayLabelText()},r=function(t){var e=!1;(TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)&&t.geometry.length>1&&(e=!0);return e};t.register=function(t){const r=this,n=TC.Control.prototype.register.call(r,t);if(r.options.layer){r.setLayer(r.options.layer);t.on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(t){Promise.all([r.getLayer(),r.renderPromise()]).then(function(e){const n=e[0];if(t.layer===n){r._selectBtn.disabled=!1;r._textBtn.disabled=!1}})}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){const n=t.layer,i=t.feature;Promise.all([r.getLayer(),r.renderPromise()]).then(function(t){if(n===t[0]){i?r.unselectFeatures([i]):r.unselectFeatures();e(r,r.getSelectedFeatures());if(0===r.layer.features.length){r._selectBtn.disabled=!0;r.setTextMode(!1);r._textBtn.disabled=!0}}})});const n=function(){const t=r.getSelectedFeatures();e(r,t);r.layer.features.filter(function(e){return t.indexOf(e)<0}).forEach(function(t){t.toggleSelectedStyle(!1)});t.forEach(function(t){t.toggleSelectedStyle(!0)})};r.on(TC.Consts.event.FEATURESSELECT,n).on(TC.Consts.event.FEATURESUNSELECT,n)}return n};t.render=function(t){const e=this,r=function(){e._selectBtn=e.div.querySelector("."+e.CLASS+"-btn-select");e._selectBtn.addEventListener(TC.Consts.event.CLICK,function(t){t.target.disabled||(e.isActive?e.deactivate():e.activate())});e._deleteBtn=e.div.querySelector("."+e.CLASS+"-btn-delete");e._deleteBtn.addEventListener(TC.Consts.event.CLICK,function(){e.deleteSelectedFeatures()});e._textBtn=e.div.querySelector("."+e.CLASS+"-btn-text");e._textBtn.addEventListener(TC.Consts.event.CLICK,function(){e.setTextMode(!e.textActive)});e._joinBtn=e.div.querySelector("."+e.CLASS+"-btn-join");e._splitBtn=e.div.querySelector("."+e.CLASS+"-btn-split");e._textInput=e.div.querySelector("input."+e.CLASS+"-txt");e._textInput.addEventListener("input",function(t){e.labelFeatures(t.target.value)});e._styleSection=e.div.querySelector("."+e.CLASS+"-style");e._fontColorPicker=e.div.querySelector(e._classSelector+"-fnt-c");e._fontColorPicker.addEventListener(TC.Consts.event.CHANGE,function(t){e.setFontColor(t.target.value)});e._fontSizeSelector=e.div.querySelector("."+e.CLASS+"-fnt-s");e._fontSizeSelector.addEventListener(TC.Consts.event.CHANGE,function(t){e.setFontSize(t.target.value)});TC.Util.isFunction(t)&&t()},n={fontSize:e.styles.text.fontSize,fontColor:e.styles.text.fontColor,labelOutlineColor:e.styles.text.labelOutlineColor,labelOutlineWidth:e.styles.text.labelOutlineWidth};return TC.browserFeatures.inputTypeColor()?e._set1stRenderPromise(e.renderData(n,r)):e._set1stRenderPromise(e.renderData(n,function(){const t=e.div.querySelector("input[type=color]");t.style.backgroundColor=t.value;t.style.color="transparent";const n=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()};t.onfocus=function(t){this.blur()};t.onchange=function(t){this.style.backgroundColor=this.value};e.map.loaded(function(){n.on("change",function(t){e.setFontColor("#"+t)})});r()}))};t.activate=function(){this._selectBtn.classList.add(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode)};t.deactivate=function(){const t=this;TC.Control.prototype.deactivate.call(t);t._selectBtn&&e(t,[]);t.wrap&&t.wrap.deactivate();if(t._selectBtn){t._selectBtn.classList.remove(TC.Consts.classes.ACTIVE);t.layer.features.forEach(function(t){t.toggleSelectedStyle(!1)})}};t.clear=function(){const t=this;t.layer&&t.layer.clearFatures();return t};t.isExclusive=function(){return!0};t.end=function(){this.wrap.end();return this};t.setMode=function(t,e){const r=this;t&&(r.mode=t);if(e&&t){r.layer&&r.layer.map.putLayerOnTop(r.layer);r.activate()}else r.deactivate();return r};t.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?Promise.resolve(null):this.layer?Promise.resolve(this.layer):this._layerPromise};t.setLayer=function(t){var e=this;e.map&&(e._layerPromise=new Promise(function(r,n){if("string"==typeof t)e.map.loaded(function(){e.layer=e.map.getLayer(t);r(e.layer)});else{e.layer=t;r(e.layer)}}))};t.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};t.setSelectedFeatures=function(t){const e=this.wrap.setSelectedFeatures(t);this.displayLabelText();return e};t.getActiveFeatures=function(){const t=this,e=t.getSelectedFeatures();!e.length&&t.layer.features.length&&e.push(t.layer.features[t.layer.features.length-1]);return e};t.unselectFeatures=function(t){t=t||[];this.wrap.unselectFeatures(t.map(function(t){return t.wrap.feature}));return this};t.deleteSelectedFeatures=function(){const t=this,e=t.getSelectedFeatures();t.wrap.unselectFeatures(e);e.forEach(function(e){t.layer.removeFeature(e)});return t};t.styleFunction=function(t,e){var r;const n=this.map.options.styles.selection;switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:case TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon:r=TC.Util.extend({},n.polygon);break;case TC.feature.Point&&t instanceof TC.feature.Point:case TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint:r=TC.Util.extend({},n.point);break;default:r=TC.Util.extend({},n.line)}const i=t.getStyle();if(i.label){r.label=i.label;r.fontSize=i.fontSize;r.fontColor=i.fontColor;r.labelOutlineColor=i.labelOutlineColor;r.labelOutlineWidth=i.labelOutlineWidth}return r};t.setTextMode=function(t){const e=this;e.textActive=t;if(t){e._textBtn.classList.add(TC.Consts.classes.ACTIVE,t);e._styleSection.classList.remove(TC.Consts.classes.HIDDEN)}else{e._textBtn.classList.remove(TC.Consts.classes.ACTIVE,t);e._styleSection.classList.add(TC.Consts.classes.HIDDEN)}e.displayLabelText();return e};t.setFontColorWatch=function(t,e){const r=this;void 0===t&&(t=r.styles.text.fontColor);t=TC.Util.colorArrayToString(t);e=e||r.getLabelOutlineColor(t);r.renderPromise().then(function(){r._fontColorPicker.value=t;r._textInput.style.color=t;r._textInput.style.textShadow="0 0 "+r.styles.text.labelOutlineWidth+"px "+e;if(!TC.browserFeatures.inputTypeColor()){r._fontColorPicker.style.backgroundColor=t;r._fontColorPicker.blur()}});return r};t.setFontColor=function(t){const e=this;e.styles.text.fontColor=t;e.styles.text.labelOutlineColor=e.getLabelOutlineColor(t);e.setFontColorWatch(t,e.styles.text.labelOutlineColor);e.getActiveFeatures().forEach(function(r){const n=r.getStyle();n.fontColor=t;n.labelOutlineColor=e.styles.text.labelOutlineColor;r.setStyle(n)});return e};t.setFontSizeWatch=function(t){const e=this;void 0===t&&(t=e.styles.text.fontSize);const r=parseInt(t);r!==Number.NaN&&e.renderPromise().then(function(){e._fontSizeSelector.value=r;e._textInput.style.fontSize=r+"pt"});return e};t.setFontSize=function(t){const e=this,r=parseInt(t);if(r!==Number.NaN){e.styles.text.fontSize=r;e.setFontSizeWatch(r);e.getActiveFeatures().forEach(function(t){const e=t.getStyle();e.fontSize=r;t.setStyle(e)})}return e};t.getLabelOutlineColor=function(t){if(t){const e=(t=TC.Util.colorArrayToString(t)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e&&e.length&&(t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const r=t.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(r&&r.length){return(parseInt(r[1],16)+parseInt(r[2],16)+parseInt(r[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"};t.displayLabelText=function(){const t=this,e=t.getSelectedFeatures();var r,n,i;if(t.isActive&&e.length){const t=e[e.length-1].getStyle();r=t.label;i=t.fontColor;n=t.fontSize}else{r="";i=t.styles.text.fontColor;n=t.styles.text.fontSize}t.renderPromise().then(function(){t.setFontSizeWatch(n).setFontColorWatch(i)._textInput.value=r||""});return t};t.labelFeatures=function(t){const e=this,r=e.getActiveFeatures();if(r.length){const n=r[0].getStyle();r.forEach(function(r){const i=TC.Util.extend({},e.styles.text,n);n.label=t;n.labelOffset=i.labelOffset;n.fontColor=i.fontColor;n.fontSize=i.fontSize;n.labelOutlineColor=i.labelOutlineColor;n.labelOutlineWidth=i.labelOutlineWidth;r.setStyle(n)})}return e}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){this.lineColor=null;TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.fInfoCtrl=null;this.lineFInfoCtrl=null;this.polygonFInfoCtrl=null;this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var t=TC.control.MultiFeatureInfo.prototype;t.CLASS="tc-ctl-m-finfo";TC.isDebug?t.template=TC.apiLocation+"TC/templates/MultiFeatureInfo.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",e,{},{$key:"selection"}).w("</span>").x(e.get(["pointSelectValue"],!1),e,{block:r},{}).x(e.get(["lineSelectValue"],!1),e,{block:n},{}).x(e.get(["polygonSelectValue"],!1),e,{block:i},{}).w("</form></div>")}e.__dustBody=!0;function r(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",e,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["pointSelectValue"],!1),e,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byPoint"}).w("</span></label>")}r.__dustBody=!0;function n(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",e,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["lineSelectValue"],!1),e,"h").w('" /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byLine"}).w("</span></label>")}n.__dustBody=!0;function i(t,e){return t.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",e,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(e.get(["polygonSelectValue"],!1),e,"h").w('" /><span class="tc-ctl-btn">').h("i18n",e,{},{$key:"byPrecinct"}).w("</span></label>")}i.__dustBody=!0;return e};const e=function(t,e){if(!0===t){t={};return TC.Util.extend(t,e)}return t};t.register=function(t){const r=this;r.div.querySelectorAll("input[type=radio]").forEach(function(t){t.checked=!1});return new Promise(function(n,i){const o=[TC.Control.prototype.register.call(r,t)];r.modes[TC.Consts.geom.POINT]&&o.push(t.addControl("featureInfo",e(r.modes[TC.Consts.geom.POINT],{displayMode:r.options.displayMode})).then(function(t){r.fInfoCtrl=t;return t}));r.modes[TC.Consts.geom.POLYLINE]&&o.push(t.addControl("lineFeatureInfo",e(r.modes[TC.Consts.geom.POLYLINE],{displayMode:r.options.displayMode,lineColor:r.lineColor})).then(function(t){r.lineFInfoCtrl=t;return t}));r.modes[TC.Consts.geom.POLYGON]&&o.push(t.addControl("polygonFeatureInfo",e(r.modes[TC.Consts.geom.POLYGON],{displayMode:r.options.displayMode,lineColor:r.lineColor})).then(function(t){r.polygonFInfoCtrl=t;return t}));t.on(`${TC.Consts.event.LAYERADD} ${TC.Consts.event.LAYERREMOVE} ${TC.Consts.event.LAYERVISIBILITY}`,function(t){r.updateUI()});t.on(`${TC.Consts.event.CONTROLACTIVATE} ${TC.Consts.event.CONTROLDEACTIVATE}`,function(t){t.control!==r.fInfoCtrl&&t.control!==r.lineFInfoCtrl&&t.control!==r.polygonFInfoCtrl||r.updateUI()});Promise.all(o).then(function(){if(r.fInfoCtrl){r.fInfoCtrl.activate();r.lastCtrlActive=r.fInfoCtrl}r.updateUI();n(r)})})};t.render=function(t){const e=this;e.lineColor=e.options.lineColor?e.options.lineColor:"#c00";var r={};e.modes[TC.Consts.geom.POINT]&&(r.pointSelectValue=TC.Consts.geom.POINT);e.modes[TC.Consts.geom.POLYLINE]&&(r.lineSelectValue=TC.Consts.geom.POLYLINE);e.modes[TC.Consts.geom.POLYGON]&&(r.polygonSelectValue=TC.Consts.geom.POLYGON);return TC.Control.prototype.renderData.call(e,r,function(){var r=function(){switch(this.value){case TC.Consts.geom.POLYLINE:e.lineFInfoCtrl.activate();e.lastCtrlActive=e.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:e.polygonFInfoCtrl.activate();e.lastCtrlActive=e.polygonFInfoCtrl;break;default:e.fInfoCtrl.activate();e.lastCtrlActive=e.fInfoCtrl}};e.div.querySelectorAll("input[type=radio]").forEach(function(t){t.addEventListener("change",r)});TC.Util.isFunction(t)&&t()})};t.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};t.deactivate=function(){this.lastCtrlActive.deactivate(!1)};t.updateUI=function(){const t=this;if(t.map){const e=t.map.workLayers.some(t=>t.type===TC.Consts.layerType.WMS&&t.getVisibility());t.div.querySelectorAll("input").forEach(function(t){t.disabled=!e});if(t.fInfoCtrl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POINT}]`);e&&(e.checked=t.fInfoCtrl.isActive)}if(t.lineFInfoCtrl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POLYLINE}]`);e&&(e.checked=t.lineFInfoCtrl.isActive)}if(t.polygonFInfoCtrl){const e=t.div.querySelector(`input[value=${TC.Consts.geom.POLYGON}]`);e&&(e.checked=t.polygonFInfoCtrl.isActive)}const r=t.div.style.display;t.div.style.display="none";r?t.div.style.display=r:t.div.style.removeProperty("display")}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var t=TC.control.NavBar.prototype;t.CLASS="tc-ctl-nav";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBar(this));return this._set1stRenderPromise(Promise.resolve())};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);(void 0===e.options.home||e.options.home)&&t.addControl("navBarHome");t.loaded(function(){e.wrap.refresh()});return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBarHome=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBarHome,TC.Control);!function(){var t=TC.control.NavBarHome.prototype;t.CLASS="tc-ctl-nav-home";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBarHome(this));return Promise.resolve()};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);t.on(TC.Consts.event.PROJECTIONCHANGE,function(r){const n=r.crs;var i=TC.Util.reproject([t.options.initialExtent[0],t.options.initialExtent[1]],t.options.crs,n),o=TC.Util.reproject([t.options.initialExtent[2],t.options.initialExtent[3]],t.options.crs,n);e.wrap.setInitialExtent([i[0],i[1],o[0],o[1]])});return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.isLoaded=!1;this.layer=null};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var t=TC.control.OverviewMap.prototype;t.CLASS="tc-ctl-ovmap";TC.isDebug?t.template=TC.apiLocation+"TC/templates/OverviewMap.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=function(e){return function(e){var r,n=function(t,e){for(var r=null,n=0;n<e.length;n++){var i=e[n];if((i.id||i)===t){r=i;break}}return r};if("string"==typeof e){var i=n(e,t.options.availableBaseLayers);TC.Util.isPlainObject(i)||(i=n(e,t.options.baseLayers));TC.Util.isPlainObject(i)&&(r=new TC.layer.Raster(i))}else r=e instanceof TC.Layer?e:e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e);return r}(e)};return new Promise(function(n,i){TC.Control.prototype.register.call(e,t).then(function(i){e.wrap=new TC.wrap.control.OverviewMap(e);t.loaded(function(){e.defaultLayer=r(e.options.layer);e.layer=r(t.baseLayer.overviewMapLayer||e.options.layer||t.options.baseLayers[0]||t.options.availableBaseLayers[0]);e.wrap.register(t);!function(r){const n={};e.layer.getCapabilitiesPromise().then(function(){e.layer.isCompatible(t.crs)||0!==e.layer.wrap.getCompatibleMatrixSets(t.crs).length||(n.layer=e.layer.getFallbackLayer());e.wrap.reset(n)})}(t.crs);t.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(t){const e=this;if(e.map.baseLayer.type===TC.Consts.layerType.WMS||e.map.baseLayer.type===TC.Consts.layerType.WMTS||e.options.layer){var n=e.map.baseLayer.overviewMapLayer||e.options.layer;if(e.layer.id!==n){var i=r(n);e.wrap.reset({layer:i}).then(function(t){e.layer=t})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(t.type)>-1&&e.wrap.reset({layer:e.layer}).then(function(t){e.layer=t})}}.bind(e))});n(i)}).catch(function(t){i(t)})})};t.loaded=function(t){TC.Util.isFunction(t)&&(this.isLoaded&&this.map&&this.map.isLoaded?t():this.on(TC.Consts.event.MAPLOAD,t))};t.activate=function(){this.enable()};t.deactivate=function(){this.disable()};t.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};t.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYGON};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.PolygonFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var t=TC.control.Popup.prototype;t.CLASS="tc-ctl-popup";t.render=function(){const t=this;return t._set1stRenderPromise(new Promise(function(e,r){t.map.wrap.addPopup(t).then(function(){t.trigger(TC.Consts.event.CONTROLRENDER);e()},function(t){r(t instanceof Error?t:Error(t))})}))};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);return new Promise(function(n,i){Promise.all([r,e.renderPromise()]).then(function(){t.on(TC.Consts.event.VIEWCHANGE,function(){t.view===TC.Consts.view.PRINTING&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.LAYERREMOVE,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&e.isVisible()&&e.hide()});t.on(TC.Consts.event.UPDATE,function(){e.currentFeature&&e.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||e.isVisible()&&e.hide()});t.on(TC.Consts.event.FEATUREREMOVE,function(t){e.currentFeature===t.feature&&e.isVisible()&&e.hide()});n(e)}).catch(function(t){i(t instanceof Error?t:Error(t))})})};t.fitToView=function(t){var e=this;t?setTimeout(function(){e.wrap.fitToView()},1e3):e.wrap.fitToView()};t.hide=function(){if(this.map){const t={control:this,feature:this.currentFeature};this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.trigger(TC.Consts.event.POPUPHIDE,t)}};t.getContainerElement=function(){return this.contentDiv||null};t.getMenuElement=function(){return this.menuDiv||null};t.setDragged=function(t){const e=this;e.dragged=t;e.popupDiv&&e.popupDiv.classList.toggle(TC.Consts.classes.DRAGGED,!!t);e.wrap.setDragged(t)};t.setDragging=function(t){const e=this;if(t){e.setDragged(!0);e.popupDiv.classList.add(TC.Consts.classes.DRAG)}else e.popupDiv.classList.remove(TC.Consts.classes.DRAG)};t.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(t){var e=this,r=t||{};e.ready=!1;e.title=r.title||TC.Util.getLocaleString(TC.Cfg.locale,"printPage");e.cssUrl=r.cssUrl||TC.apiLocation+"TC/css/print.css";if(r.target){const t=r.target;if(!t.querySelector("."+e.CLASS+"-btn")){for(var n in e.template)dust.cache[n]||e.template[n]();t.classList.add(TC.Consts.classes.PRINTABLE);var i=function(r){var n=open(null,e.CLASS),i=t.innerHTML;dust.render(e.CLASS+"-page",{title:e.title,content:i,cssUrl:e.cssUrl},function(t,e){n.document.write(e);n.document.close();n.focus();t&&TC.error(t)})};dust.render(e.CLASS,null,function(r,n){t.insertAdjacentHTML("afterbegin",n);t.querySelector("."+e.CLASS+"-btn").addEventListener("click",i)})}}};!function(){var t=TC.control.Print.prototype;t.CLASS="tc-ctl-print";t.template={};t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<a class="tc-ctl-print-btn" title="').h("i18n",e,{},{$key:"printThisWindow"}).w('">').h("i18n",e,{},{$key:"print"}).w("</a>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-page"]=function(){dust.register(t.CLASS+"-page",e);function e(t,e){return t.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(e.get(["title"],!1),e,"h").w('</title><link rel="stylesheet" href="').f(e.get(["cssUrl"],!1),e,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(e.get(["title"],!1),e,"h").w("</h1>").f(e.get(["content"],!1),e,"h",["s"]).w("</body></html>")}e.__dustBody=!0;return e}}();TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.PrintMap=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintMap,TC.control.MapInfo);!function(){var t=TC.control.PrintMap.prototype;t.CLASS="tc-ctl-printMap";const e="portrait",r="landscape",n="A4",i="A3";var o={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},a={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},s={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},l={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}};const c=function(t,c){switch(t){case e:switch(c){case n:return o;case i:return s}break;case r:switch(c){case n:return a;case i:return l}break;default:return o}},u=function(t){return t.layoutPDF.content[0].columns[0]},h=function(t){return t.layoutPDF.content[0].columns[2]},p={sideLength:85};t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/PrintMap.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/PrintMapView.html";t.template[t.CLASS+"-tools"]=TC.apiLocation+"TC/templates/PrintMapTools.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",e,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",e,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",e,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",e,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt tc-ctl-printMap-cnt-btn"><input id="tc-ctl-printMap-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-printMap-image-qr" class="tc-ctl-printMap-image-qr-label" title="').h("i18n",e,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",e,{},{$key:"appendQRCode"}).w('</label><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"printMap"}).w('">').h("i18n",e,{},{$key:"print"}).w('</button></div><div class="tc-group tc-ctl-printMap-cnt"><div class="tc-ctl-printMap-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w("</p></div></div></div></div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){dust.register(t.CLASS+"-view",e);function e(t,e){return t.w('<div class="tc-ctl-printMap-view"> </div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-tools"]=function(){dust.register(t.CLASS+"-tools",e);function e(t,e){return t.w('<div class="tc-ctl-printMap-tools"><div class="tc-ctl-printMap-btn-pdf" title="').h("i18n",e,{},{$key:"printpdf"}).w('"></div><div class="tc-ctl-printMap-btn-close" title="').h("i18n",e,{},{$key:"close"}).w('"></div></div> ')}e.__dustBody=!0;return e}}const d=function(){return this.map.workLayers.some(function(t){return t.type===TC.Consts.layerType.WMS&&t.getVisibility()})};t.register=function(t){const r=this,n=TC.control.MapInfo.prototype.register.call(r,t);r.map.mustBeExportable=!0;const i=function(){c(r.orientation||e,r.format.toString().toUpperCase()||"A4").reset()};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+r.CLASS+"-btn",function(){r.map.setView(TC.Consts.view.PRINTING);var t=document.querySelector("."+r.CLASS+"-qrcode");if(document.querySelector("#"+r.CLASS+"-image-qr").checked){if(!t){(t=document.createElement("div")).classList.add(r.CLASS+"-qrcode");r.map.div.appendChild(t)}t.innerHTML="";r.makeQRCode(t,p.sideLength,p.sideLength)}else t&&(t.innerHTML="");const n="."+r.CLASS+"-btn";r.map.on(TC.Consts.event.STARTLOADING,function(){const t=r.div.querySelector(n);t.classList.add("disabled");t.disabled=!0});r.map.on(TC.Consts.event.STOPLOADING,function(){const t=r.div.querySelector(n);t.classList.remove("disabled");t.disabled=!1});d.call(r)&&r.map.on(TC.Consts.event.ZOOM,i);const o=function(t){if(t){r.map.div.classList.add(t);var e=r.map.div.getBoundingClientRect();Number.isInteger(e.width)||(r.map.div.style.width=Math.round(e.width)+"px");Number.isInteger(e.height)||(r.map.div.style.height=Math.round(e.height)+"px");r.map.toast(r.getLocaleString("print.advice.title")+": "+r.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3})}r.map.wrap.map.updateSize()},a=function(){c(r.orientation||e,r.format.toString().toUpperCase()||"A4").reset();d.call(r)&&r.map.off(TC.Consts.event.ZOOM,i);r.map.toastHide(r.getLocaleString("print.advice.title")+": "+r.getLocaleString("print.advice.desc"));r.map.div.classList.remove(r.currentFormat,r.CLASS+"-printing");r.map.div.style.removeProperty("width");r.map.div.style.removeProperty("height");o();r.map.setView(TC.Consts.view.DEFAULT);r._viewDiv.classList.add(TC.Consts.classes.HIDDEN)};if(!r._viewDiv){r._viewDiv=TC.Util.getDiv();document.body.appendChild(r._viewDiv);r.getRenderedHtml(r.CLASS+"-view",null,function(t){r._viewDiv.innerHTML=t});r.getRenderedHtml(r.CLASS+"-tools",null,function(t){r.map.div.insertAdjacentHTML("beforeend",t);r.map.div.querySelector("."+r.CLASS+"-btn-close").addEventListener("click",a);r.map.div.querySelector("."+r.CLASS+"-btn-pdf").addEventListener("click",r.createPdf.bind(r))})}r.orientation=r.div.querySelector("#print-design").value;r.format=r.div.querySelector("#print-size").value;r.currentFormat=r.CLASS+"-"+r.orientation+"-"+r.format;r._viewDiv.classList.remove(TC.Consts.classes.HIDDEN);r.map.div.classList.add(r.CLASS+"-printing");o(r.currentFormat)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("#"+r.CLASS+"-image-qr",function(t){r.generateLink()}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){r.generateLink();r.registerListeners()}));return n};t.createPdf=function(){var t=this,r=t.map.getControlsByClass(TC.control.LoadingIndicator)[0],n=r.addWait();TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){const i=t.map.div.querySelectorAll(".ol-viewport");for(var o=0,a=i.length;o<a;o++){const e=i[o];if(!e.parentElement.classList.contains("ol-overviewmap-map")){t.canvas=e.querySelector("canvas");break}}var s=c(t.orientation||e,t.format.toString().toUpperCase()||"A4"),l=s.layoutPDF;const d=function(e){var i=window.location.host+"_",o=t.div.querySelector("."+t.CLASS+"-title").value.trim();if(o)i+=o;else{i+=TC.Util.getFormattedDate((new Date).toString(),!0)}try{pdfMake.createPdf(e).download(i.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(e){t.map.toast(t.getLocaleString("print.error"),{type:TC.Consts.msgType.ERROR});TC.error(e.message+"  "+e.stack,TC.Consts.msgErrorMode.EMAIL)}r.removeWait(n)},f=function(e){TC.error(t.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+e,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},g=function(){var e=[],r=t.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS&&t.getVisibility()}),n=[],i=function(t,e,r){if(e.isVisibleByScale(t.name)){var n,i;e.options&&e.options.params&&e.options.params.base64LegendSrc?i=e.options.params.base64LegendSrc:t.legend&&(n=t.legend.src);result.push({src:n,title:t.title,level:r,srcBase64:i})}},o=function(t,e,r,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)o(t[i],e,r,n);else if(t&&t.hasOwnProperty("children")&&t.children.length>0){t.title&&t.name&&result.push({header:t.title,level:n});o(t.children,e,r,++n)}if(t&&t.hasOwnProperty("children")&&0==t.children.length){e.apply(this,[t,r,n]);n--}};r.forEach(function(t){result=[];var e=t.options.hideTree;t.tree=null;t.options.hideTree=!0;o(t.getTree(),i,t,0);t.options.hideTree=e;result.length>0&&n.push({title:t.title,layers:result})});return new Promise(function(t,r){Promise.all(function(){for(var t=[],e=0;e<n.length;e++)for(var r=n[e].layers,i=0;i<r.length;i++)!function(r,i){var o=n[e].layers[i],a=o.src||o.srcBase64;if(a){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");t.push(new Promise(function(t,e){new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!0}).fetchImage(a,{exportable:!0}).then(function(e){if(e.complete){var r=TC.Util.imgTagToDataUrl(e,"image/png");o.image={base64:r.base64,canvas:r.canvas}}else f(a);t()},function(t){f(a);e()})}))}}(0,i);return t}()).then(function(){n.map(function(t,e){return{groupIndex:e,height:t.layers.filter(function(t){return t.image&&t.image.canvas}).reduce(function(t,e,r,n){return t+n[r].image.canvas.height},0)}}).sort(function(t,e){return t.height>e.height?1:t.height<e.height?-1:0}).forEach(function(t,r){!function(t,r){var n=[[{text:t.title,colSpan:2,alignment:"left",fontSize:11,margin:[0,r>0?10:0,0,5]},{}]];const i=(n=n.concat(t.layers.filter(function(e){return e.hasOwnProperty("header")&&e.header.trim().toLowerCase()!==t.title.trim().toLowerCase()}).map(function(t){return[{text:t.header.trim(),colSpan:2,alignment:"left",margin:[10*t.level,0,0,3]},{}]}))).length;var o=null,a=null;t.layers.forEach(function(t,e){if(t.header){o=t;a&&(a=null)}else{a||(a=1);var r;o&&(r=n.map(function(t){return t[0].text}).indexOf(o.header)+a++);if(t.image){var i=t.image.canvas.width/2,s=i*t.image.canvas.height/t.image.canvas.width,l=[{text:t.title,fontSize:9,width:"auto",margin:[10*t.level,0,0,2]},{image:t.image.base64,width:i,height:s,margin:[10*t.level,0,0,2]}];r?n.splice(r,0,l):n.push(l)}else{l=[{text:t.title,fontSize:9,colSpan:2,margin:[10*t.level,0,0,2]},{}];r?n.splice(r,0,l):n.push(l)}}});e.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:i,body:n}})}(n[t.groupIndex],r)});t(e)},function(){r([])})})},y=[function(){const e=function(){var t=u(s);delete t.image;t.text="";return t};return t.options.logo?TC.Util.imgToDataUrl(t.options.logo,"image/png").then(function(t){const e=t.canvas,r=t.dataUrl;TC.Util.calculateAspectRatioFit(e.width,e.height,s.logoWidth,s.logoHeight);var n=u(s);n.width||(n.width=e.width/e.height*n.height);n.image=r;return n},function(){f(t.options.logo);return e()}):e()},function(){var e=function(t){return t.layoutPDF.content[0].columns[1]}(s);e.text=t.div.querySelector("."+t.CLASS+"-title").value.trim();return e},function(){const e=function(){var t=h(s);delete t.image;t.text="";t.width="auto";return t};var r=t.map.getControlsByClass(TC.control.ScaleBar)[0];if(r){var n=document.getElementsByClassName("ol-scale-line-inner"),i=n[0].getBoundingClientRect();if(i){var o=getComputedStyle(n[0],null),a=parseInt(o.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(o.getPropertyValue("border-right-width").replace("px",""))||0,c=h(s);c.table={widths:[.75*((i.width>i.height?i.width:i.height)-a-l)],body:[[{border:[!0,!1,!0,!0],text:r.getText(),fontSize:10,alignment:"center"}]]};c.layout={paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}};return c}return e()}return e()},function(){if(document.querySelector("#"+t.CLASS+"-image-qr").checked){const e=document.querySelector("."+t.CLASS+"-qrcode");e.innerHTML="";return t.makeQRCode(e,p.sideLength,p.sideLength).then(function(e){if(e)return TC.Util.addToCanvas(t.canvas,e,{x:t.canvas.width-p.sideLength,y:t.canvas.height-p.sideLength},{width:p.sideLength,height:p.sideLength}).then(function(t){return t});TC.error(t.getLocaleString("print.qr.error"));return t.canvas})}return t.canvas}];Promise.all(y.map(function(t){return t()})).then(function(e){e[2].table&&(s.layoutPDF.content[0].columns[1].width=s.layoutPDF.pageSize.width-(s.layoutPDF.pageMargins[0]+s.layoutPDF.pageMargins[2])-s.layoutPDF.content[0].columns[0].width-(s.layoutPDF.content[0].columns[2].table.widths[0]+2));var r=function(t){return t.layoutPDF.content[1].table.body[0][0]}(s),n=e[3]||t.canvas;r.image=n.toDataURL();if(t.options.legend&&t.options.legend.visible&&function(){return this.map.workLayers.some(function(t){if(t.type===TC.Consts.layerType.WMS&&t.getVisibility()){for(var e=0;e<t.names.length;e++)if(t.isVisibleByScale(t.names[e]))return!0;return!1}return!1})}.call(t)&&2==l.content.length){const e=t.div.querySelector("."+t.CLASS+"-title").value.trim();l.content.push({pageBreak:"before",pageOrientation:t.options.legend.orientation||"portrait",text:e.length>0?e:"",fontSize:14,margin:[0,20,0,10]});g().then(function(t){l.content=l.content.concat(t);d(l)})}else d(l)})})};t.manageMaxLengthExceed=function(t){const e=this.div.querySelector("."+this.CLASS+"-alert");document.querySelector("#"+this.CLASS+"-image-qr").checked?e.classList.toggle(TC.Consts.classes.HIDDEN,!t.qr):e.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa",SHOW_IN:"showIn",SHOW_OUT:"showOut"};this.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};this.content=this.contentType.TABLE;TC.Util.isEmptyObject(this.options)&&(this.options={content:"table"});this.options;this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.template={};ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};if(TC.isDebug){ctlProto.template[ctlProto.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";ctlProto.template[ctlProto.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";ctlProto.template[ctlProto.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{ctlProto.template[ctlProto.CLASS]=function(){dust.register(ctlProto.CLASS,t);function t(t,e){return t.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><span class="prpanel-title-text"></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",e,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",e,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="').h("i18n",e,{},{$key:"export.excel"}).w('"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="tc-ctl-p-results-menu"></div><div class="prpanel-body list-group tc-ctl-p-results-info"></div><div class="prpanel-body list-group tc-ctl-p-results-table"></div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",e,{},{$key:"expand"}).w('" data-no-cb><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}t.__dustBody=!0;return t};ctlProto.template[ctlProto.CLASS+"-table"]=function(){dust.register(ctlProto.CLASS+"-table",t);function t(t,n){return t.w('<table class="table" style="display:none;"><thead>').s(n.get(["columns"],!1),n,{block:e},{}).w("</thead><tbody>").s(n.get(["results"],!1),n,{block:r},{}).w("</tbody></table>")}t.__dustBody=!0;function e(t,e){return t.w("<th>").f(e.getPath(!0,[]),e,"h").w("</th>")}e.__dustBody=!0;function r(t,e){return t.w("<tr>").h("iterate",e,{block:n},{on:e.getPath(!0,[])}).w("</tr>")}r.__dustBody=!0;function n(t,e){return t.w("<td>").f(e.get(["value"],!1),e,"h").w("</td>")}n.__dustBody=!0;return t};ctlProto.template[ctlProto.CLASS+"-chart"]=function(){dust.register(ctlProto.CLASS+"-chart",t);function t(t,n){return t.w('<div class="tc-track-chart">').x(n.get(["msg"],!1),n,{else:e,block:r},{}).w("</div>")}t.__dustBody=!0;function e(t,e){return t.w('<span id="elevationGain" >').h("i18n",e,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(e.get(["upHill"],!1),e,"h").w("m, -").f(e.get(["downHill"],!1),e,"h").w('m</span><div class="tc-chart"></div>')}e.__dustBody=!0;function r(t,e){return t.f(e.get(["msg"],!1),e,"h")}r.__dustBody=!0;return t}}const isElementVisible=function(t){const e=getComputedStyle(t);return t&&!t.hidden&&"none"!==e.display&&"hidden"!==e.visibility};ctlProto.isVisible=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)||isElementVisible(e)};ctlProto.isMinimized=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)&&!isElementVisible(t)};const manageClassList=function(t,e,r){const n=this.div.querySelector("."+t);if(n){n.classList.add(e);n.classList.remove(r)}};ctlProto.show=function(t){const e=this.div.querySelector("."+t);e&&"none"===e.style.display&&(e.style.display="");manageClassList.call(this,t,this.classes.SHOW_IN,this.classes.SHOW_OUT)};ctlProto.hide=function(t){manageClassList.call(this,t,this.classes.SHOW_OUT,this.classes.SHOW_IN);const e=this.div.querySelector("."+t);e&&(e.style.display="none")};ctlProto.doVisible=function(){this.div.classList.remove(TC.Consts.classes.HIDDEN);this.show("prsidebar-body")};ctlProto.render=function(t){const e=this;e.div.classList.add(TC.Consts.classes.HIDDEN);return TC.Control.prototype.render.call(e,function(){e.mainTitleElm=e.div.querySelector(".prpanel-title-text");e.minimizeButton=e.div.querySelector(".prcollapsed-slide-submenu-min");e.minimizeButton.addEventListener("click",function(){e.minimize()});e.closeButton=e.div.querySelector(".prcollapsed-slide-submenu-close");e.closeButton.addEventListener("click",function(){e.close()});e.maximizeButton=e.div.querySelector(".prcollapsed-max");e.maximizeButton.addEventListener("click",function(){e.maximize()});if(e.save){e.saveButton=e.div.querySelector(".prcollapsed-slide-submenu-csv");e.saveButton.addEventListener("click",function(){e.exportToExcel()});e.saveButton.removeAttribute("hidden")}if(e.content){e.content=e.content;if(e.options.titles){if(e.options.titles.main){e.mainTitleElm.setAttribute("title",e.options.titles.main);e.mainTitleElm.innerHTML=e.options.titles.main}e.options.titles.max&&e.maximizeButton.setAttribute("title",e.options.titles.max)}else{e.mainTitleElm.setAttribute("title",e.getLocaleString("rsp.title"));e.mainTitleElm.innerHTML=e.getLocaleString("rsp.title")}}e.div.querySelector(e.content.collapsedClass).classList.add(e.classes.FA);e.infoDiv=e.div.querySelector("."+e.CLASS+"-info");e.tableDiv=e.div.querySelector("."+e.CLASS+"-table");e.menuDiv=e.div.querySelector("."+e.CLASS+"-menu");TC.browserFeatures.touch()&&TC.Util.swipe(e.div,{left:function(){e.minimize()}});t&&"function"==typeof t&&t.call()})};ctlProto.minimize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(!isElementVisible(e)){e.classList.add(t.classes.FA);e.hidden=!1;t.hide("prsidebar-body");t.show("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMIN,{control:t})}};ctlProto.maximize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(isElementVisible(e)){e.hidden=!0;t.show("prsidebar-body");t.hide("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMAX,{control:t})}};ctlProto.close=function(){const t=this;t.div.classList.add(TC.Consts.classes.HIDDEN);t.chart&&t.chart.chart&&(t.chart.chart=t.chart.chart.destroy());const e=t.div.querySelector(".prsidebar-body");if(e){e.style.display="none";t.div.querySelector(".prcollapsed-max").style.display="none";const r=t.div.querySelector(t.content.collapsedClass);r.hidden=!0;r.classList.remove(t.classes.FA);t.map.trigger(TC.Consts.event.RESULTSPANELCLOSE,{control:t})}};ctlProto.openChart=function(t){const e=this;e.div.classList.remove(TC.Consts.classes.HIDDEN);e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return t!==e}).filter(function(t){return"chart"===t.options.content}).forEach(function(t){t.close()});if(t)if(t.msg)e.map.toast(t.msg);else{e.elevationProfileCoordinates=t.coords;e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})}else e.map.toast(options.msg);e.map.getLoadingIndicator().hide()};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data;data.ele=data.ele.map(t=>null===t?0:t);const div=options.div;var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(ctlProto.CLASS+"-chart",{upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"},function(out){div.innerHTML=out;div.style.display="";if(self.options.titles){if(self.options.titles.main){const t=self.div.querySelector(".prpanel-title-text");t.setAttribute("title",self.options.titles.main);t.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var chartOptions=TC.Util.extend({bindto:div.querySelector(".tc-chart"),padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){TC.Util.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.trigger(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(t,e){var r=this,n=r.config,i=r.d3.svg.line(),o=r.generateGetLinePoints(t,e),a=e?r.getSubYScale:r.getYScale,s=function(t){return(e?r.subxx:r.xx).call(r,t)},l=function(t,e){return n.data_groups.length>0?o(t,e)[0][1]:a.call(r,t.id)(t.value)};i=n.axis_rotated?i.x(l).y(s):i.x(s).y(l);n.line_connectNull||(i=i.defined(function(t){return null!=t.value}));return function(t){var o,s=n.line_connectNull?r.filterRemoveNull(t.values):t.values,l=e?r.x:r.subX,c=a.call(r,t.id),u=0,h=0;if(r.isLineType(t))if(n.data_regions[t.id])o=r.lineWithRegions(s,l,c,n.data_regions[t.id]);else{r.isStepType(t)&&(s=r.convertValuesToStep(s));o=i.interpolate("linear")(s)}else{if(s[0]){u=l(s[0].x);h=c(s[0].value)}o=n.axis_rotated?"M "+h+" "+u:"M "+u+" "+h}return o||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(t,e){var r=this,n=r.config,i=r.d3.svg.area(),o=r.generateGetAreaPoints(t,e),a=e?r.getSubYScale:r.getYScale,s=function(t){return(e?r.subxx:r.xx).call(r,t)},l=function(t,e){return n.data_groups.length>0?o(t,e)[0][1]:a.call(r,t.id)(0)},c=function(t,e){return n.data_groups.length>0?o(t,e)[1][1]:a.call(r,t.id)(t.value)};i=n.axis_rotated?i.x0(l).x1(c).y(s):i.x(s).y0(l).y1(c);n.line_connectNull||(i=i.defined(function(t){return null!==t.value}));return function(t){var e,o=n.line_connectNull?r.filterRemoveNull(t.values):t.values,a=0,s=0;if(r.isAreaType(t)){r.isStepType(t)&&(o=r.convertValuesToStep(o));e=i.interpolate("linear")(o)}else{if(o[0]){a=r.x(o[0].x);s=r.getYScale(t.id)(o[0].value)}e=n.axis_rotated?"M "+s+" "+a:"M "+a+" "+s}return e||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};const closeOpenedTableResultsPanel=function(){const t=this;t.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return e!==t&&e.isVisible()}).filter(function(e){return e.options.content!==t.contentType.CHART}).forEach(function(t){t.close()})};ctlProto.openTable=function(){var t=this;t.div.classList.remove(TC.Consts.classes.HIDDEN);if(r=arguments[0]){var e;r.css&&(e=r.css);var r,n=r.callback,i=r.columns;if((r=r.data)&&r.length>0){if(!i){i=[];for(var o in r[0])i.push(o)}t.tableData={columns:i,results:r,css:e,callback:n};t.getRenderedHtml(t.CLASS+"-table",t.tableData).then(function(e){const r=t.div.querySelector("."+t.CLASS+"-table"),n=r.parentElement;n.removeChild(r);r.innerHTML=e;n.appendChild(r);t.tableData.callback&&t.tableData.callback(r);closeOpenedTableResultsPanel.call(t);t.map.trigger(TC.Consts.event.DRAWTABLE,{control:t})});t.div.querySelector("."+t.CLASS+"-chart").style.display="none";t.div.querySelector("."+t.CLASS+"-info").style.display="none";t.show("prsidebar-body")}}t.map.getLoadingIndicator().hide()};ctlProto.open=function(t,e){const r=this;r.div.classList.remove(TC.Consts.classes.HIDDEN);const n=e||r.div.querySelector("."+r.CLASS+"-table");r.requestIsRendered=window.requestAnimationFrame(function(){var t=n.getBoundingClientRect();if(t&&t.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.trigger(TC.Consts.event.DRAWTABLE,{control:r})}}.bind(r));r.div.querySelector("."+r.CLASS+"-chart").style.display="none";const i=r.div.querySelector("."+r.CLASS+"-table");i.style.display="none";r.div.querySelector("."+r.CLASS+"-info").style.display="none";if(t)if(e){r.getTableContainer=function(){return e};e.innerHTML=t;e.style.display=""}else{i.innerHTML=t;i.style.display=""}const o=r.div.querySelector(".prcollapsed-max");if(r.options.titles){if(r.options.titles.main){const t=r.div.querySelector(".prpanel-title-text");t.setAttribute("title",r.options.titles.main);t.innerHTML=r.options.titles.main}r.options.titles.max&&o.setAttribute("title",r.options.titles.max)}r.options.classes&&r.options.classes.collapsed&&o.querySelector("i.fa-list-alt").classList.add(r.options.classes.collapsed);const a=r.div.querySelector(r.content.collapsedClass);isElementVisible(a)&&r.maximize();r.show("prsidebar-body");r.hide("prcollapsed-max");r.map.getLoadingIndicator().hide()};ctlProto.createChartOptions=function(t){const e=this;var r={};const n=(t=t||{}).locale||TC.Util.getMapLocale(e.map);t.chartType;if(null!=t.ele){const a=function(){const r=document.documentElement.clientWidth/100*40;return{height:r>445?t.maxHeight||e.CHART_SIZE.MAX_HEIGHT:t.minHeight||e.CHART_SIZE.MIN_HEIGHT,width:r>445?t.maxWidth||e.CHART_SIZE.MAX_WIDTH:r>310?t.mediumWidth||e.CHART_SIZE.MEDIUM_WIDTH:t.minWidth||e.CHART_SIZE.MIN_WIDTH}};var i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY;t.ele.forEach(function(t){if("number"==typeof t){i=Math.max(t,i);o=Math.min(t,o)}});const s="grad"+TC.getUID();r={data:{x:"x",columns:[["x"].concat(t.x),["ele"].concat(t.ele)],types:{ele:"area-spline"},colors:{ele:"url(#"+s+")"}},size:a(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(t){var e,r;if((t/=1e3)<1){e=Math.round(1e3*t);r=" m"}else{e=Math.round(100*t)/100;r=" km"}return(e=e.toLocaleString(n))+r}}},y:{padding:{top:0,bottom:0},max:i,min:o,tick:{count:2,format:function(t){return(parseInt(t.toFixed(0))||0).toLocaleString(n)+"m"}}}},onresize:function(){this.api.resize(a())}};t.time&&(r.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));r._onrendered=function(){const t=this.svg[0][0];var r=t.getElementsByTagName("defs")[0],n="http://www.w3.org/2000/svg",i=document.createElementNS(n,"linearGradient");i.setAttributeNS(null,"id",s);i.setAttributeNS(null,"x1","0%");i.setAttributeNS(null,"x2","0%");i.setAttributeNS(null,"y1","0%");i.setAttributeNS(null,"y2","100%");i.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const o=document.createElementNS(n,"stop");o.setAttributeNS(null,"offset","0%");o.setAttributeNS(null,"stop-color","red");o.setAttributeNS(null,"stop-opacity","0.7");i.appendChild(o);const a=document.createElementNS(n,"stop");a.setAttributeNS(null,"offset","50%");a.setAttributeNS(null,"stop-color","orange");a.setAttributeNS(null,"stop-opacity","0.9");i.appendChild(a);const l=document.createElementNS(n,"stop");l.setAttributeNS(null,"offset","100%");l.setAttributeNS(null,"stop-color","green");l.setAttributeNS(null,"stop-opacity","1");i.appendChild(l);r.appendChild(i);const c=d3.select(".c3-brush").node();c&&c.parentNode.removeChild(c);d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(t){d3.event.stopPropagation();const r=e.elevationProfileCoordinates[t.index].slice(0,2);r&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){e.map.zoomToFeatures([new TC.feature.Point(r)])})});var u=d3.select(".c3-axis.c3-axis-x").select("path").attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(u)){u=u.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(u)){u=u.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}}const h=t.getBoundingClientRect(),p={width:h.width,height:h.height};var d=function(){var t=d3.scale.ordinal().rangeRoundBands([0,p.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(t,e){t.each(function(){t.each(function(t,e){if(0!=e){d3text=d3.select(this);if(1===d3text.node().childNodes.length){var r=d3text.select("tspan").node().cloneNode(),n=d3text.text().split(" ");d3text.select("tspan").text(n[0]);r.textContent=n[1];var i=r.getAttribute("dy");i=(i=i?parseFloat(r.getAttribute("dy")):.71)+.18+"em";r.setAttribute("dy",i);d3text.node().appendChild(r)}}})})},t.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&d();else{if(e.elevationChartLabelsRAF){window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0}e.elevationChartLabelsRAF=requestAnimationFrame(function t(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())e.elevationChartLabelsRAF=requestAnimationFrame(t);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)e.elevationChartLabelsRAF=requestAnimationFrame(t);else{window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(p.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&d()}})}if(!e.isMinimized()){e.show("prsidebar-body");e.hide("prcollapsed-max")}e.div.querySelector("."+e.CLASS+"-table").style.display="";e.div.querySelector("."+e.CLASS+"-info").style.display=""}}else r={msg:e.getLocaleString("geo.trk.chart.chpe.empty")};return r};const getTime=function(t,e){var r=e-t,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60;n.h=o+24*i;var a=Math.floor(r/1e3/60);r-=1e3*a*60;n.m=a;n.s=Math.floor(r/1e3);return TC.Util.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(t){const e=this.elevationProfileCoordinates;var r=t[0].x;r/=1e3;const n=e[t[0].index];var i;4==e[0].length&&e[0][3]>0&&(i=getTime(e[0][3],n[3]));const o=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,a=parseInt(t[0].value.toFixed(0)).toLocaleString(o);var s,l;if(r<1){s=Math.round(1e3*r);l=" m"}else{s=Math.round(100*r)/100;l=" km"}return'<div class="track-elevation-tooltip"><div><span>'+a+" m </span><br><span>"+(s=s.toLocaleString(o))+l+" </span></div>"+(i?"<span>"+i.toString+"</span><div/>":"")};ctlProto.getTableContainer=function(){return this.tableDiv};ctlProto.getInfoContainer=function(){return this.infoDiv};ctlProto.getMenuElement=function(){return this.menuDiv};ctlProto.getContainerElement=function(){return this.div||null};ctlProto.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e.wrap.register(t);e.openOn&&e.map.one(e.openOn,function(t,r){e.content.fnOpen.call(e,t.data)});e.closeOn&&e.map.one(e.closeOn,function(t,r){e.close()});e.options.openOn&&e.map.on(e.options.openOn,function(t,r){e.content.fnOpen.call(e,t.data)});e.options.closeOn&&e.map.on(e.options.closeOn,function(t,r){e.close()});return r};ctlProto.exportToExcel=function(){var t=this,e=[t.tableData.columns];t.tableData.results.forEach(function(t){var r=[];for(var n in t)t.hasOwnProperty(n)&&"Id"!==n&&"Geom"!==n&&r.push(t[n]);e.push(r)});var r=function(r){var n=t.save.fileName?t.save.fileName:"resultados.xls",i=t.options.titles&&t.options.titles.main?t.options.titles.main:null;r.Save(n,e,i)};TC.Util.ExcelExport?r(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/Util.ExcelExport",function(){r(new TC.Util.ExcelExport)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var t=TC.control.ScaleBar.prototype;t.CLASS="tc-ctl-sb";t.render=function(){this.wrap||(this.wrap=new TC.wrap.control.ScaleBar(this));this.wrap.render();return this._set1stRenderPromise(Promise.resolve())};t.register=function(t){const e=this;return new Promise(function(r,n){Promise.all([TC.Control.prototype.register.call(e,t),t.wrap.getMap()]).then(function(t){t[1].addControl(e.wrap.ctl);r(e)})})};t.getText=function(){return this.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var t=TC.control.ScaleSelector.prototype;t.CLASS="tc-ctl-ss";TC.isDebug?t.template=TC.apiLocation+"TC/templates/ScaleSelector.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(e.get(["scales"],!1),e,{block:r},{}).w('</select> <input type="button" value="').f(e.get(["screenSize"],!1),e,"h").w("''\" title=\"").h("i18n",e,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}e.__dustBody=!0;function r(t,e){return t.w('<option value="').f(e.getPath(!0,[]),e,"h").w('"').h("eq",e,{block:n},{key:i,value:o}).w(">1:").h("math",e,{},{key:a,method:"round"}).w("</option>\n")}r.__dustBody=!0;function n(t,e){return t.w(' selected="true"')}n.__dustBody=!0;function i(t,e){return t.f(e.getPath(!0,[]),e,"h")}i.__dustBody=!0;function o(t,e){return t.f(e.get(["scale"],!1),e,"h")}o.__dustBody=!0;function a(t,e){return t.f(e.getPath(!0,[]),e,"h")}a.__dustBody=!0;return e};t.render=function(t){var e=this;return e._set1stRenderPromise(new Promise(function(r,n){if(e.map){!e.scales&&e.map.options.resolutions&&(e.scales=e.map.options.resolutions.map(e.getScale,e));var i=function(){e.scales=e.map.wrap.getResolutions().map(e.getScale,e);e.renderData({scale:e.getScale(),screenSize:TC.Cfg.screenSize,scales:e.scales},function(){e.div.querySelectorAll("option").forEach(function(t){t.textContent="1:"+e.format(t.textContent.substr(2))});e.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){e.setScreenSize()});e.div.querySelector("select").addEventListener("change",function(){e.setScale(this.value)});TC.Util.isFunction(t)&&t();r()}).catch(function(t){n(t instanceof Error?t:Error(t))})};e.scales?i():e.map.wrap.getMap().then(i)}else n(Error("ScaleSelector no registrado"))}))};t.setScale=function(t){var e=.0254*t/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(e/=window.devicePixelRatio);this.metersPerDegree&&(e/=this.metersPerDegree);this.map.wrap.setResolution(e);return e}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(t,e,r){var n=this;n.parent=r;n._featureTypes=[];TC.Util.extend(n,e);n.typeName=t;n._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};n.getFeatureTypes=function(t){if(t)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var e=this.featureType instanceof Array?this.featureType:[this.featureType],r=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=e.concat(r)}return this._featureTypes};n.isFeatureOfThisType=function(t){return this.getFeatureTypes().indexOf(t)>-1};n.getStyleByFeatureType=function(t){return this.getFeatureTypes().indexOf(t)>-1?this.styles[this.getFeatureTypes().indexOf(t)]:null};var i=function(t,e,r){var n=function(t,e,r){if(e){if(t.hasOwnProperty(e)&&t[e].hasOwnProperty(r))return t[e][r]}else for(var e in t)if(t[e].hasOwnProperty(r))return t[e][r]};if(r){return n(this.getStyleByFeatureType(r),e,t)}for(var i=0;i<this.styles.length;i++){var o=n(this.styles[i],e,t);if(o)return o}};n.getSuggestionListHead=function(){var t,e,r,n=this;if("function"==typeof n.suggestionListHead){t=n.suggestionListHead();e=t.label;r=[{color:t.color,title:t.label}]}else{t=n.suggestionListHead;e=n.parent.getLocaleString(t.label);if("string"==typeof t.color)r=[{color:i.call(n,t.color),title:e}];else if(t.color instanceof Array){var o=n.getFeatureTypes();t.color.length===o.length?r=t.color.map(function(t,r){return{color:i.call(n,t[o[r]].color.css,t[o[r]].color.geomType,o[r]),title:n.parent.getLocaleString(t[o[r]].title)||e}}):n._throwConfigError()}else"object"==typeof t.color&&(r=[{color:i.call(n,t.color.css,t.color.geomType),title:e}])}if(e&&r){var a='<li header><span class="header">'+e+"</span>";return a+=r.map(function(t){if(t.color)return'<span class="header-color" title="'+t.title+'" style="color: '+t.color+';"></span>'}).join("")+"</li>"}n._throwConfigError()};n.getSuggestionListElements=function(t){var e=this,r=[],n=function(t,e){switch(!0){case"number"==typeof t:if(t===e)return!0;break;case"string"==typeof t:if(isNaN(t)&&isNaN(e)){if(t.trim()===e.trim())return!0}else if(t===e)return!0}return!1},i=function(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e};e.parseFeatures(t).forEach(function(t){var o=[],a=[],s="",l=e.outputProperties,c=e.dataIdProperty,u=e.outputFormatLabel,h=t.id.split(".").slice(0,1).shift();if(!(e.outputProperties instanceof Array)){l=e.outputProperties[h];c=e.dataIdProperty[h];u=u[h]}for(var p=0;p<l.length;p++)o.push(t.data[l[p]]);for(p=0;p<c.length;p++)a.push(t.data[c[p]]);for(var d={},f=0;f<e.outputProperties.length;f++)d[e.outputProperties[f]]=o[f];o instanceof Array&&u&&i(o).length>1?s=u.tcFormat(o):o instanceof Array&&1==i(o).length&&(s=o[0]);var g=s.toCamelCase();(function(t){for(var e=0;e<r.length;e++){var i=0,o=[];for(var a in t){o.push(n(t[a],r[e].properties[a]));i++}if(o.filter(function(t){return t}).length===i)return!0}return!1})(d)||r.push({text:g,label:g,id:a.join("#"),dataRole:e.typeName,dataLayer:h,properties:d})});return r};n.parseFeatures=function(t){return(n.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:n.featurePrefix,featureType:n.featureType})).read(t)};n.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};n.filter=function(t){const e=function(e,r){var n=[];if(r!=t.parent.rootCfg.active.root)if(-1!==r.indexOf("#")||t.parent.rootCfg.active.limit)for(var i=r.split("#"),o=0;o<t.parent.rootCfg.active.dataIdProperty.length;o++){0==o&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(t.filter.getFilterNode(t.parent.rootCfg.active.dataIdProperty[o],i.length>o?i[o]:i[0]));o==t.parent.rootCfg.active.dataIdProperty.length-1&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}else{var a=t.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(e,n){return t.filter.getFilterNode(e,t.parent._LIKE_PATTERN+r+t.parent._LIKE_PATTERN)});if(a.length>1){n.push("<ogc:And>");(n=n.concat(a)).push("</ogc:And>")}else n=n.concat(a)}else{for(var s=0;s<t.parent.rootCfg.active.root.length;s++){i=t.parent.rootCfg.active.root[s];0==s&&t.parent.rootCfg.active.root.length>1&&n.push("<ogc:Or>");for(o=0;o<t.parent.rootCfg.active.dataIdProperty.length;o++){0==o&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(t.filter.getFilterNode(t.parent.rootCfg.active.dataIdProperty[o],i.length>o?i[o]:i[0]));o==t.parent.rootCfg.active.dataIdProperty.length-1&&t.parent.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}}t.parent.rootCfg.active.root.length>1&&n.push("</ogc:Or>")}return e.concat(n)};return{getPropertyValue:function(e,r){return t.getSearchTypeByRole(e)[r]},getIsLikeNode:function(e,r){var n=/([\-\"\.\xba\(\)\/])/g;n.test(r)&&(r=r.replace(n,"\\$1"));return r.toString().indexOf(t.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(e,r){var n=/([\-\"\xba\(\)\/])/g;n.test(r)&&(r=r.replace(n,"\\$1"));if(r.toString().indexOf(t.parent._LIKE_PATTERN)>-1){var i=r;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+e+"</ogc:PropertyName> <ogc:Literal>(?i)"+(i=(i=(i=(i=(i=i.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(e,r){var n,i=t.filter.getIsLikeNode;if(t.filterByMatch){i=t.filter.getFunctionStrMatches;var o=new RegExp("\\"+t.parent._LIKE_PATTERN,"gi");r=r.replace(o,t.parent._MATCH_PATTERN)}if(e instanceof Array||"string"==typeof e){if(e instanceof Array&&e.length>1){n="<ogc:Or>";for(l=0;l<e.length;l++)n+=i(e[l].trim(),r);return n+"</ogc:Or>"}return i(e instanceof Array&&1===e.length?e[0].trim():e.trim(),r)}var a=[];for(var s in e)if(e[s]instanceof Array&&e[s].length>1){n="<Or>";for(var l=0;l<e[s].length;l++)n+=i(e[s][l].trim(),r);n+="</Or>";a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+n+"</Filter>)")}else{var c=e[s];e[s]instanceof Array&&1==e[s].length&&(c=e[s][0]);a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+i(c.trim(),r)+"</Or></Filter>)")}return a.join("")},getFilter:function(r){var n={multiL:!1,f:""};switch(!0){case t.typeName===TC.Consts.searchType.NUMBER:o=[];if(t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}else{(i=/(\<|\>|\<\>)/gi.exec(r.t))?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(r.s))?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}o.push(t.filter.getFilterNode(t.queryProperties.thirdQueryWord,r.p+t.parent._LIKE_PATTERN));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===TC.Consts.searchType.STREET:o=[];if(t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}else{var i;(i=/(\<|\>|\<\>)/gi.exec(r.t))?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,r.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(r.s))?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN))}n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===TC.Consts.searchType.LOCALITY:n.f=t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN);n.multiL=!0;break;case t.queryProperties.hasOwnProperty("secondQueryWord"):var o;(o=[]).push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN));o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+r.s+t.parent._LIKE_PATTERN));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;default:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+r.t+t.parent._LIKE_PATTERN)+"</ogc:Filter>"}return n},getParams:function(e){var r=t.filter.getFilter(e),n={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:t.version,OUTPUTFORMAT:t.outputFormat},i=t.getFeatureTypes(!0);if(i instanceof Array){for(var o=[],a=0;a<i.length;a++)o.push(t.featurePrefix?t.featurePrefix+":"+i[a].trim():i[a].trim());n.TYPENAME=o.join(",")}else n.TYPENAME=t.featurePrefix?t.featurePrefix+":"+i.trim():i.trim();var s=function(t){if(""!==(t||"")){if(t instanceof Array)return t.join(",");var e=[];if(t instanceof Object)for(var r in t){var n=t[r][0];t[r].length>1&&(n=t[r].join(","));e.push(n)}return e}},l=s(t.outputProperties),c=s(t.dataIdProperty);if(l instanceof Array&&c instanceof Array){n.PROPERTYNAME="";for(a=0;a<l.length;a++)n.PROPERTYNAME+="("+l[a]+","+c[a]+")"}else n.PROPERTYNAME=l+","+c;n.FILTER=r.f;return TC.Util.getParamString(n)},getGoToFilter:function(e){var r=[],n=e.split("#"),i=t.dataIdProperty,o=t.getFeatureTypes();if(i&&o)if(e.indexOf("#")>-1&&o instanceof Array&&o.length>1)for(var a=0;a<o.length;a++)for(var s=0;s<i[o[a]].length;s++)r.push({name:i[o[a]][s],value:n[s]});else if(-1==e.indexOf("#")&&o instanceof Array){var l=i;for(a=0;a<o.length;a++)if(!r.hasOwnProperty(o[a])){l instanceof Object&&i.hasOwnProperty(o[a])&&(l=i[o[a]]);for(s=0;s<l.length;s++)s<n.length&&r.push({name:l[s],value:n[s]})}}else{i instanceof Object&&i.hasOwnProperty(o)&&(i=i[o]);for(a=0;a<i.length;a++)r.push({name:i[a],value:n[a]})}return t.filter.transformFilter(r)},transformFilter:function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(t&&t instanceof Array){var e=t.map(function(t){if(!t.hasOwnProperty("type"))return new TC.filter.equalTo(t.name,t.value);switch(!0){case t.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(t.name,t.value)}});return e.length>1?TC.filter.and.apply(null,e):e[0]}}}}(n)};TC.control.Search=function(){var t=this;TC.Control.apply(t,arguments);t.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";t.url="//idena.navarra.es/ogc/wfs";t.version="1.1.0";t.featurePrefix="IDENA";t.options&&t.options.url&&(t.url=t.options.url);t._LIKE_PATTERN="*";t._MATCH_PATTERN=".*";t.UTMX="X";t.UTMY="Y";t.LON="Lon";t.LAT="Lat";t.UTMX_LABEL="X: ";t.UTMY_LABEL="Y: ";t.LON_LABEL="Lon: ";t.LAT_LABEL="Lat: ";t.MUN="Mun";t.POL="Pol";t.PAR="Par";t.MUN_LABEL="Mun: ";t.POL_LABEL="Pol: ";t.PAR_LABEL="Par: ";t.availableSearchTypes={};t.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:t.getCadastralRef,goTo:t.goToCadastralRef,goToIdFormat:t.MUN+"{0}"+t.POL+"{1}"+t.PAR+"{2}",idPropertiesIdentifier:"#"};t.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:t.getCoordinates,goTo:t.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(e){return{label:t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||t.getLocaleString("search.list.coordinates")}}};t.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:t.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};t.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:t.goToStringPattern};t.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};t.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:t.getRoad,goTo:t.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};t.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0} "+t.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:t.getPK,goTo:t.goToPK,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+t.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};t.rootCfg={};t.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise(function(e,r){if(t.rootCfg.active&&!t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var n={SERVICE:"WFS"};n.VERSION=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;n.REQUEST="GetFeature";n.TYPENAME=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+t.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;n.OUTPUTFORMAT=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;n.PROPERTYNAME=["CMUNICIPIO"].concat(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");n.CQL_FILTER=t.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(t){return["CMUNICIPIO"].map(function(e,r){return e+"="+t[r]}).join(" AND ")});n.CQL_FILTER=n.CQL_FILTER.join(" OR ");TC.ajax({url:t.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+TC.Util.getParamString(n),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(r){const n=r.data;if(n.totalFeatures>0){t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=n.features.map(function(e){return{id:["CMUNICIPIO"].map(function(t){return e.properties[t]}).join("#"),label:e.properties[t.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).catch(function(){e([])})}else e(t.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)})}};t.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise(function(e,r){if(t.rootCfg.active&&!t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var n={SERVICE:"WFS"};n.VERSION=t.rootCfg[TC.Consts.searchType.LOCALITY].version;n.REQUEST="GetFeature";n.TYPENAME=t.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+t.rootCfg[TC.Consts.searchType.LOCALITY].featureType;n.OUTPUTFORMAT=t.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;n.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(t.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");n.CQL_FILTER=t.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(t){return["CMUNICIPIO","CENTIDAD"].map(function(e,r){return e+"="+t[r]}).join(" AND ")});n.CQL_FILTER=n.CQL_FILTER.join(" OR ");TC.ajax({url:t.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+TC.Util.getParamString(n),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(r){const n=r.data;if(n.totalFeatures>0){t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=n.features.map(function(e){return{id:["CMUNICIPIO","CENTIDAD"].map(function(t){return e.properties[t]}).join("#"),label:e.properties[t.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).catch(function(){e([])})}else e(t.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)})}};t.allowedSearchTypes=[];if(t.options.allowedSearchTypes)for(var e in t.options.allowedSearchTypes){if(t.availableSearchTypes[e]&&!TC.Util.isEmptyObject(t.options.allowedSearchTypes[e])){if(t.availableSearchTypes[e].renderFeatureType&&t.availableSearchTypes[e].renderFeatureType.length>0&&t.options.allowedSearchTypes[e].featureType&&!t.options.allowedSearchTypes[e].renderFeatureType){delete t.availableSearchTypes[e].renderFeatureType;t.availableSearchTypes[e].styles=t.availableSearchTypes[e].styles.slice(0,t.availableSearchTypes[e].styles.length-1)}TC.Util.extend(t.availableSearchTypes[e],t.options.allowedSearchTypes[e]);if(t.options.allowedSearchTypes[e].root&&e!=TC.Consts.searchType.MUNICIPALITY&&t.options.allowedSearchTypes[e].rootType==TC.Consts.searchType.MUNICIPALITY||e!=TC.Consts.searchType.LOCALITY&&t.options.allowedSearchTypes[e].rootType==TC.Consts.searchType.LOCALITY){t.rootCfg.active=t.rootCfg[t.options.allowedSearchTypes[e].rootType];t.rootCfg.active.root=t.options.allowedSearchTypes[e].root;t.rootCfg.active.limit=t.options.allowedSearchTypes[e].limit;t.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=t.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=t.rootCfg.active.dataIdProperty}}t.options.allowedSearchTypes[e]?t.addAllowedSearchType(e,t.availableSearchTypes[e]?t.availableSearchTypes[e]:t.options.allowedSearchTypes[e],t):delete t.options.allowedSearchTypes[e]}t.rootCfg.active&&t.rootCfg.active.getRootLabel();t.queryableFeatures=t.options.queryableFeatures||!1;t.UTMX_LEN=6;t.UTMY_LEN=7;t.wrap=new TC.wrap.control.Search(t);t.interval=500;t.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var t=TC.control.Search.prototype;t.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";TC.isDebug?t.template=TC.apiLocation+"TC/templates/Search.html":t.template=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",e,{},{$key:"search.placeholder"}).w('" title="').h("i18n",e,{},{$key:"search.instructions"}).w('" /><button title="').h("i18n",e,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",e,{},{$key:"search.2"}).w('</button><ul class="tc-ctl-search-list tc-hidden"></ul></div>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);e._search={data:[]};e.layerStyleFN=function(){function t(t){return t.indexOf(".")>-1?t.split(".")[0]:t}function r(r,n,i){var o=e.getSearchTypeByFeature(i);if(o){var a=o.getStyleByFeatureType(t(i));if(a&&a.hasOwnProperty(n))return a[n][r]}return TC.Cfg.styles[n][r]}return function(e,n,i,o){!TC.Feature||o instanceof TC.Feature||this.map.trigger(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:o.geom});var a=r(n,e,t(o.id));if(i){if(a instanceof Array){var s=a.map(function(t){return o.getData().hasOwnProperty(t)?o.getData()[t]:""}),l=this.getSearchTypeByFeature(t(o.id));return l?l.outputFormatLabel.tcFormat(s):s.join(" ")}return o.getData().hasOwnProperty(a)?o.getData()[a]:""}return a}}();var n=e.layerStyleFN;e.layerPromise=t.addLayer({id:e.getUID(),title:"B\xfasquedas",stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:n.bind(e,"polygon","fillColor",!1),fillOpacity:n.bind(e,"polygon","fillOpacity",!1),strokeColor:n.bind(e,"polygon","strokeColor",!1),strokeOpacity:n.bind(e,"polygon","strokeOpacity",!1),strokeWidth:n.bind(e,"polygon","strokeWidth",!1)},line:{strokeColor:n.bind(e,"line","strokeColor",!1),strokeOpacity:n.bind(e,"line","strokeOpacity",!1),strokeWidth:n.bind(e,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:n.bind(e,"point","radius",!1),height:n.bind(e,"point","height",!1),width:n.bind(e,"point","width",!1),fillColor:n.bind(e,"point","fillColor",!1),fillOpacity:n.bind(e,"point","fillOpacity",!1),strokeColor:n.bind(e,"point","strokeColor",!1),strokeWidth:n.bind(e,"point","strokeWidth",!1),fontSize:n.bind(e,"point","fontSize",!1),fontColor:n.bind(e,"point","fontColor",!1),labelOutlineColor:n.bind(e,"point","labelOutlineColor",!1),labelOutlineWidth:n.bind(e,"point","labelOutlineWidth",!1),label:n.bind(e,"point","label",!0),angle:n.bind(e,"point","angle",!0)}}}).then(function(t){e.layer=t;return t});e.EMPTY_RESULTS_LABEL=e.getLocaleString("noResults");e.EMPTY_RESULTS_TITLE=e.getLocaleString("checkCriterion");e.OUTBBX_LABEL=e.getLocaleString("outsideOfLimits");e.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"];return r};t.renderData=function(t,e){var r=this;r._search=r._search||{};var n=function(){r.search(r.textInput.value,function(t){if(1===t.length){r.textInput.value=t[0].label;r._goToResult(t[0].id,r.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));r.resultsList.classList.add(TC.Consts.classes.HIDDEN)}else 0===t.length&&r.resultsList.classList.add(TC.Consts.classes.HIDDEN)})};return TC.Control.prototype.renderData.call(r,t,function(){var t=function(){r.textInput.value=r.resultsList.label||r.resultsList.querySelector("li:not([header]) > a > span").textContent;r.lastPattern=r.textInput.value;r._goToResult(r.resultsList.id||unescape(r.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),r.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));r.resultsList.classList.add(TC.Consts.classes.HIDDEN)};r.textInput=r.div.querySelector("input.tc-ctl-search-txt");r.options&&r.options.placeHolder&&r.textInput.setAttribute("placeHolder",r.options.placeHolder.trim());r.resultsList=r.div.querySelector(".tc-ctl-search-list");r.button=r.div.querySelector(".tc-ctl-search-btn");r.button.addEventListener(TC.Consts.event.CLICK,function(){r.getLayer().then(function(e){r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(e.features.length>0?e.map.zoomToFeatures(e.features):1===r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?t():r.textInput.dispatchEvent(new Event("keyup")))})});if(r.options.instructions){r.textInput.setAttribute("title",r.options.instructions.trim());r.button.setAttribute("title",r.options.instructions.trim())}r.resultsList.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("a.tc-ctl-search-li-empty",function(){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.textInput.focus()}));r.textInput.addEventListener("keypress",function(e){if(13==e.which){e.preventDefault();e.stopPropagation();r.lastPattern="";1===r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?t():n();return!1}});r.textInput.addEventListener("search",function(){if(0===r.textInput.value.length){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);n()}});r.textInput.addEventListener("input",function(){if(0===r.textInput.value.length){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);n()}});r.textInput.addEventListener("targetCleared.autocomplete",function(){r.resultsList.classList.add(TC.Consts.classes.HIDDEN)});r.textInput.addEventListener("targetUpdated.autocomplete",function(){r.resultsList.querySelectorAll("li").length>0&&r.resultsList.classList.remove(TC.Consts.classes.HIDDEN)});r.lastPattern="";r.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){var t;TC.UI.autocomplete.call(r.textInput,{link:"#",target:r.resultsList,minLength:2,ctx:r,source:function(e,n){r.lastpress=performance.now();t||(t=requestAnimationFrame(function e(){var i=r.textInput.value.trim();if(i.length>0&&(!r.lastPattern||i!=r.lastPattern)&&performance.now()-r.lastpress>r.interval){window.cancelAnimationFrame(t);t=void 0;r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.lastPattern=i;r.search(i,n)}else t=requestAnimationFrame(e)}))},callback:function(t){var e=t.target;"a"!==t.target.tagName.toLowerCase()&&(e=function(t,e){const r=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;for(;t;){if(r.call(t,e))return t;t=t.parentElement}return null}(t.target,"a"));if(e.querySelector("span[hidden]")){r.textInput.value=e.querySelector("span[hidden]").textContent;r.lastPattern=r.textInput.value;r._goToResult(unescape(e.getAttribute("href")).substring(1),e.parentNode.getAttribute("dataRole"));TC.UI.autocomplete.call(r.textInput,"clear")}},buildHTML:function(t){var e=[],n=[],i=/[^a-zA-Z]/g,o=/[^0-9]/g;function a(t,e){var r=parseInt(t,10),n=parseInt(e,10);if(isNaN(r)&&isNaN(n)){var a=t.replace(i,""),s=e.replace(i,"");if(a===s){var l=parseInt(t.replace(o,""),10),c=parseInt(e.replace(o,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return isNaN(r)?1:isNaN(n)?-1:r>n?1:-1}var s=t.results.sort(function(t,e){return this.ctx.getSearchTypeByRole(t.dataRole).searchWeight&&this.ctx.getSearchTypeByRole(e.dataRole).searchWeight?(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)>(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)<(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:a(t.label,e.label):t.dataRole>e.dataRole?1:t.dataRole<e.dataRole?-1:a(t.label,e.label)}.bind(this));r.rootCfg.active&&(s=s.sort(function(t,e){const r=function(){var r,n,i=this.rootCfg.active.root[0]instanceof Array?this.rootCfg.active.root[0].join("-"):this.rootCfg.active.root[0];if(t.properties&&t.properties.length>0&&e.properties&&e.properties.length>0){r=this.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-");n=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-")}else{r=t.id;n=e.id}return r!==i&&n===i?1:r===i&&n!==i?-1:a(t.label,e.label)}.bind(this);return this.getSearchTypeByRole(t.dataRole).searchWeight&&this.getSearchTypeByRole(e.dataRole).searchWeight?(this.getSearchTypeByRole(t.dataRole).searchWeight||0)>(this.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(this.getSearchTypeByRole(t.dataRole).searchWeight||0)<(this.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:r():r()}.bind(r)));for(var l=0;l<s.length;l++){var c=s[l];if(-1==n.indexOf(c.dataRole)){var u=this.ctx.getSearchTypeByRole(c.dataRole);e[e.length]=u.getSuggestionListHead();n.push(c.dataRole)}const t=function(){c.label;var t=[];0===this.ctx.lastPattern.trim().length&&r.textInput.value.trim().length>0&&(this.ctx.lastPattern=r.textInput.value.trim());var e=this.ctx.lastPattern,n=[],i=",";-1==(e=r.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(r.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(r.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(i)&&(i=" ");n=e.trim().split(i);if(c.label.indexOf(this.ctx.LAT_LABEL)>-1&&c.label.indexOf(this.ctx.LON_LABEL)>-1||c.label.indexOf(this.ctx.UTMX_LABEL)>-1&&c.label.indexOf(this.ctx.UTMY_LABEL)>-1){n=this.ctx.lastPattern.split(" ");for(var o=0;o<n.length;o++)","==n[o].trim().slice(-1)&&(n[o]=n[o].slice(0,-1))}for(var a=0;a<n.length;a++)if(n[a].trim().length>0){t.push("("+n[a].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(u=/((\<)|(\>)|(\<\>))/gi.exec(n[a].trim()))for(var s=n[a].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),l=0;l<s.length;l++)s[l].trim().length>0&&t.push("("+s[l].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(c.dataRole==TC.Consts.searchType.ROAD||c.dataRole==TC.Consts.searchType.ROADPK){var u;if(u=r.getSearchTypeByRole(c.dataRole).getPattern().exec(this.ctx.lastPattern)){t=[];u[2]&&u[3]&&u[4]?t.push("("+u[2]+"-"+u[3]+"-"+u[4]+")"):u[2]&&u[3]?t.push("("+u[2]+"-"+u[3]+")"):u[3]&&u[4]?t.push("("+u[3]+"-"+u[4]+")"):(u[2]||u[3])&&t.push("("+(u[2]||u[3])+")");u[5]&&t.push("(?:"+r.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}else u&&u[5]&&(t=[]).push("(?:"+r.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}var h="("+t.join("|")+")";h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=h.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var p=new RegExp(h,"gi"),d=c.label;return c.dataRole!==TC.Consts.searchType.ROAD||c.dataRole!==TC.Consts.searchType.ROADPK?d.replace(p,function(){var t=Array.prototype.slice.call(arguments,0);return t[t.length-3]?t[0].replace(t[t.length-3],"<b>"+t[t.length-3]+"</b>"):"<b>"+t[0]+"</b>"}):d.replace(p,"<b>$1</b>")}.bind(this);e[e.length]='<li dataRole="'+c.dataRole+'"><a href="#'+encodeURIComponent(c.id)+'"><span hidden>'+c.label+"</span>"+t()+"</a></li>"}return e.join("")}});const e=function(t){if(!t.ctrlKey&&!t.altKey&&!t.shiftKey)if(40===t.keyCode){r.textInput==document.activeElement&&r.resultsList.querySelector("li:not([header]) a")?r.resultsList.querySelector("li:not([header]) a").focus():r.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?r.textInput.focus():function(t,e){var r=t.nextElementSibling;if(!e)return r;for(;r;){if(r.matches(e))return r;r=r.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();t.preventDefault();t.stopPropagation()}else if(38===t.keyCode){r.textInput==document.activeElement?r.resultsList.querySelector("li:not([header]):last-child a").focus():document.activeElement==r.resultsList.querySelector("li:not([header]) a")?r.resultsList.querySelector("li:not([header]):last-child a").focus():function(t,e){var r=t.previousElementSibling;if(!e)return r;for(;r;){if(r.matches(e))return r;r=r.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();t.preventDefault();t.stopPropagation()}t.stopPropagation()};r.textInput.addEventListener("keydown",e);r.resultsList.addEventListener("keydown",e)});TC.Util.isFunction(e)&&e()})};t.addAllowedSearchType=function(t,e){this.allowedSearchTypes.push(new SearchType(t,e,this))};t.getSearchTypeByRole=function(t){return this.allowedSearchTypes.filter(function(e){return e.typeName==t})[0]};t.getSearchTypeByFeature=function(t){var e=this.allowedSearchTypes.filter(function(e){return e.isFeatureOfThisType(t)});return e.length>0?e[0]:null};t.getElementOnSuggestionList=function(t,e){const r=this;for(var n=0;n<r._search.data.length;n++)if(r._search.data[n].id==t&&(!e||e&&r._search.data[n].dataRole===e))return r._search.data[n]};t.getLayer=function(){return this.layerPromise};t.getFeatures=function(){return this.layer.features};t.cleanMap=function(){const t=this;if(t.layer){const n=t.layer;var e=n.features.slice();n.clearFeatures();t.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:n,feature:e});for(var r=0;r<t.WFS_TYPE_ATTRS.length;r++)n.hasOwnProperty(t.WFS_TYPE_ATTRS[r])&&delete n[t.WFS_TYPE_ATTRS[r]]}};t.getMunicipalities=function(){var t=this;TC.cache.search=TC.cache.search||{};t._municipalitiesPromise=new Promise(function(e,r){if(TC.cache.search.municipalities)e(TC.cache.search.municipalities);else{var n=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(n.municipality&&n.municipality.featureType&&n.municipality.labelProperty&&n.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+n.typeName+". Error en el objeto municipality");var i={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:n.municipality.featureType,VERSION:n.version,PROPERTYNAME:n.municipality.labelProperty+","+n.municipality.idProperty,OUTPUTFORMAT:n.outputFormat};n.featurePrefix&&(i.TYPENAME=n.featurePrefix+":"+i.TYPENAME);var o=n.url+"?"+TC.Util.getParamString(i);TC.ajax({url:o,method:"GET",responseType:"text"}).then(function(t){const r=t.data;var i=(n.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:n.municipality.featurePrefix,featureType:n.municipality.featureType})).read(r);TC.cache.search.municipalities=[];for(var o=0;o<i.length;o++){var a=i[o];TC.cache.search.municipalities.push({label:a.data[n.municipality.labelProperty],id:a.data[n.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(t,e){return t.label<e.label?-1:t.label>e.label?1:0});e(TC.cache.search.municipalities)}).catch(function(){e()})}});return t._municipalitiesPromise};t.getCoordinates=function(t){const e=this;return new Promise(function(r,n){var i=t.match(new RegExp("^"+e.UTMX_LABEL.trim().toLowerCase()+"*\\s*([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+e.UTMY_LABEL.trim().toLowerCase()+"*\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$"));i&&(t=i[1]+" "+i[2]);(i=t.match(new RegExp("^"+e.LAT_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+e.LON_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=i[1]+" "+i[3]);if(/\d/.test(t)&&(new RegExp("^([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(t)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(t))){if((i=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(t))&&(i[1].indexOf(",")>-1||i[3].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[3]=i[3].replace(",",".");t=i[1]+" "+i[3]}if(!i||i&&(i[1].indexOf(",")>-1?i[1].replace(",","."):i[1])<=180&&(i[3].indexOf(",")>-1?i[3].replace(",","."):i[3])<=90){if((i=new RegExp("^([0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(t))&&(i[1].indexOf(",")>-1||i[2].indexOf(",")>-1)){i[1]=i[1].replace(",",".");i[2]=i[2].replace(",",".");t=i[1]+" "+i[2]}t=t.replace(e.UTMX_LABEL,"").replace(e.UTMY_LABEL,"").replace(e.LON_LABEL,"").replace(e.LAT_LABEL,"");var o=TC.Util.parseCoords(t);if(o){var a=o[0].value,s=o[1].value,l=o[0].type===TC.Consts.UTM?e.UTMX:e.LAT,c=o[1].type===TC.Consts.UTM?e.UTMY:e.LON,u=l+a+c+s,h=e.getPoint(u);if(h&&!e.insideLimit(h)){a=o[1].value;s=o[0].value;u=(l=o[1].type===TC.Consts.UTM?e.UTMX:e.LAT)+a+(c=o[0].type===TC.Consts.UTM?e.UTMY:e.LON)+s;h=e.getPoint(u)}if(h){e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(u)?e.getLocaleString("search.list.coordinates.utm")+e.map.crs:e.getLocaleString("search.list.coordinates.geo");r([{id:u,label:e.getLabel(u),dataRole:TC.Consts.searchType.COORDINATES}])}else r([])}else r([])}else r([])}else r([])})};t.getCadastralRef=function(t){const e=this;return new Promise(function(r,n){var i=t.match(new RegExp(e.MUN_LABEL.trim().toLowerCase()+"?\\s(.*)\\,\\s?"+e.POL_LABEL.trim().toLowerCase()+"?\\s(\\d{1,2})\\,\\s?"+e.PAR_LABEL.trim().toLowerCase()+"?\\s(\\d{1,4})"));i&&(t=i[1]+", "+i[2]+", "+i[3]);var o=t;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(t)&&e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(o=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+t);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(o)&&!new RegExp("^([0-9]{"+e.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+e.UTMY_LEN+"})$").test(t)?e.getMunicipalities().then(function(t){var n=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(o);if(n){var i=new RegExp(n[1].trim().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),a=[];const o=function(t,r,n,i){var o=[];o.push[e.MUN]=t;o.push[e.POL]=n;o.push[e.PAR]=i;return{id:e.MUN+t+e.POL+n+e.PAR+i,label:e.getLabel(e.MUN+r+e.POL+n+e.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL,properties:o}};if((a=t.filter(function(t){t=t.label||t.id||t;return i.test(t)||i.test(e.removePunctuation(t))})).length>0)for(var s=0;s<a.length;s++)a[s]=o(a[s].id,a[s].label,n[2].trim(),n[3].trim());if(/^[0-9]*$/g.test(n[1])){if(n[1].trim()===e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var l=t.filter(function(t){return parseInt(t.id)===parseInt(e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];l&&r([o(l.id,l.label,n[2].trim(),n[3].trim())])}a.push(o(n[1].trim(),n[1].trim(),n[2].trim(),n[3].trim()))}r(a)}}):r([])})};t.stringPatternsValidators={tsp:function(t,n,i,o){var a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(a&&a[1]&&a[2]){var s=function(){return e((a[3]||a[4]||a[5]||a[6]).trim())};if(/^([^0-9]+)$/i.test(a[1].trim())&&/^([^0-9]+)$/i.test(a[2].trim())){n.push({t:a[1].trim(),s:a[2].trim(),p:s()});n.push({t:a[2].trim(),s:a[1].trim(),p:s()})}else/^([^0-9]+)$/i.test(a[1].trim())?n.push({t:a[1].trim(),s:a[2].trim(),p:s()}):n.push({s:a[1].trim(),t:a[2].trim(),p:s()});r.call(this,n,i,o);return!0}return!1},spt:function(t,n,i,o){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(a&&a[6]&&a[1]){var s=function(){return e((a[2]||a[3]||a[4]||a[5]).trim())};if(/^([^0-9]+)$/i.test(a[6].trim())&&/^([^0-9]+)$/i.test(a[1].trim())){n.push({t:a[6].trim(),s:a[1].trim(),p:s()});n.push({t:a[1].trim(),s:a[6].trim(),p:s()})}else/^([^0-9]+)$/i.test(a[6].trim())?n.push({t:a[6].trim(),s:a[1].trim(),p:s()}):n.push({s:a[6].trim(),t:a[1].trim(),p:s()});r.call(this,n,i,o);return!0}return!1},tnsp:function(t,n,i,o){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(a&&a[1]&&a[2]){n.push({t:a[2].trim(),s:a[1].trim(),p:e((a[3]||a[4]||a[5]||a[6]).trim())});r.call(this,n,i,o);return!0}return!1},ts:function(t,e,n,i){var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(t);if(!o&&/^[^0-9]*$/i.test(t.trim())){var a=t.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(o&&o[1]&&o[2]){if(/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim())){e.push({t:o[1].trim(),s:o[2].trim()});e.push({s:o[1].trim(),t:o[2].trim()});r.call(this,e,n,i)}else{var s=function(t){for(var e=t.split(" ").reverse(),r=[],n=0;n<e.length;n++)if(1==e[n].length){r.push(e[n]);e[n]=""}return r.length>0?e.reverse().join(" ").trim()+self._LIKE_PATTERN+r.reverse().join(self._LIKE_PATTERN):e.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(o[1].trim())?e.push({t:o[1].trim(),s:s(o[2].trim())}):e.push({s:s(o[1].trim()),t:o[2].trim()});r.call(this,e,n,i,!0)}return!0}return!1},st:function(t,n,i,o){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(!a){var s=t.split(",").reverse();a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(s.join(","))}if(a){for(var l={},c=(s=t.split(",").reverse(),0);c<s.length;c++)if(/^([^0-9\,]+)$/i.test(s[c].trim()))l.t=s[c].trim();else if(/(\s*\d+)/i.test(s[c].trim()))if(-1==s[c].trim().indexOf(" "))l.s=s[c].trim();else{for(var u=s[c].trim().split(" ").reverse(),h=function(t){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t.trim())){l.p=e(t.trim());return!0}return!1},p=0,d=u[p].trim();p<u.length&&!h(d);)++p<u.length&&(d+=u[p]);if(l.p){for(var f=u,g=0;g<f.length;g++){for(var y=!1,m=0;m<f[g].split("").length;m++)l.p.indexOf(f[g][m])>-1&&(y=!0);if(y){f[g];f[g]="";if(l.p==e(d))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(u.reverse().join(" ").trim())){for(var C=[],v=u.reverse(),T=0;T<v.length;T++)if(1==v[T].trim().length){C.push(v[T].trim());v[T]=""}l.s=C.length>0?v.reverse().join(" ").trim()+self._LIKE_PATTERN+C.reverse().join(self._LIKE_PATTERN):v.reverse().join(" ").trim()}n.push({t:l.t,s:l.s+" "+l.p})}else l.s=s[c].trim()}n.push(l);r.call(this,n,i,o);return!0}return!1},s_or_t:function(t,e,r,n){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(t);if(i&&i[1]){if(r){e.push({t:i[1].trim()});e.push({t:r,s:i[1].trim()})}else e.push({t:i[1].trim()});return!0}return!1},sp:function(t,r,n,i){var o=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(o&&o[1]&&o[2]){n?r.push({t:n,s:o[1].trim(),p:e(o[2].trim())}):r.push({t:o[1].trim(),s:o[2].trim()});return!0}return!1},snp:function(t,r,n,i){var o=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);if(o&&o[1]&&o[2]&&n){r.push({t:n,s:o[1].trim(),p:e(o[2].trim())});return!0}return!1}};const e=function(t){for(var e=[function(t){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(t)},function(t){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(t)},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.test(t)},function(t){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(t)}],r=[function(t){var e=[],r=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(t);if(r){for(var n=1;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e.join(self._LIKE_PATTERN)}return t},function(t){var e=[],r=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(t);if(r){for(var n=1;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e.join(self._LIKE_PATTERN)}return t},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(t)?"s*n":t},function(t){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);return t}],n=0;n<r.length&&!e[n].call(self,t);)n++;return n<r.length?r[n].call(self,t):t},r=function(t,e,r,n){const i=this;if(e)for(var o=t.length;o--;)if(n)t.push(TC.Util.extend({},t[o],{t:e}));else if(t[o].t){var a=i.rootCfg.active.rootLabel.filter(function(e){return e.label.indexOf(i.removePunctuation(t[o].t).toLowerCase())>-1}.bind(i));1==a.length?t[o].t=a[0].id:a.length>1?a.map(function(e){var r=TC.Util.extend({},t[o]);r.t=e.id;t.push(r)}):0==a.length&&r&&t.splice(o,1)}},n=function(t,e){const r=this,n=r.rootCfg.active&&r.rootCfg.active.root||"",i=r.rootCfg.active&&r.rootCfg.active.limit||!1;var o=[];","==(e=e.trim()).charAt(e.length-1)&&(e=e.substring(0,e.length-1));if(function(){for(var t=[function(t){return t.length>=3},function(t){return!/^\d+$/.test(t)&&!/^\d+\,\s*\d+$/.test(t)}],n=0;n<t.length;n++)if(!t[n].call(r,e))return!1;return!0}()){var a=[];if(0===(a=t.map(function(t){return r.getSearchTypeByRole(t)}).filter(function(t){return t.stringPatternToCheck}).map(function(t){return t.stringPatternToCheck})).length){a=[r.stringPatternsValidators.tsp,r.stringPatternsValidators.spt,r.stringPatternsValidators.tnsp,r.stringPatternsValidators.ts,r.stringPatternsValidators.st];a=n&&e.split(",").length<3?[r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t].concat(a):a.concat([r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t])}var s=0;try{for(;s<a.length&&!a[s].call(r,e,o,n,i);)s++}catch(t){TC.error("Error seg\xfan el patr\xf3n: "+e,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return o}return null},i=function(t,e,r,n){const i=this;if(n){var o=[];i._search.data=o;i.request||(i.request=[]);n.forEach(function(e,r){t.filter(function(t){var r=i.getSearchTypeByRole(t);return Object.keys(r.queryProperties).length===Object.keys(e).length}).map(function(t){var r=i.getSearchTypeByRole(t);i.request.push(function(t,e,r){this.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+this.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';this.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));return TC.ajax({url:t.url,method:"POST",responseType:"text",data:t.filter.getParams(r)}).then(e).catch(function(t){"abort"!==t.statusText&&alert("error")})}.call(i,r,function(t){o=o.concat(r.getSuggestionListElements(t.data))},e))})});Promise.all(i.request).then(function(){e(o)})}else e([])};t.getStringPattern=function(t,e){const r=this;return new Promise(function(o,a){e=function(t){t=this.removePunctuation(t);return(t=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(r,e);var s=/(.*)\((.*)\)/.exec(e);if(s&&s.length>2){var l=n.call(r,t,s[1]),c=n.call(r,t,s[1]+","+s[2]);c=(c||[]).concat(l||[]);i.call(r,t,o,a,c)}else{l=n.call(r,t,e);i.call(r,t,o,a,l)}})};t.getRoad=function(t){const e=this;return new Promise(function(r,n){if((t=t.trim()).length<2)r([]);else{var i=e.getSearchTypeByRole(TC.Consts.searchType.ROAD),o=i.getPattern().exec(t);if(o&&o[3]){var a=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(a=a+"-"+o[4].trim());e.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:i.url+"?"+i.filter.getParams({t:a}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(t){const e=t.data;var n=[];if(e.totalFeatures>0){e.features.map(function(t){var e=i.outputProperties;if(!n.some(function(r){return r.text==t.properties[e[0]]})){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(e){return t.properties[e]})),o=i.outputProperties.map(function(e){return t.properties[e]}).join("-");n.push({id:i.dataIdProperty.map(function(e){return t.properties[e]}).join("#"),label:r,text:o,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}});r(n)}else r([])}).catch(function(t){r([])})}else r([])}})};t.getPK=function(t){var e=this;return new Promise(function(r,n){if((t=t.trim()).length<3)r([]);else{var i=e.getSearchTypeByRole(TC.Consts.searchType.ROADPK),o=i.getPattern().exec(t);if(o&&o[3]&&o[5]){var a=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(a=a+"-"+o[4].trim());e.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:i.url+"?"+i.filter.getParams({t:a,s:o[5].trim()}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(t){const e=t.data;var n=[];if(e.totalFeatures>0){e.features.map(function(t){var e=i.outputProperties;if(!n.some(function(r){return r.label==t.properties[e[0]]})){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map(function(e){return t.properties[e]}));n.push({id:i.dataIdProperty.map(function(e){return t.properties[e]}).join("#"),label:r,text:r,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}});r(n)}else r([])}).catch(function(t){r([])})}else r([])}})};t.search=function(t,e){var r=this,n=[];if(r.request){for(var i=0;i<r.request.length;i++)console.log("new criteria: search promise/s aborted");r.request=[]}if((t=t.trim()).length>0){t=t.toLowerCase();var o=[];r.allowedSearchTypes.forEach(function(e){e.parser?(i=e.parser,o.push(new Promise(function(e,o){i.call(r,t).then(function(t){n=n.concat(t);e(n)})}))):console.log("Falta implementaci\xf3n del m\xe9todo parser");var i});Promise.all(o).then(function(){n&&(r._search.data=n=n.sort(function(t,e){var r,n=/(\d+)/,i="";if(n.test(t.label)&&n.test(e.label)){r=t.label.match(n)[1];i=e.label.match(n)[1]}else{r=t.label;i=e.label}return r>i?1:r<i?-1:0}.bind(r)));e&&e(n);if(0===n.length){r.cleanMap();if(!r.layer||r.layer&&0===r.layer.features.length){r.resultsList.innerHTML='<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>";r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"))}}r.lastPattern=""})}else r.cleanMap()};t._goToResult=function(t,e){var r=this,n=null;return new Promise(function(i,o){r.loading||(r.loading=r.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var a;a=r.loading.addWait();if(matchMedia("(max-width: 30em)").matches){r.textInput.blur();r.map.trigger(TC.Consts.event.TOOLSCLOSE)}r.cleanMap();var s=!1,l=!0;r.allowedSearchTypes.forEach(function(i){if(l)if(r.availableSearchTypes[i.typeName]){var o=e||r.getElementOnSuggestionList.call(r,t).dataRole;if(o){var a=r.getSearchTypeByRole(o);if(r.availableSearchTypes[o]&&a&&a.goTo)null!==(n=a.goTo.call(r,t,o))&&(l=!1);else if(!r.availableSearchTypes[o]&&a&&a.goTo){s=!0;null!==(n=a.goTo.call(r,t,o))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(i.goTo){s=!0;null!==(n=i.goTo.call(r,t))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});r.loading.removeWait(a);if(n){r.getLayer().then(function(t){switch(!0){case n.params.type==TC.Consts.layerType.VECTOR:for(var e=0;e<r.WFS_TYPE_ATTRS.length;e++)t.hasOwnProperty(r.WFS_TYPE_ATTRS[e])&&delete t[r.WFS_TYPE_ATTRS[e]];break;case n.params.type==TC.Consts.layerType.WFS:for(e=0;e<r.WFS_TYPE_ATTRS.length;e++)t[r.WFS_TYPE_ATTRS[e]]=n.params[r.WFS_TYPE_ATTRS[e]];a=r.loading.addWait()}t.type=n.params.type;r.map.on(TC.Consts.event.FEATURESADD,function(t){t.layer===r.layer&&function(t){if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].showsPopup!=this.queryableFeatures&&(t[e].showsPopup=this.queryableFeatures)}.call(r,t.features)});t.refresh().then(function(){r.map.one(TC.Consts.event.LAYERUPDATE,function(e){if(e.layer==t){r.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==t){if(!e.layer.features||0==e.layer.features.length&&e.layer.wrap.layer.getSource().getFeatures()){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);var i=e.layer.wrap.layer.getSource().getExtent(),o=e.layer.map.options.pointBoundsRadius;if(i[2]-i[0]==0){i[0]=i[0]-o;i[2]=i[2]+o}if(i[3]-i[1]==0){i[1]=i[1]-o;i[3]=i[3]+o}e.layer.map.setExtent(i);r.map.trigger(TC.Consts.event.ZOOMTO,{extent:i,layer:e.layer})}else if(e.layer.features&&e.layer.features.length>0){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.layer.map.zoomToFeatures(e.layer.features);r.map.trigger(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features})}else if(e.layer.features&&0==e.layer.features.length&&n.params.type==TC.Consts.layerType.WFS){r.resultsList.inner=n.emptyResultHTML;r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}r.loading.removeWait(a)}});if(e.layer.features&&e.layer.features.length>0){r.resultsList.classList.add(TC.Consts.classes.HIDDEN);r.layer.map.zoomToFeatures(r.layer.features);r.map.trigger(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features});r.loading.removeWait(a)}else if(e.layer.features&&0==e.layer.features.length&&n.params.type==TC.Consts.layerType.WFS){r.resultsList.innerHTML=n.emptyResultHTML;r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));e.newData&&e.newData.features&&e.newData.features.length>0||r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);r.loading.removeWait(a)}}})})});i(n)}else{o();s||r.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}})};t.goToResult=function(t,e){if(this.getSearchTypeByRole(e))return this._goToResult(t,e);if(this.availableSearchTypes[e]){this.addAllowedSearchType(e,this.availableSearchTypes[e],this);return this._goToResult(t,e)}alert("No se reconoce el tipo de b\xfasqueda: "+e)};t.goToCoordinates=function(t){var e={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(t)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(t)){e.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};e.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(t){var e=this;wait=e.loading.addWait();var r,n,i=e.getPoint(t);if(i){r=e.getLabel(t);n=e.layer.addMarker(i,TC.Util.extend({},e.map.options.styles.point,{title:r,group:r}))}else{var o=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(t);t=e.LAT+o[2]+e.LON+o[1];if(i=e.getPoint(t)){r=e.getLabel(t);n=e.layer.addMarker(i,TC.Util.extend({},e.map.options.styles.point,{title:r,group:r}));e.textInput.value=r}}n.then(function(t){e.map.trigger(TC.Consts.event.FEATURESADD,{layer:e.layer,features:[t]});e.map.zoomToFeatures([t]);e.loading.removeWait(wait)})}).call(this,t);return e}return null};t.goToCadastralRef=function(t){var e={},r=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(r.test(t)){var n=r.exec(t);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var i=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);e.params={type:TC.Consts.layerType.WFS,url:i.url,version:i.version,geometryName:i.geometryName,featurePrefix:i.featurePrefix,featureType:i.featureType,properties:new TC.filter.and(new TC.filter.equalTo(i.queryProperties.firstQueryWord,n[1].trim()),new TC.filter.equalTo(i.queryProperties.secondQueryWord,n[2].trim()),new TC.filter.equalTo(i.queryProperties.thirdQueryWord,n[3].trim())),outputFormat:i.outputFormat,styles:i.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e}return null};t.goToRoad=function(t){var e={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);e.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(t),outputFormat:r.outputFormat,styles:r.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e};t.goToPK=function(t){var e={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);e.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(t),outputFormat:r.outputFormat,styles:r.styles};e.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return e};t.goToStringPattern=function(t,e){var r={},n=this.getSearchTypeByRole(e);r.params={type:TC.Consts.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(t),outputFormat:n.outputFormat,styles:n.styles};return r};t.getPoint=function(t){var e,r=this.map.wrap.isGeo(),n=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(t);if(n&&3===n.length){e=[parseFloat(n[1]),parseFloat(n[2])];r&&(e=TC.Util.reproject(e,this.map.options.utmCrs,this.map.crs))}else{if((n=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===n.length){e=[parseFloat(n[2]),parseFloat(n[1])];if(!r)return TC.Util.reproject(e,this.map.options.geoCrs,this.map.crs)}if((n=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===n.length){e=[parseFloat(n[2]),parseFloat(n[1])];if(!r)return TC.Util.reproject(e,this.map.options.geoCrs,this.map.crs)}}return e};t.insideLimit=function(t){return!!function(t,e){return!(t instanceof Array)||e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]}(this.map.options.maxExtent,t)};t.getPattern=function(){return this.textInput.value};t.getLabel=function(t){var e=t,r=TC.Util.getMapLocale(this.map);if(t.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(i=(e=e.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+this.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+this.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=(e=e.replace(i[1],parseFloat(i[1]).toLocaleString(r))).replace(i[3],parseFloat(i[3]).toLocaleString(r)));var n=1.1.toLocaleString(r).substring(1,2);if(i=e.match(new RegExp("^"+this.UTMX_LABEL.trim()+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+this.UTMY_LABEL.trim()+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(i[1]))||(e=e.replace(i[1],i[1].replace(".",n)));Number.isInteger(parseFloat(i[2]))||(e=e.replace(i[2],i[2].replace(".",n)))}}else if(t.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(i=(e=e.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+this.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+this.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=(e=e.replace(i[1],parseFloat(i[1]).toLocaleString(r))).replace(i[3],parseFloat(i[3]).toLocaleString(r)))}else if(t.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var i=t.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));e=this.MUN_LABEL+i[2]+", "+this.POL_LABEL+i[4]+", "+this.PAR_LABEL+i[6]}return e};t.removePunctuation=function(t){t=t||"";for(var e=new Array(t.length),r={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},n=0,i=t.length;n<i;n++)e[n]=r[t.charAt(n)]||t.charAt(n);return e.join("")};t.exportState=function(){const t=this;return t.exportsState?{id:t.id,searchText:t.textInput.value,layer:t.layer.exportState({exportStyles:!1})}:null};t.importState=function(t){const e=this;e.textInput.value=t.searchText;e.layer.importState(t.layer).then(function(){e.layer.features.forEach(function(t){t.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var t=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(e,r){return void 0!==t[r]?t[r]:e})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(t){for(var e=[],r=this.split(t),n=0;n<r.length;n++)r[n].trim().length>0&&e.push(r[n].trim());return e});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var t=this.toLowerCase(),e=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(e)for(var r=0;r<e.length;r++)/[-;:.<>\{\}\[\]\/\s()]/g.test(e[r])&&(t=t.replace(e[r],e[r].toUpperCase()));return t.charAt(0).toUpperCase()+t.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(t,e){for(var r=0;r<this.length;r++)if(this[r][t]==e)return this[r]}});String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var r=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>r.length)&&(e=r.length);e-=t.length;var n=r.indexOf(t,e);return-1!==n&&n===e});TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.SelectContainer=TC.control.TabContainer;TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(t){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var t=TC.control.Share.prototype;t.CLASS="tc-ctl-share";t.MAILTO_MAX_LENGTH=256;t.IFRAME_WIDTH="600px";t.IFRAME_HEIGHT="450px";t.FEATURE_PARAM="showfeature";t.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";t.NAVALERT=" +D para guardar en marcadores.";t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.render.call(e,function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){e.div.querySelectorAll("button").forEach(function(t){t.classList.remove("hide")});e.div.querySelectorAll("input[type=text]").forEach(function(t){delete t.dataset.dataOriginalTitle})}TC.Util.detectMobile()||e.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const r=e.div.querySelectorAll("."+e.CLASS+"-url-box");e.div.querySelectorAll("span:not(.tc-beta)").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=this;e&&"LABEL"!==e.tagName;)e=e.parentElement;const n=e.querySelector("input[type=radio][name=format]").value;r.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches(".tc-"+n))})})});TC.Util.isFunction(t)&&t()})})};t.getLocation=function(){var t=window.location.href;window.location.hash&&(t=t.substr(0,t.indexOf(window.location.hash)));return t};t.manageMaxLengthExceed=function(t){this.div.querySelector("."+this.CLASS+"-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.browser);this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.qr)};t.generateIframe=function(t){var e=t||this.generateLink();if(e)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+e+'"></iframe>'};t.loadParamFeature=function(){const t=this;var e=null,r=TC.Util.getParameterByName(t.FEATURE_PARAM);if(r){var n;try{n=JSON.parse(decodeURIComponent(escape(window.atob(r))))}catch(e){TC.error(t.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}n&&t.map&&(n.geom?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then(function(e){t.paramFeatureLayer=e;e.importState({features:[n]}).then(function(){t.map.zoomToFeatures(e.features)})}):e=n)}return e};t.register=function(e){const r=this,n=TC.control.MapInfo.prototype.register.call(r,e);r.exportsState=!0;r.MOBILEFAV=r.getLocaleString("mobileBookmarks.instructions");r.NAVALERT=r.getLocaleString("bookmarks.instructions");var i=function(t){const e=t.parentElement.querySelector("input[type=text]");e.value=e.classList.contains("tc-url")?r.generateLink():r.generateIframe();e.select()};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){const e=r.generateLink();r.registerListeners();r.div.querySelector(".tc-url input[type=text]").value=e;r.div.querySelector(".tc-iframe input[type=text]").value=r.generateIframe(e)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(t){const e=t.target;i(e);document.execCommand("copy");e.textContent=r.getLocaleString("copied");setTimeout(function(){e.textContent=r.getLocaleString("copy");!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(t){i(t.target)}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.disabled",function(t){t.stopImmediatePropagation();t.preventDefault();return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",function(t){t.preventDefault();var n=r.generateLink();if(n){const t=encodeURIComponent(n+"\n");t.length>r.MAILTO_MAX_LENGTH&&e.toast(r.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+t}}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(t){t.preventDefault();const e=r._dialogDiv.querySelector(".qrcode");e.innerHTML="";r._dialogDiv.querySelector("."+r.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?r.makeQRCode(e,256,256).then(function(t){t&&TC.Util.showModal(r._dialogDiv.querySelector(r._classSelector+"-qr-dialog"))}):TC.Util.showModal(r._dialogDiv.querySelector(r._classSelector+"-qr-dialog"))}));const o=function(t,e,n){if(e&&e.trim().length>0)t.location.href=n(e);else{TC.error(r.getLocaleString("urlTooLongForShortener"));t.close()}};r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(t){t.preventDefault();const e=window.open();r.shortenedLink().then(function(t){o(e,t,function(t){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t)})});return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(t){t.preventDefault();const e=window.open();r.shortenedLink().then(function(t){o(e,t,function(t){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&amp;url="+encodeURIComponent(t)})});return!1}));TC.Util.detectMobile()&&r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(t){t.preventDefault();r.shortenedLink().then(function(t){var e="whatsapp://send?text=";location.href=void 0!==t?e+encodeURIComponent(t):e+encodeURIComponent(r.generateLink())});return!1}));r.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",function(e){e.preventDefault();var n=r.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(t.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,n,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(n,i);else{window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}return!1}));return n};t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/Share.html";t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"share"}).w(' </h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url" title="').h("i18n",e,{},{$key:"shareLink"}).w('"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",e,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe" title="').h("i18n",e,{},{$key:"embedMap"}).w('"><input type="radio" name="format" value="iframe" /><span>').h("i18n",e,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",e,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",e,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",e,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",e,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",e,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"tooManyLayersLoaded|s"}).w("</p></div> </div>")}e.__dustBody=!0;return e};t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"qrCode"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div> <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",e,{},{$key:"qrAdvice|s"}).w('</p></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"close"}).w("</button></div></div></div>")}e.__dustBody=!0;return e}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var t=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){this._sv=null;this._mapActiveControl=null;TC.Control.apply(this,arguments);this.options.googleMapsKey&&(t+="&key="+this.options.googleMapsKey);this.viewDiv=null;this._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var e=TC.control.StreetView.prototype;e.CLASS="tc-ctl-sv";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";e.template[e.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(t,e){return t.w('<div class="tc-ctl-sv-btn" title="').h("i18n",e,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-view"]=function(){dust.register(e.CLASS+"-view",t);function t(t,e){return t.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",e,{},{$key:"closeStreetView"}).w('"></div>')}t.__dustBody=!0;return t}}const r=function(){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1);this.map.div.querySelector("canvas").dispatchEvent(t)};var n=function(t){const e=t.viewDiv,n=["webkitTransitionEnd","msTransitionEnd","oTransitionEnd","transitionend"],i=function(){TC.Util.detectSafari()||n.forEach(function(t){e.removeEventListener(t,i)});r.call(t)};TC.Util.detectSafari()?setTimeout(function(){r.call(t)},500):n.forEach(function(t){e.addEventListener(t,i)});t.layer.clearFeatures();t.div.querySelector("."+t.CLASS+"-btn").classList.remove(TC.Consts.classes.CHECKED);t.div.querySelector("."+t.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);t.map.div.classList.remove(t.CLASS+"-active");t._startLonLat=null};e.register=function(t){const e=this;if(!e.viewDiv){e.viewDiv=TC.Util.getDiv(e.options.viewDiv);e.viewDiv.classList.add(e.CLASS+"-view",TC.Consts.classes.HIDDEN);e.options.viewDiv||t.div.insertAdjacentElement("beforebegin",e.viewDiv)}const r=TC.Control.prototype.register.call(e,t);e.layer=null;for(var i=e.getUID(),o=0;o<t.workLayers.length;o++){var a=t.workLayers[o];if(a.type===TC.Consts.layerType.VECTOR&&a.id===i){e.layer=a;break}}e.layer||t.loaded(function(){t.addLayer({id:i,stealth:!0,type:TC.Consts.layerType.VECTOR}).then(function(t){e.layer=t})});e.renderPromise().then(function(){TC.loadJS(!window.Draggabilly,[TC.apiLocation+TC.Consts.url.DRAGGABILLY],function(){const t=new Draggabilly(e.div.querySelector("."+e.CLASS+"-drag"),{containment:e.map.div});t.on("dragStart",function(t){!function(t){t.div.querySelector("."+t.CLASS+"-btn").classList.add(TC.Consts.classes.CHECKED);t.map.div.classList.add(t.CLASS+"-active")}(e)});t.on("dragEnd",function(r){!function(t){var e=!1;const r=t.div.querySelector("."+t.CLASS+"-btn"),i=t.div.querySelector("."+t.CLASS+"-drag");var o=r.getBoundingClientRect(),a=i.getBoundingClientRect();i.classList.add(TC.Consts.classes.HIDDEN);if(a.top<o.top||a.top>o.bottom||a.left<o.left||a.left>o.right){e=!0;for(var s=t.map.getExtent(),l=[s[2],s[3]],c=(new Array(16),0);c<16;c++)t.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=t.map.div.getBoundingClientRect(),h=(a.left*window.devicePixelRatio+a.right*window.devicePixelRatio)/2-u.left*window.devicePixelRatio,p=a.bottom*window.devicePixelRatio-u.top*window.devicePixelRatio,d=t.map.wrap.getCoordinateFromPixel([h,p]);t.callback(d)}else n(t)}(e);t.setPosition(0,0)})});const t=e.viewDiv;t.querySelector("."+e.CLASS+"-btn-close").addEventListener(TC.Consts.event.CLICK,function(r){const i=e.map.div,o=function(){i.classList.remove(TC.Consts.classes.COLLAPSED);const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1);i.dispatchEvent(t)},a=function(e){if("width"===e.propertyName||"height"===e.propertyName){t.removeEventListener("transitionend",a);o()}};t.removeEventListener("transitionend",a);t.addEventListener("transitionend",a);setTimeout(o,1e3);t.classList.add(TC.Consts.classes.HIDDEN);t.classList.remove(TC.Consts.classes.VISIBLE);e.div.querySelector("."+e.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);e.layer.wrap.setDraggable(!1);n(e);e._sv.setVisible(!1);r.stopPropagation();const s=document.body.querySelector("header");s&&(s.style.display="");e._previousActiveControl&&e._previousActiveControl.activate()})},function(t,e,r){TC.error("Error de renderizado StreetView")});return r};e.render=function(){const t=this;return t._set1stRenderPromise(new Promise(function(e,r){t.renderData(null,function(){if(dust.cache[t.CLASS+"-view"])dust.render(t.CLASS+"-view",null,function(r,n){setTimeout(function(){t.viewDiv.innerHTML=n;r&&TC.error(r);e(t)},300)});else{TC.error("No hay dust.cache para StreetView");e(t)}})}))};var i=0;e.callback=function(e){var o=this,a=function(t){if(o._sv){var e=t.getBounds();lonLat=TC.Util.reproject([(e[0]+e[2])/2,(e[1]+e[3])/2],o.map.crs,"EPSG:4326");o._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},s=function(t){if(o._sv){var e=t.getBounds();o._startLonLat=[(e[0]+e[2])/2,(e[1]+e[3])/2]}},l=o.map.getLoadingIndicator();l&&(i=l.addWait(i));const c=o.map.div;var u=function(t,r){o.layer.clearFeatures();var n,i;if(t){var l=t.getPosition();n=TC.Util.reproject([l.lng(),l.lat()],"EPSG:4326",o.map.crs);i=t.getPov().heading}else{n=e;i=0}o.map.addMarker(n,{cssClass:"tc-marker-sv-"+(Math.round(16*i/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:o.layer,showsPopup:!1});Promise.all(o.map._markerPromises).then(function(){o.layer.wrap.setDraggable(!0,a,s)});if(r){var u=function(){o.map.setCenter(n)};c.classList.contains(TC.Consts.classes.COLLAPSED)?u():setTimeout(u,1200)}};TC.loadJS(!window.google||!google.maps,t,function(){if(window.google){u();const h=o.viewDiv;var t=TC.Util.reproject(e,o.map.crs,"EPSG:4326"),a=h.classList.contains(TC.Consts.classes.VISIBLE),s={position:new google.maps.LatLng(t[1],t[0]),pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(o._sv)o._sv.setOptions(s);else{o._sv=new google.maps.StreetViewPanorama(h,s);google.maps.event.addListener(o._sv,"position_changed",function(){u(o._sv,h.classList.contains(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(o._sv,"pov_changed",function(){if(o.layer.features&&o.layer.features.length>0){var t=o.layer.features[0];delete t.options.url;t.options.cssClass="tc-marker-sv-"+(Math.round(16*o._sv.getPov().heading/360)+16)%16;t.setStyle(t.options);o.layer.refresh()}});google.maps.event.addListener(o._sv,"status_changed",function(){var t=o._sv.getStatus();l&&l.removeWait(i);if(t===google.maps.StreetViewStatus.OK){c.classList.add(TC.Consts.classes.COLLAPSED);const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1);c.dispatchEvent(t);const e=function(){google.maps.event.trigger(o._sv,"resize");r.call(o)};const n=function(t){if(("width"===t.propertyName||"height"===t.propertyName)&&!a){a=!0;h.removeEventListener("transitionend",n);e()}};h.removeEventListener("transitionend",n);h.addEventListener("transitionend",n);setTimeout(e,1e3);if(!h.classList.contains(TC.Consts.classes.VISIBLE)){o._sv.setVisible(!0);u(o._sv,!0);if(o.map.activeControl){o._previousActiveControl=o.map.activeControl;o.map.activeControl.deactivate(!0)}setTimeout(function(){h.style.left="";h.style.top="";h.classList.remove(TC.Consts.classes.HIDDEN);h.classList.add(TC.Consts.classes.VISIBLE)},200);const t=document.body.querySelector("header");t&&(t.style.display="none")}}else{TC.alert(t===google.maps.StreetViewStatus.ZERO_RESULTS?o.getLocaleString("noStreetView"):o.getLocaleString("streetViewUnknownError"));if(o._startLonLat)o.callback(o._startLonLat);else{o.layer.wrap.setDraggable(!1);n(o)}}})}u(o._sv)}else n(o)},!1,!0)}}();TC.control=TC.control||{};!function(){TC.control.ThreeD=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ThreeD,TC.Control);var t=TC.control.ThreeD.prototype;t.CLASS="tc-ctl-threed";t.classes={BETA:"tc-beta-button",BTNACTIVE:"active"};t.template={};TC.isDebug?t.template[t.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html":t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(t,e){return t.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",e,{},{$key:"threed.tip"}).w('"></button>')}e.__dustBody=!0;return e};t.register=function(t){const e=this,r=TC.Control.prototype.register.call(e,t);t.on(TC.Consts.event.VIEWCHANGE,function(t){t.view==TC.Consts.view.THREED&&e.activate()});return r};t.renderData=function(t,e){const r=this;return TC.Control.prototype.renderData.call(r,t,function(){r.button=r.div.querySelector("."+r.CLASS+"-btn");r.button.addEventListener(TC.Consts.event.CLICK,function(){if("disabled"!==r.button.getAttribute("disabled"))if(r.map.on3DView){r.button.setAttribute("disabled","disabled");TC.view.ThreeD.unapply({callback:function(){r.button.setAttribute("title",r.getLocaleString("threed.tip"));r.button.classList.remove(r.classes.BTNACTIVE);r.button.removeAttribute("disabled")}})}else r.activate()});TC.Util.isFunction(e)&&e()})};t.activate=function(){var t=this;t.button.setAttribute("disabled","disabled");t.browserSupportWebGL.call(t);const e=function(){t.button.removeAttribute("disabled")};t.map.view3D?t.map.on3DView||TC.view.ThreeD.apply({map:t.map,options:t.options,getRenderedHtml:t.getRenderedHtml,callback:e}):TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:t.map,options:t.options,getRenderedHtml:t.getRenderedHtml,callback:e})});!function(){t.button.setAttribute("title",t.getLocaleString("threed.two.tip"));t.button.classList.remove(t.classes.BETA);t.button.classList.add(t.classes.BTNACTIVE)}()};t.deactivate=function(){TC.Control.prototype.deactivate.call(this)};t.browserSupportWebGL=function(){var t=!1;if(window.WebGLRenderingContext){var e=document.createElement("canvas"),r={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)||e.getContext("webkit-3d",r)||e.getContext("moz-webgl",r);if(n)t=!0;else{r.failIfMajorPerformanceCaveat=!1;if(n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)||e.getContext("webkit-3d",r)||e.getContext("moz-webgl",r)){t="slow";this.isSlower=!0}else t=!1}}catch(t){console.log(E)}if("slow"===t||!t){var i="slow"===t?"threed.slowSupport.supported":"threed.not.supported";this.map.toast(this.getLocaleString(i),{type:TC.Consts.msgType.WARNING,duration:1e4})}return t}t=!1}}();TC.control=TC.control||{};HTMLElement.prototype.appendHTML||(HTMLElement.prototype.appendHTML=function(t){var e=document.createElement("div");e.innerHTML=t;if(e.childNodes.length>1)for(var r=0;r<e.childNodes.length;r++)this.appendChild(e.childNodes[r]);e.childNodes.length>0&&this.appendChild(e.firstChild);return null});Document.prototype.createHTMLElement||(Document.prototype.createHTMLElement=function(t){var e=document.createElement("div");e.innerHTML=t;return e.childNodes.length>0?e.firstChild:null});HTMLElement.prototype.empty||(HTMLElement.prototype.empty=function(){for(;this.children.length;)this.removeChild(this.children[0])});"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r},writable:!0,configurable:!0});TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/filter");TC.control.WFSQuery=function(t){TC.Control.apply(this,arguments);this.styles=this.options.styles;this.highLightStyles=this.options.highLightStyles};TC.inherit(TC.control.WFSQuery,TC.Control);!function(){var t=TC.control.WFSQuery.prototype,e=null,r=null,n=null,i=null,o=(TC.Consts.logicalOperator.AND,null),a=null,s=null,l={eq:TC.filter.equalTo,not:TC.filter.notEqualTo,gt:TC.filter.greaterThan,lt:TC.filter.lessThan,ge:TC.filter.greaterThanOrEqualTo,le:TC.filter.lessThanOrEqualTo,like:TC.filter.like,contains:TC.filter.like,start:TC.filter.like,end:TC.filter.like,bw:TC.filter.between},c=null,u=null,h=null,p=null,d=null,f=null,g=null,y=function(){return null},m=function(){return null},C=null;t.CLASS="tc-ctl-wfsquery";t.template={};if(TC.isDebug){t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/WFSQueryDialog.html";t.template[t.CLASS+"-form"]=TC.apiLocation+"TC/templates/WFSQueryForm.html";t.template[t.CLASS+"-filter"]=TC.apiLocation+"TC/templates/WFSQueryfilter.html"}else{t.template[t.CLASS+"-dialog"]=function(){dust.register(t.CLASS+"-dialog",e);function e(t,e){return t.w('<div class="tc-ctl-wfsquery-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window tc-ctl-wfsquery-modal-window" ><div class="tc-modal-header"><h3>').f(e.get(["layerName"],!1),e,"h").w('</h3><div title="').h("i18n",e,{},{$key:"query.tooltipCloseDialogBtn"}).w('" class="tc-modal-close"></div></div><div class="tc-modal-body">').h("gt",e,{block:r},{key:e.getPath(!1,["layers","length"]),value:1}).w('<div class="tc-modal-form"></div><div class="tc-ctl-wfsquery-message tc-hidden"></div> </div><div class="tc-modal-footer"><button type="button" title="').h("i18n",e,{},{$key:"query.tooltipSendQueryBtn"}).w('" class="tc-button tc-ctl-wlm-btn-launch">').h("i18n",e,{},{$key:"query.sendQueryBtnText"}).w('</button><button type="button" title="').h("i18n",e,{},{$key:"query.cancelQueryTooltip"}).w('" class="tc-button tc-modal-close">').h("i18n",e,{},{$key:"query.cancelQueryButton"}).w("</button></div></div></div>")}e.__dustBody=!0;function r(t,e){return t.w(' <div><select class="tc-combo" name="availableLayers"><option value="">').h("i18n",e,{},{$key:"query.chooseALayerCombo"}).w("</option>").s(e.get(["layers"],!1),e,{block:n},{}).w("</select></div> ")}r.__dustBody=!0;function n(t,e){return t.w('<option value="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["title"],!1),e,"h").w("</option>")}n.__dustBody=!0;return e};t.template[t.CLASS+"-form"]=function(){dust.register(t.CLASS+"-form",e);function e(t,e){return t.w("<div>").h("countif",e,{else:r,block:n},{key:e.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w('</div><div class="tc-ctl-wfsquery-operacion tc-hidden"><div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden"><input type="radio" id="cond_1" name="codicion" value="eq" /><label for="cond_1" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_2" name="codicion" value="not" /><label for="cond_2" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_3" name="codicion" value="gt" /><label for="cond_3" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_4" name="codicion" value="lt" /><label for="cond_4" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_5" name="codicion" value="ge" /><label for="cond_5" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_6" name="codicion" value="le" /><label for="cond_6" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden"><input type="radio" id="cond_8" name="codicion" value="eq" /><label for="cond_8" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_9" name="codicion" value="contains" /><label for="cond_9" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.containsBtn"}).w('</label><input type="radio" id="cond_10" name="codicion" value="start" /><label for="cond_10" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.startsByBtn"}).w('</label><input type="radio" id="cond_11" name="codicion" value="end" /><label for="cond_11" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.endsByBtn"}).w('</label></div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden"><input type="radio" id="cond_12" name="codicion" value="bw" /><label for="cond_12" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_13" name="codicion" value="nbw" /><label for="cond_13" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_14" name="codicion" value="gt" /><label for="cond_14" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_15" name="codicion" value="lt" /><label for="cond_15" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_16" name="codicion" value="ge" /><label for="cond_16" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_17" name="codicion" value="le" /><label for="cond_17" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",e,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery-where tc-hidden"><input type="search" placeholder="').h("i18n",e,{},{$key:"query.searchFieldPhd"}).w('" class="tc-textbox" /><button type="button" title="').h("i18n",e,{},{$key:"query.tooltipAddCondBtn"}).w('" class="tc-button">').h("i18n",e,{},{$key:"query.textAddCondBtn"}).w('</button><ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul><div class="tc-ctl-wfsquery-key"><label>').h("i18n",e,{},{$key:"query.logicalOpLbl"}).w('</label></div><div class="tc-ctl-wfsquery-value"><input type="radio" id="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" checked name="log_op" value="AND" /><label for="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",e,{},{$key:"query.logicalOpAndLbl"}).w('</label><input type="radio" id="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" name="log_op" value="OR" /><label for="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",e,{},{$key:"query.logicalOpOrLbl"}).w('</label></div><div class="tc-ctl-wfsquery-whereList"></div></div></div>')}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-wfsquery-message tc-msg-warning">').h("i18n",e,{},{$key:"query.noAttributes"}).w("</div>")}r.__dustBody=!0;function n(t,e){return t.w('<select class="tc-combo" id="attributes" name="attributes"><option value="">').h("i18n",e,{},{$key:"query.chooseAttrCombo"}).w("</option>").h("iterate",e,{block:i},{on:e.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w("</select>")}n.__dustBody=!0;function i(t,e){return t.w('<option value="').f(e.get(["key"],!1),e,"h").w('">').f(e.get(["key"],!1),e,"h").w("</option>")}i.__dustBody=!0;return e};t.template[t.CLASS+"-filter"]=function(){dust.register(t.CLASS+"-filter",e);function e(t,e){return t.s(e.get(["conditions"],!1),e,{block:r},{})}e.__dustBody=!0;function r(t,e){return t.w('<div class="tc-ctl-wfsquery-where-cond">').f(e.get(["field"],!1),e,"h").w("&nbsp;").f(e.get(["opText"],!1),e,"h").w("&nbsp;").x(e.get(["isString"],!1),e,{block:n},{}).f(e.get(["valueToShow"],!1),e,"h",["numberSeparator"]).x(e.get(["isString"],!1),e,{block:i},{}).w('</div><div class="tc-ctl-wfsquery-del-cond" title="').h("i18n",e,{},{$key:"query.tooltipRemoveCond"}).w('"></div>\t')}r.__dustBody=!0;function n(t,e){return t.w("&quot;")}n.__dustBody=!0;function i(t,e){return t.w("&quot;")}i.__dustBody=!0;return e}}var v=function(t){var e=document.createElement("input");e.setAttribute("type",t);return e.type==t},T=function(t){var r=t[0],n=t[1],i=t[2];u=r;p=i;f=i.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"];g=i.Operations.GetFeature.CountDefault?i.Operations.GetFeature.CountDefault.DefaultValue:null;var o=r.getDisgregatedLayerNames();if((o=o.filter(function(t){return i.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))})).length>1){e.classList.remove("tc-loading");n.getElementsByClassName("tc-combo")[0].addEventListener("change",function(){if(this.value){n.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",n).classList.add(TC.Consts.classes.HIDDEN);d=this.options[this.selectedIndex].text;e.classList.add("tc-loading");_(this.value,i).then(function(t){b(t,n)},function(){var t=n.getElementsByClassName("tc-modal-body")[0];t.classList.remove("tc-loading");t.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>");t.empty()})}else{var t=n.getElementsByClassName("tc-modal-form")[0];t.empty();for(var r=0;r<t.children.length;r++)t.removeChild(t.children[r]);x()}})}else{if(i.FeatureTypes[o[0].substring(o[0].indexOf(":")+1)]){d=i.FeatureTypes[o[0].substring(o[0].indexOf(":")+1)].Title;_(o[0],i).then(function(t){b(t,n)},function(){var t=n.getElementsByClassName("tc-modal-body")[0];t.classList.remove("tc-loading");t.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>");t.empty()})}else{var a=n.getElementsByClassName("tc-modal-body")[0];a.classList.remove("tc-loading");a.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>")}}},_=function(t,e){h=t;return new Promise(function(r,n){if(e.Operations.DescribeFeatureType){var i=e.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"]+"?REQUEST=DescribeFeatureType&TYPENAME="+t+"&OUTPUTFORMAT="+e.Operations.DescribeFeatureType.outputFormat;u.toolProxification.fetchXML(i).then(function(e){var i=xml2json(e),o=i[t.substring(t.indexOf(":")+1)];if(o){var a=o.type;r(i[a.substring(a.indexOf(":")+1)].complexContent.extension.sequence)}else n()}).catch(function(t){TC.error(t)})}else TC.error("No est\xe1 habilitado DescribeFeatureType en este servicio",TC.Consts.msgErrorMode.TOAST)})},S=null,E=null,L=function(t){if(v("date"))t.type="date";else{t.type="search";new Promise(function(t,e){"undefined"!=typeof IMask?setTimeout(function(){t()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");t()})}).then(function(){S=new IMask(t,{mask:Date,pattern:s&&"es-ES"!==s?"eu-ES"===s?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(t){var e=t.getDate(),r=t.getMonth()+1,n=t.getFullYear();e<10&&(e="0"+e);r<10&&(r="0"+r);switch(s){case"eu-ES":return[n,r,e].join("/");case"en-US":return[r,e,n].join("/");case"es-ES":default:return[e,r,n].join("/")}},parse:function(t){switch(s){case"eu-ES":return new Date(t.split("/")[1]+"/"+t.split("/")[2]+"/"+t.split("/")[0]);case"en-US":return new Date(t);case"es-ES":default:return new Date(t.split("/")[1]+"/"+t.split("/")[0]+"/"+t.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})}},w=function(){if(S){var t=S.el.input;S.destroy();S=null;t.value="";t.type="search"}},b=function(r,n){x();_internalGetDataTypes=function(){return r};t.getRenderedHtml(t.CLASS+"-form",{attributes:r},function(i){var o=n.getElementsByClassName("tc-modal-form")[0];o.empty();o.appendHTML(i);e.classList.remove("tc-loading");TC.loadJS(!0,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){console.log("autocomplete loaded")});var a=null,c=o.getElementsByClassName("tc-combo");if(0==c.length)n.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{n.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled");c[0].addEventListener("change",function(){var e=o.querySelector(".tc-ctl-wfsquery-where .tc-textbox");e.dataset.autocomplete&&TC.UI.autocomplete.call(e,"clear");if(r[this.value]){a=r[this.value].type;o.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.remove("tc-hidden");TC.UI.autocomplete.call(e,"clear");!function(){if(E){var t=E.el.input;E.destroy();E=null;t.value="";t.type="search"}}();e.type="search";switch(!0){case a.indexOf("int")>=0:case a.indexOf("float")>=0:case a.indexOf("double")>=0:case a.indexOf("long")>=0:case a.indexOf("decimal")>=0:o.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.remove("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===o.querySelectorAll("tc-ctl-wfsquery-numeric input:checked").length&&(o.querySelector(".tc-ctl-wfsquery-numeric :first-child").checked=!0);w();if(v("number"))if(TC.Util.detectIE()){e.type="text";new Promise(function(t,e){"undefined"!=typeof IMask?setTimeout(function(){t()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");t()})}).then(function(){E=new IMask(e,{mask:Number,scale:a.indexOf("int")>=0||a.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:s&&"en-US"===s?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:s&&"en-US"===s?".":","})})}else{e.type="number";a.indexOf("int")>=0||a.indexOf("long")>=0?e.step="1":e.step="0.0001"}break;case a.indexOf("dateTime")>=0:o.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.remove("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===o.querySelectorAll("tc-ctl-wfsquery-date input:checked").length&&(o.querySelector(".tc-ctl-wfsquery-date :first-child").checked=!0);L(e);break;case a.indexOf("string")>=0:o.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.remove("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===o.querySelectorAll("tc-ctl-wfsquery-text input:checked").length&&(o.querySelector(".tc-ctl-wfsquery-text :first-child").checked=!0);w();B(e,this.value,o.getElementsByClassName(t.CLASS+"-list tc-ctl-search-list")[0])}}else{o.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.add("tc-hidden");o.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.add("tc-hidden")}});o.querySelector(".tc-ctl-wfsquery-where  input[type='radio']").addEventListener("change",function(){"OR"===this.value?TC.Consts.logicalOperator.OR:TC.Consts.logicalOperator.AND;o.getElementsByClassName("tc-ctl-wfsquery-whereList-op")[0].innerHTML=this.nextElementSibling.innerHTML});o.querySelector(".tc-button").addEventListener("click",function(){var t=o.querySelector("input.tc-textbox");TC.UI.autocomplete.call(t,"clear");E&&E.masked.remove();if(P(o)){var e,r,n=o.querySelector(".tc-combo").value,i=o.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked'),c=i.value,u=i.nextElementSibling.innerText,h=(e=t,E?E.unmaskedValue:S?S.unmaskedValue.substring(4)+"-"+S.unmaskedValue.substring(2,4)+"-"+S.unmaskedValue.substring(0,2):e.value),p=function(t){if(E)return E.value;if(S)return S.value;if("date"===t.type)return new Date(t.value).toLocaleDateString(s);if("number"===t.type){var e=1.1.toLocaleString(s).substring(1,2);return t.value.replace(".",e)}return t.value}(t);o.querySelector('.tc-ctl-wfsquery-where  input[type="radio"]:checked').nextElementSibling.innerText;h=h.replace("<","&lt;").replace(">","&gt;");(r=a.indexOf("dateTime")>=0?"nbw"!==c?new l[c](n,h+"T00:00:00Z",h+"T23:59:59Z"):new TC.filter.not(TC.filter.between(n,h+"T00:00:00Z",h+"T23:59:59Z")):new l[c](n,("end"===c||"contains"===c?"*":"")+h+("start"===c||"contains"===c?"*":""))).matchCase=!1;whereObjList.push(r);switch(!0){case a.indexOf("int")>=0:p=parseInt(h,10);break;case a.indexOf("float")>=0:case a.indexOf("double")>=0:case a.indexOf("long")>=0:case a.indexOf("decimal")>=0:p=parseFloat(h,10)}whereFilterList.push({field:n,opText:u,isString:a.indexOf("string")>=0,valueToShow:p});A(o);t.value=""}})}})},A=function(e){dust.filters.numberSeparator||(dust.filters.numberSeparator=function(t){return t.toLocaleString(s)});e.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].empty();t.getRenderedHtml(t.CLASS+"-filter",{conditions:whereFilterList},function(t){e.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].innerHTML=t;for(var r=e.getElementsByClassName("tc-ctl-wfsquery-del-cond"),n=0;n<r.length;n++)r[n].addEventListener("click",function(){var t=Array.prototype.indexOf.call(r,this);whereObjList.splice(t,1);whereFilterList.splice(t,1);A(e)})})},x=function(){whereObjList=[];whereFilterList=[]},P=function(t){var e,r=t.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');if(S&&!S.masked.isComplete){!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&F("Fecha "+str+" inv\xe1lida",TC.Consts.msgType.ERROR);return!1}if(0==r.length){F(C("query.msgNoCondition"));return!1}if(t.querySelectorAll("input[type='date']").length&&!t.querySelector("input[type='date']").checkValidity()){F(C("query.msgNoValidDate"));return!1}if(t.querySelectorAll("input[type='number']").length&&null!=(e=t.querySelector("input[type='number']"))&&!e.checkValidity()){"1"===e.step?F(C("query.msgNoValidNumberMustInt")):F(C("query.msgNoValidNumber"));return!1}if(""===t.querySelector("input.tc-textbox").value.trim()){F(C("query.msgNoValueCondition"));return!1}return!0},R=function(){if(D()){r.getElementsByClassName("tc-modal-body")[0].classList.add("tc-loading");var t=function(){var t=M();N(d);u.toolProxification.cacheHost.getAction(f).then(function(e){const r=e.action(f);if(i){i.setVisibility(!1);i.clearFeatures();c.off(TC.Consts.event.LAYERUPDATE,O);c.on(TC.Consts.event.LAYERUPDATE,O);i.url=r;i.featurePrefix=h.substring(0,h.indexOf(":"));i.featureType=h.substring(h.indexOf(":")+1);i.maxFeatures=g;i.properties=t;i.setVisibility(!0);i.refresh()}else{I({id:"WFSQueryResults",type:TC.Consts.layerType.WFS,url:r,version:"1.1.0",stealth:!0,geometryName:"the_geom",featurePrefix:h.substring(0,h.indexOf(":")),featureType:h.substring(h.indexOf(":")+1),maxFeatures:g,properties:t,outputFormat:TC.Consts.format.JSON,styles:y()});c.on(TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===n){TC.browserFeatures.touch()&&TC.Util.swipe(t.control.div,"enable");i.clearFeatures();i.setVisibility(!1);c.off(TC.Consts.event.LAYERUPDATE,O)}})}})};g?U(c).then(t,function(t){r.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");if("NumMaxFeatures"===t.err)F(C("query.msgTooManyResults",{limit:t.limit}),TC.Consts.msgType.WARNING);else if("Empty"===t.err)F(C("query.msgNoResults"),TC.Consts.msgType.INFO);else{console.error(t.errorThrown);F(C("query.errorUndefined"),TC.Consts.msgType.ERROR)}}):t()}else F(C("query.msgNoQueryFilter"))},I=function(t){c.addLayer(t).then(function(t){i=t;t.map.on(TC.Consts.event.LAYERUPDATE,O)})},M=function(){if(whereObjList.length>1){var t=document.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;return TC.filter[TC.Consts.logicalOperator[t]].apply(null,whereObjList)}return 0===whereObjList.length?null:whereObjList[0]},O=function(t){if(t.layer==i){var e=t.layer.features;if(e.length>0){c.zoomToFeatures(e);k(e.length>1?e.reduce(function(t,e,r){return(t instanceof Array?t:[t.data]).concat([e.data])}):[e[0].data],i,d)}else{r.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");F("No hay resultados",TC.Consts.msgType.INFO)}t.layer.map.off(TC.Consts.event.LAYERUPDATE,O)}},N=function(t){var e=t;new Promise(function(t,e){TC.control.ResultsPanel?t(TC.control.ResultsPanel):TC.loadJS(!0,TC.apiLocation+"TC/control/ResultsPanel",function(){t(TC.control.ResultsPanel)})}).then(function(t){if(n){n.options.save.fileName=e+".xls";n.options.titles.max=n.getLocaleString("geo.trk.chart.exp")}else{var r=function(t){n=t;delete dust.cache[n.CLASS+"-table"];if(!TC.isDebug){n.template[n.CLASS+"-table"]=dust.register(n.CLASS+"-table",e);function e(t,e){return t.w('<table class="table"><thead>').s(e.get(["columns"],!1),e,{block:r},{}).w("</thead><tbody>").s(e.get(["results"],!1),e,{block:i},{}).w("</tbody></table>")}e.__dustBody=!0;function r(t,e){return t.w("<th>").f(e.getPath(!0,[]),e,"h").w("</th>")}r.__dustBody=!0;function i(t,e){return t.w('<tr title="').h("i18n",e,{},{$key:"zoomToFeature"}).w('" data-id="').f(e.get(["Id"],!1),e,"h").w('" data-index="').f(e.get(["$idx"],!1),e,"h").w('" class="tc-selectable">').h("iterate",e,{block:o},{on:e.getPath(!0,[])}).w("</tr>")}i.__dustBody=!0;function o(t,e){return t.h("select",e,{block:a},{key:e.get(["key"],!1)})}o.__dustBody=!0;function a(t,e){return t.w('<td class="').f(e.get(["key"],!1),e,"h",["removeAccents","downcase"]).w('">').h("startsWith",e,{else:s,block:l},{key:e.get(["value"],!1),value:"http"}).w("</td>")}a.__dustBody=!0;function s(t,e){return t.f(e.get(["value"],!1),e,"h",["numberSeparator"])}s.__dustBody=!0;function l(t,e){return t.w('<a href="').f(e.get(["value"],!1),e,"h").w('" target="_blank" title="').h("i18n",e,{},{$key:"query.linkOpenAtNewTab"}).w('">').h("i18n",e,{},{$key:"query.linkText"}).w("</a>")}l.__dustBody=!0;return e}n.template[n.CLASS+"-table"]=TC.apiLocation+"TC/templates/WFSQueryResultsTable.html";n.options.titles.max=n.getLocaleString("geo.trk.chart.exp")},i=c.getControlsByClass(TC.control.ControlContainer);0==i.length?c.addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:e+".xls"}}).then(r):i[0].addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:e+".xls"},side:"right"}).then(r)}})},k=function(t,e,i){n.div.querySelector(".prpanel-title-text").innerText=n.getLocaleString(t.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:t.length,layerName:i});n.div.classList.add("tc-ctl-wfsquery-results");r.parentElement.removeChild(r);n.openTable({data:t,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},callback:function(r){n.maximize();console.log("render del panel de resultados");var i=r.getElementsByTagName("tr"),o=_internalGetDataTypes(),a=1;for(var s in t[0]){if(o.hasOwnProperty(s)&&(o[s].type.indexOf("int")>=0||o[s].type.indexOf("float")>=0||o[s].type.indexOf("double")>=0||o[s].type.indexOf("long")>=0||o[s].type.indexOf("decimal")>=0))for(var l=r.querySelectorAll("td:nth-child("+a+")"),c=0;c<l.length;c++)l[c].classList.add("tc-numeric");a++}for(s=0;s<i.length;s++){i[s].addEventListener("click",function(t){t.stopPropagation();var r=this.dataset.index;null!=r&&e.map.zoomToFeatures([e.features[r]])});i[s].addEventListener("mouseenter",function(){var t=this.dataset.index;if(null!=t){var r=e.features[t];r&&r.geometry&&j(r);for(var n=0;n<this.children.length;n++){var i=this.children[n];i.offsetWidth<i.scrollWidth&&(i.title=i.innerText)}}});i[s].addEventListener("mouseleave",function(){var t=this.dataset.index;if(null!=t){var r=e.features[t];r&&r.geometry&&q(r)}})}TC.browserFeatures.touch()&&TC.Util.swipe(n.div,"disable")}})},D=function(){return whereObjList.length>0},F=function(t,r){var n=e.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(o)clearTimeout(o);else{n.innerHTML=t;switch(r){case TC.Consts.msgType.INFO:n.classList.add("tc-msg-info");break;case TC.Consts.msgType.WARNING:n.classList.add("tc-msg-warning");break;case TC.Consts.msgType.ERROR:default:n.classList.add("tc-msg-error")}n.classList.remove(TC.Consts.classes.HIDDEN)}o=setTimeout(function(){o=null;n.classList.add(TC.Consts.classes.HIDDEN)},3e3)},B=function(t,e,r){TC.UI.autocomplete.call(t,{minLength:3,target:r,source:function(t,r){var n,i,o=this;o.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+C("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';o.target.classList.remove("tc-hidden");(n=e,i=t,new Promise(function(t,e){var r=Object.assign({},p);r.version="1.1.0";switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"start":i+="*";break;case"contains":case"eq":i="*"+i+"*";break;case"end":i="*"+i}a&&(a=null);(a=u.toolProxification.fetchJSON(f+"?"+Date.now().toString(),{data:TC.Util.WFSQueryBuilder([h],TC.filter.like(n,i,void 0,void 0,void 0,!1),r,"JSON",!1),contentType:"application/xml",method:"POST"})).then(function(r){if(r.features&&r.features.length>0){var i;1===r.features.length&&(i=[r.features[0].properties[n]]);r.features.length>1&&(i=r.features.reduce(function(t,e){return t&&t instanceof Array?t.indexOf(e.properties[n])<0?t.concat(e.properties[n]):t:t.properties[n]===e.properties[n]?[t.properties[n]]:[t.properties[n],e.properties[n]]}));t(i)}else e(null)})})).then(r).catch(function(){o.target.classList.add("tc-hidden")})},callback:function(e){t.value=e.currentTarget.dataset.value;this.target.classList.add("tc-hidden")},buildHTML:function(e){var r=t.value;this.target.style.maxHeight="";return e.results.length>1?e.results.reduce(function(t,e,n){return(n>1?t:G(t,r))+G(e,r)}):G(e.results[0],r)}});t.addEventListener("targetCleared.autocomplete",function(){r.classList.add("tc-hidden")});t.addEventListener("keypress",function(e){13==e.which&&TC.UI.autocomplete.call(t,"clear")});t.addEventListener("search",function(e){0===t.value.length&&TC.UI.autocomplete.call(t,"clear")});t.addEventListener("input",function(e){0===t.value.length&&TC.UI.autocomplete.call(t,"clear")})},G=function(t,e){e=new RegExp(e,"gi");return'<li><a href="#" data-value="'+t+'">'+t.replace(e,"<b>$&</b>")+"</a></li>"},U=function(t){return new Promise(function(e,r){var n=M(),i=Object.assign({},p);i.version="1.1.0";u.toolProxification.fetchXML(f,{data:TC.Util.WFSQueryBuilder([h],n,i,null,!0,t.getCRS()),method:"POST"}).then(function(t){var n=xml2json(t);if(n.Exception)r({err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText});else{var i=parseInt(n.numberMatched||n.numberOfFeatures,10);isNaN(i)||i>=parseInt(g,10)?r({err:"NumMaxFeatures",limit:g}):isNaN(i)||0!==i?e():r({err:"Empty"})}}).catch(function(t,e,n){r({err:e,errorThrown:n})})})},j=function(t){var e=function(t,e){var r;e instanceof TC.feature.Point?r=t.addPoint(e.getCoords()):e instanceof TC.feature.Polyline?r=t.addPolyline(e.getCoords()):e instanceof TC.feature.Polygon?r=t.addPolygon(e.getCoords()):e instanceof TC.feature.MultiPolygon?r=t.addMultiPolygon(e.getCoords()):e instanceof TC.feature.MultiPolyline&&(r=t.addMultiPolyline(e.getCoords()));return r};if(t.layer){var r=t.layer.map.getLayer("WFSQueryResultsHighlight");r?e(r,t):t.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:TC.Consts.layerType.VECTOR,stealth:!0,styles:m()},function(r){e(r,t)})}},q=function(t){var e=t.layer.map.getLayer("WFSQueryResultsHighlight");e&&e.clearFeatures()};t.render=function(t){return TC.Control.prototype.render.call(this,t)};t.register=function(t){const e=this;c=t;return new Promise(function(t){dust.helpers.countif=function(t,e,r,n){n=n||{};var i=r.block,o=r.else,a=n.key||e.current(),s=null!=n.excludedKeys?n.excludedKeys.split(","):null,l=0;for(var c in a)(null==s||s.indexOf(c)<0)&&l++;l>0?t=t.render(i,e):o&&(t=t.render(o,e));return t};TC.Control.prototype.register.call(e,c).then(function(){y=function(){var t=TC.Util.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#ffffff",fillOpacity:0,strokeColor:"#ff0000",strokeWidth:2},polyline:{strokeColor:"#ff0000",strokeWidth:2},point:{strokeColor:"#ff0000"}});return e.styles?Object.assign(t,e.styles):t};m=function(){var t=TC.Util.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#0099FF",fillOpacity:0,strokeColor:"#0099FF",strokeWidth:4},polyline:{strokeColor:"#0099FF",strokeWidth:4},point:{strokeColor:"#0099FF"}});return e.highLightStyles?Object.assign(t,e.highLightStyles):t};s=c.options.locale;C=function(t,e){return TC.Util.getLocaleString(s,t,e)};t()})})};t.renderModalDialog=function(n){var i=n.getPath(),o=new Promise(function(o,a){n.getWFSCapabilitiesPromise().then(function(a){!function(n,i,o,a){var s=[];n.getDisgregatedLayerNames().forEach(function(t,e){var r=n.getPath(t);o.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))&&s.push({name:t,title:r[r.length-1]})});s.sort(function(t,e){return t.title<e.title?-1:t.title>e.title?1:0});t.getRenderedHtml(t.CLASS+"-dialog",{layerName:C("query.titleDialog",{layerName:i}),layers:s},function(t){var n=document.createHTMLElement(t);document.body.appendChild(n);(e=n.getElementsByClassName("tc-modal-body")[0]).classList.add("tc-loading");TC.Util.showModal(n,{closeCallback:function(){n.parentElement.removeChild(n)}});if(TC.Util.detectIE()){var i=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:i=.8;case document.body.clientWidth>1140:i=.7}e.style.maxHeight=document.body.clientHeight*i-e.nextElementSibling.clientHeight-e.previousElementSibling.clientHeight}r=n;n.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",function(){R()});a&&a(n)})}(n,i[i.length-1],a,function(t){o(t)})})});Promise.all([n,o,n.getWFSCapabilitiesPromise()]).then(T)}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var t={};const e=window.hasOwnProperty("Worker"),r=new Promise(function(t,r){if(e){var n=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?t(n):TC.ajax({url:n,method:"GET",responseType:"text"}).then(function(e){const r=e.data;var n=new Blob([r],{type:"text/javascript"}),i=window.URL.createObjectURL(n);t(i)},function(t){r(Error(t))})}}),n=function(t,e){return"No se pudo obtener el documento de capacidades del servicio "+t.url+": ["+e+"]"},i=function(t){return new Promise(function(i,a){const s=t.getGetCapabilitiesUrl();t.toolProxification.fetch(s,{retryAttempts:2}).then(function(s){(function(t,n){var i;if(n.documentElement){const e=n.getElementsByTagName("ServiceException")[0];if(e)i={error:e.textContent};else{var a=t.type===TC.Consts.layerType.WMTS?new t.wrap.WmtsParser:new t.wrap.WmsParser;i=a.read(n);if(t.type===TC.Consts.layerType.WMTS&&i.Contents&&i.Contents.Layer){const t=n.getElementsByTagName("Layer");for(var s=0,l=t.length;s<l;s++){const e=t[s];var c=TC.Util.getElementByNodeName(e,"ows:Identifier")[0].firstChild.data,u=i.Contents.Layer.filter(function(t){return t.Identifier==c});if(u.length){u=u[0];for(var h=0;h<u.TileMatrixSetLink.length;h++){var p,d=u.TileMatrixSetLink[h];matrixId=d.TileMatrixSet;const t=e.getElementsByTagName("TileMatrixSetLink");for(var f=0,g=t.length;f<g;f++){const e=t[f];if(e.querySelector("TileMatrixSet:first").textContent==matrixId){p=e;break}}if(p){d.TileMatrixSetLimits=[];const t=p.getElementsByTagName("TileMatrixLimits");for(f=0,g=t.length;f<g;f++){const e=t[f];d.TileMatrixSetLimits.push({TileMatrix:e.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(e.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(e.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(e.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(e.getElementsByTagName("MaxTileCol")[0].textContent)})}}}}}}}o(t,i);return Promise.resolve(i)}return new Promise(function(a,s){e&&"string"==typeof n?r.then(function(e){var r=new Worker(e);r.onmessage=function(e){if("success"===e.data.state){i=e.data.capabilities;o(t,i)}else s((i={error:"Web worker error"}).error);a(i);r.terminate()};r.postMessage({type:t.type,text:n})}):a(i=n)})})(t,s.responseText).then(function(e){e.error?a(Error(n(t,e.error))):i(e)}).catch(function(t){a(Error(t))})}).catch(function(e){a(Error(n(t,e)))})})},o=function(t,e){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var r=t.CAPABILITIES_STORE_KEY_PREFIX+t.options.url,n=function(){e.hasOwnProperty("error")||t.getCapabilitiesPromise().then(function(){localforage.setItem(r,e).then(function(){}).catch(function(t){console.log(t)})})};t.map?t.map.loaded(n):n()})},a=function t(e,r){var n=e.availableNames.indexOf(r.name);if(-1===n)for(var i=0,o=r.children.length;i<o&&-1===(n=t(e,r.children[i]));i++);return n},s=function t(e,r,n){var i=!1;n.count=n.count+1;if(e.name===r)i=!0;else for(var o=e.children.length-1;o>=0;o--)if(t(e.children[o],r,n)){i=!0;break}return i};TC.layer.Raster=function(){var e=this;TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");this.toolProxification=new TC.tool.Proxification(TC.proxify);this._capabilitiesPromise=null;TC.Layer.apply(e,arguments);e.wrap=new TC.wrap.layer.Raster(e);e.transparent=!1!==e.options.transparent;e.url=e.options.url;e.capabilities=TC.capabilities[e.url];e.params=e.options.params;if("string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else{e.names=[];e.availableNames=[];if(Array.isArray(e.options.layerNames))for(var r=0;r<e.options.layerNames.length;r++){if("string"==typeof(l=e.options.layerNames[r])){e.names.push(l);e.availableNames.push(l)}else if(l.hasOwnProperty("name")){e.availableNames.push(l.name);(void 0===l.isVisible||l.isVisible)&&e.names.push(l.name)}}else{var n=e.options.params?e.options.params.sld_body:null;if(n){const t=new DOMParser;var o;try{o=t.parseFromString(n,"text/xml")}catch(t){TC.error(t.message);o=null}if(o){var a=TC.Util.getElementByNodeName(o,"sld:NamedLayer");if(a&&a.length>0){var s=TC.Util.getElementByNodeName(a[0],"sld:Name");if(s&&s.length>0){var l=s[0].textContent;e.names.push(l);e.availableNames.push(l)}}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes||e.options.ignorePrefixes;e._capabilitiesNodes={};e.wrap._promise=new Promise(function(r,n){var o=function(){var t,i;if(!e.wrap.layer){switch(e.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:t=(i=e).wrap.createWMTSLayer(i.options);break;default:t=function(t){var e=Array.isArray(t.names)?t.names.join(","):t.names,r=t.options.format,n=t.options,i={LAYERS:e,FORMAT:r,TRANSPARENT:t.transparent,VERSION:t.capabilities.version||"1.3.0"};t.params&&TC.Util.extend(i,t.params);t.queryParams&&TC.Util.extend(i,t.queryParams);var o=t.getPreferredInfoFormat();null!==o&&(i.INFO_FORMAT=o);return t.wrap.createWMSLayer(t.getGetMapUrl(),i,n)}(e)}e.wrap.setLayer(t);t?r(t):n(Error('Could not create native layer for "'+e.id+'"'))}};const a=function(t){e.capabilities=e.capabilities||t;var r=e.getGetMapUrl();TC.capabilities[e.options.url]=TC.capabilities[e.options.url]||t;TC.capabilities[r]=TC.capabilities[r]||t;o()};if(e.capabilities){a(e.capabilities);e._capabilitiesPromise=Promise.resolve(e.capabilities);return}const s=t[e.url];t[e.url]=e._capabilitiesPromise=s||new Promise(function(t,r){const n=i(e),o=(a=e,new Promise(function(t,e){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(a.CAPABILITIES_STORE_KEY_PREFIX+a.url).then(function(r){r?t(r):e(Error("Capabilities not in storage: "+a.url))}).catch(function(){e(Error("Undefined storage error"))})})}));var a;n.then(function(e){t(e)}).catch(function(t){o.catch(function(){r(t)})});o.then(function(e){t(e)}).catch(function(){n.catch(function(t){r(t)})})});e.getCapabilitiesPromise().then(function(t){a(t)}).catch(function(t){e.map&&e.map.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"});n(t)})});e._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==e.type&&e.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);var l=TC.layer.Raster.prototype;l.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i;l.capabilitiesState_={PENDING:0,DONE:1};l.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";l.getByProxy_=function(t){return TC.proxify(t)};l.getBySSL_=function(t){return t.replace(this.PROTOCOL_REGEX,"https://")};l.getByUrl_=function(t){return t};l.setVisibility=function(t){this.tree=null;this._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(this,t)};var c=function t(e,r,n){var i=!1,o=e.wrap.getLayerNodes(n);if(o.length){for(var a=0,s=o.length;a<s;a++)t(e,r,o[a])&&(i=!0);var l,c,u=o.map(function(t){return e.wrap.getName(t)}).reverse(),h=!1;c=l=r.indexOf(u[0]);if(l<0)h=!0;else for(a=1,s=u.length;a<s;a++)if(u[a]!=r[++l]){h=!0;break}if(!h){var p=e.wrap.getName(n);if(p&&u.length>1){r.splice(c,u.length,p);i=!0}}}return i},u=function(t,e){for(var r=[],n=e.slice(),i=t.wrap.getRootLayerNode(),o=0,a=n.length;o<a;o++)r=r.concat(h(t,n[o],i));return r},h=function t(e,r,n,i){for(var o=[],a=e.wrap.getName(n),s=e.compareNames(r,a),l=!1,c=e.wrap.getLayerNodes(n),u=0;u<c.length;u++){var h=t(e,r,c[u],i||s);h.length?o=o.concat(h):l=!0}c.length&&!l||(i||s)&&(o=[a]);return o},p=function(t){return TC.Util.extend({aggregate:!0,lazy:!1},t)},d=function(t,e,r){var n,i,o=[];n=e||[];i=r||[];for(var a=(t||[]).concat(n),s=0;s<a.length;s++)a.indexOf(a[s])===s&&-1===i.indexOf(a[s])&&(o[o.length]=a[s]);return o},f=function(t,e){var r="string"==typeof e?e.split(","):e;if(t.capabilities){var n=t.getTree();r.sort(function(t,e){var r={count:0},i={count:0};s(n,t,r);s(n,e,i);return r.count-i.count})}return r},g=function(t,e,r,n){return r.filter(function(r){return t.compareNames(e,r,n)}).length>0};l.getLimitedMatrixSet=function(){return function(t){var e=t.layerNames,r=t.matrixSet,n=t.capabilities,i=[],o=n.Contents.TileMatrixSet.filter(function(t){return t.Identifier==r});if(o.length){o=o[0];var a=n.Contents.Layer.filter(function(t){return t.Identifier==e})[0];if(a.TileMatrixSetLink&&a.TileMatrixSetLink.length&&a.TileMatrixSetLink[0].TileMatrixSetLimits){for(var s,l=a.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){s=l[c];var u=o.TileMatrix.filter(function(t){return t.Identifier==s.TileMatrix});if(u.length){var h=TC.Util.extend({matrixIndex:o.TileMatrix.indexOf(u[0])},u[0],s);i.push(h)}}return i}return o.TileMatrix}return null}(this)};l.setLayerNames=function(t,e){var r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=Array.isArray(t)?t:t.split(",");r.names=i;var o=p(e);o.aggregate&&(i=function(t,e){if(t.type!==TC.Consts.layerType.WMS)return e;var r=e.slice();c(t,r,t.wrap.getRootLayerNode());return r}(r,i));r._disgregatedLayerNames=null;var a={LAYERS:i.join(","),TRANSPARENT:!0};if(o.lazy){var s=r._newParams||r.wrap.getParams();r._newParams=TC.Util.extend(s,a)}else{r.map&&r.map.trigger(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:r});r.tree=null;r._cache.visibilityStates={};r.wrap.setParams(a);!o.reset&&r.map||(r.availableNames=r.names);r.map&&r.map.trigger(TC.Consts.event.UPDATEPARAMS,{layer:r})}n(r.names)})})};l.addLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=p(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=u(r,o);a=r.getDisgregatedLayerNames()}r.setLayerNames(f(r,d(a,o,null)),e).then(function(t){n(t)})})})};l.removeLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=p(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=u(r,o);a=r.getDisgregatedLayerNames()}r.setLayerNames(f(r,d(a,null,o)),e).then(function(t){n(t)})})})};l.toggleLayerNames=function(t,e){const r=this;return new Promise(function(n,i){r.wrap.getLayer().then(function(){var i=p(e),o=Array.isArray(t)?t:t.split(","),a=r.wrap.getParams().LAYERS;if(i.aggregate){o=u(r,o);a=r.getDisgregatedLayerNames()}for(var s=[],l=[],c=0;c<o.length;c++){var h=o[c];a.indexOf(h)<0?s[s.length]=h:l[l.length]=h}var d=[];s.length>0&&d.push(r.addLayerNames(s,i));l.length>0&&d.push(r.removeLayerNames(l,i));Promise.all(d).then(function(t){const e=t[0],r=t[1];n(e?r?e.concat(r):e:[])})})})};l.getDisgregatedLayerNames=function(){var t=this.wrap.layer;if(this.wrap.isNative(t)&&this.type===TC.Consts.layerType.WMS){if(!this._disgregatedLayerNames){var e=this.wrap.getParams().LAYERS;e=Array.isArray(e)?e:e.split(",");this._disgregatedLayerNames=u(this,e)}}else this._disgregatedLayerNames=this.names;return this._disgregatedLayerNames.slice()};l.isValidFromNames=function(){for(var t=!0,e=0,r=this.names.length;e<r;e++)if(!this.getLayerNodeByName(this.names[e])){t=!1;break}return t};l.isCompatible=function(t){var e=!1;switch(this.type){case TC.Consts.layerType.WMTS:e=this.wrap.isCompatible(t)||this.wrap.getCompatibleMatrixSets(t).length>0;break;case TC.Consts.layerType.WMS:e=this.wrap.isCompatible(t)}return e};l.getCompatibleCRS=function(t){const e=this;t=t||{};var r=e.wrap.getCompatibleCRS();if(t.includeFallback&&e.fallbackLayer){const t=e.getFallbackLayer();t instanceof TC.Layer&&(r=r.concat(t.wrap.getCompatibleCRS()))}t.normalized&&(r=r.map(function(t){return TC.Util.getCRSCode(t)}).filter(function(t){return null!==t}).reduce(function(t,e){t.indexOf(e)<0&&(t[t.length]=e);return t},[]).map(function(t){return"EPSG:"+t}));return r};l.getProjection=function(){switch(this.type){case TC.Consts.layerType.WMTS:return this.wrap.layer.getSource().getProjection().getCode();case TC.Consts.layerType.WMS:return this.map.crs}};l.setProjection=function(t){if((t=t||{}).crs)switch(this.type){case TC.Consts.layerType.WMTS:var e=this.wrap.getCompatibleMatrixSets(t.crs)[0];if(e){this.matrixSet=e;this.wrap.setMatrixSet(e)}else this.wrap.setProjection(t);this.mustReproject=!e;break;case TC.Consts.layerType.WMS:this.wrap.setProjection(t);this.mustReproject=!this.isCompatible(t.crs)}};l.isVisibleByScale=function(t,e){var r,n,i,o=this,a=function(){return o.map.wrap.getResolution()*o.map.getMetersPerUnit()/28e-5};switch(o.type){case TC.Consts.layerType.WMTS:r=!1;var s=o.wrap.getTileMatrix(o.options.matrixSet);if(s){n=a();for(i=0;i<s.length;i++){if((h=o.wrap.getScaleDenominators(s[i]))[0]===n){r=!0;break}}}break;case TC.Consts.layerType.WMS:r=!0;var l=o.wrap.getAllLayerNodes();if(l.length>0){n=a();var c;if(parseInt(t).toString()===t)c=o._capabilitiesNodes[t];else for(i=0;i<l.length;i++){var u=l[i];if(o.compareNames(o.wrap.getName(u),t,e)){c=u;break}}if(c){var h=o.wrap.getScaleDenominators(c);if(!(r=!(parseFloat(h[1])>n||parseFloat(h[0])<n))&&c.Layer&&c.Layer.length>0)return c.Layer.some(function(t){var e=o.wrap.getScaleDenominators(t);return!(parseFloat(e[1])>n||parseFloat(e[0])<n)})}}break;default:r=!0}return r};l.isVisibleByName=function(t,e){var r=this,n=!1;switch(r.type){case TC.Consts.layerType.WMTS:if(r.wrap.getWMTSLayer()){n=!0;break}break;case TC.Consts.layerType.WMS:var i=function t(n,i){var o=null,a=r.wrap.getName(i);if(r.compareNames(a,n,e))o=[a];else for(var s=r.wrap.getLayerNodes(i),l=0;l<s.length;l++){var c=t(n,s[l]);if(c){TC.Util.fastUnshift(c,a);o=c;break}}return o},o=function(t){return i(t,r.wrap.getRootLayerNode())}(t);if(o)for(var a=0;a<o.length;a++)if(g(r,o[a],r.names)){n=!0;break}break;default:n=!0}return n};l.getTree=function(){var t=this,e=t.tree;if(!e){var r,n=function e(n,i,o){var a;for(var s in t._capabilitiesNodes)if(t._capabilitiesNodes[s]===n){a=s;break}if(!a){a=TC.getUID();t._capabilitiesNodes[a]=n}var l,c,u={name:t.wrap.getName(n),title:n.title||n.Title,uid:a,children:[]};o&&(r=u);g(t,u.name,t.availableNames)&&(i=!0);if(t.options.isBase){u.name=t.names.join(",");u.title=t.title||u.title;u.isBase=t.isDefault;t.options.thumbnail&&(u.legend={src:t.options.thumbnail})}else{u.isVisible=u===r?t.getVisibility():t.isVisibleByName(u.name);var h,p=t.wrap.getLayerNodes(n);for(h=0;h<p.length;h++){var d=e(p[h],i);d&&(l=u,c=d,t.options.inverseTree?TC.Util.fastUnshift(l.children,c):l.children[l.children.length]=c)}u.legend=t.wrap.getLegend(n);if(!i&&!o){r.children=r.children.concat(u.children);u=null}}return u};switch(t.type){case TC.Consts.layerType.WMTS:e=n(t.wrap.getWMTSLayer(),!t.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(t.capabilities){e=n(t.wrap.getRootLayerNode(),!t.options.hideTree,!0);var i=t._cache.visibilityStates;!function t(e){var r=TC.Consts.visibility.NOT_VISIBLE;if(e){if(void 0!==i[e.uid])r=i[e.uid];else{if(e.children)for(var n=!1,o=!1,a=0,s=e.children.length;a<s;a++){switch(t(e.children[a])){case TC.Consts.visibility.VISIBLE:n=!0;break;case TC.Consts.visibility.NOT_VISIBLE:o=!0;break;case TC.Consts.visibility.HAS_VISIBLE:n=!0;o=!0}n&&(r=o?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}e.isVisible&&(r=TC.Consts.visibility.VISIBLE);i[e.uid]=r}e.visibilityState=r}return r}(e);t.options.hideTree&&function t(e,r){r.children.sort(function(t,r){return a(e,r)-a(e,t)});for(var n=0,i=r.children.length;n<i;n++)t(e,r.children[n])}(t,e)}}e||(e={name:t.name,title:t.title});e.title=t.title||e.title;e.customLegend=t.customLegend||e.customLegend;t.tree=e}return e};l.setNodeVisibility=function(t,e){var r=this;r.tree||(r.tree=r.getTree());var n=r.findNode(t,r.tree);if(n===r.tree)e&&0===r.names.length?r.addLayerNames(r.availableNames).then(function(){r.setVisibility(!0)}):r.setVisibility(e);else{var i=function t(e){var r=[];if(e.name)r[0]=e.name;else for(var n=0;n<e.children.length;n++)r=r.concat(t(e.children[n]));return r}(n);e?r.addLayerNames(i):r.removeLayerNames(i)}};l.getNodeVisibility=function(t){this.tree||(this.tree=this.getTree());return this._cache.visibilityStates[t]};l.getNodePath=function(t,e){var r=this,n=[];if(r.type===TC.Consts.layerType.WMS&&r.capabilities){t=t||r.names[0];n=function n(i){var o=[],a=r.wrap.getName(i);if(r.compareNames(a,t,e))o.push(i);else for(var s=r.wrap.getLayerNodes(i),l=0;l<s.length;l++){var c=n(s[l]);if(c.length){o=c;TC.Util.fastUnshift(o,i);break}}return o}(r.wrap.getRootLayerNode())}return n};l.getPath=function(t,e){return this.getNodePath(t,e).map(function(t){return t.title||t.Title})};l.getLayerNodeByName=function(t){for(var e=null,r=this.wrap.getServiceType()===TC.Consts.layerType.WMTS?this.wrap.getIdentifier:this.wrap.getName,n=this.wrap.getAllLayerNodes(),i=0,o=n.length;i<o;i++)if(this.compareNames(r(n[i]),t)){e=n[i];break}return e};l.getChildrenLayers=function(t){var e=[],r=function(t,e){if(t&&t.Layer&&t.Layer.length)for(var n=0;n<t.Layer.length;n++){e[e.length]=t.Layer[n];r(t.Layer[n],e)}};r(t,e);return e};l.compareNames=function(t,e,r){var n=t===e,i=void 0!==r?r:this.ignorePrefixes;if(!n&&i&&t&&e){var o=t.indexOf(":"),a=e.indexOf(":");o>=0&&a<0?n=t.substr(o+1)===e:a>=0&&o<0&&(n=t===e.substr(a+1))}return n};l.getCapabilitiesPromise=function(){return this._capabilitiesPromise};l.getResolutions=function(){return this.wrap.getResolutions()};l.setResolutions=function(t){this.wrap.setResolutions(t)};l.searchSubLayers=function(t){this.patternFn||(this.patternFn=function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/[^a-z\d\xe1\xe9\xed\xf3\xfa\xfc\xf1]/gi,"\\$&")).replace(/(a|\xe1)/gi,"(a|\xe1)")).replace(/(e|\xe9)/gi,"(e|\xe9)")).replace(/(i|\xed)/gi,"(i|\xed)")).replace(/(o|\xf3)/gi,"(o|\xf3)")).replace(/(u|\xfa|\xfc)/gi,"(u|\xfa|\xfc)")).replace(/n/gi,"(n|\xf1)")});if(t&&t.length&&t.length>=3){var e=this,r=null;if(this.lastPattern&&t.indexOf(this.lastPattern)>=0)r=this.lastMatches;else if(e.availableNames&&e.availableNames.length>0){r=[];for(var n=0;n<e.availableNames.length;n++){var i=e.getLayerNodeByName(e.availableNames[n]);if(i){r[r.length]=i;r=r.concat(e.getChildrenLayers(i))}}}else r=e.wrap.getAllLayerNodes();var o=this.patternFn(t),a=new RegExp(o,"i"),s=r.map(function(t,r){delete t.tcScore;t.tcPosition=r;e.wrap.normalizeLayerNode(t);var n=t.Title.trim(),i=a.exec(n),o=i?i.index:-1,s=-1;if(t.Abstract){var l=t.Abstract.trim(),c=a.exec(l);s=c?c.index:-1}i&&n==i[0]?t.tcScore=20:0==o?t.tcScore=15:o>-1?t.tcScore=10:0==s?t.tcScore=5:s>-1&&(t.tcScore=1);return t.tcScore?t:null}).filter(function(t){return null!=t}).sort(function(t,e){if(e.tcScore===t.tcScore){var r=TC.Util.replaceAccent(t.Title),n=TC.Util.replaceAccent(e.Title);return r<n?-1:r>n?1:0}return e.tcScore-t.tcScore});this.lastPattern=t;this.lastMatches=s;return s}return[]};l.getGetCapabilitiesUrl=function(){const t=this;var e;const r=t.url,n={};if(t.type===TC.Consts.layerType.WMTS)if(t.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var i="/1.0.0/WMTSCapabilities.xml";const t=r.indexOf(i);if(t<0||t<r.length-i.length){"/"===r[r.length-1]&&(i=i.substr(1));e=r+i}else e=r}else{e=r;n.SERVICE="WMTS";n.VERSION="1.0.0";n.REQUEST="GetCapabilities"}else{e=r;n.SERVICE="WMS";n.VERSION="1.3.0";n.REQUEST="GetCapabilities"}return e=e+"?"+TC.Util.getParamString(TC.Util.extend(n,t.queryParams))};l.getGetMapUrl=function(){return function(t){var e=t;if(t){var r=t.match(/\??SERVICE=\w+&/i);r&&(e=e.replace(r[0],""))}return e}(this.wrap.getGetMapUrl())};l.getPreferredInfoFormat=function(){var t=null;const e=this.wrap.getInfoFormats();if(e)for(var r=0;r<TC.wrap.layer.Raster.infoFormatPreference.length;r++){var n=TC.wrap.layer.Raster.infoFormatPreference[r];if(e.indexOf(n)>=0){t=n;break}}return t};l.getLegendGraphicImage=function(){const t=this;return new Promise(function(e,r){if(t.options.params.base64LegendSrc)return e(t.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var n=t.names[0],i=t.wrap.getInfo(n),o=new XMLHttpRequest,a=i.legend[0].src.split("?"),s=a[1].split("&"),l=t.options.params.sld_body?"sld_body="+t.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}t.options.params.env&&(l+="&"+t.options.params.env);o.open("POST",a[0],!0);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.responseType="arraybuffer";o.onload=function(r){if(200===this.status){for(var n=new Uint8Array(this.response),i=n.length,a=new Array(i);i--;)a[i]=String.fromCharCode(n[i]);var s=a.join(""),l=o.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(s);t.options.params.base64LegendSrc=c;e(c)}}};o.send(l)}else r(Error("Funci\xf3n window.btoa no soportada por el navegador"))})};l.getUrl=function(t){return t};l.getWebGLUrl=function(t,e){const r=this;return new Promise(function(e,n){var i=!TC.Util.isSecureURL(t)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(r.url))?r.getBySSL_(t):t;if(r.ignoreProxification)e(i);else{const t={exportable:!0,ignoreProxification:r.ignoreProxification};r.toolProxification.fetchImage(i,t).then(function(){r.toolProxification.cacheHost.getAction(i,t).then(function(t){t&&t.action&&e(t.action.call(r.toolProxification,i))})}).catch(function(t){n(Error(t))})}})};l.getFeatureUrl=function(t){var e=this;return e.toolProxification.fetch(t).then(function(){return e.toolProxification.cacheHost.getAction(t).then(function(r){return r.action.call(e.toolProxification,t)}).catch(function(t){return Promise.reject(t)})}).catch(function(t){return Promise.reject(t)})};l.getSiblingLoadedLayer=function(t){var e=this;if(e.map){return e.map.baseLayers.slice(0).concat(e.map.workLayers.slice(0)).filter(function(r){return(r.type===TC.Consts.layerType.WMS||r.type===TC.Consts.layerType.WMTS)&&(r.capabilities===e.capabilities||r.url===e.url)&&(!TC.Util.isFunction(t)||t(r))})[0]||null}return null};l.getImageLoad=function(t,e,r){const n=this,i=function(e){var r=t.getImage();TC.Util.isSameOrigin(e.src)||(!n.map||n.map&&n.map.mustBeExportable)&&(r.crossOrigin=null!==e.crossOrigin?e.crossOrigin:"anonymous");r.setAttribute("src",e.src);y.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})};if(n.names&&n.names.length>0){const r=function(e){y.call(n).trigger(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}});i({src:TC.Consts.BLANK_IMAGE})};if(n.type===TC.Consts.layerType.WMTS){var o,a,s;if("KVP"!=n.encoding){var l=e.replace("."+n.format.split("/")[1],"");o=(c=l.split("/").slice(l.split("/").length-3).map(function(t){return parseInt(t)}))[0];a=c[1];s=c[2]}else{var c;if((c=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(e))&&4==c.length){o=(c=c.slice(1).map(function(t){return parseInt(t)}))[0];a=c[2];s=c[1]}}if(o&&a&&s){var u=n.wrap.getWMTSLayer();if(u){var h=u.TileMatrixSetLink.filter(function(t){return t.TileMatrixSet===n.matrixSet});if(h.length>0&&h[0].TileMatrixSetLimits.length>0){var p=h[0].TileMatrixSetLimits.sort(function(t,e){return parseInt(t.TileMatrix)>parseInt(e.TileMatrix)?1:parseInt(t.TileMatrix)<parseInt(e.TileMatrix)?-1:0})[o];if(p&&n.map&&n.map.on3DView&&!(p.MinTileRow<=a&&p.MaxTileRow>=a&&p.MinTileCol<=s&&p.MaxTileCol>=s)){console.log("Prevenimos petici\xf3n fuera de matrix set, cargamos imagen en blanco");i({src:TC.Consts.BLANK_IMAGE});return}}}}}y.call(n).trigger(TC.Consts.event.BEFORETILELOAD,{tile:t});var d="";if("POST"===n.options.method){var f=e.split("?");d=f[1].split("&").filter(function(t){const e=t.split("=");return e.length>1&&e[1].trim().length>0&&"layers"!==e[0].trim().toLowerCase()}).join("&");n.toolProxification.fetchImageAsBlob(f[0],{type:"POST",data:d,contentType:"application/x-www-form-urlencoded"}).then(function(e){const r=URL.createObjectURL(e);t.getImage().onload=function(t){URL.revokeObjectURL(r)};i({src:r})}).catch(r)}else if(n.ignoreProxification){i({src:e});var g=t.getImage();TC.Util.isSameOrigin(e)||(!n.map||n.map&&n.map.mustBeExportable)&&(g.crossOrigin="anonymous");g.onload=function(){y.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})};g.onerror=function(e){g.src=TC.Consts.BLANK_IMAGE;y.call(n).trigger(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}})};g.src=n.names.length?e:TC.Consts.BLANK_IMAGE}else n.toolProxification.fetchImage(e,{exportable:!n.map||n.map&&n.map.mustBeExportable}).then(function(t){i(t)}).catch(r)}else{i({src:TC.Consts.BLANK_IMAGE});y.call(n).trigger(TC.Consts.event.TILELOAD,{tile:t})}};var y=function(){const t=this;return t.wrap&&t.wrap.$events?t.wrap.$events:null};l.getWFSCapabilitiesPromise=function(){const t=this;void 0===WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser");const e=this.options.url.replace(/wms/gi,"wfs"),r=!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(e))?t.getBySSL_(e):e,n=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.WFScapabilities[n])return TC.WFScapabilities[n]instanceof Promise?TC.WFScapabilities[n]:new Promise(function(t,e){setTimeout(function(){t(TC.WFScapabilities[n])},100)});TC.WFScapabilities[n]=new Promise(function(e,i){var o={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"},a=t.getUrl(r+"?"+TC.Util.getParamString(o));t.toolProxification.fetch(a,{retryAttempts:2}).then(function(t){var r,o;const a=t.responseText&&(t.responseText.ownerDocument||t.responseText).documentElement;var s=(o=!!a&&"HTML"!==a.nodeName?t.responseText:(new DOMParser).parseFromString(t.responseText,"text/xml")).getElementsByTagName("ServiceException")[0];s||(s=o.getElementsByTagName("ExceptionText")[0]);if(s)i(Error(s.innerHTML));else{try{r=WFSCapabilities.Parse(o)}catch(t){i(t instanceof Error?t:Error(t));return}if(r.Operations){var l=r.Operations.GetCapabilities.DCP&&r.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||r.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[l]=r;TC.WFScapabilities[n]=r;e(r)}else i(null)}}).catch(function(t){i(t instanceof Error?t:Error(t))})});return TC.WFScapabilities[n]};l.getFallbackLayer=function(){const t=this;if(t.fallbackLayer instanceof TC.Layer)return t.fallbackLayer;if(t.options.fallbackLayer){var e=t.options.fallbackLayer;if("string"==typeof e){(t.map?t.map.options.availableBaseLayers:TC.Cfg.availableBaseLayers).forEach(function(e){if(t.options.fallbackLayer===e.id){t.fallbackLayer=new TC.layer.Raster(TC.Util.extend({},e,{isBase:!0,stealth:!0,map:t.map}));t.fallbackLayer.firstOption=t}})}else if(e instanceof TC.Layer){t.fallbackLayer=e;t.fallbackLayer.firstOption=t}else{t.fallbackLayer=new TC.layer.Raster(TC.Util.extend({},e,{id:TC.getUID(),isBase:!0,stealth:!0,title:layer.title,map:t.map}));t.fallbackLayer.firstOption=t}return t.fallbackLayer}return null}}();var esriParser={parse:function(t){var e=[],r=(new DOMParser).parseFromString(t,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,o=n.length;i<o;i++)for(var a=n[i],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var h=l[c].getElementsByTagName("Field"),p={},d=0,f=h.length;d<f;d++){var g=h[d];p[getElementText(g.getElementsByTagName("FieldName")[0])]=getElementText(g.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(p);y.setId(s+"."+TC.getUID());e[e.length]=y}return e}};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.layer.Vector=function(){TC.Layer.apply(this,arguments);this.type=this.options.type||TC.Consts.layerType.VECTOR;this.features=[];this.selectedFeatures=[];const t=function(t){var e=(t=t||"").indexOf("?");e>=0?t=t.substr(0,e):(e=t.indexOf("#"))>=0&&(t=t.substr(0,e));return t.substr(t.lastIndexOf(".")).toLowerCase()}(this.url),e=function(t){switch(t){case TC.Consts.mimeType.KML:return TC.Consts.format.KML;case TC.Consts.mimeType.GPX:return TC.Consts.format.GPX;case TC.Consts.mimeType.JSON:case TC.Consts.mimeType.GEOJSON:return TC.Consts.format.GEOJSON;case TC.Consts.mimeType.GML:return TC.Consts.format.GML;default:return null}}(this.options.format)||function(t){switch(t){case".kml":return TC.Consts.format.KML;case".gpx":return TC.Consts.format.GPX;case".json":case".geojson":return TC.Consts.format.GEOJSON;case".gml":return TC.Consts.format.GML;case".wkt":return TC.Consts.format.WKT;case".topojson":return TC.Consts.format.TOPOJSON;default:return null}}(t);if(e||this.type===TC.Consts.layerType.KML){e===TC.Consts.format.KML&&(this.type=TC.Consts.layerType.KML);this.title=this.options.title||function(e){for(var r=e=e||"",n=new RegExp("([^/]+"+t+")","i"),i=0;i<3;i++){e=decodeURIComponent(e);var o=n.exec(e);if(o.length>1){r=o[1];break}}return r}(this.url)}this.wrap=new TC.wrap.layer.Vector(this);var r=this.wrap.createVectorLayer();this.wrap.setLayer(r);this.wrap._promise=Promise.resolve(r)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var t=TC.layer.Vector.prototype;t.getTree=function(){var t=null;if(!this.options.stealth){(t={}).children=[];for(var e=0;e<this.features.length;e++){var r=this.features[e].getPath();if(r.length){var n=TC.Util.addArrayToTree(r,t);n&&(n.legend=this.features[e].getLegend())}}t.name=this.name||t.name;t.customLegend=this.options.customLegend;t.title=this.title||t.title;t.uid=this.id}return t};var e=function(t,e,r,n){return new Promise(function(i,o){e.call(t,[r],n).then(function(e){i(e[0]);t.map&&t.map.trigger(TC.Consts.event.FEATUREADD,{layer:t,feature:e[0]})})})},r=function(t,e,r,n,i){var o=t.options.styles&&t.options.styles[n]||TC.Cfg.styles[n],a=TC.Util.extend(!0,{},o,i);return new Promise(function(n,i){var o;const s=function(){o=o||TC.feature[r];for(var i=new Array(e.length),s=[],l=0,c=e.length;l<c;l++){var u,h=e[l];const n=TC.wrap.Feature.prototype.isNative(h);if(h instanceof o||"TC.feature."+r===h.CLASSNAME)u=h;else{a.layer=t;n&&(u=h._wrap&&h._wrap.parent);u||(u=new o(h,a))}u.layer=t;i[l]=u;t.features[t.features.length]=u;n||(s[s.length]=u.wrap.feature);u.options.showPopup&&u.showPopup()}s.length&&t.wrap.addFeatures(s);n(i)};if(r)TC.loadJS(!TC.feature||TC.feature&&!TC.feature[r],[TC.apiLocation+"TC/feature/"+r],s);else{o=TC.Feature;s()}})};t.addPoint=function(t,r){return e(this,this.addPoints,t,r)};t.addPoints=function(t,e){return r(this,t,"Point",TC.Consts.geom.POINT,e)};t.addMarker=function(t,r){return e(this,this.addMarkers,t,r)};t.addMarkers=function(t,e){return r(this,t,"Marker","marker",e)};t.addPolyline=function(t,r){return e(this,this.addPolylines,t,r)};t.addPolylines=function(t,e){return r(this,t,"Polyline",TC.Consts.geom.POLYLINE,e)};t.addMultiPolyline=function(t,r){return e(this,this.addMultiPolylines,t,r)};t.addMultiPolylines=function(t,e){return r(this,t,"MultiPolyline",TC.Consts.geom.POLYLINE,e)};t.addPolygon=function(t,r){return e(this,this.addPolygons,t,r)};t.addPolygons=function(t,e){return r(this,t,"Polygon",TC.Consts.geom.POLYGON,e)};t.addMultiPolygon=function(t,r){return e(this,this.addMultiPolygons,t,r)};t.addMultiPolygons=function(t,e){return r(this,t,"MultiPolygon",TC.Consts.geom.POLYGON,e)};t.addCircle=function(t,r){return e(this,this.addCircles,t,r)};t.addCircles=function(t,e){return r(this,t,"Circle",TC.Consts.geom.POLYGON,e)};t.addFeature=function(t){const e=this;var n;TC.feature&&(n=TC.feature.Point&&t instanceof TC.feature.Point||"TC.feature.Point"===t.CLASSNAME?e.addPoint(t):TC.feature.Polyline&&t instanceof TC.feature.Polyline||"TC.feature.Polyline"===t.CLASSNAME?e.addPolyline(t):TC.feature.Polygon&&t instanceof TC.feature.Polygon||"TC.feature.Polygon"===t.CLASSNAME?e.addPolygon(t):TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon||"TC.feature.MultiPolygon"===t.CLASSNAME?e.addMultiPolygon(t):TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline||"TC.feature.MultiPolyline"===t.CLASSNAME?e.addMultiPolyline(t):TC.feature.Circle&&t instanceof TC.feature.Circle||"TC.feature.Circle"===t.CLASSNAME?e.addCircle(t):r(e,[t]));return n};t.removeFeature=function(t){const e=this;if(t.layer&&e.features.indexOf(t)>=0){if(e.map){e.map.getControlsByClass("TC.control.Popup").forEach(function(e){e.isVisible()&&e.currentFeature===t&&e.hide()});e.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(e){e.isVisible()&&e.currentFeature===t&&e.close()})}e.wrap.removeFeature(t);t.layer=null}};t.getFeatureById=function(t){var e=null,r=this.wrap.getFeatureById(t);r&&(e=r._wrap.parent);return e};t.clearFeatures=function(){var t=this;if(t.features&&t.wrap){if(t.map){t.map.getControlsByClass("TC.control.Popup").forEach(function(e){e.isVisible()&&t.features.indexOf(e.currentFeature)>=0&&e.hide()})}t.features.length=0;t.wrap.clearFeatures()}};t.describeFeatureType=function(t,e){const r=this;new Promise(function(t,e){TC.ajax({url:r.wrap.getDescribeFeatureTypeUrl(),method:"GET",responseType:TC.Consts.mimeType.XML}).then(function(r){const n=r.data;var i="http://www.w3.org/2001/XMLSchema",o=n.getElementsByTagNameNS(i,"complexType")[0];if(o){for(var a=o.getElementsByTagNameNS(i,"element"),s=new Array(a.length),l=0,c=a.length;l<c;l++){var u=a[l];s[l]={name:u.getAttribute("name"),type:u.getAttribute("type"),nillable:"true"===u.getAttribute("nillable"),minOccurs:parseInt(u.getAttribute("minOccurs")),maxOccurs:parseInt(u.getAttribute("maxOccurs"))}}t(s)}else{var h=n.getElementsByTagName("Exception")[0];h&&e(h.getElementsByTagName("ExceptionText")[0].innerHTML)}}).catch(function(t,r,n){e(Error(n))})}).then(function(e){TC.Util.isFunction(t)&&t(e)},function(t){TC.Util.isFunction(e)&&e(t)})};t.import=function(t){this.wrap.import(t)};t.setNodeVisibility=function(t,e){this.state=TC.Layer.state.LOADING;this.map.trigger(TC.Consts.event.BEFOREUPDATE);this.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:this});this.tree||(this.tree=this.getTree());if(this.findNode(t,this.tree)===this.tree)this.setVisibility(e);else{this._cache.visibilityStates[t]=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var r,n,i=!1;for(r=0;r<this.features.length;r++)if((n=this.features[r]).id==t){i=!0;n.setVisibility(e);break}if(!i)for(r=0;r<this.features.length;r++){void 0===(n=this.features[r])._path&&(n._path="/"+n.getPath().join("/"));n._path===t&&n.setVisibility(e)}}this.state=TC.Layer.state.IDLE;this.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:this});this.map.trigger(TC.Consts.event.UPDATE)};t.getNodeVisibility=function(t){var e=TC.Layer.prototype.getNodeVisibility.call(this,t);this.tree||(this.tree=this.getTree());if(this.findNode(t,this.tree)===this.tree)e=this.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var r=this._cache.visibilityStates[t];void 0!==r&&(e=r)}return e};t.setModifiable=function(t){this.wrap.setModifiable(t)};t.applyEdits=function(t,e,r){return this.wrap.sendTransaction(t,e,r)};t.refresh=function(){return this.wrap.reloadSource()};t.getFeaturesInCurrentExtent=function(t){var e=this.map.getExtent();return this.getFeaturesInExtent(e,t)};t.getFeaturesInExtent=function(t,e){return this.wrap.getFeaturesInExtent(t,e)};t.setProjection=function(t){const e=this;e.wrap.setProjection(t);if(t.crs&&t.oldCrs){e.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:e});e.features.forEach(function(e){e.wrap.setGeometry(TC.Util.reproject(e.geometry,t.oldCrs,t.crs));e.geometry=e.wrap.getGeometry()});e.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:e})}};t.exportState=function(t){const e=this;t=t||{};const r={id:e.id};e.map&&e.map.crs!==e.map.options.crs&&(r.crs=e.map.crs);var n=Math.pow(10,(e.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)+1);const i=t.features||e.features;r.features=i.map(function(r){const i={};var o;switch(!0){case TC.feature.Marker&&r instanceof TC.feature.Marker:i.type=TC.Consts.geom.POINT;o=e.options.styles&&e.options.styles.marker;break;case TC.feature.Point&&r instanceof TC.feature.Point:i.type=TC.Consts.geom.POINT;o=e.options.styles&&e.options.styles.point;break;case TC.feature.Polyline&&r instanceof TC.feature.Polyline:i.type=TC.Consts.geom.POLYLINE;o=e.options.styles&&e.options.styles.line;break;case TC.feature.MultiPolyline&&r instanceof TC.feature.MultiPolyline:i.type=TC.Consts.geom.MULTIPOLYLINE;o=e.options.styles&&e.options.styles.line;break;case TC.feature.Polygon&&r instanceof TC.feature.Polygon:i.type=TC.Consts.geom.POLYGON;o=e.options.styles&&e.options.styles.polygon;break;case TC.feature.MultiPolygon&&r instanceof TC.feature.MultiPolygon:i.type=TC.Consts.geom.MULTIPOLYGON;o=e.options.styles&&e.options.styles.polygon;break;case TC.feature.Circle&&r instanceof TC.feature.Circle:i.type=TC.Consts.geom.CIRCLE;o=e.options.styles&&e.options.styles.polygon}i.id=r.id;i.geom=TC.Util.compactGeometry(r.geometry,n);i.data=r.getData();i.showsPopup=r.showsPopup;if(void 0===t.exportStyles||t.exportStyles){o=TC.Util.extend({},o);for(var a in o){var s=o[a];TC.Util.isFunction(s)&&(o[a]=s(r))}i.style=TC.Util.extend(o,r.getStyle())}return i});return r};t.importState=function(t){const e=this;return new Promise(function(r,n){const i=new Array(t.features.length);t.features.forEach(function(r,n){const o=TC.Util.extend(r.style,{data:r.data,id:r.id,showsPopup:r.showsPopup});var a;switch(r.type){case TC.Consts.geom.POLYGON:a=e.addPolygon;break;case TC.Consts.geom.MULTIPOLYGON:a=e.addMultiPolygon;break;case TC.Consts.geom.POLYLINE:a=e.addPolyline;break;case TC.Consts.geom.MULTIPOLYLINE:a=e.addMultiPolyline;break;case TC.Consts.geom.CIRCLE:a=e.addCircle;break;case TC.Consts.geom.POINT:a=r.style&&(r.style.url||r.style.className)?e.addMarker:e.addPoint}if(a){var s=TC.Util.explodeGeometry(r.geom);t.crs&&e.map.crs!==t.crs?i[n]=new Promise(function(t,r){e.map.one(TC.Consts.event.PROJECTIONCHANGE,function(n){a.call(e,s,o).then(function(){t()},function(){r()})})}):i[n]=a.call(e,s,o)}});Promise.all(i).then(function(){r()},function(t){n(t instanceof Error?t:Error(t))})})}}();function xml2json(t){var e={toObj:function(t){var r={};if(1==t.nodeType){if(t.attributes.length)for(var n=0;n<t.attributes.length;n++)"name"!==t.attributes[n].nodeName&&(r[t.attributes[n].nodeName]=(t.attributes[n].nodeValue||"").toString());if(t.firstChild){for(var i=0,o=0,a=!1,s=t.firstChild;s;s=s.nextSibling)1==s.nodeType?a=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==s.nodeType&&o++;if(a)if(2>i&&2>o){e.removeWhite(t);for(s=t.firstChild;s;s=s.nextSibling){var l=e.removePrefix(s.nodeName);if(3==s.nodeType)r["#text"]=e.escape(s.nodeValue);else if(4==s.nodeType)r["#cdata"]=e.escape(s.nodeValue);else if(r[l])r[l]instanceof Array?r[l][r[l].length]=e.toObj(s):r[l]=[r[l],e.toObj(s)];else{var c=null;s.attributes.getNamedItem("name")&&(c=s.attributes.getNamedItem("name").nodeValue),r[c||l]=e.toObj(s)}}}else t.attributes.length?r["#text"]=e.escape(e.innerXml(t)):r=e.escape(e.innerXml(t));else if(i)t.attributes.length?r["#text"]=e.escape(e.innerXml(t)):r=e.escape(e.innerXml(t));else if(o)if(o>1)r=e.escape(e.innerXml(t));else for(s=t.firstChild;s;s=s.nextSibling)r["#cdata"]=e.escape(s.nodeValue)}t.attributes.length||t.firstChild||(r=null)}else 9==t.nodeType?r=e.toObj(t.documentElement):8==t.nodeType?console.log(t.textContent):alert("unhandled node type: "+t.nodeType);return r},toJson:function(t,r,n){var i=r?'"'+r+'"':"";if(t instanceof Array){for(var o=0,a=t.length;a>o;o++)t[o]=e.toJson(t[o],"",n+"\t");i+=(r?":[":"[")+(t.length>1?"\n"+n+"\t"+t.join(",\n"+n+"\t")+"\n"+n:t.join(""))+"]"}else if(null==t)i+=(r&&":")+"null";else if("object"==typeof t){var s=[];for(var l in t)s[s.length]=e.toJson(t[l],l,n+"\t");i+=(r?":{":"{")+(s.length>1?"\n"+n+"\t"+s.join(",\n"+n+"\t")+"\n"+n:s.join(""))+"}"}else i+="string"==typeof t?(r&&":")+'"'+t.toString()+'"':(r&&":")+t.toString();return i},innerXml:function(t){var e="";if("innerHTML"in t)e=t.innerHTML;else for(var r=function(t){var e="";if(1==t.nodeType){e+="<"+t.nodeName;for(var n=0;n<t.attributes.length;n++)e+=" "+t.attributes[n].nodeName+'="'+(t.attributes[n].nodeValue||"").toString()+'"';if(t.firstChild){e+=">";for(var i=t.firstChild;i;i=i.nextSibling)e+=r(i);e+="</"+t.nodeName+">"}else e+="/>"}else 3==t.nodeType?e+=t.nodeValue:4==t.nodeType&&(e+="<![CDATA["+t.nodeValue+"]]>");return e},n=t.firstChild;n;n=n.nextSibling)e+=r(n);return e},escape:function(t){return t.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(t){t.normalize();for(var r=t.firstChild;r;)if(3==r.nodeType)if(r.nodeValue.match(/[^ \f\n\r\t\v]/))r=r.nextSibling;else{var n=r.nextSibling;t.removeChild(r),r=n}else 1==r.nodeType?(e.removeWhite(r),r=r.nextSibling):r=r.nextSibling;return t},removePrefix:function(t){return t.substring(t.indexOf(":")+1)}};return 9==t.nodeType&&(t=t.documentElement),e.toObj(e.removeWhite(t))}var WFSCapabilities=function(){var t="1.0.0",e="1.1.0",r="2.0.0",n=function(n,i){switch(i){case t:var o=n.Capability.Request;if(o.GetFeature){var a=[];for(var s in o.GetFeature.ResultFormat)a.push(s.toLowerCase());o.GetFeature.outputFormat=a,delete o.GetFeature.ResultFormat,o.GetFeature.Operations=n.FeatureTypeList.Operations}return o;case e:return{};case r:var l={};for(var s in n.OperationsMetadata){var c={};c[s]=n.OperationsMetadata[s];for(var u in c[s])c[s][u]&&c[s][u].hasOwnProperty("AllowedValues")&&(c[s][u]=c[s][u].AllowedValues.Value);TC.Util.extend(l,c)}return l}return null},i=function(n,i){switch(i){case t:for(var o={},a=0;a<n.FeatureTypeList.FeatureType.length;a++){o[(s=n.FeatureTypeList.FeatureType[a].Name).substring(s.indexOf(":")+1)]=n.FeatureTypeList.FeatureType[a]}return o;case e:return{};case r:for(o={},a=0;a<n.FeatureTypeList.FeatureType.length;a++){var s;o[(s=n.FeatureTypeList.FeatureType[a].Name).substring(s.indexOf(":")+1)]=n.FeatureTypeList.FeatureType[a]}return o}return null},o=function(n,i){switch(i){case t:return n.Filter_Capabilities;case e:return{};case r:return n.Filter_Capabilities}return null},a=function(n,i){switch(i){case t:var o={};for(var a in n)"string"==typeof n[a]&&(o[a]=n[a]);return o;case e:return{};case r:o={};for(var a in n)"string"==typeof n[a]&&(o[a]=n[a]);return o}return{}};return{Promises:function(t){var e=(t=t).substring(t.indexOf("://")<0?0:t.indexOf("://")+3);if(TC.capabilities[e])return Promise.resolve(TC.capabilities[e]);var r={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return new Promise(function(n,i){TC.ajax({url:TC.proxify(t)+"?"+TC.Util.getParamString(r),method:"GET"}).then(function(t){var r=WFSCapabilities.Parse(t.data),i=r.Operations.GetCapabilities.DCP&&r.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||r.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[i]=r,TC.capabilities[e]=r,n(WFSCapabilities.Parse(t.data))})})},Parse:function(){var s,l,c,u,h=xml2json(arguments[0]);switch(h.version){case t:s=t;break;case e:s=e;break;case r:s=r}l=n(h,s),c=i(h,s),u=o(h,s);var p=a(h,s),d={Operations:l,FeatureTypes:c,Filters:u};return TC.Util.extend(d,p),d}}}(),TC=TC||{};!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Geometry=e()}(TC,function(){const t={isPoint:function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},isRing:function(e){return Array.isArray(e)&&(0===e.length||t.isPoint(e[0]))},isRingCollection:function(e){return Array.isArray(e)&&(0===e.length||t.isRing(e[0]))},isMultiRingCollection:function(e){return Array.isArray(e)&&(0===e.length||t.isRingCollection(e[0]))},getNearest:function(t,e){return TC.wrap.Geometry.getNearest(t,e)},isInside:function e(r,n){var i=!1;if(t.isPoint(r))if(t.isPoint(n))i=r[0]===n[0]&&r[1]===n[1];else if(t.isRing(n))for(var o=0,a=n.length-1;o<n.length;a=o++){var s=n[o][0],l=n[o][1],c=n[a][0],u=n[a][1];l>r[1]!=u>r[1]&&r[0]<(c-s)*(r[1]-l)/(u-l)+s&&(i=!i)}else if(t.isRingCollection(n)&&n.length>0){if(e(r,n[0])){var h=!1;for(o=1;o<n.length;o++)if(e(r,n[o])){h=!0;break}h||(i=!0)}}else if(t.isMultiRingCollection(n)&&n.length>0){o=0;for(var p=n.length;o<p;o++)if(e(r,n[o])){i=!0;break}}return i}};return t});var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var t;if(document.currentScript)t=document.currentScript;else{var e=document.getElementsByTagName("script");t=e[e.length-1]}var r=t.getAttribute("src");TC.apiLocation=r.substr(0,r.lastIndexOf("/")+1);var n=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),i=new XMLHttpRequest;i.open("GET",n,!1);i.send(null);var o=document.getElementsByTagName("head")[0];(t=document.createElement("script")).type="text/javascript";t.text=i.responseText;o.appendChild(t)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(t,e){var r=this;TC.Cfg.controls.search.allowedSearchTypes=TC.Util.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(e&&e.controls&&e.controls.search){var n=Object.keys(e.controls.search),i=TC.Util.extend(e.controls.search,{allowedSearchTypes:{}});n.forEach(function(t){if("boolean"==typeof e.controls.search[t]||TC.Util.isPlainObject(e.controls.search[t])){if(e.controls.search[t])switch(!0){case"postalAddress"===t:i.allowedSearchTypes[TC.Consts.searchType.NUMBER]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;case"cadastralParcel"===t:i.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;case"town"===t:i.allowedSearchTypes[TC.Consts.searchType.URBAN]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{};break;default:i.allowedSearchTypes[t]=TC.Util.isPlainObject(e.controls.search[t])?e.controls.search[t]:{}}delete i[t]}});e.controls.search=i}var o,a,s=new TC.Map(t,e);r.addLayer=function(t,e){s.addLayer(t,e)};r.setBaseLayer=function(t,e){s.setBaseLayer(t,e)};r.addMarker=function(t,e){s.addMarker(t,e)};r.zoomToMarkers=function(t){s.zoomToMarkers(t)};r.loaded=function(t){s.loaded(t)};s.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(o=new TC.control.Search).register(s);o.getLayer().then(function(t){a=t})});if(!s.activeControl){var t=s.getControlsByClass("TC.control.FeatureInfo")[0];t&&t.activate()}});r.getQueryableData=function(t,e){var r=o.availableSearchTypes[t];if(r.queryableData)e&&e(r.queryableData);else{var n={request:"GetFeature",service:"WFS",typename:r.featurePrefix+":"+r.featureType,version:r.version,propertyname:(r.dataIdProperty instanceof Array?r.dataIdProperty:[r.dataIdProperty]).concat(r.outputProperties instanceof Array?r.outputProperties:[r.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},i=r.url+"?"+TC.Util.getParamString(n);TC.ajax({url:i,responseType:TC.Consts.mimeType.JSON}).then(function(t){const n=t.data;r.queryableData=[];if(n.features)for(var i=n.features,a=0;a<i.length;a++){var s=i[a],l={id:[]};r.dataIdProperty instanceof Array||(r.dataIdProperty=[r.dataIdProperty]);for(var c=0;c<r.dataIdProperty.length;c++)s.properties.hasOwnProperty(r.dataIdProperty[c])&&l.id.push(s.properties[r.dataIdProperty[c]]);l.id=r.idPropertiesIdentifier?l.id.join(r.idPropertiesIdentifier):l.id.join("");l.label=[];r.outputProperties instanceof Array||(r.outputProperties=[r.outputProperties]);for(var u=0;u<r.outputProperties.length;u++)s.properties.hasOwnProperty(r.outputProperties[u])&&l.label.push(s.properties[r.outputProperties[u]]);var h=l.label instanceof Array&&l.label.join("").trim().length>0||!(l.label instanceof Array)&&l.label.trim().length>0;l.label=r.outputFormatLabel?r.outputFormatLabel.tcFormat(l.label):l.label.join("-");h&&r.queryableData.push(l)}r.queryableData=r.queryableData.sort(function(t,e){return r.idPropertiesIdentifier&&-1==t.id.indexOf(r.idPropertiesIdentifier)?o.removePunctuation(t.label)<o.removePunctuation(e.label)?-1:o.removePunctuation(t.label)>o.removePunctuation(e.label)?1:0:o.removePunctuation(t.label.split(" ")[0])<o.removePunctuation(e.label.split(" ")[0])?-1:o.removePunctuation(t.label.split(" ")[0])>o.removePunctuation(e.label.split(" ")[0])?1:0});r.queryableData=r.queryableData.filter(function(t,e,r){return e<1||t.id!==r[e-1].id&&t.label!==r[e-1].label});e&&e(r.queryableData)})}};r.getMunicipalities=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,t)};r.getUrbanAreas=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.URBAN,t)};r.getCommonwealths=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,t)};r.getCouncils=function(t){r.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,t)};r.searchCommonwealth=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,t,e)};r.searchCouncil=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,t,e)};r.searchUrbanArea=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.URBAN,t,e)};r.searchMunicipality=function(t,e){r.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,t,e)};r.searchTyped=function(t,e,n){var i=TC.getUID(),l=o.availableSearchTypes[t];e instanceof Array&&l.goToIdFormat&&(e=l.goToIdFormat.tcFormat(e));o._search.data=o._search.data||[];o._search.data.push({dataLayer:l.featureType,dataRole:t,id:e,label:"",text:""});r.removeSearch();if(o.availableSearchTypes[t]&&!o.getSearchTypeByRole(t)){o.availableSearchTypes[t].goTo||(o.availableSearchTypes[t].goTo=function(t){var e=function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var e=[];l.idPropertiesIdentifier&&(t=t.split(l.idPropertiesIdentifier));t instanceof Array||(t=[t]);for(var r=0;r<l.dataIdProperty.length;r++)e.push(new TC.filter.equalTo(l.dataIdProperty[r],t[r].trim()));return e=e.length>1?new TC.filter.and(e):e[0]}(t);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:e,outputFormat:this.outputFormat,styles:this.styles}}}.bind(l));o.addAllowedSearchType(t,o.availableSearchTypes[t],o)}s.one(TC.Consts.event.SEARCHQUERYEMPTY,function(t){s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});n&&n(null)});s.one(TC.Consts.event.FEATURESADD,function(e){e.layer==a&&e.layer.features&&e.layer.features.length>0&&s.zoomToFeatures(e.layer.features);r.search={layer:e.layer,type:t};n&&n(e.layer.id!==i?e.layer.id:i)});o.goToResult(e,t)};r.searchFeature=function(t,e,n,i){var a=TC.getUID(),l=o.featurePrefix;r.removeSearch();t=(t||"").trim();e=(e||"").trim();n=(n||"").trim();if(0==t.length||0==e.length||0==n.length){s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(null)}else{if(t.indexOf(":")>-1){l=t.split(":")[0];t=t.split(":")[1]}var c,u={id:a,type:SITNA.Consts.layerType.WFS,url:o.url,version:o.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:t,maxFeatures:1,properties:function(t){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(t&&t instanceof Array){var e=t.map(function(t){if(!t.hasOwnProperty("type"))return new TC.filter.equalTo(t.name,t.value);switch(!0){case t.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(t.name,t.value)}});return e.length>1?TC.filter.and.apply(null,e):e[0]}}([{name:e,value:n,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};s.addLayer(u).then(function(t){c=t;r.search={layer:t,type:SITNA.Consts.mapSearchType.GENERIC}});s.on(TC.Consts.event.FEATURESADD,function(t){const e=t.layer;if(e==c&&e.features&&e.features.length>0){for(var r=0;r<e.features.length;r++)e.features[r].showsPopup!=o.queryableFeatures&&(e.features[r].showsPopup=o.queryableFeatures);s.zoomToFeatures(e.features)}});s.on(TC.Consts.event.LAYERUPDATE,function(t){const e=t.layer,r=t.newData;e==c&&r&&r.features&&0==r.features.length&&s.toast(o.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(e==c&&r&&r.features&&0==r.features.length?null:a)})}};r.removeSearch=function(t){if(r.search)if(o.availableSearchTypes[r.search.type]&&o.availableSearchTypes[r.search.type].hasOwnProperty("goTo")){for(var e=0;e<r.search.layer.features.length;e++)r.search.layer.removeFeature(r.search.layer.features[e]);r.search=null}else s.removeLayer(r.search.layer).then(function(){r.search=null});t&&t()};r.exportImage=function(){return s.exportImage()};r.search=null};
//# sourceMappingURL=maps/sitna.ol.min.js.map