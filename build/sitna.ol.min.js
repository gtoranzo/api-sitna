!function(e,t,o){function r(e,t){return typeof e===t}function n(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):p?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function i(){var e=t.body;return e||((e=n(p?"svg":"body")).fake=!0),e}function a(e,o,r,a){var s,l,c,u,d="modernizr",p=n("div"),f=i();if(parseInt(r,10))for(;r--;)(c=n("div")).id=a?a[r]:d+(r+1),p.appendChild(c);return(s=n("style")).type="text/css",s.id="s"+d,(f.fake?f:p).appendChild(s),f.appendChild(p),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(t.createTextNode(e)),p.id=d,f.fake&&(f.style.background="",f.style.overflow="hidden",u=h.style.overflow,h.style.overflow="hidden",h.appendChild(f)),l=o(p,e),f.fake?(f.parentNode.removeChild(f),h.style.overflow=u,h.offsetHeight):p.parentNode.removeChild(p),!!l}var s=[],l={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var o=this;setTimeout(function(){t(o[e])},0)},addTest:function(e,t,o){s.push({name:e,fn:t,options:o})},addAsyncTest:function(e){s.push({name:null,fn:e})}},c=function(){};c.prototype=l,(c=new c).addTest("urlparser",function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}});var u=[],h=t.documentElement,d=l._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];l._prefixes=d;var p="svg"===h.nodeName.toLowerCase(),f=n("input"),g="search tel url email datetime date month week time datetime-local number range color".split(" "),m={};c.inputtypes=function(e){for(var o,r,n,i=e.length,a=0;i>a;a++)f.setAttribute("type",o=e[a]),(n="text"!==f.type&&"style"in f)&&(f.value="1)",f.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(o)&&void 0!==f.style.WebkitAppearance?(h.appendChild(f),n=(r=t.defaultView).getComputedStyle&&"textfield"!==r.getComputedStyle(f,null).WebkitAppearance&&0!==f.offsetHeight,h.removeChild(f)):/^(search|tel)$/.test(o)||(n=/^(url|email)$/.test(o)?f.checkValidity&&!1===f.checkValidity():"1)"!=f.value)),m[e[a]]=!!n;return m}(g);var y=function(){var t=e.matchMedia||e.msMatchMedia;return t?function(e){var o=t(e);return o&&o.matches||!1}:function(t){var o=!1;return a("@media "+t+" { #modernizr { position: absolute; } }",function(t){o="absolute"==(e.getComputedStyle?e.getComputedStyle(t,null):t.currentStyle).position}),o}}();l.mq=y;var C=l.testStyles=a;c.addTest("touchevents",function(){var o;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)o=!0;else{var r=["@media (",d.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");C(r,function(e){o=9===e.offsetTop})}return o}),c.addTest("canvas",function(){var e=n("canvas");return!(!e.getContext||!e.getContext("2d"))}),function(){var e,t,o,n,i,a;for(var l in s)if(s.hasOwnProperty(l)){if(e=[],(t=s[l]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(o=0;o<t.options.aliases.length;o++)e.push(t.options.aliases[o].toLowerCase());for(n=r(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)1===(a=e[i].split(".")).length?c[a[0]]=n:(!c[a[0]]||c[a[0]]instanceof Boolean||(c[a[0]]=new Boolean(c[a[0]])),c[a[0]][a[1]]=n),u.push((n?"":"no-")+a.join("-"))}}(),delete l.addTest,delete l.addAsyncTest;for(var v=0;v<c._q.length;v++)c._q[v]();e.Modernizr=c}(window,document);!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function c(e,t){if(e)return"function"==typeof e&&e.template?e.template:n.isTemplateFn(e)?e:!1!==t?n.cache[e]:void 0}function o(e,t,o){if(!e)return t.setError(new Error("No template or template name provided to render"));var r=c(e,n.config.cache);return r?r(t,i.wrap(o,r.templateName)):n.onLoad?t.map(function(t){function r(e,r){var s;if(e)return t.setError(e);if(!(s=c(r,!1)||c(a,n.config.cache))){if(!n.compile)return t.setError(new Error("Dust compiler not available"));s=n.loadSource(n.compile(r,a))}s(t,i.wrap(o,s.templateName)).end()}var a=e;3===n.onLoad.length?n.onLoad(a,o.options,r):n.onLoad(a,r)}):t.setError(new Error("Template Not Found: "+e))}function i(e,t,o,r,n){void 0===e||e instanceof l||(e=new l(e));this.stack=e;this.global=t;this.options=o;this.blocks=r;this.templateName=n}function k(e,t,o){return function(r){return e.push(r)._get(t,o)}}function l(e,t,o,r){this.tail=t;this.isObject=e&&"object"==typeof e;this.head=e;this.index=o;this.of=r}function a(e){this.head=new t(this);this.callback=e;this.out=""}function e(){this.head=new t(this)}function t(e,t,o){this.root=e;this.next=t;this.data=[];this.flushable=!1;this.taps=o}function s(e,t){this.head=e;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,o={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=y;n.log=function(e,r){o[r=r||v]>=o[n.debugLevel]&&t("[DUST:"+r+"]",e)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(e,t){e&&(t.templateName=e,!1!==n.config.cache&&(n.cache[e]=t))};n.render=function(e,t,r){var n=new a(r).head;try{o(e,n,t).end()}catch(e){n.setError(e)}};n.stream=function(t,r){var i=new e,a=i.head;return n.nextTick(function(){try{o(t,a,r).end()}catch(e){a.setError(e)}}),i};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.nextTick=function(e){setTimeout(e,0)};n.isEmpty=function(e){return 0!==e&&(!(!n.isArray(e)||e.length)||!e)};n.isEmptyObject=function(e){var t;if(null===e||void 0===e||e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0};n.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody};n.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then};n.isStreamable=function(e){return e&&"function"==typeof e.on};n.filter=function(e,t,o){var r,i,a;if(o)for(r=0,i=o.length;i>r;r++)"s"===(a=o[r])?t=null:"function"==typeof n.filters[a]?e=n.filters[a](e):n.log("Invalid filter `"+a+"`",u);return t&&(e=n.filters[t](e)),e};n.filters={h:function(e){return n.escapeHtml(e)},j:function(e){return n.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return n.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(n.log("JSON is undefined; could not parse `"+e+"`",u),e)}};n.makeBase=n.context=function(e,t){return new i(void 0,e,t)};i.wrap=function(e,t){return e instanceof i?e:new i(e,{},{},null,t)};i.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)};i.prototype._get=function(e,t){var o,i,a,s,l,c=this.stack||{},u=1;if(i=t[0],a=t.length,e&&0===a)s=c,c=c.head;else{if(e)c&&(c=c.head?c.head[i]:void 0);else{for(;c&&(!c.isObject||(s=c.head,void 0===(o=c.head[i])));)c=c.tail;c=void 0!==o?o:this.global&&this.global[i]}for(;c&&a>u;){if(n.isThenable(c))return c.then(k(this,e,t.slice(u)));s=c;c=c[t[u]];u++}}return"function"==typeof c?((l=function(){try{return c.apply(s,arguments)}catch(e){throw n.log(e,r),e}}).__dustBody=!!c.__dustBody,l):(void 0===c&&n.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",v),c)};i.prototype.getPath=function(e,t){return this._get(e,t)};i.prototype.push=function(e,t,o){return void 0===e?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(e,this.stack,t,o))};i.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e};i.prototype.rebase=function(e){return new i(e,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(e){var o,r,i;if("function"==typeof e&&(e=e(new t,this).data.join("")),!(o=this.blocks))return n.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",f),!1;for(r=o.length;r--;)if(i=o[r][e])return i;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(e){var t,o=this.blocks;return e?(t=o?o.concat([e]):[e],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(e){var o;return"function"!=typeof e?e:(o=(new t).render(e,this))instanceof t?o.data.join(""):o};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),n.log("Rendering failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.out+=e.data.join("");e=e.next;this.head=e}this.callback(null,this.out)};e.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),n.log("Streaming failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.emit("data",e.data.join(""));e=e.next;this.head=e}this.emit("end")};e.prototype.emit=function(e,t){var o,r,i=(this.events||{})[e]||[];if(!i.length)return n.log("Stream broadcasting, but no listeners for `"+e+"`",f),!1;for(o=0,r=(i=i.slice(0)).length;r>o;o++)i[o](t);return!0};e.prototype.on=function(e,t){var o=this.events=this.events||{},r=o[e]=o[e]||[];return"function"!=typeof t?n.log("No callback function provided for `"+e+"` event listener",u):r.push(t),this};e.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return n.log("Incompatible stream passed to `pipe`",u),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(o){if(!t)try{e.write(o,"utf8")}catch(e){n.log(e,r)}}).on("end",function(){if(!t)try{e.end();t=!0}catch(e){n.log(e,r)}})};t.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this};t.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(e){var o=new t(this.root,this.next,this.taps),i=new t(this.root,o,this.taps);this.next=i;this.flushable=!0;try{e(i)}catch(e){n.log(e,r);i.setError(e)}return o};t.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new s(e),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(e,t){return e(this,t)};t.prototype.reference=function(e,o,r,i){return"function"==typeof e?(e=e.apply(o.current(),[this,o,null,{auto:r,filters:i}]))instanceof t?e:this.reference(e,o,r,i):n.isThenable(e)?this.await(e,o,null,r,i):n.isStreamable(e)?this.stream(e,o,null,r,i):n.isEmpty(e)?this:this.write(n.filter(e,r,i))};t.prototype.section=function(e,o,i,a){var s,l,c,u=i.block,h=i.else,d=this;if("function"==typeof e&&!n.isTemplateFn(e)){try{e=e.apply(o.current(),[this,o,i,a])}catch(e){return n.log(e,r),this.setError(e)}if(e instanceof t)return e}if(n.isEmptyObject(a)||(o=o.push(a)),n.isArray(e)){if(u){if((l=e.length)>0){for((c=o.stack&&o.stack.head||{}).$len=l,s=0;l>s;s++)c.$idx=s,d=u(d,o.push(e[s],s,l));return c.$idx=void 0,c.$len=void 0,d}if(h)return h(this,o)}}else{if(n.isThenable(e))return this.await(e,o,i);if(n.isStreamable(e))return this.stream(e,o,i);if(!0===e){if(u)return u(this,o)}else if(e||0===e){if(u)return u(this,o.push(e))}else if(h)return h(this,o)}return n.log("Section without corresponding key in template `"+o.getTemplateName()+"`",f),this};t.prototype.exists=function(e,t,o){var r=o.block,i=o.else;if(n.isEmpty(e)){if(i)return i(this,t)}else{if(r)return r(this,t);n.log("No block for exists check in template `"+t.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(e,t,o){var r=o.block,i=o.else;if(n.isEmpty(e)){if(r)return r(this,t);n.log("No block for not-exists check in template `"+t.getTemplateName()+"`",f)}else if(i)return i(this,t);return this};t.prototype.block=function(e,t,o){var r=e||o.block;return r?r(this,t):this};t.prototype.partial=function(e,t,r,i){var a;return void 0===i&&(i=r,r=t),n.isEmptyObject(i)||(a=(r=r.clone()).pop(),r=r.push(i).push(a)),n.isTemplateFn(e)?this.capture(e,t,function(e,t){r.templateName=e;o(e,t,r).end()}):(r.templateName=e,o(e,this,r))};t.prototype.helper=function(e,t,o,i){var a,s=this;if(!n.helpers[e])return n.log("Helper `"+e+"` does not exist",u),s;try{return a=n.helpers[e](s,t,o,i),n.isThenable(a)?this.await(a,t,o):a}catch(t){return n.log("Error in helper `"+e+"`: "+t.message,r),s.setError(t)}};t.prototype.await=function(e,t,o,r,i){var a=o&&o.block,s=o&&o.error;return this.map(function(o){e.then(function(e){a?o.render(a,t.push(e)).end():o.reference(e,t,r,i).end()},function(e){s?o.render(s,t.push(e)).end():(n.log("Unhandled promise rejection in `"+t.getTemplateName()+"`"),o.end())})})};t.prototype.stream=function(e,t,o,r,i){var a=o&&o.block,s=o&&o.error;return this.map(function(o){var l=!1;e.on("data",function(e){l||(o=a?o.map(function(o){o.render(a,t.push(e)).end()}):o.reference(e,t,r,i))}).on("error",function(e){l||(s?o.render(s,t.push(e)):n.log("Unhandled stream error in `"+t.getTemplateName()+"`"),l||(l=!0,o.end()))}).on("end",function(){l||(l=!0,o.end())})})};t.prototype.capture=function(e,t,o){return this.map(function(r){var n=new a(function(e,t){e?r.setError(e):o(t,r)});e(n.head,t).end()})};t.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(e){return new s(e,this)};s.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),g.test(e)?e.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):e):e};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(e){return"string"==typeof e?e.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):e},n.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+e+"`",u),e)},n}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t,o,r,n,i){this.message=e;this.expected=t;this.found=o;this.offset=r;this.line=n;this.column=i;this.name="SyntaxError"}return function(e,t){function o(){this.constructor=e}o.prototype=t.prototype;e.prototype=new o}(e,Error),{SyntaxError:e,parse:function(t){function o(e){return go!==e&&(go>e&&(go=0,mo={line:1,column:1,seenCR:!1}),function(e,o,r){for(var n,i=o;r>i;i++)"\n"===(n=t.charAt(i))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===n||"\u2028"===n||"\u2029"===n?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(mo,go,e),go=e),mo}function r(e){yo>po||(po>yo&&(yo=po,Co=[]),Co.push(e))}function n(r,n,i){var a=o(i),s=i<t.length?t.charAt(i):null;return null!==n&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new e(null!==r?r:function(e,t){for(var o=new Array(e.length),r=0;r<e.length;r++)o[r]=e[r].description;return"Expected "+(e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(n,s),n,s,i,a.line,a.column)}function i(){return a()}function a(){var e,t,o;for(e=po,t=[],o=s();o!==U;)t.push(o),o=s();return t!==U&&(fo=e,t=V(t)),t}function s(){var e;return(e=R())===U&&(e=M())===U&&(e=function(){var e,o,n,i,s,u,h;if(vo++,e=po,(o=l())!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();n!==U&&(i=N())!==U&&(s=a())!==U&&(u=d())!==U?((h=c())===U&&(h=X),h!==U?(fo=po,(Y(o,s,u,h)?K:q)!==U?(fo=e,o=z(o,s,u,h),e=o):(po=e,e=q)):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;if(e===U)if(e=po,(o=l())!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();n!==U?(47===t.charCodeAt(po)?(i=$,po++):(i=U,0===vo&&r(J)),i!==U&&(s=N())!==U?(fo=e,o=Z(o),e=o):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(H)),e}())===U&&(e=function(){var e,o,n,i,a,s,l,c,d;if(vo++,e=po,(o=O())!==U)if(62===t.charCodeAt(po)?(n=Ce,po++):(n=U,0===vo&&r(ve)),n===U&&(43===t.charCodeAt(po)?(n=Te,po++):(n=U,0===vo&&r(_e))),n!==U){for(i=[],a=F();a!==U;)i.push(a),a=F();if(i!==U)if(a=po,(s=E())!==U&&(fo=a,s=Se(s)),(a=s)===U&&(a=b()),a!==U)if((s=u())!==U)if((l=h())!==U){for(c=[],d=F();d!==U;)c.push(d),d=F();c!==U?(47===t.charCodeAt(po)?(d=$,po++):(d=U,0===vo&&r(J)),d!==U&&N()!==U?(fo=e,o=Ee(n,a,s,l),e=o):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;else po=e,e=q;else po=e,e=q;else po=e,e=q}else po=e,e=q;else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(ye)),e}())===U&&(e=g())===U&&(e=p())===U&&(e=function(){var e,o,n,i,a,s,l,c;if(vo++,e=po,(o=D())!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();n!==U?(fo=e,o=Tt(o,n),e=o):(po=e,e=q)}else po=e,e=q;if(e===U){if(e=po,o=[],n=po,i=po,vo++,a=I(),vo--,a===U?i=K:(po=i,i=q),i!==U?(a=po,vo++,s=R(),vo--,s===U?a=K:(po=a,a=q),a!==U?(s=po,vo++,l=M(),vo--,l===U?s=K:(po=s,s=q),s!==U?(l=po,vo++,c=D(),vo--,c===U?l=K:(po=l,l=q),l!==U?(t.length>po?(c=t.charAt(po),po++):(c=U,0===vo&&r(_t)),c!==U?(fo=n,i=St(c),n=i):(po=n,n=q)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q),n!==U)for(;n!==U;)o.push(n),n=po,i=po,vo++,a=I(),vo--,a===U?i=K:(po=i,i=q),i!==U?(a=po,vo++,s=R(),vo--,s===U?a=K:(po=a,a=q),a!==U?(s=po,vo++,l=M(),vo--,l===U?s=K:(po=s,s=q),s!==U?(l=po,vo++,c=D(),vo--,c===U?l=K:(po=l,l=q),l!==U?(t.length>po?(c=t.charAt(po),po++):(c=U,0===vo&&r(_t)),c!==U?(fo=n,i=St(c),n=i):(po=n,n=q)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q);else o=q;o!==U&&(fo=e,o=Et(o));e=o}return vo--,e===U&&(o=U,0===vo&&r(vt)),e}()),e}function l(){var e,o,n,i,a,s;if(e=po,O()!==U)if(Q.test(t.charAt(po))?(o=t.charAt(po),po++):(o=U,0===vo&&r(ee)),o!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();n!==U&&(i=m())!==U&&(a=u())!==U&&(s=h())!==U?(fo=e,e=te(o,i,a,s)):(po=e,e=q)}else po=e,e=q;else po=e,e=q;return e}function c(){var e,o,n,i,a,s;if(vo++,e=po,O()!==U)if(47===t.charCodeAt(po)?(o=$,po++):(o=U,0===vo&&r(J)),o!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();if(n!==U)if((i=m())!==U){for(a=[],s=F();s!==U;)a.push(s),s=F();a!==U&&(s=N())!==U?(fo=e,e=re(i)):(po=e,e=q)}else po=e,e=q;else po=e,e=q}else po=e,e=q;else po=e,e=q;return vo--,e===U&&0===vo&&r(oe),e}function u(){var e,o,n,i;return e=po,o=po,58===t.charCodeAt(po)?(n=ne,po++):(n=U,0===vo&&r(ie)),n!==U&&(i=m())!==U?(fo=o,o=n=ae(i)):(po=o,o=q),o===U&&(o=X),o!==U&&(fo=e,o=se(o)),o}function h(){var e,o,n,i,a,s,l;if(vo++,e=po,o=[],n=po,i=[],(a=F())!==U)for(;a!==U;)i.push(a),a=F();else i=q;for(i!==U&&(a=E())!==U?(61===t.charCodeAt(po)?(s=ce,po++):(s=U,0===vo&&r(ue)),s!==U?((l=y())===U&&(l=m())===U&&(l=b()),l!==U?(fo=n,n=i=he(a,l)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q);n!==U;){if(o.push(n),n=po,i=[],(a=F())!==U)for(;a!==U;)i.push(a),a=F();else i=q;i!==U&&(a=E())!==U?(61===t.charCodeAt(po)?(s=ce,po++):(s=U,0===vo&&r(ue)),s!==U?((l=y())===U&&(l=m())===U&&(l=b()),l!==U?(fo=n,n=i=he(a,l)):(po=n,n=q)):(po=n,n=q)):(po=n,n=q)}return o!==U&&(fo=e,o=de(o)),vo--,(e=o)===U&&(o=U,0===vo&&r(le)),e}function d(){var e,o,n,i,s,l;for(vo++,e=po,o=[],n=po,O()!==U?(58===t.charCodeAt(po)?(i=ne,po++):(i=U,0===vo&&r(ie)),i!==U&&(s=E())!==U&&N()!==U&&(l=a())!==U?(fo=n,n=he(s,l)):(po=n,n=q)):(po=n,n=q);n!==U;)o.push(n),n=po,O()!==U?(58===t.charCodeAt(po)?(i=ne,po++):(i=U,0===vo&&r(ie)),i!==U&&(s=E())!==U&&N()!==U&&(l=a())!==U?(fo=n,n=he(s,l)):(po=n,n=q)):(po=n,n=q);return o!==U&&(fo=e,o=fe(o)),vo--,(e=o)===U&&(o=U,0===vo&&r(pe)),e}function p(){var e,t,o;return vo++,e=po,O()!==U&&(t=m())!==U&&(o=f())!==U&&N()!==U?(fo=e,e=me(t,o)):(po=e,e=q),vo--,e===U&&0===vo&&r(ge),e}function f(){var e,o,n,i,a;for(vo++,e=po,o=[],n=po,124===t.charCodeAt(po)?(i=we,po++):(i=U,0===vo&&r(be)),i!==U&&(a=E())!==U?(fo=n,n=i=ae(a)):(po=n,n=q);n!==U;)o.push(n),n=po,124===t.charCodeAt(po)?(i=we,po++):(i=U,0===vo&&r(be)),i!==U&&(a=E())!==U?(fo=n,n=i=ae(a)):(po=n,n=q);return o!==U&&(fo=e,o=xe(o)),vo--,(e=o)===U&&(o=U,0===vo&&r(Le)),e}function g(){var e,o,n;return vo++,e=po,O()!==U?(126===t.charCodeAt(po)?(o=Pe,po++):(o=U,0===vo&&r(Re)),o!==U&&(n=E())!==U&&N()!==U?(fo=e,e=Me(n)):(po=e,e=q)):(po=e,e=q),vo--,e===U&&0===vo&&r(Ae),e}function m(){var e,t;return vo++,e=po,(t=S())!==U&&(fo=e,t=Oe(t)),(e=t)===U&&(e=po,(t=E())!==U&&(fo=e,t=Ne(t)),e=t),vo--,e===U&&(t=U,0===vo&&r(Ie)),e}function y(){var e,t;return vo++,e=po,(t=C())===U&&(t=_()),t!==U&&(fo=e,t=Fe(t)),vo--,(e=t)===U&&(t=U,0===vo&&r(De)),e}function C(){var e,o,n,i;return vo++,e=po,(o=_())!==U?(46===t.charCodeAt(po)?(n=Ge,po++):(n=U,0===vo&&r(Be)),n!==U&&(i=v())!==U?(fo=e,e=o=Ue(o,i)):(po=e,e=q)):(po=e,e=q),vo--,e===U&&(o=U,0===vo&&r(ke)),e}function v(){var e,o,n;if(vo++,e=po,o=[],We.test(t.charAt(po))?(n=t.charAt(po),po++):(n=U,0===vo&&r(Ve)),n!==U)for(;n!==U;)o.push(n),We.test(t.charAt(po))?(n=t.charAt(po),po++):(n=U,0===vo&&r(Ve));else o=q;return o!==U&&(fo=e,o=He(o)),vo--,(e=o)===U&&(o=U,0===vo&&r(je)),e}function T(){var e,o,n;return vo++,e=po,45===t.charCodeAt(po)?(o=Xe,po++):(o=U,0===vo&&r(Ye)),o!==U&&(n=v())!==U?(fo=e,e=o=Ke(o,n)):(po=e,e=q),vo--,e===U&&(o=U,0===vo&&r(qe)),e}function _(){var e;return vo++,(e=T())===U&&(e=v()),vo--,e===U&&0===vo&&r(ze),e}function S(){var e,o,n,i;if(vo++,e=po,(o=E())===U&&(o=X),o!==U){if(n=[],(i=w())===U&&(i=L()),i!==U)for(;i!==U;)n.push(i),(i=w())===U&&(i=L());else n=q;n!==U?(fo=e,e=o=Je(o,n)):(po=e,e=q)}else po=e,e=q;if(e===U)if(e=po,46===t.charCodeAt(po)?(o=Ge,po++):(o=U,0===vo&&r(Be)),o!==U){for(n=[],(i=w())===U&&(i=L());i!==U;)n.push(i),(i=w())===U&&(i=L());n!==U?(fo=e,e=o=Ze(n)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r($e)),e}function E(){var e,o,n,i;if(vo++,e=po,et.test(t.charAt(po))?(o=t.charAt(po),po++):(o=U,0===vo&&r(tt)),o!==U){for(n=[],ot.test(t.charAt(po))?(i=t.charAt(po),po++):(i=U,0===vo&&r(rt));i!==U;)n.push(i),ot.test(t.charAt(po))?(i=t.charAt(po),po++):(i=U,0===vo&&r(rt));n!==U?(fo=e,e=o=nt(o,n)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(Qe)),e}function L(){var e,o,n,i,a,s;if(vo++,e=po,o=po,(n=function(){var e;return 91===t.charCodeAt(po)?(e=$t,po++):(e=U,0===vo&&r(Jt)),e}())!==U){if(i=po,a=[],We.test(t.charAt(po))?(s=t.charAt(po),po++):(s=U,0===vo&&r(Ve)),s!==U)for(;s!==U;)a.push(s),We.test(t.charAt(po))?(s=t.charAt(po),po++):(s=U,0===vo&&r(Ve));else a=q;a!==U&&(fo=i,a=at(a));(i=a)===U&&(i=m());i!==U&&(a=function(){var e;return 93===t.charCodeAt(po)?(e=Zt,po++):(e=U,0===vo&&r(Qt)),e}())!==U?(fo=o,o=n=st(i)):(po=o,o=q)}else po=o,o=q;return o!==U?((n=w())===U&&(n=X),n!==U?(fo=e,e=o=lt(o,n)):(po=e,e=q)):(po=e,e=q),vo--,e===U&&(o=U,0===vo&&r(it)),e}function w(){var e,o,n,i,a;if(vo++,e=po,o=[],n=po,46===t.charCodeAt(po)?(i=Ge,po++):(i=U,0===vo&&r(Be)),i!==U&&(a=E())!==U?(fo=n,n=i=ut(a)):(po=n,n=q),n!==U)for(;n!==U;)o.push(n),n=po,46===t.charCodeAt(po)?(i=Ge,po++):(i=U,0===vo&&r(Be)),i!==U&&(a=E())!==U?(fo=n,n=i=ut(a)):(po=n,n=q);else o=q;return o!==U?((n=L())===U&&(n=X),n!==U?(fo=e,e=o=ht(o,n)):(po=e,e=q)):(po=e,e=q),vo--,e===U&&(o=U,0===vo&&r(ct)),e}function b(){var e,o,n,i;if(vo++,e=po,34===t.charCodeAt(po)?(o=pt,po++):(o=U,0===vo&&r(ft)),o!==U?(34===t.charCodeAt(po)?(n=pt,po++):(n=U,0===vo&&r(ft)),n!==U?(fo=e,e=o=gt()):(po=e,e=q)):(po=e,e=q),e===U&&(e=po,34===t.charCodeAt(po)?(o=pt,po++):(o=U,0===vo&&r(ft)),o!==U&&(n=A())!==U?(34===t.charCodeAt(po)?(i=pt,po++):(i=U,0===vo&&r(ft)),i!==U?(fo=e,e=o=mt(n)):(po=e,e=q)):(po=e,e=q),e===U))if(e=po,34===t.charCodeAt(po)?(o=pt,po++):(o=U,0===vo&&r(ft)),o!==U){if(n=[],(i=x())!==U)for(;i!==U;)n.push(i),i=x();else n=q;n!==U?(34===t.charCodeAt(po)?(i=pt,po++):(i=U,0===vo&&r(ft)),i!==U?(fo=e,e=o=yt(n)):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(dt)),e}function x(){var e,t;return(e=g())===U&&(e=p())===U&&(e=po,(t=A())!==U&&(fo=e,t=Ct(t)),e=t),e}function A(){var e,o,n,i,a;if(vo++,e=po,o=[],n=po,i=po,vo++,a=I(),vo--,a===U?i=K:(po=i,i=q),i!==U?((a=P())===U&&(wt.test(t.charAt(po))?(a=t.charAt(po),po++):(a=U,0===vo&&r(bt))),a!==U?(fo=n,n=i=St(a)):(po=n,n=q)):(po=n,n=q),n!==U)for(;n!==U;)o.push(n),n=po,i=po,vo++,a=I(),vo--,a===U?i=K:(po=i,i=q),i!==U?((a=P())===U&&(wt.test(t.charAt(po))?(a=t.charAt(po),po++):(a=U,0===vo&&r(bt))),a!==U?(fo=n,n=i=St(a)):(po=n,n=q)):(po=n,n=q);else o=q;return o!==U&&(fo=e,o=xt(o)),vo--,(e=o)===U&&(o=U,0===vo&&r(Lt)),e}function P(){var e,o;return e=po,t.substr(po,2)===At?(o=At,po+=2):(o=U,0===vo&&r(Pt)),o!==U&&(fo=e,o=Rt()),o}function R(){var e,o,n,i,a,s;if(vo++,e=po,t.substr(po,2)===It?(o=It,po+=2):(o=U,0===vo&&r(Ot)),o!==U){for(n=[],i=po,a=po,vo++,t.substr(po,2)===Nt?(s=Nt,po+=2):(s=U,0===vo&&r(Dt)),vo--,s===U?a=K:(po=a,a=q),a!==U?(t.length>po?(s=t.charAt(po),po++):(s=U,0===vo&&r(_t)),s!==U?(fo=i,i=a=Ft(s)):(po=i,i=q)):(po=i,i=q);i!==U;)n.push(i),i=po,a=po,vo++,t.substr(po,2)===Nt?(s=Nt,po+=2):(s=U,0===vo&&r(Dt)),vo--,s===U?a=K:(po=a,a=q),a!==U?(t.length>po?(s=t.charAt(po),po++):(s=U,0===vo&&r(_t)),s!==U?(fo=i,i=a=Ft(s)):(po=i,i=q)):(po=i,i=q);n!==U?(t.substr(po,2)===Nt?(i=Nt,po+=2):(i=U,0===vo&&r(Dt)),i!==U?(fo=e,e=o=kt(n)):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(Mt)),e}function M(){var e,o,n,i,a,s;if(vo++,e=po,t.substr(po,2)===Bt?(o=Bt,po+=2):(o=U,0===vo&&r(Ut)),o!==U){for(n=[],i=po,a=po,vo++,t.substr(po,2)===jt?(s=jt,po+=2):(s=U,0===vo&&r(Wt)),vo--,s===U?a=K:(po=a,a=q),a!==U?(t.length>po?(s=t.charAt(po),po++):(s=U,0===vo&&r(_t)),s!==U?(fo=i,i=a=St(s)):(po=i,i=q)):(po=i,i=q);i!==U;)n.push(i),i=po,a=po,vo++,t.substr(po,2)===jt?(s=jt,po+=2):(s=U,0===vo&&r(Wt)),vo--,s===U?a=K:(po=a,a=q),a!==U?(t.length>po?(s=t.charAt(po),po++):(s=U,0===vo&&r(_t)),s!==U?(fo=i,i=a=St(s)):(po=i,i=q)):(po=i,i=q);n!==U?(t.substr(po,2)===jt?(i=jt,po+=2):(i=U,0===vo&&r(Wt)),i!==U?(fo=e,e=o=Vt(n)):(po=e,e=q)):(po=e,e=q)}else po=e,e=q;return vo--,e===U&&(o=U,0===vo&&r(Gt)),e}function I(){var e,o,n,i,a,s,l,c,u,h;if(e=po,(o=O())!==U){for(n=[],i=F();i!==U;)n.push(i),i=F();if(n!==U)if(Ht.test(t.charAt(po))?(i=t.charAt(po),po++):(i=U,0===vo&&r(qt)),i!==U){for(a=[],s=F();s!==U;)a.push(s),s=F();if(a!==U){if(s=[],l=po,c=po,vo++,u=N(),vo--,u===U?c=K:(po=c,c=q),c!==U?(u=po,vo++,h=D(),vo--,h===U?u=K:(po=u,u=q),u!==U?(t.length>po?(h=t.charAt(po),po++):(h=U,0===vo&&r(_t)),h!==U?l=c=[c,u,h]:(po=l,l=q)):(po=l,l=q)):(po=l,l=q),l!==U)for(;l!==U;)s.push(l),l=po,c=po,vo++,u=N(),vo--,u===U?c=K:(po=c,c=q),c!==U?(u=po,vo++,h=D(),vo--,h===U?u=K:(po=u,u=q),u!==U?(t.length>po?(h=t.charAt(po),po++):(h=U,0===vo&&r(_t)),h!==U?l=c=[c,u,h]:(po=l,l=q)):(po=l,l=q)):(po=l,l=q);else s=q;if(s!==U){for(l=[],c=F();c!==U;)l.push(c),c=F();l!==U&&(c=N())!==U?e=o=[o,n,i,a,s,l,c]:(po=e,e=q)}else po=e,e=q}else po=e,e=q}else po=e,e=q;else po=e,e=q}else po=e,e=q;return e===U&&(e=p()),e}function O(){var e;return 123===t.charCodeAt(po)?(e=Xt,po++):(e=U,0===vo&&r(Yt)),e}function N(){var e;return 125===t.charCodeAt(po)?(e=Kt,po++):(e=U,0===vo&&r(zt)),e}function D(){var e;return 10===t.charCodeAt(po)?(e=eo,po++):(e=U,0===vo&&r(to)),e===U&&(t.substr(po,2)===oo?(e=oo,po+=2):(e=U,0===vo&&r(ro)),e===U&&(13===t.charCodeAt(po)?(e=no,po++):(e=U,0===vo&&r(io)),e===U&&(8232===t.charCodeAt(po)?(e=ao,po++):(e=U,0===vo&&r(so)),e===U&&(8233===t.charCodeAt(po)?(e=lo,po++):(e=U,0===vo&&r(co)))))),e}function F(){var e;return uo.test(t.charAt(po))?(e=t.charAt(po),po++):(e=U,0===vo&&r(ho)),e===U&&(e=D()),e}function k(e){return e.concat([["line",o(fo).line],["col",o(fo).column]])}var G,B=arguments.length>1?arguments[1]:{},U={},j={start:i},W=i,V=function(e){return k(["body"].concat(e))},H={type:"other",description:"section"},q=U,X=null,Y=function(e,t,o,r){return r&&e[1].text===r.text||function(e){throw n(e,null,fo)}("Expected end tag for "+e[1].text+" but it was not found."),!0},K=void 0,z=function(e,t,o){return o.push(["param",["literal","block"],t]),e.push(o),k(e)},$="/",J={type:"literal",value:"/",description:'"/"'},Z=function(e){return e.push(["bodies"]),k(e)},Q=/^[#?\^<+@%]/,ee={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},te=function(e,t,o,r){return[e,t,o,r]},oe={type:"other",description:"end tag"},re=function(e){return e},ne=":",ie={type:"literal",value:":",description:'":"'},ae=function(e){return e},se=function(e){return e?["context",e]:["context"]},le={type:"other",description:"params"},ce="=",ue={type:"literal",value:"=",description:'"="'},he=function(e,t){return["param",["literal",e],t]},de=function(e){return["params"].concat(e)},pe={type:"other",description:"bodies"},fe=function(e){return["bodies"].concat(e)},ge={type:"other",description:"reference"},me=function(e,t){return k(["reference",e,t])},ye={type:"other",description:"partial"},Ce=">",ve={type:"literal",value:">",description:'">"'},Te="+",_e={type:"literal",value:"+",description:'"+"'},Se=function(e){return["literal",e]},Ee=function(e,t,o,r){return k([">"===e?"partial":e,t,o,r])},Le={type:"other",description:"filters"},we="|",be={type:"literal",value:"|",description:'"|"'},xe=function(e){return["filters"].concat(e)},Ae={type:"other",description:"special"},Pe="~",Re={type:"literal",value:"~",description:'"~"'},Me=function(e){return k(["special",e])},Ie={type:"other",description:"identifier"},Oe=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},Ne=function(e){var t=["key",e];return t.text=e,t},De={type:"other",description:"number"},Fe=function(e){return["literal",e]},ke={type:"other",description:"float"},Ge=".",Be={type:"literal",value:".",description:'"."'},Ue=function(e,t){return parseFloat(e+"."+t)},je={type:"other",description:"unsigned_integer"},We=/^[0-9]/,Ve={type:"class",value:"[0-9]",description:"[0-9]"},He=function(e){return function(e){return parseInt(e.join(""),10)}(e)},qe={type:"other",description:"signed_integer"},Xe="-",Ye={type:"literal",value:"-",description:'"-"'},Ke=function(e,t){return-1*t},ze={type:"other",description:"integer"},$e={type:"other",description:"path"},Je=function(e,t){return t=t[0],e&&t?(t.unshift(e),k([!1,t])):k([!0,t])},Ze=function(e){return k(e.length>0?[!0,e[0]]:[!0,[]])},Qe={type:"other",description:"key"},et=/^[a-zA-Z_$]/,tt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},ot=/^[0-9a-zA-Z_$\-]/,rt={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},nt=function(e,t){return e+t.join("")},it={type:"other",description:"array"},at=function(e){return e.join("")},st=function(e){return e},lt=function(e,t){return t?t.unshift(e):t=[e],t},ct={type:"other",description:"array_part"},ut=function(e){return e},ht=function(e,t){return t?e.concat(t):e},dt={type:"other",description:"inline"},pt='"',ft={type:"literal",value:'"',description:'"\\""'},gt=function(){return k(["literal",""])},mt=function(e){return k(["literal",e])},yt=function(e){return k(["body"].concat(e))},Ct=function(e){return["buffer",e]},vt={type:"other",description:"buffer"},Tt=function(e,t){return k(["format",e,t.join("")])},_t={type:"any",description:"any character"},St=function(e){return e},Et=function(e){return k(["buffer",e.join("")])},Lt={type:"other",description:"literal"},wt=/^[^"]/,bt={type:"class",value:'[^"]',description:'[^"]'},xt=function(e){return e.join("")},At='\\"',Pt={type:"literal",value:'\\"',description:'"\\\\\\""'},Rt=function(){return'"'},Mt={type:"other",description:"raw"},It="{`",Ot={type:"literal",value:"{`",description:'"{`"'},Nt="`}",Dt={type:"literal",value:"`}",description:'"`}"'},Ft=function(e){return e},kt=function(e){return k(["raw",e.join("")])},Gt={type:"other",description:"comment"},Bt="{!",Ut={type:"literal",value:"{!",description:'"{!"'},jt="!}",Wt={type:"literal",value:"!}",description:'"!}"'},Vt=function(e){return k(["comment",e.join("")])},Ht=/^[#?\^><+%:@\/~%]/,qt={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},Xt="{",Yt={type:"literal",value:"{",description:'"{"'},Kt="}",zt={type:"literal",value:"}",description:'"}"'},$t="[",Jt={type:"literal",value:"[",description:'"["'},Zt="]",Qt={type:"literal",value:"]",description:'"]"'},eo="\n",to={type:"literal",value:"\n",description:'"\\n"'},oo="\r\n",ro={type:"literal",value:"\r\n",description:'"\\r\\n"'},no="\r",io={type:"literal",value:"\r",description:'"\\r"'},ao="\u2028",so={type:"literal",value:"\u2028",description:'"\\u2028"'},lo="\u2029",co={type:"literal",value:"\u2029",description:'"\\u2029"'},uo=/^[\t\x0B\f \xA0\uFEFF]/,ho={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},po=0,fo=0,go=0,mo={line:1,column:1,seenCR:!1},yo=0,Co=[],vo=0;if("startRule"in B){if(!(B.startRule in j))throw new Error("Can't start parsing from rule \""+B.startRule+'".');W=j[B.startRule]}if((G=W())!==U&&po===t.length)return G;throw G!==U&&po<t.length&&r({type:"end",description:"end of input"}),n(null,Co,yo)}}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.compile",["dust.core","dust.parse"],function(e,o){return t(o,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function o(e){return h.filterNode({},e)}function r(e,t){for(var o,r=[t[0]],n=1,i=t.length;i>n;n++)(o=h.filterNode(e,t[n]))&&r.push(o);return r}function n(e,t){return t}function i(){}function a(e,o){var r,n={name:o,bodies:[],blocks:{},index:0,auto:"h"},i=t.escapeJs(o),a=o?'"'+i+'",':"",s="function(dust){",l=h.compileNode(n,e);return o&&(s+='dust.register("'+i+'",'+l+");"),r="("+(s+=function(e){var t,o=[],r=e.blocks;for(t in r)o.push('"'+t+'":'+r[t]);return o.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+o.join(",")+"};"):(e.blocks="",e.blocks)}(n)+function(e){for(var t=[],o=e.bodies,r=e.blocks,n=0,i=o.length;i>n;n++)t[n]="function body_"+n+"(chk,ctx){"+r+"return chk"+o[n]+";}body_"+n+".__dustBody=!0;";return t.join("")}(n)+"return "+l+"}")+"(dust));",t.config.amd?"define("+a+'["dust.core"],'+s+");":t.config.cjs?"module.exports=function(dust){var tmpl="+r+"var f="+c().toString()+";f.template=tmpl;return f}":r}function s(e,t){for(var o="",r=1,n=t.length;n>r;r++)o+=h.compileNode(e,t[r]);return o}function l(e,o,r){return"."+(t._aliases[r]||r)+"("+h.compileNode(e,o[1])+","+h.compileNode(e,o[2])+","+h.compileNode(e,o[4])+","+h.compileNode(e,o[3])+")"}function c(e){return function(o,r){return t[r?"render":"stream"](e,o,r)}}var u,h={},d=t.isArray;h.compile=function(t,r){try{return a(o(e(t)),r)}catch(e){if(!e.line||!e.column)throw e;throw new SyntaxError(e.message+" At line : "+e.line+", column : "+e.column)}};h.filterNode=function(e,t){return h.optimizers[t[0]](e,t)};h.optimizers={body:function(e,t){for(var o,r,n=[t[0]],i=1,a=t.length;a>i;i++)(r=h.filterNode(e,t[i]))&&("buffer"===r[0]||"format"===r[0]?o?(o[0]="buffer"===r[0]?"buffer":o[0],o[1]+=r.slice(1,-2).join("")):(o=r,n.push(r)):(o=null,n.push(r)));return n},buffer:n,special:function(e,t){return["buffer",u[t[1]],t[2],t[3]]},format:function(e,o){return t.config.whitespace?(o.splice(1,2,o.slice(1,-2).join("")),o):null},reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:n,key:n,path:n,literal:n,raw:n,comment:i,line:i,col:i};h.pragmas={esc:function(e,t,o){var r,n=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=s(e,o.block),e.auto=n,r}};u={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};h.compileNode=function(e,t){return h.nodes[t[0]](e,t)};h.nodes={body:function(e,t){var o=e.index++,r="body_"+o;return e.bodies[o]=s(e,t),r},buffer:function(e,t){return".w("+v(t[1])+")"},format:function(e,t){return".w("+v(t[1])+")"},reference:function(e,t){return".f("+h.compileNode(e,t[1])+",ctx,"+h.compileNode(e,t[2])+")"},"#":function(e,t){return l(e,t,"section")},"?":function(e,t){return l(e,t,"exists")},"^":function(e,t){return l(e,t,"notexists")},"<":function(e,t){for(var o,r=t[4],n=1,i=r.length;i>n;n++)if("block"===(o=r[n])[1][1])return e.blocks[t[1].text]=h.compileNode(e,o[2]),"";return""},"+":function(e,t){return void 0===t[1].text&&void 0===t[4]?".b(ctx.getBlock("+h.compileNode(e,t[1])+",chk, ctx),"+h.compileNode(e,t[2])+", {},"+h.compileNode(e,t[3])+")":".b(ctx.getBlock("+v(t[1].text)+"),"+h.compileNode(e,t[2])+","+h.compileNode(e,t[4])+","+h.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+v(t[1].text)+","+h.compileNode(e,t[2])+","+h.compileNode(e,t[4])+","+h.compileNode(e,t[3])+")"},"%":function(e,t){var o,r,n,i,a,s,l,c,u,d=t[1][1];if(!h.pragmas[d])return"";for(r={},c=1,u=(o=t[4]).length;u>c;c++)r[(s=o[c])[1][1]]=s[2];for(i={},c=1,u=(n=t[3]).length;u>c;c++)i[(l=n[c])[1][1]]=l[2][1];return a=t[2][1]?t[2][1].text:null,h.pragmas[d](e,a,r,i)},partial:function(e,t){return".p("+h.compileNode(e,t[1])+",ctx,"+h.compileNode(e,t[2])+","+h.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+h.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var o=[],r=1,n=t.length;n>r;r++)o.push(h.compileNode(e,t[r]));return o.length?"{"+o.join(",")+"}":"{}"},bodies:function(e,t){for(var o=[],r=1,n=t.length;n>r;r++)o.push(h.compileNode(e,t[r]));return"{"+o.join(",")+"}"},param:function(e,t){return h.compileNode(e,t[1])+":"+h.compileNode(e,t[2])},filters:function(e,t){for(var o,r=[],n=1,i=t.length;i>n;n++)o=t[n],r.push('"'+o+'"');return'"'+e.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var o=t[1],r=t[2],n=[],i=0,a=r.length;a>i;i++)n.push(d(r[i])?h.compileNode(e,r[i]):'"'+r[i]+'"');return"ctx.getPath("+o+", ["+n.join(",")+"])"},literal:function(e,t){return v(t[1])},raw:function(e,t){return".w("+v(t[1])+")"}};var p=/\\/g,f=/"/g,g=/\f/g,m=/\n/g,y=/\r/g,C=/\t/g,v="undefined"==typeof JSON?function(e){return'"'+function(e){return e.replace(p,"\\\\").replace(f,'\\"').replace(g,"\\f").replace(m,"\\n").replace(y,"\\r").replace(C,"\\t")}(e)+'"'}:JSON.stringify;return t.compiler=h,t.compile=t.compiler.compile,t.renderSource=function(e,o,r){return c(t.loadSource(t.compile(e)))(o,r)},t.compileFn=function(e,o){return c(t.loadSource(t.compile(e,o)))},t.filterNode=h.filterNode,t.optimizers=h.optimizers,t.pragmas=h.pragmas,t.compileNode=h.compileNode,t.nodes=h.nodes,h});"function"==typeof define&&define.amd&&!0===define.amd.dust&&define(["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,o){e([t],function(){o()})},t});!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define(["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,o,r){r=r||"INFO";t=t?"{@"+t+"}: ":"";e.log(t+o,r)}function o(e){u[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),u[e]=!0)}function r(e){return function(e){return e.stack.tail&&e.stack.tail.head&&void 0!==e.stack.tail.head.__select__}(e)&&e.get("__select__")}function n(e,t){var o,r,n=e.stack.head,i=e.rebase();e.stack&&e.stack.tail&&(i.stack=e.stack.tail);r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(o in t)r[o]=t[o];return i.push({__select__:r}).push(n,e.stack.index,e.stack.of)}function i(e){var t,o;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,o=e.deferreds.length;t<o;t++)e.deferreds[t]();e.isDeferredPending=!1}function a(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function s(e,t){return function(o,r,n,i){return l(o,r,n,i,e,t)}}function l(e,o,n,i,a,s){var l,u,h,d=n.block,p=n.else,f=r(o)||{};if(f.isResolved&&!f.isDeferredPending)return e;if(i.hasOwnProperty("key"))u=i.key;else{if(!f.hasOwnProperty("key"))return t(a,"No key specified","WARN"),e;u=f.key}return h=i.type||f.type,s(u=c(o.resolve(u),h),c(o.resolve(i.value),h))?(f.isPending||(l=!0,f.isPending=!0),d&&(e=e.render(d,o)),l&&(f.isResolved=!0)):p&&(e=e.render(p,o)),e}function c(e,t){t&&(t=t.toLowerCase());switch(t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"!==e&&e,Boolean(e);case"date":return new Date(e)}return e}var u={},h={tap:function(e,t,r){return o("tap"),r.resolve(e)},sep:function(e,t,o){var r=o.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,o){return 0===t.stack.index?o.block(e,t):e},last:function(e,t,o){return t.stack.index===t.stack.of-1?o.block(e,t):e},contextDump:function(e,o,r,n){var i,s,l=o.resolve(n.to);switch(o.resolve(n.key)){case"full":i=o.stack;break;default:i=o.stack.head}s=JSON.stringify(i,a,2);switch(l){case"console":t("contextDump",s);break;default:s=s.replace(/</g,"\\u003c");e=e.write(s)}return e},math:function(e,o,a,s){var l,c=s.key,u=s.method,h=s.operand,d=s.round;if(!s.hasOwnProperty("key")||!s.method)return t("math","`key` or `method` was not provided","ERROR"),e;c=parseFloat(o.resolve(c));h=parseFloat(o.resolve(h));switch(u){case"mod":0===h&&t("math","Division by 0","ERROR");l=c%h;break;case"add":l=c+h;break;case"subtract":l=c-h;break;case"multiply":l=c*h;break;case"divide":0===h&&t("math","Division by 0","ERROR");l=c/h;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:t("math","Method `"+u+"` is not supported","ERROR")}return void 0!==l&&(d&&(l=Math.round(l)),a&&a.block?(o=n(o,{key:l}),e=e.render(a.block,o),i(r(o))):e=e.write(l)),e},select:function(e,o,a,s){var l=a.block,c={};return s.hasOwnProperty("key")&&(c.key=o.resolve(s.key)),s.hasOwnProperty("type")&&(c.type=s.type),l?(o=n(o,c),e=e.render(l,o),i(r(o))):t("select","Missing body block","WARN"),e},eq:s("eq",function(e,t){return e===t}),ne:s("ne",function(e,t){return e!==t}),lt:s("lt",function(e,t){return e<t}),lte:s("lte",function(e,t){return e<=t}),gt:s("gt",function(e,t){return e>t}),gte:s("gte",function(e,t){return e>=t}),any:function(e,o,n){var i=r(o);return i?i.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){i.deferreds.push(function(){i.isResolved&&(e=e.render(n.block,o));e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,o,n){var i=r(o);return i?i.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){i.deferreds.push(function(){i.isResolved||(e=e.render(n.block,o));e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,o,r,n){var i,a,s=n.key;if((s=o.resolve(n.key))&&!0!==s)if(e.isArray(s))i=s.length;else if(!isNaN(parseFloat(s))&&isFinite(s))i=s;else if("object"==typeof s){i=0;for(a in s)s.hasOwnProperty(a)&&i++}else i=(s+"").length;else i=0;return t.write(i)}};for(var d in h)e.helpers[d]=h[d];return e});!function(e,t){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(o){return t(o,e)}):"object"==typeof module&&module.exports?module.exports=t(require("dustjs-linkedin"),this):e.dust=t(e.dust,e)}(this,function(e,t,o){"use strict";var r=Object.prototype.toString,n=typeof console!==o?console:{log:function(){}},i={isArray:Array.isArray||function(e){return"[object Array]"===r.call(e)},isAvailable:function(e){return s[e]!==o},log:n.log},a={selected:o,languages:{},filters:{}},s=a.languages;return typeof String.prototype.trim===o&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.i18n={resetContext:function(){a.selected=o,Object.keys(s).forEach(function(e){delete s[e]})},setLanguage:function(e){if(!i.isAvailable(e))throw new Error("language '"+e+"' not available!");a.selected=e},setLanguages:function(e){i.isArray(e)&&e.forEach(function(e){i.isAvailable(e)||(s[e]={}),a.selected===o&&(a.selected=e)})},add:function(e,t){if(i.isAvailable(e)){var o=s[e];Object.keys(t).forEach(function(e){o[e]=t[e]})}},addFilter:function(e,t){e in a.filters||(a.filters[e]=t)}},e.helpers.i18n=function(t,r,n,l){if(l&&l.$key!==o){var c,u,h,d,p=a.selected,f=s[p],g=/\{(\s*[\w]+\s*)\}/g;h=e.helpers.tap(l.$key,t,r).split("|");var m=e.helpers.tap(h.shift(),t,r);for(d=f!==o&&f[m]!==o?f[m]:null;null!==(c=g.exec(d));)"$key"===c[1].trim()?(u="",i.log("$key can't be used as a parameter")):u=e.helpers.tap(l[c[1].trim()],t,r),d=d.replace(c[0],u);h.forEach(function(e){e in a.filters&&(d=a.filters[e](d))}),t.write(d)}else i.log("No key given in the i18n helper");return t},e});!function(){dust.helpers.iterate=function(e,t,o,r){var n=(r=r||{}).on||t.current(),i=null!=r.excludedKeys?r.excludedKeys.split(","):null;for(var a in n)(null==i||i.indexOf(a)<0)&&(e=e.render(o.block,t.push({key:a,value:n[a]})));return e};dust.helpers.startsWith=function(e,t,o,r){var n=o.block,i=o.else,a=r.key,s=r.value;"string"==typeof a&&0===a.toLowerCase().indexOf(s.toLowerCase())?e=e.render(n,t):i&&(e=e.render(i,t));return e}}();var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);o.prototype=t.prototype;e.prototype=new o},exports,define;function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var o=t,r=0;r<this.length;r++)o=e(o,this[r],r,this);return o});var t="";return("."+e).split(".").reduce(function(e,o,r,n){void 0===(o=e["__"+(t=t?t+"."+o:o)])&&(JL.Logger.prototype=e,o=new JL.Logger(t),e["__"+t]=o);return o},JL.__)}!function(e){function t(e,t,o){void 0!==t[e]&&(null===t[e]?delete o[e]:o[e]=t[e])}function o(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function n(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function i(e){switch(typeof(e=n(e))){case"string":return new a(e,null,e);case"number":case"boolean":return e=e.toString(),new a(e,null,e);case"undefined":return new a("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new a(e,null,e)):new a(null,e,JSON.stringify(e));default:return new a("unknown",null,"unknown")}}e.enabled;e.maxMessages;e.defaultAjaxUrl;e.clientIP;e.defaultBeforeSend;e.requestId="";var a=function(e,t,o){this.msg=e;this.meta=t;this.finalString=o};e.setOptions=function(e){t("enabled",e,this);t("maxMessages",e,this);t("defaultAjaxUrl",e,this);t("clientIP",e,this);t("requestId",e,this);t("defaultBeforeSend",e,this);return this};e.getAllLevel=function(){return-2147483648};e.getTraceLevel=function(){return 1e3};e.getDebugLevel=function(){return 2e3};e.getInfoLevel=function(){return 3e3};e.getWarnLevel=function(){return 4e3};e.getErrorLevel=function(){return 5e3};e.getFatalLevel=function(){return 6e3};e.getOffLevel=function(){return 2147483647};var s=function(e,t){this.inner=t;this.name="JL.Exception";this.message=i(e).finalString};e.Exception=s;s.prototype=Error();var l=function(e,t,o,r){this.l=e;this.m=t;this.n=o;this.t=r};e.LogItem=l;s=function(){function n(t,o){this.appenderName=t;this.sendLogItems=o;this.level=e.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}n.prototype.setOptions=function(e){t("level",e,this);t("ipRegex",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("sendWithBufferLevel",e,this);t("storeInBufferLevel",e,this);t("bufferSize",e,this);t("batchSize",e,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};n.prototype.log=function(e,t,n,i,a,s,c){!o(this)||!r(this,s)||a<this.storeInBufferLevel||(e=new l(a,s,c,(new Date).getTime()),a<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};n.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return n}();e.Appender=s;var c=function(o){function r(e){o.call(this,e,r.prototype.sendLogItemsAjax)}__extends(r,o);r.prototype.setOptions=function(e){t("url",e,this);t("beforeSend",e,this);o.prototype.setOptions.call(this,e);return this};r.prototype.sendLogItemsAjax=function(t){try{var o="/jsnlog.logger";null!=e.defaultAjaxUrl&&(o=e.defaultAjaxUrl);this.url&&(o=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),n=this.getXhr(o);"function"==typeof this.beforeSend?this.beforeSend.call(this,n):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,n);n.send(r)}catch(e){}};r.prototype.getXhr=function(t){var o=new XMLHttpRequest;if(!("withCredentials"in o)&&"undefined"!=typeof XDomainRequest)return(o=new XDomainRequest).open("POST",t),o;o.open("POST",t);o.setRequestHeader("Content-Type","application/json");o.setRequestHeader("JSNLog-RequestId",e.requestId);return o};return r}(s);e.AjaxAppender=c;var u=function(t){function o(e){t.call(this,e,o.prototype.sendLogItemsConsole)}__extends(o,t);o.prototype.clog=function(e){console.log(e)};o.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)};o.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)};o.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)};o.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)};o.prototype.sendLogItemsConsole=function(t){try{if(console){var o;for(o=0;o<t.length;++o){var r=t[o],n=r.n+": "+r.m;"undefined"==typeof window&&(n=new Date(r.t)+" | "+n);r.l<=e.getDebugLevel()?this.cdebug(n):r.l<=e.getInfoLevel()?this.cinfo(n):r.l<=e.getWarnLevel()?this.cwarn(n):this.cerror(n)}}}catch(e){}};return o}(s);e.ConsoleAppender=u;s=function(){function e(e){this.loggerName=e;this.seenRegexes=[]}e.prototype.setOptions=function(e){t("level",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("ipRegex",e,this);t("appenders",e,this);t("onceOnly",e,this);this.seenRegexes=[];return this};e.prototype.buildExceptionObject=function(e){var t={};e.stack?t.stack=e.stack:t.e=e;e.message&&(t.message=e.message);e.name&&(t.name=e.name);e.data&&(t.data=e.data);e.inner&&(t.inner=this.buildExceptionObject(e.inner));return t};e.prototype.log=function(e,t,a){var s=0;if(!this.appenders)return this;if(e>=this.level&&o(this)&&(a?(s=this.buildExceptionObject(a)).logData=n(t):s=t,r(this,(t=i(s)).finalString))){if(this.onceOnly)for(s=this.onceOnly.length-1;0<=s;){if(RegExp(this.onceOnly[s]).test(t.finalString)){if(this.seenRegexes[s])return this;this.seenRegexes[s]=!0}s--}t.meta=t.meta||{};t.meta.loggerName=this.loggerName;for(s=this.appenders.length-1;0<=s;)this.appenders[s].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,function(){},e,t.finalString,this.loggerName),s--}return this};e.prototype.trace=function(e){return this.log(1e3,e)};e.prototype.debug=function(e){return this.log(2e3,e)};e.prototype.info=function(e){return this.log(3e3,e)};e.prototype.warn=function(e){return this.log(4e3,e)};e.prototype.error=function(e){return this.log(5e3,e)};e.prototype.fatal=function(e){return this.log(6e3,e)};e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)};return e}();e.Logger=s;e.createAjaxAppender=function(e){return new c(e)};e.createConsoleAppender=function(e){return new u(e)};s=new c("");"undefined"==typeof window&&(s=new u(""));e.__=new e.Logger("");e.__.setOptions({level:e.getDebugLevel(),appenders:[s]})}(JL||(JL={}));void 0!==exports&&(exports.JL=JL);"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,o){e!=Array.prototype&&e!=Object.prototype&&(e[t]=o.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,t,o,r){if(t){o=$jscomp.global;e=e.split(".");for(r=0;r<e.length-1;r++){var n=e[r];n in o||(o[n]={});o=o[n]}(t=t(r=o[e=e[e.length-1]]))!=r&&null!=t&&$jscomp.defineProperty(o,e,{configurable:!0,writable:!0,value:t})}};$jscomp.polyfill("Math.cosh",function(e){if(e)return e;var t=Math.exp;return function(e){e=Number(e);return(t(e)+t(-e))/2}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var e=0;return function(t){return $jscomp.SYMBOL_PREFIX+(t||"")+e++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var o=0,r={next:function(){if(o<e.length){var n=o++;return{value:t(n,e[n]),done:!1}}r.next=function(){return{done:!0,value:void 0}};return r.next()}};r[Symbol.iterator]=function(){return r};return r};$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");$jscomp.polyfill("Array.prototype.values",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e,t){return t})}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(e){return e||function(e,t,o){var r=this.length||0;0>t&&(t=Math.max(0,r+t));(null==o||o>r)&&(o=r);0>(o=Number(o))&&(o=Math.max(0,r+o));for(t=Number(t||0);t<o;t++)this[t]=e;return this}},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(e){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Object.is",function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(e){return e||function(e,t){var o=this;o instanceof String&&(o=String(o));var r=o.length;for(t=t||0;t<r;t++)if(o[t]==e||Object.is(o[t],e))return!0;return!1}},"es7","es3");$jscomp.checkStringArgs=function(e,t,o){if(null==e)throw new TypeError("The 'this' value for String.prototype."+o+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+o+" must not be a regular expression");return e+""};$jscomp.polyfill("String.prototype.includes",function(e){return e||function(e,t){return-1!==$jscomp.checkStringArgs(this,e,"includes").indexOf(e,t||0)}},"es6","es3");$jscomp.findInternal=function(e,t,o){e instanceof String&&(e=String(e));for(var r=e.length,n=0;n<r;n++){var i=e[n];if(t.call(o,i,n,e))return{i:n,v:i}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6","es3");$jscomp.polyfill("Array.prototype.findIndex",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).i}},"es6","es3");var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(e){return void 0!==e};goog.isString=function(e){return"string"==typeof e};goog.isBoolean=function(e){return"boolean"==typeof e};goog.isNumber=function(e){return"number"==typeof e};goog.exportPath_=function(e,t,o){e=e.split(".");o=o||goog.global;e[0]in o||!o.execScript||o.execScript("var "+e[0]);for(var r;e.length&&(r=e.shift());)!e.length&&goog.isDef(t)?o[r]=t:o=o[r]&&o[r]!==Object.prototype[r]?o[r]:o[r]={}};goog.define=function(e,t){COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&void 0===goog.global.CLOSURE_UNCOMPILED_DEFINES.nodeType&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,e)?t=goog.global.CLOSURE_UNCOMPILED_DEFINES[e]:goog.global.CLOSURE_DEFINES&&void 0===goog.global.CLOSURE_DEFINES.nodeType&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(t=goog.global.CLOSURE_DEFINES[e]));goog.exportPath_(e,t)};goog.DEBUG=!1;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(e){if(goog.isInModuleLoader_())throw Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');goog.constructNamespace_(e)};goog.constructNamespace_=function(e,t){if(!COMPILED){delete goog.implicitNamespaces_[e];for(var o=e;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(e,t)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(e){if(!goog.isString(e)||!e||-1==e.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+e+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=e;if(!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e]}};goog.module.get=function(e){return goog.module.getInternal_(e)};goog.module.getInternal_=function(e){if(!COMPILED){if(e in goog.loadedModules_)return goog.loadedModules_[e];if(!goog.implicitNamespaces_[e])return null!=(e=goog.getObjectByName(e))?e:null}return null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};goog.setTestOnly=function(e){if(goog.DISALLOW_TEST_ONLY_CODE)throw e=e||"",Error("Importing test-only code into non-debug environment"+(e?": "+e:"."))};goog.forwardDeclare=function(e){};COMPILED||(goog.isProvided_=function(e){return e in goog.loadedModules_||!goog.implicitNamespaces_[e]&&goog.isDefAndNotNull(goog.getObjectByName(e))},goog.implicitNamespaces_={"goog.module":!0});goog.getObjectByName=function(e,t){e=e.split(".");t=t||goog.global;for(var o=0;o<e.length;o++)if(t=t[e[o]],!goog.isDefAndNotNull(t))return null;return t};goog.globalize=function(e,t){t=t||goog.global;for(var o in e)t[o]=e[o]};goog.addDependency=function(e,t,o,r){if(goog.DEPENDENCIES_ENABLED){var n;e=e.replace(/\\/g,"/");var i=goog.dependencies_;r&&"boolean"!=typeof r||(r=r?{module:"goog"}:{});for(var a=0;n=t[a];a++)i.nameToPath[n]=e,i.loadFlags[e]=r;for(r=0;t=o[r];r++)e in i.requires||(i.requires[e]={}),i.requires[e][t]=!0}};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(e){goog.global.console&&goog.global.console.error(e)};goog.require=function(e){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(e);if(goog.isProvided_(e)){if(goog.isInModuleLoader_())return goog.module.getInternal_(e)}else if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(!t)throw e="goog.require could not find: "+e,goog.logToConsole_(e),Error(e);goog.writeScripts_(t)}return null}};goog.basePath="";goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error("unimplemented abstract method")};goog.addSingletonGetter=function(e){e.instance_=void 0;e.getInstance=function(){if(e.instance_)return e.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e);return e.instance_=new e}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE="detect";goog.TRANSPILER="transpile.js";goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={loadFlags:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return null!=e&&"write"in e},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH)&&goog.isString(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var e=goog.global.document,t=e.currentScript;for(t=(e=t?[t]:e.getElementsByTagName("SCRIPT")).length-1;0<=t;--t){var o=e[t].src,r=o.lastIndexOf("?");r=-1==r?o.length:r;if("base.js"==o.substr(r-7,7)){goog.basePath=o.substr(0,r-7);break}}}},goog.importScript_=function(e,t){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(e,t)&&(goog.dependencies_.written[e]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.oldIeWaiting_=!1,goog.importProcessedScript_=function(e,t,o){goog.importScript_("",'goog.retrieveAndExec_("'+e+'", '+t+", "+o+");")},goog.queuedModules_=[],goog.wrapModule_=function(e,t){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+e+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+e+"\n"},goog.loadQueuedModules_=function(){var e=goog.queuedModules_.length;if(0<e){var t=goog.queuedModules_;goog.queuedModules_=[];for(var o=0;o<e;o++)goog.maybeProcessDeferredPath_(t[o])}goog.oldIeWaiting_=!1},goog.maybeProcessDeferredDep_=function(e){goog.isDeferredModule_(e)&&goog.allDepsAreAvailable_(e)&&(e=goog.getPathFromDeps_(e),goog.maybeProcessDeferredPath_(goog.basePath+e))},goog.isDeferredModule_=function(e){var t=(e=goog.getPathFromDeps_(e))&&goog.dependencies_.loadFlags[e]||{},o=t.lang||"es3";return!(!e||"goog"!=t.module&&!goog.needsTranspile_(o))&&goog.basePath+e in goog.dependencies_.deferred},goog.allDepsAreAvailable_=function(e){if((e=goog.getPathFromDeps_(e))&&e in goog.dependencies_.requires)for(var t in goog.dependencies_.requires[e])if(!goog.isProvided_(t)&&!goog.isDeferredModule_(t))return!1;return!0},goog.maybeProcessDeferredPath_=function(e){if(e in goog.dependencies_.deferred){var t=goog.dependencies_.deferred[e];delete goog.dependencies_.deferred[e];goog.globalEval(t)}},goog.loadModuleFromUrl=function(e){goog.retrieveAndExec_(e,!0,!1)},goog.writeScriptSrcNode_=function(e){goog.global.document.write('<script type="text/javascript" src="'+e+'"><\/script>')},goog.appendScriptSrcNode_=function(e){var t=goog.global.document,o=t.createElement("script");o.type="text/javascript";o.src=e;o.defer=!1;o.async=!1;t.head.appendChild(o)},goog.writeScriptTag_=function(e,t){if(goog.inHtmlDocument_()){var o=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==o.readyState){if(/\bdeps.js$/.test(e))return!1;throw Error('Cannot write "'+e+'" after document load')}void 0===t?goog.IS_OLD_IE_?(goog.oldIeWaiting_=!0,t=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",o.write('<script type="text/javascript" src="'+e+'"'+t+"><\/script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(e):goog.writeScriptSrcNode_(e):o.write('<script type="text/javascript">'+goog.protectScriptTag_(t)+"<\/script>");return!0}return!1},goog.protectScriptTag_=function(e){return e.replace(/<\/(SCRIPT)/gi,"\\x3c/$1")},goog.needsTranspile_=function(e){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;goog.requiresTranspilation_||(goog.requiresTranspilation_=goog.createRequiresTranspilation_());if(e in goog.requiresTranspilation_)return goog.requiresTranspilation_[e];throw Error("Unknown language mode: "+e)},goog.requiresTranspilation_=null,goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(e,t){"complete"==e.readyState&&goog.lastNonModuleScriptIndex_==t&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(e){var t=[],o={},r=goog.dependencies_;!function e(n){if(!(n in r.written||n in r.visited)){r.visited[n]=!0;if(n in r.requires)for(var i in r.requires[n])if(!goog.isProvided_(i)){if(!(i in r.nameToPath))throw Error("Undefined nameToPath for "+i);e(r.nameToPath[i])}n in o||(o[n]=!0,t.push(n))}}(e);for(e=0;e<t.length;e++){var n=t[e];goog.dependencies_.written[n]=!0}var i=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(e=0;e<t.length;e++){if(!(n=t[e]))throw goog.moduleLoaderState_=i,Error("Undefined script input");var a=r.loadFlags[n]||{},s=goog.needsTranspile_(a.lang||"es3");"goog"==a.module||s?goog.importProcessedScript_(goog.basePath+n,"goog"==a.module,s):goog.importScript_(goog.basePath+n)}goog.moduleLoaderState_=i},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));goog.hasBadLetScoping=null;goog.useSafari10Workaround=function(){if(null==goog.hasBadLetScoping){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(e){a=!1}goog.hasBadLetScoping=a}return goog.hasBadLetScoping};goog.workaroundSafari10EvalBug=function(e){return"(function(){"+e+"\n;})();\n"};goog.loadModule=function(e){var t=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};if(goog.isFunction(e))var o=e.call(void 0,{});else{if(!goog.isString(e))throw Error("Invalid module definition");goog.useSafari10Workaround()&&(e=goog.workaroundSafari10EvalBug(e)),o=goog.loadModuleFromSource_.call(void 0,e)}var r=goog.moduleLoaderState_.moduleName;if(!goog.isString(r)||!r)throw Error('Invalid module name "'+r+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(r,o):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof o&&null!=o&&Object.seal(o);goog.loadedModules_[r]=o}finally{goog.moduleLoaderState_=t}};goog.loadModuleFromSource_=function(a){eval(a);return{}};goog.normalizePath_=function(e){e=e.split("/");for(var t=0;t<e.length;)"."==e[t]?e.splice(t,1):t&&".."==e[t]&&e[t-1]&&".."!=e[t-1]?e.splice(--t,2):t++;return e.join("/")};goog.loadFileSync_=function(e){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(e);try{var t=new goog.global.XMLHttpRequest;t.open("get",e,!1);t.send();return 0==t.status||200==t.status?t.responseText:null}catch(e){return null}};goog.retrieveAndExec_=function(e,t,o){if(!COMPILED){var r=e;e=goog.normalizePath_(e);var n=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,i=goog.loadFileSync_(e);if(null==i)throw Error('Load of "'+e+'" failed');o&&(i=goog.transpile_.call(goog.global,i,e));i=t?goog.wrapModule_(e,i):i+"\n//# sourceURL="+e;goog.IS_OLD_IE_&&goog.oldIeWaiting_?(goog.dependencies_.deferred[r]=i,goog.queuedModules_.push(r)):n(e,i)}};goog.transpile_=function(a,b){var c=goog.global.$jscomp;c||(goog.global.$jscomp=c={});var d=c.transpile;if(!d){var e=goog.basePath+goog.TRANSPILER,f=goog.loadFileSync_(e);if(f){eval(f+"\n//# sourceURL="+e);if(goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile;c=goog.global.$jscomp;d=c.transpile}}d||(d=c.transpile=function(e,t){goog.logToConsole_(t+" requires transpilation but no transpiler was found.");return e});return d(a,b)};goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t};goog.isNull=function(e){return null===e};goog.isDefAndNotNull=function(e){return null!=e};goog.isArray=function(e){return"array"==goog.typeOf(e)};goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length};goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear};goog.isFunction=function(e){return"function"==goog.typeOf(e)};goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t};goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(e){return!!e[goog.UID_PROPERTY_]};goog.removeUid=function(e){null!==e&&"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}};goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();t="array"==t?[]:{};for(var o in e)t[o]=goog.cloneObject(e[o]);return t}return e};goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)};goog.bindJs_=function(e,t,o){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(o,r);return e.apply(t,o)}}return function(){return e.apply(t,arguments)}};goog.bind=function(e,t,o){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(e,t){var o=Array.prototype.slice.call(arguments,1);return function(){var t=o.slice();t.push.apply(t,arguments);return e.apply(this,t)}};goog.mixin=function(e,t){for(var o in t)e[o]=t[o]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),void 0!==goog.global._evalTest_){try{delete goog.global._evalTest_}catch(e){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("SCRIPT");o.type="text/javascript";o.defer=!1;o.appendChild(t.createTextNode(e));t.body.appendChild(o);t.body.removeChild(o)}}};goog.evalWorksForGlobals_=null;goog.getCssName=function(e,t){if("."==String(e).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+e);var o=function(e){return goog.cssNameMapping_[e]||e},r=function(e){e=e.split("-");for(var t=[],r=0;r<e.length;r++)t.push(o(e[r]));return t.join("-")};r=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?o:r:function(e){return e};e=t?e+"-"+r(t):r(e);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(e):e};goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e;goog.cssNameMappingStyle_=t};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(e,t){t&&(e=e.replace(/\{\$([^}]+)}/g,function(e,o){return null!=t&&o in t?t[o]:e}));return e};goog.getMsgWithFallback=function(e,t){return e};goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)};goog.exportProperty=function(e,t,o){e[t]=o};goog.inherits=function(e,t){function o(){}o.prototype=t.prototype;e.superClass_=t.prototype;e.prototype=new o;e.prototype.constructor=e;e.base=function(e,o,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[o].apply(e,n)}};goog.base=function(e,t,o){var r=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!r)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(r.superClass_){for(var n=Array(arguments.length-1),i=1;i<arguments.length;i++)n[i-1]=arguments[i];return r.superClass_.constructor.apply(e,n)}n=Array(arguments.length-2);for(i=2;i<arguments.length;i++)n[i-2]=arguments[i];i=!1;for(var a=e.constructor;a;a=a.superClass_&&a.superClass_.constructor)if(a.prototype[t]===r)i=!0;else if(i)return a.prototype[t].apply(e,n);if(e[t]===r)return e.constructor.prototype[t].apply(e,n);throw Error("goog.base called from a method of one name to a method of a different name")};goog.scope=function(e){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a goog.module.");e.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);goog.defineClass=function(e,t){var o=t.constructor,r=t.statics;o&&o!=Object.prototype.constructor||(o=function(){throw Error("cannot instantiate an interface (no constructor defined).")});o=goog.defineClass.createSealingConstructor_(o,e);e&&goog.inherits(o,e);delete t.constructor;delete t.statics;goog.defineClass.applyProperties_(o.prototype,t);null!=r&&(r instanceof Function?r(o):goog.defineClass.applyProperties_(o,r));return o};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;goog.defineClass.createSealingConstructor_=function(e,t){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return e;var o=!goog.defineClass.isUnsealable_(t),r=function(){var t=e.apply(this,arguments)||this;t[goog.UID_PROPERTY_]=t[goog.UID_PROPERTY_];this.constructor===r&&o&&Object.seal instanceof Function&&Object.seal(t);return t};return r};goog.defineClass.isUnsealable_=function(e){return e&&e.prototype&&e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");goog.defineClass.applyProperties_=function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);for(var r=0;r<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;r++)o=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[r],Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])};goog.tagUnsealableClass=function(e){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";goog.createRequiresTranspilation_=function(){function a(e,t){d?c[e]=!0:t()?c[e]=!1:d=c[e]=!0}function b(a){try{return!!eval(a)}catch(e){return!1}}var c={es3:!1},d=!1,e=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";a("es5",function(){return b("[1,].length==1")});a("es6",function(){var t=e.match(/Edge\/(\d+)(\.\d)*/i);return!(t&&15>Number(t[1]))&&b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')});a("es6-impl",function(){return!0});a("es7",function(){return b("2 ** 2 == 4")});a("es8",function(){return b("async () => 1, true")});return c};var ol={ASSUME_TOUCH:!1,DEFAULT_MAX_ZOOM:42,DEFAULT_MIN_ZOOM:0,DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD:.5,DEFAULT_TILE_SIZE:256,DEFAULT_WMS_VERSION:"1.3.0",ENABLE_CANVAS:!0,ENABLE_PROJ4JS:!0,ENABLE_RASTER_REPROJECTION:!0,ENABLE_WEBGL:!0,DEBUG_WEBGL:!0,INITIAL_ATLAS_SIZE:256,MAX_ATLAS_SIZE:-1,MOUSEWHEELZOOM_MAXDELTA:1,OVERVIEWMAP_MAX_RATIO:.75,OVERVIEWMAP_MIN_RATIO:.1,RASTER_REPROJECTION_MAX_SOURCE_TILES:100,RASTER_REPROJECTION_MAX_SUBDIVISION:10,RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH:.25,SIMPLIFY_TOLERANCE:.5,WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK:1024,VERSION:"4.6.5",inherits:function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e},nullFunction:function(){},getUid:function(e){return e.ol_uid||(e.ol_uid=++ol.uidCounter_)},uidCounter_:0,AssertionError:function(e){this.message="Assertion failed. See https://openlayers.org/en/"+(ol.VERSION?ol.VERSION.split("-")[0]:"latest")+"/doc/errors/#"+e+" for details.";this.code=e;this.name="AssertionError"}};ol.inherits(ol.AssertionError,Error);ol.TileRange=function(e,t,o,r){this.minX=e;this.maxX=t;this.minY=o;this.maxY=r};ol.TileRange.createOrUpdate=function(e,t,o,r,n){return void 0!==n?(n.minX=e,n.maxX=t,n.minY=o,n.maxY=r,n):new ol.TileRange(e,t,o,r)};ol.TileRange.prototype.contains=function(e){return this.containsXY(e[1],e[2])};ol.TileRange.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY};ol.TileRange.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY};ol.TileRange.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY};ol.TileRange.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX);e.maxX>this.maxX&&(this.maxX=e.maxX);e.minY<this.minY&&(this.minY=e.minY);e.maxY>this.maxY&&(this.maxY=e.maxY)};ol.TileRange.prototype.getHeight=function(){return this.maxY-this.minY+1};ol.TileRange.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]};ol.TileRange.prototype.getWidth=function(){return this.maxX-this.minX+1};ol.TileRange.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY};ol.asserts={};ol.asserts.assert=function(e,t){if(!e)throw new ol.AssertionError(t)};ol.math={};ol.math.clamp=function(e,t,o){return Math.min(Math.max(e,t),o)};ol.math.cosh="cosh"in Math?Math.cosh:function(e){return((e=Math.exp(e))+1/e)/2};ol.math.roundUpToPowerOfTwo=function(e){ol.asserts.assert(0<e,29);return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))};ol.math.squaredSegmentDistance=function(e,t,o,r,n,i){var a=n-o,s=i-r;if(0!==a||0!==s){var l=((e-o)*a+(t-r)*s)/(a*a+s*s);1<l?(o=n,r=i):0<l&&(o+=a*l,r+=s*l)}return ol.math.squaredDistance(e,t,o,r)};ol.math.squaredDistance=function(e,t,o,r){return(e=o-e)*e+(t=r-t)*t};ol.math.solveLinearSystem=function(e){for(var t=e.length,o=0;o<t;o++){for(var r=o,n=Math.abs(e[o][o]),i=o+1;i<t;i++){var a=Math.abs(e[i][o]);a>n&&(n=a,r=i)}if(0===n)return null;n=e[r];e[r]=e[o];e[o]=n;for(r=o+1;r<t;r++)for(n=-e[r][o]/e[o][o],i=o;i<t+1;i++)e[r][i]=o==i?0:e[r][i]+n*e[o][i]}o=Array(t);for(r=t-1;0<=r;r--)for(o[r]=e[r][t]/e[r][r],n=r-1;0<=n;n--)e[n][t]-=e[n][r]*o[r];return o};ol.math.toDegrees=function(e){return 180*e/Math.PI};ol.math.toRadians=function(e){return e*Math.PI/180};ol.math.modulo=function(e,t){return 0>(e%=t)*t?e+t:e};ol.math.lerp=function(e,t,o){return e+o*(t-e)};ol.size={};ol.size.buffer=function(e,t,o){void 0===o&&(o=[0,0]);o[0]=e[0]+2*t;o[1]=e[1]+2*t;return o};ol.size.hasArea=function(e){return 0<e[0]&&0<e[1]};ol.size.scale=function(e,t,o){void 0===o&&(o=[0,0]);o[0]=e[0]*t+.5|0;o[1]=e[1]*t+.5|0;return o};ol.size.toSize=function(e,t){if(Array.isArray(e))return e;void 0===t?t=[e,e]:t[0]=t[1]=e;return t};ol.extent={};ol.extent.Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};ol.extent.Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};ol.extent.boundingExtent=function(e){for(var t=ol.extent.createEmpty(),o=0,r=e.length;o<r;++o)ol.extent.extendCoordinate(t,e[o]);return t};ol.extent.boundingExtentXYs_=function(e,t,o){var r=Math.min.apply(null,e),n=Math.min.apply(null,t);e=Math.max.apply(null,e);t=Math.max.apply(null,t);return ol.extent.createOrUpdate(r,n,e,t,o)};ol.extent.buffer=function(e,t,o){return o?(o[0]=e[0]-t,o[1]=e[1]-t,o[2]=e[2]+t,o[3]=e[3]+t,o):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]};ol.extent.clone=function(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()};ol.extent.closestSquaredDistanceXY=function(e,t,o){return(t=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0)*t+(e=o<e[1]?e[1]-o:e[3]<o?o-e[3]:0)*e};ol.extent.containsCoordinate=function(e,t){return ol.extent.containsXY(e,t[0],t[1])};ol.extent.containsExtent=function(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]};ol.extent.containsXY=function(e,t,o){return e[0]<=t&&t<=e[2]&&e[1]<=o&&o<=e[3]};ol.extent.coordinateRelationship=function(e,t){var o=e[1],r=e[2],n=e[3],i=t[0];t=t[1];var a=ol.extent.Relationship.UNKNOWN;i<e[0]?a|=ol.extent.Relationship.LEFT:i>r&&(a|=ol.extent.Relationship.RIGHT);t<o?a|=ol.extent.Relationship.BELOW:t>n&&(a|=ol.extent.Relationship.ABOVE);a===ol.extent.Relationship.UNKNOWN&&(a=ol.extent.Relationship.INTERSECTING);return a};ol.extent.createEmpty=function(){return[1/0,1/0,-1/0,-1/0]};ol.extent.createOrUpdate=function(e,t,o,r,n){return n?(n[0]=e,n[1]=t,n[2]=o,n[3]=r,n):[e,t,o,r]};ol.extent.createOrUpdateEmpty=function(e){return ol.extent.createOrUpdate(1/0,1/0,-1/0,-1/0,e)};ol.extent.createOrUpdateFromCoordinate=function(e,t){var o=e[0];e=e[1];return ol.extent.createOrUpdate(o,e,o,e,t)};ol.extent.createOrUpdateFromCoordinates=function(e,t){t=ol.extent.createOrUpdateEmpty(t);return ol.extent.extendCoordinates(t,e)};ol.extent.createOrUpdateFromFlatCoordinates=function(e,t,o,r,n){n=ol.extent.createOrUpdateEmpty(n);return ol.extent.extendFlatCoordinates(n,e,t,o,r)};ol.extent.createOrUpdateFromRings=function(e,t){t=ol.extent.createOrUpdateEmpty(t);return ol.extent.extendRings(t,e)};ol.extent.equals=function(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]};ol.extent.extend=function(e,t){t[0]<e[0]&&(e[0]=t[0]);t[2]>e[2]&&(e[2]=t[2]);t[1]<e[1]&&(e[1]=t[1]);t[3]>e[3]&&(e[3]=t[3]);return e};ol.extent.extendCoordinate=function(e,t){t[0]<e[0]&&(e[0]=t[0]);t[0]>e[2]&&(e[2]=t[0]);t[1]<e[1]&&(e[1]=t[1]);t[1]>e[3]&&(e[3]=t[1])};ol.extent.extendCoordinates=function(e,t){var o,r=0;for(o=t.length;r<o;++r)ol.extent.extendCoordinate(e,t[r]);return e};ol.extent.extendFlatCoordinates=function(e,t,o,r,n){for(;o<r;o+=n)ol.extent.extendXY(e,t[o],t[o+1]);return e};ol.extent.extendRings=function(e,t){var o,r=0;for(o=t.length;r<o;++r)ol.extent.extendCoordinates(e,t[r]);return e};ol.extent.extendXY=function(e,t,o){e[0]=Math.min(e[0],t);e[1]=Math.min(e[1],o);e[2]=Math.max(e[2],t);e[3]=Math.max(e[3],o)};ol.extent.forEachCorner=function(e,t,o){var r;return(r=t.call(o,ol.extent.getBottomLeft(e)))||(r=t.call(o,ol.extent.getBottomRight(e)))||(r=t.call(o,ol.extent.getTopRight(e)))?r:!!(r=t.call(o,ol.extent.getTopLeft(e)))&&r};ol.extent.getArea=function(e){var t=0;ol.extent.isEmpty(e)||(t=ol.extent.getWidth(e)*ol.extent.getHeight(e));return t};ol.extent.getBottomLeft=function(e){return[e[0],e[1]]};ol.extent.getBottomRight=function(e){return[e[2],e[1]]};ol.extent.getCenter=function(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]};ol.extent.getCorner=function(e,t){var o;t===ol.extent.Corner.BOTTOM_LEFT?o=ol.extent.getBottomLeft(e):t===ol.extent.Corner.BOTTOM_RIGHT?o=ol.extent.getBottomRight(e):t===ol.extent.Corner.TOP_LEFT?o=ol.extent.getTopLeft(e):t===ol.extent.Corner.TOP_RIGHT?o=ol.extent.getTopRight(e):ol.asserts.assert(!1,13);return o};ol.extent.getEnlargedArea=function(e,t){return(Math.max(e[2],t[2])-Math.min(e[0],t[0]))*(Math.max(e[3],t[3])-Math.min(e[1],t[1]))};ol.extent.getForViewAndSize=function(e,t,o,r,n){var i=t*r[0]/2;r=t*r[1]/2;t=Math.cos(o);var a=Math.sin(o);o=i*t;i*=a;t*=r;var s=r*a,l=e[0],c=e[1];e=l-o+s;r=l-o-s;a=l+o-s;o=l+o+s;s=c-i-t;l=c-i+t;var u=c+i+t;i=c+i-t;return ol.extent.createOrUpdate(Math.min(e,r,a,o),Math.min(s,l,u,i),Math.max(e,r,a,o),Math.max(s,l,u,i),n)};ol.extent.getHeight=function(e){return e[3]-e[1]};ol.extent.getIntersectionArea=function(e,t){e=ol.extent.getIntersection(e,t);return ol.extent.getArea(e)};ol.extent.getIntersection=function(e,t,o){o=o||ol.extent.createEmpty();ol.extent.intersects(e,t)&&(o[0]=e[0]>t[0]?e[0]:t[0],o[1]=e[1]>t[1]?e[1]:t[1],o[2]=e[2]<t[2]?e[2]:t[2],o[3]=e[3]<t[3]?e[3]:t[3]);return o};ol.extent.getMargin=function(e){return ol.extent.getWidth(e)+ol.extent.getHeight(e)};ol.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]};ol.extent.getTopLeft=function(e){return[e[0],e[3]]};ol.extent.getTopRight=function(e){return[e[2],e[3]]};ol.extent.getWidth=function(e){return e[2]-e[0]};ol.extent.intersects=function(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]};ol.extent.isEmpty=function(e){return e[2]<e[0]||e[3]<e[1]};ol.extent.returnOrUpdate=function(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e};ol.extent.scaleFromCenter=function(e,t){var o=(e[2]-e[0])/2*(t-1);t=(e[3]-e[1])/2*(t-1);e[0]-=o;e[2]+=o;e[1]-=t;e[3]+=t};ol.extent.intersectsSegment=function(e,t,o){var r=!1,n=ol.extent.coordinateRelationship(e,t),i=ol.extent.coordinateRelationship(e,o);if(n===ol.extent.Relationship.INTERSECTING||i===ol.extent.Relationship.INTERSECTING)r=!0;else{var a=e[0],s=e[1],l=e[2];e=e[3];var c=o[0];t=((o=o[1])-t[1])/(c-t[0]);i&ol.extent.Relationship.ABOVE&&!(n&ol.extent.Relationship.ABOVE)&&(r=(r=c-(o-e)/t)>=a&&r<=l);r||!(i&ol.extent.Relationship.RIGHT)||n&ol.extent.Relationship.RIGHT||(r=(r=o-(c-l)*t)>=s&&r<=e);r||!(i&ol.extent.Relationship.BELOW)||n&ol.extent.Relationship.BELOW||(r=(r=c-(o-s)/t)>=a&&r<=l);r||!(i&ol.extent.Relationship.LEFT)||n&ol.extent.Relationship.LEFT||(r=(r=o-(c-a)*t)>=s&&r<=e)}return r};ol.extent.applyTransform=function(e,t,o){t(e=[e[0],e[1],e[0],e[3],e[2],e[1],e[2],e[3]],e,2);return ol.extent.boundingExtentXYs_([e[0],e[2],e[4],e[6]],[e[1],e[3],e[5],e[7]],o)};ol.obj={};ol.obj.assign="function"==typeof Object.assign?Object.assign:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),r=1,n=arguments.length;r<n;++r){var i=arguments[r];if(void 0!==i&&null!==i)for(var a in i)i.hasOwnProperty(a)&&(o[a]=i[a])}return o};ol.obj.clear=function(e){for(var t in e)delete e[t]};ol.obj.getValues=function(e){var t,o=[];for(t in e)o.push(e[t]);return o};ol.obj.isEmpty=function(e){for(var t in e)return!1;return!t};ol.geom={};ol.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};ol.Sphere=function(e){this.radius=e};ol.Sphere.prototype.geodesicArea=function(e){return ol.Sphere.getArea_(e,this.radius)};ol.Sphere.prototype.haversineDistance=function(e,t){return ol.Sphere.getDistance_(e,t,this.radius)};ol.Sphere.prototype.offset=function(e,t,o){var r=ol.math.toRadians(e[1]);e=ol.math.toRadians(e[0]);t/=this.radius;var n=Math.asin(Math.sin(r)*Math.cos(t)+Math.cos(r)*Math.sin(t)*Math.cos(o));return[ol.math.toDegrees(e+Math.atan2(Math.sin(o)*Math.sin(t)*Math.cos(r),Math.cos(t)-Math.sin(r)*Math.sin(n))),ol.math.toDegrees(n)]};ol.Sphere.DEFAULT_RADIUS=6371008.8;ol.Sphere.getLength=function(e,t){var o=t||{},r=o.radius||ol.Sphere.DEFAULT_RADIUS;o=o.projection||"EPSG:3857";var n,i=(e=e.clone().transform(o,"EPSG:4326")).getType();o=0;switch(i){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:break;case ol.geom.GeometryType.LINE_STRING:case ol.geom.GeometryType.LINEAR_RING:t=e.getCoordinates();o=ol.Sphere.getLength_(t,r);break;case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:t=e.getCoordinates();e=0;for(i=t.length;e<i;++e)o+=ol.Sphere.getLength_(t[e],r);break;case ol.geom.GeometryType.MULTI_POLYGON:t=e.getCoordinates();e=0;for(i=t.length;e<i;++e){var a=t[e],s=0;for(n=a.length;s<n;++s)o+=ol.Sphere.getLength_(a[s],r)}break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:r=e.getGeometries();e=0;for(i=r.length;e<i;++e)o+=ol.Sphere.getLength(r[e],t);break;default:throw Error("Unsupported geometry type: "+i)}return o};ol.Sphere.getLength_=function(e,t){for(var o=0,r=0,n=e.length;r<n-1;++r)o+=ol.Sphere.getDistance_(e[r],e[r+1],t);return o};ol.Sphere.getDistance_=function(e,t,o){var r=ol.math.toRadians(e[1]),n=ol.math.toRadians(t[1]),i=(n-r)/2;e=ol.math.toRadians(t[0]-e[0])/2;r=Math.sin(i)*Math.sin(i)+Math.sin(e)*Math.sin(e)*Math.cos(r)*Math.cos(n);return 2*o*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))};ol.Sphere.getArea=function(e,t){var o=t||{},r=o.radius||ol.Sphere.DEFAULT_RADIUS;o=o.projection||"EPSG:3857";var n,i=(e=e.clone().transform(o,"EPSG:4326")).getType();o=0;switch(i){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:case ol.geom.GeometryType.LINE_STRING:case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.LINEAR_RING:break;case ol.geom.GeometryType.POLYGON:t=e.getCoordinates();o=Math.abs(ol.Sphere.getArea_(t[0],r));e=1;for(i=t.length;e<i;++e)o-=Math.abs(ol.Sphere.getArea_(t[e],r));break;case ol.geom.GeometryType.MULTI_POLYGON:t=e.getCoordinates();e=0;for(i=t.length;e<i;++e){var a=t[e];o+=Math.abs(ol.Sphere.getArea_(a[0],r));var s=1;for(n=a.length;s<n;++s)o-=Math.abs(ol.Sphere.getArea_(a[s],r))}break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:r=e.getGeometries();e=0;for(i=r.length;e<i;++e)o+=ol.Sphere.getArea(r[e],t);break;default:throw Error("Unsupported geometry type: "+i)}return o};ol.Sphere.getArea_=function(e,t){for(var o=0,r=e.length,n=e[r-1][0],i=e[r-1][1],a=0;a<r;a++){var s=e[a][0],l=e[a][1];o+=ol.math.toRadians(s-n)*(2+Math.sin(ol.math.toRadians(i))+Math.sin(ol.math.toRadians(l)));n=s;i=l}return o*t*t/2};ol.proj={};ol.proj.Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};ol.proj.Units.METERS_PER_UNIT={};ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.DEGREES]=12741994*Math.PI/360;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.FEET]=.3048;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.METERS]=1;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.USFEET]=1200/3937;ol.proj.proj4={};ol.proj.proj4.cache_=null;ol.proj.proj4.set=function(e){ol.proj.proj4.cache_=e};ol.proj.proj4.get=function(){return ol.proj.proj4.cache_||window.proj4};ol.proj.Projection=function(e){this.code_=e.code;this.units_=e.units;this.extent_=void 0!==e.extent?e.extent:null;this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null;this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu";this.global_=void 0!==e.global&&e.global;this.canWrapX_=!(!this.global_||!this.extent_);this.getPointResolutionFunc_=e.getPointResolution;this.defaultTileGrid_=null;this.metersPerUnit_=e.metersPerUnit;var t=e.code;if(ol.ENABLE_PROJ4JS){var o=ol.proj.proj4.get();"function"==typeof o&&(void 0!==(t=o.defs(t))&&(void 0!==t.axis&&void 0===e.axisOrientation&&(this.axisOrientation_=t.axis),void 0===e.metersPerUnit&&(this.metersPerUnit_=t.to_meter),void 0===e.units&&(this.units_=t.units)))}};ol.proj.Projection.prototype.canWrapX=function(){return this.canWrapX_};ol.proj.Projection.prototype.getCode=function(){return this.code_};ol.proj.Projection.prototype.getExtent=function(){return this.extent_};ol.proj.Projection.prototype.getUnits=function(){return this.units_};ol.proj.Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ol.proj.Units.METERS_PER_UNIT[this.units_]};ol.proj.Projection.prototype.getWorldExtent=function(){return this.worldExtent_};ol.proj.Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_};ol.proj.Projection.prototype.isGlobal=function(){return this.global_};ol.proj.Projection.prototype.setGlobal=function(e){this.global_=e;this.canWrapX_=!(!e||!this.extent_)};ol.proj.Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_};ol.proj.Projection.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e};ol.proj.Projection.prototype.setExtent=function(e){this.extent_=e;this.canWrapX_=!(!this.global_||!e)};ol.proj.Projection.prototype.setWorldExtent=function(e){this.worldExtent_=e};ol.proj.Projection.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e};ol.proj.Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};ol.proj.EPSG3857={};ol.proj.EPSG3857.Projection_=function(e){ol.proj.Projection.call(this,{code:e,units:ol.proj.Units.METERS,extent:ol.proj.EPSG3857.EXTENT,global:!0,worldExtent:ol.proj.EPSG3857.WORLD_EXTENT,getPointResolution:function(e,t){return e/ol.math.cosh(t[1]/ol.proj.EPSG3857.RADIUS)}})};ol.inherits(ol.proj.EPSG3857.Projection_,ol.proj.Projection);ol.proj.EPSG3857.RADIUS=6378137;ol.proj.EPSG3857.HALF_SIZE=Math.PI*ol.proj.EPSG3857.RADIUS;ol.proj.EPSG3857.EXTENT=[-ol.proj.EPSG3857.HALF_SIZE,-ol.proj.EPSG3857.HALF_SIZE,ol.proj.EPSG3857.HALF_SIZE,ol.proj.EPSG3857.HALF_SIZE];ol.proj.EPSG3857.WORLD_EXTENT=[-180,-85,180,85];ol.proj.EPSG3857.PROJECTIONS=[new ol.proj.EPSG3857.Projection_("EPSG:3857"),new ol.proj.EPSG3857.Projection_("EPSG:102100"),new ol.proj.EPSG3857.Projection_("EPSG:102113"),new ol.proj.EPSG3857.Projection_("EPSG:900913"),new ol.proj.EPSG3857.Projection_("urn:ogc:def:crs:EPSG:6.18:3:3857"),new ol.proj.EPSG3857.Projection_("urn:ogc:def:crs:EPSG::3857"),new ol.proj.EPSG3857.Projection_("http://www.opengis.net/gml/srs/epsg.xml#3857")];ol.proj.EPSG3857.fromEPSG4326=function(e,t,o){var r=e.length;o=1<o?o:2;void 0===t&&(t=2<o?e.slice():Array(r));for(var n=ol.proj.EPSG3857.HALF_SIZE,i=0;i<r;i+=o){t[i]=n*e[i]/180;var a=ol.proj.EPSG3857.RADIUS*Math.log(Math.tan(Math.PI*(e[i+1]+90)/360));a>n?a=n:a<-n&&(a=-n);t[i+1]=a}return t};ol.proj.EPSG3857.toEPSG4326=function(e,t,o){var r=e.length;o=1<o?o:2;void 0===t&&(t=2<o?e.slice():Array(r));for(var n=0;n<r;n+=o)t[n]=180*e[n]/ol.proj.EPSG3857.HALF_SIZE,t[n+1]=360*Math.atan(Math.exp(e[n+1]/ol.proj.EPSG3857.RADIUS))/Math.PI-90;return t};ol.proj.EPSG4326={};ol.proj.EPSG4326.Projection_=function(e,t){ol.proj.Projection.call(this,{code:e,units:ol.proj.Units.DEGREES,extent:ol.proj.EPSG4326.EXTENT,axisOrientation:t,global:!0,metersPerUnit:ol.proj.EPSG4326.METERS_PER_UNIT,worldExtent:ol.proj.EPSG4326.EXTENT})};ol.inherits(ol.proj.EPSG4326.Projection_,ol.proj.Projection);ol.proj.EPSG4326.RADIUS=6378137;ol.proj.EPSG4326.EXTENT=[-180,-90,180,90];ol.proj.EPSG4326.METERS_PER_UNIT=Math.PI*ol.proj.EPSG4326.RADIUS/180;ol.proj.EPSG4326.PROJECTIONS=[new ol.proj.EPSG4326.Projection_("CRS:84"),new ol.proj.EPSG4326.Projection_("EPSG:4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:EPSG::4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:OGC:1.3:CRS84"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:OGC:2:84"),new ol.proj.EPSG4326.Projection_("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ol.proj.EPSG4326.Projection_("urn:x-ogc:def:crs:EPSG:4326","neu")];ol.proj.projections={};ol.proj.projections.cache_={};ol.proj.projections.clear=function(){ol.proj.projections.cache_={}};ol.proj.projections.get=function(e){return ol.proj.projections.cache_[e]||null};ol.proj.projections.add=function(e,t){ol.proj.projections.cache_[e]=t};ol.proj.transforms={};ol.proj.transforms.cache_={};ol.proj.transforms.clear=function(){ol.proj.transforms.cache_={}};ol.proj.transforms.add=function(e,t,o){e=e.getCode();t=t.getCode();var r=ol.proj.transforms.cache_;e in r||(r[e]={});r[e][t]=o};ol.proj.transforms.remove=function(e,t){e=e.getCode();t=t.getCode();var o=ol.proj.transforms.cache_,r=o[e][t];delete o[e][t];ol.obj.isEmpty(o[e])&&delete o[e];return r};ol.proj.transforms.get=function(e,t){var o,r=ol.proj.transforms.cache_;e in r&&t in r[e]&&(o=r[e][t]);return o};ol.proj.METERS_PER_UNIT=ol.proj.Units.METERS_PER_UNIT;ol.proj.SPHERE_=new ol.Sphere(ol.Sphere.DEFAULT_RADIUS);ol.ENABLE_PROJ4JS&&(ol.proj.setProj4=function(e){ol.proj.proj4.set(e)});ol.proj.getPointResolution=function(e,t,o,r){var n=(e=ol.proj.get(e)).getPointResolutionFunc();n?t=n(t,o):e.getUnits()==ol.proj.Units.DEGREES&&!r||r==ol.proj.Units.DEGREES||(t=(n=ol.proj.getTransformFromProjections(e,ol.proj.get("EPSG:4326")))(t=[o[0]-t/2,o[1],o[0]+t/2,o[1],o[0],o[1]-t/2,o[0],o[1]+t/2],t,2),t=((o=ol.proj.SPHERE_.haversineDistance(t.slice(0,2),t.slice(2,4)))+(t=ol.proj.SPHERE_.haversineDistance(t.slice(4,6),t.slice(6,8))))/2,void 0!==(e=r?ol.proj.Units.METERS_PER_UNIT[r]:e.getMetersPerUnit())&&(t/=e));return t};ol.proj.addEquivalentProjections=function(e){ol.proj.addProjections(e);e.forEach(function(t){e.forEach(function(e){t!==e&&ol.proj.transforms.add(t,e,ol.proj.cloneTransform)})})};ol.proj.addEquivalentTransforms=function(e,t,o,r){e.forEach(function(e){t.forEach(function(t){ol.proj.transforms.add(e,t,o);ol.proj.transforms.add(t,e,r)})})};ol.proj.addProjection=function(e){ol.proj.projections.add(e.getCode(),e);ol.proj.transforms.add(e,e,ol.proj.cloneTransform)};ol.proj.addProjections=function(e){e.forEach(ol.proj.addProjection)};ol.proj.clearAllProjections=function(){ol.proj.projections.clear();ol.proj.transforms.clear()};ol.proj.createProjection=function(e,t){return e?"string"==typeof e?ol.proj.get(e):e:ol.proj.get(t)};ol.proj.addCoordinateTransforms=function(e,t,o,r){e=ol.proj.get(e);t=ol.proj.get(t);ol.proj.transforms.add(e,t,ol.proj.createTransformFromCoordinateTransform(o));ol.proj.transforms.add(t,e,ol.proj.createTransformFromCoordinateTransform(r))};ol.proj.createTransformFromCoordinateTransform=function(e){return function(t,o,r){var n,i=t.length;r=void 0!==r?r:2;o=void 0!==o?o:Array(i);for(n=0;n<i;n+=r){var a=e([t[n],t[n+1]]);o[n]=a[0];o[n+1]=a[1];for(a=r-1;2<=a;--a)o[n+a]=t[n+a]}return o}};ol.proj.fromLonLat=function(e,t){return ol.proj.transform(e,"EPSG:4326",void 0!==t?t:"EPSG:3857")};ol.proj.toLonLat=function(e,t){(-180>(t=(e=ol.proj.transform(e,void 0!==t?t:"EPSG:3857","EPSG:4326"))[0])||180<t)&&(e[0]=ol.math.modulo(t+180,360)-180);return e};ol.proj.get=function(e){var t=null;if(e instanceof ol.proj.Projection)t=e;else if("string"==typeof e&&(t=ol.proj.projections.get(e),ol.ENABLE_PROJ4JS&&!t)){var o=ol.proj.proj4.get();"function"==typeof o&&void 0!==o.defs(e)&&(t=new ol.proj.Projection({code:e}),ol.proj.addProjection(t))}return t};ol.proj.equivalent=function(e,t){if(e===t)return!0;var o=e.getUnits()===t.getUnits();return e.getCode()===t.getCode()?o:ol.proj.getTransformFromProjections(e,t)===ol.proj.cloneTransform&&o};ol.proj.getTransform=function(e,t){e=ol.proj.get(e);t=ol.proj.get(t);return ol.proj.getTransformFromProjections(e,t)};ol.proj.getTransformFromProjections=function(e,t){var o=e.getCode(),r=t.getCode(),n=ol.proj.transforms.get(o,r);if(ol.ENABLE_PROJ4JS&&!n){var i=ol.proj.proj4.get();if("function"==typeof i){var a=i.defs(o),s=i.defs(r);void 0!==a&&void 0!==s&&(a===s?ol.proj.addEquivalentProjections([t,e]):(n=i(r,o),ol.proj.addCoordinateTransforms(t,e,n.forward,n.inverse)),n=ol.proj.transforms.get(o,r))}}n||(n=ol.proj.identityTransform);return n};ol.proj.identityTransform=function(e,t,o){if(void 0!==t&&e!==t){o=0;for(var r=e.length;o<r;++o)t[o]=e[o];e=t}return e};ol.proj.cloneTransform=function(e,t,o){if(void 0!==t){o=0;for(var r=e.length;o<r;++o)t[o]=e[o];e=t}else e=e.slice();return e};ol.proj.transform=function(e,t,o){return ol.proj.getTransform(t,o)(e,void 0,e.length)};ol.proj.transformExtent=function(e,t,o){t=ol.proj.getTransform(t,o);return ol.extent.applyTransform(e,t)};ol.proj.transformWithProjections=function(e,t,o){return ol.proj.getTransformFromProjections(t,o)(e)};ol.proj.addCommon=function(){ol.proj.addEquivalentProjections(ol.proj.EPSG3857.PROJECTIONS);ol.proj.addEquivalentProjections(ol.proj.EPSG4326.PROJECTIONS);ol.proj.addEquivalentTransforms(ol.proj.EPSG4326.PROJECTIONS,ol.proj.EPSG3857.PROJECTIONS,ol.proj.EPSG3857.fromEPSG4326,ol.proj.EPSG3857.toEPSG4326)};ol.proj.addCommon();ol.array={};ol.array.binarySearch=function(e,t,o){for(var r,n=o||ol.array.numberSafeCompareFunction,i=0,a=e.length,s=!1;i<a;)0>(r=+n(e[o=i+(a-i>>1)],t))?i=o+1:(a=o,s=!r);return s?i:~i};ol.array.numberSafeCompareFunction=function(e,t){return e>t?1:e<t?-1:0};ol.array.includes=function(e,t){return 0<=e.indexOf(t)};ol.array.linearFindNearest=function(e,t,o){var r=e.length;if(e[0]<=t)return 0;if(!(t<=e[r-1]))if(0<o){for(o=1;o<r;++o)if(e[o]<t)return o-1}else if(0>o){for(o=1;o<r;++o)if(e[o]<=t)return o}else for(o=1;o<r;++o){if(e[o]==t)return o;if(e[o]<t)return e[o-1]-t<t-e[o]?o-1:o}return r-1};ol.array.reverseSubArray=function(e,t,o){for(;t<o;){var r=e[t];e[t]=e[o];e[o]=r;++t;--o}};ol.array.extend=function(e,t){var o=Array.isArray(t)?t:[t],r=o.length;for(t=0;t<r;t++)e[e.length]=o[t]};ol.array.remove=function(e,t){var o=-1<(t=e.indexOf(t));o&&e.splice(t,1);return o};ol.array.find=function(e,t){for(var o,r=e.length>>>0,n=0;n<r;n++)if(t(o=e[n],n,e))return o;return null};ol.array.equals=function(e,t){var o=e.length;if(o!==t.length)return!1;for(var r=0;r<o;r++)if(e[r]!==t[r])return!1;return!0};ol.array.stableSort=function(e,t){var o,r=e.length,n=Array(e.length);for(o=0;o<r;o++)n[o]={index:o,value:e[o]};n.sort(function(e,o){return t(e.value,o.value)||e.index-o.index});for(o=0;o<e.length;o++)e[o]=n[o].value};ol.array.findIndex=function(e,t){var o;return e.every(function(r,n){o=n;return!t(r,n,e)})?-1:o};ol.array.isSorted=function(e,t,o){var r=t||ol.array.numberSafeCompareFunction;return e.every(function(t,n){return 0===n||!(0<(t=r(e[n-1],t))||o&&0===t)})};ol.tilecoord={};ol.tilecoord.createOrUpdate=function(e,t,o,r){return void 0!==r?(r[0]=e,r[1]=t,r[2]=o,r):[e,t,o]};ol.tilecoord.getKeyZXY=function(e,t,o){return e+"/"+t+"/"+o};ol.tilecoord.getKey=function(e){return ol.tilecoord.getKeyZXY(e[0],e[1],e[2])};ol.tilecoord.fromKey=function(e){return e.split("/").map(Number)};ol.tilecoord.hash=function(e){return(e[1]<<e[0])+e[2]};ol.tilecoord.quadKey=function(e){var t,o=e[0],r=Array(o),n=1<<o-1;for(t=0;t<o;++t){var i=48;e[1]&n&&(i+=1);e[2]&n&&(i+=2);r[t]=String.fromCharCode(i);n>>=1}return r.join("")};ol.tilecoord.withinExtentAndZ=function(e,t){var o=e[0],r=e[1];e=e[2];if(t.getMinZoom()>o||o>t.getMaxZoom())return!1;var n=t.getExtent();return!(t=n?t.getTileRangeForExtentAndZ(n,o):t.getFullTileRange(o))||t.containsXY(r,e)};ol.tilegrid={};ol.tilegrid.TileGrid=function(e){this.minZoom=void 0!==e.minZoom?e.minZoom:0;this.resolutions_=e.resolutions;ol.asserts.assert(ol.array.isSorted(this.resolutions_,function(e,t){return t-e},!0),17);if(!e.origins)for(var t=0,o=this.resolutions_.length-1;t<o;++t)if(r){if(this.resolutions_[t]/this.resolutions_[t+1]!==r){r=void 0;break}}else var r=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=r;this.maxZoom=this.resolutions_.length-1;this.origin_=void 0!==e.origin?e.origin:null;this.origins_=null;void 0!==e.origins&&(this.origins_=e.origins,ol.asserts.assert(this.origins_.length==this.resolutions_.length,20));void 0===(r=e.extent)||this.origin_||this.origins_||(this.origin_=ol.extent.getTopLeft(r));ol.asserts.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,ol.asserts.assert(this.tileSizes_.length==this.resolutions_.length,19));this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:ol.DEFAULT_TILE_SIZE;ol.asserts.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=void 0!==r?r:null;this.fullTileRanges_=null;this.tmpSize_=[0,0];void 0!==e.sizes?this.fullTileRanges_=e.sizes.map(function(e,t){return new ol.TileRange(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1))},this):r&&this.calculateTileRanges_(r)};ol.tilegrid.TileGrid.tmpTileCoord_=[0,0,0];ol.tilegrid.TileGrid.prototype.forEachTileCoord=function(e,t,o){for(var r=(e=this.getTileRangeForExtentAndZ(e,t)).minX,n=e.maxX;r<=n;++r)for(var i=e.minY,a=e.maxY;i<=a;++i)o([t,r,i])};ol.tilegrid.TileGrid.prototype.forEachTileCoordParentTileRange=function(e,t,o,r,n){var i=null,a=e[0]-1;if(2===this.zoomFactor_)var s=e[1],l=e[2];else i=this.getTileCoordExtent(e,n);for(;a>=this.minZoom;){2===this.zoomFactor_?(s=Math.floor(s/2),l=Math.floor(l/2),e=ol.TileRange.createOrUpdate(s,s,l,l,r)):e=this.getTileRangeForExtentAndZ(i,a,r);if(t.call(o,a,e))return!0;--a}return!1};ol.tilegrid.TileGrid.prototype.getExtent=function(){return this.extent_};ol.tilegrid.TileGrid.prototype.getMaxZoom=function(){return this.maxZoom};ol.tilegrid.TileGrid.prototype.getMinZoom=function(){return this.minZoom};ol.tilegrid.TileGrid.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]};ol.tilegrid.TileGrid.prototype.getResolution=function(e){return this.resolutions_[e]};ol.tilegrid.TileGrid.prototype.getResolutions=function(){return this.resolutions_};ol.tilegrid.TileGrid.prototype.getTileCoordChildTileRange=function(e,t,o){if(e[0]<this.maxZoom){if(2===this.zoomFactor_)return o=2*e[1],e=2*e[2],ol.TileRange.createOrUpdate(o,o+1,e,e+1,t);o=this.getTileCoordExtent(e,o);return this.getTileRangeForExtentAndZ(o,e[0]+1,t)}return null};ol.tilegrid.TileGrid.prototype.getTileRangeExtent=function(e,t,o){var r=this.getOrigin(e),n=this.getResolution(e);e=ol.size.toSize(this.getTileSize(e),this.tmpSize_);return ol.extent.createOrUpdate(r[0]+t.minX*e[0]*n,r[1]+t.minY*e[1]*n,r[0]+(t.maxX+1)*e[0]*n,r[1]+(t.maxY+1)*e[1]*n,o)};ol.tilegrid.TileGrid.prototype.getTileRangeForExtentAndZ=function(e,t,o){var r=ol.tilegrid.TileGrid.tmpTileCoord_;this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r);var n=r[1],i=r[2];this.getTileCoordForXYAndZ_(e[2],e[3],t,!0,r);return ol.TileRange.createOrUpdate(n,r[1],i,r[2],o)};ol.tilegrid.TileGrid.prototype.getTileCoordCenter=function(e){var t=this.getOrigin(e[0]),o=this.getResolution(e[0]),r=ol.size.toSize(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*o,t[1]+(e[2]+.5)*r[1]*o]};ol.tilegrid.TileGrid.prototype.getTileCoordExtent=function(e,t){var o=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=ol.size.toSize(this.getTileSize(e[0]),this.tmpSize_),i=o[0]+e[1]*n[0]*r;e=o[1]+e[2]*n[1]*r;return ol.extent.createOrUpdate(i,e,i+n[0]*r,e+n[1]*r,t)};ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndResolution=function(e,t,o){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,o)};ol.tilegrid.TileGrid.prototype.getTileCoordForXYAndResolution_=function(e,t,o,r,n){var i=this.getZForResolution(o),a=o/this.getResolution(i),s=this.getOrigin(i),l=ol.size.toSize(this.getTileSize(i),this.tmpSize_);e=a*Math.floor((e-s[0])/o+(r?.5:0))/l[0];t=a*Math.floor((t-s[1])/o+(r?0:.5))/l[1];r?(e=Math.ceil(e)-1,t=Math.ceil(t)-1):(e=Math.floor(e),t=Math.floor(t));return ol.tilecoord.createOrUpdate(i,e,t,n)};ol.tilegrid.TileGrid.prototype.getTileCoordForXYAndZ_=function(e,t,o,r,n){var i=this.getOrigin(o),a=this.getResolution(o),s=ol.size.toSize(this.getTileSize(o),this.tmpSize_);e=Math.floor((e-i[0])/a+(r?.5:0))/s[0];t=Math.floor((t-i[1])/a+(r?0:.5))/s[1];r?(e=Math.ceil(e)-1,t=Math.ceil(t)-1):(e=Math.floor(e),t=Math.floor(t));return ol.tilecoord.createOrUpdate(o,e,t,n)};ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndZ=function(e,t,o){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,o)};ol.tilegrid.TileGrid.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]};ol.tilegrid.TileGrid.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]};ol.tilegrid.TileGrid.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:null};ol.tilegrid.TileGrid.prototype.getZForResolution=function(e,t){e=ol.array.linearFindNearest(this.resolutions_,e,t||0);return ol.math.clamp(e,this.minZoom,this.maxZoom)};ol.tilegrid.TileGrid.prototype.calculateTileRanges_=function(e){for(var t=this.resolutions_.length,o=Array(t),r=this.minZoom;r<t;++r)o[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=o};ol.tilegrid.getForProjection=function(e){var t=e.getDefaultTileGrid();t||(t=ol.tilegrid.createForProjection(e),e.setDefaultTileGrid(t));return t};ol.tilegrid.wrapX=function(e,t,o){var r=t[0],n=e.getTileCoordCenter(t);o=ol.tilegrid.extentFromProjection(o);if(ol.extent.containsCoordinate(o,n))return t;t=ol.extent.getWidth(o);n[0]+=t*Math.ceil((o[0]-n[0])/t);return e.getTileCoordForCoordAndZ(n,r)};ol.tilegrid.createForExtent=function(e,t,o,r){r=void 0!==r?r:ol.extent.Corner.TOP_LEFT;t=ol.tilegrid.resolutionsFromExtent(e,t,o);return new ol.tilegrid.TileGrid({extent:e,origin:ol.extent.getCorner(e,r),resolutions:t,tileSize:o})};ol.tilegrid.createXYZ=function(e){var t={};ol.obj.assign(t,void 0!==e?e:{});void 0===t.extent&&(t.extent=ol.proj.get("EPSG:3857").getExtent());t.resolutions=ol.tilegrid.resolutionsFromExtent(t.extent,t.maxZoom,t.tileSize);delete t.maxZoom;return new ol.tilegrid.TileGrid(t)};ol.tilegrid.resolutionsFromExtent=function(e,t,o){t=void 0!==t?t:ol.DEFAULT_MAX_ZOOM;var r=ol.extent.getHeight(e);e=ol.extent.getWidth(e);o=ol.size.toSize(void 0!==o?o:ol.DEFAULT_TILE_SIZE);o=Math.max(e/o[0],r/o[1]);t+=1;r=Array(t);for(e=0;e<t;++e)r[e]=o/Math.pow(2,e);return r};ol.tilegrid.createForProjection=function(e,t,o,r){e=ol.tilegrid.extentFromProjection(e);return ol.tilegrid.createForExtent(e,t,o,r)};ol.tilegrid.extentFromProjection=function(e){var t=(e=ol.proj.get(e)).getExtent();t||(e=180*ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES]/e.getMetersPerUnit(),t=ol.extent.createOrUpdate(-e,-e,e,e));return t};ol.Attribution=function(e){this.html_=e.html;this.tileRanges_=e.tileRanges?e.tileRanges:null};ol.Attribution.prototype.getHTML=function(){return this.html_};ol.Attribution.prototype.intersectsAnyTileRange=function(e,t,o){if(!this.tileRanges_)return!0;var r,n;for(n in e)if(n in this.tileRanges_){var i=e[n],a=0;for(r=this.tileRanges_[n].length;a<r;++a){var s=this.tileRanges_[n][a];if(s.intersects(i))return!0;var l=t.getTileRangeForExtentAndZ(ol.tilegrid.extentFromProjection(o),parseInt(n,10)),c=l.getWidth();if((i.minX<l.minX||i.maxX>l.maxX)&&(s.intersects(new ol.TileRange(ol.math.modulo(i.minX,c),ol.math.modulo(i.maxX,c),i.minY,i.maxY))||i.getWidth()>c&&s.intersects(l)))return!0}}return!1};ol.CollectionEventType={ADD:"add",REMOVE:"remove"};ol.ObjectEventType={PROPERTYCHANGE:"propertychange"};ol.events={};ol.events.bindListener_=function(e){return e.boundListener=function(t){var o=e.listener,r=e.bindTo||e.target;e.callOnce&&ol.events.unlistenByKey(e);return o.call(r,t)}};ol.events.findListener_=function(e,t,o,r){for(var n,i=0,a=e.length;i<a;++i)if((n=e[i]).listener===t&&n.bindTo===o)return r&&(n.deleteIndex=i),n};ol.events.getListeners=function(e,t){return(e=e.ol_lm)?e[t]:void 0};ol.events.getListenerMap_=function(e){var t=e.ol_lm;t||(t=e.ol_lm={});return t};ol.events.removeListeners_=function(e,t){var o=ol.events.getListeners(e,t);if(o){for(var r=0,n=o.length;r<n;++r)e.removeEventListener(t,o[r].boundListener),ol.obj.clear(o[r]);o.length=0;(o=e.ol_lm)&&(delete o[t],0===Object.keys(o).length&&delete e.ol_lm)}};ol.events.listen=function(e,t,o,r,n){var i=ol.events.getListenerMap_(e),a=i[t];a||(a=i[t]=[]);(i=ol.events.findListener_(a,o,r,!1))?n||(i.callOnce=!1):(i={bindTo:r,callOnce:!!n,listener:o,target:e,type:t},e.addEventListener(t,ol.events.bindListener_(i)),a.push(i));return i};ol.events.listenOnce=function(e,t,o,r){return ol.events.listen(e,t,o,r,!0)};ol.events.unlisten=function(e,t,o,r){(e=ol.events.getListeners(e,t))&&(o=ol.events.findListener_(e,o,r,!0))&&ol.events.unlistenByKey(o)};ol.events.unlistenByKey=function(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);var t=ol.events.getListeners(e.target,e.type);if(t){var o="deleteIndex"in e?e.deleteIndex:t.indexOf(e);-1!==o&&t.splice(o,1);0===t.length&&ol.events.removeListeners_(e.target,e.type)}ol.obj.clear(e)}};ol.events.unlistenAll=function(e){var t,o=ol.events.getListenerMap_(e);for(t in o)ol.events.removeListeners_(e,t)};ol.Disposable=function(){};ol.Disposable.prototype.disposed_=!1;ol.Disposable.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())};ol.Disposable.prototype.disposeInternal=ol.nullFunction;ol.events.Event=function(e){this.type=e;this.target=null};ol.events.Event.prototype.preventDefault=ol.events.Event.prototype.stopPropagation=function(){this.propagationStopped=!0};ol.events.Event.stopPropagation=function(e){e.stopPropagation()};ol.events.Event.preventDefault=function(e){e.preventDefault()};ol.events.EventTarget=function(){ol.Disposable.call(this);this.pendingRemovals_={};this.dispatching_={};this.listeners_={}};ol.inherits(ol.events.EventTarget,ol.Disposable);ol.events.EventTarget.prototype.addEventListener=function(e,t){var o=this.listeners_[e];o||(o=this.listeners_[e]=[]);-1===o.indexOf(t)&&o.push(t)};ol.events.EventTarget.prototype.dispatchEvent=function(e){var t="string"==typeof e?new ol.events.Event(e):e;e=t.type;t.target=this;var o=this.listeners_[e];if(o){e in this.dispatching_||(this.dispatching_[e]=0,this.pendingRemovals_[e]=0);++this.dispatching_[e];for(var r=0,n=o.length;r<n;++r)if(!1===o[r].call(this,t)||t.propagationStopped){var i=!1;break}--this.dispatching_[e];if(0===this.dispatching_[e]){t=this.pendingRemovals_[e];for(delete this.pendingRemovals_[e];t--;)this.removeEventListener(e,ol.nullFunction);delete this.dispatching_[e]}return i}};ol.events.EventTarget.prototype.disposeInternal=function(){ol.events.unlistenAll(this)};ol.events.EventTarget.prototype.getListeners=function(e){return this.listeners_[e]};ol.events.EventTarget.prototype.hasListener=function(e){return e?e in this.listeners_:0<Object.keys(this.listeners_).length};ol.events.EventTarget.prototype.removeEventListener=function(e,t){var o=this.listeners_[e];o&&(t=o.indexOf(t),e in this.pendingRemovals_?(o[t]=ol.nullFunction,++this.pendingRemovals_[e]):(o.splice(t,1),0===o.length&&delete this.listeners_[e]))};ol.events.EventType={CHANGE:"change",CLEAR:"clear",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"};ol.Observable=function(){ol.events.EventTarget.call(this);this.revision_=0};ol.inherits(ol.Observable,ol.events.EventTarget);ol.Observable.unByKey=function(e){if(Array.isArray(e))for(var t=0,o=e.length;t<o;++t)ol.events.unlistenByKey(e[t]);else ol.events.unlistenByKey(e)};ol.Observable.prototype.changed=function(){++this.revision_;this.dispatchEvent(ol.events.EventType.CHANGE)};ol.Observable.prototype.getRevision=function(){return this.revision_};ol.Observable.prototype.on=function(e,t,o){if(Array.isArray(e)){for(var r=e.length,n=Array(r),i=0;i<r;++i)n[i]=ol.events.listen(this,e[i],t,o);return n}return ol.events.listen(this,e,t,o)};ol.Observable.prototype.once=function(e,t,o){if(Array.isArray(e)){for(var r=e.length,n=Array(r),i=0;i<r;++i)n[i]=ol.events.listenOnce(this,e[i],t,o);return n}return ol.events.listenOnce(this,e,t,o)};ol.Observable.prototype.un=function(e,t,o){if(Array.isArray(e))for(var r=0,n=e.length;r<n;++r)ol.events.unlisten(this,e[r],t,o);else ol.events.unlisten(this,e,t,o)};ol.Object=function(e){ol.Observable.call(this);ol.getUid(this);this.values_={};void 0!==e&&this.setProperties(e)};ol.inherits(ol.Object,ol.Observable);ol.Object.changeEventTypeCache_={};ol.Object.getChangeEventType=function(e){return ol.Object.changeEventTypeCache_.hasOwnProperty(e)?ol.Object.changeEventTypeCache_[e]:ol.Object.changeEventTypeCache_[e]="change:"+e};ol.Object.prototype.get=function(e){var t;this.values_.hasOwnProperty(e)&&(t=this.values_[e]);return t};ol.Object.prototype.getKeys=function(){return Object.keys(this.values_)};ol.Object.prototype.getProperties=function(){return ol.obj.assign({},this.values_)};ol.Object.prototype.notify=function(e,t){var o=ol.Object.getChangeEventType(e);this.dispatchEvent(new ol.Object.Event(o,e,t));o=ol.ObjectEventType.PROPERTYCHANGE;this.dispatchEvent(new ol.Object.Event(o,e,t))};ol.Object.prototype.set=function(e,t,o){o?this.values_[e]=t:(o=this.values_[e],this.values_[e]=t,o!==t&&this.notify(e,o))};ol.Object.prototype.setProperties=function(e,t){for(var o in e)this.set(o,e[o],t)};ol.Object.prototype.unset=function(e,t){if(e in this.values_){var o=this.values_[e];delete this.values_[e];t||this.notify(e,o)}};ol.Object.Event=function(e,t,o){ol.events.Event.call(this,e);this.key=t;this.oldValue=o};ol.inherits(ol.Object.Event,ol.events.Event);ol.Collection=function(e,t){ol.Object.call(this);this.unique_=!!(t||{}).unique;this.array_=e||[];if(this.unique_)for(e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()};ol.inherits(ol.Collection,ol.Object);ol.Collection.prototype.clear=function(){for(;0<this.getLength();)this.pop()};ol.Collection.prototype.extend=function(e){var t,o=0;for(t=e.length;o<t;++o)this.push(e[o]);return this};ol.Collection.prototype.forEach=function(e,t){e=t?e.bind(t):e;for(var o=0,r=(t=this.array_).length;o<r;++o)e(t[o],o,t)};ol.Collection.prototype.getArray=function(){return this.array_};ol.Collection.prototype.item=function(e){return this.array_[e]};ol.Collection.prototype.getLength=function(){return this.get(ol.Collection.Property_.LENGTH)};ol.Collection.prototype.insertAt=function(e,t){this.unique_&&this.assertUnique_(t);this.array_.splice(e,0,t);this.updateLength_();this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.ADD,t))};ol.Collection.prototype.pop=function(){return this.removeAt(this.getLength()-1)};ol.Collection.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var t=this.getLength();this.insertAt(t,e);return this.getLength()};ol.Collection.prototype.remove=function(e){var t,o=this.array_,r=0;for(t=o.length;r<t;++r)if(o[r]===e)return this.removeAt(r)};ol.Collection.prototype.removeAt=function(e){var t=this.array_[e];this.array_.splice(e,1);this.updateLength_();this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.REMOVE,t));return t};ol.Collection.prototype.setAt=function(e,t){var o=this.getLength();if(e<o)this.unique_&&this.assertUnique_(t,e),o=this.array_[e],this.array_[e]=t,this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.REMOVE,o)),this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.ADD,t));else{for(;o<e;++o)this.insertAt(o,void 0);this.insertAt(e,t)}};ol.Collection.prototype.updateLength_=function(){this.set(ol.Collection.Property_.LENGTH,this.array_.length)};ol.Collection.prototype.assertUnique_=function(e,t){for(var o=0,r=this.array_.length;o<r;++o)if(this.array_[o]===e&&o!==t)throw new ol.AssertionError(58)};ol.Collection.Property_={LENGTH:"length"};ol.Collection.Event=function(e,t){ol.events.Event.call(this,e);this.element=t};ol.inherits(ol.Collection.Event,ol.events.Event);ol.MapEvent=function(e,t,o){ol.events.Event.call(this,e);this.map=t;this.frameState=void 0!==o?o:null};ol.inherits(ol.MapEvent,ol.events.Event);ol.MapBrowserEvent=function(e,t,o,r,n){ol.MapEvent.call(this,e,t,n);this.originalEvent=o;this.pixel=t.getEventPixel(o);this.coordinate=t.getCoordinateFromPixel(this.pixel);this.dragging=void 0!==r&&r};ol.inherits(ol.MapBrowserEvent,ol.MapEvent);ol.MapBrowserEvent.prototype.preventDefault=function(){ol.MapEvent.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};ol.MapBrowserEvent.prototype.stopPropagation=function(){ol.MapEvent.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};ol.webgl={};ol.webgl.ONE=1;ol.webgl.SRC_ALPHA=770;ol.webgl.COLOR_ATTACHMENT0=36064;ol.webgl.COLOR_BUFFER_BIT=16384;ol.webgl.TRIANGLES=4;ol.webgl.TRIANGLE_STRIP=5;ol.webgl.ONE_MINUS_SRC_ALPHA=771;ol.webgl.ARRAY_BUFFER=34962;ol.webgl.ELEMENT_ARRAY_BUFFER=34963;ol.webgl.STREAM_DRAW=35040;ol.webgl.STATIC_DRAW=35044;ol.webgl.DYNAMIC_DRAW=35048;ol.webgl.CULL_FACE=2884;ol.webgl.BLEND=3042;ol.webgl.STENCIL_TEST=2960;ol.webgl.DEPTH_TEST=2929;ol.webgl.SCISSOR_TEST=3089;ol.webgl.UNSIGNED_BYTE=5121;ol.webgl.UNSIGNED_SHORT=5123;ol.webgl.UNSIGNED_INT=5125;ol.webgl.FLOAT=5126;ol.webgl.RGBA=6408;ol.webgl.FRAGMENT_SHADER=35632;ol.webgl.VERTEX_SHADER=35633;ol.webgl.LINK_STATUS=35714;ol.webgl.LINEAR=9729;ol.webgl.TEXTURE_MAG_FILTER=10240;ol.webgl.TEXTURE_MIN_FILTER=10241;ol.webgl.TEXTURE_WRAP_S=10242;ol.webgl.TEXTURE_WRAP_T=10243;ol.webgl.TEXTURE_2D=3553;ol.webgl.TEXTURE0=33984;ol.webgl.CLAMP_TO_EDGE=33071;ol.webgl.COMPILE_STATUS=35713;ol.webgl.FRAMEBUFFER=36160;ol.webgl.CONTEXT_IDS_=["experimental-webgl","webgl","webkit-3d","moz-webgl"];ol.webgl.getContext=function(e,t){var o,r,n=ol.webgl.CONTEXT_IDS_.length;for(r=0;r<n;++r)try{if(o=e.getContext(ol.webgl.CONTEXT_IDS_[r],t))return o}catch(e){}return null};ol.has={};var ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",QRCode;ol.has.FIREFOX=-1!==ua.indexOf("firefox");ol.has.SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom");ol.has.WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge");ol.has.MAC=-1!==ua.indexOf("macintosh");ol.has.DEVICE_PIXEL_RATIO=window.devicePixelRatio||1;ol.has.CANVAS_LINE_DASH=!1;ol.has.CANVAS=ol.ENABLE_CANVAS&&function(){if(!("HTMLCanvasElement"in window))return!1;try{var e=document.createElement("CANVAS").getContext("2d");return!!e&&(void 0!==e.setLineDash&&(ol.has.CANVAS_LINE_DASH=!0),!0)}catch(e){return!1}}();ol.has.DEVICE_ORIENTATION="DeviceOrientationEvent"in window;ol.has.GEOLOCATION="geolocation"in navigator;ol.has.TOUCH=ol.ASSUME_TOUCH||"ontouchstart"in window;ol.has.POINTER="PointerEvent"in window;ol.has.MSPOINTER=!!navigator.msPointerEnabled;!function(){if(ol.ENABLE_WEBGL){var e=!1,t=[];if("WebGLRenderingContext"in window)try{var o=document.createElement("CANVAS"),r=ol.webgl.getContext(o,{failIfMajorPerformanceCaveat:!0});if(r){e=!0;var n=r.getParameter(r.MAX_TEXTURE_SIZE);t=r.getSupportedExtensions()}}catch(e){}ol.has.WEBGL=e;ol.WEBGL_EXTENSIONS=t;ol.WEBGL_MAX_TEXTURE_SIZE=n}}();ol.MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:ol.events.EventType.CLICK,DBLCLICK:ol.events.EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};ol.MapBrowserPointerEvent=function(e,t,o,r,n){ol.MapBrowserEvent.call(this,e,t,o.originalEvent,r,n);this.pointerEvent=o};ol.inherits(ol.MapBrowserPointerEvent,ol.MapBrowserEvent);ol.pointer={};ol.pointer.EventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};ol.pointer.EventSource=function(e,t){this.dispatcher=e;this.mapping_=t};ol.pointer.EventSource.prototype.getEvents=function(){return Object.keys(this.mapping_)};ol.pointer.EventSource.prototype.getHandlerForEvent=function(e){return this.mapping_[e]};ol.pointer.MouseSource=function(e){ol.pointer.EventSource.call(this,e,{mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout});this.pointerMap=e.pointerMap;this.lastTouches=[]};ol.inherits(ol.pointer.MouseSource,ol.pointer.EventSource);ol.pointer.MouseSource.POINTER_ID=1;ol.pointer.MouseSource.POINTER_TYPE="mouse";ol.pointer.MouseSource.DEDUP_DIST=25;ol.pointer.MouseSource.prototype.isEventSimulatedFromTouch_=function(e){var t=this.lastTouches,o=e.clientX;e=e.clientY;for(var r,n=0,i=t.length;n<i&&(r=t[n]);n++){var a=Math.abs(e-r[1]);if(Math.abs(o-r[0])<=ol.pointer.MouseSource.DEDUP_DIST&&a<=ol.pointer.MouseSource.DEDUP_DIST)return!0}return!1};ol.pointer.MouseSource.prepareEvent=function(e,t){var o=(t=t.cloneEvent(e,e)).preventDefault;t.preventDefault=function(){e.preventDefault();o()};t.pointerId=ol.pointer.MouseSource.POINTER_ID;t.isPrimary=!0;t.pointerType=ol.pointer.MouseSource.POINTER_TYPE;return t};ol.pointer.MouseSource.prototype.mousedown=function(e){if(!this.isEventSimulatedFromTouch_(e)){ol.pointer.MouseSource.POINTER_ID.toString()in this.pointerMap&&this.cancel(e);var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()]=e;this.dispatcher.down(t,e)}};ol.pointer.MouseSource.prototype.mousemove=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.move(t,e)}};ol.pointer.MouseSource.prototype.mouseup=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()];t&&t.button===e.button&&(t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher),this.dispatcher.up(t,e),this.cleanupMouse())}};ol.pointer.MouseSource.prototype.mouseover=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.enterOver(t,e)}};ol.pointer.MouseSource.prototype.mouseout=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.leaveOut(t,e)}};ol.pointer.MouseSource.prototype.cancel=function(e){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.cancel(t,e);this.cleanupMouse()};ol.pointer.MouseSource.prototype.cleanupMouse=function(){delete this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()]};ol.pointer.MsSource=function(e){ol.pointer.EventSource.call(this,e,{MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture});this.pointerMap=e.pointerMap;this.POINTER_TYPES=["","unavailable","touch","pen","mouse"]};ol.inherits(ol.pointer.MsSource,ol.pointer.EventSource);ol.pointer.MsSource.prototype.prepareEvent_=function(e){var t=e;"number"==typeof e.pointerType&&((t=this.dispatcher.cloneEvent(e,e)).pointerType=this.POINTER_TYPES[e.pointerType]);return t};ol.pointer.MsSource.prototype.cleanup=function(e){delete this.pointerMap[e.toString()]};ol.pointer.MsSource.prototype.msPointerDown=function(e){this.pointerMap[e.pointerId.toString()]=e;var t=this.prepareEvent_(e);this.dispatcher.down(t,e)};ol.pointer.MsSource.prototype.msPointerMove=function(e){var t=this.prepareEvent_(e);this.dispatcher.move(t,e)};ol.pointer.MsSource.prototype.msPointerUp=function(e){var t=this.prepareEvent_(e);this.dispatcher.up(t,e);this.cleanup(e.pointerId)};ol.pointer.MsSource.prototype.msPointerOut=function(e){var t=this.prepareEvent_(e);this.dispatcher.leaveOut(t,e)};ol.pointer.MsSource.prototype.msPointerOver=function(e){var t=this.prepareEvent_(e);this.dispatcher.enterOver(t,e)};ol.pointer.MsSource.prototype.msPointerCancel=function(e){var t=this.prepareEvent_(e);this.dispatcher.cancel(t,e);this.cleanup(e.pointerId)};ol.pointer.MsSource.prototype.msLostPointerCapture=function(e){e=this.dispatcher.makeEvent("lostpointercapture",e,e);this.dispatcher.dispatchEvent(e)};ol.pointer.MsSource.prototype.msGotPointerCapture=function(e){e=this.dispatcher.makeEvent("gotpointercapture",e,e);this.dispatcher.dispatchEvent(e)};ol.pointer.NativeSource=function(e){ol.pointer.EventSource.call(this,e,{pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture})};ol.inherits(ol.pointer.NativeSource,ol.pointer.EventSource);ol.pointer.NativeSource.prototype.pointerDown=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerMove=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerUp=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerOut=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerOver=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerCancel=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.lostPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.gotPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.PointerEvent=function(e,t,o){ol.events.Event.call(this,e);this.originalEvent=t;e=o||{};this.buttons=this.getButtons_(e);this.pressure=this.getPressure_(e,this.buttons);this.bubbles="bubbles"in e&&e.bubbles;this.cancelable="cancelable"in e&&e.cancelable;this.view="view"in e?e.view:null;this.detail="detail"in e?e.detail:null;this.screenX="screenX"in e?e.screenX:0;this.screenY="screenY"in e?e.screenY:0;this.clientX="clientX"in e?e.clientX:0;this.clientY="clientY"in e?e.clientY:0;this.ctrlKey="ctrlKey"in e&&e.ctrlKey;this.altKey="altKey"in e&&e.altKey;this.shiftKey="shiftKey"in e&&e.shiftKey;this.metaKey="metaKey"in e&&e.metaKey;this.button="button"in e?e.button:0;this.relatedTarget="relatedTarget"in e?e.relatedTarget:null;this.pointerId="pointerId"in e?e.pointerId:0;this.width="width"in e?e.width:0;this.height="height"in e?e.height:0;this.tiltX="tiltX"in e?e.tiltX:0;this.tiltY="tiltY"in e?e.tiltY:0;this.pointerType="pointerType"in e?e.pointerType:"";this.hwTimestamp="hwTimestamp"in e?e.hwTimestamp:0;this.isPrimary="isPrimary"in e&&e.isPrimary;t.preventDefault&&(this.preventDefault=function(){t.preventDefault()})};ol.inherits(ol.pointer.PointerEvent,ol.events.Event);ol.pointer.PointerEvent.prototype.getButtons_=function(e){if(e.buttons||ol.pointer.PointerEvent.HAS_BUTTONS)e=e.buttons;else switch(e.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e};ol.pointer.PointerEvent.prototype.getPressure_=function(e,t){return e.pressure?e.pressure:t?.5:0};ol.pointer.PointerEvent.HAS_BUTTONS=!1;!function(){try{var e=new MouseEvent("click",{buttons:1});ol.pointer.PointerEvent.HAS_BUTTONS=1===e.buttons}catch(e){}}();ol.pointer.TouchSource=function(e,t){ol.pointer.EventSource.call(this,e,{touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel});this.pointerMap=e.pointerMap;this.mouseSource=t;this.firstTouchId_=void 0;this.clickCount_=0;this.resetId_=void 0};ol.inherits(ol.pointer.TouchSource,ol.pointer.EventSource);ol.pointer.TouchSource.DEDUP_TIMEOUT=2500;ol.pointer.TouchSource.CLICK_COUNT_TIMEOUT=200;ol.pointer.TouchSource.POINTER_TYPE="touch";ol.pointer.TouchSource.prototype.isPrimaryTouch_=function(e){return this.firstTouchId_===e.identifier};ol.pointer.TouchSource.prototype.setPrimaryTouch_=function(e){var t=Object.keys(this.pointerMap).length;(0===t||1===t&&ol.pointer.MouseSource.POINTER_ID.toString()in this.pointerMap)&&(this.firstTouchId_=e.identifier,this.cancelResetClickCount_())};ol.pointer.TouchSource.prototype.removePrimaryPointer_=function(e){e.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())};ol.pointer.TouchSource.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),ol.pointer.TouchSource.CLICK_COUNT_TIMEOUT)};ol.pointer.TouchSource.prototype.resetClickCountHandler_=function(){this.clickCount_=0;this.resetId_=void 0};ol.pointer.TouchSource.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)};ol.pointer.TouchSource.prototype.touchToPointer_=function(e,t){(e=this.dispatcher.cloneEvent(e,t)).pointerId=t.identifier+2;e.bubbles=!0;e.cancelable=!0;e.detail=this.clickCount_;e.button=0;e.buttons=1;e.width=t.webkitRadiusX||t.radiusX||0;e.height=t.webkitRadiusY||t.radiusY||0;e.pressure=t.webkitForce||t.force||.5;e.isPrimary=this.isPrimaryTouch_(t);e.pointerType=ol.pointer.TouchSource.POINTER_TYPE;e.clientX=t.clientX;e.clientY=t.clientY;e.screenX=t.screenX;e.screenY=t.screenY;return e};ol.pointer.TouchSource.prototype.processTouches_=function(e,t){function o(){e.preventDefault()}var r,n=Array.prototype.slice.call(e.changedTouches),i=n.length;for(r=0;r<i;++r){var a=this.touchToPointer_(e,n[r]);a.preventDefault=o;t.call(this,e,a)}};ol.pointer.TouchSource.prototype.findTouch_=function(e,t){for(var o=e.length,r=0;r<o;r++)if(e[r].identifier===t)return!0;return!1};ol.pointer.TouchSource.prototype.vacuumTouches_=function(e){var t=e.touches,o=Object.keys(this.pointerMap),r=o.length;if(r>=t.length){var n,i=[];for(n=0;n<r;++n){var a=o[n],s=this.pointerMap[a];a==ol.pointer.MouseSource.POINTER_ID||this.findTouch_(t,a-2)||i.push(s.out)}for(n=0;n<i.length;++n)this.cancelOut_(e,i[n])}};ol.pointer.TouchSource.prototype.touchstart=function(e){this.vacuumTouches_(e);this.setPrimaryTouch_(e.changedTouches[0]);this.dedupSynthMouse_(e);this.clickCount_++;this.processTouches_(e,this.overDown_)};ol.pointer.TouchSource.prototype.overDown_=function(e,t){this.pointerMap[t.pointerId]={target:t.target,out:t,outTarget:t.target};this.dispatcher.over(t,e);this.dispatcher.enter(t,e);this.dispatcher.down(t,e)};ol.pointer.TouchSource.prototype.touchmove=function(e){e.preventDefault();this.processTouches_(e,this.moveOverOut_)};ol.pointer.TouchSource.prototype.moveOverOut_=function(e,t){var o=this.pointerMap[t.pointerId];if(o){var r=o.out,n=o.outTarget;this.dispatcher.move(t,e);r&&n!==t.target&&(r.relatedTarget=t.target,t.relatedTarget=n,r.target=n,t.target?(this.dispatcher.leaveOut(r,e),this.dispatcher.enterOver(t,e)):(t.target=n,t.relatedTarget=null,this.cancelOut_(e,t)));o.out=t;o.outTarget=t.target}};ol.pointer.TouchSource.prototype.touchend=function(e){this.dedupSynthMouse_(e);this.processTouches_(e,this.upOut_)};ol.pointer.TouchSource.prototype.upOut_=function(e,t){this.dispatcher.up(t,e);this.dispatcher.out(t,e);this.dispatcher.leave(t,e);this.cleanUpPointer_(t)};ol.pointer.TouchSource.prototype.touchcancel=function(e){this.processTouches_(e,this.cancelOut_)};ol.pointer.TouchSource.prototype.cancelOut_=function(e,t){this.dispatcher.cancel(t,e);this.dispatcher.out(t,e);this.dispatcher.leave(t,e);this.cleanUpPointer_(t)};ol.pointer.TouchSource.prototype.cleanUpPointer_=function(e){delete this.pointerMap[e.pointerId];this.removePrimaryPointer_(e)};ol.pointer.TouchSource.prototype.dedupSynthMouse_=function(e){var t=this.mouseSource.lastTouches;e=e.changedTouches[0];if(this.isPrimaryTouch_(e)){var o=[e.clientX,e.clientY];t.push(o);setTimeout(function(){ol.array.remove(t,o)},ol.pointer.TouchSource.DEDUP_TIMEOUT)}};ol.pointer.PointerEventHandler=function(e){ol.events.EventTarget.call(this);this.element_=e;this.pointerMap={};this.eventMap_={};this.eventSourceList_=[];this.registerSources()};ol.inherits(ol.pointer.PointerEventHandler,ol.events.EventTarget);ol.pointer.PointerEventHandler.prototype.registerSources=function(){if(ol.has.POINTER)this.registerSource("native",new ol.pointer.NativeSource(this));else if(ol.has.MSPOINTER)this.registerSource("ms",new ol.pointer.MsSource(this));else{var e=new ol.pointer.MouseSource(this);this.registerSource("mouse",e);ol.has.TOUCH&&this.registerSource("touch",new ol.pointer.TouchSource(this,e))}this.register_()};ol.pointer.PointerEventHandler.prototype.registerSource=function(e,t){(e=t.getEvents())&&(e.forEach(function(e){var o=t.getHandlerForEvent(e);o&&(this.eventMap_[e]=o.bind(t))},this),this.eventSourceList_.push(t))};ol.pointer.PointerEventHandler.prototype.register_=function(){for(var e,t=this.eventSourceList_.length,o=0;o<t;o++)e=this.eventSourceList_[o],this.addEvents_(e.getEvents())};ol.pointer.PointerEventHandler.prototype.unregister_=function(){for(var e,t=this.eventSourceList_.length,o=0;o<t;o++)e=this.eventSourceList_[o],this.removeEvents_(e.getEvents())};ol.pointer.PointerEventHandler.prototype.eventHandler_=function(e){var t=this.eventMap_[e.type];t&&t(e)};ol.pointer.PointerEventHandler.prototype.addEvents_=function(e){e.forEach(function(e){ol.events.listen(this.element_,e,this.eventHandler_,this)},this)};ol.pointer.PointerEventHandler.prototype.removeEvents_=function(e){e.forEach(function(e){ol.events.unlisten(this.element_,e,this.eventHandler_,this)},this)};ol.pointer.PointerEventHandler.prototype.cloneEvent=function(e,t){for(var o,r={},n=0,i=ol.pointer.PointerEventHandler.CLONE_PROPS.length;n<i;n++)r[o=ol.pointer.PointerEventHandler.CLONE_PROPS[n][0]]=e[o]||t[o]||ol.pointer.PointerEventHandler.CLONE_PROPS[n][1];return r};ol.pointer.PointerEventHandler.prototype.down=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERDOWN,e,t)};ol.pointer.PointerEventHandler.prototype.move=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERMOVE,e,t)};ol.pointer.PointerEventHandler.prototype.up=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERUP,e,t)};ol.pointer.PointerEventHandler.prototype.enter=function(e,t){e.bubbles=!1;this.fireEvent(ol.pointer.EventType.POINTERENTER,e,t)};ol.pointer.PointerEventHandler.prototype.leave=function(e,t){e.bubbles=!1;this.fireEvent(ol.pointer.EventType.POINTERLEAVE,e,t)};ol.pointer.PointerEventHandler.prototype.over=function(e,t){e.bubbles=!0;this.fireEvent(ol.pointer.EventType.POINTEROVER,e,t)};ol.pointer.PointerEventHandler.prototype.out=function(e,t){e.bubbles=!0;this.fireEvent(ol.pointer.EventType.POINTEROUT,e,t)};ol.pointer.PointerEventHandler.prototype.cancel=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERCANCEL,e,t)};ol.pointer.PointerEventHandler.prototype.leaveOut=function(e,t){this.out(e,t);this.contains_(e.target,e.relatedTarget)||this.leave(e,t)};ol.pointer.PointerEventHandler.prototype.enterOver=function(e,t){this.over(e,t);this.contains_(e.target,e.relatedTarget)||this.enter(e,t)};ol.pointer.PointerEventHandler.prototype.contains_=function(e,t){return!(!e||!t)&&e.contains(t)};ol.pointer.PointerEventHandler.prototype.makeEvent=function(e,t,o){return new ol.pointer.PointerEvent(e,o,t)};ol.pointer.PointerEventHandler.prototype.fireEvent=function(e,t,o){e=this.makeEvent(e,t,o);this.dispatchEvent(e)};ol.pointer.PointerEventHandler.prototype.fireNativeEvent=function(e){e=this.makeEvent(e.type,e,e);this.dispatchEvent(e)};ol.pointer.PointerEventHandler.prototype.wrapMouseEvent=function(e,t){return this.makeEvent(e,ol.pointer.MouseSource.prepareEvent(t,this),t)};ol.pointer.PointerEventHandler.prototype.disposeInternal=function(){this.unregister_();ol.events.EventTarget.prototype.disposeInternal.call(this)};ol.pointer.PointerEventHandler.CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];ol.MapBrowserEventHandler=function(e,t){ol.events.EventTarget.call(this);this.map_=e;this.clickTimeoutId_=0;this.dragging_=!1;this.dragListenerKeys_=[];this.moveTolerance_=t?t*ol.has.DEVICE_PIXEL_RATIO:ol.has.DEVICE_PIXEL_RATIO;this.down_=null;e=this.map_.getViewport();this.activePointers_=0;this.trackedTouches_={};this.pointerEventHandler_=new ol.pointer.PointerEventHandler(e);this.documentPointerEventHandler_=null;this.pointerdownListenerKey_=ol.events.listen(this.pointerEventHandler_,ol.pointer.EventType.POINTERDOWN,this.handlePointerDown_,this);this.relayedListenerKey_=ol.events.listen(this.pointerEventHandler_,ol.pointer.EventType.POINTERMOVE,this.relayEvent_,this)};ol.inherits(ol.MapBrowserEventHandler,ol.events.EventTarget);ol.MapBrowserEventHandler.prototype.emulateClick_=function(e){var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.CLICK,this.map_,e);this.dispatchEvent(t);0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0,t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=0;var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)};ol.MapBrowserEventHandler.prototype.updateActivePointers_=function(e){e.type==ol.MapBrowserEventType.POINTERUP||e.type==ol.MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==ol.MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0);this.activePointers_=Object.keys(this.trackedTouches_).length};ol.MapBrowserEventHandler.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERUP,this.map_,e);this.dispatchEvent(t);t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_);0===this.activePointers_&&(this.dragListenerKeys_.forEach(ol.events.unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)};ol.MapBrowserEventHandler.prototype.isMouseActionButton_=function(e){return 0===e.button};ol.MapBrowserEventHandler.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERDOWN,this.map_,e);this.dispatchEvent(t);this.down_=e;0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new ol.pointer.PointerEventHandler(document),this.dragListenerKeys_.push(ol.events.listen(this.documentPointerEventHandler_,ol.MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),ol.events.listen(this.documentPointerEventHandler_,ol.MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),ol.events.listen(this.pointerEventHandler_,ol.MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)))};ol.MapBrowserEventHandler.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(t)}e.preventDefault()};ol.MapBrowserEventHandler.prototype.relayEvent_=function(e){var t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new ol.MapBrowserPointerEvent(e.type,this.map_,e,t))};ol.MapBrowserEventHandler.prototype.isMoving_=function(e){return Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_};ol.MapBrowserEventHandler.prototype.disposeInternal=function(){this.relayedListenerKey_&&(ol.events.unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null);this.pointerdownListenerKey_&&(ol.events.unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null);this.dragListenerKeys_.forEach(ol.events.unlistenByKey);this.dragListenerKeys_.length=0;this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null);this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null);ol.events.EventTarget.prototype.disposeInternal.call(this)};ol.MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"};ol.MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};ol.TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};ol.structs={};ol.structs.PriorityQueue=function(e,t){this.priorityFunction_=e;this.keyFunction_=t;this.elements_=[];this.priorities_=[];this.queuedElements_={}};ol.structs.PriorityQueue.DROP=1/0;ol.structs.PriorityQueue.prototype.clear=function(){this.elements_.length=0;this.priorities_.length=0;ol.obj.clear(this.queuedElements_)};ol.structs.PriorityQueue.prototype.dequeue=function(){var e=this.elements_,t=this.priorities_,o=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));e=this.keyFunction_(o);delete this.queuedElements_[e];return o};ol.structs.PriorityQueue.prototype.enqueue=function(e){ol.asserts.assert(!(this.keyFunction_(e)in this.queuedElements_),31);var t=this.priorityFunction_(e);return t!=ol.structs.PriorityQueue.DROP&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)};ol.structs.PriorityQueue.prototype.getCount=function(){return this.elements_.length};ol.structs.PriorityQueue.prototype.getLeftChildIndex_=function(e){return 2*e+1};ol.structs.PriorityQueue.prototype.getRightChildIndex_=function(e){return 2*e+2};ol.structs.PriorityQueue.prototype.getParentIndex_=function(e){return e-1>>1};ol.structs.PriorityQueue.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;0<=e;e--)this.siftUp_(e)};ol.structs.PriorityQueue.prototype.isEmpty=function(){return 0===this.elements_.length};ol.structs.PriorityQueue.prototype.isKeyQueued=function(e){return e in this.queuedElements_};ol.structs.PriorityQueue.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))};ol.structs.PriorityQueue.prototype.siftUp_=function(e){for(var t=this.elements_,o=this.priorities_,r=t.length,n=t[e],i=o[e],a=e;e<r>>1;){var s=this.getLeftChildIndex_(e),l=this.getRightChildIndex_(e);s=l<r&&o[l]<o[s]?l:s;t[e]=t[s];o[e]=o[s];e=s}t[e]=n;o[e]=i;this.siftDown_(a,e)};ol.structs.PriorityQueue.prototype.siftDown_=function(e,t){for(var o=this.elements_,r=this.priorities_,n=o[t],i=r[t];t>e;){var a=this.getParentIndex_(t);if(!(r[a]>i))break;o[t]=o[a],r[t]=r[a],t=a}o[t]=n;r[t]=i};ol.structs.PriorityQueue.prototype.reprioritize=function(){var e,t=this.priorityFunction_,o=this.elements_,r=this.priorities_,n=0,i=o.length;for(e=0;e<i;++e){var a=o[e],s=t(a);s==ol.structs.PriorityQueue.DROP?delete this.queuedElements_[this.keyFunction_(a)]:(r[n]=s,o[n++]=a)}o.length=n;r.length=n;this.heapify_()};ol.TileQueue=function(e,t){ol.structs.PriorityQueue.call(this,function(t){return e.apply(null,t)},function(e){return e[0].getKey()});this.tileChangeCallback_=t;this.tilesLoading_=0;this.tilesLoadingKeys_={}};ol.inherits(ol.TileQueue,ol.structs.PriorityQueue);ol.TileQueue.prototype.enqueue=function(e){var t=ol.structs.PriorityQueue.prototype.enqueue.call(this,e);t&&ol.events.listen(e[0],ol.events.EventType.CHANGE,this.handleTileChange,this);return t};ol.TileQueue.prototype.getTilesLoading=function(){return this.tilesLoading_};ol.TileQueue.prototype.handleTileChange=function(e){var t=(e=e.target).getState();t!==ol.TileState.LOADED&&t!==ol.TileState.ERROR&&t!==ol.TileState.EMPTY&&t!==ol.TileState.ABORT||(ol.events.unlisten(e,ol.events.EventType.CHANGE,this.handleTileChange,this),(e=e.getKey())in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_())};ol.TileQueue.prototype.loadMoreTiles=function(e,t){for(var o,r,n,i=0,a=!1;this.tilesLoading_<e&&i<t&&0<this.getCount();)n=(r=this.dequeue()[0]).getKey(),(o=r.getState())===ol.TileState.ABORT?a=!0:o!==ol.TileState.IDLE||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++i,r.load());0===i&&a&&this.tileChangeCallback_()};ol.CenterConstraint={};ol.CenterConstraint.createExtent=function(e){return function(t){if(t)return[ol.math.clamp(t[0],e[0],e[2]),ol.math.clamp(t[1],e[1],e[3])]}};ol.CenterConstraint.none=function(e){return e};ol.ResolutionConstraint={};ol.ResolutionConstraint.createSnapToResolutions=function(e){return function(t,o,r){if(void 0!==t)return t=ol.array.linearFindNearest(e,t,r),(t=ol.math.clamp(t+o,0,e.length-1))!=(o=Math.floor(t))&&o<e.length-1?e[o]/Math.pow(e[o]/e[o+1],t-o):e[o]}};ol.ResolutionConstraint.createSnapToPower=function(e,t,o){return function(r,n,i){if(void 0!==r)return r=Math.max(Math.floor(Math.log(t/r)/Math.log(e)+(-i/2+.5))+n,0),void 0!==o&&(r=Math.min(r,o)),t/Math.pow(e,r)}};ol.RotationConstraint={};ol.RotationConstraint.disable=function(e,t){if(void 0!==e)return 0};ol.RotationConstraint.none=function(e,t){if(void 0!==e)return e+t};ol.RotationConstraint.createSnapToN=function(e){var t=2*Math.PI/e;return function(e,o){if(void 0!==e)return Math.floor((e+o)/t+.5)*t}};ol.RotationConstraint.createSnapToZero=function(e){var t=e||ol.math.toRadians(5);return function(e,o){if(void 0!==e)return Math.abs(e+o)<=t?0:e+o}};ol.ViewHint={ANIMATING:0,INTERACTING:1};ol.ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};ol.string={};ol.string.padNumber=function(e,t,o){return(o=-1===(o=(e=void 0!==o?e.toFixed(o):""+e).indexOf("."))?e.length:o)>t?e:Array(1+t-o).join("0")+e};ol.string.compareVersions=function(e,t){e=(""+e).split(".");t=(""+t).split(".");for(var o=0;o<Math.max(e.length,t.length);o++){var r=parseInt(e[o]||"0",10),n=parseInt(t[o]||"0",10);if(r>n)return 1;if(n>r)return-1}return 0};ol.coordinate={};ol.coordinate.add=function(e,t){e[0]+=t[0];e[1]+=t[1];return e};ol.coordinate.closestOnCircle=function(e,t){var o=t.getRadius(),r=t.getCenter();t=r[0];r=r[1];var n=e[0]-t;e=e[1]-r;0===n&&0===e&&(n=1);var i=Math.sqrt(n*n+e*e);return[t+o*n/i,r+o*e/i]};ol.coordinate.closestOnSegment=function(e,t){var o=e[0];e=e[1];var r=t[0],n=t[1];t=r[0];r=r[1];var i=n[0],a=i-t,s=(n=n[1])-r;0>=(o=0===a&&0===s?0:(a*(o-t)+s*(e-r))/(a*a+s*s||0))?(e=t,o=r):1<=o?(e=i,o=n):(e=t+o*a,o=r+o*s);return[e,o]};ol.coordinate.createStringXY=function(e){return function(t){return ol.coordinate.toStringXY(t,e)}};ol.coordinate.degreesToStringHDMS=function(e,t,o){t=ol.math.modulo(t+180,360)-180;var r=Math.abs(3600*t);o=o||0;var n=Math.pow(10,o),i=Math.floor(r/3600),a=Math.floor((r-3600*i)/60);60<=(r=Math.ceil((r-3600*i-60*a)*n)/n)&&(r=0,a+=1);60<=a&&(a=0,i+=1);return i+"\xb0 "+ol.string.padNumber(a,2)+"\u2032 "+ol.string.padNumber(r,2,o)+"\u2033"+(0==t?"":" "+e.charAt(0>t?1:0))};ol.coordinate.format=function(e,t,o){return e?t.replace("{x}",e[0].toFixed(o)).replace("{y}",e[1].toFixed(o)):""};ol.coordinate.equals=function(e,t){for(var o=!0,r=e.length-1;0<=r;--r)if(e[r]!=t[r]){o=!1;break}return o};ol.coordinate.rotate=function(e,t){var o=Math.cos(t);t=Math.sin(t);var r=e[1]*o+e[0]*t;e[0]=e[0]*o-e[1]*t;e[1]=r;return e};ol.coordinate.scale=function(e,t){e[0]*=t;e[1]*=t;return e};ol.coordinate.sub=function(e,t){e[0]-=t[0];e[1]-=t[1];return e};ol.coordinate.squaredDistance=function(e,t){var o=e[0]-t[0];return o*o+(e=e[1]-t[1])*e};ol.coordinate.distance=function(e,t){return Math.sqrt(ol.coordinate.squaredDistance(e,t))};ol.coordinate.squaredDistanceToSegment=function(e,t){return ol.coordinate.squaredDistance(e,ol.coordinate.closestOnSegment(e,t))};ol.coordinate.toStringHDMS=function(e,t){return e?ol.coordinate.degreesToStringHDMS("NS",e[1],t)+" "+ol.coordinate.degreesToStringHDMS("EW",e[0],t):""};ol.coordinate.toStringXY=function(e,t){return ol.coordinate.format(e,"{x}, {y}",t)};ol.easing={};ol.easing.easeIn=function(e){return Math.pow(e,3)};ol.easing.easeOut=function(e){return 1-ol.easing.easeIn(1-e)};ol.easing.inAndOut=function(e){return 3*e*e-2*e*e*e};ol.easing.linear=function(e){return e};ol.easing.upAndDown=function(e){return.5>e?ol.easing.inAndOut(2*e):1-ol.easing.inAndOut(2*(e-.5))};ol.geom.GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};ol.functions={};ol.functions.TRUE=function(){return!0};ol.functions.FALSE=function(){return!1};ol.geom.flat={};ol.geom.flat.transform={};ol.geom.flat.transform.transform2D=function(e,t,o,r,n,i){for(var a=i||[],s=0;t<o;t+=r){var l=e[t],c=e[t+1];a[s++]=n[0]*l+n[2]*c+n[4];a[s++]=n[1]*l+n[3]*c+n[5]}i&&a.length!=s&&(a.length=s);return a};ol.geom.flat.transform.rotate=function(e,t,o,r,n,i,a){var s=a||[],l=Math.cos(n);n=Math.sin(n);var c=i[0];i=i[1];for(var u=0;t<o;t+=r){var h=e[t]-c,d=e[t+1]-i;s[u++]=c+h*l-d*n;s[u++]=i+h*n+d*l;for(h=t+2;h<t+r;++h)s[u++]=e[h]}a&&s.length!=u&&(s.length=u);return s};ol.geom.flat.transform.scale=function(e,t,o,r,n,i,a,s){var l=s||[],c=a[0];a=a[1];for(var u=0;t<o;t+=r){var h=e[t]-c,d=e[t+1]-a;l[u++]=c+n*h;l[u++]=a+i*d;for(h=t+2;h<t+r;++h)l[u++]=e[h]}s&&l.length!=u&&(l.length=u);return l};ol.geom.flat.transform.translate=function(e,t,o,r,n,i,a){for(var s,l=a||[],c=0;t<o;t+=r)for(l[c++]=e[t]+n,l[c++]=e[t+1]+i,s=t+2;s<t+r;++s)l[c++]=e[s];a&&l.length!=c&&(l.length=c);return l};ol.transform={};ol.transform.tmp_=Array(6);ol.transform.create=function(){return[1,0,0,1,0,0]};ol.transform.reset=function(e){return ol.transform.set(e,1,0,0,1,0,0)};ol.transform.multiply=function(e,t){var o=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4];t=t[5];e[0]=o*l+n*c;e[1]=r*l+i*c;e[2]=o*u+n*h;e[3]=r*u+i*h;e[4]=o*d+n*t+a;e[5]=r*d+i*t+s;return e};ol.transform.set=function(e,t,o,r,n,i,a){e[0]=t;e[1]=o;e[2]=r;e[3]=n;e[4]=i;e[5]=a;return e};ol.transform.setFromArray=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e};ol.transform.apply=function(e,t){var o=t[0],r=t[1];t[0]=e[0]*o+e[2]*r+e[4];t[1]=e[1]*o+e[3]*r+e[5];return t};ol.transform.rotate=function(e,t){var o=Math.cos(t);t=Math.sin(t);return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,o,t,-t,o,0,0))};ol.transform.scale=function(e,t,o){return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,t,0,0,o,0,0))};ol.transform.translate=function(e,t,o){return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,1,0,0,1,t,o))};ol.transform.compose=function(e,t,o,r,n,i,a,s){var l=Math.sin(i);i=Math.cos(i);e[0]=r*i;e[1]=n*l;e[2]=-r*l;e[3]=n*i;e[4]=a*r*i-s*r*l+t;e[5]=a*n*l+s*n*i+o;return e};ol.transform.invert=function(e){var t=ol.transform.determinant(e);ol.asserts.assert(0!==t,32);var o=e[0],r=e[1],n=e[2],i=e[3],a=e[4],s=e[5];e[0]=i/t;e[1]=-r/t;e[2]=-n/t;e[3]=o/t;e[4]=(n*s-i*a)/t;e[5]=-(o*s-r*a)/t;return e};ol.transform.determinant=function(e){return e[0]*e[3]-e[1]*e[2]};ol.geom.Geometry=function(){ol.Object.call(this);this.extent_=ol.extent.createEmpty();this.extentRevision_=-1;this.simplifiedGeometryCache={};this.simplifiedGeometryRevision=this.simplifiedGeometryMaxMinSquaredTolerance=0;this.tmpTransform_=ol.transform.create()};ol.inherits(ol.geom.Geometry,ol.Object);ol.geom.Geometry.prototype.clone=function(){};ol.geom.Geometry.prototype.closestPointXY=function(e,t,o,r){};ol.geom.Geometry.prototype.getClosestPoint=function(e,t){t=t||[NaN,NaN];this.closestPointXY(e[0],e[1],t,1/0);return t};ol.geom.Geometry.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])};ol.geom.Geometry.prototype.computeExtent=function(e){};ol.geom.Geometry.prototype.containsXY=ol.functions.FALSE;ol.geom.Geometry.prototype.getExtent=function(e){this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision());return ol.extent.returnOrUpdate(this.extent_,e)};ol.geom.Geometry.prototype.rotate=function(e,t){};ol.geom.Geometry.prototype.scale=function(e,t,o){};ol.geom.Geometry.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)};ol.geom.Geometry.prototype.getSimplifiedGeometry=function(e){};ol.geom.Geometry.prototype.getType=function(){};ol.geom.Geometry.prototype.applyTransform=function(e){};ol.geom.Geometry.prototype.intersectsExtent=function(e){};ol.geom.Geometry.prototype.translate=function(e,t){};ol.geom.Geometry.prototype.transform=function(e,t){var o=this.tmpTransform_,r=(e=ol.proj.get(e)).getUnits()==ol.proj.Units.TILE_PIXELS?function(r,n,i){var a=e.getExtent(),s=e.getWorldExtent();a=ol.extent.getHeight(s)/ol.extent.getHeight(a);ol.transform.compose(o,s[0],s[3],a,-a,0,0,0);ol.geom.flat.transform.transform2D(r,0,r.length,i,o,n);return ol.proj.getTransform(e,t)(r,n,i)}:ol.proj.getTransform(e,t);this.applyTransform(r);return this};ol.geom.SimpleGeometry=function(){ol.geom.Geometry.call(this);this.layout=ol.geom.GeometryLayout.XY;this.stride=2;this.flatCoordinates=null};ol.inherits(ol.geom.SimpleGeometry,ol.geom.Geometry);ol.geom.SimpleGeometry.getLayoutForStride_=function(e){if(2==e)var t=ol.geom.GeometryLayout.XY;else 3==e?t=ol.geom.GeometryLayout.XYZ:4==e&&(t=ol.geom.GeometryLayout.XYZM);return t};ol.geom.SimpleGeometry.getStrideForLayout=function(e){var t;e==ol.geom.GeometryLayout.XY?t=2:e==ol.geom.GeometryLayout.XYZ||e==ol.geom.GeometryLayout.XYM?t=3:e==ol.geom.GeometryLayout.XYZM&&(t=4);return t};ol.geom.SimpleGeometry.prototype.containsXY=ol.functions.FALSE;ol.geom.SimpleGeometry.prototype.computeExtent=function(e){return ol.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)};ol.geom.SimpleGeometry.prototype.getCoordinates=function(){};ol.geom.SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)};ol.geom.SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates};ol.geom.SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)};ol.geom.SimpleGeometry.prototype.getLayout=function(){return this.layout};ol.geom.SimpleGeometry.prototype.getSimplifiedGeometry=function(e){this.simplifiedGeometryRevision!=this.getRevision()&&(ol.obj.clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision());if(0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];var o=this.getSimplifiedGeometryInternal(e);if(o.getFlatCoordinates().length<this.flatCoordinates.length)return this.simplifiedGeometryCache[t]=o;this.simplifiedGeometryMaxMinSquaredTolerance=e;return this};ol.geom.SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(e){return this};ol.geom.SimpleGeometry.prototype.getStride=function(){return this.stride};ol.geom.SimpleGeometry.prototype.setFlatCoordinatesInternal=function(e,t){this.stride=ol.geom.SimpleGeometry.getStrideForLayout(e);this.layout=e;this.flatCoordinates=t};ol.geom.SimpleGeometry.prototype.setCoordinates=function(e,t){};ol.geom.SimpleGeometry.prototype.setLayout=function(e,t,o){if(e)t=ol.geom.SimpleGeometry.getStrideForLayout(e);else{for(e=0;e<o;++e){if(0===t.length){this.layout=ol.geom.GeometryLayout.XY;this.stride=2;return}t=t[0]}t=t.length;e=ol.geom.SimpleGeometry.getLayoutForStride_(t)}this.layout=e;this.stride=t};ol.geom.SimpleGeometry.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())};ol.geom.SimpleGeometry.prototype.rotate=function(e,t){var o=this.getFlatCoordinates();if(o){var r=this.getStride();ol.geom.flat.transform.rotate(o,0,o.length,r,e,t,o);this.changed()}};ol.geom.SimpleGeometry.prototype.scale=function(e,t,o){void 0===t&&(t=e);o||(o=ol.extent.getCenter(this.getExtent()));var r=this.getFlatCoordinates();if(r){var n=this.getStride();ol.geom.flat.transform.scale(r,0,r.length,n,e,t,o,r);this.changed()}};ol.geom.SimpleGeometry.prototype.translate=function(e,t){var o=this.getFlatCoordinates();if(o){var r=this.getStride();ol.geom.flat.transform.translate(o,0,o.length,r,e,t,o);this.changed()}};ol.geom.SimpleGeometry.transform2D=function(e,t,o){var r=e.getFlatCoordinates();return r?(e=e.getStride(),ol.geom.flat.transform.transform2D(r,0,r.length,e,t,o)):null};ol.geom.flat.area={};ol.geom.flat.area.linearRing=function(e,t,o,r){for(var n=0,i=e[o-r],a=e[o-r+1];t<o;t+=r){var s=e[t],l=e[t+1];n+=a*s-i*l;i=s;a=l}return n/2};ol.geom.flat.area.linearRings=function(e,t,o,r){var n,i=0,a=0;for(n=o.length;a<n;++a){var s=o[a];i+=ol.geom.flat.area.linearRing(e,t,s,r);t=s}return i};ol.geom.flat.area.linearRingss=function(e,t,o,r){var n,i=0,a=0;for(n=o.length;a<n;++a){var s=o[a];i+=ol.geom.flat.area.linearRings(e,t,s,r);t=s[s.length-1]}return i};ol.geom.flat.closest={};ol.geom.flat.closest.point=function(e,t,o,r,n,i,a){var s=e[t],l=e[t+1],c=e[o]-s,u=e[o+1]-l;if(0!==c||0!==u)if(1<(i=((n-s)*c+(i-l)*u)/(c*c+u*u)))t=o;else if(0<i){for(n=0;n<r;++n)a[n]=ol.math.lerp(e[t+n],e[o+n],i);a.length=r;return}for(n=0;n<r;++n)a[n]=e[t+n];a.length=r};ol.geom.flat.closest.getMaxSquaredDelta=function(e,t,o,r,n){var i=e[t],a=e[t+1];for(t+=r;t<o;t+=r){var s=e[t],l=e[t+1];(i=ol.math.squaredDistance(i,a,s,l))>n&&(n=i);i=s;a=l}return n};ol.geom.flat.closest.getsMaxSquaredDelta=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a){var s=o[a];n=ol.geom.flat.closest.getMaxSquaredDelta(e,t,s,r,n);t=s}return n};ol.geom.flat.closest.getssMaxSquaredDelta=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a){var s=o[a];n=ol.geom.flat.closest.getsMaxSquaredDelta(e,t,s,r,n);t=s[s.length-1]}return n};ol.geom.flat.closest.getClosestPoint=function(e,t,o,r,n,i,a,s,l,c,u){if(t==o)return c;if(0===n){var h=ol.math.squaredDistance(a,s,e[t],e[t+1]);if(h<c){for(u=0;u<r;++u)l[u]=e[t+u];l.length=r;return h}return c}for(var d=u||[NaN,NaN],p=t+r;p<o;)if(ol.geom.flat.closest.point(e,p-r,p,r,a,s,d),(h=ol.math.squaredDistance(a,s,d[0],d[1]))<c){c=h;for(u=0;u<r;++u)l[u]=d[u];l.length=r;p+=r}else p+=r*Math.max((Math.sqrt(h)-Math.sqrt(c))/n|0,1);if(i&&(ol.geom.flat.closest.point(e,o-r,t,r,a,s,d),(h=ol.math.squaredDistance(a,s,d[0],d[1]))<c)){c=h;for(u=0;u<r;++u)l[u]=d[u];l.length=r}return c};ol.geom.flat.closest.getsClosestPoint=function(e,t,o,r,n,i,a,s,l,c,u){u=u||[NaN,NaN];var h,d=0;for(h=o.length;d<h;++d){var p=o[d];c=ol.geom.flat.closest.getClosestPoint(e,t,p,r,n,i,a,s,l,c,u);t=p}return c};ol.geom.flat.closest.getssClosestPoint=function(e,t,o,r,n,i,a,s,l,c,u){u=u||[NaN,NaN];var h,d=0;for(h=o.length;d<h;++d){var p=o[d];c=ol.geom.flat.closest.getsClosestPoint(e,t,p,r,n,i,a,s,l,c,u);t=p[p.length-1]}return c};ol.geom.flat.deflate={};ol.geom.flat.deflate.coordinate=function(e,t,o,r){var n;r=0;for(n=o.length;r<n;++r)e[t++]=o[r];return t};ol.geom.flat.deflate.coordinates=function(e,t,o,r){var n,i=0;for(n=o.length;i<n;++i){var a,s=o[i];for(a=0;a<r;++a)e[t++]=s[a]}return t};ol.geom.flat.deflate.coordinatess=function(e,t,o,r,n){n=n||[];var i,a=0,s=0;for(i=o.length;s<i;++s)t=ol.geom.flat.deflate.coordinates(e,t,o[s],r),n[a++]=t;n.length=a;return n};ol.geom.flat.deflate.coordinatesss=function(e,t,o,r,n){n=n||[];var i,a=0,s=0;for(i=o.length;s<i;++s)t=ol.geom.flat.deflate.coordinatess(e,t,o[s],r,n[a]),n[a++]=t,t=t[t.length-1];n.length=a;return n};ol.geom.flat.inflate={};ol.geom.flat.inflate.coordinates=function(e,t,o,r,n){n=void 0!==n?n:[];for(var i=0;t<o;t+=r)n[i++]=e.slice(t,t+r);n.length=i;return n};ol.geom.flat.inflate.coordinatess=function(e,t,o,r,n){n=void 0!==n?n:[];var i,a=0,s=0;for(i=o.length;s<i;++s){var l=o[s];n[a++]=ol.geom.flat.inflate.coordinates(e,t,l,r,n[a]);t=l}n.length=a;return n};ol.geom.flat.inflate.coordinatesss=function(e,t,o,r,n){n=void 0!==n?n:[];var i,a=0,s=0;for(i=o.length;s<i;++s){var l=o[s];n[a++]=ol.geom.flat.inflate.coordinatess(e,t,l,r,n[a]);t=l[l.length-1]}n.length=a;return n};ol.geom.flat.simplify={};ol.geom.flat.simplify.lineString=function(e,t,o,r,n,i,a){a=void 0!==a?a:[];i||(o=ol.geom.flat.simplify.radialDistance(e,t,o,r,n,a,0),e=a,t=0,r=2);a.length=ol.geom.flat.simplify.douglasPeucker(e,t,o,r,n,a,0);return a};ol.geom.flat.simplify.douglasPeucker=function(e,t,o,r,n,i,a){var s=(o-t)/r;if(3>s){for(;t<o;t+=r)i[a++]=e[t],i[a++]=e[t+1];return a}var l=Array(s);l[0]=1;l[s-1]=1;o=[t,o-r];for(var c,u=0;0<o.length;){var h=o.pop(),d=o.pop(),p=0,f=e[d],g=e[d+1],m=e[h],y=e[h+1];for(c=d+r;c<h;c+=r){var C=ol.math.squaredSegmentDistance(e[c],e[c+1],f,g,m,y);C>p&&(u=c,p=C)}p>n&&(l[(u-t)/r]=1,d+r<u&&o.push(d,u),u+r<h&&o.push(u,h))}for(c=0;c<s;++c)l[c]&&(i[a++]=e[t+c*r],i[a++]=e[t+c*r+1]);return a};ol.geom.flat.simplify.douglasPeuckers=function(e,t,o,r,n,i,a,s){var l,c=0;for(l=o.length;c<l;++c){var u=o[c];a=ol.geom.flat.simplify.douglasPeucker(e,t,u,r,n,i,a);s.push(a);t=u}return a};ol.geom.flat.simplify.douglasPeuckerss=function(e,t,o,r,n,i,a,s){var l,c=0;for(l=o.length;c<l;++c){var u=o[c],h=[];a=ol.geom.flat.simplify.douglasPeuckers(e,t,u,r,n,i,a,h);s.push(h);t=u[u.length-1]}return a};ol.geom.flat.simplify.radialDistance=function(e,t,o,r,n,i,a){if(o<=t+r){for(;t<o;t+=r)i[a++]=e[t],i[a++]=e[t+1];return a}var s=e[t],l=e[t+1];i[a++]=s;i[a++]=l;var c=s,u=l;for(t+=r;t<o;t+=r)c=e[t],u=e[t+1],ol.math.squaredDistance(s,l,c,u)>n&&(i[a++]=c,i[a++]=u,s=c,l=u);c==s&&u==l||(i[a++]=c,i[a++]=u);return a};ol.geom.flat.simplify.snap=function(e,t){return t*Math.round(e/t)};ol.geom.flat.simplify.quantize=function(e,t,o,r,n,i,a){if(t==o)return a;var s=ol.geom.flat.simplify.snap(e[t],n),l=ol.geom.flat.simplify.snap(e[t+1],n);t+=r;i[a++]=s;i[a++]=l;do{var c=ol.geom.flat.simplify.snap(e[t],n),u=ol.geom.flat.simplify.snap(e[t+1],n);if((t+=r)==o)return i[a++]=c,i[a++]=u,a}while(c==s&&u==l);for(;t<o;){var h=ol.geom.flat.simplify.snap(e[t],n),d=ol.geom.flat.simplify.snap(e[t+1],n);t+=r;if(h!=c||d!=u){var p=c-s,f=u-l,g=h-s,m=d-l;p*m==f*g&&(0>p&&g<p||p==g||0<p&&g>p)&&(0>f&&m<f||f==m||0<f&&m>f)||(i[a++]=c,i[a++]=u,s=c,l=u);c=h;u=d}}i[a++]=c;i[a++]=u;return a};ol.geom.flat.simplify.quantizes=function(e,t,o,r,n,i,a,s){var l,c=0;for(l=o.length;c<l;++c){var u=o[c];a=ol.geom.flat.simplify.quantize(e,t,u,r,n,i,a);s.push(a);t=u}return a};ol.geom.flat.simplify.quantizess=function(e,t,o,r,n,i,a,s){var l,c=0;for(l=o.length;c<l;++c){var u=o[c],h=[];a=ol.geom.flat.simplify.quantizes(e,t,u,r,n,i,a,h);s.push(h);t=u[u.length-1]}return a};ol.geom.LinearRing=function(e,t){ol.geom.SimpleGeometry.call(this);this.maxDeltaRevision_=this.maxDelta_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.LinearRing,ol.geom.SimpleGeometry);ol.geom.LinearRing.prototype.clone=function(){var e=new ol.geom.LinearRing(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.LinearRing.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision());return ol.geom.flat.closest.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.LinearRing.prototype.getArea=function(){return ol.geom.flat.area.linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LinearRing.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LinearRing.prototype.getSimplifiedGeometryInternal=function(e){var t=[];t.length=ol.geom.flat.simplify.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);(e=new ol.geom.LinearRing(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t);return e};ol.geom.LinearRing.prototype.getType=function(){return ol.geom.GeometryType.LINEAR_RING};ol.geom.LinearRing.prototype.intersectsExtent=function(e){};ol.geom.LinearRing.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.LinearRing.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.Point=function(e,t){ol.geom.SimpleGeometry.call(this);this.setCoordinates(e,t)};ol.inherits(ol.geom.Point,ol.geom.SimpleGeometry);ol.geom.Point.prototype.clone=function(){var e=new ol.geom.Point(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.Point.prototype.closestPointXY=function(e,t,o,r){var n=this.flatCoordinates;if((e=ol.math.squaredDistance(e,t,n[0],n[1]))<r){r=this.stride;for(t=0;t<r;++t)o[t]=n[t];o.length=r;return e}return r};ol.geom.Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]};ol.geom.Point.prototype.computeExtent=function(e){return ol.extent.createOrUpdateFromCoordinate(this.flatCoordinates,e)};ol.geom.Point.prototype.getType=function(){return ol.geom.GeometryType.POINT};ol.geom.Point.prototype.intersectsExtent=function(e){return ol.extent.containsXY(e,this.flatCoordinates[0],this.flatCoordinates[1])};ol.geom.Point.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ol.geom.flat.deflate.coordinate(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.Point.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.flat.contains={};ol.geom.flat.contains.linearRingContainsExtent=function(e,t,o,r,n){return!ol.extent.forEachCorner(n,function(n){return!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,n[0],n[1])})};ol.geom.flat.contains.linearRingContainsXY=function(e,t,o,r,n,i){for(var a=0,s=e[o-r],l=e[o-r+1];t<o;t+=r){var c=e[t],u=e[t+1];l<=i?u>i&&0<(c-s)*(i-l)-(n-s)*(u-l)&&a++:u<=i&&0>(c-s)*(i-l)-(n-s)*(u-l)&&a--;s=c;l=u}return 0!==a};ol.geom.flat.contains.linearRingsContainsXY=function(e,t,o,r,n,i){if(0===o.length||!ol.geom.flat.contains.linearRingContainsXY(e,t,o[0],r,n,i))return!1;var a;t=1;for(a=o.length;t<a;++t)if(ol.geom.flat.contains.linearRingContainsXY(e,o[t-1],o[t],r,n,i))return!1;return!0};ol.geom.flat.contains.linearRingssContainsXY=function(e,t,o,r,n,i){if(0===o.length)return!1;var a,s=0;for(a=o.length;s<a;++s){var l=o[s];if(ol.geom.flat.contains.linearRingsContainsXY(e,t,l,r,n,i))return!0;t=l[l.length-1]}return!1};ol.geom.flat.interiorpoint={};ol.geom.flat.interiorpoint.linearRings=function(e,t,o,r,n,i,a){for(var s,l,c,u,h,d=n[i+1],p=[],f=0,g=o.length;f<g;++f){var m=o[f];c=e[m-r];h=e[m-r+1];for(s=t;s<m;s+=r){u=e[s];l=e[s+1];(d<=h&&l<=d||h<=d&&d<=l)&&(c=(d-h)/(l-h)*(u-c)+c,p.push(c));c=u;h=l}}f=NaN;g=-1/0;p.sort(ol.array.numberSafeCompareFunction);c=p[0];s=1;for(l=p.length;s<l;++s)u=p[s],(m=Math.abs(u-c))>g&&(c=(c+u)/2,ol.geom.flat.contains.linearRingsContainsXY(e,t,o,r,c,d)&&(f=c,g=m)),c=u;isNaN(f)&&(f=n[i]);return a?(a.push(f,d,g),a):[f,d,g]};ol.geom.flat.interiorpoint.linearRingss=function(e,t,o,r,n){var i,a=[],s=0;for(i=o.length;s<i;++s){var l=o[s];a=ol.geom.flat.interiorpoint.linearRings(e,t,l,r,n,2*s,a);t=l[l.length-1]}return a};ol.geom.flat.segments={};ol.geom.flat.segments.forEach=function(e,t,o,r,n,i){for(var a,s=[e[t],e[t+1]],l=[];t+r<o;t+=r){l[0]=e[t+r];l[1]=e[t+r+1];if(a=n.call(i,s,l))return a;s[0]=l[0];s[1]=l[1]}return!1};ol.geom.flat.intersectsextent={};ol.geom.flat.intersectsextent.lineString=function(e,t,o,r,n){var i=ol.extent.extendFlatCoordinates(ol.extent.createEmpty(),e,t,o,r);return!!ol.extent.intersects(n,i)&&(!!(ol.extent.containsExtent(n,i)||i[0]>=n[0]&&i[2]<=n[2]||i[1]>=n[1]&&i[3]<=n[3])||ol.geom.flat.segments.forEach(e,t,o,r,function(e,t){return ol.extent.intersectsSegment(n,e,t)}))};ol.geom.flat.intersectsextent.lineStrings=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a){if(ol.geom.flat.intersectsextent.lineString(e,t,o[a],r,n))return!0;t=o[a]}return!1};ol.geom.flat.intersectsextent.linearRing=function(e,t,o,r,n){return!!(ol.geom.flat.intersectsextent.lineString(e,t,o,r,n)||ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,n[0],n[1])||ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,n[0],n[3])||ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,n[2],n[1])||ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,n[2],n[3]))};ol.geom.flat.intersectsextent.linearRings=function(e,t,o,r,n){if(!ol.geom.flat.intersectsextent.linearRing(e,t,o[0],r,n))return!1;if(1===o.length)return!0;var i;t=1;for(i=o.length;t<i;++t)if(ol.geom.flat.contains.linearRingContainsExtent(e,o[t-1],o[t],r,n))return!1;return!0};ol.geom.flat.intersectsextent.linearRingss=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a){var s=o[a];if(ol.geom.flat.intersectsextent.linearRings(e,t,s,r,n))return!0;t=s[s.length-1]}return!1};ol.geom.flat.reverse={};ol.geom.flat.reverse.coordinates=function(e,t,o,r){for(;t<o-r;){var n;for(n=0;n<r;++n){var i=e[t+n];e[t+n]=e[o-r+n];e[o-r+n]=i}t+=r;o-=r}};ol.geom.flat.orient={};ol.geom.flat.orient.linearRingIsClockwise=function(e,t,o,r){for(var n=0,i=e[o-r],a=e[o-r+1];t<o;t+=r){var s=e[t],l=e[t+1];n+=(s-i)*(l+a);i=s;a=l}return 0<n};ol.geom.flat.orient.linearRingsAreOriented=function(e,t,o,r,n){n=void 0!==n&&n;var i,a=0;for(i=o.length;a<i;++a){var s=o[a];t=ol.geom.flat.orient.linearRingIsClockwise(e,t,s,r);if(0===a){if(n&&t||!n&&!t)return!1}else if(n&&!t||!n&&t)return!1;t=s}return!0};ol.geom.flat.orient.linearRingssAreOriented=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a)if(!ol.geom.flat.orient.linearRingsAreOriented(e,t,o[a],r,n))return!1;return!0};ol.geom.flat.orient.orientLinearRings=function(e,t,o,r,n){n=void 0!==n&&n;var i,a=0;for(i=o.length;a<i;++a){var s=o[a],l=ol.geom.flat.orient.linearRingIsClockwise(e,t,s,r);(0===a?n&&l||!n&&!l:n&&!l||!n&&l)&&ol.geom.flat.reverse.coordinates(e,t,s,r);t=s}return t};ol.geom.flat.orient.orientLinearRingss=function(e,t,o,r,n){var i,a=0;for(i=o.length;a<i;++a)t=ol.geom.flat.orient.orientLinearRings(e,t,o[a],r,n);return t};ol.geom.Polygon=function(e,t){ol.geom.SimpleGeometry.call(this);this.ends_=[];this.flatInteriorPointRevision_=-1;this.flatInteriorPoint_=null;this.orientedRevision_=this.maxDeltaRevision_=this.maxDelta_=-1;this.orientedFlatCoordinates_=null;this.setCoordinates(e,t)};ol.inherits(ol.geom.Polygon,ol.geom.SimpleGeometry);ol.geom.Polygon.prototype.appendLinearRing=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};ol.geom.Polygon.prototype.clone=function(){var e=new ol.geom.Polygon(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice());return e};ol.geom.Polygon.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision());return ol.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.Polygon.prototype.containsXY=function(e,t){return ol.geom.flat.contains.linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)};ol.geom.Polygon.prototype.getArea=function(){return ol.geom.flat.area.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)};ol.geom.Polygon.prototype.getCoordinates=function(e){if(void 0!==e){var t=this.getOrientedFlatCoordinates().slice();ol.geom.flat.orient.orientLinearRings(t,0,this.ends_,this.stride,e)}else t=this.flatCoordinates;return ol.geom.flat.inflate.coordinatess(t,0,this.ends_,this.stride)};ol.geom.Polygon.prototype.getEnds=function(){return this.ends_};ol.geom.Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=ol.extent.getCenter(this.getExtent());this.flatInteriorPoint_=ol.geom.flat.interiorpoint.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0);this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_};ol.geom.Polygon.prototype.getInteriorPoint=function(){return new ol.geom.Point(this.getFlatInteriorPoint(),ol.geom.GeometryLayout.XYM)};ol.geom.Polygon.prototype.getLinearRingCount=function(){return this.ends_.length};ol.geom.Polygon.prototype.getLinearRing=function(e){if(0>e||this.ends_.length<=e)return null;var t=new ol.geom.LinearRing(null);t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]));return t};ol.geom.Polygon.prototype.getLinearRings=function(){var e,t=this.layout,o=this.flatCoordinates,r=this.ends_,n=[],i=0,a=0;for(e=r.length;a<e;++a){var s=r[a],l=new ol.geom.LinearRing(null);l.setFlatCoordinates(t,o.slice(i,s));n.push(l);i=s}return n};ol.geom.Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;ol.geom.flat.orient.linearRingsAreOriented(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ol.geom.flat.orient.orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride));this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};ol.geom.Polygon.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.quantizes(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,o);(e=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return e};ol.geom.Polygon.prototype.getType=function(){return ol.geom.GeometryType.POLYGON};ol.geom.Polygon.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)};ol.geom.Polygon.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]),e=ol.geom.flat.deflate.coordinatess(this.flatCoordinates,0,e,this.stride,this.ends_),this.flatCoordinates.length=0===e.length?0:e[e.length-1],this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.ends_)};ol.geom.Polygon.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.ends_=o;this.changed()};ol.geom.Polygon.circular=function(e,t,o,r){var n,i=r||32;r=[];for(n=0;n<i;++n)ol.array.extend(r,e.offset(t,o,2*Math.PI*n/i));r.push(r[0],r[1]);(e=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,r,[r.length]);return e};ol.geom.Polygon.fromExtent=function(e){var t=e[0],o=e[1],r=e[2];t=[t,o,t,e=e[3],r,e,r,o,t,o];(o=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t,[t.length]);return o};ol.geom.Polygon.fromCircle=function(e,t,o){var r=t||32,n=e.getStride();t=e.getLayout();var i=new ol.geom.Polygon(null,t);r=n*(r+1);n=Array(r);for(var a=0;a<r;a++)n[a]=0;i.setFlatCoordinates(t,n,[n.length]);ol.geom.Polygon.makeRegular(i,e.getCenter(),e.getRadius(),o);return i};ol.geom.Polygon.makeRegular=function(e,t,o,r){var n=e.getFlatCoordinates(),i=e.getLayout(),a=e.getStride(),s=e.getEnds(),l=n.length/a-1;r=r||0;for(var c,u,h=0;h<=l;++h)u=h*a,c=r+2*ol.math.modulo(h,l)*Math.PI/l,n[u]=t[0]+o*Math.cos(c),n[u+1]=t[1]+o*Math.sin(c);e.setFlatCoordinates(i,n,s)};ol.View=function(e){ol.Object.call(this);e=ol.obj.assign({},e);this.hints_=[0,0];this.animations_=[];this.updateAnimations_=this.updateAnimations_.bind(this);this.projection_=ol.proj.createProjection(e.projection,"EPSG:3857");this.applyOptions_(e)};ol.inherits(ol.View,ol.Object);ol.View.prototype.applyOptions_=function(e){var t={};t[ol.ViewProperty.CENTER]=void 0!==e.center?e.center:null;var o=ol.View.createResolutionConstraint_(e);this.maxResolution_=o.maxResolution;this.minResolution_=o.minResolution;this.zoomFactor_=o.zoomFactor;this.resolutions_=e.resolutions;this.minZoom_=o.minZoom;var r=ol.View.createCenterConstraint_(e);o=o.constraint;var n=ol.View.createRotationConstraint_(e);this.constraints_={center:r,resolution:o,rotation:n};void 0!==e.resolution?t[ol.ViewProperty.RESOLUTION]=e.resolution:void 0!==e.zoom&&(t[ol.ViewProperty.RESOLUTION]=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_),this.resolutions_&&(t[ol.ViewProperty.RESOLUTION]=ol.math.clamp(Number(this.getResolution()||t[ol.ViewProperty.RESOLUTION]),this.minResolution_,this.maxResolution_)));t[ol.ViewProperty.ROTATION]=void 0!==e.rotation?e.rotation:0;this.setProperties(t);this.options_=e};ol.View.prototype.getUpdatedOptions_=function(e){var t=ol.obj.assign({},this.options_);void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom();t.center=this.getCenter();t.rotation=this.getRotation();return ol.obj.assign({},t,e)};ol.View.prototype.animate=function(e){var t=arguments.length;if(1<t&&"function"==typeof arguments[t-1]){var o=arguments[t-1];--t}if(this.isDef()){for(var r=Date.now(),n=this.getCenter().slice(),i=this.getResolution(),a=this.getRotation(),s=[],l=0;l<t;++l){var c=arguments[l],u={start:r,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||ol.easing.inAndOut};c.center&&(u.sourceCenter=n,u.targetCenter=c.center,n=u.targetCenter);void 0!==c.zoom?(u.sourceResolution=i,u.targetResolution=this.constrainResolution(this.maxResolution_,c.zoom-this.minZoom_,0),i=u.targetResolution):c.resolution&&(u.sourceResolution=i,u.targetResolution=c.resolution,i=u.targetResolution);void 0!==c.rotation&&(u.sourceRotation=a,c=ol.math.modulo(c.rotation-a+Math.PI,2*Math.PI)-Math.PI,u.targetRotation=a+c,a=u.targetRotation);u.callback=o;ol.View.isNoopAnimation(u)?u.complete=!0:r+=u.duration;s.push(u)}this.animations_.push(s);this.setHint(ol.ViewHint.ANIMATING,1);this.updateAnimations_()}else(t=arguments[t-1]).center&&this.setCenter(t.center),void 0!==t.zoom&&this.setZoom(t.zoom),void 0!==t.rotation&&this.setRotation(t.rotation),o&&o(!0)};ol.View.prototype.getAnimating=function(){return 0<this.hints_[ol.ViewHint.ANIMATING]};ol.View.prototype.getInteracting=function(){return 0<this.hints_[ol.ViewHint.INTERACTING]};ol.View.prototype.cancelAnimations=function(){this.setHint(ol.ViewHint.ANIMATING,-this.hints_[ol.ViewHint.ANIMATING]);for(var e=0,t=this.animations_.length;e<t;++e){var o=this.animations_[e];o[0].callback&&o[0].callback(!1)}this.animations_.length=0};ol.View.prototype.updateAnimations_=function(){void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0);if(this.getAnimating()){for(var e=Date.now(),t=!1,o=this.animations_.length-1;0<=o;--o){for(var r=this.animations_[o],n=!0,i=0,a=r.length;i<a;++i){var s=r[i];if(!s.complete){t=e-s.start;1<=(t=0<s.duration?t/s.duration:1)?(s.complete=!0,t=1):n=!1;t=s.easing(t);if(s.sourceCenter){var l=s.sourceCenter[0],c=s.sourceCenter[1];this.set(ol.ViewProperty.CENTER,[l+t*(s.targetCenter[0]-l),c+t*(s.targetCenter[1]-c)])}s.sourceResolution&&s.targetResolution&&(l=1===t?s.targetResolution:s.sourceResolution+t*(s.targetResolution-s.sourceResolution),s.anchor&&this.set(ol.ViewProperty.CENTER,this.calculateCenterZoom(l,s.anchor)),this.set(ol.ViewProperty.RESOLUTION,l));void 0!==s.sourceRotation&&void 0!==s.targetRotation&&(t=1===t?ol.math.modulo(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+t*(s.targetRotation-s.sourceRotation),s.anchor&&this.set(ol.ViewProperty.CENTER,this.calculateCenterRotate(t,s.anchor)),this.set(ol.ViewProperty.ROTATION,t));t=!0;if(!s.complete)break}}n&&(this.animations_[o]=null,this.setHint(ol.ViewHint.ANIMATING,-1),(r=r[0].callback)&&r(!0))}this.animations_=this.animations_.filter(Boolean);t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}};ol.View.prototype.calculateCenterRotate=function(e,t){var o=this.getCenter();if(void 0!==o){var r=[o[0]-t[0],o[1]-t[1]];ol.coordinate.rotate(r,e-this.getRotation());ol.coordinate.add(r,t)}return r};ol.View.prototype.calculateCenterZoom=function(e,t){var o,r=this.getCenter(),n=this.getResolution();void 0!==r&&void 0!==n&&(o=[t[0]-e*(t[0]-r[0])/n,t[1]-e*(t[1]-r[1])/n]);return o};ol.View.prototype.getSizeFromViewport_=function(){var e=[100,100],t='.ol-viewport[data-view="'+ol.getUid(this)+'"]';(t=document.querySelector(t))&&(t=getComputedStyle(t),e[0]=parseInt(t.width,10),e[1]=parseInt(t.height,10));return e};ol.View.prototype.constrainCenter=function(e){return this.constraints_.center(e)};ol.View.prototype.constrainResolution=function(e,t,o){return this.constraints_.resolution(e,t||0,o||0)};ol.View.prototype.constrainRotation=function(e,t){return this.constraints_.rotation(e,t||0)};ol.View.prototype.getCenter=function(){return this.get(ol.ViewProperty.CENTER)};ol.View.prototype.getConstraints=function(){return this.constraints_};ol.View.prototype.getHints=function(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()};ol.View.prototype.calculateExtent=function(e){e=e||this.getSizeFromViewport_();var t=this.getCenter();ol.asserts.assert(t,1);var o=this.getResolution();ol.asserts.assert(void 0!==o,2);var r=this.getRotation();ol.asserts.assert(void 0!==r,3);return ol.extent.getForViewAndSize(t,o,r,e)};ol.View.prototype.getMaxResolution=function(){return this.maxResolution_};ol.View.prototype.getMinResolution=function(){return this.minResolution_};ol.View.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)};ol.View.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))};ol.View.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)};ol.View.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))};ol.View.prototype.getProjection=function(){return this.projection_};ol.View.prototype.getResolution=function(){return this.get(ol.ViewProperty.RESOLUTION)};ol.View.prototype.getResolutions=function(){return this.resolutions_};ol.View.prototype.getResolutionForExtent=function(e,t){var o=t||this.getSizeFromViewport_();t=ol.extent.getWidth(e)/o[0];e=ol.extent.getHeight(e)/o[1];return Math.max(t,e)};ol.View.prototype.getResolutionForValueFunction=function(e){var t=e||2,o=this.maxResolution_,r=Math.log(o/this.minResolution_)/Math.log(t);return function(e){return o/Math.pow(t,e*r)}};ol.View.prototype.getRotation=function(){return this.get(ol.ViewProperty.ROTATION)};ol.View.prototype.getValueForResolutionFunction=function(e){var t=e||2,o=this.maxResolution_,r=Math.log(o/this.minResolution_)/Math.log(t);return function(e){return Math.log(o/e)/Math.log(t)/r}};ol.View.prototype.getState=function(){var e=this.getCenter(),t=this.getProjection(),o=this.getResolution(),r=this.getRotation();return{center:e.slice(),projection:void 0!==t?t:null,resolution:o,rotation:r,zoom:this.getZoom()}};ol.View.prototype.getZoom=function(){var e,t=this.getResolution();void 0!==t&&(e=this.getZoomForResolution(t));return e};ol.View.prototype.getZoomForResolution=function(e){var t,o=this.minZoom_||0;if(this.resolutions_){o=t=ol.array.linearFindNearest(this.resolutions_,e,1);var r=this.resolutions_[t];t=t==this.resolutions_.length-1?2:r/this.resolutions_[t+1]}else r=this.maxResolution_,t=this.zoomFactor_;return o+Math.log(r/e)/Math.log(t)};ol.View.prototype.getResolutionForZoom=function(e){return this.constrainResolution(this.maxResolution_,e-this.minZoom_,0)};ol.View.prototype.fit=function(e,t){var o=(t=t||{}).size;o||(o=this.getSizeFromViewport_());if(e instanceof ol.geom.SimpleGeometry)if(e.getType()===ol.geom.GeometryType.CIRCLE){e=e.getExtent();var r=ol.geom.Polygon.fromExtent(e);r.rotate(this.getRotation(),ol.extent.getCenter(e))}else r=e;else ol.asserts.assert(Array.isArray(e),24),ol.asserts.assert(!ol.extent.isEmpty(e),25),r=ol.geom.Polygon.fromExtent(e);var n=void 0!==t.padding?t.padding:[0,0,0,0],i=void 0===t.constrainResolution||t.constrainResolution,a=void 0!==t.nearest&&t.nearest,s=void 0!==t.minResolution?t.minResolution:void 0!==t.maxZoom?this.constrainResolution(this.maxResolution_,t.maxZoom-this.minZoom_,0):0,l=r.getFlatCoordinates(),c=this.getRotation();e=Math.cos(-c);c=Math.sin(-c);var u=1/0,h=1/0,d=-1/0,p=-1/0;r=r.getStride();for(var f=0,g=l.length;f<g;f+=r){var m=l[f]*e-l[f+1]*c,y=l[f]*c+l[f+1]*e;u=Math.min(u,m);h=Math.min(h,y);d=Math.max(d,m);p=Math.max(p,y)}o=this.getResolutionForExtent([u,h,d,p],[o[0]-n[1]-n[3],o[1]-n[0]-n[2]]);o=isNaN(o)?s:Math.max(o,s);i&&(i=this.constrainResolution(o,0,0),!a&&i<o&&(i=this.constrainResolution(i,-1,0)),o=i);c=-c;e=[(a=(u+d)/2+(n[1]-n[3])/2*o)*e-(n=(h+p)/2+(n[0]-n[2])/2*o)*c,n*e+a*c];n=t.callback?t.callback:ol.nullFunction;void 0!==t.duration?this.animate({resolution:o,center:e,duration:t.duration,easing:t.easing},n):(this.setResolution(o),this.setCenter(e),setTimeout(n.bind(void 0,!0),0))};ol.View.prototype.centerOn=function(e,t,o){var r=this.getRotation(),n=Math.cos(-r);r=Math.sin(-r);var i=e[0]*n-e[1]*r;e=e[1]*n+e[0]*r;var a=this.getResolution();i+=(t[0]/2-o[0])*a;e+=(o[1]-t[1]/2)*a;r=-r;this.setCenter([i*n-e*r,e*n+i*r])};ol.View.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()};ol.View.prototype.rotate=function(e,t){void 0!==t&&(t=this.calculateCenterRotate(e,t),this.setCenter(t));this.setRotation(e)};ol.View.prototype.setCenter=function(e){this.set(ol.ViewProperty.CENTER,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setHint=function(e,t){this.hints_[e]+=t;this.changed();return this.hints_[e]};ol.View.prototype.setResolution=function(e){this.set(ol.ViewProperty.RESOLUTION,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setRotation=function(e){this.set(ol.ViewProperty.ROTATION,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))};ol.View.createCenterConstraint_=function(e){return void 0!==e.extent?ol.CenterConstraint.createExtent(e.extent):ol.CenterConstraint.none};ol.View.createResolutionConstraint_=function(e){var t=void 0!==e.minZoom?e.minZoom:ol.DEFAULT_MIN_ZOOM,o=void 0!==e.maxZoom?e.maxZoom:28,r=void 0!==e.zoomFactor?e.zoomFactor:2;if(void 0!==e.resolutions){var n=(e=e.resolutions)[t],i=void 0!==e[o]?e[o]:e[e.length-1];o=ol.ResolutionConstraint.createSnapToResolutions(e)}else{var a=((i=(n=ol.proj.createProjection(e.projection,"EPSG:3857")).getExtent())?Math.max(ol.extent.getWidth(i),ol.extent.getHeight(i)):360*ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES]/n.getMetersPerUnit())/ol.DEFAULT_TILE_SIZE/Math.pow(2,ol.DEFAULT_MIN_ZOOM),s=a/Math.pow(2,28-ol.DEFAULT_MIN_ZOOM);void 0!==(n=e.maxResolution)?t=0:n=a/Math.pow(r,t);void 0===(i=e.minResolution)&&(i=void 0!==e.maxZoom?void 0!==e.maxResolution?n/Math.pow(r,o):a/Math.pow(r,o):s);o=t+Math.floor(Math.log(n/i)/Math.log(r));i=n/Math.pow(r,o-t);o=ol.ResolutionConstraint.createSnapToPower(r,n,o-t)}return{constraint:o,maxResolution:n,minResolution:i,minZoom:t,zoomFactor:r}};ol.View.createRotationConstraint_=function(e){return void 0===e.enableRotation||e.enableRotation?void 0===(e=e.constrainRotation)||!0===e?ol.RotationConstraint.createSnapToZero():!1===e?ol.RotationConstraint.none:"number"==typeof e?ol.RotationConstraint.createSnapToN(e):ol.RotationConstraint.none:ol.RotationConstraint.disable};ol.View.isNoopAnimation=function(e){return!(e.sourceCenter&&e.targetCenter&&!ol.coordinate.equals(e.sourceCenter,e.targetCenter)||e.sourceResolution!==e.targetResolution||e.sourceRotation!==e.targetRotation)};ol.dom={};ol.dom.createCanvasContext2D=function(e,t){var o=document.createElement("CANVAS");e&&(o.width=e);t&&(o.height=t);return o.getContext("2d")};ol.dom.outerWidth=function(e){var t=e.offsetWidth;e=getComputedStyle(e);return t+(parseInt(e.marginLeft,10)+parseInt(e.marginRight,10))};ol.dom.outerHeight=function(e){var t=e.offsetHeight;e=getComputedStyle(e);return t+(parseInt(e.marginTop,10)+parseInt(e.marginBottom,10))};ol.dom.replaceNode=function(e,t){var o=t.parentNode;o&&o.replaceChild(e,t)};ol.dom.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null};ol.dom.removeChildren=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)};ol.layer={};ol.layer.Property={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"};ol.layer.Base=function(e){ol.Object.call(this);var t=ol.obj.assign({},e);t[ol.layer.Property.OPACITY]=void 0!==e.opacity?e.opacity:1;t[ol.layer.Property.VISIBLE]=void 0===e.visible||e.visible;t[ol.layer.Property.Z_INDEX]=void 0!==e.zIndex?e.zIndex:0;t[ol.layer.Property.MAX_RESOLUTION]=void 0!==e.maxResolution?e.maxResolution:1/0;t[ol.layer.Property.MIN_RESOLUTION]=void 0!==e.minResolution?e.minResolution:0;this.setProperties(t);this.state_={layer:this,managed:!0}};ol.inherits(ol.layer.Base,ol.Object);ol.layer.Base.prototype.getType=function(){return this.type};ol.layer.Base.prototype.getLayerState=function(){this.state_.opacity=ol.math.clamp(this.getOpacity(),0,1);this.state_.sourceState=this.getSourceState();this.state_.visible=this.getVisible();this.state_.extent=this.getExtent();this.state_.zIndex=this.getZIndex();this.state_.maxResolution=this.getMaxResolution();this.state_.minResolution=Math.max(this.getMinResolution(),0);return this.state_};ol.layer.Base.prototype.getLayersArray=function(e){};ol.layer.Base.prototype.getLayerStatesArray=function(e){};ol.layer.Base.prototype.getExtent=function(){return this.get(ol.layer.Property.EXTENT)};ol.layer.Base.prototype.getMaxResolution=function(){return this.get(ol.layer.Property.MAX_RESOLUTION)};ol.layer.Base.prototype.getMinResolution=function(){return this.get(ol.layer.Property.MIN_RESOLUTION)};ol.layer.Base.prototype.getOpacity=function(){return this.get(ol.layer.Property.OPACITY)};ol.layer.Base.prototype.getSourceState=function(){};ol.layer.Base.prototype.getVisible=function(){return this.get(ol.layer.Property.VISIBLE)};ol.layer.Base.prototype.getZIndex=function(){return this.get(ol.layer.Property.Z_INDEX)};ol.layer.Base.prototype.setExtent=function(e){this.set(ol.layer.Property.EXTENT,e)};ol.layer.Base.prototype.setMaxResolution=function(e){this.set(ol.layer.Property.MAX_RESOLUTION,e)};ol.layer.Base.prototype.setMinResolution=function(e){this.set(ol.layer.Property.MIN_RESOLUTION,e)};ol.layer.Base.prototype.setOpacity=function(e){this.set(ol.layer.Property.OPACITY,e)};ol.layer.Base.prototype.setVisible=function(e){this.set(ol.layer.Property.VISIBLE,e)};ol.layer.Base.prototype.setZIndex=function(e){this.set(ol.layer.Property.Z_INDEX,e)};ol.source={};ol.source.State={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};ol.layer.Group=function(e){var t=e||{};delete(e=ol.obj.assign({},t)).layers;t=t.layers;ol.layer.Base.call(this,e);this.layersListenerKeys_=[];this.listenerKeys_={};ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Group.Property_.LAYERS),this.handleLayersChanged_,this);t?Array.isArray(t)?t=new ol.Collection(t.slice(),{unique:!0}):ol.asserts.assert(t instanceof ol.Collection,43):t=new ol.Collection(void 0,{unique:!0});this.setLayers(t)};ol.inherits(ol.layer.Group,ol.layer.Base);ol.layer.Group.prototype.handleLayerChange_=function(){this.changed()};ol.layer.Group.prototype.handleLayersChanged_=function(e){this.layersListenerKeys_.forEach(ol.events.unlistenByKey);this.layersListenerKeys_.length=0;e=this.getLayers();this.layersListenerKeys_.push(ol.events.listen(e,ol.CollectionEventType.ADD,this.handleLayersAdd_,this),ol.events.listen(e,ol.CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(var t in this.listenerKeys_)this.listenerKeys_[t].forEach(ol.events.unlistenByKey);ol.obj.clear(this.listenerKeys_);t=e.getArray();var o;e=0;for(o=t.length;e<o;e++){var r=t[e];this.listenerKeys_[ol.getUid(r).toString()]=[ol.events.listen(r,ol.ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),ol.events.listen(r,ol.events.EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()};ol.layer.Group.prototype.handleLayersAdd_=function(e){e=e.element;var t=ol.getUid(e).toString();this.listenerKeys_[t]=[ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),ol.events.listen(e,ol.events.EventType.CHANGE,this.handleLayerChange_,this)];this.changed()};ol.layer.Group.prototype.handleLayersRemove_=function(e){e=ol.getUid(e.element).toString();this.listenerKeys_[e].forEach(ol.events.unlistenByKey);delete this.listenerKeys_[e];this.changed()};ol.layer.Group.prototype.getLayers=function(){return this.get(ol.layer.Group.Property_.LAYERS)};ol.layer.Group.prototype.setLayers=function(e){this.set(ol.layer.Group.Property_.LAYERS,e)};ol.layer.Group.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];this.getLayers().forEach(function(e){e.getLayersArray(t)});return t};ol.layer.Group.prototype.getLayerStatesArray=function(e){var t,o=void 0!==e?e:[],r=o.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(o)});e=this.getLayerState();for(t=o.length;r<t;r++){var n=o[r];n.opacity*=e.opacity;n.visible=n.visible&&e.visible;n.maxResolution=Math.min(n.maxResolution,e.maxResolution);n.minResolution=Math.max(n.minResolution,e.minResolution);void 0!==e.extent&&(n.extent=void 0!==n.extent?ol.extent.getIntersection(n.extent,e.extent):e.extent)}return o};ol.layer.Group.prototype.getSourceState=function(){return ol.source.State.READY};ol.layer.Group.Property_={LAYERS:"layers"};ol.PluginType={MAP_RENDERER:"MAP_RENDERER",LAYER_RENDERER:"LAYER_RENDERER"};ol.plugins={};ol.plugins.mapRendererPlugins_=[];ol.plugins.getMapRendererPlugins=function(){return ol.plugins.mapRendererPlugins_};ol.plugins.layerRendererPlugins_=[];ol.plugins.getLayerRendererPlugins=function(){return ol.plugins.layerRendererPlugins_};ol.plugins.register=function(e,t){switch(e){case ol.PluginType.MAP_RENDERER:(e=ol.plugins.mapRendererPlugins_).push(t);break;case ol.PluginType.LAYER_RENDERER:(e=ol.plugins.layerRendererPlugins_).push(t);break;default:throw Error("Unsupported plugin type: "+e)}};ol.plugins.registerMultiple=function(e,t){for(var o=0,r=t.length;o<r;++o)ol.plugins.register(e,t[o])};ol.renderer={};ol.renderer.Type={CANVAS:"canvas",WEBGL:"webgl"};ol.PluggableMap=function(e){ol.Object.call(this);var t=ol.PluggableMap.createOptionsInternal(e);this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating;this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting;this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:ol.has.DEVICE_PIXEL_RATIO;this.logos_=t.logos;this.animationDelay_=function(){this.animationDelayKey_=void 0;this.renderFrame_.call(this,Date.now())}.bind(this);this.coordinateToPixelTransform_=ol.transform.create();this.pixelToCoordinateTransform_=ol.transform.create();this.frameIndex_=0;this.layerGroupPropertyListenerKeys_=this.viewChangeListenerKey_=this.viewPropertyListenerKey_=this.previousExtent_=this.frameState_=null;this.viewport_=document.createElement("DIV");this.viewport_.className="ol-viewport"+(ol.has.TOUCH?" ol-touch":"");this.viewport_.style.position="relative";this.viewport_.style.overflow="hidden";this.viewport_.style.width="100%";this.viewport_.style.height="100%";this.viewport_.style.msTouchAction="none";this.viewport_.style.touchAction="none";this.overlayContainer_=document.createElement("DIV");this.overlayContainer_.className="ol-overlaycontainer";this.viewport_.appendChild(this.overlayContainer_);this.overlayContainerStopEvent_=document.createElement("DIV");this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var o=[ol.events.EventType.CLICK,ol.events.EventType.DBLCLICK,ol.events.EventType.MOUSEDOWN,ol.events.EventType.TOUCHSTART,ol.events.EventType.MSPOINTERDOWN,ol.MapBrowserEventType.POINTERDOWN,ol.events.EventType.MOUSEWHEEL,ol.events.EventType.WHEEL],r=0,n=o.length;r<n;++r)ol.events.listen(this.overlayContainerStopEvent_,o[r],ol.events.Event.stopPropagation);this.viewport_.appendChild(this.overlayContainerStopEvent_);this.mapBrowserEventHandler_=new ol.MapBrowserEventHandler(this,e.moveTolerance);for(var i in ol.MapBrowserEventType)ol.events.listen(this.mapBrowserEventHandler_,ol.MapBrowserEventType[i],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget;this.keyHandlerKeys_=null;ol.events.listen(this.viewport_,ol.events.EventType.WHEEL,this.handleBrowserEvent,this);ol.events.listen(this.viewport_,ol.events.EventType.MOUSEWHEEL,this.handleBrowserEvent,this);this.controls=t.controls||new ol.Collection;this.interactions=t.interactions||new ol.Collection;this.overlays_=t.overlays;this.overlayIdIndex_={};this.renderer_=t.mapRendererPlugin.create(this.viewport_,this);this.focus_=null;this.postRenderFunctions_=[];this.tileQueue_=new ol.TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this));this.skippedFeatureUids_={};ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.LAYERGROUP),this.handleLayerGroupChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.VIEW),this.handleViewChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.SIZE),this.handleSizeChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.TARGET),this.handleTargetChanged_,this);this.setProperties(t.values);this.controls.forEach(function(e){e.setMap(this)},this);ol.events.listen(this.controls,ol.CollectionEventType.ADD,function(e){e.element.setMap(this)},this);ol.events.listen(this.controls,ol.CollectionEventType.REMOVE,function(e){e.element.setMap(null)},this);this.interactions.forEach(function(e){e.setMap(this)},this);ol.events.listen(this.interactions,ol.CollectionEventType.ADD,function(e){e.element.setMap(this)},this);ol.events.listen(this.interactions,ol.CollectionEventType.REMOVE,function(e){e.element.setMap(null)},this);this.overlays_.forEach(this.addOverlayInternal_,this);ol.events.listen(this.overlays_,ol.CollectionEventType.ADD,function(e){this.addOverlayInternal_(e.element)},this);ol.events.listen(this.overlays_,ol.CollectionEventType.REMOVE,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()];e.element.setMap(null)},this)};ol.inherits(ol.PluggableMap,ol.Object);ol.PluggableMap.prototype.addControl=function(e){this.getControls().push(e)};ol.PluggableMap.prototype.addInteraction=function(e){this.getInteractions().push(e)};ol.PluggableMap.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)};ol.PluggableMap.prototype.addOverlay=function(e){this.getOverlays().push(e)};ol.PluggableMap.prototype.addOverlayInternal_=function(e){var t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e);e.setMap(this)};ol.PluggableMap.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose();ol.events.unlisten(this.viewport_,ol.events.EventType.WHEEL,this.handleBrowserEvent,this);ol.events.unlisten(this.viewport_,ol.events.EventType.MOUSEWHEEL,this.handleBrowserEvent,this);void 0!==this.handleResize_&&(window.removeEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.setTarget(null);ol.Object.prototype.disposeInternal.call(this)};ol.PluggableMap.prototype.forEachFeatureAtPixel=function(e,t,o){if(this.frameState_)return e=this.getCoordinateFromPixel(e),o=void 0!==o?o:{},this.renderer_.forEachFeatureAtCoordinate(e,this.frameState_,void 0!==o.hitTolerance?o.hitTolerance*this.frameState_.pixelRatio:0,t,null,void 0!==o.layerFilter?o.layerFilter:ol.functions.TRUE,null)};ol.PluggableMap.prototype.getFeaturesAtPixel=function(e,t){var o=null;this.forEachFeatureAtPixel(e,function(e){o||(o=[]);o.push(e)},t);return o};ol.PluggableMap.prototype.forEachLayerAtPixel=function(e,t,o,r,n){if(this.frameState_)return this.renderer_.forEachLayerAtPixel(e,this.frameState_,t,void 0!==o?o:null,void 0!==r?r:ol.functions.TRUE,void 0!==n?n:null)};ol.PluggableMap.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;e=this.getCoordinateFromPixel(e);t=void 0!==t?t:{};return this.renderer_.hasFeatureAtCoordinate(e,this.frameState_,void 0!==t.hitTolerance?t.hitTolerance*this.frameState_.pixelRatio:0,void 0!==t.layerFilter?t.layerFilter:ol.functions.TRUE,null)};ol.PluggableMap.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))};ol.PluggableMap.prototype.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect();return[(e=e.changedTouches?e.changedTouches[0]:e).clientX-t.left,e.clientY-t.top]};ol.PluggableMap.prototype.getTarget=function(){return this.get(ol.MapProperty.TARGET)};ol.PluggableMap.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null};ol.PluggableMap.prototype.getCoordinateFromPixel=function(e){var t=this.frameState_;return t?ol.transform.apply(t.pixelToCoordinateTransform,e.slice()):null};ol.PluggableMap.prototype.getControls=function(){return this.controls};ol.PluggableMap.prototype.getOverlays=function(){return this.overlays_};ol.PluggableMap.prototype.getOverlayById=function(e){return void 0!==(e=this.overlayIdIndex_[e.toString()])?e:null};ol.PluggableMap.prototype.getInteractions=function(){return this.interactions};ol.PluggableMap.prototype.getLayerGroup=function(){return this.get(ol.MapProperty.LAYERGROUP)};ol.PluggableMap.prototype.getLayers=function(){return this.getLayerGroup().getLayers()};ol.PluggableMap.prototype.getPixelFromCoordinate=function(e){var t=this.frameState_;return t?ol.transform.apply(t.coordinateToPixelTransform,e.slice(0,2)):null};ol.PluggableMap.prototype.getRenderer=function(){return this.renderer_};ol.PluggableMap.prototype.getSize=function(){return this.get(ol.MapProperty.SIZE)};ol.PluggableMap.prototype.getView=function(){return this.get(ol.MapProperty.VIEW)};ol.PluggableMap.prototype.getViewport=function(){return this.viewport_};ol.PluggableMap.prototype.getOverlayContainer=function(){return this.overlayContainer_};ol.PluggableMap.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_};ol.PluggableMap.prototype.getTilePriority=function(e,t,o,r){var n=this.frameState_;if(!(n&&t in n.wantedTiles&&n.wantedTiles[t][e.getKey()]))return ol.structs.PriorityQueue.DROP;e=o[0]-n.focus[0];o=o[1]-n.focus[1];return 65536*Math.log(r)+Math.sqrt(e*e+o*o)/r};ol.PluggableMap.prototype.handleBrowserEvent=function(e,t){e=new ol.MapBrowserEvent(t||e.type,this,e);this.handleMapBrowserEvent(e)};ol.PluggableMap.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){this.focus_=e.coordinate;e.frameState=this.frameState_;var t,o=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(t=o.length-1;0<=t;t--){var r=o[t];if(r.getActive()&&!r.handleEvent(e))break}}};ol.PluggableMap.prototype.handlePostRender=function(){var e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){var o=16,r=o;if(e){var n=e.viewHints;n[ol.ViewHint.ANIMATING]&&(o=this.loadTilesWhileAnimating_?8:0,r=2);n[ol.ViewHint.INTERACTING]&&(o=this.loadTilesWhileInteracting_?8:0,r=2)}t.getTilesLoading()<o&&(t.reprioritize(),t.loadMoreTiles(o,r))}t=this.postRenderFunctions_;o=0;for(r=t.length;o<r;++o)t[o](this,e);t.length=0};ol.PluggableMap.prototype.handleSizeChanged_=function(){this.render()};ol.PluggableMap.prototype.handleTargetChanged_=function(){var e;this.getTarget()&&(e=this.getTargetElement());if(this.keyHandlerKeys_){for(var t=0,o=this.keyHandlerKeys_.length;t<o;++t)ol.events.unlistenByKey(this.keyHandlerKeys_[t]);this.keyHandlerKeys_=null}e?(e.appendChild(this.viewport_),e=this.keyboardEventTarget_?this.keyboardEventTarget_:e,this.keyHandlerKeys_=[ol.events.listen(e,ol.events.EventType.KEYDOWN,this.handleBrowserEvent,this),ol.events.listen(e,ol.events.EventType.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1))):(this.renderer_.removeLayerRenderers(),ol.dom.removeNode(this.viewport_),void 0!==this.handleResize_&&(window.removeEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0));this.updateSize()};ol.PluggableMap.prototype.handleTileChange_=function(){this.render()};ol.PluggableMap.prototype.handleViewPropertyChanged_=function(){this.render()};ol.PluggableMap.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(ol.events.unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null);this.viewChangeListenerKey_&&(ol.events.unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.viewport_.setAttribute("data-view",ol.getUid(e)),this.viewPropertyListenerKey_=ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleViewPropertyChanged_,this));this.render()};ol.PluggableMap.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ol.events.unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.render,this),ol.events.listen(e,ol.events.EventType.CHANGE,this.render,this)]);this.render()};ol.PluggableMap.prototype.isRendered=function(){return!!this.frameState_};ol.PluggableMap.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_);this.animationDelay_()};ol.PluggableMap.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))};ol.PluggableMap.prototype.removeControl=function(e){return this.getControls().remove(e)};ol.PluggableMap.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)};ol.PluggableMap.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)};ol.PluggableMap.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)};ol.PluggableMap.prototype.renderFrame_=function(e){var t,o=this.getSize(),r=this.getView(),n=ol.extent.createEmpty(),i=this.frameState_,a=null;if(void 0!==o&&ol.size.hasArea(o)&&r&&r.isDef()){a=r.getHints(this.frameState_?this.frameState_.viewHints:void 0);var s=this.getLayerGroup().getLayerStatesArray(),l={},c=0;for(t=s.length;c<t;++c)l[ol.getUid(s[c].layer)]=s[c];r=(c=r.getState()).center;t=c.resolution/this.pixelRatio_;r[0]=Math.round(r[0]/t)*t;r[1]=Math.round(r[1]/t)*t;a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:n,focus:this.focus_?this.focus_:r,index:this.frameIndex_++,layerStates:l,layerStatesArray:s,logos:ol.obj.assign({},this.logos_),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:o,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:c,viewHints:a,wantedTiles:{}}}a&&(a.extent=ol.extent.getForViewAndSize(c.center,c.resolution,c.rotation,a.size,n));this.frameState_=a;this.renderer_.renderFrame(a);a&&(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),!i||this.previousExtent_&&(ol.extent.isEmpty(this.previousExtent_)||ol.extent.equals(a.extent,this.previousExtent_))||(this.dispatchEvent(new ol.MapEvent(ol.MapEventType.MOVESTART,this,i)),this.previousExtent_=ol.extent.createOrUpdateEmpty(this.previousExtent_)),!this.previousExtent_||a.viewHints[ol.ViewHint.ANIMATING]||a.viewHints[ol.ViewHint.INTERACTING]||ol.extent.equals(a.extent,this.previousExtent_)||(this.dispatchEvent(new ol.MapEvent(ol.MapEventType.MOVEEND,this,a)),ol.extent.clone(a.extent,this.previousExtent_)));this.dispatchEvent(new ol.MapEvent(ol.MapEventType.POSTRENDER,this,a));setTimeout(this.handlePostRender.bind(this),0)};ol.PluggableMap.prototype.setLayerGroup=function(e){this.set(ol.MapProperty.LAYERGROUP,e)};ol.PluggableMap.prototype.setSize=function(e){this.set(ol.MapProperty.SIZE,e)};ol.PluggableMap.prototype.setTarget=function(e){this.set(ol.MapProperty.TARGET,e)};ol.PluggableMap.prototype.setView=function(e){this.set(ol.MapProperty.VIEW,e)};ol.PluggableMap.prototype.skipFeature=function(e){e=ol.getUid(e).toString();this.skippedFeatureUids_[e]=!0;this.render()};ol.PluggableMap.prototype.updateSize=function(){var e=this.getTargetElement();if(e){var t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}else this.setSize(void 0)};ol.PluggableMap.prototype.unskipFeature=function(e){e=ol.getUid(e).toString();delete this.skippedFeatureUids_[e];this.render()};ol.PluggableMap.DEFAULT_RENDERER_TYPES=[ol.renderer.Type.CANVAS,ol.renderer.Type.WEBGL];ol.PluggableMap.LOGO_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC";ol.PluggableMap.createOptionsInternal=function(e){var t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);var o,r={},n={};if(void 0===e.logo||"boolean"==typeof e.logo&&e.logo)n[ol.PluggableMap.LOGO_URL]="https://openlayers.org/";else{var i=e.logo;"string"==typeof i?n[i]="":i instanceof HTMLElement?n[ol.getUid(i).toString()]=i:i&&(ol.asserts.assert("string"==typeof i.href,44),ol.asserts.assert("string"==typeof i.src,45),n[i.src]=i.href)}i=e.layers instanceof ol.layer.Group?e.layers:new ol.layer.Group({layers:e.layers});r[ol.MapProperty.LAYERGROUP]=i;r[ol.MapProperty.TARGET]=e.target;r[ol.MapProperty.VIEW]=void 0!==e.view?e.view:new ol.View;void 0!==e.renderer?(Array.isArray(e.renderer)?o=e.renderer:"string"==typeof e.renderer?o=[e.renderer]:ol.asserts.assert(!1,46),0<=o.indexOf("dom")&&(o=o.concat(ol.PluggableMap.DEFAULT_RENDERER_TYPES))):o=ol.PluggableMap.DEFAULT_RENDERER_TYPES;i=ol.plugins.getMapRendererPlugins();var a=0,s=o.length;e:for(;a<s;++a)for(var l=o[a],c=0,u=i.length;c<u;++c){var h=i[c];if(h.handles(l)){var d=h;break e}}if(!d)throw Error("Unable to create a map renderer for types: "+o.join(", "));if(void 0!==e.controls)if(Array.isArray(e.controls))var p=new ol.Collection(e.controls.slice());else ol.asserts.assert(e.controls instanceof ol.Collection,47),p=e.controls;if(void 0!==e.interactions)if(Array.isArray(e.interactions))var f=new ol.Collection(e.interactions.slice());else ol.asserts.assert(e.interactions instanceof ol.Collection,48),f=e.interactions;void 0!==e.overlays?Array.isArray(e.overlays)?e=new ol.Collection(e.overlays.slice()):(ol.asserts.assert(e.overlays instanceof ol.Collection,49),e=e.overlays):e=new ol.Collection;return{controls:p,interactions:f,keyboardEventTarget:t,logos:n,overlays:e,mapRendererPlugin:d,values:r}};ol.control={};ol.control.Control=function(e){ol.Object.call(this);this.element=e.element?e.element:null;this.map_=this.target_=null;this.listenerKeys=[];this.render=e.render?e.render:ol.nullFunction;e.target&&this.setTarget(e.target)};ol.inherits(ol.control.Control,ol.Object);ol.control.Control.prototype.disposeInternal=function(){ol.dom.removeNode(this.element);ol.Object.prototype.disposeInternal.call(this)};ol.control.Control.prototype.getMap=function(){return this.map_};ol.control.Control.prototype.setMap=function(e){this.map_&&ol.dom.removeNode(this.element);for(var t=0,o=this.listenerKeys.length;t<o;++t)ol.events.unlistenByKey(this.listenerKeys[t]);this.listenerKeys.length=0;(this.map_=e)&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ol.nullFunction&&this.listenerKeys.push(ol.events.listen(e,ol.MapEventType.POSTRENDER,this.render,this)),e.render())};ol.control.Control.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e};ol.css={};ol.css.CLASS_HIDDEN="ol-hidden";ol.css.CLASS_SELECTABLE="ol-selectable";ol.css.CLASS_UNSELECTABLE="ol-unselectable";ol.css.CLASS_UNSUPPORTED="ol-unsupported";ol.css.CLASS_CONTROL="ol-control";ol.css.getFontFamilies=function(){var e,t={};return function(o){e||(e=document.createElement("div").style);if(!(o in t)){e.font=o;var r=e.fontFamily;e.font="";if(!r)return null;t[o]=r.split(/,\s?/)}return t[o]}}();ol.render={};ol.render.EventType={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render"};ol.layer.Layer=function(e){var t=ol.obj.assign({},e);delete t.source;ol.layer.Base.call(this,t);this.sourceChangeKey_=this.mapRenderKey_=this.mapPrecomposeKey_=null;e.map&&this.setMap(e.map);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Property.SOURCE),this.handleSourcePropertyChange_,this);this.setSource(e.source?e.source:null)};ol.inherits(ol.layer.Layer,ol.layer.Base);ol.layer.Layer.visibleAtResolution=function(e,t){return e.visible&&t>=e.minResolution&&t<e.maxResolution};ol.layer.Layer.prototype.getLayersArray=function(e){(e=e||[]).push(this);return e};ol.layer.Layer.prototype.getLayerStatesArray=function(e){(e=e||[]).push(this.getLayerState());return e};ol.layer.Layer.prototype.getSource=function(){return this.get(ol.layer.Property.SOURCE)||null};ol.layer.Layer.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():ol.source.State.UNDEFINED};ol.layer.Layer.prototype.handleSourceChange_=function(){this.changed()};ol.layer.Layer.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(ol.events.unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleSourceChange_,this));this.changed()};ol.layer.Layer.prototype.setMap=function(e){this.mapPrecomposeKey_&&(ol.events.unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null);e||this.changed();this.mapRenderKey_&&(ol.events.unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null);e&&(this.mapPrecomposeKey_=ol.events.listen(e,ol.render.EventType.PRECOMPOSE,function(e){var t=this.getLayerState();t.managed=!1;t.zIndex=1/0;e.frameState.layerStatesArray.push(t);e.frameState.layerStates[ol.getUid(this)]=t},this),this.mapRenderKey_=ol.events.listen(this,ol.events.EventType.CHANGE,e.render,e),this.changed())};ol.layer.Layer.prototype.setSource=function(e){this.set(ol.layer.Property.SOURCE,e)};ol.control.Attribution=function(e){e=e||{};this.ulElement_=document.createElement("UL");this.logoLi_=document.createElement("LI");this.ulElement_.appendChild(this.logoLi_);this.logoLi_.style.display="none";this.collapsed_=void 0===e.collapsed||e.collapsed;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var t=void 0!==e.className?e.className:"ol-attribution",o=void 0!==e.tipLabel?e.tipLabel:"Attributions",r=void 0!==e.collapseLabel?e.collapseLabel:"\xbb";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;"string"==typeof(r=void 0!==e.label?e.label:"i")?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;var n=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;(r=document.createElement("button")).setAttribute("type","button");r.title=o;r.appendChild(n);ol.events.listen(r,ol.events.EventType.CLICK,this.handleClick_,this);t=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible");(o=document.createElement("div")).className=t;o.appendChild(this.ulElement_);o.appendChild(r);ol.control.Control.call(this,{element:o,render:e.render?e.render:ol.control.Attribution.render,target:e.target});this.renderedAttributions_=[];this.renderedVisible_=!0;this.logoElements_={}};ol.inherits(ol.control.Attribution,ol.control.Control);ol.control.Attribution.prototype.getSourceAttributions_=function(e){for(var t={},o=[],r=e.layerStatesArray,n=e.viewState.resolution,i=0,a=r.length;i<a;++i){var s=r[i];if(ol.layer.Layer.visibleAtResolution(s,n)&&(s=s.layer.getSource())&&(s=s.getAttributions2())&&(s=s(e)))if(Array.isArray(s))for(var l=0,c=s.length;l<c;++l)s[l]in t||(o.push(s[l]),t[s[l]]=!0);else s in t||(o.push(s),t[s]=!0)}return o};ol.control.Attribution.render=function(e){this.updateElement_(e.frameState)};ol.control.Attribution.prototype.updateElement_=function(e){if(e){var t=this.getSourceAttributions_(e);if(!ol.array.equals(t,this.renderedAttributions_)){for(;this.ulElement_.lastChild!==this.logoLi_;)this.ulElement_.removeChild(this.ulElement_.lastChild);for(var o=0,r=t.length;o<r;++o){var n=document.createElement("LI");n.innerHTML=t[o];this.ulElement_.appendChild(n)}0===t.length&&0<this.renderedAttributions_.length?this.element.classList.add("ol-logo-only"):0===this.renderedAttributions_.length&&0<t.length&&this.element.classList.remove("ol-logo-only");o=0<t.length||!ol.obj.isEmpty(e.logos);this.renderedVisible_!=o&&(this.element.style.display=o?"":"none",this.renderedVisible_=o);this.renderedAttributions_=t;this.insertLogos_(e)}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)};ol.control.Attribution.prototype.insertLogos_=function(e){e=e.logos;var t,o=this.logoElements_;for(n in o)n in e||(ol.dom.removeNode(o[n]),delete o[n]);for(t in e){var r=e[t];r instanceof HTMLElement&&(this.logoLi_.appendChild(r),o[t]=r);if(!(t in o)){var n=new Image;n.src=t;if(""===r)var i=n;else(i=document.createElement("a")).href=r,i.appendChild(n);this.logoLi_.appendChild(i);o[t]=i}}this.logoLi_.style.display=ol.obj.isEmpty(e)?"none":""};ol.control.Attribution.prototype.handleClick_=function(e){e.preventDefault();this.handleToggle_()};ol.control.Attribution.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed");this.collapsed_?ol.dom.replaceNode(this.collapseLabel_,this.label_):ol.dom.replaceNode(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_};ol.control.Attribution.prototype.getCollapsible=function(){return this.collapsible_};ol.control.Attribution.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())};ol.control.Attribution.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()};ol.control.Attribution.prototype.getCollapsed=function(){return this.collapsed_};ol.control.Rotate=function(e){var t=void 0!==(e=e||{}).className?e.className:"ol-rotate",o=void 0!==e.label?e.label:"\u21e7";this.label_=null;"string"==typeof o?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=o):(this.label_=o,this.label_.classList.add("ol-compass"));var r=e.tipLabel?e.tipLabel:"Reset rotation";(o=document.createElement("button")).className=t+"-reset";o.setAttribute("type","button");o.title=r;o.appendChild(this.label_);ol.events.listen(o,ol.events.EventType.CLICK,ol.control.Rotate.prototype.handleClick_,this);r=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL;(t=document.createElement("div")).className=r;t.appendChild(o);o=e.render?e.render:ol.control.Rotate.render;this.callResetNorth_=e.resetNorth?e.resetNorth:void 0;ol.control.Control.call(this,{element:t,render:o,target:e.target});this.duration_=void 0!==e.duration?e.duration:250;this.autoHide_=void 0===e.autoHide||e.autoHide;this.rotation_=void 0;this.autoHide_&&this.element.classList.add(ol.css.CLASS_HIDDEN)};ol.inherits(ol.control.Rotate,ol.control.Control);ol.control.Rotate.prototype.handleClick_=function(e){e.preventDefault();void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()};ol.control.Rotate.prototype.resetNorth_=function(){var e=this.getMap().getView();e&&void 0!==e.getRotation()&&(0<this.duration_?e.animate({rotation:0,duration:this.duration_,easing:ol.easing.easeOut}):e.setRotation(0))};ol.control.Rotate.render=function(e){if(e=e.frameState){if((e=e.viewState.rotation)!=this.rotation_){var t="rotate("+e+"rad)";if(this.autoHide_){var o=this.element.classList.contains(ol.css.CLASS_HIDDEN);o||0!==e?o&&0!==e&&this.element.classList.remove(ol.css.CLASS_HIDDEN):this.element.classList.add(ol.css.CLASS_HIDDEN)}this.label_.style.msTransform=t;this.label_.style.webkitTransform=t;this.label_.style.transform=t}this.rotation_=e}};ol.control.Zoom=function(e){var t=void 0!==(e=e||{}).className?e.className:"ol-zoom",o=void 0!==e.delta?e.delta:1,r=void 0!==e.zoomInLabel?e.zoomInLabel:"+",n=void 0!==e.zoomOutLabel?e.zoomOutLabel:"\u2212",i=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",a=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",s=document.createElement("button");s.className=t+"-in";s.setAttribute("type","button");s.title=i;s.appendChild("string"==typeof r?document.createTextNode(r):r);ol.events.listen(s,ol.events.EventType.CLICK,ol.control.Zoom.prototype.handleClick_.bind(this,o));(r=document.createElement("button")).className=t+"-out";r.setAttribute("type","button");r.title=a;r.appendChild("string"==typeof n?document.createTextNode(n):n);ol.events.listen(r,ol.events.EventType.CLICK,ol.control.Zoom.prototype.handleClick_.bind(this,-o));t=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL;(o=document.createElement("div")).className=t;o.appendChild(s);o.appendChild(r);ol.control.Control.call(this,{element:o,target:e.target});this.duration_=void 0!==e.duration?e.duration:250};ol.inherits(ol.control.Zoom,ol.control.Control);ol.control.Zoom.prototype.handleClick_=function(e,t){t.preventDefault();this.zoomByDelta_(e)};ol.control.Zoom.prototype.zoomByDelta_=function(e){var t=this.getMap().getView();if(t){var o=t.getResolution();o&&(e=t.constrainResolution(o,e),0<this.duration_?(t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:e,duration:this.duration_,easing:ol.easing.easeOut})):t.setResolution(e))}};ol.control.defaults=function(e){e=e||{};var t=new ol.Collection;(void 0===e.zoom||e.zoom)&&t.push(new ol.control.Zoom(e.zoomOptions));(void 0===e.rotate||e.rotate)&&t.push(new ol.control.Rotate(e.rotateOptions));(void 0===e.attribution||e.attribution)&&t.push(new ol.control.Attribution(e.attributionOptions));return t};ol.Kinetic=function(e,t,o){this.decay_=e;this.minVelocity_=t;this.delay_=o;this.points_=[];this.initialVelocity_=this.angle_=0};ol.Kinetic.prototype.begin=function(){this.initialVelocity_=this.angle_=this.points_.length=0};ol.Kinetic.prototype.update=function(e,t){this.points_.push(e,t,Date.now())};ol.Kinetic.prototype.end=function(){if(6>this.points_.length)return!1;var e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;for(var o=t-3;0<o&&this.points_[o+2]>e;)o-=3;if((e=this.points_[t+2]-this.points_[o+2])<1e3/60)return!1;var r=this.points_[t]-this.points_[o];t=this.points_[t+1]-this.points_[o+1];this.angle_=Math.atan2(t,r);this.initialVelocity_=Math.sqrt(r*r+t*t)/e;return this.initialVelocity_>this.minVelocity_};ol.Kinetic.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_};ol.Kinetic.prototype.getAngle=function(){return this.angle_};ol.interaction={};ol.interaction.Property={ACTIVE:"active"};ol.interaction.Interaction=function(e){ol.Object.call(this);this.map_=null;this.setActive(!0);this.handleEvent=e.handleEvent};ol.inherits(ol.interaction.Interaction,ol.Object);ol.interaction.Interaction.prototype.getActive=function(){return this.get(ol.interaction.Property.ACTIVE)};ol.interaction.Interaction.prototype.getMap=function(){return this.map_};ol.interaction.Interaction.prototype.setActive=function(e){this.set(ol.interaction.Property.ACTIVE,e)};ol.interaction.Interaction.prototype.setMap=function(e){this.map_=e};ol.interaction.Interaction.pan=function(e,t,o){var r=e.getCenter();r&&(t=e.constrainCenter([r[0]+t[0],r[1]+t[1]]),o?e.animate({duration:o,easing:ol.easing.linear,center:t}):e.setCenter(t))};ol.interaction.Interaction.rotate=function(e,t,o,r){t=e.constrainRotation(t,0);ol.interaction.Interaction.rotateWithoutConstraints(e,t,o,r)};ol.interaction.Interaction.rotateWithoutConstraints=function(e,t,o,r){if(void 0!==t){var n=e.getRotation(),i=e.getCenter();void 0!==n&&i&&0<r?e.animate({rotation:t,anchor:o,duration:r,easing:ol.easing.easeOut}):e.rotate(t,o)}};ol.interaction.Interaction.zoom=function(e,t,o,r,n){t=e.constrainResolution(t,0,n);ol.interaction.Interaction.zoomWithoutConstraints(e,t,o,r)};ol.interaction.Interaction.zoomByDelta=function(e,t,o,r){var n=e.getResolution();if(void 0!==(t=e.constrainResolution(n,t,0))){var i=e.getResolutions();t=ol.math.clamp(t,e.getMinResolution()||i[i.length-1],e.getMaxResolution()||i[0])}o&&void 0!==t&&t!==n&&(i=e.getCenter(),o=e.calculateCenterZoom(t,o),o=e.constrainCenter(o),o=[(t*i[0]-n*o[0])/(t-n),(t*i[1]-n*o[1])/(t-n)]);ol.interaction.Interaction.zoomWithoutConstraints(e,t,o,r)};ol.interaction.Interaction.zoomWithoutConstraints=function(e,t,o,r){if(t){var n=e.getResolution(),i=e.getCenter();void 0!==n&&i&&t!==n&&r?e.animate({resolution:t,anchor:o,duration:r,easing:ol.easing.easeOut}):(o&&(o=e.calculateCenterZoom(t,o),e.setCenter(o)),e.setResolution(t))}};ol.interaction.DoubleClickZoom=function(e){e=e||{};this.delta_=e.delta?e.delta:1;ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.DoubleClickZoom.handleEvent});this.duration_=void 0!==e.duration?e.duration:250};ol.inherits(ol.interaction.DoubleClickZoom,ol.interaction.Interaction);ol.interaction.DoubleClickZoom.handleEvent=function(e){var t=!1,o=e.originalEvent;if(e.type==ol.MapBrowserEventType.DBLCLICK){t=e.coordinate;o=o.shiftKey?-this.delta_:this.delta_;var r=e.map.getView();ol.interaction.Interaction.zoomByDelta(r,o,t,this.duration_);e.preventDefault();t=!0}return!t};ol.events.condition={};ol.events.condition.altKeyOnly=function(e){return(e=e.originalEvent).altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey};ol.events.condition.altShiftKeysOnly=function(e){return(e=e.originalEvent).altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey};ol.events.condition.always=ol.functions.TRUE;ol.events.condition.click=function(e){return e.type==ol.MapBrowserEventType.CLICK};ol.events.condition.mouseActionButton=function(e){return 0==(e=e.originalEvent).button&&!(ol.has.WEBKIT&&ol.has.MAC&&e.ctrlKey)};ol.events.condition.never=ol.functions.FALSE;ol.events.condition.pointerMove=function(e){return"pointermove"==e.type};ol.events.condition.singleClick=function(e){return e.type==ol.MapBrowserEventType.SINGLECLICK};ol.events.condition.doubleClick=function(e){return e.type==ol.MapBrowserEventType.DBLCLICK};ol.events.condition.noModifierKeys=function(e){return!(e=e.originalEvent).altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey};ol.events.condition.platformModifierKeyOnly=function(e){return!(e=e.originalEvent).altKey&&(ol.has.MAC?e.metaKey:e.ctrlKey)&&!e.shiftKey};ol.events.condition.shiftKeyOnly=function(e){return!(e=e.originalEvent).altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey};ol.events.condition.targetNotEditable=function(e){return"INPUT"!==(e=e.originalEvent.target.tagName)&&"SELECT"!==e&&"TEXTAREA"!==e};ol.events.condition.mouseOnly=function(e){ol.asserts.assert(e.pointerEvent,56);return"mouse"==e.pointerEvent.pointerType};ol.events.condition.primaryAction=function(e){return(e=e.pointerEvent).isPrimary&&0===e.button};ol.interaction.Pointer=function(e){e=e||{};ol.interaction.Interaction.call(this,{handleEvent:e.handleEvent?e.handleEvent:ol.interaction.Pointer.handleEvent});this.handleDownEvent_=e.handleDownEvent?e.handleDownEvent:ol.interaction.Pointer.handleDownEvent;this.handleDragEvent_=e.handleDragEvent?e.handleDragEvent:ol.interaction.Pointer.handleDragEvent;this.handleMoveEvent_=e.handleMoveEvent?e.handleMoveEvent:ol.interaction.Pointer.handleMoveEvent;this.handleUpEvent_=e.handleUpEvent?e.handleUpEvent:ol.interaction.Pointer.handleUpEvent;this.handlingDownUpSequence=!1;this.trackedPointers_={};this.targetPointers=[]};ol.inherits(ol.interaction.Pointer,ol.interaction.Interaction);ol.interaction.Pointer.centroid=function(e){for(var t=e.length,o=0,r=0,n=0;n<t;n++)o+=e[n].clientX,r+=e[n].clientY;return[o/t,r/t]};ol.interaction.Pointer.prototype.isPointerDraggingEvent_=function(e){return(e=e.type)===ol.MapBrowserEventType.POINTERDOWN||e===ol.MapBrowserEventType.POINTERDRAG||e===ol.MapBrowserEventType.POINTERUP};ol.interaction.Pointer.prototype.updateTrackedPointers_=function(e){if(this.isPointerDraggingEvent_(e)){var t=e.pointerEvent,o=t.pointerId.toString();e.type==ol.MapBrowserEventType.POINTERUP?delete this.trackedPointers_[o]:e.type==ol.MapBrowserEventType.POINTERDOWN?this.trackedPointers_[o]=t:o in this.trackedPointers_&&(this.trackedPointers_[o]=t);this.targetPointers=ol.obj.getValues(this.trackedPointers_)}};ol.interaction.Pointer.handleDragEvent=ol.nullFunction;ol.interaction.Pointer.handleUpEvent=ol.functions.FALSE;ol.interaction.Pointer.handleDownEvent=ol.functions.FALSE;ol.interaction.Pointer.handleMoveEvent=ol.nullFunction;ol.interaction.Pointer.handleEvent=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;var t=!1;this.updateTrackedPointers_(e);this.handlingDownUpSequence?e.type==ol.MapBrowserEventType.POINTERDRAG?this.handleDragEvent_(e):e.type==ol.MapBrowserEventType.POINTERUP&&(this.handlingDownUpSequence=this.handleUpEvent_(e)&&0<this.targetPointers.length):e.type==ol.MapBrowserEventType.POINTERDOWN?(this.handlingDownUpSequence=e=this.handleDownEvent_(e),t=this.shouldStopEvent(e)):e.type==ol.MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent_(e);return!t};ol.interaction.Pointer.prototype.shouldStopEvent=function(e){return e};ol.interaction.DragPan=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragPan.handleDownEvent_,handleDragEvent:ol.interaction.DragPan.handleDragEvent_,handleUpEvent:ol.interaction.DragPan.handleUpEvent_});e=e||{};this.kinetic_=e.kinetic;this.lastCentroid=null;this.condition_=e.condition?e.condition:ol.events.condition.noModifierKeys;this.noKinetic_=!1};ol.inherits(ol.interaction.DragPan,ol.interaction.Pointer);ol.interaction.DragPan.handleDragEvent_=function(e){var t=this.targetPointers,o=ol.interaction.Pointer.centroid(t);if(t.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){var r=this.lastCentroid[0]-o[0],n=o[1]-this.lastCentroid[1],i=(e=e.map.getView()).getState();r=[r,n];ol.coordinate.scale(r,i.resolution);ol.coordinate.rotate(r,i.rotation);ol.coordinate.add(r,i.center);r=e.constrainCenter(r);e.setCenter(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o;this.lastPointersCount_=t.length};ol.interaction.DragPan.handleUpEvent_=function(e){var t=e.map;e=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),n=e.getCenter();n=t.getPixelFromCoordinate(n);t=t.getCoordinateFromPixel([n[0]-o*Math.cos(r),n[1]-o*Math.sin(r)]);e.animate({center:e.constrainCenter(t),duration:500,easing:ol.easing.easeOut})}e.setHint(ol.ViewHint.INTERACTING,-1);return!1}this.kinetic_&&this.kinetic_.begin();this.lastCentroid=null;return!0};ol.interaction.DragPan.handleDownEvent_=function(e){if(0<this.targetPointers.length&&this.condition_(e)){var t=e.map.getView();this.lastCentroid=null;this.handlingDownUpSequence||t.setHint(ol.ViewHint.INTERACTING,1);t.getAnimating()&&t.setCenter(e.frameState.viewState.center);this.kinetic_&&this.kinetic_.begin();this.noKinetic_=1<this.targetPointers.length;return!0}return!1};ol.interaction.DragPan.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.DragRotate=function(e){e=e||{};ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragRotate.handleDownEvent_,handleDragEvent:ol.interaction.DragRotate.handleDragEvent_,handleUpEvent:ol.interaction.DragRotate.handleUpEvent_});this.condition_=e.condition?e.condition:ol.events.condition.altShiftKeysOnly;this.lastAngle_=void 0;this.duration_=void 0!==e.duration?e.duration:250};ol.inherits(ol.interaction.DragRotate,ol.interaction.Pointer);ol.interaction.DragRotate.handleDragEvent_=function(e){if(ol.events.condition.mouseOnly(e)){var t=e.map,o=t.getView();if(o.getConstraints().rotation!==ol.RotationConstraint.disable){t=t.getSize();e=e.pixel;e=Math.atan2(t[1]/2-e[1],e[0]-t[0]/2);if(void 0!==this.lastAngle_){t=e-this.lastAngle_;var r=o.getRotation();ol.interaction.Interaction.rotateWithoutConstraints(o,r-t)}this.lastAngle_=e}}};ol.interaction.DragRotate.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;(e=e.map.getView()).setHint(ol.ViewHint.INTERACTING,-1);var t=e.getRotation();ol.interaction.Interaction.rotate(e,t,void 0,this.duration_);return!1};ol.interaction.DragRotate.handleDownEvent_=function(e){return!!(ol.events.condition.mouseOnly(e)&&ol.events.condition.mouseActionButton(e)&&this.condition_(e))&&(e.map.getView().setHint(ol.ViewHint.INTERACTING,1),this.lastAngle_=void 0,!0)};ol.interaction.DragRotate.prototype.shouldStopEvent=ol.functions.FALSE;ol.render.Box=function(e){this.geometry_=null;this.element_=document.createElement("div");this.element_.style.position="absolute";this.element_.className="ol-box "+e;this.endPixel_=this.startPixel_=this.map_=null};ol.inherits(ol.render.Box,ol.Disposable);ol.render.Box.prototype.disposeInternal=function(){this.setMap(null)};ol.render.Box.prototype.render_=function(){var e=this.startPixel_,t=this.endPixel_,o=this.element_.style;o.left=Math.min(e[0],t[0])+"px";o.top=Math.min(e[1],t[1])+"px";o.width=Math.abs(t[0]-e[0])+"px";o.height=Math.abs(t[1]-e[1])+"px"};ol.render.Box.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var t=this.element_.style;t.left=t.top=t.width=t.height="inherit"}(this.map_=e)&&this.map_.getOverlayContainer().appendChild(this.element_)};ol.render.Box.prototype.setPixels=function(e,t){this.startPixel_=e;this.endPixel_=t;this.createOrUpdateGeometry();this.render_()};ol.render.Box.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,t=this.endPixel_;(e=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixel,this.map_))[4]=e[0].slice();this.geometry_?this.geometry_.setCoordinates([e]):this.geometry_=new ol.geom.Polygon([e])};ol.render.Box.prototype.getGeometry=function(){return this.geometry_};ol.interaction.DragBox=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragBox.handleDownEvent_,handleDragEvent:ol.interaction.DragBox.handleDragEvent_,handleUpEvent:ol.interaction.DragBox.handleUpEvent_});e=e||{};this.box_=new ol.render.Box(e.className||"ol-dragbox");this.minArea_=void 0!==e.minArea?e.minArea:64;this.startPixel_=null;this.condition_=e.condition?e.condition:ol.events.condition.always;this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:ol.interaction.DragBox.defaultBoxEndCondition};ol.inherits(ol.interaction.DragBox,ol.interaction.Pointer);ol.interaction.DragBox.defaultBoxEndCondition=function(e,t,o){return(e=o[0]-t[0])*e+(t=o[1]-t[1])*t>=this.minArea_};ol.interaction.DragBox.handleDragEvent_=function(e){ol.events.condition.mouseOnly(e)&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXDRAG,e.coordinate,e)))};ol.interaction.DragBox.prototype.getGeometry=function(){return this.box_.getGeometry()};ol.interaction.DragBox.prototype.onBoxEnd=ol.nullFunction;ol.interaction.DragBox.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;this.box_.setMap(null);this.boxEndCondition_(e,this.startPixel_,e.pixel)&&(this.onBoxEnd(e),this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXEND,e.coordinate,e)));return!1};ol.interaction.DragBox.handleDownEvent_=function(e){return!!(ol.events.condition.mouseOnly(e)&&ol.events.condition.mouseActionButton(e)&&this.condition_(e))&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXSTART,e.coordinate,e)),!0)};ol.interaction.DragBox.EventType_={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"};ol.interaction.DragBox.Event=function(e,t,o){ol.events.Event.call(this,e);this.coordinate=t;this.mapBrowserEvent=o};ol.inherits(ol.interaction.DragBox.Event,ol.events.Event);ol.interaction.DragZoom=function(e){var t=(e=e||{}).condition?e.condition:ol.events.condition.shiftKeyOnly;this.duration_=void 0!==e.duration?e.duration:200;this.out_=void 0!==e.out&&e.out;ol.interaction.DragBox.call(this,{condition:t,className:e.className||"ol-dragzoom"})};ol.inherits(ol.interaction.DragZoom,ol.interaction.DragBox);ol.interaction.DragZoom.prototype.onBoxEnd=function(){var e=this.getMap(),t=e.getView(),o=e.getSize(),r=this.getGeometry().getExtent();if(this.out_){var n=t.calculateExtent(o);r=ol.extent.createOrUpdateFromCoordinates([e.getPixelFromCoordinate(ol.extent.getBottomLeft(r)),e.getPixelFromCoordinate(ol.extent.getTopRight(r))]);r=t.getResolutionForExtent(r,o);ol.extent.scaleFromCenter(n,1/r);r=n}o=t.constrainResolution(t.getResolutionForExtent(r,o));n=ol.extent.getCenter(r);n=t.constrainCenter(n);t.animate({resolution:o,center:n,duration:this.duration_,easing:ol.easing.easeOut})};ol.events.KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40};ol.interaction.KeyboardPan=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.KeyboardPan.handleEvent});e=e||{};this.defaultCondition_=function(e){return ol.events.condition.noModifierKeys(e)&&ol.events.condition.targetNotEditable(e)};this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_;this.duration_=void 0!==e.duration?e.duration:100;this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128};ol.inherits(ol.interaction.KeyboardPan,ol.interaction.Interaction);ol.interaction.KeyboardPan.handleEvent=function(e){var t=!1;if(e.type==ol.events.EventType.KEYDOWN){var o=e.originalEvent.keyCode;if(this.condition_(e)&&(o==ol.events.KeyCode.DOWN||o==ol.events.KeyCode.LEFT||o==ol.events.KeyCode.RIGHT||o==ol.events.KeyCode.UP)){var r=(t=e.map.getView()).getResolution()*this.pixelDelta_,n=0,i=0;o==ol.events.KeyCode.DOWN?i=-r:o==ol.events.KeyCode.LEFT?n=-r:o==ol.events.KeyCode.RIGHT?n=r:i=r;o=[n,i];ol.coordinate.rotate(o,t.getRotation());ol.interaction.Interaction.pan(t,o,this.duration_);e.preventDefault();t=!0}}return!t};ol.interaction.KeyboardZoom=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.KeyboardZoom.handleEvent});e=e||{};this.condition_=e.condition?e.condition:ol.events.condition.targetNotEditable;this.delta_=e.delta?e.delta:1;this.duration_=void 0!==e.duration?e.duration:100};ol.inherits(ol.interaction.KeyboardZoom,ol.interaction.Interaction);ol.interaction.KeyboardZoom.handleEvent=function(e){var t=!1;if(e.type==ol.events.EventType.KEYDOWN||e.type==ol.events.EventType.KEYPRESS){var o=e.originalEvent.charCode;!this.condition_(e)||43!=o&&45!=o||(t=43==o?this.delta_:-this.delta_,o=e.map.getView(),ol.interaction.Interaction.zoomByDelta(o,t,void 0,this.duration_),e.preventDefault(),t=!0)}return!t};ol.interaction.MouseWheelZoom=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.MouseWheelZoom.handleEvent});e=e||{};this.delta_=0;this.duration_=void 0!==e.duration?e.duration:250;this.timeout_=void 0!==e.timeout?e.timeout:80;this.useAnchor_=void 0===e.useAnchor||e.useAnchor;this.constrainResolution_=e.constrainResolution||!1;this.lastAnchor_=null;this.mode_=this.timeoutId_=this.startTime_=void 0;this.trackpadEventGap_=400;this.trackpadTimeoutId_=void 0;this.trackpadDeltaPerZoom_=300;this.trackpadZoomBuffer_=1.5};ol.inherits(ol.interaction.MouseWheelZoom,ol.interaction.Interaction);ol.interaction.MouseWheelZoom.handleEvent=function(e){var t=e.type;if(t!==ol.events.EventType.WHEEL&&t!==ol.events.EventType.MOUSEWHEEL)return!0;e.preventDefault();t=e.map;var o=e.originalEvent;this.useAnchor_&&(this.lastAnchor_=e.coordinate);if(e.type==ol.events.EventType.WHEEL){var r=o.deltaY;ol.has.FIREFOX&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=ol.has.DEVICE_PIXEL_RATIO);o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)}else e.type==ol.events.EventType.MOUSEWHEEL&&(r=-o.wheelDeltaY,ol.has.SAFARI&&(r/=3));if(0===r)return!1;e=Date.now();void 0===this.startTime_&&(this.startTime_=e);(!this.mode_||e-this.startTime_>this.trackpadEventGap_)&&(this.mode_=4>Math.abs(r)?ol.interaction.MouseWheelZoom.Mode_.TRACKPAD:ol.interaction.MouseWheelZoom.Mode_.WHEEL);if(this.mode_===ol.interaction.MouseWheelZoom.Mode_.TRACKPAD){t=t.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):t.setHint(ol.ViewHint.INTERACTING,1);this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);o=t.getResolution()*Math.pow(2,r/this.trackpadDeltaPerZoom_);var n=t.getMinResolution(),i=t.getMaxResolution(),a=0;o<n?(o=Math.max(o,n/this.trackpadZoomBuffer_),a=1):o>i&&(o=Math.min(o,i*this.trackpadZoomBuffer_),a=-1);if(this.lastAnchor_){var s=t.calculateCenterZoom(o,this.lastAnchor_);t.setCenter(t.constrainCenter(s))}t.setResolution(o);0===a&&this.constrainResolution_&&t.animate({resolution:t.constrainResolution(o,0<r?-1:1),easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:this.duration_});0<a?t.animate({resolution:n,easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:500}):0>a&&t.animate({resolution:i,easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:500});this.startTime_=e;return!1}this.delta_+=r;r=Math.max(this.timeout_-(e-this.startTime_),0);clearTimeout(this.timeoutId_);this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),r);return!1};ol.interaction.MouseWheelZoom.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;this.getMap().getView().setHint(ol.ViewHint.INTERACTING,-1)};ol.interaction.MouseWheelZoom.prototype.handleWheelZoom_=function(e){(e=e.getView()).getAnimating()&&e.cancelAnimations();var t=ol.MOUSEWHEELZOOM_MAXDELTA;t=ol.math.clamp(this.delta_,-t,t);ol.interaction.Interaction.zoomByDelta(e,-t,this.lastAnchor_,this.duration_);this.mode_=void 0;this.delta_=0;this.lastAnchor_=null;this.timeoutId_=this.startTime_=void 0};ol.interaction.MouseWheelZoom.prototype.setMouseAnchor=function(e){this.useAnchor_=e;e||(this.lastAnchor_=null)};ol.interaction.MouseWheelZoom.Mode_={TRACKPAD:"trackpad",WHEEL:"wheel"};ol.interaction.PinchRotate=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.PinchRotate.handleDownEvent_,handleDragEvent:ol.interaction.PinchRotate.handleDragEvent_,handleUpEvent:ol.interaction.PinchRotate.handleUpEvent_});e=e||{};this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.threshold_=void 0!==e.threshold?e.threshold:.3;this.duration_=void 0!==e.duration?e.duration:250};ol.inherits(ol.interaction.PinchRotate,ol.interaction.Pointer);ol.interaction.PinchRotate.handleDragEvent_=function(e){var t=0,o=this.targetPointers[0],r=this.targetPointers[1];o=Math.atan2(r.clientY-o.clientY,r.clientX-o.clientX);void 0!==this.lastAngle_&&(t=o-this.lastAngle_,this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0));this.lastAngle_=o;if((o=(e=e.map).getView()).getConstraints().rotation!==ol.RotationConstraint.disable){r=e.getViewport().getBoundingClientRect();var n=ol.interaction.Pointer.centroid(this.targetPointers);n[0]-=r.left;n[1]-=r.top;this.anchor_=e.getCoordinateFromPixel(n);this.rotating_&&(r=o.getRotation(),e.render(),ol.interaction.Interaction.rotateWithoutConstraints(o,r+t,this.anchor_))}};ol.interaction.PinchRotate.handleUpEvent_=function(e){if(2>this.targetPointers.length){(e=e.map.getView()).setHint(ol.ViewHint.INTERACTING,-1);if(this.rotating_){var t=e.getRotation();ol.interaction.Interaction.rotate(e,t,this.anchor_,this.duration_)}return!1}return!0};ol.interaction.PinchRotate.handleDownEvent_=function(e){return 2<=this.targetPointers.length&&(e=e.map,this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().setHint(ol.ViewHint.INTERACTING,1),!0)};ol.interaction.PinchRotate.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.PinchZoom=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.PinchZoom.handleDownEvent_,handleDragEvent:ol.interaction.PinchZoom.handleDragEvent_,handleUpEvent:ol.interaction.PinchZoom.handleUpEvent_});e=e||{};this.constrainResolution_=e.constrainResolution||!1;this.anchor_=null;this.duration_=void 0!==e.duration?e.duration:400;this.lastDistance_=void 0;this.lastScaleDelta_=1};ol.inherits(ol.interaction.PinchZoom,ol.interaction.Pointer);ol.interaction.PinchZoom.handleDragEvent_=function(e){var t=1,o=this.targetPointers[0],r=this.targetPointers[1],n=o.clientX-r.clientX;o=o.clientY-r.clientY;n=Math.sqrt(n*n+o*o);void 0!==this.lastDistance_&&(t=this.lastDistance_/n);this.lastDistance_=n;r=(n=(e=e.map).getView()).getResolution();var i=n.getMaxResolution(),a=n.getMinResolution();(o=r*t)>i?(t=i/r,o=i):o<a&&(t=a/r,o=a);1!=t&&(this.lastScaleDelta_=t);t=e.getViewport().getBoundingClientRect();(r=ol.interaction.Pointer.centroid(this.targetPointers))[0]-=t.left;r[1]-=t.top;this.anchor_=e.getCoordinateFromPixel(r);e.render();ol.interaction.Interaction.zoomWithoutConstraints(n,o,this.anchor_)};ol.interaction.PinchZoom.handleUpEvent_=function(e){if(2>this.targetPointers.length){(e=e.map.getView()).setHint(ol.ViewHint.INTERACTING,-1);var t=e.getResolution();(this.constrainResolution_||t<e.getMinResolution()||t>e.getMaxResolution())&&ol.interaction.Interaction.zoom(e,t,this.anchor_,this.duration_,this.lastScaleDelta_-1);return!1}return!0};ol.interaction.PinchZoom.handleDownEvent_=function(e){return 2<=this.targetPointers.length&&(e=e.map,this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().setHint(ol.ViewHint.INTERACTING,1),!0)};ol.interaction.PinchZoom.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.defaults=function(e){e=e||{};var t=new ol.Collection,o=new ol.Kinetic(-.005,.05,100);(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&t.push(new ol.interaction.DragRotate);(void 0===e.doubleClickZoom||e.doubleClickZoom)&&t.push(new ol.interaction.DoubleClickZoom({delta:e.zoomDelta,duration:e.zoomDuration}));(void 0===e.dragPan||e.dragPan)&&t.push(new ol.interaction.DragPan({kinetic:o}));(void 0===e.pinchRotate||e.pinchRotate)&&t.push(new ol.interaction.PinchRotate);(void 0===e.pinchZoom||e.pinchZoom)&&t.push(new ol.interaction.PinchZoom({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));(void 0===e.keyboard||e.keyboard)&&(t.push(new ol.interaction.KeyboardPan),t.push(new ol.interaction.KeyboardZoom({delta:e.zoomDelta,duration:e.zoomDuration})));(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&t.push(new ol.interaction.MouseWheelZoom({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));(void 0===e.shiftDragZoom||e.shiftDragZoom)&&t.push(new ol.interaction.DragZoom({duration:e.zoomDuration}));return t};ol.ImageBase=function(e,t,o,r){ol.events.EventTarget.call(this);this.extent=e;this.pixelRatio_=o;this.resolution=t;this.state=r};ol.inherits(ol.ImageBase,ol.events.EventTarget);ol.ImageBase.prototype.changed=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.ImageBase.prototype.getExtent=function(){return this.extent};ol.ImageBase.prototype.getImage=function(){};ol.ImageBase.prototype.getPixelRatio=function(){return this.pixelRatio_};ol.ImageBase.prototype.getResolution=function(){return this.resolution};ol.ImageBase.prototype.getState=function(){return this.state};ol.ImageBase.prototype.load=function(){};ol.ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3};ol.ImageCanvas=function(e,t,o,r,n){this.loader_=void 0!==n?n:null;ol.ImageBase.call(this,e,t,o,void 0!==n?ol.ImageState.IDLE:ol.ImageState.LOADED);this.canvas_=r;this.error_=null};ol.inherits(ol.ImageCanvas,ol.ImageBase);ol.ImageCanvas.prototype.getError=function(){return this.error_};ol.ImageCanvas.prototype.handleLoad_=function(e){e?(this.error_=e,this.state=ol.ImageState.ERROR):this.state=ol.ImageState.LOADED;this.changed()};ol.ImageCanvas.prototype.load=function(){this.state==ol.ImageState.IDLE&&(this.state=ol.ImageState.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))};ol.ImageCanvas.prototype.getImage=function(){return this.canvas_};ol.LayerType={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"};ol.layer.VectorRenderType={IMAGE:"image",VECTOR:"vector"};ol.render.Event=function(e,t,o,r,n){ol.events.Event.call(this,e);this.vectorContext=t;this.frameState=o;this.context=r;this.glContext=n};ol.inherits(ol.render.Event,ol.events.Event);ol.structs.LRUCache=function(e){ol.events.EventTarget.call(this);this.highWaterMark=void 0!==e?e:2048;this.count_=0;this.entries_={};this.newest_=this.oldest_=null};ol.inherits(ol.structs.LRUCache,ol.events.EventTarget);ol.structs.LRUCache.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark};ol.structs.LRUCache.prototype.clear=function(){this.count_=0;this.entries_={};this.newest_=this.oldest_=null;this.dispatchEvent(ol.events.EventType.CLEAR)};ol.structs.LRUCache.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)};ol.structs.LRUCache.prototype.forEach=function(e,t){for(var o=this.oldest_;o;)e.call(t,o.value_,o.key_,this),o=o.newer};ol.structs.LRUCache.prototype.get=function(e){e=this.entries_[e];ol.asserts.assert(void 0!==e,15);if(e===this.newest_)return e.value_;e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer);e.newer=null;e.older=this.newest_;this.newest_=this.newest_.newer=e;return e.value_};ol.structs.LRUCache.prototype.remove=function(e){var t=this.entries_[e];ol.asserts.assert(void 0!==t,15);t===this.newest_?(this.newest_=t.older)&&(this.newest_.newer=null):t===this.oldest_?(this.oldest_=t.newer)&&(this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer);delete this.entries_[e];--this.count_;return t.value_};ol.structs.LRUCache.prototype.getCount=function(){return this.count_};ol.structs.LRUCache.prototype.getKeys=function(){var e,t=Array(this.count_),o=0;for(e=this.newest_;e;e=e.older)t[o++]=e.key_;return t};ol.structs.LRUCache.prototype.getValues=function(){var e,t=Array(this.count_),o=0;for(e=this.newest_;e;e=e.older)t[o++]=e.value_;return t};ol.structs.LRUCache.prototype.peekLast=function(){return this.oldest_.value_};ol.structs.LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_};ol.structs.LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_};ol.structs.LRUCache.prototype.pop=function(){var e=this.oldest_;delete this.entries_[e.key_];e.newer&&(e.newer.older=null);this.oldest_=e.newer;this.oldest_||(this.newest_=null);--this.count_;return e.value_};ol.structs.LRUCache.prototype.replace=function(e,t){this.get(e);this.entries_[e].value_=t};ol.structs.LRUCache.prototype.set=function(e,t){ol.asserts.assert(!(e in this.entries_),16);t={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=t:this.oldest_=t;this.newest_=t;this.entries_[e]=t;++this.count_};ol.structs.LRUCache.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};ol.render.canvas={};ol.render.canvas.defaultFont="10px sans-serif";ol.render.canvas.defaultFillStyle=[0,0,0,1];ol.render.canvas.defaultLineCap="round";ol.render.canvas.defaultLineDash=[];ol.render.canvas.defaultLineDashOffset=0;ol.render.canvas.defaultLineJoin="round";ol.render.canvas.defaultMiterLimit=10;ol.render.canvas.defaultStrokeStyle=[0,0,0,1];ol.render.canvas.defaultTextAlign="center";ol.render.canvas.defaultTextBaseline="middle";ol.render.canvas.defaultPadding=[0,0,0,0];ol.render.canvas.defaultLineWidth=1;ol.render.canvas.labelCache=new ol.structs.LRUCache;ol.render.canvas.checkedFonts_={};ol.render.canvas.measureContext_=null;ol.render.canvas.textHeights_={};ol.render.canvas.checkFont=function(){function e(e){var t=ol.render.canvas.getMeasureContext();t.font="32px monospace";r=t.measureText("wmytzilWMYTZIL@#/&?$%10").width;var o=!0;"monospace"!=e&&(t.font="32px "+e+",monospace",o=t.measureText("wmytzilWMYTZIL@#/&?$%10").width!=r);return o}function t(){var t,r=!0;for(t in n)60>n[t]&&(e(t)?(n[t]=60,ol.obj.clear(ol.render.canvas.textHeights_),ol.render.canvas.measureContext_=null,i.clear()):(++n[t],r=!1));r&&(window.clearInterval(o),o=void 0)}var o,r,n=ol.render.canvas.checkedFonts_,i=ol.render.canvas.labelCache;return function(r){if(r=ol.css.getFontFamilies(r))for(var i=0,a=r.length;i<a;++i){var s=r[i];s in n||(n[s]=60,e(s)||(n[s]=0,void 0===o&&(o=window.setInterval(t,32))))}}}();ol.render.canvas.getMeasureContext=function(){var e=ol.render.canvas.measureContext_;e||(e=ol.render.canvas.measureContext_=ol.dom.createCanvasContext2D(1,1));return e};ol.render.canvas.measureTextHeight=function(){var e,t=ol.render.canvas.textHeights_;return function(o){var r=t[o];void 0==r&&(e||((e=document.createElement("span")).textContent="M",e.style.margin=e.style.padding="0 !important",e.style.position="absolute !important",e.style.left="-99999px !important"),e.style.font=o,document.body.appendChild(e),r=t[o]=e.offsetHeight,document.body.removeChild(e));return r}}();ol.render.canvas.measureTextWidth=function(e,t){var o=ol.render.canvas.getMeasureContext();e!=o.font&&(o.font=e);return o.measureText(t).width};ol.render.canvas.rotateAtOffset=function(e,t,o,r){0!==t&&(e.translate(o,r),e.rotate(t),e.translate(-o,-r))};ol.render.canvas.resetTransform_=ol.transform.create();ol.render.canvas.drawImage=function(e,t,o,r,n,i,a,s,l,c,u){if(1!=o){var h=e.globalAlpha;e.globalAlpha=h*o}t&&e.setTransform.apply(e,t);e.drawImage(r,n,i,a,s,l,c,a*u,s*u);h&&(e.globalAlpha=h);t&&e.setTransform.apply(e,ol.render.canvas.resetTransform_)};ol.color={};ol.color.HEX_COLOR_RE_=/^#(?:[0-9a-f]{3,4}){1,2}$/i;ol.color.NAMED_COLOR_RE_=/^([a-z]*)$/i;ol.color.asArray=function(e){return Array.isArray(e)?e:ol.color.fromString(e)};ol.color.asString=function(e){return"string"==typeof e?e:ol.color.toString(e)};ol.color.fromNamed=function(e){var t=document.createElement("div");t.style.color=e;document.body.appendChild(t);e=getComputedStyle(t).color;document.body.removeChild(t);return e};ol.color.fromString=function(){var e={},t=0;return function(o){if(e.hasOwnProperty(o))var r=e[o];else{if(1024<=t){r=0;for(var n in e)0==(3&r++)&&(delete e[n],--t)}r=ol.color.fromStringInternal_(o);e[o]=r;++t}return r}}();ol.color.fromStringInternal_=function(e){ol.color.NAMED_COLOR_RE_.exec(e)&&(e=ol.color.fromNamed(e));if(ol.color.HEX_COLOR_RE_.exec(e)){var t=e.length-1,o=4>=t?1:2,r=4===t||8===t;t=parseInt(e.substr(1+0*o,o),16);var n=parseInt(e.substr(1+1*o,o),16),i=parseInt(e.substr(1+2*o,o),16);e=r?parseInt(e.substr(1+3*o,o),16):255;1==o&&(t=(t<<4)+t,n=(n<<4)+n,i=(i<<4)+i,r&&(e=(e<<4)+e));o=[t,n,i,e/255]}else 0==e.indexOf("rgba(")?(e=e.slice(5,-1).split(",").map(Number),o=ol.color.normalize(e)):0==e.indexOf("rgb(")?((e=e.slice(4,-1).split(",").map(Number)).push(1),o=ol.color.normalize(e)):ol.asserts.assert(!1,14);return o};ol.color.normalize=function(e,t){(t=t||[])[0]=ol.math.clamp(e[0]+.5|0,0,255);t[1]=ol.math.clamp(e[1]+.5|0,0,255);t[2]=ol.math.clamp(e[2]+.5|0,0,255);t[3]=ol.math.clamp(e[3],0,1);return t};ol.color.toString=function(e){var t=e[0];t!=(0|t)&&(t=t+.5|0);var o=e[1];o!=(0|o)&&(o=o+.5|0);var r=e[2];r!=(0|r)&&(r=r+.5|0);return"rgba("+t+","+o+","+r+","+(void 0===e[3]?1:e[3])+")"};ol.colorlike={};ol.colorlike.asColorLike=function(e){return ol.colorlike.isColorLike(e)?e:ol.color.asString(e)};ol.colorlike.isColorLike=function(e){return"string"==typeof e||e instanceof CanvasPattern||e instanceof CanvasGradient};ol.render.VectorContext=function(){};ol.render.VectorContext.prototype.drawCustom=function(e,t,o){};ol.render.VectorContext.prototype.drawGeometry=function(e){};ol.render.VectorContext.prototype.setStyle=function(e){};ol.render.VectorContext.prototype.drawCircle=function(e,t){};ol.render.VectorContext.prototype.drawFeature=function(e,t){};ol.render.VectorContext.prototype.drawGeometryCollection=function(e,t){};ol.render.VectorContext.prototype.drawLineString=function(e,t){};ol.render.VectorContext.prototype.drawMultiLineString=function(e,t){};ol.render.VectorContext.prototype.drawMultiPoint=function(e,t){};ol.render.VectorContext.prototype.drawMultiPolygon=function(e,t){};ol.render.VectorContext.prototype.drawPoint=function(e,t){};ol.render.VectorContext.prototype.drawPolygon=function(e,t){};ol.render.VectorContext.prototype.drawText=function(e,t){};ol.render.VectorContext.prototype.setFillStrokeStyle=function(e,t){};ol.render.VectorContext.prototype.setImageStyle=function(e,t){};ol.render.VectorContext.prototype.setTextStyle=function(e,t){};ol.render.canvas.Immediate=function(e,t,o,r,n){ol.render.VectorContext.call(this);this.context_=e;this.pixelRatio_=t;this.extent_=o;this.transform_=r;this.viewRotation_=n;this.image_=this.strokeState_=this.fillState_=this.contextTextState_=this.contextStrokeState_=this.contextFillState_=null;this.imageOriginY_=this.imageOriginX_=this.imageOpacity_=this.imageHeight_=this.imageAnchorY_=this.imageAnchorX_=0;this.imageRotateWithView_=!1;this.imageScale_=this.imageRotation_=0;this.imageSnapToPixel_=!1;this.imageWidth_=0;this.text_="";this.textOffsetY_=this.textOffsetX_=0;this.textRotateWithView_=!1;this.textScale_=this.textRotation_=0;this.textState_=this.textStrokeState_=this.textFillState_=null;this.pixelCoordinates_=[];this.tmpLocalTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.Immediate,ol.render.VectorContext);ol.render.canvas.Immediate.prototype.drawImages_=function(e,t,o,r){if(this.image_){e=ol.geom.flat.transform.transform2D(e,t,o,2,this.transform_,this.pixelCoordinates_);t=this.context_;o=this.tmpLocalTransform_;r=t.globalAlpha;1!=this.imageOpacity_&&(t.globalAlpha=r*this.imageOpacity_);var n,i=this.imageRotation_;this.imageRotateWithView_&&(i+=this.viewRotation_);var a=0;for(n=e.length;a<n;a+=2){var s=e[a]-this.imageAnchorX_,l=e[a+1]-this.imageAnchorY_;this.imageSnapToPixel_&&(s=Math.round(s),l=Math.round(l));if(0!==i||1!=this.imageScale_){var c=s+this.imageAnchorX_,u=l+this.imageAnchorY_;ol.transform.compose(o,c,u,this.imageScale_,this.imageScale_,i,-c,-u);t.setTransform.apply(t,o)}t.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,s,l,this.imageWidth_,this.imageHeight_)}0===i&&1==this.imageScale_||t.setTransform(1,0,0,1,0,0);1!=this.imageOpacity_&&(t.globalAlpha=r)}};ol.render.canvas.Immediate.prototype.drawText_=function(e,t,o,r){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_);this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_);this.setContextTextState_(this.textState_);e=ol.geom.flat.transform.transform2D(e,t,o,r,this.transform_,this.pixelCoordinates_);var n=this.context_,i=this.textRotation_;for(this.textRotateWithView_&&(i+=this.viewRotation_);t<o;t+=r){var a=e[t]+this.textOffsetX_,s=e[t+1]+this.textOffsetY_;if(0!==i||1!=this.textScale_){var l=ol.transform.compose(this.tmpLocalTransform_,a,s,this.textScale_,this.textScale_,i,-a,-s);n.setTransform.apply(n,l)}this.textStrokeState_&&n.strokeText(this.text_,a,s);this.textFillState_&&n.fillText(this.text_,a,s)}0===i&&1==this.textScale_||n.setTransform(1,0,0,1,0,0)}};ol.render.canvas.Immediate.prototype.moveToLineTo_=function(e,t,o,r,n){var i=this.context_;e=ol.geom.flat.transform.transform2D(e,t,o,r,this.transform_,this.pixelCoordinates_);i.moveTo(e[0],e[1]);t=e.length;n&&(t-=2);for(r=2;r<t;r+=2)i.lineTo(e[r],e[r+1]);n&&i.closePath();return o};ol.render.canvas.Immediate.prototype.drawRings_=function(e,t,o,r){var n,i=0;for(n=o.length;i<n;++i)t=this.moveToLineTo_(e,t,o[i],r,!0);return t};ol.render.canvas.Immediate.prototype.drawCircle=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=ol.geom.SimpleGeometry.transform2D(e,this.transform_,this.pixelCoordinates_),o=t[2]-t[0],r=t[3]-t[1];o=Math.sqrt(o*o+r*r);(r=this.context_).beginPath();r.arc(t[0],t[1],o,0,2*Math.PI);this.fillState_&&r.fill();this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}};ol.render.canvas.Immediate.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke());this.setImageStyle(e.getImage());this.setTextStyle(e.getText())};ol.render.canvas.Immediate.prototype.drawGeometry=function(e){switch(e.getType()){case ol.geom.GeometryType.POINT:this.drawPoint(e);break;case ol.geom.GeometryType.LINE_STRING:this.drawLineString(e);break;case ol.geom.GeometryType.POLYGON:this.drawPolygon(e);break;case ol.geom.GeometryType.MULTI_POINT:this.drawMultiPoint(e);break;case ol.geom.GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case ol.geom.GeometryType.MULTI_POLYGON:this.drawMultiPolygon(e);break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case ol.geom.GeometryType.CIRCLE:this.drawCircle(e)}};ol.render.canvas.Immediate.prototype.drawFeature=function(e,t){(e=t.getGeometryFunction()(e))&&ol.extent.intersects(this.extent_,e.getExtent())&&(this.setStyle(t),this.drawGeometry(e))};ol.render.canvas.Immediate.prototype.drawGeometryCollection=function(e){var t,o=0;for(t=(e=e.getGeometriesArray()).length;o<t;++o)this.drawGeometry(e[o])};ol.render.canvas.Immediate.prototype.drawPoint=function(e){var t=e.getFlatCoordinates();e=e.getStride();this.image_&&this.drawImages_(t,0,t.length,e);""!==this.text_&&this.drawText_(t,0,t.length,e)};ol.render.canvas.Immediate.prototype.drawMultiPoint=function(e){var t=e.getFlatCoordinates();e=e.getStride();this.image_&&this.drawImages_(t,0,t.length,e);""!==this.text_&&this.drawText_(t,0,t.length,e)};ol.render.canvas.Immediate.prototype.drawLineString=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var t=this.context_,o=e.getFlatCoordinates();t.beginPath();this.moveToLineTo_(o,0,o.length,e.getStride(),!1);t.stroke()}""!==this.text_&&(e=e.getFlatMidpoint(),this.drawText_(e,0,2,2))}};ol.render.canvas.Immediate.prototype.drawMultiLineString=function(e){var t=e.getExtent();if(ol.extent.intersects(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);t=this.context_;var o,r=e.getFlatCoordinates(),n=0,i=e.getEnds(),a=e.getStride();t.beginPath();var s=0;for(o=i.length;s<o;++s)n=this.moveToLineTo_(r,n,i[s],a,!1);t.stroke()}""!==this.text_&&(e=e.getFlatMidpoints(),this.drawText_(e,0,e.length,2))}};ol.render.canvas.Immediate.prototype.drawPolygon=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=this.context_;t.beginPath();this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride());this.fillState_&&t.fill();this.strokeState_&&t.stroke()}""!==this.text_&&(e=e.getFlatInteriorPoint(),this.drawText_(e,0,2,2))}};ol.render.canvas.Immediate.prototype.drawMultiPolygon=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t,o=this.context_,r=e.getOrientedFlatCoordinates(),n=0,i=e.getEndss(),a=e.getStride();o.beginPath();var s=0;for(t=i.length;s<t;++s)n=this.drawRings_(r,n,i[s],a);this.fillState_&&o.fill();this.strokeState_&&o.stroke()}""!==this.text_&&(e=e.getFlatInteriorPoints(),this.drawText_(e,0,e.length,2))}};ol.render.canvas.Immediate.prototype.setContextFillState_=function(e){var t=this.context_,o=this.contextFillState_;o?o.fillStyle!=e.fillStyle&&(o.fillStyle=t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})};ol.render.canvas.Immediate.prototype.setContextStrokeState_=function(e){var t=this.context_,o=this.contextStrokeState_;o?(o.lineCap!=e.lineCap&&(o.lineCap=t.lineCap=e.lineCap),ol.has.CANVAS_LINE_DASH&&(ol.array.equals(o.lineDash,e.lineDash)||t.setLineDash(o.lineDash=e.lineDash),o.lineDashOffset!=e.lineDashOffset&&(o.lineDashOffset=t.lineDashOffset=e.lineDashOffset)),o.lineJoin!=e.lineJoin&&(o.lineJoin=t.lineJoin=e.lineJoin),o.lineWidth!=e.lineWidth&&(o.lineWidth=t.lineWidth=e.lineWidth),o.miterLimit!=e.miterLimit&&(o.miterLimit=t.miterLimit=e.miterLimit),o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,ol.has.CANVAS_LINE_DASH&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})};ol.render.canvas.Immediate.prototype.setContextTextState_=function(e){var t=this.context_,o=this.contextTextState_,r=e.textAlign?e.textAlign:ol.render.canvas.defaultTextAlign;o?(o.font!=e.font&&(o.font=t.font=e.font),o.textAlign!=r&&(o.textAlign=r),o.textBaseline!=e.textBaseline&&(o.textBaseline=t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})};ol.render.canvas.Immediate.prototype.setFillStrokeStyle=function(e,t){e?(e=e.getColor(),this.fillState_={fillStyle:ol.colorlike.asColorLike(e||ol.render.canvas.defaultFillStyle)}):this.fillState_=null;if(t){e=t.getColor();var o=t.getLineCap(),r=t.getLineDash(),n=t.getLineDashOffset(),i=t.getLineJoin(),a=t.getWidth();t=t.getMiterLimit();this.strokeState_={lineCap:void 0!==o?o:ol.render.canvas.defaultLineCap,lineDash:r||ol.render.canvas.defaultLineDash,lineDashOffset:n||ol.render.canvas.defaultLineDashOffset,lineJoin:void 0!==i?i:ol.render.canvas.defaultLineJoin,lineWidth:this.pixelRatio_*(void 0!==a?a:ol.render.canvas.defaultLineWidth),miterLimit:void 0!==t?t:ol.render.canvas.defaultMiterLimit,strokeStyle:ol.colorlike.asColorLike(e||ol.render.canvas.defaultStrokeStyle)}}else this.strokeState_=null};ol.render.canvas.Immediate.prototype.setImageStyle=function(e){if(e){var t=e.getAnchor(),o=e.getImage(1),r=e.getOrigin(),n=e.getSize();this.imageAnchorX_=t[0];this.imageAnchorY_=t[1];this.imageHeight_=n[1];this.image_=o;this.imageOpacity_=e.getOpacity();this.imageOriginX_=r[0];this.imageOriginY_=r[1];this.imageRotateWithView_=e.getRotateWithView();this.imageRotation_=e.getRotation();this.imageScale_=e.getScale()*this.pixelRatio_;this.imageSnapToPixel_=e.getSnapToPixel();this.imageWidth_=n[0]}else this.image_=null};ol.render.canvas.Immediate.prototype.setTextStyle=function(e){if(e){var t=e.getFill();t?(t=t.getColor(),this.textFillState_={fillStyle:ol.colorlike.asColorLike(t||ol.render.canvas.defaultFillStyle)}):this.textFillState_=null;var o=e.getStroke();if(o){t=o.getColor();var r=o.getLineCap(),n=o.getLineDash(),i=o.getLineDashOffset(),a=o.getLineJoin(),s=o.getWidth();o=o.getMiterLimit();this.textStrokeState_={lineCap:void 0!==r?r:ol.render.canvas.defaultLineCap,lineDash:n||ol.render.canvas.defaultLineDash,lineDashOffset:i||ol.render.canvas.defaultLineDashOffset,lineJoin:void 0!==a?a:ol.render.canvas.defaultLineJoin,lineWidth:void 0!==s?s:ol.render.canvas.defaultLineWidth,miterLimit:void 0!==o?o:ol.render.canvas.defaultMiterLimit,strokeStyle:ol.colorlike.asColorLike(t||ol.render.canvas.defaultStrokeStyle)}}else this.textStrokeState_=null;t=e.getFont();r=e.getOffsetX();n=e.getOffsetY();i=e.getRotateWithView();a=e.getRotation();s=e.getScale();o=e.getText();var l=e.getTextAlign();e=e.getTextBaseline();this.textState_={font:void 0!==t?t:ol.render.canvas.defaultFont,textAlign:void 0!==l?l:ol.render.canvas.defaultTextAlign,textBaseline:void 0!==e?e:ol.render.canvas.defaultTextBaseline};this.text_=void 0!==o?o:"";this.textOffsetX_=void 0!==r?this.pixelRatio_*r:0;this.textOffsetY_=void 0!==n?this.pixelRatio_*n:0;this.textRotateWithView_=void 0!==i&&i;this.textRotation_=void 0!==a?a:0;this.textScale_=this.pixelRatio_*(void 0!==s?s:1)}else this.text_=""};ol.renderer.Layer=function(e){ol.Observable.call(this);this.layer_=e};ol.inherits(ol.renderer.Layer,ol.Observable);ol.renderer.Layer.prototype.forEachFeatureAtCoordinate=ol.nullFunction;ol.renderer.Layer.prototype.hasFeatureAtCoordinate=ol.functions.FALSE;ol.renderer.Layer.prototype.createLoadedTileFinder=function(e,t,o){return function(r,n){return e.forEachLoadedTile(t,r,n,function(e){o[r]||(o[r]={});o[r][e.tileCoord.toString()]=e})}};ol.renderer.Layer.prototype.getLayer=function(){return this.layer_};ol.renderer.Layer.prototype.handleImageChange_=function(e){e.target.getState()===ol.ImageState.LOADED&&this.renderIfReadyAndVisible()};ol.renderer.Layer.prototype.loadImage=function(e){var t=e.getState();t!=ol.ImageState.LOADED&&t!=ol.ImageState.ERROR&&ol.events.listen(e,ol.events.EventType.CHANGE,this.handleImageChange_,this);t==ol.ImageState.IDLE&&(e.load(),t=e.getState());return t==ol.ImageState.LOADED};ol.renderer.Layer.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&e.getSourceState()==ol.source.State.READY&&this.changed()};ol.renderer.Layer.prototype.scheduleExpireCache=function(e,t){t.canExpireCache()&&(t=function(e,t,o){(t=ol.getUid(e).toString())in o.usedTiles&&e.expireCache(o.viewState.projection,o.usedTiles[t])}.bind(null,t),e.postRenderFunctions.push(t))};ol.renderer.Layer.prototype.updateLogos=function(e,t){void 0!==(t=t.getLogo())&&("string"==typeof t?e.logos[t]="":t&&(ol.asserts.assert("string"==typeof t.href,44),ol.asserts.assert("string"==typeof t.src,45),e.logos[t.src]=t.href))};ol.renderer.Layer.prototype.updateUsedTiles=function(e,t,o,r){t=ol.getUid(t).toString();o=o.toString();t in e?o in e[t]?e[t][o].extend(r):e[t][o]=r:(e[t]={},e[t][o]=r)};ol.renderer.Layer.prototype.manageTilePyramid=function(e,t,o,r,n,i,a,s,l,c){var u=ol.getUid(t).toString();u in e.wantedTiles||(e.wantedTiles[u]={});var h,d,p,f=e.wantedTiles[u];e=e.tileQueue;for(p=o.getMinZoom();p<=a;++p){var g=o.getTileRangeForExtentAndZ(i,p,g),m=o.getResolution(p);for(h=g.minX;h<=g.maxX;++h)for(d=g.minY;d<=g.maxY;++d)if(a-p<=s){var y=t.getTile(p,h,d,r,n);y.getState()==ol.TileState.IDLE&&(f[y.getKey()]=!0,e.isKeyQueued(y.getKey())||e.enqueue([y,u,o.getTileCoordCenter(y.tileCoord),m]));void 0!==l&&l.call(c,y)}else t.useTile(p,h,d,n)}};ol.renderer.canvas={};ol.renderer.canvas.Layer=function(e){ol.renderer.Layer.call(this,e);this.transform_=ol.transform.create()};ol.inherits(ol.renderer.canvas.Layer,ol.renderer.Layer);ol.renderer.canvas.Layer.prototype.clip=function(e,t,o){var r=t.pixelRatio,n=t.size[0]*r,i=t.size[1]*r,a=t.viewState.rotation,s=ol.extent.getTopLeft(o),l=ol.extent.getTopRight(o),c=ol.extent.getBottomRight(o);o=ol.extent.getBottomLeft(o);ol.transform.apply(t.coordinateToPixelTransform,s);ol.transform.apply(t.coordinateToPixelTransform,l);ol.transform.apply(t.coordinateToPixelTransform,c);ol.transform.apply(t.coordinateToPixelTransform,o);e.save();ol.render.canvas.rotateAtOffset(e,-a,n/2,i/2);e.beginPath();e.moveTo(s[0]*r,s[1]*r);e.lineTo(l[0]*r,l[1]*r);e.lineTo(c[0]*r,c[1]*r);e.lineTo(o[0]*r,o[1]*r);e.clip();ol.render.canvas.rotateAtOffset(e,a,n/2,i/2)};ol.renderer.canvas.Layer.prototype.dispatchComposeEvent_=function(e,t,o,r){var n=this.getLayer();if(n.hasListener(e)){var i=o.size[0]*o.pixelRatio,a=o.size[1]*o.pixelRatio,s=o.viewState.rotation;ol.render.canvas.rotateAtOffset(t,-s,i/2,a/2);r=void 0!==r?r:this.getTransform(o,0);r=new ol.render.canvas.Immediate(t,o.pixelRatio,o.extent,r,o.viewState.rotation);e=new ol.render.Event(e,r,o,t,null);n.dispatchEvent(e);ol.render.canvas.rotateAtOffset(t,s,i/2,a/2)}};ol.renderer.canvas.Layer.prototype.forEachLayerAtCoordinate=function(e,t,o,r){if(this.forEachFeatureAtCoordinate(e,t,0,ol.functions.TRUE,this))return o.call(r,this.getLayer(),null)};ol.renderer.canvas.Layer.prototype.postCompose=function(e,t,o,r){this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e,t,r)};ol.renderer.canvas.Layer.prototype.preCompose=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e,t,o)};ol.renderer.canvas.Layer.prototype.dispatchRenderEvent=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.RENDER,e,t,o)};ol.renderer.canvas.Layer.prototype.getTransform=function(e,t){var o=e.viewState,r=e.pixelRatio,n=r/o.resolution;return ol.transform.compose(this.transform_,r*e.size[0]/2,r*e.size[1]/2,n,-n,-o.rotation,-o.center[0]+t,-o.center[1])};ol.renderer.canvas.Layer.prototype.composeFrame=function(e,t,o){};ol.renderer.canvas.Layer.prototype.prepareFrame=function(e,t){};ol.renderer.canvas.IntermediateCanvas=function(e){ol.renderer.canvas.Layer.call(this,e);this.coordinateToCanvasPixelTransform=ol.transform.create();this.hitCanvasContext_=null};ol.inherits(ol.renderer.canvas.IntermediateCanvas,ol.renderer.canvas.Layer);ol.renderer.canvas.IntermediateCanvas.prototype.composeFrame=function(e,t,o){this.preCompose(o,e);var r=this.getImage();if(r){var n=t.extent,i=void 0!==n&&!ol.extent.containsExtent(n,e.extent)&&ol.extent.intersects(n,e.extent);i&&this.clip(o,e,n);n=this.getImageTransform();var a=o.globalAlpha;o.globalAlpha=t.opacity;o.drawImage(r,0,0,+r.width,+r.height,Math.round(n[4]),Math.round(n[5]),Math.round(r.width*n[0]),Math.round(r.height*n[3]));o.globalAlpha=a;i&&o.restore()}this.postCompose(o,e,t)};ol.renderer.canvas.IntermediateCanvas.prototype.getImage=function(){};ol.renderer.canvas.IntermediateCanvas.prototype.getImageTransform=function(){};ol.renderer.canvas.IntermediateCanvas.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){var i=this.getLayer();return i.getSource().forEachFeatureAtCoordinate(e,t.viewState.resolution,t.viewState.rotation,o,t.skippedFeatureUids,function(e){return r.call(n,e,i)})};ol.renderer.canvas.IntermediateCanvas.prototype.forEachLayerAtCoordinate=function(e,t,o,r){if(this.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==ol.nullFunction)return ol.renderer.canvas.Layer.prototype.forEachLayerAtCoordinate.apply(this,arguments);var n=ol.transform.apply(this.coordinateToCanvasPixelTransform,e.slice());ol.coordinate.scale(n,t.viewState.resolution/this.renderedResolution);this.hitCanvasContext_||(this.hitCanvasContext_=ol.dom.createCanvasContext2D(1,1));this.hitCanvasContext_.clearRect(0,0,1,1);this.hitCanvasContext_.drawImage(this.getImage(),n[0],n[1],1,1,0,0,1,1);if(0<(n=this.hitCanvasContext_.getImageData(0,0,1,1).data)[3])return o.call(r,this.getLayer(),n)}};ol.renderer.canvas.ImageLayer=function(e){ol.renderer.canvas.IntermediateCanvas.call(this,e);this.image_=null;this.imageTransform_=ol.transform.create();this.skippedFeatures_=[];this.vectorRenderer_=null};ol.inherits(ol.renderer.canvas.ImageLayer,ol.renderer.canvas.IntermediateCanvas);ol.renderer.canvas.ImageLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&(t.getType()===ol.LayerType.IMAGE||t.getType()===ol.LayerType.VECTOR&&t.getRenderMode()===ol.layer.VectorRenderType.IMAGE)};ol.renderer.canvas.ImageLayer.create=function(e,t){var o=new ol.renderer.canvas.ImageLayer(t);if(t.getType()===ol.LayerType.VECTOR)for(var r=ol.plugins.getLayerRendererPlugins(),n=0,i=r.length;n<i;++n){var a=r[n];a!==ol.renderer.canvas.ImageLayer&&a.handles(ol.renderer.Type.CANVAS,t)&&o.setVectorRenderer(a.create(e,t))}return o};ol.renderer.canvas.ImageLayer.prototype.getImage=function(){return this.image_?this.image_.getImage():null};ol.renderer.canvas.ImageLayer.prototype.getImageTransform=function(){return this.imageTransform_};ol.renderer.canvas.ImageLayer.prototype.prepareFrame=function(e,t){var o=e.pixelRatio,r=e.size,n=e.viewState,i=n.center,a=n.resolution,s=this.getLayer().getSource(),l=e.viewHints,c=e.extent;void 0!==t.extent&&(c=ol.extent.getIntersection(c,t.extent));if(!l[ol.ViewHint.ANIMATING]&&!l[ol.ViewHint.INTERACTING]&&!ol.extent.isEmpty(c))if(l=n.projection,ol.ENABLE_RASTER_REPROJECTION||(n=s.getProjection())&&(l=n),n=this.vectorRenderer_){l=n.context;var u=ol.obj.assign({},e,{size:[ol.extent.getWidth(c)/a,ol.extent.getHeight(c)/a],viewState:ol.obj.assign({},e.viewState,{rotation:0})}),h=Object.keys(u.skippedFeatureUids).sort();!n.prepareFrame(u,t)||!n.replayGroupChanged&&ol.array.equals(h,this.skippedFeatures_)||(l.canvas.width=u.size[0]*o,l.canvas.height=u.size[1]*o,n.composeFrame(u,t,l),this.image_=new ol.ImageCanvas(c,a,o,l.canvas),this.skippedFeatures_=h)}else(n=s.getImage(c,a,o,l))&&this.loadImage(n)&&(this.image_=n);this.image_&&(c=(n=this.image_).getExtent(),l=o*(t=n.getResolution())/(a*(n=n.getPixelRatio())),c=ol.transform.compose(this.imageTransform_,o*r[0]/2,o*r[1]/2,l,l,0,n*(c[0]-i[0])/t,n*(i[1]-c[3])/t),ol.transform.compose(this.coordinateToCanvasPixelTransform,o*r[0]/2-c[4],o*r[1]/2-c[5],o/a,-o/a,0,-i[0],-i[1]),this.updateLogos(e,s),this.renderedResolution=t*o/n);return!!this.image_};ol.renderer.canvas.ImageLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,o,r,n):ol.renderer.canvas.IntermediateCanvas.prototype.forEachFeatureAtCoordinate.call(this,e,t,o,r,n)};ol.renderer.canvas.ImageLayer.prototype.setVectorRenderer=function(e){this.vectorRenderer_=e};ol.style={};ol.style.IconImageCache=function(){this.cache_={};this.cacheSize_=0;this.maxCacheSize_=32};ol.style.IconImageCache.getKey=function(e,t,o){return t+":"+e+":"+(o=o?ol.color.asString(o):"null")};ol.style.IconImageCache.prototype.clear=function(){this.cache_={};this.cacheSize_=0};ol.style.IconImageCache.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var e,t=0;for(e in this.cache_){var o=this.cache_[e];0!=(3&t++)||o.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}};ol.style.IconImageCache.prototype.get=function(e,t,o){return(e=ol.style.IconImageCache.getKey(e,t,o))in this.cache_?this.cache_[e]:null};ol.style.IconImageCache.prototype.set=function(e,t,o,r){e=ol.style.IconImageCache.getKey(e,t,o);this.cache_[e]=r;++this.cacheSize_};ol.style.IconImageCache.prototype.setSize=function(e){this.maxCacheSize_=e;this.expire()};ol.style.iconImageCache=new ol.style.IconImageCache;ol.renderer.Map=function(e,t){ol.Disposable.call(this);this.map_=t;this.layerRenderers_={};this.layerRendererListeners_={}};ol.inherits(ol.renderer.Map,ol.Disposable);ol.renderer.Map.prototype.calculateMatrices2D=function(e){var t=e.viewState,o=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;ol.transform.compose(o,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]);ol.transform.invert(ol.transform.setFromArray(r,o))};ol.renderer.Map.prototype.removeLayerRenderers=function(){for(var e in this.layerRenderers_)this.removeLayerRendererByKey_(e).dispose()};ol.renderer.Map.expireIconCache_=function(e,t){ol.style.iconImageCache.expire()};ol.renderer.Map.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,i,a){function s(e,o){var i=ol.getUid(e).toString(),a=t.layerStates[ol.getUid(o)].managed;if(!(i in t.skippedFeatureUids)||a)return r.call(n,e,a?o:null)}var l,c=t.viewState,u=c.resolution,h=c.projection;c=e;if(h.canWrapX()){h=h.getExtent();var d=ol.extent.getWidth(h),p=e[0];(p<h[0]||p>h[2])&&(c=[p+d*Math.ceil((h[0]-p)/d),e[1]])}for(d=(h=t.layerStatesArray).length-1;0<=d;--d){var f=h[d];p=f.layer;if(ol.layer.Layer.visibleAtResolution(f,u)&&i.call(a,p)&&(f=this.getLayerRenderer(p),p.getSource()&&(l=f.forEachFeatureAtCoordinate(p.getSource().getWrapX()?c:e,t,o,s,n)),l))return l}};ol.renderer.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,n,i){};ol.renderer.Map.prototype.hasFeatureAtCoordinate=function(e,t,o,r,n){return void 0!==this.forEachFeatureAtCoordinate(e,t,o,ol.functions.TRUE,this,r,n)};ol.renderer.Map.prototype.getLayerRenderer=function(e){var t=ol.getUid(e).toString();if(t in this.layerRenderers_)return this.layerRenderers_[t];for(var o,r=ol.plugins.getLayerRendererPlugins(),n=this.getType(),i=0,a=r.length;i<a;++i){var s=r[i];if(s.handles(n,e)){o=s.create(this,e);break}}if(!o)throw Error("Unable to create renderer for layer: "+e.getType());this.layerRenderers_[t]=o,this.layerRendererListeners_[t]=ol.events.listen(o,ol.events.EventType.CHANGE,this.handleLayerRendererChange_,this);return o};ol.renderer.Map.prototype.getLayerRendererByKey=function(e){return this.layerRenderers_[e]};ol.renderer.Map.prototype.getLayerRenderers=function(){return this.layerRenderers_};ol.renderer.Map.prototype.getMap=function(){return this.map_};ol.renderer.Map.prototype.getType=function(){};ol.renderer.Map.prototype.handleLayerRendererChange_=function(){this.map_.render()};ol.renderer.Map.prototype.removeLayerRendererByKey_=function(e){var t=this.layerRenderers_[e];delete this.layerRenderers_[e];ol.events.unlistenByKey(this.layerRendererListeners_[e]);delete this.layerRendererListeners_[e];return t};ol.renderer.Map.prototype.renderFrame=ol.nullFunction;ol.renderer.Map.prototype.removeUnusedLayerRenderers_=function(e,t){for(var o in this.layerRenderers_)t&&o in t.layerStates||this.removeLayerRendererByKey_(o).dispose()};ol.renderer.Map.prototype.scheduleExpireIconCache=function(e){e.postRenderFunctions.push(ol.renderer.Map.expireIconCache_)};ol.renderer.Map.prototype.scheduleRemoveUnusedLayerRenderers=function(e){for(var t in this.layerRenderers_)if(!(t in e.layerStates)){e.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));break}};ol.renderer.Map.sortByZIndex=function(e,t){return e.zIndex-t.zIndex};ol.renderer.canvas.Map=function(e,t){ol.renderer.Map.call(this,e,t);this.context_=ol.dom.createCanvasContext2D();this.canvas_=this.context_.canvas;this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ol.css.CLASS_UNSELECTABLE;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.renderedVisible_=!0;this.transform_=ol.transform.create()};ol.inherits(ol.renderer.canvas.Map,ol.renderer.Map);ol.renderer.canvas.Map.handles=function(e){return e===ol.renderer.Type.CANVAS};ol.renderer.canvas.Map.create=function(e,t){return new ol.renderer.canvas.Map(e,t)};ol.renderer.canvas.Map.prototype.dispatchComposeEvent_=function(e,t){var o=this.getMap(),r=this.context_;if(o.hasListener(e)){var n=t.extent,i=t.pixelRatio,a=t.viewState.rotation,s=this.getTransform(t);n=new ol.render.canvas.Immediate(r,i,n,s,a);e=new ol.render.Event(e,n,t,r,null);o.dispatchEvent(e)}};ol.renderer.canvas.Map.prototype.getTransform=function(e){var t=e.viewState;e=e.pixelRatio/t.resolution;return ol.transform.compose(this.transform_,this.canvas_.width/2,this.canvas_.height/2,e,-e,-t.rotation,-t.center[0],-t.center[1])};ol.renderer.canvas.Map.prototype.getType=function(){return ol.renderer.Type.CANVAS};ol.renderer.canvas.Map.prototype.renderFrame=function(e){if(e){var t=this.context_,o=e.pixelRatio,r=Math.round(e.size[0]*o),n=Math.round(e.size[1]*o);this.canvas_.width!=r||this.canvas_.height!=n?(this.canvas_.width=r,this.canvas_.height=n):t.clearRect(0,0,r,n);o=e.viewState.rotation;this.calculateMatrices2D(e);this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e);var i,a=e.layerStatesArray;ol.array.stableSort(a,ol.renderer.Map.sortByZIndex);o&&(t.save(),ol.render.canvas.rotateAtOffset(t,o,r/2,n/2));r=e.viewState.resolution;n=0;for(i=a.length;n<i;++n){var s=a[n],l=s.layer;l=this.getLayerRenderer(l);ol.layer.Layer.visibleAtResolution(s,r)&&s.sourceState==ol.source.State.READY&&l.prepareFrame(e,s)&&l.composeFrame(e,s,t)}o&&t.restore();this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e);this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0);this.scheduleRemoveUnusedLayerRenderers(e);this.scheduleExpireIconCache(e)}else this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1)};ol.renderer.canvas.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,n,i){var a=t.viewState.resolution,s=t.layerStatesArray,l=s.length;e=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());for(--l;0<=l;--l){var c=s[l],u=c.layer;if(ol.layer.Layer.visibleAtResolution(c,a)&&n.call(i,u)&&(c=this.getLayerRenderer(u).forEachLayerAtCoordinate(e,t,o,r)))return c}};ol.renderer.canvas.TileLayer=function(e){ol.renderer.canvas.IntermediateCanvas.call(this,e);this.context=null===this.context?null:ol.dom.createCanvasContext2D();this.renderedExtent_=null;this.renderedTiles=[];this.tmpExtent=ol.extent.createEmpty();this.tmpTileRange_=new ol.TileRange(0,0,0,0);this.imageTransform_=ol.transform.create();this.zDirection=0};ol.inherits(ol.renderer.canvas.TileLayer,ol.renderer.canvas.IntermediateCanvas);ol.renderer.canvas.TileLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.TILE};ol.renderer.canvas.TileLayer.create=function(e,t){return new ol.renderer.canvas.TileLayer(t)};ol.renderer.canvas.TileLayer.prototype.isDrawableTile_=function(e){e=e.getState();var t=this.getLayer().getUseInterimTilesOnError();return e==ol.TileState.LOADED||e==ol.TileState.EMPTY||e==ol.TileState.ERROR&&!t};ol.renderer.canvas.TileLayer.prototype.prepareFrame=function(e,t){var o=e.pixelRatio,r=e.size,n=e.viewState,i=n.projection,a=n.resolution;n=n.center;var s=this.getLayer(),l=s.getSource(),c=l.getRevision(),u=l.getTileGridForProjection(i),h=u.getZForResolution(a,this.zDirection),d=u.getResolution(h),p=Math.round(a/d)||1,f=e.extent;void 0!==t.extent&&(f=ol.extent.getIntersection(f,t.extent));if(ol.extent.isEmpty(f))return!1;var g=u.getTileRangeForExtentAndZ(f,h),m=u.getTileRangeExtent(h,g),y=l.getTilePixelRatio(o),C={};C[h]={};var v,T,_=this.createLoadedTileFinder(l,i,C),S=this.tmpExtent,E=this.tmpTileRange_,L=!1;for(v=g.minX;v<=g.maxX;++v)for(T=g.minY;T<=g.maxY;++T){var w=l.getTile(h,v,T,o,i);w.getState()==ol.TileState.ERROR&&(s.getUseInterimTilesOnError()?0<s.getPreload()&&(L=!0):w.setState(ol.TileState.LOADED));this.isDrawableTile_(w)||(w=w.getInterimTile());if(this.isDrawableTile_(w)){var b=ol.getUid(this);if(w.getState()==ol.TileState.LOADED){C[h][w.tileCoord.toString()]=w;var x=w.inTransition(b);L||!x&&-1!==this.renderedTiles.indexOf(w)||(L=!0)}if(1===w.getAlpha(b,e.time))continue}b=u.getTileCoordChildTileRange(w.tileCoord,E,S);x=!1;b&&(x=_(h+1,b));x||u.forEachTileCoordParentTileRange(w.tileCoord,_,null,E,S)}w=d*o/y*p;v=(v=e.viewHints)[ol.ViewHint.ANIMATING]||v[ol.ViewHint.INTERACTING];if(!(this.renderedResolution&&16<Date.now()-e.time&&v||!L&&this.renderedExtent_&&ol.extent.containsExtent(this.renderedExtent_,f)&&this.renderedRevision==c&&p==this.oversampling_&&(v||w==this.renderedResolution))){(w=this.context)&&(T=l.getTilePixelSize(h,o,i),v=Math.round(g.getWidth()*T[0]/p),T=Math.round(g.getHeight()*T[1]/p),(L=w.canvas).width!=v||L.height!=T?(this.oversampling_=p,L.width=v,L.height=T):(this.renderedExtent_&&!ol.extent.equals(m,this.renderedExtent_)&&w.clearRect(0,0,v,T),p=this.oversampling_));this.renderedTiles.length=0;(L=Object.keys(C).map(Number)).sort(function(e,t){return e===h?1:t===h?-1:e>t?1:e<t?-1:0});b=0;for(x=L.length;b<x;++b){E=L[b];_=l.getTilePixelSize(E,o,i);var A=(w=u.getResolution(E))/d,P=y*l.getGutter(i),R=C[E];for(var M in R){w=R[M];v=((T=u.getTileCoordExtent(w.getTileCoord(),S))[0]-m[0])/d*y/p;T=(m[3]-T[3])/d*y/p;var I=_[0]*A/p,O=_[1]*A/p;this.drawTileImage(w,e,t,v,T,I,O,P,h===E);this.renderedTiles.push(w)}}this.renderedRevision=c;this.renderedResolution=d*o/y*p;this.renderedExtent_=m}t=this.renderedResolution/a;t=ol.transform.compose(this.imageTransform_,o*r[0]/2,o*r[1]/2,t,t,0,(this.renderedExtent_[0]-n[0])/this.renderedResolution*o,(n[1]-this.renderedExtent_[3])/this.renderedResolution*o);ol.transform.compose(this.coordinateToCanvasPixelTransform,o*r[0]/2-t[4],o*r[1]/2-t[5],o/a,-o/a,0,-n[0],-n[1]);this.updateUsedTiles(e.usedTiles,l,h,g);this.manageTilePyramid(e,l,u,o,i,f,h,s.getPreload());this.scheduleExpireCache(e,l);this.updateLogos(e,l);return 0<this.renderedTiles.length};ol.renderer.canvas.TileLayer.prototype.drawTileImage=function(e,t,o,r,n,i,a,s,l){if(o=e.getImage(this.getLayer())){var c=ol.getUid(this),u=l?e.getAlpha(c,t.time):1;1!==u||this.getLayer().getSource().getOpaque(t.viewState.projection)||this.context.clearRect(r,n,i,a);var h=u!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=u);this.context.drawImage(o,s,s,o.width-2*s,o.height-2*s,r,n,i,a);h&&this.context.restore();1!==u?t.animate=!0:l&&e.endTransition(c)}};ol.renderer.canvas.TileLayer.prototype.getImage=function(){var e=this.context;return e?e.canvas:null};ol.renderer.canvas.TileLayer.prototype.getImageTransform=function(){return this.imageTransform_};ol.ext={};ol.ext.rbush=function(){};(function(){!function(e){function t(e,t,o){var r=e[t];e[t]=e[o];e[o]=r}function o(e,t){return e<t?-1:e>t?1:0}function r(e,t){if(!(this instanceof r))return new r(e,t);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));t&&this._initFormat(t);this.clear()}function n(e,t){i(e,0,e.children.length,t,e)}function i(e,t,o,r,n){n||(n=p(null));n.minX=1/0;n.minY=1/0;n.maxX=-1/0;n.maxY=-1/0;for(var i;t<o;t++)i=e.children[t],a(n,e.leaf?r(i):i);return n}function a(e,t){e.minX=Math.min(e.minX,t.minX);e.minY=Math.min(e.minY,t.minY);e.maxX=Math.max(e.maxX,t.maxX);e.maxY=Math.max(e.maxY,t.maxY);return e}function s(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function d(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(e,t,o,r,n){for(var i,a=[t,o];a.length;)(o=a.pop())-(t=a.pop())<=r||(i=t+Math.ceil((o-t)/r/2)*r,g(e,i,t,o,n),a.push(t,i,i,o))}var g=function e(r,n,i,a,s){i=i||0;a=a||r.length-1;for(s=s||o;a>i;){if(600<a-i){var l=a-i+1,c=n-i+1,u=Math.log(l),h=.5*Math.exp(2*u/3);u=.5*Math.sqrt(u*h*(l-h)/l)*(0>c-l/2?-1:1);e(r,n,Math.max(i,Math.floor(n-c*h/l+u)),Math.min(a,Math.floor(n+(l-c)*h/l+u)),s)}l=r[n];c=i;h=a;t(r,i,n);for(0<s(r[a],l)&&t(r,i,a);c<h;){t(r,c,h);c++;for(h--;0>s(r[c],l);)c++;for(;0<s(r[h],l);)h--}0===s(r[i],l)?t(r,i,h):t(r,++h,a);h<=n&&(i=h+1);n<=h&&(a=h-1)}};r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,o=[],r=this.toBBox;if(!d(e,t))return o;for(var n,i,a,s,l=[];t;){n=0;for(i=t.children.length;n<i;n++)a=t.children[n],d(e,s=t.leaf?r(a):a)&&(t.leaf?o.push(a):h(e,s)?this._all(a,o):l.push(a));t=l.pop()}return o},collides:function(e){var t=this.data,o=this.toBBox;if(!d(e,t))return!1;for(var r,n,i,a,s=[];t;){r=0;for(n=t.children.length;r<n;r++)if(i=t.children[r],d(e,a=t.leaf?o(i):i)){if(t.leaf||h(e,a))return!0;s.push(i)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,o=e.length;t<o;t++)this.insert(e[t]);return this}e=this._build(e.slice(),0,e.length-1,0);this.data.children.length?this.data.height===e.height?this._splitRoot(this.data,e):(this.data.height<e.height&&(t=this.data,this.data=e,e=t),this._insert(e,this.data.height-e.height-1,!0)):this.data=e;return this},insert:function(e){e&&this._insert(e,this.data.height-1);return this},clear:function(){this.data=p([]);return this},remove:function(e,t){if(!e)return this;for(var o,r,n,i,a=this.data,s=this.toBBox(e),l=[],c=[];a||l.length;){a||(a=l.pop(),r=l[l.length-1],o=c.pop(),i=!0);if(a.leaf){e:{n=e;var u=a.children,d=t;if(d){for(var p=0;p<u.length;p++)if(d(n,u[p])){n=p;break e}n=-1}else n=u.indexOf(n)}if(-1!==n){a.children.splice(n,1);l.push(a);this._condense(l);break}}i||a.leaf||!h(a,s)?r?(o++,a=r.children[o],i=!1):a=null:(l.push(a),c.push(o),o=0,r=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:s,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,t){for(var o=[];e;)e.leaf?t.push.apply(t,e.children):o.push.apply(o,e.children),e=o.pop();return t},_build:function(e,t,o,r){var i,a=o-t+1,s=this._maxEntries;if(a<=s){var l=p(e.slice(t,o+1));n(l,this.toBBox);return l}r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1)));(l=p([])).leaf=!1;l.height=r;for(f(e,t,o,s=(a=Math.ceil(a/s))*Math.ceil(Math.sqrt(s)),this.compareMinX);t<=o;t+=s){var c=Math.min(t+s-1,o);f(e,t,c,a,this.compareMinY);for(i=t;i<=c;i+=a){var u=Math.min(i+a-1,c);l.children.push(this._build(e,i,u,r-1))}}n(l,this.toBBox);return l},_chooseSubtree:function(e,t,o,r){for(var n,i,a,s,l,u,h,d;;){r.push(t);if(t.leaf||r.length-1===o)break;h=d=1/0;n=0;for(i=t.children.length;n<i;n++)l=c(a=t.children[n]),(u=(Math.max(a.maxX,e.maxX)-Math.min(a.minX,e.minX))*(Math.max(a.maxY,e.maxY)-Math.min(a.minY,e.minY))-l)<d?(d=u,h=l<h?l:h,s=a):u===d&&l<h&&(h=l,s=a);t=s||t.children[0]}return t},_insert:function(e,t,o){var r=this.toBBox;o=o?e:r(e);r=[];var n=this._chooseSubtree(o,this.data,t,r);n.children.push(e);for(a(n,o);0<=t&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(o,r,t)},_split:function(e,t){var o=e[t],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);r=this._chooseSplitIndex(o,i,r);(r=p(o.children.splice(r,o.children.length-r))).height=o.height;r.leaf=o.leaf;n(o,this.toBBox);n(r,this.toBBox);t?e[t-1].children.push(r):this._splitRoot(o,r)},_splitRoot:function(e,t){this.data=p([e,t]);this.data.height=e.height+1;this.data.leaf=!1;n(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,o){var r,n,a=n=1/0;for(r=t;r<=o-t;r++){var s=i(e,0,r,this.toBBox),l=i(e,r,o,this.toBBox),u=Math.max(0,Math.min(s.maxX,l.maxX)-Math.max(s.minX,l.minX))*Math.max(0,Math.min(s.maxY,l.maxY)-Math.max(s.minY,l.minY));s=c(s)+c(l);if(u<a){a=u;var h=r;n=s<n?s:n}else u===a&&s<n&&(n=s,h=r)}return h},_chooseSplitAxis:function(e,t,o){var r=e.leaf?this.compareMinX:s,n=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,o,r)<(t=this._allDistMargin(e,t,o,n))&&e.children.sort(r)},_allDistMargin:function(e,t,o,r){e.children.sort(r);var n,s=i(e,0,t,r=this.toBBox),l=i(e,o-t,o,r),c=u(s)+u(l);for(n=t;n<o-t;n++){var h=e.children[n];a(s,e.leaf?r(h):h);c+=u(s)}for(n=o-t-1;n>=t;n--)h=e.children[n],a(l,e.leaf?r(h):h),c+=u(l);return c},_adjustParentBBoxes:function(e,t,o){for(;0<=o;o--)a(t[o],e)},_condense:function(e){for(var t,o=e.length-1;0<=o;o--)0===e[o].children.length?0<o?(t=e[o-1].children).splice(t.indexOf(e[o]),1):this.clear():n(e[o],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0]));this.compareMinY=new Function("a","b",t.join(e[1]));this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};e.default=r}(this.rbush=this.rbush||{})}).call(ol.ext);ol.ext.rbush=ol.ext.rbush.default;ol.render.ReplayGroup=function(){};ol.render.ReplayGroup.prototype.getReplay=function(e,t){};ol.render.ReplayGroup.prototype.isEmpty=function(){};ol.render.ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};ol.geom.flat.length={};ol.geom.flat.length.lineString=function(e,t,o,r){var n=e[t],i=e[t+1],a=0;for(t+=r;t<o;t+=r){var s=e[t],l=e[t+1];a+=Math.sqrt((s-n)*(s-n)+(l-i)*(l-i));n=s;i=l}return a};ol.geom.flat.length.linearRing=function(e,t,o,r){var n=ol.geom.flat.length.lineString(e,t,o,r),i=e[o-r]-e[t];e=e[o-r+1]-e[t+1];return n+Math.sqrt(i*i+e*e)};ol.geom.flat.textpath={};ol.geom.flat.textpath.lineString=function(e,t,o,r,n,i,a,s){for(var l,c,u,h=[],d=e[t]>e[o-r],p=n.length,f=e[t],g=e[t+1],m=e[t+=r],y=e[t+1],C=0,v=Math.sqrt(Math.pow(m-f,2)+Math.pow(y-g,2)),T="",_=0,S=0;S<p;++S){c=d?p-S-1:S;c=n.charAt(c);var E=i(T=d?c+T:T+c)-_;_+=E;for(var L=a+E/2;t<o-r&&C+v<L;)f=m,g=y,m=e[t+=r],y=e[t+1],C+=v,v=Math.sqrt(Math.pow(m-f,2)+Math.pow(y-g,2));var w=L-C;L=Math.atan2(y-g,m-f);d&&(L+=0<L?-Math.PI:Math.PI);if(void 0!==u){var b=L-u;b+=b>Math.PI?-2*Math.PI:b<-Math.PI?2*Math.PI:0;if(Math.abs(b)>s)return null}b=w/v;w=ol.math.lerp(f,m,b);b=ol.math.lerp(g,y,b);u==L?(d&&(l[0]=w,l[1]=b,l[2]=E/2),l[4]=T):(_=E,l=[w,b,E/2,L,T=c],d?h.unshift(l):h.push(l),u=L);a+=E}return h};ol.render.canvas.Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12};ol.render.replay={};ol.render.replay.ORDER=[ol.render.ReplayType.POLYGON,ol.render.ReplayType.CIRCLE,ol.render.ReplayType.LINE_STRING,ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT,ol.render.ReplayType.DEFAULT];ol.render.replay.TEXT_ALIGN={};ol.render.replay.TEXT_ALIGN.left=0;ol.render.replay.TEXT_ALIGN.end=0;ol.render.replay.TEXT_ALIGN.center=.5;ol.render.replay.TEXT_ALIGN.right=1;ol.render.replay.TEXT_ALIGN.start=1;ol.render.replay.TEXT_ALIGN.top=0;ol.render.replay.TEXT_ALIGN.middle=.5;ol.render.replay.TEXT_ALIGN.hanging=.2;ol.render.replay.TEXT_ALIGN.alphabetic=.8;ol.render.replay.TEXT_ALIGN.ideographic=.8;ol.render.replay.TEXT_ALIGN.bottom=1;ol.render.canvas.Replay=function(e,t,o,r,n,i){ol.render.VectorContext.call(this);this.declutterTree=i;this.tmpExtent_=ol.extent.createEmpty();this.tolerance=e;this.maxExtent=t;this.overlaps=n;this.pixelRatio=r;this.maxLineWidth=0;this.resolution=o;this.bufferedMaxExtent_=this.beginGeometryInstruction2_=this.beginGeometryInstruction1_=null;this.instructions=[];this.coordinates=[];this.coordinateCache_={};this.renderedTransform_=ol.transform.create();this.hitDetectionInstructions=[];this.pixelCoordinates_=null;this.state={};this.viewRotation_=0;this.tmpLocalTransform_=ol.transform.create();this.resetTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.Replay,ol.render.VectorContext);ol.render.canvas.Replay.prototype.replayTextBackground_=function(e,t,o,r,n,i,a){e.beginPath();e.moveTo.apply(e,t);e.lineTo.apply(e,o);e.lineTo.apply(e,r);e.lineTo.apply(e,n);e.lineTo.apply(e,t);i&&(this.fillOrigin_=i[2],this.fill_(e));a&&(this.setStrokeStyle_(e,a),e.stroke())};ol.render.canvas.Replay.prototype.replayImage_=function(e,t,o,r,n,i,a,s,l,c,u,h,d,p,f,g,m,y){var C=m||y,v=this.tmpLocalTransform_;t-=n*=d;o-=i*=d;p&&(t=Math.round(t),o=Math.round(o));p=f+c>r.width?r.width-c:f;s=s+u>r.height?r.height-u:s;f=this.tmpExtent_;var T=g[3]+p*d+g[1],_=g[0]+s*d+g[2],S=t-g[3],E=o-g[0];if(C||0!==h)var L=[S,E],w=[S+T,E],b=[S+T,E+_],x=[S,E+_];g=null;0!==h?(n=t+n,i=o+i,g=ol.transform.compose(v,n,i,1,1,h,-n,-i),ol.extent.createOrUpdateEmpty(f),ol.extent.extendCoordinate(f,ol.transform.apply(v,L)),ol.extent.extendCoordinate(f,ol.transform.apply(v,w)),ol.extent.extendCoordinate(f,ol.transform.apply(v,b)),ol.extent.extendCoordinate(f,ol.transform.apply(v,x))):ol.extent.createOrUpdate(S,E,S+T,E+_,f);h=e.canvas;h=f[0]<=h.width&&0<=f[2]&&f[1]<=h.height&&0<=f[3];a?(h||1!=a[4])&&(ol.extent.extend(a,f),(e=h?[e,g?g.slice(0):null,l,r,c,u,p,s,t,o,d]:null)&&C&&e.push(m,y,L,w,b,x),a.push(e)):h&&(C&&this.replayTextBackground_(e,L,w,b,x,m,y),ol.render.canvas.drawImage(e,g,l,r,c,u,p,s,t,o,d))};ol.render.canvas.Replay.prototype.applyPixelRatio=function(e){var t=this.pixelRatio;return 1==t?e:e.map(function(e){return e*t})};ol.render.canvas.Replay.prototype.appendFlatCoordinates=function(e,t,o,r,n,i){var a=this.coordinates.length,s=this.getBufferedMaxExtent();i&&(t+=r);i=[e[t],e[t+1]];var l,c=[NaN,NaN],u=!0;for(l=t+r;l<o;l+=r){c[0]=e[l];c[1]=e[l+1];var h=ol.extent.coordinateRelationship(s,c);h!==d?(u&&(this.coordinates[a++]=i[0],this.coordinates[a++]=i[1]),this.coordinates[a++]=c[0],this.coordinates[a++]=c[1],u=!1):h===ol.extent.Relationship.INTERSECTING?(this.coordinates[a++]=c[0],this.coordinates[a++]=c[1],u=!1):u=!0;i[0]=c[0];i[1]=c[1];var d=h}(n&&u||l===t+r)&&(this.coordinates[a++]=i[0],this.coordinates[a++]=i[1]);return a};ol.render.canvas.Replay.prototype.drawCustomCoordinates_=function(e,t,o,r,n){for(var i=0,a=o.length;i<a;++i){var s=o[i];t=this.appendFlatCoordinates(e,t,s,r,!1,!1);n.push(t);t=s}return t};ol.render.canvas.Replay.prototype.drawCustom=function(e,t,o){this.beginGeometry(e,t);var r,n=e.getType(),i=e.getStride(),a=this.coordinates.length;if(n==ol.geom.GeometryType.MULTI_POLYGON){n=e.getOrientedFlatCoordinates();for(var s=[],l=e.getEndss(),c=r=0,u=l.length;c<u;++c){var h=[];r=this.drawCustomCoordinates_(n,r,l[c],i,h);s.push(h)}this.instructions.push([ol.render.canvas.Instruction.CUSTOM,a,s,e,o,ol.geom.flat.inflate.coordinatesss])}else n==ol.geom.GeometryType.POLYGON||n==ol.geom.GeometryType.MULTI_LINE_STRING?(s=[],n=n==ol.geom.GeometryType.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),this.drawCustomCoordinates_(n,0,e.getEnds(),i,s),this.instructions.push([ol.render.canvas.Instruction.CUSTOM,a,s,e,o,ol.geom.flat.inflate.coordinatess])):n==ol.geom.GeometryType.LINE_STRING||n==ol.geom.GeometryType.MULTI_POINT?(n=e.getFlatCoordinates(),i=this.appendFlatCoordinates(n,0,n.length,i,!1,!1),this.instructions.push([ol.render.canvas.Instruction.CUSTOM,a,i,e,o,ol.geom.flat.inflate.coordinates])):n==ol.geom.GeometryType.POINT&&(n=e.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),i=this.coordinates.length,this.instructions.push([ol.render.canvas.Instruction.CUSTOM,a,i,e,o]));this.endGeometry(e,t)};ol.render.canvas.Replay.prototype.beginGeometry=function(e,t){this.beginGeometryInstruction1_=[ol.render.canvas.Instruction.BEGIN_GEOMETRY,t,0];this.instructions.push(this.beginGeometryInstruction1_);this.beginGeometryInstruction2_=[ol.render.canvas.Instruction.BEGIN_GEOMETRY,t,0];this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)};ol.render.canvas.Replay.prototype.fill_=function(e){if(this.fillOrigin_){var t=ol.transform.apply(this.renderedTransform_,this.fillOrigin_.slice());e.translate(t[0],t[1]);e.rotate(this.viewRotation_)}e.fill();this.fillOrigin_&&e.setTransform.apply(e,ol.render.canvas.resetTransform_)};ol.render.canvas.Replay.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1];e.lineWidth=t[2];e.lineCap=t[3];e.lineJoin=t[4];e.miterLimit=t[5];ol.has.CANVAS_LINE_DASH&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))};ol.render.canvas.Replay.prototype.renderDeclutter_=function(e,t){if(e&&5<e.length){var o=e[4];if(1==o||o==e.length-5){t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};if(!this.declutterTree.collides(t)){this.declutterTree.insert(t);t=ol.render.canvas.drawImage;o=5;for(var r=e.length;o<r;++o){var n=e[o];n&&(11<n.length&&this.replayTextBackground_(n[0],n[13],n[14],n[15],n[16],n[11],n[12]),t.apply(void 0,n))}}e.length=5;ol.extent.createOrUpdateEmpty(e)}}};ol.render.canvas.Replay.prototype.replay_=function(e,t,o,r,n,i){if(this.pixelCoordinates_&&ol.array.equals(t,this.renderedTransform_))var a=this.pixelCoordinates_;else this.pixelCoordinates_||(this.pixelCoordinates_=[]),a=ol.geom.flat.transform.transform2D(this.coordinates,0,this.coordinates.length,2,t,this.pixelCoordinates_),ol.transform.setFromArray(this.renderedTransform_,t);t=!ol.obj.isEmpty(o);for(var s,l,c,u,h,d,p,f,g,m=0,y=r.length,C=0,v=0,T=null,_=null,S=this.coordinateCache_,E=this.viewRotation_,L={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:E},w=this.instructions!=r||this.overlaps?0:200;m<y;)switch(f=r[m],f[0]){case ol.render.canvas.Instruction.BEGIN_GEOMETRY:var b=f[1];t&&o[ol.getUid(b).toString()]||!b.getGeometry()?m=f[2]:void 0===i||ol.extent.intersects(i,b.getGeometry().getExtent())?++m:m=f[2]+1;break;case ol.render.canvas.Instruction.BEGIN_PATH:C>w&&(this.fill_(e),C=0);v>w&&(e.stroke(),v=0);C||v||(e.beginPath(),h=d=NaN);++m;break;case ol.render.canvas.Instruction.CIRCLE:p=a[s=f[1]];f=a[s+1];c=a[s+2]-p;u=a[s+3]-f;c=Math.sqrt(c*c+u*u);e.moveTo(p+c,f);e.arc(p,f,c,0,2*Math.PI,!0);++m;break;case ol.render.canvas.Instruction.CLOSE_PATH:e.closePath();++m;break;case ol.render.canvas.Instruction.CUSTOM:s=f[1];l=f[2];p=f[4];c=6==f.length?f[5]:void 0;L.geometry=f[3];L.feature=b;m in S||(S[m]=[]);f=S[m];c?c(a,s,l,2,f):(f[0]=a[s],f[1]=a[s+1],f.length=2);p(f,L);++m;break;case ol.render.canvas.Instruction.DRAW_IMAGE:s=f[1];l=f[2];g=f[3];c=f[4];u=f[5];p=n?null:f[6];var x=f[7],A=f[8],P=f[9],R=f[10],M=f[11],I=f[12],O=f[13],N=f[14],D=f[15];if(16<f.length){var F=f[16],k=f[17];f=f[18]}else F=ol.render.canvas.defaultPadding,k=f=!1;for(M&&(I+=E);s<l;s+=2)this.replayImage_(e,a[s],a[s+1],g,c,u,p,x,A,P,R,I,O,N,D,F,k?T:null,f?_:null);this.renderDeclutter_(p,b);++m;break;case ol.render.canvas.Instruction.DRAW_CHARS:c=f[1];u=f[2];s=f[3];p=n?null:f[4];R=f[5];l=f[6];M=f[7];I=f[8];g=f[9];x=f[10];A=f[11];O=f[12];P=f[13];f=f[14];N=ol.geom.flat.length.lineString(a,c,u,2);D=I(O);if((R||D<=N)&&(R=ol.geom.flat.textpath.lineString(a,c,u,2,O,I,(N-D)*ol.render.replay.TEXT_ALIGN[this.textStates[P].textAlign],M))){if(x)for(M=0,I=R.length;M<I;++M)c=(O=R[M])[4],N=this.getImage(c,P,"",x),c=O[2]+A,u=s*N.height+2*(.5-s)*A-g,this.replayImage_(e,O[0],O[1],N,c,u,p,N.height,1,0,0,O[3],f,!1,N.width,ol.render.canvas.defaultPadding,null,null);if(l)for(M=0,I=R.length;M<I;++M)c=(O=R[M])[4],N=this.getImage(c,P,l,""),c=O[2],u=s*N.height-g,this.replayImage_(e,O[0],O[1],N,c,u,p,N.height,1,0,0,O[3],f,!1,N.width,ol.render.canvas.defaultPadding,null,null)}this.renderDeclutter_(p,b);++m;break;case ol.render.canvas.Instruction.END_GEOMETRY:if(void 0!==n&&(p=n(b=f[1])))return p;++m;break;case ol.render.canvas.Instruction.FILL:w?C++:this.fill_(e);++m;break;case ol.render.canvas.Instruction.MOVE_TO_LINE_TO:s=f[1];l=f[2];c=a[s];f=(u=a[s+1])+.5|0;(p=c+.5|0)===h&&f===d||(e.moveTo(c,u),h=p,d=f);for(s+=2;s<l;s+=2)(p=(c=a[s])+.5|0,f=(u=a[s+1])+.5|0,s==l-2||p!==h||f!==d)&&(e.lineTo(c,u),h=p,d=f);++m;break;case ol.render.canvas.Instruction.SET_FILL_STYLE:T=f;this.fillOrigin_=f[2];C&&(this.fill_(e),C=0,v&&(e.stroke(),v=0));e.fillStyle=f[1];++m;break;case ol.render.canvas.Instruction.SET_STROKE_STYLE:_=f;v&&(e.stroke(),v=0);this.setStrokeStyle_(e,f);++m;break;case ol.render.canvas.Instruction.STROKE:w?v++:e.stroke();++m;break;default:++m}C&&this.fill_(e);v&&e.stroke()};ol.render.canvas.Replay.prototype.replay=function(e,t,o,r){this.viewRotation_=o;this.replay_(e,t,r,this.instructions,void 0,void 0)};ol.render.canvas.Replay.prototype.replayHitDetection=function(e,t,o,r,n,i){this.viewRotation_=o;return this.replay_(e,t,r,this.hitDetectionInstructions,n,i)};ol.render.canvas.Replay.prototype.reverseHitDetectionInstructions=function(){var e=this.hitDetectionInstructions;e.reverse();var t,o=e.length,r=-1;for(t=0;t<o;++t){var n=e[t],i=n[0];i==ol.render.canvas.Instruction.END_GEOMETRY?r=t:i==ol.render.canvas.Instruction.BEGIN_GEOMETRY&&(n[2]=t,ol.array.reverseSubArray(this.hitDetectionInstructions,r,t),r=-1)}};ol.render.canvas.Replay.prototype.setFillStrokeStyle=function(e,t){var o=this.state;e?(e=e.getColor(),o.fillStyle=ol.colorlike.asColorLike(e||ol.render.canvas.defaultFillStyle)):o.fillStyle=void 0;t?(e=t.getColor(),o.strokeStyle=ol.colorlike.asColorLike(e||ol.render.canvas.defaultStrokeStyle),e=t.getLineCap(),o.lineCap=void 0!==e?e:ol.render.canvas.defaultLineCap,e=t.getLineDash(),o.lineDash=e?e.slice():ol.render.canvas.defaultLineDash,e=t.getLineDashOffset(),o.lineDashOffset=e||ol.render.canvas.defaultLineDashOffset,e=t.getLineJoin(),o.lineJoin=void 0!==e?e:ol.render.canvas.defaultLineJoin,e=t.getWidth(),o.lineWidth=void 0!==e?e:ol.render.canvas.defaultLineWidth,t=t.getMiterLimit(),o.miterLimit=void 0!==t?t:ol.render.canvas.defaultMiterLimit,o.lineWidth>this.maxLineWidth&&(this.maxLineWidth=o.lineWidth,this.bufferedMaxExtent_=null)):(o.strokeStyle=void 0,o.lineCap=void 0,o.lineDash=null,o.lineDashOffset=void 0,o.lineJoin=void 0,o.lineWidth=void 0,o.miterLimit=void 0)};ol.render.canvas.Replay.prototype.applyFill=function(e,t){var o=e.fillStyle;e=[ol.render.canvas.Instruction.SET_FILL_STYLE,o];"string"!=typeof o&&(t=t.getExtent(),e.push([t[0],t[3]]));this.instructions.push(e)};ol.render.canvas.Replay.prototype.applyStroke=function(e){this.instructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio])};ol.render.canvas.Replay.prototype.updateFillStyle=function(e,t,o){var r=e.fillStyle;"string"==typeof r&&e.currentFillStyle==r||(t.call(this,e,o),e.currentFillStyle=r)};ol.render.canvas.Replay.prototype.updateStrokeStyle=function(e,t){var o=e.strokeStyle,r=e.lineCap,n=e.lineDash,i=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;(e.currentStrokeStyle!=o||e.currentLineCap!=r||n!=e.currentLineDash&&!ol.array.equals(e.currentLineDash,n)||e.currentLineDashOffset!=i||e.currentLineJoin!=a||e.currentLineWidth!=s||e.currentMiterLimit!=l)&&(t.call(this,e),e.currentStrokeStyle=o,e.currentLineCap=r,e.currentLineDash=n,e.currentLineDashOffset=i,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)};ol.render.canvas.Replay.prototype.endGeometry=function(e,t){this.beginGeometryInstruction1_[2]=this.instructions.length;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length;this.beginGeometryInstruction2_=null;e=[ol.render.canvas.Instruction.END_GEOMETRY,t];this.instructions.push(e);this.hitDetectionInstructions.push(e)};ol.render.canvas.Replay.prototype.finish=ol.nullFunction;ol.render.canvas.Replay.prototype.getBufferedMaxExtent=function(){this.bufferedMaxExtent_||(this.bufferedMaxExtent_=ol.extent.clone(this.maxExtent),0<this.maxLineWidth&&ol.extent.buffer(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_));return this.bufferedMaxExtent_};ol.render.canvas.ImageReplay=function(e,t,o,r,n,i){ol.render.canvas.Replay.call(this,e,t,o,r,n,i);this.image_=this.hitDetectionImage_=this.declutterGroup_=null;this.width_=this.snapToPixel_=this.scale_=this.rotation_=this.rotateWithView_=this.originY_=this.originX_=this.opacity_=this.height_=this.anchorY_=this.anchorX_=void 0};ol.inherits(ol.render.canvas.ImageReplay,ol.render.canvas.Replay);ol.render.canvas.ImageReplay.prototype.drawCoordinates_=function(e,t,o,r){return this.appendFlatCoordinates(e,t,o,r,!1,!1)};ol.render.canvas.ImageReplay.prototype.drawPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var o=e.getFlatCoordinates(),r=e.getStride(),n=this.coordinates.length;o=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,n,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]);this.endGeometry(e,t)}};ol.render.canvas.ImageReplay.prototype.drawMultiPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var o=e.getFlatCoordinates(),r=e.getStride(),n=this.coordinates.length;o=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,n,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]);this.endGeometry(e,t)}};ol.render.canvas.ImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions();this.anchorY_=this.anchorX_=void 0;this.image_=this.hitDetectionImage_=null;this.width_=this.snapToPixel_=this.rotation_=this.rotateWithView_=this.originY_=this.originX_=this.opacity_=this.scale_=this.height_=void 0};ol.render.canvas.ImageReplay.prototype.setImageStyle=function(e,t){var o=e.getAnchor(),r=e.getSize(),n=e.getHitDetectionImage(1),i=e.getImage(1),a=e.getOrigin();this.anchorX_=o[0];this.anchorY_=o[1];this.declutterGroup_=t;this.hitDetectionImage_=n;this.image_=i;this.height_=r[1];this.opacity_=e.getOpacity();this.originX_=a[0];this.originY_=a[1];this.rotateWithView_=e.getRotateWithView();this.rotation_=e.getRotation();this.scale_=e.getScale();this.snapToPixel_=e.getSnapToPixel();this.width_=r[0]};ol.render.canvas.LineStringReplay=function(e,t,o,r,n,i){ol.render.canvas.Replay.call(this,e,t,o,r,n,i)};ol.inherits(ol.render.canvas.LineStringReplay,ol.render.canvas.Replay);ol.render.canvas.LineStringReplay.prototype.drawFlatCoordinates_=function(e,t,o,r){var n=this.coordinates.length;e=this.appendFlatCoordinates(e,t,o,r,!1,!1);n=[ol.render.canvas.Instruction.MOVE_TO_LINE_TO,n,e];this.instructions.push(n);this.hitDetectionInstructions.push(n);return o};ol.render.canvas.LineStringReplay.prototype.drawLineString=function(e,t){var o=this.state,r=o.lineWidth;void 0!==o.strokeStyle&&void 0!==r&&(this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],[ol.render.canvas.Instruction.BEGIN_PATH]),o=e.getFlatCoordinates(),r=e.getStride(),this.drawFlatCoordinates_(o,0,o.length,r),this.hitDetectionInstructions.push([ol.render.canvas.Instruction.STROKE]),this.endGeometry(e,t))};ol.render.canvas.LineStringReplay.prototype.drawMultiLineString=function(e,t){var o=this.state,r=o.lineWidth;if(void 0!==o.strokeStyle&&void 0!==r){this.updateStrokeStyle(o,this.applyStroke);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],[ol.render.canvas.Instruction.BEGIN_PATH]);o=e.getEnds();r=e.getFlatCoordinates();var n,i=e.getStride(),a=0,s=0;for(n=o.length;s<n;++s)a=this.drawFlatCoordinates_(r,a,o[s],i);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.STROKE]);this.endGeometry(e,t)}};ol.render.canvas.LineStringReplay.prototype.finish=function(){var e=this.state;void 0!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push([ol.render.canvas.Instruction.STROKE]);this.reverseHitDetectionInstructions();this.state=null};ol.render.canvas.LineStringReplay.prototype.applyStroke=function(e){void 0!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push([ol.render.canvas.Instruction.STROKE]),e.lastStroke=this.coordinates.length);e.lastStroke=0;ol.render.canvas.Replay.prototype.applyStroke.call(this,e);this.instructions.push([ol.render.canvas.Instruction.BEGIN_PATH])};ol.render.canvas.PolygonReplay=function(e,t,o,r,n,i){ol.render.canvas.Replay.call(this,e,t,o,r,n,i)};ol.inherits(ol.render.canvas.PolygonReplay,ol.render.canvas.Replay);ol.render.canvas.PolygonReplay.prototype.drawFlatCoordinatess_=function(e,t,o,r){var n=this.state,i=void 0!==n.fillStyle;n=void 0!=n.strokeStyle;var a=o.length,s=[ol.render.canvas.Instruction.BEGIN_PATH];this.instructions.push(s);this.hitDetectionInstructions.push(s);for(s=0;s<a;++s){var l=o[s],c=this.coordinates.length;t=this.appendFlatCoordinates(e,t,l,r,!0,!n);t=[ol.render.canvas.Instruction.MOVE_TO_LINE_TO,c,t];this.instructions.push(t);this.hitDetectionInstructions.push(t);n&&(t=[ol.render.canvas.Instruction.CLOSE_PATH],this.instructions.push(t),this.hitDetectionInstructions.push(t));t=l}e=[ol.render.canvas.Instruction.FILL];this.hitDetectionInstructions.push(e);i&&this.instructions.push(e);n&&(i=[ol.render.canvas.Instruction.STROKE],this.instructions.push(i),this.hitDetectionInstructions.push(i));return t};ol.render.canvas.PolygonReplay.prototype.drawCircle=function(e,t){var o=this.state,r=o.strokeStyle;if(void 0!==o.fillStyle||void 0!==r){this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);var n=e.getFlatCoordinates(),i=e.getStride();r=this.coordinates.length;this.appendFlatCoordinates(n,0,n.length,i,!1,!1);n=[ol.render.canvas.Instruction.BEGIN_PATH];r=[ol.render.canvas.Instruction.CIRCLE,r];this.instructions.push(n,r);this.hitDetectionInstructions.push(n,r);r=[ol.render.canvas.Instruction.FILL];this.hitDetectionInstructions.push(r);void 0!==o.fillStyle&&this.instructions.push(r);void 0!==o.strokeStyle&&(o=[ol.render.canvas.Instruction.STROKE],this.instructions.push(o),this.hitDetectionInstructions.push(o));this.endGeometry(e,t)}};ol.render.canvas.PolygonReplay.prototype.drawPolygon=function(e,t){var o=this.state;this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);o=e.getEnds();var r=e.getOrientedFlatCoordinates(),n=e.getStride();this.drawFlatCoordinatess_(r,0,o,n);this.endGeometry(e,t)};ol.render.canvas.PolygonReplay.prototype.drawMultiPolygon=function(e,t){var o=this.state,r=o.strokeStyle;if(void 0!==o.fillStyle||void 0!==r){this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);o=e.getEndss();r=e.getOrientedFlatCoordinates();var n,i=e.getStride(),a=0,s=0;for(n=o.length;s<n;++s)a=this.drawFlatCoordinatess_(r,a,o[s],i);this.endGeometry(e,t)}};ol.render.canvas.PolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions();this.state=null;var e=this.tolerance;if(0!==e){var t,o=this.coordinates,r=0;for(t=o.length;r<t;++r)o[r]=ol.geom.flat.simplify.snap(o[r],e)}};ol.render.canvas.PolygonReplay.prototype.setFillStrokeStyles_=function(e){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.applyFill,e);void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)};ol.geom.flat.straightchunk={};ol.geom.flat.straightchunk.lineString=function(e,t,o,r,n){for(var i,a,s,l,c,u,h=o,d=o,p=0,f=0,g=o;o<r;o+=n){var m=t[o],y=t[o+1];void 0!==s&&(s=m-s,l=y-l,a=Math.sqrt(s*s+l*l),void 0!==c&&(f+=i,(i=Math.acos((c*s+u*l)/(i*a)))>e&&(f>p&&(p=f,h=g,d=o),f=0,g=o-n)),i=a,c=s,u=l);s=m;l=y}return f+a>p?[g,o]:[h,d]};ol.style.TextPlacement={POINT:"point",LINE:"line"};ol.render.canvas.TextReplay=function(e,t,o,r,n,i){ol.render.canvas.Replay.call(this,e,t,o,r,n,i);this.labels_=null;this.text_="";this.textOffsetY_=this.textOffsetX_=0;this.textRotateWithView_=void 0;this.textRotation_=0;this.textFillState_=null;this.fillStates={};this.textStrokeState_=null;this.strokeStates={};this.textState_={};this.textStates={};this.strokeKey_=this.fillKey_=this.textKey_="";this.widths_={};ol.render.canvas.labelCache.prune()};ol.inherits(ol.render.canvas.TextReplay,ol.render.canvas.Replay);ol.render.canvas.TextReplay.measureTextWidths=function(e,t,o){var r,n=t.length,i=0;for(r=0;r<n;++r){var a=ol.render.canvas.measureTextWidth(e,t[r]);i=Math.max(i,a);o.push(a)}return i};ol.render.canvas.TextReplay.prototype.drawText=function(e,t){var o=this.textFillState_,r=this.textStrokeState_,n=this.textState_;if(""!==this.text_&&n&&(o||r)){o=this.coordinates.length;var i=e.getType();r=null;var a=2,s=2;if(n.placement===ol.style.TextPlacement.LINE){if(!ol.extent.intersects(this.getBufferedMaxExtent(),e.getExtent()))return;r=e.getFlatCoordinates();s=e.getStride();if(i==ol.geom.GeometryType.LINE_STRING)var l=[r.length];else if(i==ol.geom.GeometryType.MULTI_LINE_STRING)l=e.getEnds();else if(i==ol.geom.GeometryType.POLYGON)l=e.getEnds().slice(0,1);else if(i==ol.geom.GeometryType.MULTI_POLYGON){var c=e.getEndss();l=[];a=0;for(i=c.length;a<i;++a)l.push(c[a][0])}this.beginGeometry(e,t);i=n.textAlign;var u=0;c=0;for(var h=l.length;c<h;++c){if(void 0==i){u=(a=ol.geom.flat.straightchunk.lineString(n.maxAngle,r,u,l[c],s))[0];var d=a[1]}else d=l[c];for(a=u;a<d;a+=s)this.coordinates.push(r[a],r[a+1]);a=this.coordinates.length;u=l[c];this.drawChars_(o,a,this.declutterGroup_);o=a}}else{c=(l=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_)).width/this.pixelRatio;switch(i){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:a=(r=e.getFlatCoordinates()).length;break;case ol.geom.GeometryType.LINE_STRING:r=e.getFlatMidpoint();break;case ol.geom.GeometryType.CIRCLE:r=e.getCenter();break;case ol.geom.GeometryType.MULTI_LINE_STRING:a=(r=e.getFlatMidpoints()).length;break;case ol.geom.GeometryType.POLYGON:r=e.getFlatInteriorPoint();if(!n.overflow&&r[2]/this.resolution<c)return;s=3;break;case ol.geom.GeometryType.MULTI_POLYGON:h=e.getFlatInteriorPoints();r=[];a=0;for(i=h.length;a<i;a+=3)(n.overflow||h[a+2]/this.resolution>=c)&&r.push(h[a],h[a+1]);if(0==(a=r.length))return}a=this.appendFlatCoordinates(r,0,a,s,!1,!1);this.beginGeometry(e,t);(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),this.updateFillStyle(this.state,this.applyFill,e),this.updateStrokeStyle(this.state,this.applyStroke));this.drawTextImage_(l,o,a)}this.endGeometry(e,t)}};ol.render.canvas.TextReplay.prototype.getImage=function(e,t,o,r){var n=r+t+e+o+this.pixelRatio,i=ol.render.canvas.labelCache;if(!i.containsKey(n)){var a=r?this.strokeStates[r]||this.textStrokeState_:null,s=o?this.fillStates[o]||this.textFillState_:null,l=this.textStates[t]||this.textState_,c=l.scale*this.pixelRatio,u=ol.render.replay.TEXT_ALIGN[l.textAlign||ol.render.canvas.defaultTextAlign];t=r&&a.lineWidth?a.lineWidth:0;var h=(e=e.split("\n")).length,d=[],p=ol.render.canvas.TextReplay.measureTextWidths(l.font,e,d),f=ol.render.canvas.measureTextHeight(l.font),g=(p=ol.dom.createCanvasContext2D(Math.ceil((p+t)*c),Math.ceil((f*h+t)*c))).canvas;i.set(n,g);1!=c&&p.scale(c,c);p.font=l.font;r&&(p.strokeStyle=a.strokeStyle,p.lineWidth=t*(ol.has.SAFARI?c:1),p.lineCap=a.lineCap,p.lineJoin=a.lineJoin,p.miterLimit=a.miterLimit,ol.has.CANVAS_LINE_DASH&&a.lineDash.length&&(p.setLineDash(a.lineDash),p.lineDashOffset=a.lineDashOffset));o&&(p.fillStyle=s.fillStyle);p.textBaseline="middle";p.textAlign="center";a=.5-u;s=u*g.width/c+a*t;if(r)for(r=0;r<h;++r)p.strokeText(e[r],s+a*d[r],.5*(t+f)+r*f);if(o)for(r=0;r<h;++r)p.fillText(e[r],s+a*d[r],.5*(t+f)+r*f)}return i.get(n)};ol.render.canvas.TextReplay.prototype.drawTextImage_=function(e,t,o){var r=this.textState_,n=this.textStrokeState_,i=this.pixelRatio,a=ol.render.replay.TEXT_ALIGN[r.textAlign||ol.render.canvas.defaultTextAlign],s=ol.render.replay.TEXT_ALIGN[r.textBaseline];n=n&&n.lineWidth?n.lineWidth:0;a=a*e.width/i+2*(.5-a)*n;s=s*e.height/i+2*(.5-s)*n;this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,t,o,e,(a-this.textOffsetX_)*i,(s-this.textOffsetY_)*i,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,e.width,r.padding==ol.render.canvas.defaultPadding?ol.render.canvas.defaultPadding:r.padding.map(function(e){return e*i}),!!r.backgroundFill,!!r.backgroundStroke]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,t,o,e,(a-this.textOffsetX_)*i,(s-this.textOffsetY_)*i,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/i,!0,e.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])};ol.render.canvas.TextReplay.prototype.drawChars_=function(e,t,o){var r=this.textStrokeState_,n=this.textState_,i=this.textFillState_,a=this.strokeKey_;r&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash}));var s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:n.font,textAlign:n.textAlign||ol.render.canvas.defaultTextAlign,scale:n.scale});var l=this.fillKey_;i&&(l in this.fillStates||(this.fillStates[l]={fillStyle:i.fillStyle}));var c=this.pixelRatio;i=ol.render.replay.TEXT_ALIGN[n.textBaseline];var u=this.textOffsetY_*c,h=this.text_,d=n.font,p=n.scale;r=r?r.lineWidth*p/2:0;var f=this.widths_[d];f||(this.widths_[d]=f={});this.instructions.push([ol.render.canvas.Instruction.DRAW_CHARS,e,t,i,o,n.overflow,l,n.maxAngle,function(e){var t=f[e];t||(t=f[e]=ol.render.canvas.measureTextWidth(d,e));return t*p*c},u,a,r*c,h,s,1]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_CHARS,e,t,i,o,n.overflow,l,n.maxAngle,function(e){var t=f[e];t||(t=f[e]=ol.render.canvas.measureTextWidth(d,e));return t*p},u,a,r,h,s,1/c])};ol.render.canvas.TextReplay.prototype.setTextStyle=function(e,t){var o,r;if(e){this.declutterGroup_=t;(r=e.getFill())?((t=this.textFillState_)||(t=this.textFillState_={}),t.fillStyle=ol.colorlike.asColorLike(r.getColor()||ol.render.canvas.defaultFillStyle)):t=this.textFillState_=null;if(o=e.getStroke()){(r=this.textStrokeState_)||(r=this.textStrokeState_={});var n=o.getLineDash(),i=o.getLineDashOffset(),a=o.getWidth(),s=o.getMiterLimit();r.lineCap=o.getLineCap()||ol.render.canvas.defaultLineCap;r.lineDash=n?n.slice():ol.render.canvas.defaultLineDash;r.lineDashOffset=void 0===i?ol.render.canvas.defaultLineDashOffset:i;r.lineJoin=o.getLineJoin()||ol.render.canvas.defaultLineJoin;r.lineWidth=void 0===a?ol.render.canvas.defaultLineWidth:a;r.miterLimit=void 0===s?ol.render.canvas.defaultMiterLimit:s;r.strokeStyle=ol.colorlike.asColorLike(o.getColor()||ol.render.canvas.defaultStrokeStyle)}else r=this.textStrokeState_=null;o=this.textState_;n=e.getFont()||ol.render.canvas.defaultFont;ol.render.canvas.checkFont(n);i=e.getScale();o.overflow=e.getOverflow();o.font=n;o.maxAngle=e.getMaxAngle();o.placement=e.getPlacement();o.textAlign=e.getTextAlign();o.textBaseline=e.getTextBaseline()||ol.render.canvas.defaultTextBaseline;o.backgroundFill=e.getBackgroundFill();o.backgroundStroke=e.getBackgroundStroke();o.padding=e.getPadding()||ol.render.canvas.defaultPadding;o.scale=void 0===i?1:i;n=e.getOffsetX();i=e.getOffsetY();a=e.getRotateWithView();s=e.getRotation();this.text_=e.getText()||"";this.textOffsetX_=void 0===n?0:n;this.textOffsetY_=void 0===i?0:i;this.textRotateWithView_=void 0!==a&&a;this.textRotation_=void 0===s?0:s;this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:ol.getUid(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"";this.textKey_=o.font+o.scale+(o.textAlign||"?");this.fillKey_=t?"string"==typeof t.fillStyle?t.fillStyle:"|"+ol.getUid(t.fillStyle):""}else this.text_=""};ol.render.canvas.ReplayGroup=function(e,t,o,r,n,i,a){ol.render.ReplayGroup.call(this);this.declutterTree_=i;this.declutterGroup_=null;this.tolerance_=e;this.maxExtent_=t;this.overlaps_=n;this.pixelRatio_=r;this.resolution_=o;this.renderBuffer_=a;this.replaysByZIndex_={};this.hitDetectionContext_=ol.dom.createCanvasContext2D(1,1);this.hitDetectionTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.ReplayGroup,ol.render.ReplayGroup);ol.render.canvas.ReplayGroup.circleArrayCache_={0:[[!0]]};ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_=function(e,t,o){var r,n=Math.floor(e.length/2);if(t>=n)for(r=n;r<t;r++)e[r][o]=!0;else if(t<n)for(r=t+1;r<n;r++)e[r][o]=!0};ol.render.canvas.ReplayGroup.getCircleArray_=function(e){if(void 0!==ol.render.canvas.ReplayGroup.circleArrayCache_[e])return ol.render.canvas.ReplayGroup.circleArrayCache_[e];for(var t=2*e+1,o=Array(t),r=0;r<t;r++)o[r]=Array(t);t=e;for(var n=r=0;t>=r;)ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+t,e+r),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+r,e+t),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-r,e+t),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-t,e+r),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-t,e-r),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-r,e-t),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+r,e-t),ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+t,e-r),0<2*((n+=1+2*++r)-t)+1&&(n+=1-2*--t);return ol.render.canvas.ReplayGroup.circleArrayCache_[e]=o};ol.render.canvas.ReplayGroup.replayDeclutter=function(e,t,o){for(var r=Object.keys(e).map(Number).sort(ol.array.numberSafeCompareFunction),n={},i=0,a=r.length;i<a;++i)for(var s=e[r[i].toString()],l=0,c=s.length;l<c;){var u=s[l++],h=s[l++];u.replay(t,h,o,n)}};ol.render.canvas.ReplayGroup.prototype.addDeclutter=function(e){var t=null;this.declutterTree_&&(e?(t=this.declutterGroup_)[4]++:(t=this.declutterGroup_=ol.extent.createEmpty()).push(1));return t};ol.render.canvas.ReplayGroup.prototype.clip=function(e,t){t=this.getClipCoords(t);e.beginPath();e.moveTo(t[0],t[1]);e.lineTo(t[2],t[3]);e.lineTo(t[4],t[5]);e.lineTo(t[6],t[7]);e.clip()};ol.render.canvas.ReplayGroup.prototype.hasReplays=function(e){for(var t in this.replaysByZIndex_)for(var o=this.replaysByZIndex_[t],r=0,n=e.length;r<n;++r)if(e[r]in o)return!0;return!1};ol.render.canvas.ReplayGroup.prototype.finish=function(){for(var e in this.replaysByZIndex_){var t,o=this.replaysByZIndex_[e];for(t in o)o[t].finish()}};ol.render.canvas.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,i,a){function s(e){for(var t=u.getImageData(0,0,l,l).data,o=0;o<l;o++)for(var r=0;r<l;r++)if(p[o][r]&&0<t[4*(r*l+o)+3]){if(!d||m!=ol.render.ReplayType.IMAGE&&m!=ol.render.ReplayType.TEXT||-1!==d.indexOf(e))var n=i(e);if(n)return n;u.clearRect(0,0,l,l);return}}var l=2*(r=Math.round(r))+1,c=ol.transform.compose(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-o,-e[0],-e[1]),u=this.hitDetectionContext_;u.canvas.width!==l||u.canvas.height!==l?(u.canvas.width=l,u.canvas.height=l):u.clearRect(0,0,l,l);if(void 0!==this.renderBuffer_){var h=ol.extent.createEmpty();ol.extent.extendCoordinate(h,e);ol.extent.buffer(h,t*(this.renderBuffer_+r),h)}var d,p=ol.render.canvas.ReplayGroup.getCircleArray_(r);this.declutterTree_&&(d=this.declutterTree_.all().map(function(e){return e.value}));(e=Object.keys(this.replaysByZIndex_).map(Number)).sort(ol.array.numberSafeCompareFunction);for(t=e.length-1;0<=t;--t){var f=e[t].toString(),g=this.replaysByZIndex_[f];for(r=ol.render.replay.ORDER.length-1;0<=r;--r){var m=ol.render.replay.ORDER[r],y=g[m];if(void 0!==y)if(!a||m!=ol.render.ReplayType.IMAGE&&m!=ol.render.ReplayType.TEXT){if(y=y.replayHitDetection(u,c,o,n,s,h))return y}else{var C=a[f];C?C.push(y,c.slice(0)):a[f]=[y,c.slice(0)]}}}};ol.render.canvas.ReplayGroup.prototype.getClipCoords=function(e){var t=this.maxExtent_,o=t[0],r=t[1],n=t[2];o=[o,r,o,t=t[3],n,t,n,r];ol.geom.flat.transform.transform2D(o,0,8,2,e,o);return o};ol.render.canvas.ReplayGroup.prototype.getReplay=function(e,t){var o=void 0!==e?e.toString():"0";void 0===(e=this.replaysByZIndex_[o])&&(e={},this.replaysByZIndex_[o]=e);void 0===(o=e[t])&&(o=new ol.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_[t](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),e[t]=o);return o};ol.render.canvas.ReplayGroup.prototype.getReplays=function(){return this.replaysByZIndex_};ol.render.canvas.ReplayGroup.prototype.isEmpty=function(){return ol.obj.isEmpty(this.replaysByZIndex_)};ol.render.canvas.ReplayGroup.prototype.replay=function(e,t,o,r,n,i){var a,s,l=Object.keys(this.replaysByZIndex_).map(Number);l.sort(ol.array.numberSafeCompareFunction);e.save();this.clip(e,t);n=n||ol.render.replay.ORDER;var c=0;for(a=l.length;c<a;++c){var u=l[c].toString(),h=this.replaysByZIndex_[u],d=0;for(s=n.length;d<s;++d){var p=n[d],f=h[p];void 0!==f&&(!i||p!=ol.render.ReplayType.IMAGE&&p!=ol.render.ReplayType.TEXT?f.replay(e,t,o,r):(p=i[u])?p.push(f,t.slice(0)):i[u]=[f,t.slice(0)])}}e.restore()};ol.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:ol.render.canvas.PolygonReplay,Default:ol.render.canvas.Replay,Image:ol.render.canvas.ImageReplay,LineString:ol.render.canvas.LineStringReplay,Polygon:ol.render.canvas.PolygonReplay,Text:ol.render.canvas.TextReplay};ol.renderer.vector={};ol.renderer.vector.defaultOrder=function(e,t){return ol.getUid(e)-ol.getUid(t)};ol.renderer.vector.getSquaredTolerance=function(e,t){return(e=ol.renderer.vector.getTolerance(e,t))*e};ol.renderer.vector.getTolerance=function(e,t){return ol.SIMPLIFY_TOLERANCE*e/t};ol.renderer.vector.renderCircleGeometry_=function(e,t,o,r){var n=o.getFill(),i=o.getStroke();if(n||i){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.CIRCLE);a.setFillStrokeStyle(n,i);a.drawCircle(t,r)}(n=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(n,e.addDeclutter(!1)),o.drawText(t,r))};ol.renderer.vector.renderFeature=function(e,t,o,r,n,i){var a,s=!1;if(a=o.getImage()){var l=a.getImageState();l==ol.ImageState.LOADED||l==ol.ImageState.ERROR?a.unlistenImageChange(n,i):(l==ol.ImageState.IDLE&&a.load(),a.getImageState(),a.listenImageChange(n,i),s=!0)}ol.renderer.vector.renderFeature_(e,t,o,r);return s};ol.renderer.vector.renderFeature_=function(e,t,o,r){var n=o.getGeometryFunction()(t);n&&(r=n.getSimplifiedGeometry(r),o.getRenderer()?ol.renderer.vector.renderGeometry_(e,r,o,t):(0,ol.renderer.vector.GEOMETRY_RENDERERS_[r.getType()])(e,r,o,t))};ol.renderer.vector.renderGeometry_=function(e,t,o,r){if(t.getType()==ol.geom.GeometryType.GEOMETRY_COLLECTION)for(var n=0,i=(t=t.getGeometries()).length;n<i;++n)ol.renderer.vector.renderGeometry_(e,t[n],o,r);else e.getReplay(o.getZIndex(),ol.render.ReplayType.DEFAULT).drawCustom(t,r,o.getRenderer())};ol.renderer.vector.renderGeometryCollectionGeometry_=function(e,t,o,r){var n,i=0;for(n=(t=t.getGeometriesArray()).length;i<n;++i)(0,ol.renderer.vector.GEOMETRY_RENDERERS_[t[i].getType()])(e,t[i],o,r)};ol.renderer.vector.renderLineStringGeometry_=function(e,t,o,r){var n=o.getStroke();if(n){var i=e.getReplay(o.getZIndex(),ol.render.ReplayType.LINE_STRING);i.setFillStrokeStyle(null,n);i.drawLineString(t,r)}(n=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(n,e.addDeclutter(!1)),o.drawText(t,r))};ol.renderer.vector.renderMultiLineStringGeometry_=function(e,t,o,r){var n=o.getStroke();if(n){var i=e.getReplay(o.getZIndex(),ol.render.ReplayType.LINE_STRING);i.setFillStrokeStyle(null,n);i.drawMultiLineString(t,r)}(n=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(n,e.addDeclutter(!1)),o.drawText(t,r))};ol.renderer.vector.renderMultiPolygonGeometry_=function(e,t,o,r){var n=o.getFill(),i=o.getStroke();if(i||n){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.POLYGON);a.setFillStrokeStyle(n,i);a.drawMultiPolygon(t,r)}(n=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(n,e.addDeclutter(!1)),o.drawText(t,r))};ol.renderer.vector.renderPointGeometry_=function(e,t,o,r){var n=o.getImage();if(n){if(n.getImageState()!=ol.ImageState.LOADED)return;var i=e.getReplay(o.getZIndex(),ol.render.ReplayType.IMAGE);i.setImageStyle(n,e.addDeclutter(!1));i.drawPoint(t,r)}(i=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(i,e.addDeclutter(!!n)),o.drawText(t,r))};ol.renderer.vector.renderMultiPointGeometry_=function(e,t,o,r){var n=o.getImage();if(n){if(n.getImageState()!=ol.ImageState.LOADED)return;var i=e.getReplay(o.getZIndex(),ol.render.ReplayType.IMAGE);i.setImageStyle(n,e.addDeclutter(!1));i.drawMultiPoint(t,r)}(i=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(i,e.addDeclutter(!!n)),o.drawText(t,r))};ol.renderer.vector.renderPolygonGeometry_=function(e,t,o,r){var n=o.getFill(),i=o.getStroke();if(n||i){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.POLYGON);a.setFillStrokeStyle(n,i);a.drawPolygon(t,r)}(n=o.getText())&&((o=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT)).setTextStyle(n,e.addDeclutter(!1)),o.drawText(t,r))};ol.renderer.vector.GEOMETRY_RENDERERS_={Point:ol.renderer.vector.renderPointGeometry_,LineString:ol.renderer.vector.renderLineStringGeometry_,Polygon:ol.renderer.vector.renderPolygonGeometry_,MultiPoint:ol.renderer.vector.renderMultiPointGeometry_,MultiLineString:ol.renderer.vector.renderMultiLineStringGeometry_,MultiPolygon:ol.renderer.vector.renderMultiPolygonGeometry_,GeometryCollection:ol.renderer.vector.renderGeometryCollectionGeometry_,Circle:ol.renderer.vector.renderCircleGeometry_};ol.renderer.canvas.VectorLayer=function(e){ol.renderer.canvas.Layer.call(this,e);this.declutterTree_=e.getDeclutter()?ol.ext.rbush(9):null;this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=ol.extent.createEmpty();this.replayGroup_=this.renderedRenderOrder_=null;this.replayGroupChanged=!0;this.context=ol.dom.createCanvasContext2D();ol.events.listen(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this)};ol.inherits(ol.renderer.canvas.VectorLayer,ol.renderer.canvas.Layer);ol.renderer.canvas.VectorLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.VECTOR};ol.renderer.canvas.VectorLayer.create=function(e,t){return new ol.renderer.canvas.VectorLayer(t)};ol.renderer.canvas.VectorLayer.prototype.disposeInternal=function(){ol.events.unlisten(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this);ol.renderer.canvas.Layer.prototype.disposeInternal.call(this)};ol.renderer.canvas.VectorLayer.prototype.composeFrame=function(e,t,o){var r=e.extent,n=e.pixelRatio,i=t.managed?e.skippedFeatureUids:{},a=e.viewState,s=a.projection,l=a.rotation,c=s.getExtent(),u=this.getLayer().getSource(),h=this.getTransform(e,0);this.preCompose(o,e,h);var d=t.extent;(a=void 0!==d)&&this.clip(o,e,d);var p=this.replayGroup_;if(p&&!p.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var f=this.getLayer(),g=d=0,m=1!==t.opacity;f=f.hasListener(ol.render.EventType.RENDER);if(m||f){var y=o.canvas.width,C=o.canvas.height;if(l){var v=Math.round(Math.sqrt(y*y+C*C));d=(v-y)/2;g=(v-C)/2;y=C=v}this.context.canvas.width=y;this.context.canvas.height=C;y=this.context}else y=o;C=y.globalAlpha;m||(y.globalAlpha=t.opacity);y!=o&&y.translate(d,g);v=e.size[0]*n;n*=e.size[1];ol.render.canvas.rotateAtOffset(y,-l,v/2,n/2);p.replay(y,h,l,i);if(u.getWrapX()&&s.canWrapX()&&!ol.extent.containsExtent(c,r)){s=r[0];u=ol.extent.getWidth(c);for(var T=0;s<c[0];)h=u*--T,h=this.getTransform(e,h),p.replay(y,h,l,i),s+=u;T=0;for(s=r[2];s>c[2];)h=u*++T,h=this.getTransform(e,h),p.replay(y,h,l,i),s-=u;h=this.getTransform(e,0)}ol.render.canvas.rotateAtOffset(y,l,v/2,n/2);y!=o&&(f&&this.dispatchRenderEvent(y,e,h),m?(r=o.globalAlpha,o.globalAlpha=t.opacity,o.drawImage(y.canvas,-d,-g),o.globalAlpha=r):o.drawImage(y.canvas,-d,-g),y.translate(-d,-g));m||(y.globalAlpha=C)}a&&o.restore();this.postCompose(o,e,t,h)};ol.renderer.canvas.VectorLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){if(this.replayGroup_){var i=t.viewState.resolution;t=t.viewState.rotation;var a=this.getLayer(),s={};return this.replayGroup_.forEachFeatureAtCoordinate(e,i,t,o,{},function(e){var t=ol.getUid(e).toString();if(!(t in s))return s[t]=!0,r.call(n,e,a)},null)}};ol.renderer.canvas.VectorLayer.prototype.handleFontsChanged_=function(e){(e=this.getLayer()).getVisible()&&this.replayGroup_&&e.changed()};ol.renderer.canvas.VectorLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.canvas.VectorLayer.prototype.prepareFrame=function(e,t){var o=this.getLayer();t=o.getSource();this.updateLogos(e,t);var r=e.viewHints[ol.ViewHint.ANIMATING],n=e.viewHints[ol.ViewHint.INTERACTING],i=o.getUpdateWhileAnimating(),a=o.getUpdateWhileInteracting();if(!this.dirty_&&!i&&r||!a&&n)return!0;i=e.extent;var s=e.viewState;a=s.projection;var l=s.resolution,c=e.pixelRatio;r=o.getRevision();var u=o.getRenderBuffer();void 0===(n=o.getRenderOrder())&&(n=ol.renderer.vector.defaultOrder);i=ol.extent.buffer(i,u*l);u=s.projection.getExtent();t.getWrapX()&&s.projection.canWrapX()&&!ol.extent.containsExtent(u,e.extent)&&(e=ol.extent.getWidth(u),e=Math.max(ol.extent.getWidth(i)/2,e),i[0]=u[0]-e,i[2]=u[2]+e);if(!this.dirty_&&this.renderedResolution_==l&&this.renderedRevision_==r&&this.renderedRenderOrder_==n&&ol.extent.containsExtent(this.renderedExtent_,i))return this.replayGroupChanged=!1,!0;this.replayGroup_=null;this.dirty_=!1;var h=new ol.render.canvas.ReplayGroup(ol.renderer.vector.getTolerance(l,c),i,l,c,t.getOverlaps(),this.declutterTree_,o.getRenderBuffer());t.loadFeatures(i,l,a);e=function(e){var t=e.getStyleFunction();if(t)var r=t.call(e,l);else(t=o.getStyleFunction())&&(r=t(e,l));r&&(e=this.renderFeature(e,l,c,r,h),this.dirty_=this.dirty_||e)}.bind(this);if(n){var d=[];t.forEachFeatureInExtent(i,function(e){d.push(e)},this);d.sort(n);t=0;for(a=d.length;t<a;++t)e(d[t])}else t.forEachFeatureInExtent(i,e,this);h.finish();this.renderedResolution_=l;this.renderedRevision_=r;this.renderedRenderOrder_=n;this.renderedExtent_=i;this.replayGroup_=h;return this.replayGroupChanged=!0};ol.renderer.canvas.VectorLayer.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var a=0,s=r.length;a<s;++a)i=ol.renderer.vector.renderFeature(n,e,r[a],ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||i;else i=ol.renderer.vector.renderFeature(n,e,r,ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this);return i};ol.layer.VectorTileRenderType={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"};ol.renderer.canvas.VectorTileLayer=function(e){this.context=null;ol.renderer.canvas.TileLayer.call(this,e);this.declutterTree_=e.getDeclutter()?ol.ext.rbush(9):null;this.dirty_=!1;this.tmpTransform_=ol.transform.create();this.zDirection=e.getRenderMode()==ol.layer.VectorTileRenderType.VECTOR?1:0;ol.events.listen(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this)};ol.inherits(ol.renderer.canvas.VectorTileLayer,ol.renderer.canvas.TileLayer);ol.renderer.canvas.VectorTileLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.VECTOR_TILE};ol.renderer.canvas.VectorTileLayer.create=function(e,t){return new ol.renderer.canvas.VectorTileLayer(t)};ol.renderer.canvas.VectorTileLayer.IMAGE_REPLAYS={image:[ol.render.ReplayType.POLYGON,ol.render.ReplayType.CIRCLE,ol.render.ReplayType.LINE_STRING,ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT],hybrid:[ol.render.ReplayType.POLYGON,ol.render.ReplayType.LINE_STRING]};ol.renderer.canvas.VectorTileLayer.VECTOR_REPLAYS={image:[ol.render.ReplayType.DEFAULT],hybrid:[ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT,ol.render.ReplayType.DEFAULT],vector:ol.render.replay.ORDER};ol.renderer.canvas.VectorTileLayer.prototype.disposeInternal=function(){ol.events.unlisten(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this);ol.renderer.canvas.TileLayer.prototype.disposeInternal.call(this)};ol.renderer.canvas.VectorTileLayer.prototype.prepareFrame=function(e,t){var o=this.getLayer(),r=o.getRevision();this.renderedLayerRevision_!=r&&(this.renderedTiles.length=0,o=o.getRenderMode(),this.context||o==ol.layer.VectorTileRenderType.VECTOR||(this.context=ol.dom.createCanvasContext2D()),this.context&&o==ol.layer.VectorTileRenderType.VECTOR&&(this.context=null));this.renderedLayerRevision_=r;return ol.renderer.canvas.TileLayer.prototype.prepareFrame.apply(this,arguments)};ol.renderer.canvas.VectorTileLayer.prototype.createReplayGroup_=function(e,t){var o=this.getLayer(),r=t.pixelRatio;t=t.viewState.projection;var n=o.getRevision(),i=o.getRenderOrder()||null,a=e.getReplayState(o);if(a.dirty||a.renderedRevision!=n||a.renderedRenderOrder!=i){var s=o.getSource(),l=s.getTileGrid(),c=s.getTileGridForProjection(t),u=c.getResolution(e.tileCoord[0]);c=c.getTileCoordExtent(e.wrappedTileCoord);for(var h=0,d=e.tileKeys.length;h<d;++h){var p=e.getTile(e.tileKeys[h]);if(p.getState()!=ol.TileState.ERROR){var f=l.getTileCoordExtent(p.tileCoord),g=ol.extent.getIntersection(c,f),m=ol.extent.equals(f,g)?null:ol.extent.buffer(g,o.getRenderBuffer()*u),y=p.getProjection(),C=!1;ol.proj.equivalent(t,y)||(C=!0,p.setProjection(t));a.dirty=!1;g=new ol.render.canvas.ReplayGroup(0,g,u,r,s.getOverlaps(),this.declutterTree_,o.getRenderBuffer());var v=ol.renderer.vector.getSquaredTolerance(u,r),T=p.getFeatures();i&&i!==a.renderedRenderOrder&&T.sort(i);for(var _,S=0,E=T.length;S<E;++S)if(_=T[S],C&&(y.getUnits()==ol.proj.Units.TILE_PIXELS&&(y.setWorldExtent(f),y.setExtent(p.getExtent())),_.getGeometry().transform(y,t)),!m||ol.extent.intersects(m,_.getGeometry().getExtent())){var L=void 0,w=_.getStyleFunction();w?L=w.call(_,u):(w=o.getStyleFunction())&&(L=w(_,u));L&&(L=this.renderFeature(_,v,L,g),this.dirty_=this.dirty_||L,a.dirty=a.dirty||L)}g.finish();for(var b in g.getReplays());p.setReplayGroup(o,e.tileCoord.toString(),g)}}a.renderedRevision=n;a.renderedRenderOrder=i}};ol.renderer.canvas.VectorTileLayer.prototype.drawTileImage=function(e,t,o,r,n,i,a,s,l){var c=e;this.createReplayGroup_(c,t);this.context&&(this.renderTileImage_(c,t,o),ol.renderer.canvas.TileLayer.prototype.drawTileImage.apply(this,arguments))};ol.renderer.canvas.VectorTileLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){var i=t.viewState.resolution,a=t.viewState.rotation;o=void 0==o?0:o;var s,l=this.getLayer(),c={},u=this.renderedTiles;t=l.getSource().getTileGridForProjection(t.viewState.projection);var h=0;for(s=u.length;h<s;++h){var d=u[h],p=d.wrappedTileCoord;p=t.getTileCoordExtent(p,this.tmpExtent);var f=ol.extent.buffer(p,o*i,f);if(ol.extent.containsCoordinate(f,e)){p=0;for(var g=d.tileKeys.length;p<g;++p){var m=d.getTile(d.tileKeys[p]);if(m.getState()!=ol.TileState.ERROR){m=m.getReplayGroup(l,d.tileCoord.toString());var y=y||m.forEachFeatureAtCoordinate(e,i,a,o,{},function(e){var t=ol.getUid(e).toString();if(!(t in c))return c[t]=!0,r.call(n,e,l)},null)}}}}return y};ol.renderer.canvas.VectorTileLayer.prototype.getReplayTransform_=function(e,t){var o=this.getLayer().getSource().getTileGrid(),r=e.tileCoord;e=o.getResolution(r[0]);var n=t.viewState,i=t.pixelRatio,a=n.resolution/i;r=o.getTileCoordExtent(r,this.tmpExtent);o=n.center;r=ol.extent.getTopLeft(r);t=t.size;return ol.transform.compose(this.tmpTransform_,Math.round(i*t[0]/2),Math.round(i*t[1]/2),e/a,e/a,n.rotation,(r[0]-o[0])/e,(o[1]-r[1])/e)};ol.renderer.canvas.VectorTileLayer.prototype.handleFontsChanged_=function(e){(e=this.getLayer()).getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()};ol.renderer.canvas.VectorTileLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.canvas.VectorTileLayer.prototype.postCompose=function(e,t,o){var r=this.getLayer(),n=r.getDeclutter()?{}:null,i=r.getSource(),a=r.getRenderMode(),s=ol.renderer.canvas.VectorTileLayer.VECTOR_REPLAYS[a],l=t.pixelRatio,c=t.viewState.rotation,u=t.size;if(c){var h=Math.round(l*u[0]/2),d=Math.round(l*u[1]/2);ol.render.canvas.rotateAtOffset(e,-c,h,d)}n&&this.declutterTree_.clear();l=this.renderedTiles;i=i.getTileGridForProjection(t.viewState.projection);u=[];for(var p=[],f=l.length-1;0<=f;--f){var g=l[f];if(g.getState()!=ol.TileState.ABORT)for(var m=g.tileCoord,y=i.getTileCoordExtent(m)[0]-i.getTileCoordExtent(g.wrappedTileCoord)[0],C=void 0,v=0,T=g.tileKeys.length;v<T;++v){var _=g.getTile(g.tileKeys[v]);if(_.getState()!=ol.TileState.ERROR){var S=_.getReplayGroup(r,m.toString());if(a==ol.layer.VectorTileRenderType.VECTOR||S.hasReplays(s)){C||(C=this.getTransform(t,y));_=_.tileCoord[0];var E=S.getClipCoords(C);e.save();e.globalAlpha=o.opacity;for(var L=0,w=u.length;L<w;++L){var b=u[L];_<p[L]&&(e.beginPath(),e.moveTo(E[0],E[1]),e.lineTo(E[2],E[3]),e.lineTo(E[4],E[5]),e.lineTo(E[6],E[7]),e.moveTo(b[6],b[7]),e.lineTo(b[4],b[5]),e.lineTo(b[2],b[3]),e.lineTo(b[0],b[1]),e.clip())}S.replay(e,C,c,{},s,n);e.restore();u.push(E);p.push(_)}}}}n&&ol.render.canvas.ReplayGroup.replayDeclutter(n,e,c);c&&ol.render.canvas.rotateAtOffset(e,c,h,d);ol.renderer.canvas.TileLayer.prototype.postCompose.apply(this,arguments)};ol.renderer.canvas.VectorTileLayer.prototype.renderFeature=function(e,t,o,r){if(!o)return!1;var n=!1;if(Array.isArray(o))for(var i=0,a=o.length;i<a;++i)n=ol.renderer.vector.renderFeature(r,e,o[i],t,this.handleStyleImageChange_,this)||n;else n=ol.renderer.vector.renderFeature(r,e,o,t,this.handleStyleImageChange_,this);return n};ol.renderer.canvas.VectorTileLayer.prototype.renderTileImage_=function(e,t,o){o=this.getLayer();var r=e.getReplayState(o),n=o.getRevision(),i=ol.renderer.canvas.VectorTileLayer.IMAGE_REPLAYS[o.getRenderMode()];if(i&&r.renderedTileRevision!==n){r.renderedTileRevision=n;var a=e.wrappedTileCoord,s=a[0];r=t.pixelRatio;var l=o.getSource(),c=l.getTileGridForProjection(t.viewState.projection);n=c.getResolution(s);var u=e.getContext(o);t=l.getTilePixelSize(s,r,t.viewState.projection);u.canvas.width=t[0];u.canvas.height=t[1];t=c.getTileCoordExtent(a);a=0;for(c=e.tileKeys.length;a<c;++a)if((s=e.getTile(e.tileKeys[a])).getState()!=ol.TileState.ERROR){l=r/n;var h=ol.transform.reset(this.tmpTransform_);ol.transform.scale(h,l,-l);ol.transform.translate(h,-t[0],-t[3]);s.getReplayGroup(o,e.tileCoord.toString()).replay(u,h,0,{},i)}}};ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.canvas.Map);ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.canvas.ImageLayer,ol.renderer.canvas.TileLayer,ol.renderer.canvas.VectorLayer,ol.renderer.canvas.VectorTileLayer]);ol.CanvasMap=function(e){delete(e=ol.obj.assign({},e)).renderer;e.controls||(e.controls=ol.control.defaults());e.interactions||(e.interactions=ol.interaction.defaults());ol.PluggableMap.call(this,e)};ol.inherits(ol.CanvasMap,ol.PluggableMap);ol.DeviceOrientation=function(e){ol.Object.call(this);e=e||{};this.listenerKey_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.DeviceOrientation.Property_.TRACKING),this.handleTrackingChanged_,this);this.setTracking(void 0!==e.tracking&&e.tracking)};ol.inherits(ol.DeviceOrientation,ol.Object);ol.DeviceOrientation.prototype.disposeInternal=function(){this.setTracking(!1);ol.Object.prototype.disposeInternal.call(this)};ol.DeviceOrientation.prototype.orientationChange_=function(e){if(null!==e.alpha){var t=ol.math.toRadians(e.alpha);this.set(ol.DeviceOrientation.Property_.ALPHA,t);"boolean"==typeof e.absolute&&e.absolute?this.set(ol.DeviceOrientation.Property_.HEADING,t):"number"==typeof e.webkitCompassHeading&&-1!=e.webkitCompassAccuracy&&(t=ol.math.toRadians(e.webkitCompassHeading),this.set(ol.DeviceOrientation.Property_.HEADING,t))}null!==e.beta&&this.set(ol.DeviceOrientation.Property_.BETA,ol.math.toRadians(e.beta));null!==e.gamma&&this.set(ol.DeviceOrientation.Property_.GAMMA,ol.math.toRadians(e.gamma));this.changed()};ol.DeviceOrientation.prototype.getAlpha=function(){return this.get(ol.DeviceOrientation.Property_.ALPHA)};ol.DeviceOrientation.prototype.getBeta=function(){return this.get(ol.DeviceOrientation.Property_.BETA)};ol.DeviceOrientation.prototype.getGamma=function(){return this.get(ol.DeviceOrientation.Property_.GAMMA)};ol.DeviceOrientation.prototype.getHeading=function(){return this.get(ol.DeviceOrientation.Property_.HEADING)};ol.DeviceOrientation.prototype.getTracking=function(){return this.get(ol.DeviceOrientation.Property_.TRACKING)};ol.DeviceOrientation.prototype.handleTrackingChanged_=function(){if(ol.has.DEVICE_ORIENTATION){var e=this.getTracking();e&&!this.listenerKey_?this.listenerKey_=ol.events.listen(window,"deviceorientation",this.orientationChange_,this):e||null===this.listenerKey_||(ol.events.unlistenByKey(this.listenerKey_),this.listenerKey_=null)}};ol.DeviceOrientation.prototype.setTracking=function(e){this.set(ol.DeviceOrientation.Property_.TRACKING,e)};ol.DeviceOrientation.Property_={ALPHA:"alpha",BETA:"beta",GAMMA:"gamma",HEADING:"heading",TRACKING:"tracking"};ol.style.Image=function(e){this.opacity_=e.opacity;this.rotateWithView_=e.rotateWithView;this.rotation_=e.rotation;this.scale_=e.scale;this.snapToPixel_=e.snapToPixel};ol.style.Image.prototype.getOpacity=function(){return this.opacity_};ol.style.Image.prototype.getRotateWithView=function(){return this.rotateWithView_};ol.style.Image.prototype.getRotation=function(){return this.rotation_};ol.style.Image.prototype.getScale=function(){return this.scale_};ol.style.Image.prototype.getSnapToPixel=function(){return this.snapToPixel_};ol.style.Image.prototype.getAnchor=function(){};ol.style.Image.prototype.getImage=function(e){};ol.style.Image.prototype.getHitDetectionImage=function(e){};ol.style.Image.prototype.getImageState=function(){};ol.style.Image.prototype.getImageSize=function(){};ol.style.Image.prototype.getHitDetectionImageSize=function(){};ol.style.Image.prototype.getOrigin=function(){};ol.style.Image.prototype.getSize=function(){};ol.style.Image.prototype.setOpacity=function(e){this.opacity_=e};ol.style.Image.prototype.setRotateWithView=function(e){this.rotateWithView_=e};ol.style.Image.prototype.setRotation=function(e){this.rotation_=e};ol.style.Image.prototype.setScale=function(e){this.scale_=e};ol.style.Image.prototype.setSnapToPixel=function(e){this.snapToPixel_=e};ol.style.Image.prototype.listenImageChange=function(e,t){};ol.style.Image.prototype.load=function(){};ol.style.Image.prototype.unlistenImageChange=function(e,t){};ol.style.RegularShape=function(e){this.hitDetectionCanvas_=this.canvas_=this.checksums_=null;this.fill_=void 0!==e.fill?e.fill:null;this.origin_=[0,0];this.points_=e.points;this.radius_=void 0!==e.radius?e.radius:e.radius1;this.radius2_=e.radius2;this.angle_=void 0!==e.angle?e.angle:0;this.stroke_=void 0!==e.stroke?e.stroke:null;this.hitDetectionImageSize_=this.imageSize_=this.size_=this.anchor_=null;this.atlasManager_=e.atlasManager;this.render_(this.atlasManager_);ol.style.Image.call(this,{opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:1,snapToPixel:void 0===e.snapToPixel||e.snapToPixel})};ol.inherits(ol.style.RegularShape,ol.style.Image);ol.style.RegularShape.prototype.clone=function(){var e=new ol.style.RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});e.setOpacity(this.getOpacity());e.setScale(this.getScale());return e};ol.style.RegularShape.prototype.getAnchor=function(){return this.anchor_};ol.style.RegularShape.prototype.getAngle=function(){return this.angle_};ol.style.RegularShape.prototype.getFill=function(){return this.fill_};ol.style.RegularShape.prototype.getHitDetectionImage=function(e){return this.hitDetectionCanvas_};ol.style.RegularShape.prototype.getImage=function(e){return this.canvas_};ol.style.RegularShape.prototype.getImageSize=function(){return this.imageSize_};ol.style.RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_};ol.style.RegularShape.prototype.getImageState=function(){return ol.ImageState.LOADED};ol.style.RegularShape.prototype.getOrigin=function(){return this.origin_};ol.style.RegularShape.prototype.getPoints=function(){return this.points_};ol.style.RegularShape.prototype.getRadius=function(){return this.radius_};ol.style.RegularShape.prototype.getRadius2=function(){return this.radius2_};ol.style.RegularShape.prototype.getSize=function(){return this.size_};ol.style.RegularShape.prototype.getStroke=function(){return this.stroke_};ol.style.RegularShape.prototype.listenImageChange=function(e,t){};ol.style.RegularShape.prototype.load=function(){};ol.style.RegularShape.prototype.unlistenImageChange=function(e,t){};ol.style.RegularShape.prototype.render_=function(e){var t="",o="",r=0,n=null,i=0,a=0;if(this.stroke_){var s=this.stroke_.getColor();null===s&&(s=ol.render.canvas.defaultStrokeStyle);s=ol.colorlike.asColorLike(s);void 0===(a=this.stroke_.getWidth())&&(a=ol.render.canvas.defaultLineWidth);n=this.stroke_.getLineDash();i=this.stroke_.getLineDashOffset();ol.has.CANVAS_LINE_DASH||(n=null,i=0);void 0===(o=this.stroke_.getLineJoin())&&(o=ol.render.canvas.defaultLineJoin);void 0===(t=this.stroke_.getLineCap())&&(t=ol.render.canvas.defaultLineCap);void 0===(r=this.stroke_.getMiterLimit())&&(r=ol.render.canvas.defaultMiterLimit)}var l=2*(this.radius_+a)+1;t={strokeStyle:s,strokeWidth:a,size:l,lineCap:t,lineDash:n,lineDashOffset:i,lineJoin:o,miterLimit:r};if(void 0===e){var c=ol.dom.createCanvasContext2D(l,l);this.canvas_=c.canvas;e=l=this.canvas_.width;this.draw_(t,c,0,0);this.createHitDetectionCanvas_(t)}else l=Math.round(l),(o=!this.fill_)&&(c=this.drawHitDetectionCanvas_.bind(this,t)),r=this.getChecksum(),c=e.add(r,l,l,this.draw_.bind(this,t),c),this.canvas_=c.image,this.origin_=[c.offsetX,c.offsetY],e=c.image.width,o?(this.hitDetectionCanvas_=c.hitImage,this.hitDetectionImageSize_=[c.hitImage.width,c.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[e,e]);this.anchor_=[l/2,l/2];this.size_=[l,l];this.imageSize_=[e,e]};ol.style.RegularShape.prototype.draw_=function(e,t,o,r){t.setTransform(1,0,0,1,0,0);t.translate(o,r);t.beginPath();var n=this.points_;if(1/0===n)t.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{var i=void 0!==this.radius2_?this.radius2_:this.radius_;i!==this.radius_&&(n*=2);for(o=0;o<=n;o++){r=2*o*Math.PI/n-Math.PI/2+this.angle_;var a=0==o%2?this.radius_:i;t.lineTo(e.size/2+a*Math.cos(r),e.size/2+a*Math.sin(r))}}this.fill_&&(null===(o=this.fill_.getColor())&&(o=ol.render.canvas.defaultFillStyle),t.fillStyle=ol.colorlike.asColorLike(o),t.fill());this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke());t.closePath()};ol.style.RegularShape.prototype.createHitDetectionCanvas_=function(e){this.hitDetectionImageSize_=[e.size,e.size];if(this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var t=ol.dom.createCanvasContext2D(e.size,e.size);this.hitDetectionCanvas_=t.canvas;this.drawHitDetectionCanvas_(e,t,0,0)}};ol.style.RegularShape.prototype.drawHitDetectionCanvas_=function(e,t,o,r){t.setTransform(1,0,0,1,0,0);t.translate(o,r);t.beginPath();if(1/0===(o=this.points_))t.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{(r=void 0!==this.radius2_?this.radius2_:this.radius_)!==this.radius_&&(o*=2);var n;for(n=0;n<=o;n++){var i=2*n*Math.PI/o-Math.PI/2+this.angle_,a=0==n%2?this.radius_:r;t.lineTo(e.size/2+a*Math.cos(i),e.size/2+a*Math.sin(i))}}t.fillStyle=ol.render.canvas.defaultFillStyle;t.fill();this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.stroke());t.closePath()};ol.style.RegularShape.prototype.getChecksum=function(){var e=this.stroke_?this.stroke_.getChecksum():"-",t=this.fill_?this.fill_.getChecksum():"-";this.checksums_&&e==this.checksums_[1]&&t==this.checksums_[2]&&this.radius_==this.checksums_[3]&&this.radius2_==this.checksums_[4]&&this.angle_==this.checksums_[5]&&this.points_==this.checksums_[6]||(this.checksums_=["r"+e+t+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-"),e,t,this.radius_,this.radius2_,this.angle_,this.points_]);return this.checksums_[0]};ol.style.Circle=function(e){e=e||{};ol.style.RegularShape.call(this,{points:1/0,fill:e.fill,radius:e.radius,snapToPixel:e.snapToPixel,stroke:e.stroke,atlasManager:e.atlasManager})};ol.inherits(ol.style.Circle,ol.style.RegularShape);ol.style.Circle.prototype.clone=function(){var e=new ol.style.Circle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});e.setOpacity(this.getOpacity());e.setScale(this.getScale());return e};ol.style.Circle.prototype.setRadius=function(e){this.radius_=e;this.render_(this.atlasManager_)};ol.style.Fill=function(e){e=e||{};this.color_=void 0!==e.color?e.color:null;this.checksum_=void 0};ol.style.Fill.prototype.clone=function(){var e=this.getColor();return new ol.style.Fill({color:e&&e.slice?e.slice():e||void 0})};ol.style.Fill.prototype.getColor=function(){return this.color_};ol.style.Fill.prototype.setColor=function(e){this.color_=e;this.checksum_=void 0};ol.style.Fill.prototype.getChecksum=function(){void 0===this.checksum_&&(this.checksum_=this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?ol.getUid(this.color_).toString():"f"+(this.color_?ol.color.asString(this.color_):"-"));return this.checksum_};ol.style.Stroke=function(e){e=e||{};this.color_=void 0!==e.color?e.color:null;this.lineCap_=e.lineCap;this.lineDash_=void 0!==e.lineDash?e.lineDash:null;this.lineDashOffset_=e.lineDashOffset;this.lineJoin_=e.lineJoin;this.miterLimit_=e.miterLimit;this.width_=e.width;this.checksum_=void 0};ol.style.Stroke.prototype.clone=function(){var e=this.getColor();return new ol.style.Stroke({color:e&&e.slice?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})};ol.style.Stroke.prototype.getColor=function(){return this.color_};ol.style.Stroke.prototype.getLineCap=function(){return this.lineCap_};ol.style.Stroke.prototype.getLineDash=function(){return this.lineDash_};ol.style.Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_};ol.style.Stroke.prototype.getLineJoin=function(){return this.lineJoin_};ol.style.Stroke.prototype.getMiterLimit=function(){return this.miterLimit_};ol.style.Stroke.prototype.getWidth=function(){return this.width_};ol.style.Stroke.prototype.setColor=function(e){this.color_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineCap=function(e){this.lineCap_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineDash=function(e){this.lineDash_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineJoin=function(e){this.lineJoin_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setMiterLimit=function(e){this.miterLimit_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setWidth=function(e){this.width_=e;this.checksum_=void 0};ol.style.Stroke.prototype.getChecksum=function(){void 0===this.checksum_&&(this.checksum_="s",this.checksum_=this.color_?"string"==typeof this.color_?this.checksum_+this.color_:this.checksum_+ol.getUid(this.color_).toString():this.checksum_+"-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-"));return this.checksum_};ol.style.Style=function(e){e=e||{};this.geometry_=null;this.geometryFunction_=ol.style.Style.defaultGeometryFunction;void 0!==e.geometry&&this.setGeometry(e.geometry);this.fill_=void 0!==e.fill?e.fill:null;this.image_=void 0!==e.image?e.image:null;this.renderer_=void 0!==e.renderer?e.renderer:null;this.stroke_=void 0!==e.stroke?e.stroke:null;this.text_=void 0!==e.text?e.text:null;this.zIndex_=e.zIndex};ol.style.Style.prototype.clone=function(){var e=this.getGeometry();e&&e.clone&&(e=e.clone());return new ol.style.Style({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})};ol.style.Style.prototype.getRenderer=function(){return this.renderer_};ol.style.Style.prototype.setRenderer=function(e){this.renderer_=e};ol.style.Style.prototype.getGeometry=function(){return this.geometry_};ol.style.Style.prototype.getGeometryFunction=function(){return this.geometryFunction_};ol.style.Style.prototype.getFill=function(){return this.fill_};ol.style.Style.prototype.setFill=function(e){this.fill_=e};ol.style.Style.prototype.getImage=function(){return this.image_};ol.style.Style.prototype.setImage=function(e){this.image_=e};ol.style.Style.prototype.getStroke=function(){return this.stroke_};ol.style.Style.prototype.setStroke=function(e){this.stroke_=e};ol.style.Style.prototype.getText=function(){return this.text_};ol.style.Style.prototype.setText=function(e){this.text_=e};ol.style.Style.prototype.getZIndex=function(){return this.zIndex_};ol.style.Style.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=ol.style.Style.defaultGeometryFunction;this.geometry_=e};ol.style.Style.prototype.setZIndex=function(e){this.zIndex_=e};ol.style.Style.createFunction=function(e){if("function"!=typeof e){if(Array.isArray(e))var t=e;else ol.asserts.assert(e instanceof ol.style.Style,41),t=[e];e=function(){return t}}return e};ol.style.Style.default_=null;ol.style.Style.defaultFunction=function(e,t){ol.style.Style.default_||(e=new ol.style.Fill({color:"rgba(255,255,255,0.4)"}),t=new ol.style.Stroke({color:"#3399CC",width:1.25}),ol.style.Style.default_=[new ol.style.Style({image:new ol.style.Circle({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]);return ol.style.Style.default_};ol.style.Style.createDefaultEditing=function(){var e={},t=[255,255,255,1],o=[0,153,255,1];e[ol.geom.GeometryType.POLYGON]=[new ol.style.Style({fill:new ol.style.Fill({color:[255,255,255,.5]})})];e[ol.geom.GeometryType.MULTI_POLYGON]=e[ol.geom.GeometryType.POLYGON];e[ol.geom.GeometryType.LINE_STRING]=[new ol.style.Style({stroke:new ol.style.Stroke({color:t,width:5})}),new ol.style.Style({stroke:new ol.style.Stroke({color:o,width:3})})];e[ol.geom.GeometryType.MULTI_LINE_STRING]=e[ol.geom.GeometryType.LINE_STRING];e[ol.geom.GeometryType.CIRCLE]=e[ol.geom.GeometryType.POLYGON].concat(e[ol.geom.GeometryType.LINE_STRING]);e[ol.geom.GeometryType.POINT]=[new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:o}),stroke:new ol.style.Stroke({color:t,width:1.5})}),zIndex:1/0})];e[ol.geom.GeometryType.MULTI_POINT]=e[ol.geom.GeometryType.POINT];e[ol.geom.GeometryType.GEOMETRY_COLLECTION]=e[ol.geom.GeometryType.POLYGON].concat(e[ol.geom.GeometryType.LINE_STRING],e[ol.geom.GeometryType.POINT]);return e};ol.style.Style.defaultGeometryFunction=function(e){return e.getGeometry()};ol.Feature=function(e){ol.Object.call(this);this.id_=void 0;this.geometryName_="geometry";this.style_=null;this.styleFunction_=void 0;this.geometryChangeKey_=null;ol.events.listen(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);void 0!==e&&(e instanceof ol.geom.Geometry||!e?this.setGeometry(e):this.setProperties(e))};ol.inherits(ol.Feature,ol.Object);ol.Feature.prototype.clone=function(){var e=new ol.Feature(this.getProperties());e.setGeometryName(this.getGeometryName());var t=this.getGeometry();t&&e.setGeometry(t.clone());(t=this.getStyle())&&e.setStyle(t);return e};ol.Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)};ol.Feature.prototype.getId=function(){return this.id_};ol.Feature.prototype.getGeometryName=function(){return this.geometryName_};ol.Feature.prototype.getStyle=function(){return this.style_};ol.Feature.prototype.getStyleFunction=function(){return this.styleFunction_};ol.Feature.prototype.handleGeometryChange_=function(){this.changed()};ol.Feature.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(ol.events.unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleGeometryChange_,this));this.changed()};ol.Feature.prototype.setGeometry=function(e){this.set(this.geometryName_,e)};ol.Feature.prototype.setStyle=function(e){this.styleFunction_=(this.style_=e)?ol.Feature.createStyleFunction(e):void 0;this.changed()};ol.Feature.prototype.setId=function(e){this.id_=e;this.changed()};ol.Feature.prototype.setGeometryName=function(e){ol.events.unlisten(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);this.geometryName_=e;ol.events.listen(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);this.handleGeometryChanged_()};ol.Feature.createStyleFunction=function(e){if("function"==typeof e)var t=2==e.length?function(t){return e(this,t)}:e;else{if(Array.isArray(e))var o=e;else ol.asserts.assert(e instanceof ol.style.Style,41),o=[e];t=function(){return o}}return t};ol.GeolocationProperty={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"};ol.Geolocation=function(e){ol.Object.call(this);e=e||{};this.position_=null;this.transform_=ol.proj.identityTransform;this.sphere_=new ol.Sphere(ol.proj.EPSG4326.RADIUS);this.watchId_=void 0;ol.events.listen(this,ol.Object.getChangeEventType(ol.GeolocationProperty.PROJECTION),this.handleProjectionChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.GeolocationProperty.TRACKING),this.handleTrackingChanged_,this);void 0!==e.projection&&this.setProjection(e.projection);void 0!==e.trackingOptions&&this.setTrackingOptions(e.trackingOptions);this.setTracking(void 0!==e.tracking&&e.tracking)};ol.inherits(ol.Geolocation,ol.Object);ol.Geolocation.prototype.disposeInternal=function(){this.setTracking(!1);ol.Object.prototype.disposeInternal.call(this)};ol.Geolocation.prototype.handleProjectionChanged_=function(){var e=this.getProjection();e&&(this.transform_=ol.proj.getTransformFromProjections(ol.proj.get("EPSG:4326"),e),this.position_&&this.set(ol.GeolocationProperty.POSITION,this.transform_(this.position_)))};ol.Geolocation.prototype.handleTrackingChanged_=function(){if(ol.has.GEOLOCATION){var e=this.getTracking();e&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):e||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}};ol.Geolocation.prototype.positionChange_=function(e){e=e.coords;this.set(ol.GeolocationProperty.ACCURACY,e.accuracy);this.set(ol.GeolocationProperty.ALTITUDE,null===e.altitude?void 0:e.altitude);this.set(ol.GeolocationProperty.ALTITUDE_ACCURACY,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy);this.set(ol.GeolocationProperty.HEADING,null===e.heading?void 0:ol.math.toRadians(e.heading));this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];var t=this.transform_(this.position_);this.set(ol.GeolocationProperty.POSITION,t);this.set(ol.GeolocationProperty.SPEED,null===e.speed?void 0:e.speed);(e=ol.geom.Polygon.circular(this.sphere_,this.position_,e.accuracy)).applyTransform(this.transform_);this.set(ol.GeolocationProperty.ACCURACY_GEOMETRY,e);this.changed()};ol.Geolocation.prototype.positionError_=function(e){e.type=ol.events.EventType.ERROR;this.setTracking(!1);this.dispatchEvent(e)};ol.Geolocation.prototype.getAccuracy=function(){return this.get(ol.GeolocationProperty.ACCURACY)};ol.Geolocation.prototype.getAccuracyGeometry=function(){return this.get(ol.GeolocationProperty.ACCURACY_GEOMETRY)||null};ol.Geolocation.prototype.getAltitude=function(){return this.get(ol.GeolocationProperty.ALTITUDE)};ol.Geolocation.prototype.getAltitudeAccuracy=function(){return this.get(ol.GeolocationProperty.ALTITUDE_ACCURACY)};ol.Geolocation.prototype.getHeading=function(){return this.get(ol.GeolocationProperty.HEADING)};ol.Geolocation.prototype.getPosition=function(){return this.get(ol.GeolocationProperty.POSITION)};ol.Geolocation.prototype.getProjection=function(){return this.get(ol.GeolocationProperty.PROJECTION)};ol.Geolocation.prototype.getSpeed=function(){return this.get(ol.GeolocationProperty.SPEED)};ol.Geolocation.prototype.getTracking=function(){return this.get(ol.GeolocationProperty.TRACKING)};ol.Geolocation.prototype.getTrackingOptions=function(){return this.get(ol.GeolocationProperty.TRACKING_OPTIONS)};ol.Geolocation.prototype.setProjection=function(e){this.set(ol.GeolocationProperty.PROJECTION,ol.proj.get(e))};ol.Geolocation.prototype.setTracking=function(e){this.set(ol.GeolocationProperty.TRACKING,e)};ol.Geolocation.prototype.setTrackingOptions=function(e){this.set(ol.GeolocationProperty.TRACKING_OPTIONS,e)};ol.geom.flat.interpolate={};ol.geom.flat.interpolate.lineString=function(e,t,o,r,n,i){var a=NaN,s=NaN,l=(o-t)/r;if(1===l)a=e[t],s=e[t+1];else if(2==l)a=(1-n)*e[t]+n*e[t+r],s=(1-n)*e[t+1]+n*e[t+r+1];else if(0!==l){s=e[t];l=e[t+1];var c,u=0;a=[0];for(c=t+r;c<o;c+=r){var h=e[c],d=e[c+1];u+=Math.sqrt((h-s)*(h-s)+(d-l)*(d-l));a.push(u);s=h;l=d}n*=u;0>(o=ol.array.binarySearch(a,n))?(n=(n-a[-o-2])/(a[-o-1]-a[-o-2]),t+=(-o-2)*r,a=ol.math.lerp(e[t],e[t+r],n),s=ol.math.lerp(e[t+1],e[t+r+1],n)):(a=e[t+o*r],s=e[t+o*r+1])}return i?(i[0]=a,i[1]=s,i):[a,s]};ol.geom.flat.interpolate.lineStringCoordinateAtM=function(e,t,o,r,n,i){if(o==t)return null;if(n<e[t+r-1])return i?((o=e.slice(t,t+r))[r-1]=n,o):null;if(e[o-1]<n)return i?((o=e.slice(o-r,o))[r-1]=n,o):null;if(n==e[t+r-1])return e.slice(t,t+r);t/=r;for(o/=r;t<o;)n<e[((i=t+o>>1)+1)*r-1]?o=i:t=i+1;if(n==(o=e[t*r-1]))return e.slice((t-1)*r,(t-1)*r+r);i=(n-o)/(e[(t+1)*r-1]-o);o=[];var a;for(a=0;a<r-1;++a)o.push(ol.math.lerp(e[(t-1)*r+a],e[t*r+a],i));o.push(n);return o};ol.geom.flat.interpolate.lineStringsCoordinateAtM=function(e,t,o,r,n,i,a){if(a)return ol.geom.flat.interpolate.lineStringCoordinateAtM(e,t,o[o.length-1],r,n,i);if(n<e[r-1])return i?((e=e.slice(0,r))[r-1]=n,e):null;if(e[e.length-1]<n)return i?((e=e.slice(e.length-r))[r-1]=n,e):null;i=0;for(a=o.length;i<a;++i){var s=o[i];if(t!=s){if(n<e[t+r-1])break;if(n<=e[s-1])return ol.geom.flat.interpolate.lineStringCoordinateAtM(e,t,s,r,n,!1);t=s}}return null};ol.geom.LineString=function(e,t){ol.geom.SimpleGeometry.call(this);this.flatMidpoint_=null;this.maxDeltaRevision_=this.maxDelta_=this.flatMidpointRevision_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.LineString,ol.geom.SimpleGeometry);ol.geom.LineString.prototype.appendCoordinate=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e):this.flatCoordinates=e.slice();this.changed()};ol.geom.LineString.prototype.clone=function(){var e=new ol.geom.LineString(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.LineString.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision());return ol.geom.flat.closest.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,o,r)};ol.geom.LineString.prototype.forEachSegment=function(e,t){return ol.geom.flat.segments.forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)};ol.geom.LineString.prototype.getCoordinateAtM=function(e,t){return this.layout!=ol.geom.GeometryLayout.XYM&&this.layout!=ol.geom.GeometryLayout.XYZM?null:ol.geom.flat.interpolate.lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,void 0!==t&&t)};ol.geom.LineString.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LineString.prototype.getCoordinateAt=function(e,t){return ol.geom.flat.interpolate.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)};ol.geom.LineString.prototype.getLength=function(){return ol.geom.flat.length.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LineString.prototype.getFlatMidpoint=function(){this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision());return this.flatMidpoint_};ol.geom.LineString.prototype.getSimplifiedGeometryInternal=function(e){var t=[];t.length=ol.geom.flat.simplify.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);(e=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t);return e};ol.geom.LineString.prototype.getType=function(){return ol.geom.GeometryType.LINE_STRING};ol.geom.LineString.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)};ol.geom.LineString.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.LineString.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.flat.geodesic={};ol.geom.flat.geodesic.line_=function(e,t,o){for(var r,n,i,a,s,l=[],c=e(0),u=e(1),h=t(c),d=t(u),p=[u,c],f=[d,h],g=[1,0],m={},y=1e5;0<--y&&0<g.length;)i=g.pop(),c=p.pop(),h=f.pop(),(u=i.toString())in m||(l.push(h[0],h[1]),m[u]=!0),a=g.pop(),u=p.pop(),d=f.pop(),n=t(r=e(s=(i+a)/2)),ol.math.squaredSegmentDistance(n[0],n[1],h[0],h[1],d[0],d[1])<o?(l.push(d[0],d[1]),m[u=a.toString()]=!0):(g.push(a,s,s,i),f.push(d,n,n,h),p.push(u,r,r,c));return l};ol.geom.flat.geodesic.greatCircleArc=function(e,t,o,r,n,i){var a=ol.proj.get("EPSG:4326"),s=Math.cos(ol.math.toRadians(t)),l=Math.sin(ol.math.toRadians(t)),c=Math.cos(ol.math.toRadians(r)),u=Math.sin(ol.math.toRadians(r)),h=Math.cos(ol.math.toRadians(o-e)),d=Math.sin(ol.math.toRadians(o-e)),p=l*u+s*c*h;return ol.geom.flat.geodesic.line_(function(t){if(1<=p)return[o,r];var n=t*Math.acos(p);t=Math.cos(n);var i=Math.sin(n),a=Math.atan2(d*c,s*u-l*c*h);n=Math.asin(l*t+s*i*Math.cos(a));t=ol.math.toRadians(e)+Math.atan2(Math.sin(a)*i*s,t-l*Math.sin(n));return[ol.math.toDegrees(t),ol.math.toDegrees(n)]},ol.proj.getTransform(a,n),i)};ol.geom.flat.geodesic.meridian=function(e,t,o,r,n){var i=ol.proj.get("EPSG:4326");return ol.geom.flat.geodesic.line_(function(r){return[e,t+(o-t)*r]},ol.proj.getTransform(i,r),n)};ol.geom.flat.geodesic.parallel=function(e,t,o,r,n){var i=ol.proj.get("EPSG:4326");return ol.geom.flat.geodesic.line_(function(r){return[t+(o-t)*r,e]},ol.proj.getTransform(i,r),n)};ol.style.Text=function(e){e=e||{};this.font_=e.font;this.rotation_=e.rotation;this.rotateWithView_=e.rotateWithView;this.scale_=e.scale;this.text_=e.text;this.textAlign_=e.textAlign;this.textBaseline_=e.textBaseline;this.fill_=void 0!==e.fill?e.fill:new ol.style.Fill({color:ol.style.Text.DEFAULT_FILL_COLOR_});this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4;this.placement_=void 0!==e.placement?e.placement:ol.style.TextPlacement.POINT;var t=void 0===e.overflow?e.exceedLength:e.overflow;this.overflow_=void 0!==t&&t;this.stroke_=void 0!==e.stroke?e.stroke:null;this.offsetX_=void 0!==e.offsetX?e.offsetX:0;this.offsetY_=void 0!==e.offsetY?e.offsetY:0;this.backgroundFill_=e.backgroundFill?e.backgroundFill:null;this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null;this.padding_=void 0===e.padding?null:e.padding};ol.style.Text.DEFAULT_FILL_COLOR_="#333";ol.style.Text.prototype.clone=function(){return new ol.style.Text({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY()})};ol.style.Text.prototype.getOverflow=function(){return this.overflow_};ol.style.Text.prototype.getFont=function(){return this.font_};ol.style.Text.prototype.getMaxAngle=function(){return this.maxAngle_};ol.style.Text.prototype.getPlacement=function(){return this.placement_};ol.style.Text.prototype.getOffsetX=function(){return this.offsetX_};ol.style.Text.prototype.getOffsetY=function(){return this.offsetY_};ol.style.Text.prototype.getFill=function(){return this.fill_};ol.style.Text.prototype.getRotateWithView=function(){return this.rotateWithView_};ol.style.Text.prototype.getRotation=function(){return this.rotation_};ol.style.Text.prototype.getScale=function(){return this.scale_};ol.style.Text.prototype.getStroke=function(){return this.stroke_};ol.style.Text.prototype.getText=function(){return this.text_};ol.style.Text.prototype.getTextAlign=function(){return this.textAlign_};ol.style.Text.prototype.getTextBaseline=function(){return this.textBaseline_};ol.style.Text.prototype.getBackgroundFill=function(){return this.backgroundFill_};ol.style.Text.prototype.getBackgroundStroke=function(){return this.backgroundStroke_};ol.style.Text.prototype.getPadding=function(){return this.padding_};ol.style.Text.prototype.setOverflow=function(e){this.overflow_=e};ol.style.Text.prototype.setFont=function(e){this.font_=e};ol.style.Text.prototype.setMaxAngle=function(e){this.maxAngle_=e};ol.style.Text.prototype.setOffsetX=function(e){this.offsetX_=e};ol.style.Text.prototype.setOffsetY=function(e){this.offsetY_=e};ol.style.Text.prototype.setPlacement=function(e){this.placement_=e};ol.style.Text.prototype.setFill=function(e){this.fill_=e};ol.style.Text.prototype.setRotation=function(e){this.rotation_=e};ol.style.Text.prototype.setScale=function(e){this.scale_=e};ol.style.Text.prototype.setStroke=function(e){this.stroke_=e};ol.style.Text.prototype.setText=function(e){this.text_=e};ol.style.Text.prototype.setTextAlign=function(e){this.textAlign_=e};ol.style.Text.prototype.setTextBaseline=function(e){this.textBaseline_=e};ol.style.Text.prototype.setBackgroundFill=function(e){this.backgroundFill_=e};ol.style.Text.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e};ol.style.Text.prototype.setPadding=function(e){this.padding_=e};ol.Graticule=function(e){e=e||{};this.projection_=this.map_=null;this.maxLon_=this.maxLat_=1/0;this.minLon_=this.minLat_=-1/0;this.maxLonP_=this.maxLatP_=1/0;this.minLonP_=this.minLatP_=-1/0;this.targetSize_=void 0!==e.targetSize?e.targetSize:100;this.maxLines_=void 0!==e.maxLines?e.maxLines:100;this.meridians_=[];this.parallels_=[];this.strokeStyle_=void 0!==e.strokeStyle?e.strokeStyle:ol.Graticule.DEFAULT_STROKE_STYLE_;this.toLonLatTransform_=this.fromLonLatTransform_=void 0;this.parallelsLabels_=this.meridiansLabels_=this.projectionCenterLonLat_=null;if(1==e.showLabels){var t=ol.coordinate.degreesToStringHDMS;this.lonLabelFormatter_=void 0==e.lonLabelFormatter?t.bind(this,"EW"):e.lonLabelFormatter;this.latLabelFormatter_=void 0==e.latLabelFormatter?t.bind(this,"NS"):e.latLabelFormatter;this.lonLabelPosition_=void 0==e.lonLabelPosition?0:e.lonLabelPosition;this.latLabelPosition_=void 0==e.latLabelPosition?1:e.latLabelPosition;this.lonLabelStyle_=void 0!==e.lonLabelStyle?e.lonLabelStyle:new ol.style.Text({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new ol.style.Fill({color:"rgba(0,0,0,1)"}),stroke:new ol.style.Stroke({color:"rgba(255,255,255,1)",width:3})});this.latLabelStyle_=void 0!==e.latLabelStyle?e.latLabelStyle:new ol.style.Text({font:"12px Calibri,sans-serif",textAlign:"end",fill:new ol.style.Fill({color:"rgba(0,0,0,1)"}),stroke:new ol.style.Stroke({color:"rgba(255,255,255,1)",width:3})});this.meridiansLabels_=[];this.parallelsLabels_=[]}this.setMap(void 0!==e.map?e.map:null)};ol.Graticule.DEFAULT_STROKE_STYLE_=new ol.style.Stroke({color:"rgba(0,0,0,0.2)"});ol.Graticule.intervals_=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001];ol.Graticule.prototype.addMeridian_=function(e,t,o,r,n,i){t=this.getMeridian_(e,t,o,r,i);ol.extent.intersects(t.getExtent(),n)&&(this.meridiansLabels_&&(n=this.getMeridianPoint_(t,n,i),this.meridiansLabels_[i]={geom:n,text:this.lonLabelFormatter_(e)}),this.meridians_[i++]=t);return i};ol.Graticule.prototype.getMeridianPoint_=function(e,t,o){e=e.getFlatCoordinates();t=ol.math.clamp(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,Math.max(t[1],e[1]),Math.min(t[3],e[e.length-1]));t=[e[0],t];(o=void 0!==this.meridiansLabels_[o]?this.meridiansLabels_[o].geom:new ol.geom.Point(null)).setCoordinates(t);return o};ol.Graticule.prototype.addParallel_=function(e,t,o,r,n,i){t=this.getParallel_(e,t,o,r,i);ol.extent.intersects(t.getExtent(),n)&&(this.parallelsLabels_&&(n=this.getParallelPoint_(t,n,i),this.parallelsLabels_[i]={geom:n,text:this.latLabelFormatter_(e)}),this.parallels_[i++]=t);return i};ol.Graticule.prototype.getParallelPoint_=function(e,t,o){e=e.getFlatCoordinates();t=[ol.math.clamp(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,Math.max(t[0],e[0]),Math.min(t[2],e[e.length-2])),e[1]];(o=void 0!==this.parallelsLabels_[o]?this.parallelsLabels_[o].geom:new ol.geom.Point(null)).setCoordinates(t);return o};ol.Graticule.prototype.createGraticule_=function(e,t,o,r){if(-1==(o=this.getInterval_(o)))this.meridians_.length=this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);else{var n=this.toLonLatTransform_(t);t=n[0];n=n[1];var i=this.maxLines_,a=[Math.max(e[0],this.minLonP_),Math.max(e[1],this.minLatP_),Math.min(e[2],this.maxLonP_),Math.min(e[3],this.maxLatP_)],s=(a=ol.proj.transformExtent(a,this.projection_,"EPSG:4326"))[3],l=a[2],c=a[1],u=a[0];t=Math.floor(t/o)*o;var h=ol.math.clamp(t,this.minLon_,this.maxLon_),d=this.addMeridian_(h,c,s,r,e,0);for(a=0;h!=this.minLon_&&a++<i;)h=Math.max(h-o,this.minLon_),d=this.addMeridian_(h,c,s,r,e,d);h=ol.math.clamp(t,this.minLon_,this.maxLon_);for(a=0;h!=this.maxLon_&&a++<i;)h=Math.min(h+o,this.maxLon_),d=this.addMeridian_(h,c,s,r,e,d);this.meridians_.length=d;this.meridiansLabels_&&(this.meridiansLabels_.length=d);n=Math.floor(n/o)*o;t=ol.math.clamp(n,this.minLat_,this.maxLat_);d=this.addParallel_(t,u,l,r,e,0);for(a=0;t!=this.minLat_&&a++<i;)t=Math.max(t-o,this.minLat_),d=this.addParallel_(t,u,l,r,e,d);t=ol.math.clamp(n,this.minLat_,this.maxLat_);for(a=0;t!=this.maxLat_&&a++<i;)t=Math.min(t+o,this.maxLat_),d=this.addParallel_(t,u,l,r,e,d);this.parallels_.length=d;this.parallelsLabels_&&(this.parallelsLabels_.length=d)}};ol.Graticule.prototype.getInterval_=function(e){var t,o=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1],n=-1,i=Math.pow(this.targetSize_*e,2),a=[],s=[];e=0;for(t=ol.Graticule.intervals_.length;e<t;++e){var l=ol.Graticule.intervals_[e]/2;a[0]=o-l;a[1]=r-l;s[0]=o+l;s[1]=r+l;this.fromLonLatTransform_(a,a);this.fromLonLatTransform_(s,s);if((l=Math.pow(s[0]-a[0],2)+Math.pow(s[1]-a[1],2))<=i)break;n=ol.Graticule.intervals_[e]}return n};ol.Graticule.prototype.getMap=function(){return this.map_};ol.Graticule.prototype.getMeridian_=function(e,t,o,r,n){e=ol.geom.flat.geodesic.meridian(e,t,o,this.projection_,r);(n=void 0!==this.meridians_[n]?this.meridians_[n]:new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,e);return n};ol.Graticule.prototype.getMeridians=function(){return this.meridians_};ol.Graticule.prototype.getParallel_=function(e,t,o,r,n){e=ol.geom.flat.geodesic.parallel(e,t,o,this.projection_,r);(n=void 0!==this.parallels_[n]?this.parallels_[n]:new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,e);return n};ol.Graticule.prototype.getParallels=function(){return this.parallels_};ol.Graticule.prototype.handlePostCompose_=function(e){var t=e.vectorContext,o=e.frameState;e=o.extent;var r=o.viewState,n=r.center,i=r.projection;o=(r=r.resolution)*r/(4*(o=o.pixelRatio)*o);this.projection_&&ol.proj.equivalent(this.projection_,i)||this.updateProjectionInfo_(i);this.createGraticule_(e,n,r,o);t.setFillStrokeStyle(null,this.strokeStyle_);e=0;for(n=this.meridians_.length;e<n;++e)i=this.meridians_[e],t.drawGeometry(i);e=0;for(n=this.parallels_.length;e<n;++e)i=this.parallels_[e],t.drawGeometry(i);if(this.meridiansLabels_)for(e=0,n=this.meridiansLabels_.length;e<n;++e)i=this.meridiansLabels_[e],this.lonLabelStyle_.setText(i.text),t.setTextStyle(this.lonLabelStyle_),t.drawGeometry(i.geom);if(this.parallelsLabels_)for(e=0,n=this.parallelsLabels_.length;e<n;++e)i=this.parallelsLabels_[e],this.latLabelStyle_.setText(i.text),t.setTextStyle(this.latLabelStyle_),t.drawGeometry(i.geom)};ol.Graticule.prototype.updateProjectionInfo_=function(e){var t=ol.proj.get("EPSG:4326"),o=e.getExtent(),r=e.getWorldExtent(),n=ol.proj.transformExtent(r,t,e),i=r[2],a=r[1],s=r[0],l=n[3],c=n[2],u=n[1];n=n[0];this.maxLat_=r[3];this.maxLon_=i;this.minLat_=a;this.minLon_=s;this.maxLatP_=l;this.maxLonP_=c;this.minLatP_=u;this.minLonP_=n;this.fromLonLatTransform_=ol.proj.getTransform(t,e);this.toLonLatTransform_=ol.proj.getTransform(e,t);this.projectionCenterLonLat_=this.toLonLatTransform_(ol.extent.getCenter(o));this.projection_=e};ol.Graticule.prototype.setMap=function(e){this.map_&&(this.map_.un(ol.render.EventType.POSTCOMPOSE,this.handlePostCompose_,this),this.map_.render());e&&(e.on(ol.render.EventType.POSTCOMPOSE,this.handlePostCompose_,this),e.render());this.map_=e};ol.Image=function(e,t,o,r,n,i){ol.ImageBase.call(this,e,t,o,ol.ImageState.IDLE);this.src_=r;this.image_=new Image;null!==n&&(this.image_.crossOrigin=n);this.imageListenerKeys_=null;this.state=ol.ImageState.IDLE;this.imageLoadFunction_=i};ol.inherits(ol.Image,ol.ImageBase);ol.Image.prototype.getImage=function(){return this.image_};ol.Image.prototype.handleImageError_=function(){this.state=ol.ImageState.ERROR;this.unlistenImage_();this.changed()};ol.Image.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=ol.extent.getHeight(this.extent)/this.image_.height);this.state=ol.ImageState.LOADED;this.unlistenImage_();this.changed()};ol.Image.prototype.load=function(){this.state!=ol.ImageState.IDLE&&this.state!=ol.ImageState.ERROR||(this.state=ol.ImageState.LOADING,this.changed(),this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))};ol.Image.prototype.setImage=function(e){this.image_=e};ol.Image.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};ol.Tile=function(e,t,o){ol.events.EventTarget.call(this);o=o||{};this.tileCoord=e;this.state=t;this.interimTile=null;this.key="";this.transition_=void 0===o.transition?250:o.transition;this.transitionStarts_={}};ol.inherits(ol.Tile,ol.events.EventTarget);ol.Tile.prototype.changed=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.Tile.prototype.getKey=function(){return this.key+"/"+this.tileCoord};ol.Tile.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(e.getState()==ol.TileState.LOADED)return e;e=e.interimTile}while(e);return this};ol.Tile.prototype.refreshInterimChain=function(){if(this.interimTile){var e=this.interimTile,t=this;do{if(e.getState()==ol.TileState.LOADED){e.interimTile=null;break}e.getState()==ol.TileState.LOADING?t=e:e.getState()==ol.TileState.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}};ol.Tile.prototype.getTileCoord=function(){return this.tileCoord};ol.Tile.prototype.getState=function(){return this.state};ol.Tile.prototype.setState=function(e){this.state=e;this.changed()};ol.Tile.prototype.load=function(){};ol.Tile.prototype.getAlpha=function(e,t){if(!this.transition_)return 1;var o=this.transitionStarts_[e];if(o){if(-1===o)return 1}else o=t,this.transitionStarts_[e]=o;return(e=t-o+1e3/60)>=this.transition_?1:ol.easing.easeIn(e/this.transition_)};ol.Tile.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]};ol.Tile.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)};ol.ImageTile=function(e,t,o,r,n,i){ol.Tile.call(this,e,t,i);this.crossOrigin_=r;this.src_=o;this.image_=new Image;null!==r&&(this.image_.crossOrigin=r);this.imageListenerKeys_=null;this.tileLoadFunction_=n};ol.inherits(ol.ImageTile,ol.Tile);ol.ImageTile.prototype.disposeInternal=function(){this.state==ol.TileState.LOADING&&(this.unlistenImage_(),this.image_=ol.ImageTile.getBlankImage());this.interimTile&&this.interimTile.dispose();this.state=ol.TileState.ABORT;this.changed();ol.Tile.prototype.disposeInternal.call(this)};ol.ImageTile.prototype.getImage=function(){return this.image_};ol.ImageTile.prototype.getKey=function(){return this.src_};ol.ImageTile.prototype.handleImageError_=function(){this.state=ol.TileState.ERROR;this.unlistenImage_();this.image_=ol.ImageTile.getBlankImage();this.changed()};ol.ImageTile.prototype.handleImageLoad_=function(){this.state=this.image_.naturalWidth&&this.image_.naturalHeight?ol.TileState.LOADED:ol.TileState.EMPTY;this.unlistenImage_();this.changed()};ol.ImageTile.prototype.load=function(){this.state==ol.TileState.ERROR&&(this.state=ol.TileState.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_));this.state==ol.TileState.IDLE&&(this.state=ol.TileState.LOADING,this.changed(),this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))};ol.ImageTile.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};ol.ImageTile.getBlankImage=function(){var e=ol.dom.createCanvasContext2D(1,1);e.fillStyle="rgba(0,0,0,0)";e.fillRect(0,0,1,1);return e.canvas};ol.webgl.Shader=function(e){this.source_=e};ol.webgl.Shader.prototype.getType=function(){};ol.webgl.Shader.prototype.getSource=function(){return this.source_};ol.webgl.Shader.prototype.isAnimated=ol.functions.FALSE;ol.webgl.Fragment=function(e){ol.webgl.Shader.call(this,e)};ol.inherits(ol.webgl.Fragment,ol.webgl.Shader);ol.webgl.Fragment.prototype.getType=function(){return ol.webgl.FRAGMENT_SHADER};ol.webgl.Vertex=function(e){ol.webgl.Shader.call(this,e)};ol.inherits(ol.webgl.Vertex,ol.webgl.Shader);ol.webgl.Vertex.prototype.getType=function(){return ol.webgl.VERTEX_SHADER};ol.render.webgl={};ol.render.webgl.circlereplay={};ol.render.webgl.circlereplay.defaultshader={};ol.render.webgl.circlereplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n":"precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}");ol.render.webgl.circlereplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n":"varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;//Until we get gl_VertexID in WebGL,we store an instruction.if(f==0.0){//Offsetting the edges of the triangle by lineWidth/2 is necessary,however//we should also leave some space for the antialiasing,thus we offset by lineWidth.offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}");ol.render.webgl.circlereplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_lineWidth=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_lineWidth":"k");this.u_pixelRatio=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_pixelRatio":"l");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"m");this.u_fillColor=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_fillColor":"n");this.u_strokeColor=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_strokeColor":"o");this.u_size=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_size":"p");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"e");this.a_instruction=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_instruction":"f");this.a_radius=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_radius":"g")};ol.vec={};ol.vec.Mat4={};ol.vec.Mat4.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};ol.vec.Mat4.fromTransform=function(e,t){e[0]=t[0];e[1]=t[1];e[4]=t[2];e[5]=t[3];e[12]=t[4];e[13]=t[5];return e};ol.render.webgl.Replay=function(e,t){ol.render.VectorContext.call(this);this.tolerance=e;this.maxExtent=t;this.origin=ol.extent.getCenter(t);this.projectionMatrix_=ol.transform.create();this.offsetRotateMatrix_=ol.transform.create();this.offsetScaleMatrix_=ol.transform.create();this.tmpMat4_=ol.vec.Mat4.create();this.indices=[];this.indicesBuffer=null;this.startIndices=[];this.startIndicesFeature=[];this.vertices=[];this.verticesBuffer=null;this.lineStringReplay=void 0};ol.inherits(ol.render.webgl.Replay,ol.render.VectorContext);ol.render.webgl.Replay.prototype.getDeleteResourcesFunction=function(e){};ol.render.webgl.Replay.prototype.finish=function(e){};ol.render.webgl.Replay.prototype.setUpProgram=function(e,t,o,r){};ol.render.webgl.Replay.prototype.shutDownProgram=function(e,t){};ol.render.webgl.Replay.prototype.drawReplay=function(e,t,o,r){};ol.render.webgl.Replay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,n){};ol.render.webgl.Replay.prototype.drawHitDetectionReplay=function(e,t,o,r,n,i){return n?this.drawHitDetectionReplayOneByOne(e,t,o,r,i):this.drawHitDetectionReplayAll(e,t,o,r)};ol.render.webgl.Replay.prototype.drawHitDetectionReplayAll=function(e,t,o,r){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawReplay(e,t,o,!0);if(e=r(null))return e};ol.render.webgl.Replay.prototype.replay=function(e,t,o,r,n,i,a,s,l,c,u){var h=e.getGL();if(this.lineStringReplay){var d=h.isEnabled(h.STENCIL_TEST),p=h.getParameter(h.STENCIL_FUNC),f=h.getParameter(h.STENCIL_VALUE_MASK),g=h.getParameter(h.STENCIL_REF),m=h.getParameter(h.STENCIL_WRITEMASK),y=h.getParameter(h.STENCIL_FAIL),C=h.getParameter(h.STENCIL_PASS_DEPTH_PASS),v=h.getParameter(h.STENCIL_PASS_DEPTH_FAIL);h.enable(h.STENCIL_TEST);h.clear(h.STENCIL_BUFFER_BIT);h.stencilMask(255);h.stencilFunc(h.ALWAYS,1,255);h.stencilOp(h.KEEP,h.KEEP,h.REPLACE);this.lineStringReplay.replay(e,t,o,r,n,i,a,s,l,c,u);h.stencilMask(0);h.stencilFunc(h.NOTEQUAL,1,255)}e.bindBuffer(ol.webgl.ARRAY_BUFFER,this.verticesBuffer);e.bindBuffer(ol.webgl.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);i=this.setUpProgram(h,e,n,i);var T,_=ol.transform.reset(this.projectionMatrix_);ol.transform.scale(_,2/(o*n[0]),2/(o*n[1]));ol.transform.rotate(_,-r);ol.transform.translate(_,-(t[0]-this.origin[0]),-(t[1]-this.origin[1]));t=ol.transform.reset(this.offsetScaleMatrix_);ol.transform.scale(t,2/n[0],2/n[1]);n=ol.transform.reset(this.offsetRotateMatrix_);0!==r&&ol.transform.rotate(n,-r);h.uniformMatrix4fv(i.u_projectionMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,_));h.uniformMatrix4fv(i.u_offsetScaleMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,t));h.uniformMatrix4fv(i.u_offsetRotateMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,n));h.uniform1f(i.u_opacity,a);void 0===l?this.drawReplay(h,e,s,!1):T=this.drawHitDetectionReplay(h,e,s,l,c,u);this.shutDownProgram(h,i);this.lineStringReplay&&(d||h.disable(h.STENCIL_TEST),h.clear(h.STENCIL_BUFFER_BIT),h.stencilFunc(p,g,f),h.stencilMask(m),h.stencilOp(y,v,C));return T};ol.render.webgl.Replay.prototype.drawElements=function(e,t,o,r){e.drawElements(ol.webgl.TRIANGLES,r-o,t.hasOESElementIndexUint?ol.webgl.UNSIGNED_INT:ol.webgl.UNSIGNED_SHORT,o*(t.hasOESElementIndexUint?4:2))};ol.render.webgl.defaultFont="10px sans-serif";ol.render.webgl.defaultFillStyle=[0,0,0,1];ol.render.webgl.defaultLineCap="round";ol.render.webgl.defaultLineDash=[];ol.render.webgl.defaultLineDashOffset=0;ol.render.webgl.defaultLineJoin="round";ol.render.webgl.defaultMiterLimit=10;ol.render.webgl.defaultStrokeStyle=[0,0,0,1];ol.render.webgl.defaultTextAlign=.5;ol.render.webgl.defaultTextBaseline=.5;ol.render.webgl.defaultLineWidth=1;ol.render.webgl.triangleIsCounterClockwise=function(e,t,o,r,n,i){return(e=(o-e)*(i-t)-(n-e)*(r-t))<=ol.render.webgl.EPSILON&&e>=-ol.render.webgl.EPSILON?void 0:0<e};ol.render.webgl.EPSILON=Number.EPSILON||2.220446049250313e-16;ol.webgl.Buffer=function(e,t){this.arr_=void 0!==e?e:[];this.usage_=void 0!==t?t:ol.webgl.Buffer.Usage_.STATIC_DRAW};ol.webgl.Buffer.prototype.getArray=function(){return this.arr_};ol.webgl.Buffer.prototype.getUsage=function(){return this.usage_};ol.webgl.Buffer.Usage_={STATIC_DRAW:ol.webgl.STATIC_DRAW,STREAM_DRAW:ol.webgl.STREAM_DRAW,DYNAMIC_DRAW:ol.webgl.DYNAMIC_DRAW};ol.render.webgl.CircleReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.radius_=0;this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};ol.inherits(ol.render.webgl.CircleReplay,ol.render.webgl.Replay);ol.render.webgl.CircleReplay.prototype.drawCoordinates_=function(e,t,o,r){for(var n=this.vertices.length,i=this.indices.length,a=n/4;t<o;t+=r)this.vertices[n++]=e[t],this.vertices[n++]=e[t+1],this.vertices[n++]=0,this.vertices[n++]=this.radius_,this.vertices[n++]=e[t],this.vertices[n++]=e[t+1],this.vertices[n++]=1,this.vertices[n++]=this.radius_,this.vertices[n++]=e[t],this.vertices[n++]=e[t+1],this.vertices[n++]=2,this.vertices[n++]=this.radius_,this.vertices[n++]=e[t],this.vertices[n++]=e[t+1],this.vertices[n++]=3,this.vertices[n++]=this.radius_,this.indices[i++]=a,this.indices[i++]=a+1,this.indices[i++]=a+2,this.indices[i++]=a+2,this.indices[i++]=a+3,this.indices[i++]=a,a+=4};ol.render.webgl.CircleReplay.prototype.drawCircle=function(e,t){var o=e.getRadius(),r=e.getStride();o?(this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.radius_=o,e=e.getFlatCoordinates(),e=ol.geom.flat.transform.translate(e,0,2,r,-this.origin[0],-this.origin[1]),this.drawCoordinates_(e,0,2,r)):this.state_.changed&&(this.styles_.pop(),this.styles_.length&&(r=this.styles_[this.styles_.length-1],this.state_.fillColor=r[0],this.state_.strokeColor=r[1],this.state_.lineWidth=r[2],this.state_.changed=!1))};ol.render.webgl.CircleReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.indices=this.vertices=null};ol.render.webgl.CircleReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.CircleReplay.prototype.setUpProgram=function(e,t,o,r){var n=t.getProgram(ol.render.webgl.circlereplay.defaultshader.fragment,ol.render.webgl.circlereplay.defaultshader.vertex);if(this.defaultLocations_)var i=this.defaultLocations_;else this.defaultLocations_=i=new ol.render.webgl.circlereplay.defaultshader.Locations(e,n);t.useProgram(n);e.enableVertexAttribArray(i.a_position);e.vertexAttribPointer(i.a_position,2,ol.webgl.FLOAT,!1,16,0);e.enableVertexAttribArray(i.a_instruction);e.vertexAttribPointer(i.a_instruction,1,ol.webgl.FLOAT,!1,16,8);e.enableVertexAttribArray(i.a_radius);e.vertexAttribPointer(i.a_radius,1,ol.webgl.FLOAT,!1,16,12);e.uniform2fv(i.u_size,o);e.uniform1f(i.u_pixelRatio,r);return i};ol.render.webgl.CircleReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_instruction);e.disableVertexAttribArray(t.a_radius)};ol.render.webgl.CircleReplay.prototype.drawReplay=function(e,t,o,r){if(ol.obj.isEmpty(o)){var n=this.startIndices[this.startIndices.length-1];for(o=this.styleIndices_.length-1;0<=o;--o){r=this.styleIndices_[o];var i=this.styles_[o];this.setFillStyle_(e,i[0]);this.setStrokeStyle_(e,i[1],i[2]);this.drawElements(e,t,r,n);n=r}}else this.drawReplaySkipping_(e,t,o)};ol.render.webgl.CircleReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,n){var i,a,s=this.startIndices.length-2,l=this.startIndices[s+1];for(i=this.styleIndices_.length-1;0<=i;--i){var c=this.styles_[i];this.setFillStyle_(e,c[0]);this.setStrokeStyle_(e,c[1],c[2]);for(a=this.styleIndices_[i];0<=s&&this.startIndices[s]>=a;){c=this.startIndices[s];var u=this.startIndicesFeature[s];if(void 0===o[ol.getUid(u).toString()]&&u.getGeometry()&&(void 0===n||ol.extent.intersects(n,u.getGeometry().getExtent()))&&(e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,c,l),l=r(u)))return l;s--;l=c}}};ol.render.webgl.CircleReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,n,i=this.startIndices.length-2,a=n=this.startIndices[i+1];for(r=this.styleIndices_.length-1;0<=r;--r){var s=this.styles_[r];this.setFillStyle_(e,s[0]);this.setStrokeStyle_(e,s[1],s[2]);for(s=this.styleIndices_[r];0<=i&&this.startIndices[i]>=s;){var l=this.startIndices[i],c=this.startIndicesFeature[i];o[c=ol.getUid(c).toString()]&&(n!==a&&this.drawElements(e,t,n,a),a=l);i--;n=l}n!==a&&this.drawElements(e,t,n,a);n=a=s}};ol.render.webgl.CircleReplay.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_fillColor,t)};ol.render.webgl.CircleReplay.prototype.setStrokeStyle_=function(e,t,o){e.uniform4fv(this.defaultLocations_.u_strokeColor,t);e.uniform1f(this.defaultLocations_.u_lineWidth,o)};ol.render.webgl.CircleReplay.prototype.setFillStrokeStyle=function(e,t){if(t){var o=t.getLineDash();this.state_.lineDash=o||ol.render.webgl.defaultLineDash;o=t.getLineDashOffset();this.state_.lineDashOffset=o||ol.render.webgl.defaultLineDashOffset;o=(o=t.getColor())instanceof CanvasGradient||o instanceof CanvasPattern?ol.render.webgl.defaultStrokeStyle:ol.color.asArray(o).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultStrokeStyle;t=void 0!==(t=t.getWidth())?t:ol.render.webgl.defaultLineWidth}else o=[0,0,0,0],t=0;e=(e=e?e.getColor():[0,0,0,0])instanceof CanvasGradient||e instanceof CanvasPattern?ol.render.webgl.defaultFillStyle:ol.color.asArray(e).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultFillStyle;this.state_.strokeColor&&ol.array.equals(this.state_.strokeColor,o)&&this.state_.fillColor&&ol.array.equals(this.state_.fillColor,e)&&this.state_.lineWidth===t||(this.state_.changed=!0,this.state_.fillColor=e,this.state_.strokeColor=o,this.state_.lineWidth=t,this.styles_.push([e,o,t]))};ol.render.webgl.texturereplay={};ol.render.webgl.texturereplay.defaultshader={};ol.render.webgl.texturereplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.texturereplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n":"varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}");ol.render.webgl.texturereplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"k");this.u_image=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_image":"l");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"c");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"d");this.a_offsets=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_offsets":"e");this.a_opacity=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_opacity":"f");this.a_rotateWithView=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_rotateWithView":"g")};ol.webgl.ContextEventType={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};ol.webgl.Context=function(e,t){this.canvas_=e;this.gl_=t;this.bufferCache_={};this.shaderCache_={};this.programCache_={};this.hitDetectionRenderbuffer_=this.hitDetectionTexture_=this.hitDetectionFramebuffer_=this.currentProgram_=null;(this.hasOESElementIndexUint=ol.array.includes(ol.WEBGL_EXTENSIONS,"OES_element_index_uint"))&&t.getExtension("OES_element_index_uint");ol.events.listen(this.canvas_,ol.webgl.ContextEventType.LOST,this.handleWebGLContextLost,this);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.RESTORED,this.handleWebGLContextRestored,this)};ol.inherits(ol.webgl.Context,ol.Disposable);ol.webgl.Context.prototype.bindBuffer=function(e,t){var o=this.getGL(),r=t.getArray(),n=String(ol.getUid(t));if(n in this.bufferCache_)o.bindBuffer(e,this.bufferCache_[n].buffer);else{var i,a=o.createBuffer();o.bindBuffer(e,a);e==ol.webgl.ARRAY_BUFFER?i=new Float32Array(r):e==ol.webgl.ELEMENT_ARRAY_BUFFER&&(i=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r));o.bufferData(e,i,t.getUsage());this.bufferCache_[n]={buf:t,buffer:a}}};ol.webgl.Context.prototype.deleteBuffer=function(e){var t=this.getGL();e=String(ol.getUid(e));var o=this.bufferCache_[e];t.isContextLost()||t.deleteBuffer(o.buffer);delete this.bufferCache_[e]};ol.webgl.Context.prototype.disposeInternal=function(){ol.events.unlistenAll(this.canvas_);var e=this.getGL();if(!e.isContextLost()){for(var t in this.bufferCache_)e.deleteBuffer(this.bufferCache_[t].buffer);for(t in this.programCache_)e.deleteProgram(this.programCache_[t]);for(t in this.shaderCache_)e.deleteShader(this.shaderCache_[t]);e.deleteFramebuffer(this.hitDetectionFramebuffer_);e.deleteRenderbuffer(this.hitDetectionRenderbuffer_);e.deleteTexture(this.hitDetectionTexture_)}};ol.webgl.Context.prototype.getCanvas=function(){return this.canvas_};ol.webgl.Context.prototype.getGL=function(){return this.gl_};ol.webgl.Context.prototype.getHitDetectionFramebuffer=function(){this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_();return this.hitDetectionFramebuffer_};ol.webgl.Context.prototype.getShader=function(e){var t=String(ol.getUid(e));if(t in this.shaderCache_)return this.shaderCache_[t];var o=this.getGL(),r=o.createShader(e.getType());o.shaderSource(r,e.getSource());o.compileShader(r);return this.shaderCache_[t]=r};ol.webgl.Context.prototype.getProgram=function(e,t){var o=ol.getUid(e)+"/"+ol.getUid(t);if(o in this.programCache_)return this.programCache_[o];var r=this.getGL(),n=r.createProgram();r.attachShader(n,this.getShader(e));r.attachShader(n,this.getShader(t));r.linkProgram(n);return this.programCache_[o]=n};ol.webgl.Context.prototype.handleWebGLContextLost=function(){ol.obj.clear(this.bufferCache_);ol.obj.clear(this.shaderCache_);ol.obj.clear(this.programCache_);this.hitDetectionRenderbuffer_=this.hitDetectionTexture_=this.hitDetectionFramebuffer_=this.currentProgram_=null};ol.webgl.Context.prototype.handleWebGLContextRestored=function(){};ol.webgl.Context.prototype.initHitDetectionFramebuffer_=function(){var e=this.gl_,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);var o=ol.webgl.Context.createEmptyTexture(e,1,1),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null);this.hitDetectionFramebuffer_=t;this.hitDetectionTexture_=o;this.hitDetectionRenderbuffer_=r};ol.webgl.Context.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;this.getGL().useProgram(e);this.currentProgram_=e;return!0};ol.webgl.Context.createTexture_=function(e,t,o){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);void 0!==t&&e.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_S,t);void 0!==o&&e.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_T,o);return r};ol.webgl.Context.createEmptyTexture=function(e,t,o,r,n){r=ol.webgl.Context.createTexture_(e,r,n);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,o,0,e.RGBA,e.UNSIGNED_BYTE,null);return r};ol.webgl.Context.createTexture=function(e,t,o,r){o=ol.webgl.Context.createTexture_(e,o,r);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);return o};ol.render.webgl.TextureReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.anchorY=this.anchorX=void 0;this.groupIndices=[];this.hitDetectionGroupIndices=[];this.imageWidth=this.imageHeight=this.height=void 0;this.defaultLocations=null;this.width=this.scale=this.rotation=this.rotateWithView=this.originY=this.originX=this.opacity=void 0};ol.inherits(ol.render.webgl.TextureReplay,ol.render.webgl.Replay);ol.render.webgl.TextureReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer,r=this.getTextures(!0),n=e.getGL();return function(){if(!n.isContextLost()){var i,a=0;for(i=r.length;a<i;++a)n.deleteTexture(r[a])}e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.TextureReplay.prototype.drawCoordinates=function(e,t,o,r){var n=this.anchorX,i=this.anchorY,a=this.height,s=this.imageHeight,l=this.imageWidth,c=this.opacity,u=this.originX,h=this.originY,d=this.rotateWithView?1:0,p=-this.rotation,f=this.scale,g=this.width,m=Math.cos(p);p=Math.sin(p);for(var y,C,v,T,_,S=this.indices.length,E=this.vertices.length;t<o;t+=r)T=e[t]-this.origin[0],_=e[t+1]-this.origin[1],y=E/8,C=-f*n,v=-f*(a-i),this.vertices[E++]=T,this.vertices[E++]=_,this.vertices[E++]=C*m-v*p,this.vertices[E++]=C*p+v*m,this.vertices[E++]=u/l,this.vertices[E++]=(h+a)/s,this.vertices[E++]=c,this.vertices[E++]=d,C=f*(g-n),v=-f*(a-i),this.vertices[E++]=T,this.vertices[E++]=_,this.vertices[E++]=C*m-v*p,this.vertices[E++]=C*p+v*m,this.vertices[E++]=(u+g)/l,this.vertices[E++]=(h+a)/s,this.vertices[E++]=c,this.vertices[E++]=d,C=f*(g-n),v=f*i,this.vertices[E++]=T,this.vertices[E++]=_,this.vertices[E++]=C*m-v*p,this.vertices[E++]=C*p+v*m,this.vertices[E++]=(u+g)/l,this.vertices[E++]=h/s,this.vertices[E++]=c,this.vertices[E++]=d,C=-f*n,v=f*i,this.vertices[E++]=T,this.vertices[E++]=_,this.vertices[E++]=C*m-v*p,this.vertices[E++]=C*p+v*m,this.vertices[E++]=u/l,this.vertices[E++]=h/s,this.vertices[E++]=c,this.vertices[E++]=d,this.indices[S++]=y,this.indices[S++]=y+1,this.indices[S++]=y+2,this.indices[S++]=y,this.indices[S++]=y+2,this.indices[S++]=y+3;return E};ol.render.webgl.TextureReplay.prototype.createTextures=function(e,t,o,r){var n,i=t.length;for(n=0;n<i;++n){var a=t[n],s=ol.getUid(a).toString();s in o?a=o[s]:(a=ol.webgl.Context.createTexture(r,a,ol.webgl.CLAMP_TO_EDGE,ol.webgl.CLAMP_TO_EDGE),o[s]=a);e[n]=a}};ol.render.webgl.TextureReplay.prototype.setUpProgram=function(e,t,o,r){o=t.getProgram(ol.render.webgl.texturereplay.defaultshader.fragment,ol.render.webgl.texturereplay.defaultshader.vertex);this.defaultLocations?r=this.defaultLocations:this.defaultLocations=r=new ol.render.webgl.texturereplay.defaultshader.Locations(e,o);t.useProgram(o);e.enableVertexAttribArray(r.a_position);e.vertexAttribPointer(r.a_position,2,ol.webgl.FLOAT,!1,32,0);e.enableVertexAttribArray(r.a_offsets);e.vertexAttribPointer(r.a_offsets,2,ol.webgl.FLOAT,!1,32,8);e.enableVertexAttribArray(r.a_texCoord);e.vertexAttribPointer(r.a_texCoord,2,ol.webgl.FLOAT,!1,32,16);e.enableVertexAttribArray(r.a_opacity);e.vertexAttribPointer(r.a_opacity,1,ol.webgl.FLOAT,!1,32,24);e.enableVertexAttribArray(r.a_rotateWithView);e.vertexAttribPointer(r.a_rotateWithView,1,ol.webgl.FLOAT,!1,32,28);return r};ol.render.webgl.TextureReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_offsets);e.disableVertexAttribArray(t.a_texCoord);e.disableVertexAttribArray(t.a_opacity);e.disableVertexAttribArray(t.a_rotateWithView)};ol.render.webgl.TextureReplay.prototype.drawReplay=function(e,t,o,r){var n=r?this.getHitDetectionTextures():this.getTextures();r=r?this.hitDetectionGroupIndices:this.groupIndices;if(ol.obj.isEmpty(o)){var i;o=0;var a=n.length;for(i=0;o<a;++o){e.bindTexture(ol.webgl.TEXTURE_2D,n[o]);var s=r[o];this.drawElements(e,t,i,s);i=s}}else this.drawReplaySkipping(e,t,o,n,r)};ol.render.webgl.TextureReplay.prototype.drawReplaySkipping=function(e,t,o,r,n){var i,a=0,s=0;for(i=r.length;s<i;++s){e.bindTexture(ol.webgl.TEXTURE_2D,r[s]);for(var l=0<s?n[s-1]:0,c=n[s],u=l;a<this.startIndices.length&&this.startIndices[a]<=c;){void 0!==o[ol.getUid(this.startIndicesFeature[a]).toString()]?(u!==l&&this.drawElements(e,t,u,l),l=u=a===this.startIndices.length-1?c:this.startIndices[a+1]):l=a===this.startIndices.length-1?c:this.startIndices[a+1];a++}u!==l&&this.drawElements(e,t,u,l)}};ol.render.webgl.TextureReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,n){var i,a,s=this.startIndices.length-1,l=this.getHitDetectionTextures();for(i=l.length-1;0<=i;--i){e.bindTexture(ol.webgl.TEXTURE_2D,l[i]);var c=0<i?this.hitDetectionGroupIndices[i-1]:0;for(a=this.hitDetectionGroupIndices[i];0<=s&&this.startIndices[s]>=c;){var u=this.startIndices[s],h=this.startIndicesFeature[s];if(void 0===o[ol.getUid(h).toString()]&&h.getGeometry()&&(void 0===n||ol.extent.intersects(n,h.getGeometry().getExtent()))&&(e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,u,a),a=r(h)))return a;a=u;s--}}};ol.render.webgl.TextureReplay.prototype.finish=function(e){this.imageWidth=this.imageHeight=this.height=this.anchorY=this.anchorX=void 0;this.indices=null;this.scale=this.rotation=this.rotateWithView=this.originY=this.originX=this.opacity=void 0;this.vertices=null;this.width=void 0};ol.render.webgl.TextureReplay.prototype.getTextures=function(e){};ol.render.webgl.TextureReplay.prototype.getHitDetectionTextures=function(){};ol.render.webgl.ImageReplay=function(e,t){ol.render.webgl.TextureReplay.call(this,e,t);this.images_=[];this.hitDetectionImages_=[];this.textures_=[];this.hitDetectionTextures_=[]};ol.inherits(ol.render.webgl.ImageReplay,ol.render.webgl.TextureReplay);ol.render.webgl.ImageReplay.prototype.drawMultiPoint=function(e,t){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);t=e.getFlatCoordinates();e=e.getStride();this.drawCoordinates(t,0,t.length,e)};ol.render.webgl.ImageReplay.prototype.drawPoint=function(e,t){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);t=e.getFlatCoordinates();e=e.getStride();this.drawCoordinates(t,0,t.length,e)};ol.render.webgl.ImageReplay.prototype.finish=function(e){var t=e.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices.push(this.indices.length);this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);var o={};this.createTextures(this.textures_,this.images_,o,t);this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,o,t);this.hitDetectionImages_=this.images_=null;ol.render.webgl.TextureReplay.prototype.finish.call(this,e)};ol.render.webgl.ImageReplay.prototype.setImageStyle=function(e){var t=e.getAnchor(),o=e.getImage(1),r=e.getImageSize(),n=e.getHitDetectionImage(1),i=e.getOpacity(),a=e.getOrigin(),s=e.getRotateWithView(),l=e.getRotation(),c=e.getSize();e=e.getScale();if(0===this.images_.length)this.images_.push(o);else{var u=this.images_[this.images_.length-1];ol.getUid(u)!=ol.getUid(o)&&(this.groupIndices.push(this.indices.length),this.images_.push(o))}0===this.hitDetectionImages_.length?this.hitDetectionImages_.push(n):(u=this.hitDetectionImages_[this.hitDetectionImages_.length-1],ol.getUid(u)!=ol.getUid(n)&&(this.hitDetectionGroupIndices.push(this.indices.length),this.hitDetectionImages_.push(n)));this.anchorX=t[0];this.anchorY=t[1];this.height=c[1];this.imageHeight=r[1];this.imageWidth=r[0];this.opacity=i;this.originX=a[0];this.originY=a[1];this.rotation=l;this.rotateWithView=s;this.scale=e;this.width=c[0]};ol.render.webgl.ImageReplay.prototype.getTextures=function(e){return e?this.textures_.concat(this.hitDetectionTextures_):this.textures_};ol.render.webgl.ImageReplay.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};ol.geom.flat.topology={};ol.geom.flat.topology.lineStringIsClosed=function(e,t,o,r){var n=o-r;return e[t]===e[n]&&e[t+1]===e[n+1]&&3<(o-t)/r&&!!ol.geom.flat.area.linearRing(e,t,o,r)};ol.render.webgl.linestringreplay={};ol.render.webgl.linestringreplay.defaultshader={};ol.render.webgl.linestringreplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.linestringreplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n":"varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}");ol.render.webgl.linestringreplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_lineWidth=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_lineWidth":"k");this.u_miterLimit=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_miterLimit":"l");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"m");this.u_color=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_color":"n");this.u_size=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_size":"o");this.u_pixelRatio=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_pixelRatio":"p");this.a_lastPos=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_lastPos":"d");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"e");this.a_nextPos=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_nextPos":"f");this.a_direction=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_direction":"g")};ol.render.webgl.LineStringReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};ol.inherits(ol.render.webgl.LineStringReplay,ol.render.webgl.Replay);ol.render.webgl.LineStringReplay.prototype.drawCoordinates_=function(e,t,o,r){var n,i=this.vertices.length,a=this.indices.length,s="bevel"===this.state_.lineJoin?0:"miter"===this.state_.lineJoin?1:2,l="butt"===this.state_.lineCap?0:"square"===this.state_.lineCap?1:2,c=ol.geom.flat.topology.lineStringIsClosed(e,t,o,r),u=a,h=1;for(n=t;n<o;n+=r){var d=i/7,p=f,f=g||[e[n],e[n+1]];if(n===t){var g=[e[n+r],e[n+r+1]];if(o-t==2*r&&ol.array.equals(f,g))break;if(!c){l&&(i=this.addVertices_([0,0],f,g,h*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE_CAP*l,i),i=this.addVertices_([0,0],f,g,-h*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE_CAP*l,i),this.indices[a++]=d+2,this.indices[a++]=d,this.indices[a++]=d+1,this.indices[a++]=d+1,this.indices[a++]=d+3,this.indices[a++]=d+2);i=this.addVertices_([0,0],f,g,h*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE*(l||1),i);u=(i=this.addVertices_([0,0],f,g,-h*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE*(l||1),i))/7-1;continue}p=[e[o-2*r],e[o-2*r+1]];var m=g}else{if(n===o-r){c?g=m:(p=p||[0,0],i=this.addVertices_(p,f,[0,0],h*ol.render.webgl.LineStringReplay.Instruction_.END_LINE*(l||1),i),i=this.addVertices_(p,f,[0,0],-h*ol.render.webgl.LineStringReplay.Instruction_.END_LINE*(l||1),i),this.indices[a++]=d,this.indices[a++]=u-1,this.indices[a++]=u,this.indices[a++]=u,this.indices[a++]=d+1,this.indices[a++]=d,l&&(i=this.addVertices_(p,f,[0,0],h*ol.render.webgl.LineStringReplay.Instruction_.END_LINE_CAP*l,i),i=this.addVertices_(p,f,[0,0],-h*ol.render.webgl.LineStringReplay.Instruction_.END_LINE_CAP*l,i),this.indices[a++]=d+2,this.indices[a++]=d,this.indices[a++]=d+1,this.indices[a++]=d+1,this.indices[a++]=d+3,this.indices[a++]=d+2));break}g=[e[n+r],e[n+r+1]]}var y=ol.render.webgl.triangleIsCounterClockwise(p[0],p[1],f[0],f[1],g[0],g[1])?-1:1;i=this.addVertices_(p,f,g,y*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_FIRST*(s||1),i);i=this.addVertices_(p,f,g,y*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_SECOND*(s||1),i);i=this.addVertices_(p,f,g,-y*ol.render.webgl.LineStringReplay.Instruction_.MITER_BOTTOM*(s||1),i);n>t&&(this.indices[a++]=d,this.indices[a++]=u-1,this.indices[a++]=u,this.indices[a++]=d+2,this.indices[a++]=d,this.indices[a++]=0<h*y?u:u-1);this.indices[a++]=d;this.indices[a++]=d+2;this.indices[a++]=d+1;u=d+2;h=y;s&&(i=this.addVertices_(p,f,g,y*ol.render.webgl.LineStringReplay.Instruction_.MITER_TOP*s,i),this.indices[a++]=d+1,this.indices[a++]=d+3,this.indices[a++]=d)}c&&(d=d||i/7,y=ol.geom.flat.orient.linearRingIsClockwise([p[0],p[1],f[0],f[1],g[0],g[1]],0,6,2)?1:-1,i=this.addVertices_(p,f,g,y*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_FIRST*(s||1),i),this.addVertices_(p,f,g,-y*ol.render.webgl.LineStringReplay.Instruction_.MITER_BOTTOM*(s||1),i),this.indices[a++]=d,this.indices[a++]=u-1,this.indices[a++]=u,this.indices[a++]=d+1,this.indices[a++]=d,this.indices[a++]=0<h*y?u:u-1)};ol.render.webgl.LineStringReplay.prototype.addVertices_=function(e,t,o,r,n){this.vertices[n++]=e[0];this.vertices[n++]=e[1];this.vertices[n++]=t[0];this.vertices[n++]=t[1];this.vertices[n++]=o[0];this.vertices[n++]=o[1];this.vertices[n++]=r;return n};ol.render.webgl.LineStringReplay.prototype.isValid_=function(e,t,o,r){return!((o-=t)<2*r)&&(o!==2*r||!ol.array.equals([e[t],e[t+1]],[e[t+r],e[t+r+1]]))};ol.render.webgl.LineStringReplay.prototype.drawLineString=function(e,t){var o=e.getFlatCoordinates();e=e.getStride();this.isValid_(o,0,o.length,e)&&(o=ol.geom.flat.transform.translate(o,0,o.length,e,-this.origin[0],-this.origin[1]),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.drawCoordinates_(o,0,o.length,e))};ol.render.webgl.LineStringReplay.prototype.drawMultiLineString=function(e,t){var o=this.indices.length,r=e.getEnds();r.unshift(0);var n,i=e.getFlatCoordinates();e=e.getStride();if(1<r.length){var a=1;for(n=r.length;a<n;++a)if(this.isValid_(i,r[a-1],r[a],e)){var s=ol.geom.flat.transform.translate(i,r[a-1],r[a],e,-this.origin[0],-this.origin[1]);this.drawCoordinates_(s,0,s.length,e)}}this.indices.length>o&&(this.startIndices.push(o),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(o),this.state_.changed=!1))};ol.render.webgl.LineStringReplay.prototype.drawPolygonCoordinates=function(e,t,o){ol.geom.flat.topology.lineStringIsClosed(e,0,e.length,o)||(e.push(e[0]),e.push(e[1]));this.drawCoordinates_(e,0,e.length,o);if(t.length){var r;e=0;for(r=t.length;e<r;++e)ol.geom.flat.topology.lineStringIsClosed(t[e],0,t[e].length,o)||(t[e].push(t[e][0]),t[e].push(t[e][1])),this.drawCoordinates_(t[e],0,t[e].length,o)}};ol.render.webgl.LineStringReplay.prototype.setPolygonStyle=function(e,t){t=void 0===t?this.indices.length:t;this.startIndices.push(t);this.startIndicesFeature.push(e);this.state_.changed&&(this.styleIndices_.push(t),this.state_.changed=!1)};ol.render.webgl.LineStringReplay.prototype.getCurrentIndex=function(){return this.indices.length};ol.render.webgl.LineStringReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.indices=this.vertices=null};ol.render.webgl.LineStringReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.LineStringReplay.prototype.setUpProgram=function(e,t,o,r){var n=t.getProgram(ol.render.webgl.linestringreplay.defaultshader.fragment,ol.render.webgl.linestringreplay.defaultshader.vertex);if(this.defaultLocations_)var i=this.defaultLocations_;else this.defaultLocations_=i=new ol.render.webgl.linestringreplay.defaultshader.Locations(e,n);t.useProgram(n);e.enableVertexAttribArray(i.a_lastPos);e.vertexAttribPointer(i.a_lastPos,2,ol.webgl.FLOAT,!1,28,0);e.enableVertexAttribArray(i.a_position);e.vertexAttribPointer(i.a_position,2,ol.webgl.FLOAT,!1,28,8);e.enableVertexAttribArray(i.a_nextPos);e.vertexAttribPointer(i.a_nextPos,2,ol.webgl.FLOAT,!1,28,16);e.enableVertexAttribArray(i.a_direction);e.vertexAttribPointer(i.a_direction,1,ol.webgl.FLOAT,!1,28,24);e.uniform2fv(i.u_size,o);e.uniform1f(i.u_pixelRatio,r);return i};ol.render.webgl.LineStringReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_lastPos);e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_nextPos);e.disableVertexAttribArray(t.a_direction)};ol.render.webgl.LineStringReplay.prototype.drawReplay=function(e,t,o,r){var n=e.getParameter(e.DEPTH_FUNC),i=e.getParameter(e.DEPTH_WRITEMASK);r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL));if(ol.obj.isEmpty(o)){var a=this.startIndices[this.startIndices.length-1];for(o=this.styleIndices_.length-1;0<=o;--o){var s=this.styleIndices_[o],l=this.styles_[o];this.setStrokeStyle_(e,l[0],l[1],l[2]);this.drawElements(e,t,s,a);e.clear(e.DEPTH_BUFFER_BIT);a=s}}else this.drawReplaySkipping_(e,t,o);r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(i),e.depthFunc(n))};ol.render.webgl.LineStringReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,n,i=this.startIndices.length-2,a=n=this.startIndices[i+1];for(r=this.styleIndices_.length-1;0<=r;--r){var s=this.styles_[r];this.setStrokeStyle_(e,s[0],s[1],s[2]);for(s=this.styleIndices_[r];0<=i&&this.startIndices[i]>=s;){var l=this.startIndices[i],c=this.startIndicesFeature[i];o[c=ol.getUid(c).toString()]&&(n!==a&&(this.drawElements(e,t,n,a),e.clear(e.DEPTH_BUFFER_BIT)),a=l);i--;n=l}n!==a&&(this.drawElements(e,t,n,a),e.clear(e.DEPTH_BUFFER_BIT));n=a=s}};ol.render.webgl.LineStringReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,n){var i,a,s=this.startIndices.length-2,l=this.startIndices[s+1];for(i=this.styleIndices_.length-1;0<=i;--i){var c=this.styles_[i];this.setStrokeStyle_(e,c[0],c[1],c[2]);for(a=this.styleIndices_[i];0<=s&&this.startIndices[s]>=a;){c=this.startIndices[s];var u=this.startIndicesFeature[s];if(void 0===o[ol.getUid(u).toString()]&&u.getGeometry()&&(void 0===n||ol.extent.intersects(n,u.getGeometry().getExtent()))&&(e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,c,l),l=r(u)))return l;s--;l=c}}};ol.render.webgl.LineStringReplay.prototype.setStrokeStyle_=function(e,t,o,r){e.uniform4fv(this.defaultLocations_.u_color,t);e.uniform1f(this.defaultLocations_.u_lineWidth,o);e.uniform1f(this.defaultLocations_.u_miterLimit,r)};ol.render.webgl.LineStringReplay.prototype.setFillStrokeStyle=function(e,t){e=t.getLineCap();this.state_.lineCap=void 0!==e?e:ol.render.webgl.defaultLineCap;e=t.getLineDash();this.state_.lineDash=e||ol.render.webgl.defaultLineDash;e=t.getLineDashOffset();this.state_.lineDashOffset=e||ol.render.webgl.defaultLineDashOffset;e=t.getLineJoin();this.state_.lineJoin=void 0!==e?e:ol.render.webgl.defaultLineJoin;e=(e=t.getColor())instanceof CanvasGradient||e instanceof CanvasPattern?ol.render.webgl.defaultStrokeStyle:ol.color.asArray(e).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultStrokeStyle;var o=t.getWidth();o=void 0!==o?o:ol.render.webgl.defaultLineWidth;t=void 0!==(t=t.getMiterLimit())?t:ol.render.webgl.defaultMiterLimit;this.state_.strokeColor&&ol.array.equals(this.state_.strokeColor,e)&&this.state_.lineWidth===o&&this.state_.miterLimit===t||(this.state_.changed=!0,this.state_.strokeColor=e,this.state_.lineWidth=o,this.state_.miterLimit=t,this.styles_.push([e,o,t]))};ol.render.webgl.LineStringReplay.Instruction_={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23};ol.render.webgl.polygonreplay={};ol.render.webgl.polygonreplay.defaultshader={};ol.render.webgl.polygonreplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.polygonreplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n":"attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}");ol.render.webgl.polygonreplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"b");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"c");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"d");this.u_color=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_color":"e");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"f");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"a")};ol.structs.LinkedList=function(e){this.head_=this.last_=this.first_=void 0;this.circular_=void 0===e||e;this.length_=0};ol.structs.LinkedList.prototype.insertItem=function(e){e={prev:void 0,next:void 0,data:e};var t=this.head_;if(t){var o=t.next;e.prev=t;e.next=o;t.next=e;o&&(o.prev=e);t===this.last_&&(this.last_=e)}else this.last_=this.first_=e,this.circular_&&(e.next=e,e.prev=e);this.head_=e;this.length_++};ol.structs.LinkedList.prototype.removeItem=function(){var e=this.head_;if(e){var t=e.next,o=e.prev;t&&(t.prev=o);o&&(o.next=t);this.head_=t||o;this.first_===this.last_?this.last_=this.first_=this.head_=void 0:this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=o?this.head_.prev:this.head_);this.length_--}};ol.structs.LinkedList.prototype.firstItem=function(){if(this.head_=this.first_)return this.head_.data};ol.structs.LinkedList.prototype.lastItem=function(){if(this.head_=this.last_)return this.head_.data};ol.structs.LinkedList.prototype.nextItem=function(){if(this.head_&&this.head_.next)return this.head_=this.head_.next,this.head_.data};ol.structs.LinkedList.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data};ol.structs.LinkedList.prototype.prevItem=function(){if(this.head_&&this.head_.prev)return this.head_=this.head_.prev,this.head_.data};ol.structs.LinkedList.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data};ol.structs.LinkedList.prototype.getCurrItem=function(){if(this.head_)return this.head_.data};ol.structs.LinkedList.prototype.setFirstItem=function(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)};ol.structs.LinkedList.prototype.concat=function(e){if(e.head_){if(this.head_){var t=this.head_.next;this.head_.next=e.first_;e.first_.prev=this.head_;t.prev=e.last_;e.last_.next=t;this.length_+=e.length_}else this.head_=e.head_,this.first_=e.first_,this.last_=e.last_,this.length_=e.length_;e.head_=void 0;e.first_=void 0;e.last_=void 0;e.length_=0}};ol.structs.LinkedList.prototype.getLength=function(){return this.length_};ol.structs.RBush=function(e){this.rbush_=ol.ext.rbush(e);this.items_={}};ol.structs.RBush.prototype.insert=function(e,t){e={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(e);this.items_[ol.getUid(t)]=e};ol.structs.RBush.prototype.load=function(e,t){for(var o=Array(t.length),r=0,n=t.length;r<n;r++){var i=e[r],a=t[r];i={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:a};o[r]=i;this.items_[ol.getUid(a)]=i}this.rbush_.load(o)};ol.structs.RBush.prototype.remove=function(e){e=ol.getUid(e);var t=this.items_[e];delete this.items_[e];return null!==this.rbush_.remove(t)};ol.structs.RBush.prototype.update=function(e,t){var o=this.items_[ol.getUid(t)];ol.extent.equals([o.minX,o.minY,o.maxX,o.maxY],e)||(this.remove(t),this.insert(e,t))};ol.structs.RBush.prototype.getAll=function(){return this.rbush_.all().map(function(e){return e.value})};ol.structs.RBush.prototype.getInExtent=function(e){return this.rbush_.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}).map(function(e){return e.value})};ol.structs.RBush.prototype.forEach=function(e,t){return this.forEach_(this.getAll(),e,t)};ol.structs.RBush.prototype.forEachInExtent=function(e,t,o){return this.forEach_(this.getInExtent(e),t,o)};ol.structs.RBush.prototype.forEach_=function(e,t,o){for(var r,n=0,i=e.length;n<i&&!(r=t.call(o,e[n]));n++);return r};ol.structs.RBush.prototype.isEmpty=function(){return ol.obj.isEmpty(this.items_)};ol.structs.RBush.prototype.clear=function(){this.rbush_.clear();this.items_={}};ol.structs.RBush.prototype.getExtent=function(e){var t=this.rbush_.data;return ol.extent.createOrUpdate(t.minX,t.minY,t.maxX,t.maxY,e)};ol.structs.RBush.prototype.concat=function(e){this.rbush_.load(e.rbush_.all());for(var t in e.items_)this.items_[0|t]=e.items_[0|t]};ol.render.webgl.PolygonReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.lineStringReplay=new ol.render.webgl.LineStringReplay(e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={fillColor:null,changed:!1}};ol.inherits(ol.render.webgl.PolygonReplay,ol.render.webgl.Replay);ol.render.webgl.PolygonReplay.prototype.drawCoordinates_=function(e,t,o){var r=new ol.structs.LinkedList,n=new ol.structs.RBush;this.processFlatCoordinates_(e,o,r,n,!0);e=this.getMaxCoords_(r);if(t.length){var i,a=[],s=0;for(i=t.length;s<i;++s){var l={list:new ol.structs.LinkedList,maxCoords:void 0,rtree:new ol.structs.RBush};a.push(l);this.processFlatCoordinates_(t[s],o,l.list,l.rtree,!1);this.classifyPoints_(l.list,l.rtree,!0);l.maxCoords=this.getMaxCoords_(l.list)}a.sort(function(e,t){return t.maxCoords[0]===e.maxCoords[0]?e.maxCoords[1]-t.maxCoords[1]:t.maxCoords[0]-e.maxCoords[0]});for(s=0;s<a.length;++s){i=o=(t=a[s].list).firstItem();do{if(this.getIntersections_(i,n).length){var c=!0;break}i=t.nextItem()}while(o!==i);!c&&this.bridgeHole_(t,a[s].maxCoords[0],r,e[0],n)&&(n.concat(a[s].rtree),this.classifyPoints_(r,n,!1))}}else this.classifyPoints_(r,n,!1);this.triangulate_(r,n)};ol.render.webgl.PolygonReplay.prototype.processFlatCoordinates_=function(e,t,o,r,n){var i,a=ol.geom.flat.orient.linearRingIsClockwise(e,0,e.length,t),s=this.vertices.length/2,l=[],c=[];if(n===a){a=n=this.createPoint_(e[0],e[1],s++);var u=t;for(i=e.length;u<i;u+=t){var h=this.createPoint_(e[u],e[u+1],s++);c.push(this.insertItem_(a,h,o));l.push([Math.min(a.x,h.x),Math.min(a.y,h.y),Math.max(a.x,h.x),Math.max(a.y,h.y)]);a=h}}else for(u=e.length-t,a=n=this.createPoint_(e[u],e[u+1],s++),u-=t,i=0;u>=i;u-=t)h=this.createPoint_(e[u],e[u+1],s++),c.push(this.insertItem_(a,h,o)),l.push([Math.min(a.x,h.x),Math.min(a.y,h.y),Math.max(a.x,h.x),Math.max(a.y,h.y)]),a=h;c.push(this.insertItem_(h,n,o));l.push([Math.min(a.x,h.x),Math.min(a.y,h.y),Math.max(a.x,h.x),Math.max(a.y,h.y)]);r.load(l,c)};ol.render.webgl.PolygonReplay.prototype.getMaxCoords_=function(e){var t=e.firstItem(),o=t,r=[o.p0.x,o.p0.y];do{(o=e.nextItem()).p0.x>r[0]&&(r=[o.p0.x,o.p0.y])}while(o!==t);return r};ol.render.webgl.PolygonReplay.prototype.classifyPoints_=function(e,t,o){var r=e.firstItem(),n=r,i=e.nextItem(),a=!1;do{var s=o?ol.render.webgl.triangleIsCounterClockwise(i.p1.x,i.p1.y,n.p1.x,n.p1.y,n.p0.x,n.p0.y):ol.render.webgl.triangleIsCounterClockwise(n.p0.x,n.p0.y,n.p1.x,n.p1.y,i.p1.x,i.p1.y);void 0===s?(this.removeItem_(n,i,e,t),a=!0,i===r&&(r=e.getNextItem()),i=n,e.prevItem()):n.p1.reflex!==s&&(n.p1.reflex=s,a=!0);n=i;i=e.nextItem()}while(n!==r);return a};ol.render.webgl.PolygonReplay.prototype.bridgeHole_=function(e,t,o,r,n){for(var i=e.firstItem();i.p1.x!==t;)i=e.nextItem();r={x:r,y:(t=i.p1).y,i:-1};var a,s=1/0,l=this.getIntersections_({p0:t,p1:r},n,!0),c=0;for(a=l.length;c<a;++c){var u=l[c],h=this.calculateIntersection_(t,r,u.p0,u.p1,!0),d=Math.abs(t.x-h[0]);if(d<s&&void 0!==ol.render.webgl.triangleIsCounterClockwise(t.x,t.y,u.p0.x,u.p0.y,u.p1.x,u.p1.y)){s=d;var p={x:h[0],y:h[1],i:-1};i=u}}if(1/0===s)return!1;l=i.p1;if(0<s&&(i=this.getPointsInTriangle_(t,p,i.p1,n)).length)for(p=1/0,c=0,a=i.length;c<a;++c)(s=i[c],(u=Math.atan2(t.y-s.y,r.x-s.x))<p||u===p&&s.x<l.x)&&(p=u,l=s);for(i=o.firstItem();i.p1.x!==l.x||i.p1.y!==l.y;)i=o.nextItem();r={x:t.x,y:t.y,i:t.i,reflex:void 0};c={x:i.p1.x,y:i.p1.y,i:i.p1.i,reflex:void 0};e.getNextItem().p0=r;this.insertItem_(t,i.p1,e,n);this.insertItem_(c,r,e,n);i.p1=c;e.setFirstItem();o.concat(e);return!0};ol.render.webgl.PolygonReplay.prototype.triangulate_=function(e,t){for(var o=!1,r=this.isSimple_(e,t);3<e.getLength();)if(r){if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t,!0))break}else if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t)){if(!(r=this.isSimple_(e,t))){this.splitPolygon_(e,t);break}o=!this.isClockwise_(e),this.classifyPoints_(e,t,o)}3===e.getLength()&&(t=this.indices.length,this.indices[t++]=e.getPrevItem().p0.i,this.indices[t++]=e.getCurrItem().p0.i,this.indices[t++]=e.getNextItem().p0.i)};ol.render.webgl.PolygonReplay.prototype.clipEars_=function(e,t,o,r){var n=this.indices.length,i=e.firstItem(),a=e.getPrevItem(),s=i,l=e.nextItem(),c=e.getNextItem(),u=!1;do{var h=s.p0,d=s.p1,p=l.p1;if(!1===d.reflex){var f=o?0===this.getPointsInTriangle_(h,d,p,t,!0).length:r?this.diagonalIsInside_(c.p1,p,d,h,a.p0):this.diagonalIsInside_(a.p0,h,d,p,c.p1);!o&&0!==this.getIntersections_({p0:h,p1:p},t).length||!f||!o&&!1!==h.reflex&&!1!==p.reflex&&ol.geom.flat.orient.linearRingIsClockwise([a.p0.x,a.p0.y,h.x,h.y,d.x,d.y,p.x,p.y,c.p1.x,c.p1.y],0,10,2)!==!r||(this.indices[n++]=h.i,this.indices[n++]=d.i,this.indices[n++]=p.i,this.removeItem_(s,l,e,t),l===i&&(i=c),u=!0)}a=e.getPrevItem();s=e.getCurrItem();l=e.nextItem();c=e.getNextItem()}while(s!==i&&3<e.getLength());return u};ol.render.webgl.PolygonReplay.prototype.resolveSelfIntersections_=function(e,t,o){var r=e.firstItem();e.nextItem();var n=r,i=e.nextItem(),a=!1;do{var s=this.calculateIntersection_(n.p0,n.p1,i.p0,i.p1,o);if(s){a=this.indices.length;var l=this.vertices.length/2,c=e.prevItem();e.removeItem();t.remove(c);var u=c===r;o?(s[0]===n.p0.x&&s[1]===n.p0.y?(e.prevItem(),s=n.p0,i.p0=s,t.remove(n),u=u||n===r):(s=i.p1,n.p1=s,t.remove(i),u=u||i===r),e.removeItem()):(s=this.createPoint_(s[0],s[1],l),n.p1=s,i.p0=s,t.update([Math.min(n.p0.x,n.p1.x),Math.min(n.p0.y,n.p1.y),Math.max(n.p0.x,n.p1.x),Math.max(n.p0.y,n.p1.y)],n),t.update([Math.min(i.p0.x,i.p1.x),Math.min(i.p0.y,i.p1.y),Math.max(i.p0.x,i.p1.x),Math.max(i.p0.y,i.p1.y)],i));this.indices[a++]=c.p0.i;this.indices[a++]=c.p1.i;this.indices[a++]=s.i;a=!0;if(u)break}n=e.getPrevItem();i=e.nextItem()}while(n!==r);return a};ol.render.webgl.PolygonReplay.prototype.isSimple_=function(e,t){var o=e.firstItem(),r=o;do{if(this.getIntersections_(r,t).length)return!1;r=e.nextItem()}while(r!==o);return!0};ol.render.webgl.PolygonReplay.prototype.isClockwise_=function(e){var t=2*e.getLength(),o=Array(t),r=e.firstItem(),n=r,i=0;do{o[i++]=n.p0.x,o[i++]=n.p0.y,n=e.nextItem()}while(n!==r);return ol.geom.flat.orient.linearRingIsClockwise(o,0,t,2)};ol.render.webgl.PolygonReplay.prototype.splitPolygon_=function(e,t){var o=e.firstItem(),r=o;do{var n=this.getIntersections_(r,t);if(n.length){o=n[0];n=this.vertices.length/2;var i=this.calculateIntersection_(r.p0,r.p1,o.p0,o.p1);n=this.createPoint_(i[0],i[1],n);i=new ol.structs.LinkedList;var a=new ol.structs.RBush;this.insertItem_(n,r.p1,i,a);r.p1=n;t.update([Math.min(r.p0.x,n.x),Math.min(r.p0.y,n.y),Math.max(r.p0.x,n.x),Math.max(r.p0.y,n.y)],r);for(r=e.nextItem();r!==o;)this.insertItem_(r.p0,r.p1,i,a),t.remove(r),e.removeItem(),r=e.getCurrItem();this.insertItem_(o.p0,n,i,a);o.p0=n;t.update([Math.min(o.p1.x,n.x),Math.min(o.p1.y,n.y),Math.max(o.p1.x,n.x),Math.max(o.p1.y,n.y)],o);this.classifyPoints_(e,t,!1);this.triangulate_(e,t);this.classifyPoints_(i,a,!1);this.triangulate_(i,a);break}r=e.nextItem()}while(r!==o)};ol.render.webgl.PolygonReplay.prototype.createPoint_=function(e,t,o){var r=this.vertices.length;this.vertices[r++]=e;this.vertices[r++]=t;return{x:e,y:t,i:o,reflex:void 0}};ol.render.webgl.PolygonReplay.prototype.insertItem_=function(e,t,o,r){var n={p0:e,p1:t};o.insertItem(n);r&&r.insert([Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.x,t.x),Math.max(e.y,t.y)],n);return n};ol.render.webgl.PolygonReplay.prototype.removeItem_=function(e,t,o,r){o.getCurrItem()===t&&(o.removeItem(),e.p1=t.p1,r.remove(t),r.update([Math.min(e.p0.x,e.p1.x),Math.min(e.p0.y,e.p1.y),Math.max(e.p0.x,e.p1.x),Math.max(e.p0.y,e.p1.y)],e))};ol.render.webgl.PolygonReplay.prototype.getPointsInTriangle_=function(e,t,o,r,n){var i,a,s=[],l=r.getInExtent([Math.min(e.x,t.x,o.x),Math.min(e.y,t.y,o.y),Math.max(e.x,t.x,o.x),Math.max(e.y,t.y,o.y)]);r=0;for(i=l.length;r<i;++r)for(a in l[r]){var c=l[r][a];"object"!=typeof c||n&&!c.reflex||c.x===e.x&&c.y===e.y||c.x===t.x&&c.y===t.y||c.x===o.x&&c.y===o.y||-1!==s.indexOf(c)||!ol.geom.flat.contains.linearRingContainsXY([e.x,e.y,t.x,t.y,o.x,o.y],0,6,2,c.x,c.y)||s.push(c)}return s};ol.render.webgl.PolygonReplay.prototype.getIntersections_=function(e,t,o){var r,n=e.p0,i=e.p1,a=[],s=0;for(r=(t=t.getInExtent([Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)])).length;s<r;++s){var l=t[s];e!==l&&(o||l.p0!==i||l.p1!==n)&&this.calculateIntersection_(n,i,l.p0,l.p1,o)&&a.push(l)}return a};ol.render.webgl.PolygonReplay.prototype.calculateIntersection_=function(e,t,o,r,n){var i=(r.y-o.y)*(t.x-e.x)-(r.x-o.x)*(t.y-e.y);if(0!==i&&(r=((r.x-o.x)*(e.y-o.y)-(r.y-o.y)*(e.x-o.x))/i,o=((t.x-e.x)*(e.y-o.y)-(t.y-e.y)*(e.x-o.x))/i,!n&&r>ol.render.webgl.EPSILON&&r<1-ol.render.webgl.EPSILON&&o>ol.render.webgl.EPSILON&&o<1-ol.render.webgl.EPSILON||n&&0<=r&&1>=r&&0<=o&&1>=o))return[e.x+r*(t.x-e.x),e.y+r*(t.y-e.y)]};ol.render.webgl.PolygonReplay.prototype.diagonalIsInside_=function(e,t,o,r,n){if(void 0===t.reflex||void 0===r.reflex)return!1;var i=(o.x-r.x)*(t.y-r.y)>(o.y-r.y)*(t.x-r.x);n=(n.x-r.x)*(t.y-r.y)<(n.y-r.y)*(t.x-r.x);e=(e.x-t.x)*(r.y-t.y)>(e.y-t.y)*(r.x-t.x);o=(o.x-t.x)*(r.y-t.y)<(o.y-t.y)*(r.x-t.x);t=t.reflex?o||e:o&&e;return(r.reflex?n||i:n&&i)&&t};ol.render.webgl.PolygonReplay.prototype.drawMultiPolygon=function(e,t){var o,r,n,i=e.getEndss(),a=e.getStride(),s=this.indices.length,l=this.lineStringReplay.getCurrentIndex();e=e.getFlatCoordinates();var c=r=0;for(o=i.length;c<o;++c){var u=i[c];if(0<u.length){var h=ol.geom.flat.transform.translate(e,r,u[0],a,-this.origin[0],-this.origin[1]);if(h.length){var d=[];r=1;for(n=u.length;r<n;++r)if(u[r]!==u[r-1]){var p=ol.geom.flat.transform.translate(e,u[r-1],u[r],a,-this.origin[0],-this.origin[1]);d.push(p)}this.lineStringReplay.drawPolygonCoordinates(h,d,a);this.drawCoordinates_(h,d,a)}}r=u[u.length-1]}this.indices.length>s&&(this.startIndices.push(s),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(s),this.state_.changed=!1));this.lineStringReplay.getCurrentIndex()>l&&this.lineStringReplay.setPolygonStyle(t,l)};ol.render.webgl.PolygonReplay.prototype.drawPolygon=function(e,t){var o=e.getEnds(),r=e.getStride();if(0<o.length){e=e.getFlatCoordinates().map(Number);var n=ol.geom.flat.transform.translate(e,0,o[0],r,-this.origin[0],-this.origin[1]);if(n.length){var i,a=[],s=1;for(i=o.length;s<i;++s)if(o[s]!==o[s-1]){var l=ol.geom.flat.transform.translate(e,o[s-1],o[s],r,-this.origin[0],-this.origin[1]);a.push(l)}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1);this.lineStringReplay.setPolygonStyle(t);this.lineStringReplay.drawPolygonCoordinates(n,a,r);this.drawCoordinates_(n,a,r)}}};ol.render.webgl.PolygonReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);this.lineStringReplay.finish(e);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.indices=this.vertices=null};ol.render.webgl.PolygonReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(e);return function(){e.deleteBuffer(t);e.deleteBuffer(o);r()}};ol.render.webgl.PolygonReplay.prototype.setUpProgram=function(e,t,o,r){o=t.getProgram(ol.render.webgl.polygonreplay.defaultshader.fragment,ol.render.webgl.polygonreplay.defaultshader.vertex);this.defaultLocations_?r=this.defaultLocations_:this.defaultLocations_=r=new ol.render.webgl.polygonreplay.defaultshader.Locations(e,o);t.useProgram(o);e.enableVertexAttribArray(r.a_position);e.vertexAttribPointer(r.a_position,2,ol.webgl.FLOAT,!1,8,0);return r};ol.render.webgl.PolygonReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position)};ol.render.webgl.PolygonReplay.prototype.drawReplay=function(e,t,o,r){var n=e.getParameter(e.DEPTH_FUNC),i=e.getParameter(e.DEPTH_WRITEMASK);r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL));if(ol.obj.isEmpty(o)){var a=this.startIndices[this.startIndices.length-1];for(o=this.styleIndices_.length-1;0<=o;--o){var s=this.styleIndices_[o],l=this.styles_[o];this.setFillStyle_(e,l);this.drawElements(e,t,s,a);a=s}}else this.drawReplaySkipping_(e,t,o);r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(i),e.depthFunc(n))};ol.render.webgl.PolygonReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,n){var i,a,s=this.startIndices.length-2,l=this.startIndices[s+1];for(i=this.styleIndices_.length-1;0<=i;--i){var c=this.styles_[i];this.setFillStyle_(e,c);for(a=this.styleIndices_[i];0<=s&&this.startIndices[s]>=a;){c=this.startIndices[s];var u=this.startIndicesFeature[s];if(void 0===o[ol.getUid(u).toString()]&&u.getGeometry()&&(void 0===n||ol.extent.intersects(n,u.getGeometry().getExtent()))&&(e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,c,l),l=r(u)))return l;s--;l=c}}};ol.render.webgl.PolygonReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,n,i=this.startIndices.length-2,a=n=this.startIndices[i+1];for(r=this.styleIndices_.length-1;0<=r;--r){var s=this.styles_[r];this.setFillStyle_(e,s);for(s=this.styleIndices_[r];0<=i&&this.startIndices[i]>=s;){var l=this.startIndices[i],c=this.startIndicesFeature[i];o[c=ol.getUid(c).toString()]&&(n!==a&&(this.drawElements(e,t,n,a),e.clear(e.DEPTH_BUFFER_BIT)),a=l);i--;n=l}n!==a&&(this.drawElements(e,t,n,a),e.clear(e.DEPTH_BUFFER_BIT));n=a=s}};ol.render.webgl.PolygonReplay.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_color,t)};ol.render.webgl.PolygonReplay.prototype.setFillStrokeStyle=function(e,t){e=(e=e?e.getColor():[0,0,0,0])instanceof CanvasGradient||e instanceof CanvasPattern?ol.render.webgl.defaultFillStyle:ol.color.asArray(e).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultFillStyle;this.state_.fillColor&&ol.array.equals(e,this.state_.fillColor)||(this.state_.fillColor=e,this.state_.changed=!0,this.styles_.push(e));t||(t=new ol.style.Stroke({color:[0,0,0,0],lineWidth:0}));this.lineStringReplay.setFillStrokeStyle(null,t)};ol.style.Atlas=function(e,t){this.space_=t;this.emptyBlocks_=[{x:0,y:0,width:e,height:e}];this.entries_={};this.context_=ol.dom.createCanvasContext2D(e,e);this.canvas_=this.context_.canvas};ol.style.Atlas.prototype.get=function(e){return this.entries_[e]||null};ol.style.Atlas.prototype.add=function(e,t,o,r,n){var i,a=0;for(i=this.emptyBlocks_.length;a<i;++a){var s=this.emptyBlocks_[a];if(s.width>=t+this.space_&&s.height>=o+this.space_)return i={offsetX:s.x+this.space_,offsetY:s.y+this.space_,image:this.canvas_},this.entries_[e]=i,r.call(n,this.context_,s.x+this.space_,s.y+this.space_),this.split_(a,s,t+this.space_,o+this.space_),i}return null};ol.style.Atlas.prototype.split_=function(e,t,o,r){if(t.width-o>t.height-r){var n={x:t.x+o,y:t.y,width:t.width-o,height:t.height};t={x:t.x,y:t.y+r,width:o,height:t.height-r}}else n={x:t.x+o,y:t.y,width:t.width-o,height:r},t={x:t.x,y:t.y+r,width:t.width,height:t.height-r};this.updateBlocks_(e,n,t)};ol.style.Atlas.prototype.updateBlocks_=function(e,t,o){e=[e,1];0<t.width&&0<t.height&&e.push(t);0<o.width&&0<o.height&&e.push(o);this.emptyBlocks_.splice.apply(this.emptyBlocks_,e)};ol.style.AtlasManager=function(e){e=e||{};this.currentSize_=void 0!==e.initialSize?e.initialSize:ol.INITIAL_ATLAS_SIZE;this.maxSize_=void 0!==e.maxSize?e.maxSize:-1!=ol.MAX_ATLAS_SIZE?ol.MAX_ATLAS_SIZE:void 0!==ol.WEBGL_MAX_TEXTURE_SIZE?ol.WEBGL_MAX_TEXTURE_SIZE:2048;this.space_=void 0!==e.space?e.space:1;this.atlases_=[new ol.style.Atlas(this.currentSize_,this.space_)];this.currentHitSize_=this.currentSize_;this.hitAtlases_=[new ol.style.Atlas(this.currentHitSize_,this.space_)]};ol.style.AtlasManager.prototype.getInfo=function(e){var t=this.getInfo_(this.atlases_,e);if(!t)return null;e=this.getInfo_(this.hitAtlases_,e);return this.mergeInfos_(t,e)};ol.style.AtlasManager.prototype.getInfo_=function(e,t){var o,r=0;for(o=e.length;r<o;++r){var n=e[r];if(n=n.get(t))return n}return null};ol.style.AtlasManager.prototype.mergeInfos_=function(e,t){return{offsetX:e.offsetX,offsetY:e.offsetY,image:e.image,hitImage:t.image}};ol.style.AtlasManager.prototype.add=function(e,t,o,r,n,i){if(t+this.space_>this.maxSize_||o+this.space_>this.maxSize_)return null;if(!(r=this.add_(!1,e,t,o,r,i)))return null;e=this.add_(!0,e,t,o,void 0!==n?n:ol.nullFunction,i);return this.mergeInfos_(r,e)};ol.style.AtlasManager.prototype.add_=function(e,t,o,r,n,i){var a,s=e?this.hitAtlases_:this.atlases_,l=0;for(a=s.length;l<a;++l){var c=s[l];if(c=c.add(t,o,r,n,i))return c;c||l!==a-1||(e?this.currentHitSize_=c=Math.min(2*this.currentHitSize_,this.maxSize_):this.currentSize_=c=Math.min(2*this.currentSize_,this.maxSize_),c=new ol.style.Atlas(c,this.space_),s.push(c),++a)}return null};ol.render.webgl.TextReplay=function(e,t){ol.render.webgl.TextureReplay.call(this,e,t);this.images_=[];this.textures_=[];this.measureCanvas_=ol.dom.createCanvasContext2D(0,0).canvas;this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.offsetY_=this.offsetX_=this.textBaseline_=this.textAlign_=void 0;this.atlases_={};this.currAtlas_=void 0;this.opacity=this.scale=1};ol.inherits(ol.render.webgl.TextReplay,ol.render.webgl.TextureReplay);ol.render.webgl.TextReplay.prototype.drawText=function(e,t){if(this.text_){var o=null,r=2,n=2;switch(e.getType()){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:r=(o=e.getFlatCoordinates()).length;n=e.getStride();break;case ol.geom.GeometryType.CIRCLE:o=e.getCenter();break;case ol.geom.GeometryType.LINE_STRING:o=e.getFlatMidpoint();break;case ol.geom.GeometryType.MULTI_LINE_STRING:r=(o=e.getFlatMidpoints()).length;break;case ol.geom.GeometryType.POLYGON:o=e.getFlatInteriorPoint();break;case ol.geom.GeometryType.MULTI_POLYGON:r=(o=e.getFlatInteriorPoints()).length}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);e=this.currAtlas_;t=this.text_.split("\n");var i,a,s,l=this.getTextSize_(t),c=Math.round(l[0]*this.textAlign_-this.offsetX_),u=Math.round(l[1]*this.textBaseline_-this.offsetY_),h=this.state_.lineWidth/2*this.state_.scale;l=0;for(i=t.length;l<i;++l){var d=0,p=e.height*l,f=t[l].split(""),g=0;for(a=f.length;g<a;++g){if(s=e.atlas.getInfo(f[g])){var m=s.image;this.anchorX=c-d;this.anchorY=u-p;this.originX=0===g?s.offsetX-h:s.offsetX;this.originY=s.offsetY;this.height=e.height;this.width=0===g||g===f.length-1?e.width[f[g]]+h:e.width[f[g]];this.imageHeight=m.height;this.imageWidth=m.width;0===this.images_.length?this.images_.push(m):(s=this.images_[this.images_.length-1],ol.getUid(s)!=ol.getUid(m)&&(this.groupIndices.push(this.indices.length),this.images_.push(m)));this.drawText_(o,0,r,n)}d+=this.width}}}};ol.render.webgl.TextReplay.prototype.getTextSize_=function(e){var t=this,o=this.currAtlas_,r=e.length*o.height;return[e.map(function(e){var r,n=0,i=0;for(r=e.length;i<r;++i){var a=e[i];o.width[a]||t.addCharToAtlas_(a);n+=o.width[a]?o.width[a]:0}return n}).reduce(function(e,t){return Math.max(e,t)}),r]};ol.render.webgl.TextReplay.prototype.drawText_=function(e,t,o,r){var n;for(n=t;n<o;n+=r)this.drawCoordinates(e,t,o,r)};ol.render.webgl.TextReplay.prototype.addCharToAtlas_=function(e){if(1===e.length){var t=this.currAtlas_,o=this.state_,r=this.measureCanvas_.getContext("2d");r.font=o.font;r=Math.ceil(r.measureText(e).width*o.scale);t.atlas.add(e,r,t.height,function(t,r,n){t.font=o.font;t.fillStyle=o.fillColor;t.strokeStyle=o.strokeColor;t.lineWidth=o.lineWidth;t.lineCap=o.lineCap;t.lineJoin=o.lineJoin;t.miterLimit=o.miterLimit;t.textAlign="left";t.textBaseline="top";ol.has.CANVAS_LINE_DASH&&o.lineDash&&(t.setLineDash(o.lineDash),t.lineDashOffset=o.lineDashOffset);1!==o.scale&&t.setTransform(o.scale,0,0,o.scale,0,0);o.strokeColor&&t.strokeText(e,r,n);o.fillColor&&t.fillText(e,r,n)})&&(t.width[e]=r)}};ol.render.webgl.TextReplay.prototype.finish=function(e){var t=e.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices=this.groupIndices;this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.createTextures(this.textures_,this.images_,{},t);this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.offsetY_=this.offsetX_=this.textBaseline_=this.textAlign_=void 0;this.images_=null;this.atlases_={};this.currAtlas_=void 0;ol.render.webgl.TextureReplay.prototype.finish.call(this,e)};ol.render.webgl.TextReplay.prototype.setTextStyle=function(e){var t=this.state_,o=e.getFill(),r=e.getStroke();e&&e.getText()&&(o||r)?(o?(o=o.getColor(),t.fillColor=ol.colorlike.asColorLike(o||ol.render.webgl.defaultFillStyle)):t.fillColor=null,r?(o=r.getColor(),t.strokeColor=ol.colorlike.asColorLike(o||ol.render.webgl.defaultStrokeStyle),t.lineWidth=r.getWidth()||ol.render.webgl.defaultLineWidth,t.lineCap=r.getLineCap()||ol.render.webgl.defaultLineCap,t.lineDashOffset=r.getLineDashOffset()||ol.render.webgl.defaultLineDashOffset,t.lineJoin=r.getLineJoin()||ol.render.webgl.defaultLineJoin,t.miterLimit=r.getMiterLimit()||ol.render.webgl.defaultMiterLimit,r=r.getLineDash(),t.lineDash=r?r.slice():ol.render.webgl.defaultLineDash):(t.strokeColor=null,t.lineWidth=0),t.font=e.getFont()||ol.render.webgl.defaultFont,t.scale=e.getScale()||1,this.text_=e.getText(),r=ol.render.replay.TEXT_ALIGN[e.getTextAlign()],o=ol.render.replay.TEXT_ALIGN[e.getTextBaseline()],this.textAlign_=void 0===r?ol.render.webgl.defaultTextAlign:r,this.textBaseline_=void 0===o?ol.render.webgl.defaultTextBaseline:o,this.offsetX_=e.getOffsetX()||0,this.offsetY_=e.getOffsetY()||0,this.rotateWithView=!!e.getRotateWithView(),this.rotation=e.getRotation()||0,this.currAtlas_=this.getAtlas_(t)):this.text_=""};ol.render.webgl.TextReplay.prototype.getAtlas_=function(e){var t=[];for(o in e)(e[o]||0===e[o])&&(Array.isArray(e[o])?t=t.concat(e[o]):t.push(e[o]));t=this.calculateHash_(t);if(!this.atlases_[t]){var o=this.measureCanvas_.getContext("2d");o.font=e.font;o=Math.ceil((1.5*o.measureText("M").width+e.lineWidth/2)*e.scale);this.atlases_[t]={atlas:new ol.style.AtlasManager({space:e.lineWidth+1}),width:{},height:o}}return this.atlases_[t]};ol.render.webgl.TextReplay.prototype.calculateHash_=function(e){var t,o="",r=0;for(t=e.length;r<t;++r)o+=e[r];return o};ol.render.webgl.TextReplay.prototype.getTextures=function(e){return this.textures_};ol.render.webgl.TextReplay.prototype.getHitDetectionTextures=function(){return this.textures_};ol.render.webgl.ReplayGroup=function(e,t,o){ol.render.ReplayGroup.call(this);this.maxExtent_=t;this.tolerance_=e;this.renderBuffer_=o;this.replaysByZIndex_={}};ol.inherits(ol.render.webgl.ReplayGroup,ol.render.ReplayGroup);ol.render.webgl.ReplayGroup.prototype.addDeclutter=function(e,t){};ol.render.webgl.ReplayGroup.prototype.getDeleteResourcesFunction=function(e){var t,o=[];for(t in this.replaysByZIndex_){var r,n=this.replaysByZIndex_[t];for(r in n)o.push(n[r].getDeleteResourcesFunction(e))}return function(){for(var e,t=o.length,r=0;r<t;r++)e=o[r].apply(this,arguments);return e}};ol.render.webgl.ReplayGroup.prototype.finish=function(e){for(var t in this.replaysByZIndex_){var o,r=this.replaysByZIndex_[t];for(o in r)r[o].finish(e)}};ol.render.webgl.ReplayGroup.prototype.getReplay=function(e,t){var o=void 0!==e?e.toString():"0";void 0===(e=this.replaysByZIndex_[o])&&(e={},this.replaysByZIndex_[o]=e);void 0===(o=e[t])&&(o=new ol.render.webgl.ReplayGroup.BATCH_CONSTRUCTORS_[t](this.tolerance_,this.maxExtent_),e[t]=o);return o};ol.render.webgl.ReplayGroup.prototype.isEmpty=function(){return ol.obj.isEmpty(this.replaysByZIndex_)};ol.render.webgl.ReplayGroup.prototype.replay=function(e,t,o,r,n,i,a,s){var l,c,u=Object.keys(this.replaysByZIndex_).map(Number);u.sort(ol.array.numberSafeCompareFunction);var h=0;for(l=u.length;h<l;++h){var d=this.replaysByZIndex_[u[h].toString()],p=0;for(c=ol.render.replay.ORDER.length;p<c;++p){var f=d[ol.render.replay.ORDER[p]];void 0!==f&&f.replay(e,t,o,r,n,i,a,s,void 0,!1)}}};ol.render.webgl.ReplayGroup.prototype.replayHitDetection_=function(e,t,o,r,n,i,a,s,l,c,u){var h,d,p=Object.keys(this.replaysByZIndex_).map(Number);p.sort(function(e,t){return t-e});var f=0;for(h=p.length;f<h;++f){var g=this.replaysByZIndex_[p[f].toString()];for(d=ol.render.replay.ORDER.length-1;0<=d;--d){var m=g[ol.render.replay.ORDER[d]];if(void 0!==m&&(m=m.replay(e,t,o,r,n,i,a,s,l,c,u)))return m}}};ol.render.webgl.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,i,a,s,l,c){var u,h=t.getGL();h.bindFramebuffer(h.FRAMEBUFFER,t.getHitDetectionFramebuffer());void 0!==this.renderBuffer_&&(u=ol.extent.buffer(ol.extent.createOrUpdateFromCoordinate(e),r*this.renderBuffer_));return this.replayHitDetection_(t,e,r,n,ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_,a,s,l,function(e){var t=new Uint8Array(4);h.readPixels(0,0,1,1,h.RGBA,h.UNSIGNED_BYTE,t);if(0<t[3]&&(e=c(e)))return e},!0,u)};ol.render.webgl.ReplayGroup.prototype.hasFeatureAtCoordinate=function(e,t,o,r,n,i,a,s,l){var c=t.getGL();c.bindFramebuffer(c.FRAMEBUFFER,t.getHitDetectionFramebuffer());return void 0!==this.replayHitDetection_(t,e,r,n,ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_,a,s,l,function(e){e=new Uint8Array(4);c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,e);return 0<e[3]},!1)};ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_=[1,1];ol.render.webgl.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:ol.render.webgl.CircleReplay,Image:ol.render.webgl.ImageReplay,LineString:ol.render.webgl.LineStringReplay,Polygon:ol.render.webgl.PolygonReplay,Text:ol.render.webgl.TextReplay};ol.render.webgl.Immediate=function(e,t,o,r,n,i,a){ol.render.VectorContext.call(this);this.context_=e;this.center_=t;this.extent_=i;this.pixelRatio_=a;this.size_=n;this.rotation_=r;this.resolution_=o;this.textStyle_=this.strokeStyle_=this.fillStyle_=this.imageStyle_=null};ol.inherits(ol.render.webgl.Immediate,ol.render.VectorContext);ol.render.webgl.Immediate.prototype.drawText_=function(e,t){var o=this.context_;(e=e.getReplay(0,ol.render.ReplayType.TEXT)).setTextStyle(this.textStyle_);e.drawText(t,null);e.finish(o);e.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);e.getDeleteResourcesFunction(o)()};ol.render.webgl.Immediate.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke());this.setImageStyle(e.getImage());this.setTextStyle(e.getText())};ol.render.webgl.Immediate.prototype.drawGeometry=function(e){switch(e.getType()){case ol.geom.GeometryType.POINT:this.drawPoint(e,null);break;case ol.geom.GeometryType.LINE_STRING:this.drawLineString(e,null);break;case ol.geom.GeometryType.POLYGON:this.drawPolygon(e,null);break;case ol.geom.GeometryType.MULTI_POINT:this.drawMultiPoint(e,null);break;case ol.geom.GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(e,null);break;case ol.geom.GeometryType.MULTI_POLYGON:this.drawMultiPolygon(e,null);break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(e,null);break;case ol.geom.GeometryType.CIRCLE:this.drawCircle(e,null)}};ol.render.webgl.Immediate.prototype.drawFeature=function(e,t){(e=t.getGeometryFunction()(e))&&ol.extent.intersects(this.extent_,e.getExtent())&&(this.setStyle(t),this.drawGeometry(e))};ol.render.webgl.Immediate.prototype.drawGeometryCollection=function(e,t){e=e.getGeometriesArray();var o;t=0;for(o=e.length;t<o;++t)this.drawGeometry(e[t])};ol.render.webgl.Immediate.prototype.drawPoint=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.IMAGE);n.setImageStyle(this.imageStyle_);n.drawPoint(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiPoint=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.IMAGE);n.setImageStyle(this.imageStyle_);n.drawMultiPoint(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawLineString=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.LINE_STRING);n.setFillStrokeStyle(null,this.strokeStyle_);n.drawLineString(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiLineString=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.LINE_STRING);n.setFillStrokeStyle(null,this.strokeStyle_);n.drawMultiLineString(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawPolygon=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.POLYGON);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);n.drawPolygon(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiPolygon=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.POLYGON);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);n.drawMultiPolygon(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawCircle=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),n=r.getReplay(0,ol.render.ReplayType.CIRCLE);n.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);n.drawCircle(e,t);n.finish(o);n.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);n.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.setImageStyle=function(e){this.imageStyle_=e};ol.render.webgl.Immediate.prototype.setFillStrokeStyle=function(e,t){this.fillStyle_=e;this.strokeStyle_=t};ol.render.webgl.Immediate.prototype.setTextStyle=function(e){this.textStyle_=e};ol.renderer.webgl={};ol.renderer.webgl.defaultmapshader={};ol.renderer.webgl.defaultmapshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n":"precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}");ol.renderer.webgl.defaultmapshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}");ol.renderer.webgl.defaultmapshader.Locations=function(e,t){this.u_texCoordMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texCoordMatrix":"d");this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"e");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"f");this.u_texture=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texture":"g");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"b");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"c")};ol.renderer.webgl.Layer=function(e,t){ol.renderer.Layer.call(this,t);this.mapRenderer=e;this.arrayBuffer_=new ol.webgl.Buffer([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.framebuffer=this.texture=null;this.framebufferDimension=void 0;this.texCoordMatrix=ol.transform.create();this.projectionMatrix=ol.transform.create();this.tmpMat4_=ol.vec.Mat4.create();this.defaultLocations_=null};ol.inherits(ol.renderer.webgl.Layer,ol.renderer.Layer);ol.renderer.webgl.Layer.prototype.bindFramebuffer=function(e,t){var o=this.mapRenderer.getGL();if(void 0===this.framebufferDimension||this.framebufferDimension!=t){var r=function(e,t,o){e.isContextLost()||(e.deleteFramebuffer(t),e.deleteTexture(o))}.bind(null,o,this.framebuffer,this.texture);e.postRenderFunctions.push(r);e=ol.webgl.Context.createEmptyTexture(o,t,t);r=o.createFramebuffer();o.bindFramebuffer(ol.webgl.FRAMEBUFFER,r);o.framebufferTexture2D(ol.webgl.FRAMEBUFFER,ol.webgl.COLOR_ATTACHMENT0,ol.webgl.TEXTURE_2D,e,0);this.texture=e;this.framebuffer=r;this.framebufferDimension=t}else o.bindFramebuffer(ol.webgl.FRAMEBUFFER,this.framebuffer)};ol.renderer.webgl.Layer.prototype.composeFrame=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,o,e);o.bindBuffer(ol.webgl.ARRAY_BUFFER,this.arrayBuffer_);var r=o.getGL(),n=o.getProgram(ol.renderer.webgl.defaultmapshader.fragment,ol.renderer.webgl.defaultmapshader.vertex);if(this.defaultLocations_)var i=this.defaultLocations_;else this.defaultLocations_=i=new ol.renderer.webgl.defaultmapshader.Locations(r,n);o.useProgram(n)&&(r.enableVertexAttribArray(i.a_position),r.vertexAttribPointer(i.a_position,2,ol.webgl.FLOAT,!1,16,0),r.enableVertexAttribArray(i.a_texCoord),r.vertexAttribPointer(i.a_texCoord,2,ol.webgl.FLOAT,!1,16,8),r.uniform1i(i.u_texture,0));r.uniformMatrix4fv(i.u_texCoordMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,this.getTexCoordMatrix()));r.uniformMatrix4fv(i.u_projectionMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,this.getProjectionMatrix()));r.uniform1f(i.u_opacity,t.opacity);r.bindTexture(ol.webgl.TEXTURE_2D,this.getTexture());r.drawArrays(ol.webgl.TRIANGLE_STRIP,0,4);this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,o,e)};ol.renderer.webgl.Layer.prototype.dispatchComposeEvent_=function(e,t,o){var r=this.getLayer();if(r.hasListener(e)){var n=o.viewState;n=new ol.render.webgl.Immediate(t,n.center,n.resolution,n.rotation,o.size,o.extent,o.pixelRatio);e=new ol.render.Event(e,n,o,null,t);r.dispatchEvent(e)}};ol.renderer.webgl.Layer.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix};ol.renderer.webgl.Layer.prototype.getTexture=function(){return this.texture};ol.renderer.webgl.Layer.prototype.getProjectionMatrix=function(){return this.projectionMatrix};ol.renderer.webgl.Layer.prototype.handleWebGLContextLost=function(){this.framebuffer=this.texture=null;this.framebufferDimension=void 0};ol.renderer.webgl.Layer.prototype.prepareFrame=function(e,t,o){};ol.renderer.webgl.Layer.prototype.forEachLayerAtPixel=function(e,t,o,r){};ol.renderer.webgl.ImageLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.hitTransformationMatrix_=this.hitCanvasContext_=this.image_=null};ol.inherits(ol.renderer.webgl.ImageLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.ImageLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.IMAGE};ol.renderer.webgl.ImageLayer.create=function(e,t){return new ol.renderer.webgl.ImageLayer(e,t)};ol.renderer.webgl.ImageLayer.prototype.createTexture_=function(e){e=e.getImage();var t=this.mapRenderer.getGL();return ol.webgl.Context.createTexture(t,e,ol.webgl.CLAMP_TO_EDGE,ol.webgl.CLAMP_TO_EDGE)};ol.renderer.webgl.ImageLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){var i=this.getLayer();return i.getSource().forEachFeatureAtCoordinate(e,t.viewState.resolution,t.viewState.rotation,o,t.skippedFeatureUids,function(e){return r.call(n,e,i)})};ol.renderer.webgl.ImageLayer.prototype.prepareFrame=function(e,t,o){var r=this.mapRenderer.getGL(),n=e.pixelRatio,i=e.viewState,a=i.center,s=i.resolution,l=i.rotation;o=this.image_;var c=this.texture,u=this.getLayer().getSource(),h=e.viewHints,d=e.extent;void 0!==t.extent&&(d=ol.extent.getIntersection(d,t.extent));h[ol.ViewHint.ANIMATING]||h[ol.ViewHint.INTERACTING]||ol.extent.isEmpty(d)||(t=i.projection,ol.ENABLE_RASTER_REPROJECTION||(i=u.getProjection())&&(t=i),(d=u.getImage(d,s,n,t))&&this.loadImage(d)&&(o=d,c=this.createTexture_(d),this.texture&&(r=function(e,t){e.isContextLost()||e.deleteTexture(t)}.bind(null,r,this.texture),e.postRenderFunctions.push(r))));o&&(r=this.mapRenderer.getContext().getCanvas(),this.updateProjectionMatrix_(r.width,r.height,n,a,s,l,o.getExtent()),this.hitTransformationMatrix_=null,n=this.texCoordMatrix,ol.transform.reset(n),ol.transform.scale(n,1,-1),ol.transform.translate(n,0,-1),this.image_=o,this.texture=c,this.updateLogos(e,u));return!!o};ol.renderer.webgl.ImageLayer.prototype.updateProjectionMatrix_=function(e,t,o,r,n,i,a){e*=n;t*=n;n=this.projectionMatrix;ol.transform.reset(n);ol.transform.scale(n,2*o/e,2*o/t);ol.transform.rotate(n,-i);ol.transform.translate(n,a[0]-r[0],a[1]-r[1]);ol.transform.scale(n,(a[2]-a[0])/2,(a[3]-a[1])/2);ol.transform.translate(n,1,1)};ol.renderer.webgl.ImageLayer.prototype.hasFeatureAtCoordinate=function(e,t){return void 0!==this.forEachFeatureAtCoordinate(e,t,0,ol.functions.TRUE,this)};ol.renderer.webgl.ImageLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.image_&&this.image_.getImage())if(this.getLayer().getSource().forEachFeatureAtCoordinate!==ol.nullFunction){var n=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());if(this.forEachFeatureAtCoordinate(n,t,0,ol.functions.TRUE,this))return o.call(r,this.getLayer(),null)}else if(n=[this.image_.getImage().width,this.image_.getImage().height],this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(t.size,n)),!(0>(t=ol.transform.apply(this.hitTransformationMatrix_,e.slice()))[0]||t[0]>n[0]||0>t[1]||t[1]>n[1])&&(this.hitCanvasContext_||(this.hitCanvasContext_=ol.dom.createCanvasContext2D(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.image_.getImage(),t[0],t[1],1,1,0,0,1,1),0<(t=this.hitCanvasContext_.getImageData(0,0,1,1).data)[3]))return o.call(r,this.getLayer(),t)};ol.renderer.webgl.ImageLayer.prototype.getHitTransformationMatrix_=function(e,t){var o=ol.transform.create();ol.transform.translate(o,-1,-1);ol.transform.scale(o,2/e[0],2/e[1]);ol.transform.translate(o,0,e[1]);ol.transform.scale(o,1,-1);e=ol.transform.invert(this.projectionMatrix.slice());var r=ol.transform.create();ol.transform.translate(r,0,t[1]);ol.transform.scale(r,1,-1);ol.transform.scale(r,t[0]/2,t[1]/2);ol.transform.translate(r,1,1);ol.transform.multiply(r,e);ol.transform.multiply(r,o);return r};ol.renderer.webgl.Map=function(e,t){ol.renderer.Map.call(this,e,t);this.canvas_=document.createElement("CANVAS");this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ol.css.CLASS_UNSELECTABLE;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.clipTileCanvasHeight_=this.clipTileCanvasWidth_=0;this.clipTileContext_=ol.dom.createCanvasContext2D();this.renderedVisible_=!0;this.gl_=ol.webgl.getContext(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.context_=new ol.webgl.Context(this.canvas_,this.gl_);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.LOST,this.handleWebGLContextLost,this);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.RESTORED,this.handleWebGLContextRestored,this);this.textureCache_=new ol.structs.LRUCache;this.focus_=null;this.tileTextureQueue_=new ol.structs.PriorityQueue(function(e){var t=e[1];e=e[2];var o=t[0]-this.focus_[0];t=t[1]-this.focus_[1];return 65536*Math.log(e)+Math.sqrt(o*o+t*t)/e}.bind(this),function(e){return e[0].getKey()});this.loadNextTileTexture_=function(e,t){this.tileTextureQueue_.isEmpty()||(this.tileTextureQueue_.reprioritize(),e=this.tileTextureQueue_.dequeue(),this.bindTileTexture(e[0],e[3],e[4],ol.webgl.LINEAR,ol.webgl.LINEAR));return!1}.bind(this);this.textureCacheFrameMarkerCount_=0;this.initializeGL_()};ol.inherits(ol.renderer.webgl.Map,ol.renderer.Map);ol.renderer.webgl.Map.handles=function(e){return ol.has.WEBGL&&e===ol.renderer.Type.WEBGL};ol.renderer.webgl.Map.create=function(e,t){return new ol.renderer.webgl.Map(e,t)};ol.renderer.webgl.Map.prototype.bindTileTexture=function(e,t,o,r,n){var i=this.getGL(),a=e.getKey();if(this.textureCache_.containsKey(a))e=this.textureCache_.get(a),i.bindTexture(ol.webgl.TEXTURE_2D,e.texture),e.magFilter!=r&&(i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MAG_FILTER,r),e.magFilter=r),e.minFilter!=n&&(i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MIN_FILTER,n),e.minFilter=n);else{var s=i.createTexture();i.bindTexture(ol.webgl.TEXTURE_2D,s);if(0<o){var l=this.clipTileContext_.canvas,c=this.clipTileContext_;this.clipTileCanvasWidth_!==t[0]||this.clipTileCanvasHeight_!==t[1]?(l.width=t[0],l.height=t[1],this.clipTileCanvasWidth_=t[0],this.clipTileCanvasHeight_=t[1]):c.clearRect(0,0,t[0],t[1]);c.drawImage(e.getImage(),o,o,t[0],t[1],0,0,t[0],t[1]);i.texImage2D(ol.webgl.TEXTURE_2D,0,ol.webgl.RGBA,ol.webgl.RGBA,ol.webgl.UNSIGNED_BYTE,l)}else i.texImage2D(ol.webgl.TEXTURE_2D,0,ol.webgl.RGBA,ol.webgl.RGBA,ol.webgl.UNSIGNED_BYTE,e.getImage());i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MAG_FILTER,r);i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MIN_FILTER,n);i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_S,ol.webgl.CLAMP_TO_EDGE);i.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_T,ol.webgl.CLAMP_TO_EDGE);this.textureCache_.set(a,{texture:s,magFilter:r,minFilter:n})}};ol.renderer.webgl.Map.prototype.dispatchComposeEvent_=function(e,t){var o=this.getMap();if(o.hasListener(e)){var r=this.context_,n=t.viewState;n=new ol.render.webgl.Immediate(r,n.center,n.resolution,n.rotation,t.size,t.extent,t.pixelRatio);e=new ol.render.Event(e,n,t,null,r);o.dispatchEvent(e)}};ol.renderer.webgl.Map.prototype.disposeInternal=function(){var e=this.getGL();e.isContextLost()||this.textureCache_.forEach(function(t){t&&e.deleteTexture(t.texture)});this.context_.dispose();ol.renderer.Map.prototype.disposeInternal.call(this)};ol.renderer.webgl.Map.prototype.expireCache_=function(e,t){e=this.getGL();for(var o;this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>ol.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK;){if(o=this.textureCache_.peekLast())e.deleteTexture(o.texture);else{if(+this.textureCache_.peekLastKey()==t.index)break;--this.textureCacheFrameMarkerCount_}this.textureCache_.pop()}};ol.renderer.webgl.Map.prototype.getContext=function(){return this.context_};ol.renderer.webgl.Map.prototype.getGL=function(){return this.gl_};ol.renderer.webgl.Map.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_};ol.renderer.webgl.Map.prototype.getType=function(){return ol.renderer.Type.WEBGL};ol.renderer.webgl.Map.prototype.handleWebGLContextLost=function(e){e.preventDefault();this.textureCache_.clear();this.textureCacheFrameMarkerCount_=0;e=this.getLayerRenderers();for(var t in e)e[t].handleWebGLContextLost()};ol.renderer.webgl.Map.prototype.handleWebGLContextRestored=function(){this.initializeGL_();this.getMap().render()};ol.renderer.webgl.Map.prototype.initializeGL_=function(){var e=this.gl_;e.activeTexture(ol.webgl.TEXTURE0);e.blendFuncSeparate(ol.webgl.SRC_ALPHA,ol.webgl.ONE_MINUS_SRC_ALPHA,ol.webgl.ONE,ol.webgl.ONE_MINUS_SRC_ALPHA);e.disable(ol.webgl.CULL_FACE);e.disable(ol.webgl.DEPTH_TEST);e.disable(ol.webgl.SCISSOR_TEST);e.disable(ol.webgl.STENCIL_TEST)};ol.renderer.webgl.Map.prototype.isTileTextureLoaded=function(e){return this.textureCache_.containsKey(e.getKey())};ol.renderer.webgl.Map.prototype.renderFrame=function(e){var t=this.getContext(),o=this.getGL();if(o.isContextLost())return!1;if(!e)return this.renderedVisible_&&(this.canvas_.style.display="none",this.renderedVisible_=!1),!1;this.focus_=e.focus;this.textureCache_.set((-e.index).toString(),null);++this.textureCacheFrameMarkerCount_;this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e);var r=[],n=e.layerStatesArray;ol.array.stableSort(n,ol.renderer.Map.sortByZIndex);var i,a=e.viewState.resolution,s=0;for(i=n.length;s<i;++s){var l=n[s];if(ol.layer.Layer.visibleAtResolution(l,a)&&l.sourceState==ol.source.State.READY){var c=this.getLayerRenderer(l.layer);c.prepareFrame(e,l,t)&&r.push(l)}}n=e.size[0]*e.pixelRatio;a=e.size[1]*e.pixelRatio;this.canvas_.width==n&&this.canvas_.height==a||(this.canvas_.width=n,this.canvas_.height=a);o.bindFramebuffer(ol.webgl.FRAMEBUFFER,null);o.clearColor(0,0,0,0);o.clear(ol.webgl.COLOR_BUFFER_BIT);o.enable(ol.webgl.BLEND);o.viewport(0,0,this.canvas_.width,this.canvas_.height);s=0;for(i=r.length;s<i;++s)l=r[s],(c=this.getLayerRenderer(l.layer)).composeFrame(e,l,t);this.renderedVisible_||(this.canvas_.style.display="",this.renderedVisible_=!0);this.calculateMatrices2D(e);this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>ol.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK&&e.postRenderFunctions.push(this.expireCache_.bind(this));this.tileTextureQueue_.isEmpty()||(e.postRenderFunctions.push(this.loadNextTileTexture_),e.animate=!0);this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e);this.scheduleRemoveUnusedLayerRenderers(e);this.scheduleExpireIconCache(e)};ol.renderer.webgl.Map.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,i,a){if(this.getGL().isContextLost())return!1;var s,l=t.viewState,c=t.layerStatesArray;for(s=c.length-1;0<=s;--s){var u=c[s],h=u.layer;if(ol.layer.Layer.visibleAtResolution(u,l.resolution)&&i.call(a,h)&&(u=this.getLayerRenderer(h).forEachFeatureAtCoordinate(e,t,o,r,n)))return u}};ol.renderer.webgl.Map.prototype.hasFeatureAtCoordinate=function(e,t,o,r,n){o=!1;if(this.getGL().isContextLost())return!1;var i,a=t.viewState,s=t.layerStatesArray;for(i=s.length-1;0<=i;--i){var l=s[i],c=l.layer;if(ol.layer.Layer.visibleAtResolution(l,a.resolution)&&r.call(n,c)&&(o=this.getLayerRenderer(c).hasFeatureAtCoordinate(e,t)))return!0}return o};ol.renderer.webgl.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,n,i){if(this.getGL().isContextLost())return!1;i=t.viewState;var a,s=t.layerStatesArray;for(a=s.length-1;0<=a;--a){var l=s[a],c=l.layer;if(ol.layer.Layer.visibleAtResolution(l,i.resolution)&&n.call(r,c)&&(l=this.getLayerRenderer(c).forEachLayerAtPixel(e,t,o,r)))return l}};ol.renderer.webgl.tilelayershader={};ol.renderer.webgl.tilelayershader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n":"precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}");ol.renderer.webgl.tilelayershader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}");ol.renderer.webgl.tilelayershader.Locations=function(e,t){this.u_tileOffset=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_tileOffset":"d");this.u_texture=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texture":"e");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"b");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"c")};ol.renderer.webgl.TileLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.fragmentShader_=ol.renderer.webgl.tilelayershader.fragment;this.vertexShader_=ol.renderer.webgl.tilelayershader.vertex;this.locations_=null;this.renderArrayBuffer_=new ol.webgl.Buffer([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.renderedFramebufferExtent_=this.renderedTileRange_=null;this.renderedRevision_=-1;this.tmpSize_=[0,0]};ol.inherits(ol.renderer.webgl.TileLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.TileLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.TILE};ol.renderer.webgl.TileLayer.create=function(e,t){return new ol.renderer.webgl.TileLayer(e,t)};ol.renderer.webgl.TileLayer.prototype.disposeInternal=function(){this.mapRenderer.getContext().deleteBuffer(this.renderArrayBuffer_);ol.renderer.webgl.Layer.prototype.disposeInternal.call(this)};ol.renderer.webgl.TileLayer.prototype.createLoadedTileFinder=function(e,t,o){var r=this.mapRenderer;return function(n,i){return e.forEachLoadedTile(t,n,i,function(e){var t=r.isTileTextureLoaded(e);t&&(o[n]||(o[n]={}),o[n][e.tileCoord.toString()]=e);return t})}};ol.renderer.webgl.TileLayer.prototype.handleWebGLContextLost=function(){ol.renderer.webgl.Layer.prototype.handleWebGLContextLost.call(this);this.locations_=null};ol.renderer.webgl.TileLayer.prototype.prepareFrame=function(e,t,o){var r=this.mapRenderer,n=o.getGL(),i=e.viewState,a=i.projection,s=this.getLayer(),l=s.getSource(),c=l.getTileGridForProjection(a),u=c.getZForResolution(i.resolution),h=c.getResolution(u),d=l.getTilePixelSize(u,e.pixelRatio,a),p=d[0]/ol.size.toSize(c.getTileSize(u),this.tmpSize_)[0],f=h/p,g=l.getTilePixelRatio(p)*l.getGutter(a),m=i.center,y=e.extent,C=c.getTileRangeForExtentAndZ(y,u);if(this.renderedTileRange_&&this.renderedTileRange_.equals(C)&&this.renderedRevision_==l.getRevision())f=this.renderedFramebufferExtent_;else{var v=C.getSize(),T=ol.math.roundUpToPowerOfTwo(Math.max(v[0]*d[0],v[1]*d[1]));v=f*T;var _=c.getOrigin(u),S=_[0]+C.minX*d[0]*f;f=[S,f=_[1]+C.minY*d[1]*f,S+v,f+v];this.bindFramebuffer(e,T);n.viewport(0,0,T,T);n.clearColor(0,0,0,0);n.clear(ol.webgl.COLOR_BUFFER_BIT);n.disable(ol.webgl.BLEND);T=o.getProgram(this.fragmentShader_,this.vertexShader_);o.useProgram(T);this.locations_||(this.locations_=new ol.renderer.webgl.tilelayershader.Locations(n,T));o.bindBuffer(ol.webgl.ARRAY_BUFFER,this.renderArrayBuffer_);n.enableVertexAttribArray(this.locations_.a_position);n.vertexAttribPointer(this.locations_.a_position,2,ol.webgl.FLOAT,!1,16,0);n.enableVertexAttribArray(this.locations_.a_texCoord);n.vertexAttribPointer(this.locations_.a_texCoord,2,ol.webgl.FLOAT,!1,16,8);n.uniform1i(this.locations_.u_texture,0);(o={})[u]={};var E=this.createLoadedTileFinder(l,a,o),L=s.getUseInterimTilesOnError();T=!0;S=ol.extent.createEmpty();var w,b,x,A=new ol.TileRange(0,0,0,0);for(w=C.minX;w<=C.maxX;++w)for(b=C.minY;b<=C.maxY;++b){_=l.getTile(u,w,b,p,a);if(void 0!==t.extent){var P=c.getTileCoordExtent(_.tileCoord,S);if(!ol.extent.intersects(P,t.extent))continue}(P=(P=_.getState())==ol.TileState.LOADED||P==ol.TileState.EMPTY||P==ol.TileState.ERROR&&!L)||(_=_.getInterimTile());if((P=_.getState())==ol.TileState.LOADED){if(r.isTileTextureLoaded(_)){o[u][_.tileCoord.toString()]=_;continue}}else if(P==ol.TileState.EMPTY||P==ol.TileState.ERROR&&!L)continue;T=!1;(P=c.forEachTileCoordParentTileRange(_.tileCoord,E,null,A,S))||(_=c.getTileCoordChildTileRange(_.tileCoord,A,S))&&E(u+1,_)}(t=Object.keys(o).map(Number)).sort(ol.array.numberSafeCompareFunction);E=new Float32Array(4);L=0;for(A=t.length;L<A;++L)for(x in w=o[t[L]])_=w[x],P=c.getTileCoordExtent(_.tileCoord,S),E[0]=2*(P[2]-P[0])/v,E[1]=2*(P[3]-P[1])/v,E[2]=2*(P[0]-f[0])/v-1,E[3]=2*(P[1]-f[1])/v-1,n.uniform4fv(this.locations_.u_tileOffset,E),r.bindTileTexture(_,d,g*p,ol.webgl.LINEAR,ol.webgl.LINEAR),n.drawArrays(ol.webgl.TRIANGLE_STRIP,0,4);T?(this.renderedTileRange_=C,this.renderedFramebufferExtent_=f,this.renderedRevision_=l.getRevision()):(this.renderedFramebufferExtent_=this.renderedTileRange_=null,this.renderedRevision_=-1,e.animate=!0)}this.updateUsedTiles(e.usedTiles,l,u,C);var R=r.getTileTextureQueue();this.manageTilePyramid(e,l,c,p,a,y,u,s.getPreload(),function(e){e.getState()!=ol.TileState.LOADED||r.isTileTextureLoaded(e)||R.isKeyQueued(e.getKey())||R.enqueue([e,c.getTileCoordCenter(e.tileCoord),c.getResolution(e.tileCoord[0]),d,g*p])},this);this.scheduleExpireCache(e,l);this.updateLogos(e,l);n=this.texCoordMatrix;ol.transform.reset(n);ol.transform.translate(n,(Math.round(m[0]/h)*h-f[0])/(f[2]-f[0]),(Math.round(m[1]/h)*h-f[1])/(f[3]-f[1]));0!==i.rotation&&ol.transform.rotate(n,i.rotation);ol.transform.scale(n,e.size[0]*i.resolution/(f[2]-f[0]),e.size[1]*i.resolution/(f[3]-f[1]));ol.transform.translate(n,-.5,-.5);return!0};ol.renderer.webgl.TileLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.framebuffer){e=[(e=ol.transform.apply(this.texCoordMatrix,[e[0]/t.size[0],(t.size[1]-e[1])/t.size[1]].slice()))[0]*this.framebufferDimension,e[1]*this.framebufferDimension];(t=this.mapRenderer.getContext().getGL()).bindFramebuffer(t.FRAMEBUFFER,this.framebuffer);var n=new Uint8Array(4);t.readPixels(e[0],e[1],1,1,t.RGBA,t.UNSIGNED_BYTE,n);if(0<n[3])return o.call(r,this.getLayer(),n)}};ol.renderer.webgl.VectorLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=ol.extent.createEmpty();this.layerState_=this.replayGroup_=this.renderedRenderOrder_=null};ol.inherits(ol.renderer.webgl.VectorLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.VectorLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.VECTOR};ol.renderer.webgl.VectorLayer.create=function(e,t){return new ol.renderer.webgl.VectorLayer(e,t)};ol.renderer.webgl.VectorLayer.prototype.composeFrame=function(e,t,o){this.layerState_=t;var r=e.viewState,n=this.replayGroup_,i=e.size,a=e.pixelRatio,s=this.mapRenderer.getGL();n&&!n.isEmpty()&&(s.enable(s.SCISSOR_TEST),s.scissor(0,0,i[0]*a,i[1]*a),n.replay(o,r.center,r.resolution,r.rotation,i,a,t.opacity,t.managed?e.skippedFeatureUids:{}),s.disable(s.SCISSOR_TEST))};ol.renderer.webgl.VectorLayer.prototype.disposeInternal=function(){var e=this.replayGroup_;if(e){var t=this.mapRenderer.getContext();e.getDeleteResourcesFunction(t)();this.replayGroup_=null}ol.renderer.webgl.Layer.prototype.disposeInternal.call(this)};ol.renderer.webgl.VectorLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n){if(this.replayGroup_&&this.layerState_){o=this.mapRenderer.getContext();var i=t.viewState,a=this.getLayer(),s={};return this.replayGroup_.forEachFeatureAtCoordinate(e,o,i.center,i.resolution,i.rotation,t.size,t.pixelRatio,this.layerState_.opacity,{},function(e){var t=ol.getUid(e).toString();if(!(t in s))return s[t]=!0,r.call(n,e,a)})}};ol.renderer.webgl.VectorLayer.prototype.hasFeatureAtCoordinate=function(e,t){if(this.replayGroup_&&this.layerState_){var o=this.mapRenderer.getContext(),r=t.viewState;return this.replayGroup_.hasFeatureAtCoordinate(e,o,r.center,r.resolution,r.rotation,t.size,t.pixelRatio,this.layerState_.opacity,t.skippedFeatureUids)}return!1};ol.renderer.webgl.VectorLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){e=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());if(this.hasFeatureAtCoordinate(e,t))return o.call(r,this.getLayer(),null)};ol.renderer.webgl.VectorLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.webgl.VectorLayer.prototype.prepareFrame=function(e,t,o){var r=this.getLayer();t=r.getSource();this.updateLogos(e,t);var n=e.viewHints[ol.ViewHint.ANIMATING],i=e.viewHints[ol.ViewHint.INTERACTING],a=r.getUpdateWhileAnimating(),s=r.getUpdateWhileInteracting();if(!this.dirty_&&!a&&n||!s&&i)return!0;s=e.extent;n=(i=e.viewState).projection;var l=i.resolution,c=e.pixelRatio;i=r.getRevision();var u=r.getRenderBuffer();void 0===(a=r.getRenderOrder())&&(a=ol.renderer.vector.defaultOrder);s=ol.extent.buffer(s,u*l);if(!this.dirty_&&this.renderedResolution_==l&&this.renderedRevision_==i&&this.renderedRenderOrder_==a&&ol.extent.containsExtent(this.renderedExtent_,s))return!0;this.replayGroup_&&e.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(o));this.dirty_=!1;var h=new ol.render.webgl.ReplayGroup(ol.renderer.vector.getTolerance(l,c),s,r.getRenderBuffer());t.loadFeatures(s,l,n);e=function(e){var t=e.getStyleFunction();if(t)var o=t.call(e,l);else(t=r.getStyleFunction())&&(o=t(e,l));o&&(e=this.renderFeature(e,l,c,o,h),this.dirty_=this.dirty_||e)};if(a){var d=[];t.forEachFeatureInExtent(s,function(e){d.push(e)},this);d.sort(a);d.forEach(e,this)}else t.forEachFeatureInExtent(s,e,this);h.finish(o);this.renderedResolution_=l;this.renderedRevision_=i;this.renderedRenderOrder_=a;this.renderedExtent_=s;this.replayGroup_=h;return!0};ol.renderer.webgl.VectorLayer.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;var i=!1;if(Array.isArray(r))for(var a=r.length-1;0<=a;--a)i=ol.renderer.vector.renderFeature(n,e,r[a],ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||i;else i=ol.renderer.vector.renderFeature(n,e,r,ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||i;return i};ol.ENABLE_CANVAS&&(ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.canvas.Map),ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.canvas.ImageLayer,ol.renderer.canvas.TileLayer,ol.renderer.canvas.VectorLayer,ol.renderer.canvas.VectorTileLayer]));ol.ENABLE_WEBGL&&(ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.webgl.Map),ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.webgl.ImageLayer,ol.renderer.webgl.TileLayer,ol.renderer.webgl.VectorLayer]));ol.Map=function(e){(e=ol.obj.assign({},e)).controls||(e.controls=ol.control.defaults());e.interactions||(e.interactions=ol.interaction.defaults());ol.PluggableMap.call(this,e)};ol.inherits(ol.Map,ol.PluggableMap);ol.OverlayPositioning={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};ol.Overlay=function(e){ol.Object.call(this);this.options=e;this.id=e.id;this.insertFirst=void 0===e.insertFirst||e.insertFirst;this.stopEvent=void 0===e.stopEvent||e.stopEvent;this.element=document.createElement("DIV");this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+ol.css.CLASS_SELECTABLE;this.element.style.position="absolute";this.autoPan=void 0!==e.autoPan&&e.autoPan;this.autoPanAnimation=e.autoPanAnimation||{};this.autoPanMargin=void 0!==e.autoPanMargin?e.autoPanMargin:20;this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0};this.mapPostrenderListenerKey=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.ELEMENT),this.handleElementChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.MAP),this.handleMapChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.OFFSET),this.handleOffsetChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.POSITION),this.handlePositionChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.POSITIONING),this.handlePositioningChanged,this);void 0!==e.element&&this.setElement(e.element);this.setOffset(void 0!==e.offset?e.offset:[0,0]);this.setPositioning(void 0!==e.positioning?e.positioning:ol.OverlayPositioning.TOP_LEFT);void 0!==e.position&&this.setPosition(e.position)};ol.inherits(ol.Overlay,ol.Object);ol.Overlay.prototype.getElement=function(){return this.get(ol.Overlay.Property.ELEMENT)};ol.Overlay.prototype.getId=function(){return this.id};ol.Overlay.prototype.getMap=function(){return this.get(ol.Overlay.Property.MAP)};ol.Overlay.prototype.getOffset=function(){return this.get(ol.Overlay.Property.OFFSET)};ol.Overlay.prototype.getPosition=function(){return this.get(ol.Overlay.Property.POSITION)};ol.Overlay.prototype.getPositioning=function(){return this.get(ol.Overlay.Property.POSITIONING)};ol.Overlay.prototype.handleElementChanged=function(){ol.dom.removeChildren(this.element);var e=this.getElement();e&&this.element.appendChild(e)};ol.Overlay.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(ol.dom.removeNode(this.element),ol.events.unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var e=this.getMap();e&&(this.mapPostrenderListenerKey=ol.events.listen(e,ol.MapEventType.POSTRENDER,this.render,this),this.updatePixelPosition(),e=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer(),this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element))};ol.Overlay.prototype.render=function(){this.updatePixelPosition()};ol.Overlay.prototype.handleOffsetChanged=function(){this.updatePixelPosition()};ol.Overlay.prototype.handlePositionChanged=function(){this.updatePixelPosition();this.get(ol.Overlay.Property.POSITION)&&this.autoPan&&this.panIntoView()};ol.Overlay.prototype.handlePositioningChanged=function(){this.updatePixelPosition()};ol.Overlay.prototype.setElement=function(e){this.set(ol.Overlay.Property.ELEMENT,e)};ol.Overlay.prototype.setMap=function(e){this.set(ol.Overlay.Property.MAP,e)};ol.Overlay.prototype.setOffset=function(e){this.set(ol.Overlay.Property.OFFSET,e)};ol.Overlay.prototype.setPosition=function(e){this.set(ol.Overlay.Property.POSITION,e)};ol.Overlay.prototype.panIntoView=function(){var e=this.getMap();if(e&&e.getTargetElement()){var t=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),r=this.getRect(o,[ol.dom.outerWidth(o),ol.dom.outerHeight(o)]);o=this.autoPanMargin;if(!ol.extent.containsExtent(t,r)){var n=r[0]-t[0],i=t[2]-r[2],a=r[1]-t[1];r=t[3]-r[3];t=[0,0];0>n?t[0]=n-o:0>i&&(t[0]=Math.abs(i)+o);0>a?t[1]=a-o:0>r&&(t[1]=Math.abs(r)+o);0===t[0]&&0===t[1]||(o=e.getView().getCenter(),o=[(o=e.getPixelFromCoordinate(o))[0]+t[0],o[1]+t[1]],e.getView().animate({center:e.getCoordinateFromPixel(o),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing}))}}};ol.Overlay.prototype.getRect=function(e,t){var o=e.getBoundingClientRect();return[e=o.left+window.pageXOffset,o=o.top+window.pageYOffset,e+t[0],o+t[1]]};ol.Overlay.prototype.setPositioning=function(e){this.set(ol.Overlay.Property.POSITIONING,e)};ol.Overlay.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)};ol.Overlay.prototype.updatePixelPosition=function(){var e=this.getMap(),t=this.getPosition();e&&e.isRendered()&&t?(t=e.getPixelFromCoordinate(t),e=e.getSize(),this.updateRenderedPosition(t,e)):this.setVisible(!1)};ol.Overlay.prototype.updateRenderedPosition=function(e,t){var o=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);var i=r[0];r=r[1];if(n==ol.OverlayPositioning.BOTTOM_RIGHT||n==ol.OverlayPositioning.CENTER_RIGHT||n==ol.OverlayPositioning.TOP_RIGHT)""!==this.rendered.left_&&(this.rendered.left_=o.left=""),i=Math.round(t[0]-e[0]-i)+"px",this.rendered.right_!=i&&(this.rendered.right_=o.right=i);else{""!==this.rendered.right_&&(this.rendered.right_=o.right="");n!=ol.OverlayPositioning.BOTTOM_CENTER&&n!=ol.OverlayPositioning.CENTER_CENTER&&n!=ol.OverlayPositioning.TOP_CENTER||(i-=this.element.offsetWidth/2);i=Math.round(e[0]+i)+"px";this.rendered.left_!=i&&(this.rendered.left_=o.left=i)}if(n==ol.OverlayPositioning.BOTTOM_LEFT||n==ol.OverlayPositioning.BOTTOM_CENTER||n==ol.OverlayPositioning.BOTTOM_RIGHT)""!==this.rendered.top_&&(this.rendered.top_=o.top=""),e=Math.round(t[1]-e[1]-r)+"px",this.rendered.bottom_!=e&&(this.rendered.bottom_=o.bottom=e);else{""!==this.rendered.bottom_&&(this.rendered.bottom_=o.bottom="");n!=ol.OverlayPositioning.CENTER_LEFT&&n!=ol.OverlayPositioning.CENTER_CENTER&&n!=ol.OverlayPositioning.CENTER_RIGHT||(r-=this.element.offsetHeight/2);e=Math.round(e[1]+r)+"px";this.rendered.top_!=e&&(this.rendered.top_=o.top=e)}};ol.Overlay.prototype.getOptions=function(){return this.options};ol.Overlay.Property={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};ol.VectorTile=function(e,t,o,r,n,i){ol.Tile.call(this,e,t,i);this.consumers=0;this.extent_=null;this.format_=r;this.features_=null;this.replayGroups_={};this.tileLoadFunction_=n;this.url_=o};ol.inherits(ol.VectorTile,ol.Tile);ol.VectorTile.prototype.disposeInternal=function(){this.features_=null;this.replayGroups_={};this.state=ol.TileState.ABORT;this.changed();ol.Tile.prototype.disposeInternal.call(this)};ol.VectorTile.prototype.getExtent=function(){return this.extent_||ol.VectorTile.DEFAULT_EXTENT};ol.VectorTile.prototype.getFormat=function(){return this.format_};ol.VectorTile.prototype.getFeatures=function(){return this.features_};ol.VectorTile.prototype.getKey=function(){return this.url_};ol.VectorTile.prototype.getProjection=function(){return this.projection_};ol.VectorTile.prototype.getReplayGroup=function(e,t){return this.replayGroups_[ol.getUid(e)+","+t]};ol.VectorTile.prototype.load=function(){this.state==ol.TileState.IDLE&&(this.setState(ol.TileState.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_(null,NaN,null))};ol.VectorTile.prototype.onLoad=function(e,t,o){this.setProjection(t);this.setFeatures(e);this.setExtent(o)};ol.VectorTile.prototype.onError=function(){this.setState(ol.TileState.ERROR)};ol.VectorTile.prototype.setExtent=function(e){this.extent_=e};ol.VectorTile.prototype.setFeatures=function(e){this.features_=e;this.setState(ol.TileState.LOADED)};ol.VectorTile.prototype.setProjection=function(e){this.projection_=e};ol.VectorTile.prototype.setReplayGroup=function(e,t,o){this.replayGroups_[ol.getUid(e)+","+t]=o};ol.VectorTile.prototype.setLoader=function(e){this.loader_=e};ol.VectorTile.DEFAULT_EXTENT=[0,0,4096,4096];ol.control.FullScreen=function(e){e=e||{};this.cssClassName_=void 0!==e.className?e.className:"ol-full-screen";var t=void 0!==e.label?e.label:"\u2922";this.labelNode_="string"==typeof t?document.createTextNode(t):t;t=void 0!==e.labelActive?e.labelActive:"\xd7";this.labelActiveNode_="string"==typeof t?document.createTextNode(t):t;var o=e.tipLabel?e.tipLabel:"Toggle full-screen";(t=document.createElement("button")).className=this.cssClassName_+"-"+ol.control.FullScreen.isFullScreen();t.setAttribute("type","button");t.title=o;t.appendChild(this.labelNode_);ol.events.listen(t,ol.events.EventType.CLICK,this.handleClick_,this);o=this.cssClassName_+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+" "+(ol.control.FullScreen.isFullScreenSupported()?"":ol.css.CLASS_UNSUPPORTED);var r=document.createElement("div");r.className=o;r.appendChild(t);ol.control.Control.call(this,{element:r,target:e.target});this.keys_=void 0!==e.keys&&e.keys;this.source_=e.source};ol.inherits(ol.control.FullScreen,ol.control.Control);ol.control.FullScreen.prototype.handleClick_=function(e){e.preventDefault();this.handleFullScreen_()};ol.control.FullScreen.prototype.handleFullScreen_=function(){if(ol.control.FullScreen.isFullScreenSupported()){var e=this.getMap();e&&(ol.control.FullScreen.isFullScreen()?ol.control.FullScreen.exitFullScreen():(e=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?ol.control.FullScreen.requestFullScreenWithKeys(e):ol.control.FullScreen.requestFullScreen(e)))}};ol.control.FullScreen.prototype.handleFullScreenChange_=function(){var e=this.element.firstElementChild,t=this.getMap();ol.control.FullScreen.isFullScreen()?(e.className=this.cssClassName_+"-true",ol.dom.replaceNode(this.labelActiveNode_,this.labelNode_)):(e.className=this.cssClassName_+"-false",ol.dom.replaceNode(this.labelNode_,this.labelActiveNode_));t&&t.updateSize()};ol.control.FullScreen.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);e&&this.listenerKeys.push(ol.events.listen(document,ol.control.FullScreen.getChangeType_(),this.handleFullScreenChange_,this))};ol.control.FullScreen.isFullScreenSupported=function(){var e=document.body;return!!(e.webkitRequestFullscreen||e.mozRequestFullScreen&&document.mozFullScreenEnabled||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)};ol.control.FullScreen.isFullScreen=function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)};ol.control.FullScreen.requestFullScreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()};ol.control.FullScreen.requestFullScreenWithKeys=function(e){e.mozRequestFullScreenWithKeys?e.mozRequestFullScreenWithKeys():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):ol.control.FullScreen.requestFullScreen(e)};ol.control.FullScreen.exitFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()};ol.control.FullScreen.getChangeType_=function(){var e;return function(){if(!e){var t=document.body;t.webkitRequestFullscreen?e="webkitfullscreenchange":t.mozRequestFullScreen?e="mozfullscreenchange":t.msRequestFullscreen?e="MSFullscreenChange":t.requestFullscreen&&(e="fullscreenchange")}return e}}();ol.control.MousePosition=function(e){e=e||{};var t=document.createElement("DIV");t.className=void 0!==e.className?e.className:"ol-mouse-position";ol.control.Control.call(this,{element:t,render:e.render?e.render:ol.control.MousePosition.render,target:e.target});ol.events.listen(this,ol.Object.getChangeEventType(ol.control.MousePosition.Property_.PROJECTION),this.handleProjectionChanged_,this);e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat);e.projection&&this.setProjection(e.projection);this.undefinedHTML_=void 0!==e.undefinedHTML?e.undefinedHTML:"";this.renderedHTML_=t.innerHTML;this.lastMouseMovePixel_=this.transform_=this.mapProjection_=null};ol.inherits(ol.control.MousePosition,ol.control.Control);ol.control.MousePosition.render=function(e){(e=e.frameState)?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null;this.updateHTML_(this.lastMouseMovePixel_)};ol.control.MousePosition.prototype.handleProjectionChanged_=function(){this.transform_=null};ol.control.MousePosition.prototype.getCoordinateFormat=function(){return this.get(ol.control.MousePosition.Property_.COORDINATE_FORMAT)};ol.control.MousePosition.prototype.getProjection=function(){return this.get(ol.control.MousePosition.Property_.PROJECTION)};ol.control.MousePosition.prototype.handleMouseMove=function(e){this.lastMouseMovePixel_=this.getMap().getEventPixel(e);this.updateHTML_(this.lastMouseMovePixel_)};ol.control.MousePosition.prototype.handleMouseOut=function(e){this.updateHTML_(null);this.lastMouseMovePixel_=null};ol.control.MousePosition.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);e&&(e=e.getViewport(),this.listenerKeys.push(ol.events.listen(e,ol.events.EventType.MOUSEMOVE,this.handleMouseMove,this),ol.events.listen(e,ol.events.EventType.MOUSEOUT,this.handleMouseOut,this)))};ol.control.MousePosition.prototype.setCoordinateFormat=function(e){this.set(ol.control.MousePosition.Property_.COORDINATE_FORMAT,e)};ol.control.MousePosition.prototype.setProjection=function(e){this.set(ol.control.MousePosition.Property_.PROJECTION,ol.proj.get(e))};ol.control.MousePosition.prototype.updateHTML_=function(e){var t=this.undefinedHTML_;if(e&&this.mapProjection_){if(!this.transform_){var o=this.getProjection();this.transform_=o?ol.proj.getTransformFromProjections(this.mapProjection_,o):ol.proj.identityTransform}(e=this.getMap().getCoordinateFromPixel(e))&&(this.transform_(e,e),t=(t=this.getCoordinateFormat())?t(e):e.toString())}this.renderedHTML_&&t==this.renderedHTML_||(this.renderedHTML_=this.element.innerHTML=t)};ol.control.MousePosition.Property_={PROJECTION:"projection",COORDINATE_FORMAT:"coordinateFormat"};ol.control.OverviewMap=function(e){e=e||{};this.collapsed_=void 0===e.collapsed||e.collapsed;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var t=void 0!==e.className?e.className:"ol-overviewmap",o=void 0!==e.tipLabel?e.tipLabel:"Overview map",r=void 0!==e.collapseLabel?e.collapseLabel:"\xab";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r):this.collapseLabel_=r;"string"==typeof(r=void 0!==e.label?e.label:"\xbb")?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;var n=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;(r=document.createElement("button")).setAttribute("type","button");r.title=o;r.appendChild(n);ol.events.listen(r,ol.events.EventType.CLICK,this.handleClick_,this);this.ovmapDiv_=document.createElement("DIV");this.ovmapDiv_.className="ol-overviewmap-map";var i=this.ovmap_=new ol.PluggableMap({controls:new ol.Collection,interactions:new ol.Collection,view:e.view});e.layers&&e.layers.forEach(function(e){i.addLayer(e)},this);(o=document.createElement("DIV")).className="ol-overviewmap-box";o.style.boxSizing="border-box";this.boxOverlay_=new ol.Overlay({position:[0,0],positioning:ol.OverlayPositioning.BOTTOM_LEFT,element:o});this.ovmap_.addOverlay(this.boxOverlay_);t=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible");(o=document.createElement("div")).className=t;o.appendChild(this.ovmapDiv_);o.appendChild(r);ol.control.Control.call(this,{element:o,render:e.render?e.render:ol.control.OverviewMap.render,target:e.target});var a=this,s=this.boxOverlay_,l=this.boxOverlay_.getElement(),c=function(e){e=i.getEventCoordinate({clientX:e.clientX-l.offsetWidth/2,clientY:e.clientY+l.offsetHeight/2});s.setPosition(e)},u=function(e){e=i.getEventCoordinate(e);a.getMap().getView().setCenter(e);window.removeEventListener("mousemove",c);window.removeEventListener("mouseup",u)};l.addEventListener("mousedown",function(){window.addEventListener("mousemove",c);window.addEventListener("mouseup",u)})};ol.inherits(ol.control.OverviewMap,ol.control.Control);ol.control.OverviewMap.prototype.setMap=function(e){var t=this.getMap();e!==t&&(t&&((t=t.getView())&&this.unbindView_(t),this.ovmap_.setTarget(null)),ol.control.Control.prototype.setMap.call(this,e),e&&(this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup()),e=e.getView()))&&(this.bindView_(e),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))};ol.control.OverviewMap.prototype.handleMapPropertyChange_=function(e){e.key===ol.MapProperty.VIEW&&((e=e.oldValue)&&this.unbindView_(e),e=this.getMap().getView(),this.bindView_(e))};ol.control.OverviewMap.prototype.bindView_=function(e){ol.events.listen(e,ol.Object.getChangeEventType(ol.ViewProperty.ROTATION),this.handleRotationChanged_,this)};ol.control.OverviewMap.prototype.unbindView_=function(e){ol.events.unlisten(e,ol.Object.getChangeEventType(ol.ViewProperty.ROTATION),this.handleRotationChanged_,this)};ol.control.OverviewMap.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())};ol.control.OverviewMap.render=function(e){this.validateExtent_();this.updateBox_()};ol.control.OverviewMap.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize();e=e.getView().calculateExtent(o);var r=t.getSize();o=t.getView().calculateExtent(r);var n=t.getPixelFromCoordinate(ol.extent.getTopLeft(e)),i=t.getPixelFromCoordinate(ol.extent.getBottomRight(e));t=Math.abs(n[0]-i[0]);n=Math.abs(n[1]-i[1]);i=r[0];r=r[1];t<i*ol.OVERVIEWMAP_MIN_RATIO||n<r*ol.OVERVIEWMAP_MIN_RATIO||t>i*ol.OVERVIEWMAP_MAX_RATIO||n>r*ol.OVERVIEWMAP_MAX_RATIO?this.resetExtent_():ol.extent.containsExtent(o,e)||this.recenter_()}};ol.control.OverviewMap.prototype.resetExtent_=function(){if(0!==ol.OVERVIEWMAP_MAX_RATIO&&0!==ol.OVERVIEWMAP_MIN_RATIO){var e=this.getMap(),t=this.ovmap_,o=e.getSize();e=e.getView().calculateExtent(o);t=t.getView();ol.extent.scaleFromCenter(e,1/(Math.pow(2,Math.log(ol.OVERVIEWMAP_MAX_RATIO/ol.OVERVIEWMAP_MIN_RATIO)/Math.LN2/2)*ol.OVERVIEWMAP_MIN_RATIO));t.fit(e)}};ol.control.OverviewMap.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_;e=e.getView();t.getView().setCenter(e.getCenter())};ol.control.OverviewMap.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize(),r=e.getView(),n=t.getView(),i=r.getRotation();t=this.boxOverlay_;e=this.boxOverlay_.getElement();var a=r.calculateExtent(o);o=n.getResolution();r=ol.extent.getBottomLeft(a);n=ol.extent.getTopRight(a);i=this.calculateCoordinateRotate_(i,r);t.setPosition(i);e&&(e.style.width=Math.abs((r[0]-n[0])/o)+"px",e.style.height=Math.abs((n[1]-r[1])/o)+"px")}};ol.control.OverviewMap.prototype.calculateCoordinateRotate_=function(e,t){var o=this.getMap().getView().getCenter();if(o){var r=[t[0]-o[0],t[1]-o[1]];ol.coordinate.rotate(r,e);ol.coordinate.add(r,o)}return r};ol.control.OverviewMap.prototype.handleClick_=function(e){e.preventDefault();this.handleToggle_()};ol.control.OverviewMap.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed");this.collapsed_?ol.dom.replaceNode(this.collapseLabel_,this.label_):ol.dom.replaceNode(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_;var e=this.ovmap_;this.collapsed_||e.isRendered()||(e.updateSize(),this.resetExtent_(),ol.events.listenOnce(e,ol.MapEventType.POSTRENDER,function(e){this.updateBox_()},this))};ol.control.OverviewMap.prototype.getCollapsible=function(){return this.collapsible_};ol.control.OverviewMap.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())};ol.control.OverviewMap.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()};ol.control.OverviewMap.prototype.getCollapsed=function(){return this.collapsed_};ol.control.OverviewMap.prototype.getOverviewMap=function(){return this.ovmap_};ol.control.ScaleLineUnits={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"};ol.control.ScaleLine=function(e){var t=void 0!==(e=e||{}).className?e.className:"ol-scale-line";this.innerElement_=document.createElement("DIV");this.innerElement_.className=t+"-inner";this.element_=document.createElement("DIV");this.element_.className=t+" "+ol.css.CLASS_UNSELECTABLE;this.element_.appendChild(this.innerElement_);this.viewState_=null;this.minWidth_=void 0!==e.minWidth?e.minWidth:64;this.renderedVisible_=!1;this.renderedWidth_=void 0;this.renderedHTML_="";ol.control.Control.call(this,{element:this.element_,render:e.render?e.render:ol.control.ScaleLine.render,target:e.target});ol.events.listen(this,ol.Object.getChangeEventType(ol.control.ScaleLine.Property_.UNITS),this.handleUnitsChanged_,this);this.setUnits(e.units||ol.control.ScaleLineUnits.METRIC)};ol.inherits(ol.control.ScaleLine,ol.control.Control);ol.control.ScaleLine.LEADING_DIGITS=[1,2,5];ol.control.ScaleLine.prototype.getUnits=function(){return this.get(ol.control.ScaleLine.Property_.UNITS)};ol.control.ScaleLine.render=function(e){this.viewState_=(e=e.frameState)?e.viewState:null;this.updateElement_()};ol.control.ScaleLine.prototype.handleUnitsChanged_=function(){this.updateElement_()};ol.control.ScaleLine.prototype.setUnits=function(e){this.set(ol.control.ScaleLine.Property_.UNITS,e)};ol.control.ScaleLine.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,o=e.projection,r=this.getUnits();e=ol.proj.getPointResolution(o,e.resolution,t,r==ol.control.ScaleLineUnits.DEGREES?ol.proj.Units.DEGREES:ol.proj.Units.METERS);r!=ol.control.ScaleLineUnits.METRIC&&(e*=o.getMetersPerUnit());var n=this.minWidth_*e;t="";r==ol.control.ScaleLineUnits.DEGREES?(t=ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES],o.getUnits()==ol.proj.Units.DEGREES?n*=t:e/=t,n<t/60?(t="\u2033",e*=3600):n<t?(t="\u2032",e*=60):t="\xb0"):r==ol.control.ScaleLineUnits.IMPERIAL?.9144>n?(t="in",e/=.0254):1609.344>n?(t="ft",e/=.3048):(t="mi",e/=1609.344):r==ol.control.ScaleLineUnits.NAUTICAL?(e/=1852,t="nm"):r==ol.control.ScaleLineUnits.METRIC?.001>n?(t="\u03bcm",e*=1e6):1>n?(t="mm",e*=1e3):1e3>n?t="m":(t="km",e/=1e3):r==ol.control.ScaleLineUnits.US?.9144>n?(t="in",e*=39.37):1609.344>n?(t="ft",e/=.30480061):(t="mi",e/=1609.3472):ol.asserts.assert(!1,33);for(r=3*Math.floor(Math.log(this.minWidth_*e)/Math.log(10));;){n=ol.control.ScaleLine.LEADING_DIGITS[(r%3+3)%3]*Math.pow(10,Math.floor(r/3));o=Math.round(n/e);if(isNaN(o)){this.element_.style.display="none";this.renderedVisible_=!1;return}if(o>=this.minWidth_)break;++r}e=n+" "+t;this.renderedHTML_!=e&&(this.renderedHTML_=this.innerElement_.innerHTML=e);this.renderedWidth_!=o&&(this.innerElement_.style.width=o+"px",this.renderedWidth_=o);this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)};ol.control.ScaleLine.Property_={UNITS:"units"};ol.control.ZoomSlider=function(e){e=e||{};this.currentResolution_=void 0;this.direction_=ol.control.ZoomSlider.Direction_.VERTICAL;this.widthLimit_=this.heightLimit_=0;this.thumbSize_=null;this.sliderInitialized_=!1;this.duration_=void 0!==e.duration?e.duration:200;var t=void 0!==e.className?e.className:"ol-zoomslider",o=document.createElement("button");o.setAttribute("type","button");o.className=t+"-thumb "+ol.css.CLASS_UNSELECTABLE;var r=document.createElement("div");r.className=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL;r.appendChild(o);this.dragger_=new ol.pointer.PointerEventHandler(r);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERDOWN,this.handleDraggerStart_,this);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERMOVE,this.handleDraggerDrag_,this);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERUP,this.handleDraggerEnd_,this);ol.events.listen(r,ol.events.EventType.CLICK,this.handleContainerClick_,this);ol.events.listen(o,ol.events.EventType.CLICK,ol.events.Event.stopPropagation);ol.control.Control.call(this,{element:r,render:e.render?e.render:ol.control.ZoomSlider.render})};ol.inherits(ol.control.ZoomSlider,ol.control.Control);ol.control.ZoomSlider.prototype.disposeInternal=function(){this.dragger_.dispose();ol.control.Control.prototype.disposeInternal.call(this)};ol.control.ZoomSlider.Direction_={VERTICAL:0,HORIZONTAL:1};ol.control.ZoomSlider.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);e&&e.render()};ol.control.ZoomSlider.prototype.initSlider_=function(){var e=this.element,t=e.offsetWidth,o=e.offsetHeight,r=e.firstElementChild,n=getComputedStyle(r);e=r.offsetWidth+parseFloat(n.marginRight)+parseFloat(n.marginLeft);r=r.offsetHeight+parseFloat(n.marginTop)+parseFloat(n.marginBottom);this.thumbSize_=[e,r];t>o?(this.direction_=ol.control.ZoomSlider.Direction_.HORIZONTAL,this.widthLimit_=t-e):(this.direction_=ol.control.ZoomSlider.Direction_.VERTICAL,this.heightLimit_=o-r);this.sliderInitialized_=!0};ol.control.ZoomSlider.render=function(e){e.frameState&&(this.sliderInitialized_||this.initSlider_(),(e=e.frameState.viewState.resolution)!==this.currentResolution_&&(this.currentResolution_=e,this.setThumbPosition_(e)))};ol.control.ZoomSlider.prototype.handleContainerClick_=function(e){var t=this.getMap().getView();e=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2);e=this.getResolutionForPosition_(e);t.animate({resolution:t.constrainResolution(e),duration:this.duration_,easing:ol.easing.easeOut})};ol.control.ZoomSlider.prototype.handleDraggerStart_=function(e){this.dragging_||e.originalEvent.target!==this.element.firstElementChild||(this.getMap().getView().setHint(ol.ViewHint.INTERACTING,1),this.previousX_=e.clientX,this.previousY_=e.clientY,this.dragging_=!0)};ol.control.ZoomSlider.prototype.handleDraggerDrag_=function(e){if(this.dragging_){var t=this.element.firstElementChild,o=e.clientX-this.previousX_+parseInt(t.style.left,10);t=e.clientY-this.previousY_+parseInt(t.style.top,10);o=this.getRelativePosition_(o,t);this.currentResolution_=this.getResolutionForPosition_(o);this.getMap().getView().setResolution(this.currentResolution_);this.setThumbPosition_(this.currentResolution_);this.previousX_=e.clientX;this.previousY_=e.clientY}};ol.control.ZoomSlider.prototype.handleDraggerEnd_=function(e){this.dragging_&&((e=this.getMap().getView()).setHint(ol.ViewHint.INTERACTING,-1),e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:ol.easing.easeOut}),this.dragging_=!1,this.previousY_=this.previousX_=void 0)};ol.control.ZoomSlider.prototype.setThumbPosition_=function(e){e=this.getPositionForResolution_(e);var t=this.element.firstElementChild;this.direction_==ol.control.ZoomSlider.Direction_.HORIZONTAL?t.style.left=this.widthLimit_*e+"px":t.style.top=this.heightLimit_*e+"px"};ol.control.ZoomSlider.prototype.getRelativePosition_=function(e,t){return ol.math.clamp(this.direction_===ol.control.ZoomSlider.Direction_.HORIZONTAL?e/this.widthLimit_:t/this.heightLimit_,0,1)};ol.control.ZoomSlider.prototype.getResolutionForPosition_=function(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)};ol.control.ZoomSlider.prototype.getPositionForResolution_=function(e){return 1-this.getMap().getView().getValueForResolutionFunction()(e)};ol.control.ZoomToExtent=function(e){e=e||{};this.extent=e.extent?e.extent:null;var t=void 0!==e.className?e.className:"ol-zoom-extent",o=void 0!==e.label?e.label:"E",r=void 0!==e.tipLabel?e.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button");n.title=r;n.appendChild("string"==typeof o?document.createTextNode(o):o);ol.events.listen(n,ol.events.EventType.CLICK,this.handleClick_,this);t=t+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL;(o=document.createElement("div")).className=t;o.appendChild(n);ol.control.Control.call(this,{element:o,target:e.target})};ol.inherits(ol.control.ZoomToExtent,ol.control.Control);ol.control.ZoomToExtent.prototype.handleClick_=function(e){e.preventDefault();this.handleZoomToExtent()};ol.control.ZoomToExtent.prototype.handleZoomToExtent=function(){var e=this.getMap().getView(),t=this.extent?this.extent:e.getProjection().getExtent();e.fit(t)};ol.format={};ol.format.FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};ol.xml={};ol.xml.DOCUMENT=document.implementation.createDocument("","",null);ol.xml.createElementNS=function(e,t){return ol.xml.DOCUMENT.createElementNS(e,t)};ol.xml.getAllTextContent=function(e,t){return ol.xml.getAllTextContent_(e,t,[]).join("")};ol.xml.getAllTextContent_=function(e,t,o){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?o.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):o.push(e.nodeValue);else for(e=e.firstChild;e;e=e.nextSibling)ol.xml.getAllTextContent_(e,t,o);return o};ol.xml.isDocument=function(e){return e instanceof Document};ol.xml.isNode=function(e){return e instanceof Node};ol.xml.getAttributeNS=function(e,t,o){return e.getAttributeNS(t,o)||""};ol.xml.setAttributeNS=function(e,t,o,r){e.setAttributeNS(t,o,r)};ol.xml.parse=function(e){return(new DOMParser).parseFromString(e,"application/xml")};ol.xml.makeArrayExtender=function(e,t){return function(o,r){void 0!==(o=e.call(t,o,r))&&ol.array.extend(r[r.length-1],o)}};ol.xml.makeArrayPusher=function(e,t){return function(o,r){void 0!==(o=e.call(void 0!==t?t:this,o,r))&&r[r.length-1].push(o)}};ol.xml.makeReplacer=function(e,t){return function(o,r){void 0!==(o=e.call(void 0!==t?t:this,o,r))&&(r[r.length-1]=o)}};ol.xml.makeObjectPropertyPusher=function(e,t,o){return function(r,n){var i=e.call(void 0!==o?o:this,r,n);void 0!==i&&(n=n[n.length-1],((r=void 0!==t?t:r.localName)in n?n[r]:n[r]=[]).push(i))}};ol.xml.makeObjectPropertySetter=function(e,t,o){return function(r,n){var i=e.call(void 0!==o?o:this,r,n);void 0!==i&&(n[n.length-1][void 0!==t?t:r.localName]=i)}};ol.xml.makeChildAppender=function(e,t){return function(o,r,n){e.call(void 0!==t?t:this,o,r,n);n[n.length-1].node.appendChild(o)}};ol.xml.makeArraySerializer=function(e,t){var o,r;return function(t,n,i){if(void 0===o){o={};var a={};a[t.localName]=e;o[t.namespaceURI]=a;r=ol.xml.makeSimpleNodeFactory(t.localName)}ol.xml.serialize(o,r,n,i)}};ol.xml.makeSimpleNodeFactory=function(e,t){return function(o,r,n){o=r[r.length-1].node;void 0===(r=e)&&(r=n);n=t;void 0===t&&(n=o.namespaceURI);return ol.xml.createElementNS(n,r)}};ol.xml.OBJECT_PROPERTY_NODE_FACTORY=ol.xml.makeSimpleNodeFactory();ol.xml.makeSequence=function(e,t){for(var o=t.length,r=Array(o),n=0;n<o;++n)r[n]=e[t[n]];return r};ol.xml.makeStructureNS=function(e,t,o){o=void 0!==o?o:{};var r,n=0;for(r=e.length;n<r;++n)o[e[n]]=t;return o};ol.xml.parseNode=function(e,t,o,r){for(t=t.firstElementChild;t;t=t.nextElementSibling){var n=e[t.namespaceURI];void 0!==n&&(void 0!==(n=n[t.localName])&&n.call(r,t,o))}};ol.xml.pushParseAndPop=function(e,t,o,r,n){r.push(e);ol.xml.parseNode(t,o,r,n);return r.pop()};ol.xml.serialize=function(e,t,o,r,n,i){for(var a,s,l=(void 0!==n?n:o).length,c=0;c<l;++c)void 0!==(a=o[c])&&(void 0!==(s=t.call(i,a,r,void 0!==n?n[c]:void 0))&&e[s.namespaceURI][s.localName].call(i,s,a,r))};ol.xml.pushSerializeAndPop=function(e,t,o,r,n,i,a){n.push(e);ol.xml.serialize(t,o,r,n,i,a);return n.pop()};ol.featureloader={};ol.featureloader.loadFeaturesXhr=function(e,t,o,r){return function(n,i,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof e?e(n,i,a):e,!0);t.getType()==ol.format.FormatType.ARRAY_BUFFER&&(s.responseType="arraybuffer");s.onload=function(e){if(!s.status||200<=s.status&&300>s.status){if((e=t.getType())==ol.format.FormatType.JSON||e==ol.format.FormatType.TEXT)var n=s.responseText;else e==ol.format.FormatType.XML?(n=s.responseXML)||(n=ol.xml.parse(s.responseText)):e==ol.format.FormatType.ARRAY_BUFFER&&(n=s.response);n?o.call(this,t.readFeatures(n,{featureProjection:a}),t.readProjection(n),t.getLastExtent()):r.call(this)}else r.call(this)}.bind(this);s.onerror=function(){r.call(this)}.bind(this);s.send()}};ol.featureloader.xhr=function(e,t){return ol.featureloader.loadFeaturesXhr(e,t,function(e,t){this.addFeatures(e)},ol.nullFunction)};ol.format.Feature=function(){this.defaultFeatureProjection=this.defaultDataProjection=null};ol.format.Feature.prototype.getReadOptions=function(e,t){var o;t&&(o={dataProjection:t.dataProjection?t.dataProjection:this.readProjection(e),featureProjection:t.featureProjection});return this.adaptOptions(o)};ol.format.Feature.prototype.adaptOptions=function(e){return ol.obj.assign({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},e)};ol.format.Feature.prototype.getLastExtent=function(){return null};ol.format.Feature.prototype.getType=function(){};ol.format.Feature.prototype.readFeature=function(e,t){};ol.format.Feature.prototype.readFeatures=function(e,t){};ol.format.Feature.prototype.readGeometry=function(e,t){};ol.format.Feature.prototype.readProjection=function(e){};ol.format.Feature.prototype.writeFeature=function(e,t){};ol.format.Feature.prototype.writeFeatures=function(e,t){};ol.format.Feature.prototype.writeGeometry=function(e,t){};ol.format.Feature.transformWithOptions=function(e,t,o){var r=o?ol.proj.get(o.featureProjection):null,n=o?ol.proj.get(o.dataProjection):null;r=r&&n&&!ol.proj.equivalent(r,n)?e instanceof ol.geom.Geometry?(t?e.clone():e).transform(t?r:n,t?n:r):ol.proj.transformExtent(e,n,r):e;if(t&&o&&void 0!==o.decimals){var i=Math.pow(10,o.decimals);r===e&&(r=r.clone());r.applyTransform(function(e){for(var t=0,o=e.length;t<o;++t)e[t]=Math.round(e[t]*i)/i;return e})}return r};ol.format.JSONFeature=function(){ol.format.Feature.call(this)};ol.inherits(ol.format.JSONFeature,ol.format.Feature);ol.format.JSONFeature.prototype.getObject_=function(e){return"string"==typeof e?(e=JSON.parse(e))?e:null:null!==e?e:null};ol.format.JSONFeature.prototype.getType=function(){return ol.format.FormatType.JSON};ol.format.JSONFeature.prototype.readFeature=function(e,t){return this.readFeatureFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readFeatures=function(e,t){return this.readFeaturesFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readFeatureFromObject=function(e,t){};ol.format.JSONFeature.prototype.readFeaturesFromObject=function(e,t){};ol.format.JSONFeature.prototype.readGeometry=function(e,t){return this.readGeometryFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readGeometryFromObject=function(e,t){};ol.format.JSONFeature.prototype.readProjection=function(e){return this.readProjectionFromObject(this.getObject_(e))};ol.format.JSONFeature.prototype.readProjectionFromObject=function(e){};ol.format.JSONFeature.prototype.writeFeature=function(e,t){return JSON.stringify(this.writeFeatureObject(e,t))};ol.format.JSONFeature.prototype.writeFeatureObject=function(e,t){};ol.format.JSONFeature.prototype.writeFeatures=function(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))};ol.format.JSONFeature.prototype.writeFeaturesObject=function(e,t){};ol.format.JSONFeature.prototype.writeGeometry=function(e,t){return JSON.stringify(this.writeGeometryObject(e,t))};ol.format.JSONFeature.prototype.writeGeometryObject=function(e,t){};ol.geom.MultiLineString=function(e,t){ol.geom.SimpleGeometry.call(this);this.ends_=[];this.maxDeltaRevision_=this.maxDelta_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiLineString,ol.geom.SimpleGeometry);ol.geom.MultiLineString.prototype.appendLineString=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};ol.geom.MultiLineString.prototype.clone=function(){var e=new ol.geom.MultiLineString(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice());return e};ol.geom.MultiLineString.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision());return ol.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,o,r)};ol.geom.MultiLineString.prototype.getCoordinateAtM=function(e,t,o){return this.layout!=ol.geom.GeometryLayout.XYM&&this.layout!=ol.geom.GeometryLayout.XYZM||0===this.flatCoordinates.length?null:ol.geom.flat.interpolate.lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,e,void 0!==t&&t,void 0!==o&&o)};ol.geom.MultiLineString.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinatess(this.flatCoordinates,0,this.ends_,this.stride)};ol.geom.MultiLineString.prototype.getEnds=function(){return this.ends_};ol.geom.MultiLineString.prototype.getLineString=function(e){if(0>e||this.ends_.length<=e)return null;var t=new ol.geom.LineString(null);t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]));return t};ol.geom.MultiLineString.prototype.getLineStrings=function(){var e,t=this.flatCoordinates,o=this.ends_,r=this.layout,n=[],i=0,a=0;for(e=o.length;a<e;++a){var s=o[a],l=new ol.geom.LineString(null);l.setFlatCoordinates(r,t.slice(i,s));n.push(l);i=s}return n};ol.geom.MultiLineString.prototype.getFlatMidpoints=function(){var e,t=[],o=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,a=0;for(e=n.length;a<e;++a){var s=n[a];r=ol.geom.flat.interpolate.lineString(o,r,s,i,.5);ol.array.extend(t,r);r=s}return t};ol.geom.MultiLineString.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.douglasPeuckers(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,o);(e=new ol.geom.MultiLineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return e};ol.geom.MultiLineString.prototype.getType=function(){return ol.geom.GeometryType.MULTI_LINE_STRING};ol.geom.MultiLineString.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.lineStrings(this.flatCoordinates,0,this.ends_,this.stride,e)};ol.geom.MultiLineString.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]),e=ol.geom.flat.deflate.coordinatess(this.flatCoordinates,0,e,this.stride,this.ends_),this.flatCoordinates.length=0===e.length?0:e[e.length-1],this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.ends_)};ol.geom.MultiLineString.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.ends_=o;this.changed()};ol.geom.MultiLineString.prototype.setLineStrings=function(e){var t,o=this.getLayout(),r=[],n=[],i=0;for(t=e.length;i<t;++i){var a=e[i];0===i&&(o=a.getLayout());ol.array.extend(r,a.getFlatCoordinates());n.push(r.length)}this.setFlatCoordinates(o,r,n)};ol.geom.MultiPoint=function(e,t){ol.geom.SimpleGeometry.call(this);this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiPoint,ol.geom.SimpleGeometry);ol.geom.MultiPoint.prototype.appendPoint=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice();this.changed()};ol.geom.MultiPoint.prototype.clone=function(){var e=new ol.geom.MultiPoint(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.MultiPoint.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;var n,i=this.flatCoordinates,a=this.stride,s=0;for(n=i.length;s<n;s+=a){var l=ol.math.squaredDistance(e,t,i[s],i[s+1]);if(l<r){r=l;for(l=0;l<a;++l)o[l]=i[s+l];o.length=a}}return r};ol.geom.MultiPoint.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.MultiPoint.prototype.getPoint=function(e){var t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;if(0>e||t<=e)return null;(t=new ol.geom.Point(null)).setFlatCoordinates(this.layout,this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride));return t};ol.geom.MultiPoint.prototype.getPoints=function(){var e,t=this.flatCoordinates,o=this.layout,r=this.stride,n=[],i=0;for(e=t.length;i<e;i+=r){var a=new ol.geom.Point(null);a.setFlatCoordinates(o,t.slice(i,i+r));n.push(a)}return n};ol.geom.MultiPoint.prototype.getType=function(){return ol.geom.GeometryType.MULTI_POINT};ol.geom.MultiPoint.prototype.intersectsExtent=function(e){var t,o=this.flatCoordinates,r=this.stride,n=0;for(t=o.length;n<t;n+=r){var i=o[n],a=o[n+1];if(ol.extent.containsXY(e,i,a))return!0}return!1};ol.geom.MultiPoint.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.MultiPoint.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.flat.center={};ol.geom.flat.center.linearRingss=function(e,t,o,r){var n,i=[];ol.extent.createEmpty();var a=0;for(n=o.length;a<n;++a){var s=o[a];t=ol.extent.createOrUpdateFromFlatCoordinates(e,t,s[0],r);i.push((t[0]+t[2])/2,(t[1]+t[3])/2);t=s[s.length-1]}return i};ol.geom.MultiPolygon=function(e,t){ol.geom.SimpleGeometry.call(this);this.endss_=[];this.flatInteriorPointsRevision_=-1;this.flatInteriorPoints_=null;this.orientedRevision_=this.maxDeltaRevision_=this.maxDelta_=-1;this.orientedFlatCoordinates_=null;this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiPolygon,ol.geom.SimpleGeometry);ol.geom.MultiPolygon.prototype.appendPolygon=function(e){if(this.flatCoordinates){var t,o=this.flatCoordinates.length;ol.array.extend(this.flatCoordinates,e.getFlatCoordinates());var r=0;for(t=(e=e.getEnds().slice()).length;r<t;++r)e[r]+=o}else this.flatCoordinates=e.getFlatCoordinates().slice(),e=e.getEnds().slice(),this.endss_.push();this.endss_.push(e);this.changed()};ol.geom.MultiPolygon.prototype.clone=function(){for(var e=new ol.geom.MultiPolygon(null),t=this.endss_.length,o=Array(t),r=0;r<t;++r)o[r]=this.endss_[r].slice();e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),o);return e};ol.geom.MultiPolygon.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getssMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision());return ol.geom.flat.closest.getssClosestPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.MultiPolygon.prototype.containsXY=function(e,t){return ol.geom.flat.contains.linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)};ol.geom.MultiPolygon.prototype.getArea=function(){return ol.geom.flat.area.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)};ol.geom.MultiPolygon.prototype.getCoordinates=function(e){if(void 0!==e){var t=this.getOrientedFlatCoordinates().slice();ol.geom.flat.orient.orientLinearRingss(t,0,this.endss_,this.stride,e)}else t=this.flatCoordinates;return ol.geom.flat.inflate.coordinatesss(t,0,this.endss_,this.stride)};ol.geom.MultiPolygon.prototype.getEndss=function(){return this.endss_};ol.geom.MultiPolygon.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var e=ol.geom.flat.center.linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e);this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_};ol.geom.MultiPolygon.prototype.getInteriorPoints=function(){var e=new ol.geom.MultiPoint(null);e.setFlatCoordinates(ol.geom.GeometryLayout.XYM,this.getFlatInteriorPoints().slice());return e};ol.geom.MultiPolygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;ol.geom.flat.orient.linearRingssAreOriented(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ol.geom.flat.orient.orientLinearRingss(this.orientedFlatCoordinates_,0,this.endss_,this.stride));this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};ol.geom.MultiPolygon.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.quantizess(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,o);(e=new ol.geom.MultiPolygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return e};ol.geom.MultiPolygon.prototype.getPolygon=function(e){if(0>e||this.endss_.length<=e)return null;if(0===e)var t=0;else t=(t=this.endss_[e-1])[t.length-1];var o=(e=this.endss_[e].slice())[e.length-1];if(0!==t){var r,n=0;for(r=e.length;n<r;++n)e[n]-=t}(n=new ol.geom.Polygon(null)).setFlatCoordinates(this.layout,this.flatCoordinates.slice(t,o),e);return n};ol.geom.MultiPolygon.prototype.getPolygons=function(){var e,t,o=this.layout,r=this.flatCoordinates,n=this.endss_,i=[],a=0,s=0;for(e=n.length;s<e;++s){var l=n[s].slice(),c=l[l.length-1];if(0!==a){var u=0;for(t=l.length;u<t;++u)l[u]-=a}(u=new ol.geom.Polygon(null)).setFlatCoordinates(o,r.slice(a,c),l);i.push(u);a=c}return i};ol.geom.MultiPolygon.prototype.getType=function(){return ol.geom.GeometryType.MULTI_POLYGON};ol.geom.MultiPolygon.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)};ol.geom.MultiPolygon.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]),0===(e=ol.geom.flat.deflate.coordinatesss(this.flatCoordinates,0,e,this.stride,this.endss_)).length?this.flatCoordinates.length=0:(e=e[e.length-1],this.flatCoordinates.length=0===e.length?0:e[e.length-1]),this.changed()):this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.endss_)};ol.geom.MultiPolygon.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.endss_=o;this.changed()};ol.geom.MultiPolygon.prototype.setPolygons=function(e){var t,o=this.getLayout(),r=[],n=[],i=0;for(t=e.length;i<t;++i){var a=e[i];0===i&&(o=a.getLayout());var s,l=r.length,c=a.getEnds(),u=0;for(s=c.length;u<s;++u)c[u]+=l;ol.array.extend(r,a.getFlatCoordinates());n.push(c)}this.setFlatCoordinates(o,r,n)};ol.format.EsriJSON=function(e){e=e||{};ol.format.JSONFeature.call(this);this.geometryName_=e.geometryName};ol.inherits(ol.format.EsriJSON,ol.format.JSONFeature);ol.format.EsriJSON.readGeometry_=function(e,t){if(!e)return null;if("number"==typeof e.x&&"number"==typeof e.y)var o=ol.geom.GeometryType.POINT;else if(e.points)o=ol.geom.GeometryType.MULTI_POINT;else if(e.paths)o=1===e.paths.length?ol.geom.GeometryType.LINE_STRING:ol.geom.GeometryType.MULTI_LINE_STRING;else if(e.rings){o=ol.format.EsriJSON.getGeometryLayout_(e);var r=ol.format.EsriJSON.convertRings_(e.rings,o);e=ol.obj.assign({},e);1===r.length?(o=ol.geom.GeometryType.POLYGON,e.rings=r[0]):(o=ol.geom.GeometryType.MULTI_POLYGON,e.rings=r)}return ol.format.Feature.transformWithOptions((0,ol.format.EsriJSON.GEOMETRY_READERS_[o])(e),!1,t)};ol.format.EsriJSON.convertRings_=function(e,t){var o,r=[],n=[],i=[],a=0;for(o=e.length;a<o;++a)r.length=0,ol.geom.flat.deflate.coordinates(r,0,e[a],t.length),ol.geom.flat.orient.linearRingIsClockwise(r,0,r.length,t.length)?n.push([e[a]]):i.push(e[a]);for(;i.length;){e=i.shift();t=!1;for(a=n.length-1;0<=a;a--)if(ol.extent.containsExtent(new ol.geom.LinearRing(n[a][0]).getExtent(),new ol.geom.LinearRing(e).getExtent())){n[a].push(e);t=!0;break}t||n.push([e.reverse()])}return n};ol.format.EsriJSON.readPointGeometry_=function(e){return void 0!==e.m&&void 0!==e.z?new ol.geom.Point([e.x,e.y,e.z,e.m],ol.geom.GeometryLayout.XYZM):void 0!==e.z?new ol.geom.Point([e.x,e.y,e.z],ol.geom.GeometryLayout.XYZ):void 0!==e.m?new ol.geom.Point([e.x,e.y,e.m],ol.geom.GeometryLayout.XYM):new ol.geom.Point([e.x,e.y])};ol.format.EsriJSON.readLineStringGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.LineString(e.paths[0],t)};ol.format.EsriJSON.readMultiLineStringGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiLineString(e.paths,t)};ol.format.EsriJSON.getGeometryLayout_=function(e){var t=ol.geom.GeometryLayout.XY;!0===e.hasZ&&!0===e.hasM?t=ol.geom.GeometryLayout.XYZM:!0===e.hasZ?t=ol.geom.GeometryLayout.XYZ:!0===e.hasM&&(t=ol.geom.GeometryLayout.XYM);return t};ol.format.EsriJSON.readMultiPointGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiPoint(e.points,t)};ol.format.EsriJSON.readMultiPolygonGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiPolygon(e.rings,t)};ol.format.EsriJSON.readPolygonGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.Polygon(e.rings,t)};ol.format.EsriJSON.writePointGeometry_=function(e,t){t=e.getCoordinates();var o;(e=e.getLayout())===ol.geom.GeometryLayout.XYZ?o={x:t[0],y:t[1],z:t[2]}:e===ol.geom.GeometryLayout.XYM?o={x:t[0],y:t[1],m:t[2]}:e===ol.geom.GeometryLayout.XYZM?o={x:t[0],y:t[1],z:t[2],m:t[3]}:e===ol.geom.GeometryLayout.XY?o={x:t[0],y:t[1]}:ol.asserts.assert(!1,34);return o};ol.format.EsriJSON.getHasZM_=function(e){return{hasZ:(e=e.getLayout())===ol.geom.GeometryLayout.XYZ||e===ol.geom.GeometryLayout.XYZM,hasM:e===ol.geom.GeometryLayout.XYM||e===ol.geom.GeometryLayout.XYZM}};ol.format.EsriJSON.writeLineStringGeometry_=function(e,t){return{hasZ:(t=ol.format.EsriJSON.getHasZM_(e)).hasZ,hasM:t.hasM,paths:[e.getCoordinates()]}};ol.format.EsriJSON.writePolygonGeometry_=function(e,t){return{hasZ:(t=ol.format.EsriJSON.getHasZM_(e)).hasZ,hasM:t.hasM,rings:e.getCoordinates(!1)}};ol.format.EsriJSON.writeMultiLineStringGeometry_=function(e,t){return{hasZ:(t=ol.format.EsriJSON.getHasZM_(e)).hasZ,hasM:t.hasM,paths:e.getCoordinates()}};ol.format.EsriJSON.writeMultiPointGeometry_=function(e,t){return{hasZ:(t=ol.format.EsriJSON.getHasZM_(e)).hasZ,hasM:t.hasM,points:e.getCoordinates()}};ol.format.EsriJSON.writeMultiPolygonGeometry_=function(e,t){t=ol.format.EsriJSON.getHasZM_(e);e=e.getCoordinates(!1);for(var o=[],r=0;r<e.length;r++)for(var n=e[r].length-1;0<=n;n--)o.push(e[r][n]);return{hasZ:t.hasZ,hasM:t.hasM,rings:o}};ol.format.EsriJSON.GEOMETRY_READERS_={};ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.POINT]=ol.format.EsriJSON.readPointGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.LINE_STRING]=ol.format.EsriJSON.readLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.POLYGON]=ol.format.EsriJSON.readPolygonGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_POINT]=ol.format.EsriJSON.readMultiPointGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_LINE_STRING]=ol.format.EsriJSON.readMultiLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_POLYGON]=ol.format.EsriJSON.readMultiPolygonGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_={};ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.POINT]=ol.format.EsriJSON.writePointGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.LINE_STRING]=ol.format.EsriJSON.writeLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.POLYGON]=ol.format.EsriJSON.writePolygonGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_POINT]=ol.format.EsriJSON.writeMultiPointGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_LINE_STRING]=ol.format.EsriJSON.writeMultiLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_POLYGON]=ol.format.EsriJSON.writeMultiPolygonGeometry_;ol.format.EsriJSON.prototype.readFeatureFromObject=function(e,t){var o=ol.format.EsriJSON.readGeometry_(e.geometry,t),r=new ol.Feature;this.geometryName_&&r.setGeometryName(this.geometryName_);r.setGeometry(o);t&&t.idField&&e.attributes[t.idField]&&r.setId(e.attributes[t.idField]);e.attributes&&r.setProperties(e.attributes);return r};ol.format.EsriJSON.prototype.readFeaturesFromObject=function(e,t){t=t||{};if(e.features){var o,r=[],n=e.features;t.idField=e.objectIdFieldName;e=0;for(o=n.length;e<o;++e)r.push(this.readFeatureFromObject(n[e],t));return r}return[this.readFeatureFromObject(e,t)]};ol.format.EsriJSON.prototype.readGeometryFromObject=function(e,t){return ol.format.EsriJSON.readGeometry_(e,t)};ol.format.EsriJSON.prototype.readProjectionFromObject=function(e){return e.spatialReference&&e.spatialReference.wkid?ol.proj.get("EPSG:"+e.spatialReference.wkid):null};ol.format.EsriJSON.writeGeometry_=function(e,t){return(0,ol.format.EsriJSON.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)};ol.format.EsriJSON.prototype.writeGeometryObject=function(e,t){return ol.format.EsriJSON.writeGeometry_(e,this.adaptOptions(t))};ol.format.EsriJSON.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var o={},r=e.getGeometry();r&&(o.geometry=ol.format.EsriJSON.writeGeometry_(r,t),t&&t.featureProjection&&(o.geometry.spatialReference={wkid:ol.proj.get(t.featureProjection).getCode().split(":").pop()}));delete(t=e.getProperties())[e.getGeometryName()];ol.obj.isEmpty(t)?o.attributes={}:o.attributes=t;return o};ol.format.EsriJSON.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);var o,r=[],n=0;for(o=e.length;n<o;++n)r.push(this.writeFeatureObject(e[n],t));return{features:r}};ol.format.XMLFeature=function(){this.xmlSerializer_=new XMLSerializer;ol.format.Feature.call(this)};ol.inherits(ol.format.XMLFeature,ol.format.Feature);ol.format.XMLFeature.prototype.getType=function(){return ol.format.FormatType.XML};ol.format.XMLFeature.prototype.readFeature=function(e,t){return ol.xml.isDocument(e)?this.readFeatureFromDocument(e,t):ol.xml.isNode(e)?this.readFeatureFromNode(e,t):"string"==typeof e?(e=ol.xml.parse(e),this.readFeatureFromDocument(e,t)):null};ol.format.XMLFeature.prototype.readFeatureFromDocument=function(e,t){return 0<(e=this.readFeaturesFromDocument(e,t)).length?e[0]:null};ol.format.XMLFeature.prototype.readFeatureFromNode=function(e,t){return null};ol.format.XMLFeature.prototype.readFeatures=function(e,t){return ol.xml.isDocument(e)?this.readFeaturesFromDocument(e,t):ol.xml.isNode(e)?this.readFeaturesFromNode(e,t):"string"==typeof e?(e=ol.xml.parse(e),this.readFeaturesFromDocument(e,t)):[]};ol.format.XMLFeature.prototype.readFeaturesFromDocument=function(e,t){var o=[];for(e=e.firstChild;e;e=e.nextSibling)e.nodeType==Node.ELEMENT_NODE&&ol.array.extend(o,this.readFeaturesFromNode(e,t));return o};ol.format.XMLFeature.prototype.readFeaturesFromNode=function(e,t){};ol.format.XMLFeature.prototype.readGeometry=function(e,t){return ol.xml.isDocument(e)?this.readGeometryFromDocument(e,t):ol.xml.isNode(e)?this.readGeometryFromNode(e,t):"string"==typeof e?(e=ol.xml.parse(e),this.readGeometryFromDocument(e,t)):null};ol.format.XMLFeature.prototype.readGeometryFromDocument=function(e,t){return null};ol.format.XMLFeature.prototype.readGeometryFromNode=function(e,t){return null};ol.format.XMLFeature.prototype.readProjection=function(e){return ol.xml.isDocument(e)?this.readProjectionFromDocument(e):ol.xml.isNode(e)?this.readProjectionFromNode(e):"string"==typeof e?(e=ol.xml.parse(e),this.readProjectionFromDocument(e)):null};ol.format.XMLFeature.prototype.readProjectionFromDocument=function(e){return this.defaultDataProjection};ol.format.XMLFeature.prototype.readProjectionFromNode=function(e){return this.defaultDataProjection};ol.format.XMLFeature.prototype.writeFeature=function(e,t){e=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(e)};ol.format.XMLFeature.prototype.writeFeatureNode=function(e,t){return null};ol.format.XMLFeature.prototype.writeFeatures=function(e,t){e=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(e)};ol.format.XMLFeature.prototype.writeFeaturesNode=function(e,t){return null};ol.format.XMLFeature.prototype.writeGeometry=function(e,t){e=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(e)};ol.format.XMLFeature.prototype.writeGeometryNode=function(e,t){return null};ol.format.GMLBase=function(e){e=e||{};this.featureType=e.featureType;this.featureNS=e.featureNS;this.srsName=e.srsName;this.schemaLocation="";this.FEATURE_COLLECTION_PARSERS={};this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS]={featureMember:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFeaturesInternal),featureMembers:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFeaturesInternal)};ol.format.XMLFeature.call(this)};ol.inherits(ol.format.GMLBase,ol.format.XMLFeature);ol.format.GMLBase.GMLNS="http://www.opengis.net/gml";ol.format.GMLBase.ONLY_WHITESPACE_RE_=/^[\s\xa0]*$/;ol.format.GMLBase.prototype.readFeaturesInternal=function(e,t){var o=e.localName,r=null;if("FeatureCollection"==o)r="http://www.opengis.net/wfs"===e.namespaceURI?ol.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,t,this):ol.xml.pushParseAndPop(null,this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==o||"featureMember"==o){var n,i=t[0],a=i.featureType;r=i.featureNS;if(!a&&e.childNodes){a=[];r={};var s=0;for(n=e.childNodes.length;s<n;++s){var l=e.childNodes[s];if(1===l.nodeType){var c=l.nodeName.split(":").pop();if(-1===a.indexOf(c)){var u="",h=0;l=l.namespaceURI;for(var d in r){if(r[d]===l){u=d;break}++h}u||(r[u="p"+h]=l);a.push(u+":"+c)}}}"featureMember"!=o&&(i.featureType=a,i.featureNS=r)}"string"==typeof r&&(s=r,(r={}).p0=s);d={};a=Array.isArray(a)?a:[a];for(var p in r){i={};s=0;for(n=a.length;s<n;++s)(-1===a[s].indexOf(":")?"p0":a[s].split(":")[0])===p&&(i[a[s].split(":").pop()]="featureMembers"==o?ol.xml.makeArrayPusher(this.readFeatureElement,this):ol.xml.makeReplacer(this.readFeatureElement,this));d[r[p]]=i}r="featureMember"==o?ol.xml.pushParseAndPop(void 0,d,e,t):ol.xml.pushParseAndPop([],d,e,t)}null===r&&(r=[]);return r};ol.format.GMLBase.prototype.readGeometryElement=function(e,t){var o=t[0];o.srsName=e.firstElementChild.getAttribute("srsName");o.srsDimension=e.firstElementChild.getAttribute("srsDimension");if(e=ol.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS_,e,t,this))return ol.format.Feature.transformWithOptions(e,!1,o)};ol.format.GMLBase.prototype.readFeatureElement=function(e,t){var o,r=e.getAttribute("fid")||ol.xml.getAttributeNS(e,ol.format.GMLBase.GMLNS,"id"),n={};for(e=e.firstElementChild;e;e=e.nextElementSibling){var i=e.localName;if(0===e.childNodes.length||1===e.childNodes.length&&(3===e.firstChild.nodeType||4===e.firstChild.nodeType)){var a=ol.xml.getAllTextContent(e,!1);ol.format.GMLBase.ONLY_WHITESPACE_RE_.test(a)&&(a=void 0);n[i]=a}else"boundedBy"!==i&&(o=i),n[i]=this.readGeometryElement(e,t)}t=new ol.Feature(n);o&&t.setGeometryName(o);r&&t.setId(r);return t};ol.format.GMLBase.prototype.readPoint=function(e,t){if(e=this.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.Point(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t};ol.format.GMLBase.prototype.readMultiPoint=function(e,t){if(e=ol.xml.pushParseAndPop([],this.MULTIPOINT_PARSERS_,e,t,this))return new ol.geom.MultiPoint(e)};ol.format.GMLBase.prototype.readMultiLineString=function(e,t){if(e=ol.xml.pushParseAndPop([],this.MULTILINESTRING_PARSERS_,e,t,this))return(t=new ol.geom.MultiLineString(null)).setLineStrings(e),t};ol.format.GMLBase.prototype.readMultiPolygon=function(e,t){if(e=ol.xml.pushParseAndPop([],this.MULTIPOLYGON_PARSERS_,e,t,this))return(t=new ol.geom.MultiPolygon(null)).setPolygons(e),t};ol.format.GMLBase.prototype.pointMemberParser_=function(e,t){ol.xml.parseNode(this.POINTMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.lineStringMemberParser_=function(e,t){ol.xml.parseNode(this.LINESTRINGMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.polygonMemberParser_=function(e,t){ol.xml.parseNode(this.POLYGONMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.readLineString=function(e,t){if(e=this.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t};ol.format.GMLBase.prototype.readFlatLinearRing_=function(e,t){if(e=ol.xml.pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this))return e};ol.format.GMLBase.prototype.readLinearRing=function(e,t){if(e=this.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.LinearRing(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t};ol.format.GMLBase.prototype.readPolygon=function(e,t){if((e=ol.xml.pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this))&&e[0]){t=new ol.geom.Polygon(null);var o,r=e[0],n=[r.length],i=1;for(o=e.length;i<o;++i)ol.array.extend(r,e[i]),n.push(r.length);t.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,r,n);return t}};ol.format.GMLBase.prototype.readFlatCoordinatesFromNode_=function(e,t){return ol.xml.pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.pointMemberParser_),pointMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.pointMemberParser_)}};ol.format.GMLBase.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.lineStringMemberParser_),lineStringMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.lineStringMemberParser_)}};ol.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.polygonMemberParser_),polygonMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.polygonMemberParser_)}};ol.format.GMLBase.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFlatCoordinatesFromNode_)}};ol.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readLineString)}};ol.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readPolygon)}};ol.format.GMLBase.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFlatLinearRing_)}};ol.format.GMLBase.prototype.readGeometryFromNode=function(e,t){return(e=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]))?e:null};ol.format.GMLBase.prototype.readFeaturesFromNode=function(e,t){var o={featureType:this.featureType,featureNS:this.featureNS};t&&ol.obj.assign(o,this.getReadOptions(e,t));return this.readFeaturesInternal(e,[o])||[]};ol.format.GMLBase.prototype.readProjectionFromNode=function(e){return ol.proj.get(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))};ol.format.XSD={};ol.format.XSD.NAMESPACE_URI="http://www.w3.org/2001/XMLSchema";ol.format.XSD.readBoolean=function(e){e=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readBooleanString(e)};ol.format.XSD.readBooleanString=function(e){if(e=/^\s*(true|1)|(false|0)\s*$/.exec(e))return void 0!==e[1]||!1};ol.format.XSD.readDateTime=function(e){e=ol.xml.getAllTextContent(e,!1);e=Date.parse(e);return isNaN(e)?void 0:e/1e3};ol.format.XSD.readDecimal=function(e){e=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readDecimalString(e)};ol.format.XSD.readDecimalString=function(e){if(e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e))return parseFloat(e[1])};ol.format.XSD.readNonNegativeInteger=function(e){e=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readNonNegativeIntegerString(e)};ol.format.XSD.readNonNegativeIntegerString=function(e){if(e=/^\s*(\d+)\s*$/.exec(e))return parseInt(e[1],10)};ol.format.XSD.readString=function(e){return ol.xml.getAllTextContent(e,!1).trim()};ol.format.XSD.writeBooleanTextNode=function(e,t){ol.format.XSD.writeStringTextNode(e,t?"1":"0")};ol.format.XSD.writeCDATASection=function(e,t){e.appendChild(ol.xml.DOCUMENT.createCDATASection(t))};ol.format.XSD.writeDateTimeTextNode=function(e,t){t=(t=new Date(1e3*t)).getUTCFullYear()+"-"+ol.string.padNumber(t.getUTCMonth()+1,2)+"-"+ol.string.padNumber(t.getUTCDate(),2)+"T"+ol.string.padNumber(t.getUTCHours(),2)+":"+ol.string.padNumber(t.getUTCMinutes(),2)+":"+ol.string.padNumber(t.getUTCSeconds(),2)+"Z";e.appendChild(ol.xml.DOCUMENT.createTextNode(t))};ol.format.XSD.writeDecimalTextNode=function(e,t){t=t.toPrecision();e.appendChild(ol.xml.DOCUMENT.createTextNode(t))};ol.format.XSD.writeNonNegativeIntegerTextNode=function(e,t){e.appendChild(ol.xml.DOCUMENT.createTextNode(t.toString()))};ol.format.XSD.writeStringTextNode=function(e,t){e.appendChild(ol.xml.DOCUMENT.createTextNode(t))};ol.format.GML3=function(e){e=e||{};ol.format.GMLBase.call(this,e);this.surface_=void 0!==e.surface&&e.surface;this.curve_=void 0!==e.curve&&e.curve;this.multiCurve_=void 0===e.multiCurve||e.multiCurve;this.multiSurface_=void 0===e.multiSurface||e.multiSurface;this.schemaLocation=e.schemaLocation?e.schemaLocation:ol.format.GML3.schemaLocation_;this.hasZ=void 0!==e.hasZ&&e.hasZ};ol.inherits(ol.format.GML3,ol.format.GMLBase);ol.format.GML3.schemaLocation_=ol.format.GMLBase.GMLNS+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd";ol.format.GML3.prototype.readMultiCurve_=function(e,t){if(e=ol.xml.pushParseAndPop([],this.MULTICURVE_PARSERS_,e,t,this))return(t=new ol.geom.MultiLineString(null)).setLineStrings(e),t};ol.format.GML3.prototype.readMultiSurface_=function(e,t){if(e=ol.xml.pushParseAndPop([],this.MULTISURFACE_PARSERS_,e,t,this))return(t=new ol.geom.MultiPolygon(null)).setPolygons(e),t};ol.format.GML3.prototype.curveMemberParser_=function(e,t){ol.xml.parseNode(this.CURVEMEMBER_PARSERS_,e,t,this)};ol.format.GML3.prototype.surfaceMemberParser_=function(e,t){ol.xml.parseNode(this.SURFACEMEMBER_PARSERS_,e,t,this)};ol.format.GML3.prototype.readPatch_=function(e,t){return ol.xml.pushParseAndPop([null],this.PATCHES_PARSERS_,e,t,this)};ol.format.GML3.prototype.readSegment_=function(e,t){return ol.xml.pushParseAndPop([null],this.SEGMENTS_PARSERS_,e,t,this)};ol.format.GML3.prototype.readPolygonPatch_=function(e,t){return ol.xml.pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this)};ol.format.GML3.prototype.readLineStringSegment_=function(e,t){return ol.xml.pushParseAndPop([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)};ol.format.GML3.prototype.interiorParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this))&&t[t.length-1].push(e)};ol.format.GML3.prototype.exteriorParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this))&&(t[t.length-1][0]=e)};ol.format.GML3.prototype.readSurface_=function(e,t){if((e=ol.xml.pushParseAndPop([null],this.SURFACE_PARSERS_,e,t,this))&&e[0]){t=new ol.geom.Polygon(null);var o,r=e[0],n=[r.length],i=1;for(o=e.length;i<o;++i)ol.array.extend(r,e[i]),n.push(r.length);t.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,r,n);return t}};ol.format.GML3.prototype.readCurve_=function(e,t){if(e=ol.xml.pushParseAndPop([null],this.CURVE_PARSERS_,e,t,this))return(t=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t};ol.format.GML3.prototype.readEnvelope_=function(e,t){e=ol.xml.pushParseAndPop([null],this.ENVELOPE_PARSERS_,e,t,this);return ol.extent.createOrUpdate(e[1][0],e[1][1],e[2][0],e[2][1])};ol.format.GML3.prototype.readFlatPos_=function(e,t){var o,r=ol.xml.getAllTextContent(e,!1),n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/;e=[];for(;o=n.exec(r);)e.push(parseFloat(o[1])),r=r.substr(o[0].length);if(""===r){t=t[0].srsName;r="enu";t&&(r=ol.proj.get(t).getAxisOrientation());if("neu"===r)for(t=0,r=e.length;t<r;t+=3)n=e[t],e[t]=e[t+1],e[t+1]=n;2==(t=e.length)&&e.push(0);if(0!==t)return e}};ol.format.GML3.prototype.readFlatPosList_=function(e,t){var o=ol.xml.getAllTextContent(e,!1).replace(/^\s*|\s*$/g,""),r=(t=t[0]).srsName,n=t.srsDimension;t="enu";r&&(t=ol.proj.get(r).getAxisOrientation());o=o.split(/\s+/);r=2;e.getAttribute("srsDimension")?r=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("srsDimension")):e.getAttribute("dimension")?r=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?r=ol.format.XSD.readNonNegativeIntegerString(e.parentNode.getAttribute("srsDimension")):n&&(r=ol.format.XSD.readNonNegativeIntegerString(n));for(var i,a=[],s=0,l=o.length;s<l;s+=r)e=parseFloat(o[s]),n=parseFloat(o[s+1]),i=3===r?parseFloat(o[s+2]):0,"en"===t.substr(0,2)?a.push(e,n,i):a.push(n,e,i);return a};ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{pos:ol.xml.makeReplacer(ol.format.GML3.prototype.readFlatPos_),posList:ol.xml.makeReplacer(ol.format.GML3.prototype.readFlatPosList_)}};ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{interior:ol.format.GML3.prototype.interiorParser_,exterior:ol.format.GML3.prototype.exteriorParser_}};ol.format.GML3.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPoint),MultiPoint:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPoint),LineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLineString),MultiLineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiLineString),LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLinearRing),Polygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPolygon),MultiPolygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPolygon),Surface:ol.xml.makeReplacer(ol.format.GML3.prototype.readSurface_),MultiSurface:ol.xml.makeReplacer(ol.format.GML3.prototype.readMultiSurface_),Curve:ol.xml.makeReplacer(ol.format.GML3.prototype.readCurve_),MultiCurve:ol.xml.makeReplacer(ol.format.GML3.prototype.readMultiCurve_),Envelope:ol.xml.makeReplacer(ol.format.GML3.prototype.readEnvelope_)}};ol.format.GML3.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:ol.xml.makeArrayPusher(ol.format.GML3.prototype.curveMemberParser_),curveMembers:ol.xml.makeArrayPusher(ol.format.GML3.prototype.curveMemberParser_)}};ol.format.GML3.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeArrayPusher(ol.format.GML3.prototype.surfaceMemberParser_),surfaceMembers:ol.xml.makeArrayPusher(ol.format.GML3.prototype.surfaceMemberParser_)}};ol.format.GML3.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readLineString),Curve:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readCurve_)}};ol.format.GML3.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readPolygon),Surface:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readSurface_)}};ol.format.GML3.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:ol.xml.makeReplacer(ol.format.GML3.prototype.readPatch_)}};ol.format.GML3.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:ol.xml.makeReplacer(ol.format.GML3.prototype.readSegment_)}};ol.format.GML3.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readFlatPosList_),upperCorner:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readFlatPosList_)}};ol.format.GML3.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:ol.xml.makeReplacer(ol.format.GML3.prototype.readPolygonPatch_)}};ol.format.GML3.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:ol.xml.makeReplacer(ol.format.GML3.prototype.readLineStringSegment_)}};ol.format.GML3.prototype.writePos_=function(e,t,o){var r=o[o.length-1];o=r.hasZ;e.setAttribute("srsDimension",o?3:2);var n=r.srsName;r="enu";n&&(r=ol.proj.get(n).getAxisOrientation());t=t.getCoordinates();r="en"===r.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];o&&(r+=" "+(t[2]||0));ol.format.XSD.writeStringTextNode(e,r)};ol.format.GML3.prototype.getCoords_=function(e,t,o){var r="enu";t&&(r=ol.proj.get(t).getAxisOrientation());t="en"===r.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0];o&&(t+=" "+(e[2]||0));return t};ol.format.GML3.prototype.writePosList_=function(e,t,o){var r=o[o.length-1];o=r.hasZ;e.setAttribute("srsDimension",o?3:2);r=r.srsName;for(var n,i=(t=t.getCoordinates()).length,a=Array(i),s=0;s<i;++s)n=t[s],a[s]=this.getCoords_(n,r,o);ol.format.XSD.writeStringTextNode(e,a.join(" "))};ol.format.GML3.prototype.writePoint_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);r=ol.xml.createElementNS(e.namespaceURI,"pos");e.appendChild(r);this.writePos_(r,t,o)};ol.format.GML3.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),upperCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};ol.format.GML3.prototype.writeEnvelope=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);ol.xml.pushSerializeAndPop({node:e},ol.format.GML3.ENVELOPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t[0]+" "+t[1],t[2]+" "+t[3]],o,["lowerCorner","upperCorner"],this)};ol.format.GML3.prototype.writeLinearRing_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);r=ol.xml.createElementNS(e.namespaceURI,"posList");e.appendChild(r);this.writePosList_(r,t,o)};ol.format.GML3.prototype.RING_NODE_FACTORY_=function(e,t,o){t=(e=t[t.length-1]).node;void 0===(o=e.exteriorWritten)&&(e.exteriorWritten=!0);return ol.xml.createElementNS(t.namespaceURI,void 0!==o?"interior":"exterior")};ol.format.GML3.prototype.writeSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],n=r.hasZ;r=r.srsName;"PolygonPatch"!==e.nodeName&&r&&e.setAttribute("srsName",r);"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName?(t=t.getLinearRings(),ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:r},ol.format.GML3.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,t,o,void 0,this)):"Surface"===e.nodeName&&(n=ol.xml.createElementNS(e.namespaceURI,"patches"),e.appendChild(n),this.writeSurfacePatches_(n,t,o))};ol.format.GML3.prototype.writeCurveOrLineString_=function(e,t,o){var r=o[o.length-1].srsName;"LineStringSegment"!==e.nodeName&&r&&e.setAttribute("srsName",r);"LineString"===e.nodeName||"LineStringSegment"===e.nodeName?(r=ol.xml.createElementNS(e.namespaceURI,"posList"),e.appendChild(r),this.writePosList_(r,t,o)):"Curve"===e.nodeName&&(r=ol.xml.createElementNS(e.namespaceURI,"segments"),e.appendChild(r),this.writeCurveSegments_(r,t,o))};ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],n=r.hasZ,i=r.srsName;r=r.surface;i&&e.setAttribute("srsName",i);t=t.getPolygons();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:i,surface:r},ol.format.GML3.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,t,o,void 0,this)};ol.format.GML3.prototype.writeMultiPoint_=function(e,t,o){var r=o[o.length-1],n=r.srsName;r=r.hasZ;n&&e.setAttribute("srsName",n);t=t.getPoints();ol.xml.pushSerializeAndPop({node:e,hasZ:r,srsName:n},ol.format.GML3.POINTMEMBER_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("pointMember"),t,o,void 0,this)};ol.format.GML3.prototype.writeMultiCurveOrLineString_=function(e,t,o){var r=o[o.length-1],n=r.hasZ,i=r.srsName;r=r.curve;i&&e.setAttribute("srsName",i);t=t.getLineStrings();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:i,curve:r},ol.format.GML3.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,t,o,void 0,this)};ol.format.GML3.prototype.writeRing_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LinearRing");e.appendChild(r);this.writeLinearRing_(r,t,o)};ol.format.GML3.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))};ol.format.GML3.prototype.writePointMember_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"Point");e.appendChild(r);this.writePoint_(r,t,o)};ol.format.GML3.prototype.writeLineStringOrCurveMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))};ol.format.GML3.prototype.writeSurfacePatches_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"PolygonPatch");e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)};ol.format.GML3.prototype.writeCurveSegments_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LineStringSegment");e.appendChild(r);this.writeCurveOrLineString_(r,t,o)};ol.format.GML3.prototype.writeGeometryElement=function(e,t,o){var r=o[o.length-1],n=ol.obj.assign({},r);n.node=e;e=Array.isArray(t)?r.dataProjection?ol.proj.transformExtent(t,r.featureProjection,r.dataProjection):t:ol.format.Feature.transformWithOptions(t,!0,r);ol.xml.pushSerializeAndPop(n,ol.format.GML3.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[e],o,void 0,this)};ol.format.GML3.prototype.writeFeatureElement=function(e,t,o){var r=t.getId();r&&e.setAttribute("fid",r);var n=(r=o[o.length-1]).featureNS,i=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[n]={});var a=t.getProperties();t=[];var s=[];for(c in a){var l=a[c];null!==l&&(t.push(c),s.push(l),c==i||l instanceof ol.geom.Geometry?c in r.serializers[n]||(r.serializers[n][c]=ol.xml.makeChildAppender(this.writeGeometryElement,this)):c in r.serializers[n]||(r.serializers[n][c]=ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)))}var c=ol.obj.assign({},r);c.node=e;ol.xml.pushSerializeAndPop(c,r.serializers,ol.xml.makeSimpleNodeFactory(void 0,n),s,o,t)};ol.format.GML3.prototype.writeFeatureMembers_=function(e,t,o){var r=o[o.length-1],n=r.featureType,i=r.featureNS,a={};a[i]={};a[i][n]=ol.xml.makeChildAppender(this.writeFeatureElement,this);(r=ol.obj.assign({},r)).node=e;ol.xml.pushSerializeAndPop(r,a,ol.xml.makeSimpleNodeFactory(n,i),t,o)};ol.format.GML3.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygonMember_),polygonMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygonMember_)}};ol.format.GML3.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writePointMember_)}};ol.format.GML3.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLineStringOrCurveMember_),curveMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLineStringOrCurveMember_)}};ol.format.GML3.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeRing_),interior:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeRing_)}};ol.format.GML3.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeCurveOrLineString_),MultiCurve:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiCurveOrLineString_),Point:ol.xml.makeChildAppender(ol.format.GML3.prototype.writePoint_),MultiPoint:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiPoint_),LineString:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeCurveOrLineString_),MultiLineString:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiCurveOrLineString_),LinearRing:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLinearRing_),Polygon:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygon_),MultiPolygon:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_),Surface:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygon_),MultiSurface:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_),Envelope:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeEnvelope)}};ol.format.GML3.MULTIGEOMETRY_TO_MEMBER_NODENAME_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};ol.format.GML3.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,o){return ol.xml.createElementNS("http://www.opengis.net/gml",ol.format.GML3.MULTIGEOMETRY_TO_MEMBER_NODENAME_[t[t.length-1].node.nodeName])};ol.format.GML3.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1];t=r.multiSurface;o=r.surface;var n=r.curve;r=r.multiCurve;Array.isArray(e)?e="Envelope":"MultiPolygon"===(e=e.getType())&&!0===t?e="MultiSurface":"Polygon"===e&&!0===o?e="Surface":"LineString"===e&&!0===n?e="Curve":"MultiLineString"===e&&!0===r&&(e="MultiCurve");return ol.xml.createElementNS("http://www.opengis.net/gml",e)};ol.format.GML3.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.opengis.net/gml","geom"),r={node:o,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};t&&ol.obj.assign(r,t);this.writeGeometryElement(o,e,[r]);return o};ol.format.GML3.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.opengis.net/gml","featureMembers");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation);var r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};t&&ol.obj.assign(r,t);this.writeFeatureMembers_(o,e,[r]);return o};ol.format.GML=ol.format.GML3;ol.format.GML2=function(e){e=e||{};ol.format.GMLBase.call(this,e);this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS].featureMember=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal);this.schemaLocation=e.schemaLocation?e.schemaLocation:ol.format.GML2.schemaLocation_};ol.inherits(ol.format.GML2,ol.format.GMLBase);ol.format.GML2.schemaLocation_=ol.format.GMLBase.GMLNS+" http://schemas.opengis.net/gml/2.1.2/feature.xsd";ol.format.GML2.prototype.readFlatCoordinates_=function(e,t){e=ol.xml.getAllTextContent(e,!1).replace(/^\s*|\s*$/g,"");var o=t[0].srsName;t="enu";o&&(o=ol.proj.get(o))&&(t=o.getAxisOrientation());for(var r,n,i=[],a=0,s=(e=e.trim().split(/\s+/)).length;a<s;a++)n=e[a].split(/,+/),o=parseFloat(n[0]),r=parseFloat(n[1]),n=3===n.length?parseFloat(n[2]):0,"en"===t.substr(0,2)?i.push(o,r,n):i.push(r,o,n);return i};ol.format.GML2.prototype.readBox_=function(e,t){e=ol.xml.pushParseAndPop([null],this.BOX_PARSERS_,e,t,this);return ol.extent.createOrUpdate(e[1][0],e[1][1],e[1][3],e[1][4])};ol.format.GML2.prototype.innerBoundaryIsParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this))&&t[t.length-1].push(e)};ol.format.GML2.prototype.outerBoundaryIsParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this))&&(t[t.length-1][0]=e)};ol.format.GML2.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{coordinates:ol.xml.makeReplacer(ol.format.GML2.prototype.readFlatCoordinates_)}};ol.format.GML2.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{innerBoundaryIs:ol.format.GML2.prototype.innerBoundaryIsParser_,outerBoundaryIs:ol.format.GML2.prototype.outerBoundaryIsParser_}};ol.format.GML2.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ol.xml.makeArrayPusher(ol.format.GML2.prototype.readFlatCoordinates_)}};ol.format.GML2.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPoint),MultiPoint:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPoint),LineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLineString),MultiLineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiLineString),LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLinearRing),Polygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPolygon),MultiPolygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPolygon),Box:ol.xml.makeReplacer(ol.format.GML2.prototype.readBox_)}};ol.format.GML2.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1];t=r.multiSurface;o=r.surface;r=r.multiCurve;Array.isArray(e)?e="Envelope":"MultiPolygon"===(e=e.getType())&&!0===t?e="MultiSurface":"Polygon"===e&&!0===o?e="Surface":"MultiLineString"===e&&!0===r&&(e="MultiCurve");return ol.xml.createElementNS("http://www.opengis.net/gml",e)};ol.format.GML2.prototype.writeFeatureElement=function(e,t,o){var r=t.getId();r&&e.setAttribute("fid",r);var n=(r=o[o.length-1]).featureNS,i=t.getGeometryName();r.serializers||(r.serializers={},r.serializers[n]={});var a=t.getProperties();t=[];var s=[];for(c in a){var l=a[c];null!==l&&(t.push(c),s.push(l),c==i||l instanceof ol.geom.Geometry?c in r.serializers[n]||(r.serializers[n][c]=ol.xml.makeChildAppender(this.writeGeometryElement,this)):c in r.serializers[n]||(r.serializers[n][c]=ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)))}var c=ol.obj.assign({},r);c.node=e;ol.xml.pushSerializeAndPop(c,r.serializers,ol.xml.makeSimpleNodeFactory(void 0,n),s,o,t)};ol.format.GML2.prototype.writeGeometryElement=function(e,t,o){var r=o[o.length-1],n=ol.obj.assign({},r);n.node=e;e=Array.isArray(t)?r.dataProjection?ol.proj.transformExtent(t,r.featureProjection,r.dataProjection):t:ol.format.Feature.transformWithOptions(t,!0,r);ol.xml.pushSerializeAndPop(n,ol.format.GML2.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[e],o,void 0,this)};ol.format.GML2.prototype.writeCurveOrLineString_=function(e,t,o){var r=o[o.length-1].srsName;"LineStringSegment"!==e.nodeName&&r&&e.setAttribute("srsName",r);"LineString"===e.nodeName||"LineStringSegment"===e.nodeName?(r=this.createCoordinatesNode_(e.namespaceURI),e.appendChild(r),this.writeCoordinates_(r,t,o)):"Curve"===e.nodeName&&(r=ol.xml.createElementNS(e.namespaceURI,"segments"),e.appendChild(r),this.writeCurveSegments_(r,t,o))};ol.format.GML2.prototype.createCoordinatesNode_=function(e){(e=ol.xml.createElementNS(e,"coordinates")).setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");return e};ol.format.GML2.prototype.writeCoordinates_=function(e,t,o){var r=o[o.length-1];o=r.hasZ;r=r.srsName;for(var n,i=(t=t.getCoordinates()).length,a=Array(i),s=0;s<i;++s)n=t[s],a[s]=this.getCoords_(n,r,o);ol.format.XSD.writeStringTextNode(e,a.join(" "))};ol.format.GML2.prototype.writeCurveSegments_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LineStringSegment");e.appendChild(r);this.writeCurveOrLineString_(r,t,o)};ol.format.GML2.prototype.writeSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],n=r.hasZ;r=r.srsName;"PolygonPatch"!==e.nodeName&&r&&e.setAttribute("srsName",r);"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName?(t=t.getLinearRings(),ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:r},ol.format.GML2.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,t,o,void 0,this)):"Surface"===e.nodeName&&(n=ol.xml.createElementNS(e.namespaceURI,"patches"),e.appendChild(n),this.writeSurfacePatches_(n,t,o))};ol.format.GML2.prototype.RING_NODE_FACTORY_=function(e,t,o){t=(e=t[t.length-1]).node;void 0===(o=e.exteriorWritten)&&(e.exteriorWritten=!0);return ol.xml.createElementNS(t.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")};ol.format.GML2.prototype.writeSurfacePatches_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"PolygonPatch");e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)};ol.format.GML2.prototype.writeRing_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LinearRing");e.appendChild(r);this.writeLinearRing_(r,t,o)};ol.format.GML2.prototype.getCoords_=function(e,t,o){var r="enu";t&&(r=ol.proj.get(t).getAxisOrientation());t="en"===r.substr(0,2)?e[0]+","+e[1]:e[1]+","+e[0];o&&(t+=","+(e[2]||0));return t};ol.format.GML2.prototype.writeMultiCurveOrLineString_=function(e,t,o){var r=o[o.length-1],n=r.hasZ,i=r.srsName;r=r.curve;i&&e.setAttribute("srsName",i);t=t.getLineStrings();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:i,curve:r},ol.format.GML2.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,t,o,void 0,this)};ol.format.GML2.prototype.writePoint_=function(e,t,o){var r=o[o.length-1];o=r.hasZ;var n=r.srsName;n&&e.setAttribute("srsName",n);r=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(r);e=t.getCoordinates();e=this.getCoords_(e,n,o);ol.format.XSD.writeStringTextNode(r,e)};ol.format.GML2.prototype.writeMultiPoint_=function(e,t,o){var r=o[o.length-1],n=r.hasZ;(r=r.srsName)&&e.setAttribute("srsName",r);t=t.getPoints();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:r},ol.format.GML2.POINTMEMBER_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("pointMember"),t,o,void 0,this)};ol.format.GML2.prototype.writePointMember_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"Point");e.appendChild(r);this.writePoint_(r,t,o)};ol.format.GML2.prototype.writeLineStringOrCurveMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))};ol.format.GML2.prototype.writeLinearRing_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);r=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(r);this.writeCoordinates_(r,t,o)};ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],n=r.hasZ,i=r.srsName;r=r.surface;i&&e.setAttribute("srsName",i);t=t.getPolygons();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:i,surface:r},ol.format.GML2.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,t,o,void 0,this)};ol.format.GML2.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))};ol.format.GML2.prototype.writeEnvelope=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);ol.xml.pushSerializeAndPop({node:e},ol.format.GML2.ENVELOPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t[0]+" "+t[1],t[2]+" "+t[3]],o,["lowerCorner","upperCorner"],this)};ol.format.GML2.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeCurveOrLineString_),MultiCurve:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiCurveOrLineString_),Point:ol.xml.makeChildAppender(ol.format.GML2.prototype.writePoint_),MultiPoint:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiPoint_),LineString:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeCurveOrLineString_),MultiLineString:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiCurveOrLineString_),LinearRing:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLinearRing_),Polygon:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygon_),MultiPolygon:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_),Surface:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygon_),MultiSurface:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_),Envelope:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeEnvelope)}};ol.format.GML2.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeRing_),innerBoundaryIs:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeRing_)}};ol.format.GML2.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writePointMember_)}};ol.format.GML2.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLineStringOrCurveMember_),curveMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLineStringOrCurveMember_)}};ol.format.GML2.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,o){return ol.xml.createElementNS("http://www.opengis.net/gml",ol.format.GML2.MULTIGEOMETRY_TO_MEMBER_NODENAME_[t[t.length-1].node.nodeName])};ol.format.GML2.MULTIGEOMETRY_TO_MEMBER_NODENAME_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};ol.format.GML2.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygonMember_),polygonMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygonMember_)}};ol.format.GML2.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),upperCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};ol.format.GPX=function(e){e=e||{};ol.format.XMLFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.readExtensions_=e.readExtensions};ol.inherits(ol.format.GPX,ol.format.XMLFeature);ol.format.GPX.NAMESPACE_URIS_=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];ol.format.GPX.SCHEMA_LOCATION_="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd";ol.format.GPX.appendCoordinate_=function(e,t,o,r){e.push(parseFloat(o.getAttribute("lon")),parseFloat(o.getAttribute("lat")));"ele"in r?(e.push(r.ele),delete r.ele,t.hasZ=!0):e.push(0);"time"in r?(e.push(r.time),delete r.time,t.hasM=!0):e.push(0);return e};ol.format.GPX.applyLayoutOptions_=function(e,t,o){var r=ol.geom.GeometryLayout.XY,n=2;e.hasZ&&e.hasM?(r=ol.geom.GeometryLayout.XYZM,n=4):e.hasZ?(r=ol.geom.GeometryLayout.XYZ,n=3):e.hasM&&(r=ol.geom.GeometryLayout.XYM,n=3);if(4!==n){var i,a=0;for(i=t.length/4;a<i;a++)t[a*n]=t[4*a],t[a*n+1]=t[4*a+1],e.hasZ&&(t[a*n+2]=t[4*a+2]),e.hasM&&(t[a*n+2]=t[4*a+3]);t.length=t.length/4*n;if(o)for(a=0,i=o.length;a<i;a++)o[a]=o[a]/4*n}return r};ol.format.GPX.parseLink_=function(e,t){var o=t[t.length-1],r=e.getAttribute("href");null!==r&&(o.link=r);ol.xml.parseNode(ol.format.GPX.LINK_PARSERS_,e,t)};ol.format.GPX.parseExtensions_=function(e,t){t[t.length-1].extensionsNode_=e};ol.format.GPX.parseRtePt_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.GPX.RTEPT_PARSERS_,e,t);o&&(t=t[t.length-1],ol.format.GPX.appendCoordinate_(t.flatCoordinates,t.layoutOptions,e,o))};ol.format.GPX.parseTrkPt_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.GPX.TRKPT_PARSERS_,e,t);o&&(t=t[t.length-1],ol.format.GPX.appendCoordinate_(t.flatCoordinates,t.layoutOptions,e,o))};ol.format.GPX.parseTrkSeg_=function(e,t){var o=t[t.length-1];ol.xml.parseNode(ol.format.GPX.TRKSEG_PARSERS_,e,t);o.ends.push(o.flatCoordinates.length)};ol.format.GPX.readRte_=function(e,t){var o=t[0];if(e=ol.xml.pushParseAndPop({flatCoordinates:[],layoutOptions:{}},ol.format.GPX.RTE_PARSERS_,e,t)){t=e.flatCoordinates;delete e.flatCoordinates;var r=e.layoutOptions;delete e.layoutOptions;r=ol.format.GPX.applyLayoutOptions_(r,t);var n=new ol.geom.LineString(null);n.setFlatCoordinates(r,t);ol.format.Feature.transformWithOptions(n,!1,o);(o=new ol.Feature(n)).setProperties(e);return o}};ol.format.GPX.readTrk_=function(e,t){var o=t[0];if(e=ol.xml.pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},ol.format.GPX.TRK_PARSERS_,e,t)){t=e.flatCoordinates;delete e.flatCoordinates;var r=e.ends;delete e.ends;var n=e.layoutOptions;delete e.layoutOptions;n=ol.format.GPX.applyLayoutOptions_(n,t,r);var i=new ol.geom.MultiLineString(null);i.setFlatCoordinates(n,t,r);ol.format.Feature.transformWithOptions(i,!1,o);(o=new ol.Feature(i)).setProperties(e);return o}};ol.format.GPX.readWpt_=function(e,t){var o=t[0];if(t=ol.xml.pushParseAndPop({},ol.format.GPX.WPT_PARSERS_,e,t)){var r={};e=ol.format.GPX.appendCoordinate_([],r,e,t);r=ol.format.GPX.applyLayoutOptions_(r,e);e=new ol.geom.Point(e,r);ol.format.Feature.transformWithOptions(e,!1,o);(o=new ol.Feature(e)).setProperties(t);return o}};ol.format.GPX.FEATURE_READER_={rte:ol.format.GPX.readRte_,trk:ol.format.GPX.readTrk_,wpt:ol.format.GPX.readWpt_};ol.format.GPX.GPX_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{rte:ol.xml.makeArrayPusher(ol.format.GPX.readRte_),trk:ol.xml.makeArrayPusher(ol.format.GPX.readTrk_),wpt:ol.xml.makeArrayPusher(ol.format.GPX.readWpt_)});ol.format.GPX.LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{text:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString,"linkText"),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString,"linkType")});ol.format.GPX.RTE_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,number:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),extensions:ol.format.GPX.parseExtensions_,type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),rtept:ol.format.GPX.parseRtePt_});ol.format.GPX.RTEPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime)});ol.format.GPX.TRK_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,number:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),extensions:ol.format.GPX.parseExtensions_,trkseg:ol.format.GPX.parseTrkSeg_});ol.format.GPX.TRKSEG_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{trkpt:ol.format.GPX.parseTrkPt_});ol.format.GPX.TRKPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime)});ol.format.GPX.WPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime),magvar:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),geoidheight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,sym:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),fix:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),sat:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),hdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),vdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),pdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),ageofdgpsdata:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),dgpsid:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),extensions:ol.format.GPX.parseExtensions_});ol.format.GPX.prototype.handleReadExtensions_=function(e){e||(e=[]);for(var t=0,o=e.length;t<o;++t){var r=e[t];if(this.readExtensions_){var n=r.get("extensionsNode_")||null;this.readExtensions_(r,n)}r.set("extensionsNode_",void 0)}};ol.format.GPX.prototype.readFeatureFromNode=function(e,t){if(!ol.array.includes(ol.format.GPX.NAMESPACE_URIS_,e.namespaceURI))return null;var o=ol.format.GPX.FEATURE_READER_[e.localName];if(!o)return null;if(!(e=o(e,[this.getReadOptions(e,t)])))return null;this.handleReadExtensions_([e]);return e};ol.format.GPX.prototype.readFeaturesFromNode=function(e,t){return ol.array.includes(ol.format.GPX.NAMESPACE_URIS_,e.namespaceURI)&&"gpx"==e.localName&&(e=ol.xml.pushParseAndPop([],ol.format.GPX.GPX_PARSERS_,e,[this.getReadOptions(e,t)]))?(this.handleReadExtensions_(e),e):[]};ol.format.GPX.writeLink_=function(e,t,o){e.setAttribute("href",t);t=o[o.length-1].properties;ol.xml.pushSerializeAndPop({node:e},ol.format.GPX.LINK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t.linkText,t.linkType],o,ol.format.GPX.LINK_SEQUENCE_)};ol.format.GPX.writeWptType_=function(e,t,o){var r=o[o.length-1],n=r.node.namespaceURI,i=r.properties;ol.xml.setAttributeNS(e,null,"lat",t[1]);ol.xml.setAttributeNS(e,null,"lon",t[0]);switch(r.geometryLayout){case ol.geom.GeometryLayout.XYZM:0!==t[3]&&(i.time=t[3]);case ol.geom.GeometryLayout.XYZ:0!==t[2]&&(i.ele=t[2]);break;case ol.geom.GeometryLayout.XYM:0!==t[2]&&(i.time=t[2])}t="rtept"==e.nodeName?ol.format.GPX.RTEPT_TYPE_SEQUENCE_[n]:ol.format.GPX.WPT_TYPE_SEQUENCE_[n];r=ol.xml.makeSequence(i,t);ol.xml.pushSerializeAndPop({node:e,properties:i},ol.format.GPX.WPT_TYPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,r,o,t)};ol.format.GPX.writeRte_=function(e,t,o){var r=o[0],n=t.getProperties();e={node:e,properties:n};(t=t.getGeometry())&&(t=ol.format.Feature.transformWithOptions(t,!0,r),e.geometryLayout=t.getLayout(),n.rtept=t.getCoordinates());r=ol.format.GPX.RTE_SEQUENCE_[o[o.length-1].node.namespaceURI];n=ol.xml.makeSequence(n,r);ol.xml.pushSerializeAndPop(e,ol.format.GPX.RTE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,n,o,r)};ol.format.GPX.writeTrk_=function(e,t,o){var r=o[0],n=t.getProperties();e={node:e,properties:n};(t=t.getGeometry())&&(t=ol.format.Feature.transformWithOptions(t,!0,r),n.trkseg=t.getLineStrings());r=ol.format.GPX.TRK_SEQUENCE_[o[o.length-1].node.namespaceURI];n=ol.xml.makeSequence(n,r);ol.xml.pushSerializeAndPop(e,ol.format.GPX.TRK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,n,o,r)};ol.format.GPX.writeTrkSeg_=function(e,t,o){e={node:e,geometryLayout:t.getLayout(),properties:{}};ol.xml.pushSerializeAndPop(e,ol.format.GPX.TRKSEG_SERIALIZERS_,ol.format.GPX.TRKSEG_NODE_FACTORY_,t.getCoordinates(),o)};ol.format.GPX.writeWpt_=function(e,t,o){var r=o[0],n=o[o.length-1];n.properties=t.getProperties();(t=t.getGeometry())&&(t=ol.format.Feature.transformWithOptions(t,!0,r),n.geometryLayout=t.getLayout(),ol.format.GPX.writeWptType_(e,t.getCoordinates(),o))};ol.format.GPX.LINK_SEQUENCE_=["text","type"];ol.format.GPX.LINK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{text:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)});ol.format.GPX.RTE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,"name cmt desc src link number type rtept".split(" "));ol.format.GPX.RTE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),number:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),rtept:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(ol.format.GPX.writeWptType_))});ol.format.GPX.RTEPT_TYPE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,["ele","time"]);ol.format.GPX.TRK_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,"name cmt desc src link number type trkseg".split(" "));ol.format.GPX.TRK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),number:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),trkseg:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(ol.format.GPX.writeTrkSeg_))});ol.format.GPX.TRKSEG_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("trkpt");ol.format.GPX.TRKSEG_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{trkpt:ol.xml.makeChildAppender(ol.format.GPX.writeWptType_)});ol.format.GPX.WPT_TYPE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,"ele time magvar geoidheight name cmt desc src link sym type fix sat hdop vdop pdop ageofdgpsdata dgpsid".split(" "));ol.format.GPX.WPT_TYPE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),time:ol.xml.makeChildAppender(ol.format.XSD.writeDateTimeTextNode),magvar:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),geoidheight:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),sym:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),fix:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),sat:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),hdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),vdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),pdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),ageofdgpsdata:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),dgpsid:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode)});ol.format.GPX.GEOMETRY_TYPE_TO_NODENAME_={Point:"wpt",LineString:"rte",MultiLineString:"trk"};ol.format.GPX.GPX_NODE_FACTORY_=function(e,t,o){if((e=e.getGeometry())&&(e=ol.format.GPX.GEOMETRY_TYPE_TO_NODENAME_[e.getType()]))return ol.xml.createElementNS(t[t.length-1].node.namespaceURI,e)};ol.format.GPX.GPX_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{rte:ol.xml.makeChildAppender(ol.format.GPX.writeRte_),trk:ol.xml.makeChildAppender(ol.format.GPX.writeTrk_),wpt:ol.xml.makeChildAppender(ol.format.GPX.writeWpt_)});ol.format.GPX.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.topografix.com/GPX/1/1","gpx");ol.xml.setAttributeNS(o,"http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",ol.format.GPX.SCHEMA_LOCATION_);o.setAttribute("version","1.1");o.setAttribute("creator","OpenLayers");ol.xml.pushSerializeAndPop({node:o},ol.format.GPX.GPX_SERIALIZERS_,ol.format.GPX.GPX_NODE_FACTORY_,e,[t]);return o};ol.geom.GeometryCollection=function(e){ol.geom.Geometry.call(this);this.geometries_=e||null;this.listenGeometriesChange_()};ol.inherits(ol.geom.GeometryCollection,ol.geom.Geometry);ol.geom.GeometryCollection.cloneGeometries_=function(e){var t,o=[],r=0;for(t=e.length;r<t;++r)o.push(e[r].clone());return o};ol.geom.GeometryCollection.prototype.unlistenGeometriesChange_=function(){var e;if(this.geometries_){var t=0;for(e=this.geometries_.length;t<e;++t)ol.events.unlisten(this.geometries_[t],ol.events.EventType.CHANGE,this.changed,this)}};ol.geom.GeometryCollection.prototype.listenGeometriesChange_=function(){var e;if(this.geometries_){var t=0;for(e=this.geometries_.length;t<e;++t)ol.events.listen(this.geometries_[t],ol.events.EventType.CHANGE,this.changed,this)}};ol.geom.GeometryCollection.prototype.clone=function(){var e=new ol.geom.GeometryCollection(null);e.setGeometries(this.geometries_);return e};ol.geom.GeometryCollection.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;var n,i=this.geometries_,a=0;for(n=i.length;a<n;++a)r=i[a].closestPointXY(e,t,o,r);return r};ol.geom.GeometryCollection.prototype.containsXY=function(e,t){var o,r=this.geometries_,n=0;for(o=r.length;n<o;++n)if(r[n].containsXY(e,t))return!0;return!1};ol.geom.GeometryCollection.prototype.computeExtent=function(e){ol.extent.createOrUpdateEmpty(e);for(var t=this.geometries_,o=0,r=t.length;o<r;++o)ol.extent.extend(e,t[o].getExtent());return e};ol.geom.GeometryCollection.prototype.getGeometries=function(){return ol.geom.GeometryCollection.cloneGeometries_(this.geometries_)};ol.geom.GeometryCollection.prototype.getGeometriesArray=function(){return this.geometries_};ol.geom.GeometryCollection.prototype.getSimplifiedGeometry=function(e){this.simplifiedGeometryRevision!=this.getRevision()&&(ol.obj.clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision());if(0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];var o,r=[],n=this.geometries_,i=!1,a=0;for(o=n.length;a<o;++a){var s=n[a],l=s.getSimplifiedGeometry(e);r.push(l);l!==s&&(i=!0)}if(i)return(e=new ol.geom.GeometryCollection(null)).setGeometriesArray(r),this.simplifiedGeometryCache[t]=e;this.simplifiedGeometryMaxMinSquaredTolerance=e;return this};ol.geom.GeometryCollection.prototype.getType=function(){return ol.geom.GeometryType.GEOMETRY_COLLECTION};ol.geom.GeometryCollection.prototype.intersectsExtent=function(e){var t,o=this.geometries_,r=0;for(t=o.length;r<t;++r)if(o[r].intersectsExtent(e))return!0;return!1};ol.geom.GeometryCollection.prototype.isEmpty=function(){return 0===this.geometries_.length};ol.geom.GeometryCollection.prototype.rotate=function(e,t){for(var o=this.geometries_,r=0,n=o.length;r<n;++r)o[r].rotate(e,t);this.changed()};ol.geom.GeometryCollection.prototype.scale=function(e,t,o){o||(o=ol.extent.getCenter(this.getExtent()));for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].scale(e,t,o);this.changed()};ol.geom.GeometryCollection.prototype.setGeometries=function(e){this.setGeometriesArray(ol.geom.GeometryCollection.cloneGeometries_(e))};ol.geom.GeometryCollection.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_();this.geometries_=e;this.listenGeometriesChange_();this.changed()};ol.geom.GeometryCollection.prototype.applyTransform=function(e){var t,o=this.geometries_,r=0;for(t=o.length;r<t;++r)o[r].applyTransform(e);this.changed()};ol.geom.GeometryCollection.prototype.translate=function(e,t){var o,r=this.geometries_,n=0;for(o=r.length;n<o;++n)r[n].translate(e,t);this.changed()};ol.geom.GeometryCollection.prototype.disposeInternal=function(){this.unlistenGeometriesChange_();ol.geom.Geometry.prototype.disposeInternal.call(this)};ol.format.GeoJSON=function(e){e=e||{};ol.format.JSONFeature.call(this);this.defaultDataProjection=ol.proj.get(e.defaultDataProjection?e.defaultDataProjection:"EPSG:4326");e.featureProjection&&(this.defaultFeatureProjection=ol.proj.get(e.featureProjection));this.geometryName_=e.geometryName;this.extractGeometryName_=e.extractGeometryName};ol.inherits(ol.format.GeoJSON,ol.format.JSONFeature);ol.format.GeoJSON.readGeometry_=function(e,t){return e?ol.format.Feature.transformWithOptions((0,ol.format.GeoJSON.GEOMETRY_READERS_[e.type])(e),!1,t):null};ol.format.GeoJSON.readGeometryCollectionGeometry_=function(e,t){e=e.geometries.map(function(e){return ol.format.GeoJSON.readGeometry_(e,t)});return new ol.geom.GeometryCollection(e)};ol.format.GeoJSON.readPointGeometry_=function(e){return new ol.geom.Point(e.coordinates)};ol.format.GeoJSON.readLineStringGeometry_=function(e){return new ol.geom.LineString(e.coordinates)};ol.format.GeoJSON.readMultiLineStringGeometry_=function(e){return new ol.geom.MultiLineString(e.coordinates)};ol.format.GeoJSON.readMultiPointGeometry_=function(e){return new ol.geom.MultiPoint(e.coordinates)};ol.format.GeoJSON.readMultiPolygonGeometry_=function(e){return new ol.geom.MultiPolygon(e.coordinates)};ol.format.GeoJSON.readPolygonGeometry_=function(e){return new ol.geom.Polygon(e.coordinates)};ol.format.GeoJSON.writeGeometry_=function(e,t){return(0,ol.format.GeoJSON.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)};ol.format.GeoJSON.writeEmptyGeometryCollectionGeometry_=function(e){return{type:"GeometryCollection",geometries:[]}};ol.format.GeoJSON.writeGeometryCollectionGeometry_=function(e,t){return{type:"GeometryCollection",geometries:e.getGeometriesArray().map(function(e){var o=ol.obj.assign({},t);delete o.featureProjection;return ol.format.GeoJSON.writeGeometry_(e,o)})}};ol.format.GeoJSON.writeLineStringGeometry_=function(e,t){return{type:"LineString",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiLineStringGeometry_=function(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiPointGeometry_=function(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiPolygonGeometry_=function(e,t){if(t)var o=t.rightHanded;return{type:"MultiPolygon",coordinates:e.getCoordinates(o)}};ol.format.GeoJSON.writePointGeometry_=function(e,t){return{type:"Point",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writePolygonGeometry_=function(e,t){if(t)var o=t.rightHanded;return{type:"Polygon",coordinates:e.getCoordinates(o)}};ol.format.GeoJSON.GEOMETRY_READERS_={Point:ol.format.GeoJSON.readPointGeometry_,LineString:ol.format.GeoJSON.readLineStringGeometry_,Polygon:ol.format.GeoJSON.readPolygonGeometry_,MultiPoint:ol.format.GeoJSON.readMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.readMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.readGeometryCollectionGeometry_};ol.format.GeoJSON.GEOMETRY_WRITERS_={Point:ol.format.GeoJSON.writePointGeometry_,LineString:ol.format.GeoJSON.writeLineStringGeometry_,Polygon:ol.format.GeoJSON.writePolygonGeometry_,MultiPoint:ol.format.GeoJSON.writeMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.writeMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.writeMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.writeGeometryCollectionGeometry_,Circle:ol.format.GeoJSON.writeEmptyGeometryCollectionGeometry_};ol.format.GeoJSON.prototype.readFeatureFromObject=function(e,t){e="Feature"===e.type?e:{type:"Feature",geometry:e};t=ol.format.GeoJSON.readGeometry_(e.geometry,t);var o=new ol.Feature;this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&void 0!==e.geometry_name&&o.setGeometryName(e.geometry_name);o.setGeometry(t);void 0!==e.id&&o.setId(e.id);e.properties&&o.setProperties(e.properties);return o};ol.format.GeoJSON.prototype.readFeaturesFromObject=function(e,t){if("FeatureCollection"===e.type){var o,r=[],n=0;for(o=(e=e.features).length;n<o;++n)r.push(this.readFeatureFromObject(e[n],t))}else r=[this.readFeatureFromObject(e,t)];return r};ol.format.GeoJSON.prototype.readGeometryFromObject=function(e,t){return ol.format.GeoJSON.readGeometry_(e,t)};ol.format.GeoJSON.prototype.readProjectionFromObject=function(e){var t;(e=e.crs)?"name"==e.type?t=ol.proj.get(e.properties.name):ol.asserts.assert(!1,36):t=this.defaultDataProjection;return t};ol.format.GeoJSON.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var o={type:"Feature"},r=e.getId();void 0!==r&&(o.id=r);r=e.getGeometry();o.geometry=r?ol.format.GeoJSON.writeGeometry_(r,t):null;delete(t=e.getProperties())[e.getGeometryName()];ol.obj.isEmpty(t)?o.properties=null:o.properties=t;return o};ol.format.GeoJSON.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);var o,r=[],n=0;for(o=e.length;n<o;++n)r.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:r}};ol.format.GeoJSON.prototype.writeGeometryObject=function(e,t){return ol.format.GeoJSON.writeGeometry_(e,this.adaptOptions(t))};ol.format.IGCZ={BAROMETRIC:"barometric",GPS:"gps",NONE:"none"};ol.format.TextFeature=function(){ol.format.Feature.call(this)};ol.inherits(ol.format.TextFeature,ol.format.Feature);ol.format.TextFeature.prototype.getText_=function(e){return"string"==typeof e?e:""};ol.format.TextFeature.prototype.getType=function(){return ol.format.FormatType.TEXT};ol.format.TextFeature.prototype.readFeature=function(e,t){return this.readFeatureFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readFeatureFromText=function(e,t){};ol.format.TextFeature.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readFeaturesFromText=function(e,t){};ol.format.TextFeature.prototype.readGeometry=function(e,t){return this.readGeometryFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readGeometryFromText=function(e,t){};ol.format.TextFeature.prototype.readProjection=function(e){return this.readProjectionFromText(this.getText_(e))};ol.format.TextFeature.prototype.readProjectionFromText=function(e){return this.defaultDataProjection};ol.format.TextFeature.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeFeatureText=function(e,t){};ol.format.TextFeature.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeFeaturesText=function(e,t){};ol.format.TextFeature.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeGeometryText=function(e,t){};ol.format.IGC=function(e){e=e||{};ol.format.TextFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.altitudeMode_=e.altitudeMode?e.altitudeMode:ol.format.IGCZ.NONE};ol.inherits(ol.format.IGC,ol.format.TextFeature);ol.format.IGC.B_RECORD_RE_=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/;ol.format.IGC.H_RECORD_RE_=/^H.([A-Z]{3}).*?:(.*)/;ol.format.IGC.HFDTE_RECORD_RE_=/^HFDTE(\d{2})(\d{2})(\d{2})/;ol.format.IGC.NEWLINE_RE_=/\r\n|\r|\n/;ol.format.IGC.prototype.readFeatureFromText=function(e,t){var o=this.altitudeMode_,r=e.split(ol.format.IGC.NEWLINE_RE_);e={};var n,i=[],a=2e3,s=0,l=1,c=-1,u=0;for(n=r.length;u<n;++u){var h,d=r[u];if("B"==d.charAt(0)){if(h=ol.format.IGC.B_RECORD_RE_.exec(d)){d=parseInt(h[1],10);var p=parseInt(h[2],10),f=parseInt(h[3],10),g=parseInt(h[4],10)+parseInt(h[5],10)/6e4;"S"==h[6]&&(g=-g);var m=parseInt(h[7],10)+parseInt(h[8],10)/6e4;"W"==h[9]&&(m=-m);i.push(m,g);o!=ol.format.IGCZ.NONE&&(h=o==ol.format.IGCZ.GPS?parseInt(h[11],10):o==ol.format.IGCZ.BAROMETRIC?parseInt(h[12],10):0,i.push(h));(h=Date.UTC(a,s,l,d,p,f))<c&&(h=Date.UTC(a,s,l+1,d,p,f));i.push(h/1e3);c=h}}else"H"==d.charAt(0)&&((h=ol.format.IGC.HFDTE_RECORD_RE_.exec(d))?(l=parseInt(h[1],10),s=parseInt(h[2],10)-1,a=2e3+parseInt(h[3],10)):(h=ol.format.IGC.H_RECORD_RE_.exec(d))&&(e[h[1]]=h[2].trim()))}if(0===i.length)return null;(r=new ol.geom.LineString(null)).setFlatCoordinates(o==ol.format.IGCZ.NONE?ol.geom.GeometryLayout.XYM:ol.geom.GeometryLayout.XYZM,i);(t=new ol.Feature(ol.format.Feature.transformWithOptions(r,!1,t))).setProperties(e);return t};ol.format.IGC.prototype.readFeaturesFromText=function(e,t){return(e=this.readFeatureFromText(e,t))?[e]:[]};ol.format.IGC.prototype.writeFeatureText=function(e,t){};ol.format.IGC.prototype.writeFeaturesText=function(e,t){};ol.format.IGC.prototype.writeGeometryText=function(e,t){};ol.format.IGC.prototype.readGeometryFromText=function(e,t){};ol.style.IconAnchorUnits={FRACTION:"fraction",PIXELS:"pixels"};ol.style.IconImage=function(e,t,o,r,n,i){ol.events.EventTarget.call(this);this.hitDetectionImage_=null;this.image_=e||new Image;null!==r&&(this.image_.crossOrigin=r);this.canvas_=i?document.createElement("CANVAS"):null;this.color_=i;this.imageListenerKeys_=null;this.imageState_=n;this.size_=o;this.src_=t;this.tainting_=!1;this.imageState_==ol.ImageState.LOADED&&this.determineTainting_()};ol.inherits(ol.style.IconImage,ol.events.EventTarget);ol.style.IconImage.get=function(e,t,o,r,n,i){var a=ol.style.iconImageCache,s=a.get(t,r,i);s||(s=new ol.style.IconImage(e,t,o,r,n,i),a.set(t,r,i,s));return s};ol.style.IconImage.prototype.determineTainting_=function(){var e=ol.dom.createCanvasContext2D(1,1);try{e.drawImage(this.image_,0,0),e.getImageData(0,0,1,1)}catch(e){this.tainting_=!0}};ol.style.IconImage.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.style.IconImage.prototype.handleImageError_=function(){this.imageState_=ol.ImageState.ERROR;this.unlistenImage_();this.dispatchChangeEvent_()};ol.style.IconImage.prototype.handleImageLoad_=function(){this.imageState_=ol.ImageState.LOADED;this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]);this.size_=[this.image_.width,this.image_.height];this.unlistenImage_();this.determineTainting_();this.replaceColor_();this.dispatchChangeEvent_()};ol.style.IconImage.prototype.getImage=function(e){return this.canvas_?this.canvas_:this.image_};ol.style.IconImage.prototype.getImageState=function(){return this.imageState_};ol.style.IconImage.prototype.getHitDetectionImage=function(e){if(!this.hitDetectionImage_)if(this.tainting_){e=this.size_[0];var t=this.size_[1],o=ol.dom.createCanvasContext2D(e,t);o.fillRect(0,0,e,t);this.hitDetectionImage_=o.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_};ol.style.IconImage.prototype.getSize=function(){return this.size_};ol.style.IconImage.prototype.getSrc=function(){return this.src_};ol.style.IconImage.prototype.load=function(){if(this.imageState_==ol.ImageState.IDLE){this.imageState_=ol.ImageState.LOADING;this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(e){this.handleImageError_()}}};ol.style.IconImage.prototype.replaceColor_=function(){if(!this.tainting_&&null!==this.color_){this.canvas_.width=this.image_.width;this.canvas_.height=this.image_.height;var e=this.canvas_.getContext("2d");e.drawImage(this.image_,0,0);for(var t=e.getImageData(0,0,this.image_.width,this.image_.height),o=t.data,r=this.color_[0]/255,n=this.color_[1]/255,i=this.color_[2]/255,a=0,s=o.length;a<s;a+=4)o[a]*=r,o[a+1]*=n,o[a+2]*=i;e.putImageData(t,0,0)}};ol.style.IconImage.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};ol.style.IconOrigin={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};ol.style.Icon=function(e){e=e||{};this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5];this.normalizedAnchor_=null;this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:ol.style.IconOrigin.TOP_LEFT;this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:ol.style.IconAnchorUnits.FRACTION;this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:ol.style.IconAnchorUnits.FRACTION;this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;var t=void 0!==e.img?e.img:null,o=void 0!==e.imgSize?e.imgSize:null,r=e.src;ol.asserts.assert(!(void 0!==r&&t),4);ol.asserts.assert(!t||t&&o,5);void 0!==r&&0!==r.length||!t||(r=t.src||ol.getUid(t).toString());ol.asserts.assert(void 0!==r&&0<r.length,6);var n=void 0!==e.src?ol.ImageState.IDLE:ol.ImageState.LOADED;this.color_=void 0!==e.color?ol.color.asArray(e.color):null;this.iconImage_=ol.style.IconImage.get(t,r,o,this.crossOrigin_,n,this.color_);this.offset_=void 0!==e.offset?e.offset:[0,0];this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:ol.style.IconOrigin.TOP_LEFT;this.origin_=null;this.size_=void 0!==e.size?e.size:null;ol.style.Image.call(this,{opacity:void 0!==e.opacity?e.opacity:1,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,snapToPixel:void 0===e.snapToPixel||e.snapToPixel,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView})};ol.inherits(ol.style.Icon,ol.style.Image);ol.style.Icon.prototype.clone=function(){return new ol.style.Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};ol.style.Icon.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var e=this.anchor_,t=this.getSize();if(this.anchorXUnits_==ol.style.IconAnchorUnits.FRACTION||this.anchorYUnits_==ol.style.IconAnchorUnits.FRACTION){if(!t)return null;e=this.anchor_.slice();this.anchorXUnits_==ol.style.IconAnchorUnits.FRACTION&&(e[0]*=t[0]);this.anchorYUnits_==ol.style.IconAnchorUnits.FRACTION&&(e[1]*=t[1])}if(this.anchorOrigin_!=ol.style.IconOrigin.TOP_LEFT){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice());this.anchorOrigin_!=ol.style.IconOrigin.TOP_RIGHT&&this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[0]=-e[0]+t[0]);this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_LEFT&&this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[1]=-e[1]+t[1])}return this.normalizedAnchor_=e};ol.style.Icon.prototype.getColor=function(){return this.color_};ol.style.Icon.prototype.getImage=function(e){return this.iconImage_.getImage(e)};ol.style.Icon.prototype.getImageSize=function(){return this.iconImage_.getSize()};ol.style.Icon.prototype.getHitDetectionImageSize=function(){return this.getImageSize()};ol.style.Icon.prototype.getImageState=function(){return this.iconImage_.getImageState()};ol.style.Icon.prototype.getHitDetectionImage=function(e){return this.iconImage_.getHitDetectionImage(e)};ol.style.Icon.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var e=this.offset_;if(this.offsetOrigin_!=ol.style.IconOrigin.TOP_LEFT){var t=this.getSize(),o=this.iconImage_.getSize();if(!t||!o)return null;e=e.slice();this.offsetOrigin_!=ol.style.IconOrigin.TOP_RIGHT&&this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[0]=o[0]-t[0]-e[0]);this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_LEFT&&this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[1]=o[1]-t[1]-e[1])}return this.origin_=e};ol.style.Icon.prototype.getSrc=function(){return this.iconImage_.getSrc()};ol.style.Icon.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()};ol.style.Icon.prototype.listenImageChange=function(e,t){return ol.events.listen(this.iconImage_,ol.events.EventType.CHANGE,e,t)};ol.style.Icon.prototype.load=function(){this.iconImage_.load()};ol.style.Icon.prototype.unlistenImageChange=function(e,t){ol.events.unlisten(this.iconImage_,ol.events.EventType.CHANGE,e,t)};ol.format.KML=function(e){e=e||{};ol.format.XMLFeature.call(this);ol.format.KML.DEFAULT_STYLE_ARRAY_||ol.format.KML.createStyleDefaults_();this.defaultDataProjection=ol.proj.get("EPSG:4326");this.defaultStyle_=e.defaultStyle?e.defaultStyle:ol.format.KML.DEFAULT_STYLE_ARRAY_;this.extractStyles_=void 0===e.extractStyles||e.extractStyles;this.writeStyles_=void 0===e.writeStyles||e.writeStyles;this.sharedStyles_={};this.showPointNames_=void 0===e.showPointNames||e.showPointNames};ol.inherits(ol.format.KML,ol.format.XMLFeature);ol.format.KML.GX_NAMESPACE_URIS_=["http://www.google.com/kml/ext/2.2"];ol.format.KML.NAMESPACE_URIS_=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];ol.format.KML.SCHEMA_LOCATION_="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd";ol.format.KML.createStyleDefaults_=function(){ol.format.KML.DEFAULT_COLOR_=[255,255,255,1];ol.format.KML.DEFAULT_FILL_STYLE_=new ol.style.Fill({color:ol.format.KML.DEFAULT_COLOR_});ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_=[20,2];ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_=ol.style.IconAnchorUnits.PIXELS;ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_=ol.style.IconAnchorUnits.PIXELS;ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_=[64,64];ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_=.5;ol.format.KML.DEFAULT_IMAGE_STYLE_=new ol.style.Icon({anchor:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_,anchorOrigin:ol.style.IconOrigin.BOTTOM_LEFT,anchorXUnits:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_,anchorYUnits:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_,crossOrigin:"anonymous",rotation:0,scale:ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_,size:ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_,src:ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_});ol.format.KML.DEFAULT_NO_IMAGE_STYLE_="NO_IMAGE";ol.format.KML.DEFAULT_STROKE_STYLE_=new ol.style.Stroke({color:ol.format.KML.DEFAULT_COLOR_,width:1});ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_=new ol.style.Stroke({color:[51,51,51,1],width:2});ol.format.KML.DEFAULT_TEXT_STYLE_=new ol.style.Text({font:"bold 16px Helvetica",fill:ol.format.KML.DEFAULT_FILL_STYLE_,stroke:ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_,scale:.8});ol.format.KML.DEFAULT_STYLE_=new ol.style.Style({fill:ol.format.KML.DEFAULT_FILL_STYLE_,image:ol.format.KML.DEFAULT_IMAGE_STYLE_,text:ol.format.KML.DEFAULT_TEXT_STYLE_,stroke:ol.format.KML.DEFAULT_STROKE_STYLE_,zIndex:0});ol.format.KML.DEFAULT_STYLE_ARRAY_=[ol.format.KML.DEFAULT_STYLE_];return ol.format.KML.DEFAULT_STYLE_ARRAY_};ol.format.KML.ICON_ANCHOR_UNITS_MAP_={fraction:ol.style.IconAnchorUnits.FRACTION,pixels:ol.style.IconAnchorUnits.PIXELS,insetPixels:ol.style.IconAnchorUnits.PIXELS};ol.format.KML.createNameStyleFunction_=function(e,t){var o=[0,0],r="start";if(e.getImage()){var n=e.getImage().getImageSize();null===n&&(n=ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_);2==n.length&&(r=e.getImage().getScale(),o[0]=r*n[0]/2,o[1]=-r*n[1]/2,r="left")}null!==e.getText()?((e=(n=e.getText()).clone()).setFont(n.getFont()||ol.format.KML.DEFAULT_TEXT_STYLE_.getFont()),e.setScale(n.getScale()||ol.format.KML.DEFAULT_TEXT_STYLE_.getScale()),e.setFill(n.getFill()||ol.format.KML.DEFAULT_TEXT_STYLE_.getFill()),e.setStroke(n.getStroke()||ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_)):e=ol.format.KML.DEFAULT_TEXT_STYLE_.clone();e.setText(t);e.setOffsetX(o[0]);e.setOffsetY(o[1]);e.setTextAlign(r);return new ol.style.Style({text:e})};ol.format.KML.createFeatureStyleFunction_=function(e,t,o,r,n){return function(i){var a=n,s="";a&&this.getGeometry()&&(a=this.getGeometry().getType()===ol.geom.GeometryType.POINT);a&&(s=this.get("name"),a=a&&s);return e?a?(a=ol.format.KML.createNameStyleFunction_(e[0],s),e.concat(a)):e:t?(i=ol.format.KML.findStyle_(t,o,r),a?(a=ol.format.KML.createNameStyleFunction_(i[0],s),i.concat(a)):i):a?(a=ol.format.KML.createNameStyleFunction_(o[0],s),o.concat(a)):o}};ol.format.KML.findStyle_=function(e,t,o){return Array.isArray(e)?e:"string"==typeof e?(!(e in o)&&"#"+e in o&&(e="#"+e),ol.format.KML.findStyle_(o[e],t,o)):t};ol.format.KML.readColor_=function(e){e=ol.xml.getAllTextContent(e,!1);if(e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e))return e=e[1],[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]};ol.format.KML.readFlatCoordinates_=function(e){e=ol.xml.getAllTextContent(e,!1);for(var t,o=[],r=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;t=r.exec(e);){var n=parseFloat(t[1]),i=parseFloat(t[2]),a=t[3]?parseFloat(t[3]):0;o.push(n,i,a);e=e.substr(t[0].length)}if(""===e)return o};ol.format.KML.readURI_=function(e){var t=ol.xml.getAllTextContent(e,!1).trim();(e=e.baseURI)&&"about:blank"!=e||(e=window.location.href);return e?new URL(t,e).href:t};ol.format.KML.readVec2_=function(e){var t=e.getAttribute("xunits"),o=e.getAttribute("yunits"),r="insetPixels"!==t?"insetPixels"!==o?ol.style.IconOrigin.BOTTOM_LEFT:ol.style.IconOrigin.TOP_LEFT:"insetPixels"!==o?ol.style.IconOrigin.BOTTOM_RIGHT:ol.style.IconOrigin.TOP_RIGHT;return{x:parseFloat(e.getAttribute("x")),xunits:ol.format.KML.ICON_ANCHOR_UNITS_MAP_[t],y:parseFloat(e.getAttribute("y")),yunits:ol.format.KML.ICON_ANCHOR_UNITS_MAP_[o],origin:r}};ol.format.KML.readScale_=function(e){return ol.format.XSD.readDecimal(e)};ol.format.KML.readStyleMapValue_=function(e,t){return ol.xml.pushParseAndPop(void 0,ol.format.KML.STYLE_MAP_PARSERS_,e,t)};ol.format.KML.IconStyleParser_=function(e,t){if(e=ol.xml.pushParseAndPop({},ol.format.KML.ICON_STYLE_PARSERS_,e,t)){t=t[t.length-1];var o="Icon"in e?e.Icon:{},r=!("Icon"in e)||0<Object.keys(o).length,n=o.href;if(n)var i=n;else r&&(i=ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_);n=ol.style.IconOrigin.BOTTOM_LEFT;var a,s=e.hotSpot;if(s){var l=[s.x,s.y],c=s.xunits,u=s.yunits;n=s.origin}else i===ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_?(l=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_,c=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_,u=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(i)&&(l=[.5,0],u=c=ol.style.IconAnchorUnits.FRACTION);s=o.x;var h,d,p=o.y;void 0!==s&&void 0!==p&&(a=[s,p]);s=o.w;o=o.h;void 0!==s&&void 0!==o&&(h=[s,o]);void 0!==(o=e.heading)&&(d=ol.math.toRadians(o));e=e.scale;r?(i==ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_&&(h=ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_,void 0===e&&(e=ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_)),i=new ol.style.Icon({anchor:l,anchorOrigin:n,anchorXUnits:c,anchorYUnits:u,crossOrigin:"anonymous",offset:a,offsetOrigin:ol.style.IconOrigin.BOTTOM_LEFT,rotation:d,scale:e,size:h,src:i}),t.imageStyle=i):t.imageStyle=ol.format.KML.DEFAULT_NO_IMAGE_STYLE_}};ol.format.KML.LabelStyleParser_=function(e,t){(e=ol.xml.pushParseAndPop({},ol.format.KML.LABEL_STYLE_PARSERS_,e,t))&&(t=t[t.length-1],e=new ol.style.Text({fill:new ol.style.Fill({color:"color"in e?e.color:ol.format.KML.DEFAULT_COLOR_}),scale:e.scale}),t.textStyle=e)};ol.format.KML.LineStyleParser_=function(e,t){(e=ol.xml.pushParseAndPop({},ol.format.KML.LINE_STYLE_PARSERS_,e,t))&&(t=t[t.length-1],e=new ol.style.Stroke({color:"color"in e?e.color:ol.format.KML.DEFAULT_COLOR_,width:"width"in e?e.width:1}),t.strokeStyle=e)};ol.format.KML.PolyStyleParser_=function(e,t){if(e=ol.xml.pushParseAndPop({},ol.format.KML.POLY_STYLE_PARSERS_,e,t)){t=t[t.length-1];var o=new ol.style.Fill({color:"color"in e?e.color:ol.format.KML.DEFAULT_COLOR_});t.fillStyle=o;void 0!==(o=e.fill)&&(t.fill=o);void 0!==(e=e.outline)&&(t.outline=e)}};ol.format.KML.readFlatLinearRing_=function(e,t){return ol.xml.pushParseAndPop(null,ol.format.KML.FLAT_LINEAR_RING_PARSERS_,e,t)};ol.format.KML.gxCoordParser_=function(e,t){t=t[t.length-1].flatCoordinates;e=ol.xml.getAllTextContent(e,!1);var o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(e);if(o){e=parseFloat(o[1]);var r=parseFloat(o[2]);o=parseFloat(o[3]);t.push(e,r,o,0)}else t.push(0,0,0,0)};ol.format.KML.readGxMultiTrack_=function(e,t){if(e=ol.xml.pushParseAndPop([],ol.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_,e,t))return(t=new ol.geom.MultiLineString(null)).setLineStrings(e),t};ol.format.KML.readGxTrack_=function(e,t){if(t=ol.xml.pushParseAndPop({flatCoordinates:[],whens:[]},ol.format.KML.GX_TRACK_PARSERS_,e,t)){e=t.flatCoordinates;t=t.whens;var o,r=0;for(o=Math.min(e.length,t.length);r<o;++r)e[4*r+3]=t[r];(t=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZM,e);return t}};ol.format.KML.readIcon_=function(e,t){return(e=ol.xml.pushParseAndPop({},ol.format.KML.ICON_PARSERS_,e,t))?e:null};ol.format.KML.readFlatCoordinatesFromNode_=function(e,t){return ol.xml.pushParseAndPop(null,ol.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t)};ol.format.KML.readLineString_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t);if(e=ol.format.KML.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t.setProperties(o),t};ol.format.KML.readLinearRing_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t);if(e=ol.format.KML.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e,[e.length]),t.setProperties(o),t};ol.format.KML.readMultiGeometry_=function(e,t){if(!(e=ol.xml.pushParseAndPop([],ol.format.KML.MULTI_GEOMETRY_PARSERS_,e,t)))return null;if(0===e.length)return new ol.geom.GeometryCollection(e);var o,r=!0,n=e[0].getType(),i=1;for(o=e.length;i<o;++i)if((t=e[i]).getType()!=n){r=!1;break}if(r)if(n==ol.geom.GeometryType.POINT){var a=e[0];r=a.getLayout();n=a.getFlatCoordinates();i=1;for(o=e.length;i<o;++i)t=e[i],ol.array.extend(n,t.getFlatCoordinates());(a=new ol.geom.MultiPoint(null)).setFlatCoordinates(r,n);ol.format.KML.setCommonGeometryProperties_(a,e)}else n==ol.geom.GeometryType.LINE_STRING?((a=new ol.geom.MultiLineString(null)).setLineStrings(e),ol.format.KML.setCommonGeometryProperties_(a,e)):n==ol.geom.GeometryType.POLYGON?((a=new ol.geom.MultiPolygon(null)).setPolygons(e),ol.format.KML.setCommonGeometryProperties_(a,e)):n==ol.geom.GeometryType.GEOMETRY_COLLECTION?a=new ol.geom.GeometryCollection(e):ol.asserts.assert(!1,37);else a=new ol.geom.GeometryCollection(e);return a};ol.format.KML.readPoint_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t);if(e=ol.format.KML.readFlatCoordinatesFromNode_(e,t))return(t=new ol.geom.Point(null)).setFlatCoordinates(ol.geom.GeometryLayout.XYZ,e),t.setProperties(o),t};ol.format.KML.readPolygon_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t);if((e=ol.xml.pushParseAndPop([null],ol.format.KML.FLAT_LINEAR_RINGS_PARSERS_,e,t))&&e[0]){t=new ol.geom.Polygon(null);var r,n=e[0],i=[n.length],a=1;for(r=e.length;a<r;++a)ol.array.extend(n,e[a]),i.push(n.length);t.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,n,i);t.setProperties(o);return t}};ol.format.KML.readStyle_=function(e,t){if(!(t=ol.xml.pushParseAndPop({},ol.format.KML.STYLE_PARSERS_,e,t)))return null;e="fillStyle"in t?t.fillStyle:ol.format.KML.DEFAULT_FILL_STYLE_;var o=t.fill;void 0===o||o||(e=null);(o="imageStyle"in t?t.imageStyle:ol.format.KML.DEFAULT_IMAGE_STYLE_)==ol.format.KML.DEFAULT_NO_IMAGE_STYLE_&&(o=void 0);var r="textStyle"in t?t.textStyle:ol.format.KML.DEFAULT_TEXT_STYLE_,n="strokeStyle"in t?t.strokeStyle:ol.format.KML.DEFAULT_STROKE_STYLE_;void 0===(t=t.outline)||t||(n=null);return[new ol.style.Style({fill:e,image:o,stroke:n,text:r,zIndex:void 0})]};ol.format.KML.setCommonGeometryProperties_=function(e,t){var o,r,n,i=t.length,a=Array(t.length),s=Array(t.length),l=Array(t.length),c=r=n=!1;for(o=0;o<i;++o){var u=t[o];a[o]=u.get("extrude");s[o]=u.get("tessellate");l[o]=u.get("altitudeMode");c=c||void 0!==a[o];r=r||void 0!==s[o];n=n||l[o]}c&&e.set("extrude",a);r&&e.set("tessellate",s);n&&e.set("altitudeMode",l)};ol.format.KML.DataParser_=function(e,t){var o=e.getAttribute("name");ol.xml.parseNode(ol.format.KML.DATA_PARSERS_,e,t);e=t[t.length-1];null!==o?e[o]=e.value:null!==e.displayName&&(e[e.displayName]=e.value);delete e.value};ol.format.KML.ExtendedDataParser_=function(e,t){ol.xml.parseNode(ol.format.KML.EXTENDED_DATA_PARSERS_,e,t)};ol.format.KML.RegionParser_=function(e,t){ol.xml.parseNode(ol.format.KML.REGION_PARSERS_,e,t)};ol.format.KML.PairDataParser_=function(e,t){if(e=ol.xml.pushParseAndPop({},ol.format.KML.PAIR_PARSERS_,e,t)){var o=e.key;o&&"normal"==o&&((o=e.styleUrl)&&(t[t.length-1]=o),(e=e.Style)&&(t[t.length-1]=e))}};ol.format.KML.PlacemarkStyleMapParser_=function(e,t){(e=ol.format.KML.readStyleMapValue_(e,t))&&(t=t[t.length-1],Array.isArray(e)?t.Style=e:"string"==typeof e?t.styleUrl=e:ol.asserts.assert(!1,38))};ol.format.KML.SchemaDataParser_=function(e,t){ol.xml.parseNode(ol.format.KML.SCHEMA_DATA_PARSERS_,e,t)};ol.format.KML.SimpleDataParser_=function(e,t){var o=e.getAttribute("name");null!==o&&(e=ol.format.XSD.readString(e),t[t.length-1][o]=e)};ol.format.KML.LatLonAltBoxParser_=function(e,t){if(e=ol.xml.pushParseAndPop({},ol.format.KML.LAT_LON_ALT_BOX_PARSERS_,e,t)){t=t[t.length-1];var o=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];t.extent=o;t.altitudeMode=e.altitudeMode;t.minAltitude=parseFloat(e.minAltitude);t.maxAltitude=parseFloat(e.maxAltitude)}};ol.format.KML.LodParser_=function(e,t){(e=ol.xml.pushParseAndPop({},ol.format.KML.LOD_PARSERS_,e,t))&&((t=t[t.length-1]).minLodPixels=parseFloat(e.minLodPixels),t.maxLodPixels=parseFloat(e.maxLodPixels),t.minFadeExtent=parseFloat(e.minFadeExtent),t.maxFadeExtent=parseFloat(e.maxFadeExtent))};ol.format.KML.innerBoundaryIsParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,ol.format.KML.INNER_BOUNDARY_IS_PARSERS_,e,t))&&t[t.length-1].push(e)};ol.format.KML.outerBoundaryIsParser_=function(e,t){(e=ol.xml.pushParseAndPop(void 0,ol.format.KML.OUTER_BOUNDARY_IS_PARSERS_,e,t))&&(t[t.length-1][0]=e)};ol.format.KML.LinkParser_=function(e,t){ol.xml.parseNode(ol.format.KML.LINK_PARSERS_,e,t)};ol.format.KML.whenParser_=function(e,t){t=t[t.length-1].whens;e=ol.xml.getAllTextContent(e,!1);e=Date.parse(e);t.push(isNaN(e)?0:e)};ol.format.KML.DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{displayName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),value:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.KML.EXTENDED_DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Data:ol.format.KML.DataParser_,SchemaData:ol.format.KML.SchemaDataParser_});ol.format.KML.REGION_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LatLonAltBox:ol.format.KML.LatLonAltBoxParser_,Lod:ol.format.KML.LodParser_});ol.format.KML.LAT_LON_ALT_BOX_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),minAltitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxAltitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),north:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),south:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),east:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),west:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.LOD_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{minLodPixels:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxLodPixels:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),minFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{extrude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),tessellate:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.KML.FLAT_LINEAR_RING_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{coordinates:ol.xml.makeReplacer(ol.format.KML.readFlatCoordinates_)});ol.format.KML.FLAT_LINEAR_RINGS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{innerBoundaryIs:ol.format.KML.innerBoundaryIsParser_,outerBoundaryIs:ol.format.KML.outerBoundaryIsParser_});ol.format.KML.GX_TRACK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{when:ol.format.KML.whenParser_},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{coord:ol.format.KML.gxCoordParser_}));ol.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{coordinates:ol.xml.makeReplacer(ol.format.KML.readFlatCoordinates_)});ol.format.KML.ICON_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{x:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),y:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),w:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),h:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)}));ol.format.KML.ICON_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Icon:ol.xml.makeObjectPropertySetter(ol.format.KML.readIcon_),heading:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),hotSpot:ol.xml.makeObjectPropertySetter(ol.format.KML.readVec2_),scale:ol.xml.makeObjectPropertySetter(ol.format.KML.readScale_)});ol.format.KML.INNER_BOUNDARY_IS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeReplacer(ol.format.KML.readFlatLinearRing_)});ol.format.KML.LABEL_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),scale:ol.xml.makeObjectPropertySetter(ol.format.KML.readScale_)});ol.format.KML.LINE_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),width:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.MULTI_GEOMETRY_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LineString:ol.xml.makeArrayPusher(ol.format.KML.readLineString_),LinearRing:ol.xml.makeArrayPusher(ol.format.KML.readLinearRing_),MultiGeometry:ol.xml.makeArrayPusher(ol.format.KML.readMultiGeometry_),Point:ol.xml.makeArrayPusher(ol.format.KML.readPoint_),Polygon:ol.xml.makeArrayPusher(ol.format.KML.readPolygon_)});ol.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{Track:ol.xml.makeArrayPusher(ol.format.KML.readGxTrack_)});ol.format.KML.NETWORK_LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.format.KML.ExtendedDataParser_,Region:ol.format.KML.RegionParser_,Link:ol.format.KML.LinkParser_,address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),description:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),open:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),visibility:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)});ol.format.KML.LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)});ol.format.KML.OUTER_BOUNDARY_IS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeReplacer(ol.format.KML.readFlatLinearRing_)});ol.format.KML.PAIR_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Style:ol.xml.makeObjectPropertySetter(ol.format.KML.readStyle_),key:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),styleUrl:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)});ol.format.KML.PLACEMARK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.format.KML.ExtendedDataParser_,Region:ol.format.KML.RegionParser_,MultiGeometry:ol.xml.makeObjectPropertySetter(ol.format.KML.readMultiGeometry_,"geometry"),LineString:ol.xml.makeObjectPropertySetter(ol.format.KML.readLineString_,"geometry"),LinearRing:ol.xml.makeObjectPropertySetter(ol.format.KML.readLinearRing_,"geometry"),Point:ol.xml.makeObjectPropertySetter(ol.format.KML.readPoint_,"geometry"),Polygon:ol.xml.makeObjectPropertySetter(ol.format.KML.readPolygon_,"geometry"),Style:ol.xml.makeObjectPropertySetter(ol.format.KML.readStyle_),StyleMap:ol.format.KML.PlacemarkStyleMapParser_,address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),description:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),open:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),styleUrl:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_),visibility:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{MultiTrack:ol.xml.makeObjectPropertySetter(ol.format.KML.readGxMultiTrack_,"geometry"),Track:ol.xml.makeObjectPropertySetter(ol.format.KML.readGxTrack_,"geometry")}));ol.format.KML.POLY_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),fill:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),outline:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)});ol.format.KML.SCHEMA_DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{SimpleData:ol.format.KML.SimpleDataParser_});ol.format.KML.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{IconStyle:ol.format.KML.IconStyleParser_,LabelStyle:ol.format.KML.LabelStyleParser_,LineStyle:ol.format.KML.LineStyleParser_,PolyStyle:ol.format.KML.PolyStyleParser_});ol.format.KML.STYLE_MAP_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Pair:ol.format.KML.PairDataParser_});ol.format.KML.prototype.readDocumentOrFolder_=function(e,t){var o=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Document:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Folder:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:ol.xml.makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)});if(e=ol.xml.pushParseAndPop([],o,e,t,this))return e};ol.format.KML.prototype.readPlacemark_=function(e,t){var o=ol.xml.pushParseAndPop({geometry:null},ol.format.KML.PLACEMARK_PARSERS_,e,t);if(o){var r=new ol.Feature;null!==(e=e.getAttribute("id"))&&r.setId(e);t=t[0];(e=o.geometry)&&ol.format.Feature.transformWithOptions(e,!1,t);r.setGeometry(e);delete o.geometry;this.extractStyles_&&(t=ol.format.KML.createFeatureStyleFunction_(o.Style,o.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_),r.setStyle(t));delete o.Style;r.setProperties(o);return r}};ol.format.KML.prototype.readSharedStyle_=function(e,t){var o=e.getAttribute("id");null!==o&&(t=ol.format.KML.readStyle_(e,t))&&((e=e.baseURI)&&"about:blank"!=e||(e=window.location.href),o=e?new URL("#"+o,e).href:"#"+o,this.sharedStyles_[o]=t)};ol.format.KML.prototype.readSharedStyleMap_=function(e,t){var o=e.getAttribute("id");null!==o&&(t=ol.format.KML.readStyleMapValue_(e,t))&&((e=e.baseURI)&&"about:blank"!=e||(e=window.location.href),o=e?new URL("#"+o,e).href:"#"+o,this.sharedStyles_[o]=t)};ol.format.KML.prototype.readFeatureFromNode=function(e,t){return ol.array.includes(ol.format.KML.NAMESPACE_URIS_,e.namespaceURI)&&(e=this.readPlacemark_(e,[this.getReadOptions(e,t)]))?e:null};ol.format.KML.prototype.readFeaturesFromNode=function(e,t){if(!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,e.namespaceURI))return[];var o=e.localName;if("Document"==o||"Folder"==o)return(o=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))?o:[];if("Placemark"==o)return(t=this.readPlacemark_(e,[this.getReadOptions(e,t)]))?[t]:[];if("kml"==o){o=[];for(e=e.firstElementChild;e;e=e.nextElementSibling){var r=this.readFeaturesFromNode(e,t);r&&ol.array.extend(o,r)}return o}return[]};ol.format.KML.prototype.readName=function(e){return ol.xml.isDocument(e)?this.readNameFromDocument(e):ol.xml.isNode(e)?this.readNameFromNode(e):"string"==typeof e?(e=ol.xml.parse(e),this.readNameFromDocument(e)):void 0};ol.format.KML.prototype.readNameFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var t=this.readNameFromNode(e);if(t)return t}};ol.format.KML.prototype.readNameFromNode=function(e){var t;for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"name"==t.localName)return ol.format.XSD.readString(t);for(t=e.firstElementChild;t;t=t.nextElementSibling)if(e=t.localName,ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&("Document"==e||"Folder"==e||"Placemark"==e||"kml"==e)&&(e=this.readNameFromNode(t)))return e};ol.format.KML.prototype.readNetworkLinks=function(e){var t=[];ol.xml.isDocument(e)?ol.array.extend(t,this.readNetworkLinksFromDocument(e)):ol.xml.isNode(e)?ol.array.extend(t,this.readNetworkLinksFromNode(e)):"string"==typeof e&&(e=ol.xml.parse(e),ol.array.extend(t,this.readNetworkLinksFromDocument(e)));return t};ol.format.KML.prototype.readNetworkLinksFromDocument=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)e.nodeType==Node.ELEMENT_NODE&&ol.array.extend(t,this.readNetworkLinksFromNode(e));return t};ol.format.KML.prototype.readNetworkLinksFromNode=function(e){var t,o=[];for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"NetworkLink"==t.localName){var r=ol.xml.pushParseAndPop({},ol.format.KML.NETWORK_LINK_PARSERS_,t,[]);o.push(r)}for(t=e.firstElementChild;t;t=t.nextElementSibling)e=t.localName,!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||ol.array.extend(o,this.readNetworkLinksFromNode(t));return o};ol.format.KML.prototype.readRegion=function(e){var t=[];ol.xml.isDocument(e)?ol.array.extend(t,this.readRegionFromDocument(e)):ol.xml.isNode(e)?ol.array.extend(t,this.readRegionFromNode(e)):"string"==typeof e&&(e=ol.xml.parse(e),ol.array.extend(t,this.readRegionFromDocument(e)));return t};ol.format.KML.prototype.readRegionFromDocument=function(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)e.nodeType==Node.ELEMENT_NODE&&ol.array.extend(t,this.readRegionFromNode(e));return t};ol.format.KML.prototype.readRegionFromNode=function(e){var t,o=[];for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"Region"==t.localName){var r=ol.xml.pushParseAndPop({},ol.format.KML.REGION_PARSERS_,t,[]);o.push(r)}for(t=e.firstElementChild;t;t=t.nextElementSibling)e=t.localName,!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||ol.array.extend(o,this.readRegionFromNode(t));return o};ol.format.KML.writeColorTextNode_=function(e,t){t=[255*(4==(t=ol.color.asArray(t)).length?t[3]:1),t[2],t[1],t[0]];var o;for(o=0;4>o;++o){var r=parseInt(t[o],10).toString(16);t[o]=1==r.length?"0"+r:r}ol.format.XSD.writeStringTextNode(e,t.join(""))};ol.format.KML.writeCoordinatesTextNode_=function(e,t,o){var r,n=(o=o[o.length-1]).layout;o=o.stride;n==ol.geom.GeometryLayout.XY||n==ol.geom.GeometryLayout.XYM?r=2:n==ol.geom.GeometryLayout.XYZ||n==ol.geom.GeometryLayout.XYZM?r=3:ol.asserts.assert(!1,34);var i,a=t.length,s="";if(0<a){s+=t[0];for(n=1;n<r;++n)s+=","+t[n];for(i=o;i<a;i+=o)for(s+=" "+t[i],n=1;n<r;++n)s+=","+t[i+n]}ol.format.XSD.writeStringTextNode(e,s)};ol.format.KML.writeDataNode_=function(e,t,o){e.setAttribute("name",t.name);e={node:e};"object"==typeof(t=t.value)?(null!==t&&t.displayName&&ol.xml.pushSerializeAndPop(e,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t.displayName],o,["displayName"]),null!==t&&t.value&&ol.xml.pushSerializeAndPop(e,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t.value],o,["value"])):ol.xml.pushSerializeAndPop(e,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[t],o,["value"])};ol.format.KML.writeDataNodeName_=function(e,t){ol.format.XSD.writeCDATASection(e,t)};ol.format.KML.writeDataNodeValue_=function(e,t){ol.format.XSD.writeStringTextNode(e,t)};ol.format.KML.writeDocument_=function(e,t,o){ol.xml.pushSerializeAndPop({node:e},ol.format.KML.DOCUMENT_SERIALIZERS_,ol.format.KML.DOCUMENT_NODE_FACTORY_,t,o,void 0,this)};ol.format.KML.writeExtendedData_=function(e,t,o){e={node:e};var r=t.names;t=t.values;for(var n=r.length,i=0;i<n;i++)ol.xml.pushSerializeAndPop(e,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.format.KML.DATA_NODE_FACTORY_,[{name:r[i],value:t[i]}],o)};ol.format.KML.writeIcon_=function(e,t,o){e={node:e};var r=ol.format.KML.ICON_SEQUENCE_[o[o.length-1].node.namespaceURI],n=ol.xml.makeSequence(t,r);ol.xml.pushSerializeAndPop(e,ol.format.KML.ICON_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,n,o,r);r=ol.format.KML.ICON_SEQUENCE_[ol.format.KML.GX_NAMESPACE_URIS_[0]];n=ol.xml.makeSequence(t,r);ol.xml.pushSerializeAndPop(e,ol.format.KML.ICON_SERIALIZERS_,ol.format.KML.GX_NODE_FACTORY_,n,o,r)};ol.format.KML.writeIconStyle_=function(e,t,o){e={node:e};var r={},n=t.getSrc(),i=t.getSize(),a=t.getImageSize();n={href:n};if(i){n.w=i[0];n.h=i[1];var s=t.getAnchor(),l=t.getOrigin();l&&a&&0!==l[0]&&l[1]!==i[1]&&(n.x=l[0],n.y=a[1]-(l[1]+i[1]));!s||s[0]===i[0]/2&&s[1]===i[1]/2||(r.hotSpot={x:s[0],xunits:ol.style.IconAnchorUnits.PIXELS,y:i[1]-s[1],yunits:ol.style.IconAnchorUnits.PIXELS})}r.Icon=n;1!==(i=t.getScale())&&(r.scale=i);0!==(t=t.getRotation())&&(r.heading=t);t=ol.format.KML.ICON_STYLE_SEQUENCE_[o[o.length-1].node.namespaceURI];r=ol.xml.makeSequence(r,t);ol.xml.pushSerializeAndPop(e,ol.format.KML.ICON_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,r,o,t)};ol.format.KML.writeLabelStyle_=function(e,t,o){e={node:e};var r={},n=t.getFill();n&&(r.color=n.getColor());(t=t.getScale())&&1!==t&&(r.scale=t);t=ol.format.KML.LABEL_STYLE_SEQUENCE_[o[o.length-1].node.namespaceURI];r=ol.xml.makeSequence(r,t);ol.xml.pushSerializeAndPop(e,ol.format.KML.LABEL_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,r,o,t)};ol.format.KML.writeLineStyle_=function(e,t,o){e={node:e};var r={color:t.getColor(),width:t.getWidth()};t=ol.format.KML.LINE_STYLE_SEQUENCE_[o[o.length-1].node.namespaceURI];r=ol.xml.makeSequence(r,t);ol.xml.pushSerializeAndPop(e,ol.format.KML.LINE_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,r,o,t)};ol.format.KML.writeMultiGeometry_=function(e,t,o){e={node:e};var r=t.getType();if(r==ol.geom.GeometryType.GEOMETRY_COLLECTION)var n=t.getGeometries(),i=ol.format.KML.GEOMETRY_NODE_FACTORY_;else r==ol.geom.GeometryType.MULTI_POINT?(n=t.getPoints(),i=ol.format.KML.POINT_NODE_FACTORY_):r==ol.geom.GeometryType.MULTI_LINE_STRING?(n=t.getLineStrings(),i=ol.format.KML.LINE_STRING_NODE_FACTORY_):r==ol.geom.GeometryType.MULTI_POLYGON?(n=t.getPolygons(),i=ol.format.KML.POLYGON_NODE_FACTORY_):ol.asserts.assert(!1,39);ol.xml.pushSerializeAndPop(e,ol.format.KML.MULTI_GEOMETRY_SERIALIZERS_,i,n,o)};ol.format.KML.writeBoundaryIs_=function(e,t,o){ol.xml.pushSerializeAndPop({node:e},ol.format.KML.BOUNDARY_IS_SERIALIZERS_,ol.format.KML.LINEAR_RING_NODE_FACTORY_,[t],o)};ol.format.KML.writePlacemark_=function(e,t,o){var r={node:e};t.getId()&&e.setAttribute("id",t.getId());e=t.getProperties();var n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;var i=Object.keys(e||{}).sort().filter(function(e){return!n[e]});if(0<i.length){var a=ol.xml.makeSequence(e,i);ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.format.KML.EXTENDEDDATA_NODE_FACTORY_,[{names:i,values:a}],o)}(i=t.getStyleFunction())&&(i=i.call(t,0))&&(i=Array.isArray(i)?i[0]:i,this.writeStyles_&&(e.Style=i),(i=i.getText())&&(e.name=i.getText()));i=ol.format.KML.PLACEMARK_SEQUENCE_[o[o.length-1].node.namespaceURI];e=ol.xml.makeSequence(e,i);ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,e,o,i);e=o[0];(t=t.getGeometry())&&(t=ol.format.Feature.transformWithOptions(t,!0,e));ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.format.KML.GEOMETRY_NODE_FACTORY_,[t],o)};ol.format.KML.writePrimitiveGeometry_=function(e,t,o){var r=t.getFlatCoordinates();(e={node:e}).layout=t.getLayout();e.stride=t.getStride();(t=t.getProperties()).coordinates=r;r=ol.format.KML.PRIMITIVE_GEOMETRY_SEQUENCE_[o[o.length-1].node.namespaceURI];t=ol.xml.makeSequence(t,r);ol.xml.pushSerializeAndPop(e,ol.format.KML.PRIMITIVE_GEOMETRY_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,t,o,r)};ol.format.KML.writePolygon_=function(e,t,o){var r=(t=t.getLinearRings()).shift();e={node:e};ol.xml.pushSerializeAndPop(e,ol.format.KML.POLYGON_SERIALIZERS_,ol.format.KML.INNER_BOUNDARY_NODE_FACTORY_,t,o);ol.xml.pushSerializeAndPop(e,ol.format.KML.POLYGON_SERIALIZERS_,ol.format.KML.OUTER_BOUNDARY_NODE_FACTORY_,[r],o)};ol.format.KML.writePolyStyle_=function(e,t,o){ol.xml.pushSerializeAndPop({node:e},ol.format.KML.POLY_STYLE_SERIALIZERS_,ol.format.KML.COLOR_NODE_FACTORY_,[t.getColor()],o)};ol.format.KML.writeScaleTextNode_=function(e,t){ol.format.XSD.writeDecimalTextNode(e,Math.round(1e6*t)/1e6)};ol.format.KML.writeStyle_=function(e,t,o){e={node:e};var r={},n=t.getFill(),i=t.getStroke(),a=t.getImage();t=t.getText();a instanceof ol.style.Icon&&(r.IconStyle=a);t&&(r.LabelStyle=t);i&&(r.LineStyle=i);n&&(r.PolyStyle=n);t=ol.format.KML.STYLE_SEQUENCE_[o[o.length-1].node.namespaceURI];r=ol.xml.makeSequence(r,t);ol.xml.pushSerializeAndPop(e,ol.format.KML.STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,r,o,t)};ol.format.KML.writeVec2_=function(e,t){e.setAttribute("x",t.x);e.setAttribute("y",t.y);e.setAttribute("xunits",t.xunits);e.setAttribute("yunits",t.yunits)};ol.format.KML.KML_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["Document","Placemark"]);ol.format.KML.KML_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Document:ol.xml.makeChildAppender(ol.format.KML.writeDocument_),Placemark:ol.xml.makeChildAppender(ol.format.KML.writePlacemark_)});ol.format.KML.DOCUMENT_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Placemark:ol.xml.makeChildAppender(ol.format.KML.writePlacemark_)});ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Data:ol.xml.makeChildAppender(ol.format.KML.writeDataNode_),value:ol.xml.makeChildAppender(ol.format.KML.writeDataNodeValue_),displayName:ol.xml.makeChildAppender(ol.format.KML.writeDataNodeName_)});ol.format.KML.GEOMETRY_TYPE_TO_NODENAME_={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"};ol.format.KML.ICON_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["href"],ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,["x","y","w","h"]));ol.format.KML.ICON_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{x:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),y:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),w:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),h:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode)}));ol.format.KML.ICON_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["scale","heading","Icon","hotSpot"]);ol.format.KML.ICON_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Icon:ol.xml.makeChildAppender(ol.format.KML.writeIcon_),heading:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),hotSpot:ol.xml.makeChildAppender(ol.format.KML.writeVec2_),scale:ol.xml.makeChildAppender(ol.format.KML.writeScaleTextNode_)});ol.format.KML.LABEL_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["color","scale"]);ol.format.KML.LABEL_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_),scale:ol.xml.makeChildAppender(ol.format.KML.writeScaleTextNode_)});ol.format.KML.LINE_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["color","width"]);ol.format.KML.LINE_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_),width:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode)});ol.format.KML.BOUNDARY_IS_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_)});ol.format.KML.MULTI_GEOMETRY_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LineString:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Point:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Polygon:ol.xml.makeChildAppender(ol.format.KML.writePolygon_),GeometryCollection:ol.xml.makeChildAppender(ol.format.KML.writeMultiGeometry_)});ol.format.KML.PLACEMARK_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,"name open visibility address phoneNumber description styleUrl Style".split(" "));ol.format.KML.PLACEMARK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.xml.makeChildAppender(ol.format.KML.writeExtendedData_),MultiGeometry:ol.xml.makeChildAppender(ol.format.KML.writeMultiGeometry_),LineString:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),LinearRing:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Point:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Polygon:ol.xml.makeChildAppender(ol.format.KML.writePolygon_),Style:ol.xml.makeChildAppender(ol.format.KML.writeStyle_),address:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),description:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),open:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),phoneNumber:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),styleUrl:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),visibility:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode)});ol.format.KML.PRIMITIVE_GEOMETRY_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["extrude","tessellate","altitudeMode","coordinates"]);ol.format.KML.PRIMITIVE_GEOMETRY_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{extrude:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),tessellate:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),altitudeMode:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),coordinates:ol.xml.makeChildAppender(ol.format.KML.writeCoordinatesTextNode_)});ol.format.KML.POLYGON_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{outerBoundaryIs:ol.xml.makeChildAppender(ol.format.KML.writeBoundaryIs_),innerBoundaryIs:ol.xml.makeChildAppender(ol.format.KML.writeBoundaryIs_)});ol.format.KML.POLY_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_)});ol.format.KML.STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["IconStyle","LabelStyle","LineStyle","PolyStyle"]);ol.format.KML.STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{IconStyle:ol.xml.makeChildAppender(ol.format.KML.writeIconStyle_),LabelStyle:ol.xml.makeChildAppender(ol.format.KML.writeLabelStyle_),LineStyle:ol.xml.makeChildAppender(ol.format.KML.writeLineStyle_),PolyStyle:ol.xml.makeChildAppender(ol.format.KML.writePolyStyle_)});ol.format.KML.GX_NODE_FACTORY_=function(e,t,o){return ol.xml.createElementNS(ol.format.KML.GX_NAMESPACE_URIS_[0],"gx:"+o)};ol.format.KML.DOCUMENT_NODE_FACTORY_=function(e,t,o){return ol.xml.createElementNS(t[t.length-1].node.namespaceURI,"Placemark")};ol.format.KML.GEOMETRY_NODE_FACTORY_=function(e,t,o){if(e)return ol.xml.createElementNS(t[t.length-1].node.namespaceURI,ol.format.KML.GEOMETRY_TYPE_TO_NODENAME_[e.getType()])};ol.format.KML.COLOR_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("color");ol.format.KML.DATA_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Data");ol.format.KML.EXTENDEDDATA_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("ExtendedData");ol.format.KML.INNER_BOUNDARY_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("innerBoundaryIs");ol.format.KML.POINT_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Point");ol.format.KML.LINE_STRING_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("LineString");ol.format.KML.LINEAR_RING_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("LinearRing");ol.format.KML.POLYGON_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Polygon");ol.format.KML.OUTER_BOUNDARY_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("outerBoundaryIs");ol.format.KML.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS(ol.format.KML.NAMESPACE_URIS_[4],"kml");ol.xml.setAttributeNS(o,"http://www.w3.org/2000/xmlns/","xmlns:gx",ol.format.KML.GX_NAMESPACE_URIS_[0]);ol.xml.setAttributeNS(o,"http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",ol.format.KML.SCHEMA_LOCATION_);var r={node:o},n={};1<e.length?n.Document=e:1==e.length&&(n.Placemark=e[0]);e=ol.format.KML.KML_SEQUENCE_[o.namespaceURI];n=ol.xml.makeSequence(n,e);ol.xml.pushSerializeAndPop(r,ol.format.KML.KML_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,n,[t],e,this);return o};ol.ext.PBF=function(){};(function(){!function(e){function t(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0);this.type=this.pos=0;this.length=this.buf.length}function o(e,t,o){var r=o.buf,i=r[o.pos++],a=(112&i)>>4;if(128>i)return n(e,a,t);a|=(127&(i=r[o.pos++]))<<3;if(128>i)return n(e,a,t);a|=(127&(i=r[o.pos++]))<<10;if(128>i)return n(e,a,t);a|=(127&(i=r[o.pos++]))<<17;if(128>i)return n(e,a,t);a|=(127&(i=r[o.pos++]))<<24;if(128>i)return n(e,a,t);if(128>(i=r[o.pos++]))return n(e,a|(1&i)<<31,t);throw Error("Expected varint not more than 10 bytes")}function r(e){return e.type===t.Bytes?e.readVarint()+e.pos:e.pos+1}function n(e,t,o){return o?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function i(e,t,o){t=16383>=t?1:2097151>=t?2:268435455>=t?3:Math.ceil(Math.log(t)/(7*Math.LN2));o.realloc(t);for(var r=o.pos-1;r>=e;r--)o.buf[r+t]=o.buf[r]}function a(e,t){for(var o=0;o<e.length;o++)t.writeVarint(e[o])}function s(e,t){for(var o=0;o<e.length;o++)t.writeSVarint(e[o])}function l(e,t){for(var o=0;o<e.length;o++)t.writeFloat(e[o])}function c(e,t){for(var o=0;o<e.length;o++)t.writeDouble(e[o])}function u(e,t){for(var o=0;o<e.length;o++)t.writeBoolean(e[o])}function h(e,t){for(var o=0;o<e.length;o++)t.writeFixed32(e[o])}function d(e,t){for(var o=0;o<e.length;o++)t.writeSFixed32(e[o])}function p(e,t){for(var o=0;o<e.length;o++)t.writeFixed64(e[o])}function f(e,t){for(var o=0;o<e.length;o++)t.writeSFixed64(e[o])}function g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function m(e,t,o){e[o]=t;e[o+1]=t>>>8;e[o+2]=t>>>16;e[o+3]=t>>>24}function y(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}var C=function(e,t,o,r,n){var i=8*n-r-1,a=(1<<i)-1,s=a>>1,l=-7;n=o?n-1:0;var c=o?-1:1,u=e[t+n];n+=c;o=u&(1<<-l)-1;u>>=-l;for(l+=i;0<l;o=256*o+e[t+n],n+=c,l-=8);i=o&(1<<-l)-1;o>>=-l;for(l+=r;0<l;i=256*i+e[t+n],n+=c,l-=8);if(0===o)o=1-s;else{if(o===a)return i?NaN:1/0*(u?-1:1);i+=Math.pow(2,r);o-=s}return(u?-1:1)*i*Math.pow(2,o-r)},v=function(e,t,o,r,n,i){var a,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0;i=r?0:i-1;var h=r?1:-1,d=0>t||0===t&&0>1/t?1:0;t=Math.abs(t);isNaN(t)||1/0===t?(t=isNaN(t)?1:0,r=l):(r=Math.floor(Math.log(t)/Math.LN2),1>t*(a=Math.pow(2,-r))&&(r--,a*=2),2<=(t=1<=r+c?t+u/a:t+u*Math.pow(2,1-c))*a&&(r++,a/=2),r+c>=l?(t=0,r=l):1<=r+c?(t=(t*a-1)*Math.pow(2,n),r+=c):(t=t*Math.pow(2,c-1)*Math.pow(2,n),r=0));for(;8<=n;e[o+i]=255&t,i+=h,t/=256,n-=8);r=r<<n|t;for(s+=n;0<s;e[o+i]=255&r,i+=h,r/=256,s-=8);e[o+i-h]|=128*d};t.Varint=0;t.Fixed64=1;t.Bytes=2;t.Fixed32=5;var T=1/4294967296;t.prototype={destroy:function(){this.buf=null},readFields:function(e,t,o){for(o=o||this.length;this.pos<o;){var r=this.readVarint(),n=r>>3,i=this.pos;this.type=7&r;e(n,t,this);this.pos===i&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=g(this.buf,this.pos);this.pos+=4;return e},readSFixed32:function(){var e=y(this.buf,this.pos);this.pos+=4;return e},readFixed64:function(){var e=g(this.buf,this.pos)+4294967296*g(this.buf,this.pos+4);this.pos+=8;return e},readSFixed64:function(){var e=g(this.buf,this.pos)+4294967296*y(this.buf,this.pos+4);this.pos+=8;return e},readFloat:function(){var e=C(this.buf,this.pos,!0,23,4);this.pos+=4;return e},readDouble:function(){var e=C(this.buf,this.pos,!0,52,8);this.pos+=8;return e},readVarint:function(e){var t=this.buf,r=t[this.pos++],n=127&r;if(128>r)return n;n|=(127&(r=t[this.pos++]))<<7;if(128>r)return n;n|=(127&(r=t[this.pos++]))<<14;if(128>r)return n;n|=(127&(r=t[this.pos++]))<<21;return 128>r?n:o(n|(15&(r=t[this.pos]))<<28,e,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return 1==e%2?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){for(var e=this.readVarint()+this.pos,t=this.buf,o="",r=this.pos;r<e;){var n=t[r],i=null,a=239<n?4:223<n?3:191<n?2:1;if(r+a>e)break;if(1===a)128>n&&(i=n);else if(2===a){var s=t[r+1];128==(192&s)&&(127>=(i=(31&n)<<6|63&s)&&(i=null))}else if(3===a){s=t[r+1];var l=t[r+2];128==(192&s)&&128==(192&l)&&(2047>=(i=(15&n)<<12|(63&s)<<6|63&l)||55296<=i&&57343>=i)&&(i=null)}else if(4===a){s=t[r+1];l=t[r+2];var c=t[r+3];128==(192&s)&&128==(192&l)&&128==(192&c)&&(65535>=(i=(15&n)<<18|(63&s)<<12|(63&l)<<6|63&c)||1114112<=i)&&(i=null)}null===i?(i=65533,a=1):65535<i&&(i-=65536,o+=String.fromCharCode(i>>>10&1023|55296),i=56320|1023&i);o+=String.fromCharCode(i);r+=a}this.pos=e;return o},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);this.pos=e;return t},readPackedVarint:function(e,t){var o=r(this);for(e=e||[];this.pos<o;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=r(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){if((e&=7)===t.Varint)for(;127<this.buf[this.pos++];);else if(e===t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===t.Fixed32)this.pos+=4;else{if(e!==t.Fixed64)throw Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;t!==this.length&&((e=new Uint8Array(t)).set(this.buf),this.buf=e,this.length=t)},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4);m(this.buf,e,this.pos);this.pos+=4},writeSFixed32:function(e){this.realloc(4);m(this.buf,e,this.pos);this.pos+=4},writeFixed64:function(e){this.realloc(8);m(this.buf,-1&e,this.pos);m(this.buf,Math.floor(e*T),this.pos+4);this.pos+=8},writeSFixed64:function(e){this.realloc(8);m(this.buf,-1&e,this.pos);m(this.buf,Math.floor(e*T),this.pos+4);this.pos+=8},writeVarint:function(e){if(268435455<(e=+e||0)||0>e){if(0<=e)var t=e%4294967296|0,o=e/4294967296|0;else o=~(-e/4294967296),4294967295^(t=~(-e%4294967296))?t=t+1|0:(t=0,o=o+1|0);if(0x10000000000000000<=e||-0x10000000000000000>e)throw Error("Given varint doesn't fit into 10 bytes");this.realloc(10);e=t;this.buf[this.pos++]=127&e|128;e>>>=7;this.buf[this.pos++]=127&e|128;e>>>=7;this.buf[this.pos++]=127&e|128;e>>>=7;this.buf[this.pos++]=127&e|128;this.buf[this.pos]=e>>>7&127;this.buf[this.pos++]|=(7&o)<<4|((o>>>=3)?128:0);o&&(this.buf[this.pos++]=127&o|((o>>>=7)?128:0),o&&(this.buf[this.pos++]=127&o|((o>>>=7)?128:0),o&&(this.buf[this.pos++]=127&o|((o>>>=7)?128:0),o&&(this.buf[this.pos++]=127&o|((o>>>=7)?128:0),o&&(this.buf[this.pos++]=127&o)))))}else this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),127>=e||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),127>=e||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),127>=e||(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(0>e?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e);this.realloc(4*e.length);this.pos++;for(var t,o,r=this.pos,n=this.buf,a=this.pos,s=0;s<e.length;s++){if(55295<(t=e.charCodeAt(s))&&57344>t){if(!o){56319<t||s+1===e.length?(n[a++]=239,n[a++]=191,n[a++]=189):o=t;continue}if(56320>t){n[a++]=239;n[a++]=191;n[a++]=189;o=t;continue}t=o-55296<<10|t-56320|65536,o=null}else o&&(n[a++]=239,n[a++]=191,n[a++]=189,o=null);128>t?n[a++]=t:(2048>t?n[a++]=t>>6|192:(65536>t?n[a++]=t>>12|224:(n[a++]=t>>18|240,n[a++]=t>>12&63|128),n[a++]=t>>6&63|128),n[a++]=63&t|128)}this.pos=a;128<=(n=this.pos-r)&&i(r,n,this);this.pos=r-1;this.writeVarint(n);this.pos+=n},writeFloat:function(e){this.realloc(4);v(this.buf,e,this.pos,!0,23,4);this.pos+=4},writeDouble:function(e){this.realloc(8);v(this.buf,e,this.pos,!0,52,8);this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t);this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=e[o]},writeRawMessage:function(e,t){this.pos++;var o=this.pos;e(t,this);128<=(e=this.pos-o)&&i(o,e,this);this.pos=o-1;this.writeVarint(e);this.pos+=e},writeMessage:function(e,o,r){this.writeTag(e,t.Bytes);this.writeRawMessage(o,r)},writePackedVarint:function(e,t){this.writeMessage(e,a,t)},writePackedSVarint:function(e,t){this.writeMessage(e,s,t)},writePackedBoolean:function(e,t){this.writeMessage(e,u,t)},writePackedFloat:function(e,t){this.writeMessage(e,l,t)},writePackedDouble:function(e,t){this.writeMessage(e,c,t)},writePackedFixed32:function(e,t){this.writeMessage(e,h,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,d,t)},writePackedFixed64:function(e,t){this.writeMessage(e,p,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,f,t)},writeBytesField:function(e,o){this.writeTag(e,t.Bytes);this.writeBytes(o)},writeFixed32Field:function(e,o){this.writeTag(e,t.Fixed32);this.writeFixed32(o)},writeSFixed32Field:function(e,o){this.writeTag(e,t.Fixed32);this.writeSFixed32(o)},writeFixed64Field:function(e,o){this.writeTag(e,t.Fixed64);this.writeFixed64(o)},writeSFixed64Field:function(e,o){this.writeTag(e,t.Fixed64);this.writeSFixed64(o)},writeVarintField:function(e,o){this.writeTag(e,t.Varint);this.writeVarint(o)},writeSVarintField:function(e,o){this.writeTag(e,t.Varint);this.writeSVarint(o)},writeStringField:function(e,o){this.writeTag(e,t.Bytes);this.writeString(o)},writeFloatField:function(e,o){this.writeTag(e,t.Fixed32);this.writeFloat(o)},writeDoubleField:function(e,o){this.writeTag(e,t.Fixed64);this.writeDouble(o)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};e.default=t}(this.PBF=this.PBF||{})}).call(ol.ext);ol.ext.PBF=ol.ext.PBF.default;ol.render.Feature=function(e,t,o,r,n){this.id_=n;this.type_=e;this.flatCoordinates_=t;this.flatMidpoints_=this.flatInteriorPoints_=null;this.ends_=o;this.properties_=r;this.tmpTransform_=ol.transform.create()};ol.render.Feature.prototype.get=function(e){return this.properties_[e]};ol.render.Feature.prototype.getEnds=ol.render.Feature.prototype.getEndss=function(){return this.ends_};ol.render.Feature.prototype.getExtent=function(){this.extent_||(this.extent_=this.type_===ol.geom.GeometryType.POINT?ol.extent.createOrUpdateFromCoordinate(this.flatCoordinates_):ol.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2));return this.extent_};ol.render.Feature.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var e=ol.extent.getCenter(this.getExtent());this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRings(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_};ol.render.Feature.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var e=ol.geom.flat.center.linearRingss(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRingss(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_};ol.render.Feature.prototype.getFlatMidpoint=function(){this.flatMidpoints_||(this.flatMidpoints_=ol.geom.flat.interpolate.lineString(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5));return this.flatMidpoints_};ol.render.Feature.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var e=this.flatCoordinates_,t=0,o=this.ends_,r=0,n=o.length;r<n;++r){var i=o[r];t=ol.geom.flat.interpolate.lineString(e,t,i,2,.5);ol.array.extend(this.flatMidpoints_,t);t=i}}return this.flatMidpoints_};ol.render.Feature.prototype.getId=function(){return this.id_};ol.render.Feature.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_};ol.render.Feature.prototype.getFlatCoordinates=ol.render.Feature.prototype.getOrientedFlatCoordinates;ol.render.Feature.prototype.getGeometry=function(){return this};ol.render.Feature.prototype.getProperties=function(){return this.properties_};ol.render.Feature.prototype.getSimplifiedGeometry=ol.render.Feature.prototype.getGeometry;ol.render.Feature.prototype.getStride=function(){return 2};ol.render.Feature.prototype.getStyleFunction=ol.nullFunction;ol.render.Feature.prototype.getType=function(){return this.type_};ol.render.Feature.prototype.transform=function(e,t){t=e.getExtent();e=e.getWorldExtent();t=ol.extent.getHeight(e)/ol.extent.getHeight(t);var o=this.tmpTransform_;ol.transform.compose(o,e[0],e[3],t,-t,0,0,0);ol.geom.flat.transform.transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,o,this.flatCoordinates_)};ol.format.MVT=function(e){ol.format.Feature.call(this);e=e||{};this.defaultDataProjection=new ol.proj.Projection({code:"EPSG:3857",units:ol.proj.Units.TILE_PIXELS});this.featureClass_=e.featureClass?e.featureClass:ol.render.Feature;this.geometryName_=e.geometryName;this.layerName_=e.layerName?e.layerName:"layer";this.layers_=e.layers?e.layers:null;this.extent_=null};ol.inherits(ol.format.MVT,ol.format.Feature);ol.format.MVT.pbfReaders_={layers:function(e,t,o){if(3===e){e={keys:[],values:[],features:[]};var r=o.readVarint()+o.pos;o.readFields(ol.format.MVT.pbfReaders_.layer,e,r);e.length=e.features.length;e.length&&(t[e.name]=e)}},layer:function(e,t,o){if(15===e)t.version=o.readVarint();else if(1===e)t.name=o.readString();else if(5===e)t.extent=o.readVarint();else if(2===e)t.features.push(o.pos);else if(3===e)t.keys.push(o.readString());else if(4===e){e=null;for(var r=o.readVarint()+o.pos;o.pos<r;)e=1===(e=o.readVarint()>>3)?o.readString():2===e?o.readFloat():3===e?o.readDouble():4===e?o.readVarint64():5===e?o.readVarint():6===e?o.readSVarint():7===e?o.readBoolean():null;t.values.push(e)}},feature:function(e,t,o){if(1==e)t.id=o.readVarint();else if(2==e)for(e=o.readVarint()+o.pos;o.pos<e;){var r=t.layer.keys[o.readVarint()],n=t.layer.values[o.readVarint()];t.properties[r]=n}else 3==e?t.type=o.readVarint():4==e&&(t.geometry=o.pos)}};ol.format.MVT.readRawFeature_=function(e,t,o){e.pos=t.features[o];o=e.readVarint()+e.pos;t={layer:t,type:0,properties:{}};e.readFields(ol.format.MVT.pbfReaders_.feature,t,o);return t};ol.format.MVT.readRawGeometry_=function(e,t,o,r){e.pos=t.geometry;t=e.readVarint()+e.pos;for(var n=1,i=0,a=0,s=0,l=0,c=0;e.pos<t;)i||(n=7&(i=e.readVarint()),i>>=3),i--,1===n||2===n?(a+=e.readSVarint(),s+=e.readSVarint(),1===n&&l>c&&(r.push(l),c=l),o.push(a,s),l+=2):7===n?l>c&&(o.push(o[c],o[c+1]),l+=2):ol.asserts.assert(!1,59);l>c&&r.push(l)};ol.format.MVT.getGeometryType_=function(e,t){if(1===e)var o=1===t?ol.geom.GeometryType.POINT:ol.geom.GeometryType.MULTI_POINT;else 2===e?o=1===t?ol.geom.GeometryType.LINE_STRING:ol.geom.GeometryType.MULTI_LINE_STRING:3===e&&(o=ol.geom.GeometryType.POLYGON);return o};ol.format.MVT.prototype.createFeature_=function(e,t,o){var r=t.type;if(0===r)return null;var n=t.id,i=t.properties;i[this.layerName_]=t.layer.name;var a=[],s=[];ol.format.MVT.readRawGeometry_(e,t,a,s);e=ol.format.MVT.getGeometryType_(r,s.length);if(this.featureClass_===ol.render.Feature)a=new this.featureClass_(e,a,s,i,n);else{if(e==ol.geom.GeometryType.POLYGON){e=[];for(var l=r=t=0,c=s.length;l<c;++l){var u=s[l];ol.geom.flat.orient.linearRingIsClockwise(a,t,u,2)||(e.push(s.slice(r,l)),r=l);t=u}1<e.length?(s=e,e=new ol.geom.MultiPolygon(null)):e=new ol.geom.Polygon(null)}else e=e===ol.geom.GeometryType.POINT?new ol.geom.Point(null):e===ol.geom.GeometryType.LINE_STRING?new ol.geom.LineString(null):e===ol.geom.GeometryType.POLYGON?new ol.geom.Polygon(null):e===ol.geom.GeometryType.MULTI_POINT?new ol.geom.MultiPoint(null):e===ol.geom.GeometryType.MULTI_LINE_STRING?new ol.geom.MultiLineString(null):null;e.setFlatCoordinates(ol.geom.GeometryLayout.XY,a,s);a=new this.featureClass_;this.geometryName_&&a.setGeometryName(this.geometryName_);o=ol.format.Feature.transformWithOptions(e,!1,this.adaptOptions(o));a.setGeometry(o);a.setId(n);a.setProperties(i)}return a};ol.format.MVT.prototype.getLastExtent=function(){return this.extent_};ol.format.MVT.prototype.getType=function(){return ol.format.FormatType.ARRAY_BUFFER};ol.format.MVT.prototype.readFeatures=function(e,t){t=this.layers_;var o,r=(e=new ol.ext.PBF(e)).readFields(ol.format.MVT.pbfReaders_.layers,{}),n=[];for(o in r)if(!t||-1!=t.indexOf(o)){for(var i,a=r[o],s=0,l=a.length;s<l;++s)i=ol.format.MVT.readRawFeature_(e,a,s),n.push(this.createFeature_(e,i));this.extent_=a?[0,0,a.extent,a.extent]:null}return n};ol.format.MVT.prototype.readProjection=function(e){return this.defaultDataProjection};ol.format.MVT.prototype.setLayers=function(e){this.layers_=e};ol.format.MVT.prototype.readFeature=function(){};ol.format.MVT.prototype.readGeometry=function(){};ol.format.MVT.prototype.writeFeature=function(){};ol.format.MVT.prototype.writeGeometry=function(){};ol.format.MVT.prototype.writeFeatures=function(){};ol.format.OSMXML=function(){ol.format.XMLFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326")};ol.inherits(ol.format.OSMXML,ol.format.XMLFeature);ol.format.OSMXML.readNode_=function(e,t){var o=t[0],r=t[t.length-1],n=e.getAttribute("id"),i=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))];r.nodes[n]=i;e=ol.xml.pushParseAndPop({tags:{}},ol.format.OSMXML.NODE_PARSERS_,e,t);ol.obj.isEmpty(e.tags)||(i=new ol.geom.Point(i),ol.format.Feature.transformWithOptions(i,!1,o),(o=new ol.Feature(i)).setId(n),o.setProperties(e.tags),r.features.push(o))};ol.format.OSMXML.readWay_=function(e,t){var o=e.getAttribute("id");e=ol.xml.pushParseAndPop({id:o,ndrefs:[],tags:{}},ol.format.OSMXML.WAY_PARSERS_,e,t);t[t.length-1].ways.push(e)};ol.format.OSMXML.readNd_=function(e,t){t[t.length-1].ndrefs.push(e.getAttribute("ref"))};ol.format.OSMXML.readTag_=function(e,t){t[t.length-1].tags[e.getAttribute("k")]=e.getAttribute("v")};ol.format.OSMXML.NAMESPACE_URIS_=[null];ol.format.OSMXML.WAY_PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{nd:ol.format.OSMXML.readNd_,tag:ol.format.OSMXML.readTag_});ol.format.OSMXML.PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{node:ol.format.OSMXML.readNode_,way:ol.format.OSMXML.readWay_});ol.format.OSMXML.NODE_PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{tag:ol.format.OSMXML.readTag_});ol.format.OSMXML.prototype.readFeaturesFromNode=function(e,t){t=this.getReadOptions(e,t);if("osm"==e.localName){e=ol.xml.pushParseAndPop({nodes:{},ways:[],features:[]},ol.format.OSMXML.PARSERS_,e,[t]);for(var o=0;o<e.ways.length;o++){for(var r=e.ways[o],n=[],i=0,a=r.ndrefs.length;i<a;i++)ol.array.extend(n,e.nodes[r.ndrefs[i]]);r.ndrefs[0]==r.ndrefs[r.ndrefs.length-1]?(i=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,n,[n.length]):(i=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,n);ol.format.Feature.transformWithOptions(i,!1,t);(n=new ol.Feature(i)).setId(r.id);n.setProperties(r.tags);e.features.push(n)}if(e.features)return e.features}return[]};ol.format.OSMXML.prototype.writeFeatureNode=function(e,t){};ol.format.OSMXML.prototype.writeFeaturesNode=function(e,t){};ol.format.OSMXML.prototype.writeGeometryNode=function(e,t){};ol.geom.flat.flip={};ol.geom.flat.flip.flipXY=function(e,t,o,r,n,i){void 0!==n?i=void 0!==i?i:0:(n=[],i=0);for(;t<o;){var a=e[t++];n[i++]=e[t++];n[i++]=a;for(a=2;a<r;++a)n[i++]=e[t++]}n.length=i;return n};ol.format.Polyline=function(e){e=e||{};ol.format.TextFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.factor_=e.factor?e.factor:1e5;this.geometryLayout_=e.geometryLayout?e.geometryLayout:ol.geom.GeometryLayout.XY};ol.inherits(ol.format.Polyline,ol.format.TextFeature);ol.format.Polyline.encodeDeltas=function(e,t,o){var r,n,i=Array(t);for(r=0;r<t;++r)i[r]=0;var a=0;for(n=e.length;a<n;)for(r=0;r<t;++r,++a){var s=e[a],l=s-i[r];i[r]=s;e[a]=l}return ol.format.Polyline.encodeFloats(e,o||1e5)};ol.format.Polyline.decodeDeltas=function(e,t,o){var r,n,i=Array(t);for(r=0;r<t;++r)i[r]=0;e=ol.format.Polyline.decodeFloats(e,o||1e5);o=0;for(n=e.length;o<n;)for(r=0;r<t;++r,++o)i[r]+=e[o],e[o]=i[r];return e};ol.format.Polyline.encodeFloats=function(e,t){t=t||1e5;var o,r=0;for(o=e.length;r<o;++r)e[r]=Math.round(e[r]*t);return ol.format.Polyline.encodeSignedIntegers(e)};ol.format.Polyline.decodeFloats=function(e,t){t=t||1e5;var o,r=0;for(o=(e=ol.format.Polyline.decodeSignedIntegers(e)).length;r<o;++r)e[r]/=t;return e};ol.format.Polyline.encodeSignedIntegers=function(e){var t,o=0;for(t=e.length;o<t;++o){var r=e[o];e[o]=0>r?~(r<<1):r<<1}return ol.format.Polyline.encodeUnsignedIntegers(e)};ol.format.Polyline.decodeSignedIntegers=function(e){var t,o=0;for(t=(e=ol.format.Polyline.decodeUnsignedIntegers(e)).length;o<t;++o){var r=e[o];e[o]=1&r?~(r>>1):r>>1}return e};ol.format.Polyline.encodeUnsignedIntegers=function(e){var t,o="",r=0;for(t=e.length;r<t;++r)o+=ol.format.Polyline.encodeUnsignedInteger(e[r]);return o};ol.format.Polyline.decodeUnsignedIntegers=function(e){var t,o=[],r=0,n=0,i=0;for(t=e.length;i<t;++i){var a=e.charCodeAt(i)-63;r|=(31&a)<<n;32>a?(o.push(r),n=r=0):n+=5}return o};ol.format.Polyline.encodeUnsignedInteger=function(e){for(var t,o="";32<=e;)t=63+(32|31&e),o+=String.fromCharCode(t),e>>=5;return o+String.fromCharCode(e+63)};ol.format.Polyline.prototype.readFeatureFromText=function(e,t){e=this.readGeometryFromText(e,t);return new ol.Feature(e)};ol.format.Polyline.prototype.readFeaturesFromText=function(e,t){return[this.readFeatureFromText(e,t)]};ol.format.Polyline.prototype.readGeometryFromText=function(e,t){var o=ol.geom.SimpleGeometry.getStrideForLayout(this.geometryLayout_);e=ol.format.Polyline.decodeDeltas(e,o,this.factor_);ol.geom.flat.flip.flipXY(e,0,e.length,o,e);o=ol.geom.flat.inflate.coordinates(e,0,e.length,o);return ol.format.Feature.transformWithOptions(new ol.geom.LineString(o,this.geometryLayout_),!1,this.adaptOptions(t))};ol.format.Polyline.prototype.writeFeatureText=function(e,t){if(e=e.getGeometry())return this.writeGeometryText(e,t);ol.asserts.assert(!1,40);return""};ol.format.Polyline.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)};ol.format.Polyline.prototype.writeGeometryText=function(e,t){t=(e=ol.format.Feature.transformWithOptions(e,!0,this.adaptOptions(t))).getFlatCoordinates();e=e.getStride();ol.geom.flat.flip.flipXY(t,0,t.length,e,t);return ol.format.Polyline.encodeDeltas(t,e,this.factor_)};ol.format.TopoJSON=function(e){e=e||{};ol.format.JSONFeature.call(this);this.layerName_=e.layerName;this.layers_=e.layers?e.layers:null;this.defaultDataProjection=ol.proj.get(e.defaultDataProjection?e.defaultDataProjection:"EPSG:4326")};ol.inherits(ol.format.TopoJSON,ol.format.JSONFeature);ol.format.TopoJSON.concatenateArcs_=function(e,t){var o,r=[],n=0;for(o=e.length;n<o;++n){var i=e[n];0<n&&r.pop();i=0<=i?t[i]:t[~i].slice().reverse();r.push.apply(r,i)}e=0;for(t=r.length;e<t;++e)r[e]=r[e].slice();return r};ol.format.TopoJSON.readPointGeometry_=function(e,t,o){e=e.coordinates;t&&o&&ol.format.TopoJSON.transformVertex_(e,t,o);return new ol.geom.Point(e)};ol.format.TopoJSON.readMultiPointGeometry_=function(e,t,o){e=e.coordinates;var r;if(t&&o){var n=0;for(r=e.length;n<r;++n)ol.format.TopoJSON.transformVertex_(e[n],t,o)}return new ol.geom.MultiPoint(e)};ol.format.TopoJSON.readLineStringGeometry_=function(e,t){e=ol.format.TopoJSON.concatenateArcs_(e.arcs,t);return new ol.geom.LineString(e)};ol.format.TopoJSON.readMultiLineStringGeometry_=function(e,t){var o,r=[],n=0;for(o=e.arcs.length;n<o;++n)r[n]=ol.format.TopoJSON.concatenateArcs_(e.arcs[n],t);return new ol.geom.MultiLineString(r)};ol.format.TopoJSON.readPolygonGeometry_=function(e,t){var o,r=[],n=0;for(o=e.arcs.length;n<o;++n)r[n]=ol.format.TopoJSON.concatenateArcs_(e.arcs[n],t);return new ol.geom.Polygon(r)};ol.format.TopoJSON.readMultiPolygonGeometry_=function(e,t){var o,r,n=[],i=0;for(r=e.arcs.length;i<r;++i){var a=e.arcs[i],s=[],l=0;for(o=a.length;l<o;++l)s[l]=ol.format.TopoJSON.concatenateArcs_(a[l],t);n[i]=s}return new ol.geom.MultiPolygon(n)};ol.format.TopoJSON.readFeaturesFromGeometryCollection_=function(e,t,o,r,n,i,a){var s,l=[],c=0;for(s=(e=e.geometries).length;c<s;++c)l[c]=ol.format.TopoJSON.readFeatureFromGeometry_(e[c],t,o,r,n,i,a);return l};ol.format.TopoJSON.readFeatureFromGeometry_=function(e,t,o,r,n,i,a){var s=e.type,l=ol.format.TopoJSON.GEOMETRY_READERS_[s];o="Point"===s||"MultiPoint"===s?l(e,o,r):l(e,t);(t=new ol.Feature).setGeometry(ol.format.Feature.transformWithOptions(o,!1,a));void 0!==e.id&&t.setId(e.id);e=e.properties;n&&(e||(e={}),e[n]=i);e&&t.setProperties(e);return t};ol.format.TopoJSON.prototype.readFeaturesFromObject=function(e,t){if("Topology"==e.type){var o=null,r=null;if(e.transform){var n=e.transform;o=n.scale;r=n.translate}var i=e.arcs;n&&ol.format.TopoJSON.transformArcs_(i,o,r);n=[];e=e.objects;var a,s=this.layerName_;for(a in e)if(!this.layers_||-1!=this.layers_.indexOf(a))if("GeometryCollection"===e[a].type){var l=e[a];n.push.apply(n,ol.format.TopoJSON.readFeaturesFromGeometryCollection_(l,i,o,r,s,a,t))}else l=e[a],n.push(ol.format.TopoJSON.readFeatureFromGeometry_(l,i,o,r,s,a,t));return n}return[]};ol.format.TopoJSON.transformArcs_=function(e,t,o){var r,n=0;for(r=e.length;n<r;++n)ol.format.TopoJSON.transformArc_(e[n],t,o)};ol.format.TopoJSON.transformArc_=function(e,t,o){var r,n=0,i=0,a=0;for(r=e.length;a<r;++a){var s=e[a];n+=s[0];i+=s[1];s[0]=n;s[1]=i;ol.format.TopoJSON.transformVertex_(s,t,o)}};ol.format.TopoJSON.transformVertex_=function(e,t,o){e[0]=e[0]*t[0]+o[0];e[1]=e[1]*t[1]+o[1]};ol.format.TopoJSON.prototype.readProjectionFromObject=function(e){return this.defaultDataProjection};ol.format.TopoJSON.GEOMETRY_READERS_={Point:ol.format.TopoJSON.readPointGeometry_,LineString:ol.format.TopoJSON.readLineStringGeometry_,Polygon:ol.format.TopoJSON.readPolygonGeometry_,MultiPoint:ol.format.TopoJSON.readMultiPointGeometry_,MultiLineString:ol.format.TopoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.TopoJSON.readMultiPolygonGeometry_};ol.format.TopoJSON.prototype.writeFeatureObject=function(e,t){};ol.format.TopoJSON.prototype.writeFeaturesObject=function(e,t){};ol.format.TopoJSON.prototype.writeGeometryObject=function(e,t){};ol.format.TopoJSON.prototype.readGeometryFromObject=function(){};ol.format.TopoJSON.prototype.readFeatureFromObject=function(){};ol.format.filter={};ol.format.filter.Filter=function(e){this.tagName_=e};ol.format.filter.Filter.prototype.getTagName=function(){return this.tagName_};ol.format.filter.LogicalNary=function(e,t){ol.format.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1);ol.asserts.assert(2<=this.conditions.length,57)};ol.inherits(ol.format.filter.LogicalNary,ol.format.filter.Filter);ol.format.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));ol.format.filter.LogicalNary.apply(this,t)};ol.inherits(ol.format.filter.And,ol.format.filter.LogicalNary);ol.format.filter.Bbox=function(e,t,o){ol.format.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};ol.inherits(ol.format.filter.Bbox,ol.format.filter.Filter);ol.format.filter.Spatial=function(e,t,o,r){ol.format.filter.Filter.call(this,e);this.geometryName=t||"the_geom";this.geometry=o;this.srsName=r};ol.inherits(ol.format.filter.Spatial,ol.format.filter.Filter);ol.format.filter.Contains=function(e,t,o){ol.format.filter.Spatial.call(this,"Contains",e,t,o)};ol.inherits(ol.format.filter.Contains,ol.format.filter.Spatial);ol.format.filter.Comparison=function(e,t){ol.format.filter.Filter.call(this,e);this.propertyName=t};ol.inherits(ol.format.filter.Comparison,ol.format.filter.Filter);ol.format.filter.During=function(e,t,o){ol.format.filter.Comparison.call(this,"During",e);this.begin=t;this.end=o};ol.inherits(ol.format.filter.During,ol.format.filter.Comparison);ol.format.filter.ComparisonBinary=function(e,t,o,r){ol.format.filter.Comparison.call(this,e,t);this.expression=o;this.matchCase=r};ol.inherits(ol.format.filter.ComparisonBinary,ol.format.filter.Comparison);ol.format.filter.EqualTo=function(e,t,o){ol.format.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,o)};ol.inherits(ol.format.filter.EqualTo,ol.format.filter.ComparisonBinary);ol.format.filter.GreaterThan=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};ol.inherits(ol.format.filter.GreaterThan,ol.format.filter.ComparisonBinary);ol.format.filter.GreaterThanOrEqualTo=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};ol.inherits(ol.format.filter.GreaterThanOrEqualTo,ol.format.filter.ComparisonBinary);ol.format.filter.Intersects=function(e,t,o){ol.format.filter.Spatial.call(this,"Intersects",e,t,o)};ol.inherits(ol.format.filter.Intersects,ol.format.filter.Spatial);ol.format.filter.IsBetween=function(e,t,o){ol.format.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=o};ol.inherits(ol.format.filter.IsBetween,ol.format.filter.Comparison);ol.format.filter.IsLike=function(e,t,o,r,n,i){ol.format.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==o?o:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==n?n:"!";this.matchCase=i};ol.inherits(ol.format.filter.IsLike,ol.format.filter.Comparison);ol.format.filter.IsNull=function(e){ol.format.filter.Comparison.call(this,"PropertyIsNull",e)};ol.inherits(ol.format.filter.IsNull,ol.format.filter.Comparison);ol.format.filter.LessThan=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};ol.inherits(ol.format.filter.LessThan,ol.format.filter.ComparisonBinary);ol.format.filter.LessThanOrEqualTo=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};ol.inherits(ol.format.filter.LessThanOrEqualTo,ol.format.filter.ComparisonBinary);ol.format.filter.Not=function(e){ol.format.filter.Filter.call(this,"Not");this.condition=e};ol.inherits(ol.format.filter.Not,ol.format.filter.Filter);ol.format.filter.NotEqualTo=function(e,t,o){ol.format.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,o)};ol.inherits(ol.format.filter.NotEqualTo,ol.format.filter.ComparisonBinary);ol.format.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));ol.format.filter.LogicalNary.apply(this,t)};ol.inherits(ol.format.filter.Or,ol.format.filter.LogicalNary);ol.format.filter.Within=function(e,t,o){ol.format.filter.Spatial.call(this,"Within",e,t,o)};ol.inherits(ol.format.filter.Within,ol.format.filter.Spatial);ol.format.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(ol.format.filter.And,t))};ol.format.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(ol.format.filter.Or,t))};ol.format.filter.not=function(e){return new ol.format.filter.Not(e)};ol.format.filter.bbox=function(e,t,o){return new ol.format.filter.Bbox(e,t,o)};ol.format.filter.contains=function(e,t,o){return new ol.format.filter.Contains(e,t,o)};ol.format.filter.intersects=function(e,t,o){return new ol.format.filter.Intersects(e,t,o)};ol.format.filter.within=function(e,t,o){return new ol.format.filter.Within(e,t,o)};ol.format.filter.equalTo=function(e,t,o){return new ol.format.filter.EqualTo(e,t,o)};ol.format.filter.notEqualTo=function(e,t,o){return new ol.format.filter.NotEqualTo(e,t,o)};ol.format.filter.lessThan=function(e,t){return new ol.format.filter.LessThan(e,t)};ol.format.filter.lessThanOrEqualTo=function(e,t){return new ol.format.filter.LessThanOrEqualTo(e,t)};ol.format.filter.greaterThan=function(e,t){return new ol.format.filter.GreaterThan(e,t)};ol.format.filter.greaterThanOrEqualTo=function(e,t){return new ol.format.filter.GreaterThanOrEqualTo(e,t)};ol.format.filter.isNull=function(e){return new ol.format.filter.IsNull(e)};ol.format.filter.between=function(e,t,o){return new ol.format.filter.IsBetween(e,t,o)};ol.format.filter.like=function(e,t,o,r,n,i){return new ol.format.filter.IsLike(e,t,o,r,n,i)};ol.format.filter.during=function(e,t,o){return new ol.format.filter.During(e,t,o)};ol.format.WFS=function(e){e=e||{};this.featureType_=e.featureType;this.featureNS_=e.featureNS;this.gmlFormat_=e.gmlFormat?e.gmlFormat:new ol.format.GML3;this.schemaLocation_=e.schemaLocation?e.schemaLocation:ol.format.WFS.SCHEMA_LOCATIONS[ol.format.WFS.DEFAULT_VERSION];ol.format.XMLFeature.call(this)};ol.inherits(ol.format.WFS,ol.format.XMLFeature);ol.format.WFS.FEATURE_PREFIX="feature";ol.format.WFS.XMLNS="http://www.w3.org/2000/xmlns/";ol.format.WFS.OGCNS="http://www.opengis.net/ogc";ol.format.WFS.WFSNS="http://www.opengis.net/wfs";ol.format.WFS.FESNS="http://www.opengis.net/fes";ol.format.WFS.SCHEMA_LOCATIONS={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"};ol.format.WFS.DEFAULT_VERSION="1.1.0";ol.format.WFS.prototype.getFeatureType=function(){return this.featureType_};ol.format.WFS.prototype.setFeatureType=function(e){this.featureType_=e};ol.format.WFS.prototype.readFeaturesFromNode=function(e,t){var o={featureType:this.featureType_,featureNS:this.featureNS_};ol.obj.assign(o,this.getReadOptions(e,t||{}));t=[o];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS].featureMember=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal);(e=ol.xml.pushParseAndPop([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,t,this.gmlFormat_))||(e=[]);return e};ol.format.WFS.prototype.readTransactionResponse=function(e){return ol.xml.isDocument(e)?this.readTransactionResponseFromDocument(e):ol.xml.isNode(e)?this.readTransactionResponseFromNode(e):"string"==typeof e?(e=ol.xml.parse(e),this.readTransactionResponseFromDocument(e)):void 0};ol.format.WFS.prototype.readFeatureCollectionMetadata=function(e){return ol.xml.isDocument(e)?this.readFeatureCollectionMetadataFromDocument(e):ol.xml.isNode(e)?this.readFeatureCollectionMetadataFromNode(e):"string"==typeof e?(e=ol.xml.parse(e),this.readFeatureCollectionMetadataFromDocument(e)):void 0};ol.format.WFS.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)};ol.format.WFS.FEATURE_COLLECTION_PARSERS_={"http://www.opengis.net/gml":{boundedBy:ol.xml.makeObjectPropertySetter(ol.format.GMLBase.prototype.readGeometryElement,"bounds")}};ol.format.WFS.prototype.readFeatureCollectionMetadataFromNode=function(e){var t={},o=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("numberOfFeatures"));t.numberOfFeatures=o;return ol.xml.pushParseAndPop(t,ol.format.WFS.FEATURE_COLLECTION_PARSERS_,e,[],this.gmlFormat_)};ol.format.WFS.TRANSACTION_SUMMARY_PARSERS_={"http://www.opengis.net/wfs":{totalInserted:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),totalUpdated:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),totalDeleted:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)}};ol.format.WFS.readTransactionSummary_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WFS.TRANSACTION_SUMMARY_PARSERS_,e,t)};ol.format.WFS.OGC_FID_PARSERS_={"http://www.opengis.net/ogc":{FeatureId:ol.xml.makeArrayPusher(function(e,t){return e.getAttribute("fid")})}};ol.format.WFS.fidParser_=function(e,t){ol.xml.parseNode(ol.format.WFS.OGC_FID_PARSERS_,e,t)};ol.format.WFS.INSERT_RESULTS_PARSERS_={"http://www.opengis.net/wfs":{Feature:ol.format.WFS.fidParser_}};ol.format.WFS.readInsertResults_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WFS.INSERT_RESULTS_PARSERS_,e,t)};ol.format.WFS.TRANSACTION_RESPONSE_PARSERS_={"http://www.opengis.net/wfs":{TransactionSummary:ol.xml.makeObjectPropertySetter(ol.format.WFS.readTransactionSummary_,"transactionSummary"),InsertResults:ol.xml.makeObjectPropertySetter(ol.format.WFS.readInsertResults_,"insertIds")}};ol.format.WFS.prototype.readTransactionResponseFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)};ol.format.WFS.prototype.readTransactionResponseFromNode=function(e){return ol.xml.pushParseAndPop({},ol.format.WFS.TRANSACTION_RESPONSE_PARSERS_,e,[])};ol.format.WFS.QUERY_SERIALIZERS_={"http://www.opengis.net/wfs":{PropertyName:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};ol.format.WFS.writeFeature_=function(e,t,o){var r=o[o.length-1],n=r.gmlVersion;r=ol.xml.createElementNS(r.featureNS,r.featureType);e.appendChild(r);2===n?ol.format.GML2.prototype.writeFeatureElement(r,t,o):ol.format.GML3.prototype.writeFeatureElement(r,t,o)};ol.format.WFS.writeOgcFidFilter_=function(e,t,o){o=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter");var r=ol.xml.createElementNS(ol.format.WFS.OGCNS,"FeatureId");o.appendChild(r);r.setAttribute("fid",t);e.appendChild(o)};ol.format.WFS.getTypeName_=function(e,t){e=e||ol.format.WFS.FEATURE_PREFIX;e+=":";return 0===t.indexOf(e)?t:e+t};ol.format.WFS.writeDelete_=function(e,t,o){var r=o[o.length-1];ol.asserts.assert(void 0!==t.getId(),26);var n=r.featurePrefix,i=r.featureNS;r=ol.format.WFS.getTypeName_(n,r.featureType);e.setAttribute("typeName",r);ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,i);void 0!==(t=t.getId())&&ol.format.WFS.writeOgcFidFilter_(e,t,o)};ol.format.WFS.writeUpdate_=function(e,t,o){var r=o[o.length-1];ol.asserts.assert(void 0!==t.getId(),27);var n=r.featurePrefix,i=r.featureNS,a=ol.format.WFS.getTypeName_(n,r.featureType),s=t.getGeometryName();e.setAttribute("typeName",a);ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,i);if(void 0!==(n=t.getId())){i=t.getKeys();a=[];for(var l=0,c=i.length;l<c;l++){var u=t.get(i[l]);if(void 0!==u){var h=i[l];u instanceof ol.geom.Geometry&&(h=s);a.push({name:h,value:u})}}ol.xml.pushSerializeAndPop({gmlVersion:r.gmlVersion,node:e,hasZ:r.hasZ,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Property"),a,o);ol.format.WFS.writeOgcFidFilter_(e,n,o)}};ol.format.WFS.writeProperty_=function(e,t,o){var r=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Name"),n=o[o.length-1].gmlVersion;e.appendChild(r);ol.format.XSD.writeStringTextNode(r,t.name);void 0!==t.value&&null!==t.value&&(r=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Value"),e.appendChild(r),t.value instanceof ol.geom.Geometry?2===n?ol.format.GML2.prototype.writeGeometryElement(r,t.value,o):ol.format.GML3.prototype.writeGeometryElement(r,t.value,o):ol.format.XSD.writeStringTextNode(r,t.value))};ol.format.WFS.writeNative_=function(e,t,o){t.vendorId&&e.setAttribute("vendorId",t.vendorId);void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",t.safeToIgnore);void 0!==t.value&&ol.format.XSD.writeStringTextNode(e,t.value)};ol.format.WFS.TRANSACTION_SERIALIZERS_={"http://www.opengis.net/wfs":{Insert:ol.xml.makeChildAppender(ol.format.WFS.writeFeature_),Update:ol.xml.makeChildAppender(ol.format.WFS.writeUpdate_),Delete:ol.xml.makeChildAppender(ol.format.WFS.writeDelete_),Property:ol.xml.makeChildAppender(ol.format.WFS.writeProperty_),Native:ol.xml.makeChildAppender(ol.format.WFS.writeNative_)}};ol.format.WFS.writeQuery_=function(e,t,o){var r=o[o.length-1],n=r.featurePrefix,i=r.featureNS,a=r.propertyNames,s=r.srsName;t=n?ol.format.WFS.getTypeName_(n,t):t;e.setAttribute("typeName",t);s&&e.setAttribute("srsName",s);i&&ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,i);(n=ol.obj.assign({},r)).node=e;ol.xml.pushSerializeAndPop(n,ol.format.WFS.QUERY_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("PropertyName"),a,o);(r=r.filter)&&(a=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter"),e.appendChild(a),ol.format.WFS.writeFilterCondition_(a,r,o))};ol.format.WFS.writeFilterCondition_=function(e,t,o){ol.xml.pushSerializeAndPop({node:e},ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(t.getTagName()),[t],o)};ol.format.WFS.writeBboxFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.extent,o)};ol.format.WFS.writeContainsFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeIntersectsFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeWithinFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeDuringFilter_=function(e,t,o){o=ol.xml.createElementNS(ol.format.WFS.FESNS,"ValueReference");ol.format.XSD.writeStringTextNode(o,t.propertyName);e.appendChild(o);o=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"TimePeriod");e.appendChild(o);e=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"begin");o.appendChild(e);ol.format.WFS.writeTimeInstant_(e,t.begin);e=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"end");o.appendChild(e);ol.format.WFS.writeTimeInstant_(e,t.end)};ol.format.WFS.writeLogicalFilter_=function(e,t,o){e={node:e};for(var r=0,n=(t=t.conditions).length;r<n;++r){var i=t[r];ol.xml.pushSerializeAndPop(e,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(i.getTagName()),[i],o)}};ol.format.WFS.writeNotFilter_=function(e,t,o){t=t.condition;ol.xml.pushSerializeAndPop({node:e},ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(t.getTagName()),[t],o)};ol.format.WFS.writeComparisonFilter_=function(e,t,o){void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString());ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);ol.format.WFS.writeOgcLiteral_(e,""+t.expression)};ol.format.WFS.writeIsNullFilter_=function(e,t,o){ol.format.WFS.writeOgcPropertyName_(e,t.propertyName)};ol.format.WFS.writeIsBetweenFilter_=function(e,t,o){ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);o=ol.xml.createElementNS(ol.format.WFS.OGCNS,"LowerBoundary");e.appendChild(o);ol.format.WFS.writeOgcLiteral_(o,""+t.lowerBoundary);o=ol.xml.createElementNS(ol.format.WFS.OGCNS,"UpperBoundary");e.appendChild(o);ol.format.WFS.writeOgcLiteral_(o,""+t.upperBoundary)};ol.format.WFS.writeIsLikeFilter_=function(e,t,o){e.setAttribute("wildCard",t.wildCard);e.setAttribute("singleChar",t.singleChar);e.setAttribute("escapeChar",t.escapeChar);void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString());ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);ol.format.WFS.writeOgcLiteral_(e,""+t.pattern)};ol.format.WFS.writeOgcExpression_=function(e,t,o){e=ol.xml.createElementNS(ol.format.WFS.OGCNS,e);ol.format.XSD.writeStringTextNode(e,o);t.appendChild(e)};ol.format.WFS.writeOgcPropertyName_=function(e,t){ol.format.WFS.writeOgcExpression_("PropertyName",e,t)};ol.format.WFS.writeOgcLiteral_=function(e,t){ol.format.WFS.writeOgcExpression_("Literal",e,t)};ol.format.WFS.writeTimeInstant_=function(e,t){var o=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"TimeInstant");e.appendChild(o);e=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"timePosition");o.appendChild(e);ol.format.XSD.writeStringTextNode(e,t)};ol.format.WFS.GETFEATURE_SERIALIZERS_={"http://www.opengis.net/wfs":{Query:ol.xml.makeChildAppender(ol.format.WFS.writeQuery_)},"http://www.opengis.net/ogc":{During:ol.xml.makeChildAppender(ol.format.WFS.writeDuringFilter_),And:ol.xml.makeChildAppender(ol.format.WFS.writeLogicalFilter_),Or:ol.xml.makeChildAppender(ol.format.WFS.writeLogicalFilter_),Not:ol.xml.makeChildAppender(ol.format.WFS.writeNotFilter_),BBOX:ol.xml.makeChildAppender(ol.format.WFS.writeBboxFilter_),Contains:ol.xml.makeChildAppender(ol.format.WFS.writeContainsFilter_),Intersects:ol.xml.makeChildAppender(ol.format.WFS.writeIntersectsFilter_),Within:ol.xml.makeChildAppender(ol.format.WFS.writeWithinFilter_),PropertyIsEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsNotEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsLessThan:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsLessThanOrEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsGreaterThan:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsGreaterThanOrEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsNull:ol.xml.makeChildAppender(ol.format.WFS.writeIsNullFilter_),PropertyIsBetween:ol.xml.makeChildAppender(ol.format.WFS.writeIsBetweenFilter_),PropertyIsLike:ol.xml.makeChildAppender(ol.format.WFS.writeIsLikeFilter_)}};ol.format.WFS.writeFilter=function(e){var t=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter");ol.format.WFS.writeFilterCondition_(t,e,[]);return t};ol.format.WFS.writeGetFeature_=function(e,t,o){var r=ol.obj.assign({},o[o.length-1]);r.node=e;ol.xml.pushSerializeAndPop(r,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Query"),t,o)};ol.format.WFS.prototype.writeGetFeature=function(e){var t=ol.xml.createElementNS(ol.format.WFS.WFSNS,"GetFeature");t.setAttribute("service","WFS");t.setAttribute("version","1.1.0");if(e){e.handle&&t.setAttribute("handle",e.handle);e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat);void 0!==e.maxFeatures&&t.setAttribute("maxFeatures",e.maxFeatures);e.resultType&&t.setAttribute("resultType",e.resultType);void 0!==e.startIndex&&t.setAttribute("startIndex",e.startIndex);void 0!==e.count&&t.setAttribute("count",e.count);var o=e.filter;if(e.bbox){ol.asserts.assert(e.geometryName,12);var r=ol.format.filter.bbox(e.geometryName,e.bbox,e.srsName);o=o?ol.format.filter.and(o,r):r}}ol.xml.setAttributeNS(t,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation_);o={node:t,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,geometryName:e.geometryName,filter:o,propertyNames:e.propertyNames?e.propertyNames:[]};ol.asserts.assert(Array.isArray(e.featureTypes),11);ol.format.WFS.writeGetFeature_(t,e.featureTypes,[o]);return t};ol.format.WFS.prototype.writeTransaction=function(e,t,o,r){var n=[],i=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Transaction"),a=r.version?r.version:ol.format.WFS.DEFAULT_VERSION,s="1.0.0"===a?2:3;i.setAttribute("service","WFS");i.setAttribute("version",a);if(r){var l=r.gmlOptions?r.gmlOptions:{};r.handle&&i.setAttribute("handle",r.handle)}ol.xml.setAttributeNS(i,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",ol.format.WFS.SCHEMA_LOCATIONS[a]);var c=r.featurePrefix?r.featurePrefix:ol.format.WFS.FEATURE_PREFIX;e&&(a={node:i,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},ol.obj.assign(a,l),ol.xml.pushSerializeAndPop(a,ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Insert"),e,n));t&&(a={node:i,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},ol.obj.assign(a,l),ol.xml.pushSerializeAndPop(a,ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Update"),t,n));o&&ol.xml.pushSerializeAndPop({node:i,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:s,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Delete"),o,n);r.nativeElements&&ol.xml.pushSerializeAndPop({node:i,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:s,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Native"),r.nativeElements,n);return i};ol.format.WFS.prototype.readProjectionFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null};ol.format.WFS.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(e=(e=e.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var t=[{}];this.gmlFormat_.readGeometryElement(e,t);return ol.proj.get(t.pop().srsName)}return null};ol.format.WKT=function(e){e=e||{};ol.format.TextFeature.call(this);this.splitCollection_=void 0!==e.splitCollection&&e.splitCollection};ol.inherits(ol.format.WKT,ol.format.TextFeature);ol.format.WKT.EMPTY="EMPTY";ol.format.WKT.Z="Z";ol.format.WKT.M="M";ol.format.WKT.ZM="ZM";ol.format.WKT.encodePointGeometry_=function(e){return 0===(e=e.getCoordinates()).length?"":e.join(" ")};ol.format.WKT.encodeMultiPointGeometry_=function(e){for(var t=[],o=0,r=(e=e.getPoints()).length;o<r;++o)t.push("("+ol.format.WKT.encodePointGeometry_(e[o])+")");return t.join(",")};ol.format.WKT.encodeGeometryCollectionGeometry_=function(e){for(var t=[],o=0,r=(e=e.getGeometries()).length;o<r;++o)t.push(ol.format.WKT.encode_(e[o]));return t.join(",")};ol.format.WKT.encodeLineStringGeometry_=function(e){for(var t=[],o=0,r=(e=e.getCoordinates()).length;o<r;++o)t.push(e[o].join(" "));return t.join(",")};ol.format.WKT.encodeMultiLineStringGeometry_=function(e){for(var t=[],o=0,r=(e=e.getLineStrings()).length;o<r;++o)t.push("("+ol.format.WKT.encodeLineStringGeometry_(e[o])+")");return t.join(",")};ol.format.WKT.encodePolygonGeometry_=function(e){for(var t=[],o=0,r=(e=e.getLinearRings()).length;o<r;++o)t.push("("+ol.format.WKT.encodeLineStringGeometry_(e[o])+")");return t.join(",")};ol.format.WKT.encodeMultiPolygonGeometry_=function(e){for(var t=[],o=0,r=(e=e.getPolygons()).length;o<r;++o)t.push("("+ol.format.WKT.encodePolygonGeometry_(e[o])+")");return t.join(",")};ol.format.WKT.encodeGeometryLayout_=function(e){var t="";(e=e.getLayout())!==ol.geom.GeometryLayout.XYZ&&e!==ol.geom.GeometryLayout.XYZM||(t+=ol.format.WKT.Z);e!==ol.geom.GeometryLayout.XYM&&e!==ol.geom.GeometryLayout.XYZM||(t+=ol.format.WKT.M);return t};ol.format.WKT.encode_=function(e){var t=e.getType(),o=(0,ol.format.WKT.GeometryEncoder_[t])(e);t=t.toUpperCase();e instanceof ol.geom.SimpleGeometry&&(0<(e=ol.format.WKT.encodeGeometryLayout_(e)).length&&(t+=" "+e));return 0===o.length?t+" "+ol.format.WKT.EMPTY:t+"("+o+")"};ol.format.WKT.GeometryEncoder_={Point:ol.format.WKT.encodePointGeometry_,LineString:ol.format.WKT.encodeLineStringGeometry_,Polygon:ol.format.WKT.encodePolygonGeometry_,MultiPoint:ol.format.WKT.encodeMultiPointGeometry_,MultiLineString:ol.format.WKT.encodeMultiLineStringGeometry_,MultiPolygon:ol.format.WKT.encodeMultiPolygonGeometry_,GeometryCollection:ol.format.WKT.encodeGeometryCollectionGeometry_};ol.format.WKT.prototype.parse_=function(e){e=new ol.format.WKT.Lexer(e);return new ol.format.WKT.Parser(e).parse()};ol.format.WKT.prototype.readFeatureFromText=function(e,t){return(e=this.readGeometryFromText(e,t))?((t=new ol.Feature).setGeometry(e),t):null};ol.format.WKT.prototype.readFeaturesFromText=function(e,t){e=this.readGeometryFromText(e,t);for(var o=[],r=0,n=(e=this.splitCollection_&&e.getType()==ol.geom.GeometryType.GEOMETRY_COLLECTION?e.getGeometriesArray():[e]).length;r<n;++r)(t=new ol.Feature).setGeometry(e[r]),o.push(t);return o};ol.format.WKT.prototype.readGeometryFromText=function(e,t){return(e=this.parse_(e))?ol.format.Feature.transformWithOptions(e,!1,t):null};ol.format.WKT.prototype.writeFeatureText=function(e,t){return(e=e.getGeometry())?this.writeGeometryText(e,t):""};ol.format.WKT.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);for(var o=[],r=0,n=e.length;r<n;++r)o.push(e[r].getGeometry());e=new ol.geom.GeometryCollection(o);return this.writeGeometryText(e,t)};ol.format.WKT.prototype.writeGeometryText=function(e,t){return ol.format.WKT.encode_(ol.format.Feature.transformWithOptions(e,!0,t))};ol.format.WKT.TokenType_={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6};ol.format.WKT.Lexer=function(e){this.wkt=e;this.index_=-1};ol.format.WKT.Lexer.prototype.isAlpha_=function(e){return"a"<=e&&"z">=e||"A"<=e&&"Z">=e};ol.format.WKT.Lexer.prototype.isNumeric_=function(e,t){return"0"<=e&&"9">=e||"."==e&&!(void 0!==t&&t)};ol.format.WKT.Lexer.prototype.isWhiteSpace_=function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e};ol.format.WKT.Lexer.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)};ol.format.WKT.Lexer.prototype.nextToken=function(){var e=this.nextChar_(),t={position:this.index_,value:e};if("("==e)t.type=ol.format.WKT.TokenType_.LEFT_PAREN;else if(","==e)t.type=ol.format.WKT.TokenType_.COMMA;else if(")"==e)t.type=ol.format.WKT.TokenType_.RIGHT_PAREN;else if(this.isNumeric_(e)||"-"==e)t.type=ol.format.WKT.TokenType_.NUMBER,t.value=this.readNumber_();else if(this.isAlpha_(e))t.type=ol.format.WKT.TokenType_.TEXT,t.value=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw Error("Unexpected character: "+e);t.type=ol.format.WKT.TokenType_.EOF}return t};ol.format.WKT.Lexer.prototype.readNumber_=function(){var e=this.index_,t=!1,o=!1;do{"."==r?t=!0:"e"!=r&&"E"!=r||(o=!0);var r=this.nextChar_()}while(this.isNumeric_(r,t)||!o&&("e"==r||"E"==r)||o&&("-"==r||"+"==r));return parseFloat(this.wkt.substring(e,this.index_--))};ol.format.WKT.Lexer.prototype.readText_=function(){var e=this.index_;do{var t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()};ol.format.WKT.Parser=function(e){this.lexer_=e;this.layout_=ol.geom.GeometryLayout.XY};ol.format.WKT.Parser.prototype.consume_=function(){this.token_=this.lexer_.nextToken()};ol.format.WKT.Parser.prototype.isTokenType=function(e){return this.token_.type==e};ol.format.WKT.Parser.prototype.match=function(e){(e=this.isTokenType(e))&&this.consume_();return e};ol.format.WKT.Parser.prototype.parse=function(){this.consume_();return this.parseGeometry_()};ol.format.WKT.Parser.prototype.parseGeometryLayout_=function(){var e=ol.geom.GeometryLayout.XY,t=this.token_;this.isTokenType(ol.format.WKT.TokenType_.TEXT)&&((t=t.value)===ol.format.WKT.Z?e=ol.geom.GeometryLayout.XYZ:t===ol.format.WKT.M?e=ol.geom.GeometryLayout.XYM:t===ol.format.WKT.ZM&&(e=ol.geom.GeometryLayout.XYZM),e!==ol.geom.GeometryLayout.XY&&this.consume_());return e};ol.format.WKT.Parser.prototype.parseGeometry_=function(){var e=this.token_;if(this.match(ol.format.WKT.TokenType_.TEXT)){var t=e.value;this.layout_=this.parseGeometryLayout_();if(t==ol.geom.GeometryType.GEOMETRY_COLLECTION.toUpperCase())return e=this.parseGeometryCollectionText_(),new ol.geom.GeometryCollection(e);var o=ol.format.WKT.Parser.GeometryParser_[t];e=ol.format.WKT.Parser.GeometryConstructor_[t];if(!o||!e)throw Error("Invalid geometry type: "+t);return new e(t=o.call(this),this.layout_)}throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseGeometryCollectionText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(ol.format.WKT.TokenType_.COMMA));if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePointText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePoint_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return null;throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseLineStringText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePointList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePolygonText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiPointText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.token_.type==ol.format.WKT.TokenType_.LEFT_PAREN?this.parsePointTextList_():this.parsePointList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiLineStringText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiPolygonText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePolygonTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePoint_=function(){for(var e=[],t=this.layout_.length,o=0;o<t;++o){var r=this.token_;if(!this.match(ol.format.WKT.TokenType_.NUMBER))break;e.push(r.value)}if(e.length==t)return e;throw Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePointList_=function(){for(var e=[this.parsePoint_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePoint_());return e};ol.format.WKT.Parser.prototype.parsePointTextList_=function(){for(var e=[this.parsePointText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePointText_());return e};ol.format.WKT.Parser.prototype.parseLineStringTextList_=function(){for(var e=[this.parseLineStringText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parseLineStringText_());return e};ol.format.WKT.Parser.prototype.parsePolygonTextList_=function(){for(var e=[this.parsePolygonText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePolygonText_());return e};ol.format.WKT.Parser.prototype.isEmptyGeometry_=function(){var e=this.isTokenType(ol.format.WKT.TokenType_.TEXT)&&this.token_.value==ol.format.WKT.EMPTY;e&&this.consume_();return e};ol.format.WKT.Parser.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"};ol.format.WKT.Parser.GeometryConstructor_={POINT:ol.geom.Point,LINESTRING:ol.geom.LineString,POLYGON:ol.geom.Polygon,MULTIPOINT:ol.geom.MultiPoint,MULTILINESTRING:ol.geom.MultiLineString,MULTIPOLYGON:ol.geom.MultiPolygon};ol.format.WKT.Parser.GeometryParser_={POINT:ol.format.WKT.Parser.prototype.parsePointText_,LINESTRING:ol.format.WKT.Parser.prototype.parseLineStringText_,POLYGON:ol.format.WKT.Parser.prototype.parsePolygonText_,MULTIPOINT:ol.format.WKT.Parser.prototype.parseMultiPointText_,MULTILINESTRING:ol.format.WKT.Parser.prototype.parseMultiLineStringText_,MULTIPOLYGON:ol.format.WKT.Parser.prototype.parseMultiPolygonText_};ol.format.XLink={};ol.format.XLink.NAMESPACE_URI="http://www.w3.org/1999/xlink";ol.format.XLink.readHref=function(e){return e.getAttributeNS(ol.format.XLink.NAMESPACE_URI,"href")};ol.format.XML=function(){};ol.format.XML.prototype.read=function(e){return ol.xml.isDocument(e)?this.readFromDocument(e):ol.xml.isNode(e)?this.readFromNode(e):"string"==typeof e?(e=ol.xml.parse(e),this.readFromDocument(e)):null};ol.format.XML.prototype.readFromDocument=function(e){};ol.format.XML.prototype.readFromNode=function(e){};ol.format.WMSCapabilities=function(){ol.format.XML.call(this);this.version=void 0};ol.inherits(ol.format.WMSCapabilities,ol.format.XML);ol.format.WMSCapabilities.prototype.readFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};ol.format.WMSCapabilities.prototype.readFromNode=function(e){this.version=e.getAttribute("version").trim();return(e=ol.xml.pushParseAndPop({version:this.version},ol.format.WMSCapabilities.PARSERS_,e,[]))?e:null};ol.format.WMSCapabilities.readAttribution_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.ATTRIBUTION_PARSERS_,e,t)};ol.format.WMSCapabilities.readBoundingBox_=function(e,t){t=[ol.format.XSD.readDecimalString(e.getAttribute("minx")),ol.format.XSD.readDecimalString(e.getAttribute("miny")),ol.format.XSD.readDecimalString(e.getAttribute("maxx")),ol.format.XSD.readDecimalString(e.getAttribute("maxy"))];var o=[ol.format.XSD.readDecimalString(e.getAttribute("resx")),ol.format.XSD.readDecimalString(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:t,res:o}};ol.format.WMSCapabilities.readEXGeographicBoundingBox_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS_,e,t);if(o){e=o.westBoundLongitude;t=o.southBoundLatitude;var r=o.eastBoundLongitude;o=o.northBoundLatitude;if(void 0!==e&&void 0!==t&&void 0!==r&&void 0!==o)return[e,t,r,o]}};ol.format.WMSCapabilities.readCapability_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CAPABILITY_PARSERS_,e,t)};ol.format.WMSCapabilities.readService_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.SERVICE_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactInformation_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_INFORMATION_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactPersonPrimary_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_PERSON_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactAddress_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_ADDRESS_PARSERS_,e,t)};ol.format.WMSCapabilities.readException_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMSCapabilities.EXCEPTION_PARSERS_,e,t)};ol.format.WMSCapabilities.readCapabilityLayer_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.LAYER_PARSERS_,e,t)};ol.format.WMSCapabilities.readLayer_=function(e,t){var o=t[t.length-1],r=ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.LAYER_PARSERS_,e,t);if(r)return void 0===(t=ol.format.XSD.readBooleanString(e.getAttribute("queryable")))&&(t=o.queryable),r.queryable=void 0!==t&&t,void 0===(t=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("cascaded")))&&(t=o.cascaded),r.cascaded=t,void 0===(t=ol.format.XSD.readBooleanString(e.getAttribute("opaque")))&&(t=o.opaque),r.opaque=void 0!==t&&t,void 0===(t=ol.format.XSD.readBooleanString(e.getAttribute("noSubsets")))&&(t=o.noSubsets),r.noSubsets=void 0!==t&&t,(t=ol.format.XSD.readDecimalString(e.getAttribute("fixedWidth")))||(t=o.fixedWidth),r.fixedWidth=t,(e=ol.format.XSD.readDecimalString(e.getAttribute("fixedHeight")))||(e=o.fixedHeight),r.fixedHeight=e,["Style","CRS","AuthorityURL"].forEach(function(e){e in o&&(r[e]=(r[e]||[]).concat(o[e]))}),"EX_GeographicBoundingBox BoundingBox Dimension Attribution MinScaleDenominator MaxScaleDenominator".split(" ").forEach(function(e){e in r||(r[e]=o[e])}),r};ol.format.WMSCapabilities.readDimension_=function(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:ol.format.XSD.readBooleanString(e.getAttribute("multipleValues")),nearestValue:ol.format.XSD.readBooleanString(e.getAttribute("nearestValue")),current:ol.format.XSD.readBooleanString(e.getAttribute("current")),values:ol.format.XSD.readString(e)}};ol.format.WMSCapabilities.readFormatOnlineresource_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.FORMAT_ONLINERESOURCE_PARSERS_,e,t)};ol.format.WMSCapabilities.readRequest_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.REQUEST_PARSERS_,e,t)};ol.format.WMSCapabilities.readDCPType_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.DCPTYPE_PARSERS_,e,t)};ol.format.WMSCapabilities.readHTTP_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.HTTP_PARSERS_,e,t)};ol.format.WMSCapabilities.readOperationType_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.OPERATIONTYPE_PARSERS_,e,t)};ol.format.WMSCapabilities.readSizedFormatOnlineresource_=function(e,t){if(t=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t))return e=[ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("width")),ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("height"))],t.size=e,t};ol.format.WMSCapabilities.readAuthorityURL_=function(e,t){if(t=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t))return t.name=e.getAttribute("name"),t};ol.format.WMSCapabilities.readMetadataURL_=function(e,t){if(t=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t))return t.type=e.getAttribute("type"),t};ol.format.WMSCapabilities.readStyle_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.STYLE_PARSERS_,e,t)};ol.format.WMSCapabilities.readKeywordList_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMSCapabilities.KEYWORDLIST_PARSERS_,e,t)};ol.format.WMSCapabilities.NAMESPACE_URIS_=[null,"http://www.opengis.net/wms"];ol.format.WMSCapabilities.PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Service:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readService_),Capability:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readCapability_)});ol.format.WMSCapabilities.CAPABILITY_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Request:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readRequest_),Exception:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readException_),Layer:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readCapabilityLayer_)});ol.format.WMSCapabilities.SERVICE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),KeywordList:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readKeywordList_),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),ContactInformation:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactInformation_),Fees:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AccessConstraints:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),LayerLimit:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)});ol.format.WMSCapabilities.CONTACT_INFORMATION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{ContactPersonPrimary:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactPersonPrimary_),ContactPosition:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactAddress:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactAddress_),ContactVoiceTelephone:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactFacsimileTelephone:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactElectronicMailAddress:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.CONTACT_PERSON_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{ContactPerson:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactOrganization:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.CONTACT_ADDRESS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{AddressType:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),City:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),StateOrProvince:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PostCode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Country:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.EXCEPTION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeArrayPusher(ol.format.XSD.readString)});ol.format.WMSCapabilities.LAYER_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),KeywordList:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readKeywordList_),CRS:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),EX_GeographicBoundingBox:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readEXGeographicBoundingBox_),BoundingBox:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readBoundingBox_),Dimension:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readDimension_),Attribution:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readAttribution_),AuthorityURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readAuthorityURL_),Identifier:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),MetadataURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readMetadataURL_),DataURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readFormatOnlineresource_),FeatureListURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readFormatOnlineresource_),Style:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readStyle_),MinScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),MaxScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),Layer:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readLayer_)});ol.format.WMSCapabilities.ATTRIBUTION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),LogoURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readSizedFormatOnlineresource_)});ol.format.WMSCapabilities.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{westBoundLongitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),eastBoundLongitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),southBoundLatitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),northBoundLatitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.WMSCapabilities.REQUEST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{GetCapabilities:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_),GetMap:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_),GetFeatureInfo:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_)});ol.format.WMSCapabilities.OPERATIONTYPE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),DCPType:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readDCPType_)});ol.format.WMSCapabilities.DCPTYPE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{HTTP:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readHTTP_)});ol.format.WMSCapabilities.HTTP_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Get:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_),Post:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_)});ol.format.WMSCapabilities.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),LegendURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readSizedFormatOnlineresource_),StyleSheetURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_),StyleURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_)});ol.format.WMSCapabilities.FORMAT_ONLINERESOURCE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref)});ol.format.WMSCapabilities.KEYWORDLIST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Keyword:ol.xml.makeArrayPusher(ol.format.XSD.readString)});ol.format.WMSGetFeatureInfo=function(e){e=e||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver";this.gmlFormat_=new ol.format.GML2;this.layers_=e.layers?e.layers:null;ol.format.XMLFeature.call(this)};ol.inherits(ol.format.WMSGetFeatureInfo,ol.format.XMLFeature);ol.format.WMSGetFeatureInfo.featureIdentifier_="_feature";ol.format.WMSGetFeatureInfo.layerIdentifier_="_layer";ol.format.WMSGetFeatureInfo.prototype.getLayers=function(){return this.layers_};ol.format.WMSGetFeatureInfo.prototype.setLayers=function(e){this.layers_=e};ol.format.WMSGetFeatureInfo.prototype.readFeatures_=function(e,t){e.setAttribute("namespaceURI",this.featureNS_);var o=e.localName,r=[];if(0===e.childNodes.length)return r;if("msGMLOutput"==o)for(var n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(a.nodeType===Node.ELEMENT_NODE){var s=t[0],l=a.localName.replace(ol.format.WMSGetFeatureInfo.layerIdentifier_,"");if(!this.layers_||ol.array.includes(this.layers_,l)){l+=ol.format.WMSGetFeatureInfo.featureIdentifier_;s.featureType=l;s.featureNS=this.featureNS_;var c={};c[l]=ol.xml.makeArrayPusher(this.gmlFormat_.readFeatureElement,this.gmlFormat_);s=ol.xml.makeStructureNS([s.featureNS,null],c);a.setAttribute("namespaceURI",this.featureNS_);(a=ol.xml.pushParseAndPop([],s,a,t,this.gmlFormat_))&&ol.array.extend(r,a)}}}"FeatureCollection"==o&&(e=ol.xml.pushParseAndPop([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_))&&(r=e);return r};ol.format.WMSGetFeatureInfo.prototype.readFeaturesFromNode=function(e,t){var o={};t&&ol.obj.assign(o,this.getReadOptions(e,t));return this.readFeatures_(e,[o])};ol.format.WMSGetFeatureInfo.prototype.writeFeatureNode=function(e,t){};ol.format.WMSGetFeatureInfo.prototype.writeFeaturesNode=function(e,t){};ol.format.WMSGetFeatureInfo.prototype.writeGeometryNode=function(e,t){};ol.format.OWS=function(){ol.format.XML.call(this)};ol.inherits(ol.format.OWS,ol.format.XML);ol.format.OWS.prototype.readFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};ol.format.OWS.prototype.readFromNode=function(e){return(e=ol.xml.pushParseAndPop({},ol.format.OWS.PARSERS_,e,[]))?e:null};ol.format.OWS.readAddress_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.ADDRESS_PARSERS_,e,t)};ol.format.OWS.readAllowedValues_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.ALLOWED_VALUES_PARSERS_,e,t)};ol.format.OWS.readConstraint_=function(e,t){var o=e.getAttribute("name");if(o)return ol.xml.pushParseAndPop({name:o},ol.format.OWS.CONSTRAINT_PARSERS_,e,t)};ol.format.OWS.readContactInfo_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.CONTACT_INFO_PARSERS_,e,t)};ol.format.OWS.readDcp_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.DCP_PARSERS_,e,t)};ol.format.OWS.readGet_=function(e,t){var o=ol.format.XLink.readHref(e);if(o)return ol.xml.pushParseAndPop({href:o},ol.format.OWS.REQUEST_METHOD_PARSERS_,e,t)};ol.format.OWS.readHttp_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.HTTP_PARSERS_,e,t)};ol.format.OWS.readOperation_=function(e,t){var o=e.getAttribute("name");(e=ol.xml.pushParseAndPop({},ol.format.OWS.OPERATION_PARSERS_,e,t))&&(t[t.length-1][o]=e)};ol.format.OWS.readOperationsMetadata_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.OPERATIONS_METADATA_PARSERS_,e,t)};ol.format.OWS.readPhone_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.PHONE_PARSERS_,e,t)};ol.format.OWS.readServiceIdentification_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_IDENTIFICATION_PARSERS_,e,t)};ol.format.OWS.readServiceContact_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_CONTACT_PARSERS_,e,t)};ol.format.OWS.readServiceProvider_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_PROVIDER_PARSERS_,e,t)};ol.format.OWS.readValue_=function(e,t){return ol.format.XSD.readString(e)};ol.format.OWS.NAMESPACE_URIS_=[null,"http://www.opengis.net/ows/1.1"];ol.format.OWS.PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{ServiceIdentification:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceIdentification_),ServiceProvider:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceProvider_),OperationsMetadata:ol.xml.makeObjectPropertySetter(ol.format.OWS.readOperationsMetadata_)});ol.format.OWS.ADDRESS_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{DeliveryPoint:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),City:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AdministrativeArea:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PostalCode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Country:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ElectronicMailAddress:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.ALLOWED_VALUES_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Value:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readValue_)});ol.format.OWS.CONSTRAINT_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{AllowedValues:ol.xml.makeObjectPropertySetter(ol.format.OWS.readAllowedValues_)});ol.format.OWS.CONTACT_INFO_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Phone:ol.xml.makeObjectPropertySetter(ol.format.OWS.readPhone_),Address:ol.xml.makeObjectPropertySetter(ol.format.OWS.readAddress_)});ol.format.OWS.DCP_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{HTTP:ol.xml.makeObjectPropertySetter(ol.format.OWS.readHttp_)});ol.format.OWS.HTTP_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Get:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readGet_),Post:void 0});ol.format.OWS.OPERATION_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{DCP:ol.xml.makeObjectPropertySetter(ol.format.OWS.readDcp_)});ol.format.OWS.OPERATIONS_METADATA_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Operation:ol.format.OWS.readOperation_});ol.format.OWS.PHONE_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Voice:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Facsimile:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.REQUEST_METHOD_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Constraint:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readConstraint_)});ol.format.OWS.SERVICE_CONTACT_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{IndividualName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PositionName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactInfo:ol.xml.makeObjectPropertySetter(ol.format.OWS.readContactInfo_)});ol.format.OWS.SERVICE_IDENTIFICATION_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AccessConstraints:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Fees:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ServiceTypeVersion:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ServiceType:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.SERVICE_PROVIDER_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{ProviderName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ProviderSite:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),ServiceContact:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceContact_)});ol.format.WMTSCapabilities=function(){ol.format.XML.call(this);this.owsParser_=new ol.format.OWS};ol.inherits(ol.format.WMTSCapabilities,ol.format.XML);ol.format.WMTSCapabilities.prototype.readFromDocument=function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};ol.format.WMTSCapabilities.prototype.readFromNode=function(e){var t=e.getAttribute("version").trim(),o=this.owsParser_.readFromNode(e);if(!o)return null;o.version=t;return(o=ol.xml.pushParseAndPop(o,ol.format.WMTSCapabilities.PARSERS_,e,[]))?o:null};ol.format.WMTSCapabilities.readContents_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.CONTENTS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readLayer_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.LAYER_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixSet_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readStyle_=function(e,t){if(t=ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.STYLE_PARSERS_,e,t))return e="true"===e.getAttribute("isDefault"),t.isDefault=e,t};ol.format.WMTSCapabilities.readTileMatrixSetLink_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_LINKS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readDimensions_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.DIMENSION_PARSERS_,e,t)};ol.format.WMTSCapabilities.readResourceUrl_=function(e,t){t=e.getAttribute("format");var o=e.getAttribute("template");e=e.getAttribute("resourceType");var r={};t&&(r.format=t);o&&(r.template=o);e&&(r.resourceType=e);return r};ol.format.WMTSCapabilities.readWgs84BoundingBox_=function(e,t){if(2==(e=ol.xml.pushParseAndPop([],ol.format.WMTSCapabilities.WGS84_BBOX_READERS_,e,t)).length)return ol.extent.boundingExtent(e)};ol.format.WMTSCapabilities.readLegendUrl_=function(e,t){(t={}).format=e.getAttribute("format");t.href=ol.format.XLink.readHref(e);return t};ol.format.WMTSCapabilities.readCoordinates_=function(e,t){if((t=ol.format.XSD.readString(e).split(" "))&&2==t.length&&(e=+t[0],t=+t[1],!isNaN(e)&&!isNaN(t)))return[e,t]};ol.format.WMTSCapabilities.readTileMatrix_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TM_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixLimitsList_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMTSCapabilities.TMS_LIMITS_LIST_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixLimits_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_LIMITS_PARSERS_,e,t)};ol.format.WMTSCapabilities.NAMESPACE_URIS_=[null,"http://www.opengis.net/wmts/1.0"];ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_=[null,"http://www.opengis.net/ows/1.1"];ol.format.WMTSCapabilities.PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Contents:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readContents_)});ol.format.WMTSCapabilities.CONTENTS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Layer:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readLayer_),TileMatrixSet:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrixSet_)});ol.format.WMTSCapabilities.LAYER_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Style:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readStyle_),Format:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),TileMatrixSetLink:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrixSetLink_),Dimension:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readDimensions_),ResourceURL:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readResourceUrl_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),WGS84BoundingBox:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readWgs84BoundingBox_),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{LegendURL:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readLegendUrl_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.TMS_LINKS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrixSet:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),TileMatrixSetLimits:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readTileMatrixLimitsList_)});ol.format.WMTSCapabilities.TMS_LIMITS_LIST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrixLimits:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readTileMatrixLimits_)});ol.format.WMTSCapabilities.TMS_LIMITS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrix:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),MinTileRow:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxTileRow:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MinTileCol:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxTileCol:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)});ol.format.WMTSCapabilities.DIMENSION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Default:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Value:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.WGS84_BBOX_READERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{LowerCorner:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readCoordinates_),UpperCorner:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readCoordinates_)});ol.format.WMTSCapabilities.TMS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{WellKnownScaleSet:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),TileMatrix:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrix_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{SupportedCRS:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.TM_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TopLeftCorner:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readCoordinates_),ScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),TileWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),TileHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MatrixWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MatrixHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.geom.Circle=function(e,t,o){ol.geom.SimpleGeometry.call(this);this.setCenterAndRadius(e,t||0,o)};ol.inherits(ol.geom.Circle,ol.geom.SimpleGeometry);ol.geom.Circle.prototype.clone=function(){var e=new ol.geom.Circle(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.Circle.prototype.closestPointXY=function(e,t,o,r){var n=this.flatCoordinates;e-=n[0];var i=t-n[1];if((t=e*e+i*i)<r){0===t?r=0:(r=this.getRadius()/Math.sqrt(t),o[0]=n[0]+r*e,o[1]=n[1]+r*i,r=2);for(;r<this.stride;++r)o[r]=n[r];o.length=this.stride;return t}return r};ol.geom.Circle.prototype.containsXY=function(e,t){var o=this.flatCoordinates;return(e-=o[0])*e+(t-=o[1])*t<=this.getRadiusSquared_()};ol.geom.Circle.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)};ol.geom.Circle.prototype.computeExtent=function(e){var t=this.flatCoordinates,o=t[this.stride]-t[0];return ol.extent.createOrUpdate(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)};ol.geom.Circle.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())};ol.geom.Circle.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t};ol.geom.Circle.prototype.getType=function(){return ol.geom.GeometryType.CIRCLE};ol.geom.Circle.prototype.intersectsExtent=function(e){var t=this.getExtent();return!!ol.extent.intersects(e,t)&&(t=this.getCenter(),e[0]<=t[0]&&e[2]>=t[0]||e[1]<=t[1]&&e[3]>=t[1]||ol.extent.forEachCorner(e,this.intersectsCoordinate,this))};ol.geom.Circle.prototype.setCenter=function(e){var t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+o;for(o=1;o<t;++o)r[t+o]=e[o];this.setFlatCoordinates(this.layout,r)};ol.geom.Circle.prototype.setCenterAndRadius=function(e,t,o){if(e){this.setLayout(o,e,0);this.flatCoordinates||(this.flatCoordinates=[]);o=this.flatCoordinates;e=ol.geom.flat.deflate.coordinate(o,0,e,this.stride);o[e++]=o[0]+t;var r;t=1;for(r=this.stride;t<r;++t)o[e++]=o[t];o.length=e;this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.Circle.prototype.getCoordinates=function(){};ol.geom.Circle.prototype.setCoordinates=function(e,t){};ol.geom.Circle.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.Circle.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e;this.changed()};ol.interaction.DragAndDrop=function(e){e=e||{};ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.DragAndDrop.handleEvent});this.formatConstructors_=e.formatConstructors?e.formatConstructors:[];this.projection_=e.projection?ol.proj.get(e.projection):null;this.dropListenKeys_=null;this.source_=e.source||null;this.target=e.target?e.target:null};ol.inherits(ol.interaction.DragAndDrop,ol.interaction.Interaction);ol.interaction.DragAndDrop.handleDrop_=function(e){var t,o=0;for(t=(e=e.dataTransfer.files).length;o<t;++o){var r=e.item(o),n=new FileReader;n.addEventListener(ol.events.EventType.LOAD,this.handleResult_.bind(this,r));n.readAsText(r)}};ol.interaction.DragAndDrop.handleStop_=function(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy"};ol.interaction.DragAndDrop.prototype.handleResult_=function(e,t){t=t.target.result;var o=this.getMap(),r=this.projection_;r||(r=o.getView().getProjection());var n,i=[],a=0;for(n=(o=this.formatConstructors_).length;a<n&&!(i=new o[a],(i=this.tryReadFeatures_(i,t,{featureProjection:r}))&&0<i.length);++a);this.source_&&(this.source_.clear(),this.source_.addFeatures(i));this.dispatchEvent(new ol.interaction.DragAndDrop.Event(ol.interaction.DragAndDrop.EventType_.ADD_FEATURES,e,i,r))};ol.interaction.DragAndDrop.handleEvent=ol.functions.TRUE;ol.interaction.DragAndDrop.prototype.registerListeners_=function(){var e=this.getMap();e&&(e=this.target?this.target:e.getViewport(),this.dropListenKeys_=[ol.events.listen(e,ol.events.EventType.DROP,ol.interaction.DragAndDrop.handleDrop_,this),ol.events.listen(e,ol.events.EventType.DRAGENTER,ol.interaction.DragAndDrop.handleStop_,this),ol.events.listen(e,ol.events.EventType.DRAGOVER,ol.interaction.DragAndDrop.handleStop_,this),ol.events.listen(e,ol.events.EventType.DROP,ol.interaction.DragAndDrop.handleStop_,this)])};ol.interaction.DragAndDrop.prototype.setActive=function(e){ol.interaction.Interaction.prototype.setActive.call(this,e);e?this.registerListeners_():this.unregisterListeners_()};ol.interaction.DragAndDrop.prototype.setMap=function(e){this.unregisterListeners_();ol.interaction.Interaction.prototype.setMap.call(this,e);this.getActive()&&this.registerListeners_()};ol.interaction.DragAndDrop.prototype.tryReadFeatures_=function(e,t,o){try{return e.readFeatures(t,o)}catch(e){return null}};ol.interaction.DragAndDrop.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(ol.events.unlistenByKey),this.dropListenKeys_=null)};ol.interaction.DragAndDrop.EventType_={ADD_FEATURES:"addfeatures"};ol.interaction.DragAndDrop.Event=function(e,t,o,r){ol.events.Event.call(this,e);this.features=o;this.file=t;this.projection=r};ol.inherits(ol.interaction.DragAndDrop.Event,ol.events.Event);ol.interaction.DragRotateAndZoom=function(e){e=e||{};ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragRotateAndZoom.handleDownEvent_,handleDragEvent:ol.interaction.DragRotateAndZoom.handleDragEvent_,handleUpEvent:ol.interaction.DragRotateAndZoom.handleUpEvent_});this.condition_=e.condition?e.condition:ol.events.condition.shiftKeyOnly;this.lastMagnitude_=this.lastAngle_=void 0;this.lastScaleDelta_=0;this.duration_=void 0!==e.duration?e.duration:400};ol.inherits(ol.interaction.DragRotateAndZoom,ol.interaction.Pointer);ol.interaction.DragRotateAndZoom.handleDragEvent_=function(e){if(ol.events.condition.mouseOnly(e)){var t=e.map,o=t.getSize(),r=e.pixel;e=r[0]-o[0]/2;r=o[1]/2-r[1];o=Math.atan2(r,e);e=Math.sqrt(e*e+r*r);(t=t.getView()).getConstraints().rotation!==ol.RotationConstraint.disable&&void 0!==this.lastAngle_&&(r=o-this.lastAngle_,ol.interaction.Interaction.rotateWithoutConstraints(t,t.getRotation()-r));this.lastAngle_=o;void 0!==this.lastMagnitude_&&(o=this.lastMagnitude_*(t.getResolution()/e),ol.interaction.Interaction.zoomWithoutConstraints(t,o));void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/e);this.lastMagnitude_=e}};ol.interaction.DragRotateAndZoom.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;(e=e.map.getView()).setHint(ol.ViewHint.INTERACTING,-1);var t=this.lastScaleDelta_-1;ol.interaction.Interaction.rotate(e,e.getRotation());ol.interaction.Interaction.zoom(e,e.getResolution(),void 0,this.duration_,t);this.lastScaleDelta_=0;return!1};ol.interaction.DragRotateAndZoom.handleDownEvent_=function(e){return!(!ol.events.condition.mouseOnly(e)||!this.condition_(e))&&(e.map.getView().setHint(ol.ViewHint.INTERACTING,1),this.lastMagnitude_=this.lastAngle_=void 0,!0)};ol.interaction.DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend"};ol.layer.Vector=function(e){e=e||{};var t=ol.obj.assign({},e);delete t.style;delete t.renderBuffer;delete t.updateWhileAnimating;delete t.updateWhileInteracting;ol.layer.Layer.call(this,t);this.declutter_=void 0!==e.declutter&&e.declutter;this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100;this.style_=null;this.styleFunction_=void 0;this.setStyle(e.style);this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating;this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting;this.renderMode_=e.renderMode||ol.layer.VectorRenderType.VECTOR;this.type=ol.LayerType.VECTOR};ol.inherits(ol.layer.Vector,ol.layer.Layer);ol.layer.Vector.prototype.getDeclutter=function(){return this.declutter_};ol.layer.Vector.prototype.setDeclutter=function(e){this.declutter_=e};ol.layer.Vector.prototype.getRenderBuffer=function(){return this.renderBuffer_};ol.layer.Vector.prototype.getRenderOrder=function(){return this.get(ol.layer.Vector.Property_.RENDER_ORDER)};ol.layer.Vector.prototype.getStyle=function(){return this.style_};ol.layer.Vector.prototype.getStyleFunction=function(){return this.styleFunction_};ol.layer.Vector.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_};ol.layer.Vector.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_};ol.layer.Vector.prototype.setRenderOrder=function(e){this.set(ol.layer.Vector.Property_.RENDER_ORDER,e)};ol.layer.Vector.prototype.setStyle=function(e){this.style_=void 0!==e?e:ol.style.Style.defaultFunction;this.styleFunction_=null===e?void 0:ol.style.Style.createFunction(this.style_);this.changed()};ol.layer.Vector.prototype.getRenderMode=function(){return this.renderMode_};ol.layer.Vector.Property_={RENDER_ORDER:"renderOrder"};ol.loadingstrategy={};ol.loadingstrategy.all=function(e,t){return[[-1/0,-1/0,1/0,1/0]]};ol.loadingstrategy.bbox=function(e,t){return[e]};ol.loadingstrategy.tile=function(e){return function(t,o){o=e.getZForResolution(o);t=e.getTileRangeForExtentAndZ(t,o);var r=[];for((o=[o,0,0])[1]=t.minX;o[1]<=t.maxX;++o[1])for(o[2]=t.minY;o[2]<=t.maxY;++o[2])r.push(e.getTileCoordExtent(o));return r}};ol.source.Source=function(e){ol.Object.call(this);this.projection_=ol.proj.get(e.projection);this.attributions_=null;this.attributions2_=this.adaptAttributions_(e.attributions);this.logo_=e.logo;this.state_=void 0!==e.state?e.state:ol.source.State.READY;this.wrapX_=void 0!==e.wrapX&&e.wrapX};ol.inherits(ol.source.Source,ol.Object);ol.source.Source.prototype.adaptAttributions_=function(e){if(!e)return null;if(e instanceof ol.Attribution)return this.attributions_=[e],function(t){return[e.getHTML()]};if(Array.isArray(e)){if(e[0]instanceof ol.Attribution){this.attributions_=e;var t=e.map(function(e){return e.getHTML()});return function(e){return t}}this.attributions_=e.map(function(e){return new ol.Attribution({html:e})});return function(t){return e}}if("function"==typeof e)return e;this.attributions_=[new ol.Attribution({html:e})];return function(t){return[e]}};ol.source.Source.prototype.forEachFeatureAtCoordinate=ol.nullFunction;ol.source.Source.prototype.getAttributions=function(){return this.attributions_};ol.source.Source.prototype.getAttributions2=function(){return this.attributions2_};ol.source.Source.prototype.getLogo=function(){return this.logo_};ol.source.Source.prototype.getProjection=function(){return this.projection_};ol.source.Source.prototype.getResolutions=function(){};ol.source.Source.prototype.getState=function(){return this.state_};ol.source.Source.prototype.getWrapX=function(){return this.wrapX_};ol.source.Source.prototype.refresh=function(){this.changed()};ol.source.Source.prototype.setAttributions=function(e){this.attributions2_=this.adaptAttributions_(e);this.changed()};ol.source.Source.prototype.setLogo=function(e){this.logo_=e};ol.source.Source.prototype.setState=function(e){this.state_=e;this.changed()};ol.source.VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};ol.source.Vector=function(e){e=e||{};ol.source.Source.call(this,{attributions:e.attributions,logo:e.logo,projection:void 0,state:ol.source.State.READY,wrapX:void 0===e.wrapX||e.wrapX});this.loader_=ol.nullFunction;this.format_=e.format;this.overlaps_=void 0==e.overlaps||e.overlaps;this.url_=e.url;void 0!==e.loader?this.loader_=e.loader:void 0!==this.url_&&(ol.asserts.assert(this.format_,7),this.loader_=ol.featureloader.xhr(this.url_,this.format_));this.strategy_=void 0!==e.strategy?e.strategy:ol.loadingstrategy.all;var t=void 0===e.useSpatialIndex||e.useSpatialIndex;this.featuresRtree_=t?new ol.structs.RBush:null;this.loadedExtentsRtree_=new ol.structs.RBush;this.nullGeometryFeatures_={};this.idIndex_={};this.undefIdIndex_={};this.featureChangeKeys_={};this.featuresCollection_=null;if(e.features instanceof ol.Collection)var o=e.features,r=o.getArray();else Array.isArray(e.features)&&(r=e.features);t||void 0!==o||(o=new ol.Collection(r));void 0!==r&&this.addFeaturesInternal(r);void 0!==o&&this.bindFeaturesCollection_(o)};ol.inherits(ol.source.Vector,ol.source.Source);ol.source.Vector.prototype.addFeature=function(e){this.addFeatureInternal(e);this.changed()};ol.source.Vector.prototype.addFeatureInternal=function(e){var t=ol.getUid(e).toString();if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var o=e.getGeometry();o?(t=o.getExtent(),this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,e))}};ol.source.Vector.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[ol.events.listen(t,ol.events.EventType.CHANGE,this.handleFeatureChange_,this),ol.events.listen(t,ol.ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]};ol.source.Vector.prototype.addToIndex_=function(e,t){var o=!0,r=t.getId();void 0!==r?r.toString()in this.idIndex_?o=!1:this.idIndex_[r.toString()]=t:(ol.asserts.assert(!(e in this.undefIdIndex_),30),this.undefIdIndex_[e]=t);return o};ol.source.Vector.prototype.addFeatures=function(e){this.addFeaturesInternal(e);this.changed()};ol.source.Vector.prototype.addFeaturesInternal=function(e){var t,o=[],r=[],n=[],i=0;for(t=e.length;i<t;i++){var a=e[i],s=ol.getUid(a).toString();this.addToIndex_(s,a)&&r.push(a)}i=0;for(t=r.length;i<t;i++)a=r[i],s=ol.getUid(a).toString(),this.setupChangeEvents_(s,a),(e=a.getGeometry())?(s=e.getExtent(),o.push(s),n.push(a)):this.nullGeometryFeatures_[s]=a;this.featuresRtree_&&this.featuresRtree_.load(o,n);i=0;for(t=r.length;i<t;i++)this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,r[i]))};ol.source.Vector.prototype.bindFeaturesCollection_=function(e){var t=!1;ol.events.listen(this,ol.source.VectorEventType.ADDFEATURE,function(o){t||(t=!0,e.push(o.feature),t=!1)});ol.events.listen(this,ol.source.VectorEventType.REMOVEFEATURE,function(o){t||(t=!0,e.remove(o.feature),t=!1)});ol.events.listen(e,ol.CollectionEventType.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)},this);ol.events.listen(e,ol.CollectionEventType.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)},this);this.featuresCollection_=e};ol.source.Vector.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(ol.events.unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal,this);for(var o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear();this.featuresRtree_&&this.featuresRtree_.clear();this.loadedExtentsRtree_.clear();this.nullGeometryFeatures_={};e=new ol.source.Vector.Event(ol.source.VectorEventType.CLEAR);this.dispatchEvent(e);this.changed()};ol.source.Vector.prototype.forEachFeature=function(e,t){return this.featuresRtree_?this.featuresRtree_.forEach(e,t):this.featuresCollection_?this.featuresCollection_.forEach(e,t):void 0};ol.source.Vector.prototype.forEachFeatureAtCoordinateDirect=function(e,t,o){return this.forEachFeatureInExtent([e[0],e[1],e[0],e[1]],function(r){if(r.getGeometry().intersectsCoordinate(e))return t.call(o,r)})};ol.source.Vector.prototype.forEachFeatureInExtent=function(e,t,o){return this.featuresRtree_?this.featuresRtree_.forEachInExtent(e,t,o):this.featuresCollection_?this.featuresCollection_.forEach(t,o):void 0};ol.source.Vector.prototype.forEachFeatureIntersectingExtent=function(e,t,o){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)&&(r=t.call(o,r)))return r})};ol.source.Vector.prototype.getFeaturesCollection=function(){return this.featuresCollection_};ol.source.Vector.prototype.getFeatures=function(){if(this.featuresCollection_)var e=this.featuresCollection_.getArray();else this.featuresRtree_&&(e=this.featuresRtree_.getAll(),ol.obj.isEmpty(this.nullGeometryFeatures_)||ol.array.extend(e,ol.obj.getValues(this.nullGeometryFeatures_)));return e};ol.source.Vector.prototype.getFeaturesAtCoordinate=function(e){var t=[];this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)});return t};ol.source.Vector.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_.getInExtent(e)};ol.source.Vector.prototype.getClosestFeatureToCoordinate=function(e,t){var o=e[0],r=e[1],n=null,i=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],l=t||ol.functions.TRUE;this.featuresRtree_.forEachInExtent(s,function(e){if(l(e)){var t=e.getGeometry(),c=a;(a=t.closestPointXY(o,r,i,a))<c&&(n=e,e=Math.sqrt(a),s[0]=o-e,s[1]=r-e,s[2]=o+e,s[3]=r+e)}});return n};ol.source.Vector.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)};ol.source.Vector.prototype.getFeatureById=function(e){return void 0!==(e=this.idIndex_[e.toString()])?e:null};ol.source.Vector.prototype.getFormat=function(){return this.format_};ol.source.Vector.prototype.getOverlaps=function(){return this.overlaps_};ol.source.Vector.prototype.getResolutions=function(){};ol.source.Vector.prototype.getUrl=function(){return this.url_};ol.source.Vector.prototype.handleFeatureChange_=function(e){e=e.target;var t=ol.getUid(e).toString(),o=e.getGeometry();o?(o=o.getExtent(),t in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[t],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)):t in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[t]=e);void 0!==(o=e.getId())?(o=o.toString(),t in this.undefIdIndex_?(delete this.undefIdIndex_[t],this.idIndex_[o]=e):this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)):t in this.undefIdIndex_||(this.removeFromIdIndex_(e),this.undefIdIndex_[t]=e);this.changed();this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.CHANGEFEATURE,e))};ol.source.Vector.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&ol.obj.isEmpty(this.nullGeometryFeatures_)};ol.source.Vector.prototype.loadFeatures=function(e,t,o){var r,n=this.loadedExtentsRtree_,i=0;for(r=(e=this.strategy_(e,t)).length;i<r;++i){var a=e[i];n.forEachInExtent(a,function(e){return ol.extent.containsExtent(e.extent,a)})||(this.loader_.call(this,a,t,o),n.insert(a,{extent:a.slice()}))}};ol.source.Vector.prototype.removeLoadedExtent=function(e){var t,o=this.loadedExtentsRtree_;o.forEachInExtent(e,function(o){if(ol.extent.equals(o.extent,e))return t=o,!0});t&&o.remove(t)};ol.source.Vector.prototype.removeFeature=function(e){var t=ol.getUid(e).toString();t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);this.removeFeatureInternal(e);this.changed()};ol.source.Vector.prototype.removeFeatureInternal=function(e){var t=ol.getUid(e).toString();this.featureChangeKeys_[t].forEach(ol.events.unlistenByKey);delete this.featureChangeKeys_[t];var o=e.getId();void 0!==o?delete this.idIndex_[o.toString()]:delete this.undefIdIndex_[t];this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.REMOVEFEATURE,e))};ol.source.Vector.prototype.removeFromIdIndex_=function(e){var t,o=!1;for(t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];o=!0;break}return o};ol.source.Vector.prototype.setLoader=function(e){this.loader_=e};ol.source.Vector.Event=function(e,t){ol.events.Event.call(this,e);this.feature=t};ol.inherits(ol.source.Vector.Event,ol.events.Event);ol.interaction.Draw=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Draw.handleDownEvent_,handleEvent:ol.interaction.Draw.handleEvent,handleUpEvent:ol.interaction.Draw.handleUpEvent_});this.shouldHandle_=!1;this.downPx_=null;this.freehand_=!1;this.source_=e.source?e.source:null;this.features_=e.features?e.features:null;this.snapTolerance_=e.snapTolerance?e.snapTolerance:12;this.type_=e.type;this.mode_=ol.interaction.Draw.getMode_(this.type_);this.stopClick_=!!e.stopClick;this.minPoints_=e.minPoints?e.minPoints:this.mode_===ol.interaction.Draw.Mode_.POLYGON?3:2;this.maxPoints_=e.maxPoints?e.maxPoints:1/0;this.finishCondition_=e.finishCondition?e.finishCondition:ol.functions.TRUE;var t=e.geometryFunction;if(!t)if(this.type_===ol.geom.GeometryType.CIRCLE)t=function(e,t){t=t||new ol.geom.Circle([NaN,NaN]);var o=ol.coordinate.squaredDistance(e[0],e[1]);t.setCenterAndRadius(e[0],Math.sqrt(o));return t};else{var o=this.mode_;if(o===ol.interaction.Draw.Mode_.POINT)var r=ol.geom.Point;else o===ol.interaction.Draw.Mode_.LINE_STRING?r=ol.geom.LineString:o===ol.interaction.Draw.Mode_.POLYGON&&(r=ol.geom.Polygon);t=function(e,t){t?o===ol.interaction.Draw.Mode_.POLYGON?e[0].length?t.setCoordinates([e[0].concat([e[0][0]])]):t.setCoordinates([]):t.setCoordinates(e):t=new r(e);return t}}this.geometryFunction_=t;this.sketchLineCoords_=this.sketchLine_=this.sketchCoords_=this.sketchPoint_=this.sketchFeature_=this.finishCoordinate_=null;this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36;this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:ol.interaction.Draw.getDefaultStyleFunction()});this.geometryName_=e.geometryName;this.condition_=e.condition?e.condition:ol.events.condition.noModifierKeys;this.freehandCondition_=e.freehand?ol.events.condition.always:e.freehandCondition?e.freehandCondition:ol.events.condition.shiftKeyOnly;ol.events.listen(this,ol.Object.getChangeEventType(ol.interaction.Property.ACTIVE),this.updateState_,this)};ol.inherits(ol.interaction.Draw,ol.interaction.Pointer);ol.interaction.Draw.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[t.getGeometry().getType()]}};ol.interaction.Draw.prototype.setMap=function(e){ol.interaction.Pointer.prototype.setMap.call(this,e);this.updateState_()};ol.interaction.Draw.handleEvent=function(e){this.freehand_=this.mode_!==ol.interaction.Draw.Mode_.POINT&&this.freehandCondition_(e);var t=!0;this.freehand_&&e.type===ol.MapBrowserEventType.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e),t=!1):this.freehand_&&e.type===ol.MapBrowserEventType.POINTERDOWN?t=!1:e.type===ol.MapBrowserEventType.POINTERMOVE?t=this.handlePointerMove_(e):e.type===ol.MapBrowserEventType.DBLCLICK&&(t=!1);return ol.interaction.Pointer.handleEvent.call(this,e)&&t};ol.interaction.Draw.handleDownEvent_=function(e){this.shouldHandle_=!this.freehand_;return this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):!!this.condition_(e)&&(this.downPx_=e.pixel,!0)};ol.interaction.Draw.handleUpEvent_=function(e){var t=!0;this.handlePointerMove_(e);var o=this.mode_===ol.interaction.Draw.Mode_.CIRCLE;this.shouldHandle_?(this.finishCoordinate_?this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e):(this.startDrawing_(e),this.mode_===ol.interaction.Draw.Mode_.POINT&&this.finishDrawing()),t=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_());!t&&this.stopClick_&&e.stopPropagation();return t};ol.interaction.Draw.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,o=e.pixel,r=t[0]-o[0];r=r*r+(t=t[1]-o[1])*t;this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_}this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e);return!0};ol.interaction.Draw.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var o=!1,r=[this.finishCoordinate_];this.mode_===ol.interaction.Draw.Mode_.LINE_STRING?o=this.sketchCoords_.length>this.minPoints_:this.mode_===ol.interaction.Draw.Mode_.POLYGON&&(o=this.sketchCoords_[0].length>this.minPoints_,r=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]);if(o){o=e.map;for(var n=0,i=r.length;n<i;n++){var a=r[n],s=o.getPixelFromCoordinate(a),l=e.pixel;t=l[0]-s[0];s=l[1]-s[1];if(t=Math.sqrt(t*t+s*s)<=(this.freehand_?1:this.snapTolerance_)){this.finishCoordinate_=a;break}}}}return t};ol.interaction.Draw.prototype.createOrUpdateSketchPoint_=function(e){e=e.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new ol.Feature(new ol.geom.Point(e)),this.updateSketchFeatures_())};ol.interaction.Draw.prototype.startDrawing_=function(e){this.finishCoordinate_=e=e.coordinate;this.mode_===ol.interaction.Draw.Mode_.POINT?this.sketchCoords_=e.slice():this.mode_===ol.interaction.Draw.Mode_.POLYGON?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):(this.sketchCoords_=[e.slice(),e.slice()],this.mode_===ol.interaction.Draw.Mode_.CIRCLE&&(this.sketchLineCoords_=this.sketchCoords_));this.sketchLineCoords_&&(this.sketchLine_=new ol.Feature(new ol.geom.LineString(this.sketchLineCoords_)));e=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new ol.Feature;this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_);this.sketchFeature_.setGeometry(e);this.updateSketchFeatures_();this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWSTART,this.sketchFeature_))};ol.interaction.Draw.prototype.modifyDrawing_=function(e){var t=e.coordinate,o=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.POINT)var r=this.sketchCoords_;else this.mode_===ol.interaction.Draw.Mode_.POLYGON?(r=(r=this.sketchCoords_[0])[r.length-1],this.atFinish_(e)&&(t=this.finishCoordinate_.slice())):r=(r=this.sketchCoords_)[r.length-1];r[0]=t[0];r[1]=t[1];this.geometryFunction_(this.sketchCoords_,o);this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t);o instanceof ol.geom.Polygon&&this.mode_!==ol.interaction.Draw.Mode_.POLYGON?(this.sketchLine_||(this.sketchLine_=new ol.Feature(new ol.geom.LineString(null))),t=o.getLinearRing(0),(e=this.sketchLine_.getGeometry()).setFlatCoordinates(t.getLayout(),t.getFlatCoordinates())):this.sketchLineCoords_&&(e=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()};ol.interaction.Draw.prototype.addToDrawing_=function(e){e=e.coordinate;var t,o=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){this.finishCoordinate_=e.slice();var r=this.sketchCoords_;r.length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0);r.push(e.slice());this.geometryFunction_(r,o)}else this.mode_===ol.interaction.Draw.Mode_.POLYGON&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0),r.push(e.slice()),t&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,o));this.updateSketchFeatures_();t&&this.finishDrawing()};ol.interaction.Draw.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){var t=this.sketchCoords_;t.splice(-2,1);this.geometryFunction_(t,e);2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())}else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){(t=this.sketchCoords_[0]).splice(-2,1);this.sketchLine_.getGeometry().setCoordinates(t);this.geometryFunction_(this.sketchCoords_,e)}0===t.length&&(this.finishCoordinate_=null);this.updateSketchFeatures_()}};ol.interaction.Draw.prototype.finishDrawing=function(){var e=this.abortDrawing_(),t=this.sketchCoords_,o=e.getGeometry();this.mode_===ol.interaction.Draw.Mode_.LINE_STRING?(t.pop(),this.geometryFunction_(t,o)):this.mode_===ol.interaction.Draw.Mode_.POLYGON&&(t[0].pop(),this.geometryFunction_(t,o),t=o.getCoordinates());this.type_===ol.geom.GeometryType.MULTI_POINT?e.setGeometry(new ol.geom.MultiPoint([t])):this.type_===ol.geom.GeometryType.MULTI_LINE_STRING?e.setGeometry(new ol.geom.MultiLineString([t])):this.type_===ol.geom.GeometryType.MULTI_POLYGON&&e.setGeometry(new ol.geom.MultiPolygon([t]));this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWEND,e));this.features_&&this.features_.push(e);this.source_&&this.source_.addFeature(e)};ol.interaction.Draw.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;e&&(this.sketchLine_=this.sketchPoint_=this.sketchFeature_=null,this.overlay_.getSource().clear(!0));return e};ol.interaction.Draw.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e;this.sketchCoords_=t.getCoordinates();e=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=e.slice();this.sketchCoords_.push(e.slice());this.updateSketchFeatures_();this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWSTART,this.sketchFeature_))};ol.interaction.Draw.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.Draw.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_);this.sketchLine_&&e.push(this.sketchLine_);this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0);t.addFeatures(e)};ol.interaction.Draw.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing_();this.overlay_.setMap(t?e:null)};ol.interaction.Draw.createRegularPolygon=function(e,t){return function(o,r){var n=o[0];o=o[1];var i=Math.sqrt(ol.coordinate.squaredDistance(n,o));r=r||ol.geom.Polygon.fromCircle(new ol.geom.Circle(n),e);ol.geom.Polygon.makeRegular(r,n,i,t||Math.atan((o[1]-n[1])/(o[0]-n[0])));return r}};ol.interaction.Draw.createBox=function(){return function(e,t){e=ol.extent.boundingExtent(e);(t=t||new ol.geom.Polygon(null)).setCoordinates([[ol.extent.getBottomLeft(e),ol.extent.getBottomRight(e),ol.extent.getTopRight(e),ol.extent.getTopLeft(e),ol.extent.getBottomLeft(e)]]);return t}};ol.interaction.Draw.getMode_=function(e){if(e===ol.geom.GeometryType.POINT||e===ol.geom.GeometryType.MULTI_POINT)var t=ol.interaction.Draw.Mode_.POINT;else e===ol.geom.GeometryType.LINE_STRING||e===ol.geom.GeometryType.MULTI_LINE_STRING?t=ol.interaction.Draw.Mode_.LINE_STRING:e===ol.geom.GeometryType.POLYGON||e===ol.geom.GeometryType.MULTI_POLYGON?t=ol.interaction.Draw.Mode_.POLYGON:e===ol.geom.GeometryType.CIRCLE&&(t=ol.interaction.Draw.Mode_.CIRCLE);return t};ol.interaction.Draw.Mode_={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"};ol.interaction.Draw.Event=function(e,t){ol.events.Event.call(this,e);this.feature=t};ol.inherits(ol.interaction.Draw.Event,ol.events.Event);ol.interaction.ExtentEventType={EXTENTCHANGED:"extentchanged"};ol.interaction.Extent=function(e){var t=e||{};this.pointerHandler_=this.extent_=null;this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10;this.snappedToVertex_=!1;this.vertexFeature_=this.extentFeature_=null;e||(e={});ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Extent.handleDownEvent_,handleDragEvent:ol.interaction.Extent.handleDragEvent_,handleEvent:ol.interaction.Extent.handleEvent_,handleUpEvent:ol.interaction.Extent.handleUpEvent_});this.extentOverlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:ol.interaction.Extent.getDefaultExtentStyleFunction_(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.vertexOverlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:ol.interaction.Extent.getDefaultPointerStyleFunction_(),updateWhileAnimating:!0,updateWhileInteracting:!0});e.extent&&this.setExtent(e.extent)};ol.inherits(ol.interaction.Extent,ol.interaction.Pointer);ol.interaction.Extent.handleEvent_=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;e.type!=ol.MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e);ol.interaction.Pointer.handleEvent.call(this,e);return!1};ol.interaction.Extent.handleDownEvent_=function(e){var t=e.pixel,o=e.map,r=this.getExtent(),n=function(e){var t=null,o=null;e[0]==r[0]?t=r[2]:e[0]==r[2]&&(t=r[0]);e[1]==r[1]?o=r[3]:e[1]==r[3]&&(o=r[1]);return null!==t&&null!==o?[t,o]:null};(e=this.snapToVertex_(t,o))&&r?(t=e[0]==r[0]||e[0]==r[2]?e[0]:null,o=e[1]==r[1]||e[1]==r[3]?e[1]:null,null!==t&&null!==o?this.pointerHandler_=ol.interaction.Extent.getPointHandler_(n(e)):null!==t?this.pointerHandler_=ol.interaction.Extent.getEdgeHandler_(n([t,r[1]]),n([t,r[3]])):null!==o&&(this.pointerHandler_=ol.interaction.Extent.getEdgeHandler_(n([r[0],o]),n([r[2],o])))):(e=o.getCoordinateFromPixel(t),this.setExtent([e[0],e[1],e[0],e[1]]),this.pointerHandler_=ol.interaction.Extent.getPointHandler_(e));return!0};ol.interaction.Extent.handleDragEvent_=function(e){this.pointerHandler_&&(e=e.coordinate,this.setExtent(this.pointerHandler_(e)),this.createOrUpdatePointerFeature_(e));return!0};ol.interaction.Extent.handleUpEvent_=function(e){this.pointerHandler_=null;(e=this.getExtent())&&0!==ol.extent.getArea(e)||this.setExtent(null);return!1};ol.interaction.Extent.getDefaultExtentStyleFunction_=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POLYGON]}};ol.interaction.Extent.getDefaultPointerStyleFunction_=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POINT]}};ol.interaction.Extent.getPointHandler_=function(e){return function(t){return ol.extent.boundingExtent([e,t])}};ol.interaction.Extent.getEdgeHandler_=function(e,t){return e[0]==t[0]?function(o){return ol.extent.boundingExtent([e,[o[0],t[1]]])}:e[1]==t[1]?function(o){return ol.extent.boundingExtent([e,[t[0],o[1]]])}:null};ol.interaction.Extent.getSegments_=function(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]};ol.interaction.Extent.prototype.snapToVertex_=function(e,t){var o=t.getCoordinateFromPixel(e),r=function(e,t){return ol.coordinate.squaredDistanceToSegment(o,e)-ol.coordinate.squaredDistanceToSegment(o,t)},n=this.getExtent();if(n){(n=ol.interaction.Extent.getSegments_(n)).sort(r);r=n[0];n=ol.coordinate.closestOnSegment(o,r);var i=t.getPixelFromCoordinate(n);if(ol.coordinate.distance(e,i)<=this.pixelTolerance_)return e=t.getPixelFromCoordinate(r[0]),t=t.getPixelFromCoordinate(r[1]),e=ol.coordinate.squaredDistance(i,e),t=ol.coordinate.squaredDistance(i,t),(this.snappedToVertex_=Math.sqrt(Math.min(e,t))<=this.pixelTolerance_)&&(n=e>t?r[1]:r[0]),n}return null};ol.interaction.Extent.prototype.handlePointerMove_=function(e){var t=e.pixel;e=e.map;var o=this.snapToVertex_(t,e);o||(o=e.getCoordinateFromPixel(t));this.createOrUpdatePointerFeature_(o)};ol.interaction.Extent.prototype.createOrUpdateExtentFeature_=function(e){var t=this.extentFeature_;t?e?t.setGeometry(ol.geom.Polygon.fromExtent(e)):t.setGeometry(void 0):(this.extentFeature_=t=e?new ol.Feature(ol.geom.Polygon.fromExtent(e)):new ol.Feature({}),this.extentOverlay_.getSource().addFeature(t));return t};ol.interaction.Extent.prototype.createOrUpdatePointerFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(this.vertexFeature_=t=new ol.Feature(new ol.geom.Point(e)),this.vertexOverlay_.getSource().addFeature(t));return t};ol.interaction.Extent.prototype.setMap=function(e){this.extentOverlay_.setMap(e);this.vertexOverlay_.setMap(e);ol.interaction.Pointer.prototype.setMap.call(this,e)};ol.interaction.Extent.prototype.getExtent=function(){return this.extent_};ol.interaction.Extent.prototype.setExtent=function(e){this.extent_=e||null;this.createOrUpdateExtentFeature_(e);this.dispatchEvent(new ol.interaction.Extent.Event(this.extent_))};ol.interaction.Extent.Event=function(e){ol.events.Event.call(this,ol.interaction.ExtentEventType.EXTENTCHANGED);this.extent=e};ol.inherits(ol.interaction.Extent.Event,ol.events.Event);ol.interaction.ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};ol.interaction.Modify=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Modify.handleDownEvent_,handleDragEvent:ol.interaction.Modify.handleDragEvent_,handleEvent:ol.interaction.Modify.handleEvent,handleUpEvent:ol.interaction.Modify.handleUpEvent_});this.condition_=e.condition?e.condition:ol.events.condition.primaryAction;this.defaultDeleteCondition_=function(e){return ol.events.condition.altKeyOnly(e)&&ol.events.condition.singleClick(e)};this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_;this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ol.events.condition.always;this.vertexSegments_=this.vertexFeature_=null;this.lastPixel_=[0,0];this.modified_=this.ignoreNextSingleClick_=!1;this.rBush_=new ol.structs.RBush;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.changingFeature_=this.snappedToVertex_=!1;this.dragSegments_=[];this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ol.interaction.Modify.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_};this.source_=null;e.source?(this.source_=e.source,e=new ol.Collection(this.source_.getFeatures()),ol.events.listen(this.source_,ol.source.VectorEventType.ADDFEATURE,this.handleSourceAdd_,this),ol.events.listen(this.source_,ol.source.VectorEventType.REMOVEFEATURE,this.handleSourceRemove_,this)):e=e.features;if(!e)throw Error("The modify interaction requires features or a source");this.features_=e;this.features_.forEach(this.addFeature_,this);ol.events.listen(this.features_,ol.CollectionEventType.ADD,this.handleFeatureAdd_,this);ol.events.listen(this.features_,ol.CollectionEventType.REMOVE,this.handleFeatureRemove_,this);this.lastPointerEvent_=null};ol.inherits(ol.interaction.Modify,ol.interaction.Pointer);ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX=0;ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX=1;ol.interaction.Modify.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);(t=this.getMap())&&t.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,t);ol.events.listen(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this)};ol.interaction.Modify.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYSTART,this.features_,e)))};ol.interaction.Modify.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e);this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);ol.events.unlisten(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this)};ol.interaction.Modify.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,o=[];t.forEach(function(t){e===t.feature&&o.push(t)});for(var r=o.length-1;0<=r;--r)t.remove(o[r])};ol.interaction.Modify.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);ol.interaction.Pointer.prototype.setActive.call(this,e)};ol.interaction.Modify.prototype.setMap=function(e){this.overlay_.setMap(e);ol.interaction.Pointer.prototype.setMap.call(this,e)};ol.interaction.Modify.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)};ol.interaction.Modify.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)};ol.interaction.Modify.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)};ol.interaction.Modify.prototype.handleFeatureChange_=function(e){this.changingFeature_||(e=e.target,this.removeFeature_(e),this.addFeature_(e))};ol.interaction.Modify.prototype.handleFeatureRemove_=function(e){this.removeFeature_(e.element)};ol.interaction.Modify.prototype.writePointGeometry_=function(e,t){var o=t.getCoordinates();e={feature:e,geometry:t,segment:[o,o]};this.rBush_.insert(t.getExtent(),e)};ol.interaction.Modify.prototype.writeMultiPointGeometry_=function(e,t){var o,r=t.getCoordinates(),n=0;for(o=r.length;n<o;++n){var i=r[n];i={feature:e,geometry:t,depth:[n],index:n,segment:[i,i]};this.rBush_.insert(t.getExtent(),i)}};ol.interaction.Modify.prototype.writeLineStringGeometry_=function(e,t){var o,r=t.getCoordinates(),n=0;for(o=r.length-1;n<o;++n){var i=r.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:i};this.rBush_.insert(ol.extent.boundingExtent(i),a)}};ol.interaction.Modify.prototype.writeMultiLineStringGeometry_=function(e,t){var o,r,n=t.getCoordinates(),i=0;for(r=n.length;i<r;++i){var a=n[i],s=0;for(o=a.length-1;s<o;++s){var l=a.slice(s,s+2),c={feature:e,geometry:t,depth:[i],index:s,segment:l};this.rBush_.insert(ol.extent.boundingExtent(l),c)}}};ol.interaction.Modify.prototype.writePolygonGeometry_=function(e,t){var o,r,n=t.getCoordinates(),i=0;for(r=n.length;i<r;++i){var a=n[i],s=0;for(o=a.length-1;s<o;++s){var l=a.slice(s,s+2),c={feature:e,geometry:t,depth:[i],index:s,segment:l};this.rBush_.insert(ol.extent.boundingExtent(l),c)}}};ol.interaction.Modify.prototype.writeMultiPolygonGeometry_=function(e,t){var o,r,n,i=t.getCoordinates(),a=0;for(n=i.length;a<n;++a){var s=i[a],l=0;for(r=s.length;l<r;++l){var c=s[l],u=0;for(o=c.length-1;u<o;++u){var h=c.slice(u,u+2),d={feature:e,geometry:t,depth:[l,a],index:u,segment:h};this.rBush_.insert(ol.extent.boundingExtent(h),d)}}}};ol.interaction.Modify.prototype.writeCircleGeometry_=function(e,t){var o=t.getCenter(),r={feature:e,geometry:t,index:ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX,segment:[o,o]};e={feature:e,geometry:t,index:ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX,segment:[o,o]};r.featureSegments=e.featureSegments=[r,e];this.rBush_.insert(ol.extent.createOrUpdateFromCoordinate(o),r);this.rBush_.insert(t.getExtent(),e)};ol.interaction.Modify.prototype.writeGeometryCollectionGeometry_=function(e,t){var o=t.getGeometriesArray();for(t=0;t<o.length;++t)this.SEGMENT_WRITERS_[o[t].getType()].call(this,e,o[t])};ol.interaction.Modify.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(this.vertexFeature_=t=new ol.Feature(new ol.geom.Point(e)),this.overlay_.getSource().addFeature(t));return t};ol.interaction.Modify.compareIndexes_=function(e,t){return e.index-t.index};ol.interaction.Modify.handleDownEvent_=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0;this.modified_=!1;var o=this.vertexFeature_;if(o){var r=[];o=o.getGeometry().getCoordinates();var n=ol.extent.boundingExtent([o]),i={};(n=this.rBush_.getInExtent(n)).sort(ol.interaction.Modify.compareIndexes_);for(var a=0,s=n.length;a<s;++a){var l=n[a],c=l.segment,u=ol.getUid(l.feature),h=l.depth;h&&(u+="-"+h.join("-"));i[u]||(i[u]=Array(2));l.geometry.getType()===ol.geom.GeometryType.CIRCLE&&l.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX?(c=ol.interaction.Modify.closestOnSegmentData_(t,l),ol.coordinate.equals(c,o)&&!i[u][0]&&(this.dragSegments_.push([l,0]),i[u][0]=l)):ol.coordinate.equals(c[0],o)&&!i[u][0]?(this.dragSegments_.push([l,0]),i[u][0]=l):ol.coordinate.equals(c[1],o)&&!i[u][1]?(l.geometry.getType()!==ol.geom.GeometryType.LINE_STRING&&l.geometry.getType()!==ol.geom.GeometryType.MULTI_LINE_STRING||!i[u][0]||0!==i[u][0].index)&&(this.dragSegments_.push([l,1]),i[u][1]=l):this.insertVertexCondition_(e)&&ol.getUid(c)in this.vertexSegments_&&!i[u][0]&&!i[u][1]&&r.push([l,o])}r.length&&this.willModifyFeatures_(e);for(e=r.length-1;0<=e;--e)this.insertVertex_.apply(this,r[e])}return!!this.vertexFeature_};ol.interaction.Modify.handleDragEvent_=function(e){this.ignoreNextSingleClick_=!1;this.willModifyFeatures_(e);e=e.coordinate;for(var t=0,o=this.dragSegments_.length;t<o;++t){var r=this.dragSegments_[t],n=r[0],i=n.depth,a=n.geometry,s=n.segment;for(r=r[1];e.length<a.getStride();)e.push(s[r][e.length]);switch(a.getType()){case ol.geom.GeometryType.POINT:var l=e;s[0]=s[1]=e;break;case ol.geom.GeometryType.MULTI_POINT:(l=a.getCoordinates())[n.index]=e;s[0]=s[1]=e;break;case ol.geom.GeometryType.LINE_STRING:(l=a.getCoordinates())[n.index+r]=e;s[r]=e;break;case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:(l=a.getCoordinates())[i[0]][n.index+r]=e;s[r]=e;break;case ol.geom.GeometryType.MULTI_POLYGON:(l=a.getCoordinates())[i[1]][i[0]][n.index+r]=e;s[r]=e;break;case ol.geom.GeometryType.CIRCLE:s[0]=s[1]=e,n.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX?(this.changingFeature_=!0,a.setCenter(e)):(this.changingFeature_=!0,a.setRadius(ol.coordinate.distance(a.getCenter(),e))),this.changingFeature_=!1}l&&this.setGeometryCoordinates_(a,l)}this.createOrUpdateVertexFeature_(e)};ol.interaction.Modify.handleUpEvent_=function(e){for(var t,o,r=this.dragSegments_.length-1;0<=r;--r)if((o=(t=this.dragSegments_[r][0]).geometry).getType()===ol.geom.GeometryType.CIRCLE){var n=o.getCenter(),i=t.featureSegments[0];t=t.featureSegments[1];i.segment[0]=i.segment[1]=n;t.segment[0]=t.segment[1]=n;this.rBush_.update(ol.extent.createOrUpdateFromCoordinate(n),i);this.rBush_.update(o.getExtent(),t)}else this.rBush_.update(ol.extent.boundingExtent(t.segment),t);this.modified_&&(this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYEND,this.features_,e)),this.modified_=!1);return!1};ol.interaction.Modify.handleEvent=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;this.lastPointerEvent_=e;var t;e.map.getView().getInteracting()||e.type!=ol.MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e);this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=ol.MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint());e.type==ol.MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1);return ol.interaction.Pointer.handleEvent.call(this,e)&&!t};ol.interaction.Modify.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel;this.handlePointerAtPixel_(e.pixel,e.map)};ol.interaction.Modify.prototype.handlePointerAtPixel_=function(e,t){var o=t.getCoordinateFromPixel(e),r=function(e,t){return ol.interaction.Modify.pointDistanceToSegmentDataSquared_(o,e)-ol.interaction.Modify.pointDistanceToSegmentDataSquared_(o,t)},n=ol.extent.buffer(ol.extent.createOrUpdateFromCoordinate(o),t.getView().getResolution()*this.pixelTolerance_);if(0<(n=this.rBush_.getInExtent(n)).length){n.sort(r);var i=n[0];r=i.segment;var a=ol.interaction.Modify.closestOnSegmentData_(o,i),s=t.getPixelFromCoordinate(a),l=ol.coordinate.distance(e,s);if(l<=this.pixelTolerance_){e={};if(i.geometry.getType()===ol.geom.GeometryType.CIRCLE&&i.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(a);else for(l=t.getPixelFromCoordinate(r[0]),i=t.getPixelFromCoordinate(r[1]),t=ol.coordinate.squaredDistance(s,l),s=ol.coordinate.squaredDistance(s,i),l=Math.sqrt(Math.min(t,s)),(this.snappedToVertex_=l<=this.pixelTolerance_)&&(a=t>s?r[1]:r[0]),this.createOrUpdateVertexFeature_(a),t=1,s=n.length;t<s&&(a=n[t].segment,ol.coordinate.equals(r[0],a[0])&&ol.coordinate.equals(r[1],a[1])||ol.coordinate.equals(r[0],a[1])&&ol.coordinate.equals(r[1],a[0]));++t)e[ol.getUid(a)]=!0;e[ol.getUid(r)]=!0;this.vertexSegments_=e;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)};ol.interaction.Modify.pointDistanceToSegmentDataSquared_=function(e,t){var o=t.geometry;return o.getType()===ol.geom.GeometryType.CIRCLE&&t.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX?(e=ol.coordinate.squaredDistance(o.getCenter(),e),(o=Math.sqrt(e)-o.getRadius())*o):ol.coordinate.squaredDistanceToSegment(e,t.segment)};ol.interaction.Modify.closestOnSegmentData_=function(e,t){var o=t.geometry;return o.getType()===ol.geom.GeometryType.CIRCLE&&t.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX?o.getClosestPoint(e):ol.coordinate.closestOnSegment(e,t.segment)};ol.interaction.Modify.prototype.insertVertex_=function(e,t){for(var o,r=e.segment,n=e.feature,i=e.geometry,a=e.depth,s=e.index;t.length<i.getStride();)t.push(0);switch(i.getType()){case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:(o=i.getCoordinates())[a[0]].splice(s+1,0,t);break;case ol.geom.GeometryType.MULTI_POLYGON:(o=i.getCoordinates())[a[1]][a[0]].splice(s+1,0,t);break;case ol.geom.GeometryType.LINE_STRING:(o=i.getCoordinates()).splice(s+1,0,t);break;default:return}this.setGeometryCoordinates_(i,o);(o=this.rBush_).remove(e);this.updateSegmentIndices_(i,s,a,1);e={segment:[r[0],t],feature:n,geometry:i,depth:a,index:s};o.insert(ol.extent.boundingExtent(e.segment),e);this.dragSegments_.push([e,1]);t={segment:[t,r[1]],feature:n,geometry:i,depth:a,index:s+1};o.insert(ol.extent.boundingExtent(t.segment),t);this.dragSegments_.push([t,0]);this.ignoreNextSingleClick_=!0};ol.interaction.Modify.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=ol.MapBrowserEventType.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e);this.removeVertex_();this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYEND,this.features_,e));this.modified_=!1;return!0}return!1};ol.interaction.Modify.prototype.removeVertex_=function(){var e,t,o=this.dragSegments_,r={},n=!1;for(t=o.length-1;0<=t;--t){var i=o[t],a=i[0],s=ol.getUid(a.feature);a.depth&&(s+="-"+a.depth.join("-"));s in r||(r[s]={});0===i[1]?(r[s].right=a,r[s].index=a.index):1==i[1]&&(r[s].left=a,r[s].index=a.index+1)}for(s in r){var l=r[s].right,c=r[s].left,u=(t=r[s].index)-1;a=void 0!==c?c:l;0>u&&(u=0);var h=e=(i=a.geometry).getCoordinates();n=!1;switch(i.getType()){case ol.geom.GeometryType.MULTI_LINE_STRING:2<e[a.depth[0]].length&&(e[a.depth[0]].splice(t,1),n=!0);break;case ol.geom.GeometryType.LINE_STRING:2<e.length&&(e.splice(t,1),n=!0);break;case ol.geom.GeometryType.MULTI_POLYGON:h=h[a.depth[1]];case ol.geom.GeometryType.POLYGON:4<(h=h[a.depth[0]]).length&&(t==h.length-1&&(t=0),h.splice(t,1),n=!0,0===t&&(h.pop(),h.push(h[0]),u=h.length-1))}n&&(this.setGeometryCoordinates_(i,e),h=[],void 0!==c&&(this.rBush_.remove(c),h.push(c.segment[0])),void 0!==l&&(this.rBush_.remove(l),h.push(l.segment[1])),void 0!==c&&void 0!==l&&(c={depth:a.depth,feature:a.feature,geometry:a.geometry,index:u,segment:h},this.rBush_.insert(ol.extent.boundingExtent(c.segment),c)),this.updateSegmentIndices_(i,t,a.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),o.length=0)}return n};ol.interaction.Modify.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0;e.setCoordinates(t);this.changingFeature_=!1};ol.interaction.Modify.prototype.updateSegmentIndices_=function(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),function(n){n.geometry===e&&(void 0===o||void 0===n.depth||ol.array.equals(n.depth,o))&&n.index>t&&(n.index+=r)})};ol.interaction.Modify.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POINT]}};ol.interaction.Modify.Event=function(e,t,o){ol.events.Event.call(this,e);this.features=t;this.mapBrowserEvent=o};ol.inherits(ol.interaction.Modify.Event,ol.events.Event);ol.interaction.Select=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.Select.handleEvent});e=e||{};this.condition_=e.condition?e.condition:ol.events.condition.singleClick;this.addCondition_=e.addCondition?e.addCondition:ol.events.condition.never;this.removeCondition_=e.removeCondition?e.removeCondition:ol.events.condition.never;this.toggleCondition_=e.toggleCondition?e.toggleCondition:ol.events.condition.shiftKeyOnly;this.multi_=!!e.multi&&e.multi;this.filter_=e.filter?e.filter:ol.functions.TRUE;this.hitTolerance_=e.hitTolerance?e.hitTolerance:0;this.featureOverlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,features:e.features,wrapX:e.wrapX}),style:e.style?e.style:ol.interaction.Select.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0});if(e.layers)if("function"==typeof e.layers)e=e.layers;else{var t=e.layers;e=function(e){return ol.array.includes(t,e)}}else e=ol.functions.TRUE;this.layerFilter_=e;this.featureLayerAssociation_={};e=this.featureOverlay_.getSource().getFeaturesCollection();ol.events.listen(e,ol.CollectionEventType.ADD,this.addFeature_,this);ol.events.listen(e,ol.CollectionEventType.REMOVE,this.removeFeature_,this)};ol.inherits(ol.interaction.Select,ol.interaction.Interaction);ol.interaction.Select.prototype.addFeatureLayerAssociation_=function(e,t){e=ol.getUid(e);this.featureLayerAssociation_[e]=t};ol.interaction.Select.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()};ol.interaction.Select.prototype.getHitTolerance=function(){return this.hitTolerance_};ol.interaction.Select.prototype.getLayer=function(e){e=ol.getUid(e);return this.featureLayerAssociation_[e]};ol.interaction.Select.handleEvent=function(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),n=!t&&!o&&!r,i=e.map,a=this.featureOverlay_.getSource().getFeaturesCollection(),s=[],l=[];if(n){ol.obj.clear(this.featureLayerAssociation_);i.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(n=a.getLength()-1;0<=n;--n){i=a.item(n);var c=l.indexOf(i);-1<c?l.splice(c,1):(a.remove(i),s.push(i))}0!==l.length&&a.extend(l)}else{i.forEachFeatureAtPixel(e.pixel,function(e,n){if(this.filter_(e,n))return!t&&!r||ol.array.includes(a.getArray(),e)?(o||r)&&ol.array.includes(a.getArray(),e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)):(l.push(e),this.addFeatureLayerAssociation_(e,n)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(n=s.length-1;0<=n;--n)a.remove(s[n]);a.extend(l)}(0<l.length||0<s.length)&&this.dispatchEvent(new ol.interaction.Select.Event(ol.interaction.Select.EventType_.SELECT,l,s,e));return ol.events.condition.pointerMove(e)};ol.interaction.Select.prototype.setHitTolerance=function(e){this.hitTolerance_=e};ol.interaction.Select.prototype.setMap=function(e){var t=this.getMap(),o=this.featureOverlay_.getSource().getFeaturesCollection();t&&o.forEach(t.unskipFeature,t);ol.interaction.Interaction.prototype.setMap.call(this,e);this.featureOverlay_.setMap(e);e&&o.forEach(e.skipFeature,e)};ol.interaction.Select.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();ol.array.extend(e[ol.geom.GeometryType.POLYGON],e[ol.geom.GeometryType.LINE_STRING]);ol.array.extend(e[ol.geom.GeometryType.GEOMETRY_COLLECTION],e[ol.geom.GeometryType.LINE_STRING]);return function(t,o){return t.getGeometry()?e[t.getGeometry().getType()]:null}};ol.interaction.Select.prototype.addFeature_=function(e){var t=this.getMap();t&&t.skipFeature(e.element)};ol.interaction.Select.prototype.removeFeature_=function(e){var t=this.getMap();t&&t.unskipFeature(e.element)};ol.interaction.Select.prototype.removeFeatureLayerAssociation_=function(e){e=ol.getUid(e);delete this.featureLayerAssociation_[e]};ol.interaction.Select.Event=function(e,t,o,r){ol.events.Event.call(this,e);this.selected=t;this.deselected=o;this.mapBrowserEvent=r};ol.inherits(ol.interaction.Select.Event,ol.events.Event);ol.interaction.Select.EventType_={SELECT:"select"};ol.interaction.Snap=function(e){ol.interaction.Pointer.call(this,{handleEvent:ol.interaction.Snap.handleEvent_,handleDownEvent:ol.functions.TRUE,handleUpEvent:ol.interaction.Snap.handleUpEvent_});e=e||{};this.source_=e.source?e.source:null;this.vertex_=void 0===e.vertex||e.vertex;this.edge_=void 0===e.edge||e.edge;this.features_=e.features?e.features:null;this.featuresListenerKeys_=[];this.featureChangeListenerKeys_={};this.indexedFeaturesExtents_={};this.pendingFeatures_={};this.pixelCoordinate_=null;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.sortByDistance_=ol.interaction.Snap.sortByDistance.bind(this);this.rBush_=new ol.structs.RBush;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}};ol.inherits(ol.interaction.Snap,ol.interaction.Pointer);ol.interaction.Snap.prototype.addFeature=function(e,t){t=void 0===t||t;var o=ol.getUid(e),r=e.getGeometry();if(r){var n=this.SEGMENT_WRITERS_[r.getType()];n&&(this.indexedFeaturesExtents_[o]=r.getExtent(ol.extent.createEmpty()),n.call(this,e,r))}t&&(this.featureChangeListenerKeys_[o]=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this))};ol.interaction.Snap.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)};ol.interaction.Snap.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)};ol.interaction.Snap.prototype.getFeatures_=function(){var e;this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures());return e};ol.interaction.Snap.prototype.handleFeatureAdd_=function(e){if(e instanceof ol.source.Vector.Event)var t=e.feature;else e instanceof ol.Collection.Event&&(t=e.element);this.addFeature(t)};ol.interaction.Snap.prototype.handleFeatureRemove_=function(e){if(e instanceof ol.source.Vector.Event)var t=e.feature;else e instanceof ol.Collection.Event&&(t=e.element);this.removeFeature(t)};ol.interaction.Snap.prototype.handleFeatureChange_=function(e){e=e.target;if(this.handlingDownUpSequence){var t=ol.getUid(e);t in this.pendingFeatures_||(this.pendingFeatures_[t]=e)}else this.updateFeature_(e)};ol.interaction.Snap.prototype.removeFeature=function(e,t){t=void 0===t||t;var o=ol.getUid(e),r=this.indexedFeaturesExtents_[o];if(r){var n=this.rBush_,i=[];n.forEachInExtent(r,function(t){e===t.feature&&i.push(t)});for(r=i.length-1;0<=r;--r)n.remove(i[r])}t&&(ol.events.unlistenByKey(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])};ol.interaction.Snap.prototype.setMap=function(e){var t=this.getMap(),o=this.featuresListenerKeys_,r=this.getFeatures_();t&&(o.forEach(ol.events.unlistenByKey),o.length=0,r.forEach(this.forEachFeatureRemove_,this));ol.interaction.Pointer.prototype.setMap.call(this,e);e&&(this.features_?o.push(ol.events.listen(this.features_,ol.CollectionEventType.ADD,this.handleFeatureAdd_,this),ol.events.listen(this.features_,ol.CollectionEventType.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push(ol.events.listen(this.source_,ol.source.VectorEventType.ADDFEATURE,this.handleFeatureAdd_,this),ol.events.listen(this.source_,ol.source.VectorEventType.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_,this))};ol.interaction.Snap.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.Snap.prototype.snapTo=function(e,t,o){var r=o.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),n=o.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]);r=ol.extent.boundingExtent([r,n]);var i=this.rBush_.getInExtent(r);this.vertex_&&!this.edge_&&(i=i.filter(function(e){return e.feature.getGeometry().getType()!==ol.geom.GeometryType.CIRCLE}));var a=!1;r=!1;var s=n=null;if(0<i.length){this.pixelCoordinate_=t;i.sort(this.sortByDistance_);var l=i[0].segment;a=i[0].feature.getGeometry().getType()===ol.geom.GeometryType.CIRCLE;this.vertex_&&!this.edge_?(t=o.getPixelFromCoordinate(l[0]),a=o.getPixelFromCoordinate(l[1]),t=ol.coordinate.squaredDistance(e,t),e=ol.coordinate.squaredDistance(e,a),a=(a=Math.sqrt(Math.min(t,e)))<=this.pixelTolerance_)&&(r=!0,n=t>e?l[1]:l[0],s=o.getPixelFromCoordinate(n)):this.edge_&&(n=a?ol.coordinate.closestOnCircle(t,i[0].feature.getGeometry()):ol.coordinate.closestOnSegment(t,l),s=o.getPixelFromCoordinate(n),ol.coordinate.distance(e,s)<=this.pixelTolerance_&&(r=!0,this.vertex_&&!a&&(t=o.getPixelFromCoordinate(l[0]),a=o.getPixelFromCoordinate(l[1]),t=ol.coordinate.squaredDistance(s,t),e=ol.coordinate.squaredDistance(s,a),a=(a=Math.sqrt(Math.min(t,e)))<=this.pixelTolerance_)))&&(n=t>e?l[1]:l[0],s=o.getPixelFromCoordinate(n));r&&(s=[Math.round(s[0]),Math.round(s[1])])}return{snapped:r,vertex:n,vertexPixel:s}};ol.interaction.Snap.prototype.updateFeature_=function(e){this.removeFeature(e,!1);this.addFeature(e,!1)};ol.interaction.Snap.prototype.writeCircleGeometry_=function(e,t){var o,r=0;for(o=(t=ol.geom.Polygon.fromCircle(t).getCoordinates()[0]).length-1;r<o;++r){var n=t.slice(r,r+2),i={feature:e,segment:n};this.rBush_.insert(ol.extent.boundingExtent(n),i)}};ol.interaction.Snap.prototype.writeGeometryCollectionGeometry_=function(e,t){var o=t.getGeometriesArray();for(t=0;t<o.length;++t){var r=this.SEGMENT_WRITERS_[o[t].getType()];r&&r.call(this,e,o[t])}};ol.interaction.Snap.prototype.writeLineStringGeometry_=function(e,t){var o,r=0;for(o=(t=t.getCoordinates()).length-1;r<o;++r){var n=t.slice(r,r+2),i={feature:e,segment:n};this.rBush_.insert(ol.extent.boundingExtent(n),i)}};ol.interaction.Snap.prototype.writeMultiLineStringGeometry_=function(e,t){var o,r,n=0;for(r=(t=t.getCoordinates()).length;n<r;++n){var i=t[n],a=0;for(o=i.length-1;a<o;++a){var s=i.slice(a,a+2),l={feature:e,segment:s};this.rBush_.insert(ol.extent.boundingExtent(s),l)}}};ol.interaction.Snap.prototype.writeMultiPointGeometry_=function(e,t){var o,r=t.getCoordinates(),n=0;for(o=r.length;n<o;++n){var i=r[n];i={feature:e,segment:[i,i]};this.rBush_.insert(t.getExtent(),i)}};ol.interaction.Snap.prototype.writeMultiPolygonGeometry_=function(e,t){var o,r,n,i=0;for(n=(t=t.getCoordinates()).length;i<n;++i){var a=t[i],s=0;for(r=a.length;s<r;++s){var l=a[s],c=0;for(o=l.length-1;c<o;++c){var u=l.slice(c,c+2),h={feature:e,segment:u};this.rBush_.insert(ol.extent.boundingExtent(u),h)}}}};ol.interaction.Snap.prototype.writePointGeometry_=function(e,t){var o=t.getCoordinates();e={feature:e,segment:[o,o]};this.rBush_.insert(t.getExtent(),e)};ol.interaction.Snap.prototype.writePolygonGeometry_=function(e,t){var o,r,n=0;for(r=(t=t.getCoordinates()).length;n<r;++n){var i=t[n],a=0;for(o=i.length-1;a<o;++a){var s=i.slice(a,a+2),l={feature:e,segment:s};this.rBush_.insert(ol.extent.boundingExtent(s),l)}}};ol.interaction.Snap.handleEvent_=function(e){var t=this.snapTo(e.pixel,e.coordinate,e.map);t.snapped&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel);return ol.interaction.Pointer.handleEvent.call(this,e)};ol.interaction.Snap.handleUpEvent_=function(e){(e=ol.obj.getValues(this.pendingFeatures_)).length&&(e.forEach(this.updateFeature_,this),this.pendingFeatures_={});return!1};ol.interaction.Snap.sortByDistance=function(e,t){return ol.coordinate.squaredDistanceToSegment(this.pixelCoordinate_,e.segment)-ol.coordinate.squaredDistanceToSegment(this.pixelCoordinate_,t.segment)};ol.interaction.TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};ol.interaction.Translate=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Translate.handleDownEvent_,handleDragEvent:ol.interaction.Translate.handleDragEvent_,handleMoveEvent:ol.interaction.Translate.handleMoveEvent_,handleUpEvent:ol.interaction.Translate.handleUpEvent_});e=e||{};this.lastCoordinate_=null;this.features_=void 0!==e.features?e.features:null;if(e.layers)if("function"==typeof e.layers)var t=e.layers;else{var o=e.layers;t=function(e){return ol.array.includes(o,e)}}else t=ol.functions.TRUE;this.layerFilter_=t;this.hitTolerance_=e.hitTolerance?e.hitTolerance:0;this.lastFeature_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.interaction.Property.ACTIVE),this.handleActiveChanged_,this)};ol.inherits(ol.interaction.Translate,ol.interaction.Pointer);ol.interaction.Translate.handleDownEvent_=function(e){this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map);if(!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate;ol.interaction.Translate.handleMoveEvent_.call(this,e);var t=this.features_||new ol.Collection([this.lastFeature_]);this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATESTART,t,e.coordinate));return!0}return!1};ol.interaction.Translate.handleUpEvent_=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null;ol.interaction.Translate.handleMoveEvent_.call(this,e);var t=this.features_||new ol.Collection([this.lastFeature_]);this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATEEND,t,e.coordinate));return!0}return!1};ol.interaction.Translate.handleDragEvent_=function(e){if(this.lastCoordinate_){var t=(e=e.coordinate)[0]-this.lastCoordinate_[0],o=e[1]-this.lastCoordinate_[1],r=this.features_||new ol.Collection([this.lastFeature_]);r.forEach(function(e){var r=e.getGeometry();r.translate(t,o);e.setGeometry(r)});this.lastCoordinate_=e;this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATING,r,e))}};ol.interaction.Translate.handleMoveEvent_=function(e){var t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")};ol.interaction.Translate.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||ol.array.includes(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})};ol.interaction.Translate.prototype.getHitTolerance=function(){return this.hitTolerance_};ol.interaction.Translate.prototype.setHitTolerance=function(e){this.hitTolerance_=e};ol.interaction.Translate.prototype.setMap=function(e){var t=this.getMap();ol.interaction.Pointer.prototype.setMap.call(this,e);this.updateState_(t)};ol.interaction.Translate.prototype.handleActiveChanged_=function(){this.updateState_(null)};ol.interaction.Translate.prototype.updateState_=function(e){var t=this.getMap(),o=this.getActive();t&&o||(t=t||e)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")};ol.interaction.Translate.Event=function(e,t,o){ol.events.Event.call(this,e);this.features=t;this.coordinate=o};ol.inherits(ol.interaction.Translate.Event,ol.events.Event);ol.layer.Heatmap=function(e){e=e||{};var t=ol.obj.assign({},e);delete t.gradient;delete t.radius;delete t.blur;delete t.shadow;delete t.weight;ol.layer.Vector.call(this,t);this.gradient_=null;this.shadow_=void 0!==e.shadow?e.shadow:250;this.circleImage_=void 0;this.styleCache_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.GRADIENT),this.handleGradientChanged_,this);this.setGradient(e.gradient?e.gradient:ol.layer.Heatmap.DEFAULT_GRADIENT);this.setBlur(void 0!==e.blur?e.blur:15);this.setRadius(void 0!==e.radius?e.radius:8);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.BLUR),this.handleStyleChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.RADIUS),this.handleStyleChanged_,this);this.handleStyleChanged_();var o=e.weight?e.weight:"weight",r="string"==typeof o?function(e){return e.get(o)}:o;this.setStyle(function(e,t){t=255*(e=void 0!==(e=r(e))?ol.math.clamp(e,0,1):1)|0;var o=this.styleCache_[t];o||(o=[new ol.style.Style({image:new ol.style.Icon({opacity:e,src:this.circleImage_})})],this.styleCache_[t]=o);return o}.bind(this));this.setRenderOrder(null);ol.events.listen(this,ol.render.EventType.RENDER,this.handleRender_,this)};ol.inherits(ol.layer.Heatmap,ol.layer.Vector);ol.layer.Heatmap.DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"];ol.layer.Heatmap.createGradient_=function(e){for(var t=ol.dom.createCanvasContext2D(1,256),o=t.createLinearGradient(0,0,1,256),r=1/(e.length-1),n=0,i=e.length;n<i;++n)o.addColorStop(n*r,e[n]);t.fillStyle=o;t.fillRect(0,0,1,256);return t.getImageData(0,0,1,256).data};ol.layer.Heatmap.prototype.createCircle_=function(){var e=this.getRadius(),t=this.getBlur(),o=e+t+1,r=2*o;(r=ol.dom.createCanvasContext2D(r,r)).shadowOffsetX=r.shadowOffsetY=this.shadow_;r.shadowBlur=t;r.shadowColor="#000";r.beginPath();t=o-this.shadow_;r.arc(t,t,e,0,2*Math.PI,!0);r.fill();return r.canvas.toDataURL()};ol.layer.Heatmap.prototype.getBlur=function(){return this.get(ol.layer.Heatmap.Property_.BLUR)};ol.layer.Heatmap.prototype.getGradient=function(){return this.get(ol.layer.Heatmap.Property_.GRADIENT)};ol.layer.Heatmap.prototype.getRadius=function(){return this.get(ol.layer.Heatmap.Property_.RADIUS)};ol.layer.Heatmap.prototype.handleGradientChanged_=function(){this.gradient_=ol.layer.Heatmap.createGradient_(this.getGradient())};ol.layer.Heatmap.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_();this.styleCache_=Array(256);this.changed()};ol.layer.Heatmap.prototype.handleRender_=function(e){var t,o,r=(e=e.context).canvas,n=(r=e.getImageData(0,0,r.width,r.height)).data,i=0;for(t=n.length;i<t;i+=4)(o=4*n[i+3])&&(n[i]=this.gradient_[o],n[i+1]=this.gradient_[o+1],n[i+2]=this.gradient_[o+2]);e.putImageData(r,0,0)};ol.layer.Heatmap.prototype.setBlur=function(e){this.set(ol.layer.Heatmap.Property_.BLUR,e)};ol.layer.Heatmap.prototype.setGradient=function(e){this.set(ol.layer.Heatmap.Property_.GRADIENT,e)};ol.layer.Heatmap.prototype.setRadius=function(e){this.set(ol.layer.Heatmap.Property_.RADIUS,e)};ol.layer.Heatmap.Property_={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"};ol.layer.Image=function(e){ol.layer.Layer.call(this,e||{});this.type=ol.LayerType.IMAGE};ol.inherits(ol.layer.Image,ol.layer.Layer);ol.layer.TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};ol.layer.Tile=function(e){e=e||{};var t=ol.obj.assign({},e);delete t.preload;delete t.useInterimTilesOnError;ol.layer.Layer.call(this,t);this.setPreload(void 0!==e.preload?e.preload:0);this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError);this.type=ol.LayerType.TILE};ol.inherits(ol.layer.Tile,ol.layer.Layer);ol.layer.Tile.prototype.getPreload=function(){return this.get(ol.layer.TileProperty.PRELOAD)};ol.layer.Tile.prototype.setPreload=function(e){this.set(ol.layer.TileProperty.PRELOAD,e)};ol.layer.Tile.prototype.getUseInterimTilesOnError=function(){return this.get(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR)};ol.layer.Tile.prototype.setUseInterimTilesOnError=function(e){this.set(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR,e)};ol.layer.VectorTile=function(e){var t=(e=e||{}).renderMode||ol.layer.VectorTileRenderType.HYBRID;ol.asserts.assert(void 0==t||t==ol.layer.VectorTileRenderType.IMAGE||t==ol.layer.VectorTileRenderType.HYBRID||t==ol.layer.VectorTileRenderType.VECTOR,28);e.declutter&&t==ol.layer.VectorTileRenderType.IMAGE&&(t=ol.layer.VectorTileRenderType.HYBRID);e.renderMode=t;delete(t=ol.obj.assign({},e)).preload;delete t.useInterimTilesOnError;ol.layer.Vector.call(this,t);this.setPreload(e.preload?e.preload:0);this.setUseInterimTilesOnError(!e.useInterimTilesOnError||e.useInterimTilesOnError);this.type=ol.LayerType.VECTOR_TILE};ol.inherits(ol.layer.VectorTile,ol.layer.Vector);ol.layer.VectorTile.prototype.getPreload=function(){return this.get(ol.layer.TileProperty.PRELOAD)};ol.layer.VectorTile.prototype.getUseInterimTilesOnError=function(){return this.get(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR)};ol.layer.VectorTile.prototype.setPreload=function(e){this.set(ol.layer.TileProperty.PRELOAD,e)};ol.layer.VectorTile.prototype.setUseInterimTilesOnError=function(e){this.set(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR,e)};ol.proj.common={};ol.proj.common.add=ol.proj.addCommon;ol.render.toContext=function(e,t){var o=e.canvas,r=t||{};t=r.pixelRatio||ol.has.DEVICE_PIXEL_RATIO;(r=r.size)&&(o.width=r[0]*t,o.height=r[1]*t,o.style.width=r[0]+"px",o.style.height=r[1]+"px");o=[0,0,o.width,o.height];r=ol.transform.scale(ol.transform.create(),t,t);return new ol.render.canvas.Immediate(e,t,o,r,0)};ol.TileUrlFunction={};ol.TileUrlFunction.createFromTemplate=function(e,t){var o=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,i=/\{-y\}/g;return function(a,s,l){if(a)return e.replace(o,a[0].toString()).replace(r,a[1].toString()).replace(n,function(){return(-a[2]-1).toString()}).replace(i,function(){var e=t.getFullTileRange(a[0]);ol.asserts.assert(e,55);return(e.getHeight()+a[2]).toString()})}};ol.TileUrlFunction.createFromTemplates=function(e,t){for(var o=e.length,r=Array(o),n=0;n<o;++n)r[n]=ol.TileUrlFunction.createFromTemplate(e[n],t);return ol.TileUrlFunction.createFromTileUrlFunctions(r)};ol.TileUrlFunction.createFromTileUrlFunctions=function(e){return 1===e.length?e[0]:function(t,o,r){if(t){var n=ol.tilecoord.hash(t);n=ol.math.modulo(n,e.length);return e[n](t,o,r)}}};ol.TileUrlFunction.nullTileUrlFunction=function(e,t,o){};ol.TileUrlFunction.expandUrl=function(e){var t=[],o=/\{([a-z])-([a-z])\}/.exec(e);if(o){for(var r=o[1].charCodeAt(0),n=o[2].charCodeAt(0);r<=n;++r)t.push(e.replace(o[0],String.fromCharCode(r)));return t}if(o=o=/\{(\d+)-(\d+)\}/.exec(e)){n=parseInt(o[2],10);for(r=parseInt(o[1],10);r<=n;r++)t.push(e.replace(o[0],r.toString()));return t}t.push(e);return t};ol.net={};ol.net.jsonp=function(e,t,o,r){function n(){delete window[a];i.parentNode.removeChild(i)}var i=document.createElement("script"),a="olc_"+ol.getUid(t);i.async=!0;i.src=e+(-1==e.indexOf("?")?"?":"&")+(r||"callback")+"="+a;var s=setTimeout(function(){n();o&&o()},1e4);window[a]=function(e){clearTimeout(s);n();t(e)};document.getElementsByTagName("head")[0].appendChild(i)};ol.TileCache=function(e){ol.structs.LRUCache.call(this,e)};ol.inherits(ol.TileCache,ol.structs.LRUCache);ol.TileCache.prototype.expireCache=function(e){for(var t,o;this.canExpireCache()&&!(t=this.peekLast(),o=t.tileCoord[0].toString(),o in e&&e[o].contains(t.tileCoord));)this.pop().dispose()};ol.TileCache.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=this.peekFirstKey(),t=ol.tilecoord.fromKey(e)[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(ol.tilecoord.getKey(e.tileCoord)),e.dispose())},this)}};ol.reproj={};ol.reproj.calculateSourceResolution=function(e,t,o,r){var n=ol.proj.transform(o,t,e);o=ol.proj.getPointResolution(t,r,o);void 0!==(t=t.getMetersPerUnit())&&(o*=t);void 0!==(t=e.getMetersPerUnit())&&(o/=t);(t=e.getExtent())&&!ol.extent.containsCoordinate(t,n)||(e=ol.proj.getPointResolution(e,o,n)/o,isFinite(e)&&0<e&&(o/=e));return o};ol.reproj.enlargeClipPoint_=function(e,t,o,r){e=o-e;t=r-t;var n=Math.sqrt(e*e+t*t);return[Math.round(o+e/n),Math.round(r+t/n)]};ol.reproj.render=function(e,t,o,r,n,i,a,s,l,c,u){var h=ol.dom.createCanvasContext2D(Math.round(o*e),Math.round(o*t));if(0===l.length)return h.canvas;h.scale(o,o);var d=ol.extent.createEmpty();l.forEach(function(e,t,o){ol.extent.extend(d,e.extent)});e=ol.extent.getWidth(d);t=ol.extent.getHeight(d);var p=ol.dom.createCanvasContext2D(Math.round(o*e/r),Math.round(o*t/r)),f=o/r;l.forEach(function(e,t,o){t=e.extent[0]-d[0];o=-(e.extent[3]-d[3]);var r=ol.extent.getWidth(e.extent),n=ol.extent.getHeight(e.extent);p.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,t*f,o*f,r*f,n*f)});var g=ol.extent.getTopLeft(a);s.getTriangles().forEach(function(e,t,n){var a=e.source,s=e.target,l=a[1][0],c=a[1][1],u=a[2][0],f=a[2][1];e=(s[0][0]-g[0])/i;t=-(s[0][1]-g[1])/i;var m=(s[1][0]-g[0])/i,y=-(s[1][1]-g[1])/i;n=(s[2][0]-g[0])/i;var C=-(s[2][1]-g[1])/i;s=a[0][0];a=a[0][1];l-=s;c-=a;u-=s;f-=a;(l=ol.math.solveLinearSystem([[l,c,0,0,m-e],[u,f,0,0,n-e],[0,0,l,c,y-t],[0,0,u,f,C-t]]))&&(h.save(),h.beginPath(),u=(e+m+n)/3,f=(t+y+C)/3,c=ol.reproj.enlargeClipPoint_(u,f,e,t),m=ol.reproj.enlargeClipPoint_(u,f,m,y),n=ol.reproj.enlargeClipPoint_(u,f,n,C),h.moveTo(m[0],m[1]),h.lineTo(c[0],c[1]),h.lineTo(n[0],n[1]),h.clip(),h.transform(l[0],l[2],l[1],l[3],e,t),h.translate(d[0]-s,d[3]-a),h.scale(r/o,-r/o),h.drawImage(p.canvas,0,0),h.restore())});u&&(h.save(),h.strokeStyle="black",h.lineWidth=1,s.getTriangles().forEach(function(e,t,o){var r=e.target;e=(r[0][0]-g[0])/i;t=-(r[0][1]-g[1])/i;o=(r[1][0]-g[0])/i;var n=-(r[1][1]-g[1])/i,a=(r[2][0]-g[0])/i;r=-(r[2][1]-g[1])/i;h.beginPath();h.moveTo(o,n);h.lineTo(e,t);h.lineTo(a,r);h.closePath();h.stroke()}),h.restore());return h.canvas};ol.reproj.Triangulation=function(e,t,o,r,n){this.sourceProj_=e;this.targetProj_=t;var i={},a=ol.proj.getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){var t=e[0]+"/"+e[1];i[t]||(i[t]=a(e));return i[t]};this.maxSourceExtent_=r;this.errorThresholdSquared_=n*n;this.triangles_=[];this.wrapsXInSource_=!1;this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ol.extent.getWidth(r)==ol.extent.getWidth(this.sourceProj_.getExtent());this.sourceWorldWidth_=this.sourceProj_.getExtent()?ol.extent.getWidth(this.sourceProj_.getExtent()):null;this.targetWorldWidth_=this.targetProj_.getExtent()?ol.extent.getWidth(this.targetProj_.getExtent()):null;e=ol.extent.getTopLeft(o);t=ol.extent.getTopRight(o);r=ol.extent.getBottomRight(o);o=ol.extent.getBottomLeft(o);n=this.transformInv_(e);var s=this.transformInv_(t),l=this.transformInv_(r),c=this.transformInv_(o);this.addQuad_(e,t,r,o,n,s,l,c,ol.RASTER_REPROJECTION_MAX_SUBDIVISION);if(this.wrapsXInSource_){var u=1/0;this.triangles_.forEach(function(e,t,o){u=Math.min(u,e.source[0][0],e.source[1][0],e.source[2][0])});this.triangles_.forEach(function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-u>this.sourceWorldWidth_/2){var t=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];t[0][0]-u>this.sourceWorldWidth_/2&&(t[0][0]-=this.sourceWorldWidth_);t[1][0]-u>this.sourceWorldWidth_/2&&(t[1][0]-=this.sourceWorldWidth_);t[2][0]-u>this.sourceWorldWidth_/2&&(t[2][0]-=this.sourceWorldWidth_);Math.max(t[0][0],t[1][0],t[2][0])-Math.min(t[0][0],t[1][0],t[2][0])<this.sourceWorldWidth_/2&&(e.source=t)}},this)}i={}};ol.reproj.Triangulation.prototype.addTriangle_=function(e,t,o,r,n,i){this.triangles_.push({source:[r,n,i],target:[e,t,o]})};ol.reproj.Triangulation.prototype.addQuad_=function(e,t,o,r,n,i,a,s,l){var c=ol.extent.boundingExtent([n,i,a,s]),u=this.sourceWorldWidth_?ol.extent.getWidth(c)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&.5<u&&1>u,p=!1;if(0<l){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var f=ol.extent.boundingExtent([e,t,o,r]);p|=(f=ol.extent.getWidth(f)/this.targetWorldWidth_)>ol.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH}!d&&this.sourceProj_.isGlobal()&&u&&(p|=u>ol.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH)}if(p||!this.maxSourceExtent_||ol.extent.intersects(c,this.maxSourceExtent_)){if(!(p||isFinite(n[0])&&isFinite(n[1])&&isFinite(i[0])&&isFinite(i[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1]))){if(!(0<l))return;p=!0}if(0<l&&(p||(c=this.transformInv_([(e[0]+o[0])/2,(e[1]+o[1])/2]),p=(h=d?(ol.math.modulo(n[0],h)+ol.math.modulo(a[0],h))/2-ol.math.modulo(c[0],h):(n[0]+a[0])/2-c[0])*h+(c=(n[1]+a[1])/2-c[1])*c>this.errorThresholdSquared_),p)){Math.abs(e[0]-o[0])<=Math.abs(e[1]-o[1])?(d=[(t[0]+o[0])/2,(t[1]+o[1])/2],h=this.transformInv_(d),c=[(r[0]+e[0])/2,(r[1]+e[1])/2],u=this.transformInv_(c),this.addQuad_(e,t,d,c,n,i,h,u,l-1),this.addQuad_(c,d,o,r,u,h,a,s,l-1)):(d=[(e[0]+t[0])/2,(e[1]+t[1])/2],h=this.transformInv_(d),c=[(o[0]+r[0])/2,(o[1]+r[1])/2],u=this.transformInv_(c),this.addQuad_(e,d,c,r,n,h,u,s,l-1),this.addQuad_(d,t,o,c,h,i,a,u,l-1));return}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(e,o,r,n,a,s);this.addTriangle_(e,t,o,n,i,a)}};ol.reproj.Triangulation.prototype.calculateSourceExtent=function(){var e=ol.extent.createEmpty();this.triangles_.forEach(function(t,o,r){t=t.source;ol.extent.extendCoordinate(e,t[0]);ol.extent.extendCoordinate(e,t[1]);ol.extent.extendCoordinate(e,t[2])});return e};ol.reproj.Triangulation.prototype.getTriangles=function(){return this.triangles_};ol.reproj.Tile=function(e,t,o,r,n,i,a,s,l,c,u){ol.Tile.call(this,n,ol.TileState.IDLE);this.renderEdges_=void 0!==u&&u;this.pixelRatio_=a;this.gutter_=s;this.canvas_=null;this.sourceTileGrid_=t;this.targetTileGrid_=r;this.wrappedTileCoord_=i||n;this.sourceTiles_=[];this.sourcesListenerKeys_=null;this.sourceZ_=0;i=r.getTileCoordExtent(this.wrappedTileCoord_);s=this.targetTileGrid_.getExtent();n=this.sourceTileGrid_.getExtent();i=s?ol.extent.getIntersection(i,s):i;if(0===ol.extent.getArea(i))this.state=ol.TileState.EMPTY;else if((s=e.getExtent())&&(n=n?ol.extent.getIntersection(n,s):s),r=r.getResolution(this.wrappedTileCoord_[0]),s=ol.extent.getCenter(i),r=ol.reproj.calculateSourceResolution(e,o,s,r),!isFinite(r)||0>=r)this.state=ol.TileState.EMPTY;else if(this.triangulation_=new ol.reproj.Triangulation(e,o,i,n,r*(void 0!==c?c:ol.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD)),0===this.triangulation_.getTriangles().length)this.state=ol.TileState.EMPTY;else if(this.sourceZ_=t.getZForResolution(r),o=this.triangulation_.calculateSourceExtent(),n&&(e.canWrapX()?(o[1]=ol.math.clamp(o[1],n[1],n[3]),o[3]=ol.math.clamp(o[3],n[1],n[3])):o=ol.extent.getIntersection(o,n)),ol.extent.getArea(o)){for(t=(e=t.getTileRangeForExtentAndZ(o,this.sourceZ_)).minX;t<=e.maxX;t++)for(o=e.minY;o<=e.maxY;o++)(c=l(this.sourceZ_,t,o,a))&&this.sourceTiles_.push(c);0===this.sourceTiles_.length&&(this.state=ol.TileState.EMPTY)}else this.state=ol.TileState.EMPTY};ol.inherits(ol.reproj.Tile,ol.Tile);ol.reproj.Tile.prototype.disposeInternal=function(){this.state==ol.TileState.LOADING&&this.unlistenSources_();ol.Tile.prototype.disposeInternal.call(this)};ol.reproj.Tile.prototype.getImage=function(){return this.canvas_};ol.reproj.Tile.prototype.reproject_=function(){var e=[];this.sourceTiles_.forEach(function(t,o,r){t&&t.getState()==ol.TileState.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})},this);this.sourceTiles_.length=0;if(0===e.length)this.state=ol.TileState.ERROR;else{var t=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(t),r="number"==typeof o?o:o[0];o="number"==typeof o?o:o[1];t=this.targetTileGrid_.getResolution(t);var n=this.sourceTileGrid_.getResolution(this.sourceZ_),i=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ol.reproj.render(r,o,this.pixelRatio_,n,this.sourceTileGrid_.getExtent(),t,i,this.triangulation_,e,this.gutter_,this.renderEdges_);this.state=ol.TileState.LOADED}this.changed()};ol.reproj.Tile.prototype.load=function(){if(this.state==ol.TileState.IDLE){this.state=ol.TileState.LOADING;this.changed();var e=0;this.sourcesListenerKeys_=[];this.sourceTiles_.forEach(function(t,o,r){if((o=t.getState())==ol.TileState.IDLE||o==ol.TileState.LOADING){e++;var n=ol.events.listen(t,ol.events.EventType.CHANGE,function(o){(o=t.getState())!=ol.TileState.LOADED&&o!=ol.TileState.ERROR&&o!=ol.TileState.EMPTY||(ol.events.unlistenByKey(n),0===--e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}},this);this.sourceTiles_.forEach(function(e,t,o){e.getState()==ol.TileState.IDLE&&e.load()});0===e&&setTimeout(this.reproject_.bind(this),0)}};ol.reproj.Tile.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(ol.events.unlistenByKey);this.sourcesListenerKeys_=null};ol.source.Tile=function(e){ol.source.Source.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,state:e.state,wrapX:e.wrapX});this.opaque_=void 0!==e.opaque&&e.opaque;this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1;this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;this.tileCache=new ol.TileCache(e.cacheSize);this.tmpSize=[0,0];this.key_="";this.tileOptions={transition:e.transition}};ol.inherits(ol.source.Tile,ol.source.Source);ol.source.Tile.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()};ol.source.Tile.prototype.expireCache=function(e,t){(e=this.getTileCacheForProjection(e))&&e.expireCache(t)};ol.source.Tile.prototype.forEachLoadedTile=function(e,t,o,r){if(!(e=this.getTileCacheForProjection(e)))return!1;for(var n,i,a=!0,s=o.minX;s<=o.maxX;++s)for(var l=o.minY;l<=o.maxY;++l)n=ol.tilecoord.getKeyZXY(t,s,l),i=!1,e.containsKey(n)&&((i=(n=e.get(n)).getState()===ol.TileState.LOADED)&&(i=!1!==r(n))),i||(a=!1);return a};ol.source.Tile.prototype.getGutter=function(e){return 0};ol.source.Tile.prototype.getKey=function(){return this.key_};ol.source.Tile.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())};ol.source.Tile.prototype.getOpaque=function(e){return this.opaque_};ol.source.Tile.prototype.getResolutions=function(){return this.tileGrid.getResolutions()};ol.source.Tile.prototype.getTile=function(e,t,o,r,n){};ol.source.Tile.prototype.getTileGrid=function(){return this.tileGrid};ol.source.Tile.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:ol.tilegrid.getForProjection(e)};ol.source.Tile.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();return t&&!ol.proj.equivalent(t,e)?null:this.tileCache};ol.source.Tile.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_};ol.source.Tile.prototype.getTilePixelSize=function(e,t,o){o=this.getTileGridForProjection(o);t=this.getTilePixelRatio(t);e=ol.size.toSize(o.getTileSize(e),this.tmpSize);return 1==t?e:ol.size.scale(e,t,this.tmpSize)};ol.source.Tile.prototype.getTileCoordForTileUrlFunction=function(e,t){t=void 0!==t?t:this.getProjection();var o=this.getTileGridForProjection(t);this.getWrapX()&&t.isGlobal()&&(e=ol.tilegrid.wrapX(o,e,t));return ol.tilecoord.withinExtentAndZ(e,o)?e:null};ol.source.Tile.prototype.refresh=function(){this.tileCache.clear();this.changed()};ol.source.Tile.prototype.useTile=ol.nullFunction;ol.source.Tile.Event=function(e,t){ol.events.Event.call(this,e);this.tile=t};ol.inherits(ol.source.Tile.Event,ol.events.Event);ol.source.TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};ol.source.UrlTile=function(e){ol.source.Tile.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,logo:e.logo,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition});this.tileLoadFunction=e.tileLoadFunction;this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.nullTileUrlFunction;this.urls=null;e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url);e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction);this.tileLoadingKeys_={}};ol.inherits(ol.source.UrlTile,ol.source.Tile);ol.source.UrlTile.prototype.getTileLoadFunction=function(){return this.tileLoadFunction};ol.source.UrlTile.prototype.getTileUrlFunction=function(){return this.tileUrlFunction};ol.source.UrlTile.prototype.getUrls=function(){return this.urls};ol.source.UrlTile.prototype.handleTileChange=function(e){e=e.target;var t=ol.getUid(e),o=e.getState();if(o==ol.TileState.LOADING){this.tileLoadingKeys_[t]=!0;var r=ol.source.TileEventType.TILELOADSTART}else t in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[t],r=o==ol.TileState.ERROR?ol.source.TileEventType.TILELOADERROR:o==ol.TileState.LOADED||o==ol.TileState.ABORT?ol.source.TileEventType.TILELOADEND:void 0);void 0!=r&&this.dispatchEvent(new ol.source.Tile.Event(r,e))};ol.source.UrlTile.prototype.setTileLoadFunction=function(e){this.tileCache.clear();this.tileLoadFunction=e;this.changed()};ol.source.UrlTile.prototype.setTileUrlFunction=function(e,t){this.tileUrlFunction=e;this.tileCache.pruneExceptNewestZ();void 0!==t?this.setKey(t):this.changed()};ol.source.UrlTile.prototype.setUrl=function(e){var t=this.urls=ol.TileUrlFunction.expandUrl(e);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTemplates(t,this.tileGrid),e)};ol.source.UrlTile.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTemplates(e,this.tileGrid),t)};ol.source.UrlTile.prototype.useTile=function(e,t,o){e=ol.tilecoord.getKeyZXY(e,t,o);this.tileCache.containsKey(e)&&this.tileCache.get(e)};ol.source.TileImage=function(e){ol.source.UrlTile.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,logo:e.logo,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ol.source.TileImage.defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition});this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null;this.tileClass=void 0!==e.tileClass?e.tileClass:ol.ImageTile;this.tileCacheForProjection={};this.tileGridForProjection={};this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold;this.renderReprojectionEdges_=!1};ol.inherits(ol.source.TileImage,ol.source.UrlTile);ol.source.TileImage.prototype.canExpireCache=function(){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1};ol.source.TileImage.prototype.expireCache=function(e,t){if(ol.ENABLE_RASTER_REPROJECTION){e=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==e?t:{});for(var o in this.tileCacheForProjection){var r=this.tileCacheForProjection[o];r.expireCache(r==e?t:{})}}else ol.source.UrlTile.prototype.expireCache.call(this,e,t)};ol.source.TileImage.prototype.getGutter=function(e){return ol.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!ol.proj.equivalent(this.getProjection(),e)?0:this.getGutterInternal()};ol.source.TileImage.prototype.getGutterInternal=function(){return 0};ol.source.TileImage.prototype.getOpaque=function(e){return!(ol.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!ol.proj.equivalent(this.getProjection(),e))&&ol.source.UrlTile.prototype.getOpaque.call(this,e)};ol.source.TileImage.prototype.getTileGridForProjection=function(e){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.getTileGridForProjection.call(this,e);var t=this.getProjection();return!this.tileGrid||t&&!ol.proj.equivalent(t,e)?((t=ol.getUid(e).toString())in this.tileGridForProjection||(this.tileGridForProjection[t]=ol.tilegrid.getForProjection(e)),this.tileGridForProjection[t]):this.tileGrid};ol.source.TileImage.prototype.getTileCacheForProjection=function(e){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.getTileCacheForProjection.call(this,e);var t=this.getProjection();if(!t||ol.proj.equivalent(t,e))return this.tileCache;(e=ol.getUid(e).toString())in this.tileCacheForProjection||(this.tileCacheForProjection[e]=new ol.TileCache(this.tileCache.highWaterMark));return this.tileCacheForProjection[e]};ol.source.TileImage.prototype.createTile_=function(e,t,o,r,n,i){e=[e,t,o];r=(t=this.getTileCoordForTileUrlFunction(e,n))?this.tileUrlFunction(t,r,n):void 0;(r=new this.tileClass(e,void 0!==r?ol.TileState.IDLE:ol.TileState.EMPTY,void 0!==r?r:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions)).key=i;ol.events.listen(r,ol.events.EventType.CHANGE,this.handleTileChange,this);return r};ol.source.TileImage.prototype.getTile=function(e,t,o,r,n){var i=this.getProjection();if(ol.ENABLE_RASTER_REPROJECTION&&i&&n&&!ol.proj.equivalent(i,n)){var a,s=this.getTileCacheForProjection(n);o=[e,t,o];e=ol.tilecoord.getKey(o);s.containsKey(e)&&(a=s.get(e));t=this.getKey();if(a&&a.key==t)return a;var l=this.getTileGridForProjection(i),c=this.getTileGridForProjection(n),u=this.getTileCoordForTileUrlFunction(o,n);(r=new ol.reproj.Tile(i,l,n,c,o,u,this.getTilePixelRatio(r),this.getGutterInternal(),function(e,t,o,r){return this.getTileInternal(e,t,o,r,i)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_)).key=t;a?(r.interimTile=a,r.refreshInterimChain(),s.replace(e,r)):s.set(e,r);return r}return this.getTileInternal(e,t,o,r,i||n)};ol.source.TileImage.prototype.getTileInternal=function(e,t,o,r,n){var i=ol.tilecoord.getKeyZXY(e,t,o),a=this.getKey();if(this.tileCache.containsKey(i)){var s=this.tileCache.get(i);if(s.key!=a){var l=s;s=this.createTile_(e,t,o,r,n,a);l.getState()==ol.TileState.IDLE?s.interimTile=l.interimTile:s.interimTile=l;s.refreshInterimChain();this.tileCache.replace(i,s)}}else s=this.createTile_(e,t,o,r,n,a),this.tileCache.set(i,s);return s};ol.source.TileImage.prototype.setRenderReprojectionEdges=function(e){if(ol.ENABLE_RASTER_REPROJECTION&&this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(var t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}};ol.source.TileImage.prototype.setTileGridForProjection=function(e,t){ol.ENABLE_RASTER_REPROJECTION&&(e=ol.proj.get(e))&&((e=ol.getUid(e).toString())in this.tileGridForProjection||(this.tileGridForProjection[e]=t))};ol.source.TileImage.defaultTileLoadFunction=function(e,t){e.getImage().src=t};ol.source.BingMaps=function(e){this.hidpi_=void 0!==e.hidpi&&e.hidpi;ol.source.TileImage.call(this,{cacheSize:e.cacheSize,crossOrigin:"anonymous",opaque:!0,projection:ol.proj.get("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:ol.source.State.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:this.hidpi_?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.culture_=void 0!==e.culture?e.culture:"en-us";this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1;this.apiKey_=e.key;this.imagerySet_=e.imagerySet;ol.net.jsonp("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_,this.handleImageryMetadataResponse.bind(this),void 0,"jsonp")};ol.inherits(ol.source.BingMaps,ol.source.TileImage);ol.source.BingMaps.TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>';ol.source.BingMaps.prototype.getApiKey=function(){return this.apiKey_};ol.source.BingMaps.prototype.getImagerySet=function(){return this.imagerySet_};ol.source.BingMaps.prototype.handleImageryMetadataResponse=function(e){if(200!=e.statusCode||"OK"!=e.statusDescription||"ValidCredentials"!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)this.setState(ol.source.State.ERROR);else{var t=e.brandLogoUri;-1==t.indexOf("https")&&(t=t.replace("http","https"));var o=e.resourceSets[0].resources[0];e=-1==this.maxZoom_?o.zoomMax:this.maxZoom_;var r=this.getProjection();r=ol.tilegrid.extentFromProjection(r);this.tileGrid=ol.tilegrid.createXYZ({extent:r,minZoom:o.zoomMin,maxZoom:e,tileSize:(o.imageWidth==o.imageHeight?o.imageWidth:[o.imageWidth,o.imageHeight])/(this.hidpi_?2:1)});var n=this.culture_,i=this.hidpi_;this.tileUrlFunction=ol.TileUrlFunction.createFromTileUrlFunctions(o.imageUrlSubdomains.map(function(e){var t=[0,0,0],r=o.imageUrl.replace("{subdomain}",e).replace("{culture}",n);return function(e,o,n){if(e)return ol.tilecoord.createOrUpdate(e[0],e[1],-e[2]-1,t),e=r,i&&(e+="&dpi=d1&device=mobile"),e.replace("{quadkey}",ol.tilecoord.quadKey(t))}}));if(o.imageryProviders){var a=ol.proj.getTransformFromProjections(ol.proj.get("EPSG:4326"),this.getProjection());this.setAttributions(function(e){var t=[],r=e.viewState.zoom;o.imageryProviders.map(function(o){for(var n=!1,i=o.coverageAreas,s=0,l=i.length;s<l;++s){var c=i[s];if(r>=c.zoomMin&&r<=c.zoomMax&&(c=c.bbox,c=ol.extent.applyTransform([c[1],c[0],c[3],c[2]],a),ol.extent.intersects(c,e.extent))){n=!0;break}}n&&t.push(o.attribution)});t.push(ol.source.BingMaps.TOS_ATTRIBUTION);return t})}this.setLogo(t);this.setState(ol.source.State.READY)}};ol.source.XYZ=function(e){var t=void 0!==(e=e||{}).projection?e.projection:"EPSG:3857",o=void 0!==e.tileGrid?e.tileGrid:ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(t),maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:o,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition})};ol.inherits(ol.source.XYZ,ol.source.TileImage);ol.source.CartoDB=function(e){this.account_=e.account;this.mapId_=e.map||"";this.config_=e.config||{};this.templateCache_={};ol.source.XYZ.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,maxZoom:void 0!==e.maxZoom?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,state:ol.source.State.LOADING,wrapX:e.wrapX});this.initializeMap_()};ol.inherits(ol.source.CartoDB,ol.source.XYZ);ol.source.CartoDB.prototype.getConfig=function(){return this.config_};ol.source.CartoDB.prototype.updateConfig=function(e){ol.obj.assign(this.config_,e);this.initializeMap_()};ol.source.CartoDB.prototype.setConfig=function(e){this.config_=e||{};this.initializeMap_()};ol.source.CartoDB.prototype.initializeMap_=function(){var e=JSON.stringify(this.config_);if(this.templateCache_[e])this.applyTemplate_(this.templateCache_[e]);else{var t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);var o=new XMLHttpRequest;o.addEventListener("load",this.handleInitResponse_.bind(this,e));o.addEventListener("error",this.handleInitError_.bind(this));o.open("POST",t);o.setRequestHeader("Content-type","application/json");o.send(JSON.stringify(this.config_))}};ol.source.CartoDB.prototype.handleInitResponse_=function(e,t){if(!(t=t.target).status||200<=t.status&&300>t.status){try{var o=JSON.parse(t.responseText)}catch(e){this.setState(ol.source.State.ERROR);return}this.applyTemplate_(o);this.templateCache_[e]=o;this.setState(ol.source.State.READY)}else this.setState(ol.source.State.ERROR)};ol.source.CartoDB.prototype.handleInitError_=function(e){this.setState(ol.source.State.ERROR)};ol.source.CartoDB.prototype.applyTemplate_=function(e){this.setUrl("https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png")};ol.source.Cluster=function(e){ol.source.Vector.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,wrapX:e.wrapX});this.resolution=void 0;this.distance=void 0!==e.distance?e.distance:20;this.features=[];this.geometryFunction=e.geometryFunction||function(e){e=e.getGeometry();ol.asserts.assert(e instanceof ol.geom.Point,10);return e};this.source=e.source;this.source.on(ol.events.EventType.CHANGE,ol.source.Cluster.prototype.refresh,this)};ol.inherits(ol.source.Cluster,ol.source.Vector);ol.source.Cluster.prototype.getDistance=function(){return this.distance};ol.source.Cluster.prototype.getSource=function(){return this.source};ol.source.Cluster.prototype.loadFeatures=function(e,t,o){this.source.loadFeatures(e,t,o);t!==this.resolution&&(this.clear(),this.resolution=t,this.cluster(),this.addFeatures(this.features))};ol.source.Cluster.prototype.setDistance=function(e){this.distance=e;this.refresh()};ol.source.Cluster.prototype.refresh=function(){this.clear();this.cluster();this.addFeatures(this.features);ol.source.Vector.prototype.refresh.call(this)};ol.source.Cluster.prototype.cluster=function(){if(void 0!==this.resolution){this.features.length=0;for(var e=ol.extent.createEmpty(),t=this.distance*this.resolution,o=this.source.getFeatures(),r={},n=0,i=o.length;n<i;n++){var a=o[n];ol.getUid(a).toString()in r||!(a=this.geometryFunction(a))||(a=a.getCoordinates(),ol.extent.createOrUpdateFromCoordinate(a,e),ol.extent.buffer(e,t,e),a=(a=this.source.getFeaturesInExtent(e)).filter(function(e){return!((e=ol.getUid(e).toString())in r)&&(r[e]=!0)}),this.features.push(this.createCluster(a)))}}};ol.source.Cluster.prototype.createCluster=function(e){for(var t=[0,0],o=e.length-1;0<=o;--o){var r=this.geometryFunction(e[o]);r?ol.coordinate.add(t,r.getCoordinates()):e.splice(o,1)}ol.coordinate.scale(t,1/e.length);(t=new ol.Feature(new ol.geom.Point(t))).set("features",e);return t};ol.reproj.Image=function(e,t,o,r,n,i){this.targetProj_=t;this.maxSourceExtent_=e.getExtent();var a=t.getExtent();a=a?ol.extent.getIntersection(o,a):o;var s=ol.extent.getCenter(a);s=ol.reproj.calculateSourceResolution(e,t,s,r);this.triangulation_=new ol.reproj.Triangulation(e,t,a,this.maxSourceExtent_,s*ol.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD);this.targetResolution_=r;this.targetExtent_=o;e=this.triangulation_.calculateSourceExtent();this.sourcePixelRatio_=(this.sourceImage_=i(e,s,n))?this.sourceImage_.getPixelRatio():1;this.sourceListenerKey_=this.canvas_=null;n=ol.ImageState.LOADED;this.sourceImage_&&(n=ol.ImageState.IDLE);ol.ImageBase.call(this,o,r,this.sourcePixelRatio_,n)};ol.inherits(ol.reproj.Image,ol.ImageBase);ol.reproj.Image.prototype.disposeInternal=function(){this.state==ol.ImageState.LOADING&&this.unlistenSource_();ol.ImageBase.prototype.disposeInternal.call(this)};ol.reproj.Image.prototype.getImage=function(){return this.canvas_};ol.reproj.Image.prototype.getProjection=function(){return this.targetProj_};ol.reproj.Image.prototype.reproject_=function(){var e=this.sourceImage_.getState();if(e==ol.ImageState.LOADED){var t=ol.extent.getWidth(this.targetExtent_)/this.targetResolution_,o=ol.extent.getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=ol.reproj.render(t,o,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=e;this.changed()};ol.reproj.Image.prototype.load=function(){if(this.state==ol.ImageState.IDLE){this.state=ol.ImageState.LOADING;this.changed();var e=this.sourceImage_.getState();e==ol.ImageState.LOADED||e==ol.ImageState.ERROR?this.reproject_():(this.sourceListenerKey_=ol.events.listen(this.sourceImage_,ol.events.EventType.CHANGE,function(e){(e=this.sourceImage_.getState())!=ol.ImageState.LOADED&&e!=ol.ImageState.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}};ol.reproj.Image.prototype.unlistenSource_=function(){ol.events.unlistenByKey(this.sourceListenerKey_);this.sourceListenerKey_=null};ol.source.Image=function(e){ol.source.Source.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,state:e.state});this.resolutions_=void 0!==e.resolutions?e.resolutions:null;this.reprojectedImage_=null;this.reprojectedRevision_=0};ol.inherits(ol.source.Image,ol.source.Source);ol.source.Image.prototype.getResolutions=function(){return this.resolutions_};ol.source.Image.prototype.findNearestResolution=function(e){this.resolutions_&&(e=ol.array.linearFindNearest(this.resolutions_,e,0),e=this.resolutions_[e]);return e};ol.source.Image.prototype.getImage=function(e,t,o,r){var n=this.getProjection();if(ol.ENABLE_RASTER_REPROJECTION&&n&&r&&!ol.proj.equivalent(n,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ol.proj.equivalent(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&ol.extent.equals(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose();this.reprojectedImage_=null}this.reprojectedImage_=new ol.reproj.Image(n,r,e,t,o,function(e,t,o){return this.getImageInternal(e,t,o,n)}.bind(this));this.reprojectedRevision_=this.getRevision();return this.reprojectedImage_}n&&(r=n);return this.getImageInternal(e,t,o,r)};ol.source.Image.prototype.getImageInternal=function(e,t,o,r){};ol.source.Image.prototype.handleImageChange=function(e){switch((e=e.target).getState()){case ol.ImageState.LOADING:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADSTART,e));break;case ol.ImageState.LOADED:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADEND,e));break;case ol.ImageState.ERROR:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADERROR,e))}};ol.source.Image.defaultImageLoadFunction=function(e,t){e.getImage().src=t};ol.source.Image.Event=function(e,t){ol.events.Event.call(this,e);this.image=t};ol.inherits(ol.source.Image.Event,ol.events.Event);ol.source.Image.EventType_={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};ol.uri={};ol.uri.appendParams=function(e,t){var o=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&o.push(e+"="+encodeURIComponent(t[e]))});var r=o.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+r};ol.source.ImageArcGISRest=function(e){e=e||{};ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.hidpi_=void 0===e.hidpi||e.hidpi;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.params_=e.params||{};this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5};ol.inherits(ol.source.ImageArcGISRest,ol.source.Image);ol.source.ImageArcGISRest.prototype.getParams=function(){return this.params_};ol.source.ImageArcGISRest.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t);o=this.hidpi_?o:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==t&&n.getPixelRatio()==o&&ol.extent.containsExtent(n.getExtent(),e))return n;n={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};ol.obj.assign(n,this.params_);var i=((e=e.slice())[0]+e[2])/2,a=(e[1]+e[3])/2;if(1!=this.ratio_){var s=this.ratio_*ol.extent.getWidth(e)/2,l=this.ratio_*ol.extent.getHeight(e)/2;e[0]=i-s;e[1]=a-l;e[2]=i+s;e[3]=a+l}s=t/o;l=Math.ceil(ol.extent.getWidth(e)/s);var c=Math.ceil(ol.extent.getHeight(e)/s);e[0]=i-s*l/2;e[2]=i+s*l/2;e[1]=a-s*c/2;e[3]=a+s*c/2;this.imageSize_[0]=l;this.imageSize_[1]=c;r=this.getRequestUrl_(e,this.imageSize_,o,r,n);this.image_=new ol.Image(e,t,o,r,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this);return this.image_};ol.source.ImageArcGISRest.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageArcGISRest.prototype.getRequestUrl_=function(e,t,o,r,n){r=r.getCode().split(":").pop();n.SIZE=t[0]+","+t[1];n.BBOX=e.join(",");n.BBOXSR=r;n.IMAGESR=r;n.DPI=Math.round(90*o);(t=(e=this.url_).replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"))==e&&ol.asserts.assert(!1,50);return ol.uri.appendParams(t,n)};ol.source.ImageArcGISRest.prototype.getUrl=function(){return this.url_};ol.source.ImageArcGISRest.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};ol.source.ImageArcGISRest.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())};ol.source.ImageArcGISRest.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.image_=null;this.changed()};ol.source.ImageCanvas=function(e){ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:e.projection,resolutions:e.resolutions,state:e.state});this.canvasFunction_=e.canvasFunction;this.canvas_=null;this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5};ol.inherits(ol.source.ImageCanvas,ol.source.Image);ol.source.ImageCanvas.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);var n=this.canvas_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==t&&n.getPixelRatio()==o&&ol.extent.containsExtent(n.getExtent(),e))return n;e=e.slice();ol.extent.scaleFromCenter(e,this.ratio_);var i=ol.extent.getWidth(e)/t,a=ol.extent.getHeight(e)/t;(r=this.canvasFunction_(e,t,o,[i*o,a*o],r))&&(n=new ol.ImageCanvas(e,t,o,r));this.canvas_=n;this.renderedRevision_=this.getRevision();return n};ol.source.ImageMapGuide=function(e){ol.source.Image.call(this,{projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.displayDpi_=void 0!==e.displayDpi?e.displayDpi:96;this.params_=e.params||{};this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.hidpi_=void 0===e.hidpi||e.hidpi;this.metersPerUnit_=void 0!==e.metersPerUnit?e.metersPerUnit:1;this.ratio_=void 0!==e.ratio?e.ratio:1;this.useOverlay_=void 0!==e.useOverlay&&e.useOverlay;this.image_=null;this.renderedRevision_=0};ol.inherits(ol.source.ImageMapGuide,ol.source.Image);ol.source.ImageMapGuide.prototype.getParams=function(){return this.params_};ol.source.ImageMapGuide.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);o=this.hidpi_?o:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==t&&n.getPixelRatio()==o&&ol.extent.containsExtent(n.getExtent(),e))return n;1!=this.ratio_&&(e=e.slice(),ol.extent.scaleFromCenter(e,this.ratio_));n=[(n=ol.extent.getWidth(e)/t)*o,ol.extent.getHeight(e)/t*o];void 0!==this.url_?(r=this.getUrl(this.url_,this.params_,e,n,r),n=new ol.Image(e,t,o,r,this.crossOrigin_,this.imageLoadFunction_),ol.events.listen(n,ol.events.EventType.CHANGE,this.handleImageChange,this)):n=null;this.image_=n;this.renderedRevision_=this.getRevision();return n};ol.source.ImageMapGuide.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageMapGuide.getScale=function(e,t,o,r){var n=ol.extent.getWidth(e);e=ol.extent.getHeight(e);var i=t[0];t=t[1];r=.0254/r;return t*n>i*e?n*o/(i*r):e*o/(t*r)};ol.source.ImageMapGuide.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.changed()};ol.source.ImageMapGuide.prototype.getUrl=function(e,t,o,r,n){n=ol.source.ImageMapGuide.getScale(o,r,this.metersPerUnit_,this.displayDpi_);o=ol.extent.getCenter(o);r={OPERATION:this.useOverlay_?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol.source.ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:n,SETVIEWCENTERX:o[0],SETVIEWCENTERY:o[1]};ol.obj.assign(r,t);return ol.uri.appendParams(e,r)};ol.source.ImageMapGuide.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};ol.source.ImageStatic=function(e){var t=e.imageExtent,o=void 0!==e.crossOrigin?e.crossOrigin:null,r=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:ol.proj.get(e.projection)});this.image_=new ol.Image(t,void 0,1,e.url,o,r);this.imageSize_=e.imageSize?e.imageSize:null;ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this)};ol.inherits(ol.source.ImageStatic,ol.source.Image);ol.source.ImageStatic.prototype.getImageInternal=function(e,t,o,r){return ol.extent.intersects(e,this.image_.getExtent())?this.image_:null};ol.source.ImageStatic.prototype.handleImageChange=function(e){if(this.image_.getState()==ol.ImageState.LOADED){var t=this.image_.getExtent(),o=this.image_.getImage();if(this.imageSize_)var r=this.imageSize_[0],n=this.imageSize_[1];else r=o.width,n=o.height;var i=ol.extent.getHeight(t)/n;(t=Math.ceil(ol.extent.getWidth(t)/i))!=r&&(i=(t=ol.dom.createCanvasContext2D(t,n)).canvas,t.drawImage(o,0,0,r,n,0,0,i.width,i.height),this.image_.setImage(i))}ol.source.Image.prototype.handleImageChange.call(this,e)};ol.source.ImageVector=function(e){this.source_=e.source;this.transform_=ol.transform.create();this.canvasContext_=ol.dom.createCanvasContext2D();this.canvasSize_=[0,0];this.declutterTree_=ol.ext.rbush(9);this.renderBuffer_=void 0==e.renderBuffer?100:e.renderBuffer;this.replayGroup_=null;ol.source.ImageCanvas.call(this,{attributions:e.attributions,canvasFunction:this.canvasFunctionInternal_.bind(this),logo:e.logo,projection:e.projection,ratio:e.ratio,resolutions:e.resolutions,state:this.source_.getState()});this.style_=null;this.styleFunction_=void 0;this.setStyle(e.style);ol.events.listen(this.source_,ol.events.EventType.CHANGE,this.handleSourceChange_,this)};ol.inherits(ol.source.ImageVector,ol.source.ImageCanvas);ol.source.ImageVector.prototype.canvasFunctionInternal_=function(e,t,o,r,n){var i=new ol.render.canvas.ReplayGroup(ol.renderer.vector.getTolerance(t,o),e,t,o,this.source_.getOverlaps(),this.declutterTree_,this.renderBuffer_);this.source_.loadFeatures(e,t,n);var a=!1;this.source_.forEachFeatureInExtent(e,function(e){a=a||this.renderFeature_(e,t,o,i)},this);i.finish();if(a)return null;this.canvasSize_[0]!=r[0]||this.canvasSize_[1]!=r[1]?(this.canvasContext_.canvas.width=r[0],this.canvasContext_.canvas.height=r[1],this.canvasSize_[0]=r[0],this.canvasSize_[1]=r[1]):this.canvasContext_.clearRect(0,0,r[0],r[1]);this.declutterTree_.clear();e=this.getTransform_(ol.extent.getCenter(e),t,o,r);i.replay(this.canvasContext_,e,0,{});this.replayGroup_=i;return this.canvasContext_.canvas};ol.source.ImageVector.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,i){if(this.replayGroup_){var a={};return this.replayGroup_.forEachFeatureAtCoordinate(e,t,0,r,n,function(e){var t=ol.getUid(e).toString();if(!(t in a))return a[t]=!0,i(e)},null)}};ol.source.ImageVector.prototype.getSource=function(){return this.source_};ol.source.ImageVector.prototype.getStyle=function(){return this.style_};ol.source.ImageVector.prototype.getStyleFunction=function(){return this.styleFunction_};ol.source.ImageVector.prototype.getTransform_=function(e,t,o,r){t=o/t;return ol.transform.compose(this.transform_,r[0]/2,r[1]/2,t,-t,0,-e[0],-e[1])};ol.source.ImageVector.prototype.handleImageChange_=function(e){this.changed()};ol.source.ImageVector.prototype.handleSourceChange_=function(){this.setState(this.source_.getState())};ol.source.ImageVector.prototype.renderFeature_=function(e,t,o,r){var n,i=e.getStyleFunction();i?n=i.call(e,t):this.styleFunction_&&(n=this.styleFunction_(e,t));if(!n)return!1;var a,s=!1;Array.isArray(n)||(n=[n]);i=0;for(a=n.length;i<a;++i)s=ol.renderer.vector.renderFeature(r,e,n[i],ol.renderer.vector.getSquaredTolerance(t,o),this.handleImageChange_,this)||s;return s};ol.source.ImageVector.prototype.setStyle=function(e){this.style_=void 0!==e?e:ol.style.Style.defaultFunction;this.styleFunction_=e?ol.style.Style.createFunction(this.style_):void 0;this.changed()};ol.source.WMSServerType={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"};ol.source.ImageWMS=function(e){e=e||{};ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.params_=e.params||{};this.v13_=!0;this.updateV13_();this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5};ol.inherits(ol.source.ImageWMS,ol.source.Image);ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_=[101,101];ol.source.ImageWMS.prototype.getGetFeatureInfoUrl=function(e,t,o,r){if(void 0!==this.url_){o=ol.proj.get(o);var n=this.getProjection();n&&n!==o&&(t=ol.reproj.calculateSourceResolution(n,o,e,t),e=ol.proj.transform(e,o,n));var i=ol.extent.getForViewAndSize(e,t,0,ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_),a={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};ol.obj.assign(a,this.params_,r);r=Math.floor((i[3]-e[1])/t);a[this.v13_?"I":"X"]=Math.floor((e[0]-i[0])/t);a[this.v13_?"J":"Y"]=r;return this.getRequestUrl_(i,ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_,1,n||o,a)}};ol.source.ImageWMS.prototype.getParams=function(){return this.params_};ol.source.ImageWMS.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t);1==o||this.hidpi_&&void 0!==this.serverType_||(o=1);var n=t/o,i=ol.extent.getCenter(e),a=Math.ceil(ol.extent.getWidth(e)/n),s=Math.ceil(ol.extent.getHeight(e)/n);a=ol.extent.getForViewAndSize(i,n,0,[a,s]);s=Math.ceil(this.ratio_*ol.extent.getWidth(e)/n);e=Math.ceil(this.ratio_*ol.extent.getHeight(e)/n);i=ol.extent.getForViewAndSize(i,n,0,[s,e]);if((e=this.image_)&&this.renderedRevision_==this.getRevision()&&e.getResolution()==t&&e.getPixelRatio()==o&&ol.extent.containsExtent(e.getExtent(),a))return e;a={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ol.obj.assign(a,this.params_);this.imageSize_[0]=Math.round(ol.extent.getWidth(i)/n);this.imageSize_[1]=Math.round(ol.extent.getHeight(i)/n);r=this.getRequestUrl_(i,this.imageSize_,o,r,a);this.image_=new ol.Image(i,t,o,r,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this);return this.image_};ol.source.ImageWMS.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageWMS.prototype.getRequestUrl_=function(e,t,o,r,n){ol.asserts.assert(void 0!==this.url_,9);n[this.v13_?"CRS":"SRS"]=r.getCode();"STYLES"in this.params_||(n.STYLES="");if(1!=o)switch(this.serverType_){case ol.source.WMSServerType.GEOSERVER:o=90*o+.5|0;n.FORMAT_OPTIONS="FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+";dpi:"+o:"dpi:"+o;break;case ol.source.WMSServerType.MAPSERVER:n.MAP_RESOLUTION=90*o;break;case ol.source.WMSServerType.CARMENTA_SERVER:case ol.source.WMSServerType.QGIS:n.DPI=90*o;break;default:ol.asserts.assert(!1,8)}n.WIDTH=t[0];n.HEIGHT=t[1];t=r.getAxisOrientation();e=this.v13_&&"ne"==t.substr(0,2)?[e[1],e[0],e[3],e[2]]:e;n.BBOX=e.join(",");return ol.uri.appendParams(this.url_,n)};ol.source.ImageWMS.prototype.getUrl=function(){return this.url_};ol.source.ImageWMS.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};ol.source.ImageWMS.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())};ol.source.ImageWMS.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.updateV13_();this.image_=null;this.changed()};ol.source.ImageWMS.prototype.updateV13_=function(){this.v13_=0<=ol.string.compareVersions(this.params_.VERSION||ol.DEFAULT_WMS_VERSION,"1.3")};ol.source.OSM=function(e){e=e||{};ol.source.XYZ.call(this,{attributions:void 0!==e.attributions?e.attributions:[ol.source.OSM.ATTRIBUTION],cacheSize:e.cacheSize,crossOrigin:void 0!==e.crossOrigin?e.crossOrigin:"anonymous",opaque:void 0===e.opaque||e.opaque,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:void 0!==e.url?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:e.wrapX})};ol.inherits(ol.source.OSM,ol.source.XYZ);ol.source.OSM.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.';ol.ext.pixelworks={};ol.ext.pixelworks.Processor=function(){};(function(){!function(e){function t(e){var t=!0;try{new ImageData(10,10)}catch(e){t=!1}return function(o){var r=o.buffers,n=o.meta,i=o.width,a=o.height,s=r.length,l=r[0].byteLength;if(o.imageOps){l=Array(s);for(o=0;o<s;++o){var c=o,u=new Uint8ClampedArray(r[o]),h=i,d=a;u=t?new ImageData(u,h,d):{data:u,width:h,height:d};l[c]=u}i=e(l,n).data}else{i=new Uint8ClampedArray(l);a=Array(s);c=Array(s);for(o=0;o<s;++o)a[o]=new Uint8ClampedArray(r[o]),c[o]=[0,0,0,0];for(r=0;r<l;r+=4){for(o=0;o<s;++o)u=a[o],c[o][0]=u[r],c[o][1]=u[r+1],c[o][2]=u[r+2],c[o][3]=u[r+3];o=e(c,n);i[r]=o[0];i[r+1]=o[1];i[r+2]=o[2];i[r+3]=o[3]}}return i.buffer}}function o(e,o){var r=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+t.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]);r=new Blob(r,{type:"text/javascript"});r=URL.createObjectURL(r);(r=new Worker(r)).addEventListener("message",o);return r}function r(e,o){var r=t(e.operation);return{postMessage:function(e){setTimeout(function(){o({data:{buffer:r(e),meta:e.meta}})},0)}}}function n(e){this._imageOps=!!e.imageOps;var t=0===e.threads?0:this._imageOps?1:e.threads||1,n=[];if(t)for(var i=0;i<t;++i)n[i]=o(e,this._onWorkerMessage.bind(this,i));else n[0]=r(e,this._onWorkerMessage.bind(this,0));this._workers=n;this._queue=[];this._maxQueueLength=e.queue||1/0;this._running=0;this._dataLookup={};this._job=null}var i=!0;try{new ImageData(10,10)}catch(e){i=!1}var a=document.createElement("canvas").getContext("2d"),s=function(e,t,o){if(i)return new ImageData(e,t,o);(t=a.createImageData(t,o)).data.set(e);return t};n.prototype.process=function(e,t,o){this._enqueue({inputs:e,meta:t,callback:o});this._dispatch()};n.prototype.destroy=function(){for(var e in this)this[e]=null;this._destroyed=!0};n.prototype._enqueue=function(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)};n.prototype._dispatch=function(){if(0===this._running&&0<this._queue.length){var e=this._job=this._queue.shift(),t=e.inputs[0].width,o=e.inputs[0].height,r=e.inputs.map(function(e){return e.data.buffer}),n=this._workers.length;this._running=n;if(1===n)this._workers[0].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:t,height:o},r);else for(var i=4*Math.ceil(e.inputs[0].data.length/4/n),a=0;a<n;++a){for(var s=a*i,l=[],c=0,u=r.length;c<u;++c)l.push(r[a].slice(s,s+i));this._workers[a].postMessage({buffers:l,meta:e.meta,imageOps:this._imageOps,width:t,height:o},l)}}};n.prototype._onWorkerMessage=function(e,t){this._destroyed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())};n.prototype._resolveJob=function(){var e=this._job,t=this._workers.length;if(1===t)var o=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{var n=e.inputs[0].data.length;o=new Uint8ClampedArray(n);r=Array(n);n=4*Math.ceil(n/4/t);for(var i=0;i<t;++i){var a=i*n;o.set(new Uint8ClampedArray(this._dataLookup[i].buffer),a);r[i]=this._dataLookup[i].meta}}this._job=null;this._dataLookup={};e.callback(null,s(o,e.inputs[0].width,e.inputs[0].height),r);this._dispatch()};e.default={Processor:n};e.Processor=n}(this.pixelworks=this.pixelworks||{})}).call(ol.ext);ol.source.RasterOperationType={PIXEL:"pixel",IMAGE:"image"};ol.source.Raster=function(e){this.worker_=null;this.operationType_=void 0!==e.operationType?e.operationType:ol.source.RasterOperationType.PIXEL;this.threads_=void 0!==e.threads?e.threads:1;this.renderers_=ol.source.Raster.createRenderers_(e.sources);for(var t=0,o=this.renderers_.length;t<o;++t)ol.events.listen(this.renderers_[t],ol.events.EventType.CHANGE,this.changed,this);this.tileQueue_=new ol.TileQueue(function(){return 1},this.changed.bind(this));t=ol.source.Raster.getLayerStatesArray_(this.renderers_);o={};for(var r=0,n=t.length;r<n;++r)o[ol.getUid(t[r].layer)]=t[r];this.renderedImageCanvas_=null;this.frameState_={animate:!1,coordinateToPixelTransform:ol.transform.create(),extent:null,focus:null,index:0,layerStates:o,layerStatesArray:t,logos:{},pixelRatio:1,pixelToCoordinateTransform:ol.transform.create(),postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}};ol.source.Image.call(this,{});void 0!==e.operation&&this.setOperation(e.operation,e.lib)};ol.inherits(ol.source.Raster,ol.source.Image);ol.source.Raster.prototype.setOperation=function(e,t){this.worker_=new ol.ext.pixelworks.Processor({operation:e,imageOps:this.operationType_===ol.source.RasterOperationType.IMAGE,queue:1,lib:t,threads:this.threads_});this.changed()};ol.source.Raster.prototype.updateFrameState_=function(e,t,o){var r=ol.obj.assign({},this.frameState_);r.viewState=ol.obj.assign({},r.viewState);var n=ol.extent.getCenter(e);r.extent=e.slice();r.focus=n;r.size[0]=Math.round(ol.extent.getWidth(e)/t);r.size[1]=Math.round(ol.extent.getHeight(e)/t);r.time=Date.now();r.animate=!1;(e=r.viewState).center=n;e.projection=o;e.resolution=t;return r};ol.source.Raster.prototype.allSourcesReady_=function(){for(var e=!0,t=0,o=this.renderers_.length;t<o;++t)if(this.renderers_[t].getLayer().getSource().getState()!==ol.source.State.READY){e=!1;break}return e};ol.source.Raster.prototype.getImage=function(e,t,o,r){if(!this.allSourcesReady_())return null;this.requestedFrameState_=o=this.updateFrameState_(e,t,r);if(this.renderedImageCanvas_){r=this.renderedImageCanvas_.getResolution();var n=this.renderedImageCanvas_.getExtent();t===r&&ol.extent.equals(e,n)||(this.renderedImageCanvas_=null)}this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_();o.tileQueue.loadMoreTiles(16,16);o.animate&&requestAnimationFrame(this.changed.bind(this));return this.renderedImageCanvas_};ol.source.Raster.prototype.processSources_=function(){for(var e=this.requestedFrameState_,t=this.renderers_.length,o=Array(t),r=0;r<t;++r){var n=ol.source.Raster.getImageData_(this.renderers_[r],e,e.layerStatesArray[r]);if(!n)return;o[r]=n}t={};this.dispatchEvent(new ol.source.Raster.Event(ol.source.Raster.EventType_.BEFOREOPERATIONS,e,t));this.worker_.process(o,t,this.onWorkerComplete_.bind(this,e))};ol.source.Raster.prototype.onWorkerComplete_=function(e,t,o,r){if(!t&&o){t=e.extent;var n=e.viewState.resolution;if(n===this.requestedFrameState_.viewState.resolution&&ol.extent.equals(t,this.requestedFrameState_.extent)){if(this.renderedImageCanvas_)var i=this.renderedImageCanvas_.getImage().getContext("2d");else{i=Math.round(ol.extent.getWidth(t)/n);var a=Math.round(ol.extent.getHeight(t)/n);i=ol.dom.createCanvasContext2D(i,a);this.renderedImageCanvas_=new ol.ImageCanvas(t,n,1,i.canvas)}i.putImageData(o,0,0);this.changed();this.renderedRevision_=this.getRevision();this.dispatchEvent(new ol.source.Raster.Event(ol.source.Raster.EventType_.AFTEROPERATIONS,e,r))}}};ol.source.Raster.getImageData_=function(e,t,o){if(!e.prepareFrame(t,o))return null;var r=t.size[0],n=t.size[1];if(ol.source.Raster.context_){var i=ol.source.Raster.context_.canvas;i.width!==r||i.height!==n?ol.source.Raster.context_=ol.dom.createCanvasContext2D(r,n):ol.source.Raster.context_.clearRect(0,0,r,n)}else ol.source.Raster.context_=ol.dom.createCanvasContext2D(r,n);e.composeFrame(t,o,ol.source.Raster.context_);return ol.source.Raster.context_.getImageData(0,0,r,n)};ol.source.Raster.context_=null;ol.source.Raster.getLayerStatesArray_=function(e){return e.map(function(e){return e.getLayer().getLayerState()})};ol.source.Raster.createRenderers_=function(e){for(var t=e.length,o=Array(t),r=0;r<t;++r)o[r]=ol.source.Raster.createRenderer_(e[r]);return o};ol.source.Raster.createRenderer_=function(e){var t=null;e instanceof ol.source.Tile?t=ol.source.Raster.createTileRenderer_(e):e instanceof ol.source.Image&&(t=ol.source.Raster.createImageRenderer_(e));return t};ol.source.Raster.createImageRenderer_=function(e){e=new ol.layer.Image({source:e});return new ol.renderer.canvas.ImageLayer(e)};ol.source.Raster.createTileRenderer_=function(e){e=new ol.layer.Tile({source:e});return new ol.renderer.canvas.TileLayer(e)};ol.source.Raster.Event=function(e,t,o){ol.events.Event.call(this,e);this.extent=t.extent;this.resolution=t.viewState.resolution/t.pixelRatio;this.data=o};ol.inherits(ol.source.Raster.Event,ol.events.Event);ol.source.Raster.prototype.getImageInternal=function(){return null};ol.source.Raster.EventType_={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};ol.source.Stamen=function(e){var t=e.layer.indexOf("-");t=-1==t?e.layer:e.layer.slice(0,t);t=ol.source.Stamen.ProviderConfig[t];var o=ol.source.Stamen.LayerConfig[e.layer];ol.source.XYZ.call(this,{attributions:ol.source.Stamen.ATTRIBUTIONS,cacheSize:e.cacheSize,crossOrigin:"anonymous",maxZoom:void 0!=e.maxZoom?e.maxZoom:t.maxZoom,minZoom:void 0!=e.minZoom?e.minZoom:t.minZoom,opaque:o.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:void 0!==e.url?e.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+e.layer+"/{z}/{x}/{y}."+o.extension,wrapX:e.wrapX})};ol.inherits(ol.source.Stamen,ol.source.XYZ);ol.source.Stamen.ATTRIBUTIONS=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',ol.source.OSM.ATTRIBUTION];ol.source.Stamen.LayerConfig={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}};ol.source.Stamen.ProviderConfig={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}};ol.source.TileArcGISRest=function(e){e=e||{};ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.params_=e.params||{};this.tmpExtent_=ol.extent.createEmpty();this.setKey(this.getKeyForParams_())};ol.inherits(ol.source.TileArcGISRest,ol.source.TileImage);ol.source.TileArcGISRest.prototype.getKeyForParams_=function(){var e,t=0,o=[];for(e in this.params_)o[t++]=e+"-"+this.params_[e];return o.join("/")};ol.source.TileArcGISRest.prototype.getParams=function(){return this.params_};ol.source.TileArcGISRest.prototype.getRequestUrl_=function(e,t,o,r,n,i){var a=this.urls;if(a)return n=n.getCode().split(":").pop(),i.SIZE=t[0]+","+t[1],i.BBOX=o.join(","),i.BBOXSR=n,i.IMAGESR=n,i.DPI=Math.round(i.DPI?i.DPI*r:90*r),1==a.length?a=a[0]:a=a[e=ol.math.modulo(ol.tilecoord.hash(e),a.length)],a=a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),ol.uri.appendParams(a,i)};ol.source.TileArcGISRest.prototype.getTilePixelRatio=function(e){return e};ol.source.TileArcGISRest.prototype.fixedTileUrlFunction=function(e,t,o){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(o));if(!(r.getResolutions().length<=e[0])){var n=r.getTileCoordExtent(e,this.tmpExtent_);r=ol.size.toSize(r.getTileSize(e[0]),this.tmpSize);1!=t&&(r=ol.size.scale(r,t,this.tmpSize));var i={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};ol.obj.assign(i,this.params_);return this.getRequestUrl_(e,r,n,t,o,i)}};ol.source.TileArcGISRest.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.setKey(this.getKeyForParams_())};ol.source.TileDebug=function(e){ol.source.Tile.call(this,{opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:void 0===e.wrapX||e.wrapX})};ol.inherits(ol.source.TileDebug,ol.source.Tile);ol.source.TileDebug.prototype.getTile=function(e,t,o){var r=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(r))return this.tileCache.get(r);var n=ol.size.toSize(this.tileGrid.getTileSize(e));e=[e,t,o];t=(t=this.getTileCoordForTileUrlFunction(e))?this.getTileCoordForTileUrlFunction(t).toString():"";n=new ol.source.TileDebug.Tile_(e,n,t);this.tileCache.set(r,n);return n};ol.source.TileDebug.Tile_=function(e,t,o){ol.Tile.call(this,e,ol.TileState.LOADED);this.tileSize_=t;this.text_=o;this.canvas_=null};ol.inherits(ol.source.TileDebug.Tile_,ol.Tile);ol.source.TileDebug.Tile_.prototype.getImage=function(){if(this.canvas_)return this.canvas_;var e=this.tileSize_,t=ol.dom.createCanvasContext2D(e[0],e[1]);t.strokeStyle="black";t.strokeRect(.5,.5,e[0]+.5,e[1]+.5);t.fillStyle="black";t.textAlign="center";t.textBaseline="middle";t.font="24px sans-serif";t.fillText(this.text_,e[0]/2,e[1]/2);return this.canvas_=t.canvas};ol.source.TileDebug.Tile_.prototype.load=function(){};ol.source.TileJSON=function(e){this.tileJSON_=null;ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:ol.proj.get("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:ol.source.State.LOADING,tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});if(e.url)if(e.jsonp)ol.net.jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",e.url);t.send()}else e.tileJSON?this.handleTileJSONResponse(e.tileJSON):ol.asserts.assert(!1,51)};ol.inherits(ol.source.TileJSON,ol.source.TileImage);ol.source.TileJSON.prototype.onXHRLoad_=function(e){if(!(e=e.target).status||200<=e.status&&300>e.status){try{var t=JSON.parse(e.responseText)}catch(e){this.handleTileJSONError();return}this.handleTileJSONResponse(t)}else this.handleTileJSONError()};ol.source.TileJSON.prototype.onXHRError_=function(e){this.handleTileJSONError()};ol.source.TileJSON.prototype.getTileJSON=function(){return this.tileJSON_};ol.source.TileJSON.prototype.handleTileJSONResponse=function(e){var t=ol.proj.get("EPSG:4326"),o=this.getProjection();if(void 0!==e.bounds){var r=ol.proj.getTransformFromProjections(t,o);r=ol.extent.applyTransform(e.bounds,r)}var n=e.minzoom||0,i=e.maxzoom||22;this.tileGrid=o=ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(o),maxZoom:i,minZoom:n});this.tileUrlFunction=ol.TileUrlFunction.createFromTemplates(e.tiles,o);if(void 0!==e.attribution&&!this.getAttributions2()){var a=void 0!==r?r:t.getExtent();this.setAttributions(function(t){return ol.extent.intersects(a,t.extent)?[e.attribution]:null})}this.tileJSON_=e;this.setState(ol.source.State.READY)};ol.source.TileJSON.prototype.handleTileJSONError=function(){this.setState(ol.source.State.ERROR)};ol.source.TileUTFGrid=function(e){ol.source.Tile.call(this,{projection:ol.proj.get("EPSG:3857"),state:ol.source.State.LOADING});this.preemptive_=void 0===e.preemptive||e.preemptive;this.tileUrlFunction_=ol.TileUrlFunction.nullTileUrlFunction;this.template_=void 0;this.jsonp_=e.jsonp||!1;if(e.url)if(this.jsonp_)ol.net.jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",e.url);t.send()}else e.tileJSON?this.handleTileJSONResponse(e.tileJSON):ol.asserts.assert(!1,51)};ol.inherits(ol.source.TileUTFGrid,ol.source.Tile);ol.source.TileUTFGrid.prototype.onXHRLoad_=function(e){if(!(e=e.target).status||200<=e.status&&300>e.status){try{var t=JSON.parse(e.responseText)}catch(e){this.handleTileJSONError();return}this.handleTileJSONResponse(t)}else this.handleTileJSONError()};ol.source.TileUTFGrid.prototype.onXHRError_=function(e){this.handleTileJSONError()};ol.source.TileUTFGrid.prototype.getTemplate=function(){return this.template_};ol.source.TileUTFGrid.prototype.forDataAtCoordinateAndResolution=function(e,t,o,r,n){this.tileGrid?(t=this.tileGrid.getTileCoordForCoordAndResolution(e,t),this.getTile(t[0],t[1],t[2],1,this.getProjection()).forDataAtCoordinate(e,o,r,n)):!0===n?setTimeout(function(){o.call(r,null)},0):o.call(r,null)};ol.source.TileUTFGrid.prototype.handleTileJSONError=function(){this.setState(ol.source.State.ERROR)};ol.source.TileUTFGrid.prototype.handleTileJSONResponse=function(e){var t=ol.proj.get("EPSG:4326"),o=this.getProjection();if(void 0!==e.bounds){var r=ol.proj.getTransformFromProjections(t,o);r=ol.extent.applyTransform(e.bounds,r)}var n=e.minzoom||0,i=e.maxzoom||22;this.tileGrid=o=ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(o),maxZoom:i,minZoom:n});this.template_=e.template;if(n=e.grids){this.tileUrlFunction_=ol.TileUrlFunction.createFromTemplates(n,o);if(void 0!==e.attribution){var a=void 0!==r?r:t.getExtent();this.setAttributions(function(t){return ol.extent.intersects(a,t.extent)?[e.attribution]:null})}this.setState(ol.source.State.READY)}else this.setState(ol.source.State.ERROR)};ol.source.TileUTFGrid.prototype.getTile=function(e,t,o,r,n){var i=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(i))return this.tileCache.get(i);e=[e,t,o];t=this.getTileCoordForTileUrlFunction(e,n);r=this.tileUrlFunction_(t,r,n);r=new ol.source.TileUTFGrid.Tile_(e,void 0!==r?ol.TileState.IDLE:ol.TileState.EMPTY,void 0!==r?r:"",this.tileGrid.getTileCoordExtent(e),this.preemptive_,this.jsonp_);this.tileCache.set(i,r);return r};ol.source.TileUTFGrid.prototype.useTile=function(e,t,o){e=ol.tilecoord.getKeyZXY(e,t,o);this.tileCache.containsKey(e)&&this.tileCache.get(e)};ol.source.TileUTFGrid.Tile_=function(e,t,o,r,n,i){ol.Tile.call(this,e,t);this.src_=o;this.extent_=r;this.preemptive_=n;this.data_=this.keys_=this.grid_=null;this.jsonp_=i};ol.inherits(ol.source.TileUTFGrid.Tile_,ol.Tile);ol.source.TileUTFGrid.Tile_.prototype.getImage=function(){return null};ol.source.TileUTFGrid.Tile_.prototype.getData=function(e){if(!this.grid_||!this.keys_)return null;var t=this.grid_[Math.floor((1-(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]))*this.grid_.length)];if("string"!=typeof t)return null;93<=(e=t.charCodeAt(Math.floor((e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0])*t.length)))&&e--;35<=e&&e--;t=null;(e-=32)in this.keys_&&(e=this.keys_[e],t=this.data_&&e in this.data_?this.data_[e]:e);return t};ol.source.TileUTFGrid.Tile_.prototype.forDataAtCoordinate=function(e,t,o,r){this.state==ol.TileState.IDLE&&!0===r?(ol.events.listenOnce(this,ol.events.EventType.CHANGE,function(r){t.call(o,this.getData(e))},this),this.loadInternal_()):!0===r?setTimeout(function(){t.call(o,this.getData(e))}.bind(this),0):t.call(o,this.getData(e))};ol.source.TileUTFGrid.Tile_.prototype.getKey=function(){return this.src_};ol.source.TileUTFGrid.Tile_.prototype.handleError_=function(){this.state=ol.TileState.ERROR;this.changed()};ol.source.TileUTFGrid.Tile_.prototype.handleLoad_=function(e){this.grid_=e.grid;this.keys_=e.keys;this.data_=e.data;this.state=ol.TileState.EMPTY;this.changed()};ol.source.TileUTFGrid.Tile_.prototype.loadInternal_=function(){if(this.state==ol.TileState.IDLE)if(this.state=ol.TileState.LOADING,this.jsonp_)ol.net.jsonp(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",this.src_);e.send()}};ol.source.TileUTFGrid.Tile_.prototype.onXHRLoad_=function(e){if(!(e=e.target).status||200<=e.status&&300>e.status){try{var t=JSON.parse(e.responseText)}catch(e){this.handleError_();return}this.handleLoad_(t)}else this.handleError_()};ol.source.TileUTFGrid.Tile_.prototype.onXHRError_=function(e){this.handleError_()};ol.source.TileUTFGrid.Tile_.prototype.load=function(){this.preemptive_&&this.loadInternal_()};ol.source.TileWMS=function(e){var t=(e=e||{}).params||{};ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,opaque:!(!("TRANSPARENT"in t)||t.TRANSPARENT),projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.gutter_=void 0!==e.gutter?e.gutter:0;this.params_=t;this.v13_=!0;this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.tmpExtent_=ol.extent.createEmpty();this.updateV13_();this.setKey(this.getKeyForParams_())};ol.inherits(ol.source.TileWMS,ol.source.TileImage);ol.source.TileWMS.prototype.getGetFeatureInfoUrl=function(e,t,o,r){o=ol.proj.get(o);var n=this.getProjection(),i=this.getTileGrid();i||(i=this.getTileGridForProjection(o));t=i.getTileCoordForCoordAndResolution(e,t);if(!(i.getResolutions().length<=t[0])){var a=i.getResolution(t[0]),s=i.getTileCoordExtent(t,this.tmpExtent_);i=ol.size.toSize(i.getTileSize(t[0]),this.tmpSize);var l=this.gutter_;0!==l&&(i=ol.size.buffer(i,l,this.tmpSize),s=ol.extent.buffer(s,a*l,s));n&&n!==o&&(a=ol.reproj.calculateSourceResolution(n,o,e,a),s=ol.proj.transformExtent(s,o,n),e=ol.proj.transform(e,o,n));l={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};ol.obj.assign(l,this.params_,r);r=Math.floor((s[3]-e[1])/a);l[this.v13_?"I":"X"]=Math.floor((e[0]-s[0])/a);l[this.v13_?"J":"Y"]=r;return this.getRequestUrl_(t,i,s,1,n||o,l)}};ol.source.TileWMS.prototype.getGutterInternal=function(){return this.gutter_};ol.source.TileWMS.prototype.getParams=function(){return this.params_};ol.source.TileWMS.prototype.getRequestUrl_=function(e,t,o,r,n,i){var a=this.urls;if(a){i.WIDTH=t[0];i.HEIGHT=t[1];i[this.v13_?"CRS":"SRS"]=n.getCode();"STYLES"in this.params_||(i.STYLES="");if(1!=r)switch(this.serverType_){case ol.source.WMSServerType.GEOSERVER:t=90*r+.5|0;i.FORMAT_OPTIONS="FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+";dpi:"+t:"dpi:"+t;break;case ol.source.WMSServerType.MAPSERVER:i.MAP_RESOLUTION=90*r;break;case ol.source.WMSServerType.CARMENTA_SERVER:case ol.source.WMSServerType.QGIS:i.DPI=90*r;break;default:ol.asserts.assert(!1,52)}n=n.getAxisOrientation();this.v13_&&"ne"==n.substr(0,2)&&(n=o[0],o[0]=o[1],o[1]=n,n=o[2],o[2]=o[3],o[3]=n);i.BBOX=o.join(",");1==a.length?a=a[0]:a=a[e=ol.math.modulo(ol.tilecoord.hash(e),a.length)];return ol.uri.appendParams(a,i)}};ol.source.TileWMS.prototype.getTilePixelRatio=function(e){return this.hidpi_&&void 0!==this.serverType_?e:1};ol.source.TileWMS.prototype.getKeyForParams_=function(){var e,t=0,o=[];for(e in this.params_)o[t++]=e+"-"+this.params_[e];return o.join("/")};ol.source.TileWMS.prototype.fixedTileUrlFunction=function(e,t,o){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(o));if(!(r.getResolutions().length<=e[0])){1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);var n=r.getResolution(e[0]),i=r.getTileCoordExtent(e,this.tmpExtent_);r=ol.size.toSize(r.getTileSize(e[0]),this.tmpSize);var a=this.gutter_;0!==a&&(r=ol.size.buffer(r,a,this.tmpSize),i=ol.extent.buffer(i,n*a,i));1!=t&&(r=ol.size.scale(r,t,this.tmpSize));n={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ol.obj.assign(n,this.params_);return this.getRequestUrl_(e,r,i,t,o,n)}};ol.source.TileWMS.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.updateV13_();this.setKey(this.getKeyForParams_())};ol.source.TileWMS.prototype.updateV13_=function(){this.v13_=0<=ol.string.compareVersions(this.params_.VERSION||ol.DEFAULT_WMS_VERSION,"1.3")};ol.VectorImageTile=function(e,t,o,r,n,i,a,s,l,c,u,h,d,p,f){ol.Tile.call(this,e,t,f);this.context_={};this.replayState_={};this.sourceTiles_=c;this.tileKeys=[];this.sourceRevision_=o;this.wrappedTileCoord=i;this.loadListenerKeys_=[];this.sourceTileListenerKeys_=[];if(i){var g=l.getTileCoordExtent(i),m=l.getResolution(e[0]);e=s.getZForResolution(m);s.forEachTileCoord(g,e,function(e){var t=ol.extent.getIntersection(g,s.getTileCoordExtent(e)),o=s.getExtent();o&&(t=ol.extent.getIntersection(t,o));.5<=ol.extent.getWidth(t)/m&&.5<=ol.extent.getHeight(t)/m&&(t=e.toString(),(o=c[t])||(o=a(e,u,h),o=c[t]=new d(e,void 0==o?ol.TileState.EMPTY:ol.TileState.IDLE,void 0==o?"":o,r,n),this.sourceTileListenerKeys_.push(ol.events.listen(o,ol.events.EventType.CHANGE,p))),o.consumers++,this.tileKeys.push(t))}.bind(this))}};ol.inherits(ol.VectorImageTile,ol.Tile);ol.VectorImageTile.prototype.disposeInternal=function(){for(var e=0,t=this.tileKeys.length;e<t;++e){var o=this.tileKeys[e],r=this.getTile(o);r.consumers--;0==r.consumers&&(delete this.sourceTiles_[o],r.dispose())}this.tileKeys.length=0;this.sourceTiles_=null;this.loadListenerKeys_.forEach(ol.events.unlistenByKey);this.loadListenerKeys_.length=0;this.interimTile&&this.interimTile.dispose();this.state=ol.TileState.ABORT;this.changed();this.sourceTileListenerKeys_.forEach(ol.events.unlistenByKey);this.sourceTileListenerKeys_.length=0;ol.Tile.prototype.disposeInternal.call(this)};ol.VectorImageTile.prototype.getContext=function(e){(e=ol.getUid(e).toString())in this.context_||(this.context_[e]=ol.dom.createCanvasContext2D());return this.context_[e]};ol.VectorImageTile.prototype.getImage=function(e){return-1==this.getReplayState(e).renderedTileRevision?null:this.getContext(e).canvas};ol.VectorImageTile.prototype.getReplayState=function(e){(e=ol.getUid(e).toString())in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1});return this.replayState_[e]};ol.VectorImageTile.prototype.getKey=function(){return this.tileKeys.join("/")+"-"+this.sourceRevision_};ol.VectorImageTile.prototype.getTile=function(e){return this.sourceTiles_[e]};ol.VectorImageTile.prototype.load=function(){var e=0,t={};this.state==ol.TileState.IDLE&&this.setState(ol.TileState.LOADING);this.state==ol.TileState.LOADING&&this.tileKeys.forEach(function(o){var r=this.getTile(o);r.state==ol.TileState.IDLE&&(r.setLoader(this.loader_),r.load());r.state==ol.TileState.LOADING&&(o=ol.events.listen(r,ol.events.EventType.CHANGE,function(o){if((o=r.getState())==ol.TileState.LOADED||o==ol.TileState.ERROR){var n=ol.getUid(r);o==ol.TileState.ERROR?t[n]=!0:(--e,delete t[n]);0==e-Object.keys(t).length&&this.finishLoading_()}}.bind(this)),this.loadListenerKeys_.push(o),++e)}.bind(this));0==e-Object.keys(t).length&&setTimeout(this.finishLoading_.bind(this),0)};ol.VectorImageTile.prototype.finishLoading_=function(){for(var e=this.tileKeys.length,t=0,o=e-1;0<=o;--o){var r=this.getTile(this.tileKeys[o]).getState();r!=ol.TileState.LOADED&&--e;r==ol.TileState.EMPTY&&++t}e==this.tileKeys.length?(this.loadListenerKeys_.forEach(ol.events.unlistenByKey),this.loadListenerKeys_.length=0,this.setState(ol.TileState.LOADED)):this.setState(t==this.tileKeys.length?ol.TileState.EMPTY:ol.TileState.ERROR)};ol.VectorImageTile.defaultLoadFunction=function(e,t){t=ol.featureloader.loadFeaturesXhr(t,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(t)};ol.source.VectorTile=function(e){var t=e.projection||"EPSG:3857",o=e.extent||ol.tilegrid.extentFromProjection(t),r=e.tileGrid||ol.tilegrid.createXYZ({extent:o,maxZoom:e.maxZoom||22,minZoom:e.minZoom,tileSize:e.tileSize||512});ol.source.UrlTile.call(this,{attributions:e.attributions,cacheSize:void 0!==e.cacheSize?e.cacheSize:128,extent:o,logo:e.logo,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ol.VectorImageTile.defaultLoadFunction,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.format_=e.format?e.format:null;this.sourceTiles_={};this.overlaps_=void 0==e.overlaps||e.overlaps;this.tileClass=e.tileClass?e.tileClass:ol.VectorTile;this.tileGrids_={}};ol.inherits(ol.source.VectorTile,ol.source.UrlTile);ol.source.VectorTile.prototype.getOverlaps=function(){return this.overlaps_};ol.source.VectorTile.prototype.clear=function(){this.tileCache.clear();this.sourceTiles_={}};ol.source.VectorTile.prototype.getTile=function(e,t,o,r,n){var i=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(i))return this.tileCache.get(i);e=[e,t,o];t=this.getTileCoordForTileUrlFunction(e,n);r=new ol.VectorImageTile(e,null!==t?ol.TileState.IDLE:ol.TileState.EMPTY,this.getRevision(),this.format_,this.tileLoadFunction,t,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(n),this.sourceTiles_,r,n,this.tileClass,this.handleTileChange.bind(this),this.tileOptions);this.tileCache.set(i,r);return r};ol.source.VectorTile.prototype.getTileGridForProjection=function(e){var t=e.getCode(),o=this.tileGrids_[t];o||(o=this.tileGrid,o=this.tileGrids_[t]=ol.tilegrid.createForProjection(e,void 0,o?o.getTileSize(o.getMinZoom()):void 0));return o};ol.source.VectorTile.prototype.getTilePixelRatio=function(e){return e};ol.source.VectorTile.prototype.getTilePixelSize=function(e,t,o){e=ol.size.toSize(this.getTileGridForProjection(o).getTileSize(e));return[Math.round(e[0]*t),Math.round(e[1]*t)]};ol.source.WMTSRequestEncoding={KVP:"KVP",REST:"REST"};ol.tilegrid.WMTS=function(e){this.matrixIds_=e.matrixIds;ol.tilegrid.TileGrid.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})};ol.inherits(ol.tilegrid.WMTS,ol.tilegrid.TileGrid);ol.tilegrid.WMTS.prototype.getMatrixId=function(e){return this.matrixIds_[e]};ol.tilegrid.WMTS.prototype.getMatrixIds=function(){return this.matrixIds_};ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet=function(e,t,o){var r=[],n=[],i=[],a=[],s=[],l=void 0!==o?o:[];o=e.SupportedCRS;var c=(o=ol.proj.get(o.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(o)).getMetersPerUnit(),u="ne"==o.getAxisOrientation().substr(0,2);e.TileMatrix.sort(function(e,t){return t.ScaleDenominator-e.ScaleDenominator});e.TileMatrix.forEach(function(e,t,o){if(!(0<l.length)||ol.array.find(l,function(t,o,r){return e.Identifier==t.TileMatrix})){n.push(e.Identifier);t=28e-5*e.ScaleDenominator/c;o=e.TileWidth;var h=e.TileHeight;u?i.push([e.TopLeftCorner[1],e.TopLeftCorner[0]]):i.push(e.TopLeftCorner);r.push(t);a.push(o==h?o:[o,h]);s.push([e.MatrixWidth,-e.MatrixHeight])}});return new ol.tilegrid.WMTS({extent:t,origins:i,resolutions:r,matrixIds:n,tileSizes:a,sizes:s})};ol.source.WMTS=function(e){this.version_=void 0!==e.version?e.version:"1.0.0";this.format_=void 0!==e.format?e.format:"image/jpeg";this.dimensions_=void 0!==e.dimensions?e.dimensions:{};this.layer_=e.layer;this.matrixSet_=e.matrixSet;this.style_=e.style;var t=e.urls;void 0===t&&void 0!==e.url&&(t=ol.TileUrlFunction.expandUrl(e.url));var o=this.requestEncoding_=void 0!==e.requestEncoding?e.requestEncoding:ol.source.WMTSRequestEncoding.KVP,r=e.tileGrid,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};o==ol.source.WMTSRequestEncoding.KVP&&ol.obj.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_});var i=this.dimensions_;this.createFromWMTSTemplate_=function(e){e=o==ol.source.WMTSRequestEncoding.KVP?ol.uri.appendParams(e,n):e.replace(/\{(\w+?)\}/g,function(e,t){return t.toLowerCase()in n?n[t.toLowerCase()]:e});return function(t,n,a){if(t){var s={TileMatrix:r.getMatrixId(t[0]),TileCol:t[1],TileRow:-t[2]-1};ol.obj.assign(s,i);t=e;return o==ol.source.WMTSRequestEncoding.KVP?ol.uri.appendParams(t,s):t.replace(/\{(\w+?)\}/g,function(e,t){return s[t]})}}};var a=t&&0<t.length?ol.TileUrlFunction.createFromTileUrlFunctions(t.map(this.createFromWMTSTemplate_)):ol.TileUrlFunction.nullTileUrlFunction;ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:a,urls:t,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition});this.setKey(this.getKeyForDimensions_())};ol.inherits(ol.source.WMTS,ol.source.TileImage);ol.source.WMTS.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTileUrlFunctions(e.map(this.createFromWMTSTemplate_.bind(this))),t)};ol.source.WMTS.prototype.getDimensions=function(){return this.dimensions_};ol.source.WMTS.prototype.getFormat=function(){return this.format_};ol.source.WMTS.prototype.getLayer=function(){return this.layer_};ol.source.WMTS.prototype.getMatrixSet=function(){return this.matrixSet_};ol.source.WMTS.prototype.getRequestEncoding=function(){return this.requestEncoding_};ol.source.WMTS.prototype.getStyle=function(){return this.style_};ol.source.WMTS.prototype.getVersion=function(){return this.version_};ol.source.WMTS.prototype.getKeyForDimensions_=function(){var e,t=0,o=[];for(e in this.dimensions_)o[t++]=e+"-"+this.dimensions_[e];return o.join("/")};ol.source.WMTS.prototype.updateDimensions=function(e){ol.obj.assign(this.dimensions_,e);this.setKey(this.getKeyForDimensions_())};ol.source.WMTS.optionsFromCapabilities=function(e,t){var o=ol.array.find(e.Contents.Layer,function(e,o,r){return e.Identifier==t.layer});if(null===o)return null;var r=e.Contents.TileMatrixSet,n=1<o.TileMatrixSetLink.length?"projection"in t?ol.array.findIndex(o.TileMatrixSetLink,function(e,o,n){o=ol.array.find(r,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS;n=ol.proj.get(o.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(o);var i=ol.proj.get(t.projection);return n&&i?ol.proj.equivalent(n,i):o==t.projection}):ol.array.findIndex(o.TileMatrixSetLink,function(e,o,r){return e.TileMatrixSet==t.matrixSet}):0;0>n&&(n=0);var i=o.TileMatrixSetLink[n].TileMatrixSet,a=o.TileMatrixSetLink[n].TileMatrixSetLimits,s=o.Format[0];"format"in t&&(s=t.format);0>(n=ol.array.findIndex(o.Style,function(e,o,r){return"style"in t?e.Title==t.style:e.isDefault}))&&(n=0);n=o.Style[n].Identifier;var l={};"Dimension"in o&&o.Dimension.forEach(function(e,t,o){t=e.Identifier;void 0===(o=e.Default)&&(o=e.Value[0]);l[t]=o});var c,u=ol.array.find(e.Contents.TileMatrixSet,function(e,t,o){return e.Identifier==i}),h=u.SupportedCRS;h&&(c=ol.proj.get(h.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(h));"projection"in t&&(!(h=ol.proj.get(t.projection))||c&&!ol.proj.equivalent(h,c)||(c=h));if(void 0!==(h=o.WGS84BoundingBox)){var d=ol.proj.get("EPSG:4326").getExtent();d=h[0]==d[0]&&h[2]==d[2];var p=ol.proj.transformExtent(h,"EPSG:4326",c);(h=c.getExtent())&&(ol.extent.containsExtent(h,p)||(p=void 0))}a=ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet(u,p,a);var f=[];u=void 0!==(u=t.requestEncoding)?u:"";if("OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata)for(p=0,h=(e=e.OperationsMetadata.GetTile.DCP.HTTP.Get).length;p<h;++p)if(e[p].Constraint){var g=ol.array.find(e[p].Constraint,function(e){return"GetEncoding"==e.name}).AllowedValues.Value;""===u&&(u=g[0]);if(u!==ol.source.WMTSRequestEncoding.KVP)break;ol.array.includes(g,ol.source.WMTSRequestEncoding.KVP)&&f.push(e[p].href)}else e[p].href&&(u=ol.source.WMTSRequestEncoding.KVP,f.push(e[p].href));0===f.length&&(u=ol.source.WMTSRequestEncoding.REST,o.ResourceURL.forEach(function(e){"tile"===e.resourceType&&(s=e.format,f.push(e.template))}));return{urls:f,layer:t.layer,matrixSet:i,format:s,projection:c,requestEncoding:u,tileGrid:a,style:n,dimensions:l,wrapX:d,crossOrigin:t.crossOrigin}};ol.source.Zoomify=function(e){var t=(e=e||{}).size,o=t[0],r=t[1];t=e.extent||[0,-t[1],t[0],0];var n=[],i=e.tileSize||ol.DEFAULT_TILE_SIZE,a=i;switch(void 0!==e.tierSizeCalculation?e.tierSizeCalculation:ol.source.Zoomify.TierSizeCalculation_.DEFAULT){case ol.source.Zoomify.TierSizeCalculation_.DEFAULT:for(;o>a||r>a;)n.push([Math.ceil(o/a),Math.ceil(r/a)]),a+=a;break;case ol.source.Zoomify.TierSizeCalculation_.TRUNCATED:for(;o>a||r>a;)n.push([Math.ceil(o/a),Math.ceil(r/a)]),o>>=1,r>>=1;break;default:ol.asserts.assert(!1,53)}n.push([1,1]);n.reverse();r=[1];var s=[0];a=1;for(o=n.length;a<o;a++)r.push(1<<a),s.push(n[a-1][0]*n[a-1][1]+s[a-1]);r.reverse();var l=new ol.tilegrid.TileGrid({tileSize:i,extent:t,origin:ol.extent.getTopLeft(t),resolutions:r});(t=e.url)&&-1==t.indexOf("{TileGroup}")&&-1==t.indexOf("{tileIndex}")&&(t+="{TileGroup}/{z}-{x}-{y}.jpg");t=ol.TileUrlFunction.expandUrl(t);t=ol.TileUrlFunction.createFromTileUrlFunctions(t.map(function(e){return function(t,o,r){if(t){o=t[0];var i=(r=t[1])+(t=-t[2]-1)*n[o][0],a=l.getTileSize(o),c={z:o,x:r,y:t,tileIndex:i,TileGroup:"TileGroup"+((i+s[o])/a|0)};return e.replace(/\{(\w+?)\}/g,function(e,t){return c[t]})}}}));i=ol.source.Zoomify.Tile_.bind(null,l);ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:i,tileGrid:l,tileUrlFunction:t,transition:e.transition})};ol.inherits(ol.source.Zoomify,ol.source.TileImage);ol.source.Zoomify.Tile_=function(e,t,o,r,n,i,a){ol.ImageTile.call(this,t,o,r,n,i,a);this.zoomifyImage_=null;this.tileSize_=ol.size.toSize(e.getTileSize(t[0]))};ol.inherits(ol.source.Zoomify.Tile_,ol.ImageTile);ol.source.Zoomify.Tile_.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var e=ol.ImageTile.prototype.getImage.call(this);if(this.state==ol.TileState.LOADED){var t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e;(t=ol.dom.createCanvasContext2D(t[0],t[1])).drawImage(e,0,0);return this.zoomifyImage_=t.canvas}return e};ol.source.Zoomify.TierSizeCalculation_={DEFAULT:"default",TRUNCATED:"truncated"};goog.exportSymbol("ol.Map",ol.Map);goog.exportSymbol("ol.Overlay",ol.Overlay);goog.exportSymbol("ol.View",ol.View);goog.exportSymbol("ol.control.defaults",ol.control.defaults);goog.exportSymbol("ol.control.OverviewMap",ol.control.OverviewMap);goog.exportSymbol("ol.control.ScaleLine",ol.control.ScaleLine);goog.exportSymbol("ol.control.ZoomSlider",ol.control.ZoomSlider);goog.exportSymbol("ol.control.ZoomToExtent",ol.control.ZoomToExtent);goog.exportSymbol("ol.Geolocation",ol.Geolocation);goog.exportSymbol("ol.geom.LineString",ol.geom.LineString);goog.exportSymbol("ol.geom.MultiLineString",ol.geom.MultiLineString);goog.exportSymbol("ol.geom.MultiPolygon",ol.geom.MultiPolygon);goog.exportSymbol("ol.geom.Point",ol.geom.Point);goog.exportSymbol("ol.geom.Polygon",ol.geom.Polygon);goog.exportSymbol("ol.format.Feature",ol.format.Feature);goog.exportSymbol("ol.format.GeoJSON",ol.format.GeoJSON);goog.exportSymbol("ol.format.GML2",ol.format.GML2);goog.exportSymbol("ol.format.GML3",ol.format.GML3);goog.exportSymbol("ol.format.GPX",ol.format.GPX);goog.exportSymbol("ol.format.KML",ol.format.KML);goog.exportSymbol("ol.format.WFS",ol.format.WFS);goog.exportSymbol("ol.format.WKT",ol.format.WKT);goog.exportSymbol("ol.format.WMSCapabilities",ol.format.WMSCapabilities);goog.exportSymbol("ol.format.WMSGetFeatureInfo",ol.format.WMSGetFeatureInfo);goog.exportSymbol("ol.format.WMTSCapabilities",ol.format.WMTSCapabilities);goog.exportSymbol("ol.interaction.Draw",ol.interaction.Draw);goog.exportSymbol("ol.interaction.Pointer",ol.interaction.Pointer);goog.exportSymbol("ol.interaction.Translate",ol.interaction.Translate);goog.exportSymbol("ol.layer.Tile",ol.layer.Tile);goog.exportSymbol("ol.layer.Image",ol.layer.Image);goog.exportSymbol("ol.layer.Vector",ol.layer.Vector);goog.exportSymbol("ol.proj.Projection",ol.proj.Projection);goog.exportSymbol("ol.source.Cluster",ol.source.Cluster);goog.exportSymbol("ol.source.ImageWMS",ol.source.ImageWMS);goog.exportSymbol("ol.source.WMTS",ol.source.WMTS);goog.exportSymbol("ol.style.Circle",ol.style.Circle);goog.exportSymbol("ol.style.Fill",ol.style.Fill);goog.exportSymbol("ol.style.Icon",ol.style.Icon);goog.exportSymbol("ol.style.Stroke",ol.style.Stroke);goog.exportSymbol("ol.style.Style",ol.style.Style);goog.exportSymbol("ol.style.Text",ol.style.Text);!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.proj4=t()}(this,function(){"use strict";function e(e,t){if(e[t])return e[t];for(var o,r=Object.keys(e),n=t.toLowerCase().replace(W,""),i=-1;++i<r.length;)if((o=r[i]).toLowerCase().replace(W,"")===n)return e[o]}function t(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=H}function o(e){return new t(e).output()}function r(e,t,o){Array.isArray(t)&&(o.unshift(t),t=null);var r=t?{}:e,i=o.reduce(function(e,t){return n(t,e),e},r);t&&(e[t]=i)}function n(e,t){if(Array.isArray(e)){var o=e.shift();if("PARAMETER"===o&&(o=e.shift()),1===e.length)return Array.isArray(e[0])?(t[o]={},void n(e[0],t[o])):void(t[o]=e[0]);if(e.length)if("TOWGS84"!==o){Array.isArray(o)||(t[o]={});var i;switch(o){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[o]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&n(e[2],t[o]));case"SPHEROID":case"ELLIPSOID":return t[o]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&n(e[3],t[o]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void r(t,o,e);default:for(i=-1;++i<e.length;)if(!Array.isArray(e[i]))return n(e,t[o]);return r(t,o,e)}}else t[o]=e;else t[o]=!0}else t[e]=!0}function i(e){return e*$}function a(e){function t(t){return t*(e.to_meter||1)}"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36")),e.b&&!isFinite(e.b)&&(e.b=e.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",i],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",i],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",i],["lat0","latitude_of_origin",i],["lat0","standard_parallel_1",i],["lat1","standard_parallel_1",i],["lat2","standard_parallel_2",i],["alpha","azimuth",i],["srsCode","name"]].forEach(function(t){return function(e,t){var o=t[0],r=t[1];!(o in e)&&r in e&&(e[o]=e[r],3===t.length&&(e[o]=t[2](e[o])))}(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=i(e.lat1>0?90:-90),e.lat_ts=e.lat1)}function s(e){var t=this;if(2===arguments.length){var o=arguments[1];"string"==typeof o?"+"===o.charAt(0)?s[e]=V(arguments[1]):s[e]=J(arguments[1]):s[e]=o}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?s.apply(t,e):s(e)});if("string"==typeof e){if(e in s)return s[e]}else"EPSG"in e?s["EPSG:"+e.EPSG]=e:"ESRI"in e?s["ESRI:"+e.ESRI]=e:"IAU2000"in e?s["IAU2000:"+e.IAU2000]=e:console.log(e);return}}function l(e){return function(e){return"string"==typeof e}(e)?function(e){return e in s}(e)?s[e]:function(e){return Z.some(function(t){return e.indexOf(t)>-1})}(e)?J(e):function(e){return"+"===e[0]}(e)?V(e):void 0:e}function c(e){return e}function u(e,t){var o=se.length;return e.names?(se[o]=e,e.names.forEach(function(e){ae[e.toLowerCase()]=o}),this):(console.log(t),!0)}function h(t,o){if(!(this instanceof h))return new h(t);o=o||function(e){if(e)throw e};var r=l(t);if("object"==typeof r){var n=h.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=e(he,r.datumCode);i&&(r.datum_params=i.towgs84?i.towgs84.split(","):null,r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84";var a=function(t,o,r,n,i){if(!t){var a=e(ce,n);a||(a=ue),t=a.a,o=a.b,r=a.rf}return r&&!o&&(o=(1-1/r)*t),(0===r||Math.abs(t-o)<D)&&(i=!0,o=t),{a:t,b:o,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),s=function(e,t,o,r){var n=e*e,i=t*t,a=(n-i)/n,s=0;r?(n=(e*=1-a*(I+a*(O+a*N)))*e,a=0):s=Math.sqrt(a);return{es:a,e:s,ep2:(n-i)/i}}(a.a,a.b,a.rf,r.R_A),c=r.datum||function(e,t,o,r,n,i){var a={};return a.datum_type=void 0===e||"none"===e?P:A,t&&(a.datum_params=t.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=b),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=x,a.datum_params[3]*=R,a.datum_params[4]*=R,a.datum_params[5]*=R,a.datum_params[6]=a.datum_params[6]/1e6+1))),a.a=o,a.b=r,a.es=n,a.ep2=i,a}(r.datumCode,r.datum_params,a.a,a.b,s.es,s.ep2);Q(this,r),Q(this,n),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=c,this.init(),o(null,this)}else o(t)}else o(t)}function d(e){return e===b||e===x}function p(e,t,o){var r;return Array.isArray(o)&&(o=fe(o)),e.datum&&t.datum&&function(e,t){return(e.datum.datum_type===b||e.datum.datum_type===x)&&"WGS84"!==t.datumCode||(t.datum.datum_type===b||t.datum.datum_type===x)&&"WGS84"!==e.datumCode}(e,t)&&(o=p(e,r=new h("WGS84"),o),e=r),"enu"!==e.axis&&(o=pe(e,!1,o)),"longlat"===e.projName?o={x:o.x*F,y:o.y*F}:(e.to_meter&&(o={x:o.x*e.to_meter,y:o.y*e.to_meter}),o=e.inverse(o)),e.from_greenwich&&(o.x+=e.from_greenwich),o=de(e.datum,t.datum,o),t.from_greenwich&&(o={x:o.x-t.from_greenwich,y:o.y}),"longlat"===t.projName?o={x:o.x*k,y:o.y*k}:(o=t.forward(o),t.to_meter&&(o={x:o.x/t.to_meter,y:o.y/t.to_meter})),"enu"!==t.axis?pe(t,!0,o):o}function f(e,t,o){var r;return Array.isArray(o)?(r=p(e,t,o),3===o.length?[r.x,r.y,r.z]:[r.x,r.y]):p(e,t,o)}function g(e){return e instanceof h?e:e.oProj?e.oProj:h(e)}function m(e,t,o){e=g(e);var r,n=!1;return void 0===t?(t=e,e=ge,n=!0):(void 0!==t.x||Array.isArray(t))&&(o=t,t=e,e=ge,n=!0),t=g(t),o?f(e,t,o):(r={forward:function(o){return f(e,t,o)},inverse:function(o){return f(t,e,o)}},n&&(r.oProj=t),r)}function y(e,t){return t=t||5,function(e,t){var o="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+function(e,t,o){var r=S(o),n=Math.floor(e/1e5),i=Math.floor(t/1e5)%20;return function(e,t,o){var r=o-1,n=ye.charCodeAt(r),i=Ce.charCodeAt(r),a=n+e-1,s=i+t,l=!1;a>Ee&&(a=a-Ee+ve-1,l=!0),(a===Te||n<Te&&a>Te||(a>Te||n<Te)&&l)&&a++,(a===_e||n<_e&&a>_e||(a>_e||n<_e)&&l)&&++a===Te&&a++,a>Ee&&(a=a-Ee+ve-1),s>Se?(s=s-Se+ve-1,l=!0):l=!1,(s===Te||i<Te&&s>Te||(s>Te||i<Te)&&l)&&s++,(s===_e||i<_e&&s>_e||(s>_e||i<_e)&&l)&&++s===Te&&s++,s>Se&&(s=s-Se+ve-1);return String.fromCharCode(a)+String.fromCharCode(s)}(n,i,r)}(e.easting,e.northing,e.zoneNumber)+o.substr(o.length-5,t)+r.substr(r.length-5,t)}(function(e){var t,o,r,n,i,a,s,l,c=e.lat,u=e.lon,h=6378137,d=.00669438,p=v(c),f=v(u);l=Math.floor((u+180)/6)+1,180===u&&(l=60),c>=56&&c<64&&u>=3&&u<12&&(l=32),c>=72&&c<84&&(u>=0&&u<9?l=31:u>=9&&u<21?l=33:u>=21&&u<33?l=35:u>=33&&u<42&&(l=37)),s=v(6*(l-1)-180+3),t=d/(1-d),o=h/Math.sqrt(1-d*Math.sin(p)*Math.sin(p)),r=Math.tan(p)*Math.tan(p),n=t*Math.cos(p)*Math.cos(p),i=Math.cos(p)*(f-s),a=h*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-35*d*d*d/3072*Math.sin(6*p));var g=.9996*o*(i+(1-r+n)*i*i*i/6+(5-18*r+r*r+72*n-58*t)*i*i*i*i*i/120)+5e5,m=.9996*(a+o*Math.tan(p)*(i*i/2+(5-r+9*n+4*n*n)*i*i*i*i/24+(61-58*r+r*r+600*n-330*t)*i*i*i*i*i*i/720));return c<0&&(m+=1e7),{northing:Math.round(m),easting:Math.round(g),zoneNumber:l,zoneLetter:function(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}(c)}}({lat:e[1],lon:e[0]}),t)}function C(e){var t=_(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function v(e){return e*(Math.PI/180)}function T(e){return e/Math.PI*180}function _(e){var t=e.northing,o=e.easting,r=e.zoneLetter,n=e.zoneNumber;if(n<0||n>60)return null;var i,a,s,l,c,u,h,d,p,f=6378137,g=.00669438,m=(1-Math.sqrt(1-g))/(1+Math.sqrt(1-g)),y=o-5e5,C=t;r<"N"&&(C-=1e7),h=6*(n-1)-180+3,i=g/(1-g),p=(d=C/.9996/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*d)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*d)+151*m*m*m/96*Math.sin(6*d),a=f/Math.sqrt(1-g*Math.sin(p)*Math.sin(p)),s=Math.tan(p)*Math.tan(p),l=i*Math.cos(p)*Math.cos(p),c=f*(1-g)/Math.pow(1-g*Math.sin(p)*Math.sin(p),1.5),u=y/(.9996*a);var v=p-a*Math.tan(p)/c*(u*u/2-(5+3*s+10*l-4*l*l-9*i)*u*u*u*u/24+(61+90*s+298*l+45*s*s-252*i-3*l*l)*u*u*u*u*u*u/720);v=T(v);var S,E=(u-(1+2*s+l)*u*u*u/6+(5-2*l+28*s-3*l*l+8*i+24*s*s)*u*u*u*u*u/120)/Math.cos(p);E=h+T(E);if(e.accuracy){var L=_({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});S={top:L.lat,right:L.lon,bottom:v,left:E}}else S={lat:v,lon:E};return S}function S(e){var t=e%me;return 0===t&&(t=me),t}function E(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,o=e.length,r=null,n="",i=0;!/[A-Z]/.test(t=e.charAt(i));){if(i>=2)throw"MGRSPoint bad conversion from: "+e;n+=t,i++}var a=parseInt(n,10);if(0===i||i+3>o)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(i++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;r=e.substring(i,i+=2);for(var l=S(a),c=function(e,t){for(var o=ye.charCodeAt(t-1),r=1e5,n=!1;o!==e.charCodeAt(0);){if(++o===Te&&o++,o===_e&&o++,o>Ee){if(n)throw"Bad character: "+e;o=ve,n=!0}r+=1e5}return r}(r.charAt(0),l),u=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var o=Ce.charCodeAt(t-1),r=0,n=!1;o!==e.charCodeAt(0);){if(++o===Te&&o++,o===_e&&o++,o>Se){if(n)throw"Bad character: "+e;o=ve,n=!0}r+=1e5}return r}(r.charAt(1),l);u<L(s);)u+=2e6;var h=o-i;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,p,f,g=h/2,m=0,y=0;return g>0&&(d=1e5/Math.pow(10,g),p=e.substring(i,i+g),m=parseFloat(p)*d,f=e.substring(i+g),y=parseFloat(f)*d),{easting:m+c,northing:y+u,zoneLetter:s,zoneNumber:a,accuracy:d}}function L(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function w(e,t,o){if(!(this instanceof w))return new w(e,t,o);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=o||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var b=1,x=2,A=4,P=5,R=484813681109536e-20,M=Math.PI/2,I=.16666666666666666,O=.04722222222222222,N=.022156084656084655,D=void 0===Number.EPSILON?1e-10:Number.EPSILON,F=.017453292519943295,k=57.29577951308232,G=Math.PI/4,B=2*Math.PI,U={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},j={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},W=/[\s_\-\/\(\)]/g,V=function(t){var o,r,n,i={},a=t.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var o=t.split("=");return o.push(!0),e[o[0].toLowerCase()]=o[1],e},{}),s={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*F},lat_1:function(e){i.lat1=e*F},lat_2:function(e){i.lat2=e*F},lat_ts:function(e){i.lat_ts=e*F},lon_0:function(e){i.long0=e*F},lon_1:function(e){i.long1=e*F},lon_2:function(e){i.long2=e*F},alpha:function(e){i.alpha=parseFloat(e)*F},lonc:function(e){i.longc=e*F},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(t){i.units=t;var o=e(j,t);o&&(i.to_meter=o.to_meter)},from_greenwich:function(e){i.from_greenwich=e*F},pm:function(t){var o=e(U,t);i.from_greenwich=(o||parseFloat(t))*F},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(i.axis=e)}};for(o in a)r=a[o],o in s?"function"==typeof(n=s[o])?n(r):i[n]=r:i[o]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i},H=1,q=/\s/,X=/[A-Za-z]/,Y=/[A-Za-z84]/,K=/[,\]]/,z=/[\d\.E\-\+]/;t.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;q.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case H:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},t.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(K.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},t.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=H)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=H,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},t.prototype.number=function(e){if(!z.test(e)){if(K.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},t.prototype.quoted=function(e){return'"'===e?void(this.state=5):void(this.word+=e)},t.prototype.keyword=function(e){if(Y.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=H)}if(!K.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},t.prototype.neutral=function(e){if(X.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(z.test(e))return this.word=e,void(this.state=3);if(!K.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},t.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var $=.017453292519943295,J=function(e){var t=o(e),r=t.shift(),i=t.shift();t.unshift(["name",i]),t.unshift(["type",r]);var s={};return n(t,s),a(s),s};!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(s);var Z=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Q=function(e,t){e=e||{};var o,r;if(!t)return e;for(r in t)void 0!==(o=t[r])&&(e[r]=o);return e},ee=function(e,t,o){var r=e*t;return o/Math.sqrt(1-r*r)},te=function(e){return e<0?-1:1},oe=function(e){return Math.abs(e)<=3.14159265359?e:e-te(e)*B},re=function(e,t,o){var r=e*o,n=.5*e;return r=Math.pow((1-r)/(1+r),n),Math.tan(.5*(M-t))/r},ne=function(e,t){for(var o,r,n=.5*e,i=M-2*Math.atan(t),a=0;a<=15;a++)if(o=e*Math.sin(i),i+=r=M-2*Math.atan(t*Math.pow((1-o)/(1+o),n))-i,Math.abs(r)<=1e-10)return i;return-9999},ie=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,o,r=e.x,n=e.y;if(n*k>90&&n*k<-90&&r*k>180&&r*k<-180)return null;if(Math.abs(Math.abs(n)-M)<=D)return null;if(this.sphere)t=this.x0+this.a*this.k0*oe(r-this.long0),o=this.y0+this.a*this.k0*Math.log(Math.tan(G+.5*n));else{var i=Math.sin(n),a=re(this.e,n,i);t=this.x0+this.a*this.k0*oe(r-this.long0),o=this.y0-this.a*this.k0*Math.log(a)}return e.x=t,e.y=o,e},inverse:function(e){var t,o,r=e.x-this.x0,n=e.y-this.y0;if(this.sphere)o=M-2*Math.atan(Math.exp(-n/(this.a*this.k0)));else{var i=Math.exp(-n/(this.a*this.k0));if(-9999===(o=ne(this.e,i)))return null}return t=oe(this.long0+r/(this.a*this.k0)),e.x=t,e.y=o,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:c,inverse:c,names:["longlat","identity"]}],ae={},se=[],le={start:function(){ie.forEach(u)},add:u,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==ae[t]&&se[ae[t]]?se[ae[t]]:void 0}},ce={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ue=ce.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ce.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var he={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};h.projections=le,h.projections.start();var de=function(e,t,o){return function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===b?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==x||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)?o:e.datum_type===P||t.datum_type===P?o:e.es!==t.es||e.a!==t.a||d(e.datum_type)||d(t.datum_type)?(o=function(e,t,o){var r,n,i,a,s=e.x,l=e.y,c=e.z?e.z:0;if(l<-M&&l>-1.001*M)l=-M;else if(l>M&&l<1.001*M)l=M;else if(l<-M||l>M)return null;return s>Math.PI&&(s-=2*Math.PI),n=Math.sin(l),a=Math.cos(l),i=n*n,{x:((r=o/Math.sqrt(1-t*i))+c)*a*Math.cos(s),y:(r+c)*a*Math.sin(s),z:(r*(1-t)+c)*n}}(o,e.es,e.a),d(e.datum_type)&&(o=function(e,t,o){if(t===b)return{x:e.x+o[0],y:e.y+o[1],z:e.z+o[2]};if(t===x){var r=o[0],n=o[1],i=o[2],a=o[3],s=o[4],l=o[5],c=o[6];return{x:c*(e.x-l*e.y+s*e.z)+r,y:c*(l*e.x+e.y-a*e.z)+n,z:c*(-s*e.x+a*e.y+e.z)+i}}}(o,e.datum_type,e.datum_params)),d(t.datum_type)&&(o=function(e,t,o){if(t===b)return{x:e.x-o[0],y:e.y-o[1],z:e.z-o[2]};if(t===x){var r=o[0],n=o[1],i=o[2],a=o[3],s=o[4],l=o[5],c=o[6],u=(e.x-r)/c,h=(e.y-n)/c,d=(e.z-i)/c;return{x:u+l*h-s*d,y:-l*u+h+a*d,z:s*u-a*h+d}}}(o,t.datum_type,t.datum_params)),function(e,t,o,r){var n,i,a,s,l,c,u,h,d,p,f,g,m,y,C,v=1e-12,T=e.x,_=e.y,S=e.z?e.z:0;if(n=Math.sqrt(T*T+_*_),i=Math.sqrt(T*T+_*_+S*S),n/o<v){if(y=0,i/o<v)return C=-r,{x:e.x,y:e.y,z:e.z}}else y=Math.atan2(_,T);a=S/i,h=(s=n/i)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*s*s)),d=a*l,m=0;do{m++,c=t*(u=o/Math.sqrt(1-t*d*d))/(u+(C=n*h+S*d-u*(1-t*d*d))),g=(f=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(p=s*(1-c)*l)*d,h=p,d=f}while(g*g>1e-24&&m<30);return{x:y,y:Math.atan(f/Math.abs(p)),z:C}}(o,t.es,t.a,t.b)):o},pe=function(e,t,o){var r,n,i,a=o.x,s=o.y,l=o.z||0,c={};for(i=0;i<3;i++)if(!t||2!==i||void 0!==o.z)switch(0===i?(r=a,n="x"):1===i?(r=s,n="y"):(r=l,n="z"),e.axis[i]){case"e":c[n]=r;break;case"w":c[n]=-r;break;case"n":c[n]=r;break;case"s":c[n]=-r;break;case"u":void 0!==o[n]&&(c.z=r);break;case"d":void 0!==o[n]&&(c.z=-r);break;default:return null}return c},fe=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t},ge=h("WGS84"),me=6,ye="AJSAJS",Ce="AFAFAF",ve=65,Te=73,_e=79,Se=86,Ee=90,Le={forward:y,inverse:function(e){var t=_(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:C};w.fromMGRS=function(e){return new w(C(e))},w.prototype.toMGRS=function(e){return y([this.x,this.y],e)};var we,be=.01953125,xe=.01068115234375,Ae=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(be+e*xe))),t[1]=e*(.75-e*(.046875+e*(be+e*xe)));var o=e*e;return t[2]=o*(.46875-e*(.013020833333333334+.007120768229166667*e)),o*=e,t[3]=o*(.3645833333333333-.005696614583333333*e),t[4]=o*e*.3076171875,t},Pe=function(e,t,o,r){return o*=t,t*=t,r[0]*e-o*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))},Re=function(e,t,o){for(var r=1/(1-t),n=e,i=20;i;--i){var a=Math.sin(n),s=1-t*a*a;if(n-=s=(Pe(n,a,Math.cos(n),o)-e)*(s*Math.sqrt(s))*r,Math.abs(s)<D)return n}return n},Me={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Ae(this.es),this.ml0=Pe(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,o,r,n=e.x,i=e.y,a=oe(n-this.long0),s=Math.sin(i),l=Math.cos(i);if(this.es){var c=l*a,u=Math.pow(c,2),h=this.ep2*Math.pow(l,2),d=Math.pow(h,2),p=Math.abs(l)>D?Math.tan(i):0,f=Math.pow(p,2),g=Math.pow(f,2);t=1-this.es*Math.pow(s,2),c/=Math.sqrt(t);var m=Pe(i,s,l,this.en);o=this.a*(this.k0*c*(1+u/6*(1-f+h+u/20*(5-18*f+g+14*h-58*f*h+u/42*(61+179*g-g*f-479*f)))))+this.x0,r=this.a*(this.k0*(m-this.ml0+s*a*c/2*(1+u/12*(5-f+9*h+4*d+u/30*(61+g-58*f+270*h-330*f*h+u/56*(1385+543*g-g*f-3111*f))))))+this.y0}else{var y=l*Math.sin(a);if(Math.abs(Math.abs(y)-1)<D)return 93;if(o=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,r=l*Math.cos(a)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(r))>=1){if(y-1>D)return 93;r=0}else r=Math.acos(r);i<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return e.x=o,e.y=r,e},inverse:function(e){var t,o,r,n,i=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,o=Re(t,this.es,this.en),Math.abs(o)<M){var s=Math.sin(o),l=Math.cos(o),c=Math.abs(l)>D?Math.tan(o):0,u=this.ep2*Math.pow(l,2),h=Math.pow(u,2),d=Math.pow(c,2),p=Math.pow(d,2);t=1-this.es*Math.pow(s,2);var f=i*Math.sqrt(t)/this.k0,g=Math.pow(f,2);r=o-(t*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*d-9*u*d+u-4*h-g/30*(61+90*d-252*u*d+45*p+46*u-g/56*(1385+3633*d+4095*p+1574*p*d)))),n=oe(this.long0+f*(1-g/6*(1+2*d+u-g/20*(5+28*d+24*p+8*u*d+6*u-g/42*(61+662*d+1320*p+720*p*d))))/l)}else r=M*te(a),n=0;else{var m=Math.exp(i/this.k0),y=.5*(m-1/m),C=this.lat0+a/this.k0,v=Math.cos(C);t=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(y,2))),r=Math.asin(t),a<0&&(r=-r),n=0===y&&0===v?0:oe(Math.atan2(y,v)+this.long0)}return e.x=n,e.y=r,e},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Ie=function(e){var t=Math.exp(e);return(t-1/t)/2},Oe=function(e,t){e=Math.abs(e),t=Math.abs(t);var o=Math.max(e,t),r=Math.min(e,t)/(o||1);return o*Math.sqrt(1+Math.pow(r,2))},Ne=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,o=t-1;return 0===o?e:e*Math.log(t)/o}(t*(1+t/(Oe(1,t)+1))),e<0?-t:t},De=function(e,t){for(var o,r=2*Math.cos(2*t),n=e.length-1,i=e[n],a=0;--n>=0;)o=r*i-a+e[n],a=i,i=o;return t+o*Math.sin(2*t)},Fe=function(e,t){for(var o,r=2*Math.cos(t),n=e.length-1,i=e[n],a=0;--n>=0;)o=r*i-a+e[n],a=i,i=o;return Math.sin(t)*o},ke=function(e,t,o){for(var r,n,i=Math.sin(t),a=Math.cos(t),s=Ie(o),l=function(e){var t=Math.exp(e);return(t+1/t)/2}(o),c=2*a*l,u=-2*i*s,h=e.length-1,d=e[h],p=0,f=0,g=0;--h>=0;)r=f,n=p,d=c*(f=d)-r-u*(p=g)+e[h],g=u*f-n+c*p;return[(c=i*l)*d-(u=a*s)*g,c*g+u*d]},Ge={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),o=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),o*=t,this.cgb[1]=o*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=o*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),o*=t,this.cgb[2]=o*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=o*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),o*=t,this.cgb[3]=o*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=o*(1237/630+t*(t*(-24832/14175)-2.4)),o*=t,this.cgb[4]=o*(4174/315+t*(-144838/6237)),this.cbg[4]=o*(-734/315+t*(109598/31185)),o*=t,this.cgb[5]=o*(601676/22275),this.cbg[5]=o*(444337/155925),o=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+o*(.25+o*(1/64+o/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=o*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=o*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),o*=t,this.utg[2]=o*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=o*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),o*=t,this.utg[3]=o*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=o*(49561/161280+t*(-179/168+t*(6601661/7257600))),o*=t,this.utg[4]=o*(-4583/161280+t*(108847/3991680)),this.gtu[4]=o*(34729/80640+t*(-3418889/1995840)),o*=t,this.utg[5]=-.03233083094085698*o,this.gtu[5]=.6650675310896665*o;var r=De(this.cbg,this.lat0);this.Zb=-this.Qn*(r+Fe(this.gtu,2*r))},forward:function(e){var t=oe(e.x-this.long0),o=e.y;o=De(this.cbg,o);var r=Math.sin(o),n=Math.cos(o),i=Math.sin(t),a=Math.cos(t);o=Math.atan2(r,a*n),t=Math.atan2(i*n,Oe(r,n*a)),t=Ne(Math.tan(t));var s,l,c=ke(this.gtu,2*o,2*t);o+=c[0],t+=c[1];return Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*o+this.Zb)+this.y0):(s=1/0,l=1/0),e.x=s,e.y=l,e},inverse:function(e){var t,o,r=(e.x-this.x0)*(1/this.a),n=(e.y-this.y0)*(1/this.a);n=(n-this.Zb)/this.Qn,r/=this.Qn;if(Math.abs(r)<=2.623395162778){var i=ke(this.utg,2*n,2*r);n+=i[0],r+=i[1],r=Math.atan(Ie(r));var a=Math.sin(n),s=Math.cos(n),l=Math.sin(r),c=Math.cos(r);n=Math.atan2(a*c,Oe(l,c*s)),r=Math.atan2(l,c*s),t=oe(r+this.long0),o=De(this.cgb,n)}else t=1/0,o=1/0;return e.x=t,e.y=o,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Be=function(e,t){if(void 0===e){if((e=Math.floor(30*(oe(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e},Ue={init:function(){var e=Be(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*F,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Ge.init.apply(this),this.forward=Ge.forward,this.inverse=Ge.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},je=function(e,t){return Math.pow((1-e)/(1+e),t)},We=20,Ve={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+G)/(Math.pow(Math.tan(.5*this.lat0+G),this.C)*je(this.e*e,this.ratexp))},forward:function(e){var t=e.x,o=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*o+G),this.C)*je(this.e*Math.sin(o),this.ratexp))-M,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,o=e.y,r=Math.pow(Math.tan(.5*o+G)/this.K,1/this.C),n=We;n>0&&(o=2*Math.atan(r*je(this.e*Math.sin(e.y),-.5*this.e))-M,!(Math.abs(o-e.y)<1e-14));--n)e.y=o;return n?(e.x=t,e.y=o,e):null},names:["gauss"]},He={init:function(){Ve.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,o,r,n;return e.x=oe(e.x-this.long0),Ve.forward.apply(this,[e]),t=Math.sin(e.y),o=Math.cos(e.y),r=Math.cos(e.x),n=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*o*r),e.x=n*o*Math.sin(e.x),e.y=n*(this.cosc0*t-this.sinc0*o*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,o,r,n,i;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,i=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(i,this.R2);t=Math.sin(a),o=Math.cos(a),n=Math.asin(o*this.sinc0+e.y*t*this.cosc0/i),r=Math.atan2(e.x*t,i*this.cosc0*o-e.y*this.sinc0*t)}else n=this.phic0,r=0;return e.x=r,e.y=n,Ve.inverse.apply(this,[e]),e.x=oe(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},qe={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*(1+te(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=D&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*this.cons*ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/re(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ee(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-M,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,o,r,n,i,a,s=e.x,l=e.y,c=Math.sin(l),u=Math.cos(l),h=oe(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=D&&Math.abs(l+this.lat0)<=D?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(h)),e.x=this.a*t*u*Math.sin(h)+this.x0,e.y=this.a*t*(this.coslat0*c-this.sinlat0*u*Math.cos(h))+this.y0,e):(o=2*Math.atan(this.ssfn_(l,c,this.e))-M,n=Math.cos(o),r=Math.sin(o),Math.abs(this.coslat0)<=D?(i=re(this.e,l*this.con,this.con*c),a=2*this.a*this.k0*i/this.cons,e.x=this.x0+a*Math.sin(s-this.long0),e.y=this.y0-this.con*a*Math.cos(s-this.long0),e):(Math.abs(this.sinlat0)<D?(t=2*this.a*this.k0/(1+n*Math.cos(h)),e.y=t*r):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*n*Math.cos(h))),e.y=t*(this.cosX0*r-this.sinX0*n*Math.cos(h))+this.y0),e.x=t*n*Math.sin(h)+this.x0,e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,n,i,a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var s=2*Math.atan(a/(.5*this.a*this.k0));return t=this.long0,o=this.lat0,a<=D?(e.x=t,e.y=o,e):(o=Math.asin(Math.cos(s)*this.sinlat0+e.y*Math.sin(s)*this.coslat0/a),t=oe(Math.abs(this.coslat0)<D?this.lat0>0?this.long0+Math.atan2(e.x,-1*e.y):this.long0+Math.atan2(e.x,e.y):this.long0+Math.atan2(e.x*Math.sin(s),a*this.coslat0*Math.cos(s)-e.y*this.sinlat0*Math.sin(s))),e.x=t,e.y=o,e)}if(Math.abs(this.coslat0)<=D){if(a<=D)return o=this.lat0,t=this.long0,e.x=t,e.y=o,e;e.x*=this.con,e.y*=this.con,r=a*this.cons/(2*this.a*this.k0),o=this.con*ne(this.e,r),t=this.con*oe(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=D?i=this.X0:(i=Math.asin(Math.cos(n)*this.sinX0+e.y*Math.sin(n)*this.cosX0/a),t=oe(this.long0+Math.atan2(e.x*Math.sin(n),a*this.cosX0*Math.cos(n)-e.y*this.sinX0*Math.sin(n)))),o=-1*ne(this.e,Math.tan(.5*(M+i)));return e.x=t,e.y=o,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,o){return t*=o,Math.tan(.5*(M+e))*Math.pow((1-t)/(1+t),.5*o)}},Xe={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),o=this.a,r=1/this.rf,n=2*r-Math.pow(r,2),i=this.e=Math.sqrt(n);this.R=this.k0*o*Math.sqrt(1-n)/(1-n*Math.pow(t,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+i*t)/(1-i*t));this.K=a-this.alpha*s+this.alpha*i/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),o=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+o)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),i=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(i))),s=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(i));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,o=e.y-this.y0,r=t/this.R,n=2*(Math.atan(Math.exp(o/this.R))-Math.PI/4),i=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),s=this.lambda0+a/this.alpha,l=0,c=i,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+i/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=c,e},names:["somerc"]},Ye={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),o=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-o*o);var r,n,i=re(this.e,this.lat0,e),a=this.bl/t*Math.sqrt((1-this.es)/(1-o*o));a*a<1&&(a=1);if(isNaN(this.longc)){var s=re(this.e,this.lat1,Math.sin(this.lat1)),l=re(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(i,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(i,this.bl);var c=Math.pow(s,this.bl),u=Math.pow(l,this.bl);n=.5*((r=this.el/c)-1/r);var h=(this.el*this.el-u*c)/(this.el*this.el+u*c),d=(u-c)/(u+c),p=oe(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(h*Math.tan(.5*this.bl*p)/d)/this.bl,this.long0=oe(this.long0);var f=oe(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*f)/n),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else r=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=r*Math.pow(i,this.bl),n=.5*(r-1/r),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(n*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},forward:function(e){var t,o,r,n=e.x,i=e.y,a=oe(n-this.long0);if(Math.abs(Math.abs(i)-M)<=D)r=i>0?-1:1,o=this.al/this.bl*Math.log(Math.tan(G+r*this.gamma0*.5)),t=-1*r*M*this.al/this.bl;else{var s=re(this.e,i,Math.sin(i)),l=this.el/Math.pow(s,this.bl),c=.5*(l-1/l),u=.5*(l+1/l),h=Math.sin(this.bl*a),d=(c*Math.sin(this.gamma0)-h*Math.cos(this.gamma0))/u;o=Math.abs(Math.abs(d)-1)<=D?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-d)/(1+d))/this.bl,t=Math.abs(Math.cos(this.bl*a))<=D?this.al*this.bl*a:this.al*Math.atan2(c*Math.cos(this.gamma0)+h*Math.sin(this.gamma0),Math.cos(this.bl*a))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+o):(t-=this.uc,e.x=this.x0+o*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-o*Math.sin(this.alpha)),e},inverse:function(e){var t,o;this.no_rot?(o=e.y-this.y0,t=e.x-this.x0):(o=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var r=Math.exp(-1*this.bl*o/this.al),n=.5*(r-1/r),i=.5*(r+1/r),a=Math.sin(this.bl*t/this.al),s=(a*Math.cos(this.gamma0)+n*Math.sin(this.gamma0))/i,l=Math.pow(this.el/Math.sqrt((1+s)/(1-s)),1/this.bl);return Math.abs(s-1)<D?(e.x=this.long0,e.y=M):Math.abs(s+1)<D?(e.x=this.long0,e.y=-1*M):(e.y=ne(this.e,l),e.x=oe(this.long0-Math.atan2(n*Math.cos(this.gamma0)-a*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},Ke={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<D)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),o=Math.cos(this.lat1),r=ee(this.e,t,o),n=re(this.e,this.lat1,t),i=Math.sin(this.lat2),a=Math.cos(this.lat2),s=ee(this.e,i,a),l=re(this.e,this.lat2,i),c=re(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>D?this.ns=Math.log(r/s)/Math.log(n/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(n,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,o=e.y;Math.abs(2*Math.abs(o)-Math.PI)<=D&&(o=te(o)*(M-2*D));var r,n,i=Math.abs(Math.abs(o)-M);if(i>D)r=re(this.e,o,Math.sin(o)),n=this.a*this.f0*Math.pow(r,this.ns);else{if((i=o*this.ns)<=0)return null;n=0}var a=this.ns*oe(t-this.long0);return e.x=this.k0*(n*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-n*Math.cos(a))+this.y0,e},inverse:function(e){var t,o,r,n,i,a=(e.x-this.x0)/this.k0,s=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+s*s),o=1):(t=-Math.sqrt(a*a+s*s),o=-1);var l=0;if(0!==t&&(l=Math.atan2(o*a,o*s)),0!==t||this.ns>0){if(o=1/this.ns,r=Math.pow(t/(this.a*this.f0),o),-9999===(n=ne(this.e,r)))return null}else n=-M;return i=oe(l/this.ns+this.long0),e.x=i,e.y=n,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},ze={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,o,r,n,i,a,s,l=e.x,c=e.y,u=oe(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),o=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),r=-u*this.alfa,n=Math.asin(Math.cos(this.ad)*Math.sin(o)+Math.sin(this.ad)*Math.cos(o)*Math.cos(r)),i=Math.asin(Math.cos(o)*Math.sin(r)/Math.cos(n)),a=this.n*i,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(n/2+this.s45),this.n),e.y=s*Math.cos(a)/1,e.x=s*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,o,r,n,i,a,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),i=Math.sqrt(e.x*e.x+e.y*e.y),n=Math.atan2(e.y,e.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/i,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(t)),e.x=this.long0-o/this.alfa,a=t,s=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(s=1),a=e.y,c+=1}while(0===s&&c<15);return c>=15?null:e},names:["Krovak","krovak"]},$e=function(e,t,o,r,n){return e*n-t*Math.sin(2*n)+o*Math.sin(4*n)-r*Math.sin(6*n)},Je=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},Ze=function(e){return.375*e*(1+.25*e*(1+.46875*e))},Qe=function(e){return.05859375*e*e*(1+.75*e)},et=function(e){return e*e*e*(35/3072)},tt=function(e,t,o){var r=t*o;return e/Math.sqrt(1-r*r)},ot=function(e){return Math.abs(e)<M?e:e-te(e)*Math.PI},rt=function(e,t,o,r,n){var i,a;i=e/t;for(var s=0;s<15;s++)if(i+=a=(e-(t*i-o*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)))/(t-2*o*Math.cos(2*i)+4*r*Math.cos(4*i)-6*n*Math.cos(6*i)),Math.abs(a)<=1e-10)return i;return NaN},nt={init:function(){this.sphere||(this.e0=Je(this.es),this.e1=Ze(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,o,r=e.x,n=e.y;if(r=oe(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(n)*Math.sin(r)),o=this.a*(Math.atan2(Math.tan(n),Math.cos(r))-this.lat0);else{var i=Math.sin(n),a=Math.cos(n),s=tt(this.a,this.e,i),l=Math.tan(n)*Math.tan(n),c=r*Math.cos(n),u=c*c,h=this.es*a*a/(1-this.es);t=s*c*(1-u*l*(1/6-(8-l+8*h)*u/120)),o=this.a*$e(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+s*i/a*u*(.5+(5-l+6*h)*u/24)}return e.x=t+this.x0,e.y=o+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r=e.x/this.a,n=e.y/this.a;if(this.sphere){var i=n+this.lat0;t=Math.asin(Math.sin(i)*Math.cos(r)),o=Math.atan2(Math.tan(r),Math.cos(i))}else{var a=this.ml0/this.a+n,s=rt(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-M)<=D)return e.x=this.long0,e.y=M,n<0&&(e.y*=-1),e;var l=tt(this.a,this.e,Math.sin(s)),c=l*l*l/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),h=r*this.a/l,d=h*h;t=s-l*Math.tan(s)/c*h*h*(.5-(1+3*u)*h*h/24),o=h*(1-d*(u/3+(1+3*u)*u*d/15))/Math.cos(s)}return e.x=oe(o+this.long0),e.y=ot(t),e},names:["Cassini","Cassini_Soldner","cass"]},it=function(e,t){var o;return e>1e-7?(1-e*e)*(t/(1-(o=e*t)*o)-.5/e*Math.log((1-o)/(1+o))):2*t},at=.3333333333333333,st=.17222222222222222,lt=.10257936507936508,ct=.06388888888888888,ut=.0664021164021164,ht=.016415012942191543,dt={init:function(){var e=Math.abs(this.lat0);if(Math.abs(e-M)<D?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<D?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=it(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,o=[];return o[0]=e*at,t=e*e,o[0]+=t*st,o[1]=t*ct,t*=e,o[0]+=t*lt,o[1]+=t*ut,o[2]=t*ht,o}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=it(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,o,r,n,i,a,s,l,c,u,h=e.x,d=e.y;if(h=oe(h-this.long0),this.sphere){if(i=Math.sin(d),u=Math.cos(d),r=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((o=this.mode===this.EQUIT?1+u*r:1+this.sinph0*i+this.cosph0*u*r)<=D)return null;t=(o=Math.sqrt(2/o))*u*Math.sin(h),o*=this.mode===this.EQUIT?i:this.cosph0*i-this.sinph0*u*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(d+this.phi0)<D)return null;o=G-.5*d,t=(o=2*(this.mode===this.S_POLE?Math.cos(o):Math.sin(o)))*Math.sin(h),o*=r}}else{switch(s=0,l=0,c=0,r=Math.cos(h),n=Math.sin(h),i=Math.sin(d),a=it(this.e,i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=a/this.qp,l=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:c=1+this.sinb1*s+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=M+d,a=this.qp-a;break;case this.S_POLE:c=d-M,a=this.qp+a}if(Math.abs(c)<D)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),o=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*s-this.sinb1*l*r):(c=Math.sqrt(2/(1+l*r)))*s*this.ymf,t=this.xmf*c*l*n;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(c=Math.sqrt(a))*n,o=r*(this.mode===this.S_POLE?c:-c)):t=o=0}}return e.x=this.a*t+this.x0,e.y=this.a*o+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,n,i,a,s,l=e.x/this.a,c=e.y/this.a;if(this.sphere){var u,h=0,d=0;if((o=.5*(u=Math.sqrt(l*l+c*c)))>1)return null;switch(o=2*Math.asin(o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(d=Math.sin(o),h=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(u)<=D?0:Math.asin(c*d/u),l*=d,c=h*u;break;case this.OBLIQ:o=Math.abs(u)<=D?this.phi0:Math.asin(h*this.sinph0+c*d*this.cosph0/u),l*=d*this.cosph0,c=(h-Math.sin(o)*this.sinph0)*u;break;case this.N_POLE:c=-c,o=M-o;break;case this.S_POLE:o-=M}t=0!==c||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,c):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,c*=this.dd,(a=Math.sqrt(l*l+c*c))<D)return e.x=0,e.y=this.phi0,e;n=2*Math.asin(.5*a/this.rq),r=Math.cos(n),l*=n=Math.sin(n),this.mode===this.OBLIQ?(s=r*this.sinb1+c*n*this.cosb1/a,i=this.qp*s,c=a*this.cosb1*r-c*this.sinb1*n):(s=c*n/a,i=this.qp*s,c=a*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(c=-c),!(i=l*l+c*c))return e.x=0,e.y=this.phi0,e;s=1-i/this.qp,this.mode===this.S_POLE&&(s=-s)}t=Math.atan2(l,c),o=function(e,t){var o=e+e;return e+t[0]*Math.sin(o)+t[1]*Math.sin(o+o)+t[2]*Math.sin(o+o+o)}(Math.asin(s),this.apa)}return e.x=oe(this.long0+t),e.y=o,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},pt=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},ft={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ee(this.e3,this.sin_po,this.cos_po),this.qs1=it(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ee(this.e3,this.sin_po,this.cos_po),this.qs2=it(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=it(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>D?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,o=e.y;this.sin_phi=Math.sin(o),this.cos_phi=Math.cos(o);var r=it(this.e3,this.sin_phi,this.cos_phi),n=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,i=this.ns0*oe(t-this.long0),a=n*Math.sin(i)+this.x0,s=this.rh-n*Math.cos(i)+this.y0;return e.x=a,e.y=s,e},inverse:function(e){var t,o,r,n,i,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),n=0,0!==t&&(n=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(o=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,o)),i=oe(n/this.ns0+this.long0),e.x=i,e.y=a,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var o,r,n,i,a,s=pt(.5*t);if(e<D)return s;for(var l=e*e,c=1;c<=25;c++)if(o=Math.sin(s),r=Math.cos(s),s+=a=.5*(i=1-(n=e*o)*n)*i/r*(t/(1-l)-o/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return s;return null}},gt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,o,r,n,i,a,s,l=e.x,c=e.y;return r=oe(l-this.long0),t=Math.sin(c),o=Math.cos(c),n=Math.cos(r),(i=this.sin_p14*t+this.cos_p14*o*n)>0||Math.abs(i)<=D?(a=this.x0+1*this.a*o*Math.sin(r)/i,s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*o*n)/i):(a=this.x0+this.infinity_dist*o*Math.sin(r),s=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*o*n)),e.x=a,e.y=s,e},inverse:function(e){var t,o,r,n,i,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(n=Math.atan2(t,this.rc),o=Math.sin(n),r=Math.cos(n),a=pt(r*this.sin_p14+e.y*o*this.cos_p14/t),i=Math.atan2(e.x*o,t*this.cos_p14*r-e.y*this.sin_p14*o),i=oe(this.long0+i)):(a=this.phic0,i=0),e.x=i,e.y=a,e},names:["gnom"]},mt=function(e,t){var o=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-o)<1e-6)return t<0?-1*M:M;for(var r,n,i,a,s=Math.asin(.5*t),l=0;l<30;l++)if(n=Math.sin(s),i=Math.cos(s),a=e*n,s+=r=Math.pow(1-a*a,2)/(2*i)*(t/(1-e*e)-n/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),Math.abs(r)<=1e-10)return s;return NaN},yt={init:function(){this.sphere||(this.k0=ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,o,r=e.x,n=e.y,i=oe(r-this.long0);if(this.sphere)t=this.x0+this.a*i*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var a=it(this.e,Math.sin(n));t=this.x0+this.a*this.k0*i,o=this.y0+this.a*a*.5/this.k0}return e.x=t,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o;return this.sphere?(t=oe(this.long0+e.x/this.a/Math.cos(this.lat_ts)),o=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(o=mt(this.e,2*e.y*this.k0/this.a),t=oe(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=o,e},names:["cea"]},Ct={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,o=e.y,r=oe(t-this.long0),n=ot(o-this.lat0);return e.x=this.x0+this.a*r*this.rc,e.y=this.y0+this.a*n,e},inverse:function(e){var t=e.x,o=e.y;return e.x=oe(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=ot(this.lat0+(o-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},vt=20,Tt={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Je(this.es),this.e1=Ze(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.ml0=this.a*$e(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,o,r,n=e.x,i=e.y,a=oe(n-this.long0);if(r=a*Math.sin(i),this.sphere)Math.abs(i)<=D?(t=this.a*a,o=-1*this.a*this.lat0):(t=this.a*Math.sin(r)/Math.tan(i),o=this.a*(ot(i-this.lat0)+(1-Math.cos(r))/Math.tan(i)));else if(Math.abs(i)<=D)t=this.a*a,o=-1*this.ml0;else{var s=tt(this.a,this.e,Math.sin(i))/Math.tan(i);t=s*Math.sin(r),o=this.a*$e(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*(1-Math.cos(r))}return e.x=t+this.x0,e.y=o+this.y0,e},inverse:function(e){var t,o,r,n,i,a,s,l,c;if(r=e.x-this.x0,n=e.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=D)t=oe(r/this.a+this.long0),o=0;else{a=this.lat0+n/this.a,s=r*r/this.a/this.a+a*a,l=a;var u;for(i=vt;i;--i)if(l+=c=-1*(a*(l*(u=Math.tan(l))+1)-l-.5*(l*l+s)*u)/((l-a)/u-1),Math.abs(c)<=D){o=l;break}t=oe(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(o))}else if(Math.abs(n+this.ml0)<=D)o=0,t=oe(this.long0+r/this.a);else{a=(this.ml0+n)/this.a,s=r*r/this.a/this.a+a*a,l=a;var h,d,p,f,g;for(i=vt;i;--i)if(g=this.e*Math.sin(l),h=Math.sqrt(1-g*g)*Math.tan(l),d=this.a*$e(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(a*(h*(f=d/this.a)+1)-f-.5*h*(f*f+s))/(this.es*Math.sin(2*l)*(f*f+s-2*a*f)/(4*h)+(a-f)*(h*p-2/Math.sin(2*l))-p),Math.abs(c)<=D){o=l;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(o),2))*Math.tan(o),t=oe(this.long0+Math.asin(r*h/this.a)/Math.sin(o))}return e.x=t,e.y=o,e},names:["Polyconic","poly"]},_t={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,o=e.x,r=e.y-this.lat0,n=o-this.long0,i=r/R*1e-5,a=n,s=1,l=0;for(t=1;t<=10;t++)s*=i,l+=this.A[t]*s;var c,u=l,h=a,d=1,p=0,f=0,g=0;for(t=1;t<=6;t++)c=p*u+d*h,d=d*u-p*h,p=c,f=f+this.B_re[t]*d-this.B_im[t]*p,g=g+this.B_im[t]*d+this.B_re[t]*p;return e.x=g*this.a+this.x0,e.y=f*this.a+this.y0,e},inverse:function(e){var t,o,r=e.x,n=e.y,i=r-this.x0,a=(n-this.y0)/this.a,s=i/this.a,l=1,c=0,u=0,h=0;for(t=1;t<=6;t++)o=c*a+l*s,l=l*a-c*s,c=o,u=u+this.C_re[t]*l-this.C_im[t]*c,h=h+this.C_im[t]*l+this.C_re[t]*c;for(var d=0;d<this.iterations;d++){var p,f=u,g=h,m=a,y=s;for(t=2;t<=6;t++)p=g*u+f*h,f=f*u-g*h,g=p,m+=(t-1)*(this.B_re[t]*f-this.B_im[t]*g),y+=(t-1)*(this.B_im[t]*f+this.B_re[t]*g);f=1,g=0;var C=this.B_re[1],v=this.B_im[1];for(t=2;t<=6;t++)p=g*u+f*h,f=f*u-g*h,g=p,C+=t*(this.B_re[t]*f-this.B_im[t]*g),v+=t*(this.B_im[t]*f+this.B_re[t]*g);var T=C*C+v*v;u=(m*C+y*v)/T,h=(y*C-m*v)/T}var _=u,S=h,E=1,L=0;for(t=1;t<=9;t++)E*=_,L+=this.D[t]*E;var w=this.lat0+L*R*1e5,b=this.long0+S;return e.x=b,e.y=w,e},names:["New_Zealand_Map_Grid","nzmg"]},St={init:function(){},forward:function(e){var t=e.x,o=e.y,r=oe(t-this.long0),n=this.x0+this.a*r,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+o/2.5))*1.25;return e.x=n,e.y=i,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=oe(this.long0+e.x/this.a),o=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=o,e},names:["Miller_Cylindrical","mill"]},Et=20,Lt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Ae(this.es)},forward:function(e){var t,o,r=e.x,n=e.y;if(r=oe(r-this.long0),this.sphere){if(this.m)for(var i=this.n*Math.sin(n),a=Et;a;--a){var s=(this.m*n+Math.sin(n)-i)/(this.m+Math.cos(n));if(n-=s,Math.abs(s)<D)break}else n=1!==this.n?Math.asin(this.n*Math.sin(n)):n;t=this.a*this.C_x*r*(this.m+Math.cos(n)),o=this.a*this.C_y*n}else{var l=Math.sin(n),c=Math.cos(n);o=this.a*Pe(n,l,c,this.en),t=this.a*r*c/Math.sqrt(1-this.es*l*l)}return e.x=t,e.y=o,e},inverse:function(e){var t,o,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=pt((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=pt(Math.sin(t)/this.n)),r=oe(r+this.long0),t=ot(t)):(t=Re(e.y/this.a,this.es,this.en),(n=Math.abs(t))<M?(n=Math.sin(t),o=this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)),r=oe(o)):n-D<M&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]},wt={init:function(){},forward:function(e){for(var t=e.x,o=e.y,r=oe(t-this.long0),n=o,i=Math.PI*Math.sin(o),a=0;;a++){var s=-(n+Math.sin(n)-i)/(1+Math.cos(n));if(n+=s,Math.abs(s)<D)break}n/=2,Math.PI/2-Math.abs(o)<D&&(r=0);var l=.900316316158*this.a*r*Math.cos(n)+this.x0,c=1.4142135623731*this.a*Math.sin(n)+this.y0;return e.x=l,e.y=c,e},inverse:function(e){var t,o;e.x-=this.x0,e.y-=this.y0,o=e.y/(1.4142135623731*this.a),Math.abs(o)>.999999999999&&(o=.999999999999),t=Math.asin(o);var r=oe(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),o=(2*t+Math.sin(2*t))/Math.PI,Math.abs(o)>1&&(o=1);var n=Math.asin(o);return e.x=r,e.y=n,e},names:["Mollweide","moll"]},bt={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Je(this.es),this.e1=Ze(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ee(this.e,this.sinphi,this.cosphi),this.ml1=$e(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<D?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ee(this.e,this.sinphi,this.cosphi),this.ml2=$e(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=$e(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,o=e.x,r=e.y;if(this.sphere)t=this.a*(this.g-r);else{var n=$e(this.e0,this.e1,this.e2,this.e3,r);t=this.a*(this.g-n)}var i=this.ns*oe(o-this.long0),a=this.x0+t*Math.sin(i),s=this.y0+this.rh-t*Math.cos(i);return e.x=a,e.y=s,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,o,r,n;this.ns>=0?(o=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(o=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var i=0;if(0!==o&&(i=Math.atan2(t*e.x,t*e.y)),this.sphere)return n=oe(this.long0+i/this.ns),r=ot(this.g-o/this.a),e.x=n,e.y=r,e;var a=this.g-o/this.a;return r=rt(a,this.e0,this.e1,this.e2,this.e3),n=oe(this.long0+i/this.ns),e.x=n,e.y=r,e},names:["Equidistant_Conic","eqdc"]},xt={init:function(){this.R=this.a},forward:function(e){var t,o,r=e.x,n=e.y,i=oe(r-this.long0);Math.abs(n)<=D&&(t=this.x0+this.R*i,o=this.y0);var a=pt(2*Math.abs(n/Math.PI));(Math.abs(i)<=D||Math.abs(Math.abs(n)-M)<=D)&&(t=this.x0,o=n>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var s=.5*Math.abs(Math.PI/i-i/Math.PI),l=s*s,c=Math.sin(a),u=Math.cos(a),h=u/(c+u-1),d=h*h,p=h*(2/c-1),f=p*p,g=Math.PI*this.R*(s*(h-f)+Math.sqrt(l*(h-f)*(h-f)-(f+l)*(d-f)))/(f+l);i<0&&(g=-g),t=this.x0+g;var m=l+h;return g=Math.PI*this.R*(p*m-s*Math.sqrt((f+l)*(l+1)-m*m))/(f+l),o=n>=0?this.y0+g:this.y0-g,e.x=t,e.y=o,e},inverse:function(e){var t,o,r,n,i,a,s,l,c,u,h,d;return e.x-=this.x0,e.y-=this.y0,h=Math.PI*this.R,i=(r=e.x/h)*r+(n=e.y/h)*n,h=3*(n*n/(l=-2*(a=-Math.abs(n)*(1+i))+1+2*n*n+i*i)+(2*(s=a-2*n*n+r*r)*s*s/l/l/l-9*a*s/l/l)/27)/(c=(a-s*s/3/l)/l)/(u=2*Math.sqrt(-c/3)),Math.abs(h)>1&&(h=h>=0?1:-1),d=Math.acos(h)/3,o=e.y>=0?(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI:-(-u*Math.cos(d+Math.PI/3)-s/3/l)*Math.PI,t=Math.abs(r)<D?this.long0:oe(this.long0+Math.PI*(i-1+Math.sqrt(1+2*(r*r-n*n)+i*i))/2/r),e.x=t,e.y=o,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},At={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,o,r,n,i,a,s,l,c,u,h,d,p,f,g,m,y,C,v,T,_,S,E=e.x,L=e.y,w=Math.sin(e.y),b=Math.cos(e.y),x=oe(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=D?(e.x=this.x0+this.a*(M-L)*Math.sin(x),e.y=this.y0-this.a*(M-L)*Math.cos(x),e):Math.abs(this.sin_p12+1)<=D?(e.x=this.x0+this.a*(M+L)*Math.sin(x),e.y=this.y0+this.a*(M+L)*Math.cos(x),e):(C=this.sin_p12*w+this.cos_p12*b*Math.cos(x),y=(m=Math.acos(C))/Math.sin(m),e.x=this.x0+this.a*y*b*Math.sin(x),e.y=this.y0+this.a*y*(this.cos_p12*w-this.sin_p12*b*Math.cos(x)),e):(t=Je(this.es),o=Ze(this.es),r=Qe(this.es),n=et(this.es),Math.abs(this.sin_p12-1)<=D?(i=this.a*$e(t,o,r,n,M),a=this.a*$e(t,o,r,n,L),e.x=this.x0+(i-a)*Math.sin(x),e.y=this.y0-(i-a)*Math.cos(x),e):Math.abs(this.sin_p12+1)<=D?(i=this.a*$e(t,o,r,n,M),a=this.a*$e(t,o,r,n,L),e.x=this.x0+(i+a)*Math.sin(x),e.y=this.y0+(i+a)*Math.cos(x),e):(s=w/b,l=tt(this.a,this.e,this.sin_p12),c=tt(this.a,this.e,w),u=Math.atan((1-this.es)*s+this.es*l*this.sin_p12/(c*b)),v=0===(h=Math.atan2(Math.sin(x),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(x)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(h)-Math.PI)<=D?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(x)*Math.cos(u)/Math.sin(h)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),m=l*v*(1-(T=v*v)*(g=(p=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*p)*(1-g)/6+(_=T*v)/8*(f=d*p)*(1-2*g)+(S=_*v)/120*(g*(4-7*g)-3*d*d*(1-7*g))-S*v/48*f),e.x=this.x0+m*Math.sin(h),e.y=this.y0+m*Math.cos(h),e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,n,i,a,s,l,c,u,h,d,p,f,g,m,y,C,v,T,_,S;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*M*this.a)return;return o=t/this.a,r=Math.sin(o),n=Math.cos(o),i=this.long0,Math.abs(t)<=D?a=this.lat0:(a=pt(n*this.sin_p12+e.y*r*this.cos_p12/t),s=Math.abs(this.lat0)-M,i=oe(Math.abs(s)<=D?this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y):this.long0+Math.atan2(e.x*r,t*this.cos_p12*n-e.y*this.sin_p12*r))),e.x=i,e.y=a,e}return l=Je(this.es),c=Ze(this.es),u=Qe(this.es),h=et(this.es),Math.abs(this.sin_p12-1)<=D?(d=this.a*$e(l,c,u,h,M),t=Math.sqrt(e.x*e.x+e.y*e.y),a=rt((d-t)/this.a,l,c,u,h),i=oe(this.long0+Math.atan2(e.x,-1*e.y)),e.x=i,e.y=a,e):Math.abs(this.sin_p12+1)<=D?(d=this.a*$e(l,c,u,h,M),t=Math.sqrt(e.x*e.x+e.y*e.y),a=rt((t-d)/this.a,l,c,u,h),i=oe(this.long0+Math.atan2(e.x,e.y)),e.x=i,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),g=Math.atan2(e.x,e.y),p=tt(this.a,this.e,this.sin_p12),m=Math.cos(g),C=-(y=this.e*this.cos_p12*m)*y/(1-this.es),v=3*this.es*(1-C)*this.sin_p12*this.cos_p12*m/(1-this.es),S=1-C*(_=(T=t/p)-C*(1+C)*Math.pow(T,3)/6-v*(1+3*C)*Math.pow(T,4)/24)*_/2-T*_*_*_/6,f=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*m),i=oe(this.long0+Math.asin(Math.sin(g)*Math.sin(_)/Math.cos(f))),a=Math.atan((1-this.es*S*this.sin_p12/Math.sin(f))*Math.tan(f)/(1-this.es)),e.x=i,e.y=a,e)},names:["Azimuthal_Equidistant","aeqd"]},Pt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,o,r,n,i,a,s,l=e.x,c=e.y;return r=oe(l-this.long0),t=Math.sin(c),o=Math.cos(c),n=Math.cos(r),((i=this.sin_p14*t+this.cos_p14*o*n)>0||Math.abs(i)<=D)&&(a=1*this.a*o*Math.sin(r),s=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*o*n)),e.x=a,e.y=s,e},inverse:function(e){var t,o,r,n,i,a,s;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),o=pt(t/this.a),r=Math.sin(o),n=Math.cos(o),a=this.long0,Math.abs(t)<=D?(s=this.lat0,e.x=a,e.y=s,e):(s=pt(n*this.sin_p14+e.y*r*this.cos_p14/t),i=Math.abs(this.lat0)-M,Math.abs(i)<=D?(a=oe(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=s,e):(a=oe(this.long0+Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r)),e.x=a,e.y=s,e))},names:["ortho"]};return m.defaultDatum="WGS84",m.Proj=h,m.WGS84=new m.Proj("WGS84"),m.Point=w,m.toPoint=fe,m.defs=s,m.transform=p,m.mgrs=Le,m.version="2.4.3",(we=m).Proj.projections.add(Me),we.Proj.projections.add(Ge),we.Proj.projections.add(Ue),we.Proj.projections.add(He),we.Proj.projections.add(qe),we.Proj.projections.add(Xe),we.Proj.projections.add(Ye),we.Proj.projections.add(Ke),we.Proj.projections.add(ze),we.Proj.projections.add(nt),we.Proj.projections.add(dt),we.Proj.projections.add(ft),we.Proj.projections.add(gt),we.Proj.projections.add(yt),we.Proj.projections.add(Ct),we.Proj.projections.add(Tt),we.Proj.projections.add(_t),we.Proj.projections.add(St),we.Proj.projections.add(Lt),we.Proj.projections.add(wt),we.Proj.projections.add(bt),we.Proj.projections.add(xt),we.Proj.projections.add(At),we.Proj.projections.add(Pt),m});!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){var o=[],r=o.slice,n=o.concat,i=o.push,a=o.indexOf,s={},l=s.toString,c=s.hasOwnProperty,u={},h=e.document,d=function(e,t){return new d.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,f=/^-ms-/,g=/-([\da-z])/gi,m=function(e,t){return t.toUpperCase()};d.fn=d.prototype={jquery:"2.1.3",constructor:d,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?e<0?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=d.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return d.each(this,e,t)},map:function(e){return this.pushStack(d.map(this,function(t,o){return e.call(t,o,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,o=+e+(e<0?t:0);return this.pushStack(o>=0&&o<t?[this[o]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:i,sort:o.sort,splice:o.splice};d.extend=d.fn.extend=function(){var e,t,o,r,n,i,a=arguments[0]||{},s=1,l=arguments.length,c=!1;if("boolean"==typeof a){c=a;a=arguments[s]||{};s++}"object"==typeof a||d.isFunction(a)||(a={});if(s===l){a=this;s--}for(;s<l;s++)if(null!=(e=arguments[s]))for(t in e){o=a[t];if(a!==(r=e[t]))if(c&&r&&(d.isPlainObject(r)||(n=d.isArray(r)))){if(n){n=!1;i=o&&d.isArray(o)?o:[]}else i=o&&d.isPlainObject(o)?o:{};a[t]=d.extend(c,i,r)}else void 0!==r&&(a[t]=r)}return a};d.extend({expando:"jQuery"+("2.1.3"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===d.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!d.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"===d.type(e)&&!e.nodeType&&!d.isWindow(e)&&!(e.constructor&&!c.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?s[l.call(e)]||"object":typeof e},globalEval:function(e){var t,o=eval;if(e=d.trim(e))if(1===e.indexOf("use strict")){(t=h.createElement("script")).text=e;h.head.appendChild(t).parentNode.removeChild(t)}else o(e)},camelCase:function(e){return e.replace(f,"ms-").replace(g,m)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,o){var r=0,n=e.length,i=y(e);if(o){if(i)for(;r<n&&!1!==t.apply(e[r],o);r++);else for(r in e)if(!1===t.apply(e[r],o))break}else if(i)for(;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var o=t||[];null!=e&&(y(Object(e))?d.merge(o,"string"==typeof e?[e]:e):i.call(o,e));return o},inArray:function(e,t,o){return null==t?-1:a.call(t,e,o)},merge:function(e,t){for(var o=+t.length,r=0,n=e.length;r<o;r++)e[n++]=t[r];e.length=n;return e},grep:function(e,t,o){for(var r=[],n=0,i=e.length,a=!o;n<i;n++)!t(e[n],n)!==a&&r.push(e[n]);return r},map:function(e,t,o){var r,i=0,a=e.length,s=[];if(y(e))for(;i<a;i++)null!=(r=t(e[i],i,o))&&s.push(r);else for(i in e)null!=(r=t(e[i],i,o))&&s.push(r);return n.apply([],s)},guid:1,proxy:function(e,t){var o,n,i;if("string"==typeof t){o=e[t];t=e;e=o}if(d.isFunction(e)){n=r.call(arguments,2);(i=function(){return e.apply(t||this,n.concat(r.call(arguments)))}).guid=e.guid=e.guid||d.guid++;return i}},now:Date.now,support:u});d.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){s["[object "+t+"]"]=t.toLowerCase()});function y(e){var t=e.length,o=d.type(e);return"function"!==o&&!d.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===o||0===t||"number"==typeof t&&t>0&&t-1 in e))}var C=function(e){var t,o,r,n,i,a,s,l,c,u,h,d,p,f,g,m,y,C,v,T="sizzle"+1*new Date,_=e.document,S=0,E=0,L=ae(),w=ae(),b=ae(),x=function(e,t){e===t&&(h=!0);return 0},A=1<<31,P={}.hasOwnProperty,R=[],M=R.pop,I=R.push,O=R.push,N=R.slice,D=function(e,t){for(var o=0,r=e.length;o<r;o++)if(e[o]===t)return o;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",k="[\\x20\\t\\r\\n\\f]",G="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",B=G.replace("w","w#"),U="\\["+k+"*("+G+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+k+"*\\]",j=":("+G+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+U+")*)|.*)\\)|)",W=new RegExp(k+"+","g"),V=new RegExp("^"+k+"+|((?:^|[^\\\\])(?:\\\\.)*)"+k+"+$","g"),H=new RegExp("^"+k+"*,"+k+"*"),q=new RegExp("^"+k+"*([>+~]|"+k+")"+k+"*"),X=new RegExp("="+k+"*([^\\]'\"]*?)"+k+"*\\]","g"),Y=new RegExp(j),K=new RegExp("^"+B+"$"),z={ID:new RegExp("^#("+G+")"),CLASS:new RegExp("^\\.("+G+")"),TAG:new RegExp("^("+G.replace("w","w*")+")"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+k+"*(even|odd|(([+-]|)(\\d*)n|)"+k+"*(?:([+-]|)"+k+"*(\\d+)|))"+k+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+k+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+k+"*((?:-\\d)?\\d*)"+k+"*\\)|)(?=[^-]|$)","i")},$=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=/'|\\/g,oe=new RegExp("\\\\([\\da-f]{1,6}"+k+"?|("+k+")|.)","ig"),re=function(e,t,o){var r="0x"+t-65536;return r!=r||o?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},ne=function(){d()};try{O.apply(R=N.call(_.childNodes),_.childNodes);R[_.childNodes.length].nodeType}catch(e){O={apply:R.length?function(e,t){I.apply(e,N.call(t))}:function(e,t){for(var o=e.length,r=0;e[o++]=t[r++];);e.length=o-1}}}function ie(e,t,r,n){var i,s,c,u,h,f,y,C,S,E;(t?t.ownerDocument||t:_)!==p&&d(t);t=t||p;r=r||[];u=t.nodeType;if("string"!=typeof e||!e||1!==u&&9!==u&&11!==u)return r;if(!n&&g){if(11!==u&&(i=Q.exec(e)))if(c=i[1]){if(9===u){if(!(s=t.getElementById(c))||!s.parentNode)return r;if(s.id===c){r.push(s);return r}}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(c))&&v(t,s)&&s.id===c){r.push(s);return r}}else{if(i[2]){O.apply(r,t.getElementsByTagName(e));return r}if((c=i[3])&&o.getElementsByClassName){O.apply(r,t.getElementsByClassName(c));return r}}if(o.qsa&&(!m||!m.test(e))){C=y=T;S=t;E=1!==u&&e;if(1===u&&"object"!==t.nodeName.toLowerCase()){f=a(e);(y=t.getAttribute("id"))?C=y.replace(te,"\\$&"):t.setAttribute("id",C);C="[id='"+C+"'] ";h=f.length;for(;h--;)f[h]=C+me(f[h]);S=ee.test(e)&&fe(t.parentNode)||t;E=f.join(",")}if(E)try{O.apply(r,S.querySelectorAll(E));return r}catch(e){}finally{y||t.removeAttribute("id")}}}return l(e.replace(V,"$1"),t,r,n)}function ae(){var e=[];return function t(o,n){e.push(o+" ")>r.cacheLength&&delete t[e.shift()];return t[o+" "]=n}}function se(e){e[T]=!0;return e}function le(e){var t=p.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function ce(e,t){for(var o=e.split("|"),n=e.length;n--;)r.attrHandle[o[n]]=t}function ue(e,t){var o=t&&e,r=o&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(o)for(;o=o.nextSibling;)if(o===t)return-1;return e?1:-1}function he(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function de(e){return function(t){var o=t.nodeName.toLowerCase();return("input"===o||"button"===o)&&t.type===e}}function pe(e){return se(function(t){t=+t;return se(function(o,r){for(var n,i=e([],o.length,t),a=i.length;a--;)o[n=i[a]]&&(o[n]=!(r[n]=o[n]))})})}function fe(e){return e&&void 0!==e.getElementsByTagName&&e}o=ie.support={};i=ie.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName};d=ie.setDocument=function(e){var t,n,a=e?e.ownerDocument||e:_;if(a===p||9!==a.nodeType||!a.documentElement)return p;p=a;f=a.documentElement;(n=a.defaultView)&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",ne,!1):n.attachEvent&&n.attachEvent("onunload",ne));g=!i(a);o.attributes=le(function(e){e.className="i";return!e.getAttribute("className")});o.getElementsByTagName=le(function(e){e.appendChild(a.createComment(""));return!e.getElementsByTagName("*").length});o.getElementsByClassName=Z.test(a.getElementsByClassName);o.getById=le(function(e){f.appendChild(e).id=T;return!a.getElementsByName||!a.getElementsByName(T).length});if(o.getById){r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var o=t.getElementById(e);return o&&o.parentNode?[o]:[]}};r.filter.ID=function(e){var t=e.replace(oe,re);return function(e){return e.getAttribute("id")===t}}}else{delete r.find.ID;r.filter.ID=function(e){var t=e.replace(oe,re);return function(e){var o=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return o&&o.value===t}}}r.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var o,r=[],n=0,i=t.getElementsByTagName(e);if("*"===e){for(;o=i[n++];)1===o.nodeType&&r.push(o);return r}return i};r.find.CLASS=o.getElementsByClassName&&function(e,t){if(g)return t.getElementsByClassName(e)};y=[];m=[];if(o.qsa=Z.test(a.querySelectorAll)){le(function(e){f.appendChild(e).innerHTML="<a id='"+T+"'></a><select id='"+T+"-\f]' msallowcapture=''><option selected=''></option></select>";e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+k+"*(?:''|\"\")");e.querySelectorAll("[selected]").length||m.push("\\["+k+"*(?:value|"+F+")");e.querySelectorAll("[id~="+T+"-]").length||m.push("~=");e.querySelectorAll(":checked").length||m.push(":checked");e.querySelectorAll("a#"+T+"+*").length||m.push(".#.+[+~]")});le(function(e){var t=a.createElement("input");t.setAttribute("type","hidden");e.appendChild(t).setAttribute("name","D");e.querySelectorAll("[name=d]").length&&m.push("name"+k+"*[*^$|!~]?=");e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled");e.querySelectorAll("*,:x");m.push(",.*:")})}(o.matchesSelector=Z.test(C=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&le(function(e){o.disconnectedMatch=C.call(e,"div");C.call(e,"[s!='']:x");y.push("!=",j)});m=m.length&&new RegExp(m.join("|"));y=y.length&&new RegExp(y.join("|"));t=Z.test(f.compareDocumentPosition);v=t||Z.test(f.contains)?function(e,t){var o=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(o.contains?o.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};x=t?function(e,t){if(e===t){h=!0;return 0}var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===r?e===a||e.ownerDocument===_&&v(_,e)?-1:t===a||t.ownerDocument===_&&v(_,t)?1:u?D(u,e)-D(u,t):0:4&r?-1:1)}:function(e,t){if(e===t){h=!0;return 0}var o,r=0,n=e.parentNode,i=t.parentNode,s=[e],l=[t];if(!n||!i)return e===a?-1:t===a?1:n?-1:i?1:u?D(u,e)-D(u,t):0;if(n===i)return ue(e,t);o=e;for(;o=o.parentNode;)s.unshift(o);o=t;for(;o=o.parentNode;)l.unshift(o);for(;s[r]===l[r];)r++;return r?ue(s[r],l[r]):s[r]===_?-1:l[r]===_?1:0};return a};ie.matches=function(e,t){return ie(e,null,null,t)};ie.matchesSelector=function(e,t){(e.ownerDocument||e)!==p&&d(e);t=t.replace(X,"='$1']");if(o.matchesSelector&&g&&(!y||!y.test(t))&&(!m||!m.test(t)))try{var r=C.call(e,t);if(r||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return ie(t,p,null,[e]).length>0};ie.contains=function(e,t){(e.ownerDocument||e)!==p&&d(e);return v(e,t)};ie.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var n=r.attrHandle[t.toLowerCase()],i=n&&P.call(r.attrHandle,t.toLowerCase())?n(e,t,!g):void 0;return void 0!==i?i:o.attributes||!g?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null};ie.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};ie.uniqueSort=function(e){var t,r=[],n=0,i=0;h=!o.detectDuplicates;u=!o.sortStable&&e.slice(0);e.sort(x);if(h){for(;t=e[i++];)t===e[i]&&(n=r.push(i));for(;n--;)e.splice(r[n],1)}u=null;return e};n=ie.getText=function(e){var t,o="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)o+=n(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)o+=n(t);return o};(r=ie.selectors={cacheLength:50,createPseudo:se,match:z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(oe,re);e[3]=(e[3]||e[4]||e[5]||"").replace(oe,re);"~="===e[2]&&(e[3]=" "+e[3]+" ");return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if("nth"===e[1].slice(0,3)){e[3]||ie.error(e[0]);e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3]));e[5]=+(e[7]+e[8]||"odd"===e[3])}else e[3]&&ie.error(e[0]);return e},PSEUDO:function(e){var t,o=!e[6]&&e[2];if(z.CHILD.test(e[0]))return null;if(e[3])e[2]=e[4]||e[5]||"";else if(o&&Y.test(o)&&(t=a(o,!0))&&(t=o.indexOf(")",o.length-t)-o.length)){e[0]=e[0].slice(0,t);e[2]=o.slice(0,t)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(oe,re).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=L[e+" "];return t||(t=new RegExp("(^|"+k+")"+e+"("+k+"|$)"))&&L(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,o){return function(r){var n=ie.attr(r,e);if(null==n)return"!="===t;if(!t)return!0;n+="";return"="===t?n===o:"!="===t?n!==o:"^="===t?o&&0===n.indexOf(o):"*="===t?o&&n.indexOf(o)>-1:"$="===t?o&&n.slice(-o.length)===o:"~="===t?(" "+n.replace(W," ")+" ").indexOf(o)>-1:"|="===t&&(n===o||n.slice(0,o.length+1)===o+"-")}},CHILD:function(e,t,o,r,n){var i="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,o,l){var c,u,h,d,p,f,g=i!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),C=!l&&!s;if(m){if(i){for(;g;){h=t;for(;h=h[g];)if(s?h.nodeName.toLowerCase()===y:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}f=[a?m.firstChild:m.lastChild];if(a&&C){p=(c=(u=m[T]||(m[T]={}))[e]||[])[0]===S&&c[1];d=c[0]===S&&c[2];h=p&&m.childNodes[p];for(;h=++p&&h&&h[g]||(d=p=0)||f.pop();)if(1===h.nodeType&&++d&&h===t){u[e]=[S,p,d];break}}else if(C&&(c=(t[T]||(t[T]={}))[e])&&c[0]===S)d=c[1];else for(;h=++p&&h&&h[g]||(d=p=0)||f.pop();)if((s?h.nodeName.toLowerCase()===y:1===h.nodeType)&&++d){C&&((h[T]||(h[T]={}))[e]=[S,d]);if(h===t)break}return(d-=n)===r||d%r==0&&d/r>=0}}},PSEUDO:function(e,t){var o,n=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ie.error("unsupported pseudo: "+e);if(n[T])return n(t);if(n.length>1){o=[e,e,"",t];return r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,o){for(var r,i=n(e,t),a=i.length;a--;)e[r=D(e,i[a])]=!(o[r]=i[a])}):function(e){return n(e,0,o)}}return n}},pseudos:{not:se(function(e){var t=[],o=[],r=s(e.replace(V,"$1"));return r[T]?se(function(e,t,o,n){for(var i,a=r(e,null,n,[]),s=e.length;s--;)(i=a[s])&&(e[s]=!(t[s]=i))}):function(e,n,i){t[0]=e;r(t,null,i,o);t[0]=null;return!o.pop()}}),has:se(function(e){return function(t){return ie(e,t).length>0}}),contains:se(function(e){e=e.replace(oe,re);return function(t){return(t.textContent||t.innerText||n(t)).indexOf(e)>-1}}),lang:se(function(e){K.test(e||"")||ie.error("unsupported lang: "+e);e=e.replace(oe,re).toLowerCase();return function(t){var o;do{if(o=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(o=o.toLowerCase())===e||0===o.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var o=e.location&&e.location.hash;return o&&o.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return $.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pe(function(){return[0]}),last:pe(function(e,t){return[t-1]}),eq:pe(function(e,t,o){return[o<0?o+t:o]}),even:pe(function(e,t){for(var o=0;o<t;o+=2)e.push(o);return e}),odd:pe(function(e,t){for(var o=1;o<t;o+=2)e.push(o);return e}),lt:pe(function(e,t,o){for(var r=o<0?o+t:o;--r>=0;)e.push(r);return e}),gt:pe(function(e,t,o){for(var r=o<0?o+t:o;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=he(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=de(t);function ge(){}ge.prototype=r.filters=r.pseudos;r.setFilters=new ge;a=ie.tokenize=function(e,t){var o,n,i,a,s,l,c,u=w[e+" "];if(u)return t?0:u.slice(0);s=e;l=[];c=r.preFilter;for(;s;){if(!o||(n=H.exec(s))){n&&(s=s.slice(n[0].length)||s);l.push(i=[])}o=!1;if(n=q.exec(s)){o=n.shift();i.push({value:o,type:n[0].replace(V," ")});s=s.slice(o.length)}for(a in r.filter)if((n=z[a].exec(s))&&(!c[a]||(n=c[a](n)))){o=n.shift();i.push({value:o,type:a,matches:n});s=s.slice(o.length)}if(!o)break}return t?s.length:s?ie.error(e):w(e,l).slice(0)};function me(e){for(var t=0,o=e.length,r="";t<o;t++)r+=e[t].value;return r}function ye(e,t,o){var r=t.dir,n=o&&"parentNode"===r,i=E++;return t.first?function(t,o,i){for(;t=t[r];)if(1===t.nodeType||n)return e(t,o,i)}:function(t,o,a){var s,l,c=[S,i];if(a){for(;t=t[r];)if((1===t.nodeType||n)&&e(t,o,a))return!0}else for(;t=t[r];)if(1===t.nodeType||n){if((s=(l=t[T]||(t[T]={}))[r])&&s[0]===S&&s[1]===i)return c[2]=s[2];l[r]=c;if(c[2]=e(t,o,a))return!0}}}function Ce(e){return e.length>1?function(t,o,r){for(var n=e.length;n--;)if(!e[n](t,o,r))return!1;return!0}:e[0]}function ve(e,t,o,r,n){for(var i,a=[],s=0,l=e.length,c=null!=t;s<l;s++)if((i=e[s])&&(!o||o(i,r,n))){a.push(i);c&&t.push(s)}return a}function Te(e,t,o,r,n,i){r&&!r[T]&&(r=Te(r));n&&!n[T]&&(n=Te(n,i));return se(function(i,a,s,l){var c,u,h,d=[],p=[],f=a.length,g=i||function(e,t,o){for(var r=0,n=t.length;r<n;r++)ie(e,t[r],o);return o}(t||"*",s.nodeType?[s]:s,[]),m=!e||!i&&t?g:ve(g,d,e,s,l),y=o?n||(i?e:f||r)?[]:a:m;o&&o(m,y,s,l);if(r){c=ve(y,p);r(c,[],s,l);u=c.length;for(;u--;)(h=c[u])&&(y[p[u]]=!(m[p[u]]=h))}if(i){if(n||e){if(n){c=[];u=y.length;for(;u--;)(h=y[u])&&c.push(m[u]=h);n(null,y=[],c,l)}u=y.length;for(;u--;)(h=y[u])&&(c=n?D(i,h):d[u])>-1&&(i[c]=!(a[c]=h))}}else{y=ve(y===a?y.splice(f,y.length):y);n?n(null,a,y,l):O.apply(a,y)}})}function _e(e){for(var t,o,n,i=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],l=a?1:0,u=ye(function(e){return e===t},s,!0),h=ye(function(e){return D(t,e)>-1},s,!0),d=[function(e,o,r){var n=!a&&(r||o!==c)||((t=o).nodeType?u(e,o,r):h(e,o,r));t=null;return n}];l<i;l++)if(o=r.relative[e[l].type])d=[ye(Ce(d),o)];else{if((o=r.filter[e[l].type].apply(null,e[l].matches))[T]){n=++l;for(;n<i&&!r.relative[e[n].type];n++);return Te(l>1&&Ce(d),l>1&&me(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(V,"$1"),o,l<n&&_e(e.slice(l,n)),n<i&&_e(e=e.slice(n)),n<i&&me(e))}d.push(o)}return Ce(d)}s=ie.compile=function(e,t){var o,n=[],i=[],s=b[e+" "];if(!s){t||(t=a(e));o=t.length;for(;o--;)(s=_e(t[o]))[T]?n.push(s):i.push(s);(s=b(e,function(e,t){var o=t.length>0,n=e.length>0,i=function(i,a,s,l,u){var h,d,f,g=0,m="0",y=i&&[],C=[],v=c,T=i||n&&r.find.TAG("*",u),_=S+=null==v?1:Math.random()||.1,E=T.length;u&&(c=a!==p&&a);for(;m!==E&&null!=(h=T[m]);m++){if(n&&h){d=0;for(;f=e[d++];)if(f(h,a,s)){l.push(h);break}u&&(S=_)}if(o){(h=!f&&h)&&g--;i&&y.push(h)}}g+=m;if(o&&m!==g){d=0;for(;f=t[d++];)f(y,C,a,s);if(i){if(g>0)for(;m--;)y[m]||C[m]||(C[m]=M.call(l));C=ve(C)}O.apply(l,C);u&&!i&&C.length>0&&g+t.length>1&&ie.uniqueSort(l)}if(u){S=_;c=v}return y};return o?se(i):i}(i,n))).selector=e}return s};l=ie.select=function(e,t,n,i){var l,c,u,h,d,p="function"==typeof e&&e,f=!i&&a(e=p.selector||e);n=n||[];if(1===f.length){if((c=f[0]=f[0].slice(0)).length>2&&"ID"===(u=c[0]).type&&o.getById&&9===t.nodeType&&g&&r.relative[c[1].type]){if(!(t=(r.find.ID(u.matches[0].replace(oe,re),t)||[])[0]))return n;p&&(t=t.parentNode);e=e.slice(c.shift().value.length)}l=z.needsContext.test(e)?0:c.length;for(;l--;){u=c[l];if(r.relative[h=u.type])break;if((d=r.find[h])&&(i=d(u.matches[0].replace(oe,re),ee.test(c[0].type)&&fe(t.parentNode)||t))){c.splice(l,1);if(!(e=i.length&&me(c))){O.apply(n,i);return n}break}}}(p||s(e,f))(i,t,!g,n,ee.test(e)&&fe(t.parentNode)||t);return n};o.sortStable=T.split("").sort(x).join("")===T;o.detectDuplicates=!!h;d();o.sortDetached=le(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))});le(function(e){e.innerHTML="<a href='#'></a>";return"#"===e.firstChild.getAttribute("href")})||ce("type|href|height|width",function(e,t,o){if(!o)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)});o.attributes&&le(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return""===e.firstChild.getAttribute("value")})||ce("value",function(e,t,o){if(!o&&"input"===e.nodeName.toLowerCase())return e.defaultValue});le(function(e){return null==e.getAttribute("disabled")})||ce(F,function(e,t,o){var r;if(!o)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null});return ie}(e);d.find=C;d.expr=C.selectors;d.expr[":"]=d.expr.pseudos;d.unique=C.uniqueSort;d.text=C.getText;d.isXMLDoc=C.isXML;d.contains=C.contains;var v=d.expr.match.needsContext,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,_=/^.[^:#\[\.,]*$/;function S(e,t,o){if(d.isFunction(t))return d.grep(e,function(e,r){return!!t.call(e,r,e)!==o});if(t.nodeType)return d.grep(e,function(e){return e===t!==o});if("string"==typeof t){if(_.test(t))return d.filter(t,e,o);t=d.filter(t,e)}return d.grep(e,function(e){return a.call(t,e)>=0!==o})}d.filter=function(e,t,o){var r=t[0];o&&(e=":not("+e+")");return 1===t.length&&1===r.nodeType?d.find.matchesSelector(r,e)?[r]:[]:d.find.matches(e,d.grep(t,function(e){return 1===e.nodeType}))};d.fn.extend({find:function(e){var t,o=this.length,r=[],n=this;if("string"!=typeof e)return this.pushStack(d(e).filter(function(){for(t=0;t<o;t++)if(d.contains(n[t],this))return!0}));for(t=0;t<o;t++)d.find(e,n[t],r);(r=this.pushStack(o>1?d.unique(r):r)).selector=this.selector?this.selector+" "+e:e;return r},filter:function(e){return this.pushStack(S(this,e||[],!1))},not:function(e){return this.pushStack(S(this,e||[],!0))},is:function(e){return!!S(this,"string"==typeof e&&v.test(e)?d(e):e||[],!1).length}});var E,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(d.fn.init=function(e,t){var o,r;if(!e)return this;if("string"==typeof e){if(!(o="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))||!o[1]&&t)return!t||t.jquery?(t||E).find(e):this.constructor(t).find(e);if(o[1]){t=t instanceof d?t[0]:t;d.merge(this,d.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:h,!0));if(T.test(o[1])&&d.isPlainObject(t))for(o in t)d.isFunction(this[o])?this[o](t[o]):this.attr(o,t[o]);return this}if((r=h.getElementById(o[2]))&&r.parentNode){this.length=1;this[0]=r}this.context=h;this.selector=e;return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(d.isFunction(e))return void 0!==E.ready?E.ready(e):e(d);if(void 0!==e.selector){this.selector=e.selector;this.context=e.context}return d.makeArray(e,this)}).prototype=d.fn;E=d(h);var w=/^(?:parents|prev(?:Until|All))/,b={children:!0,contents:!0,next:!0,prev:!0};d.extend({dir:function(e,t,o){for(var r=[],n=void 0!==o;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&d(e).is(o))break;r.push(e)}return r},sibling:function(e,t){for(var o=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&o.push(e);return o}});d.fn.extend({has:function(e){var t=d(e,this),o=t.length;return this.filter(function(){for(var e=0;e<o;e++)if(d.contains(this,t[e]))return!0})},closest:function(e,t){for(var o,r=0,n=this.length,i=[],a=v.test(e)||"string"!=typeof e?d(e,t||this.context):0;r<n;r++)for(o=this[r];o&&o!==t;o=o.parentNode)if(o.nodeType<11&&(a?a.index(o)>-1:1===o.nodeType&&d.find.matchesSelector(o,e))){i.push(o);break}return this.pushStack(i.length>1?d.unique(i):i)},index:function(e){return e?"string"==typeof e?a.call(d(e),this[0]):a.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(d.unique(d.merge(this.get(),d(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function x(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}d.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d.dir(e,"parentNode")},parentsUntil:function(e,t,o){return d.dir(e,"parentNode",o)},next:function(e){return x(e,"nextSibling")},prev:function(e){return x(e,"previousSibling")},nextAll:function(e){return d.dir(e,"nextSibling")},prevAll:function(e){return d.dir(e,"previousSibling")},nextUntil:function(e,t,o){return d.dir(e,"nextSibling",o)},prevUntil:function(e,t,o){return d.dir(e,"previousSibling",o)},siblings:function(e){return d.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return d.sibling(e.firstChild)},contents:function(e){return e.contentDocument||d.merge([],e.childNodes)}},function(e,t){d.fn[e]=function(o,r){var n=d.map(this,t,o);"Until"!==e.slice(-5)&&(r=o);r&&"string"==typeof r&&(n=d.filter(r,n));if(this.length>1){b[e]||d.unique(n);w.test(e)&&n.reverse()}return this.pushStack(n)}});var A,P=/\S+/g,R={};d.Callbacks=function(e){var t,o,r,n,i,a,s=[],l=!(e="string"==typeof e?R[e]||function(e){var t=R[e]={};d.each(e.match(P)||[],function(e,o){t[o]=!0});return t}(e):d.extend({},e)).once&&[],c=function(h){t=e.memory&&h;o=!0;a=n||0;n=0;i=s.length;r=!0;for(;s&&a<i;a++)if(!1===s[a].apply(h[0],h[1])&&e.stopOnFalse){t=!1;break}r=!1;s&&(l?l.length&&c(l.shift()):t?s=[]:u.disable())},u={add:function(){if(s){var o=s.length;!function t(o){d.each(o,function(o,r){var n=d.type(r);"function"===n?e.unique&&u.has(r)||s.push(r):r&&r.length&&"string"!==n&&t(r)})}(arguments);if(r)i=s.length;else if(t){n=o;c(t)}}return this},remove:function(){s&&d.each(arguments,function(e,t){for(var o;(o=d.inArray(t,s,o))>-1;){s.splice(o,1);if(r){o<=i&&i--;o<=a&&a--}}});return this},has:function(e){return e?d.inArray(e,s)>-1:!(!s||!s.length)},empty:function(){s=[];i=0;return this},disable:function(){s=l=t=void 0;return this},disabled:function(){return!s},lock:function(){l=void 0;t||u.disable();return this},locked:function(){return!l},fireWith:function(e,t){if(s&&(!o||l)){t=[e,(t=t||[]).slice?t.slice():t];r?l.push(t):c(t)}return this},fire:function(){u.fireWith(this,arguments);return this},fired:function(){return!!o}};return u};d.extend({Deferred:function(e){var t=[["resolve","done",d.Callbacks("once memory"),"resolved"],["reject","fail",d.Callbacks("once memory"),"rejected"],["notify","progress",d.Callbacks("memory")]],o="pending",r={state:function(){return o},always:function(){n.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return d.Deferred(function(o){d.each(t,function(t,i){var a=d.isFunction(e[t])&&e[t];n[i[1]](function(){var e=a&&a.apply(this,arguments);e&&d.isFunction(e.promise)?e.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[i[0]+"With"](this===r?o.promise():this,a?[e]:arguments)})});e=null}).promise()},promise:function(e){return null!=e?d.extend(e,r):r}},n={};r.pipe=r.then;d.each(t,function(e,i){var a=i[2],s=i[3];r[i[1]]=a.add;s&&a.add(function(){o=s},t[1^e][2].disable,t[2][2].lock);n[i[0]]=function(){n[i[0]+"With"](this===n?r:this,arguments);return this};n[i[0]+"With"]=a.fireWith});r.promise(n);e&&e.call(n,n);return n},when:function(e){var t,o,n,i=0,a=r.call(arguments),s=a.length,l=1!==s||e&&d.isFunction(e.promise)?s:0,c=1===l?e:d.Deferred(),u=function(e,o,n){return function(i){o[e]=this;n[e]=arguments.length>1?r.call(arguments):i;n===t?c.notifyWith(o,n):--l||c.resolveWith(o,n)}};if(s>1){t=new Array(s);o=new Array(s);n=new Array(s);for(;i<s;i++)a[i]&&d.isFunction(a[i].promise)?a[i].promise().done(u(i,n,a)).fail(c.reject).progress(u(i,o,t)):--l}l||c.resolveWith(n,a);return c.promise()}});d.fn.ready=function(e){d.ready.promise().done(e);return this};d.extend({isReady:!1,readyWait:1,holdReady:function(e){e?d.readyWait++:d.ready(!0)},ready:function(e){if(!0===e?!--d.readyWait:!d.isReady){d.isReady=!0;if(!(!0!==e&&--d.readyWait>0)){A.resolveWith(h,[d]);if(d.fn.triggerHandler){d(h).triggerHandler("ready");d(h).off("ready")}}}}});function M(){h.removeEventListener("DOMContentLoaded",M,!1);e.removeEventListener("load",M,!1);d.ready()}d.ready.promise=function(t){if(!A){A=d.Deferred();if("complete"===h.readyState)setTimeout(d.ready);else{h.addEventListener("DOMContentLoaded",M,!1);e.addEventListener("load",M,!1)}}return A.promise(t)};d.ready.promise();var I=d.access=function(e,t,o,r,n,i,a){var s=0,l=e.length,c=null==o;if("object"===d.type(o)){n=!0;for(s in o)d.access(e,t,s,o[s],!0,i,a)}else if(void 0!==r){n=!0;d.isFunction(r)||(a=!0);if(c)if(a){t.call(e,r);t=null}else{c=t;t=function(e,t,o){return c.call(d(e),o)}}if(t)for(;s<l;s++)t(e[s],o,a?r:r.call(e[s],s,t(e[s],o)))}return n?e:c?t.call(e):l?t(e[0],o):i};d.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function O(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=d.expando+O.uid++}O.uid=1;O.accepts=d.acceptData;O.prototype={key:function(e){if(!O.accepts(e))return 0;var t={},o=e[this.expando];if(!o){o=O.uid++;try{t[this.expando]={value:o};Object.defineProperties(e,t)}catch(r){t[this.expando]=o;d.extend(e,t)}}this.cache[o]||(this.cache[o]={});return o},set:function(e,t,o){var r,n=this.key(e),i=this.cache[n];if("string"==typeof t)i[t]=o;else if(d.isEmptyObject(i))d.extend(this.cache[n],t);else for(r in t)i[r]=t[r];return i},get:function(e,t){var o=this.cache[this.key(e)];return void 0===t?o:o[t]},access:function(e,t,o){var r;if(void 0===t||t&&"string"==typeof t&&void 0===o)return void 0!==(r=this.get(e,t))?r:this.get(e,d.camelCase(t));this.set(e,t,o);return void 0!==o?o:t},remove:function(e,t){var o,r,n,i=this.key(e),a=this.cache[i];if(void 0===t)this.cache[i]={};else{if(d.isArray(t))r=t.concat(t.map(d.camelCase));else{n=d.camelCase(t);r=t in a?[t,n]:(r=n)in a?[r]:r.match(P)||[]}o=r.length;for(;o--;)delete a[r[o]]}},hasData:function(e){return!d.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var N=new O,D=new O,F=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,k=/([A-Z])/g;function G(e,t,o){var r;if(void 0===o&&1===e.nodeType){r="data-"+t.replace(k,"-$1").toLowerCase();if("string"==typeof(o=e.getAttribute(r))){try{o="true"===o||"false"!==o&&("null"===o?null:+o+""===o?+o:F.test(o)?d.parseJSON(o):o)}catch(e){}D.set(e,t,o)}else o=void 0}return o}d.extend({hasData:function(e){return D.hasData(e)||N.hasData(e)},data:function(e,t,o){return D.access(e,t,o)},removeData:function(e,t){D.remove(e,t)},_data:function(e,t,o){return N.access(e,t,o)},_removeData:function(e,t){N.remove(e,t)}});d.fn.extend({data:function(e,t){var o,r,n,i=this[0],a=i&&i.attributes;if(void 0===e){if(this.length){n=D.get(i);if(1===i.nodeType&&!N.get(i,"hasDataAttrs")){o=a.length;for(;o--;)if(a[o]&&0===(r=a[o].name).indexOf("data-")){r=d.camelCase(r.slice(5));G(i,r,n[r])}N.set(i,"hasDataAttrs",!0)}}return n}return"object"==typeof e?this.each(function(){D.set(this,e)}):I(this,function(t){var o,r=d.camelCase(e);if(i&&void 0===t)return void 0!==(o=D.get(i,e))?o:void 0!==(o=D.get(i,r))?o:void 0!==(o=G(i,r,void 0))?o:void 0;this.each(function(){var o=D.get(this,r);D.set(this,r,t);-1!==e.indexOf("-")&&void 0!==o&&D.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){D.remove(this,e)})}});d.extend({queue:function(e,t,o){var r;if(e){t=(t||"fx")+"queue";r=N.get(e,t);o&&(!r||d.isArray(o)?r=N.access(e,t,d.makeArray(o)):r.push(o));return r||[]}},dequeue:function(e,t){t=t||"fx";var o=d.queue(e,t),r=o.length,n=o.shift(),i=d._queueHooks(e,t);if("inprogress"===n){n=o.shift();r--}if(n){"fx"===t&&o.unshift("inprogress");delete i.stop;n.call(e,function(){d.dequeue(e,t)},i)}!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var o=t+"queueHooks";return N.get(e,o)||N.access(e,o,{empty:d.Callbacks("once memory").add(function(){N.remove(e,[t+"queue",o])})})}});d.fn.extend({queue:function(e,t){var o=2;if("string"!=typeof e){t=e;e="fx";o--}return arguments.length<o?d.queue(this[0],e):void 0===t?this:this.each(function(){var o=d.queue(this,e,t);d._queueHooks(this,e);"fx"===e&&"inprogress"!==o[0]&&d.dequeue(this,e)})},dequeue:function(e){return this.each(function(){d.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var o,r=1,n=d.Deferred(),i=this,a=this.length,s=function(){--r||n.resolveWith(i,[i])};if("string"!=typeof e){t=e;e=void 0}e=e||"fx";for(;a--;)if((o=N.get(i[a],e+"queueHooks"))&&o.empty){r++;o.empty.add(s)}s();return n.promise(t)}});var B=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=["Top","Right","Bottom","Left"],j=function(e,t){e=t||e;return"none"===d.css(e,"display")||!d.contains(e.ownerDocument,e)},W=/^(?:checkbox|radio)$/i;!function(){var e=h.createDocumentFragment().appendChild(h.createElement("div")),t=h.createElement("input");t.setAttribute("type","radio");t.setAttribute("checked","checked");t.setAttribute("name","t");e.appendChild(t);u.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked;e.innerHTML="<textarea>x</textarea>";u.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();u.focusinBubbles="onfocusin"in e;var V=/^key/,H=/^(?:mouse|pointer|contextmenu)|click/,q=/^(?:focusinfocus|focusoutblur)$/,X=/^([^.]*)(?:\.(.+)|)$/;function Y(){return!0}function K(){return!1}function z(){try{return h.activeElement}catch(e){}}d.event={global:{},add:function(e,t,o,r,n){var i,a,s,l,c,u,h,p,f,g,m,y=N.get(e);if(y){if(o.handler){o=(i=o).handler;n=i.selector}o.guid||(o.guid=d.guid++);(l=y.events)||(l=y.events={});(a=y.handle)||(a=y.handle=function(t){return void 0!==d&&d.event.triggered!==t.type?d.event.dispatch.apply(e,arguments):void 0});c=(t=(t||"").match(P)||[""]).length;for(;c--;){f=m=(s=X.exec(t[c])||[])[1];g=(s[2]||"").split(".").sort();if(f){h=d.event.special[f]||{};f=(n?h.delegateType:h.bindType)||f;h=d.event.special[f]||{};u=d.extend({type:f,origType:m,data:r,handler:o,guid:o.guid,selector:n,needsContext:n&&d.expr.match.needsContext.test(n),namespace:g.join(".")},i);if(!(p=l[f])){(p=l[f]=[]).delegateCount=0;h.setup&&!1!==h.setup.call(e,r,g,a)||e.addEventListener&&e.addEventListener(f,a,!1)}if(h.add){h.add.call(e,u);u.handler.guid||(u.handler.guid=o.guid)}n?p.splice(p.delegateCount++,0,u):p.push(u);d.event.global[f]=!0}}}},remove:function(e,t,o,r,n){var i,a,s,l,c,u,h,p,f,g,m,y=N.hasData(e)&&N.get(e);if(y&&(l=y.events)){c=(t=(t||"").match(P)||[""]).length;for(;c--;){f=m=(s=X.exec(t[c])||[])[1];g=(s[2]||"").split(".").sort();if(f){h=d.event.special[f]||{};p=l[f=(r?h.delegateType:h.bindType)||f]||[];s=s[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)");a=i=p.length;for(;i--;){u=p[i];if((n||m===u.origType)&&(!o||o.guid===u.guid)&&(!s||s.test(u.namespace))&&(!r||r===u.selector||"**"===r&&u.selector)){p.splice(i,1);u.selector&&p.delegateCount--;h.remove&&h.remove.call(e,u)}}if(a&&!p.length){h.teardown&&!1!==h.teardown.call(e,g,y.handle)||d.removeEvent(e,f,y.handle);delete l[f]}}else for(f in l)d.event.remove(e,f+t[c],o,r,!0)}if(d.isEmptyObject(l)){delete y.handle;N.remove(e,"events")}}},trigger:function(t,o,r,n){var i,a,s,l,u,p,f,g=[r||h],m=c.call(t,"type")?t.type:t,y=c.call(t,"namespace")?t.namespace.split("."):[];a=s=r=r||h;if(3!==r.nodeType&&8!==r.nodeType&&!q.test(m+d.event.triggered)){if(m.indexOf(".")>=0){m=(y=m.split(".")).shift();y.sort()}u=m.indexOf(":")<0&&"on"+m;(t=t[d.expando]?t:new d.Event(m,"object"==typeof t&&t)).isTrigger=n?2:3;t.namespace=y.join(".");t.namespace_re=t.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;t.result=void 0;t.target||(t.target=r);o=null==o?[t]:d.makeArray(o,[t]);f=d.event.special[m]||{};if(n||!f.trigger||!1!==f.trigger.apply(r,o)){if(!n&&!f.noBubble&&!d.isWindow(r)){l=f.delegateType||m;q.test(l+m)||(a=a.parentNode);for(;a;a=a.parentNode){g.push(a);s=a}s===(r.ownerDocument||h)&&g.push(s.defaultView||s.parentWindow||e)}i=0;for(;(a=g[i++])&&!t.isPropagationStopped();){t.type=i>1?l:f.bindType||m;(p=(N.get(a,"events")||{})[t.type]&&N.get(a,"handle"))&&p.apply(a,o);if((p=u&&a[u])&&p.apply&&d.acceptData(a)){t.result=p.apply(a,o);!1===t.result&&t.preventDefault()}}t.type=m;if(!n&&!t.isDefaultPrevented()&&(!f._default||!1===f._default.apply(g.pop(),o))&&d.acceptData(r)&&u&&d.isFunction(r[m])&&!d.isWindow(r)){(s=r[u])&&(r[u]=null);d.event.triggered=m;r[m]();d.event.triggered=void 0;s&&(r[u]=s)}return t.result}}},dispatch:function(e){e=d.event.fix(e);var t,o,n,i,a,s,l=r.call(arguments),c=(N.get(this,"events")||{})[e.type]||[],u=d.event.special[e.type]||{};l[0]=e;e.delegateTarget=this;if(!u.preDispatch||!1!==u.preDispatch.call(this,e)){s=d.event.handlers.call(this,e,c);t=0;for(;(i=s[t++])&&!e.isPropagationStopped();){e.currentTarget=i.elem;o=0;for(;(a=i.handlers[o++])&&!e.isImmediatePropagationStopped();)if(!e.namespace_re||e.namespace_re.test(a.namespace)){e.handleObj=a;e.data=a.data;if(void 0!==(n=((d.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,l))&&!1===(e.result=n)){e.preventDefault();e.stopPropagation()}}}u.postDispatch&&u.postDispatch.call(this,e);return e.result}},handlers:function(e,t){var o,r,n,i,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(!0!==l.disabled||"click"!==e.type){r=[];for(o=0;o<s;o++){void 0===r[n=(i=t[o]).selector+" "]&&(r[n]=i.needsContext?d(n,this).index(l)>=0:d.find(n,this,null,[l]).length);r[n]&&r.push(i)}r.length&&a.push({elem:l,handlers:r})}s<t.length&&a.push({elem:this,handlers:t.slice(s)});return a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var o,r,n,i=t.button;if(null==e.pageX&&null!=t.clientX){r=(o=e.target.ownerDocument||h).documentElement;n=o.body;e.pageX=t.clientX+(r&&r.scrollLeft||n&&n.scrollLeft||0)-(r&&r.clientLeft||n&&n.clientLeft||0);e.pageY=t.clientY+(r&&r.scrollTop||n&&n.scrollTop||0)-(r&&r.clientTop||n&&n.clientTop||0)}e.which||void 0===i||(e.which=1&i?1:2&i?3:4&i?2:0);return e}},fix:function(e){if(e[d.expando])return e;var t,o,r,n=e.type,i=e,a=this.fixHooks[n];a||(this.fixHooks[n]=a=H.test(n)?this.mouseHooks:V.test(n)?this.keyHooks:{});r=a.props?this.props.concat(a.props):this.props;e=new d.Event(i);t=r.length;for(;t--;)e[o=r[t]]=i[o];e.target||(e.target=h);3===e.target.nodeType&&(e.target=e.target.parentNode);return a.filter?a.filter(e,i):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==z()&&this.focus){this.focus();return!1}},delegateType:"focusin"},blur:{trigger:function(){if(this===z()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&d.nodeName(this,"input")){this.click();return!1}},_default:function(e){return d.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,o,r){var n=d.extend(new d.Event,o,{type:e,isSimulated:!0,originalEvent:{}});r?d.event.trigger(n,null,t):d.event.dispatch.call(t,n);n.isDefaultPrevented()&&o.preventDefault()}};d.removeEvent=function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o,!1)};d.Event=function(e,t){if(!(this instanceof d.Event))return new d.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Y:K}else this.type=e;t&&d.extend(this,t);this.timeStamp=e&&e.timeStamp||d.now();this[d.expando]=!0};d.Event.prototype={isDefaultPrevented:K,isPropagationStopped:K,isImmediatePropagationStopped:K,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Y;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Y;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Y;e&&e.stopImmediatePropagation&&e.stopImmediatePropagation();this.stopPropagation()}};d.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){d.event.special[e]={delegateType:t,bindType:t,handle:function(e){var o,r=e.relatedTarget,n=e.handleObj;if(!r||r!==this&&!d.contains(this,r)){e.type=n.origType;o=n.handler.apply(this,arguments);e.type=t}return o}}});u.focusinBubbles||d.each({focus:"focusin",blur:"focusout"},function(e,t){var o=function(e){d.event.simulate(t,e.target,d.event.fix(e),!0)};d.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=N.access(r,t);n||r.addEventListener(e,o,!0);N.access(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=N.access(r,t)-1;if(n)N.access(r,t,n);else{r.removeEventListener(e,o,!0);N.remove(r,t)}}}});d.fn.extend({on:function(e,t,o,r,n){var i,a;if("object"==typeof e){if("string"!=typeof t){o=o||t;t=void 0}for(a in e)this.on(a,t,o,e[a],n);return this}if(null==o&&null==r){r=t;o=t=void 0}else if(null==r)if("string"==typeof t){r=o;o=void 0}else{r=o;o=t;t=void 0}if(!1===r)r=K;else if(!r)return this;if(1===n){i=r;(r=function(e){d().off(e);return i.apply(this,arguments)}).guid=i.guid||(i.guid=d.guid++)}return this.each(function(){d.event.add(this,e,r,o,t)})},one:function(e,t,o,r){return this.on(e,t,o,r,1)},off:function(e,t,o){var r,n;if(e&&e.preventDefault&&e.handleObj){r=e.handleObj;d(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler);return this}if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}if(!1===t||"function"==typeof t){o=t;t=void 0}!1===o&&(o=K);return this.each(function(){d.event.remove(this,e,o,t)})},trigger:function(e,t){return this.each(function(){d.event.trigger(e,t,this)})},triggerHandler:function(e,t){var o=this[0];if(o)return d.event.trigger(e,t,o,!0)}});var $=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,J=/<([\w:]+)/,Z=/<|&#?\w+;/,Q=/<(?:script|style|link)/i,ee=/checked\s*(?:[^=]|=\s*.checked.)/i,te=/^$|\/(?:java|ecma)script/i,oe=/^true\/(.*)/,re=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ne={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ne.optgroup=ne.option;ne.tbody=ne.tfoot=ne.colgroup=ne.caption=ne.thead;ne.th=ne.td;function ie(e,t){return d.nodeName(e,"table")&&d.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ae(e){e.type=(null!==e.getAttribute("type"))+"/"+e.type;return e}function se(e){var t=oe.exec(e.type);t?e.type=t[1]:e.removeAttribute("type");return e}function le(e,t){for(var o=0,r=e.length;o<r;o++)N.set(e[o],"globalEval",!t||N.get(t[o],"globalEval"))}function ce(e,t){var o,r,n,i,a,s,l,c;if(1===t.nodeType){if(N.hasData(e)){i=N.access(e);a=N.set(t,i);if(c=i.events){delete a.handle;a.events={};for(n in c)for(o=0,r=c[n].length;o<r;o++)d.event.add(t,n,c[n][o])}}if(D.hasData(e)){s=D.access(e);l=d.extend({},s);D.set(t,l)}}}function ue(e,t){var o=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&d.nodeName(e,t)?d.merge([e],o):o}d.extend({clone:function(e,t,o){var r,n,i,a,s,l,c,h=e.cloneNode(!0),p=d.contains(e.ownerDocument,e);if(!(u.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||d.isXMLDoc(e))){a=ue(h);for(r=0,n=(i=ue(e)).length;r<n;r++)s=i[r],l=a[r],void 0,"input"===(c=l.nodeName.toLowerCase())&&W.test(s.type)?l.checked=s.checked:"input"!==c&&"textarea"!==c||(l.defaultValue=s.defaultValue)}if(t)if(o){i=i||ue(e);a=a||ue(h);for(r=0,n=i.length;r<n;r++)ce(i[r],a[r])}else ce(e,h);(a=ue(h,"script")).length>0&&le(a,!p&&ue(e,"script"));return h},buildFragment:function(e,t,o,r){for(var n,i,a,s,l,c,u=t.createDocumentFragment(),h=[],p=0,f=e.length;p<f;p++)if((n=e[p])||0===n)if("object"===d.type(n))d.merge(h,n.nodeType?[n]:n);else if(Z.test(n)){i=i||u.appendChild(t.createElement("div"));a=(J.exec(n)||["",""])[1].toLowerCase();s=ne[a]||ne._default;i.innerHTML=s[1]+n.replace($,"<$1></$2>")+s[2];c=s[0];for(;c--;)i=i.lastChild;d.merge(h,i.childNodes);(i=u.firstChild).textContent=""}else h.push(t.createTextNode(n));u.textContent="";p=0;for(;n=h[p++];)if(!r||-1===d.inArray(n,r)){l=d.contains(n.ownerDocument,n);i=ue(u.appendChild(n),"script");l&&le(i);if(o){c=0;for(;n=i[c++];)te.test(n.type||"")&&o.push(n)}}return u},cleanData:function(e){for(var t,o,r,n,i=d.event.special,a=0;void 0!==(o=e[a]);a++){if(d.acceptData(o)&&(n=o[N.expando])&&(t=N.cache[n])){if(t.events)for(r in t.events)i[r]?d.event.remove(o,r):d.removeEvent(o,r,t.handle);N.cache[n]&&delete N.cache[n]}delete D.cache[o[D.expando]]}}});d.fn.extend({text:function(e){return I(this,function(e){return void 0===e?d.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){ie(this,e).appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=ie(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var o,r=e?d.filter(e,this):this,n=0;null!=(o=r[n]);n++){t||1!==o.nodeType||d.cleanData(ue(o));if(o.parentNode){t&&d.contains(o.ownerDocument,o)&&le(ue(o,"script"));o.parentNode.removeChild(o)}}return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)if(1===e.nodeType){d.cleanData(ue(e,!1));e.textContent=""}return this},clone:function(e,t){e=null!=e&&e;t=null==t?e:t;return this.map(function(){return d.clone(this,e,t)})},html:function(e){return I(this,function(e){var t=this[0]||{},o=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Q.test(e)&&!ne[(J.exec(e)||["",""])[1].toLowerCase()]){e=e.replace($,"<$1></$2>");try{for(;o<r;o++)if(1===(t=this[o]||{}).nodeType){d.cleanData(ue(t,!1));t.innerHTML=e}t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];this.domManip(arguments,function(t){e=this.parentNode;d.cleanData(ue(this));e&&e.replaceChild(t,this)});return e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=n.apply([],e);var o,r,i,a,s,l,c=0,h=this.length,p=this,f=h-1,g=e[0],m=d.isFunction(g);if(m||h>1&&"string"==typeof g&&!u.checkClone&&ee.test(g))return this.each(function(o){var r=p.eq(o);m&&(e[0]=g.call(this,o,r.html()));r.domManip(e,t)});if(h){r=(o=d.buildFragment(e,this[0].ownerDocument,!1,this)).firstChild;1===o.childNodes.length&&(o=r);if(r){a=(i=d.map(ue(o,"script"),ae)).length;for(;c<h;c++){s=o;if(c!==f){s=d.clone(s,!0,!0);a&&d.merge(i,ue(s,"script"))}t.call(this[c],s,c)}if(a){l=i[i.length-1].ownerDocument;d.map(i,se);for(c=0;c<a;c++){s=i[c];te.test(s.type||"")&&!N.access(s,"globalEval")&&d.contains(l,s)&&(s.src?d._evalUrl&&d._evalUrl(s.src):d.globalEval(s.textContent.replace(re,"")))}}}}return this}});d.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){d.fn[e]=function(e){for(var o,r=[],n=d(e),a=n.length-1,s=0;s<=a;s++){o=s===a?this:this.clone(!0);d(n[s])[t](o);i.apply(r,o.get())}return this.pushStack(r)}});var he,de={};function pe(t,o){var r,n=d(o.createElement(t)).appendTo(o.body),i=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(n[0]))?r.display:d.css(n[0],"display");n.detach();return i}function fe(e){var t=h,o=de[e];if(!o){if("none"===(o=pe(e,t))||!o){(t=(he=(he||d("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement))[0].contentDocument).write();t.close();o=pe(e,t);he.detach()}de[e]=o}return o}var ge=/^margin/,me=new RegExp("^("+B+")(?!px)[a-z%]+$","i"),ye=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};function Ce(e,t,o){var r,n,i,a,s=e.style;(o=o||ye(e))&&(a=o.getPropertyValue(t)||o[t]);if(o){""!==a||d.contains(e.ownerDocument,e)||(a=d.style(e,t));if(me.test(a)&&ge.test(t)){r=s.width;n=s.minWidth;i=s.maxWidth;s.minWidth=s.maxWidth=s.width=a;a=o.width;s.width=r;s.minWidth=n;s.maxWidth=i}}return void 0!==a?a+"":a}function ve(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){var t,o,r=h.documentElement,n=h.createElement("div"),i=h.createElement("div");if(i.style){i.style.backgroundClip="content-box";i.cloneNode(!0).style.backgroundClip="";u.clearCloneStyle="content-box"===i.style.backgroundClip;n.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute";n.appendChild(i);e.getComputedStyle&&d.extend(u,{pixelPosition:function(){a();return t},boxSizingReliable:function(){null==o&&a();return o},reliableMarginRight:function(){var t,o=i.appendChild(h.createElement("div"));o.style.cssText=i.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0";o.style.marginRight=o.style.width="0";i.style.width="1px";r.appendChild(n);t=!parseFloat(e.getComputedStyle(o,null).marginRight);r.removeChild(n);i.removeChild(o);return t}})}function a(){i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute";i.innerHTML="";r.appendChild(n);var a=e.getComputedStyle(i,null);t="1%"!==a.top;o="4px"===a.width;r.removeChild(n)}}();d.swap=function(e,t,o,r){var n,i,a={};for(i in t){a[i]=e.style[i];e.style[i]=t[i]}n=o.apply(e,r||[]);for(i in t)e.style[i]=a[i];return n};var Te=/^(none|table(?!-c[ea]).+)/,_e=new RegExp("^("+B+")(.*)$","i"),Se=new RegExp("^([+-])=("+B+")","i"),Ee={position:"absolute",visibility:"hidden",display:"block"},Le={letterSpacing:"0",fontWeight:"400"},we=["Webkit","O","Moz","ms"];function be(e,t){if(t in e)return t;for(var o=t[0].toUpperCase()+t.slice(1),r=t,n=we.length;n--;)if((t=we[n]+o)in e)return t;return r}function xe(e,t,o){var r=_e.exec(t);return r?Math.max(0,r[1]-(o||0))+(r[2]||"px"):t}function Ae(e,t,o,r,n){for(var i=o===(r?"border":"content")?4:"width"===t?1:0,a=0;i<4;i+=2){"margin"===o&&(a+=d.css(e,o+U[i],!0,n));if(r){"content"===o&&(a-=d.css(e,"padding"+U[i],!0,n));"margin"!==o&&(a-=d.css(e,"border"+U[i]+"Width",!0,n))}else{a+=d.css(e,"padding"+U[i],!0,n);"padding"!==o&&(a+=d.css(e,"border"+U[i]+"Width",!0,n))}}return a}function Pe(e,t,o){var r=!0,n="width"===t?e.offsetWidth:e.offsetHeight,i=ye(e),a="border-box"===d.css(e,"boxSizing",!1,i);if(n<=0||null==n){((n=Ce(e,t,i))<0||null==n)&&(n=e.style[t]);if(me.test(n))return n;r=a&&(u.boxSizingReliable()||n===e.style[t]);n=parseFloat(n)||0}return n+Ae(e,t,o||(a?"border":"content"),r,i)+"px"}function Re(e,t){for(var o,r,n,i=[],a=0,s=e.length;a<s;a++)if((r=e[a]).style){i[a]=N.get(r,"olddisplay");o=r.style.display;if(t){i[a]||"none"!==o||(r.style.display="");""===r.style.display&&j(r)&&(i[a]=N.access(r,"olddisplay",fe(r.nodeName)))}else{n=j(r);"none"===o&&n||N.set(r,"olddisplay",n?o:d.css(r,"display"))}}for(a=0;a<s;a++)(r=e[a]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?i[a]||"":"none"));return e}d.extend({cssHooks:{opacity:{get:function(e,t){if(t){var o=Ce(e,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,o,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,i,a,s=d.camelCase(t),l=e.style;t=d.cssProps[s]||(d.cssProps[s]=be(l,s));a=d.cssHooks[t]||d.cssHooks[s];if(void 0===o)return a&&"get"in a&&void 0!==(n=a.get(e,!1,r))?n:l[t];if("string"===(i=typeof o)&&(n=Se.exec(o))){o=(n[1]+1)*n[2]+parseFloat(d.css(e,t));i="number"}if(null!=o&&o==o){"number"!==i||d.cssNumber[s]||(o+="px");u.clearCloneStyle||""!==o||0!==t.indexOf("background")||(l[t]="inherit");a&&"set"in a&&void 0===(o=a.set(e,o,r))||(l[t]=o)}}},css:function(e,t,o,r){var n,i,a,s=d.camelCase(t);t=d.cssProps[s]||(d.cssProps[s]=be(e.style,s));(a=d.cssHooks[t]||d.cssHooks[s])&&"get"in a&&(n=a.get(e,!0,o));void 0===n&&(n=Ce(e,t,r));"normal"===n&&t in Le&&(n=Le[t]);if(""===o||o){i=parseFloat(n);return!0===o||d.isNumeric(i)?i||0:n}return n}});d.each(["height","width"],function(e,t){d.cssHooks[t]={get:function(e,o,r){if(o)return Te.test(d.css(e,"display"))&&0===e.offsetWidth?d.swap(e,Ee,function(){return Pe(e,t,r)}):Pe(e,t,r)},set:function(e,o,r){var n=r&&ye(e);return xe(0,o,r?Ae(e,t,r,"border-box"===d.css(e,"boxSizing",!1,n),n):0)}}});d.cssHooks.marginRight=ve(u.reliableMarginRight,function(e,t){if(t)return d.swap(e,{display:"inline-block"},Ce,[e,"marginRight"])});d.each({margin:"",padding:"",border:"Width"},function(e,t){d.cssHooks[e+t]={expand:function(o){for(var r=0,n={},i="string"==typeof o?o.split(" "):[o];r<4;r++)n[e+U[r]+t]=i[r]||i[r-2]||i[0];return n}};ge.test(e)||(d.cssHooks[e+t].set=xe)});d.fn.extend({css:function(e,t){return I(this,function(e,t,o){var r,n,i={},a=0;if(d.isArray(t)){r=ye(e);n=t.length;for(;a<n;a++)i[t[a]]=d.css(e,t[a],!1,r);return i}return void 0!==o?d.style(e,t,o):d.css(e,t)},e,t,arguments.length>1)},show:function(){return Re(this,!0)},hide:function(){return Re(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){j(this)?d(this).show():d(this).hide()})}});function Me(e,t,o,r,n){return new Me.prototype.init(e,t,o,r,n)}d.Tween=Me;Me.prototype={constructor:Me,init:function(e,t,o,r,n,i){this.elem=e;this.prop=o;this.easing=n||"swing";this.options=t;this.start=this.now=this.cur();this.end=r;this.unit=i||(d.cssNumber[o]?"":"px")},cur:function(){var e=Me.propHooks[this.prop];return e&&e.get?e.get(this):Me.propHooks._default.get(this)},run:function(e){var t,o=Me.propHooks[this.prop];this.options.duration?this.pos=t=d.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e;this.now=(this.end-this.start)*t+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);o&&o.set?o.set(this):Me.propHooks._default.set(this);return this}};Me.prototype.init.prototype=Me.prototype;Me.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=d.css(e.elem,e.prop,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){d.fx.step[e.prop]?d.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[d.cssProps[e.prop]]||d.cssHooks[e.prop])?d.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}};Me.propHooks.scrollTop=Me.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};d.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};d.fx=Me.prototype.init;d.fx.step={};var Ie,Oe,Ne=/^(?:toggle|show|hide)$/,De=new RegExp("^(?:([+-])=|)("+B+")([a-z%]*)$","i"),Fe=/queueHooks$/,ke=[function(e,t,o){var r,n,i,a,s,l,c,u=this,h={},p=e.style,f=e.nodeType&&j(e),g=N.get(e,"fxshow");if(!o.queue){if(null==(s=d._queueHooks(e,"fx")).unqueued){s.unqueued=0;l=s.empty.fire;s.empty.fire=function(){s.unqueued||l()}}s.unqueued++;u.always(function(){u.always(function(){s.unqueued--;d.queue(e,"fx").length||s.empty.fire()})})}if(1===e.nodeType&&("height"in t||"width"in t)){o.overflow=[p.overflow,p.overflowX,p.overflowY];c=d.css(e,"display");"inline"===("none"===c?N.get(e,"olddisplay")||fe(e.nodeName):c)&&"none"===d.css(e,"float")&&(p.display="inline-block")}if(o.overflow){p.overflow="hidden";u.always(function(){p.overflow=o.overflow[0];p.overflowX=o.overflow[1];p.overflowY=o.overflow[2]})}for(r in t){n=t[r];if(Ne.exec(n)){delete t[r];i=i||"toggle"===n;if(n===(f?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;f=!0}h[r]=g&&g[r]||d.style(e,r)}else c=void 0}if(d.isEmptyObject(h))"inline"===("none"===c?fe(e.nodeName):c)&&(p.display=c);else{g?"hidden"in g&&(f=g.hidden):g=N.access(e,"fxshow",{});i&&(g.hidden=!f);f?d(e).show():u.done(function(){d(e).hide()});u.done(function(){var t;N.remove(e,"fxshow");for(t in h)d.style(e,t,h[t])});for(r in h){a=je(f?g[r]:0,r,u);if(!(r in g)){g[r]=a.start;if(f){a.end=a.start;a.start="width"===r||"height"===r?1:0}}}}}],Ge={"*":[function(e,t){var o=this.createTween(e,t),r=o.cur(),n=De.exec(t),i=n&&n[3]||(d.cssNumber[e]?"":"px"),a=(d.cssNumber[e]||"px"!==i&&+r)&&De.exec(d.css(o.elem,e)),s=1,l=20;if(a&&a[3]!==i){i=i||a[3];n=n||[];a=+r||1;do{a/=s=s||".5";d.style(o.elem,e,a+i)}while(s!==(s=o.cur()/r)&&1!==s&&--l)}if(n){a=o.start=+a||+r||0;o.unit=i;o.end=n[1]?a+(n[1]+1)*n[2]:+n[2]}return o}]};function Be(){setTimeout(function(){Ie=void 0});return Ie=d.now()}function Ue(e,t){var o,r=0,n={height:e};t=t?1:0;for(;r<4;r+=2-t)n["margin"+(o=U[r])]=n["padding"+o]=e;t&&(n.opacity=n.width=e);return n}function je(e,t,o){for(var r,n=(Ge[t]||[]).concat(Ge["*"]),i=0,a=n.length;i<a;i++)if(r=n[i].call(o,t,e))return r}function We(e,t,o){var r,n,i=0,a=ke.length,s=d.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=Ie||Be(),o=Math.max(0,c.startTime+c.duration-t),r=1-(o/c.duration||0),i=0,a=c.tweens.length;i<a;i++)c.tweens[i].run(r);s.notifyWith(e,[c,r,o]);if(r<1&&a)return o;s.resolveWith(e,[c]);return!1},c=s.promise({elem:e,props:d.extend({},t),opts:d.extend(!0,{specialEasing:{}},o),originalProperties:t,originalOptions:o,startTime:Ie||Be(),duration:o.duration,tweens:[],createTween:function(t,o){var r=d.Tween(e,c.opts,t,o,c.opts.specialEasing[t]||c.opts.easing);c.tweens.push(r);return r},stop:function(t){var o=0,r=t?c.tweens.length:0;if(n)return this;n=!0;for(;o<r;o++)c.tweens[o].run(1);t?s.resolveWith(e,[c,t]):s.rejectWith(e,[c,t]);return this}}),u=c.props;!function(e,t){var o,r,n,i,a;for(o in e){n=t[r=d.camelCase(o)];i=e[o];if(d.isArray(i)){n=i[1];i=e[o]=i[0]}if(o!==r){e[r]=i;delete e[o]}if((a=d.cssHooks[r])&&"expand"in a){i=a.expand(i);delete e[r];for(o in i)if(!(o in e)){e[o]=i[o];t[o]=n}}else t[r]=n}}(u,c.opts.specialEasing);for(;i<a;i++)if(r=ke[i].call(c,e,u,c.opts))return r;d.map(u,je,c);d.isFunction(c.opts.start)&&c.opts.start.call(e,c);d.fx.timer(d.extend(l,{elem:e,anim:c,queue:c.opts.queue}));return c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}d.Animation=d.extend(We,{tweener:function(e,t){if(d.isFunction(e)){t=e;e=["*"]}else e=e.split(" ");for(var o,r=0,n=e.length;r<n;r++){o=e[r];Ge[o]=Ge[o]||[];Ge[o].unshift(t)}},prefilter:function(e,t){t?ke.unshift(e):ke.push(e)}});d.speed=function(e,t,o){var r=e&&"object"==typeof e?d.extend({},e):{complete:o||!o&&t||d.isFunction(e)&&e,duration:e,easing:o&&t||t&&!d.isFunction(t)&&t};r.duration=d.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in d.fx.speeds?d.fx.speeds[r.duration]:d.fx.speeds._default;null!=r.queue&&!0!==r.queue||(r.queue="fx");r.old=r.complete;r.complete=function(){d.isFunction(r.old)&&r.old.call(this);r.queue&&d.dequeue(this,r.queue)};return r};d.fn.extend({fadeTo:function(e,t,o,r){return this.filter(j).css("opacity",0).show().end().animate({opacity:t},e,o,r)},animate:function(e,t,o,r){var n=d.isEmptyObject(e),i=d.speed(t,o,r),a=function(){var t=We(this,d.extend({},e),i);(n||N.get(this,"finish"))&&t.stop(!0)};a.finish=a;return n||!1===i.queue?this.each(a):this.queue(i.queue,a)},stop:function(e,t,o){var r=function(e){var t=e.stop;delete e.stop;t(o)};if("string"!=typeof e){o=t;t=e;e=void 0}t&&!1!==e&&this.queue(e||"fx",[]);return this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",i=d.timers,a=N.get(this);if(n)a[n]&&a[n].stop&&r(a[n]);else for(n in a)a[n]&&a[n].stop&&Fe.test(n)&&r(a[n]);for(n=i.length;n--;)if(i[n].elem===this&&(null==e||i[n].queue===e)){i[n].anim.stop(o);t=!1;i.splice(n,1)}!t&&o||d.dequeue(this,e)})},finish:function(e){!1!==e&&(e=e||"fx");return this.each(function(){var t,o=N.get(this),r=o[e+"queue"],n=o[e+"queueHooks"],i=d.timers,a=r?r.length:0;o.finish=!0;d.queue(this,e,[]);n&&n.stop&&n.stop.call(this,!0);for(t=i.length;t--;)if(i[t].elem===this&&i[t].queue===e){i[t].anim.stop(!0);i.splice(t,1)}for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete o.finish})}});d.each(["toggle","show","hide"],function(e,t){var o=d.fn[t];d.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(Ue(t,!0),e,r,n)}});d.each({slideDown:Ue("show"),slideUp:Ue("hide"),slideToggle:Ue("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){d.fn[e]=function(e,o,r){return this.animate(t,e,o,r)}});d.timers=[];d.fx.tick=function(){var e,t=0,o=d.timers;Ie=d.now();for(;t<o.length;t++)(e=o[t])()||o[t]!==e||o.splice(t--,1);o.length||d.fx.stop();Ie=void 0};d.fx.timer=function(e){d.timers.push(e);e()?d.fx.start():d.timers.pop()};d.fx.interval=13;d.fx.start=function(){Oe||(Oe=setInterval(d.fx.tick,d.fx.interval))};d.fx.stop=function(){clearInterval(Oe);Oe=null};d.fx.speeds={slow:600,fast:200,_default:400};d.fn.delay=function(e,t){e=d.fx&&d.fx.speeds[e]||e;t=t||"fx";return this.queue(t,function(t,o){var r=setTimeout(t,e);o.stop=function(){clearTimeout(r)}})};!function(){var e=h.createElement("input"),t=h.createElement("select"),o=t.appendChild(h.createElement("option"));e.type="checkbox";u.checkOn=""!==e.value;u.optSelected=o.selected;t.disabled=!0;u.optDisabled=!o.disabled;(e=h.createElement("input")).value="t";e.type="radio";u.radioValue="t"===e.value}();var Ve,He=d.expr.attrHandle;d.fn.extend({attr:function(e,t){return I(this,d.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){d.removeAttr(this,e)})}});d.extend({attr:function(e,t,o){var r,n,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i){if(void 0===e.getAttribute)return d.prop(e,t,o);if(1!==i||!d.isXMLDoc(e)){t=t.toLowerCase();r=d.attrHooks[t]||(d.expr.match.bool.test(t)?Ve:void 0)}if(void 0===o)return r&&"get"in r&&null!==(n=r.get(e,t))?n:null==(n=d.find.attr(e,t))?void 0:n;if(null!==o){if(r&&"set"in r&&void 0!==(n=r.set(e,o,t)))return n;e.setAttribute(t,o+"");return o}d.removeAttr(e,t)}},removeAttr:function(e,t){var o,r,n=0,i=t&&t.match(P);if(i&&1===e.nodeType)for(;o=i[n++];){r=d.propFix[o]||o;d.expr.match.bool.test(o)&&(e[r]=!1);e.removeAttribute(o)}},attrHooks:{type:{set:function(e,t){if(!u.radioValue&&"radio"===t&&d.nodeName(e,"input")){var o=e.value;e.setAttribute("type",t);o&&(e.value=o);return t}}}}});Ve={set:function(e,t,o){!1===t?d.removeAttr(e,o):e.setAttribute(o,o);return o}};d.each(d.expr.match.bool.source.match(/\w+/g),function(e,t){var o=He[t]||d.find.attr;He[t]=function(e,t,r){var n,i;if(!r){i=He[t];He[t]=n;n=null!=o(e,t,r)?t.toLowerCase():null;He[t]=i}return n}});var qe=/^(?:input|select|textarea|button)$/i;d.fn.extend({prop:function(e,t){return I(this,d.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[d.propFix[e]||e]})}});d.extend({propFix:{for:"htmlFor",class:"className"},prop:function(e,t,o){var r,n,i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i){if(1!==i||!d.isXMLDoc(e)){t=d.propFix[t]||t;n=d.propHooks[t]}return void 0!==o?n&&"set"in n&&void 0!==(r=n.set(e,o,t))?r:e[t]=o:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]}},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||qe.test(e.nodeName)||e.href?e.tabIndex:-1}}}});u.optSelected||(d.propHooks.selected={get:function(e){var t=e.parentNode;t&&t.parentNode&&t.parentNode.selectedIndex;return null}});d.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){d.propFix[this.toLowerCase()]=this});var Xe=/[\t\r\n\f]/g;d.fn.extend({addClass:function(e){var t,o,r,n,i,a,s="string"==typeof e&&e,l=0,c=this.length;if(d.isFunction(e))return this.each(function(t){d(this).addClass(e.call(this,t,this.className))});if(s){t=(e||"").match(P)||[];for(;l<c;l++)if(r=1===(o=this[l]).nodeType&&(o.className?(" "+o.className+" ").replace(Xe," "):" ")){i=0;for(;n=t[i++];)r.indexOf(" "+n+" ")<0&&(r+=n+" ");a=d.trim(r);o.className!==a&&(o.className=a)}}return this},removeClass:function(e){var t,o,r,n,i,a,s=0===arguments.length||"string"==typeof e&&e,l=0,c=this.length;if(d.isFunction(e))return this.each(function(t){d(this).removeClass(e.call(this,t,this.className))});if(s){t=(e||"").match(P)||[];for(;l<c;l++)if(r=1===(o=this[l]).nodeType&&(o.className?(" "+o.className+" ").replace(Xe," "):"")){i=0;for(;n=t[i++];)for(;r.indexOf(" "+n+" ")>=0;)r=r.replace(" "+n+" "," ");a=e?d.trim(r):"";o.className!==a&&(o.className=a)}}return this},toggleClass:function(e,t){var o=typeof e;return"boolean"==typeof t&&"string"===o?t?this.addClass(e):this.removeClass(e):d.isFunction(e)?this.each(function(o){d(this).toggleClass(e.call(this,o,this.className,t),t)}):this.each(function(){if("string"===o)for(var t,r=0,n=d(this),i=e.match(P)||[];t=i[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else if("undefined"===o||"boolean"===o){this.className&&N.set(this,"__className__",this.className);this.className=this.className||!1===e?"":N.get(this,"__className__")||""}})},hasClass:function(e){for(var t=" "+e+" ",o=0,r=this.length;o<r;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(Xe," ").indexOf(t)>=0)return!0;return!1}});var Ye=/\r/g;d.fn.extend({val:function(e){var t,o,r,n=this[0];if(!arguments.length)return n?(t=d.valHooks[n.type]||d.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(o=t.get(n,"value"))?o:"string"==typeof(o=n.value)?o.replace(Ye,""):null==o?"":o:void 0;r=d.isFunction(e);return this.each(function(o){var n;if(1===this.nodeType){null==(n=r?e.call(this,o,d(this).val()):e)?n="":"number"==typeof n?n+="":d.isArray(n)&&(n=d.map(n,function(e){return null==e?"":e+""}));(t=d.valHooks[this.type]||d.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n)}})}});d.extend({valHooks:{option:{get:function(e){var t=d.find.attr(e,"value");return null!=t?t:d.trim(d.text(e))}},select:{get:function(e){for(var t,o,r=e.options,n=e.selectedIndex,i="select-one"===e.type||n<0,a=i?null:[],s=i?n+1:r.length,l=n<0?s:i?n:0;l<s;l++)if(((o=r[l]).selected||l===n)&&(u.optDisabled?!o.disabled:null===o.getAttribute("disabled"))&&(!o.parentNode.disabled||!d.nodeName(o.parentNode,"optgroup"))){t=d(o).val();if(i)return t;a.push(t)}return a},set:function(e,t){for(var o,r,n=e.options,i=d.makeArray(t),a=n.length;a--;)((r=n[a]).selected=d.inArray(r.value,i)>=0)&&(o=!0);o||(e.selectedIndex=-1);return i}}}});d.each(["radio","checkbox"],function(){d.valHooks[this]={set:function(e,t){if(d.isArray(t))return e.checked=d.inArray(d(e).val(),t)>=0}};u.checkOn||(d.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});d.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){d.fn[t]=function(e,o){return arguments.length>0?this.on(t,null,e,o):this.trigger(t)}});d.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,o){return this.on(e,null,t,o)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,o,r){return this.on(t,e,o,r)},undelegate:function(e,t,o){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",o)}});var Ke=d.now(),ze=/\?/;d.parseJSON=function(e){return JSON.parse(e+"")};d.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}t&&!t.getElementsByTagName("parsererror").length||d.error("Invalid XML: "+e);return t};var $e=/#.*$/,Je=/([?&])_=[^&]*/,Ze=/^(.*?):[ \t]*([^\r\n]*)$/gm,Qe=/^(?:GET|HEAD)$/,et=/^\/\//,tt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,ot={},rt={},nt="*/".concat("*"),it=e.location.href,at=tt.exec(it.toLowerCase())||[];function st(e){return function(t,o){if("string"!=typeof t){o=t;t="*"}var r,n=0,i=t.toLowerCase().match(P)||[];if(d.isFunction(o))for(;r=i[n++];)if("+"===r[0]){r=r.slice(1)||"*";(e[r]=e[r]||[]).unshift(o)}else(e[r]=e[r]||[]).push(o)}}function lt(e,t,o,r){var n={},i=e===rt;function a(s){var l;n[s]=!0;d.each(e[s]||[],function(e,s){var c=s(t,o,r);if("string"==typeof c&&!i&&!n[c]){t.dataTypes.unshift(c);a(c);return!1}if(i)return!(l=c)});return l}return a(t.dataTypes[0])||!n["*"]&&a("*")}function ct(e,t){var o,r,n=d.ajaxSettings.flatOptions||{};for(o in t)void 0!==t[o]&&((n[o]?e:r||(r={}))[o]=t[o]);r&&d.extend(!0,e,r);return e}d.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:it,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(at[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":d.parseJSON,"text xml":d.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ct(ct(e,d.ajaxSettings),t):ct(d.ajaxSettings,e)},ajaxPrefilter:st(ot),ajaxTransport:st(rt),ajax:function(e,t){if("object"==typeof e){t=e;e=void 0}t=t||{};var o,r,n,i,a,s,l,c,u=d.ajaxSetup({},t),h=u.context||u,p=u.context&&(h.nodeType||h.jquery)?d(h):d.event,f=d.Deferred(),g=d.Callbacks("once memory"),m=u.statusCode||{},y={},C={},v=0,T="canceled",_={readyState:0,getResponseHeader:function(e){var t;if(2===v){if(!i){i={};for(;t=Ze.exec(n);)i[t[1].toLowerCase()]=t[2]}t=i[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===v?n:null},setRequestHeader:function(e,t){var o=e.toLowerCase();if(!v){e=C[o]=C[o]||e;y[e]=t}return this},overrideMimeType:function(e){v||(u.mimeType=e);return this},statusCode:function(e){var t;if(e)if(v<2)for(t in e)m[t]=[m[t],e[t]];else _.always(e[_.status]);return this},abort:function(e){var t=e||T;o&&o.abort(t);S(0,t);return this}};f.promise(_).complete=g.add;_.success=_.done;_.error=_.fail;u.url=((e||u.url||it)+"").replace($e,"").replace(et,at[1]+"//");u.type=t.method||t.type||u.method||u.type;u.dataTypes=d.trim(u.dataType||"*").toLowerCase().match(P)||[""];if(null==u.crossDomain){s=tt.exec(u.url.toLowerCase());u.crossDomain=!(!s||s[1]===at[1]&&s[2]===at[2]&&(s[3]||("http:"===s[1]?"80":"443"))===(at[3]||("http:"===at[1]?"80":"443")))}u.data&&u.processData&&"string"!=typeof u.data&&(u.data=d.param(u.data,u.traditional));lt(ot,u,t,_);if(2===v)return _;(l=d.event&&u.global)&&0==d.active++&&d.event.trigger("ajaxStart");u.type=u.type.toUpperCase();u.hasContent=!Qe.test(u.type);r=u.url;if(!u.hasContent){if(u.data){r=u.url+=(ze.test(r)?"&":"?")+u.data;delete u.data}!1===u.cache&&(u.url=Je.test(r)?r.replace(Je,"$1_="+Ke++):r+(ze.test(r)?"&":"?")+"_="+Ke++)}if(u.ifModified){d.lastModified[r]&&_.setRequestHeader("If-Modified-Since",d.lastModified[r]);d.etag[r]&&_.setRequestHeader("If-None-Match",d.etag[r])}(u.data&&u.hasContent&&!1!==u.contentType||t.contentType)&&_.setRequestHeader("Content-Type",u.contentType);_.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+nt+"; q=0.01":""):u.accepts["*"]);for(c in u.headers)_.setRequestHeader(c,u.headers[c]);if(u.beforeSend&&(!1===u.beforeSend.call(h,_,u)||2===v))return _.abort();T="abort";for(c in{success:1,error:1,complete:1})_[c](u[c]);if(o=lt(rt,u,t,_)){_.readyState=1;l&&p.trigger("ajaxSend",[_,u]);u.async&&u.timeout>0&&(a=setTimeout(function(){_.abort("timeout")},u.timeout));try{v=1;o.send(y,S)}catch(e){if(!(v<2))throw e;S(-1,e)}}else S(-1,"No Transport");function S(e,t,i,s){var c,y,C,T,S,E=t;if(2!==v){v=2;a&&clearTimeout(a);o=void 0;n=s||"";_.readyState=e>0?4:0;c=e>=200&&e<300||304===e;i&&(T=function(e,t,o){for(var r,n,i,a,s=e.contents,l=e.dataTypes;"*"===l[0];){l.shift();void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"))}if(r)for(n in s)if(s[n]&&s[n].test(r)){l.unshift(n);break}if(l[0]in o)i=l[0];else{for(n in o){if(!l[0]||e.converters[n+" "+l[0]]){i=n;break}a||(a=n)}i=i||a}if(i){i!==l[0]&&l.unshift(i);return o[i]}}(u,_,i));T=function(e,t,o,r){var n,i,a,s,l,c={},u=e.dataTypes.slice();if(u[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];i=u.shift();for(;i;){e.responseFields[i]&&(o[e.responseFields[i]]=t);!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType));l=i;if(i=u.shift())if("*"===i)i=l;else if("*"!==l&&l!==i){if(!(a=c[l+" "+i]||c["* "+i]))for(n in c)if((s=n.split(" "))[1]===i&&(a=c[l+" "+s[0]]||c["* "+s[0]])){if(!0===a)a=c[n];else if(!0!==c[n]){i=s[0];u.unshift(s[1])}break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+i}}}}return{state:"success",data:t}}(u,T,_,c);if(c){if(u.ifModified){(S=_.getResponseHeader("Last-Modified"))&&(d.lastModified[r]=S);(S=_.getResponseHeader("etag"))&&(d.etag[r]=S)}if(204===e||"HEAD"===u.type)E="nocontent";else if(304===e)E="notmodified";else{E=T.state;y=T.data;c=!(C=T.error)}}else{C=E;if(e||!E){E="error";e<0&&(e=0)}}_.status=e;_.statusText=(t||E)+"";c?f.resolveWith(h,[y,E,_]):f.rejectWith(h,[_,E,C]);_.statusCode(m);m=void 0;l&&p.trigger(c?"ajaxSuccess":"ajaxError",[_,u,c?y:C]);g.fireWith(h,[_,E]);if(l){p.trigger("ajaxComplete",[_,u]);--d.active||d.event.trigger("ajaxStop")}}}return _},getJSON:function(e,t,o){return d.get(e,t,o,"json")},getScript:function(e,t){return d.get(e,void 0,t,"script")}});d.each(["get","post"],function(e,t){d[t]=function(e,o,r,n){if(d.isFunction(o)){n=n||r;r=o;o=void 0}return d.ajax({url:e,type:t,dataType:n,data:o,success:r})}});d._evalUrl=function(e){return d.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})};d.fn.extend({wrapAll:function(e){var t;if(d.isFunction(e))return this.each(function(t){d(this).wrapAll(e.call(this,t))});if(this[0]){t=d(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)}return this},wrapInner:function(e){return d.isFunction(e)?this.each(function(t){d(this).wrapInner(e.call(this,t))}):this.each(function(){var t=d(this),o=t.contents();o.length?o.wrapAll(e):t.append(e)})},wrap:function(e){var t=d.isFunction(e);return this.each(function(o){d(this).wrapAll(t?e.call(this,o):e)})},unwrap:function(){return this.parent().each(function(){d.nodeName(this,"body")||d(this).replaceWith(this.childNodes)}).end()}});d.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0};d.expr.filters.visible=function(e){return!d.expr.filters.hidden(e)};var ut=/%20/g,ht=/\[\]$/,dt=/\r?\n/g,pt=/^(?:submit|button|image|reset|file)$/i,ft=/^(?:input|select|textarea|keygen)/i;function gt(e,t,o,r){var n;if(d.isArray(t))d.each(t,function(t,n){o||ht.test(e)?r(e,n):gt(e+"["+("object"==typeof n?t:"")+"]",n,o,r)});else if(o||"object"!==d.type(t))r(e,t);else for(n in t)gt(e+"["+n+"]",t[n],o,r)}d.param=function(e,t){var o,r=[],n=function(e,t){t=d.isFunction(t)?t():null==t?"":t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};void 0===t&&(t=d.ajaxSettings&&d.ajaxSettings.traditional);if(d.isArray(e)||e.jquery&&!d.isPlainObject(e))d.each(e,function(){n(this.name,this.value)});else for(o in e)gt(o,e[o],t,n);return r.join("&").replace(ut,"+")};d.fn.extend({serialize:function(){return d.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=d.prop(this,"elements");return e?d.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!d(this).is(":disabled")&&ft.test(this.nodeName)&&!pt.test(e)&&(this.checked||!W.test(e))}).map(function(e,t){var o=d(this).val();return null==o?null:d.isArray(o)?d.map(o,function(e){return{name:t.name,value:e.replace(dt,"\r\n")}}):{name:t.name,value:o.replace(dt,"\r\n")}}).get()}});d.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var mt=0,yt={},Ct={0:200,1223:204},vt=d.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in yt)yt[e]()});u.cors=!!vt&&"withCredentials"in vt;u.ajax=vt=!!vt;d.ajaxTransport(function(e){var t;if(u.cors||vt&&!e.crossDomain)return{send:function(o,r){var n,i=e.xhr(),a=++mt;i.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(n in e.xhrFields)i[n]=e.xhrFields[n];e.mimeType&&i.overrideMimeType&&i.overrideMimeType(e.mimeType);e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(n in o)i.setRequestHeader(n,o[n]);t=function(e){return function(){if(t){delete yt[a];t=i.onload=i.onerror=null;"abort"===e?i.abort():"error"===e?r(i.status,i.statusText):r(Ct[i.status]||i.status,i.statusText,"string"==typeof i.responseText?{text:i.responseText}:void 0,i.getAllResponseHeaders())}}};i.onload=t();i.onerror=t("error");t=yt[a]=t("abort");try{i.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}});d.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){d.globalEval(e);return e}}});d.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1);e.crossDomain&&(e.type="GET")});d.ajaxTransport("script",function(e){if(e.crossDomain){var t,o;return{send:function(r,n){t=d("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",o=function(e){t.remove();o=null;e&&n("error"===e.type?404:200,e.type)});h.head.appendChild(t[0])},abort:function(){o&&o()}}}});var Tt=[],_t=/(=)\?(?=&|$)|\?\?/;d.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Tt.pop()||d.expando+"_"+Ke++;this[e]=!0;return e}});d.ajaxPrefilter("json jsonp",function(t,o,r){var n,i,a,s=!1!==t.jsonp&&(_t.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&_t.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0]){n=t.jsonpCallback=d.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback;s?t[s]=t[s].replace(_t,"$1"+n):!1!==t.jsonp&&(t.url+=(ze.test(t.url)?"&":"?")+t.jsonp+"="+n);t.converters["script json"]=function(){a||d.error(n+" was not called");return a[0]};t.dataTypes[0]="json";i=e[n];e[n]=function(){a=arguments};r.always(function(){e[n]=i;if(t[n]){t.jsonpCallback=o.jsonpCallback;Tt.push(n)}a&&d.isFunction(i)&&i(a[0]);a=i=void 0});return"script"}});d.parseHTML=function(e,t,o){if(!e||"string"!=typeof e)return null;if("boolean"==typeof t){o=t;t=!1}t=t||h;var r=T.exec(e),n=!o&&[];if(r)return[t.createElement(r[1])];r=d.buildFragment([e],t,n);n&&n.length&&d(n).remove();return d.merge([],r.childNodes)};var St=d.fn.load;d.fn.load=function(e,t,o){if("string"!=typeof e&&St)return St.apply(this,arguments);var r,n,i,a=this,s=e.indexOf(" ");if(s>=0){r=d.trim(e.slice(s));e=e.slice(0,s)}if(d.isFunction(t)){o=t;t=void 0}else t&&"object"==typeof t&&(n="POST");a.length>0&&d.ajax({url:e,type:n,dataType:"html",data:t}).done(function(e){i=arguments;a.html(r?d("<div>").append(d.parseHTML(e)).find(r):e)}).complete(o&&function(e,t){a.each(o,i||[e.responseText,t,e])});return this};d.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){d.fn[t]=function(e){return this.on(t,e)}});d.expr.filters.animated=function(e){return d.grep(d.timers,function(t){return e===t.elem}).length};var Et=e.document.documentElement;function Lt(e){return d.isWindow(e)?e:9===e.nodeType&&e.defaultView}d.offset={setOffset:function(e,t,o){var r,n,i,a,s,l,c=d.css(e,"position"),u=d(e),h={};"static"===c&&(e.style.position="relative");s=u.offset();i=d.css(e,"top");l=d.css(e,"left");if(("absolute"===c||"fixed"===c)&&(i+l).indexOf("auto")>-1){a=(r=u.position()).top;n=r.left}else{a=parseFloat(i)||0;n=parseFloat(l)||0}d.isFunction(t)&&(t=t.call(e,o,s));null!=t.top&&(h.top=t.top-s.top+a);null!=t.left&&(h.left=t.left-s.left+n);"using"in t?t.using.call(e,h):u.css(h)}};d.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){d.offset.setOffset(this,e,t)});var t,o,r=this[0],n={top:0,left:0},i=r&&r.ownerDocument;if(i){t=i.documentElement;if(!d.contains(t,r))return n;void 0!==r.getBoundingClientRect&&(n=r.getBoundingClientRect());o=Lt(i);return{top:n.top+o.pageYOffset-t.clientTop,left:n.left+o.pageXOffset-t.clientLeft}}},position:function(){if(this[0]){var e,t,o=this[0],r={top:0,left:0};if("fixed"===d.css(o,"position"))t=o.getBoundingClientRect();else{e=this.offsetParent();t=this.offset();d.nodeName(e[0],"html")||(r=e.offset());r.top+=d.css(e[0],"borderTopWidth",!0);r.left+=d.css(e[0],"borderLeftWidth",!0)}return{top:t.top-r.top-d.css(o,"marginTop",!0),left:t.left-r.left-d.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Et;e&&!d.nodeName(e,"html")&&"static"===d.css(e,"position");)e=e.offsetParent;return e||Et})}});d.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,o){var r="pageYOffset"===o;d.fn[t]=function(n){return I(this,function(t,n,i){var a=Lt(t);if(void 0===i)return a?a[o]:t[n];a?a.scrollTo(r?e.pageXOffset:i,r?i:e.pageYOffset):t[n]=i},t,n,arguments.length,null)}});d.each(["top","left"],function(e,t){d.cssHooks[t]=ve(u.pixelPosition,function(e,o){if(o){o=Ce(e,t);return me.test(o)?d(e).position()[t]+"px":o}})});d.each({Height:"height",Width:"width"},function(e,t){d.each({padding:"inner"+e,content:t,"":"outer"+e},function(o,r){d.fn[r]=function(r,n){var i=arguments.length&&(o||"boolean"!=typeof r),a=o||(!0===r||!0===n?"margin":"border");return I(this,function(t,o,r){var n;if(d.isWindow(t))return t.document.documentElement["client"+e];if(9===t.nodeType){n=t.documentElement;return Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])}return void 0===r?d.css(t,o,a):d.style(t,o,r,a)},t,i?r:void 0,i,null)}})});d.fn.size=function(){return this.length};d.fn.andSelf=d.fn.addBack;"function"==typeof define&&define.amd&&define("jquery",[],function(){return d});var wt=e.jQuery,bt=e.$;d.noConflict=function(t){e.$===d&&(e.$=bt);t&&e.jQuery===d&&(e.jQuery=wt);return d};void 0===t&&(e.jQuery=e.$=d);return d});!function(e){"use strict";e();var t=function(t,r,n){var i=[];if(r)if(n.buildHTML)e(n.target).html(n.buildHTML({results:r}));else{for(var a=0;a<r.length;a++){var s=r[a];e.isPlainObject(s)?i[i.length]='<li><a href="'+n.link+encodeURIComponent(s.id)+'">'+s.label+"</a></li>":i[i.length]='<li><a href="'+n.link+encodeURIComponent(s)+'">'+s+"</a></li>"}e(n.target).html(i.join(""))}null!==n.callback&&e.isFunction(n.callback)&&o(n);t.val().length>0?t.trigger("targetUpdated.autocomplete"):t.trigger("targetCleared.autocomplete")},o=function(t){e("li a",e(t.target)).on("click.autocomplete",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})},r=function(e,t){t.html("").closest("fieldset").removeClass("ui-search-active");e.trigger("targetCleared.autocomplete")},n=function(o){var n,i,a,s,l=e(this),c=l.attr("id"),u=l.data("autocomplete");if(u){var h=u.settings,d=u.openXHR;if((n=l.val()).length<h.minLength)r(l,e(h.target));else if(e.isArray(h.source)){i=h.source.sort().filter(function(t){s=h.matchFromStart?new RegExp("^"+n,"i"):new RegExp(n,"i");a=e.isPlainObject(t)?t.label:t;return s.test(a)});t(l,i,h)}else if("function"==typeof h.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;h.source(n,function(e){t(l,e,h)})}else e.ajax({type:h.method,url:h.source,data:{term:n},beforeSend:function(e){if(h.cancelRequests){if(d[c])d[c].abort();else{h.target.html('<li><a href="#">Searching...</a></li>');h.target.closest("fieldset").addClass("ui-search-active")}d[c]=e}},success:function(e){t(l,e,h)},complete:function(e,t){h.cancelRequests&&(d[c]=null)},dataType:"json"})}},i={init:function(t){var o=this,i={settings:null};i.settings=e.extend({},i.defaults,t);o.data("autocomplete",i);var a=i.settings;return o.off("keyup.autocomplete").on("keyup.autocomplete",n).next(".ui-input-clear").on("click",function(t){r(o,e(a.target))})},update:function(t){var o=this.data("autocomplete");if(o){o.settings=e.extend(o.settings,t);this.data("autocomplete",o)}return this},clear:function(){var t=this.data("autocomplete");t&&r(this,e(t.settings.target));return this},destroy:function(){var t=this.data("autocomplete");if(t){r(this,e(t.settings.target));this.removeData("autocomplete");this.off(".autocomplete")}return this}};e.fn.autocomplete=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:i.init.apply(this,arguments)}}(jQuery);!function(e,t){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(o){return t(e,o)}):"object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.jQueryBridget=t(e,e.jQuery)}(window,function(e,t){"use strict";var o=Array.prototype.slice,r=e.console,n=void 0===r?function(){}:function(e){r.error(e)};function i(r,i,s){(s=s||t||e.jQuery)&&(i.prototype.option||(i.prototype.option=function(e){s.isPlainObject(e)&&(this.options=s.extend(!0,this.options,e))}),s.fn[r]=function(e){if("string"==typeof e){var t=o.call(arguments,1);return l=t,u="$()."+r+'("'+(a=e)+'")',this.each(function(e,t){var o=s.data(t,r);if(o){var i=o[a];if(i&&"_"!=a.charAt(0)){var h=i.apply(o,l);c=void 0===c?h:c}else n(u+" is not a valid method")}else n(r+" not initialized. Cannot call methods, i.e. "+u)}),void 0!==c?c:this}var a,l,c,u,h;return h=e,this.each(function(e,t){var o=s.data(t,r);o?(o.option(h),o._init()):(o=new i(t,h),s.data(t,r,o))}),this},a(s))}function a(e){!e||e&&e.bridget||(e.bridget=i)}return a(t||e.jQuery),i}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.getSize=t()}(window,function(){"use strict";function e(e){var t=parseFloat(e);return-1==e.indexOf("%")&&!isNaN(t)&&t}var t="undefined"==typeof console?function(){}:function(e){console.error(e)},o=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],r=o.length;function n(e){var o=getComputedStyle(e);return o||t("Style returned "+o+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),o}var i,a=!1;return function t(s){if(function(){if(!a){a=!0;var o=document.createElement("div");o.style.width="200px",o.style.padding="1px 2px 3px 4px",o.style.borderStyle="solid",o.style.borderWidth="1px 2px 3px 4px",o.style.boxSizing="border-box";var r=document.body||document.documentElement;r.appendChild(o);var s=n(o);t.isBoxSizeOuter=i=200==e(s.width),r.removeChild(o)}}(),"string"==typeof s&&(s=document.querySelector(s)),s&&"object"==typeof s&&s.nodeType){var l=n(s);if("none"==l.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<r;t++)e[o[t]]=0;return e}();var c={};c.width=s.offsetWidth,c.height=s.offsetHeight;for(var u=c.isBorderBox="border-box"==l.boxSizing,h=0;h<r;h++){var d=o[h],p=l[d],f=parseFloat(p);c[d]=isNaN(f)?0:f}var g=c.paddingLeft+c.paddingRight,m=c.paddingTop+c.paddingBottom,y=c.marginLeft+c.marginRight,C=c.marginTop+c.marginBottom,v=c.borderLeftWidth+c.borderRightWidth,T=c.borderTopWidth+c.borderBottomWidth,_=u&&i,S=e(l.width);!1!==S&&(c.width=S+(_?0:g+v));var E=e(l.height);return!1!==E&&(c.height=E+(_?0:m+T)),c.innerWidth=c.width-(g+v),c.innerHeight=c.height-(m+T),c.outerWidth=c.width+y,c.outerHeight=c.height+C,c}}}),function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var o=this._events=this._events||{},r=o[e]=o[e]||[];return-1==r.indexOf(t)&&r.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var o=this._onceEvents=this._onceEvents||{};return(o[e]=o[e]||{})[t]=!0,this}},t.off=function(e,t){var o=this._events&&this._events[e];if(o&&o.length){var r=o.indexOf(t);return-1!=r&&o.splice(r,1),this}},t.emitEvent=function(e,t){var o=this._events&&this._events[e];if(o&&o.length){o=o.slice(0),t=t||[];for(var r=this._onceEvents&&this._onceEvents[e],n=0;n<o.length;n++){var i=o[n];r&&r[i]&&(this.off(e,i),delete r[i]),i.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"function"==typeof define&&define.amd?define("unipointer/unipointer",["ev-emitter/ev-emitter"],function(o){return t(e,o)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.Unipointer=t(e,e.EvEmitter)}(window,function(e,t){function o(){}var r=o.prototype=Object.create(t.prototype);r.bindStartEvent=function(e){this._bindStartEvent(e,!0)},r.unbindStartEvent=function(e){this._bindStartEvent(e,!1)},r._bindStartEvent=function(t,o){var r=(o=void 0===o||o)?"addEventListener":"removeEventListener",n="mousedown";e.PointerEvent?n="pointerdown":"ontouchstart"in e&&(n="touchstart"),t[r](n,this)},r.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.getTouch=function(e){for(var t=0;t<e.length;t++){var o=e[t];if(o.identifier==this.pointerIdentifier)return o}},r.onmousedown=function(e){var t=e.button;t&&0!==t&&1!==t||this._pointerDown(e,e)},r.ontouchstart=function(e){this._pointerDown(e,e.changedTouches[0])},r.onpointerdown=function(e){this._pointerDown(e,e)},r._pointerDown=function(e,t){e.button||this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,this.pointerDown(e,t))},r.pointerDown=function(e,t){this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t])};var n={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};return r._bindPostStartEvents=function(t){if(t){var o=n[t.type];o.forEach(function(t){e.addEventListener(t,this)},this),this._boundPointerEvents=o}},r._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){e.removeEventListener(t,this)},this),delete this._boundPointerEvents)},r.onmousemove=function(e){this._pointerMove(e,e)},r.onpointermove=function(e){e.pointerId==this.pointerIdentifier&&this._pointerMove(e,e)},r.ontouchmove=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerMove(e,t)},r._pointerMove=function(e,t){this.pointerMove(e,t)},r.pointerMove=function(e,t){this.emitEvent("pointerMove",[e,t])},r.onmouseup=function(e){this._pointerUp(e,e)},r.onpointerup=function(e){e.pointerId==this.pointerIdentifier&&this._pointerUp(e,e)},r.ontouchend=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerUp(e,t)},r._pointerUp=function(e,t){this._pointerDone(),this.pointerUp(e,t)},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t])},r._pointerDone=function(){this._pointerReset(),this._unbindPostStartEvents(),this.pointerDone()},r._pointerReset=function(){this.isPointerDown=!1,delete this.pointerIdentifier},r.pointerDone=function(){},r.onpointercancel=function(e){e.pointerId==this.pointerIdentifier&&this._pointerCancel(e,e)},r.ontouchcancel=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerCancel(e,t)},r._pointerCancel=function(e,t){this._pointerDone(),this.pointerCancel(e,t)},r.pointerCancel=function(e,t){this.emitEvent("pointerCancel",[e,t])},o.getPointerPoint=function(e){return{x:e.pageX,y:e.pageY}},o}),function(e,t){"function"==typeof define&&define.amd?define("unidragger/unidragger",["unipointer/unipointer"],function(o){return t(e,o)}):"object"==typeof module&&module.exports?module.exports=t(e,require("unipointer")):e.Unidragger=t(e,e.Unipointer)}(window,function(e,t){function o(){}var r=o.prototype=Object.create(t.prototype);r.bindHandles=function(){this._bindHandles(!0)},r.unbindHandles=function(){this._bindHandles(!1)},r._bindHandles=function(t){for(var o=(t=void 0===t||t)?"addEventListener":"removeEventListener",r=t?this._touchActionValue:"",n=0;n<this.handles.length;n++){var i=this.handles[n];this._bindStartEvent(i,t),i[o]("click",this),e.PointerEvent&&(i.style.touchAction=r)}},r._touchActionValue="none",r.pointerDown=function(e,t){this.okayPointerDown(e)&&(this.pointerDownPointer=t,e.preventDefault(),this.pointerDownBlur(),this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t]))};var n={TEXTAREA:!0,INPUT:!0,SELECT:!0,OPTION:!0},i={radio:!0,checkbox:!0,button:!0,submit:!0,image:!0,file:!0};return r.okayPointerDown=function(e){var t=n[e.target.nodeName],o=i[e.target.type],r=!t||o;return r||this._pointerReset(),r},r.pointerDownBlur=function(){var e=document.activeElement;e&&e.blur&&e!=document.body&&e.blur()},r.pointerMove=function(e,t){var o=this._dragPointerMove(e,t);this.emitEvent("pointerMove",[e,t,o]),this._dragMove(e,t,o)},r._dragPointerMove=function(e,t){var o={x:t.pageX-this.pointerDownPointer.pageX,y:t.pageY-this.pointerDownPointer.pageY};return!this.isDragging&&this.hasDragStarted(o)&&this._dragStart(e,t),o},r.hasDragStarted=function(e){return 3<Math.abs(e.x)||3<Math.abs(e.y)},r.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t]),this._dragPointerUp(e,t)},r._dragPointerUp=function(e,t){this.isDragging?this._dragEnd(e,t):this._staticClick(e,t)},r._dragStart=function(e,t){this.isDragging=!0,this.isPreventingClicks=!0,this.dragStart(e,t)},r.dragStart=function(e,t){this.emitEvent("dragStart",[e,t])},r._dragMove=function(e,t,o){this.isDragging&&this.dragMove(e,t,o)},r.dragMove=function(e,t,o){e.preventDefault(),this.emitEvent("dragMove",[e,t,o])},r._dragEnd=function(e,t){this.isDragging=!1,setTimeout(function(){delete this.isPreventingClicks}.bind(this)),this.dragEnd(e,t)},r.dragEnd=function(e,t){this.emitEvent("dragEnd",[e,t])},r.onclick=function(e){this.isPreventingClicks&&e.preventDefault()},r._staticClick=function(e,t){this.isIgnoringMouseUp&&"mouseup"==e.type||(this.staticClick(e,t),"mouseup"!=e.type&&(this.isIgnoringMouseUp=!0,setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)))},r.staticClick=function(e,t){this.emitEvent("staticClick",[e,t])},o.getPointerPoint=t.getPointerPoint,o}),function(e,t){"function"==typeof define&&define.amd?define(["get-size/get-size","unidragger/unidragger"],function(o,r){return t(e,o,r)}):"object"==typeof module&&module.exports?module.exports=t(e,require("get-size"),require("unidragger")):e.Draggabilly=t(e,e.getSize,e.Unidragger)}(window,function(e,t,o){function r(e,t){for(var o in t)e[o]=t[o];return e}var n=e.jQuery;function i(e,t){this.element="string"==typeof e?document.querySelector(e):e,n&&(this.$element=n(this.element)),this.options=r({},this.constructor.defaults),this.option(t),this._create()}var a=i.prototype=Object.create(o.prototype);i.defaults={},a.option=function(e){r(this.options,e)};var s={relative:!0,absolute:!0,fixed:!0};function l(e,t,o){return o=o||"round",t?Math[o](e/t)*t:e}return a._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=r({},this.position);var e=getComputedStyle(this.element);s[e.position]||(this.element.style.position="relative"),this.on("pointerDown",this.onPointerDown),this.on("pointerMove",this.onPointerMove),this.on("pointerUp",this.onPointerUp),this.enable(),this.setHandles()},a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element],this.bindHandles()},a.dispatchEvent=function(e,t,o){var r=[t].concat(o);this.emitEvent(e,r),this.dispatchJQueryEvent(e,t,o)},a.dispatchJQueryEvent=function(t,o,r){var n=e.jQuery;if(n&&this.$element){var i=n.Event(o);i.type=t,this.$element.trigger(i,r)}},a._getPosition=function(){var e=getComputedStyle(this.element),t=this._getPositionCoord(e.left,"width"),o=this._getPositionCoord(e.top,"height");this.position.x=isNaN(t)?0:t,this.position.y=isNaN(o)?0:o,this._addTransformPosition(e)},a._getPositionCoord=function(e,o){if(-1!=e.indexOf("%")){var r=t(this.element.parentNode);return r?parseFloat(e)/100*r[o]:0}return parseInt(e,10)},a._addTransformPosition=function(e){var t=e.transform;if(0===t.indexOf("matrix")){var o=t.split(","),r=0===t.indexOf("matrix3d")?12:4,n=parseInt(o[r],10),i=parseInt(o[r+1],10);this.position.x+=n,this.position.y+=i}},a.onPointerDown=function(e,t){this.element.classList.add("is-pointer-down"),this.dispatchJQueryEvent("pointerDown",e,[t])},a.dragStart=function(e,t){this.isEnabled&&(this._getPosition(),this.measureContainment(),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this.element.classList.add("is-dragging"),this.dispatchEvent("dragStart",e,[t]),this.animate())},a.measureContainment=function(){var e=this.getContainer();if(e){var o=t(this.element),r=t(e),n=this.element.getBoundingClientRect(),i=e.getBoundingClientRect(),a=r.borderLeftWidth+r.borderRightWidth,s=r.borderTopWidth+r.borderBottomWidth,l=this.relativeStartPosition={x:n.left-(i.left+r.borderLeftWidth),y:n.top-(i.top+r.borderTopWidth)};this.containSize={width:r.width-a-l.x-o.width,height:r.height-s-l.y-o.height}}},a.getContainer=function(){var e=this.options.containment;if(e)return e instanceof HTMLElement?e:"string"==typeof e?document.querySelector(e):this.element.parentNode},a.onPointerMove=function(e,t,o){this.dispatchJQueryEvent("pointerMove",e,[t,o])},a.dragMove=function(e,t,o){if(this.isEnabled){var r=o.x,n=o.y,i=this.options.grid,a=i&&i[0],s=i&&i[1];r=l(r,a),n=l(n,s),r=this.containDrag("x",r,a),n=this.containDrag("y",n,s),r="y"==this.options.axis?0:r,n="x"==this.options.axis?0:n,this.position.x=this.startPosition.x+r,this.position.y=this.startPosition.y+n,this.dragPoint.x=r,this.dragPoint.y=n,this.dispatchEvent("dragMove",e,[t,o])}},a.containDrag=function(e,t,o){if(!this.options.containment)return t;var r="x"==e?"width":"height",n=l(-this.relativeStartPosition[e],o,"ceil"),i=this.containSize[r];return i=l(i,o,"floor"),Math.max(n,Math.min(i,t))},a.onPointerUp=function(e,t){this.element.classList.remove("is-pointer-down"),this.dispatchJQueryEvent("pointerUp",e,[t])},a.dragEnd=function(e,t){this.isEnabled&&(this.element.style.transform="",this.setLeftTop(),this.element.classList.remove("is-dragging"),this.dispatchEvent("dragEnd",e,[t]))},a.animate=function(){if(this.isDragging){this.positionDrag();var e=this;requestAnimationFrame(function(){e.animate()})}},a.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},a.positionDrag=function(){this.element.style.transform="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)"},a.staticClick=function(e,t){this.dispatchEvent("staticClick",e,[t])},a.setPosition=function(e,t){this.position.x=e,this.position.y=t,this.setLeftTop()},a.enable=function(){this.isEnabled=!0},a.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},a.destroy=function(){this.disable(),this.element.style.transform="",this.element.style.left="",this.element.style.top="",this.element.style.position="",this.unbindHandles(),this.$element&&this.$element.removeData("draggabilly")},a._init=function(){},n&&n.bridget&&n.bridget("draggabilly",i),i});!function(e){"use strict";"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&void 0!==module.exports?module.exports=e():window.Sortable=e()}(function(){"use strict";if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,o,r,n,i,a,s,l,c,u,h,d,p,f,g,m,y,C,v,T,_,S,E,L,w=[],b=!1,x=!1,A=!1,P=[],R=!1,M=!1,I=/\s+/g,O="Sortable"+(new Date).getTime(),N=window,D=N.document,F=N.parseInt,k=N.setTimeout,G=N.jQuery||N.Zepto,B=N.Polymer,U={capture:!1,passive:!1},j=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),W=!!navigator.userAgent.match(/Edge/i),V=W||j?"cssFloat":"float",H="draggable"in D.createElement("div"),q=function(){if(j)return!1;var e=D.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),X=!1,Y=!1,K=Math.abs,z=Math.min,$=[],J=function(e,t){var o=fe(e),r=F(o.width),n=_e(e,0,t),i=_e(e,1,t),a=n&&fe(n),s=i&&fe(i),l=a&&F(a.marginLeft)+F(a.marginRight)+Me(n).width,c=s&&F(s.marginLeft)+F(s.marginRight)+Me(i).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if(n&&"none"!==a.float){var u="left"===a.float?"left":"right";return!i||"both"!==s.clear&&s.clear!==u?"horizontal":"vertical"}return n&&("block"===a.display||"flex"===a.display||"table"===a.display||"grid"===a.display||r<=l&&"none"===o[V]||i&&"none"===o[V]&&r<l+c)?"vertical":"horizontal"},Z=function(e,t){if(!e||!e.getBoundingClientRect)return N;var o=e,r=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var n=fe(o);if(o.clientWidth<o.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!o||!o.getBoundingClientRect||o===D.body)return N;if(r||t)return o;r=!0}}}while(o=o.parentNode);return N},Q=be(function(e,t,o,r){if(t.scroll){var n=o?o[O]:window,i=t.scrollSensitivity,a=t.scrollSpeed,u=e.clientX,h=e.clientY,d=(window.innerWidth,window.innerHeight,!1);l!==o&&(ee(),s=t.scroll,c=t.scrollFn,!0===s&&(s=Z(o,!0),l=s));var p=0,f=s;do{var g,m,y,v,T,_,S,E,L,x=f,A=Me(x),P=A.top,R=A.bottom,M=A.left,I=A.right,F=A.width,k=A.height;if(L=x!==N?(g=x.scrollWidth,m=x.scrollHeight,y=fe(x),_=F<g&&("auto"===y.overflowX||"scroll"===y.overflowX),S=k<m&&("auto"===y.overflowY||"scroll"===y.overflowY),E=x.scrollLeft,x.scrollTop):(g=D.documentElement.scrollWidth,m=D.documentElement.scrollHeight,y=fe(D.documentElement),_=F<g&&("auto"===y.overflowX||"scroll"===y.overflowX||"visible"===y.overflowX),S=k<m&&("auto"===y.overflowY||"scroll"===y.overflowY||"visible"===y.overflowY),E=D.documentElement.scrollLeft,D.documentElement.scrollTop),v=_&&(K(I-u)<=i&&E+F<g)-(K(M-u)<=i&&!!E),T=S&&(K(R-h)<=i&&L+k<m)-(K(P-h)<=i&&!!L),!w[p])for(var G=0;G<=p;G++)w[G]||(w[G]={});w[p].vx==v&&w[p].vy==T&&w[p].el===x||(w[p].el=x,w[p].vx=v,w[p].vy=T,clearInterval(w[p].pid),!x||0==v&&0==T||(d=!0,w[p].pid=setInterval(function(){r&&0===this.layer&&ce.active._emulateDragOver(!0);var t=w[this.layer].vy?w[this.layer].vy*a:0,o=w[this.layer].vx?w[this.layer].vx*a:0;"function"==typeof c&&"continue"!==c.call(n,o,t,e,C,w[this.layer].el)||(w[this.layer].el===N?N.scrollTo(N.pageXOffset+o,N.pageYOffset+t):(w[this.layer].el.scrollTop+=t,w[this.layer].el.scrollLeft+=o))}.bind({layer:p}),24))),p++}while(t.bubbleScroll&&f!==N&&(f=Z(f,!1)));b=d}},30),ee=function(){w.forEach(function(e){clearInterval(e.pid)}),w=[]},te=function(e){function t(e,o){return function(r,n,i,a){var s=r.options.group.name&&n.options.group.name&&r.options.group.name===n.options.group.name;if(null==e&&(o||s))return!0;if(null==e||!1===e)return!1;if(o&&"clone"===e)return e;if("function"==typeof e)return t(e(r,n,i,a),o)(r,n,i,a);var l=(o?r:n).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var o={},r=e.group;r&&"object"==typeof r||(r={name:r}),o.name=r.name,o.checkPull=t(r.pull,!0),o.checkPut=t(r.put),o.revertClone=r.revertClone,e.group=o},oe=function(t){e&&e.parentNode&&e.parentNode[O]&&e.parentNode[O]._computeIsAligned(t)},re=function(e,t){for(var o=t;!o[O];)o=o.parentNode;return e===o},ne=function(e,t,o){for(var r=e.parentNode;r&&!r[O];)r=r.parentNode;r&&r[O][o](xe(t,{artificialBubble:!0}))},ie=function(){!q&&o&&fe(o,"display","none")},ae=function(){!q&&o&&fe(o,"display","")};D.addEventListener("click",function(e){if(A)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),A=!1},!0);var se,le=function(t){if(t=t.touches?t.touches[0]:t,e){var o=function(e,t){for(var o=0;o<P.length;o++)if(!P[o].children.length){var r=Me(P[o]),n=P[o][O].options.emptyInsertThreshold,i=e>=r.left-n&&e<=r.right+n,a=t>=r.top-n&&t<=r.bottom+n;if(i&&a)return P[o]}}(t.clientX,t.clientY);o&&o[O]._onDragOver({clientX:t.clientX,clientY:t.clientY,target:o,rootEl:o})}};function ce(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(e);this.el=e,this.options=t=xe({},t),e[O]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return J(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:F(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ce.supportPointer&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var r in o)!(r in t)&&(t[r]=o[r]);for(var n in te(t),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!t.forceFallback&&H,t.supportPointer?he(e,"pointerdown",this._onTapStart):(he(e,"mousedown",this._onTapStart),he(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(he(e,"dragover",this),he(e,"dragenter",this)),P.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[])}function ue(e,t,o,r){if(e){o=o||D;do{if(null!=t&&(">"===t[0]&&e.parentNode===o&&we(e,t.substring(1))||we(e,t))||r&&e===o)return e;if(e===o)break}while(e=(n=e).host&&n!==D&&n.host.nodeType?n.host:n.parentNode)}var n;return null}function he(e,t,o){e.addEventListener(t,o,U)}function de(e,t,o){e.removeEventListener(t,o,U)}function pe(e,t,o){if(e&&t)if(e.classList)e.classList[o?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(I," ").replace(" "+t+" "," ");e.className=(r+(o?" "+t:"")).replace(I," ")}}function fe(e,t,o){var r=e&&e.style;if(r){if(void 0===o)return D.defaultView&&D.defaultView.getComputedStyle?o=D.defaultView.getComputedStyle(e,""):e.currentStyle&&(o=e.currentStyle),void 0===t?o:o[t];t in r||-1!==t.indexOf("webkit")||(t="-webkit-"+t),r[t]=o+("string"==typeof o?"":"px")}}function ge(e){var t="";do{var o=fe(e,"transform");o&&"none"!==o&&(t=o+" "+t)}while(e=e.parentNode);return window.DOMMatrix?new DOMMatrix(t):window.WebKitCSSMatrix?new WebKitCSSMatrix(t):window.CSSMatrix?new CSSMatrix(t):void 0}function me(e,t,o){if(e){var r=e.getElementsByTagName(t),n=0,i=r.length;if(o)for(;n<i;n++)o(r[n],n);return r}return[]}function ye(e,t,o,n,i,a,s,l,c){var u,h=(e=e||t[O]).options,d="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||j||W?(u=D.createEvent("Event")).initEvent(o,!0,!0):u=new CustomEvent(o,{bubbles:!0,cancelable:!0}),u.to=i||t,u.from=a||t,u.item=n||t,u.clone=r,u.oldIndex=s,u.newIndex=l,u.originalEvent=c,t&&t.dispatchEvent(u),h[d]&&h[d].call(e,u)}function Ce(e,t,o,r,n,i,a,s){var l,c,u=e[O],h=u.options.onMove;return!window.CustomEvent||j||W?(l=D.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=o,l.draggedRect=r,l.related=n||t,l.relatedRect=i||Me(t),l.willInsertAfter=s,l.originalEvent=a,e.dispatchEvent(l),h&&(c=h.call(u,l,a)),c}function ve(e){e.draggable=!1}function Te(){X=!1}function _e(t,r,n){for(var i=0,a=0,s=t.children;a<s.length;){if("none"!==s[a].style.display&&s[a]!==o&&s[a]!==e&&ue(s[a],n.draggable,t,!1)){if(i===r)return s[a];i++}a++}return null}function Se(e){for(var t=e.lastElementChild;(t===o||"none"===t.style.display)&&(t=t.previousElementSibling););return t||null}function Ee(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,o=t.length,r=0;o--;)r+=t.charCodeAt(o);return r.toString(36)}function Le(e,t){var o=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&e!==r&&o++;return o}function we(e,t){if(e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}function be(e,t){return function(){if(!se){var o=arguments,r=this;se=k(function(){1===o.length?e.call(r,o[0]):e.apply(r,o),se=void 0},t)}}}function xe(e,t){if(e&&t)for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e}function Ae(e){return B&&B.dom?B.dom(e).cloneNode(!0):G?G(e).clone(!0)[0]:e.cloneNode(!0)}function Pe(e){return k(e,0)}function Re(e){return clearTimeout(e)}function Me(e,t,o){if(e.getBoundingClientRect||e===N){var r,n,i,a,s,l,c;if(c=e!==N?(n=(r=e.getBoundingClientRect()).top,i=r.left,a=r.bottom,s=r.right,l=r.height,r.width):(i=n=0,a=window.innerHeight,s=window.innerWidth,l=window.innerHeight,window.innerWidth),o&&e!==N){if(t=t||e.parentNode,!j)do{if(t&&t.getBoundingClientRect&&"none"!==fe(t,"transform")){var u=t.getBoundingClientRect();n-=u.top+F(fe(t,"border-top-width")),i-=u.left+F(fe(t,"border-left-width")),a=n+r.height,s=i+r.width;break}}while(t=t.parentNode);var h=ge(e),d=h&&h.a,p=h&&h.d;h&&(a=(n/=p)+(l/=p),s=(i/=d)+(c/=d))}return{top:n,left:i,bottom:a,right:s,width:c,height:l}}}return he(D,"dragover",le),he(D,"mousemove",le),he(D,"touchmove",le),ce.prototype={constructor:ce,_computeIsAligned:function(t){var r;if(o&&!q?(ie(),r=D.elementFromPoint(t.clientX,t.clientY),ae()):r=t.target,r=ue(r,this.options.draggable,this.el,!1),!Y&&e&&e.parentNode===this.el){for(var n,i,a,s,l,c,u,h,d=this.el.children,p=0;p<d.length;p++)ue(d[p],this.options.draggable,this.el,!1)&&d[p]!==r&&(d[p].sortableMouseAligned=(n=t.clientX,i=t.clientY,a=d[p],s=this._getDirection(t,null),this.options,l=Me(a),c="vertical"===s?l.left:l.top,u="vertical"===s?l.right:l.bottom,c<(h="vertical"===s?n:i)&&h<u));ue(r,this.options.draggable,this.el,!0)||(T=null),Y=!0,k(function(){Y=!1},30)}},_getDirection:function(t,o){return"function"==typeof this.options.direction?this.options.direction.call(this,t,o,e):this.options.direction},_onTapStart:function(t){if(t.cancelable){var o,r=this,n=this.el,i=this.options,s=i.preventOnFilter,l=t.type,c=t.touches&&t.touches[0],u=(c||t).target,h=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||u,d=i.filter;if(function(e){$.length=0;for(var t=e.getElementsByTagName("input"),o=t.length;o--;){var r=t[o];r.checked&&$.push(r)}}(n),(!j||t.artificialBubble||re(n,u))&&!e&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||i.disabled||h.isContentEditable))if(u=ue(u,i.draggable,n,!1)){if(a!==u){if(o=Le(u,i.draggable),"function"==typeof d){if(d.call(this,t,u,this))return ye(r,h,"filter",u,n,n,o),void(s&&t.cancelable&&t.preventDefault())}else if(d&&(d=d.split(",").some(function(e){if(e=ue(h,e.trim(),n,!1))return ye(r,e,"filter",u,n,n,o),!0})))return void(s&&t.cancelable&&t.preventDefault());i.handle&&!ue(h,i.handle,n,!1)||this._prepareDragStart(t,c,u,o)}}else j&&ne(n,t,"_onTapStart")}},_handleAutoScroll:function(t,o){if(e&&this.options.scroll){var r=t.clientX,n=t.clientY,i=D.elementFromPoint(r,n),a=this;if(o||W||j){Q(t,a.options,i,o);var s=Z(i,!0);!b||f&&r===g&&n===m||(f&&clearInterval(f),f=setInterval(function(){if(e){var i=Z(D.elementFromPoint(r,n),!0);i!==s&&(s=i,ee(),Q(t,a.options,s,o))}},10),g=r,m=n)}else{if(!a.options.bubbleScroll||Z(i,!0)===window)return void ee();Q(t,a.options,Z(i,!1),!1)}}},_prepareDragStart:function(o,r,s,l){var c,h=this,p=h.el,f=h.options,g=p.ownerDocument;s&&!e&&s.parentNode===p&&(n=p,t=(e=s).parentNode,i=e.nextSibling,a=s,d=f.group,u=l,y={target:e,clientX:(r||o).clientX,clientY:(r||o).clientY},this._lastX=(r||o).clientX,this._lastY=(r||o).clientY,e.style["will-change"]="all",e.style.transition="",e.style.transform="",c=function(){h._disableDelayedDrag(),e.draggable=h.nativeDraggable,h._triggerDragStart(o,r),ye(h,n,"choose",e,n,n,u),pe(e,f.chosenClass,!0)},f.ignore.split(",").forEach(function(t){me(e,t.trim(),ve)}),f.supportPointer?he(g,"pointerup",h._onDrop):(he(g,"mouseup",h._onDrop),he(g,"touchend",h._onDrop),he(g,"touchcancel",h._onDrop)),f.delay?(he(g,"mouseup",h._disableDelayedDrag),he(g,"touchend",h._disableDelayedDrag),he(g,"touchcancel",h._disableDelayedDrag),he(g,"mousemove",h._delayedDragTouchMoveHandler),he(g,"touchmove",h._delayedDragTouchMoveHandler),f.supportPointer&&he(g,"pointermove",h._delayedDragTouchMoveHandler),h._dragStartTimer=k(c,f.delay)):c())},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;z(K(t.clientX-this._lastX),K(t.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),de(e,"mouseup",this._disableDelayedDrag),de(e,"touchend",this._disableDelayedDrag),de(e,"touchcancel",this._disableDelayedDrag),de(e,"mousemove",this._delayedDragTouchMoveHandler),de(e,"touchmove",this._delayedDragTouchMoveHandler),de(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,o){o=o||("touch"==t.pointerType?t:null),!this.nativeDraggable||o?this.options.supportPointer?he(D,"pointermove",this._onTouchMove):he(D,o?"touchmove":"mousemove",this._onTouchMove):(he(e,"dragend",this),he(n,"dragstart",this._onDragStart));try{D.selection?Pe(function(){D.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t){if(x=!1,n&&e){this.nativeDraggable&&(he(D,"dragover",this._handleAutoScroll),he(D,"dragover",oe));var o=this.options;!t&&pe(e,o.dragClass,!1),pe(e,o.ghostClass,!0),fe(e,"transform",""),ce.active=this,t&&this._appendGhost(),ye(this,n,"start",e,n,n,u)}else this._nulling()},_emulateDragOver:function(t){if(C){if(this._lastX===C.clientX&&this._lastY===C.clientY&&!t)return;this._lastX=C.clientX,this._lastY=C.clientY,ie();for(var o=D.elementFromPoint(C.clientX,C.clientY),r=o;o&&o.shadowRoot;)r=o=o.shadowRoot.elementFromPoint(C.clientX,C.clientY);if(r)do{if(r[O]&&r[O]._onDragOver({clientX:C.clientX,clientY:C.clientY,target:o,rootEl:r})&&!this.options.dragoverBubble)break;o=r}while(r=r.parentNode);e.parentNode[O]._computeIsAligned(C),ae()}},_onTouchMove:function(e){if(y){var t=this.options,r=t.fallbackTolerance,n=t.fallbackOffset,i=e.touches?e.touches[0]:e,a=o&&ge(o),s=o&&a&&a.a,l=o&&a&&a.d,c=(i.clientX-y.clientX+n.x)/(s||1),u=(i.clientY-y.clientY+n.y)/(l||1),h=e.touches?"translate3d("+c+"px,"+u+"px,0)":"translate("+c+"px,"+u+"px)";if(!ce.active&&!x){if(r&&z(K(i.clientX-this._lastX),K(i.clientY-this._lastY))<r)return;this._onDragStart(e,!0)}this._handleAutoScroll(i,!0),v=!0,C=i,fe(o,"webkitTransform",h),fe(o,"mozTransform",h),fe(o,"msTransform",h),fe(o,"transform",h),e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!o){var t=Me(e,this.options.fallbackOnBody?D.body:n,!0),r=(fe(e),this.options);pe(o=e.cloneNode(!0),r.ghostClass,!1),pe(o,r.fallbackClass,!0),pe(o,r.dragClass,!0),fe(o,"box-sizing","border-box"),fe(o,"margin",0),fe(o,"top",t.top),fe(o,"left",t.left),fe(o,"width",t.width),fe(o,"height",t.height),fe(o,"opacity","0.8"),fe(o,"position","fixed"),fe(o,"zIndex","100000"),fe(o,"pointerEvents","none"),r.fallbackOnBody&&D.body.appendChild(o)||n.appendChild(o)}},_onDragStart:function(t,o){var i=this,a=t.dataTransfer,s=i.options;(r=Ae(e)).draggable=!1,r.style["will-change"]="",this._hideClone(),pe(r,i.options.chosenClass,!1),i._cloneId=Pe(function(){i.options.removeCloneOnHide||n.insertBefore(r,e),ye(i,n,"clone",e)}),!o&&pe(e,s.dragClass,!0),o?(A=!0,i._loopId=setInterval(i._emulateDragOver,50)):(de(D,"mouseup",i._onDrop),de(D,"touchend",i._onDrop),de(D,"touchcancel",i._onDrop),a&&(a.effectAllowed="move",s.setData&&s.setData.call(i,a,e)),he(D,"drop",i),fe(e,"transform","translateZ(0)")),x=!0,i._dragStartId=Pe(i._dragStarted.bind(i,o)),he(D,"selectstart",i)},_onDragOver:function(r){var a,s,l,c=this.el,h=r.target,f=this.options,g=f.group,m=ce.active,y=d===g,C=f.sort,w=this;if(!X&&(!j||r.rootEl||r.artificialBubble||re(c,h))){if(void 0!==r.preventDefault&&r.cancelable&&r.preventDefault(),v=!0,h=ue(h,f.draggable,c,!0),ue(r.target,null,e,!0)||h.animated)return Ee();if(h!==e&&(A=!1),m&&!f.disabled&&(y?C||(l=!n.contains(e)):p===this||(this.lastPutMode=d.checkPull(this,m,e,r))&&g.checkPut(this,m,e,r))){var x=this._getDirection(r,h);if(a=Me(e),l)return this._hideClone(),t=n,i?n.insertBefore(e,i):n.appendChild(e),Ee();if(0===c.children.length||c.children[0]===o||(le=r,he=x,de=Me(Se(c)),fe="vertical"===he?le.clientY:le.clientX,ge="vertical"===he?le.clientX:le.clientY,me="vertical"===he?de.bottom:de.right,ve="vertical"===he?de.left:de.top,_e="vertical"===he?de.right:de.bottom,("vertical"===he?_e+10<ge||ge<=_e&&me<fe&&ve<=ge:me<fe&&ve<ge||fe<=me&&_e+10<ge)&&!e.animated)){if(0!==c.children.length&&c.children[0]!==o&&c===r.target&&(h=Se(c)),h&&(s=Me(h)),y?m._hideClone():m._showClone(this),!1!==Ce(n,c,e,a,h,s,r,!!h))return c.appendChild(e),t=c,L=null,we(),this._animate(a,e),h&&this._animate(s,h),Ee()}else if(h&&h!==e&&h.parentNode===c){var P,I=0,F=h.sortableMouseAligned,G=e.parentNode!==c,B=function(e,t){for(var o=Z(o,!0),r=Me(e)[t];o;){var n=Me(o)[t];if(!("top"===t||"left"===t?n<=r:r<=n))return!0;if(o===N)break;o=Z(o,!1)}return!1}(h,"vertical"===x?"top":"left");if(T!==h&&(S=null,P=Me(h)["vertical"===x?"top":"left"],R=!1),z=h,$=x,J=(Y=e)===e&&L||Me(Y),Q=z===e&&L||Me(z),ee="vertical"===$?J.left:J.top,te="vertical"===$?J.right:J.bottom,oe="vertical"===$?J.width:J.height,ie="vertical"===$?Q.left:Q.top,ae="vertical"===$?Q.right:Q.bottom,se="vertical"===$?Q.width:Q.height,S=(ee===ie||te===ae||ee+oe/2===ie+se/2)&&F||G||B||f.invertSwap||"insert"===S||"swap"===S?("swap"!==S&&(M=f.invertSwap||G||b||B),I=function(t,o,r,n,i,a,s){var l=Me(o),c="vertical"===r?t.clientY:t.clientX,u="vertical"===r?l.height:l.width,h="vertical"===r?l.top:l.left,d="vertical"===r?l.bottom:l.right,p=Me(e),f=!1;if(!a)if(s&&E<u*n)if(!R&&(1===_?h+u*i/2<c:c<d-u*i/2)&&(R=!0),R)f=!0;else{"vertical"===r?p.top:p.left,"vertical"===r?p.bottom:p.right;if(1===_?c<h+E:d-E<c)return-1*_}else if(h+u*(1-n)/2<c&&c<d-u*(1-n)/2)return h+u/2<c?-1:1;return(f=f||a)&&(c<h+u*i/2||d-u*i/2<c)?h+u/2<c?1:-1:0}(r,h,x,f.swapThreshold,null==f.invertedSwapThreshold?f.swapThreshold:f.invertedSwapThreshold,M,T===h),"swap"):(H=h,I=Le(e,(q=f).draggable)<Le(H,q.draggable)?1:-1,"insert"),0===I)return Ee();L=null,_=I,s=Me(T=h);var U=h.nextElementSibling,W=!1,V=Ce(n,c,e,a,h,s,r,W=1===I);if(!1!==V)return 1!==V&&-1!==V||(W=1===V),X=!0,k(Te,30),y?m._hideClone():m._showClone(this),W&&!U?c.appendChild(e):h.parentNode.insertBefore(e,W?U:h),t=e.parentNode,void 0===P||M||(E=K(P-Me(h)["vertical"===x?"top":"left"])),we(),!G&&this._animate(s,h),this._animate(a,e),Ee()}if(c.contains(e))return Ee()}var H,q,Y,z,$,J,Q,ee,te,oe,ie,ae,se,le,he,de,fe,ge,me,ve,_e;return j&&!r.rootEl&&ne(c,r,"_onDragOver"),!1}function Ee(){return m&&(pe(e,p?p.options.ghostClass:m.options.ghostClass,!1),pe(e,f.ghostClass,!0)),p!==w&&w!==ce.active?p=w:w===ce.active&&(p=null),(h===e&&!e.animated||h===c&&!h.animated)&&(T=null),f.dragoverBubble||r.rootEl||h===D||(w._handleAutoScroll(r),e.parentNode[O]._computeIsAligned(r)),!f.dragoverBubble&&r.stopPropagation&&r.stopPropagation(),!0}function we(){ye(w,n,"change",h,c,n,u,Le(e,f.draggable),r)}},_animate:function(t,o){var r=this.options.animation;if(r){var n=Me(o);if(o===e&&(L=n),1===t.nodeType&&(t=Me(t)),t.left+t.width/2!==n.left+n.width/2||t.top+t.height/2!==n.top+n.height/2){var i=ge(this.el),a=i&&i.a,s=i&&i.d;fe(o,"transition","none"),fe(o,"transform","translate3d("+(t.left-n.left)/(a||1)+"px,"+(t.top-n.top)/(s||1)+"px,0)"),o.offsetWidth,fe(o,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),fe(o,"transform","translate3d(0,0,0)")}"number"==typeof o.animated&&clearTimeout(o.animated),o.animated=k(function(){fe(o,"transition",""),fe(o,"transform",""),o.animated=!1},r)}},_offUpEvents:function(){var e=this.el.ownerDocument;de(D,"touchmove",this._onTouchMove),de(D,"pointermove",this._onTouchMove),de(e,"mouseup",this._onDrop),de(e,"touchend",this._onDrop),de(e,"pointerup",this._onDrop),de(e,"touchcancel",this._onDrop),de(D,"selectstart",this)},_onDrop:function(a){var s=this.el,l=this.options;R=M=b=x=!1,clearInterval(this._loopId),clearInterval(f),ee(),clearTimeout(se),se=void 0,clearTimeout(this._dragStartTimer),Re(this._cloneId),Re(this._dragStartId),de(D,"mousemove",this._onTouchMove),this.nativeDraggable&&(de(D,"drop",this),de(s,"dragstart",this._onDragStart),de(D,"dragover",this._handleAutoScroll),de(D,"dragover",oe)),this._offUpEvents(),a&&(v&&(a.cancelable&&a.preventDefault(),!l.dropBubble&&a.stopPropagation()),o&&o.parentNode&&o.parentNode.removeChild(o),(n===t||p&&"clone"!==p.lastPutMode)&&r&&r.parentNode&&r.parentNode.removeChild(r),e&&(this.nativeDraggable&&de(e,"dragend",this),ve(e),e.style["will-change"]="",pe(e,p?p.options.ghostClass:this.options.ghostClass,!1),pe(e,this.options.chosenClass,!1),ye(this,n,"unchoose",e,t,n,u,null,a),n!==t?(0<=(h=Le(e,l.draggable))&&(ye(null,t,"add",e,t,n,u,h,a),ye(this,n,"remove",e,t,n,u,h,a),ye(null,t,"sort",e,t,n,u,h,a),ye(this,n,"sort",e,t,n,u,h,a)),p&&p.save()):e.nextSibling!==i&&0<=(h=Le(e,l.draggable))&&(ye(this,n,"update",e,t,n,u,h,a),ye(this,n,"sort",e,t,n,u,h,a)),ce.active&&(null!=h&&-1!==h||(h=u),ye(this,n,"end",e,t,n,u,h,a),this.save()))),this._nulling()},_nulling:function(){n=e=t=o=i=r=a=s=l=w.length=f=g=m=y=C=v=h=u=T=_=L=p=d=ce.active=null,$.forEach(function(e){e.checked=!0}),$.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":e&&(this._onDragOver(t),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none");e.cancelable&&e.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var e,t=[],o=this.el.children,r=0,n=o.length,i=this.options;r<n;r++)ue(e=o[r],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||Ee(e));return t},sort:function(e){var t={},o=this.el;this.toArray().forEach(function(e,r){var n=o.children[r];ue(n,this.options.draggable,o,!1)&&(t[e]=n)},this),e.forEach(function(e){t[e]&&(o.removeChild(t[e]),o.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ue(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(void 0===t)return o[e];o[e]=t,"group"===e&&te(o)},destroy:function(){var e=this.el;e[O]=null,de(e,"mousedown",this._onTapStart),de(e,"touchstart",this._onTapStart),de(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(de(e,"dragover",this),de(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),P.splice(P.indexOf(this.el),1),this.el=e=null},_hideClone:function(){r.cloneHidden||(fe(r,"display","none"),r.cloneHidden=!0,r.parentNode&&this.options.removeCloneOnHide&&r.parentNode.removeChild(r))},_showClone:function(t){"clone"===t.lastPutMode?r.cloneHidden&&(n.contains(e)&&!this.options.group.revertClone?n.insertBefore(r,e):i?n.insertBefore(r,i):n.appendChild(r),this.options.group.revertClone&&this._animate(e,r),fe(r,"display",""),r.cloneHidden=!1):this._hideClone()}},he(D,"touchmove",function(e){(ce.active||x)&&e.cancelable&&e.preventDefault()}),ce.utils={on:he,off:de,css:fe,find:me,is:function(e,t){return!!ue(e,t,e,!1)},extend:xe,throttle:be,closest:ue,toggleClass:pe,clone:Ae,index:Le,nextTick:Pe,cancelNextTick:Re,detectDirection:J,getChild:_e},ce.create=function(e,t){return new ce(e,t)},ce.version="1.8.2",ce});!function(){function e(e){this.mode=s.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],o=0,r=this.data.length;r>o;o++){var n=this.data.charCodeAt(o);n>65536?(t[0]=240|(1835008&n)>>>18,t[1]=128|(258048&n)>>>12,t[2]=128|(4032&n)>>>6,t[3]=128|63&n):n>2048?(t[0]=224|(61440&n)>>>12,t[1]=128|(4032&n)>>>6,t[2]=128|63&n):n>128?(t[0]=192|(1984&n)>>>6,t[1]=128|63&n):t[0]=n,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function o(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var o=0;o<e.length&&0==e[o];)o++;this.num=new Array(e.length-o+t);for(var r=0;r<e.length-o;r++)this.num[r]=e[r+o]}function r(e,t){this.totalCount=e,this.dataCount=t}function n(){this.buffer=[],this.length=0}function i(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function a(e,t){for(var o=1,r=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),n=0,i=p.length;i>=n;n++){var a=0;switch(t){case l.L:a=p[n][0];break;case l.M:a=p[n][1];break;case l.Q:a=p[n][2];break;case l.H:a=p[n][3]}if(a>=r)break;o++}if(o>p.length)throw new Error("Too long data");return o}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,o=this.parsedData.length;o>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var o=new e(t);this.dataList.push(o),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,o){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[r][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,o),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,o)},setupPositionProbePattern:function(e,t){for(var o=-1;7>=o;o++)if(!(-1>=e+o||this.moduleCount<=e+o))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+o][t+r]=o>=0&&6>=o&&(0==r||6==r)||r>=0&&6>=r&&(0==o||6==o)||o>=2&&4>=o&&r>=2&&4>=r)},getBestMaskPattern:function(){for(var e=0,t=0,o=0;8>o;o++){this.makeImpl(!0,o);var r=u.getLostPoint(this);(0==o||e>r)&&(e=r,t=o)}return t},createMovieClip:function(e,t,o){var r=e.createEmptyMovieClip(t,o);this.make();for(var n=0;n<this.modules.length;n++)for(var i=1*n,a=0;a<this.modules[n].length;a++){var s=1*a;this.modules[n][a]&&(r.beginFill(0,100),r.moveTo(s,i),r.lineTo(s+1,i),r.lineTo(s+1,i+1),r.lineTo(s,i+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=u.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var o=0;o<e.length;o++){var r=e[t],n=e[o];if(null==this.modules[r][n])for(var i=-2;2>=i;i++)for(var a=-2;2>=a;a++)this.modules[r+i][n+a]=-2==i||2==i||-2==a||2==a||0==i&&0==a}},setupTypeNumber:function(e){for(var t=u.getBCHTypeNumber(this.typeNumber),o=0;18>o;o++){var r=!e&&1==(1&t>>o);this.modules[Math.floor(o/3)][o%3+this.moduleCount-8-3]=r}for(o=0;18>o;o++){r=!e&&1==(1&t>>o);this.modules[o%3+this.moduleCount-8-3][Math.floor(o/3)]=r}},setupTypeInfo:function(e,t){for(var o=this.errorCorrectLevel<<3|t,r=u.getBCHTypeInfo(o),n=0;15>n;n++){var i=!e&&1==(1&r>>n);6>n?this.modules[n][8]=i:8>n?this.modules[n+1][8]=i:this.modules[this.moduleCount-15+n][8]=i}for(n=0;15>n;n++){i=!e&&1==(1&r>>n);8>n?this.modules[8][this.moduleCount-n-1]=i:9>n?this.modules[8][15-n-1+1]=i:this.modules[8][15-n-1]=i}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var o=-1,r=this.moduleCount-1,n=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[r][a-s]){var l=!1;i<e.length&&(l=1==(1&e[i]>>>n));u.getMask(t,r,a-s)&&(l=!l),this.modules[r][a-s]=l,-1==--n&&(i++,n=7)}if(0>(r+=o)||this.moduleCount<=r){r-=o,o=-o;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,o,i){for(var a=r.getRSBlocks(e,o),s=new n,l=0;l<i.length;l++){var c=i[l];s.put(c.mode,4),s.put(c.getLength(),u.getLengthInBits(c.mode,e)),c.write(s)}var h=0;for(l=0;l<a.length;l++)h+=a[l].dataCount;if(s.getLengthInBits()>8*h)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*h+")");for(s.getLengthInBits()+4<=8*h&&s.put(0,4);0!=s.getLengthInBits()%8;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*h)&&(s.put(t.PAD0,8),!(s.getLengthInBits()>=8*h));)s.put(t.PAD1,8);return t.createBytes(s,a)},t.createBytes=function(e,t){for(var r=0,n=0,i=0,a=new Array(t.length),s=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,h=t[l].totalCount-c;n=Math.max(n,c),i=Math.max(i,h),a[l]=new Array(c);for(var d=0;d<a[l].length;d++)a[l][d]=255&e.buffer[d+r];r+=c;var p=u.getErrorCorrectPolynomial(h),f=new o(a[l],p.getLength()-1).mod(p);s[l]=new Array(p.getLength()-1);for(d=0;d<s[l].length;d++){var g=d+f.getLength()-s[l].length;s[l][d]=g>=0?f.get(g):0}}var m=0;for(d=0;d<t.length;d++)m+=t[d].totalCount;var y=new Array(m),C=0;for(d=0;n>d;d++)for(l=0;l<t.length;l++)d<a[l].length&&(y[C++]=a[l][d]);for(d=0;i>d;d++)for(l=0;l<t.length;l++)d<s[l].length&&(y[C++]=s[l][d]);return y};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,o){switch(e){case c.PATTERN000:return 0==(t+o)%2;case c.PATTERN001:return 0==t%2;case c.PATTERN010:return 0==o%3;case c.PATTERN011:return 0==(t+o)%3;case c.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(o/3))%2;case c.PATTERN101:return 0==t*o%2+t*o%3;case c.PATTERN110:return 0==(t*o%2+t*o%3)%2;case c.PATTERN111:return 0==(t*o%3+(t+o)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),r=0;e>r;r++)t=t.multiply(new o([1,h.gexp(r)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),o=0,r=0;t>r;r++)for(var n=0;t>n;n++){for(var i=0,a=e.isDark(r,n),s=-1;1>=s;s++)if(!(0>r+s||r+s>=t))for(var l=-1;1>=l;l++)0>n+l||n+l>=t||(0!=s||0!=l)&&a==e.isDark(r+s,n+l)&&i++;i>5&&(o+=3+i-5)}for(r=0;t-1>r;r++)for(n=0;t-1>n;n++){var c=0;e.isDark(r,n)&&c++,e.isDark(r+1,n)&&c++,e.isDark(r,n+1)&&c++,e.isDark(r+1,n+1)&&c++,(0==c||4==c)&&(o+=3)}for(r=0;t>r;r++)for(n=0;t-6>n;n++)e.isDark(r,n)&&!e.isDark(r,n+1)&&e.isDark(r,n+2)&&e.isDark(r,n+3)&&e.isDark(r,n+4)&&!e.isDark(r,n+5)&&e.isDark(r,n+6)&&(o+=40);for(n=0;t>n;n++)for(r=0;t-6>r;r++)e.isDark(r,n)&&!e.isDark(r+1,n)&&e.isDark(r+2,n)&&e.isDark(r+3,n)&&e.isDark(r+4,n)&&!e.isDark(r+5,n)&&e.isDark(r+6,n)&&(o+=40);var u=0;for(n=0;t>n;n++)for(r=0;t>r;r++)e.isDark(r,n)&&u++;return o+10*(Math.abs(100*u/t/t-50)/5)}},h={glog:function(e){if(1>e)throw new Error("glog("+e+")");return h.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return h.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},d=0;8>d;d++)h.EXP_TABLE[d]=1<<d;for(d=8;256>d;d++)h.EXP_TABLE[d]=h.EXP_TABLE[d-4]^h.EXP_TABLE[d-5]^h.EXP_TABLE[d-6]^h.EXP_TABLE[d-8];for(d=0;255>d;d++)h.LOG_TABLE[h.EXP_TABLE[d]]=d;o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<e.getLength();n++)t[r+n]^=h.gexp(h.glog(this.get(r))+h.glog(e.get(n)));return new o(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=h.glog(this.get(0))-h.glog(e.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<e.getLength();n++)r[n]^=h.gexp(h.glog(e.get(n))+t);return new o(r,0).mod(e)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(e,t){var o=r.getRsBlockTable(e,t);if(void 0==o)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=o.length/3,i=[],a=0;n>a;a++)for(var s=o[3*a+0],l=o[3*a+1],c=o[3*a+2],u=0;s>u;u++)i.push(new r(l,c));return i},r.getRsBlockTable=function(e,t){switch(t){case l.L:return r.RS_BLOCK_TABLE[4*(e-1)+0];case l.M:return r.RS_BLOCK_TABLE[4*(e-1)+1];case l.Q:return r.RS_BLOCK_TABLE[4*(e-1)+2];case l.H:return r.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},n.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var o=0;t>o;o++)this.putBit(1==(1&e>>>t-o-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],f=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&o.setAttribute(r,t[r]);return o}var o=this._htOption,r=this._el,n=e.getModuleCount();Math.floor(o.width/n),Math.floor(o.height/n),this.clear();var i=t("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:o.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(i),i.appendChild(t("rect",{fill:o.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;n>a;a++)for(var s=0;n>s;s++)if(e.isDark(a,s)){var l=t("use",{x:String(a),y:String(s)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),g="svg"===document.documentElement.tagName.toLowerCase()?f:"undefined"!=typeof CanvasRenderingContext2D?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var t=1/window.devicePixelRatio,o=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,r,n,i,a,s,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*t;else void 0===c&&(arguments[1]*=t,arguments[2]*=t,arguments[3]*=t,arguments[4]*=t);o.apply(this,arguments)}}var r=function(e,t){this._bIsPainted=!1,this._android=i(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return r.prototype.draw=function(e){var t=this._elImage,o=this._oContext,r=this._htOption,n=e.getModuleCount(),i=r.width/n,a=r.height/n,s=Math.round(i),l=Math.round(a);t.style.display="none",this.clear();for(var c=0;n>c;c++)for(var u=0;n>u;u++){var h=e.isDark(c,u),d=u*i,p=c*a;o.strokeStyle=h?r.colorDark:r.colorLight,o.lineWidth=1,o.fillStyle=h?r.colorDark:r.colorLight,o.fillRect(d,p,i,a),o.strokeRect(Math.floor(d)+.5,Math.floor(p)+.5,s,l),o.strokeRect(Math.ceil(d)-.5,Math.ceil(p)-.5,s,l)}this._bIsPainted=!0},r.prototype.makeImage=function(){this._bIsPainted&&function(e,t){var o=this;if(o._fFail=t,o._fSuccess=e,null===o._bSupportDataURI){var r=document.createElement("img"),n=function(){o._bSupportDataURI=!1,o._fFail&&_fFail.call(o)};return r.onabort=n,r.onerror=n,r.onload=function(){o._bSupportDataURI=!0,o._fSuccess&&o._fSuccess.call(o)},void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===o._bSupportDataURI&&o._fSuccess?o._fSuccess.call(o):!1===o._bSupportDataURI&&o._fFail&&o._fFail.call(o)}.call(this,e)},r.prototype.isPainted=function(){return this._bIsPainted},r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},r.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},r}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,o=this._el,r=e.getModuleCount(),n=Math.floor(t.width/r),i=Math.floor(t.height/r),a=['<table style="border:0;border-collapse:collapse;">'],s=0;r>s;s++){a.push("<tr>");for(var l=0;r>l;l++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+n+"px;height:"+i+"px;background-color:"+(e.isDark(s,l)?t.colorDark:t.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),o.innerHTML=a.join("");var c=o.childNodes[0],u=(t.width-c.offsetWidth)/2,h=(t.height-c.offsetHeight)/2;u>0&&h>0&&(c.style.margin=h+"px "+u+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();(QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof t&&(t={text:t}),t)for(var o in t)this._htOption[o]=t[o];"string"==typeof e&&(e=document.getElementById(e)),this._android=i(),this._el=e,this._oQRCode=null,this._oDrawing=new g(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new t(a(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();(void 0!==define&&define.amd?define:function(e,t){var o,r=t();if(void 0!==exports)for(o in r)exports[o]=r[o];else window.jsonpack=r})([],function(){var e=-4,t=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]})},o=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]})},r=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},n=function(e){return parseInt(e,36)},i=Array.prototype.indexOf||function(e,t){for(var o=t||0,r=this.length;o<r;o++)if(this[o]===e)return o;return-1};return{JSON:JSON,pack:function(o,n){var a,s,l;(a=(n=n||{}).verbose||!1)&&console.log("Normalize the JSON Object");o="string"==typeof o?this.JSON.parse(o):o;a&&console.log("Creating a empty dictionary");s={strings:[],integers:[],floats:[]};a&&console.log("Creating the AST");var c=function o(n){var l,c,u,h,d;if(a&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(n)),l=typeof n,null===n)return{type:"null",index:-3};if(void 0===n)return{type:"undefined",index:-5};if(n instanceof Array){u=["@"];for(c in n)n.hasOwnProperty(c)&&u.push(o(n[c]));return u}if("object"===l){u=["$"];for(h in n)n.hasOwnProperty(h)&&(u.push(o(h)),u.push(o(n[h])));return u}if(""===n)return{type:"empty",index:e};if("string"===l)return-1==(d=i.call(s.strings,n))&&(s.strings.push(t(n)),d=s.strings.length-1),{type:"strings",index:d};if("number"===l&&n%1==0)return-1==(d=i.call(s.integers,n))&&(s.integers.push(r(n)),d=s.integers.length-1),{type:"integers",index:d};if("number"===l)return-1==(d=i.call(s.floats,n))&&(s.floats.push(n),d=s.floats.length-1),{type:"floats",index:d};if("boolean"===l)return{type:"boolean",index:n?-1:-2};throw new Error("Unexpected argument of type "+typeof n)}(o),u=s.strings.length,h=s.integers.length;s.floats.length;return a&&console.log("Parsing the dictionary"),l=s.strings.join("|"),l+="^"+s.integers.join("|"),l+="^"+s.floats.join("|"),a&&console.log("Parsing the structure"),l+="^"+function t(o){var n,i,s,l;if(a&&console.log("Calling a recursiveParser with "+this.JSON.stringify(o)),o instanceof Array){n=o.shift();for(i in o)o.hasOwnProperty(i)&&(n+=t(o[i])+"|");return("|"===n[n.length-1]?n.slice(0,-1):n)+"]"}if(s=o.type,l=o.index,"strings"===s)return r(l);if("integers"===s)return r(u+l);if("floats"===s)return r(u+h+l);if("boolean"===s)return o.index;if("null"===s)return-3;if("undefined"===s)return-5;if("empty"===s)return e;throw new TypeError("The item is alien!")}(c),a&&console.log("Ending parser"),n.debug?{dictionary:s,ast:c,packed:l}:l},unpack:function(t,r){var i,a,s,l,c,u,h,d;if(r=r||{},i=t.split("^"),r.verbose&&console.log("Building dictionary"),a=[],""!==(s=i[0]))for(s=s.split("|"),r.verbose&&console.log("Parse the strings dictionary"),c=0,l=s.length;c<l;c++)a.push(o(s[c]));if(""!==(s=i[1]))for(s=s.split("|"),r.verbose&&console.log("Parse the integers dictionary"),c=0,l=s.length;c<l;c++)a.push(n(s[c]));if(""!==(s=i[2]))for(s=s.split("|"),r.verbose&&console.log("Parse the floats dictionary"),c=0,l=s.length;c<l;c++)a.push(parseFloat(s[c]));s=null;r.verbose&&console.log("Tokenizing the structure");var p="",f=[],g=i[3].length;for(c=0;c<g;c++)"|"===(u=i[3].charAt(c))||"$"===u||"@"===u||"]"===u?(p&&(f.push(n(p)),p=""),"|"!==u&&f.push(u)):p+=u;return h=f.length,d=0,r.verbose&&console.log("Starting recursive parser"),function t(){var o,n,i,s=f[d++];if(r.verbose&&console.log("Reading collection type "+("$"===s?"object":"Array")),"@"===s){for(o=[];d<h;d++){if(i=f[d],r.verbose&&console.log("Read "+i+" symbol"),"]"===i)return o;if("@"===i||"$"===i)o.push(t());else switch(i){case-1:o.push(!0);break;case-2:o.push(!1);break;case-3:o.push(null);break;case-5:o.push(void 0);break;case e:o.push("");break;default:o.push(a[i])}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(o)),o}if("$"===s){for(o={};d<h;d++){if("]"===(n=f[d]))return o;if(n=n===e?"":a[n],"@"===(i=f[++d])||"$"===i)o[n]=t();else switch(i){case-1:o[n]=!0;break;case-2:o[n]=!1;break;case-3:o[n]=null;break;case-5:o[n]=void 0;break;case e:o[n]="";break;default:o[n]=a[i]}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(o)),o}throw new TypeError("Bad token "+s+" isn't a type")}()}}});!function(e,t){"use strict";var o="model",r="name",n="type",i="vendor",a="version",s="mobile",l="tablet",c={extend:function(e,t){var o={};for(var r in e)t[r]&&t[r].length%2==0?o[r]=t[r].concat(e[r]):o[r]=e[r];return o},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},u={rgx:function(e,t){for(var o,r,n,i,a,s,l=0;l<t.length&&!a;){var c=t[l],u=t[l+1];o=r=0;for(;o<c.length&&!a;)if(a=c[o++].exec(e))for(n=0;n<u.length;n++){s=a[++r];"object"==typeof(i=u[n])&&i.length>0?2==i.length?"function"==typeof i[1]?this[i[0]]=i[1].call(this,s):this[i[0]]=i[1]:3==i.length?"function"!=typeof i[1]||i[1].exec&&i[1].test?this[i[0]]=s?s.replace(i[1],i[2]):void 0:this[i[0]]=s?i[1].call(this,s,i[2]):void 0:4==i.length&&(this[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):void 0):this[i]=s||void 0}l+=2}},str:function(e,t){for(var o in t)if("object"==typeof t[o]&&t[o].length>0){for(var r=0;r<t[o].length;r++)if(c.has(t[o][r],e))return"?"===o?void 0:o}else if(c.has(t[o],e))return"?"===o?void 0:o;return e}},h={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},d={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[r,a],[/(opios)[\/\s]+([\w\.]+)/i],[[r,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[r,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark)\/([\w\.-]+)/i],[r,a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[r,"IE"],a],[/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i],[[r,"Edge"],a],[/(yabrowser)\/([\w\.]+)/i],[[r,"Yandex"],a],[/(puffin)\/([\w\.]+)/i],[[r,"Puffin"],a],[/(focus)\/([\w\.]+)/i],[[r,"Firefox Focus"],a],[/(opt)\/([\w\.]+)/i],[[r,"Opera Touch"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[r,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],a],[/(micromessenger)\/([\w\.]+)/i],[[r,"WeChat"],a],[/(brave)\/([\w\.]+)/i],[[r,"Brave"],a],[/(qqbrowserlite)\/([\w\.]+)/i],[r,a],[/(QQ)\/([\d\.]+)/i],[r,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[r,a],[/(BIDUBrowser)[\/\s]?([\w\.]+)/i],[r,a],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[r,a],[/(MetaSr)[\/\s]?([\w\.]+)/i],[r],[/(LBBROWSER)/i],[r],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[r,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[r,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[r,a],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[r,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[r,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[r,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[r,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[r,a],[/(dolfin)\/([\w\.]+)/i],[[r,"Dolphin"],a],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[r,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[r,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[r,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[r,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,r],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[r,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[r,[a,u.str,h.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[r,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[r,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[r,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",c.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",c.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",c.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,i,[n,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[i,"Apple"],[n,l]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[i,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[i,o,[n,l]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[o,[i,"Amazon"],[n,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[o,u.str,h.device.amazon.model],[i,"Amazon"],[n,s]],[/android.+aft([bms])\sbuild/i],[o,[i,"Amazon"],[n,"smarttv"]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,i,[n,s]],[/\((ip[honed|\s\w*]+);/i],[o,[i,"Apple"],[n,s]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[i,o,[n,s]],[/\(bb10;\s(\w+)/i],[o,[i,"BlackBerry"],[n,s]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[o,[i,"Asus"],[n,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[i,"Sony"],[o,"Xperia Tablet"],[n,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[o,[i,"Sony"],[n,s]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[i,o,[n,"console"]],[/android.+;\s(shield)\sbuild/i],[o,[i,"Nvidia"],[n,"console"]],[/(playstation\s[34portablevi]+)/i],[o,[i,"Sony"],[n,"console"]],[/(sprint\s(\w+))/i],[[i,u.str,h.device.sprint.vendor],[o,u.str,h.device.sprint.model],[n,s]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[i,o,[n,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[i,[o,/_/g," "],[n,s]],[/(nexus\s9)/i],[o,[i,"HTC"],[n,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[o,[i,"Huawei"],[n,s]],[/(microsoft);\s(lumia[\s\w]+)/i],[i,o,[n,s]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[i,"Microsoft"],[n,"console"]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[i,"Microsoft"],[n,s]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[i,"Motorola"],[n,s]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[i,"Motorola"],[n,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[i,c.trim],[o,c.trim],[n,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[i,"Samsung"],[n,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[o,[i,"Sharp"],[n,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[i,"Samsung"],o,[n,l]],[/smart-tv.+(samsung)/i],[i,[n,"smarttv"],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[i,"Samsung"],o,[n,s]],[/sie-(\w*)/i],[o,[i,"Siemens"],[n,s]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[i,"Nokia"],o,[n,s]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[o,[i,"Acer"],[n,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[o,[i,"LG"],[n,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[i,"LG"],o,[n,l]],[/(lg) netcast\.tv/i],[i,o,[n,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[o,[i,"LG"],[n,s]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[i,"Lenovo"],[n,l]],[/linux;.+((jolla));/i],[i,o,[n,s]],[/((pebble))app\/[\d\.]+\s/i],[i,o,[n,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[i,o,[n,s]],[/crkey/i],[[o,"Chromecast"],[i,"Google"]],[/android.+;\s(glass)\s\d/i],[o,[i,"Google"],[n,"wearable"]],[/android.+;\s(pixel c)[\s)]/i],[o,[i,"Google"],[n,l]],[/android.+;\s(pixel( [23])?( xl)?)\s/i],[o,[i,"Google"],[n,s]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[o,/_/g," "],[i,"Xiaomi"],[n,s]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[o,/_/g," "],[i,"Xiaomi"],[n,l]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[o,[i,"Meizu"],[n,l]],[/(mz)-([\w-]{2,})/i],[[i,"Meizu"],o,[n,s]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})\s+build/i],[o,[i,"OnePlus"],[n,s]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[o,[i,"RCA"],[n,l]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[o,[i,"Dell"],[n,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[o,[i,"Verizon"],[n,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[i,"Barnes & Noble"],o,[n,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[o,[i,"NuVision"],[n,l]],[/android.+;\s(k88)\sbuild/i],[o,[i,"ZTE"],[n,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[o,[i,"Swiss"],[n,s]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[o,[i,"Swiss"],[n,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[o,[i,"Zeki"],[n,l]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[i,"Dragon Touch"],o,[n,l]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[o,[i,"Insignia"],[n,l]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[o,[i,"NextBook"],[n,l]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[i,"Voice"],o,[n,s]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[i,"LvTel"],o,[n,s]],[/android.+;\s(PH-1)\s/i],[o,[i,"Essential"],[n,s]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[o,[i,"Envizen"],[n,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[i,o,[n,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[o,[i,"MachSpeed"],[n,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[i,o,[n,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[o,[i,"Rotor"],[n,l]],[/android.+(KS(.+))\s+build/i],[o,[i,"Amazon"],[n,l]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[i,o,[n,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[n,c.lowerize],i,o],[/(android[\w\.\s\-]{0,9});.+build/i],[o,[i,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[r,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,a],[/rv\:([\w\.]{1,9}).+(gecko)/i],[a,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[a,u.str,h.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[a,u.str,h.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i,/linux;.+(sailfish);/i],[r,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[r,"Symbian"],a],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[r,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],a],[/(sunos)\s?([\w\.\d]*)/i],[[r,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[r,a],[/(haiku)\s(\w+)/i],[r,a],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[r,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[r,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[r,a]]},p=function(t,o){if("object"==typeof t){o=t;t=void 0}if(!(this instanceof p))return new p(t,o).getResult();var r=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),n=o?c.extend(d,o):d;this.getBrowser=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,n.browser);e.major=c.major(e.version);return e};this.getCPU=function(){var e={architecture:void 0};u.rgx.call(e,r,n.cpu);return e};this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};u.rgx.call(e,r,n.device);return e};this.getEngine=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,n.engine);return e};this.getOS=function(){var e={name:void 0,version:void 0};u.rgx.call(e,r,n.os);return e};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return r};this.setUA=function(e){r=e;return this};return this};p.VERSION="0.7.19";p.BROWSER={NAME:r,MAJOR:"major",VERSION:a};p.CPU={ARCHITECTURE:"architecture"};p.DEVICE={MODEL:o,VENDOR:i,TYPE:n,CONSOLE:"console",MOBILE:s,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"};p.ENGINE={NAME:r,VERSION:a};p.OS={NAME:r,VERSION:a};if(void 0!==exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=p);exports.UAParser=p}else"function"==typeof define&&define.amd?define(function(){return p}):e&&(e.UAParser=p);var f=e&&(e.jQuery||e.Zepto);if(void 0!==f&&!f.ua){var g=new p;f.ua=g.getResult();f.ua.get=function(){return g.getUA()};f.ua.set=function(e){g.setUA(e);var t=g.getResult();for(var o in t)f.ua[o]=t[o]}}}("object"==typeof window?window:this);var TC=TC||{};TC.tool=TC.tool||{};TC.tool.Proxification=function(e,t){this.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}};if(void 0===e)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");this.proxy="function"==typeof e?e:function(t){var o=e;"http"!=t.substr(0,4)&&(o+=window.location.protocol);return o+=encodeURIComponent(t)};t=t||{};this._location=t.location||window.location;this.preventMixedContent=void 0===t.allowedMixedContent||!t.allowedMixedContent};!function(){window.fetch||function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{new Blob;return!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},n=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=s(e);t=l(t);var o=this.map[e];this.map[e]=o?o+","+t:t};u.prototype.delete=function(e){delete this.map[s(e)]};u.prototype.get=function(e){e=s(e);return this.has(e)?this.map[e]:null};u.prototype.has=function(e){return this.map.hasOwnProperty(s(e))};u.prototype.set=function(e,t){this.map[s(e)]=l(t)};u.prototype.forEach=function(e,t){for(var o in this.map)this.map.hasOwnProperty(o)&&e.call(t,this.map[o],o,this)};u.prototype.keys=function(){var e=[];this.forEach(function(t,o){e.push(o)});return c(e)};u.prototype.values=function(){var e=[];this.forEach(function(t){e.push(t)});return c(e)};u.prototype.entries=function(){var e=[];this.forEach(function(t,o){e.push([o,t])});return c(e)};t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var i=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})};g.call(m.prototype);g.call(C.prototype);C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})};C.error=function(){var e=new C(null,{status:0,statusText:""});e.type="error";return e};var a=[301,302,303,307,308];C.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new C(null,{status:t,headers:{location:e}})};e.Headers=u;e.Request=m;e.Response=C;e.fetch=function(e,o){return new Promise(function(r,n){var i=new m(e,o);o=o||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new C(null,{status:a.status});var e={status:a.status,statusText:a.statusText,headers:function(e){var t=new u;e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var o=e.split(":"),r=o.shift().trim();if(r){var n=o.join(":").trim();t.append(r,n)}});return t}(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;r(new C(t,e))};a.onerror=function(){n(new TypeError("Network request failed"))};a.ontimeout=function(){n(new TypeError("Network request failed"))};a.open(i.method,i.url,!o.sync);"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1);!o.sync&&"responseType"in a&&t.blob&&(a.responseType="blob");i.headers.forEach(function(e,t){a.setRequestHeader(t,e)});a.send(void 0===i._bodyInit?null:i._bodyInit)})};e.fetch.polyfill=!0}function s(e){"string"!=typeof e&&(e=String(e));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){"string"!=typeof e&&(e=String(e));return e}function c(e){var o={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};t.iterable&&(o[Symbol.iterator]=function(){return o});return o}function u(e){this.map={};e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise(function(t,o){e.onload=function(){t(e.result)};e.onerror=function(){o(e.error)}})}function p(e){var t=new FileReader,o=d(t);t.readAsArrayBuffer(e);return o}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);t.set(new Uint8Array(e));return t.buffer}function g(){this.bodyUsed=!1;this._initBody=function(e){this._bodyInit=e;if(e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e)){this._bodyArrayBuffer=f(e.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!n(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=f(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))};if(t.blob){this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))};this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}}this.text=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,o=d(t);t.readAsText(e);return o}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),o=new Array(t.length),r=0;r<t.length;r++)o[r]=String.fromCharCode(t[r]);return o.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)};t.formData&&(this.formData=function(){return this.text().then(y)});this.json=function(){return this.text().then(JSON.parse)};return this}function m(e,t){var o,r,n=(t=t||{}).body;if(e instanceof m){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url;this.credentials=e.credentials;t.headers||(this.headers=new u(e.headers));this.method=e.method;this.mode=e.mode;if(!n&&null!=e._bodyInit){n=e._bodyInit;e.bodyUsed=!0}}else this.url=String(e);this.credentials=t.credentials||this.credentials||"omit";!t.headers&&this.headers||(this.headers=new u(t.headers));this.method=(o=t.method||this.method||"GET",r=o.toUpperCase(),i.indexOf(r)>-1?r:o);this.mode=t.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function y(e){var t=new FormData;e.trim().split("&").forEach(function(e){if(e){var o=e.split("="),r=o.shift().replace(/\+/g," "),n=o.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}});return t}function C(e,t){t||(t={});this.type="default";this.status=void 0===t.status?200:t.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in t?t.statusText:"OK";this.headers=new u(t.headers);this.url=t.url||"";this._initBody(e)}}("undefined"!=typeof self?self:this);var e=function(e){var t=document.createElement("a");t.href=e;if(!t.origin){if(!t.protocol||!t.hostname){var o=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);t.protocol=o[1];if(o[4].indexOf(":")>-1){var r=o[4].split(":");t.hostname=r[0];t.port=r[1]}else t.hostname=o[4]}t.origin=(0===t.protocol.length?window.location.protocol:t.protocol)+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t};var t=TC.tool.Proxification.prototype;t.cacheHost=new function(){var t=function(t){var o=e(t);return o?o.origin:null};this._hosts=[];this._hostsImage=[];this.is=function(e,o){var r=t(e);return null!==this.get(r,o)};this.get=function(e,t){if(0===this.getList(t).length)return null;var o=this.getList(t).filter(function(o){return o.key===e&&t.exportable==o.exportable});return 0===o.length?null:o[0]};this.getList=function(e){return e.forImage?this._hostsImage:this._hosts};this.addKey=function(e,o){var r={key:t(e),action:null};o.exportable&&(r.exportable=o.exportable);this.getList(o).push(r);return this.getList(o)[this.getList(o).length-1]};this.removeKey=function(e,o){t(e);for(var r=0;r<this.getList(o).length;r++)if(this.getList(o)[r].key&&o.exportable==this.getList(o)[r].exportable){this.getList(o).splice(r,1);break}};this.getAction=function(e,o){o=o||{};var r=t(e);return this.get(r,o)._actionPromise}};t._isServiceWorker=function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)};t._isSameOrigin=function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),o=!t&&e.match(this.Consts.url.SPLIT_REGEX);if(o){var r=o[1];t=(r==this._location.protocol||void 0==r)&&o[3]==this._location.hostname;var n=o[4],i=this._location.port;(80!=n&&""!==n||"80"!=i&&""!==i)&&(t=t&&n==i)}return t};t._isSameProtocol=function(e){var t=/^(https?:\/\/)/i,o=e.match(t);if(o&&o.length>1){var r=self._location.match(t);if(r&&r.length>1)return o[0].trim()===r[0].trim()}return!1};t._isSecureURL=function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)};var o=function(t,o){var r=e(t);return t.replace(r.protocol,o)},r=function(e){return o(e,"https:")},n=function(e){return o(e,"http:")},i=function(e,t,o,i){var s=this;e=r(e);s._image.getImgTag(e,t).then(function(e){o(e,s._actionHTTPS)},function(r){r===s._image.ErrorType.PROTOCOL?i(r):a.call(s,n(e),t,o,i)})},a=function(e,t,o,r){var n=this;t.sameOrigin=n._isSameOrigin(n._actionProxy.call(n,e));n._image.getImgTagByAction(e,t,n._actionProxy.bind(n)).then(function(e){o(e,n._actionProxy)},function(e){r(e)})};t._actionDirect=function(e){return e};t._actionHTTP=function(e){return o(e,"http:")};t._actionHTTPS=function(e){return o(e,"https:")};t._actionProxy=function(e){return this.proxy(e)};t._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected"},checkHttpStatus:function(e){const t=this;return fetch(e,{credentials:"omit"}).then(function(e){return{status:e.status,statusText:e.statusText}}).catch(function(e){return t.ErrorType.UNEXPECTED})},getImgTag:function(e,o){return new Promise(function(t,r){var n=this,i=document.createElement("img");if(o.exportable&&!o.sameOrigin){i.dataset.checkCORSHeaders=!0;i.crossOrigin="anonymous"}i.onload=function(){console.log("Load OK: "+i.src);i.onload=i.onerror=void 0;if(o.exportable&&!o.sameOrigin){try{var e=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t}(i);result=e.toDataURL("image/png");t(i)}catch(e){18===e.code?r(n.ErrorType.CORS):t(i)}}else t(i)};i.onerror=function(t){console.log("Load crossOrigin ERROR: "+i.src);if(i.dataset.checkCORSHeaders){i.crossOrigin=null;i.onerror=void 0;i.onerror=function(e){console.log("Load ERROR: "+i.src);n.checkHttpStatus(i.src).then(function(e){o.ignoreProxification?r(n.ErrorType.PROTOCOL):400===e.status?r(n.ErrorType.PROTOCOL):r(e)}).catch(r);i.onload=i.onerror=void 0};i.src=e}else{console.log("Load ERROR: "+i.src);i.onload=i.onerror=void 0;n.checkHttpStatus(i.src).then(function(e){o.ignoreProxification?r(n.ErrorType.PROTOCOL):400===e.status?r(n.ErrorType.PROTOCOL):r(e)}).catch(r)}};try{i.src=e}catch(e){console.log("Load ERROR: "+i.src);r(n.ErrorType.UNEXPECTED)}}.bind(t._image))},getImgTagByAction:function(e,o,r){return new Promise(function(t,n){var i=this,a=document.createElement("img");o.sameOrigin||o.exportable&&(a.crossOrigin="anonymous");a.onload=function(){a.onload=a.onerror=void 0;t(a)};a.onerror=function(e){console.log("Load ERROR: "+a.src);a.onload=a.onerror=void 0;i.checkHttpStatus(a.src).then(function(e){o.ignoreProxification?n(i.ErrorType.PROTOCOL):400===e.status?n(i.ErrorType.PROTOCOL):n(e)}).catch(n)};a.src=r(e)}.bind(t._image))}};t._fetch={Headers:{CONTENTTYPE:"content-type"},ErrorType:{CORS:"cors",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(e){if(!e.ok)throw Error(e.statusText);return e},validateContentType:function(e,t){const o=this;if(!e)return t;var r=t.headers.get(o._fetch.Headers.CONTENTTYPE);if(r&&-1===r.indexOf(e))throw Error(o._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return t}};t.fetchImage=function(e,t){var o=this;(t=t||{}).forImage=!0;return new Promise(function(s,l){if(o.cacheHost.is(e,t))o.cacheHost.getAction(e,t).then(function(r){t.sameOrigin=o._isSameOrigin(r.action(e));o._image.getImgTagByAction(e,t,r.action).then(function(e){s(e)},function(e){l(e)})});else{var c=o.cacheHost.addKey(e,t);c._actionPromise=new Promise(function(u,h){const d=function(e,r){c.action=r.bind(o);c.exportable=t.exportable;u({action:c.action});s(e)},p=function(r){if(200==r.status){o.cacheHost.removeKey(e,t);l(r)}else{o.cacheHost.removeKey(e,t);l(r)}};!function(t){if(o._isSameOrigin(e)){t.sameOrigin=!0;o._image.getImgTag(e,t).then(function(e){d(e,o._actionDirect)},p)}else o._isSecureURL(e)?o._image.getImgTag(e,t).then(function(e){d(e,o._actionDirect)},function(i){t.exportable&&i===o._image.ErrorType.CORS||o._isServiceWorker()||o._isSecureURL(o._location)&&o.preventMixedContent?i===o._image.ErrorType.PROTOCOL&&t.ignoreProxification?p(i):a.call(o,e,t,d,p):function(e,t,o,i){var s=this;e=n(e);s._image.getImgTag(e,t).then(function(e){o(e,s._actionHTTP)},function(n){n===s._image.ErrorType.PROTOCOL?i(n):a.call(s,r(e),t,o,i)})}.call(o,e,t,d,p)}):o._isServiceWorker()||o._isSecureURL(o._location)&&o.preventMixedContent?i.call(o,e,t,d,p):o._image.getImgTag(e,t).then(function(e){d(e,o._actionDirect)},function(r){t.exportable&&r===o._image.ErrorType.CORS||!o._isSecureURL(o._location)?r===o._image.ErrorType.PROTOCOL&&t.ignoreProxification?p(r):a.call(o,e,t,d,p):i.call(o,e,t,d,p)})}(t)})}})};t.fetchRetry=function(e,t,o){const r=this;var n=fetch;t.sync&&(n=r.fetchSync);return n(e,t).catch(function(n){if(1===o)throw n;return r.fetchRetry(e,t,o-1)})};t.fetchSync=function(e,t){var o=this;return new Promise(function(r,n){"Symbol"in o&&Symbol;var i="FileReader"in o&&"Blob"in o&&function(){try{new Blob;return!0}catch(e){return!1}}();if("ArrayBuffer"in o){var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];ArrayBuffer.isView}var s=new Request(e,t),l=new XMLHttpRequest;l.onload=function(){var e={status:l.status,statusText:l.statusText,headers:function(e){var t=new Headers;e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var o=e.split(":"),r=o.shift().trim();if(r){var n=o.join(":").trim();t.append(r,n)}});return t}(l.getAllResponseHeaders()||"")};e.url="responseURL"in l?l.responseURL:e.headers.get("X-Request-URL");var t="response"in l?l.response:l.responseText;r(new Response(t,e))};l.onerror=function(){n(new TypeError("Network request failed"))};l.ontimeout=function(){n(new TypeError("Network request failed"))};l.open(s.method,s.url,!1);"include"===s.credentials?l.withCredentials=!t.sync:"omit"===s.credentials&&(l.withCredentials=!1);!t.sync&&"responseType"in l&&i&&(l.responseType="blob");s.headers.forEach(function(e,t){l.setRequestHeader(t,e)});l.send(void 0===s._bodyInit?null:s._bodyInit)})};t.fetchXML=function(e,t){(t=t||{}).responseType="xml";return this.fetch(e,t)};t.fetchJSON=function(e,t){(t=t||{}).responseType=TC.Consts.mimeType.JSON;return this.fetch(e,t)};t.fetchBlob=function(e,t){(t=t||{}).responseType="blob";return this.fetch(e,t)};t.fetchImageAsBlob=function(e,t){(t=t||{}).responseType="image";return this.fetch(e,t)};t.fetch=function(t,o){const r=this;if((o=o||{}).type){o.method=o.type;delete o.type}if(o.data){o.body=o.data;delete o.data}if(o.contentType){o.headers=new Headers;o.headers.append("Content-Type",o.contentType);delete o.contentType}o.responseType||(o.responseType="");var n=function(e,t,o,i){return(t.retryAttempts?r.fetchRetry(o[0].call(r,e),t,t.retryAttempts):fetch(o[0].call(r,e),t)).then(r._fetch.validateResponse).then(r._fetch.validateContentType.bind(r,t.responseType)).then(function(e){i&&(i.action=o[0].bind(r));const n=e.headers.get(r._fetch.Headers.CONTENTTYPE),a=function(t){return e.blob().then(function(e){const o=new FileReader;return new Promise(function(r,n){o.addEventListener("error",function(){o.abort();n(new DOMException("Problem decoding"))});o.addEventListener("loadend",function(){r(o.result)});o.readAsText(e,t)})})};switch(!0){case t.responseType.indexOf("xml")>-1:case t.responseType.indexOf("text/xml")>-1:case t.responseType.indexOf(TC.Consts.mimeType.XML)>-1:return(s=/charset=([^;]*)/i.exec(n))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(e){return(new window.DOMParser).parseFromString(e,"text/xml")}):e.text().then(function(e){return(new window.DOMParser).parseFromString(e,"text/xml")});case t.responseType.indexOf("arraybuffer")>-1:return e.arrayBuffer();case t.responseType.indexOf("image")>-1:case t.responseType.indexOf("blob")>-1:return e.blob().then(function(e){return new Blob([e],{type:n})});case t.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+t.responseType);case t.responseType.indexOf(TC.Consts.mimeType.JSON)>-1:return e.json();case""==t.responseType:case t.responseType.indexOf("text")>-1:default:var s;return(s=/charset=([^;]*)/i.exec(n))&&2===s.length&&"UTF-8"!==s[1]?a(s[1]).then(function(e){return""==t.responseType?{responseText:e,contentType:n}:e}):e.text().then(function(e){return""==t.responseType?{responseText:e,contentType:n}:e})}}).catch(function(r){if(1===o.length){console.log("request failed",r);return Promise.reject(new Error(r.message))}o.shift();return n(e,t,o,i)})};if(r.cacheHost.is(t,o))return r.cacheHost.getAction(t,o).then(function(e){return n(t,o,[e.action])}).catch(function(e){return Promise.reject(new Error(e))});var i=r.cacheHost.addKey(t,o);return new Promise(function(a,s){i._actionPromise=new Promise(function(l,c){t=e(t).href;const u=function(e){l({action:i.action});a(e)},h=function(e){r.cacheHost.removeKey(t,o);c(e);s(e)};r._isSameOrigin(t)?n(t,o,[r._actionDirect,r._actionProxy],i).then(u).catch(h):r._isSecureURL(t)?r._isServiceWorker()?n(t,o,[r._actionDirect,r._actionProxy],i).then(u).catch(h):n(t,o,[r._actionDirect,r._actionHTTP,r._actionProxy],i).then(u).catch(h):r._isServiceWorker()?n(t,o,[r._actionHTTPS,r._actionProxy],i).then(u).catch(h):n(t,o,r._isSecureURL(r._location)?[r._actionDirect,r._actionHTTPS,r._actionProxy]:[r._actionDirect,r._actionProxy],i).then(u).catch(h)})})}}();var TC=TC||{};TC.inherit=function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;e._super=t.prototype};!function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(e){t.prototype=new t("").constructor.prototype;return t;function t(e,t){t||(t={});var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail);return o}}();Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);const e=function(e,t,o){const r=this;e.split(" ").forEach(function(e){r.$events.addEventListener(e,function(e,t){const o=function(e){const o={type:e.type,target:this,currentTarget:this};e.detail&&Object.keys(e.detail).forEach(function(t){t in o||(o[t]=e.detail[t])});return t.call(this,o)}.bind(this);(this._listeners[e]=this._listeners[e]||new Map).set(t,o);return o}.call(r,e,t),o)});return r};TC.EventTarget=function(){const e=this;e._listeners={};e.$events=document.createDocumentFragment();const t=["addEventListener","dispatchEvent","removeEventListener"];t.forEach(function(t){this[t]=e.$events[t].bind(e.$events)},e);t.push("on");t.push("one");t.push("off");t.push("trigger");t.forEach(function(t){e.$events[t]=e[t].bind(e)},e)};const t=TC.EventTarget.prototype;t.on=function(t,o){return e.call(this,t,o)};navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0?t.one=function(e,t){const o=this,r=function(n){o.off(e,r);t.call(this,n)};o.on(e,r);return o}:t.one=function(t,o){return e.call(this,t,o,{once:!0})};t.off=function(e,t){const o=this,r=e.split(" ");t?r.forEach(function(e){const r=o._listeners[e];r&&r.has(t)&&o.$events.removeEventListener(e,r.get(t))}):r.forEach(function(e){const t=o._listeners[e];if(t){t.forEach(function(t){o.$events.removeEventListener(e,t)});t.clear()}});return o};t.trigger=function(e,t){if(window.$&&$.Event&&e instanceof $.Event){t={};Object.keys(e).forEach(function(o){"type"!==o&&(t[o]=e[o])});e=e.type}var o;t&&(o={detail:t});const r=new CustomEvent(e,o);this.dispatchEvent(r)};TC.EventTarget._onBySelectorMap=new WeakMap;TC.EventTarget.listenerBySelector=function(e,t){return function(o){const r=this,n=o.type;var i=TC.EventTarget._onBySelectorMap.get(r);if(!i){i={};TC.EventTarget._onBySelectorMap.set(r,i)}var a=i[n];a||(i[n]=a={});a[e]||(a[e]=t);if(!o._listenerBySelectorCalled)for(var s,l=!1,c=o.target;c&&c!==r;){for(e in a)if(c.matches&&c.matches(e)){l=!0;s=a[e].call(r,o);o._listenerBySelectorCalled=!0}if(l)return s;c=c.parentNode}}};var o=null,r=null;const n=function(e){const t=this;var n=i.call(t);if(t.replaceCurrent){window.history.replaceState(n,null,null);delete t.replaceCurrent}else{t.lastEventType=e.type;var a=function(){r=o;(o=TC.Util.utf8ToBase64(n))!==r&&window.history.pushState(n,null,window.location.href.split("#").shift()+"#"+o)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE:case e.type==TC.Consts.event.LAYERORDER:case e.type==TC.Consts.event.ZOOM:a();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&a()}}},i=function(e){const t=this;var o={};t.crs!==t.options.crs&&(o.crs=t.crs);for(var r=t.getExtent(),n=0;n<r.length;n++)Math.abs(r[n])>180&&(r[n]=Math.floor(1e3*r[n])/1e3);o.ext=r;var i,a,s=[];t.baseLayers&&(s=t.baseLayers.filter(function(e){return e.isRaster()&&e.fallbackLayer}).map(function(e){return{baseLayer:e,fallbackLayerID:e.fallbackLayer.id}}).filter(function(e){return e.fallbackLayerID===(t.baseLayer?t.baseLayer.id:t.baseLayers[0].id)}));s.length>0?o.base=s[0].baseLayer.id:o.base=(t.baseLayer||t.baseLayers[0]).id;o.layers=[];for(n=0;n<t.workLayers.length;n++)if("WMS"==(i=t.workLayers[n]).type&&!i.options.stateless&&i.layerNames&&i.layerNames.length){a={u:TC.Util.isOnCapabilities(i.url),n:$.isArray(i.names)?i.names.join(","):i.names,o:i.getOpacity(),v:i.getVisibility(),h:i.options.hideTitle,ur:i.unremovable,t:i.title};o.layers.push(a)}t.on3DView&&t.view3D.cameraControls&&(o.vw3=t.view3D.cameraControls.getCameraState());window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);e&&$.extend(o,e);return jsonpack.pack(o)},a=function(e){const t=this,o=[];t.loadingctrl||(t.loadingCtrl=t.getControlsByClass("TC.control.LoadingIndicator")[0]);t.hasWait||(t.hasWait=t.loadingCtrl&&t.loadingCtrl.addWait());return new Promise(function(r,n){var i,a=function(){t.loadingCtrl&&t.loadingCtrl.removeWait(t.hasWait);delete t.hasWait;r()};if("string"==typeof e)try{i=jsonpack.unpack(e)}catch(o){try{i=JSON.parse(e)}catch(e){TC.error(TC.Util.getLocaleString(t.options.locale,"mapStateNotValid"))}}else i=e;if(i){if(i.crs&&i.crs!==t.crs||void 0===i.crs&&t.crs!==t.options.crs)o.push(t.setProjection({crs:i.crs||t.options.crs,oldCrs:t.crs,extent:i.ext,baseLayer:t.getLayer(i.base)}));else{if(i.base!=t.getBaseLayer().id){t.getLayer(i.base)&&t.setBaseLayer(i.base);const e=t.baseLayers.filter(function(e){return e.options.fallbackLayer===i.base})[0];if(e){const r=t.addLayer(e.getFallbackLayer());o.push(r);r.then(function(e){t.setBaseLayer(e)})}}i.ext&&o.push(t.setExtent(i.ext,{animate:!1}))}(function(){const e=this;e.workLayers.filter(function(e){return!(e instanceof TC.layer.Vector)}).forEach(function(t){t.unremovable&&(t.unremovable=!1);e.removeLayer(t)})}).call(t);i.layers=i.layers||i.capas||[];if(i.layers.length>0)for(var s=0;s<i.layers.length;s++){var l=i.layers[s],c=!1;for(j=0;j<t.options.workLayers.length;j++){var u=$.extend({},t.options.workLayers[j],{map:t});if(l.u===u.url&&u.layerNames.indexOf(l.n)>=0){c=!0;u.renderOptions={opacity:l.o,hide:!l.v};u.unremovable=l.ur;u.title=l.t;o.push(t.addLayer(u).then(function(e){e.setVisibility(this.v);e.setOpacity(this.o,!0)}.bind(l)))}}c||o.push(t.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:l.n?l.n.split(","):"",unremovable:l.ur,title:l.t,renderOptions:{opacity:l.o,hide:!l.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(this.o,!0);e.setVisibility(this.v)}.bind(l)))}Promise.all(o).then(function(){a()}).catch(function(){a()})}})},s=function(e){return function(t,o,r,n){return o.id===e?r:t}},l=function(e){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(t){return t.id===e})[0]};TC.Map=TC.Map||function(e,t){const o=this;TC.EventTarget.call(o);TC.Map._instances.push(o);o.isReady=!1;o.isLoaded=!1;o.controls=[];o.activeControl=null;o.layers=[];o.baseLayers=[];o.workLayers=[];o.baseLayer=null;o.vectors=null;var u=0;o.div=TC.Util.getDiv(e);o._$div=$(o.div);o.div.classList.add(TC.Consts.classes.LOADING);$(o.div).data("map",o);o.div.classList.add(TC.Consts.classes.MAP);o._markerPromises=[];o._layerBuffer={layers:[],contains:function(e){return this.layers.some(function(t){return t.id===e})},getIndex:function(e){return this.layers.reduce(s(e),-1)},add:function(e,t,o){var r;const n={id:e,pending:!0,isRaster:t,isBase:o};if(t){r=this.getRasterIndex();this.layers.splice(r,0,n)}else{r=this.layers.length;this.layers[r]=n}},remove:function(e){this.layers.splice(this.getIndex(e),1)},getMapLayers:function(){return this.layers.filter(function(e){return!1===e.pending}).map(function(e){return e.mapLayer})},resolve:function(e,t,o){const r=this.layers[this.getIndex(t.id)];r.mapLayer=t;r.pending=!1;e.layers=this.getMapLayers();if(o){0===e.baseLayers.length&&(e.baseLayers=new Array(e.options.baseLayers.length));if((n=e.options.baseLayers.map(function(e){return e.id}).indexOf(t.id))<0){var n;(n=e.baseLayers.map(function(e){return e.type}).indexOf(TC.Consts.layerType.VECTOR))<0?e.baseLayers.push(t):e.baseLayers.splice(n,0,t)}else e.baseLayers.splice(n,1,t)}else e.workLayers=e.layers.filter(function(e){return!e.isBase})},reject:function(e,t,o){const r=this.layers[this.getIndex(t.id)];r.mapLayer=t;r.pending=!1;r.rejected=!0;var n=e.options.baseLayers.map(function(e){return e.id}).indexOf(t.id);e.baseLayers.splice(n,1)},getResolvedWorkLayerIndex:function(e,t){return this.layers.filter(function(e){return e.id===t||!e.isBase&&!1===e.pending}).reduce(s(t),-1)},getResolvedVisibleLayerIndex:function(e,t){var o=this.getResolvedWorkLayerIndex(e,t);e.baseLayer&&(o+=1);return o},getRasterIndex:function(){return this.layers.reduce((e="isRaster",function(t,o,r){return o[e]?r:t}),-1)+1;var e},checkMapLoad:function(e){const t=this;if(e.options.baseLayers.concat(e.options.workLayers).every(function(e){return t.contains(e.id||e)})&&!this.layers.some(function(e){return!0===e.pending})){const t=function(){if(!e.isLoaded){const t=function(){e.options.stateful&&function(){const e=this;var t=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");e.replaceCurrent=!0;n.call(e);const o=n.bind(e);e.on(t,o);var r;e.on(TC.Consts.event.LAYEROPACITY,function(t){clearTimeout(r);r=setTimeout(function(){n.call(e,t)},500)});window.addEventListener("popstate",function(r){var n;n=e.loadingCtrl&&e.loadingCtrl.addWait();setTimeout(function(){if(r){e.off(t,o);var i=r.state;"[object Object]"===Object.prototype.toString.call(i)&&(i=e.checkLocation());a.call(e,i).then(function(){setTimeout(function(){e.on(t,o)},200);e.loadingCtrl&&e.loadingCtrl.removeWait(n)})}},4)})}.call(e);e.isLoaded=!0;e.trigger(TC.Consts.event.MAPLOAD);Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12&&e.options.warningIE||e.div.classList.remove(TC.Consts.classes.LOADING)};if(e.state&&e.state.vw3){if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12){e.toast(TC.Util.getLocaleString(e.options.locale,"threed.not.supported"),{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});t()}else if(!e.div.classList.contains(TC.Consts.classes.THREED)){e.div.classList.add(TC.Consts.classes.THREED);TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:e,state:e.state.vw3,callback:function(){t();e.getControlsByClass(TC.control.ThreeD)[0].button.removeAttribute("disabled")}})})}}else t()}};if(e.baseLayer)t();else{var o=[];e.state&&e.state.base&&(o=TC.Cfg.availableBaseLayers.filter(function(t){return t.id===e.state.base}));if(o.length>0){o[0].isBase=!0;e.addLayer(o[0]).then(function(e){t()})}else{const o=e.baseLayers.filter(function(e){return!e.mustReproject}).filter(function(e){return e.wrap&&e.wrap.layer});if(o.length>0){e.wrap.setBaseLayer(o[0].wrap.layer);e.baseLayer=o[0]}t()}}}}};if(!TC.ready){TC.Cfg=$.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(t&&t.controls&&t.controls.search&&t.controls.search.allowedSearchTypes)for(var p in TC.Cfg.controls.search.allowedSearchTypes)t.controls.search.allowedSearchTypes.hasOwnProperty(p)||(t.controls.search.allowedSearchTypes[p]=!1);t=t||{};h.call(o,t);var f=function(){TC.loadJS(o.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){o.options.stateful&&(o.state=o.checkLocation());o.options.layout&&o.trigger(TC.Consts.event.LAYOUTLOAD,{map:o});t&&void 0!==t.workLayers&&(o.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(o.options.baseLayers=t.baseLayers);if(o.options.zoomToFeatures){o.on(TC.Consts.event.FEATURESADD,function e(t){clearTimeout(o._zoomToFeaturesTimeout);o._zoomToFeaturesTimeout=setTimeout(function(){o.zoomToFeatures(t.layer.features,{animate:!1});o.off(TC.Consts.event.FEATURESADD,e)},100)})}o.on(TC.Consts.event.LAYERADD,function e(t){if(t.layer.isBase&&(t.layer===o.baseLayer||o.baseLayer&&t.layer.fallbackLayer&&t.layer.fallbackLayer.id===o.baseLayer.id)){void 0!==o.state&&(o.state.crs?o.loaded(function(){o.setProjection({crs:o.state.crs,extent:o.state.ext})}):o.setExtent(o.state.ext,{animate:!1}));o.off(TC.Consts.event.LAYERADD,e)}});o.crs=o.options.crs;o.initialExtent=o.options.initialExtent;o.maxExtent=o.options.maxExtent;Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12&&o.options.warningIE&&function(){const e=TC.isDebug?TC.apiLocation+"TC/templates/WarningIE.html":function(){dust.register("warningIE",e);function e(e,t){return e.w('<div class="tc-warningIE"><span>').h("i18n",t,{},{$key:"warningIE"}).w('</span><button class="tc-button tc-hidden" title="').h("i18n",t,{},{$key:"warningIEContinue"}).w('">').h("i18n",t,{},{$key:"warningIEContinue"}).w("</button></div>")}e.__dustBody=!0;return e};TC.Util.getRenderedHtml("warningIE",e,null,function(e){var t=document.createElement("template");t.innerHTML=e.trim();o.div.appendChild(t.content?t.content.firstChild:t.firstChild);o.loaded(function(){const e=document.querySelector(".tc-warningIE > button");e.classList.remove(TC.Consts.classes.HIDDEN);const t=function(r){e.removeEventListener("click",t);o.div.removeChild(document.querySelector(".tc-warningIE"));o.div.classList.remove(TC.Consts.classes.LOADING)};e.addEventListener("click",t)})})}();o.wrap=new TC.wrap.Map(o);TC.loadJS(!(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ]),[TC.url.proj4js],function(){TC.loadJSInOrder(!(TC.isLegacy?window[TC.Consts.OLNS_LEGACY]:window[TC.Consts.OLNS]),[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:o.options.crs,callback:function(){o.wrap.setMap();const e=[];for(var t in o.options.controls){const r=o.options.controls[t];r&&e.push(o.addControl(t,"boolean"==typeof r?{}:r))}o.on(TC.Consts.event.BEFORELAYERUPDATE,g);o.on(TC.Consts.event.LAYERUPDATE,m);var r,n;for(r=0;r<o.options.baseLayers.length;r++){"string"==typeof(n=o.options.baseLayers[r])&&(n=l.call(o,n));o.addLayer($.extend({},n,{isBase:!0,map:o}))}var i=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};o.options.workLayers.map(function(e){return $.extend({},e,{map:o})}).filter(function(e){return!o.state||!o.state.layers||!o.state.layers.some(function(t){const o=t.u===e.url&&e.layerNames.indexOf(t.n)>=0;o&&(t.id=e.id);return o})}).forEach(function(e){o.addLayer(e).then(i)});o.state&&o.state.layers&&o.state.layers.forEach(function(e){o.addLayer({id:e.id||TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:e.n?e.n.split(","):"",unremovable:e.ur,title:e.t,renderOptions:{opacity:e.o,hide:!e.v}}).then(function(t){t.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)});var o=t.wrap.getRootLayerNode();t.title=e.t||o.Title||o.title;this.o<1&&t.setOpacity(this.o);this.v||t.setVisibility(this.v)}.bind(e))});Promise.all(e).then(function(){o.isReady=!0;o.trigger(TC.Consts.event.MAPREADY)});C(o.div)}})})});o.on(TC.Consts.event.FEATURECLICK,function(e){o.activeControl&&o.activeControl.isExclusive()||(o.on3DView?e.feature.showResultsPanel():e.feature.showPopup())});o.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;for(var t=!0,r=0,n=o.workLayers.length;r<n;r++)if(!o.workLayers[r]._noFeatureClicked){t=!1;break}if(t){o.workLayers.forEach(function(e){delete e._noFeatureClicked});o.getControlsByClass(TC.control.Popup).forEach(function(e){e.hide()})}})})};d.getMapState=function(e){var t=i.call(this,e);return TC.Util.utf8ToBase64(t)};d.getPreviousMapState=function(){return r};d.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(r){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(e){TC.error(TC.Util.getLocaleString(o.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(o.options.locale,"mapStateNotValidForIE"),TC.Consts.msgErrorMode.TOAST);if(t){var r=!1;if(!t.hasOwnProperty("ext")){r=!0;t.ext=o.options.initialExtent}if(!t.hasOwnProperty("base")){r=!0;t.base=o.options.defaultBaseLayer}if(t.hasOwnProperty("layers"))for(var n=t.layers.length-1;n>=0;n--)if(t.layers[n]&&t.layers[n].hasOwnProperty("u")&&t.layers[n].hasOwnProperty("n")){if(!t.layers[n].hasOwnProperty("o")||!t.layers[n].hasOwnProperty("v")||!t.layers[n].hasOwnProperty("h")){r=!0;jQuery.extend(t.layers[n],{o:t.layers[n].o||1,v:t.layers[n].v||!0,h:t.layers[n].h||!1})}}else{r=!0;t.layers.length=t.layers.length-1}else{r=!0;t.layers=[]}t.hasOwnProperty("vw3")&&(t.vw3?(!t.vw3.cp||t.vw3.cp&&3!=t.vw3.cp.length||!t.vw3.chpr||t.vw3.chpr&&3!=t.vw3.chpr.length||!t.vw3.bcpd)&&(r=!0):r=!0);r&&TC.error(TC.Util.getLocaleString(o.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return t}TC.error(TC.Util.getLocaleString(o.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var g=function(e){if(u<=0){u=0;o.trigger(TC.Consts.event.BEFOREUPDATE)}u+=1},m=function(e){if((u-=1)<=0){u=0;o.trigger(TC.Consts.event.UPDATE)}};const y=function(e){var t={};return new Promise(function(o,r){if("string"==typeof e){var n=e,i=/^(https?:)?\/\//i.test(n);const r=function(e,t,o){return new Promise(function(r,l){var c=[n+"/"+o,s+n+"/"+o,s+"layout/responsive/"+o];i&&c.unshift(n+"/"+o);!function o(n){(i=c[n],s=t,new Promise(function(e,t){TC.ajax({method:"HEAD",url:i}).then(function(t){e({resource:s,found:!0,url:i})}).catch(function(t){e({resource:s,found:404!==t.status,url:i})})})).then(function(t){t.found?r(a(e,t)):n===c.length-1?r(e):o(++n)});var i,s}(0)})};var a=function(e,t){if(!(t.resource in e)){var o=t.found?t.url:s+n+"/"+l[t.resource];e[t.resource]=o}return e},s=TC.apiLocation+"TC/",l={script:"script.js",style:"style.css",markup:"markup.html",config:"config.json",i18n:"resources"};Object.keys(l).length;Promise.all(Object.keys(l).map(function(e){return r(t,e,l[e])})).then(function(){o(t)})}else o(e)})};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,o){var r;if(e)r=new Promise(function(e,r){TC.ajax({url:t+o+".json",method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(t){TC.i18n[o]=TC.i18n[o]||{};$.extend(TC.i18n[o],t);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(o,TC.i18n[o]);e()})}).catch(function(e){r(e instanceof Error?e:Error(e))})});else{dust.i18n.add(o,TC.i18n[o]);r=Promise.resolve()}return r};var v=[],T=o.options.locale;v.push(new Promise(function(e,t){TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(T){dust.i18n.setLanguages([T]);v.push(TC.i18n.loadResources(!TC.i18n[T],TC.apiLocation+"TC/resources/",T))}e()})}));Promise.all(v).finally(function(){const e=TC.Util.getParameterByName(TC.Cfg.layoutURLParamName)||o.options.layout;e?y(e).then(function(e){o.trigger(TC.Consts.event.BEFORELAYOUTLOAD,{map:o});var r;"string"==typeof e?r={href:$.trim(e)}:(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("ie8Style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(r=$.extend({},e));if(r.href)r.href+=r.href.match(/\/$/)?"":"/";else for(var n in r){const e=r[n];if(e){r.href=e.substr(0,e.lastIndexOf("/")+1);break}}r.config=r.config||r.href+"config.json";r.markup=r.markup||r.href+"markup.html";r.style=r.style||r.href+"style.css";r.ie8Style=r.ie8Style||r.href+"ie8.css";r.script=r.script||r.href+"script.js";r.i18n=r.i18n||r.href+"resources";r.i18n&&(r.i18n+=r.i18n.match(/\/$/)?"":"/");o.layout=r;const i=[],a=new Promise(function(e,n){if(r.config){const n=TC.ajax({url:r.config,method:"GET",responseType:TC.Consts.mimeType.JSON});n.then(function(r){e(r.i18n);h.call(o,r,t)}).catch(function(t){TC.error(t);e(!1)});i.push(n)}else e(!1)});i.push(a);if(r.style){o.div.classList.add("tc-lo");TC.loadCSS(r.style)}!Modernizr.canvas&&r.ie8Style&&TC.loadCSS(r.ie8Style);r.markup&&i.push(new Promise(function(e,t){TC.ajax({url:r.markup,method:"GET",responseType:"text"}).then(function(t){a.then(function(n){if(n&&T)TC.i18n.loadResources(!0,r.i18n,T).finally(function(){t=t.replace(/(?:\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\})/g,function(e,t,o){return TC.Util.getLocaleString(T,t||o)});o.div.lastElementChild?o.div.lastElementChild.insertAdjacentHTML("afterend",t):o.div.innerHTML=t;e()});else{o.div.lastElementChild?o.div.lastElementChild.insertAdjacentHTML("afterend",t):o.div.innerHTML=t;e()}})}).catch(function(e){t(Error(e))})}));Promise.all(i).finally(function(){TC.loadJS(r.script,r.script,function(){C(o.div);f()})})}):f()});o.on(TC.Consts.event.UPDATEPARAMS,function(e){c(e.layer)});o.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<o.workLayers.length;e++)c(o.workLayers[e])});var _=TC.error;TC.error=function(e,t,r){TC.isDebug&&console.trace&&console.trace();if(t){var n=function(e,t,r){switch(t){case TC.Consts.msgErrorMode.TOAST:if(!o.toast){console.warn("No existe el objeto Toast");return}o.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(r?{msg:r,errorMsg:e}:e,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(e)}};if($.isArray(t))for(var i=0;i<t.length;i++)n(e,t[i],r);else n(e,t,r)}else{_(e);o.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};TC.Map._instances=[];TC.Map.get=function(e){for(var t=0,o=TC.Map._instances.length;t<o;t++){const o=TC.Map._instances[t];if(o.div===e)return o}};TC.inherit(TC.Map,TC.EventTarget);var c=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},u=function(e,t){var o=$.map(e,function(e){var o={};e&&(o[t]=e[t]);return o});"availableBaseLayers"===t&&console.log("layerOptions",o);var r={};r[t]=TC.Cfg[t];o.unshift(r);if("baseLayers"===t&&o[1].baseLayers){r=o[1];for(var n=0;n<r.baseLayers.length;n++)"object"==typeof r.baseLayers[n]&&$.extend(r.baseLayers[n],l.call(this,r.baseLayers[n].id))}else{o.unshift(!0);r=$.extend.apply(this,o);"availableBaseLayers"===t&&console.log("layerOption",r)}return r[t]};var h=function(){const e=this.options=$.extend.apply(this,$.merge([!0,{},TC.Cfg],arguments));e.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(e){return e.availableBaseLayers||[]}));e.baseLayers=u.call(this,arguments,"baseLayers");e.workLayers=u.call(this,arguments,"workLayers");Array.prototype.slice.call(arguments).filter(function(e){return e.controls}).map(function(e){return e.controls}).length>0&&(e.controls=function(e){e.controlContainer&&Object.keys(e).filter(function(t){return Object.keys(e.controlContainer.controls).indexOf(t)>-1}).forEach(function(t){delete e[t]});return e}(e.controls));return e},d=TC.Map.prototype,p=function(e,t){var o,r='Layer "'+t.title+'" ("'+t.names+'"): ';o=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";r+=TC.Util.getLocaleString(e.options.locale,o);TC.error(r);e.trigger(TC.Consts.event.LAYERERROR,{layer:t,reason:o})};d.getCRS=function(){const e=this;return e.on3DView?e.view3D.crs:e.crs};d.addLayer=function(e,t){const o=this,r=new Promise(function(t,r){const i=v(e);"object"!=typeof e||e.id||(e.id=TC.getUID());o._layerBuffer.add(e.id||e,i,e.isBase);var a,s,c;if(i){s=!TC.layer||!TC.layer.Raster;c=TC.apiLocation+"TC/layer/Raster"}else{s=!TC.layer||!TC.layer.Vector;c=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(s,[c],function(){if("string"==typeof e)a=new TC.layer.Raster($.extend({},l.call(o,e),{map:o}));else if(e instanceof TC.Layer)(a=e).map=o;else{e.map=o;a=e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e)}Promise.all([o.wrap.getMap(),a.wrap.getLayer()]).then(function(){o.trigger(TC.Consts.event.BEFORELAYERADD,{layer:a});var i;v(a)&&(i=o.wrap.indexOfFirstVector());-1===i&&(i=o.wrap.getLayerCount());const s=o.state&&o.state.crs?o.state.crs:o.getCRS(),l=a.isCompatible(s);if(a.isBase){if(!l)if(!a.type===TC.Consts.layerType.WMTS)a.mustReproject=!0;else{const e=a.wrap.getCompatibleMatrixSets(s)[0];e?a.wrap.setMatrixSet(e):a.mustReproject=!0}o.state?a.isDefault=o.state.base===a.id||o.state.base===a.options.fallbackLayer:"string"==typeof o.options.defaultBaseLayer?a.isDefault=o.options.defaultBaseLayer===a.id:"number"==typeof o.options.defaultBaseLayer&&(a.isDefault=o.options.defaultBaseLayer===o.baseLayers.length);if(a.isDefault){var c;if(a.mustReproject&&!a.type===TC.Consts.layerType.WMTS||a.mustReproject&&a.type===TC.Consts.layerType.WMTS&&!a.wrap.getCompatibleMatrixSets(s)[0])if(a.options.fallbackLayer&&a.getFallbackLayer)o.addLayer(a.getFallbackLayer()).then(function(e){o.wrap.setBaseLayer(e.wrap.layer);o.baseLayer=e.wrap.parent;n(c);t(a)});else{p(o,a);r(e)}else{c=null===o.baseLayer;a.wrap.getLayer().then(function(e){o.wrap.setBaseLayer(e);o.baseLayer=a;n(c);t(a)})}}else t(a)}else if(l)a.wrap.getLayer().then(function(e){t(a)});else{p(o,a);r(e)}},function(t){r(e)})})});r.then(function(e){o._layerBuffer.resolve(o,e,e.isBase);e.isBase||o.wrap.insertLayer(e.wrap.layer,o._layerBuffer.getResolvedVisibleLayerIndex(o,e.id));o.trigger(TC.Consts.event.LAYERADD,{layer:e});o._layerBuffer.checkMapLoad(o);$.isFunction(t)&&t(e)}).catch(function(e){o._layerBuffer.reject(o,e,e.isBase);o._layerBuffer.checkMapLoad(o)});const n=function(e){if(e){var t={projection:o.wrap.map.getView().getProjection(),extent:o.initialExtent},r=o.baseLayer.getResolutions();if(r&&r.length)t.resolutions=r;else{t.minZoom=o.wrap.map.getView().getMinZoom();t.maxZoom=o.wrap.map.getView().getMaxZoom();var n=o.baseLayer.wrap.layer.getMinResolution();0!==n&&(t.minResolution=n);var i=o.baseLayer.wrap.layer.getMaxResolution();i!==Number.POSITIVE_INFINITY&&(t.maxResolution=i)}o.wrap.map.setView(new ol.View(t));o.wrap.map.getView().fit(o.initialExtent)}};return r};d.removeLayer=function(e){const t=this;return new Promise(function(o,r){if(e.unremovable)return r("Unremovable");e.wrap.getLayer().then(function(r){for(var n=0;n<t.layers.length;n++)t.layers[n]===e&&t.layers.splice(n,1);if(e.isBase){for(n=0;n<t.baseLayers.length;n++)if(t.baseLayers[n]===e){t.baseLayers.splice(n,1);t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(n=0;n<t.workLayers.length;n++)if(t.workLayers[n]===e){t.workLayers.splice(n,1);break}e===t.vectors&&(t.vectors=null)}t.wrap.removeLayer(r);t._layerBuffer.remove(e.id);t.trigger(TC.Consts.event.LAYERREMOVE,{layer:e});t._layerBuffer.checkMapLoad(t);o(e)})})};d.insertLayer=function(e,t,o){for(var r=this,n=-1,i=0;i<r.layers.length;i++)if(e===r.layers[i]){n=i;break}var a=[];a.push(e.wrap.getLayer());var s=r.layers[t];s&&a.push(s.wrap.getLayer());Promise.all(a).then(function(i){const a=i[0],s=i[1];var l=-1;if((l=s?r.wrap.getLayerIndex(s):r.wrap.getLayerCount())>=0){e.map=r;r.wrap.insertLayer(a,l);n>-1&&r.layers.splice(n,1);r.layers.splice(t,0,e);r.workLayers=r.layers.filter(function(e){return!e.isBase});r.trigger(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:n,newIndex:t})}$.isFunction(o)&&o()})};d.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.layer,t)};d.putLayerOnTop=function(e){var t=this.wrap.getLayerCount();this.setLayerIndex(e,t-1)};d.setBaseLayer=function(e,t){var o=this,r=null,n=!1;if("string"==typeof e){var i;for(i=0;i<o.layers.length;i++)if(o.layers[i].id===e){e=o.layers[i];n=!0;break}if(!n&&(e=l.call(o,e))){e=o.addLayer($.extend(!0,{},e,{isDefault:!0,map:o}));n=!0}}else{if($.inArray(e,o.layers)<0){e.isDefault=!0;e.map=o;o.addLayer(e)}n=!0}if(n)if(e.isCompatible(o.getCRS())||e.fallbackLayer&&(!e.fallbackLayer||e.fallbackLayer.isCompatible(o.getCRS()))){o.trigger(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:o.getBaseLayer(),newLayer:e});r=e;o.wrap.getMap().then(function(r){e.wrap.getLayer().then(function(r){o.wrap.setBaseLayer(r).then(function(){o.baseLayer=e;o.trigger(TC.Consts.event.BASELAYERCHANGE,{layer:e});$.isFunction(t)&&t()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return r};d.setView=function(e){this.view=e;this.trigger(TC.Consts.event.VIEWCHANGE,{view:e})};d.ready=function(e){$.isFunction(e)&&(this.isReady?e():this.one(TC.Consts.event.MAPREADY,e))};d.loaded=function(e){$.isFunction(e)&&(this.isLoaded?e():this.one(TC.Consts.event.MAPLOAD,e))};d.getLayerTree=function(){var e={baseLayers:[],workLayers:[]};this.baseLayer&&(e.baseLayers[0]=this.baseLayer.getTree());for(var t=0;t<this.workLayers.length;t++){var o=this.workLayers[t].getTree();o&&e.workLayers.unshift(o)}return e};d.addControl=function(e,t){const o=this;return new Promise(function(r,n){const i=function(e){o.controls.push(e);return Promise.resolve(e.register(o)).then(function(t){e.div.parentElement||o.div.appendChild(e.div);o.trigger(TC.Consts.event.CONTROLADD,{control:e});return t}).catch(function(e){n(e instanceof Error?e:Error(e))})};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e],function(){i(new TC.control[e](null,t)).then(function(e){r(e)})})}else i(e).then(function(e){r(e)})})};d.getControlsByClass=function(e){var t=[],o=e;if("string"==typeof e){o=window;for(var r=e.split("."),n=0;n<r.length&&(o=o[r[n]]);n++);}if($.isFunction(o))for(n=0;n<this.controls.length;n++){var i=this.controls[n];i instanceof o&&t.push(i)}return t};d.getControlById=function(e){const t=this;for(var o=0,r=t.controls.length;o<r;o++){const r=t.controls[o];if(r.id===e)return r}return null};d.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null};d.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};d.setExtent=function(e,t){return this.wrap.setExtent(e,t)};d.getExtent=function(){return this.wrap.getExtent()};d.setCenter=function(e,t){return this.wrap.setCenter(e,t)};d.getCenter=function(){return this.wrap.getCenter()};d.setRotation=function(e){this.wrap.setRotation(e)};d.getRotation=function(){return this.wrap.getRotation()};d.getViewHTML=function(){return this.wrap.getViewport()};d.getCompatibleCRS=function(e){const t=((e=e||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(e){return e.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})}),o=t.slice(1);return t[0].filter(function(e){return o.every(function(t){return t.indexOf(e)>=0})})};d.loadProjections=function(e){e=e||{};return new Promise(function(t,o){const r=e.crsList||[];Promise.all(r.map(function(e){return TC.getProjectionData({crs:TC.Util.getCRSCode(e)})})).then(function(o){var r=o.filter(function(e){return"ok"===e.status&&e.number_result>0}).map(function(e){const t=e.results[0],o="EPSG:"+t.code;TC.loadProjDef({crs:o,def:t.def,name:t.name});return{code:o,name:t.name,proj4:t.proj4,unit:t.unit}});e.orderBy&&(r=r.sort(TC.Util.getSorterByProperty(e.orderBy)));t(r)},function(e){o(e)})})};d.setProjection=function(e){const t=this;e=e||{};return new Promise(function(o,r){var n;if(e.crs){e.baseLayer?n=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(n=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(n=t.baseLayer.getFallbackLayer()));n||(n=t.baseLayer);const i=function(){TC.loadProjDef({crs:e.crs,callback:function(){const i=function(n){const a=function(){const a=$.extend({},e,{oldCrs:t.crs}),s=function(e){e.setProjection(a)};if(n.isCompatible(e.crs)||n.wrap.getCompatibleMatrixSets(e.crs).length>0){n.setProjection(a);t.wrap.setProjection($.extend({},e,{baseLayer:n}));t.crs=e.crs;t.baseLayers.filter(function(e){return e!==n}).forEach(s);t.workLayers.forEach(s);const r=function(){t.trigger(TC.Consts.event.PROJECTIONCHANGE,{crs:e.crs});o()};n&&n!==t.baseLayer?t.setBaseLayer(n,r):r()}else n.fallbackLayer?i(n.fallbackLayer):r()};n.type===TC.Consts.layerType.WMS||n.type===TC.Consts.layerType.WTMS?n.getCapabilitiesPromise().then(a):a()};i(n)}})};t.baseLayers.indexOf(n)<0?t.addLayer(n).then(i):i()}})};d.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};d.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};d.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};d.zoomToFeatures=function(e,t){if(e.length>0){var o=[1/0,1/0,-1/0,-1/0],r=t||{},n=r.pointBoundsRadius||this.options.pointBoundsRadius;n/=this.getMetersPerUnit();var i=r.extentMargin;"number"!=typeof i&&(i=this.options.extentMargin);for(var a=0;a<e.length;a++){var s=e[a].getBounds();if(s){o[0]=Math.min(o[0],s[0]);o[1]=Math.min(o[1],s[1]);o[2]=Math.max(o[2],s[2]);o[3]=Math.max(o[3],s[3])}}if(o[2]-o[0]==0){o[0]=o[0]-n;o[2]=o[2]+n}if(o[3]-o[1]==0){o[1]=o[1]-n;o[3]=o[3]+n}if(this.options.extentMargin){var l=(o[2]-o[0])*i/2,c=(o[3]-o[1])*i/2;o[0]=o[0]-l;o[1]=o[1]-c;o[2]=o[2]+l;o[3]=o[3]+c}if(this.options.maxExtent){o[0]=Math.max(o[0],this.options.maxExtent[0]);o[1]=Math.max(o[1],this.options.maxExtent[1]);o[2]=Math.min(o[2],this.options.maxExtent[2]);o[3]=Math.min(o[3],this.options.maxExtent[3])}this.wrap.setExtent(o,r);this.trigger(TC.Consts.event.ZOOMTO,{extent:o})}};d.zoomToMarkers=function(e){var t=this;Promise.all(t._markerPromises).then(function(){for(var o=[],r=0;r<t.workLayers.length;r++){var n=t.workLayers[r];if(n.type===TC.Consts.layerType.VECTOR)for(var i=0;i<n.features.length;i++){var a=n.features[i];a instanceof TC.feature.Marker&&(o[o.length]=a)}}t.zoomToFeatures(o,e);t._markerPromises=[]})};d.getLayer=function(e){var t=null;if("string"==typeof e){for(var o=0;o<this.layers.length;o++)if(this.layers[o].id===e){t=this.layers[o];break}}else TC.Layer&&e instanceof TC.Layer&&(t=e);return t};var f=function(e){var t;if(e.vectors)t=Promise.resolve(e.vectors);else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;t.then(function(t){e.vectors=t})}return t};d.addPoint=function(e,t){if(t&&t.layer){var o=this.getLayer(t.layer);o&&o.addPoint(e,t)}else f(this).then(function(o){o.addPoint(e,t)})};d.addMarker=function(e,t){var o=this;if(t&&t.layer){var r=o.getLayer(t.layer);r&&o._markerPromises.push(r.addMarker(e,t))}else o._markerPromises.push(new Promise(function(r,n){f(o).then(function(o){o.addMarker(e,t).then(function(e){r(e)})})}))};d.addPolyline=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolyline(e,t)}else f(this).then(function(o){o.addPolyline(e,t)})};d.addPolygon=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolygon(e,t)}else f(this).then(function(o){o.addPolygon(e,t)})};d.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};d.getResolutions=function(){return this.wrap.getResolutions()};d.getResolution=function(){return this.wrap.getResolution()};d.setResolution=function(e){this.wrap.setResolution(e)};d.exportFeatures=function(e,t){t=t||{};var o=this.getLoadingIndicator(),r=o&&o.addWait();const n=t.format===TC.Consts.format.GPX?Number.NaN:0;e.forEach(function(t,o){var r=t.getCoords({pointArray:!0});if(r.some(function(e){return null===e[2]})){e[o]=t=t.clone();(r=t.getCoords({pointArray:!0})).forEach(function(e){null===e[2]&&(e[2]=n)})}});const i=this.wrap.exportFeatures(e,t),a=TC.Consts.mimeType[t.format],s=t.format||"";TC.Util.downloadFile((t.fileName||TC.getUID())+"."+s.toLowerCase(),a,i);o&&o.removeWait(r)};var g={},m=function(){const e=this;var t=e;do{t=t.parentElement}while(t&&!t.matches(".tc-toast-container"));const o=e.innerHTML;e.classList.add(TC.Consts.classes.HIDDEN);void 0!==g[o]&&(g[o]=void 0);setTimeout(function(){e.parentElement&&e.parentElement.removeChild(e);t&&!t.querySelector(".tc-toast")&&t.parentElement&&t.parentElement.removeChild(t)},1e3)};d.toastHide=function(e){var t=g[e];if(t){clearTimeout(t.timeout);t.toast&&t.toast.parentElement&&t.toast.parentElement.removeChild(t.toast);t.toast=null}};d.toast=function(e,t){const o=this;var r=t||{},n=r.duration||TC.Cfg.toastDuration,i=g[e];if(i){clearTimeout(i.timeout);i.toast&&i.toast.parentElement&&i.toast.parentElement.removeChild(i.toast);i.toast=null}var a=o.div.querySelector(".tc-toast-container");if(!a){(a=document.createElement("div")).classList.add("tc-toast-container");(r.container?r.container:o.div).appendChild(a)}const s=document.createElement("div"),l=document.createElement("span");s.classList.add("tc-toast");s.appendChild(l);const c=document.createElement("p");c.innerHTML=e;s.appendChild(c);s.addEventListener(TC.Consts.event.CLICK,m);a.appendChild(s);i=g[e]={toast:s};var u="";switch(r.type){case TC.Consts.msgType.INFO:u=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:u=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:u=TC.Consts.classes.ERROR}u.length&&i.toast.classList.add(u);i.timeout=setTimeout(function(){m.call(i.toast)},n)};var y=!1,C=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.getBoundingClientRect.height===t+(Modernizr.mq("only screen and (orientation : landscape)")?20:0)&&(y=!0)}var o=function(){Modernizr.mq("only screen and (orientation : landscape)")?e.classList.add(TC.Consts.classes.IPAD_IOS7_FIX):e.classList.remove(TC.Consts.classes.IPAD_IOS7_FIX)};if(y){o();window.addEventListener("resize",o)}else window.removeEventListener("resize",o)},v=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS};d.exportImage=function(){var e=null,t="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",o=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(o&&this.options.crossOrigin)try{e=o.toDataURL()}catch(e){TC.error(t+": "+e.message)}else TC.error(t);return e}}();var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,o){return codes[e]}).filter(function(e,t,o){return 0===t?e!==codes[f]:e!==o[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,o){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var r=e.apply(this,arguments);r=r.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1"));return r};var t={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(e,t,o){return o<t.length-1?e.hasOwnProperty(t[o])?l(e[t[o]],t,++o):null:e[t[o]]};const c=new WeakMap,u=new WeakMap;var h={isPlainObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],o=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[o])return e}else for(var r in TC.capabilities)if(r.replace(TC.Util.regex.PROTOCOL,"")==o)return r;for(r in TC.capabilities){var n=l(TC.capabilities[r],a,0)||l(TC.capabilities[r],s,0);if(n&&t&&e==n)return n;if(n&&e.replace(TC.Util.regex.PROTOCOL,"")==n.replace(TC.Util.regex.PROTOCOL,""))return n}return e},reqGetMapOnCapabilities:function(e){var t,o,r=2!=arguments.length||arguments[1];r||e.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(o=l(t,a,0)||l(t,s,0))?r?o.split("?")[0]:o.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(e){var t=window,o=e.split(".");for(i=0;i<o.length-1;i++)if(void 0==(t=t[o[i]]))return;return t[o[o.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),o=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(o){var r=window.location,n=o[1];t=(n==r.protocol||void 0==n)&&o[3]==r.hostname;var i=o[4],a=r.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(t=t&&i==a)}return t},formatNumber:function(e,t){var o=typeof e;if("number"===o)return e.toLocaleString(t);if("string"===o){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var o=document.getElementsByTagName("script");t=o[o.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var o="";if(e)if(void 0!==t[e])o=t[e];else{const n=document.createElement("div");n.style.display="none";n.classList.add(e);document.body.appendChild(n);var r=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(n,null).backgroundImage);r&&r.length>1&&(o=r[r.length-1]);n.parentElement.removeChild(n);t[e]=o}return o},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url;else{var n;if("string"==typeof t.cssClass)n=t.cssClass;else{var i=t.classes||TC.Cfg.styles.marker.classes;n=i[0];if(t.group){if(void 0===o[t.group]){var a=0;for(var s in o)a++;a%=i.length;o[t.group]=i[a]}n=o[t.group]}}r=TC.Util.getBackgroundUrlFromCss(n)}r||t===TC.Cfg.styles.point||""===t.cssClass||(r=e(TC.Cfg.styles.point));return r},addArrayToTree:function e(t,o,r){var n=null,i=!1,a=t[r=r||0];if(a){for(var s,l=0,c=o.children.length;l<c;l++)if((s=o.children[l]).name===a){i=!0;var u=e(t,s,r+1);u&&(n=u);break}if(!i){s={name:a,title:a,uid:"/"+t.slice(0,r+1).join("/"),children:[]};o.children.push(s);n=s}}return n},parseCoords:function(e){var t=null,o=function(e){var t=e,o={};o.type=TC.Consts.GEOGRAPHIC;var r=t.indexOf("\xb0");o.value=parseFloat(t.substr(0,r));if((r=(t=t.substr(r+1)).indexOf("'"))>=0){var n=parseFloat(t.substr(0,r))/60;o.value>=0?o.value+=n:o.value-=n;if((r=(t=t.substr(r+1)).indexOf("'"))>=0){n=parseFloat(t.substr(0,r).replace(",","."))/3600;o.value>=0?o.value+=n:o.value-=n}}return o},r=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return o(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return o(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var r={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(r.value=-r.value);return r}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},n=(e=$.trim(e).toUpperCase()).split(",");4===n.length?n=[n.slice(0,1).join("."),n.slice(2,3).join(".")]:1!==n.length&&3!==n.length||(n=e.split(" "));if(2===n.length){var i=r(n[0]),a=r(n[1]);null!==i&&null!==a&&(t=[i,a])}return t},reproject:function(e,t,o){var r,n=!0,i=!0,a=!0;if($.isArray(e[0]))if($.isArray(e[0][0])){if(!$.isArray(e[0][0][0])){a=!1;e=[e]}}else{i=!1;e=[[e]]}else{n=!1;i=!1;a=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:o,sync:!0});var s=new Proj4js.Proj(t),l=new Proj4js.Proj(o);r=new Array(e.length);e.forEach(function(e,t){const o=r[t]=[];e.forEach(function(e,t){const r=o[t]=[];e.forEach(function(e,t){var o=Proj4js.transform(s,l,{x:e[0],y:e[1]});r[t]=[o.x,o.y];e.length>2&&(r[t][2]=e[2])})})});n?i?a||(r=r[0]):r=r[0][0]:r=r[0][0][0];return r},getMetersPerDegree:function(e){var t=void 0;if($.isArray(e)&&e.length>=4){var o=this.degToRad(e[3]-e[1]),r=Math.sin(o/2),n=r*r;t=6370997*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var o=e.trim().match(/^.+[:#](\d{4,6})$/);o&&(t=o[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var o=this.getCRSCode(e),r=this.getCRSCode(t);return null!==o&&null!==r&&o===r},getLocaleString:function(e,t,o){var r=t;if(TC.i18n&&TC.i18n[e]){var n=TC.i18n[e][t];if(n){r=n;if(o)for(var i in o)r=r.replace("{"+i+"}",o[i])}}return r},getSimpleMimeType:function(e){var t="";if(e){var o=e.indexOf(";");o>0&&(e=e.substring(0,o));t=e}return t},getQueryStringParams:function(e){var t;if(e){var o=e.indexOf("?");if(o>=0){var r=(t=e.substr(o)).indexOf("#");r>=0&&(t=t.substr(0,r))}else t="?"}else t=location.search;var n=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete n[""];return n},getParamString:function(e){const t=[];for(var o in e)t[t.length]=encodeURIComponent(o)+"="+encodeURIComponent(e[o]);return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var o=e.length;o;){e[o]=e[o-1];o--}e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,o){return $.cookie(e,t,o)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var o=new Date;o.setDate(o.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:o})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var o=new Date;o.setDate(o.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:o})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){return!!function(){var e,t="(hover: hover)",o=!Modernizr.touch;"matchMedia"in window?(e=window.matchMedia(t)).media===t&&(o=e.matches):console.log("no dispone de matchMedia");return o}()}return!(Modernizr.mq("(pointer:coarse)")||!Modernizr.mq("(pointer:fine)"))||!Modernizr.mq("(pointer:none)")&&(!Modernizr.touch||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var o=t.indexOf(":"),r=t.substr(o+1),n=e.getElementsByTagNameNS("*",r),i=0;i<n.length;i++)if(n[i].nodeName==t)return n},addURLParameters:function(e,t){if(!t)return e;var o=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),r=e.split("?");if(r.length>=2){var n=r[1].split(/[&;]/g);n.push(o);return e=r[0]+"?"+n.join("&")}if((r=e.split("#")).length>=2){r.shift();return e=r[0]+"?"+o+"#"+r.join("#")}return e=e+"?"+o},removeURLParameter:function(e,t){var o=e.split("?");if(o.length>=2){for(var r=encodeURIComponent(t.toLowerCase())+"=",n=o[1].toLowerCase().split(/[&;]/g),i=n.length;i-- >0;)-1!==n[i].lastIndexOf(r,0)&&n.splice(i,1);return e=o[0]+"?"+n.join("&")}return e},showModal:function(e,t){t=t||{};e.hidden=!1;$(e).fadeIn(250,function(){window.$&&e instanceof $&&(e=e.get(0));const o=e.querySelectorAll(".tc-modal-close");if(o&&o.length>0)for(var r=0;r<o.length;r++){var n=u.get(o[r]);if(n)u.delete(o[r]);else{n=function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,e.target)};u.set(o[r],n)}u.set(o[r],n);o[r].addEventListener("click",n);$.isFunction(t.openCallback)&&t.openCallback()}})},closeModal:function(e,t){const o=function(e){e.style.display="none";e.querySelector(".tc-modal-window").removeAttribute("style")};var r;if(t){r=t;for(;r&&!r.matches(".tc-modal");)r=r.parentElement;o(r)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(e){o(e)});e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t){const o=function(t){e.addEventListener("mousedown",t.start);e.addEventListener("touchstart",t.start);e.addEventListener("mouseup",t.end);e.addEventListener("touchend",t.end)};if("disable"===t){const t=c.get(e);if(t){e.removeEventListener("mousedown",t.start);e.removeEventListener("touchstart",t.start);e.removeEventListener("mouseup",t.end);e.removeEventListener("touchend",t.end)}return}if("enable"===t){const t=c.get(e);t&&o(t);return}const r=(t=t||{}).minDistance||30,n=t.maxCrossDistance||30,i=t.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const u={start:function(o){if(function(o){if(t.noSwipe)for(var r=o.target;r&&r!==e;){if(r.matches&&r.matches(t.noSwipe))return!1;r=r.parentNode}return!0}(o)){o="changedTouches"in o?o.changedTouches[0]:o;a.x=o.pageX;a.y=o.pageY;l=(new Date).getTime()}},end:function(o){if(l){o="changedTouches"in o?o.changedTouches[0]:o;s.x=o.pageX;s.y=o.pageY;if((new Date).getTime()-l<=i){const o=t[function(e,t){const o=t.x-e.x,i=t.y-e.y,a=Math.abs(o),s=Math.abs(i);return a>s&&a>r&&s<=n?o<0?"left":"right":s>a&&s>r&&a<=n?i<0?"up":"down":"none"}(a,s)];o&&o.call(e)}l=0}}};c.set(e,u);o(u)},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en-US",o=(e=e||{}).cookieName||"SITNA.language",r=e.paramName||"lang",n=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,i=TC.Util.getParameterByName(r)||TC.Util.storage.getCookie(o)||n,a=i.indexOf("-");a>=0&&(i=i.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(o,i,{expires:s});switch(i){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[/\\?%*:|"<>]/g,"-")},downloadBlob:function(e,t){var o=document.createElement("a");if(void 0!==o.download){var r=URL.createObjectURL(t);o.setAttribute("href",r);o.setAttribute("download",TC.Util.getValidFilename(e));o.style.visibility="hidden";document.body.appendChild(o);o.click();document.body.removeChild(o)}},downloadFile:function(e,t,o){var r=new Blob([o],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(r,e):TC.Util.downloadBlob(e,r)},downloadDataURI:function(e,t,o){for(var r=atob(o.split(",")[1]),n=[],i=0;i<r.length;i++)n.push(r.charCodeAt(i));var a=new Blob([new Uint8Array(n)],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(a,e):TC.Util.downloadBlob(e,a)},shortenUrl:function(e){return TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}})},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){$.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const o=t.toString(16);return e+"00".substring(0,2-o.length)+o},"#"));return e},operation:function(e,t,o,r){for(var n=[],i=0;i<e.length;i++){for(var a=e[i],s=!1,l=0;l<t.length;l++)if(o(a,t[l])){s=!0;break}s===r&&n.push(a)}return n},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,o){return this.operation(e,t,o,!0)},inFirstOnly:function(e,t,o){return this.operation(e,t,o,!1)},inSecondOnly:function(e,t,o){return this.inFirstOnly(t,e,o)},toDataUrl:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},r=o.type,n=o.encoderOptions,i=e.getContext("2d");if(!i)return"";var a=e.width,s=e.height,l=i.getImageData(0,0,a,s),c=i.globalCompositeOperation;if(t){i.globalCompositeOperation="destination-over";i.fillStyle=t;i.fillRect(0,0,a,s)}var u=e.toDataURL(r,n);if(t){i.clearRect(0,0,a,s);i.putImageData(l,0,0);i.globalCompositeOperation=c}return u},imgToDataUrl:function(e,t){var o=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t};return new Promise(function(r,n){var i=new Image;i.crossOrigin="anonymous";i.onload=function(){var n,a=o(i);try{n=TC.Util.toDataUrl(a,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:n,canvas:a})}catch(t){i.src=TC.proxify(e)}};i.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(e),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(e){if(200===this.status){for(var n=new Uint8Array(this.response),a=n.length,l=new Array(a);a--;)l[a]=String.fromCharCode(n[a]);var c=l.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){i.src="data:"+u+";base64,"+window.btoa(c);i.onload=function(){var e=o(i);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r({dataUrl:dataURL,canvas:e})}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&n()};s.send()};i.src=e;if(i.complete||void 0===i.complete){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.src=e}})},imgTagToDataUrl:function(e,t){var o=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(o,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:o}}catch(e){return null}},addToCanvas:function(e,t,o,r){var n=TC.Util.cloneCanvas(e),i=n.getContext("2d");return new Promise(function(e,a){var s=new Image;t.crossOrigin="anonymous";s.src=t;s.onload=function(){r?i.drawImage(s,o.x||0,o.y||0,r.width,r.height):i.drawImage(s,o.x||0,o.y||0);e(n)}})},cloneCanvas:function(e){var t=document.createElement("canvas"),o=t.getContext("2d");t.width=e.width;t.height=e.height;o.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,o,r){var n=Math.min(o/e,r/t);return{width:e*n,height:t*n}},getFormattedDate:function(e,t){function o(e){return e<10?"0"+e:e}var r=new Date(e);return[r.getFullYear(),o(r.getMonth()+1),o(r.getDate())].concat(t?["_",o(r.getHours()),o(r.getMinutes()),o(r.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var o=function(e,t){const o=document.createDocumentFragment();var r=document.createElement("form");r.classList.add("tc-ctl-download-form");r.setAttribute("method","post");r.setAttribute("enctype","text/plain");r.setAttribute("action",!1!==TC.Util.detectIE()&&TC.Util.detectIE()<=11?TC.proxify(e):e);const n=document.createElement("input");n.classList.add("tc-ctl-download-query");n.setAttribute("name",t.substring(0,t.indexOf("=")));r.appendChild(n);o.appendChild(r);const i=document.querySelectorAll("iframe");for(var a,s=0,l=i.length;s<l;s++){const t=i[s];if(t.dataset.downloadUrl===e){a=t;break}}if(!a){(a=document.createElement("iframe")).style.visibility="hidden";a.style.display="none";a.dataset.downloadUrl=e;document.body.appendChild(a)}const c=a.contentDocument;c.open();c.write(r.outerHTML);c.close();c.querySelector("input").value=t.substring(t.indexOf("=")+1);return r=c.querySelector("form")},r=[];if($.isArray(e))for(var n=e,i=0;i<n.length;i++)r.push(o(n[i].url,n[i].data));else r.push(o(e,t));r.forEach(function(e){e.submit()});setTimeout(function(){document.querySelectorAll(".tc-ctl-download-form").forEach(function(e){e.parentElement.removeChild(e)})},1e3)},WFSQueryBuilder:function(e,t,o,r,n){$.isArray(e)||(e=[e]);var i='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(o.version){case"1.0.0":case"1.1.0":i+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":i+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var a in o)"string"==typeof o[a]&&a.indexOf("gml")<0&&o[a].indexOf("wfs")<0&&(i+=a+'="'+o[a]+'" ');var s="<wfs:GetFeature "+i.format({resultType:n?'resultType="hits"':"",format:'outputFormat="'+r+'"'})+">",l="",c="<wfs:Query typeName"+("2.0.0"===o.version?"s":"")+'="{typeName}">{filter}</wfs:Query>';$.each(e,function(e,r){l+=c.format({typeName:r,filter:t?t.getText(o.version):""})});return s+=l+"</wfs:GetFeature>"},WFSFilterBuilder:function(e,t){var o="";if(jQuery.isPlainObject(e))o='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case $.isArray(e):var r="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:o+="<ogc:Filter><ogc:BBOX>"+r+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:o+="<fes:Filter><fes:BBOX>"+r+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:o+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,"2.0")+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:o+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,"3.2")+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return o},writeGMLGeometry:function(e,t){var o=function(e){var o;if(0===t.indexOf("3")){o=e.toString();for(;o.indexOf(",")>=0;)o=o.replace(","," ")}else{o=e;jQuery.each(o,function(e,t){return t.join(",")}).join(" ")}return o};switch(t){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"><gml:posList>'+o(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"><gml:exterior><gml:LinearRing><gml:posList>'+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var o=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!o&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=r[1];o=(n==t.protocol||void 0==n)&&r[3]==t.hostname;var i=r[4],a=t.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(o=o&&i==a)}return o},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var o=/^(https?:\/\/)/i,r=e.match(o);if(r&&r.length>1){var n=t.match(o);if(n&&n.length>1)return r[0].trim()===n[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,o){return t[e]>o[e]?1:t[e]<o[e]?-1:0}},getSoundexDifference:function(e,t){for(var o=0,r=0;r<e.length;r++)e.charAt(r)==t.charAt(r)&&o++;return o},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href},getRenderedHtml:function(e,t,o,r){return new Promise(function(n,i){var a=function(){dust.cache[e]&&dust.render(e,o,function(e,t){if(e){TC.error(e);i(Error(e))}else{$.isFunction(r)&&r(t);n(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])a();else if("string"==typeof t)TC.ajax({url:t,method:"GET",responseType:"text"}).then(function(t){var o=dust.compile(t,e);dust.loadSource(o);a()}).catch(function(e){console.log("Error fetching template: "+e)});else if($.isFunction(t)){t();a()}})})},explodeGeometry:function(e){const t=e.origin,o=function(e,r,n){if($.isArray(e))e.forEach(o);else{0===r&&(n[0]=e+t[0]);1===r&&(n[1]=e+t[1])}};e.geom.forEach(o);return e.geom},cloneMappingFunction:function(e){return $.isArray(e)?e.map(TC.Util.cloneMappingFunction):e},compactGeometry:function(e,t){const o=[Number.MAX_VALUE,Number.MAX_VALUE],r=e.map(TC.Util.cloneMappingFunction),n=function(e,t){$.isArray(e)?e.forEach(n):0===t&&e<o[0]?o[0]=e:1===t&&e<o[1]&&(o[1]=e)};r.forEach(n);const i=function(e){return Math.round(e*t)/t};o[0]=i(o[0]);o[1]=i(o[1]);const a=function(e,t,r){if($.isArray(e))e.forEach(a);else{0===t&&(r[0]=i(e-o[0]));1===t&&(r[1]=i(e-o[1]))}};r.forEach(a);return{origin:o,geom:r}}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};var d=function(e,t,o){return o(e.getBoundingClientRect(),t.getBoundingClientRect())};HTMLElement.prototype.colliding=function(e){return d(this,e,function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)})};HTMLElement.prototype.containing=function(e){d(this,e,function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)})};HTMLElement.prototype.inside=function(e){return d(this,e,function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right})};return h});loadjs=function(){var e=function(){},t={},o={},r={};function n(e,t){if(e){var n=r[e];if(o[e]=t,n)for(;n.length;)n[0](e,t),n.splice(0,1)}}function i(t,o){t.call&&(t={success:t}),o.length?(t.error||e)(o):(t.success||e)(t)}function a(t,o,r,n){var i,s,l=document,c=r.async,u=(r.numRetries||0)+1,h=r.before||e,d=t.replace(/^(css|img)!/,"");n=n||0,/(^css!|\.css$)/.test(t)?(i=!0,(s=l.createElement("link")).rel="stylesheet",s.href=d):/(^img!|\.(png|gif|jpg|svg)$)/.test(t)?(s=l.createElement("img")).src=d:((s=l.createElement("script")).src=t,s.async=void 0===c||c),!(s.onload=s.onerror=s.onbeforeload=function(e){var l=e.type[0];if(i&&"hideFocus"in s)try{s.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l&&(n+=1)<u)return a(t,o,r,n);o(t,l,e.defaultPrevented)})!==h(t,s)&&l.head.appendChild(s)}function s(e,o,r){var s,l;if(o&&o.trim&&(s=o),l=(s?r:o)||{},s){if(s in t)throw"LoadJS";t[s]=!0}!function(e,t,o){var r,n,i=(e=e.push?e:[e]).length,s=i,l=[];for(r=function(e,o,r){if("e"==o&&l.push(e),"b"==o){if(!r)return;l.push(e)}--i||t(l)},n=0;n<s;n++)a(e[n],r,o)}(e,function(e){i(l,e),n(s,e)},l)}return s.ready=function(e,t){return function(e,t){var n,i,a,s=[],l=(e=e.push?e:[e]).length,c=l;for(n=function(e,o){o.length&&s.push(e),--c||t(s)};l--;)i=e[l],(a=o[i])?n(i,a):(r[i]=r[i]||[]).push(n)}(e,function(e){i(t,e)}),s},s.done=function(e){n(e,[])},s.reset=function(){t={},o={},r={}},s.isDefined=function(e){return e in t},s}();var TC=TC||{};TC.version="1.6.0";!function(){if(!TC.apiLocation){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var o=e.getAttribute("src");TC.apiLocation=o.substr(0,o.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS_LEGACY="OpenLayers";TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ_LEGACY="Proj4js";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,MODERNIZR:"lib/modernizr.js",JQUERY_LEGACY:TC.apiLocation+"lib/jquery/jquery.1.10.2.js",JQUERY:"//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.js",OL_LEGACY:"lib/OpenLayers/OpenLayers.sitna.js",OL:"lib/ol/build/ol-custom.js",OL_CONNECTOR_LEGACY:"TC/ol/ol2.js",OL_CONNECTOR:"TC/ol/ol.js",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",PROJ4JS_LEGACY:"lib/proj4js/legacy/proj4js-compressed.js",PROJ4JS:"lib/proj4js/proj4-src.js",EPSG:"https://epsg.io/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js",UA_PARSER:"lib/ua-parser/ua-parser.min.js",HASH:"lib/jshash/md5-min.js",URL_POLYFILL:"lib/polyfill/url.js",PROMISE_POLYFILL:"lib/polyfill/promise/polyfill.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-threed"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_FR_CARTO:"ign-fr-cartes",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNCARTO:"ign-fr-cartes-dyn",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"};TC.Consts.logicalOperator={AND:"and",OR:"or"};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.WFSErrors={GetFeatureNotAvailable:"GetFeatureNotAvailable",LayersNotAvailable:"LayersNotAvailable",NoLayers:"NoLayers",NoValidLayers:"noValidLayers",QueryNotAvailable:"QueryNotAvailable",CapabilitiesParseError:"CapabilitiesParseError",NumMaxFeatures:"NumMaxFeatures",GetCapabilities:"GetCapabilities",Indeterminate:"Indeterminate",NoFeatures:"NoFeatures"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.view={DEFAULT:0,THREED:1,PRINTING:2};TC.Consts.units={DEGREES:"degrees",METERS:"m"};TC.Consts.MARKER="marker";TC.Defaults=function(){var e={};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,layoutURLParamName:"layout",titleURLParamName:"title",locale:"es-ES",view:TC.Consts.view.DEFAULT,screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:TC.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto m\xe1xima actualidad",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"mapaTopografico",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:TC.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2018.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2017.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IGN_ES_CARTO,type:TC.Consts.layerType.WMTS,title:"Cartograf\xeda raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_grey_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/mdt",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_grey_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:TC.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mdt",layerNames:"relieve",thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_FR_CARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNCARTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNCARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"HR.ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.OSM,title:"OSM",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:TC.Consts.layer.OSM},{id:TC.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_DARK,title:"CARTO dark",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!0,featureInfo:!0,featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(t){var o=t.features.length,r=e[o];if(!r){r=2+Math.round(5*Math.sqrt(o));e[o]=r}return r},label:"${features.length}",fontColor:"#fff",fontSize:9}},selection:{point:{fillColor:"#0000ff",fillOpacity:.5,strokeColor:"#0000ff",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},line:{strokeColor:"#0000ff",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#0000ff",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),o=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=new Array(o),n=arguments.length>=2?arguments[1]:void 0,i=0;i<o;i++)i in t&&(r[i]=e.call(n,t[i],i,t));return r});TC.proxify=function(e){var t=e=$.trim(e);if(TC.Cfg.proxy){var o=!1;if(TC.Cfg.proxyExceptions)for(var r=0;r<TC.Cfg.proxyExceptions.length;r++)if(e.indexOf(TC.Cfg.proxyExceptions[r])>-1){o=!0;break}if(!o&&!TC.Util.isSameOrigin(e))if("function"==typeof TC.Cfg.proxy)t=TC.Cfg.proxy(e);else{t=TC.Cfg.proxy;"http"!=e.substr(0,4)&&(t+=window.location.protocol);t+=encodeURIComponent(e)}}return t};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);var e=function(e){var t=$("."+TC.Consts.classes.MAP).data("map");TC.error(TC.Util.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+e)};TC.syncLoadJS=function(t){var o=function(e,t){var o,r=new XMLHttpRequest;r.open("GET",e,!1);r.onreadystatechange=function(e){if(4===r.readyState)if(404===r.status){o=!1;t(!0)}else if(200!==r.status){t();o=!1}else o=r.responseText};try{r.send(null)}catch(e){o=!1;t()}return o};/(\.js|\/)$/i.test(t)||(t+=TC.isDebug?".js":".min.js");var r=o(t,function(r){if(r){e(t);return!1}return o(t,function(){e(t)})});if(r){var n=document.createElement("script");n.type="text/javascript";n.text=r;(function(){var e,t=document,o=t.getElementsByTagName("head");if(0===o.length){e=t.createElement("head");t.documentElement.insertBefore(e,document.body)}else e=o[0];return e})().appendChild(n)}};window.Modernizr||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.MODERNIZR);Modernizr.touch=Modernizr.touchevents;TC.isLegacy=!1;window.jQuery||(Modernizr.canvas&&!TC.isLegacy?TC.syncLoadJS(TC.Consts.url.JQUERY):TC.syncLoadJS(TC.Consts.url.JQUERY_LEGACY));"Promise"in window||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.PROMISE_POLYFILL);window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);"finally"in Promise.prototype||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then(function(o){return t.resolve(e()).then(function(){return value})},function(o){return t.resolve(e()).then(function(){return t.reject(o)})})});if("$"in window){$._oldWhen=$.when;$.when=function(){const e=new Array(arguments.length);for(var t=0;t<arguments.length;t++){const o=e[t]=arguments[t];if(o instanceof Promise){const r=$.Deferred();o.then(function(e){r.resolve(e)}).catch(function(e){r.reject(e)});e[t]=r}}return $._oldWhen.apply(this,e)}}TC.ajax=function(e){return new Promise(function(t,o){const r=(e=e||{}).method||"GET";var n;if(e.data)if("string"==typeof e.data)n=e.data;else if("object"==typeof e.data){const t=[];for(var i in e.data)t[t.length]=i+"="+e.data[i].toString();n=t.join("&")}var a=e.url;"GET"===r&&(a=a+"?"+n);const s=new XMLHttpRequest;s.open(r,e.url);e.contentType||"boolean"==typeof e.contentType?e.contentType&&s.setRequestHeader("Content-Type",e.contentType+"; charset=UTF-8"):s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");s.onreadystatechange=function(r){if(4===s.readyState)if(200!==s.status)o({status:s.status,msg:s.statusText,url:e.url});else{var n;try{switch(e.responseType){case TC.Consts.mimeType.JSON:n=JSON.parse(s.responseText);break;case TC.Consts.mimeType.XML:n=(new DOMParser).parseFromString(s.responseText,"application/xml");break;default:n=s.responseText}t(n)}catch(e){o(e)}}};try{s.send("POST"===r?n:null)}catch(e){o(Error(e))}})};document.addEventListener("DOMContentLoaded",function(){var e,t="Unknown library",o="OpenLayers 2",r="OpenLayers 4";if(TC.Control){e="Compiled";TC.isLegacy?window.OpenLayers&&(t=o):window.ol&&(t=r)}else{e="On demand";t=TC.isLegacy?o:r}TC.version=TC.version+" ("+e+"; "+t+"; @ "+TC.apiLocation+")"});TC.loadJSInOrder=function(e,t,o){TC.loadJS(e,t,o,!0)};const t=function(e,t){TC.Util.isSameOrigin(e)||(t.crossOrigin="anonymous")};TC.loadJS=function(o,r,n,i,a){arguments.length<4&&(i=!1);var s=$.isArray(r)?r:[r];s=s.map(function(e){return/\.js$/i.test(e)||0!==e.indexOf(TC.apiLocation)?e:e+(TC.isDebug?".js":".min.js")});if(Modernizr.canvas)if(o){var l="";const o=function(e){return e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if((s=s instanceof Array?s:[s]).length>1){var c=s.slice(0).filter(function(e,t){if(loadjs.isDefined(o(e))){s.splice(t,1);loadjs.ready(o(e),n);return!1}return!0});1===c.length?l=o(c[0]):c.length>0&&(l=c.reduce(function(e,t){return o(e)+"_"+o(t)}))}else l=o(s[0]);if(l.length>0)if(loadjs.isDefined(l))loadjs.ready(l,n);else{var u={async:!i,numRetries:1};a||TC.Util.detectIE()||(u.before=t);loadjs(s,l,u);loadjs.ready(l,{success:function(){n()},error:function(t){e(t)}})}}else n();else{if(o)for(var h=0;h<s.length;h++)TC.syncLoadJS(s[h]);n&&n()}};TC.loadCSS=function(t){const o=t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();loadjs.isDefined(o)?loadjs.ready(o):loadjs(t,o,{error:function(t){e(t)},numRetries:1})};var o={};TC.getProjectionData=function(e){return new Promise(function(t,r){var n=(e=e||{}).crs.substr(e.crs.indexOf(":")+1);parseInt(n)===Number.NaN&&(n=e.crs.substr(e.crs.lastIndexOf("/")+1));var i=o[n];if(i)t(i);else{var a=TC.Consts.url.EPSG+"?format=json&q="+n;new TC.tool.Proxification(TC.proxify).fetchJSON(a,e).then(function(e){o[n]=e;t(e)}).catch(function(e){r(Error(e))})}})};TC.loadProjDef=function(e){const t=(e=e||{}).crs;var o;if(TC.isLegacy){window[TC.Consts.PROJ4JSOBJ_LEGACY]||TC.syncLoadJS(TC.url.proj4js);o=function(e){return Proj4js.defs[e]}}else{window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);o=function(e){return proj4.defs(e)}}window.Proj4js||(window.Proj4js={Proj:function(e){return proj4(Proj4js.defs[e])},defs:proj4.defs,transform:proj4});const r=function(e,t){Proj4js.defs[e]=t;TC.isLegacy||proj4.defs(e,t)},n=function(e,n,i){const a="EPSG:"+e,s="urn:ogc:def:crs:EPSG::"+e,l="http://www.opengis.net/gml/srs/epsg.xml#"+e;var c;if("object"==typeof n){c=$.extend({},n);n=$.extend({},n);c.axis&&delete c.axis}else"string"==typeof n&&(c=n.replace("+axis=neu",""));r(a,n);r(s,n);r(l,c);if(0===t.indexOf("http")){r(t,c);o(t).name=i}o(a).name=i;o(l).name=i};var i=t.lastIndexOf("#");i<0&&(i=t.lastIndexOf("/"));i<0&&(i=t.lastIndexOf(":"));var a=t.substr(i+1),s=o(t);if(s){n(a,s,e.name);$.isFunction(e.callback)&&e.callback()}else if(e.def){n(a,e.def,e.name);$.isFunction(e.callback)&&e.callback()}else TC.getProjectionData(e).then(function(t){(function(e){var t="ok"===e.status&&1===e.number_result;if(t){var o=e.results[0];n(o.code,o.proj4,o.name)}return t})(t)&&$.isFunction(e.callback)&&e.callback()})};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES]};if(TC.isLegacy){TC.url.ol=TC.apiLocation+TC.Consts.url.OL_LEGACY;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR_LEGACY;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS_LEGACY}else{TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS}TC.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"});TC.Cfg=$.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.alert=function(e){alert(e)};TC.prompt=function(e,t,o){var r=prompt(e,t);$.isFunction(o)&&o(r)};TC.confirm=function(e,t,o){confirm(e)?$.isFunction(t)&&t():$.isFunction(o)&&o()};TC.error=function(e){window.console&&console.error(e)};TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");TC.wrap={Map:function(e){var t=this;t.parent=e;t.map=null;t.getMap=function(){return t._promise}},Layer:function(e){var t=this;t.parent=e;t.layer=null;TC.EventTarget.call(t);t.getLayer=function(){return t.layer?Promise.resolve(t.layer):t._promise};t.setLayer=function(e){t.layer=e}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(e){this.parent=e},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},NavBarHome:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},Modify:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)},ResultsPanel:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};TC.inherit(TC.wrap.Layer,TC.EventTarget);TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBarHome,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.inherit(TC.wrap.control.ResultsPanel,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.loadJS(!Modernizr.urlparser,TC.apiLocation+TC.Consts.url.URL_POLYFILL,function(){});var r={};TC.getUID=function(e){var t=r[e=e||""];t||(t=r[e]=1);var o=e+t;r[e]=t+1;return o}}();!function(e,t){var o=/\+/g;function r(e){return e}function n(e){return decodeURIComponent(e.replace(o," "))}e.cookie=function(o,i,a){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null===i)){a=e.extend({},e.cookie.defaults,a);null===i&&(a.expires=-1);if("number"==typeof a.expires){var s=a.expires,l=a.expires=new Date;l.setDate(l.getDate()+s)}i=String(i);return t.cookie=[encodeURIComponent(o),"=",a.raw?i:encodeURIComponent(i),a.expires?";expires="+a.expires.toUTCString():"",a.path?";path="+a.path:"",a.domain?";domain="+a.domain:"",a.secure?";secure":""].join("")}for(var c,u=(a=i||e.cookie.defaults||{}).raw?r:n,h=t.cookie.split("; "),d=0;c=h[d]&&h[d].split("=");d++)if(u(c.shift())===o)return u(c.join("="));return null};e.cookie.defaults={}}(jQuery,document)}document.addEventListener("DOMContentLoaded",function(){TC.browser=TC.Util.getBrowser();TC.loadJS(!TC.Cfg.acceptedBrowserVersions,TC.apiLocation+"TC/config/browser-versions.js",function(e){var t=!0,o=TC.Cfg.acceptedBrowserVersions.filter(function(e){return e.name.toLowerCase()===TC.browser.name.toLowerCase()});if(o.length>0&&o[0].expired)TC.Cfg.loggingErrorsEnabled=!1;else{o.length>0&&!isNaN(o[0].version)&&TC.browser.version<o[0].version&&(t=!1);if(TC.Cfg.oldBrowserAlert&&!t){TC.Cfg.loggingErrorsEnabled=!1;var r=$("."+TC.Consts.classes.MAP).data("map");TC.i18n.loadResources(!TC.i18n[r.options.locale],TC.apiLocation+"TC/resources/",r.options.locale).then(function(){TC.error(TC.Util.getLocaleString(r.options.locale,"outdatedBrowser"),TC.Consts.msgErrorMode.TOAST)})}}});/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;const e=(o=0,function(e){t=t||TC.Map.get(document.querySelector("."+TC.Consts.classes.MAP));var r,n,i,a="",s=-1,l=-1;if("unhandledrejection"===e.type){r=e.reason.message;i=!e.reason.stack||e.reason.stack.indexOf(TC.apiLocation)>0;n=e.reason}else{r=e.message;a=e.filename;s=e.lineno;l=e.colno;n=e.error;i=a.indexOf(TC.apiLocation)>0}if((TC.Cfg.notifyApplicationErrors||i)&&o<TC.Cfg.maxErrorCount&&TC.Cfg.loggingErrorsEnabled){var c=i?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:r,url:a,lineNumber:s,column:l,appUrl:location.href,prevState:t.getPreviousMapState(),userAgent:navigator.userAgent},n);o++;TC.isDebug||TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale).then(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"genericError")+(t.options.contactEmail||"webmaster@itracasa.es"),{type:TC.Consts.msgType.ERROR})})}return!1});var t,o;window.addEventListener("error",e,!1);window.addEventListener("unhandledrejection",e,!1)});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}(function(){return function e(t,o,r){function n(a,s){if(!o[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return n(t[a][1][e]||e)},u,u.exports,e,t,o,r)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t,o){(function(e){"use strict";function o(){c=!0;for(var e,t,o=u.length;o;){for(t=u,u=[],e=-1;++e<o;)t[e]();o=u.length}c=!1}var r,n=e.MutationObserver||e.WebKitMutationObserver;if(n){var i=0,a=new n(o),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){o(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(o,0)};else{var l=new e.MessageChannel;l.port1.onmessage=o,r=function(){l.port2.postMessage(0)}}var c,u=[];t.exports=function(e){1!==u.push(e)||c||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";function r(){}function n(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,e!==r&&l(this,e)}function i(e,t,o){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof o&&(this.onRejected=o,this.callRejected=this.otherCallRejected)}function a(e,t,o){u(function(){var r;try{r=t(o)}catch(t){return h.reject(e,t)}r===e?h.reject(e,new TypeError("Cannot resolve promise with itself")):h.resolve(e,r)})}function s(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function o(t){n||(n=!0,h.reject(e,t))}function r(t){n||(n=!0,h.resolve(e,t))}var n=!1,i=c(function(){t(r,o)});"error"===i.status&&o(i.value)}function c(e,t){var o={};try{o.value=e(t),o.status="success"}catch(e){o.status="error",o.value=e}return o}var u=e(1),h={},d=["REJECTED"],p=["FULFILLED"],f=["PENDING"];t.exports=o=n,n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===p||"function"!=typeof t&&this.state===d)return this;var o=new this.constructor(r);this.state!==f?a(o,this.state===p?e:t,this.outcome):this.queue.push(new i(o,e,t));return o},i.prototype.callFulfilled=function(e){h.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){h.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},h.resolve=function(e,t){var o=c(s,t);if("error"===o.status)return h.reject(e,o.value);var r=o.value;if(r)l(e,r);else{e.state=p,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callFulfilled(t)}return e},h.reject=function(e,t){e.state=d,e.outcome=t;for(var o=-1,r=e.queue.length;++o<r;)e.queue[o].callRejected(t);return e},o.resolve=function(e){return e instanceof this?e:h.resolve(new this(r),e)},o.reject=function(e){var t=new this(r);return h.reject(t,e)},o.all=function(e){function t(e,t){o.resolve(e).then(function(e){a[t]=e,++s!==n||i||(i=!0,h.resolve(c,a))},function(e){i||(i=!0,h.reject(c,e))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,l=-1,c=new this(r);++l<n;)t(e[l],l);return c},o.race=function(e){function t(e){o.resolve(e).then(function(e){i||(i=!0,h.resolve(s,e))},function(e){i||(i=!0,h.reject(s,e))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=-1,s=new this(r);++a<n;)t(e[a]);return s}},{1:1}],3:[function(e,t,o){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,o){"use strict";function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var o=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)o.append(e[r]);return o.getBlob(t.type)}}function n(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function i(e,t,o){"function"==typeof t&&e.then(t),"function"==typeof o&&e.catch(o)}function a(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function s(e){return"boolean"==typeof S?L.resolve(S):function(e){return new L(function(t){var o=e.transaction(w,A),n=r([""]);o.objectStore(w).put(n,"key"),o.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},o.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);t(o||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return S=e})}function l(e){var t=E[e.name],o={};o.promise=new L(function(e){o.resolve=e}),t.deferredOperations.push(o),t.dbReady?t.dbReady=t.dbReady.then(function(){return o.promise}):t.dbReady=o.promise}function c(e,t){return new L(function(o,r){if(e.db){if(!t)return o(e.db);l(e),e.db.close()}var n=[e.name];t&&n.push(e.version);var i=_.open.apply(_,n);t&&(i.onupgradeneeded=function(t){var o=i.result;try{o.createObjectStore(e.storeName),t.oldVersion<=1&&o.createObjectStore(w)}catch(o){if("ConstraintError"!==o.name)throw o;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){o(i.result),function(e){var t=E[e.name].deferredOperations.pop();t&&t.resolve()}(e)}})}function u(e){return r([function(e){for(var t=e.length,o=new ArrayBuffer(t),r=new Uint8Array(o),n=0;n<t;n++)r[n]=e.charCodeAt(n);return o}(atob(e.data))],{type:e.type})}function h(e){return e&&e.__local_forage_encoded_blob}function d(e){var t=this,o=t._initReady().then(function(){var e=E[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return i(o,e,e),o}function p(e){l(e);for(var t=E[e.name].forages,o=0;o<t.length;o++)t[o]._dbInfo.db&&(t[o]._dbInfo.db.close(),t[o]._dbInfo.db=null);return c(e,!1).then(function(e){for(var o=0;o<t.length;o++)t[o]._dbInfo.db=e}).catch(function(t){throw function(e,t){var o=E[e.name].deferredOperations.pop();o&&o.reject(t)}(e,t),t})}function f(e,t,o){try{var r=e.db.transaction(e.storeName,t);o(null,r)}catch(r){if(!e.db||"InvalidStateError"===r.name)return p(e).then(function(){var r=e.db.transaction(e.storeName,t);o(null,r)});o(r)}}function g(e){var t,o,r,n,i,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(t=0;t<s;t+=4)o=R.indexOf(e[t]),r=R.indexOf(e[t+1]),n=R.indexOf(e[t+2]),i=R.indexOf(e[t+3]),u[l++]=o<<2|r>>4,u[l++]=(15&r)<<4|n>>2,u[l++]=(3&n)<<6|63&i;return c}function m(e){var t,o=new Uint8Array(e),r="";for(t=0;t<o.length;t+=3)r+=R[o[t]>>2],r+=R[(3&o[t])<<4|o[t+1]>>4],r+=R[(15&o[t+1])<<2|o[t+2]>>6],r+=R[63&o[t+2]];return o.length%3==2?r=r.substring(0,r.length-1)+"=":o.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function y(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function C(e,t){e[t]=function(){var o=arguments;return e.ready().then(function(){return e[t].apply(e,o)})}}function v(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var o in t)t.hasOwnProperty(o)&&(J(t[o])?arguments[0][o]=t[o].slice():arguments[0][o]=t[o])}return arguments[0]}var T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var S,E,L=Promise,w="local-forage-detect-blob-support",b=Object.prototype.toString,x="readonly",A="readwrite",P={_driver:"asyncStorage",_initStorage:function(e){function t(){return L.resolve()}var o=this,r={db:null};if(e)for(var n in e)r[n]=e[n];E||(E={});var i=E[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},E[r.name]=i),i.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=d);for(var a=[],s=0;s<i.forages.length;s++){var l=i.forages[s];l!==o&&a.push(l._initReady().catch(t))}var u=i.forages.slice(0);return L.all(a).then(function(){return r.db=i.db,c(r,!1)}).then(function(e){return r.db=e,function(e,t){if(!e.db)return!0;var o=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,n=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),n||o){if(o){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}(r,o._defaultConfig.version)?function(e){return c(e,!0)}(r):e}).then(function(e){r.db=i.db=e,o._dbInfo=r;for(var t=0;t<u.length;t++){var n=u[t];n!==o&&(n._dbInfo.db=r.db,n._dbInfo.version=r.version)}})},_support:function(){try{if(!_)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=new L(function(t,r){o.ready().then(function(){f(o._dbInfo,x,function(n,i){if(n)return r(n);try{var a=i.objectStore(o._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var o=a.result;if(o){var r=o.value;h(r)&&(r=u(r));var n=e(r,o.key,s++);void 0!==n?t(n):o.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return n(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=new L(function(t,r){o.ready().then(function(){f(o._dbInfo,x,function(n,i){if(n)return r(n);try{var a=i.objectStore(o._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),h(e)&&(e=u(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return n(r,t),r},setItem:function(e,t,o){var r=this;e=a(e);var i=new L(function(o,n){var i;r.ready().then(function(){return i=r._dbInfo,"[object Blob]"===b.call(t)?s(i.db).then(function(e){return e?t:function(e){return new L(function(t,o){var r=new FileReader;r.onerror=o,r.onloadend=function(o){var r=btoa(o.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}(t)}):t}).then(function(t){f(r._dbInfo,A,function(i,a){if(i)return n(i);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var l=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),o(t)},a.onabort=a.onerror=function(){var e=l.error?l.error:l.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return n(i,o),i},removeItem:function(e,t){var o=this;e=a(e);var r=new L(function(t,r){o.ready().then(function(){f(o._dbInfo,A,function(n,i){if(n)return r(n);try{var a=i.objectStore(o._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return n(r,t),r},clear:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){f(t._dbInfo,A,function(r,n){if(r)return o(r);try{var i=n.objectStore(t._dbInfo.storeName).clear();n.oncomplete=function(){e()},n.onabort=n.onerror=function(){var e=i.error?i.error:i.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return n(o,e),o},length:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){f(t._dbInfo,x,function(r,n){if(r)return o(r);try{var i=n.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){o(i.error)}}catch(e){o(e)}})}).catch(o)});return n(o,e),o},key:function(e,t){var o=this,r=new L(function(t,r){e<0?t(null):o.ready().then(function(){f(o._dbInfo,x,function(n,i){if(n)return r(n);try{var a=i.objectStore(o._dbInfo.storeName),s=!1,l=a.openCursor();l.onsuccess=function(){var o=l.result;o?0===e?t(o.key):s?t(o.key):(s=!0,o.advance(e)):t(null)},l.onerror=function(){r(l.error)}}catch(e){r(e)}})}).catch(r)});return n(r,t),r},keys:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){f(t._dbInfo,x,function(r,n){if(r)return o(r);try{var i=n.objectStore(t._dbInfo.storeName).openCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){o(i.error)}}catch(e){o(e)}})}).catch(o)});return n(o,e),o}},R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M="~~local_forage_type~",I=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:",N=O.length,D="arbf",F="blob",k="si08",G="ui08",B="uic8",U="si16",j="si32",W="ur16",V="ui32",H="fl32",q="fl64",X=N+D.length,Y=Object.prototype.toString,K={serialize:function(e,t){var o="";if(e&&(o=Y.call(e)),e&&("[object ArrayBuffer]"===o||e.buffer&&"[object ArrayBuffer]"===Y.call(e.buffer))){var r,n=O;e instanceof ArrayBuffer?(r=e,n+=D):(r=e.buffer,"[object Int8Array]"===o?n+=k:"[object Uint8Array]"===o?n+=G:"[object Uint8ClampedArray]"===o?n+=B:"[object Int16Array]"===o?n+=U:"[object Uint16Array]"===o?n+=W:"[object Int32Array]"===o?n+=j:"[object Uint32Array]"===o?n+=V:"[object Float32Array]"===o?n+=H:"[object Float64Array]"===o?n+=q:t(new Error("Failed to get type for BinaryArray"))),t(n+m(r))}else if("[object Blob]"===o){var i=new FileReader;i.onload=function(){var o=M+e.type+"~"+m(this.result);t(O+F+o)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(o){console.error("Couldn't convert value into a JSON string: ",e),t(null,o)}},deserialize:function(e){if(e.substring(0,N)!==O)return JSON.parse(e);var t,o=e.substring(X),n=e.substring(N,X);if(n===F&&I.test(o)){var i=o.match(I);t=i[1],o=o.substring(i[0].length)}var a=g(o);switch(n){case D:return a;case F:return r([a],{type:t});case k:return new Int8Array(a);case G:return new Uint8Array(a);case B:return new Uint8ClampedArray(a);case U:return new Int16Array(a);case W:return new Uint16Array(a);case j:return new Int32Array(a);case V:return new Uint32Array(a);case H:return new Float32Array(a);case q:return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:g,bufferToString:m},z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,o={db:null};if(e)for(var r in e)o[r]="string"!=typeof e[r]?e[r].toString():e[r];var n=new L(function(e,r){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(e){return r(e)}o.db.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=o,e()},function(e,t){r(t)})})});return o.serializer=K,n},_support:"function"==typeof openDatabase,iterate:function(e,t){var o=this,r=new L(function(t,r){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("SELECT * FROM "+n.storeName,[],function(o,r){for(var i=r.rows,a=i.length,s=0;s<a;s++){var l=i.item(s),c=l.value;if(c&&(c=n.serializer.deserialize(c)),void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()},function(e,t){r(t)})})}).catch(r)});return n(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=new L(function(t,r){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[e],function(e,o){var r=o.rows.length?o.rows.item(0).value:null;r&&(r=n.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})}).catch(r)});return n(r,t),r},setItem:function(e,t,o){return function e(t,o,r,i){var s=this;t=a(t);var l=new L(function(n,a){s.ready().then(function(){void 0===o&&(o=null);var l=o,c=s._dbInfo;c.serializer.serialize(o,function(o,u){u?a(u):c.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[t,o],function(){n(l)},function(e,t){a(t)})},function(o){if(o.code===o.QUOTA_ERR){if(i>0)return void n(e.apply(s,[t,l,r,i-1]));a(o)}})})}).catch(a)});return n(l,r),l}.apply(this,[e,t,o,1])},removeItem:function(e,t){var o=this;e=a(e);var r=new L(function(t,r){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("DELETE FROM "+n.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return n(r,t),r},clear:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){o(t)})})}).catch(o)});return n(o,e),o},length:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,o){var r=o.rows.item(0).c;e(r)},function(e,t){o(t)})})}).catch(o)});return n(o,e),o},key:function(e,t){var o=this,r=new L(function(t,r){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("SELECT key FROM "+n.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,o){var r=o.rows.length?o.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return n(r,t),r},keys:function(e){var t=this,o=new L(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,o){for(var r=[],n=0;n<o.rows.length;n++)r.push(o.rows.item(n).key);e(r)},function(e,t){o(t)})})}).catch(o)});return n(o,e),o}},$={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=t.name+"/",t.storeName!==this._defaultConfig.storeName&&(t.keyPrefix+=t.storeName+"/"),y()?(this._dbInfo=t,t.serializer=K,L.resolve()):L.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=o.ready().then(function(){for(var t=o._dbInfo,r=t.keyPrefix,n=r.length,i=localStorage.length,a=1,s=0;s<i;s++){var l=localStorage.key(s);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(n),a++)))return c}}});return n(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=o.ready().then(function(){var t=o._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return n(r,t),r},setItem:function(e,t,o){var r=this;e=a(e);var i=r.ready().then(function(){void 0===t&&(t=null);var o=t;return new L(function(n,i){var a=r._dbInfo;a.serializer.serialize(t,function(t,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+e,t),n(o)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}})})});return n(i,o),i},removeItem:function(e,t){var o=this;e=a(e);var r=o.ready().then(function(){var t=o._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return n(r,t),r},clear:function(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var r=localStorage.key(o);0===r.indexOf(e)&&localStorage.removeItem(r)}});return n(o,e),o},length:function(e){var t=this.keys().then(function(e){return e.length});return n(t,e),t},key:function(e,t){var o=this,r=o.ready().then(function(){var t,r=o._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return n(r,t),r},keys:function(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo,o=localStorage.length,r=[],n=0;n<o;n++){var i=localStorage.key(n);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r});return n(o,e),o}},J=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Z={},Q={},ee={INDEXEDDB:P,WEBSQL:z,LOCALSTORAGE:$},te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],oe={description:"",driver:[ee.INDEXEDDB._driver,ee.WEBSQL._driver,ee.LOCALSTORAGE._driver].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},re=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var o in ee)if(ee.hasOwnProperty(o)){var r=ee[o],n=r._driver;this[o]=n,Z[n]||this.defineDriver(r)}this._defaultConfig=v({},oe),this._config=v({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":T(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,o){var r=new L(function(t,o){try{var r=e._driver,n=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void o(n);for(var i=te.concat("_initStorage"),a=0,s=i.length;a<s;a++){var l=i[a];if(!l||!e[l]||"function"!=typeof e[l])return void o(n)}var c=function(o){Z[r]&&console.info("Redefining LocalForage driver: "+r),Z[r]=e,Q[r]=o,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(c,o):c(!!e._support):c(!0)}catch(e){o(e)}});return i(r,t,o),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,o){var r=Z[e]?L.resolve(Z[e]):L.reject(new Error("Driver not found."));return i(r,t,o),r},e.prototype.getSerializer=function(e){var t=L.resolve(K);return i(t,e),t},e.prototype.ready=function(e){var t=this,o=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return i(o,e,e),o},e.prototype.setDriver=function(e,t,o){function r(){a._config.driver=a.driver()}function n(e){return a._extend(e),r(),a._ready=a._initStorage(a._config),a._ready}var a=this;J(e)||(e=[e]);var s=this._getSupportedDrivers(e),l=null!==this._driverSet?this._driverSet.catch(function(){return L.resolve()}):L.resolve();return this._driverSet=l.then(function(){var e=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,r(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(e){return function(){var t=0;return function o(){for(;t<e.length;){var i=e[t];return t++,a._dbInfo=null,a._ready=null,a.getDriver(i).then(n).catch(o)}r();var s=new Error("No available storage method found.");return a._driverSet=L.reject(s),a._driverSet}()}}(s)})}).catch(function(){r();var e=new Error("No available storage method found.");return a._driverSet=L.reject(e),a._driverSet}),i(this._driverSet,t,o),this._driverSet},e.prototype.supports=function(e){return!!Q[e]},e.prototype._extend=function(e){v(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],o=0,r=e.length;o<r;o++){var n=e[o];this.supports(n)&&t.push(n)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)C(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=re},{3:3}]},{},[4])(4)});TC.Layer=function(e){this.options=e||{};$.extend(this,this.options);this.id=this.options.id||TC.getUID();this.map=this.options.map;this.type=this.options.type||TC.Consts.layerType.WMS;this.customLegend=this.options.customLegend;var t=this.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;this.options.format=this.options.format||t;void 0===this.options.hideTree&&(this.options.hideTree=!0);void 0===this.options.hideTitle&&(this.options.hideTitle=!1);this._cache={visibilityStates:{}};this.tree=null;this.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(e){this.wrap.setVisibility(e)};TC.Layer.prototype.getVisibility=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.getVisibility()));return e};TC.Layer.prototype.getOpacity=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.layer.getOpacity()));return e};TC.Layer.prototype.setOpacity=function(e,t){var o=this;this.wrap.getLayer().then(function(r){r.setOpacity(e);o.opacity=e;o.map&&!t&&o.map.trigger(TC.Consts.event.LAYEROPACITY,{layer:o,opacity:e})})};TC.Layer.prototype.isCompatible=function(e){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var e=!0;switch(this.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:e=!1}return e};TC.Layer.prototype.isVisibleByScale=function(e){return!0};TC.Layer.prototype.isVisibleByName=function(e){return!0};TC.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}};TC.Layer.prototype.findNode=function e(t,o){var r=null;if(o.uid==t)r=o;else for(var n=0;n<o.children.length;n++){var i=e(t,o.children[n]);if(i){r=i;break}}return r};TC.Layer.prototype.setNodeVisibility=function(e,t){this.setVisibility(t)};TC.Layer.prototype.getNodeVisibility=function(e){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.Layer.prototype.setProjection=function(){};TC.control=TC.control||{};TC.Control=function(){TC.EventTarget.call(this);this.map=null;this.isActive=!1;this.isDisabled=!1;var e=arguments.length;this.options=$.extend({},e>1?arguments[1]:arguments[0]);this.id=this.options.id||TC.getUID(this.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");this.div=TC.Util.getDiv(this.options.div?this.options.div:arguments[0]);this._$div=$(this.div);this.div.classList.add(TC.Control.prototype.CLASS);this.div.classList.add(this.CLASS);this.template=this.options.template||this.template;this.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const e=TC.Control.prototype;e.CLASS="tc-ctl";e.template="";e.show=function(){this.div.style.display=""};e.hide=function(){this.div.style.display="none"};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(null,function(){t.addUIEventListeners();"function"==typeof e&&e()}))};e._set1stRenderPromise=function(e){const t=this;t._firstRender||(t._firstRender=e);return e};const t=function(e,t,o){return new Promise(function(r,n){const i=[],a=[];for(var s in o){var l=o[s];if("string"==typeof l)if(dust.cache[e.CLASS])dust.render(e.CLASS,t,function(t,o){e.div.innerHTML=o;t&&TC.error(t)});else{var c=TC.ajax({url:l,method:"GET",responseType:"text"});i.push(c);a.push(s)}else $.isFunction(l)&&l()}0===i.length?r():Promise.all(i).then(function(e){e.forEach(function(e,t){const o=dust.compile(e,a[t]);dust.loadSource(o)});r()}).catch(function(e){console.error("Error fetching templates: "+e);n(e instanceof Error?e:Error(e))})})};e.renderData=function(e,o){const r=this;return new Promise(function(n,i){r.map&&r.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:e});r.isDisabled?r.div.classList.add(TC.Consts.classes.DISABLED):r.div.classList.remove(TC.Consts.classes.DISABLED);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var a;if("object"==typeof r.template)a=t(r,e,r.template);else{var s={};r.template&&(s[r.CLASS]=r.template);a=t(r,e,s)}a.then(function(){dust.cache[r.CLASS]&&dust.render(r.CLASS,e,function(e,t){r.div.innerHTML=t;if(e){i(Error(e));TC.error(e)}});r.trigger(TC.Consts.event.CONTROLRENDER);$.isFunction(o)&&o();n()}).catch(function(e){i(Error(e))})})})};e.getRenderedHtml=function(e,t,o){const r=this;return new Promise(function(n,i){var a=function(){dust.cache[e]&&dust.render(e,t,function(e,t){if(e){TC.error(e);i(Error(e))}else{$.isFunction(o)&&o(t);n(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])a();else{var t=r.template[e];if("string"==typeof t)TC.ajax({url:t,method:"GET",responseType:"text"}).then(function(t){var o=dust.compile(t,e);dust.loadSource(o);a()}).catch(function(e){console.log("Error fetching template: "+e)});else if($.isFunction(t)){t();a()}}})})};e.register=function(e){const t=this;return new Promise(function(o,r){t.map=e;Promise.resolve(t.render()).then(function(){t.options.active&&t.activate();o(t)})})};e.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};e.deactivate=function(e){0==arguments.length&&(e=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!e){var t=this.map.getDefaultControl();t==this?t=null:this.map.previousActiveControl==this?t=null:t||(t=this.map.previousActiveControl);t&&t.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};e.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};e.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};e.renderPromise=function(){const e=this;return e._firstRender||new Promise(function(t,o){e.one(TC.Consts.event.CONTROLRENDER,function(){t(e)})})};e.addUIEventListener=function(e,t,o){(e?this.div.querySelectorAll(e):[this.div]).forEach(function(e){e.addEventListener(t,o)})};e.addUIEventListeners=function(){};e.isExclusive=function(){return!1};e.getLocaleString=function(e,t){var o=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(o,e,t)};e.getUID=function(){return TC.getUID(this.id+"-")};e.exportState=function(){return this.exportsState?{}:null};e.importState=function(e){}}();TC.feature=TC.feature||{};TC.Feature=function(e,t){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if($.isArray(e))this.geometry=e;else if(this.wrap.isNative(e)){this.wrap.feature=e;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();this.folders=e._folders;this.data=this.wrap.getData()}var o=this.options=$.extend(!0,{},t);this.id=this.id||o.id||TC.getUID();this.data=o.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===o.showsPopup?this.showsPopup=!0:this.showsPopup=o.showsPopup;this.layer=o.layer||null;this._selected=!1;o.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var e=[];this.folders?e=this.folders:this.options.group&&(e=[this.options.group]);return e};TC.Feature.prototype.setVisibility=function(e){var t=this;if(!e&&t.showsPopup&&t.layer){var o=t.layer.map.getControlsByClass(TC.control.Popup).filter(function(e){return e.currentFeature===t});o.length>0&&o[0].hide()}if(e&&t._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!e&&t._visibilityState===TC.Consts.visibility.VISIBLE){t._visibilityState=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;t.layer.wrap.setFeatureVisibility(t,e)}};TC.Feature.prototype.setId=function(e){this.id=e;this.wrap.setId(e)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(e){this.wrap.setStyle(e)};TC.Feature.prototype.toggleSelectedStyle=function(e){this.wrap.toggleSelectedStyle(e)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const e=function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},t=function(t){return e(t)?[t]:t.reduce(o,[])},o=function(o,r){e(r)?o[o.length]=r:o=o.concat(t(r));return o};return t(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const e=this.getCoordsArray()[0];return e?e.length:0};TC.Feature.prototype.setCoords=function(e){this.geometry=e;return this.wrap.setGeometry(e)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(e){this.data=$.extend(this.data,e);this.wrap.setData(e)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(e){var t=null,o=(e=e||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),r=this.getData();if("object"==typeof r){var n=this.wrap.getTemplate();if(n)t=n.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(e,t){return r[t]});else{var i=[];const e=[];var a=TC.Util.getLocaleString(o,"open");for(var s in r){const t=r[s],n=s.match(/^h(\d)_/i);if(n)e[n[1]]=t;else if("string"==typeof t||"number"==typeof t||void 0===t){i[i.length]="<tr><th>";i[i.length]=s;i[i.length]="</th><td>";if(TC.Util.isURL(t)){i[i.length]='<a href="';i[i.length]=t;i[i.length]='" target="_blank">';i[i.length]=a;i[i.length]="</a>"}else i[i.length]=void 0!==t?TC.Util.formatNumber(t,o):"&mdash;";i[i.length]="</td></tr>"}}const n=e.map(function(e,t){if(e)return"<h"+t+">"+e+"</h"+t+">"}).filter(function(e){return e});n.length&&(i=n.concat(i));if(i.length>0){i.unshift('<table class="tc-attr">');i[i.length]="</table>";t=i.join("")}}}else"string"==typeof r&&(t=r);if(!t){t=this.title;this.group&&(t+=" "+this.group)}t||(t=TC.Util.getLocaleString(o,"noData"));return t};TC.Feature.prototype.clone=function(){var e=this.wrap.cloneFeature();e._wrap=this.wrap;return new this.constructor(e,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(e){const t=this,o=t.layer&&t.layer.map||e&&e.map;if(o){var r,n=e||t.popup;if(!n)for(var i=o.getControlsByClass("TC.control.Popup"),a=0,s=i.length;a<s;a++){var l=i[a];if(!l.caller){n=l;break}}if(n){n.currentFeature=t;r=Promise.resolve(n)}else r=o.addControl("popup");r.then(function(e){e.currentFeature=t;o.getControlsByClass(TC.control.Popup).forEach(function(e){e.isVisible()&&e.hide()});t.wrap.showPopup(e);const r=e.contentDiv.querySelector("table.tc-attr"),n=e.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(r&&n.length){const e=r.getBoundingClientRect().width+"px";n.forEach(function(t){t.style.maxWidth=e})}o.trigger(TC.Consts.event.POPUP,{control:e});e.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(e){const t=this,o=t.layer&&t.layer.map||e&&e.map;if(o){var r,n=e;if(!n)for(var i=o.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.options.content}),a=0,s=i.length;a<s;a++){var l=i[a];if(!l.caller){n=l;break}}if(n){n.currentFeature=t;r=Promise.resolve(n)}else{var c={content:"table"},u=o.getControlsByClass("TC.control.ControlContainer")[0];if(u){c.side=u.SIDE.RIGHT;r=u.addControl("resultsPanel",c)}else{c.div=document.createElement("div");o.div.appendChild(c.div);r=o.addControl("resultsPanel",c)}}r.then(function(e){e.currentFeature=t;0===o.getControlsByClass(TC.control.ControlContainer).length&&o.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return"table"===e.options.content}).forEach(function(e){e.close()});o.getControlsByClass("TC.control.ResultsPanel").forEach(function(e){e.currentFeature&&e.close()});e.div.querySelector(".tc-ctl-print-btn")&&e.div.querySelector(".tc-ctl-print-btn").remove();e.menuDiv.innerHTML="";e.open(t.getInfo({locale:o.options.locale}),e.getInfoContainer());var r=function(t){o.off(TC.Consts.event.VIEWCHANGE,r);e.close()};o.on(TC.Consts.event.VIEWCHANGE,r)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var e=this.options.selection||{};this.setStyle($.extend({},TC.Cfg.styles.selection[this.STYLETYPE],e[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){this._selected=!1;this.setStyle(this.options);if(this.layer){var e=$.inArray(this,this.layer.selectedFeatures);e>=0&&this.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(e,t){return this.wrap.toGML(e,t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.point,t);this.wrap.createPoint(e,o)}};TC.inherit(TC.feature.Point,TC.Feature);TC.feature.Point.prototype.STYLETYPE=TC.Consts.geom.POINT;TC.feature.Point.prototype.CLASSNAME="TC.feature.Point";TC.feature.Point.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[t]:t};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createCircle(e,o)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var e=TC.feature.Circle.prototype;e.STYLETYPE=TC.Consts.geom.POLYGON;e.CLASSNAME="TC.feature.Circle";e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(e,t){TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{var o=this.options=$.extend(!0,this.options,TC.Cfg.styles.marker,t),r=this.layer&&this.layer.map?this.layer.map.options.locale:TC.Cfg.locale;this.title=o.title||TC.i18n[r][TC.Consts.MARKER];this.wrap.createMarker(e,o)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createMultiPolygon(e,o)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature.MultiPolygon.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],[].concat.apply([],t)):t};TC.feature.MultiPolygon.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createMultiPolyline(e,o)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE="line";TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature.MultiPolyline.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],t):t};TC.feature.MultiPolyline.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createPolygon(e,o)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature.Polygon.prototype.getCoords=function(e){e=e||{};const t=TC.Feature.prototype.getCoords.call(this,e);return e.pointArray?[].concat.apply([],t):t};TC.feature.Polygon.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature.Polygon.prototype.getArea=function(e){return this.wrap.getArea(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createPolyline(e,o)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE="line";TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.feature.Polyline.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.filter={};TC.filter.Filter=function(e){this.tagName_=e;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(e){if(e!=this){e._defaultNSURL=this._defaultNSURL;e._defaultPrefixNS=this._defaultPrefixNS}return e instanceof TC.filter.LogicalNary?e.write():e instanceof TC.filter.ComparisonBinary?e.write():e instanceof TC.filter.Comparison?e.write():e instanceof TC.filter.Spatial?e.write():(TC.filter.Function,e.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(e){return e.reduce(function(e,t,o){return(e instanceof TC.filter.Filter?e.writeInnerCondition_(e):e)+t.writeInnerCondition_(t)})};TC.filter.Filter.prototype.getText=function(e){if(e&&parseFloat(e,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,t))};TC.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,t))};TC.filter.not=function(e){return new TC.filter.Not(e)};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(e,t,o){return new TC.filter.EqualTo(e,t,o)};TC.filter.notEqualTo=function(e,t,o){return new TC.filter.NotEqualTo(e,t,o)};TC.filter.lessThan=function(e,t){return new TC.filter.LessThan(e,t)};TC.filter.lessThanOrEqualTo=function(e,t){return new TC.filter.LessThanOrEqualTo(e,t)};TC.filter.greaterThan=function(e,t){return new TC.filter.GreaterThan(e,t)};TC.filter.greaterThanOrEqualTo=function(e,t){return new TC.filter.GreaterThanOrEqualTo(e,t)};TC.filter.isNull=function(e){return new TC.filter.IsNull(e)};TC.filter.between=function(e,t,o){return new TC.filter.IsBetween(e,t,o)};TC.filter.function=function(e,t){return new TC.filter.Function(e,t)};TC.filter.like=function(e,t,o,r,n,i){return new TC.filter.IsLike(e,t,o,r,n,i)};TC.filter.LogicalNary=function(e,t){TC.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(e){this.condition=e;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Bbox=function(e,t,o){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(e,t){TC.filter.Filter.call(this,e);this.propertyName=t};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var e="";this.lowerBoundary&&this.upperBoundary&&(e="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(e="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(e=$.isArray(this.params)?this.params.reduce(function(e,t,o){var r=function(e){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:e})};return(o>0?e:r(e))+r(t)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:e,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(e,t,o,r){TC.filter.Comparison.call(this,e,t);this.expression=o;this.matchCase=r};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(e,t,o){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,o)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(e,t,o){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,o)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(e,t,o,r,n,i){TC.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==o?o:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==n?n:"!";this.matchCase=i};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(e){TC.filter.Comparison.call(this,"PropertyIsNull",e)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(e,t,o){TC.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=o};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(e,t){TC.filter.Filter.call(this,e);this.params=t};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var e="";if(this.params){var t=function(e,t){if("string"==typeof e)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:t,value:e});if("object"==typeof e){var o="";for(var r in e)o+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:t,value:e[r],key:r});return o}};if($.isArray(this.params)){var o=this._defaultPrefixNS;e=this.params.reduce(function(e,r,n){var i=function(e){return t(e,o)};return(n>1?e:i(e))+i(r)})}else e=t(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:e})};TC.filter.Spatial=function(e,t,o,r){TC.filter.Filter.call(this,e);this.geometryName=t;this.geometry=o;this.srsName=r};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.srsName),fieldTitle:this._fieldTitle})};TC.filter.Bbox=function(e,t,o){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var e="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:e})};TC.filter.Intersects=function(e,t,o){TC.filter.Spatial.call(this,"Intersects",e,t,o)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(e,t,o){TC.filter.Spatial.call(this,"Within",e,t,o)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t="tcLayer",o="tcImg";e.render=function(e,t){const o=this;return o._set1stRenderPromise(o.map?o.renderData(t?$.extend(o.map.getLayerTree(),t):o.map.getLayerTree(),function(){o.addUIEventListeners();"function"==typeof e&&e()}):Promise.reject())};e.register=function(e){const t=this;return new Promise(function(o,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){for(var r=0,n=e.layers.length;r<n;r++)t.updateLayerTree(e.layers[r]);e.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){const o=e.layer;var r=o.names;!function e(t){var o=!1;if(t)if($.inArray(t.name,r)>=0)o=!0;else for(var n=0;n<t.children.length;n++)if(e(t.children[n])){o=!0;break}return o}(t.layerTrees[o.id])&&0!==r.length?t.updateLayerTree(o):t.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){const o=e.layer;t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(o)>-1){t.updateLayerTree(o);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)}).on(TC.Consts.event.LAYERERROR,function(e){t.onErrorLayer(e.layer)});o(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,o,r,n){const i=this;if(o>=0&&o!==r){var a,s;const o=i.getLayerUIElements();for(var l=(n=n||i.map.workLayers).length-1;l>=0;l--){const r=n[l];s=a;for(var c=0,u=o.length;c<u;c++){const e=o[c];if($(e).data(t)===r){a=e;break}}if(r===e){s?s.insertAdjacentElement("afterend",a):a.parentElement.firstChild.insertAdjacentElement("beforebegin",a);break}}}};e.removeLayer=function(e){const o=this,r=o.getLayerUIElements();for(var n=0,i=r.length;n<i;n++){const o=r[n];if($(o).data(t)===e){o.parentElement.removeChild(o);break}}0===o.getLayerUIElements().length&&o.div.querySelector("."+o.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};e.onErrorLayer=function(e){};e.getLayerUIElements=function(){return this.div.querySelector("ul").children};e.styleLegendImage=function(e,t){if(!e.getAttribute("src")){var r=$(e).data(o);const c=new TC.tool.Proxification(TC.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then(function(t){e.src=t}).catch(function(e){TC.error(e)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const u=e.parentElement;var n=u.style.color,i=n.indexOf("("),a=n.indexOf(")");if(i>=0&&a>i){color=n.substr(0,a).substr(i+1).split(",");n="0x";for(var s=0;s<3;s++){var l=parseInt(color[s]).toString(16);n+=1===l.length?"0"+l:l}}else n.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+u.style.fontFamily+";fontSize:"+parseInt(u.style.fontSize)+";fontColor:"+n+";fontAntiAliasing:true";t.params&&t.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:t.params.sld_body}));c.fetchImage(r).then(function(e){$(e).data(o,e.src)}).catch(function(e){TC.error(e)})}c.fetchImage(r).then(function(t){e.src=t.src}).catch(function(e){TC.error(e.statusText)})}}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapInfo=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.MapInfo,TC.Control);!function(){var e=TC.control.MapInfo.prototype;e.CLASS="tc-ctl-mi";e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.QR_MAX_URL_LENGTH=150;t.SHORTEN_URL_LENGTH=32715;t.exportsState=!1;t.includeControls=void 0===t.options.includeControls||t.options.includeControls;e.ready(function(){const o=e.state&&e.state.ctl;if(o&&!e._controlStatesLoaded){t.importControlStates(o);e._controlStatesLoaded=!0}});return o};e.exportControlStates=function(){const e=this;return e.map?e.map.controls.map(function(e){return e.exportState()}).filter(function(e){if(e)for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}):[]};e.importControlStates=function(e){const t=this;t.map&&e.forEach(function(e){const o=t.map.getControlById(e.id);o&&t.map.loaded(function(){o.importState(e)})})};e.exportState=function(){const e=this;if(e.exportsState){const o={};if(e.featureToShare||e.sharedFeaturesLayer){var t;o.id=e.id;if(e.featureToShare){const o=e.featureToShare.clone();o.showsPopup=!0;t=e.featureToShare.layer.exportState({features:[o]})}else t=e.sharedFeaturesLayer.exportState();o.features=t.features;t.crs&&(o.crs=t.crs)}return o}return null};e.importState=function(e){const t=this;t.map&&e.features.length&&t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then(function(o){t.sharedFeaturesLayer=o;o.importState({features:e.features,crs:e.crs}).then(function(){t.map.zoomToFeatures(o.features)})})};e.manageMaxLengthExceed=function(){throw"Falta implementaci\xf3n del m\xe9todo manageMaxLengthExceed"};e.generateLink=function(){var e=window.location.href,t=e.indexOf("#");t>0&&(e=e.substring(0,t));if(this.extraParams){var o=TC.Util.getQueryStringParams(e);$.extend(o,this.extraParams);var r=e.indexOf("?");r>=0&&(e=e.substring(0,r));e=e.concat("?",$.param(o))}TC.Util.getParameterByName("lang").length>0&&(e=e.indexOf("&")>-1?e.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):e.replace("?lang="+TC.Util.getParameterByName("lang"),""));const n=this.includeControls?this.exportControlStates():[];this.exportsState&&(this.featureToShare||this.sharedFeaturesLayer)&&n.push(this.exportState());const i=n.length?{ctl:n}:void 0;var a=this.map.getMapState(i),s=e.concat("#",a);this.manageMaxLengthExceed({browser:s.length>TC.Consts.URL_MAX_LENGTH,qr:s.length>this.SHORTEN_URL_LENGTH});return s};e.shortenedLink=function(){const e=this;var t;return new Promise(function(o,r){var n=function(){var t=e.generateLink(),o=t.indexOf("?"),r=t.indexOf("#");o>0&&(t=o<r?t.replace(t.substring(o,r),""):t.replace(t.substring(o,t.length-1),""));return t}();if(n.length>e.QR_MAX_URL_LENGTH&&n.length<e.SHORTEN_URL_LENGTH){t=e.map.getLoadingIndicator().addWait();(function(e){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");var t=new FormData;t.append("url",e);return new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:t}).then(function(e){return e}).catch(function(e){return null})})(n).then(function(r){if(r&&r.responseText){e.map.getLoadingIndicator().removeWait(t);o(r.responseText.replace("http://","https://"))}else onerror()},onerror)}else{n.length>=e.SHORTEN_URL_LENGTH&&function(){e.map.toast(e.getLocaleString("urlTooLongForShortener"),{type:TC.Consts.msgType.ERROR});e.map.getLoadingIndicator().removeWait(t);o("")}();o("")}})};e.makeQRCode=function(e,t,o){const r=this;return new Promise(function(n,i){TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){r.shortenedLink().then(function(r){if((r=r||"").length>0){var i={text:r};if(t&&o){i.width=t;i.height=o}new MutationObserver(function(e,t){var o=e.filter(function(e){return"attributes"===e.type}).filter(function(e){return e.attributeName.indexOf("src")>-1});if(o.length>0){t.disconnect();n(o[0].target.src)}}).observe(e,{attributes:!0,childList:!0,subtree:!0});new QRCode(e,i)}else n()})})})};e.drawScaleBarIntoCanvas=function(e){var t,o=this.map.getControlsByClass(TC.control.ScaleBar);if(0==o.length)return null;var r=(t=(e=e||{}).canvas?e.canvas:document.createElement("CANVAS")).getContext("2d");r.save();var n,i,a=document.getElementsByClassName("ol-scale-line-inner").item(0),s=$.extend({},a.getBoundingClientRect()),l=a.textContent;r.beginPath();r.strokeStyle=window.getComputedStyle(a).borderColor;if(s.width>s.height){n=s.width;i=s.height}else{n=s.height;i=s.width}if(e.setSize){t.width=n;t.height=i}s.left=void 0!=e.left?e.left:15;s.top=void 0!=e.top?e.top:15;r.moveTo(s.left,s.top);r.lineTo(s.left,s.top+i);r.lineTo(s.left+n,s.top+i);r.lineTo(s.left+n,s.top);r.stroke();r.measureText(l);var c={x:s.left+n/2,y:s.top+i/2};e.fill&&function(t,r,n){var i=document.getElementsByClassName(o[0].CLASS).item(0),a=$.extend({},i.getBoundingClientRect());a.left=(e.left||15)-2;a.top=e.top||15;a.top--;t.globalAlpha=.5;t.fillStyle=window.getComputedStyle(i).backgroundColor;r+=4;n+=4;t.fillRect(a.left,a.top,r,n)}(r,n,i);r.globalAlpha=1;r.fillStyle=void 0!=e.textColor?e.textColor:window.getComputedStyle(a).color;r.font=void 0!=e.font?e.font:window.getComputedStyle(a).fontSize+" "+window.getComputedStyle(a).fontFamily;r.textAlign="center";r.textBaseline="middle";r.fillText(l,c.x,c.y);return t};e.registerListeners=function(){const e=this;if(!e.registeredListeners){e.map.on(TC.Consts.event.LAYERADD,e.generateLink.bind(e)).on(TC.Consts.event.LAYERREMOVE,e.generateLink.bind(e)).on(TC.Consts.event.FEATUREADD,e.generateLink.bind(e)).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,e.generateLink.bind(e));e.registeredListeners=!0}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var e=TC.control.TOC.prototype;e.CLASS="tc-ctl-toc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/TOC.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><div class="tc-ctl-toc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(t.get(["workLayers"],!1),t,{block:o},{}).w("</ul></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-toc-wlbranch",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><button class="tc-ctl-toc-collapse-btn"></button><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:n},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:i},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function n(e,t){return e.w(" checked")}n.__dustBody=!0;function i(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}i.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('">').x(t.get(["children"],!1),t,{block:n},{}).w('<input type="checkbox" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:a},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function n(e,t){return e.w('<button class="tc-ctl-toc-collapse-btn"></button>')}n.__dustBody=!0;function i(e,t){return e.w(" checked")}i.__dustBody=!0;function a(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}a.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerUid";e.register=function(e){const t=this,o=TC.control.MapContents.prototype.register.call(t,e);e.on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){t.onExternalServiceAdded.call(t,e,this)});return o};e.onExternalServiceAdded=function(e,t){const o=this;if(e&&e.layer){e.layer.map=t;t.addLayer(e.layer).then(function(t){o.updateLayerTree(e.layer)})}};e.addUIEventListeners=function(){var e=this;e.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(r){const n=r.target;for(var i=n;i&&!i.matches("ul."+e.CLASS+"-wl");)i=i.parentElement;const a=[];for(var s=0,l=i.children.length;s<l;s++){child=i.children[s];"LI"===child.tagName&&a.push(child)}for(s=0,l=a.length;s<l;s++){const e=a[s];if(e.contains(n)){const r=$(e).data(t);var c=n;do{c=c.parentElement}while(c&&"LI"!==c.tagName);const i=$(c).data(o);r.setNodeVisibility(i,n.checked);break}}r.stopPropagation()}));e.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+e.CLASS+"-collapse-btn",function(t){t.target.blur();const o=t.target.parentElement;if(!o.classList.contains(e.CLASS+"-leaf")){o.classList.contains(TC.Consts.classes.COLLAPSED)?o.classList.remove(TC.Consts.classes.COLLAPSED):o.classList.add(TC.Consts.classes.COLLAPSED);const e=o.querySelector("ul");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED);t.stopPropagation()}}))};e.update=function(){var e=function(e){for(var t=0,o=e.children.length;t<o;t++){const o=e.children[t];if(o.matches("input[type=checkbox]"))return o}return null};this.getLayerUIElements().forEach(function(r){var n=$(r).data(t);if(n){e(r).checked=n.getVisibility();n.tree=null;r.querySelectorAll("li").forEach(function(t){const r=e(t);var i=$(t).data(o);switch(n.getNodeVisibility(i)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:r.checked=!0;r.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:r.checked=!1;r.indeterminate=!0;break;default:r.checked=!1;r.indeterminate=!1}})}});this.updateScale()};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(r){var n=$(r).data(t);r.querySelectorAll("li").forEach(function(t,r){var i=$(r);i.toggleClass(e.CLASS+"-node-notvisible",!n.isVisibleByScale(i.data(o)))})})};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r.div.querySelector("."+r.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var n=r.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n,r.layerTrees[e.id],function(n,i){const a=(new DOMParser).parseFromString(i,"text/html").body.firstChild,s=$(a).data(o),l=r.div.querySelector("."+r.CLASS+'-wl li[data-tc-layer-uid="'+s+'"]');if(l){l.innerHTML=a.innerHTML;l.setAttribute("class",a.getAttribute("class"));$(l).data(t)||$(l).data(t,e)}else{$(a).data(t,e);const o=r.div.querySelector("."+r.CLASS+"-wl");o.insertBefore(a,o.firstChild)}n&&TC.error(n)});var i="ul."+r.CLASS+"-wl",a="ul."+r.CLASS+"-branch",s="li."+r.CLASS+"-node",l="li."+r.CLASS+"-leaf";r.div.querySelectorAll(i+" "+a+" "+a+","+i+" "+a+" "+s).forEach(function(e){e.matches(l)||e.classList.add(TC.Consts.classes.COLLAPSED)});r.update()})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var o=this;o.getLayerUIElements().forEach(function(r){if($(r).data(t)===e){var n=!e.getVisibility();r.querySelectorAll("input[type=checkbox]").forEach(function(e){e.matches("."+o.CLASS+"-branch-cb")?e.checked=!n:e.disabled=n})}})};e.updateLayerOrder=function(e,t,o){};e.render=function(e){const t=this;return TC.Control.prototype.render.call(t,function(){var o=t.options.controls||[];if(o.length>0){var r=o[0],n=document.createElement("div");t.div.appendChild(n);t.map.addControl(r.name,$.extend({div:n},r.options))}$.isFunction(e)&&e()})};e.getLayerUIElements=function(){const e=[],t=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var o=0,r=t.length;o<r;o++){child=t[o];"LI"===child.tagName&&(e[e.length]=child)}return e}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(e){TC.control.TOC.apply(this,arguments);this.layers=[];this.queries=this.options.queries};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var e=TC.control.WorkLayerManager.prototype;e.CLASS="tc-ctl-wlm";e.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/WorkLayerManager.html";e.template[e.CLASS+"-elm"]=TC.apiLocation+"TC/templates/WorkLayerManagerElement.html";e.template[e.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipSingle.html";e.template[e.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroup.html";e.template[e.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroupNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="').h("i18n",t,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-wlm-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><div class="tc-ctl-wlm-content tc-hidden"><form><ul>').s(t.get(["workLayers"],!1),t,{block:o},{}).w("</ul></form></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-elm",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-elm"]=function(){dust.register(e.CLASS+"-elm",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-elm" tabindex="-1"><div class="tc-ctl-wlm-lyr">').x(t.get(["path"],!1),t,{block:o},{}).w('</div><div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="').s(t.get(["path"],!1),t,{else:r,block:n},{}).w('">').s(t.get(["path"],!1),t,{else:a,block:s},{}).w('</div><div class="tc-ctl-wlm-buttons"><div class="tc-ctl-wlm-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(t.get(["opacity"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(t.get(["hide"],!1),t,{block:c},{}).w(' title="').h("i18n",t,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-wlm-info tc-hidden">').x(t.get(["abstract"],!1),t,{block:u},{}).x(t.get(["customLegend"],!1),t,{else:h,block:f},{}).x(t.get(["metadata"],!1),t,{block:g},{}).w('</div><div class="tc-ctl-wlm-dd ').x(t.get(["hide"],!1),t,{block:y},{}).w('" title="').h("i18n",t,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-wlm-del ').x(t.get(["unremovable"],!1),t,{block:C},{}).w(" ").nx(t.get(["hide"],!1),t,{block:v},{}).w('" ').nx(t.get(["unremovable"],!1),t,{block:T},{}).w("></div></li>")}t.__dustBody=!0;function o(e,t){return e.f(t.get(["title"],!1),t,"h")}o.__dustBody=!0;function r(e,t){return e.f(t.get(["title"],!1),t,"h")}r.__dustBody=!0;function n(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:i},{})}n.__dustBody=!0;function i(e,t){return e.w(" &bull; ")}i.__dustBody=!0;function a(e,t){return e.f(t.get(["title"],!1),t,"h")}a.__dustBody=!0;function s(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:l},{})}s.__dustBody=!0;function l(e,t){return e.w(" &bull; ")}l.__dustBody=!0;function c(e,t){return e.w('checked="checked"')}c.__dustBody=!0;function u(e,t){return e.w('<div class="tc-ctl-wlm-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div><pre>").f(t.get(["abstract"],!1),t,"h",["s"]).w("</pre></div></div>")}u.__dustBody=!0;function h(e,t){return e.x(t.get(["legend"],!1),t,{block:d},{})}h.__dustBody=!0;function d(e,t){return e.w('<div class="tc-ctl-wlm-legend" data-tc-layer-name="').f(t.get(["layerNames"],!1),t,"h").w('"><h4>').h("i18n",t,{},{$key:"content"}).w("</h4>").s(t.get(["legend"],!1),t,{block:p},{}).w("</div>")}d.__dustBody=!0;function p(e,t){return e.w("<div><p>").f(t.get(["title"],!1),t,"h").w('</p><img data-tc-img="').f(t.get(["src"],!1),t,"h").w('" /></div>')}p.__dustBody=!0;function f(e,t){return e.w('<ul class="tc-ctl-wlm-custom-legend">').f(t.get(["customLegend"],!1),t,"h",["s"]).w("</ul>")}f.__dustBody=!0;function g(e,t){return e.w('<div class="tc-ctl-wlm-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:m},{}).w("</ul></div>")}g.__dustBody=!0;function m(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}m.__dustBody=!0;function y(e,t){return e.w("tc-hidden")}y.__dustBody=!0;function C(e,t){return e.w("disabled")}C.__dustBody=!0;function v(e,t){return e.w("tc-hidden")}v.__dustBody=!0;function T(e,t){return e.w('title="').h("i18n",t,{},{$key:"removeLayerFromMap"}).w('"')}T.__dustBody=!0;return t};e.template[e.CLASS+"-type-sgl"]=function(){dust.register(e.CLASS+"-type-sgl",t);function t(e,t){return e.h("i18n",t,{},{$key:"singleLayer"})}t.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp"]=function(){dust.register(e.CLASS+"-type-grp",t);function t(e,t){return e.w("<div>").h("i18n",t,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(t.get(["Layer"],!1),t,{block:o},{}).w("</ul>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp-node"]=function(){dust.register(e.CLASS+"-type-grp-node",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-tip-grp-elm"><span>').f(t.get(["Title"],!1),t,"h").w("</span><ul>").s(t.get(["Layer"],!1),t,{block:o},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t}}const t="tcLayer",o=function(e,o){return e.getLayerUIElements().filter(function(e){return $(e).data(t)===o})[0]};var r=function(e){return $.grep(e.map.workLayers,function(e){return!e.stealth}).length};const n=function(e){return!e.layers.some(function(e){return e.unremovable})},i=function(e,o,r,n,i){const a=e.getLayerUIElements();var s;if(n>r)s=a[n-1];else{if(!(n<r))return;s=a[n+1]}const l=$(o).data(t),c=$(s).data(t);for(var u=-1,h=0;h<e.map.layers.length;h++)if(c===e.map.layers[h]){u=h;break}u>=1&&u<e.map.layers.length&&e.map.insertLayer(l,u,i)};e.render=function(e,t){const o=this;return o._set1stRenderPromise(o.map?o.renderData(t?$.extend(o.map.getLayerTree(),t):o.map.getLayerTree(),function(){o.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){o.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){o.updateLayerTree(e)});const t=o.div.querySelector("ul");o._sortable=Sortable.create(t,{handle:"."+o.CLASS+"-dd",animation:150,onSort:function(e){i(o,e.item,e.oldIndex,e.newIndex)}});t.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const r=function(e,r){const n=o._sortable.toArray(),a=n[e];n[e]=n[r];n[r]=a;o._sortable.sort(n);i(o,t,e,r)},n=o.getLayerUIElements(),a=n.indexOf(t);switch(!0){case/Up$/.test(e.key):if(a>0){r(a,a-1);t.focus();e.stopPropagation()}break;case/Down$/.test(e.key):if(a<n.length-1){r(a,a+1);t.focus();e.stopPropagation()}break;case/Enter$/.test(e.key):t.blur();e.stopPropagation()}}));"function"==typeof e&&e()})}):Promise.reject())};e.register=function(t){const r=this;return new Promise(function(n,i){TC.control.TOC.prototype.register.call(r,t).then(function(){t.on(TC.Consts.event.LAYEROPACITY,function(e){const t=o(r,e.layer);t&&(t.querySelector("input[type=range]").value=Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(e){var o=e.fileName;if(e.features&&e.features.length>0){var n="."+TC.Consts.format.GPX.toLowerCase();if(e.fileName.toLowerCase().indexOf(n)===e.fileName.length-n.length)return;t.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==o){if(r.map&&r.map.layout&&r.map.layout.accordion&&r.div.classList.contains(TC.Consts.classes.COLLAPSED))for(var t=0;t<r.map.controls.length;t++)r.map.controls[t]!==r&&r.map.controls[t].div.classList.add(TC.Consts.classes.COLLAPSED);r.map.trigger(TC.Consts.event.TOOLSOPEN);r.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});if(r.queries){TC.control.WFSQuery||TC.syncLoadJS(TC.apiLocation+"TC/Control/WFSQuery");e.queryControl=new TC.control.WFSQuery(null,r.queries instanceof Object?r.queries:null);r.map.addControl(e.queryControl)}n(r)})})};e.onExternalServiceAdded=function(e,t){};e.addUIEventListeners=function(){const e=this;e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("input[type=checkbox]",function(o){const r=o.target;var n=r;do{n=n.parentElement}while(n&&!n.matches("li."+e.CLASS+"-elm"));$(n).data(t).setVisibility(r.checked);o.stopPropagation()}));const o=function(e){const o=e.target;var r=o;do{r=r.parentElement}while(r&&"LI"!==r.tagName);$(r).data(t).setOpacity(o.value/100)};e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",o));e.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",o));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del:not(.disabled)",function(o){var r=o.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=$(r).data(t);e.map.removeLayer(n)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",function(o){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){e.getLayerUIElements().map(function(e){return $(e).data(t)}).forEach(function(t){e.map.removeLayer(t)})})}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-btn-info",function(o){const r=o.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const i=n.querySelector("."+e.CLASS+"-info"),a=$(n).data(t);i.querySelectorAll("."+e.CLASS+"-legend img").forEach(function(t){e.styleLegendImage(t,a)});i.classList.contains(TC.Consts.classes.HIDDEN)?i.classList.remove(TC.Consts.classes.HIDDEN):i.classList.add(TC.Consts.classes.HIDDEN);if(n.querySelector('input[type="checkbox"]').checked){const t=n.querySelector("."+e.CLASS+"-dd");i.classList.contains(TC.Consts.classes.HIDDEN)?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}r.classList.contains(TC.Consts.classes.CHECKED)?r.classList.remove(TC.Consts.classes.CHECKED):r.classList.add(TC.Consts.classes.CHECKED)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-btn-query",function(o){if(o.target.classList.contains("tc-unavailable")||o.target.classList.contains("tc-loading"))return;var r=o.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=$(r).data(t);e.queryControl.renderModalDialog(n)}))};e.updateLayerVisibility=function(e){const t=this,r=o(t,e);if(r){const o=e.getVisibility();r.querySelector('input[type="checkbox"]').checked=o;const n=r.querySelector("."+t.CLASS+"-del"),i=r.querySelector("."+t.CLASS+"-info"),a=r.querySelector("."+t.CLASS+"-dd");if(o){n.classList.add(TC.Consts.classes.HIDDEN);i.classList.contains(TC.Consts.classes.HIDDEN)&&a.classList.remove(TC.Consts.classes.HIDDEN)}else{n.classList.remove(TC.Consts.classes.HIDDEN);i.classList.contains(TC.Consts.classes.HIDDEN)&&a.classList.add(TC.Consts.classes.HIDDEN)}}};e.updateLayerTree=function(e){var o=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(o,e);for(var i=!1,s=0,l=o.layers.length;s<l;s++)if(e===o.layers[s]){i=!0;break}if(!i){var c=o.CLASS+"-elm";o.layers.push(e);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r,n=e.title||e.wrap.getServiceTitle(),i={title:e.options.hideTitle?"":n,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable},s=e.isRaster();if(s){i.layerNames=e.layerNames;var l=e.getPath();l.shift();i.path=l;var u=e.names[0],h=e.wrap.getInfo(u);i.legend=h.legend;i.abstract=h.abstract;var d,p=h.hasOwnProperty("abstract")||h.hasOwnProperty("legend")||h.hasOwnProperty("metadata");if(e.tree&&e.tree.children&&e.tree.children.length&&e.tree.children[0].children&&e.tree.children[0].children.length)d=null;else if(d=h.metadata)for(var f=0,g=d.length;f<g;f++){var m=d[f];m.formatDescription=o.getLocaleString(TC.Util.getSimpleMimeType(m.format))||o.getLocaleString("viewMetadata")}i.metadata=d;o.queries&&(r=a(e))}(function(e){return new Promise(function(t,o){e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().then(function(e){t(e)}).catch(function(e){TC.error(e)}):t()})})(e).then(function(n){n&&(legend.src=n);dust.render(c,i,function(n,i){const a=(new DOMParser).parseFromString(i,"text/html").body.firstChild;var l,c=!1;if(s&&!(c=e.names.length>1))for(var h=e.wrap.getAllLayerNodes(),d=0;d<h.length;d++){var f=h[d];if(e.wrap.getName(f)===u){l=f;e.wrap.getLayerNodes(f).length>0&&(c=!0);break}}const g=a.querySelector("."+o.CLASS+"-type"),m=c?o.CLASS+"-type-grp":o.CLASS+"-type-sgl";g.classList.add(m);p||a.querySelector("."+o.CLASS+"-btn-info").classList.add(TC.Consts.classes.HIDDEN);if(l){e.wrap.normalizeLayerNode(l);dust.render(m,l,function(e,t){var r;g.addEventListener("mouseover",function(e){const n=o.map.div,i=g.getBoundingClientRect();(r=document.createElement("div")).classList.add(o.CLASS+"-tip");r.innerHTML=t;r.style.top=i.top-n.offsetTop+"px";r.style.right=n.offsetWidth-(i.left-n.offsetLeft)+"px";n.appendChild(r)});g.addEventListener("mouseout",function(e){r.parentElement.removeChild(r)})})}const y=o.div.querySelector("ul");$(a).data(t,e);const C=o.map.workLayers.filter(function(e){return!e.stealth}).reverse().indexOf(e),v=o.getLayerUIElements();v.length<C||0===v.length?y.appendChild(a):v.length===C?y.insertBefore(a,v[v.length-1]):y.insertBefore(a,v[Math.max(C,0)]);r&&r(a);o.updateScale()})})});var u=r(o);const i=o.div.querySelector("."+o.CLASS+"-n"),s=o.div.querySelector("."+o.CLASS+"-empty"),l=o.div.querySelector("."+o.CLASS+"-content");i.textContent=u;if(u>0){i.classList.add(TC.Consts.classes.VISIBLE);s.classList.add(TC.Consts.classes.HIDDEN);l.classList.remove(TC.Consts.classes.HIDDEN)}else{i.classList.remove(TC.Consts.classes.VISIBLE);s.classList.remove(TC.Consts.classes.HIDDEN);l.classList.add(TC.Consts.classes.HIDDEN)}const h=o.div.querySelector("."+o.CLASS+"-del-all");n(o)?h.classList.remove(TC.Consts.classes.HIDDEN):h.classList.add(TC.Consts.classes.HIDDEN)}}};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(o){var r=$(o).data(t);if(r.names){for(var n=!1,i=0;i<r.names.length;i++)if(r.isVisibleByScale(r.names[i])){n=!0;break}const t=e.CLASS+"-elm-notvisible";n?o.classList.remove(t):o.classList.add(t)}})};e.updateLayerOrder=function(e,t,r){const n=this;n.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){const t=o(n,e);t&&t.parentElement.firstChild.insertAdjacentElement("beforebegin",t)})};e.removeLayer=function(e){var o=this.layers.indexOf(e);o>=0&&this.layers.splice(o,1);this.getLayerUIElements().forEach(function(o){$(o).data(t)===e&&o.parentElement.removeChild(o)});const i=this.div.querySelector("."+this.CLASS+"-content"),a=this.div.querySelector("."+this.CLASS+"-empty"),s=this.div.querySelector("."+this.CLASS+"-n");var l=r(this);s.textContent=l;if(l>0){i.classList.remove(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.HIDDEN);s.classList.add(TC.Consts.classes.VISIBLE)}else{n(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);i.classList.add(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.HIDDEN);s.classList.remove(TC.Consts.classes.VISIBLE)}};e.getLayerUIElements=function(){const e=this,t=[],o=e.div.querySelector("ul").children;for(var r=0,n=o.length;r<n;r++){child=o[r];child.matches("li."+e.CLASS+"-elm")&&(t[t.length]=child)}return t};const a=function(t){var o,r=null,n=new Promise(function(e,t){r=e});n.then(function(t){(o=document.createElement("div")).classList.add(e.CLASS+"-btn-query");o.classList.add(TC.Consts.classes.LOADING);o.setAttribute("title",e.getLocaleString("query.tooltipMagnifBtn"));t.querySelector("."+e.CLASS+"-btn-info").insertAdjacentElement("afterend",o)});var i=t.getWFSCapabilitiesPromise();const a=function(){if(o){o.classList.remove(TC.Consts.classes.LOADING);o.classList.add("tc-unavailable")}console.log("El servicio "+(t.title||t.tree.title)+" no tiene disponible el WFS")};Promise.all([i,n]).then(function(){var e=arguments[0][0];if(o){o.classList.remove(TC.Consts.classes.LOADING);var r=t.getDisgregatedLayerNames();if(1===r.length&&!e.FeatureTypes.hasOwnProperty(r[0].substring(r[0].indexOf(":")+1))){o.classList.add("tc-unavailable");console.log("El servicio WFS de "+(t.title||t.tree.title)+" no dispone de la capa "+r[0])}}}).catch(a);i.catch(a);return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){TC.Control.apply(this,arguments);this.options&&this.options.callback&&(this.callback=this.options.callback);this.wrap=new TC.wrap.control.Click(this)};TC.inherit(TC.control.Click,TC.Control);!function(){var e=TC.control.Click.prototype;e.CLASS="tc-ctl-click";e.register=function(e){this.wrap.register(e);return TC.Control.prototype.register.call(this,e)};e.activate=function(){TC.Control.prototype.activate.call(this);this.wrap.activate()};e.deactivate=function(){this.wrap.deactivate();TC.Control.prototype.deactivate.call(this)};e.callback=function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);const e=this._classSelector="."+this.CLASS;this._selectors={LIST_ITEM:"ul"+e+"-features li"};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},o=Math.pow(2,53)-1,r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),o)},function(e){var o=Object(e);if(null==e)throw new TypeError("Array.from requiere un objeto array-like - not null or undefined");var n,i=arguments.length>1?arguments[1]:void 0;if(void 0!==i){if(!t(i))throw new TypeError("Array.from: si hay mapFn, el segundo argumento debe ser una funci\xf3n");arguments.length>2&&(n=arguments[2])}for(var a,s=r(o.length),l=t(this)?Object(new this(s)):new Array(s),c=0;c<s;){a=o[c];l[c]=i?void 0===n?i(a,c):i.call(n,a,c):a;c+=1}l.length=s;return l}));var e,t,o,r,n=function(e){return e.info.services?e.info.services.reduce(function(e,t){return e+t.layers.reduce(function(e,t){return e+1},0)},0):0};TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var i=TC.control.FeatureInfoCommons.prototype;i.CLASS="tc-ctl-finfo";i.TITLE_SEPARATOR=" \u2022 ";TC.isDebug?i.template=TC.apiLocation+"TC/templates/FeatureInfo.html":i.template=function(){dust.register(i.CLASS,e);function e(e,o){return e.x(o.get(["elevation"],!1),o,{block:t},{}).w('<ul class="tc-ctl-finfo-services">').s(o.get(["services"],!1),o,{else:n,block:s},{}).w("</ul>").x(o.get(["featureCount"],!1),o,{block:M},{})}e.__dustBody=!0;function t(e,t){return e.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(t.get(["crs"],!1),t,"h").w("</span></span> ").x(t.get(["isGeo"],!1),t,{else:o,block:r},{}).w(' <span class="tc-ctl-finfo-coords-pair">').h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.get(["elevation"],!1),t,"h").w(" m</span></span></div>")}t.__dustBody=!0;function o(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w("</span></span> ")}o.__dustBody=!0;function r(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w("</span></span> ")}r.__dustBody=!0;function n(e,t){return e.nx(t.get(["elevation"],!1),t,{block:a},{})}n.__dustBody=!0;function a(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}a.__dustBody=!0;function s(e,t){return e.w("<li><h3>").x(t.get(["title"],!1),t,{else:l,block:h},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:d,block:R},{}).w("</div></li>")}s.__dustBody=!0;function l(e,t){return e.x(t.getPath(!1,["layers","0","title"]),t,{else:c,block:u},{})}l.__dustBody=!0;function c(e,t){return e.f(t.getPath(!1,["layer","name"]),t,"h")}c.__dustBody=!0;function u(e,t){return e.f(t.getPath(!1,["layers","0","title"]),t,"h")}u.__dustBody=!0;function h(e,t){return e.f(t.get(["title"],!1),t,"h")}h.__dustBody=!0;function d(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:p,block:f},{}).w("</ul>")}d.__dustBody=!0;function p(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}p.__dustBody=!0;function f(e,t){return e.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w("</span> ").s(t.get(["path"],!1),t,{block:g},{}).w('</h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:y,block:C},{}).w("</ul></div></li>")}f.__dustBody=!0;function g(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:m},{})}g.__dustBody=!0;function m(e,t){return e.w(" &bull; ")}m.__dustBody=!0;function y(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}y.__dustBody=!0;function C(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:v,block:L},{}).w("</li>")}C.__dustBody=!0;function v(e,t){return e.x(t.get(["error"],!1),t,{else:T,block:E},{})}v.__dustBody=!0;function T(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:_},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:S},{}).w("</tbody></table>")}T.__dustBody=!0;function _(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToShowOnMap"}).w('"')}_.__dustBody=!0;function S(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}S.__dustBody=!0;function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}E.__dustBody=!0;function L(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:w,block:b},{key:t.get(["rawFormat"],!1),value:"text/html"})}L.__dustBody=!0;function w(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}w.__dustBody=!0;function b(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:x},{})}b.__dustBody=!0;function x(e,t){return e.h("ne",t,{else:A,block:P},{key:t.get(["expandUrl"],!1),value:""})}x.__dustBody=!0;function A(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe>')}A.__dustBody=!0;function P(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('"></iframe><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}P.__dustBody=!0;function R(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}R.__dustBody=!0;function M(e,t){return e.h("gt",t,{block:I},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}M.__dustBody=!0;function I(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}I.__dustBody=!0;return e};i.register=function(e){const t=this,o=TC.control.Click.prototype.register.call(t,e);t._createLayers();e.loaded(function(){const o=e.getControlsByClass("TC.control.Share")[0];o&&t.loadSharedFeature(o.loadParamFeature())});t.displayMode=t.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;t.setDisplayMode(t.displayMode);e.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.getDisplayControl()&&t.resultsLayer){if(t.highlightedFeature){t.resultsLayer.removeFeature(t.highlightedFeature);t.highlightedFeature=null}t.querying||t.filterLayer.clearFeatures()}}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){t.highlightedFeature=null}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){const o=e.control;o.currentFeature!==t.filterFeature&&(t.highlightedFeature=o.currentFeature);e.control.currentFeature&&e.control.currentFeature.layer&&[t.filterLayer.id,t.resultsLayer.id].indexOf(e.control.currentFeature.layer.id)>-1&&t._decorateDisplay(o)}).on(TC.Consts.event.DRAWCHART,function(e){setTimeout(function(){t.highlightedFeature=e.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(t.info&&t.info.services){const r={};t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS}).forEach(function(e){const t=r[e.url]||[];r[e.url]=t.concat(e.getDisgregatedLayerNames())});for(var e=0,o=t.info.services.length;e<o;e++){const o=t.info.services[e],n=r[o.mapLayers[0].url]||[];if(!o.layers.reduce(function(e,t){return e.concat(t.name)},[]).every(function(e){return n.indexOf(e)>=0})){t.downplayFeatures();t.info=null;t.closeResults();break}}}}).on(TC.Consts.event.VIEWCHANGE,function(e){t.closeResults()});return o};i.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};i.responseCallback=function(e){const t=this;t.querying=!1;t.filterFeature&&(t.info={services:e.services});if(e.featureCount){t._addSourceAttributes();t.lastFeatureCount=e.featureCount;t.map.trigger(TC.Consts.event.FEATUREINFO,$.extend({control:t},e))}else{t.lastFeatureCount=0;t.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:t});t.closeResults()}};i.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.responseCallback({})};i.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};i.setDisplayMode=function(e){var t=this;t.displayMode=e;var o=t.map;switch(e){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!t.resultsPanel){var r=o.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.options.content})[0];if(r){t.resultsPanel=r;r.caller=t}else{o.on(TC.Consts.event.CONTROLADD,function e(r){const n=r.control;if(TC.control.ResultsPanel&&n instanceof TC.control.ResultsPanel){t.resultsPanel=n;n.caller=t;o.off(TC.Consts.event.CONTROLADD,e)}})}}break;default:t.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;t.popup||o.addControl("popup",{closeButton:!0,draggable:t.options.draggable}).then(function(e){t.popup=e;e.caller=t;o.on(TC.Consts.event.POPUP,function(e){t.onShowPopup(e)});o.on(TC.Consts.event.POPUPHIDE,function(o){o.control===e&&t._resetSize()})})}};i.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};i.getDisplayTarget=function(e){if((e=e||{}).control)switch(!0){case TC.control.Popup&&e.control instanceof TC.control.Popup:return e.control.getContainerElement();case TC.control.ResultsPanel&&e.control instanceof TC.control.ResultsPanel:return e.control.getTableContainer();default:return null}switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getTableContainer();default:return this.popup.getContainerElement()}};i.getMenuTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};i.displayResults=function(){var e=this;const t=e.div.cloneNode(!0);t.classList.remove(TC.Consts.classes.HIDDEN);e.filterFeature.data=t.outerHTML;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(e.resultsPanel){if(0===e.map.getControlsByClass(TC.control.ControlContainer).length)e.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(e){e.isVisible()&&e.close()});else{e.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t!==e.resultsPanel&&t.currentFeature&&t.close()})}e.resultsPanel.currentFeature=e.filterFeature;e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer());e.displayResultsCallback()}break;default:e.popup&&e.filterFeature.showPopup(e.popup)}};const a=function(e){return Array.from(e.parentElement.childNodes).indexOf(e)},s=function(e,t){var o=e;do{o=o.parentElement}while(o&&o.tagName!==t);return o};i.getFeatureElement=function(e){const t=this;var o;t.getDisplayTarget().querySelectorAll(t._selectors.LIST_ITEM).forEach(function(r){const n=r,i=s(r,"LI"),l=s(i,"LI");t.getFeature(a(l),a(i),a(n))===e&&(o=n)});return o};i.getNextFeatureElement=function(e){const t=this.getDisplayTarget().querySelectorAll("ul."+this.CLASS+"-features > li"),o=t.length;for(var r=0;r<o;r++)if(t[r].matches("."+TC.Consts.classes.CHECKED))return t[(r+e+o)%o];return null};i.getFeaturePath=function(e){const t=this;if(t.info&&t.info.services)for(var o=0,r=t.info.services.length;o<r;o++){const r=t.info.services[o];for(var n=0,i=r.layers.length;n<i;n++){const t=r.layers[n];for(var a=0,s=t.features.length;a<s;a++)if(t.features[a]===e)return{service:r.title||r.mapLayers.reduce(function(e,t){return e||t.title},""),layer:t.path}}}return null};i.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};i.displayResultsCallback=function(){var e=this;const t=e.getDisplayTarget().querySelector("."+e.CLASS);var o,r="click";t.addEventListener(r,TC.EventTarget.listenerBySelector(e._selectors.LIST_ITEM,function(t){e.highlightFeature(t.target)}));r=TC.Consts.event.CLICK;o="."+e.CLASS+"-btn-next";t.addEventListener(r,TC.EventTarget.listenerBySelector(o,function(t){e.highlightFeature(e.getNextFeatureElement(1),1);return!1}));o="."+e.CLASS+"-btn-prev";t.addEventListener(r,TC.EventTarget.listenerBySelector(o,function(t){e.highlightFeature(e.getNextFeatureElement(-1),-1);return!1}));o="ul."+e.CLASS+"-layers h4";t.addEventListener(r,TC.EventTarget.listenerBySelector(o,function(o){const r=s(o.target,"LI");if(r.classList.contains(TC.Consts.classes.CHECKED))t.querySelector(".tc-ctl-finfo-btn-next")&&"none"===t.querySelector(".tc-ctl-finfo-btn-next").style.display&&n(e)>1&&e.downplayFeatures();else{e.highlightFeature(r.querySelector(e._selectors.LIST_ITEM));e.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&e.popup.fitToView(!0)}}));o="."+e.CLASS+"-del-btn";t.addEventListener(r,TC.EventTarget.listenerBySelector(o,function(t){e.downplayFeatures();e.closeResults()}));if(e.info)if(e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)){e.getFeatureElement(e.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);e.highlightFeature(e.info.defaultFeature)}else t.querySelector(e._selectors.LIST_ITEM)&&e.highlightFeature(t.querySelector(e._selectors.LIST_ITEM));t.querySelectorAll("table").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){const o=this.parentElement;if(!o.classList.contains(TC.Consts.classes.DISABLED)){if(o.classList.contains(TC.Consts.classes.CHECKED)){if(e.resultsLayer.features[0]&&window.getSelection()&&0===window.getSelection().toString().trim().length){e.map.on(TC.Consts.event.ZOOM,function t(){e._zooming=!1;e.map.off(TC.Consts.event.ZOOM,t)});e._zooming=!0;e.map.zoomToFeatures([e.resultsLayer.features[0]],{animate:!0})}}else e.highlightFeature(o);t.stopPropagation()}})});t.querySelectorAll("table a").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation()})});if(Modernizr.touch&&e.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&t.querySelector("."+e.CLASS+"-btn-prev")&&"none"!==t.querySelector("."+e.CLASS+"-btn-prev").style.display){e.resultsPanel&&TC.Util.swipe(e.resultsPanel.div,"disable");n(e)>1&&TC.Util.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}})}};i.onShowPopup=function(e){this.map;if(e.control===this.popup){this.displayResultsCallback();this._fitSize()}};i.loadSharedFeature=function(e){};i.insertLinks=function(){const e=this.getLocaleString("open"),t=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(o){const r=o.textContent;TC.Util.isURL(r)&&(o.innerHTML='<a href="'+r+'" target="_blank" title="'+t+'">'+e+"</a>")})};i.highlightFeature=function(e,t){const o=this;var r;if(!o._zooming){var n;if(e instanceof TC.Feature){r=e;n=o.getFeatureElement(r)}else{n=e;for(;n&&"LI"!==n.tagName;)n=n.parentElement}const u=s(n,"LI"),h=s(u,"LI"),d=a(h),p=a(u),f=a(n);r=r||o.getFeature(d,p,f);o.downplayFeatures({exception:r});n.classList.add(TC.Consts.classes.CHECKED);u.classList.add(TC.Consts.classes.CHECKED);h.classList.add(TC.Consts.classes.CHECKED);if(t>0){n.classList.add(TC.Consts.classes.FROMLEFT);u.classList.add(TC.Consts.classes.FROMLEFT);h.classList.add(TC.Consts.classes.FROMLEFT)}else if(t<0){n.classList.add(TC.Consts.classes.FROMRIGHT);u.classList.add(TC.Consts.classes.FROMRIGHT);h.classList.add(TC.Consts.classes.FROMRIGHT)}n.querySelector("table")&&n.querySelector("table").setAttribute("title",o.getLocaleString("clickToCenter"));o.highlightedFeature=r;o.getDisplayTarget().querySelector("."+o.CLASS+"-counter-current")&&(o.getDisplayTarget().querySelector("."+o.CLASS+"-counter-current").innerHTML=o.getFeatureIndex(d,p,f)+1);var i=o.resultsLayer.features.slice();if(i.filter(function(e){return r&&r.id===e.id}).length>0)return;for(var l=0;l<i.length;l++){var c=i[l];c!==o.filterFeature&&o.resultsLayer.removeFeature(c)}r&&r.geometry?o.resultsLayer.addFeature(r):n.classList.add(TC.Consts.classes.DISABLED)}};i.downplayFeatures=function(e){const t=this;e=e||{};t.highlightedFeature!==e.exception&&(t.highlightedFeature=null);const o=e.exception?t.getFeatureElement(e.exception):void 0;var r,n;if(o){r=s(o,"LI");n=s(r,"LI")}t.resultsLayer.clearFeatures();const i=t.getDisplayTarget();Array.from(i.querySelectorAll("ul."+t.CLASS+"-services li")).filter(function(e){return e!==o&&e!==r&&e!==n}).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.classList.remove(TC.Consts.classes.DISABLED);e.classList.remove(TC.Consts.classes.FROMLEFT);e.classList.remove(TC.Consts.classes.FROMRIGHT)});i.querySelectorAll("."+t.CLASS+"-features table").forEach(function(e){e.setAttribute("title",t.getLocaleString("clickToShowOnMap"))})};i._fitSize=function(){const e=this.getDisplayTarget();var t=0;e.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(e){t=Math.max(t,e.offsetLeft+e.offsetWidth)});t&&(e.style.width=t+50+"px")};i._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};i.getFeature=function(e,t,o){var r;const n=this.info;n&&n.services&&(r=n.services[e])&&(r=r.layers[t])&&(r=r.features[o]);return r};i.getFeatureIndex=function(e,t,o){var r=-1;const n=this.info;if(n)for(var i=0;i<=e;i++)for(var a=n.services[i],s=i===e?t:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===t?o:c.features.length-1,h=0;h<=u;h++)r+=1;return r};i.beforeRequest=function(e){var t=this;t.querying=!0;t.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:e.xy,control:t});t.closeResults();if(t.map&&t.resultsLayer){t.lastFeatureCount=null;t.resultsLayer.features.forEach(function(e){t.resultsLayer.removeFeature(e)});t.info=null}};i.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};i.deactivate=function(e){this.popup&&this.popup.hide();this.resultsLayer.clearFeatures();this.filterLayer.clearFeatures();this.wrap&&this.wrap.deactivate();TC.Control.prototype.deactivate.call(this,e)};i.exportState=function(){const e=this;return e.exportsState&&e.resultsLayer?{id:e.id,layer:e.resultsLayer.exportState()}:null};i.importState=function(e){const t=this;t._layersPromise.then(function(){t.resultsLayer.importState(e.layer)})};i._createLayers=function(){const e=this;var t,o;t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};o=e.options.filterLayer?e.options.filterLayer:{id:e.getUID(),title:e.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:e.lineColor,strokeWidth:2},polygon:{strokeColor:e.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};const r=e.map;e._layersPromise=new Promise(function(n,i){r.loaded(function(){Promise.all([r.addLayer(t),r.addLayer(o)]).then(function(t){e.resultsLayer=t[0];e.filterLayer=t[1];n()})})});return e._layersPromise};i._decorateDisplay=function(e){const t=this,o=t.getDisplayTarget({control:e});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!o.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var r=t.getLocaleString("feature");if(e===t.getDisplayControl())if(TC.feature.Point&&t.filterFeature instanceof TC.feature.Point){const e=t.filterFeature.geometry;r=t.getLocaleString("featuresAt",{crs:t.map.crs,x:TC.Util.formatNumber(e[0],t.map.locale),y:TC.Util.formatNumber(e[1],t.map.locale)})}else r=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(r=e.currentFeature.id);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&new TC.control.Print({target:o,title:r})}})};i._addSourceAttributes=function(){const e=this,t="h3_"+e.getLocaleString("service"),o="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach(function(r){r.layers.forEach(function(r){r.features.forEach(function(r){if(r instanceof TC.Feature){const n=e.getFeaturePath(r);if(n){const i={};i[t]=n.service;n.layer&&(i[o]=n.layer.join(e.TITLE_SEPARATOR));const a=$.extend(i,r.getData());r.clearData();r.setData(a)}}})})})}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Scale.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:o,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}t.__dustBody=!0;function o(e,t){return e.f(t.get(["scale"],!1),t,"h")}o.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){const o=t.div.querySelector("span");o.textContent="1:"+t.format(o.textContent.substr(2));t.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){t.setScreenSize()});$.isFunction(e)&&e()}))};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);var r=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);r&&(TC.Cfg.screenSize=r);t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree;t.update()})});return o};e.update=function(){this.render()};e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){if(t){TC.Cfg.screenSize=parseFloat(t);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);e.update()}})};e.getScale=function(e){var t=0,o=!e&&this.map?this.map.wrap.getResolution():e;if(o){t=o*this.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(t*=window.devicePixelRatio)}if(this.map&&this.map.wrap.isGeo()){if(!this.metersPerDegree){var r=this.map.getExtent();r&&(this.metersPerDegree=TC.Util.getMetersPerDegree(r))}this.metersPerDegree&&(t*=this.metersPerDegree)}return t};e.getDpi=function(e){this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e;return this.dpi};e.format=function(e){for(var t=new Number(e).toFixed(0),o=[];t.length>3;){var r=t.length-3;o.unshift(t.substr(r));t=t.substr(0,r)}t&&o.unshift(t);return o.join(".")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){TC.Control.apply(this,arguments);this.serviceWorkerEnabled=!1};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t._swPromise=new Promise(function(e,o){navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(o){t.serviceWorkerEnabled=!0;o.installing?e(o.installing):o.waiting?e(o.waiting):o.active&&e(o.active);console.log(o.scope,"register")},function(e){t.serviceWorkerEnabled=!1;o();console.error("Could not register service worker: "+e)}):o(new Error("Browser does not support service workers"))});return o};e.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var t=function(e,t,o,r,n){navigator.serviceWorker.addEventListener("message",function i(a){if(a.data.name===o){a.data.action===r&&a.data.event===n?e(o):"error"===a.data.event&&t();navigator.serviceWorker.removeEventListener("message",i)}})};e.createCache=function(e,o){var r=this;return new Promise(function(n,i){r.getServiceWorker().then(function(r){var a=o||{};t(n,i,e,"create","cached");r.postMessage({action:"create",name:e,list:a.urlList||[],silent:a.silent})},function(){n(!1)})})};e.deleteCache=function(e,o){var r=this;return new Promise(function(n,i){r.getServiceWorker().then(function(r){var a=o||{};t(n,i,e,"delete","deleted");r.postMessage({action:"delete",name:e,silent:a.silent})},function(){n(!1)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);e.drawControls=[];e.persistentDrawControls=!1;e.NOMEASURE="-";e.exportsState=!0;this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._len=e.div.querySelector(".tc-ctl-meas-val-len");e._area=e.div.querySelector(".tc-ctl-meas-val-area");e._peri=e.div.querySelector(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Measure.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}t.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);t.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var o=this;o&&"LABEL"!==o.tagName;)o=o.parentElement;var r=o.querySelector("input[type=radio][name=mode]"),n=r.value;r.checked=!0;t.setMode(n,!0)})});$.isFunction(e)&&e()})}))};e.register=function(e){const t=this;return new Promise(function(o,r){TC.Control.prototype.register.call(t,e).then(function(){t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.trigger(TC.Consts.event.DRAWEND)});const n=t.getUID(),i=t.getUID(),a=t.getUID();t.layerPromise=e.addLayer({id:n,title:t.getLocaleString("measure"),stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}});Promise.all([t.layerPromise,t.renderPromise()]).then(function(n){const s=n[0];t.layer=s;t.layer.map.putLayerOnTop(t.layer);t._drawLinesPromise=e.addControl("draw",{id:i,div:t.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});t._drawPolygonsPromise=e.addControl("draw",{id:a,div:t.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});Promise.all([t._drawLinesPromise,t._drawPolygonsPromise]).then(function(e){t.drawLines=e[0];t.drawPolygons=e[1];e.forEach(function(e){e.containerControl=t;t.drawControls.push(e);e.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(e){t.showMeasures(e)}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)});e.exportsState=!1});o(t);t.setMode(t.options.mode)}).catch(r)}).catch(r)})})};e.displayMode=function(e){const t=this,o=[];t.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(e){o.push(e)});switch(e){case TC.Consts.geom.POLYLINE:t._activeMode=o.filter(function(e){return e.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:t._activeMode=o.filter(function(e){return e.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:t._activeMode=null}const r=o.filter(function(e){return e!==t._activeMode});if(e){const o=t.div.querySelector("input[type=radio][name=mode][value="+e+"]");o.checked=!0;o.classList.add(TC.Consts.classes.CHECKED);o.nextSibling.classList.add(TC.Consts.classes.CHECKED)}else t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.checked=!1;e.classList.remove(TC.Consts.classes.CHECKED);e.nextSibling.classList.remove(TC.Consts.classes.CHECKED)});if(t._activeMode){t._activeMode.classList.remove(TC.Consts.classes.HIDDEN);t._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}r.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});return t};e.setMode=function(e){const t=this;t.mode=e;t.displayMode(e);var o;switch(e){case TC.Consts.geom.POLYLINE:t.drawLines.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:t.drawPolygons.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach(function(e){e.isActive&&e.cancel()});o=TC.Consts.event.CONTROLDEACTIVATE;break;default:o=TC.Consts.event.CONTROLACTIVATE}t.resetValues();o&&t.map&&t.map.trigger(o,{control:t});return t};e.cancel=function(){this.setMode(null,!1);return this};e.showMeasures=function(e){const t=this;var o,r=(e=e||{}).units;const n=t.map.options.locale||TC.Cfg.locale;if(e.area){var i=e.area;if(i>1e4){i/=1e6;r="km"}o="m"===r?0:3;t._area.innerHTML=TC.Util.formatNumber(i.toFixed(o),n)+" "+r+"&sup2;"}if(e.perimeter){var a=e.perimeter;if(a>1e3){a/=1e3;r="km"}o="m"===r?0:3;t._peri.innerHTML=TC.Util.formatNumber(a.toFixed(o),n)+" "+r}if(e.length){var s=e.length;if(s>1e3){s/=1e3;r="km"}o="m"===r?0:3;t._len.innerHTML=TC.Util.formatNumber(s.toFixed(o),n)+" "+r}return t};e.resetValues=function(){const e=this;if(e._len){e._len.textContent=e.NOMEASURE;e._area.textContent=e.NOMEASURE;e._peri.textContent=e.NOMEASURE}return e};e.getDrawLines=function(){};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.layerPromise.then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const e=this;TC.Control.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+e._cssClasses.LOAD_CRS_BUTTON+")",function(t){const o=t.target.dataset.crsCode;o&&e.setProjection({crs:o,allowFallbackLayer:!0})}));e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+e._cssClasses.LOAD_CRS_BUTTON,function(t){e.loadFallbackProjections()}))};TC.inherit(TC.control.ProjectionSelector,TC.Control);const e=TC.control.ProjectionSelector.prototype;e.CLASS="tc-ctl-projs";e.render=function(e){const t=this,o=TC.Control.prototype.render.call(t,e);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e});return o};e.getAvailableCRS=function(e){return this.map.getCompatibleCRS({includeFallbacks:!0})};e.showProjectionChangeDialog=function(e){const t=this,o=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG),r=o.querySelector(".tc-modal-body");r.classList.add(TC.Consts.classes.LOADING);const n=r.querySelector("ul."+t._cssClasses.CRS_LIST);n.innerHTML="";const i=t.map.baseLayer.firstOption||t.map.baseLayer,a=i.getFallbackLayer(),s=i.getCompatibleCRS(),l=function(){t.map.loadProjections({crsList:t.getAvailableCRS(e),orderBy:"name"}).then(function(e){var i=!1;e.forEach(function(e){if(TC.Util.CRSCodesEqual(t.map.crs,e.code)){o.querySelector("."+t._cssClasses.CURRENT_CRS_NAME).textContent=e.name;o.querySelector("."+t._cssClasses.CURRENT_CRS_CODE).textContent=e.code}else{const t=document.createElement("button");t.textContent=e.name+" ("+e.code+")";t.dataset.crsCode=e.code;const o=document.createElement("li");o.appendChild(t);if(0===s.filter(function(t){return TC.Util.CRSCodesEqual(t,e.code)}).length){i=!0;o.classList.add(TC.Consts.classes.HIDDEN);t.classList.add(TC.Consts.classes.WARNING)}n.appendChild(o)}});if(i){const e=document.createElement("li"),o=document.createElement("button");o.classList.add(t._cssClasses.LOAD_CRS_BUTTON);o.innerHTML=t.getLocaleString("showOnTheFlyProjections");e.appendChild(o);n.appendChild(e)}if(0===n.querySelectorAll("li").length){const e=document.createElement("li");e.innerHTML=t.getLocaleString("thereAreNoCompatibleCRS");n.appendChild(e)}const a=n.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");o.querySelectorAll("."+t._cssClasses.CHANGE).forEach(function(e){e.style.display=a.length>1?"":"none"});o.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=a.length>1?"none":""});o.querySelector("ul."+t._cssClasses.CRS_LIST).style.display=a.length>0||i?"":"none";r.classList.remove(TC.Consts.classes.LOADING)})};a?a.getCapabilitiesPromise().then(l):l();TC.Util.showModal(o,e)};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e)}})};e.loadFallbackProjections=function(){const e=this,t=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li");t.forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(e){e.style.display=t.length>1?"":"none"});e._dialogDiv.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=t.length>1?"none":""})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Container=function(){TC.Control.apply(this,arguments);this.controlOptions=this.options.controls||[];this.ctlCount=this.controlOptions instanceof Array?this.controlOptions.length:Object.keys(this.controlOptions).length;this.defaultSelection=this.options.defaultSelection};TC.inherit(TC.control.Container,TC.Control);!function(){var e=TC.control.Container.prototype;e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.uids=new Array(t.ctlCount);t.uids.forEach(function(e,o,r){r[o]=t.getUID()});return new Promise(function(e,r){Promise.all([o,t.renderPromise()]).then(function(){t.onRenderPromise();e()})})};e.onRenderPromise=function(){};e.render=function(e){};e.getControl=function(e){var t=this._ctlPromises[e];return t||new Promise(function(e,t){t()})}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.TabContainer=function(){TC.control.Container.apply(this,arguments);var e=this._classSelector="."+this.CLASS;this._selectors={TAB:e+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:e+"-elm"}};TC.inherit(TC.control.TabContainer,TC.control.Container);!function(){var e=TC.control.TabContainer.prototype;e.CLASS="tc-ctl-tctr";TC.isDebug?e.template=TC.apiLocation+"TC/templates/TabContainer.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").f(t.get(["title"],!1),t,"h").w('</h2><div class="tc-ctl-tctr-select"><form>').s(t.get(["controls"],!1),t,{block:o},{}).w("</form></div>").s(t.get(["controls"],!1),t,{block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-').f(t.get(["$idx"],!1),t,"h").w('" style="width:calc(100%/').f(t.get(["$len"],!1),t,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(t.get(["$idx"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label>")}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-').f(t.get(["$idx"],!1),t,"h").w(' tc-hidden"></div>')}r.__dustBody=!0;return t};e.onRenderPromise=function(){const e=this;e.title=e.title||e.getLocaleString(e.options.title||"moreControls");e.div.querySelector("h2").innerHTML=e.title;for(var t=new Array(e.ctlCount),o=0,r=e.controlOptions.length;o<r;o++){var n=e.controlOptions[o];t[o]=e.map.addControl(n.name,$.extend({id:e.uids[o],div:e.div.querySelector("."+e.CLASS+"-elm-"+o)},n.options))}var i=function(t,o){t.renderPromise().then(function(){const r=e.getLocaleString(e.controlOptions[o].title)||t.div.querySelector("h2").innerHTML;var n=t.div;do{n=n.parentElement}while(n&&!n.matches(e._classSelector));n.querySelector(e._selectors.TAB+"-"+o+" span").innerHTML=r})};Promise.all(t).then(function(t){for(var o=0,r=t.length;o<r;o++){var n=t[o];n.containerControl=e;i(n,o)}})};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({title:t.title,controls:t.controlOptions},function(){var e=function(e){for(var o=this;o&&!o.matches(t._selectors.TAB);)o=o.parentElement;var r,n=[];const i=o.querySelector(t._selectors.RADIOBUTTON),a=i.value,s=t.div.querySelectorAll(t._selectors.ELEMENT);if(t._oldValue===a&&t.options.deselectable){setTimeout(function(){i.checked=!1},0);t._oldValue=null;r=null;n=s}else{s.forEach(function(e){e.matches(t._selectors.ELEMENT+"-"+a)?r=e:n.push(e)});t._oldValue=a}r&&r.classList.remove(TC.Consts.classes.HIDDEN);n.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});i.checked=!0};t.div.querySelectorAll("span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,e)});"number"==typeof t.defaultSelection&&e.call(t.div.querySelectorAll(t._selectors.RADIOBUTTON)[t.defaultSelection])}))}}();!function(e,t){"function"==typeof define&&define.amd?define(["../../lib/ol/build/ol-debug"],t):"object"==typeof exports?module.exports=t(require("../../lib/ol/build/ol-debug")):e.ol=t(e.ol)}(this,function(e){Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,o=0;o<t;o++){if(arguments[o]===1/0||arguments[o]===-1/0)return 1/0;e+=arguments[o]*arguments[o]}return Math.sqrt(e)};for(var t=0,o=["ms","moz","webkit","o"],r=0;r<o.length&&!window.requestAnimationFrame;++r){window.requestAnimationFrame=window[o[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[o[r]+"CancelAnimationFrame"]||window[o[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,o){var r=(new Date).getTime(),n=Math.max(0,16-(r-t)),i=window.setTimeout(function(){e(r+n)},n);t=r+n;return i});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var n=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/"));n=n.substr(0,n.lastIndexOf("/")+1)+"css/ol.css";e.proj.get("EPSG:4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.get("urn:ogc:def:crs:EPSG::4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.get("http://www.opengis.net/gml/srs/epsg.xml#4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.oldGet=e.proj.get;e.proj.get=function(t){if("string"==typeof t){t=t.trim();TC.loadProjDef({crs:t,sync:!0})}return e.proj.oldGet.call(this,t)};e.format.GMLBase.prototype.readGeometryElement=function(t,o){var r=o[0];r.srsName=t.firstElementChild.getAttribute("srsName");if((this instanceof e.format.GML2CRS84||this instanceof e.format.GML3CRS84)&&("EPSG:4326"!==r.srsName||!r.srsName))throw new Error("Conflicto de CRS");r.srsName||(r.srsName=this.srsName);r.dataProjection=e.proj.get(r.srsName);var n=e.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS_,t,o,this);return n?e.format.Feature.transformWithOptions(n,!1,r):void 0};e.format.GMLBase.prototype.readFeatureElement=function(t,o){var r,n,i=t.getAttribute("fid")||e.xml.getAttributeNS(t,e.format.GMLBase.GMLNS,"id"),a={};for(r=t.firstElementChild;r;r=r.nextElementSibling){var s=r.localName;if(0===r.childNodes.length||1===r.childNodes.length&&(3===r.firstChild.nodeType||4===r.firstChild.nodeType)){var l=e.xml.getAllTextContent(r,!1);e.format.GMLBase.ONLY_WHITESPACE_RE_.test(l)&&(l=void 0);a[s]=l}else{a[s]=this.readGeometryElement(r,o);"boundedBy"!==s&&"referencePoint"!==s&&(n=s)}}var c=new e.Feature(a);n&&c.setGeometryName(n);i&&c.setId(i);return c};e.format.GML3.prototype._writePosList_=e.format.GML3.prototype.writePosList_;e.format.GML3.prototype.writePosList_=function(e,t,o){this._writePosList_(e,t,o);const r=t.getCoordinates()[0];r&&r.length>2&&e.setAttribute("srsDimension",r.length)};e.format.GML3.prototype._getCoords_=e.format.GML3.prototype.getCoords_;e.format.GML3.prototype.getCoords_=function(e,t){var o=this._getCoords_(e,t);e.length>2&&(o+=" "+e[2]);return o};e.format.GML3.prototype._writePos_=e.format.GML3.prototype.writePos_;e.format.GML3.prototype.writePos_=function(t,o,r){this._writePos_(t,o,r);const n=o.getCoordinates();n.length>2&&e.format.XSD.writeStringTextNode(t," "+n[2])};var i="http://www.opengis.net/gml",a="http://www.opengis.net/gml/3.2";e.format.GMLBase.prototype.MULTIPOINT_PARSERS_[a]=e.format.GMLBase.prototype.MULTIPOINT_PARSERS_[i];e.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[a]=e.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[i];e.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[a]=e.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[i];e.format.GMLBase.prototype.POINTMEMBER_PARSERS_[a]=e.format.GMLBase.prototype.POINTMEMBER_PARSERS_[i];e.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[a]=e.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[i];e.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[a]=e.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[i];e.format.GMLBase.prototype.RING_PARSERS[a]=e.format.GMLBase.prototype.RING_PARSERS[i];e.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_[a]=e.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_[i];e.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_[a]=e.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_[i];e.format.GML3.prototype.GEOMETRY_PARSERS_[a]=e.format.GML3.prototype.GEOMETRY_PARSERS_[i];e.format.GML3.prototype.MULTICURVE_PARSERS_[a]=e.format.GML3.prototype.MULTICURVE_PARSERS_[i];e.format.GML3.prototype.MULTISURFACE_PARSERS_[a]=e.format.GML3.prototype.MULTISURFACE_PARSERS_[i];e.format.GML3.prototype.CURVEMEMBER_PARSERS_[a]=e.format.GML3.prototype.CURVEMEMBER_PARSERS_[i];e.format.GML3.prototype.SURFACEMEMBER_PARSERS_[a]=e.format.GML3.prototype.SURFACEMEMBER_PARSERS_[i];e.format.GML3.prototype.SURFACE_PARSERS_[a]=e.format.GML3.prototype.SURFACE_PARSERS_[i];e.format.GML3.prototype.CURVE_PARSERS_[a]=e.format.GML3.prototype.CURVE_PARSERS_[i];e.format.GML3.prototype.ENVELOPE_PARSERS_[a]=e.format.GML3.prototype.ENVELOPE_PARSERS_[i];e.format.GML3.prototype.PATCHES_PARSERS_[a]=e.format.GML3.prototype.PATCHES_PARSERS_[i];e.format.GML3.prototype.SEGMENTS_PARSERS_[a]=e.format.GML3.prototype.SEGMENTS_PARSERS_[i];e.format.KML._createStyleDefaults_=e.format.KML.createStyleDefaults_;e.format.KML.createStyleDefaults_=function(){e.format.KML._createStyleDefaults_();e.format.KML.DEFAULT_FILL_STYLE_.color_=y(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity);e.format.KML.DEFAULT_TEXT_STYLE_.fill_=new e.style.Fill({color:e.format.KML.DEFAULT_COLOR_});e.format.KML.DEFAULT_STROKE_STYLE_.color_=y(TC.Cfg.styles.line.strokeColor,1);e.format.KML.DEFAULT_STROKE_STYLE_.width_=TC.Cfg.styles.line.strokeWidth;return e.format.KML.DEFAULT_STYLE_ARRAY_};e.format.KML.prototype._readDocumentOrFolder_=e.format.KML.prototype.readDocumentOrFolder_;e.format.KML.prototype.readDocumentOrFolder_=function(t,o){var r=e.format.KML.prototype._readDocumentOrFolder_.apply(this,arguments);if("Folder"==t.localName)for(var n=0;n<r.length;n++){var i=r[n];$.isArray(i._folders)||(i._folders=[]);var a=t.getElementsByTagName("name")[0];a&&TC.Util.fastUnshift(i._folders,a.innerHTML||a.textContent)}return r};e.format.KML.readText_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE);e.asserts.assert("text"==t.localName);return e.xml.getAllTextContent(t,!1).trim()};e.format.KML.BALLOON_STYLE_PARSERS_=e.xml.makeStructureNS(e.format.KML.NAMESPACE_URIS_,{text:e.xml.makeObjectPropertySetter(e.format.KML.readText_)});e.format.KML.BalloonStyleParser_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE);e.asserts.assert("BalloonStyle"==t.localName);var r=e.xml.pushParseAndPop({},e.format.KML.BALLOON_STYLE_PARSERS_,t,o);if(goog.isDef(r)){var n=o[o.length-1];e.asserts.assert(goog.isObject(n));var i=new e.style.Text({text:r.text});n.balloonStyle=i}};for(var s in e.format.KML.STYLE_PARSERS_){e.format.KML.STYLE_PARSERS_[s].BalloonStyle=e.format.KML.BalloonStyleParser_}e.format.KML.readStyle_=function(t,o){var r=e.xml.pushParseAndPop({},e.format.KML.STYLE_PARSERS_,t,o);if(!r)return null;var n="fillStyle"in r?r.fillStyle:e.format.KML.DEFAULT_FILL_STYLE_,i=r.fill;void 0===i||i||(n=null);var a="imageStyle"in r?r.imageStyle:e.format.KML.DEFAULT_IMAGE_STYLE_;a==e.format.KML.DEFAULT_NO_IMAGE_STYLE_&&(a=void 0);var s="textStyle"in r?r.textStyle:e.format.KML.DEFAULT_TEXT_STYLE_,l="strokeStyle"in r?r.strokeStyle:e.format.KML.DEFAULT_STROKE_STYLE_,c="balloonStyle"in r?r.balloonStyle:e.format.KML.DEFAULT_BALLOON_STYLE_,u=new e.style.Style({fill:n,image:a,stroke:l,text:s,zIndex:void 0});u._balloon=c;return[u]};e.format.KML._readURI_=e.format.KML.readURI_;e.format.KML.readURI_=function(t){var o=e.format.KML._readURI_(t);"https:"===location.protocol&&0===o.indexOf("http://")&&(o=o.substr(5));return o};for(var s in e.format.KML.ICON_PARSERS_)e.format.KML.ICON_PARSERS_[s].href=e.xml.makeObjectPropertySetter(e.format.KML.readURI_);e.format.KML.whenParser_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");e.asserts.assert("when"==t.localName,"localName should be when");var r=o[o.length-1];e.asserts.assert(goog.isObject(r),"gxTrackObject should be an Object");r=r.whens;var n=e.xml.getAllTextContent(t,!1);if(n=/^\s*(\d{4})($|-(\d{2})($|-(\d{2})($|T(\d{2}):(\d{2}):(\d{2})(?:.?\d{3})?(Z|(?:([+\-])(\d{2})(?::(\d{2}))?)))))\s*$/.exec(n)){var i=parseInt(n[1],10),a=n[3]?parseInt(n[3],10)-1:0,s=n[5]?parseInt(n[5],10):1,l=n[7]?parseInt(n[7],10):0,c=n[8]?parseInt(n[8],10):0,u=n[9]?parseInt(n[9],10):0;i=Date.UTC(i,a,s,l,c,u);n[10]&&"Z"!=n[10]&&(i+=60*(a="-"==n[11]?-1:1)*parseInt(n[12],10),n[13]&&(i+=3600*a*parseInt(n[13],10)));r.push(i)}else r.push(0)};e.format.KML.GX_TRACK_PARSERS_=e.xml.makeStructureNS(e.format.KML.NAMESPACE_URIS_,{when:e.format.KML.whenParser_},e.xml.makeStructureNS(e.format.KML.GX_NAMESPACE_URIS_,{coord:e.format.KML.gxCoordParser_}));e.format.KML.prototype.readFeatures=function(t,o){if("string"==typeof t){var r=t.indexOf("<kml");if(r>=0){r+="<kml".length;t.indexOf(">",r);t.indexOf("xmlns:xsi=")<0&&(t=t.substr(0,r)+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+t.substr(r));t=function(t,o){var r=e.xml.parse(t).getElementsByTagName(o.toLowerCase());if(r&&r.length>0){var n=r[0].getAttribute("xmlns");if(n&&n.indexOf(" ")>-1&&p.indexOf(n)>-1)for(var i=n.split(" "),a=[],s=0;s<i.length;s++)a.push("xmlns:"+o.toLowerCase()+s+'="'+i[s].trim()+'"')}return t}(t,"KML")}}return e.format.XMLFeature.prototype.readFeatures.call(this,t,o)};e.format.XSD.readDateTime=function(t){t=e.xml.getAllTextContent(t,!1);if(t=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?))\s*$/.exec(t)){var o=parseInt(t[1],10),r=parseInt(t[2],10)-1,n=parseInt(t[3],10),i=parseInt(t[4],10),a=parseInt(t[5],10),s=parseInt(t[6],10);o=Date.UTC(o,r,n,i,a,s);"Z"!=t[7]&&(o+=60*(r="-"==t[8]?-1:1)*parseInt(t[9],10),void 0!==t[10]&&(o+=3600*r*parseInt(t[10],10)));return o}};e.format.GPX.RTEPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime)});e.format.GPX.TRKPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime)});e.format.GPX.WPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime),magvar:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),geoidheight:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),name:e.xml.makeObjectPropertySetter(e.format.XSD.readString),cmt:e.xml.makeObjectPropertySetter(e.format.XSD.readString),desc:e.xml.makeObjectPropertySetter(e.format.XSD.readString),src:e.xml.makeObjectPropertySetter(e.format.XSD.readString),link:e.format.GPX.parseLink_,sym:e.xml.makeObjectPropertySetter(e.format.XSD.readString),type:e.xml.makeObjectPropertySetter(e.format.XSD.readString),fix:e.xml.makeObjectPropertySetter(e.format.XSD.readString),sat:e.xml.makeObjectPropertySetter(e.format.XSD.readNonNegativeInteger),hdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),vdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),pdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),ageofdgpsdata:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),dgpsid:e.xml.makeObjectPropertySetter(e.format.XSD.readNonNegativeInteger),extensions:e.format.GPX.parseExtensions_});e.format.XSD.writeDateTimeTextNode=function(t,o){var r=new Date(o),n=r.getUTCFullYear()+"-"+e.string.padNumber(r.getUTCMonth()+1,2)+"-"+e.string.padNumber(r.getUTCDate(),2)+"T"+e.string.padNumber(r.getUTCHours(),2)+":"+e.string.padNumber(r.getUTCMinutes(),2)+":"+e.string.padNumber(r.getUTCSeconds(),2)+"Z";t.appendChild(e.xml.DOCUMENT.createTextNode(n))};e.format.GPX.WPT_TYPE_SERIALIZERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),time:e.xml.makeChildAppender(e.format.XSD.writeDateTimeTextNode),magvar:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),geoidheight:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),name:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),cmt:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),desc:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),src:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),link:e.xml.makeChildAppender(e.format.GPX.writeLink_),sym:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),type:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),fix:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),sat:e.xml.makeChildAppender(e.format.XSD.writeNonNegativeIntegerTextNode),hdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),vdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),pdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),ageofdgpsdata:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),dgpsid:e.xml.makeChildAppender(e.format.XSD.writeNonNegativeIntegerTextNode)});const l=TC.Util.detectMouse()?3:10;var c=function(e){for(var t=[],o=[],r=Math.pow(2,e.length),n=0;n<r;n++){o=[];for(var i=0;i<e.length;i++)n&Math.pow(2,i)&&-1==o.indexOf(e[i])&&o.push(e[i]);o.length>0&&-1==t.indexOf(o.join(" "))&&t.push(o.join(" "))}return t},u=function(e,t){if(e&&e.length>0)for(var o=0;o<t.length;o++){var r=e.indexOf(t[o]);r>-1&&e.splice(r,1)}},h=function(e,t){for(var o=0;o<e.length;o++)for(var r=e[o],n=0;n<t.length;n++){var i=t[n].split(" ")[0];r[t[n]]=r[i]}},d=[e.format.KML.DATA_PARSERS_,e.format.KML.EXTENDED_DATA_PARSERS_,e.format.KML.REGION_PARSERS_,e.format.KML.LAT_LON_ALT_BOX_PARSERS_,e.format.KML.LOD_PARSERS_,e.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e.format.KML.FLAT_LINEAR_RING_PARSERS_,e.format.KML.FLAT_LINEAR_RINGS_PARSERS_,e.format.KML.GX_TRACK_PARSERS_,e.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_,e.format.KML.ICON_PARSERS_,e.format.KML.ICON_STYLE_PARSERS_,e.format.KML.INNER_BOUNDARY_IS_PARSERS_,e.format.KML.LABEL_STYLE_PARSERS_,e.format.KML.LINE_STYLE_PARSERS_,e.format.KML.MULTI_GEOMETRY_PARSERS_,e.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_,e.format.KML.NETWORK_LINK_PARSERS_,e.format.KML.LINK_PARSERS_,e.format.KML.OUTER_BOUNDARY_IS_PARSERS_,e.format.KML.PAIR_PARSERS_,e.format.KML.PLACEMARK_PARSERS_,e.format.KML.POLY_STYLE_PARSERS_,e.format.KML.SCHEMA_DATA_PARSERS_,e.format.KML.STYLE_PARSERS_,e.format.KML.STYLE_MAP_PARSERS_],p=c(e.format.KML.NAMESPACE_URIS_.slice().slice(1));u(p,e.format.KML.NAMESPACE_URIS_);e.format.KML.NAMESPACE_URIS_=e.format.KML.NAMESPACE_URIS_.concat(p);h(d,p);var f=[e.format.GPX.GPX_PARSERS_,e.format.GPX.LINK_PARSERS_,e.format.GPX.RTE_PARSERS_,e.format.GPX.RTEPT_PARSERS_,e.format.GPX.TRK_PARSERS_,e.format.GPX.TRKSEG_PARSERS_,e.format.GPX.TRKPT_PARSERS_,e.format.GPX.WPT_PARSERS_,e.format.GPX.LINK_SERIALIZERS_,e.format.GPX.RTE_SEQUENCE_,e.format.GPX.RTE_SERIALIZERS_,e.format.GPX.RTEPT_TYPE_SEQUENCE_,e.format.GPX.TRK_SEQUENCE_,e.format.GPX.TRK_SERIALIZERS_,e.format.GPX.TRKSEG_SERIALIZERS_,e.format.GPX.WPT_TYPE_SEQUENCE_,e.format.GPX.WPT_TYPE_SERIALIZERS_,e.format.GPX.GPX_SERIALIZERS_],g=c(e.format.GPX.NAMESPACE_URIS_.slice().slice(1));u(g,e.format.GPX.NAMESPACE_URIS_);e.format.GPX.NAMESPACE_URIS_=e.format.GPX.NAMESPACE_URIS_.concat(g);h(f,g);e.format.GML3Patched=function(t){var o=new e.format.GML(t);o.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS].featureMember=e.xml.makeArrayPusher(e.format.GMLBase.prototype.readFeaturesInternal);return o};e.format.GMLBase.prototype.readFeaturesInternal=function(t,o){e.DEBUG&&console.assert(t.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");var r=t.localName,n=null;if("FeatureCollection"==r){var i=this.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS];i.member||(i.member=e.xml.makeArrayPusher(e.format.GMLBase.prototype.readFeaturesInternal));if("http://www.opengis.net/wfs"===t.namespaceURI)n=e.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,t,o,this);else{this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS];n=e.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,t,o,this)}}else if("featureMembers"==r||"featureMember"==r||"member"==r){var a,s=o[0],l=s.featureType,c=s.featureNS;if(t.childNodes){l=[],c={};for(S=0,a=t.childNodes.length;S<a;++S){var u=t.childNodes[S];if(1===u.nodeType){var h=u.nodeName.split(":").pop();if(-1===l.indexOf(h)){var d="",p=0,f=u.namespaceURI;for(var g in c){if(c[g]===f){d=g;break}++p}d||(c[d="p"+p]=f);l.push(d+":"+h)}}}if("featureMember"!=r&&"member"!=r){s.featureType=l;s.featureNS=c}}if("string"==typeof c){var m=c;(c={}).p0=m}var y={},C=Array.isArray(l)?l:[l];for(var v in c){var T={};for(S=0,a=C.length;S<a;++S){(-1===C[S].indexOf(":")?"p0":C[S].split(":")[0])===v&&(T[C[S].split(":").pop()]="featureMembers"==r?e.xml.makeArrayPusher(this.readFeatureElement,this):e.xml.makeReplacer(this.readFeatureElement,this))}y[c[v]]=T}n="featureMember"==r||"member"==r?e.xml.pushParseAndPop(void 0,y,t,o):e.xml.pushParseAndPop([],y,t,o)}null===n&&(n=[]);var _=function(e){var t=e.getGeometry();if(e.getProperties().hasOwnProperty(e.getGeometryName())&&(!t||!t.flatCoordinates.length))throw"Geometr\xeda no v\xe1lida. \xbfPosible versi\xf3n incorrecta de GML?"};if(n instanceof e.Feature)_(n);else for(var S=0,E=n.length;S<E;S++)_(n[S]);return n};e.format.GML3CRS84=function(){e.format.GML3.call(this,{srsName:"CRS:84"})};e.inherits(e.format.GML3CRS84,e.format.GML3);e.format.GML2CRS84=function(){e.format.GML2.call(this,{srsName:"CRS:84"})};e.inherits(e.format.GML2CRS84,e.format.GML2);e.View.prototype.getValueForResolutionFunction=function(e){var t=e||2,o=this.maxResolution_,r=this.minResolution_,n=Math.log(o/r)/Math.log(t);return function(e){var r=Math.log(o/e)/Math.log(t)/n;return r=Math.max(Math.min(1,r),0)}};e.control.OverviewMap.prototype._validateExtent_=e.control.OverviewMap.prototype.validateExtent_;e.control.OverviewMap.prototype.validateExtent_=function(){this._validateExtent_();this._wrap&&this._wrap.parent.options.alwaysCentered&&this.recenter_()};e.control.OverviewMap.prototype._resetExtent_=e.control.OverviewMap.prototype.resetExtent_;e.control.OverviewMap.prototype.resetExtent_=function(){this._resetExtent_.call(this);var t=this._wrap;if(t.is3D){var o=this.ovmap_.getView(),r=o.calculateExtent(),n=t.get3DCameraLayer().getSource().getFeatures()[0];if(n){coordinates=n.getGeometry().getCoordinates();var i=coordinates[0][0],a=coordinates[0][1];if(!e.extent.containsCoordinate(r,i)||!e.extent.containsCoordinate(r,a)){var s=Math.max(r[0]-i[0],r[1]-i[1],i[0]-r[2],i[1]-r[3],r[0]-a[0],r[1]-a[1],a[0]-r[2],a[1]-r[3]);o.fit(e.extent.buffer(r,s))}}}};const m=e.Image;e.Image=function(){7===arguments.length&&Array.prototype.splice.call(arguments,3,1);return m.apply(this,arguments)};TC.inherit(e.Image,m);TC.Util.detectMobile()||(e.Overlay.prototype.updateRenderedPosition=function(t,o){var r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);var a=n[0],s=n[1];if(i==e.OverlayPositioning.BOTTOM_RIGHT||i==e.OverlayPositioning.CENTER_RIGHT||i==e.OverlayPositioning.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=r.left="");var l=Math.round(o[0]-t[0]-a)/window.devicePixelRatio+"px";this.rendered.right_!=l&&(this.rendered.right_=r.right=l)}else{""!==this.rendered.right_&&(this.rendered.right_=r.right="");i!=e.OverlayPositioning.BOTTOM_CENTER&&i!=e.OverlayPositioning.CENTER_CENTER&&i!=e.OverlayPositioning.TOP_CENTER||(a-=this.element.offsetWidth/2);var c=Math.round(t[0]+a)/window.devicePixelRatio+"px";this.rendered.left_!=c&&(this.rendered.left_=r.left=c)}if(i==e.OverlayPositioning.BOTTOM_LEFT||i==e.OverlayPositioning.BOTTOM_CENTER||i==e.OverlayPositioning.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=r.top="");var u=Math.round(o[1]-t[1]-s)/window.devicePixelRatio+"px";this.rendered.bottom_!=u&&(this.rendered.bottom_=r.bottom=u)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=r.bottom="");i!=e.OverlayPositioning.CENTER_LEFT&&i!=e.OverlayPositioning.CENTER_CENTER&&i!=e.OverlayPositioning.CENTER_RIGHT||(s-=this.element.offsetHeight/2);var h=Math.round(t[1]+s)/window.devicePixelRatio+"px";this.rendered.top_!=h&&(this.rendered.top_=r.top=h)}});var y=function(t,o){var r;if(t){r=(r=e.color.asArray(t)).slice();void 0!==o&&(r[3]=o)}else r=[0,0,0,1];return r},C=function(e,t){var o=e.map.getView(),r=o.getResolution(),n={projection:o.getProjection(),center:o.getCenter(),resolution:r,enableRotation:!1};e.parent.maxExtent&&(n.extent=e.parent.maxExtent);var i=t;t.type===TC.Consts.layerType.VECTOR&&e.parent.getBaseLayer()&&(i=e.parent.getBaseLayer());var a,s,l=i.getResolutions?i.getResolutions():[];if(l&&l.length){a=i.maxResolution||l[0];s=i.minResolution||l[l.length-1];var c=l.indexOf(s),u=l.indexOf(a);n.resolutions=l.slice(u,c+1)}else{a=i.maxResolution;s=i.minResolution}if(s){n.minResolution=s;r<s&&(n.resolution=s)}if(a){n.maxResolution=a;r>a&&(n.resolution=a)}return n};TC.wrap.Map.prototype.setMap=function(){var t=this,o=[(t.parent.initialExtent[0]+t.parent.initialExtent[2])/2,(t.parent.initialExtent[1]+t.parent.initialExtent[3])/2],r=proj4(t.parent.crs);!function(){var o=t.parent.crs.substr(t.parent.crs.lastIndexOf(":")+1),n={units:r.oProj.units,global:!0},i=[];if("4326"!==o){n.code="EPSG:"+o;i.push(new e.proj.Projection(n));n.code="urn:ogc:def:crs:EPSG::"+o;i.push(new e.proj.Projection(n));e.proj.addEquivalentProjections(i)}var a=function(e,t,o,r){for(var n=[],i=r||2,a=0;a<t.length;a+=i){var s=Array.prototype.slice.call(e(t.slice(a,a+i)));3!==i&&4!==i||(s=s.slice(0,2).concat(t.slice(a+2,a+2+(i-2))));n=n.concat(s)}if($.isArray(o)){o.length=0;for(a=0;a<n.length;a++)o[a]=n[a];n=o}return n};e.proj.addEquivalentTransforms(e.proj.EPSG4326.PROJECTIONS,i,function(e,t,o){return a(r.forward,e,t,o)},function(e,t,o){return a(r.inverse,e,t,o)})}();var n={code:t.parent.crs,units:r.oProj.units};"EPSG:4326"===t.parent.crs&&(n.axisOrientation="neu");var i=new e.proj.Projection(n),a=e.interaction.defaults({constrainResolution:!0}),s={projection:i,center:o,enableRotation:!1};if(t.parent.maxExtent){var c=t.parent.maxExtent;s.extent=c;var u=t.parent.div.getBoundingClientRect(),h=(u.width,u.height,c[2]-c[0]),d=c[3]-c[1];u.width/u.height>h/d?s.resolution=h/u.width:s.resolution=d/u.height}else s.zoom=2;t.map=new e.Map({target:t.parent.div,renderer:e.renderer.Type.CANVAS,view:new e.View(s),controls:[],interactions:a,pixelRatio:1});TC.Util.detectMobile()||(t.map.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect(),o=e.changedTouches?e.changedTouches[0]:e;return[((o=o.clientX?o:o.pointerEvent?o.pointerEvent:o).clientX-t.left)*window.devicePixelRatio,(o.clientY-t.top)*window.devicePixelRatio]});t.map._wrap=t;t._promise=Promise.resolve(t.map);t.manageSize.call(t.map);var p=function(){t.map.updateSize()};t.parent.div.addEventListener(e.events.EventType.RESIZE,p);t.parent.one(TC.Consts.event.MAPLOAD,p);t.map.on(e.MapBrowserEventType.SINGLECLICK,function(e){if(t.parent.view!==TC.Consts.view.PRINTING){t.parent.workLayers.forEach(function(e){delete e._noFeatureClicked});var o=$.map(t.parent.workLayers,function(){return!1});t.map.forEachFeatureAtPixel(e.pixel,function(e,r){if(e._wrap&&e._wrap.parent.showsPopup){for(var n=0;n<t.parent.workLayers.length;n++){if(t.parent.workLayers[n].wrap.layer===r){o[n]=!0;break}}t.parent.trigger(TC.Consts.event.FEATURECLICK,{feature:e._wrap.parent});return e}},{hitTolerance:l});for(var r=0;r<o.length;r++)o[r]||t.parent.trigger(TC.Consts.event.NOFEATURECLICK,{layer:t.parent.workLayers[r]})}});const f=function(){t.map.on(e.MapEventType.MOVEEND,function(){t.parent.trigger(TC.Consts.event.ZOOM)})};t.map.getView().on("change:resolution",function(){t.map.hasListener(e.MapEventType.MOVEEND)||t.map.once(e.MapEventType.MOVEEND,function(){f()});t.parent.trigger(TC.Consts.event.BEFOREZOOM)},t.parent);const g=function(){if(!t.map.hasListener(e.MapEventType.MOVEEND)){t.map.un("change:view",g);f()}};t.map.on("change:view",g);var m=function(o){t.map.getView().getResolution(),t.map.getView().getZoom();var r=C(t,o),n=new e.View(r);t.map.setView(n);t.map.render()};t.parent.on(TC.Consts.event.BASELAYERCHANGE,function(e){t.parent.crs!==t.parent.options.crs||t.parent.on3DView||e.layer.type===TC.Consts.layerType.VECTOR||m(e.layer)});t.parent.on(TC.Consts.event.MAPLOAD,function(e){m(t.parent.getBaseLayer())});t.map.getViewport().addEventListener(TC.Consts.event.MOUSEMOVE,function(e){var o=t.map.getTarget(),r=!1;if(!t.parent.activeControl||!t.parent.activeControl.isExclusive()){if(t.parent.view===TC.Consts.view.PRINTING)return;var n=t.map.getEventPixel(e);r=t.map.forEachFeatureAtPixel(n,function(e,o){var r=!0;!e._wrap||e._wrap.parent.showsPopup||e._wrap.parent.options.selectable||(r=!1);r&&e._wrap&&t.parent.trigger(TC.Consts.event.FEATUREOVER,{feature:e._wrap.parent});return r},{hitTolerance:l})}o.style.cursor=r?"pointer":""})};var v=function(t,o){var r=t.getUnits();return r&&r!==e.proj.Units.DEGREES?e.proj.METERS_PER_UNIT[r]:TC.Util.getMetersPerDegree(o)};TC.wrap.Map.prototype.getMetersPerUnit=function(){return v(e.proj.get(this.parent.crs),this.getExtent())};var T=function(t){t=t||{};var o=this.parent.options.crs||TC.Cfg.crs,r=e.proj.get(o),n=e.proj.get(t.crs);return v(n,t.extentInDegrees)/v(r,t.extentInDegrees)},_=function(t){var o;(o=t.axisOrientation?new e.proj.Projection({code:t.crs,axisOrientation:t.axisOrientation}):e.proj.get(t.crs)).getUnits()||(o.units_=e.proj.Units.DEGREES);return o};TC.wrap.Map.prototype.setProjection=function(t){const o=this,r=(t=t||{}).baseLayer||o.parent.baseLayer;var n;n=t.extent?t.extent:e.proj.transformExtent(o.getExtent(),o.parent.crs,t.crs);const i=e.proj.transformExtent(n,t.crs,"EPSG:4326"),a=T.call(o,{crs:t.crs,extentInDegrees:i}),s=_(t),l=o.map.getView(),c={projection:s,enableRotation:!1},u=r.getResolutions();if(u&&u.length)c.resolutions=u;else{c.minZoom=l.getMinZoom();c.maxZoom=l.getMaxZoom();const e=r.wrap.layer.getMinResolution(),t=r.wrap.layer.getMaxResolution();var h=1;if(0===e||t===Number.POSITIVE_INFINITY){h=T.call(o,{crs:o.parent.crs,extentInDegrees:i})/a}c.minResolution=0===e?l.getMinResolution()*h:e;t===Number.POSITIVE_INFINITY?c.maxResolution=l.getMaxResolution()*h:c.maxResolution=t}c.center=e.proj.transform(o.getCenter(),o.parent.crs,t.crs);var d=new e.View(c);o.map.setView(d);o.parent.initialExtent=1!==a?e.proj.transformExtent(o.parent.initialExtent,o.parent.crs,t.crs):o.parent.options.initialExtent;o.parent.options.maxExtent&&(o.parent.options.maxExtent=o.parent.maxExtent=1!==a?e.proj.transformExtent(o.parent.maxExtent,o.parent.crs,t.crs):o.parent.options.maxExtent);d.fit(n,{nearest:!0})};TC.wrap.Map.prototype.insertLayer=function(t,o){for(var r=this,n=r.map.getLayers(),i=!1,a=0;a<n.getLength();a++)if(n.item(a)===t){i=!0;break}if(i){n.remove(t);n.insertAt(o,t)}else{o<0?n.push(t):n.insertAt(o,t);var s=r.map.getView();if(r.parent.crs===r.parent.options.crs){if(t instanceof e.layer.Tile){var l=t.getSource().getResolutions();s.maxResolution_=l[0];s.minResolution_=l[l.length-1]}}else if(t instanceof e.layer.Tile){t.setMaxResolution(s.getMaxResolution());t.setMinResolution(s.getMinResolution())}var c=t._wrap,u=0,h=function(e){c.parent.state=TC.Layer.state.LOADING;if(u<=0){u=0;r.parent.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:c.parent})}t._loadingTileCount=t._loadingTileCount+1};c.parent.state===TC.Layer.state.LOADING&&c.parent.isRaster()&&h();c.$events.on(TC.Consts.event.BEFORETILELOAD,h);c.$events.on(TC.Consts.event.TILELOAD,function(e){if((u-=1)<=0){u=0;c.parent.state=TC.Layer.state.IDLE;r.parent.trigger(TC.Consts.event.LAYERUPDATE,{layer:c.parent})}})}};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()};TC.wrap.Map.prototype.indexOfFirstVector=function(){var t=-1;this.map.getLayerGroup().getLayers().forEach(function(o,r){o instanceof e.layer.Vector&&-1===t&&(t=r)});return t};TC.wrap.Map.prototype.getLayerIndex=function(e){var t=-1;this.map.getLayerGroup().getLayers().forEach(function(o,r){o===e&&(t=r)});return t};TC.wrap.Map.prototype.setLayerIndex=function(e,t){var o=this.map.getLayers().getArray().indexOf(e);if(o>-1&&o!=t){this.map.removeLayer(e);this.insertLayer(e,t)}};TC.wrap.Map.prototype.setBaseLayer=function(t){var o=this;return new Promise(function(r,n){var i=function(n){if(n=n||o.parent.getBaseLayer()){o.map.removeLayer(n.wrap.layer);if(t instanceof e.layer.Image){T.call(o,{crs:o.parent.crs,extent:o.parent.getExtent()});t._wrap.setProjection({crs:o.parent.crs})}if(t._wrap.parent.type===TC.Consts.layerType.WMTS){var i={crs:o.parent.crs,oldCrs:t.getSource().getProjection().getCode()};i.oldCrs!==i.crs&&t._wrap.parent.setProjection(i)}}o.insertLayer(t,0);r()},a=C(o,t._wrap.parent),s=o.map.getView(),l=s.getResolution();if(o.parent.crs===o.parent.options.crs&&a.resolutions){var c=a.resolutions.sort(function(e,t){return e-t}).reduce(function(e,t){return 0===e&&(t>l||Math.abs(1-l/t)<o.parent.options.maxResolutionError)?t:e},0);if(c!==l)if(o.parent.isLoaded)s.animate({resolution:c,duration:TC.Consts.ZOOM_ANIMATION_DURATION},i.bind(o,o.parent.getBaseLayer()));else{s.setResolution(c);i()}else i()}else i()})};TC.wrap.Map.prototype.setExtent=function(t,o){const r=this;o=o||{};const n=function(e,r,n,i){var a=e.getResolutionForExtent(t,r);if(e.constrainResolution){var s=e.constrainResolution(a,0,0);s<a&&s/a<TC.Consts.EXTENT_TOLERANCE&&(s=e.constrainResolution(s,-1,0));a=s}const l=[(t[0]+t[2])/2,(t[1]+t[3])/2];if(void 0===o.animate||o.animate)e.animate({resolution:a,center:l,duration:TC.Consts.ZOOM_ANIMATION_DURATION},n);else{e.setCenter(l);e.setResolution(a);n()}};Promise.resolve(r._setExtentPromise).finally(function(){!function(t,o){r._setExtentPromise=new Promise(function(o,i){clearTimeout(r._timeout);r._timeout=setTimeout(function(){var i=r.map.getSize(),a=r.map.getView();r.parent.baseLayer?r.parent.baseLayer.wrap.getLayer().then(function(s){if(s.getSource().getResolutions!=goog.abstractMethod){var l=a.getResolutionForExtent(t,i),c=r.map.getView().getResolutions();if(c&&c.length>0){var u=Math.min.apply(r,c);if(u>l){var h=.5*(u/l-1),d=e.extent.getWidth(t)*h,p=e.extent.getHeight(t)*h;(t=t.slice(0))[0]=t[0]-d;t[1]=t[1]-p;t[2]=t[2]+d;t[3]=t[3]+p}}}n(a,i,o)}):n(a,i,o)},50)})}(t)});return r._setExtentPromise};TC.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())};TC.wrap.Map.prototype.setCenter=function(e,t){const o=this;return new Promise(function(r,n){const i=function(){r()},a=t||{},s=o.map.getView();if(a.animate)s.animate({center:e,duration:TC.Consts.ZOOM_ANIMATION_DURATION},i);else{s.setCenter(e);r()}})};TC.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()};TC.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()};TC.wrap.Map.prototype.setResolution=function(e){this.getMap().then(function(t){t.getView().setResolution(e)})};TC.wrap.Map.prototype.setRotation=function(e){this.getMap().then(function(t){t.getView().setRotation(e)})};TC.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()};TC.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){return this.map.getCoordinateFromPixel(e)};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)};TC.wrap.Map.prototype.getViewport=function(e){const t=this;return(e||{}).synchronous?t.map.getViewport():new Promise(function(e,o){t.getMap().then(function(t){e(t.getViewport())})})};TC.wrap.Map.prototype.isNative=function(t){return t instanceof e.Map};TC.wrap.Map.prototype.isGeo=function(){var t=this.map.getView().getProjection().getUnits();return!t||t===e.proj.Units.DEGREES};TC.wrap.Map.prototype.addPopup=function(t){const o=this;return new Promise(function(r,n){var i=void 0===t.options.draggable||t.options.draggable;TC.loadJS(i&&!window.Draggabilly,[TC.apiLocation+"lib/draggabilly/draggabilly.pkgd.min.js"],function(){o.getMap().then(function(r){if(!t.popupDiv){const a=TC.Util.getDiv();t.popupDiv=a;t.$popupDiv=$(a);a.classList.add(TC.control.Popup.prototype.CLASS);t.contentDiv=TC.Util.getDiv();t.contentDiv.classList.add(TC.control.Popup.prototype.CLASS+"-content");t.popupDiv.appendChild(t.contentDiv);t.menuDiv=TC.Util.getDiv();t.menuDiv.classList.add(TC.control.Popup.prototype.CLASS+"-menu");t.popupDiv.appendChild(t.menuDiv);o.parent.div.appendChild(a);var n=new e.Overlay({element:a,positioning:e.OverlayPositioning.BOTTOM_LEFT});r.addOverlay(n);t.wrap.popup=n;const s=r.getViewport();if(i){const e=t.popupDiv.parentElement;t.popupDiv.classList.add(TC.Consts.classes.DRAGGABLE);e.addEventListener("touchmove",function(e){for(var t=e.target;t;)if((t=t.parentElement)&&t.matches(".tc-ctl-finfo-layer-content")){e.stopPropagation();break}});const o=new Draggabilly(e,{not:"th,td, td *,input,select,.tc-ctl-finfo-coords"});o.handleEvent=function(e){this.options.not&&e.target&&e.target.matches(this.options.not)||Draggabilly.prototype.handleEvent.call(this,e)};o.on("pointerDown",function(e,t){var r=e.target.getBoundingClientRect();if(r.left+e.target.clientWidth<t.pageX||r.top+e.target.clientHeight<t.pageY){o._pointerCancel(e,t);return!1}});o.on("dragStart",function(e,o){t.setDragging(!0);t._currentOffset=n.getOffset();if(t._previousContainerPosition){var i=r.getSize();n.setPosition(r.getCoordinateFromPixel([t._previousContainerPosition[0],i[1]-t._previousContainerPosition[1]]));t._currentOffset=[0,0];n.setOffset(t._currentOffset);delete t._previousContainerPosition}else t._currentOffset=n.getOffset()});o.on("dragEnd",function(o){t.setDragging(!1);var i=r.getCoordinateFromPixel([0,0]),a=r.getCoordinateFromPixel(n.getOffset()),s=[a[0]-i[0],a[1]-i[1]],l=n.getPosition();n.setPosition([l[0]+s[0],l[1]+s[1]]);n.setOffset([0,0]);t._currentOffset=[0,0];const c=e.getBoundingClientRect();t._previousContainerPosition=[c.left,c.bottom]});o.on("dragMove",function(e,t,o){})}const c=function(e){var t=r.getTarget(),n=!1;if(!o.parent.activeControl||!o.parent.activeControl.isExclusive()){var i=r.getEventPixel(e);n=r.forEachFeatureAtPixel(i,function(e,t){var o=!0;e._wrap&&!e._wrap.parent.showsPopup&&(o=!1);return o},{hitTolerance:l})}t.style.cursor=n?"pointer":""};s.removeEventListener("mousemove",c);s.addEventListener("mousemove",c)}});r()})})};TC.wrap.Map.prototype.hidePopup=function(e){this.parent.currentFeature=null;e.popupDiv&&e.popupDiv.classList.remove(TC.Consts.classes.VISIBLE)};TC.wrap.Map.prototype.manageSize=function(){const t=this,o=function(e){var t=window.devicePixelRatio||1,o=e.context.canvas.getBoundingClientRect(),r=t*o.width,n=t*o.height;r===o.width&&Number.isInteger(r)||(r=Math.round(r));n===o.height&&Number.isInteger(n)||(n=Math.round(n));if(r!==o.width||n!==o.height){var i=[r,n];e.target.setSize(i)}};TC.Util.detectMobile()||t.on(e.render.EventType.POSTCOMPOSE,o)};var S=function(t){switch(t){case TC.Consts.layerType.KML:case TC.Consts.mimeType.KML:return new e.format.KML({showPointNames:!1});case TC.Consts.layerType.GPX:case TC.Consts.mimeType.GPX:return new e.format.GPX;case TC.Consts.layerType.GEOJSON:case TC.Consts.mimeType.GEOJSON:case TC.Consts.mimeType.JSON:case TC.Consts.format.JSON:return new e.format.GeoJSON;case TC.Consts.format.GML2:return new e.format.GML2;case TC.Consts.format.GML3:return new e.format.GML3Patched;case TC.Consts.mimeType.GML:case TC.Consts.format.GML:return new e.format.GML;case TC.Consts.format.TOPOJSON:return new e.format.TopoJSON;case TC.Consts.format.WKT:return new e.format.WKT;default:return null}};TC.wrap.Map.prototype.exportFeatures=function(t,o){o=o||{};var r=R({styles:this.parent.options.styles}),n=t.map(function(e){var t=e.wrap.feature;t.getStyle()||t.setStyle(r);const o=z.call(t).getText();o&&(t=t.clone()).setProperties({name:o.getText()});return t}),i=S(o.format);if(i instanceof e.format.KML){const t=[];(n=n.map(function(t){const o=t.getGeometry();if(o instanceof e.geom.Point){var r=z.call(t);const n=r.getImage();if(n instanceof e.style.RegularShape){const i=n.getRadius(),a=n.getStroke(),s=(n.getFill(),2*i+a.getWidth()+1),l=s/2,c=document.createElement("canvas");c.width=s;c.height=s;const u=e.render.toContext(c.getContext("2d"),{size:[s,s]}),h=r.getText();(r=r.clone()).setText();u.setStyle(r);u.drawGeometry(new e.geom.Point([l,l]));const d=new e.Feature(o);d.setProperties(t.getProperties());d.setStyle(new e.style.Style({image:new e.style.Icon({src:c.toDataURL("image/png")}),text:h}));return d}}return t})).forEach(function(o){var r=z.call(o);const n=o.getGeometry(),i=r.getText();var a;if(i){switch(!0){case n instanceof e.geom.LineString:a=new e.geom.Point(n.getCoordinateAt(.5));break;case n instanceof e.geom.Polygon:a=n.getInteriorPoint();break;case n instanceof e.geom.MultiLineString:const t=n.getLineStrings();var s=-1;a=new e.geom.Point(t[t.map(function(e){return e.getLength()}).reduce(function(e,t,o){if(t>s){s=t;return o}return e},-1)].getCoordinateAt(.5));break;case n instanceof e.geom.MultiPolygon:const o=n.getPolygons();var l=-1;a=o[o.map(function(e){return e.getArea()}).reduce(function(e,t,o){if(t>l){l=t;return o}return e},-1)].getInteriorPoint()}if(a){const o=new e.Feature(a);o.setStyle(new e.style.Style({text:i.clone(),image:new e.style.Icon({crossOrigin:"anonymous",src:TC.apiLocation+"TC/css/img/transparent.gif"})}));t.push(o)}}});t.length&&(n=n.concat(t))}if(i instanceof e.format.GMLBase){(n=n.map(function(e){return e.clone()})).forEach(function(e){const t=e.values_,o=[];for(var r in t)r.indexOf(" ")>=0&&o.push(r);o.forEach(function(e){var o=e.replace(/ /g,"_");/^\d/.test(o)&&(o="_"+o);if(e!==o)for(;void 0!==t[o];)o+="_";t[o]=t[e];delete t[e]})});i.featureNS="sitna";i.featureType="feature";var a=i.writeFeaturesNode(n,{featureProjection:this.parent.crs}),s=e.xml.createElementNS("http://www.opengis.net/gml","FeatureCollection");e.xml.setAttributeNS(s,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",i.schemaLocation);a.removeAttribute("xmlns:xsi");a.removeAttribute("xsi:schemaLocation");s.appendChild(a)}i instanceof e.format.GPX&&(n=n.map(function(t){const o=t.getGeometry();o instanceof e.geom.LineString&&(t=t.clone()).setGeometry(new e.geom.MultiLineString([o.getCoordinates()]));return t}));var l=i.writeFeatures(n,{dataProjection:"EPSG:4326",featureProjection:this.parent.crs});i instanceof e.format.GPX&&(l=l.replace(/<ele>NaN<\/ele>/g,""));return l};var E=function(e){for(var t=0,o=e.dataTransfer.types.length;t<o;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1},L=function(e){if(E(e)){this.getMap()._wrap.parent.div.classList.add(TC.Consts.classes.DROP);e.preventDefault();e.stopPropagation()}},w=function(e){if(E(e)){var t=this.getMap()._wrap.parent;e.target===this.target&&t.div.classList.remove(TC.Consts.classes.DROP)}};TC.wrap.Map.prototype.enableDragAndDrop=function(t){var o=this,r=t||{},n={formatConstructors:[e.format.KML,e.format.GPX,e.format.GML3CRS84,e.format.GML2CRS84,e.format.GML3Patched,e.format.GML2,e.format.GeoJSON,function(){return new e.format.WKT({splitCollection:!0})},e.format.TopoJSON]};r.dropTarget?n.target=TC.getDiv(r.dropTarget):n.target=o.parent.div;var i=new e.interaction.DragAndDrop(n);i.on(e.interaction.DragAndDrop.EventType_.ADD_FEATURES,function(e){var t=e.features?e.features.map(function(e){return TC.wrap.Feature.createFeature(e)}):[];Promise.all(t).then(function(t){var r=o.parent.getLoadingIndicator();r&&r.removeWait(o._featureImportWaitId);t.length&&!t.some(function(e){return!e.geometry})?o.parent.trigger(TC.Consts.event.FEATURESIMPORT,{features:t,fileName:e.file.name,dropTarget:e.target.target}):o.parent.trigger(TC.Consts.event.FEATURESIMPORTERROR,{file:e.file})})});if(r.once)i.map_=o.map;else{o.map.addInteraction(i);var a=i.target?i.target:o.map.getViewport(),s=function(e){if(E(e)){var t=o.parent;if(i.target===e.target){var r=t.getLoadingIndicator();r&&(o._featureImportWaitId=r.addWait());e.stopPropagation()}else e.preventDefault();t.div.classList.remove(TC.Consts.classes.DROP)}};i.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DRAGENTER,L,i));i.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DRAGENTER,L,i));i.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DRAGOVER,L,i));i.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DRAGOVER,L,i));i.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DROP,s,i));i.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DROP,s,i));i.dropListenKeys_.push(e.events.listen(document.body,"dragleave",w,i));i.dropListenKeys_.push(e.events.listen(document.body,"dragend",w,i));i.dropListenKeys_.push(e.events.listen(document.body,"dragexit",w,i));document.addEventListener("mouseenter",function(e){e.buttons||o.parent.div.classList.remove(TC.Consts.classes.DROP)},!1);o.ddEnabled=!0}return i};TC.wrap.Map.prototype.loadFiles=function(t,o){var r,n=this;n.ddEnabled?n.map.getInteractions().forEach(function(t){t instanceof e.interaction.DragAndDrop&&(r=t)}):r=n.enableDragAndDrop({once:!0});if(r&&o){var i=r.target;r.target=o.control;const e=function(t){r.target=i;n.parent.off(TC.Consts.event.FEATURESIMPORT,e)};n.parent.on(TC.Consts.event.FEATURESIMPORT,e)}var a=n.parent.getLoadingIndicator();a&&(n._featureImportWaitId=a.addWait());e.interaction.DragAndDrop.handleDrop_.call(r,{dataTransfer:{files:t}})};TC.wrap.Layer.prototype.getVisibility=function(e){var t=!1;this.layer&&(t=this.layer.getVisible());return t};TC.wrap.Layer.prototype.setVisibility=function(e){this.getLayer().then(function(t){t.setVisible(e)})};TC.wrap.Layer.prototype.isNative=function(t){return t instanceof e.layer.Layer};TC.wrap.Layer.prototype.setProjection=function(t){const o=this;t=t||{};const r=o.parent;if(r.map){const i=T.call(o,{crs:t.crs,extentInDegrees:e.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326")});var n=r.getResolutions();if(n&&n.length){n=n.map(function(e){return e/i});r.wrap.layer.setMaxResolution(n[0]);r.wrap.layer.setMinResolution(n[n.length-1])}else{if(r.minResolution){r.minResolution=r.minResolution/i;o.layer.setMinResolution(r.minResolution)}if(r.maxResolution){r.maxResolution=r.maxResolution/i;o.layer.setMaxResolution(r.maxResolution)}}}};TC.wrap.layer.Raster.prototype.WmsParser=e.format.WMSCapabilities;TC.wrap.layer.Raster.prototype.WmtsParser=e.format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.on("change:visible",function(){t.parent.map&&t.parent.map.trigger(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent})},t.parent.map)};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:for(var t=this.parent.capabilities.Capability.Request.GetMap.DCPType,o=0;o<t.length;o++)if(t[o].HTTP&&t[o].HTTP.Get){e=t[o].HTTP.Get.OnlineResource;break}break;case TC.Consts.layerType.WMTS:e=this.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const r=document.createDocumentFragment(),n=document.createElement("textarea");r.appendChild(n);n.innerHTML=e;return e=n.textContent};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Capability.Request.GetFeatureInfo&&(e=t.Capability.Request.GetFeatureInfo.Format);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this.parent.capabilities;if(t&&t.Contents)for(var o=0;o<t.Contents.Layer.length;o++)for(var r=t.Contents.Layer[o],n=0;n<r.TileMatrixSetLink.length;n++)if(this.parent.options.matrixSet===r.TileMatrixSetLink[n].TileMatrixSet){e=r;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,o=this.parent.capabilities;if(o&&o.Contents&&o.Contents.TileMatrixSet)for(var r=0;r<o.Contents.TileMatrixSet.length;r++){var n=o.Contents.TileMatrixSet[r];if(n.Identifier===e){t=n.TileMatrix;break}}return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[];e.ScaleDenominator?t=[e.ScaleDenominator,e.ScaleDenominator]:(e.MinScaleDenominator||e.MaxScaleDenominator)&&(t=[e.MaxScaleDenominator,e.MinScaleDenominator]);if(!t.length&&!this.getName(e)){for(var o=this.getLayerNodes(e),r=-1/0,n=1/0,i=0,a=o.length;i<a;i++){var s=this.getScaleDenominators(o[i]);s[0]>r&&(r=s[0]);s[1]<n&&(n=s[1])}r>-1/0&&n<1/0&&(t=[r,n])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(){const e={},t=TC.capabilities[this.parent.url];if(t)if(t.ServiceProvider){e.name=t.ServiceProvider.ProviderName.trim();e.site=t.ServiceProvider.ProviderSite;e.site.href&&e.site.href.trim().length>0&&(e.site=e.site.href)}else t.ServiceIdentification?e.name=t.ServiceIdentification.Title.trim():e.name=t.Service.Title.trim();return e};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t=this,o={},r=t.parent.capabilities;if(r&&r.Capability)for(var n=t.getAllLayerNodes(),i=0;i<n.length;i++){var a=n[i];if(t.parent.compareNames(t.getName(a),e)){a.Title&&(o.title=a.Title);a.Abstract&&(o.abstract=a.Abstract);o.legend=[];var s=function(e,o){if(e.Layer&&e.Layer.length>0)for(var r in e.Layer)s(e.Layer[r],o);else o.apply(t,[e])};s(a,function(e){var t=this.getLegend(e);t.src&&o.legend.push({src:t.src,title:e.Title})});if(a.MetadataURL&&a.MetadataURL.length){o.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];o.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}o.queryable=a.queryable;break}}return o};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Capability.Request&&t.Capability.Request.GetMap?e=TC.Consts.layerType.WMS:t.OperationsMetadata&&t.OperationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Service?e=t.Service.Title:t.ServiceIdentification&&(e=t.ServiceIdentification.Title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;this.getServiceType()===TC.Consts.layerType.WMS&&(e=this.parent.capabilities.Capability.Layer);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var o=e.Name;if(o&&t){var r=o.indexOf(":");r>=0&&(o=o.substr(r+1))}return o};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.Identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.Layer;$.isArray(t)||(t=t?[t]:[]);return t};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this;if(!e._layerList)switch(e.getServiceType()){case TC.Consts.layerType.WMS:var t=e.getRootLayerNode();e._layerList=t?function t(o){for(var r=[o],n=e.getLayerNodes(o),i=0;i<n.length;i++)r=r.concat(t(n[i]));return r}(t):[];break;case TC.Consts.layerType.WMTS:e._layerList=e.parent.capabilities.Contents.Layer.slice();break;default:e._layerList=[]}return e._layerList};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return e};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},o=e.Style;if(o&&o.length&&o.length&&o[0].LegendURL&&o[0].LegendURL.length){var r=o[0].LegendURL[0];const e=document.createDocumentFragment(),n=document.createElement("textarea");e.appendChild(n);n.innerHTML=r.OnlineResource;t.src=n.textContent}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,o=!0,r=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer&&r.names.length>0)for(var n=r.names.slice(0),i=function o(n,i,a){var s=!1;if(n)for(var l=0;l<n.length;l++){var c=n[l];const h=c.CRS||c.SRS,d=Array.isArray(h)?h:[h];var u=a||$.inArray(e,d)>=0;if(r.compareNames(t.getName(c),i)){u&&(s=!0);break}if(o(c.Layer,i,u)){s=!0;break}}return s};n.length>0;)if(!i([r.capabilities.Capability.Layer],n.pop())){o=!1;break}break;case TC.Consts.layerType.WMTS:o=!1;if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var a=r.capabilities.Contents.TileMatrixSet,s=0;s<a.length;s++)if(a[s].Identifier===r.options.matrixSet){o=TC.Util.CRSCodesEqual(e,a[s].SupportedCRS);break}}return o};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var e=[],t=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(t.capabilities&&t.capabilities.Capability&&t.capabilities.Capability.Layer&&t.names.length>0){const o=t.names.map(function(e){return t.getNodePath(e).map(function(e){const t=e.CRS||e.SRS||[],o=Array.isArray(t)?t:[t];return $.isArray(o)?o:[o]}).reduce(function(e,t){if(0===e.length)return t;t.forEach(function(t){e.indexOf(t)<0&&(e[e.length-1]=t)});return e},[])});if(1===o.length)e=o[0];else{const t=o.slice(1);e=o[0].filter(function(e){return t.every(function(t){return t.indexOf(e)>=0})})}}break;case TC.Consts.layerType.WMTS:t.capabilities&&t.capabilities.Contents&&t.capabilities.Contents.Layer.filter(function(e){return e.Identifier===t.layerNames}).forEach(function(o){const r=o.TileMatrixSetLink.map(function(e){return e.TileMatrixSet});e=t.capabilities.Contents.TileMatrixSet.filter(function(e){return r.indexOf(e.Identifier)>=0}).map(function(e){return e.SupportedCRS})})}return e};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],o=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(o.capabilities&&o.capabilities.Capability&&o.capabilities.Capability.Layer){var r=function(e,o,n){var i=e.CRS||e.SRS,a=Array.isArray(i)?i:[i],s=n||$.inArray(o,a)>=0;s&&e.Name&&(t[t.length]=e.Name);if(e.Layer)for(var l=0;l<e.Layer.length;l++)r(e.Layer[l],o,s)};r(o.capabilities.Capability.Layer,e)}break;case TC.Consts.layerType.WMTS:if(o.capabilities&&o.capabilities.Contents&&o.capabilities.Contents.TileMatrixSet)for(var n=o.capabilities.Contents.TileMatrixSet,i=0,a=n.length;i<a;i++){var s=n[i];if(TC.Util.CRSCodesEqual(e,s.SupportedCRS))for(var l=s.Identifier,c=o.capabilities.Contents.Layer,u=0,h=c.length;u<h;u++)for(var d=c[u].TileMatrixSetLink,p=0,f=d.length;p<f;p++)if(d[p].TileMatrixSet===l){t[t.length]=c[u].Identifier;break}}}return t};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(e){var t=[];_({crs:e});var o=this.parent;if(this.getServiceType()===TC.Consts.layerType.WMTS)for(var r=o.capabilities.Contents.Layer,n=o.capabilities.Contents.TileMatrixSet,i=0,a=r.length;i<a;i++)if(o.layerNames===r[i].Identifier)for(var s=r[i].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],h=0,d=n.length;h<d;h++){var p=n[h];if(p.Identifier===u.TileMatrixSet){TC.Util.CRSCodesEqual(e,p.SupportedCRS)&&(t[t.length]=p.Identifier);break}}return t};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){var e=this;e.getLayer().then(function(t){e.parent.options=e.parent.options||{};var o=t.getSource().getUrls();e.parent.options.urlPattern=o[o.length-1]})};TC.wrap.layer.Raster.prototype.createWMSLayer=function(t,o,r){const n=this;var i=null,a=new e.source.ImageWMS({url:t,crossOrigin:r.map?r.map.options.crossOrigin:void 0,params:o,extent:TC.Cfg.initialExtent,ratio:TC.Cfg.imageRatio,imageLoadFunction:$.proxy(n.parent.getImageLoad,n.parent)});a.on(e.source.Image.EventType_.IMAGELOADSTART,function(e){n.trigger(TC.Consts.event.BEFORETILELOAD,{tile:e.image.getImage()})});a.on(e.source.Image.EventType_.IMAGELOADEND,function(e){n.trigger(TC.Consts.event.TILELOAD,{tile:e.image.getImage()})});a.on(e.source.Image.EventType_.IMAGELOADERROR,function(e){n.trigger(TC.Consts.event.TILELOAD,{tile:e.image.getImage()})});var s={visible:!!o.LAYERS.length||r&&r.method&&"POST"===r.method,source:a};r.minResolution&&(s.minResolution=r.minResolution);r.maxResolution&&(s.maxResolution=r.maxResolution);(i=new e.layer.Image(s))._wrap=n;n.addCommonEvents(i);return i};var b=function(t){var o=this,r=null,n=e.source.WMTS.optionsFromCapabilities(o.parent.capabilities,{layer:t.layerNames,matrixSet:t.matrixSet,crossOrigin:t.map?t.map.options.crossOrigin:void 0,requestEncoding:t.encoding,format:t.format});if(n){"https:"===location.protocol&&(n.urls=n.urls.map(function(e){return e.replace("http:","https:")}));n.crossOrigin=t.map?t.map.options.crossOrigin:void 0;(r=new e.source.WMTS(n)).setTileLoadFunction($.proxy(o.parent.getImageLoad,o.parent));r.on(e.source.TileEventType.TILELOADSTART,function(e){o.trigger(TC.Consts.event.BEFORETILELOAD,{tile:e.tile.getImage()})});r.on(e.source.TileEventType.TILELOADEND,function(e){o.trigger(TC.Consts.event.TILELOAD,{tile:e.tile.getImage()})});r.on(e.source.TileEventType.TILELOADERROR,function(e){o.trigger(TC.Consts.event.TILELOAD,{tile:e.tile.getImage()})});var i=$.proxy(r.getResolutions,r);r.getResolutions=function(){var e=i(),t=o.parent.getLimitedMatrixSet();if(t&&t.length){var r=t[0].matrixIndex;e=e.slice(r,t.length+r)}return e}}return r};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(t){const o=this;var r=null,n=b.call(o,t);if(n){var i={source:n};t.minResolution&&(i.minResolution=t.minResolution);t.maxResolution&&(i.maxResolution=t.maxResolution);(r=new e.layer.Tile(i))._wrap=o;o.addCommonEvents(r);var a=n.getResolutions();r.setMaxResolution(a[0]+1);r.setMinResolution(a[a.length-1])}return r};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()};TC.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getSource().updateParams(e)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(e){const t=this;t.layer.getSource().getResolutions();if(t.parent.type===TC.Consts.layerType.WMTS){const o=b.call(t,$.extend({},t.parent.options,{matrixSet:e})),r=o.getResolutions(),n=r[0],i=r[r.length-1];t.layer.setMaxResolution(n);t.layer.setMinResolution(i);t.parent.minResolution&&(t.parent.minResolution=i);t.parent.maxResolution&&(t.parent.maxResolution=n);t.layer.setSource(o)}};TC.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var e=this.layer.getSource();return e.getResolutions&&e.getResolutions!=goog.abstractMethod?e.getResolutions():[]}return[]};TC.wrap.Geometry={getNearest:function(t,o){return new e.geom.LineString(o).getClosestPoint(t)}};var x=function(e,t,o){if(e){var r=function(r){var n=(o&&o._wrap?o._wrap.parent.options.width:null)||t;if(n<r){var i=n/r;e.setScale(i)}},n=e.getSize();if(n)r(n[0]);else{var i=e.getImage();if(i.naturalWidth)r(i.naturalWidth);else{const t=document.createDocumentFragment(),o=document.createElement("img");o.src=e.getSrc();o.addEventListener("load",function(){r(this.naturalWidth)});t.appendChild(o)}}}},A=function(e,t){var o=e,r=t&&t.wrap&&t.wrap.feature;if("string"==typeof e){var n=e.match(/^\$\{(.+)\}$/);if(n&&r){for(var i=n[1].split("."),a=r.getProperties(),s=0;s<i.length&&void 0!==a;s++)a=a[i[s]];if(void 0===a){a=t.data;for(s=0;s<i.length&&void 0!==a;s++)a=a[i[s]]}o=a}}else $.isFunction(e)&&(o=e(t));return o},P=function(e){var t=e.getStyle();$.isFunction(t)&&(t=t.call(e));$.isArray(t)&&(t=t[0]);return t},R=function(t,o){var r,n,i,a,s,l={};if(o){switch(o.getGeometry().getType()){case"Point":case"MultiPoint":n=!0;break;case"LineString":case"MultiLineString":i=!0;break;case"Polygon":case"MultiPolygon":a=!0}r=o._wrap?o._wrap.parent:{id:TC.wrap.Feature.prototype.getId.call({feature:o}),features:o.get("features"),getData:function(){return TC.wrap.Feature.prototype.getData.call({feature:o})}}}var c={};if((s=r&&$.isArray(r.features)&&r.features.length>1&&t.cluster?$.extend(!0,{},TC.Cfg.styles.cluster,t.cluster.styles):t.styles||TC.Cfg.styles).line&&(i||!o)){c=s.line;l.stroke=new e.style.Stroke({color:A(s.line.strokeColor,r),width:A(s.line.strokeWidth,r),lineDash:s.line.lineDash})}if(s.polygon&&(a||!o)){c=s.polygon;l.fill=new e.style.Fill({color:y(A(s.polygon.fillColor,r),A(s.polygon.fillOpacity,r))});l.stroke=new e.style.Stroke({color:A(s.polygon.strokeColor,r),width:A(s.polygon.strokeWidth,r),lineDash:s.polygon.lineDash})}if(s.point&&(n||!o)){c=s.point;var u={radius:A(c.radius,r)||(A(c.height,r)+A(c.width,r))/4};c.fillColor&&(u.fill=new e.style.Fill({color:y(A(c.fillColor,r),A(c.fillOpacity,r))}));c.strokeColor&&(u.stroke=new e.style.Stroke({color:A(c.strokeColor,r),width:A(c.strokeWidth,r),lineDash:c.lineDash}));isNaN(u.radius)||(l.image=new e.style.Circle(u))}c.label&&(l.text=M(c,r));if(s.marker&&(n||!o)){if((c=s.marker).url){l.image=new e.style.Icon({crossOrigin:"anonymous",anchor:c.anchor,anchorXUnits:c.anchorXUnits||"fraction",anchorYUnits:c.anchorYUnits||"fraction",src:c.url});l.text=M(c,r)}}return[new e.style.Style(l)]};const M=function(t,o){if(!t||!t.label)return;const r={text:""+A(t.label,o)};t.fontSize&&(r.font=A(t.fontSize,o)+"pt sans-serif");t.angle&&(r.rotation=-Math.PI*A(t.angle,o)/180);t.fontColor&&(r.fill=new e.style.Fill({color:y(A(t.fontColor,o),1)}));t.labelOutlineColor&&(r.stroke=new e.style.Stroke({color:y(A(t.labelOutlineColor,o),1),width:A(t.labelOutlineWidth,o)}));if(t.labelOffset){r.offsetX=t.labelOffset[0];r.offsetY=t.labelOffset[1]}return new e.style.Text(r)};var I=function(e){var t=e.toString(16);1===t.length&&(t="0"+t);return t},O=function(e){return"#"+I(e[0])+I(e[1])+I(e[2])},N=function(t,o){var r={};$.isFunction(t)&&o&&(t=t(o));$.isArray(t)&&(t=t[0]);if(!$.isFunction(t)){var n,i,a,s=t.getImage();if(s)if(s instanceof e.style.RegularShape){i=s.getStroke();n=e.color.asArray(i.getColor());r.strokeColor=O(n);r.strokeWidth=i.getWidth();if(a=s.getFill()){n=e.color.asArray(a.getColor());r.fillColor=O(n);r.fillOpacity=n[3]}}else{r.url=s.getSrc();var l=s.getSize();if(l){r.width=l[0];r.height=l[1];r.anchor=s.getAnchor();if(r.anchor){r.anchor[0]=r.anchor[0]/r.width;r.anchor[1]=r.anchor[1]/r.height}}}else{if(i=t.getStroke()){n=e.color.asArray(i.getColor());r.strokeColor=O(n);r.strokeWidth=i.getWidth();r.lineDash=i.getLineDash()}if(a=t.getFill()){n=e.color.asArray(a.getColor());r.fillColor=O(n);r.fillOpacity=n[3]}}}return r};TC.wrap.layer.Vector.prototype.getStyle=function(){return N(this.layer.getStyle())};TC.wrap.layer.Vector.prototype.reloadSource=function(){const t=this;return new Promise(function(o,r){const n=t.createVectorSource(t.parent,t.createStyles(t.parent));if(t.parent.type===TC.Consts.layerType.WFS)var i=n.source.on("change",function(t){if("ready"==n.source.getState()){e.Observable.unByKey(i);o()}});var a=t.layer.getSource().getFeatures();t.layer.setSource(n.source);n.style&&t.layer.setStyle(n.style);if(t.parent.type!=TC.Consts.layerType.WFS){n.source.addFeatures(a);o()}})};TC.wrap.layer.Vector.prototype.import=function(e){var t=$.extend({},e);t.type=e.format;var o=this.layer.getSource().getFeatures(),r=this.createVectorSource(t,this.createStyles(this.parent));this.layer.setSource(r.source);r.style&&this.layer.setStyle(r.style);r.source.addFeatures(o)};const D=function(t){t._wrapPromise||(t._wrapPromise=new Promise(function(o,r){var n,i=t.getGeometry();const a=t.getStyle();a&&(n=N(a,t));const s=function(e){e?TC.loadJS(!TC.feature||!TC.feature[e],TC.apiLocation+"TC/feature/"+e,function(){o(new TC.feature[e](t,n))}):o(new TC.Feature(t,n))};i instanceof e.geom.Point?!function(t){var o=null,r=P(t);if(r){var n=r.getImage();n instanceof e.style.Icon&&(o=n.getSrc())}return o}(t)?s("Point"):s("Marker"):i instanceof e.geom.LineString?s("Polyline"):i instanceof e.geom.Polygon?s("Polygon"):i instanceof e.geom.MultiLineString?s("MultiPolyline"):i instanceof e.geom.MultiPolygon?s("MultiPolygon"):s()}));return t._wrapPromise};TC.wrap.layer.Vector.prototype.createVectorSource=function(t,o){var r,n,i,a,s,l=this,c=!1;if($.isArray(t.url)||t.urls){var u=t.urls||t.url;n={url:u=$.map(u,function(e,t){return TC.proxify(e)}),format:new e.format.KML({showPointNames:!1}),projection:t.crs}}else if(t.url&&t.type!==TC.Consts.layerType.WFS){(n={url:TC.proxify(t.url),projection:t.crs}).format=S(t.format)||S(function(e){var t=e.indexOf("?");t>=0?e=e.substr(0,t):(t=e.indexOf("#"))>=0&&(e=e.substr(0,t));switch(e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"kml":return TC.Consts.mimeType.KML;case"json":case"geojson":return TC.Consts.mimeType.GEOJSON;case"gml":return TC.Consts.mimeType.GML;case"gpx":return TC.Consts.mimeType.GPX;default:return null}}(t.url))||S(t.type);n.loader=(i=n.url,a=n.format,s=e.featureloader.xhr(i,a),function(e,t,o){l.parent.state=TC.Layer.state.LOADING;l.parent.map&&l.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:l.parent});s.call(this,e,t,o)});c=!0}else if(t.data)(n={projection:t.crs,loader:function(e,o,r){l.parent.state=TC.Layer.state.LOADING;l.parent.map&&l.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:l.parent});var n=this.getFormat();try{var i=n.readFeatures(t.data,{featureProjection:r});this.addFeatures(i);l.parent.state=TC.Layer.state.IDLE;l.parent.map&&l.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:l.parent,newData:data})}catch(e){l.parent.state=TC.Layer.state.IDLE;l.parent.map&&l.parent.map.trigger(TC.Consts.event.LAYERERROR,{layer:l.parent,reason:e.message})}}}).format=S(t.format)||S(t.type);else if(t.type==TC.Consts.layerType.WFS){var h,d;switch(t.outputFormat){case TC.Consts.format.JSON:h=new e.format.GeoJSON({geometryName:t.geometryName});d="json";break;case TC.Consts.format.GML3:h=new e.format.GML3Patched;d=TC.Consts.mimeType.GML;break;default:h=new e.format.GML2;d=TC.Consts.mimeType.GML}n={format:h,loader:function(e,o,r){var n=this,i=t.url;if(i){l.parent.state=TC.Layer.state.LOADING;l.parent.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:l.parent});var a={},s=r.getCode(),c=t.version||"1.1.0",u=i,p=$.isArray(t.featureType)?t.featureType:[t.featureType];if(!t.properties||t.properties instanceof Array&&!t.properties.length||!Object.keys(t.properties).length){u=u+"?service=WFS&version="+c+"&request=GetFeature&typename="+p.join(",")+"&outputFormat="+d+"&srsname="+s;e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0&&(u=u+"&bbox="+e.join(",")+","+s);t.maxFeatures&&(u=u+"maxFeatures="+t.maxFeatures)}else{a.method="POST";switch(d){case"json":a.responseType=TC.Consts.mimeType.JSON;break;default:a.responseType=TC.Consts.mimeType.XML}var f=[];f[f.length]='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="';f[f.length]=c;f[f.length]='" outputFormat="';f[f.length]=t.outputFormat;if(t.maxFeatures){f[f.length]='" maxFeatures="';f[f.length]=t.maxFeatures}f[f.length]='" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/';f[f.length]=c;f[f.length]='/wfs.xsd">';for(var g=0;g<p.length;g++){f[f.length]='<wfs:Query typeName="feature:';f[f.length]=p[g];f[f.length]='" srsName="';f[f.length]=s;f[f.length]='">';if(t.propertynames){var m="1.1.0"===c?"wfs":"ogc",y="string"==typeof t.propertynames?t.propertynames.split(","):t.propertynames;t.geometryName&&y.push(t.geometryName);for(;g<y.length;g++)f[f.length]="<"+m+":PropertyName>"+y[g].trim()+"</"+m+":PropertyName>"}f[f.length]=t.properties.getText();f[f.length]="</wfs:Query>"}f[f.length]="</wfs:GetFeature>";a.data=f.join("");a.contentType=TC.Consts.mimeType.XML}a.url=u;l._requestUrl=u;TC.ajax(a).then(function(e){const t=h.readFeatures(e),o=function(){l.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:l.parent,newData:e})},r=function(e){if(e.layer===l.parent){l.parent.map.off(TC.Consts.event.FEATURESADD,r);o()}};if(t.length){n.addFeatures(t);l.parent.map.on(TC.Consts.event.FEATURESADD,r)}else o();l.parent.state=TC.Layer.state.IDLE})}},projection:t.crs}}r=new e.source.Vector(n);c&&r.on(e.events.EventType.CHANGE,function(e){l.parent.map&&l.parent.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:l.parent})});r._tcLayer=l.parent;var p=t.style&&t.style.marker?t.style.marker:TC.Cfg.styles.marker;t.style&&t.style.marker||(p=$.extend({},p,{anchor:TC.Cfg.styles.point.anchor}));if(t.cluster){r=new e.source.Cluster({projection:t.crs,distance:t.cluster.distance,source:r});if(t.cluster.animate){var f=function(t,o){var r=Date.now(),n=t.getGeometry().getCoordinates(),i=o.getGeometry().getCoordinates();o.setGeometry(new e.geom.Point(n));requestAnimationFrame(function a(){var s=function(e,t,o,r){var n=Math.min((Date.now()-r)/o,1),i=(t[0]-e[0])*n,a=(t[1]-e[1])*n;return[e[0]+i,e[1]+a]}(n,i,TC.Consts.CLUSTER_ANIMATION_DURATION,r);o.setGeometry(new e.geom.Point(s));s[0]!==i[0]&&s[1]!==i[1]?requestAnimationFrame(a):g.splice($.inArray(t,g),1)})},g=[];r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(e){var t=e.feature.get("features");t&&t.length>1&&g.push(e.feature)});r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){var t=e.feature.get("features");if(t){var o=t[0].getGeometry().getCoordinates();if(t.length>1){var r=$.grep(g,function(e){var t=e.getGeometry().getCoordinates();return t[0]===o[0]&&t[1]===o[1]});r.length&&g.splice($.inArray(r[0],g),1)}var n=$.grep(g,function(e){var t=e.get("features");if(t&&t.length>0){return $.grep(t,function(e){var t=e.getGeometry().getCoordinates();return t[0]===o[0]&&t[1]===o[1]}).length>0}});n.length&&f(n[n.length-1],e.feature)}})}}var m=r;do{m.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){var t=e.feature,o=P(t);o&&x(o.getImage(),p.width,t)});m=$.isFunction(m.getSource)?m.getSource():null}while(m);r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){const t=e.feature,o=function(e){var o;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:o=l.parent.addPoint;break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:o=l.parent.addPolyline;break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:o=l.parent.addPolygon;break;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:o=l.parent.addMultiPolygon;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:o=l.parent.addMultiPolyline;break;default:o=l.parent.addFeature}if(o){var r;o.call(l.parent,t).then(function(o){var n=t.get("features");$.isArray(n)&&(o.features=$.map(n,function(t){return new e.constructor(t)}));clearTimeout(r);r=setTimeout(function(){l.parent.map.trigger(TC.Consts.event.FEATURESADD,{layer:l.parent,features:[o]})},50)})}};t._wrap&&t._wrap.parent.layer||D(t).then(o)});r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(e){var t=e.feature;if(t._wrap){var o=$.inArray(t._wrap.parent,l.parent.features);if(o>-1){l.parent.features.splice(o,1);l.parent.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:l.parent,feature:t._wrap.parent})}}});r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){l.parent.map&&l.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:l.parent})});r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(){l.parent.map&&l.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:l.parent})});r.addEventListener(e.source.VectorEventType.CLEAR,function(){l.parent.map&&l.parent.map.trigger(TC.Consts.event.FEATURESCLEAR,{layer:l.parent})});var y={source:r};t.minResolution&&(y.minResolution=t.minResolution);t.maxResolution&&(y.maxResolution=t.maxResolution);n&&n.format instanceof e.format.KML&&!t.cluster||(y.style=o||t.styles);return y};TC.wrap.layer.Vector.prototype.createStyles=function(e){var t=this,o=!1;if($.isFunction(e)){o=!0;t.styleFunction=function(t){return R(e(t))}}else{(e=$.extend({},e)).crs=e.crs||TC.Cfg.crs;e.styles=e.styles||TC.Cfg.styles;o=!(!e.cluster||!e.cluster.styles)||function e(t){for(var o in t){var r=t[o];switch(typeof r){case"string":if(/^\$\{(.+)\}$/.test(r))return!0;break;case"object":if(e(r))return!0;break;case"function":return!0}}return!1}(e.styles);t.styleFunction=function(e){return R(t.parent.options,e)}}return o?t.styleFunction:t.styleFunction()};TC.wrap.layer.Vector.prototype.setStyles=function(e){const t=this;t.getLayer().then(function(o){o.setStyle(t.createStyles(e))})};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var t=null,o=this.parent.options,r=this.createVectorSource(o,this.createStyles(o));r.declutter=this.parent.options.declutter||!1;(t=new e.layer.Vector(r))._wrap=this;this.addCommonEvents(t);return t};TC.wrap.layer.Vector.prototype.addFeatures=function(e){const t=this,o=function(t){for(var o=t;$.isFunction(o.getSource);)o=o.getSource();o.addFeatures(e)};t.layer?o(t.layer):t.getLayer().then(o)};TC.wrap.layer.Vector.prototype.getFeatures=function(){var t=this.getLayer();return t instanceof e.layer.Layer?t.getSource().getFeatures():[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(t){var o=this.layer;return o instanceof e.layer.Layer?o.getSource().getFeatureById(t):null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){const t=this,o=function(t){if(e.wrap.feature){t.getSource().removeFeature(e.wrap.feature)}};t.layer?o(t.layer):t.getLayer().then(o)};TC.wrap.layer.Vector.prototype.clearFeatures=function(){const e=this,t=function(e){var t=e.getSource();t.clearFeatures?t.clearFeatures():t.clear()};e.layer?t(e.layer):e.getLayer().then(t)};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(t,o){var r=this,n={color:"rgba(0, 0, 0, 0)"},i={color:"rgba(0, 0, 0, 0)"},a=new e.style.Style({image:new e.style.Circle({radius:0,fill:new e.style.Fill(n),stroke:new e.style.Stroke(i)}),fill:new e.style.Fill(n),stroke:new e.style.Stroke(i)});if($.inArray(t,r.parent.features)>=0){var s=t.wrap.feature;r.getLayer().then(function(e){if(o&&s._originalStyle)s.setStyle(s._originalStyle);else{s._originalStyle=s.getStyle()||e.getStyle();s.setStyle(a)}r.parent.map.trigger(TC.Consts.event.VECTORUPDATE,{layer:r.parent})})}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){return y(e,t)};TC.wrap.layer.Vector.prototype.findFeature=function(e){};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl};TC.wrap.layer.Vector.prototype.getDescribeFeatureTypeUrl=function(){var e=this.parent,t=e.options.version||"1.1.0",o=e.url;return o=o+"?service=WFS&version="+t+"&request=DescribeFeatureType&typename="+($.isArray(e.options.featureType)?e.options.featureType:[e.options.featureType]).join(",")+"&outputFormat=XMLSCHEMA"};TC.wrap.layer.Vector.prototype.sendTransaction=function(t,o,r){const n=this,i=function(e){return e.wrap.feature};return new Promise(function(a,s){const l=t.map(i),c=o.map(i),u=r.map(i);t.length||o.length||r.length?n.getLayer().then(function(t){t.getSource();var o=new e.format.WFS,r=n.parent.options,i=o.writeTransaction(l,c,u,{featurePrefix:r.featurePrefix,featureNS:r.featureNS,featureType:r.featureType[0]}),h={url:n.parent.url,method:"POST",responseType:TC.Consts.mimeType.XML,data:i.outerHTML};TC.ajax(h).then(function(e){var t=e.getElementsByTagName("ExceptionReport")[0],r={reason:""};if(t){var n=t.getElementsByTagName("Exception")[0];if(n){r.code=n.getAttribute("exceptionCode");for(var i=n.getElementsByTagName("ExceptionText"),l=0,c=i.length;l<c;l++)r.reason+="\n"+i[l].innerHTML}s(r)}else{var u=o.readTransactionResponse(e);a(u)}}).catch(function(){s({code:"",reason:"unknown"})})}):a(n.parent)})};TC.wrap.layer.Vector.prototype.setDraggable=function(t,o,r){var n=this;Promise.all([n.parent.map.wrap.getMap(),n.getLayer()]).then(function(i){const a=i[0],s=i[1];if(t){var c={layers:[s],features:new e.Collection(s.getSource().getFeatures())};n.interaction=new e.interaction.Translate(c);$.isFunction(o)&&n.interaction.on(e.interaction.TranslateEventType.TRANSLATEEND,function(e){e.features.getLength()&&o(e.features.item(0)._wrap.parent)});$.isFunction(r)&&n.interaction.on(e.interaction.TranslateEventType.TRANSLATESTART,function(e){e.features.getLength()&&r(e.features.item(0)._wrap.parent)});a.addInteraction(n.interaction);if(TC.Util.detectIE()){n._handlerDraggablePointerMove=function(e){if(!e.dragging){var t=a.getEventPixel(e);a.hasFeatureAtPixel(t)?a.forEachFeatureAtPixel(t,function(e,t){t._wrap&&t._wrap.parent&&t._wrap.parent.id===n.parent.id&&e?a.getTarget().style.cursor="move":a.getTarget().style.cursor=""},{hitTolerance:l}):a.getTarget().style.cursor=""}};a.on("pointermove",n._handlerDraggablePointerMove)}}else if(n.interaction){a.removeInteraction(n.interaction);if(TC.Util.detectIE()&&n._handlerDraggablePointerMove&&$.isFunction(n._handlerDraggablePointerMove)){a.un("pointermove",n._handlerDraggablePointerMove);delete n._handlerDraggablePointerMove}}})};TC.wrap.layer.Vector.prototype.getFeaturesInExtent=function(t,o){var r=this.layer.getSource().getFeatures(),n=[];if(o){var i=this.parent.map.getPixelFromCoordinate([t[0],t[1]]),a=this.parent.map.getPixelFromCoordinate([t[2],t[3]]);i[0]-=o[0]/2;i[1]+=o[1];a[0]+=o[0]/2;t=this.parent.map.getCoordinateFromPixel(i).concat(this.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<r.length;s++){var l=r[s],c=l.getGeometry().getCoordinates();e.extent.containsCoordinate(t,c)&&n.push(l._wrap.parent)}return n};TC.wrap.layer.Vector.prototype.getAttribution=function(){return null};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._trigger=function(o){if(e.view!==TC.Consts.view.PRINTING){var r=0;e.wrap.map.forEachFeatureAtPixel(o.pixel,function(e,t){e._wrap&&e._wrap.parent.showsPopup&&r++},{hitTolerance:l});if(!r){t.parent.map.trigger(TC.Consts.event.CLICK,{coordinate:o.coordinate,pixel:o.pixel});t.parent.callback(o.coordinate,o.pixel)}return 0===r}}};TC.wrap.control.Click.prototype.activate=function(){var t=this;t.parent.map.wrap.getMap().then(function(o){o.on(e.MapBrowserEventType.SINGLECLICK,t._trigger)})};TC.wrap.control.Click.prototype.deactivate=function(){var t=this;t.parent.map.wrap.getMap().then(function(o){o.un(e.MapBrowserEventType.SINGLECLICK,t._trigger)})};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.updateElement_():this.ctl=new e.control.ScaleLine({target:this.parent.div})};TC.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_};TC.wrap.control.NavBar.prototype.register=function(t){var o=this;t.wrap.getMap().then(function(r){const n=o.parent.div;o.zCtl=new e.control.Zoom({target:n});o.zsCtl=new e.control.ZoomSlider({render:function(t){if(!t.frameState||!t.frameState.viewState||r.getView().getMinResolution()<=t.frameState.viewState.resolution){var n=function(){if(this.element.offsetWidth>this.element.offsetHeight){o.requestSliderSize||(o.requestSliderSize=window.requestAnimationFrame(n.bind(this)));window.requestAnimationFrame(n.bind(this))}else if(this.element.offsetWidth<this.element.offsetHeight){if(o.requestSliderSize){window.cancelAnimationFrame(o.requestSliderSize);delete o.requestSliderSize}e.control.ZoomSlider.render.call(this,t)}};n.call(this)}}});o.zsCtl.setTarget(n);r.addControl(o.zsCtl);r.addControl(o.zCtl);n.querySelectorAll("button").forEach(function(e){e.classList.add("tc-ctl-btn");e.classList.add(o.parent.CLASS+"-btn");e.style.display="block";e.innerHTML="";if(e.matches(".ol-zoom-in")){e.classList.add(o.parent.CLASS+"-btn-zoomin");e.setAttribute("title",o.parent.getLocaleString("zoomIn"))}if(e.matches(".ol-zoom-out")){e.classList.add(o.parent.CLASS+"-btn-zoomout");e.setAttribute("title",o.parent.getLocaleString("zoomOut"))}});const i=n.querySelector(".ol-zoomslider");i.classList.add(o.parent.CLASS+"-bar");i.querySelector(".ol-zoomslider-thumb").classList.add(o.parent.CLASS+"-slider");t.on(TC.Consts.event.BASELAYERCHANGE,$.proxy(o.refresh,o))})};TC.wrap.control.NavBar.prototype.refresh=function(){var t=this,o=t.parent.map.wrap.map;t.parent.renderPromise().then(function(){if(t.zsCtl.sliderInitialized_){var r=o.getView().getResolution();t.zsCtl.setThumbPosition_(r)}else o.once(e.MapEventType.POSTRENDER,function(e){t.zsCtl.render(e)})})};TC.wrap.control.NavBarHome.prototype.register=function(t){var o=this;t.wrap.getMap().then(function(r){const n=o.parent.div;o.z2eCtl=new e.control.ZoomToExtent({target:n,extent:t.initialExtent,tipLabel:""});r.addControl(o.z2eCtl);n.querySelectorAll("button").forEach(function(e){e.style.display="block";e.innerHTML=""});const i=n.querySelector(".ol-zoom-extent button");i.classList.add("tc-ctl-btn");i.classList.add(o.parent.CLASS+"-btn");i.setAttribute("title",o.parent.getLocaleString("zoomToInitialExtent"))})};TC.wrap.control.NavBarHome.prototype.setInitialExtent=function(e){this.z2eCtl.extent=e};TC.wrap.control.Coordinates.prototype.register=function(t){const o=this;o.map=t;return new Promise(function(r,n){o._coordsTrigger=function(e){o.parent.coordsToClick(e)};t.wrap.getMap().then(function(t){o.olMap=t;if(o.parent.map.on3DView){o.parent.crs=o.parent.map.view3D.crs;o.parent.units=TC.Consts.units.DEGREES}else{var n=t.getView().getProjection();o.parent.crs=n.getCode();o.parent.units=n.getUnits()}o.parent.isGeo=o.parent.units===e.proj.Units.DEGREES;r()})})};TC.wrap.control.Coordinates.prototype.onMouseMove=function(e){if(this.map.wrap.map){var t=this.map.wrap.map.getEventCoordinate(e);if(t){this.parent.isGeo?this.parent.latLon=t.reverse():this.parent.xy=t;this.parent.update.apply(this.parent,arguments)}}};TC.wrap.control.Geolocation.prototype.register=function(e){var t=this;t.map=e;t._snapTrigger=function(e){e.dragging||t.initSnap(t.olMap.getEventCoordinate(e),e.pixel)};t._postcomposeTrigger=function(e){t.duringTrackSnap(e)};e.wrap.getMap().then(function(e){t.olMap=e})};var F=function(){return this.parent.layerTracking.features.filter(function(e){return e instanceof TC.feature.Polyline})[0]};TC.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.layerTracking.features.length>0&&this.parent.layerTracking.features[0].geometry.length>=1};TC.wrap.control.Geolocation.prototype.showElevationMarker=function(e){TC.wrap.control.ResultsPanel.prototype.showElevationMarker.call(this,{data:e,layer:this.parent.layerTrack,coords:this.parent.chart.coordinates})};TC.wrap.control.Geolocation.prototype.hideElevationMarker=function(){TC.wrap.control.ResultsPanel.prototype.hideElevationMarker.call(this)};TC.wrap.control.Geolocation.prototype.addWaypoint=function(t,o){var r=new e.Feature({geometry:new e.geom.Point([t[0],t[1],o.ele,o.time],"XYZM")});r.setProperties(o);this.parent.layerTracking.wrap.layer.getSource().addFeature(r)};TC.wrap.control.Geolocation.prototype.addPosition=function(e,t,o,r,n,i,a){var s=Math.round(e[0]),l=Math.round(e[1]),c=F.call(this);if(this.parent.layerTracking.features&&c){var u=c.geometry.length>0&&c.geometry[c.geometry.length-1];if(u&&0==u.length){this.parent.layerTracking.features[0].geometry.push([s,l,a,o]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,o])}else{var h=Math.round(u[0]),d=Math.round(u[1]);if(s!=h||l!=d){this.parent.layerTracking.features[0].geometry.push([s,l,a,o]);c.wrap.feature.getGeometry().appendCoordinate([s,l,a,o])}}TC.Util.storage.setSessionLocalValue(this.parent.Const.LocalStorageKey.TRACKINGTEMP,this.formattedToStorage(this.parent.layerTracking).features)}this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:void 0!=t&&void 0!=r&&r>0&&t>0})};TC.wrap.control.Geolocation.prototype.positionChangehandler=function(e){const t=this;var o,r,n,i,a;F.call(this)||t.setTracking(!1);return new Promise(function(s,l){if(e&&e.coords){t.parent.layerGPS.clearFeatures();o=e.coords.accuracy/t.parent.map.getMetersPerUnit()||0;r=e.coords.heading||e[2]||0;n=e.coords.speed?3.6*e.coords.speed:0;i=e.coords.altitude||0;a=e.coords.altitudeAccuracy||0;if(t.parent.layerTracking){var c=[e.coords&&e.coords.longitude||e[0],e.coords&&e.coords.latitude||e[1]],u=TC.Util.reproject(c,"EPSG:4326",t.parent.map.crs);t.addPosition(u,r,(new Date).getTime(),n,o,a,i);var h=F.call(t).geometry,d=h.length;d>=2&&(t.parent.deltaMean=(h[d-1][3]-h[0][3])/(d-1));t.parent.trigger(t.parent.Const.Event.POSITIONCHANGE,{pd:{position:u,altitude:i,accuracy:o,heading:TC.Util.radToDeg(r),speed:n}});Promise.all([t.parent.layerGPS.addPoint(u,{radius:4,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),t.parent.layerGPS.addCircle([u,o],{strokeColor:"#00CED1",strokeWidth:.4,fillColor:"#ffffff",fillOpacity:.2,showsPopup:!1})]).then(function(e){const o=e[0],r=e[1];t.parent.geopositionTracking=!0;if(0==t.parent.firstPosition){t.parent.firstPosition=!0;if(!t.parent.trackCenterButton){t.parent.trackCenterButton=t.parent.div.querySelector("."+t.parent.CLASS+"-track-center");t.parent.trackCenterButton.querySelector("button").addEventListener("click",function(){t.parent.layerGPS.map.zoomToFeatures(t.parent.layerGPS.features);t.parent.track.infoPanel.isVisible()||t.parent.track.infoPanel.doVisible();t.parent.track.infoPanel.isMinimized()&&t.parent.track.infoPanel.maximize()});var n=t.parent.map.getControlsByClass("TC.control.ControlContainer")[0];n?t.parent.trackCenterButton=n.addElement({side:n.SIDE.LEFT,htmlElement:t.parent.trackCenterButton}):t.parent.map.div.appendChild(t.parent.trackCenterButton)}t.parent.trackCenterButton.classList.remove(TC.Consts.classes.HIDDEN);t.parent.layerGPS.map.zoomToFeatures(t.parent.layerGPS.features)}s({marker:o,accuracy:r})})}else s(null)}else s(null)})};TC.wrap.control.Geolocation.prototype.setTracking=function(t){var o=this;if(t){o.parent.firstPosition=!1;var r,n=[];if(o.parent.sessionTracking){var i=(new TC.wrap.parser.JSON).parser.readFeatures(o.parent.sessionTracking);i&&o.parent.storageCRS!==o.parent.map.crs&&(i=i.map(function(e){var t=e.clone();t.getGeometry().transform(o.parent.storageCRS,o.parent.map.crs);return t}));var a=i.filter(function(e){var t=e.getGeometry().getType().toLowerCase();"point"===t&&n.push(e);return"linestring"===t||"multilinestring"===t})[0].getGeometry().getCoordinates();r=new e.Feature({geometry:new e.geom.LineString(a,"XYZM"),tracking:!0})}else r=new e.Feature({geometry:new e.geom.LineString([],"XYZM"),tracking:!0});r&&TC.wrap.Feature.createFeature(r).then(function(e){o.parent.layerTracking.addFeature(e);e.geometry.length>1&&o.parent.map.zoomToFeatures(o.parent.layerTracking.features);n.length>0&&Promise.all(n.map(function(e){return TC.wrap.Feature.createFeature(e)})).then(function(e){e&&e.forEach(function(e){o.parent.layerTracking.addFeature(e)})});o.parent.currentPositionWaiting=o.parent.getLoadingIndicator().addWait();o.currentPositionTrk||(o.currentPositionTrk=[]);var t,r=0,i=0,a=!1,s={enableHighAccuracy:!0,timeout:6e5};t=setInterval(function e(n){var l=r++;navigator.geolocation.getCurrentPosition(function(e){clearInterval(t);o.parent.getLoadingIndicator().removeWait(o.parent.currentPositionWaiting);o.positionChangehandler(e).then(function(e){1==o.parent.geopositionTracking&&e&&e.marker&&e.accuracy&&o.currentPositionTrk.push(navigator.geolocation.watchPosition(o.positionChangehandler.bind(o),o.parent.onGeolocateError.bind(o.parent),s))})},n||function(r){switch(r.code){case r.TIMEOUT:if(i>10){clearInterval(t);o.parent.onGeolocateError.call(o.parent,r)}else{i++;e(function(){clearInterval(t);if(!a){a=!0;o.parent.onGeolocateError.call(o.parent,r)}})}break;default:clearInterval(t);o.parent.onGeolocateError.call(o.parent,r)}},{timeout:5e3+l,maximumAge:10,enableHighAccuracy:!0})},1e3);setTimeout(function(){if(o.parent.layerTracking&&o.parent.layerTracking.features&&o.parent.layerTracking.features.length>0&&0==o.parent.layerTracking.features[0].geometry.length){clearInterval(t);o.parent.getLoadingIndicator().removeWait(o.parent.currentPositionWaiting);o.map.toast(o.parent.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});o.parent.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);o.parent.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}},s.timeout+1e3)})}else{o.parent.firstPosition=!1;if(o.currentPositionTrk){o.currentPositionTrk=o.currentPositionTrk instanceof Array?o.currentPositionTrk:[o.currentPositionTrk];o.currentPositionTrk.forEach(function(e){navigator.geolocation.clearWatch(e)});o.currentPositionTrk=[]}o.parent.trackCenterButton&&o.parent.trackCenterButton.classList.add(TC.Consts.classes.HIDDEN)}};TC.wrap.control.Geolocation.prototype.activateSnapping=function(){if(!TC.Util.detectMobile()){this.olMap.on([e.MapBrowserEventType.POINTERMOVE,e.MapBrowserEventType.SINGLECLICK],this._snapTrigger);this.olMap.on(e.render.EventType.POSTCOMPOSE,this._postcomposeTrigger)}};TC.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var t=this;t.parent.map.wrap.getMap().then(function(o){if(!TC.Util.detectMobile()){o.un([e.MapBrowserEventType.POINTERMOVE,e.MapBrowserEventType.SINGLECLICK],t._snapTrigger);o.un(e.render.EventType.POSTCOMPOSE,t._postcomposeTrigger)}t.snapInfo&&o.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");if(t.snapLine){delete t.snapLine;o.render()}})};TC.wrap.control.Geolocation.prototype.clear=function(e){e&&e.clearFeatures();attachedDTD=!1;this.deactivateSnapping.call(this)};TC.wrap.control.Geolocation.prototype.duringTrackSnap=function(t){var o=t.vectorContext;if(o&&this.snapLine){"function"==typeof o.setFillStrokeStyle&&o.setFillStrokeStyle(null,new e.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1}));"function"==typeof o.drawGeometry&&o.drawGeometry(this.snapLine.wrap.feature.getGeometry())}};TC.wrap.control.Geolocation.prototype.endSnap=function(){var e=this;e.parent.map.wrap.getMap().then(function(t){e.snapInfo&&t.removeOverlay(e.snapInfo);e.snapInfoElement&&(e.snapInfoElement.style.display="none");e.snapLine&&delete e.snapLine})};TC.wrap.control.Geolocation.prototype.initSnap=function(t,o){var r=this;if(r.parent.layerTrack){var n=r.parent.layerTrack.wrap.layer.getSource().getClosestFeatureToCoordinate(t);if(null!==n){var i=n.getGeometry().getClosestPoint(t);const h=r.parent.map.getPixelFromCoordinate(i);if(Math.sqrt(Math.pow(o[0]-h[0],2)+Math.pow(o[1]-h[1],2))>r.parent.snappingTolerance)r.endSnap();else{var a=[t,[i[0],i[1]]];r.snapLine?r.snapLine.wrap.feature.getGeometry().setCoordinates(a):r.snapLine=new TC.feature.Polyline(a);r.snapInfoElement||(r.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]);r.snapInfoElement.style.display="block";if(!r.snapInfo){r.snapInfo=new e.Overlay({element:r.snapInfoElement,offset:[5,18]});r.olMap.addOverlay(r.snapInfo)}void 0==r.snapInfo.getMap()&&r.snapInfo.setMap(r.olMap);r.snapInfo.setPosition(t);var s={};"LineString"!=n.getGeometry().getType()&&n.getKeys().indexOf("name")>-1&&(s.n=n.get("name"));var l=r.parent.map.options.locale&&r.parent.map.options.locale.replace("_","-")||void 0;s.x=r.map.wrap.isGeo()?i[0].toLocaleString(l,{minimumFractionDigits:5}):Math.round(i[0]).toLocaleString(l);s.y=r.map.wrap.isGeo()?i[1].toLocaleString(l,{minimumFractionDigits:5}):Math.round(i[1]).toLocaleString(l);r.map.wrap.isGeo()&&(s.isGeo=!0);var c=function(e){return i[e]?(Math.round(100*i[e])/100).toLocaleString(l):void 0},u=function(e){return i[e]>0?new Date(i[e]).toLocaleString(l):void 0};if(n.getGeometry().getLayout()===e.geom.GeometryLayout.XYZM){s.z=c(2);s.m=u(3)}else n.getGeometry().getLayout()===e.geom.GeometryLayout.XYZ?s.z=c(2):n.getGeometry().getLayout()===e.geom.GeometryLayout.XYM&&(s.m=u(2));s&&r.parent.getRenderedHtml(r.parent.CLASS+"-track-snapping-node",s,function(e){r.snapInfoElement.innerHTML=e})}}}r.olMap.render()};TC.wrap.control.Geolocation.prototype.drawTrackingData=function(e){const t=this;return new Promise(function(o,r){const n=[],i=(new TC.wrap.parser.JSON).parser.readFeatures(e.data);i.filter(function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()}).forEach(function(t){t.getGeometry().setCoordinates(t.getGeometry().getCoordinates(),e.layout)});t.activateSnapping.call(t);for(var a=0,s=i.length;a<s;a++)n.push(TC.wrap.Feature.createFeature(i[a]));Promise.all(n).then(function(e){e.forEach(function(e){e&&t.parent.layerTrack.addFeature(e)});t.parent.map.zoomToFeatures(t.parent.layerTrack.features);o()})})};TC.wrap.control.Geolocation.prototype.formattedFromStorage=function(t){const o=this;if(o.parent.storageCRS!==o.parent.map.crs){var r=(new e.format.GeoJSON).readFeatures(t);if(r){r=r.map(function(e){var t=e.clone();t.getGeometry().transform(o.parent.storageCRS,o.parent.map.crs);return t});return(new e.format.GeoJSON).writeFeatures(r)}}return t};TC.wrap.control.Geolocation.prototype.formattedToStorage=function(t,o,r){var n=this,i=new TC.wrap.parser.JSON;i=i.parser;var a,s=t.wrap.layer.getSource().getFeatures();s=s.map(function(t){t.getGeometry()instanceof e.geom.LineString&&(a=t.getGeometry().getLayout());o&&t.getProperties().tracking&&t.unset("tracking");if(!r&&n.parent.map.crs!==n.parent.storageCRS){var i=t.clone();i.getGeometry().transform(n.parent.map.crs,n.parent.storageCRS);return i}return t}).sort(function(t,o){return t.getGeometry()instanceof e.geom.Point&&!(o.getGeometry()instanceof e.geom.Point)?-1:o.getGeometry()instanceof e.geom.Point&&!(t.getGeometry()instanceof e.geom.Point)?2:t.getProperties().name<o.getProperties().name?-1:t.getProperties().name>o.getProperties().name?1:0});return{features:i.writeFeatures(s),layout:a}};TC.wrap.control.Geolocation.prototype.export=function(t,o){const r=this;return new Promise(function(n,i){var a=[];r.parent.getTrackingData(o).then(function(i){if(i){var s=(new e.format.GeoJSON).readFeatures(i.data);if(0===s.length){var l=r.parent.getTrackingData(o);s=(new e.format.GeoJSON).readFeatures(l)}a=s.map(function(t){var o=t.clone();o.getGeometry().transform(r.parent.map.crs,"EPSG:4326");return o.getGeometry()instanceof e.geom.LineString?new e.Feature({geometry:new e.geom.MultiLineString([o.getGeometry().getCoordinates()],"XYZM")}):o})}switch(t){case"GPX":n(a?(new e.format.GPX).writeFeatures(a):null);break;case"KML":n(a?(new e.format.KML).writeFeatures(a):null)}})})};var k,G,B=function(e){var t=[],o=[];if(e.length>1){4==e[0].length&&(e=e.sort(function(e,t){return e[0][3]==t[0][3]?0:e[0][3]<t[0][3]?-1:1}));for(var r=0;r<e.length;r++){for(var n=e[r],i=-1,a=1/0,s=n.getLastCoordinate(),l=r+1;l<e.length;l++){var c=e[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);if(u<a){i=l;a=u}}if(t.length<e.length){if(-1==t.indexOf(r)){t.push(r);o=o.concat(n.getCoordinates())}if(-1==t.indexOf(i)){t.push(i);o=o.concat(e[i].getCoordinates())}}}return o}return e[0].getCoordinates()};TC.wrap.control.Geolocation.prototype.processImportedFeatures=function(t){for(var o=this,r=o.parent.layerTrack.wrap.layer.getSource(),n=o.parent.importedFileName,i=[],a=[],s=[],l=[],c=r.getFeatures(),u=[],h=[],d=function(e){e.getProperties().hasOwnProperty("name")&&e.getProperties().name.trim().length>0?i.push(e.getProperties().name):i.push(n)},p=0;p<c.length;p++){var f=c[p];f instanceof TC.Feature&&(f=c[p].wrap.feature);if(f.getGeometry()instanceof e.geom.Point){h.push(f.getGeometry().getCoordinates());l.push(f)}else if(f.getGeometry()instanceof e.geom.LineString){d(f);a.push(new e.Feature({geometry:new e.geom.LineString(f.getGeometry().getCoordinates(),f.getGeometry().getLayout())}));s.push(f)}else if(f.getGeometry()instanceof e.geom.MultiLineString){var g=f.clone();d(g);var m=g.getGeometry().getLineStrings(),y=B(m);a.push(new e.Feature({geometry:new e.geom.LineString(y,f.getGeometry().getLayout())}));s.push(f)}}if(u.length>0){y=B(u);a.push(new e.Feature({geometry:new e.geom.LineString(y)}))}h.length>0&&l.length==c.length&&a.push(new e.Feature({geometry:new e.geom.LineString(h)}));if(s.length>0)for(var C=0;C<s.length;C++)r.removeFeature(s[C]);if(a.length>0){var v,T=0;(function(){const e=a.map(function(e,s){return new Promise(function(e,l){v&&r.removeFeature(v);if(i.length>s){var c=i[s];(function(e,t){for(var o=[],r=e.indexOf(t);-1!=r;){o.push(r);r=e.indexOf(t,r+1);if(o.length>1)return!0}return o.length>1})(i,c)&&(c="["+(s+1)+"] "+c)}o.parent.importedFileName=c||n;v=a[s];r.addFeature(v);o.parent.saveTrack({message:o.parent.getLocaleString("geo.trk.upload.ok",{trackName:c||n}),importedFileName:c||n,notReproject:t.notReproject}).then(function(t){0==s&&(T=t);e()})})});return Promise.all(e)})().then(function(){o.parent.layerTrack.setVisibility(!1);o.parent.layerTrack.clearFeatures();o.parent.trigger(o.parent.Const.Event.IMPORTEDTRACK,{index:T});delete o.parent.importedFileName;o.parent.getLoadingIndicator().removeWait(t.wait)})}else{if(o.parent.layerTrack){o.parent.map.removeLayer(o.parent.layerTrack);o.parent.layerTrack=void 0}delete o.parent.importedFileName;o.parent.getLoadingIndicator().removeWait(t.wait);TC.alert(o.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.import=function(t,o,r){var n,i,a=this;if(o&&o.text){var s=a.parent.layerTrack.wrap.createVectorSource({data:o.text,type:r});n=s.source;i=n.on("change",function(o){if("ready"==n.getState()){e.Observable.unByKey(i);a.processImportedFeatures(t)}});a.parent.layerTrack.wrap.layer.setSource(n)}else{if(a.parent.layerTrack){a.parent.map.removeLayer(a.parent.layerTrack);a.parent.layerTrack=void 0}delete a.parent.importedFileName;a.parent.getLoadingIndicator().removeWait(t);TC.alert(a.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.simulateTrackEnd=function(){this.parent.chartProgressClear();if(this.simulateMarker){window.cancelAnimationFrame(k);this.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&this.simulateMarker.layer.removeFeature(this.simulateMarker);delete this.simulateMarker}};TC.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var t,o=this,r=o.parent.layerTrack.wrap.layer.getSource().getFeatures(),n=0;n<r.length;n++)if(r[n].getGeometry()instanceof e.geom.LineString){t=r[n].getGeometry().getCoordinates();break}if(t&&t.length>0){var i=t[0];new Promise(function(e,t){if(o.simulateMarker){o.simulateMarker.setCoords(i.slice(0,2));e(o.simulateMarker)}else o.parent.layerTrack.addPoint(i.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}).then(function(t){e(t)})}).then(function(r){o.simulateMarker=r;var n=function(){t.length;var r,n=!1;const i=function(e){return o.parent.map.crs!==o.parent.map.options.utmCrs?TC.Util.reproject(e,o.parent.map.crs,o.parent.map.options.utmCrs):e};var a=t;if(4==a[0].length&&a[0][3]>0){r=a[0][3];a[a.length-1][3];n=!0}else{a[0][3]=Date.now();for(var s=1;s<a.length;s++){a[s][3]=0;h=s+1<a.length?new e.geom.LineString(i(a.slice(s-1,s+1))).getLength():new e.geom.LineString(i(a.slice(s-1))).getLength();a[s][3]=a[s-1][3]+36e5*h/o.parent.walkingSpeed}r=a[0][3];a[a.length-1][3]}var l=new e.geom.LineString(a),c=r,u=0;u=o.parent.map.crs!==o.parent.map.options.utmCrs?new e.geom.LineString(i(JSON.parse(JSON.stringify(a)))).getLength():l.getLength();var h=0,d=function(){if(!o.parent.simulate_paused){var t=l.getCoordinateAtM(c),r=function(t){for(var o=0;o<a.length;o++)if(a[o][3]>t)return{d:new e.geom.LineString(i(a.slice(0,o))).getLength(),p:a[o-1].slice(0,2)}}(c);if(!t||!r){o.simulateTrackEnd();var s=o.parent.getSelectedTrack();s&&o.parent.uiSimulate(!1,s);o.parent.hasElevation&&o.parent.chartProgressClear();return}o.parent.hasElevation&&o.parent.chartSetProgress(r,t,u,!!n&&o.parent._getTime(a[0][3],t[3]));if(o.simulateMarker){var h=o.simulateMarker.getCoords(),p=t;Math.atan2(p[1]-h[1],p[0]-h[0]),Math.PI;o.simulateMarker.setCoords(t)}1!==o.parent.simulate_speed?c+=o.parent.delta*o.parent.simulate_speed:c+=o.parent.delta}k=requestAnimationFrame(d)};k=requestAnimationFrame(d)};new Promise(function(e,t){window.d3?e():TC.loadJS(!window.d3,[TC.Consts.url.D3C3],function(){e()})}).then(function(){k=requestAnimationFrame(n)})})}};TC.wrap.control.Geolocation.prototype.headingChangehandler=function(e){var t=this;if(!t.parent.track.infoOnMap){t.parent.track.infoOnMap=document.createElement("div");const e=t.parent.track.infoOnMap.style;e.overFlowY="scroll";e.height="200px";e.width="200px";e.top="0";e.left="100px";e.backgroundColor="fuchsia";e.position="absolute";t.parent.map.div.appendChild(t.parent.track.infoOnMap)}t.parent.track.infoOnMap.style.display="";t.heading=e.target.getHeading();t.parent.track.infoOnMap.innerHTML=t.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+t.heading+" </p>";t.map.wrap.getMap().then(function(e){e.getView().setRotation(-t.heading)});t.parent.trigger(t.parent.Const.Event.STATEUPDATED,{moving:void 0!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.orientationChangehandler=function(e){var t=this.map.wrap.map.getView(),o=t.getCenter(),r=t.getResolution(),n=e.target.getBeta()||0,i=e.target.getGamma()||0;o[0]-=r*i*25;o[1]+=r*n*25;t.setCenter(t.constrainCenter(o));this.parent.trigger(this.parent.Const.Event.STATEUPDATED,{moving:void 0!=heading&&heading>0})};TC.wrap.control.Geolocation.prototype.pulsate=function(t){this.pulsated=!0;var o,r=t.wrap.feature.getGeometry().getRadius(),n=(new Date).getTime();o=this.olMap.on(e.render.EventType.POSTCOMPOSE,function(i){var a=i.vectorContext,s=i.frameState,l=s.time-n,c=t.wrap.feature.getGeometry().clone(),u=function(e){switch(!0){case e<=50:return r;case e>50&&e<=100:return 1.02*r;case e>100&&e<=150:return 1.05*r;case e>150&&e<=200:return 1.02*r;case e>200&&e<=300:return r;case e>300&&e<=350:return 1.02*r;case e>350&&e<=400:return 1.05*r;case e>400&&e<=450:return 1.02*r;case e>450&&e<=500:return 1*r;default:return r}}(l);c.setRadius(u);a.setFillStrokeStyle(new e.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new e.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1}));a.drawCircleGeometry(c);l>500?e.Observable.unByKey(o):s.animate=!0})};TC.wrap.control.ResultsPanel.prototype.register=function(e){const t=this;t.map=e;e.wrap.getMap().then(function(e){t.olMap=e})};TC.wrap.control.ResultsPanel.prototype.showElevationMarker=function(t){const o=this,r=(t=t||{}).data,n=t.layer,i=t.coords;if(!o.elevationMarker){const t=document.createElement("div");t.style.display="none";t.classList.add("tc-ctl-geolocation-trackMarker");t.classList.add("elevation");o.elevationMarker=new e.Overlay({element:t,offset:[0,-11],positioning:e.OverlayPositioning.CENTER_CENTER,stopEvent:!1})}if(n.getVisibility()&&n.getOpacity()>0){o.elevationMarker.getElement().style.display="";o.olMap.addOverlay(o.elevationMarker);o.elevationMarker.setPosition(i[r[0].index])}};TC.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){this.elevationMarker&&(this.elevationMarker.getElement().style.display="none")};TC.wrap.control.Coordinates.prototype.coordsActivate=function(){this.olMap.on(e.MapBrowserEventType.SINGLECLICK,this._coordsTrigger)};TC.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(e.MapBrowserEventType.SINGLECLICK,this._coordsTrigger)};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");t=$.map(this.parser.readFeatures(e),function(e){return new TC.Feature(null,{id:e.getId(),data:e.getProperties()})})}return t};TC.wrap.parser={WFS:function(t){this.parser=new e.format.WFS(t)},JSON:function(t){this.parser=new e.format.GeoJSON(t)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.OverviewMap.prototype.register=function(t){var o=this;o.parent.layer.wrap.getLayer().then(function(r){o.ovMap=new e.control.OverviewMap({target:o.parent.div,collapsed:!1,collapsible:!1,className:o.parent.CLASS+" ol-overviewmap",layers:[r]});o.ovMap._wrap=o;o.ovMap.getOverviewMap().pixelRatio_=1;o.ovMap.ovmap_.removeOverlay(o.ovMap.boxOverlay_);var n=document.createElement("DIV");n.className="ol-overviewmap-box";n.style.boxSizing="border-box";o.ovMap.boxOverlay_=new e.Overlay({position:[0,0],positioning:e.OverlayPositioning.BOTTOM_LEFT,element:n});o.ovMap.ovmap_.addOverlay(o.ovMap.boxOverlay_);o.manageSize.call(o.ovMap.ovmap_);o._boxElm=o.ovMap.boxOverlay_.getElement();TC.loadJS(!window.Draggabilly,[TC.apiLocation+"lib/draggabilly/draggabilly.pkgd.min.js"],function(){var e=o.ovMap.ovmap_;const r=new Draggabilly(o._boxElm);r.positionDrag=function(){const e=this.element.style,t="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(e.transform.length){const o=e.transform.indexOf("translate3d");if(o>=0){const r=e.transform.indexOf(")",o);e.transform=e.transform.replace(e.transform.substring(o,r+1),t)}else e.transform=t+" "+e.transform}else e.transform=t};r.on("pointerDown",function(n){r.dragged=o._boxElm.cloneNode();r.dragged.classList.add(TC.Consts.classes.ACTIVE);r.dragged.style.position="absolute";o._boxElm.insertAdjacentElement("beforebegin",r.dragged);if(t.maxExtent){var i=e.getPixelFromCoordinate([t.maxExtent[0],t.maxExtent[1]]),a=e.getPixelFromCoordinate([t.maxExtent[2],t.maxExtent[3]]),s=e.getSize();const o=document.createElement("div");o.style.position="absolute";o.style.bottom=Math.round(s[1]-i[1])+"px";o.style.left=Math.round(i[0])+"px";o.style.top=Math.round(a[1])+"px";o.style.right=Math.round(s[0]-a[0])+"px";const n=e.getViewport();n.insertBefore(o,n.firstElementChild);r.options.containment=o}});r.on("pointerUp",function(o){r.dragged.parentElement.removeChild(r.dragged);if(t.maxExtent){e.getViewport().removeChild(r.options.containment);r.options.containment=null}});r.on("dragMove",function(e,t,o){r._delta=o});r.on("dragEnd",function(n,i){var a=o.ovMap.getMap().getView(),s=e.getPixelFromCoordinate(a.getCenter()),l=e.getCoordinateFromPixel([s[0]+r._delta.x,s[1]+r._delta.y]),c=t.getExtent(),u=(c[2]-c[0])/2,h=(c[3]-c[1])/2;l[0]+u>t.maxExtent[2]?l[0]=t.maxExtent[2]-u:l[0]-u<t.maxExtent[0]&&(l[0]=t.maxExtent[0]+u);l[1]+h>t.maxExtent[3]?l[1]=t.maxExtent[3]-h:l[1]-h<t.maxExtent[1]&&(l[1]=t.maxExtent[1]+h);r.setPosition(0,0);delete r._delta;t.setCenter(l,{animate:!0})})});t.wrap.getMap().then(function(e){o.reset();const t=o.parent.div.querySelector("."+o.parent.CLASS+"-load");r._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){t.classList.remove(TC.Consts.classes.HIDDEN);t.classList.add(TC.Consts.classes.VISIBLE)});r._wrap.$events.on(TC.Consts.event.TILELOAD,function(){t.classList.remove(TC.Consts.classes.VISIBLE);t.classList.add(TC.Consts.classes.HIDDEN)});e.addControl(o.ovMap);o.parent.isLoaded=!0;o.parent.trigger(TC.Consts.event.MAPLOAD)})})};TC.wrap.control.OverviewMap.prototype.reset=function(t){const o=this;return new Promise(function(r,n){const i=function(t,n){if(t.type===TC.Consts.layerType.WMTS){var i={crs:n||o.parent.map.crs,oldCrs:t.wrap.layer.getSource().getProjection().getCode()};i.oldCrs!==i.crs&&t.setProjection(i)}t.wrap.getLayer().then(function(n){var i=new e.View(C(o.parent.map.wrap,n._wrap.parent));if(i.getResolutions()){i.setResolution(i.getResolutions().filter(function(e){return e>i.getResolutionForExtent(o.parent.map.getExtent(),s.getSize())}).reverse()[0]);s.setView(i)}else i.getProjection().getCode()!==s.getView().getProjection().getCode()&&s.setView(i);n._wrap.$events.one(TC.Consts.event.TILELOAD,function(){s.getLayers().getArray()[0].getSource().refresh()});if(t!==o.parent.layer||-1===s.getLayers().getArray().indexOf(t)){o.parent.map.trigger(TC.Consts.event.OVERVIEWBASELAYERCHANGE,{oldLayer:t!==o.parent.layer?o.parent.layer:null,newLayer:t});s.getLayers().forEach(function(t){(t instanceof e.layer.Image||t instanceof e.layer.Tile)&&s.removeLayer(t)});const r=o.parent.div.querySelector("."+o.parent.CLASS+"-load");n._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){r.classList.remove(TC.Consts.classes.HIDDEN);r.classList.add(TC.Consts.classes.VISIBLE)});n._wrap.$events.on(TC.Consts.event.TILELOAD,function(){r.classList.remove(TC.Consts.classes.VISIBLE);r.classList.add(TC.Consts.classes.HIDDEN)});s.getLayers().insertAt(0,n)}r(t)})};var a=(t=t||{}).layer||o.parent.layer;if(o.parent.map&&a&&o.ovMap){var s=o.ovMap.ovmap_;a.getCapabilitiesPromise().then(function(){var e=a;a.isCompatible(o.parent.map.crs)||0!==a.wrap.getCompatibleMatrixSets(o.parent.map.crs).length?i(a):(a=a.getFallbackLayer()||o.parent.defaultLayer).getCapabilitiesPromise().then(function(){o.parent.map.on3DView&&!a.isCompatible(o.parent.map.crs)?o.parent.map.loadProjections({crsList:e.getCompatibleCRS(),orderBy:"name"}).then(function(t){i(e,t[0].code)}):a.isCompatible(o.parent.map.crs)&&i(a)})})}})};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var t=null;if(this.ovMap){(o=this.ovMap.getOverviewMap()).getLayers().forEach(function(e){"3DCamera"===e.get("id")&&(t=e)});if(!t){var o=this.ovMap.getOverviewMap(),r=R({});r[0].getFill().setColor([0,0,0,0]);t=new e.layer.Vector({id:"3DCamera",source:new e.source.Vector,style:r});o.addLayer(t)}}return t};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(t){if(this.parent.map.isLoaded){this.is3D=!!t;var o=this.get3DCameraLayer();if(o){var r,n=(t=t||{}).fov,i=o.getSource();if(n&&n.length){var a=i.getFeatures();if(a.length)r=a[0];else{r=new e.Feature;i.addFeature(r)}r.setGeometry(new e.geom.Polygon([n]))}else i.clear();var s="number"==typeof t.heading?t.heading:0;this._boxElm.style.transform="rotate("+s+"rad)"}}};TC.wrap.control.OverviewMap.prototype.enable=function(){if(this.parent.layer&&this.parent.layer.setVisibility){this.parent.layer.setVisibility(!0);this.parent.wrap.ovMap.ovmap_.updateSize();const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1);this.parent.map.div.dispatchEvent(e)}};TC.wrap.control.OverviewMap.prototype.disable=function(){this.parent.layer&&this.parent.layer.setVisibility&&this.parent.layer.setVisibility(!1)};TC.wrap.control.OverviewMap.prototype.manageSize=function(){TC.wrap.Map.prototype.manageSize.call(this)};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;e.wrap.getMap().then(function(o){TC.wrap.control.Click.prototype.register.call(t,e);var r=t._trigger;t._trigger=function(o){var n=r.call(t,o);n?t.parent.beforeRequest({xy:o.pixel}):e.trigger(TC.Consts.event.NOFEATUREINFO,{control:t.parent});return n}})};var U=function(e){var t=e.innerHTML||e.textContent;(G=G||document.createElement("textarea")).innerHTML=t;return G.value},j={readFeatures:function(t){var o=[],r=(new DOMParser).parseFromString(t,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,a=n.length;i<a;i++)for(var s=n[i],l=s.getAttribute("layername"),c=s.getElementsByTagName("FeatureInfo"),u=0,h=c.length;u<h;u++){for(var d=c[u].getElementsByTagName("Field"),p={},f=0,g=d.length;f<g;f++){var m=d[f];p[U(m.getElementsByTagName("FieldName")[0])]=U(m.getElementsByTagName("FieldValue")[0])}var y=new e.Feature(p);y.setId(l+"."+TC.getUID());o[o.length]=y}return o}},W=function(e,t,o){var r=t.getPath(o);e.layers.push({name:o,title:r[r.length-1],path:r.slice(1),features:[]})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(t,o,r){var n=this,i=r||{},a=n.parent.map;a.wrap.getMap().then(function(r){var s={},l={};const c=[],u=[];var h=[],d=[];T=(T=r.getLayers().getArray()).filter(function(t){return t instanceof e.layer.Image&&t.getVisible()});for(var p=0;p<T.length;p++){var f=T[p],g=f._wrap.parent;if((S=f.getSource()).getGetFeatureInfoUrl&&$.inArray(g,a.workLayers)>=0&&g.names.length>0&&(!i.serviceUrl||i.serviceUrl===g.url)){if(s[g.url]){_=s[g.url];l[g.url].source.updateParams(e.obj.assign(l[g.url].source.getParams(),S.getParams()))}else{_={layers:[],mapLayers:[],title:g.title,request:null};s[g.url]=_;l[g.url]={source:jQuery.extend(!0,{},S),layers:[]}}_.mapLayers.push(g);var m=g.getDisgregatedLayerNames();if(i.layerName){if(m.indexOf(i.layerName)>=0&&f._wrap.getInfo(i.layerName).queryable){W(_,g,i.layerName);l[g.url].layers.push(i.layerName)}}else{for(var y=0;y<m.length;y++){var C=m[y];if(f._wrap.getInfo(C).queryable)W(_,g,C);else{TC.Util.consoleRegister('Capa "'+m[y]+'" no queryable, la eliminamos de la petici\xf3n GFI');m.splice(y,1);y-=1}}m.length>0&&(l[g.url].layers=l[g.url].layers.concat(m))}}}for(var v in s){d.push(s[v]);var T,_=s[v],S=l[v].source;if(!(T=l[v].layers)||T&&0===T.length)continue;var E=S.getParams();S.params_.LAYERS=T.join(",");var L=S.getGetFeatureInfoUrl(t,o,a.crs,{QUERY_LAYERS:T.join(","),INFO_FORMAT:E.INFO_FORMAT,FEATURE_COUNT:1e3,radius:a.options.pixelTolerance,buffer:a.options.pixelTolerance}),w=L=L.replace(/sld_body=[a-zA-Z%0-9._]*/);const e={serviceUrl:v,requestedFormat:E.INFO_FORMAT,expandUrl:w};u.push(e);c.push(new Promise(function(t,o){const r=_.mapLayers[0];r.toolProxification.fetch(L).then(function(o){r.toolProxification.cacheHost.getAction(e.expandUrl).then(function(n){e.originalUrl=n.action.call(r.toolProxification,e.expandUrl);t($.extend({},o,e))})}).catch(function(e){o(Error(e))})}));TC.Util.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then(function(r){for(var l=!1,c=0,d=[],p=0;p<r.length;p++){var f,g=r[p],m=s[u[p].serviceUrl];l=!0;m.text=g.responseText;var y=g.contentType;y&&y.indexOf(";")>-1&&(y=y.substr(0,y.indexOf(";")).trim());y||(y=g.requestedFormat);if(y===g.requestedFormat){switch(y){case"application/json":f=new e.format.GeoJSON;break;case"application/vnd.ogc.gml":f=g.responseText.indexOf("FeatureCollection")>-1?new e.format.WFS({gmlFormat:new e.format.GML2({srsName:a.crs})}):new e.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":f=new e.format.GML3Patched({srsName:a.crs});break;case"application/vnd.esri.wms_featureinfo_xml":f=j;break;default:f=null}if(f){var C=f.readFeatures(g.responseText,{featureProjection:e.proj.get(a.crs)});c+=C.length;for(var v=function(e,t,o){var r=!1;if(t===o)r=!0;else{var n=e.getNodePath(t),i=e.getNodePath(o);if(n.length>0&&i.length>=n.length){r=!0;for(var a=0;a<n.length;a++)if(e.wrap.getName(n[a])!==e.wrap.getName(i[a])){r=!1;break}}}return r},T={},_=0;_<C.length;_++){var S=C[_];if(S instanceof e.Feature){for(var E=S.getId()||TC.getUID(),L=!1,w=E.substr(0,E.lastIndexOf(".")),b=0;b<m.layers.length;b++){var x=m.layers[b],A=x.name.substr(x.name.indexOf(":")+1);if(m.mapLayers.some(function(e){return v(e,A,w)})){L=!0;if(!i.featureId||S.getId()===i.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));d.push(x.features)}break}}if(!L){var P;if(T[w])P=T[w];else{P={name:w,title:w,path:[w],features:[]};T[w]=P;m.layers.push(P)}if(!i.featureId||S.getId()===i.featureId){h.push(TC.wrap.Feature.createFeature(S,{showsPopup:!1}));d.push(P.features)}}}}}else{var R={name:"layer"+TC.getUID(),title:"Datos en el punto",features:[]};m.layers[m.layers.length]=R;R.features[0]={rawUrl:g.originalUrl,expandUrl:g.expandUrl,rawContent:g.responseText,rawFormat:y};c+=1}}else{TC.Util.consoleRegister("Respuesta GFI: lo m\xe1s probable es que el servidor est\xe9 devolviendo una excepci\xf3n");TC.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada");n.parent.responseError({message:g.responseText,status:g.status});a.toast(n.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})}}if(l){var M=h;h.length&&(M=M.concat(new Promise(function(e,t){TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){e()})})));Promise.all(M).then(function(e){var r;e.forEach(function(e,o){if(e){e.attributes=[];for(var i in e.data){var a=e.data[i];"object"!=typeof a&&e.attributes.push({name:i,value:"number"==typeof a?a.toLocaleString(TC.Util.getMapLocale(n.parent.map)):a})}!r&&TC.Geometry.isInside(t,e.geometry)&&(r=e);d[o].push(e)}});var i=[];for(var a in s)s.hasOwnProperty(a)&&i.push(s[a]);n.parent.responseCallback({coords:t,resolution:o,services:i,featureCount:c,defaultFeature:r})})}},function(e,r,i){if(d&&0==d.length)for(var l in s)d.push(s[l]);n.parent.responseCallback({coords:t,resolution:o,services:d,featureCount:0});a.toast(n.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})});else{a.workLayers.filter(function(e){return e instanceof TC.layer.Raster}).length>0&&a.toast(n.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:TC.Consts.msgType.INFO});if(d&&0==d.length)for(var v in s)d.push(s[v]);a.on(TC.Consts.event.BEFOREFEATUREINFO,function(){n.parent.responseCallback({coords:t,resolution:o,services:d,featureCount:0})});n.parent.responseCallback({coords:t,resolution:o,services:d,featureCount:0})}})};TC.wrap.control.GeometryFeatureInfo.prototype.register=function(t){var o=this;t.wrap.getMap().then(function(r){TC.wrap.control.Click.prototype.register.call(o,t);var n=o._trigger;o._trigger=function(t){o.hasEligibleLayers().then(function(r){r&&(o.parent._isSearching||t.type!=e.MapBrowserEventType.SINGLECLICK||o.parent._isDrawing||o.parent._isSearching||n.call(o,t))})}})};TC.wrap.control.GeometryFeatureInfo.prototype.hasEligibleLayers=function(){const e=this;return new Promise(function(t,o){const r=e.parent.map;var n=!1;r.wrap.getMap().then(function(e){e.getLayers().forEach(function(e){var t=e._wrap.parent;if(e.getSource().getGetFeatureInfoUrl&&$.inArray(t,r.workLayers)>=0){n=!0;return!1}});t(n)})})};TC.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(t){var o=this,r=(t=t||{}).xy,n=t.layer,i=t.callback,a=t.geometryType,s=!1;if(o.drawCtrl){o.drawCtrl.setActive(!0);o.drawCtrl.startDrawing_({coordinate:r})}else n.wrap.getLayer().then(function(t){var n;switch(a){case TC.Consts.geom.POLYLINE:n=e.geom.GeometryType.LINE_STRING;break;default:n=e.geom.GeometryType.POLYGON}o.drawCtrl=new e.interaction.Draw({source:t.getSource(),type:n,style:t.getStyle()});var l=function(e){e.parent.showsPopup=!1};t.getSource().on(e.source.VectorEventType.ADDFEATURE,function(e){e.feature._wrap?l(e.feature._wrap):e.feature._wrapPromise.then(l)});o.drawCtrl.handleEvent=function(t){if(t.type==e.MapBrowserEventType.SINGLECLICK){var o=n===e.geom.GeometryType.POLYGON?this.sketchCoords_[0]:this.sketchCoords_;s&&2==o.length&&null!==this.sketchFeature_?this.addToDrawing_(t):s=!0}return e.interaction.Draw.handleEvent.call(this,t)};const c=o.parent.map.wrap.map;c.addInteraction(o.drawCtrl);o.drawCtrl.on(e.interaction.DrawEventType.DRAWSTART,function(t){o.parent._isDrawing=!0;c.getInteractions().forEach(function(t,o){t instanceof e.interaction.DoubleClickZoom&&t.setActive(!1)})});o.drawCtrl.startDrawing_({coordinate:r});o.drawCtrl.on(e.interaction.DrawEventType.DRAWEND,function(r){o.parent._isDrawing=!1;c.getInteractions().forEach(function(t,o){t instanceof e.interaction.DoubleClickZoom&&t.setActive(!1)});c.removeInteraction(o.drawCtrl);this.setActive(!1);o.drawCtrl=null;t.getSource().clear();o.parent._drawToken=!0;setTimeout(function(){o.parent._drawToken=!1},500);i&&TC.wrap.Feature.createFeature(r.feature).then(function(e){i(e)})})})};TC.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(e,t,o){if(this.drawCtrl&&this.parent._isDrawing){this.parent._isDrawing=!1;this.drawCtrl.setActive(!1);this.drawCtrl.source_.clear()}};var V=function(e,t,o,r){const n=[];var i={};const a=function(e){const t=e.mapLayers[0];return e.title||e.mapLayers.reduce(function(e,t){return e||t.title},"")||t.tree&&t.tree.title||t.capabilities.Service.Title};e.wrap.map.getLayers().forEach(function(s){var l=s._wrap.parent;if(s.getVisible()&&!($.inArray(l,e.workLayers)<0)&&l.type===TC.Consts.layerType.WMS){var c=l.getDisgregatedLayerNames()||l.availableNames,u=i[l.url.toLowerCase()];u||(u=i[l.url.toLowerCase()]={layers:[],mapLayers:[l],layerNames:[]});for(var h=0;h<c.length;h++){var d=c[h];if((l.isVisibleByScale(d)||r)&&l.wrap.getInfo(d).queryable){u.layerNames.push(d);var p=l.getPath(d);u.layers.push({name:d,title:p[p.length-1],path:p.slice(1),features:[]})}}if(0!=u.layerNames.length&&void 0===u.request){u.request=u.request||l.getWFSCapabilitiesPromise();n.push(new Promise(function(e,n){u.request.then(function(s){var l=null,c=[];for(var h in i)i[h].request&&i[h].request==u.request&&(l=i[h]);var d=null,p=l.layerNames;if(p instanceof Array&&p.length)if(void 0!==s.Operations.GetFeature){for(var f=[],g=0;g<p.length;g++){for(var m=p[g].substring(p[g].indexOf(":")+1);"_"===m[m.length-1];)m=m.substring(0,m.lastIndexOf("_"));if(s.FeatureTypes.hasOwnProperty(m))f.indexOf(m)<0&&f.push(m);else{var y=l.mapLayers[0].getPath(m);c.push({key:TC.Consts.WFSErrors.LayersNotAvailable,params:{serviceTitle:a(l),layerName:y[y.length-1]}})}}if(0!=f.length){s.Operations.GetFeature.CountDefault&&(d=s.Operations.GetFeature.CountDefault.DefaultValue);if("1.0.0"===s.version&&!s.Operations.GetFeature.Operations.hasOwnProperty("Query")||("2.0.0"===s.version||"1.1.0"===s.version)&&s.Operations.QueryExpressions.AllowedValues.Value.indexOf("wfs:Query")<0){c.push({key:TC.Consts.WFSErrors.QueryNotAvailable,params:{serviceTitle:a(l)}});e({errors:c})}else{h=s.Operations.GetFeature.DCPType?s.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:s.Operations.GetFeature.DCP.HTTP.Post["xlink:href"];l.mapLayers[0].getFeatureUrl(h).then(function(i){d?jQuery.ajax({url:i,data:TC.Util.WFSQueryBuilder(f,t,s,o,!0),cache:!1,contentType:"application/xml",type:"POST"}).then(function(){if(arguments[0]instanceof XMLDocument){var n=xml2json(arguments[0]);if(n.Exception){e({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText,serviceTitle:l.mapLayers.reduce(function(e,t){return e||t.title},"")}}]});return}}var i=parseInt(n.numberMatched||n.numberOfFeatures,10);isNaN(i)||i>parseInt(d,10)?e({errors:[{key:TC.Consts.WFSErrors.NumMaxFeatures,params:{limit:d,serviceTitle:a(l)}}]}):0===i?e({errors:[{key:TC.Consts.WFSErrors.NoFeatures,params:{serviceTitle:a(l)}}]}):r&&e({url:h,data:TC.Util.WFSQueryBuilder(f,t,s,o,!1),service:l,numFeatures:i,errors:c})},function(t,o,r){e({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:o,errorThrown:r,serviceTitle:a(l)}}]})}):r||e({url:i,data:TC.Util.WFSQueryBuilder(f,t,s,o,!1),service:l,errors:c});r&&!d&&e({url:h,data:TC.Util.WFSQueryBuilder(f,t,s,o,!1),service:l,errors:c});r||jQuery.ajax({url:i,data:TC.Util.WFSQueryBuilder(f,t,s,o,!1),cache:!1,contentType:"application/xml",type:"POST"}).then(function(){if("success"==arguments[1]){if(arguments[0]instanceof XMLDocument){var t=xml2json(arguments[0]);if(t.Exception){e({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:t.Exception.exceptionCode,errorThrown:t.Exception.ExceptionText,serviceTitle:l.mapLayers.reduce(function(e,t){return e||t.title},"")}}]});return}}e({service:l,response:arguments,errors:c})}else n(arguments)},function(t,o,r){e({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:o,errorThrown:r,serviceTitle:a(l)}}]})})})}}else{c.push({key:TC.Consts.WFSErrors.NoValidLayers,params:{serviceTitle:a(l)}});e({errors:c})}}else{c.push({key:TC.Consts.WFSErrors.GetFeatureNotAvailable,params:{serviceTitle:a(l)}});e({errors:c})}},function(t,o,r){var n=null;for(var s in i)i[s].request&&i[s].request===u.request&&(n=i[s]);e({errors:[{key:TC.Consts.WFSErrors.GetCapabilities,params:{err:r,serviceTitle:a(n)}}]})})}))}}});return n};TC.WFSGetFeatureBuilder=V;var H=function(t,o,r){var n,i=r.getResponseHeader("Content-type");i&&i.indexOf(";")>-1&&(i=i.substr(0,i.indexOf(";")).trim());i||(i=o.requestedFormat);switch(i){case"application/json":n=new e.format.GeoJSON;break;case"application/vnd.ogc.gml":n=o.responseText.indexOf("FeatureCollection")>-1?new e.format.WFS({gmlFormat:new e.format.GML2({srsName:t.crs})}):new e.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":n=new e.format.GML3Patched({srsName:t.crs});break;case"text/xml":case"application/xml":(r=xml2json(o)).ServiceException&&TC.error(r.ServiceException);n=null;break;default:n=null}return n?n.readFeatures(r.responseText,{featureProjection:e.proj.get(t.crs)}):null},q=function(t,o){for(var r=[],n=[],i=function(e,t,o){var r=!1;if(t===o||0===t.indexOf(o))r=!0;else{var n=e.getPath(t),i=e.getPath(o);if(n.length>0&&i.length>=n.length){r=!0;for(var a=0;a<n.length;a++)if(n[a]!==i[a]){r=!1;break}}}return r},a=0;a<t.length;a++){var s=t[a];if(s instanceof e.Feature){for(var l=s.getId()||TC.getUID(),c=!1,u=l.substr(0,l.lastIndexOf(".")),h=0;h<o.layers.length;h++){var d=o.layers[h],p=d.name.substr(d.name.indexOf(":")+1);if(o.mapLayers.some(function(e){return i(e,p,u)})){c=!0;r.push(TC.wrap.Feature.createFeature(s));n[s.id_]=d.features;break}}if(!c){var f;if(fakeLayers[u])f=fakeLayers[u];else{f={name:u,title:u,features:[]};fakeLayers[u]=f;o.layers.push(f)}if(!opts.featureId||s.getId()===opts.featureId){r.push(TC.wrap.Feature.createFeature(s));n.push(f.features)}}}}return new Promise(function(e,t){Promise.all(r).then(function(t){t.forEach(function(e){e.attributes=[];for(var t in e.data){var o=e.data[t];"object"!=typeof o&&e.attributes.push({name:t,value:o})}n[e.id].push(e)});e({service:o})})})};TC.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(t,o){var r=this,n=r.parent.map;r.parent.filterFeature=t;t.layer=r.parent.filterLayer;n.wrap.getMap().then(function(i){var a=t.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!o){for(var c=null,u=1,h=l.length;u<h;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);o=i.getPixelFromCoordinate(new e.geom.Point(c).getCoordinates())}r.parent.beforeRequest({xy:o});var d=V(n,new TC.filter.intersects(t,n.crs!==n.options.crs?n.crs:void 0),"JSON");const p=[];Promise.all(d).then(function(e){for(var t=[],i=0,a=0;a<e.length;a++){const o=e[a];if(o){p[p.length]=new Promise(function(e,t){if(o.errors&&o.errors.length){for(var i=0;i<o.errors.length;i++){var a,s=TC.Consts.msgType.WARNING;!0;var l=o.errors[i];switch(l.key){case TC.Consts.WFSErrors.NumMaxFeatures:a=r.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case TC.Consts.WFSErrors.GetCapabilities:a=r.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case TC.Consts.WFSErrors.NoFeatures:!1;continue;case TC.Consts.WFSErrors.Indeterminate:a=r.parent.getLocaleString("wfs.IndeterminateError");TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:l.params.err,descripcion:l.params.errorThrown,serviceName:l.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);s=TC.Consts.msgType.ERROR;break;default:a=r.parent.getLocaleString("wfsGFI."+l.key,l.params)}n.toast(a,{type:s})}o.response||e()}});var s=e[a].response?H(n,e[a].response[0],e[a].response[2]):[];p[p.length-1]=q(s,e[a].service);t.push(e[a].service);i+=s.length}}Promise.all(p).then(function(){r.parent.responseCallback({xy:o||null,services:t,featureCount:i})})},function(e){r.parent.responseCallback({})})})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.Consts.event.PANANIMATIONSTART="pananimationstart.tc";TC.Consts.event.PANANIMATIONEND="pananimationend.tc";TC.wrap.control.Popup.prototype.fitToView=function(){var t=this,o=t.parent.map,r=t.parent.map.wrap.map,n=t.parent.popupDiv.getBoundingClientRect(),i=o.div.getBoundingClientRect(),a=r.getCoordinateFromPixel([n.left-i.left,n.top-i.top]),s=r.getCoordinateFromPixel([n.right-i.left,n.bottom-i.top]),l=a[0],c=a[1],u=s[0],h=[l,s[1],u,c],d=o.getExtent();if(!e.extent.containsExtent(d,h)){var p={left:Math.max(d[0]-h[0],0),bottom:Math.max(d[1]-h[1],0),right:Math.max(h[2]-d[2],0),top:Math.max(h[3]-d[3],0)};if(t.parent.dragged){var f=t.popup.getPosition();p.right?f[0]=f[0]-p.right:p.left&&(f[0]=f[0]+p.left);p.top?f[1]=f[1]-p.top:p.bottom&&(f[1]=f[1]+p.bottom);var g=r.getPixelFromCoordinate(f);g[1]=r.getSize()[1]-g[1];t.parent._previousContainerPosition=g;t.popup._oldUpdatePixelPosition(f)}else if(t.parent.isVisible()){var m=r.getView(),y=m.getCenter().slice();p.top?y[1]+=p.top:p.bottom&&(y[1]-=p.bottom);p.right?y[0]+=p.right:p.left&&(y[0]-=p.left);m.animate({center:y,easing:function(e){0===e&&t.parent.map.trigger(TC.Consts.event.PANANIMATIONSTART);1===e&&t.parent.map.trigger(TC.Consts.event.PANANIMATIONEND);return e}})}}};TC.wrap.control.Popup.prototype.setDragged=function(t){var o=this.popup;if(t){if(!o._oldUpdatePixelPosition){o._oldUpdatePixelPosition=o.updatePixelPosition;o.updatePixelPosition=function(){}}if(!o._newHandleOffsetChanged){o._newHandleOffsetChanged=function(){this._oldUpdatePixelPosition()};e.events.unlisten(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o.handleOffsetChanged,o);e.events.listen(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o._newHandleOffsetChanged,o)}}else{const t=o.getElement().parentElement.style;t.setProperty("top",o.rendered.top_);t.setProperty("bottom",o.rendered.bottom_);t.setProperty("left",o.rendered.left_);t.setProperty("right",o.rendered.right_);delete this.parent._previousContainerPosition;if(o._oldUpdatePixelPosition){o.updatePixelPosition=o._oldUpdatePixelPosition;delete o._oldUpdatePixelPosition}if(o._newHandleOffsetChanged){e.events.unlisten(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o._newHandleOffsetChanged,o);e.events.listen(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o.handleOffsetChanged,o);delete o._newHandleOffsetChanged}}};TC.wrap.Feature.prototype.getLegend=function(){var t={},o=P(this.feature);if(o){var r=o.getImage();if(r){if(r instanceof e.style.Icon){t.src=r.getSrc();var n=r.getScale();if(n){t.scale=n;var i=r.getImage();if(i.width){t.width=i.width*n;t.height=i.height*n}}}else r instanceof e.style.Circle&&(t.src=r.canvas_.toDataURL());if(this.parent.options.radius)t.height=t.width=2*this.parent.options.radius;else{t.width=t.width||this.parent.options.width;t.height=t.height||this.parent.options.height}}else{var a=o.getStroke(),s=o.getFill();if(a){var l=a.getColor();l&&(t.strokeColor=e.color.asString(l));var c=a.getWidth();c&&(t.strokeWidth=c)}if(s){var u=s.getColor();u&&(t.fillColor=e.color.asString(u))}}}return t};var X=function(t,o,r){var n,i={};i[r||"geometry"]=new o(t);n=new e.Feature(i);r&&n.setGeometryName(r);return n};TC.wrap.Feature.prototype.createPoint=function(t,o){if($.isArray(t))this.feature=X(t,e.geom.Point,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;this.feature.setStyle(R({styles:{point:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMarker=function(t,o){var r=TC.Util.getPointIconUrl(o);if(r){o.url=r;if($.isArray(t))this.feature=X(t,e.geom.Point,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;this.feature.setStyle(R({styles:{marker:o}},this.feature));this.setData(this.parent.data)}else this.createPoint(t,o)};TC.wrap.Feature.prototype.createPolyline=function(t,o){if($.isArray(t))this.feature=X(t,e.geom.LineString,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;o&&this.feature.setStyle(R({styles:{line:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createPolygon=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var n=r[0];$.isArray(n)||(t=[t]);for(var i=0;i<t.length;i++){var a=(r=t[i])[0],s=r[r.length-1];a[0]===s[0]&&a[1]===s[1]||(r[r.length]=a);this.parent.geometry=t;this.feature=X(t,e.geom.MultiLineString,o.geometryName)}this.parent.geometry=t;this.feature=X(t,e.geom.Polygon,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;var l=o||{};(l.strokeColor||l.strokeWidth||l.fillColor||l.fillOpacity)&&this.feature.setStyle(R({styles:{polygon:l}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMultiPolyline=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var n=r[0];$.isArray(n)||(t=[t]);this.parent.geometry=t;this.feature=X(t,e.geom.MultiLineString,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;o&&this.feature.setStyle(R({styles:{line:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMultiPolygon=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var n=r[0];if($.isArray(n)&&n.length){var i=n[0];$.isArray(i)||(t=[t])}else t=[[t]];for(var a=0,s=t.length;a<s;a++)for(var l=0,c=(r=t[a]).length;l<c;l++){var u=(n=r[l])[0],h=n[n.length-1];u[0]===h[0]&&u[1]===h[1]||(n[n.length]=u)}this.parent.geometry=t;this.feature=X(t,e.geom.MultiPolygon,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;var d=o||{};(d.strokeColor||d.strokeWidth||d.fillColor||d.fillOpacity)&&this.feature.setStyle(R({styles:{polygon:d}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createCircle=function(t,o){if($.isArray(t)&&$.isArray(t[0])&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]&&"number"==typeof t[1]){var r={};r[o.geometryName||"geometry"]=new e.geom.Circle(t[0],t[1]);this.feature=new e.Feature(r);o.geometryName&&this.feature.setGeometryName(o.geometryName)}else if(this.isNative(t)){this.feature=t;var n=t.getGeometry();this.parent.geometry=[n.getCenter(),n.getRadius()]}this.feature._wrap=this;o&&this.feature.setStyle(new e.style.Style({stroke:new e.style.Stroke({color:o.strokeColor,width:o.strokeWidth,lineDash:o.lineDash}),fill:new e.style.Fill({color:y(o.fillColor,o.fillOpacity)})}));this.setData(this.parent.data)};TC.wrap.Feature.createFeature=function(t,o){return new Promise(function(r,n){var i,a=t.getGeometry();(o=o||{}).id=t.getId();switch(!0){case a instanceof e.geom.Point:var s=t.getStyle();$.isFunction(s)&&(s=s.call(t));for(var l=s?$.isArray(s)?s:[s]:[],c=0,u=l.length;c<u;c++)if((s=l[c]).getImage()instanceof e.style.Icon){i="Marker";break}i=i||"Point";break;case a instanceof e.geom.LineString:i="Polyline";break;case a instanceof e.geom.Polygon:i="Polygon";break;case a instanceof e.geom.MultiLineString:i="MultiPolyline";break;case a instanceof e.geom.MultiPolygon:i="MultiPolygon"}i?TC.loadJS(!TC.feature||TC.feature&&!TC.feature[i],[TC.apiLocation+"TC/feature/"+i],function(){var e=new TC.feature[i](t,o);e.data=e.wrap.getData();r(e)}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){var e=new TC.Feature(t,o);e.data=e.wrap.getData();r(e)})})};TC.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()};TC.wrap.Feature.prototype.getStyle=function(){var t={},o=this.feature.getStyle();$.isFunction(o)&&(o=o.call(this.feature));var r=o?$.isArray(o)?o:[o]:[];const n=function(e,t){if(e){const o=e.getFill();if(o){t.fillColor=o.getColor();$.isArray(t.fillColor)&&(t.fillOpacity=t.fillColor[3])}}},i=function(e,t){if(e){const o=e.getStroke();if(o){t.strokeColor=o.getColor();t.strokeWidth=o.getWidth()}}};for(var a=0,s=r.length;a<s;a++){n(o=r[a],t);i(o,t);const s=o.getImage();if(s instanceof e.style.Icon){t.url=s.getSrc();const e=s.getSize(),o=s.getScale()||1;if(e){t.width=e[0]*o;t.height=e[1]*o}var l=s.getAnchor();if(l){t.anchor=[l[0]*o,l[1]*o];if(e){t.anchor[0]=t.anchor[0]/t.width;t.anchor[1]=t.anchor[1]/t.height}}}else{n(s,t);i(s,t)}var c=o.getText();if(c){t.label=c.getText();var u=c.getFont();u&&(t.fontSize=parseInt(u.match(/\d+pt/))||.75*parseInt(u.match(/\d+px/)));var h=c.getRotation();h&&(t.angle=-180*h/Math.PI);t.labelOffset=[c.getOffsetX(),c.getOffsetY()];fill=c.getFill();fill&&(t.fontColor=fill.getColor());stroke=c.getStroke();if(stroke){t.labelOutlineColor=stroke.getColor();t.labelOutlineWidth=stroke.getWidth()}}}$.extend(this.parent.options,t);return t};TC.wrap.Feature.prototype.getGeometry=function(){var t;if(this.feature&&this.feature.getGeometry){var o=this.feature.getGeometry();o&&(o.getCoordinates?t=o.getCoordinates():o instanceof e.geom.Circle&&(t=[o.getCenter(),o.getRadius()]))}return t};TC.wrap.Feature.prototype.setGeometry=function(t){var o=!1;if(this.feature&&this.feature.getGeometry){var r,n,i,a,s,l,c,u=this.feature.getGeometry();switch(!0){case u instanceof e.geom.MultiPolygon:s=!0;a=t;$.isArray(a)&&(i=t[0]);case u instanceof e.geom.Polygon||u instanceof e.geom.MultiLineString:l=!0;i=s?i:t;$.isArray(i)&&(n=i[0]);case u instanceof e.geom.LineString:c=!0;n=l?n:t;$.isArray(n)&&(r=n[0]);case u instanceof e.geom.Point:r=c?r:t;if($.isArray(r)&&"number"==typeof r[0]&&"number"==typeof r[1]){var h;switch(r.length){case 3:h=e.geom.GeometryLayout.XYZ;break;case 4:h=e.geom.GeometryLayout.XYZM;break;default:h=e.geom.GeometryLayout.XY}u.setCoordinates(t,h);o=!0}break;case u instanceof e.geom.Circle:if($.isArray(t)&&$.isArray(t[0])&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]&&"number"==typeof t[1]){u.setCenterAndRadius(t[0],t[1]);o=!0}}}return o};TC.wrap.Feature.prototype.getId=function(){var e;this.feature&&(e=this.feature.getId());return e};TC.wrap.Feature.prototype.setId=function(e){this.feature&&this.feature.setId(e)};const Y=function(t,o){const r=this;var n=0;t.getLinearRings().forEach(function(t){coordinates=t.getCoordinates();o.crs&&(coordinates=TC.Util.reproject(coordinates,r.parent.layer.map.crs,o.crs));const i=new e.geom.Polygon([coordinates]).getLinearRing(0);n+=e.geom.flat.length.linearRing(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)});return n},K=function(t,o){const r=this;coordinates=t.getCoordinates();o.crs&&(coordinates=TC.Util.reproject(coordinates,r.parent.layer.map.crs,o.crs));return new e.geom.LineString(coordinates).getLength()};TC.wrap.Feature.prototype.getLength=function(t){const o=this;t=t||{};var r=0;const n=o.feature.getGeometry();switch(!0){case n instanceof e.geom.Polygon:r=Y.call(o,n,t);break;case n instanceof e.geom.LineString:r=K.call(o,n,t);break;case n instanceof e.geom.MultiPolygon:n.getPolygons().forEach(function(e){r+=Y.call(o,e,t)});break;case n instanceof e.geom.MultiPolygon:n.getLineStrings().forEach(function(e){r+=K.call(o,e,t)})}return r};TC.wrap.Feature.prototype.getArea=function(t){const o=this;t=t||{};const r=o.feature.getGeometry();var n;if(r instanceof e.geom.Polygon){n=r.getLinearRing(0).getCoordinates();t.crs&&(n=TC.Util.reproject(n,o.parent.layer.map.crs,t.crs));return new e.geom.Polygon([n]).getArea()}};const z=function(t){var o=this.getStyle();$.isFunction(o)&&(o=o.call(this));$.isArray(o)&&(o=o[o.length-1]);if(!o&&!t){o=new e.style.Style;this.setStyle(o)}return o};TC.wrap.Feature.prototype.setStyle=function(t){const o=this.feature;if(null===t){o.setStyle(null);return}const r=this.parent,n=o.getGeometry();var i,a=z.call(o);r.layer&&(i=function(t){var o=this.getStyle();$.isFunction(o)&&(o=o(t));$.isArray(o)&&(o=o[o.length-1]);o||(o=new e.style.Style);return o}.call(r.layer.wrap.layer,r.wrap.feature));if(n instanceof e.geom.Point||n instanceof e.geom.MultiPoint){var s;if(t.anchor||t.url||t.cssClass){const o={};if((s=a.getImage())instanceof e.style.Icon){o.src=t.url||TC.Util.getBackgroundUrlFromCss(t.cssClass)||s.getSrc();t.width&&t.height?o.size=[A(t.width,r),A(t.height,r)]:o.size=s.getSize();o.anchor=A(t.anchor,r)||s.getAnchor().map(function(e,t){return e/o.size[t]})}else{o.src=TC.Util.getPointIconUrl(t);o.anchor=A(t.anchor,r);o.size=[A(t.width,r),A(t.height,r)]}t.angle&&(o.angle=t.angle);s=new e.style.Icon(o)}else if(!a.getImage()&&a.getText())if(void 0!==t.label){a=z.call(o);t.label.length?a.setText(M(t,r)):a.setText()}else a.setText();else{(s=a.getImage())||(s=new e.style.Circle);const o={radius:A(t.radius,r)||(A(t.height,r)+A(t.width,r))/4};isNaN(o.radius)&&(o.radius=s.getRadius());t.fillColor?o.fill=new e.style.Fill({color:y(A(t.fillColor,r),A(t.fillOpacity,r))}):o.fill=s.getFill();o.stroke=s.getStroke();const n=i&&i.getStroke();if(t.strokeColor||t.strokeWidth){o.stroke||(o.stroke=new e.style.Stroke);if(t.strokeColor)o.stroke.setColor(A(t.strokeColor,r));else{const e=o.stroke.getColor()||n&&n.getColor()||TC.Cfg.styles.point.strokeColor;o.stroke.setColor(A(e,r))}if(t.strokeWidth)o.stroke.setWidth(A(t.strokeWidth,r));else{const e=o.stroke.getWidth()||n&&n.getWidth()||TC.Cfg.styles.point.strokeWidth;o.stroke.setWidth(A(e,r))}}s=new e.style.Circle(o)}a.setImage(s)}else{var l=a.getStroke(),c=!1;l||(l=new e.style.Stroke);if(t.strokeColor){l.setColor(A(t.strokeColor,r));c=!0}if(t.strokeWidth){l.setWidth(A(t.strokeWidth,r));c=!0;a.setStroke(l)}if(t.lineDash){l.setLineDash(t.lineDash);c=!0;a.setStroke(l)}c&&a.setStroke(l);if((n instanceof e.geom.Polygon||n instanceof e.geom.MultiPolygon)&&(t.fillColor||t.fillOpacity)){var u=a.getFill()||new e.style.Fill;u.setColor(y(A(t.fillColor,r),A(t.fillOpacity,r)));a.setFill(u)}}if(void 0!==t.label){a=z.call(o);t.label.length?a.setText(M(t,r)):a.setText()}o.changed()};TC.wrap.Feature.prototype.toggleSelectedStyle=function(e){const t=this.feature;(void 0===e?!t._originalStyle:e)?ee(t):te(t)};TC.wrap.Feature.prototype.getInnerPoint=function(t){var o,r=t||{},n=this.feature.getGeometry(),i=function e(t){if(r.clipBox&&$.isArray(t))if($.isArray(t[0]))for(var o=0,n=t.length;o<n;o++)e(t[o]);else!function(e){var t=r.clipBox;e[0]=Math.min(Math.max(e[0],t[0]),t[2]);e[1]=Math.min(Math.max(e[1],t[1]),t[3])}(t)};o=n.getFirstCoordinate();switch(n.getType()){case e.geom.GeometryType.MULTI_POLYGON:var a=0;n=n.getPolygons().reduce(function(e,t){const o=t.getArea(),r=o>a?t:e;a=o;return r});case e.geom.GeometryType.POLYGON:var s=function(e,t){for(var o=!1,r=0,n=t.length-1;r<t.length;n=r++){var i=t[r][0],a=t[r][1],s=t[n][0],l=t[n][1];a>e[1]!=l>e[1]&&e[0]<(s-i)*(e[1]-a)/(l-a)+i&&(o=!o)}return o};i(h=n.getCoordinates());o=(n=new e.geom.Polygon(h)).getInteriorPoint().getCoordinates();for(var l=n.getLinearRings(),c=1;c<l.length;c++)if(s(o,l[c].getCoordinates())){o=n.getClosestPoint(o);break}break;case e.geom.GeometryType.MULTI_LINE_STRING:var u=0;n=n.getLineStrings().reduce(function(e,t){const o=t.getLength(),r=o>u?t:e;u=o;return r});case e.geom.GeometryType.LINE_STRING:var h,d=[0,0];i(h=n.getCoordinates());n=new e.geom.LineString(h);for(c=0;c<h.length;c++){d[0]+=h[c][0];d[1]+=h[c][1]}d[0]/=h.length;d[1]/=h.length;o=n.getClosestPoint(d)}return o};TC.wrap.Feature.prototype.showPopup=function(t){var o=t.map;if(o){var r=this.feature;if(r){o.currentFeature=this.parent;var n=o.getExtent();this._innerCentroid=this.getInnerPoint({clipBox:n});t.contentDiv.innerHTML=this.parent.getInfo({locale:o.options.locale});t.menuDiv.innerHTML="";if(t.options.closeButton||void 0===t.options.closeButton){const e=document.createElement("div");e.classList.add(t.CLASS+"-close");e.setAttribute("title",t.getLocaleString("close"));t.menuDiv.appendChild(e);e.addEventListener(TC.Consts.event.CLICK,function(){t.hide()});t.contentDiv.classList.add(t.CLASS+"-has-btn");const o=t.contentDiv.querySelector(".tc-ctl-finfo");if(o){o.width="auto";o.height="auto"}}var i,a=this.parent.options;if(TC.Util.isEmptyObject(a)&&this.parent.layer&&this.parent.layer.options&&this.parent.layer.options.styles)switch(this.parent.CLASSNAME){case"TC.feature.Point":(a=this.parent.layer.options.styles.point)&&!TC.Util.isEmptyObject(a)||(a=this.parent.layer.options.styles.marker);break;case"TC.feature.Marker":a=this.parent.layer.options.styles.marker;break;case"TC.feature.Circle":a=this.parent.layer.options.styles.circle;break;case"TC.feature.MultiPolygon":case"TC.feature.Polygon":a=this.parent.layer.options.styles.polygon;break;case"TC.feature.MultiPolyline":case"TC.feature.Polyline":a=this.parent.layer.options.styles.line}if(a.anchor)i=a.anchor;else{for(var s,l=r._wrap.parent,c=0;c<o.workLayers.length;c++){var u=o.workLayers[c];if(!u.isRaster()&&$.inArray(l,u.features)>=0){s=u.wrap.styleFunction(r);break}}if($.isArray(s)){const t=s[0].getImage();i=!t||t instanceof e.style.Icon?[.5,0]:[.5,.5]}}const d=[0,0];if(i)if(a.height)d[1]=-a.height*i[1];else{var h=z.call(r,!0);if(h){const t=h.getImage();t instanceof e.style.Icon&&(d[1]=t.getImageSize()[1]*-t.getScale())}}t.wrap.setDragged(!1);t.wrap.popup.setOffset(d);t.wrap.popup.setPosition(this._innerCentroid);t.popupDiv.classList.add(TC.Consts.classes.VISIBLE)}else o.wrap.hidePopup(t)}};TC.wrap.Feature.prototype.isNative=function(t){return t instanceof e.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[];this.feature&&this.feature._folders&&(e=this.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null;this.feature&&(e=this.feature.getGeometry().getExtent());return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this.feature.getStyle();"function"==typeof t&&(t=t.call(this.feature));if($.isArray(t))for(var o=0;o<t.length;o++)if(t[o]._balloon){if(t[o]._balloon.getText()){t=t[o]._balloon;break}}t&&!$.isArray(t)&&t.getText&&(e=t.getText());return e};TC.wrap.Feature.prototype.getData=function(){var e=this.feature.getProperties();$.isArray(e.features)&&(e=1===e.features.length?e.features[0].getProperties():e.features.length+" elementos");var t=this.feature.getGeometryName();e[t]&&delete e[t];return e};TC.wrap.Feature.prototype.setData=function(e){this.feature.setProperties(e)};TC.wrap.Feature.prototype.clearData=function(){const e=this.feature,t=e.getGeometryName();e.getKeys().forEach(function(o){o!==t&&e.unset(o)})};TC.wrap.control.Draw.prototype.mouseMoveHandler=function(e){const t=this;t.sketch&&t.parent.trigger(TC.Consts.event.MEASUREPARTIAL,t.getMeasureData())};TC.wrap.control.Draw.prototype.mouseOverHandler=function(e){const t=this;if(t.sketch&&t.hoverCoordinate){t.pushCoordinate(t.hoverCoordinate);t.hoverCoordinate=null}};TC.wrap.control.Draw.prototype.clickHandler=function(e){const t=this;if(t.parent.map.view!==TC.Consts.view.PRINTING){if(t._mdPx){const o=t._mdPx[0]-e.clientX,r=t._mdPx[1]-e.clientY;if(o*o+r*r>t.interaction.squaredClickTolerance_)return}if(t.sketch){var o=t.sketch.getGeometry().getCoordinates();t.parent.trigger(TC.Consts.event.POINT,{point:o[o.length-1]})}}};TC.wrap.control.Draw.prototype.mousedownHandler=function(e){this._mdPx=[e.clientX,e.clientY]};TC.wrap.control.Draw.prototype.getMeasureData=function(){var t=this,o={units:e.proj.Units.METERS};if(this.sketch){var r=this.sketch.getGeometry();r instanceof e.geom.Polygon?function(o,r){o=new e.geom.Polygon([TC.Util.reproject(o.getLinearRing(0).getCoordinates(),t.parent.map.crs,t.parent.map.options.utmCrs)]);r.area=o.getArea();var n=o.getLinearRing(0);r.perimeter=e.geom.flat.length.linearRing(n.flatCoordinates,0,n.flatCoordinates.length,n.stride)}(r,o):r instanceof e.geom.LineString&&function(o,r){o=new e.geom.LineString(TC.Util.reproject(o.getCoordinates(),t.parent.map.crs,t.parent.map.options.utmCrs));r.length=o.getLength()}(r,o)}return o};TC.wrap.control.Draw.prototype.activate=function(t){var o,r=this;switch(t){case TC.Consts.geom.POLYGON:o=e.geom.GeometryType.POLYGON;break;case TC.Consts.geom.POINT:o=e.geom.GeometryType.POINT;break;default:o=e.geom.GeometryType.LINE_STRING}r.parent.map&&Promise.all([r.parent.map.wrap.getMap(),r.parent.getLayer()]).then(function(n){const i=n[0],a=n[1];a&&a.wrap.getLayer().then(function(n){r.viewport||(r.viewport=i.getViewport());if(r.interaction){i.removeInteraction(r.interaction);if(r._mousedownHandler){r.viewport.removeEventListener("mousedown",r._mousedownHandler);r._mousedownHandler=null}if(r._clickHandler){r.viewport.removeEventListener(TC.Consts.event.CLICK,r._clickHandler);r._clickHandler=null}if(r._mouseMoveHandler&&r._mouseOverHandler){r.viewport.removeEventListener("mousemove",r._mouseMoveHandler);r.viewport.removeEventListener("mouseover",r._mouseOverHandler)}}r.snapInteraction&&i.removeInteraction(r.snapInteraction);if(t){r._mousedownHandler=$.proxy(r.mousedownHandler,r);r._clickHandler=$.proxy(r.clickHandler,r);r.viewport.addEventListener("mousedown",r._mousedownHandler);r.viewport.addEventListener(TC.Consts.event.CLICK,r._clickHandler);if(r.parent.measure){r._mouseMoveHandler=r.mouseMoveHandler.bind(r);r._mouseOverHandler=r.mouseOverHandler.bind(r);r.viewport.addEventListener("mousemove",r._mouseMoveHandler);r.viewport.addEventListener("mouseover",r._mouseOverHandler)}var a={type:o,snapTolerance:0,condition:function(){e.events.condition.shiftKeyOnly(arguments[0])&&(hole=i.forEachFeatureAtPixel(i.getPixelFromCoordinate(arguments[0].coordinate),function(t){return e.geom.GeometryType.POLYGON==t.getGeometry().getType()||e.geom.GeometryType.MULTI_POLYGON==t.getGeometry().getType()?t:null},{hitTolerance:l}));return r.parent.map.view!==TC.Consts.view.PRINTING||null}};n&&(a.source=n.getSource());switch(t){case TC.Consts.geom.RECTANGLE:a.style=R({styles:{line:r.parent.styles.line}});a.type=e.geom.GeometryType.LINE_STRING;a.maxPoints=2;a.geometryFunction=function(t,o){o||(o=new e.geom.Polygon(null));var r=t[0],n=t[1];o.setCoordinates([[r,[r[0],n[1]],n,[n[0],r[1]],r]]);return o};break;case TC.Consts.geom.POLYGON:a.style=R({styles:{polygon:r.parent.styles.polygon}});break;case TC.Consts.geom.POINT:a.style=R({styles:{point:r.parent.styles.point}});break;default:a.style=R({styles:{line:r.parent.styles.line}})}r.interaction=new e.interaction.Draw(a);r.interaction.on(e.interaction.DrawEventType.DRAWSTART,function(e){r.sketch=e.feature;r.parent.trigger(TC.Consts.event.DRAWSTART)},this);r.interaction.on(e.interaction.DrawEventType.DRAWEND,function(e){e.feature.setStyle(e.target.overlay_.getStyle().map(function(e){return e.clone()}));r.parent.measure&&r.parent.trigger(TC.Consts.event.MEASURE,r.getMeasureData());D(r.sketch).then(function(e){r.parent.trigger(TC.Consts.event.DRAWEND,{feature:e});r.sketch=null})},this);r._projectionChangeHandler=function(t){!function(t,o){if(t.sketch){const n=o.oldValue.getProjection(),i=o.target.get(o.key).getProjection();if(n.getCode()!==i.getCode()){const o=t.sketch.getGeometry();o.transform(n,i);t.interaction.sketchPoint_.getGeometry().transform(n,i);const a=[];var r;r=t.interaction.mode_===e.interaction.Draw.Mode_.POLYGON?t.interaction.sketchCoords_[0]:t.interaction.sketchCoords_;e.geom.flat.deflate.coordinates(a,0,r,o.stride);e.proj.getTransform(n,i)(a,a,o.stride);r=e.geom.flat.inflate.coordinates(a,0,a.length,o.stride);t.interaction.mode_===e.interaction.Draw.Mode_.POLYGON?t.interaction.sketchCoords_=[r]:t.interaction.sketchCoords_=r}}}(r,t)};i.on("change:view",r._projectionChangeHandler);i.addInteraction(r.interaction);if(r.parent.snapping){var s={};n?s.source=n.getSource():r.parent.snapping instanceof TC.Layer&&(s.source=r.parent.snapping.wrap.layer.getSource());r.snapInteraction=new e.interaction.Snap(s);i.addInteraction(r.snapInteraction)}}r.redoStack=[]})})};TC.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.parent.map&&Promise.all([e.parent.map.wrap.getMap(),e.parent.getLayer()]).then(function(t){const o=t[0],r=t[1];if(e.viewport){if(e._mousedownHandler){e.viewport.removeEventListener("mousedown",e._mousedownHandler);e._mousedownHandler=null}if(e._clickHandler){e.viewport.removeEventListener(TC.Consts.event.CLICK,e._clickHandler);e._clickHandler=null}}r&&!e.parent.persistent&&r.clearFeatures();if(e.interaction){o.removeInteraction(e.interaction);e.interaction=null}o.un("change:view",e._projectionChangeHandler)})};TC.wrap.control.Draw.prototype.popCoordinate=function(){var t=null;if(this.interaction){var o=this.interaction.sketchFeature_;if(o){var r,n=o.getGeometry();n instanceof e.geom.Polygon?r=n.getCoordinates()[0]:n instanceof e.geom.LineString&&(r=n.getCoordinates());if(r.length>1){var i;n instanceof e.geom.Polygon?i=this.interaction.sketchCoords_[0]:n instanceof e.geom.LineString&&(i=this.interaction.sketchCoords_);var a,s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<r.length;c++)if(r[c][0]==l[0]&&r[c][1]==l[1]){s=!0;break}t=i[a=s?i.length-2:i.length-1];i.splice(a,1);if(n instanceof e.geom.Polygon){n.setCoordinates([i]);this.interaction.sketchLine_.getGeometry().setCoordinates(i)}else n.setCoordinates(i);o.setGeometry(n)}}}return t};TC.wrap.control.Draw.prototype.pushCoordinate=function(t){var o=!1;if(this.interaction){var r=this.interaction.sketchFeature_;if(r){var n,i=r.getGeometry();i instanceof e.geom.Polygon?n=i.getCoordinates()[0]:i instanceof e.geom.LineString&&(n=i.getCoordinates());var a;i instanceof e.geom.Polygon?a=this.interaction.sketchCoords_[0]:i instanceof e.geom.LineString&&(a=this.interaction.sketchCoords_);var s=!1;if(this.interaction.sketchPoint_)for(var l=this.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<n.length;c++)if(n[c][0]==l[0]&&n[c][1]==l[1]){s=!0;break}index=s?a.length-1:a.length;a.splice(index,0,t);if(i instanceof e.geom.LineString)i.setCoordinates(a,e.geom.GeometryLayout.XY);else{i.setCoordinates([a],e.geom.GeometryLayout.XY);this.interaction.sketchLine_.getGeometry().setCoordinates(a)}o=!0}}return o};TC.wrap.control.Draw.prototype.undo=function(){var e=!1,t=this.popCoordinate();if(t){this.redoStack.push(t);e=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return e};TC.wrap.control.Draw.prototype.redo=function(){var e=!1;if(this.redoStack.length>0){this.pushCoordinate(this.redoStack.pop());e=!0}this.parent.trigger(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData());return e};TC.wrap.control.Draw.prototype.end=function(){this.interaction&&this.interaction.sketchFeature_&&this.interaction.finishDrawing()};TC.wrap.control.Draw.prototype.setStyle=function(e){const t=this;t.interaction&&t.interaction.overlay_.setStyle(R({styles:e}))};TC.wrap.control.CacheBuilder.prototype.getRequestSchemas=function(e){for(var t=e.extent,o=e.layers,r=new Array(o.length),n=0,i=r.length;n<i;n++){var a=o[n],s={layerId:a.id},l=a.wrap.layer.getSource();l.getUrls&&(s.url=l.getUrls()[0]);if(l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),h=c.getMatrixIds(),d=a.getLayerNodeByName(a.layerNames),p=null,f=0,g=d.TileMatrixSetLink.length;f<g;f++){var m=d.TileMatrixSetLink[f];if(m.TileMatrixSet===a.matrixSet){p=m.TileMatrixSetLimits;break}}s.tileMatrixLimits=[];f=0;for(var y=u.length;f<y;f++){var C=c.getOrigin(f),v=c.getTileSize(f),T=u[f],_=v*T,S={mId:h[f],res:T,origin:C,tSize:v,cl:Math.floor((t[0]-C[0])/_),cr:Math.floor((t[2]-C[0])/_),rt:Math.floor((C[1]-t[3])/_),rb:Math.floor((C[1]-t[1])/_)};if(p){var E=p[f];if(E){S.cl=Math.max(S.cl,E.MinTileCol);S.cr=Math.min(S.cr,E.MaxTileCol);S.rt=Math.max(S.rt,E.MinTileRow);S.rb=Math.min(S.rb,E.MaxTileRow)}}S.cl<=S.cr&&S.rt<=S.rb&&s.tileMatrixLimits.push(S)}}r[n]=s}return r};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){var t="",o=e.wrap.layer.getSource();o.getUrls&&(t=o.getUrls()[0]);if(e.options.encoding!==TC.Consts.WMTSEncoding.RESTFUL){t.indexOf("?")<0&&(t+="?");t.indexOf("?")===t.length-1&&(t=t+"layer="+e.layerNames+"&style=default&tilematrixset="+encodeURIComponent(e.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(e.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")}return t};const J=function(t){return new e.style.Stroke({color:"#ffffff",width:t+4})},Z=function(t){return new e.style.Stroke({color:"#000000",width:t+6})},Q=function(t){void 0===t&&(t=[]);t instanceof e.style.Style&&(t=[t]);const o=(t=t.slice())[0];if(o){const n=o.getImage();var r;if(n instanceof e.style.RegularShape){r=n.getStroke().getWidth();const i=n.getRadius(),a=o.clone();a.setImage(new e.style.Circle({radius:i,stroke:J(r)}));t.unshift(a);const s=o.clone();s.setImage(new e.style.Circle({radius:i,stroke:Z(r)}));t.unshift(s)}else{r=o.getStroke().getWidth();t.unshift(new e.style.Style({stroke:J(r)}));t.unshift(new e.style.Style({stroke:Z(r)}))}return t}return null},ee=function(t){oe.call(t);t.changed();e.events.listen(t,e.events.EventType.CHANGE,oe,t)},te=function(t){e.events.unlisten(t,e.events.EventType.CHANGE,oe,t);if(t._originalStyle){t.setStyle(null);t.setStyle(t._originalStyle)}t._originalStyle=null},oe=function(){this.style_=function(e){e._originalStyle=e._originalStyle||e.getStyle();return $.isFunction(e._originalStyle)?function(t,o){return Q(e._originalStyle(t,o))}:Q(e._originalStyle)}(this);this.styleFunction_=this.style_?e.Feature.createStyleFunction(this.style_):void 0};TC.wrap.control.Modify.prototype.activate=function(){const t=this;t.parent.map&&Promise.all([t.parent.map.wrap.getMap(),t.parent.layer.wrap.getLayer()]).then(function(o){const r=o[0],n=o[1];t.selectInteraction&&r.removeInteraction(t.selectInteraction);var i=new e.interaction.Select({layers:[n],hitTolerance:l});t.selectInteraction=i;r.addInteraction(i);var a=function(e){return e._wrap.parent};i.on("select",function(e){e.selected.length>0&&t.parent.trigger(TC.Consts.event.FEATURESSELECT,{ctrl:t,features:e.selected.map(a)});e.deselected.length>0&&0==e.selected.length&&t.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:t.parent,features:e.deselected.map(a)})});t.modifyInteraction&&r.removeInteraction(t.modifyInteraction);var s=new e.interaction.Modify({features:i.getFeatures()});s.on(e.interaction.ModifyEventType.MODIFYEND,function(e){e.features.forEach(function(e){e._wrap.parent.geometry=e._wrap.getGeometry();t.parent.trigger(TC.Consts.event.FEATUREMODIFY,{feature:e._wrap.parent,layer:t.parent.layer})})});t.modifyInteraction=s;r.addInteraction(s);t.snapInteraction&&r.removeInteraction(t.snapInteraction);if(t.parent.snapping){t.snapInteraction=new e.interaction.Snap({source:n.getSource()});r.addInteraction(t.snapInteraction)}t._onMouseMove||(t._onMouseMove=function(e){const o=r.getTarget();var n,i=r.getEventPixel(e);n=r.forEachFeatureAtPixel(i,function(e,o){return o===t.parent.layer.wrap.layer},{hitTolerance:l});o.style.cursor=n?"pointer":""});r.getViewport().addEventListener("mousemove",t._onMouseMove)})};TC.wrap.control.Modify.prototype.deactivate=function(){const e=this;if(e.modifyInteraction){e.modifyInteraction.setActive(!1);e.selectInteraction.setActive(!1);e.parent.map.wrap.getMap().then(function(t){t.getViewport().removeEventListener("mousemove",e._onMouseMove);t.removeInteraction(e.modifyInteraction);t.removeInteraction(e.selectInteraction);e.modifyInteraction=null;e.selectInteraction=null})}};TC.wrap.control.Modify.prototype.getSelectedFeatures=function(){var e=[];this.selectInteraction&&this.selectInteraction.getFeatures().forEach(function(t){e[e.length]=t._wrap.parent});return e};TC.wrap.control.Modify.prototype.setSelectedFeatures=function(e){if(this.selectInteraction){var t=this.selectInteraction.featureOverlay_.getSource();t.clear();t.addFeatures(e.map(function(e){return e.wrap.feature}))}};TC.wrap.control.Modify.prototype.unselectFeatures=function(e){e=e||[];const t=this,o=t.selectInteraction?t.selectInteraction.getFeatures():null;if(o){const r=[];o.getArray().slice().forEach(function(t){if(!e.length||e.indexOf(t)>=0){o.remove(t);r[r.length]=t._wrap.parent}});r.length&&t.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{features:r})}};TC.wrap.control.Edit.prototype.activate=function(e){this.cancel(!0);e===TC.Consts.editMode.SELECT&&TC.wrap.control.Modify.prototype.activate.call(this)};TC.wrap.control.Edit.prototype.deactivate=function(){var e=this;TC.wrap.control.Modify.prototype.deactivate.call(e);if(e.drawInteraction){e.drawInteraction.abortDrawing_();e.drawInteraction.setActive(!1);e.parent.map.wrap.getMap().then(function(t){t.removeInteraction(e.drawInteraction);e.drawInteraction=null})}e.parent.trigger(TC.Consts.event.CONTROLDEACTIVATE,{ctrl:e})};TC.wrap.control.Edit.prototype.cancel=function(e,t){this.points=[];this.histPoints=[];this.control&&this.control.layer||this.modifyInteraction&&this.modifyInteraction.layer;if(this.selectInteraction){var o=this.selectInteraction.getFeatures();this.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{ctrl:this.parent,feature:o.get(0)});o.clear();this.selectInteraction.setActive(!1)}};TC.wrap.control.Edit.prototype.getSelectedFeatures=function(){return TC.wrap.control.Modify.prototype.getSelectedFeatures.call(this)};TC.wrap.control.Edit.prototype.setSelectedFeatures=function(e){TC.wrap.control.Modify.prototype.setSelectedFeatures.call(this,e)};TC.wrap.control.Edit.prototype.deleteFeatures=function(e){var t=this;if($.isArray(e)){var o=e.map(function(e){return e.wrap.feature});t.parent.layer.wrap.getLayer().then(function(e){for(var r=t.selectInteraction?t.selectInteraction.getFeatures():null,n=0,i=o.length;n<i;n++){var a=o[n];if(r){r.remove(a);t.parent.trigger(TC.Consts.event.FEATURESUNSELECT,{feature:a._wrap.parent})}e.getSource().removeFeature(a);t.parent.trigger(TC.Consts.event.FEATUREREMOVE,{feature:a._wrap.parent})}})}};TC.wrap.Feature.prototype.toGML=function(t,o){var r=(new e.format.GML).writeGeometryNode(this.feature.getGeometry(),{dataProjection:o});return(new XMLSerializer).serializeToString(r.firstChild).replace(/\<\/?\w/gm,function(e){var t=e.indexOf("/")>0?e.indexOf("/")+1:1;return e.substring(0,t)+"gml:"+e.substring(t)})};TC.wrap.Feature.prototype.toGeoJSON=function(){return(new e.format.GeoJSON).writeGeometry(this.feature.getGeometry())};TC.wrap.Geometry.write=function(t){var o;(t=t||{}).format;t.parser=new e.format.GeoJSON;switch(t.type){case TC.Consts.geom.POLYLINE:o=new e.geom.LineString(t.coordinates);break;case TC.Consts.geom.POLYGON:o=new e.geom.Polygon(t.coordinates);break;case TC.Consts.geom.MULTIPOINT:o=new e.geom.MultiPoint(t.coordinates);break;case TC.Consts.geom.MULTIPOLYLINE:o=new e.geom.MultiLineString(t.coordinates);break;case TC.Consts.geom.MULTIPOLYGON:o=new e.geom.MultiPolygon(t.coordinates);break;case TC.Consts.geom.POINT:default:o=new e.geom.Point(t.coordinates)}return t.parser.writeGeometry(o)};TC.wrap.Geometry.toGeoJSON=function(e){return TC.wrap.Geometry.write(e)};return e});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const e=this;TC.Control.apply(e,arguments);e.apiAttribution="";e.mainDataAttribution=null;e.dataAttributions=[];e.options.dataAttributions&&(e.dataAttributions=e.options.dataAttributions instanceof Array?e.options.dataAttributions:[e.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var e=TC.control.Attribution.prototype;e.CLASS="tc-ctl-attrib";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Attribution.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<div><span>&copy; ").f(t.get(["api"],!1),t,"h",["s"]).w("</span>").x(t.get(["mainData"],!1),t,{block:o},{}).x(t.get(["otherData"],!1),t,{block:a},{}).w('<div class="tc-ctl-attrib-other ').x(t.get(["isCollapsed"],!1),t,{block:s},{}).w('">').s(t.get(["otherData"],!1),t,{block:l},{}).w("</div></div>")}t.__dustBody=!0;function o(e,t){return e.w(" - ").h("i18n",t,{},{$key:"data"}).w(":").x(t.getPath(!1,["mainData","site"]),t,{else:r,block:i},{})}o.__dustBody=!0;function r(e,t){return e.x(t.getPath(!1,["mainData","name"]),t,{block:n},{})}r.__dustBody=!0;function n(e,t){return e.w("<span> &copy; ").f(t.getPath(!1,["mainData","name"]),t,"h").w("</span>")}n.__dustBody=!0;function i(e,t){return e.w('<span> &copy; <a href="').f(t.getPath(!1,["mainData","site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["mainData","name"]),t,"h").w("</a></span>")}i.__dustBody=!0;function a(e,t){return e.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",t,{},{$key:"others"}).w("...</span>")}a.__dustBody=!0;function s(e,t){return e.w(" tc-collapsed ")}s.__dustBody=!0;function l(e,t){return e.x(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,{else:c,block:u},{}).h("sep",t,{block:h},{})}l.__dustBody=!0;function c(e,t){return e.w("<span>&copy; ").f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</span>")}c.__dustBody=!0;function u(e,t){return e.w('<span>&copy; <a href="').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</a></span>")}u.__dustBody=!0;function h(e,t){return e.w(", ")}h.__dustBody=!0;return t};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var r=function(e){if(e){var o=e.getAttribution();if(o)if(/IDENA/.test(o.name)||/Tracasa Instrumental/.test(o.name))t.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var r=!1,n=0;n<t.dataAttributions.length;n++)if(o.name===t.dataAttributions[n].name){r=!0;break}r||t.dataAttributions.push(o)}}},n=function(e){if(e){if(!(e instanceof TC.Layer)||function(){if(e.map.workLayers.length>0){for(var t=e.map.workLayers.slice().reverse(),o=0;o<t.length;o++)if(t[o].url==e.url&&t[o].getVisibility())return!1;return!0}return!0}()){var o=e.getAttribution();if(o){var r=t.dataAttributions.reduce(function(e,t,r){return t.name===o.name?r:e},-1);const e=function(e){return(/IDENA/.test(o.name)||/Tracasa Instrumental/.test(o.name))&&(/IDENA/.test(e)||/Tracasa Instrumental/.test(e))||o.name===e};if(t.map.baseLayer&&t.map.baseLayer.wrap.getAttribution()&&e(t.map.baseLayer.wrap.getAttribution().name))return;if(t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).some(function(t){var o=t.wrap.getAttribution();return o&&e(o.name)}))return;r>-1?t.dataAttributions.splice(r,1):(/IDENA/.test(o.name)||/Tracasa Instrumental/.test(o.name))&&(t.mainDataAttribution=null)}}}};t.render();e.loaded(function(){if(e.baseLayer.wrap.getAttribution){r(e.baseLayer.wrap);t.render()}});e.on(TC.Consts.event.LAYERADD,function(e){const o=e.layer;if(!o.isBase&&o.wrap.getAttribution){r(o.wrap);t.render()}});e.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(e){const o=e.type,i=e.newLayer,a=e.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(o)>-1&&(t.ignoreLayer=i);a&&a.wrap.getAttribution&&n(a.wrap);i&&i.wrap.getAttribution&&r(i.wrap);t.render()});e.on(TC.Consts.event.LAYERREMOVE,function(e){const o=e.layer;if(o.wrap.getAttribution){n(o.wrap);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERADD,function(e){const o=e.terrainProvider;if(o.getAttribution){r(o);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(e){const o=e.terrainProvider;if(o.getAttribution){n(o);t.render()}});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){const o=e.layer;if(t.ignoreLayer!==o&&o.wrap.getAttribution){o.getVisibility()?r(o.wrap):n(o.wrap);t.render()}});return o};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({api:t.apiAttribution,mainData:t.mainDataAttribution,otherData:t.dataAttributions,isCollapsed:!t.div.querySelector("."+t.CLASS+"-other")||t.div.querySelector("."+t.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const o=t.div.querySelector("."+t.CLASS+"-cmd");o&&o.addEventListener(TC.Consts.event.CLICK,function(){t.toggleOtherAttributions()});"function"==typeof e&&e()}))};e.toggleOtherAttributions=function(){const e=this.div.querySelector("."+this.CLASS+"-other");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(.tc-modal-close)",function(o){if(o.target.classList.contains(e._cssClasses.LOAD_CRS_BUTTON)){e.loadFallbackProjections();return}TC.Util.closeModal();const r=o.target,n=r.dataset.crsCode,i=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog");i.classList.add(TC.Consts.classes.HIDDEN);const a=e.getLayer(i.dataset.layerId);if(a)if(n)TC.loadProjDef({crs:n,callback:function(){e.map.setProjection({crs:n,baseLayer:a})}});else{const o=$(r).data(t.FALLBACK_LAYER);o&&e.map.setBaseLayer(o)}}))};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";var t={FALLBACK_LAYER:"tcFallbackLayer"};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/BasemapSelectorDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(t.get(["baseLayers"],!1),t,{block:o},{}).s(t.get(["dialogMore"],!1),t,{block:r},{}).w("</ul></form></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-bms-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;function r(e,t){return e.w('<li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="').h("i18n",t,{},{$key:"moreBackgroundMaps"}).w('"><input type="radio" name="bms" value="moreLayers"><span></span></label></li>')}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('" ><label').x(t.get(["legend"],!1),t,{block:o},{}).x(t.get(["thumbnail"],!1),t,{block:r},{}).w('><input type="radio" name="bms" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["mustReproject"],!1),t,{block:n},{}).w("><span>").f(t.get(["title"],!1),t,"h").w("</span></label></li>")}t.__dustBody=!0;function o(e,t){return e.w(' style="background-image: url(').f(t.getPath(!1,["legend","src"]),t,"h").w(')"')}o.__dustBody=!0;function r(e,t){return e.w(' style="background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"')}r.__dustBody=!0;function n(e,t){return e.w(' class="tc-disabled"')}n.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"backgroundMaps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w('</button></div></div></div><div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"baseLayerNotCompatible"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"baseLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-bms-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}const o=function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},r=function(e,t){const r=this;var n=!0,i=e.target,a=r.getLayer(o(i,"li").dataset.layerId);if(r.options.dialogMore&&o(i,"."+r.CLASS+"-more-dialog")){const e=r.div.querySelectorAll("input[type=radio]");for(var s=0,l=e.length;s<l;s++){const t=r.getLayer(o(e[s],"li").dataset.layerId);if(t)switch(!0){case t.id===a.id:a=t}}}if(a!=r.map.getBaseLayer())if(a.mustReproject)if(r.map.on3DView){if(!a.getFallbackLayer()){r._currentSelection.checked=!0;e.stopPropagation();return}if(a.getFallbackLayer()){const e=a.getFallbackLayer();e&&e._capabilitiesPromise.then(function(){e.isCompatible(r.map.getCRS())&&r.map.setBaseLayer(a)});n=!0}}else{r._currentSelection&&(r._currentSelection.checked=!0);const e={layer:a},t=a.getFallbackLayer();t?t._capabilitiesPromise.then(function(){t.isCompatible(r.map.getCRS())&&(e.fallbackLayer=t);r.showProjectionChangeDialog(e)}):r.showProjectionChangeDialog(e);n=!1}else{(a.type===TC.Consts.layerType.WMS||a.type===TC.Consts.layerType.WMTS&&a.getProjection()!==r.map.crs)&&a.setProjection({crs:r.map.crs});r.map.setBaseLayer(a)}this._currentSelection&&(this._currentSelection.checked=!0);t&&t(n)};e.register=function(e){const t=this,o=TC.control.MapContents.prototype.register.call(t,e);t.options.dialogMore&&e.on(TC.Consts.event.VIEWCHANGE,function(){t._getMoreBaseLayers()});e.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(e){t.update(t.div,e.layer)});t.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){"moreLayers"===e.target.value?t.showMoreLayersDialog():r.call(t,e);e.stopPropagation()}));return o};e.render=function(e){const t=this,o=TC.control.MapContents.prototype.render.call(t,e,t.options);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;if(t.options.dialogMore){t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog").addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){r.call(t,e,function(e){e&&TC.Util.closeModal()});e.stopPropagation()}))}});return o};e.update=function(e,t){const o=this;(e=e||o.div).querySelector("ul."+o.CLASS+"-branch").querySelectorAll("li").forEach(function(e){const r=o.getLayer(e.dataset.layerId);if(r){const n=t||o.map.baseLayer,i=e.querySelector("input[type=radio]"),a=n&&(n===r||n.id===r.id||r.getFallbackLayer&&(n===r.getFallbackLayer()||r.getFallbackLayer()&&n.id===r.getFallbackLayer().id));if(o.map.on3DView&&r.mustReproject&&r.fallbackLayer&&r.getFallbackLayer)r.getFallbackLayer().getCapabilitiesPromise().then(function(){var t=!r.getFallbackLayer().isCompatible(o.map.getCRS());i.checked=a;if(t){i.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",o.map.on3DView?o.getLocaleString("notAvailableTo3D"):o.getLocaleString("reprojectionNeeded"))}else{i.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}});else{i.checked=a;if(r.mustReproject){i.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",o.map.on3DView?o.getLocaleString("notAvailableTo3D"):o.getLocaleString("reprojectionNeeded"))}else{i.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}}a&&(o._currentSelection=i)}});o.updateScale()};e.updateLayerTree=function(e){const t=this;if(e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);var o=t.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(o,t.layerTrees[e.id],function(o,r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild;var i=n.dataset.tcLayerUid;const a=t.div.querySelector("."+t.CLASS+"-branch"),s=a.querySelector('li[data-tc-layer-uid="'+i+'"]');if(s)s.innerHTML=n.innerHTML;else{n.dataset.layerId=e.id;var l=t.map.baseLayers.filter(function(e){return!e.stealth}).map(function(e){return e.id}).indexOf(e.id);const o=a.querySelectorAll("li");l<0||l>=o.length?a.appendChild(n):a.insertBefore(n,o[l])}o&&TC.error(o)});t.update()})}};e.updateLayerOrder=function(e,t,o){};e.removeLayer=function(e){const t=this;if(e.isBase){const n=t.div.querySelector("."+t.CLASS+"-branch").querySelectorAll("li");for(var o=0,r=n.length;o<r;o++){const t=n[o];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}}};e.onErrorLayer=function(e){const t=this;e.isBase&&!e.options.stealth&&t.map.toast(t.getLocaleString("baseLayerNotAvailable",{mapName:e.title}),{type:TC.Consts.msgType.ERROR})};e.loadFallbackProjections=function(){const e=this;e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li").forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)})};e.showProjectionChangeDialog=function(e){const o=this,r=(e=e||{}).layer,n=o._dialogDiv.querySelector("."+o.CLASS+"-crs-dialog"),i=n.querySelector(".tc-modal-body");i.classList.add(TC.Consts.classes.LOADING);const a=r.getCompatibleCRS();n.classList.remove(TC.Consts.classes.HIDDEN);n.dataset.layerId=r.id;const s=n.querySelector("ul."+o.CLASS+"-crs-list");s.innerHTML="";o.map.loadProjections({crsList:o.map.getCompatibleCRS({layers:o.map.workLayers.concat(r),includeFallbacks:!0}),orderBy:"name"}).then(function(r){var n=!1;const l=document.createDocumentFragment();r.forEach(function(r){const i=document.createElement("li"),s=document.createElement("button");if(0===a.filter(function(e){return TC.Util.CRSCodesEqual(e,r.code)}).length){n=!0;s.innerHTML=r.name+" ("+r.code+")";$(s).data(t.FALLBACK_LAYER,e.layer.fallbackLayer);s.dataset.crsCode=r.code;s.classList.add(TC.Consts.classes.WARNING);i.classList.add(TC.Consts.classes.HIDDEN)}else{s.innerHTML=o.getLocaleString("changeMapToCrs",{crs:r.name+" ("+r.code+")"});s.dataset.crsCode=r.code}i.appendChild(s);l.appendChild(i)});if(e.fallbackLayer){const r=document.createElement("li"),n=document.createElement("button");n.innerHTML=o.getLocaleString("reprojectOnTheFly");$(n).data(t.FALLBACK_LAYER,e.fallbackLayer);r.appendChild(n);l.appendChild(r)}if(n){const e=document.createElement("li"),t=document.createElement("button");t.classList.add(o._cssClasses.LOAD_CRS_BUTTON);t.innerHTML=o.getLocaleString("showOnTheFlyProjections");e.appendChild(t);l.appendChild(e)}s.appendChild(l);i.classList.remove(TC.Consts.classes.LOADING)});n.querySelector("."+o.CLASS+"-name").innerHTML=r.title||r.name;TC.Util.showModal(n)};e.showMoreLayersDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");e.map.on3DView?t.classList.add(TC.Consts.classes.THREED):t.classList.remove(TC.Consts.classes.THREED);const o=t.querySelector(".tc-modal-body");o.innerHTML="";o.classList.add(TC.Consts.classes.LOADING);t.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,{closeCallback:function(){this._currentSelection.checked=!0;this.update()}.bind(e)});t.querySelector(".tc-modal-window").classList.add(e.CLASS+"-more-dialog");e._getMoreBaseLayers().then(function(){e.getRenderedHtml(e.CLASS,{baseLayers:e._moreBaseLayers},function(t){o.innerHTML=t;o.classList.remove(TC.Consts.classes.LOADING);o.querySelectorAll("li").forEach(function(t,o){t.dataset.layerId=e._moreBaseLayers[o].id});e.update(o)})})};e.getLayer=function(e){return this.map&&(this.map.getLayer(e)||this._moreBaseLayers&&this._moreBaseLayers.filter(function(t){return t.id===e})[0])};const n=function(e){return new Promise(function(t,o){Promise.all([e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then(function(){t()})})};e._getMoreBaseLayers=function(){const e=this;if(e._moreBaseLayers||e._moreBaseLayersPromise){if(e._moreBaseLayers)return new Promise(function(t,o){Promise.all(e._moreBaseLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).map(function(t){return e.map.on3DView?n(t):t.getCapabilitiesPromise()})).then(function(){e._moreBaseLayers=e._moreBaseLayers.map(function(t){if(t.type===TC.Consts.layerType.WMTS){var o=t.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];t.mustReproject=!o}else t.type===TC.Consts.layerType.WMS&&(t.mustReproject=!t.isCompatible(e.map.getCRS()));if(e.map.on3DView&&t.mustReproject&&t.getFallbackLayer&&t.getFallbackLayer()){t.mustReproject=!t.getFallbackLayer().isCompatible(e.map.getCRS());return t}return t});t(e._moreBaseLayers)})})}else e._moreBaseLayersPromise=new Promise(function(t,o){var r=TC.Cfg.availableBaseLayers.filter(function(e){return-1==TC.Cfg.availableBaseLayers.filter(function(e){return e.fallbackLayer}).map(function(e){return e.fallbackLayer}).indexOf(e.id)}).map(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(e):e.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(e):void 0});Promise.all(r).then(function(o){e._moreBaseLayers=new Array(o.length);var r=o.length;const i=function(){e._moreBaseLayers=e._moreBaseLayers.filter(function(e){return null!==e});t(e._moreBaseLayers)},a=function(t){const o=this;o.map=e.map;o.isBase=o.options.isBase=!0;if(o.type===TC.Consts.layerType.WMTS){var n=o.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];o.mustReproject=!n}else o.type===TC.Consts.layerType.WMS&&(o.mustReproject=!o.isCompatible(e.map.getCRS()));e.map.on3DView&&o.mustReproject&&o.getFallbackLayer&&o.getFallbackLayer()&&(o.mustReproject=!o.getFallbackLayer().isCompatible(e.map.getCRS()));e._moreBaseLayers.splice(t,1,o);0===--r&&i()};o.forEach(function(t,o){if(t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS){(e.map.on3DView?n(t):t.getCapabilitiesPromise()).then(a.bind(t,o),function(t){e._moreBaseLayers.splice(o,1,null);0===--r&&i()})}else a.call(t,o)})})});return e._moreBaseLayersPromise}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(e,t){TC.Util.getQueryStringParams(t);for(var o=0,r=TC._appCacheBuilders.length;o<r;o++){var n=TC._appCacheBuilders[o];switch(e.type){case"cached":n.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t});break;case"obsolete":n.trigger(TC.Consts.event.MAPCACHEDELETE,{url:t});break;case"checking":break;case"progress":n.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:t,loaded:e.loaded,total:e.total});break;case"error":n.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:e.reason,status:e.status});break;case"noupdate":case"updateready":n.trigger(TC.Consts.event.MAPCACHEERROR,{url:t,reason:"already_exists",status:e.status})}}});var t,o=function(){return new Promise(function(e,t){var o=document.documentElement.getAttribute("manifest");o?TC.ajax({url:o,method:"GET",responseType:"text"}).then(function(t){TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var o=hex_md5(t),r=t.indexOf("NETWORK:");r>=0&&(t=t.substr(0,r));(r=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,r));(r=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,r));var n=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});n.shift();e({hash:o,urls:n})})}).catch(function(){t()}):t()})};if(e){const o=(t=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater,function(e){t&&parent.TC._appCacheUpdater(e,location.href)});e.addEventListener("cached",o,!1);e.addEventListener("error",o,!1);e.addEventListener("noupdate",o,!1);e.addEventListener("obsolete",o,!1);e.addEventListener("progress",o,!1);e.addEventListener("updateready",o,!1)}TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var o=0,r=localStorage.length;o<r;o++){var i=localStorage.key(o);if(0===i.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)&&i!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var a=localStorage.getItem(i).split(" "),s=n(a.shift()),l={name:a.join(" "),extent:s,url:decodeURIComponent(i.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(l)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(t){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var c=$.extend({},r>1?arguments[1]:arguments[0]);e._dialogDiv=TC.Util.getDiv(c.dialogDiv);e._$dialogDiv=$(e._dialogDiv);c.dialogDiv||document.body.appendChild(e._dialogDiv);e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var u=history.pushState;history.pushState=function(t){var o;o=u.apply(history,arguments);if(e._offlinePanelDiv){var r=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),n=TC.Util.getQueryStringParams();delete n[e.MAP_DEFINITION_PARAM_NAME];delete n[e.MAP_EXTENT_PARAM_NAME];delete n[e.SERVICE_WORKER_FLAG];var i=$.param(n);i.length&&(i="?"+i);var a=r+i+location.hash;e._offlinePanelDiv.querySelector(e._selectors.EXIT).setAttribute("href",a)}return o};var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},d=function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.remove(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI);switch(h.type){case 1:case 2:case void 0:t.classList.add(TC.Consts.classes.CONNECTION_WIFI);break;default:t.classList.add(TC.Consts.classes.CONNECTION_MOBILE)}}};h.addEventListener&&h.addEventListener("typechange",d);window.addEventListener("online",d);window.addEventListener("offline",function(){if(e._offlinePanelDiv){const t=e._offlinePanelDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);t.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);t.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var r=TC.control.CacheBuilder.prototype;r.CLASS="tc-ctl-cbuild";r.MAP_DEFINITION_PARAM_NAME="map-def";r.MAP_EXTENT_PARAM_NAME="map-extent";r.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";r.ROOT_CACHE_NAME="root";r.COOKIE_KEY_PREFIX="TC.offline.map.";r.CACHE_REQUEST_PATH="offline";r.SERVICE_WORKER_FLAG="sw";r._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};r._actions={CREATE:"create",DELETE:"delete"};r.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";r.template={};if(TC.isDebug){r.template[r.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";r.template[r.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";r.template[r.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";r.template[r.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";r.template[r.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{r.template[r.CLASS]=function(){dust.register(r.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",r,{},{$key:"cb.filter.plhr"}).w('"').x(r.get(["storedMaps"],!1),r,{else:t,block:o},{}).w(' maxlength="200" /> <ul id="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(r.get(["storedMaps"],!1),r,{block:n},{}).w("><span>").h("i18n",r,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",r,{},{$key:"noMatches"}).w("</span></li>").s(r.get(["storedMaps"],!1),r,{block:i},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",r,{},{$key:"newofflinemap"}).w('">').h("i18n",r,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",r,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function t(e,t){return e.w(" disabled")}t.__dustBody=!0;function o(e,t){return e}o.__dustBody=!0;function n(e,t){return e.w(" hidden")}n.__dustBody=!0;function i(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}i.__dustBody=!0;return e};r.template[r.CLASS+"-map-node"]=function(){dust.register(r.CLASS+"-map-node",e);function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-bl-node"]=function(){dust.register(r.CLASS+"-bl-node",e);function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-dialog"]=function(){dust.register(r.CLASS+"-dialog",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w('</h4><p class="tc-ctl-cbuild-bl-panel-txt">').h("i18n",t,{},{$key:"selectAtLeastOne"}).w('</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-off-panel"]=function(){dust.register(r.CLASS+"-off-panel",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e}}const n=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},i=function(e,t){t.querySelector("span").classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.TEXTBOX).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.SAVEBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.remove(TC.Consts.classes.HIDDEN)};var a=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},s=function(e,t){var o=t||{};const r=e._dialogDiv.querySelector(e._classSelector+"-res"),n=e._dialogDiv.querySelector(e._selectors.RNGMAXRES);var i,a,s,l=e.getResolutions();if(l.length){if(e.minResolution){if(void 0===o.rangeValue)for(var c=0,u=l.length;c<u;c++)if(e.minResolution>=l[c]){n.value=c;break}}else void 0===o.rangeValue&&(n.value=Math.floor(l.length/2));n.setAttribute("max",l.length-1);a=parseInt(n.value);var h=Math.floor(1e3*new Number(l[a]))/1e3;i=e.getLocaleString("metersPerPixel",{value:h.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});s=100*(a+1)/(l.length+1)+"%";n.disabled=!1;e.minResolution=l[n.value]}else{a=0;i="";n.value=0;s="0";e.minResolution=0;n.disabled=!0}r.style.left=s;r.innerHTML=i};const l=function(e){e._dialogDiv.querySelectorAll(e._classSelector+"-bl-node input[type=checkbox]").forEach(function(t,o){if(t.checked){var r=e.requestSchemas.filter(function(e){return e.layerId===t.value})[0];if(r){var n=function(e,t){for(var o=null,r=0,n=e.tileMatrixLimits.length;r<n&&!((o=e.tileMatrixLimits[r]).res<=t);r++);return o}(r,e.minResolution);if(n){var i=r.url;if(i.indexOf("{TileMatrix}")<0){var a=i.indexOf("?");a>=0&&(i=i.substr(0,a));for(var s=0,l=e.baseLayers.length;s<l;s++){var c=e.baseLayers[s];if(c.id===r.layerId){i=i+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}for(;t&&"LABEL"!==t.tagName;)t=t.parentElement;if(t){t.style.backgroundSize="auto";t.style.backgroundPosition="left bottom";t.style.backgroundImage="url("+i.replace("{TileMatrix}",n.mId).replace("{TileRow}",n.rt).replace("{TileCol}",n.cl)+")"}}}}})},c=function(e,t){return t<1?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:a(t)})},u=function(e){var t="";e.tileCount=0;for(var o=0,r=e.requestSchemas.length;o<r;o++)for(var n=e.requestSchemas[o],i=0,s=n.tileMatrixLimits.length;i<s;i++){var l=n.tileMatrixLimits[i];e.tileCount+=(l.cr-l.cl+1)*(l.rb-l.rt+1);if(l.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:a(e.tileCount)})+" ("+c(e,e.estimatedMapSize)+")"}e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML=t},h=function(e,t){var o=t.indexOf("#");o>=0&&(t=t.substr(0,o));const r=e.div.querySelectorAll(e._selectors.LISTITEM);for(var n=0,i=r.length;n<i;n++){const e=r[n],o=e.querySelector("a");if(o&&o.getAttribute("href")===t)return e}return null},d=function(e,t){const o=document.createElement("iframe");o.style.display="none";o.setAttribute("src",t);e.div.appendChild(o)},p=function(e,t){const o=e.div.querySelector('iframe[src="'+t+'"]');o&&o.parentElement.removeChild(o)};var f=function(e,t){var o=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);o=!0}return o};const g=function(e,t){const o=e.findStoredMap({url:t});if(o){if(function(e,t){var o=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));o=!0}return o}(e,t)){const t=function(e,t){const o=e.div.querySelectorAll(e._selectors.LISTITEM);for(var r=0,n=o.length;r<n;r++){const e=o[r],n=e.querySelector("a");if(n&&n.innerHTML===t)return e}return null}(e,o.name);t&&t.parentElement.removeChild(t)}var r=$.inArray(o,e.storedMaps);e.storedMaps.splice(r,1);if(!e.storedMaps.length){e.div.querySelector(e._selectors.SEARCH).disabled=!0;e.div.querySelector(e._selectors.EMPTYLIST).removeAttribute("hidden")}return o.name}return null};r.render=function(e){const t=this;return t._set1stRenderPromise(new Promise(function(o,r){var a={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(a,function(){t._dialogDiv.querySelector(t._selectors.OKBTN).addEventListener(TC.Consts.event.CLICK,function(){t.generateCache()});t._dialogDiv.querySelector(t._selectors.NAMETB).addEventListener("input",function(){t._updateReadyState()});t.div.querySelector(t._selectors.NEWBTN).addEventListener(TC.Consts.event.CLICK,function(){t.setEditState()});t.div.querySelector(t._classSelector+"-btn-cancel-draw").addEventListener(TC.Consts.event.CLICK,function(){t.setReadyState()});t.div.querySelector(t._classSelector+"-btn-cancel-dl").addEventListener(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});const o=t.div.querySelector(t._selectors.LIST);o.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.DELETEBTN,function(e){t.startDeleteMap(e.target.parentElement.querySelector("a").innerHTML)}));o.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.EDITBTN,function(e){!function(e,t){t.querySelector("span").classList.add(TC.Consts.classes.HIDDEN);const o=t.querySelector(e._selectors.TEXTBOX);o.classList.remove(TC.Consts.classes.HIDDEN);o.value=t.querySelector("span a").innerHTML;o.focus();t.querySelector(e._selectors.SAVEBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.CANCELBTN).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.EDITBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.VIEWBTN).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DELETEBTN).classList.add(TC.Consts.classes.HIDDEN)}(t,e.target.parentElement)}));o.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.CANCELBTN,function(e){const o=e.target.parentElement;o.querySelector(t._selectors.TEXTBOX).value=o.querySelector("a").innerHTML;i(t,o)}));o.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.SAVEBTN,function(e){const o=e.target.parentElement;i(t,o);const r=o.querySelector("a"),n=(r.innerHTML,o.querySelector(t._selectors.TEXTBOX).value),a=t.findStoredMap({url:r.getAttribute("href")});if(a){a.name=n;r.innerHTML=n;r.setAttribute("title",n);f(t,a)}}));o.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(t._selectors.VIEWBTN,function(e){const o=e.target;var r=!o.classList.contains(TC.Consts.classes.ACTIVE);const i=t.div.querySelector(t._selectors.VIEWBTN);i.classList.remove(TC.Consts.classes.ACTIVE);i.parentElement.classList.remove(TC.Consts.classes.ACTIVE);const a=o.parentElement.querySelector("a").innerHTML;if(a){var s=t.findStoredMap({name:a});if(s){var l=n(s.extent);t.layer.clearFeatures();if(r){t.layer.addPolygon([[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});o.classList.add(TC.Consts.classes.ACTIVE);o.parentElement.classList.add(TC.Consts.classes.ACTIVE);o.setAttribute("title",t.getLocaleString("removeMapExtent"))}}}}));const r=t.div.querySelector(t._selectors.SEARCH),a=function(){!function(e){e=e.toLowerCase();const o=t.div.querySelectorAll(t._selectors.LISTITEM);o.forEach(function(e){e.style.display="none"});const r=[];o.forEach(function(e){e.matches("li:not([class]),li."+TC.Consts.classes.ACTIVE)&&r.push(e)});if(0===e.length){r.forEach(function(e){e.style.removeProperty("display")});t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="visible"}else{t.div.querySelector(t._classSelector+"-map-search-icon").style.visibility="hidden";var n=new RegExp(e,"i");r.forEach(function(e){e.style.display=n.test(e.querySelector("a").textContent)?"":"none"});r.some(function(e){return!e.hidden})||o.forEach(function(e){e.matches('[class^="tc-ctl-cbuild-map-not"]')&&e.style.removeProperty("display")})}}(this.value.toLowerCase().trim())};r.addEventListener("keyup",a);r.addEventListener("search",a);t._dialogDiv.querySelector(t._selectors.BLLIST).addEventListener("change",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){t.baseLayers.length=0;t._dialogDiv.querySelectorAll(t._selectors.BLLIST+" input[type=checkbox]").forEach(function(e){if(e.checked)for(var o=e.value,r=0,n=t.map.baseLayers.length;r<n;r++){var i=t.map.baseLayers[r];if(i.id===o&&i.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=i;break}}});t.updateRequestSchemas();s(t);l(t);t._updateReadyState();u(t)}));const c=t._dialogDiv.querySelector(t._selectors.RNGMAXRES),d=function(e){s(t,{rangeValue:e.target.value});l(t);u(t)};c.addEventListener("input",d);c.addEventListener("change",d);const p=h(t,location.href);p&&p.classList.add(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()}).then(function(){o()}).catch(function(e){r(e instanceof Error?e:Error(e))})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var o=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=o;return o}},!0)}))};r.register=function(e){var t=this;const r=TC.control.SWCacheClient.prototype.register.call(t,e);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":t.trigger(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total});break;case"cached":t.trigger(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name});break;case"deleted":t.trigger(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name});break;case"error":e.data.action===t._actions.CREATE&&TC.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});o().then(function(e){const o=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var r;window.localStorage&&(r=localStorage.getItem(o));if(r!==e.hash){t.cacheUrlList(e.urls);t.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){const n=!r;window.localStorage&&localStorage.setItem(o,e.hash);n||TC.confirm(t.getLocaleString("newAppVersionAvailable"),function(){location.reload()})})}})}if(t.mapIsOffline){e.div.classList.add(TC.Consts.classes.OFFLINE);t._offlinePanelDiv=TC.Util.getDiv(t.options.offlinePanelDiv);t.options.offlinePanelDiv||e.div.appendChild(t._offlinePanelDiv);t.getRenderedHtml(t.CLASS+"-off-panel",null,function(e){t._offlinePanelDiv.innerHTML=e;if(!navigator.onLine){const e=t._offlinePanelDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(TC.Consts.classes.CONNECTION_OFFLINE);e.classList.remove(TC.Consts.classes.CONNECTION_MOBILE);e.classList.remove(TC.Consts.classes.CONNECTION_WIFI)}t._offlinePanelDiv.querySelector(t._selectors.EXIT).addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}const i=t.getUID(),a=t.getUID();t.layerPromise=e.addLayer({id:a,type:TC.Consts.layerType.VECTOR,stealth:!0,styles:{line:e.options.styles.line}});t.layer=null;Promise.all([t.layerPromise,t.renderPromise(),e.addControl("draw",{id:i,div:t.div.querySelector(t._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1})]).then(function(o){const r=t.layer=o[0],n=t.boxDraw=o[2];n.setLayer(r);n.on(TC.Consts.event.DRAWSTART,function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var o=e.feature.geometry[0],r=o[0],n=o[2],i=Math.min(r[0],n[0]),a=Math.max(r[0],n[0]),s=Math.min(r[1],n[1]),c=Math.max(r[1],n[1]);t.setExtent([i,s,a,c]);const h=t._dialogDiv.querySelectorAll("input[type=checkbox]");h.forEach(function(e){for(var o=0,r=t.map.baseLayers.length;o<r;o++){var n=t.map.baseLayers[o];if(e.value===n.id){for(var i=e;i&&"LI"!==i.tagName;)i=i.parentElement;var a=n.getResolutions(),s=t.wrap.getRequestSchemas({extent:t.extent,layers:[n]})[0].tileMatrixLimits;if(s.length&&a[a.length-1]==s[s.length-1].res)i.classList.remove(TC.Consts.classes.HIDDEN);else{e.checked=!1;i.classList.add(TC.Consts.classes.HIDDEN)}break}}});var d;const p=t._dialogDiv.querySelectorAll(t._selectors.BLLISTITEM);for(var f=0,g=p.length;f<g;f++)if(p[f].matches("."+TC.Consts.classes.HIDDEN)){d="selectAtLeastOne";break}d||(d="cb.noMapsAtSelectedExtent");t._dialogDiv.querySelector(t._selectors.BLLISTTEXT).innerHTML=t.getLocaleString(d);l(t);u(t);TC.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-dialog"),{openCallback:function(){h.forEach(function(e){e.disabled=!1});var e;if(Date.prototype.toLocaleString){var o={};o.year=o.month=o.day=o.hour=o.minute=o.second="numeric";e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),o)}else e=(new Date).toString();t._dialogDiv.querySelector(t._selectors.NAMETB).value=e;t._updateReadyState()},closeCallback:function(){h.forEach(function(e){e.disabled=!0});t.layer.clearFeatures()}})});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){n===e.control&&t._state===t._states.EDITING&&t.setReadyState()})});var s=function(e){var o=!1;const r=t._dialogDiv.querySelector(t._selectors.BLLIST),n=function(){return!!r.querySelector('li[data-tc-layer-uid="'+e.id+'"]')};var i=e.type===TC.Consts.layerType.WMTS&&!e.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(i=i&&TC.Util.isSameOrigin(e.url));if(i&&!n()){o=!0;t.getRenderedHtml(t.CLASS+"-bl-node",e,function(e){if(!n()){const t=new DOMParser;r.appendChild(t.parseFromString(e,"text/html").body.firstChild)}})}return o};e.on(TC.Consts.event.LAYERADD,function(e){t.renderPromise().then(function(){s(e.layer)})}).on(TC.Consts.event.LAYERREMOVE,function(e){t.renderPromise().then(function(){const o=e.layer;if(o.type===TC.Consts.layerType.WMTS){const e=t._dialogDiv.querySelector(t._selectors.BLLIST).querySelector('li[data-tc-layer-uid="'+o.id+'"]');e.parentElement.removeChild(e)}})});var c=TC.Util.getQueryStringParams(),d=c[t.MAP_DEFINITION_PARAM_NAME],m=c[t.MAP_EXTENT_PARAM_NAME];e.ready(function(){if(t.mapIsOffline){var o,r,n=[];for(o=0,r=t.offlineControls.length;o<r;o++){var i=t.offlineControls[o];i=i.substr(0,1).toUpperCase()+i.substr(1);n=n.concat(e.getControlsByClass("TC.control."+i))}for(o=0,r=e.controls.length;o<r;o++){var a=e.controls[o];n.indexOf(a)<0&&a.disable()}document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})}});e.loaded(function(){t.layerPromise.then(function(t){e.putLayerOnTop(t)});t.renderPromise().then(function(){t.div.querySelector(t._selectors.NEWBTN).disabled=!1;for(var o=0,r=e.baseLayers.length;o<r;o++)s(e.baseLayers[o])});if(t.mapIsOffline){var o=JSON.parse(window.atob(decodeURIComponent(d))),r=[],i=$.grep(e.baseLayers,function(e){var t=!1;if(e.type===TC.Consts.layerType.WMTS)for(var n=0,i=o.layers.length;n<i;n++){var a=o.layers[n];if((0===e.url.indexOf("//")?location.protocol+e.url:e.url)===o.url[a.urlIdx]&&e.layerNames===a.id&&e.matrixSet===o.tms[a.tmsIdx]){t=!0;break}}t||e.type!==TC.Consts.layerType.VECTOR&&(r[r.length]=e);return t})[0];i&&e.setBaseLayer(i);for(var a=0,l=r.length;a<l;a++)e.removeLayer(r[a]);e.setExtent(n(m))}});t.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(o){t.isDownloading=!1;const r=function(e){const t=e.indexOf("#");return t>=0?e.substr(0,t):e}(o.url),n=h(t,r);if(n&&!t.serviceWorkerEnabled){n.classList.remove(TC.Consts.classes.DISABLED);TC.alert(t.getLocaleString("cb.delete.error"))}else if(t.currentMap&&r===t.currentMap.url){!function(e){const t=e.currentMap;if(f(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){const o=new DOMParser;e.div.querySelector(e._selectors.LIST).appendChild(o.parseFromString(t,"text/html").body.firstChild);e.div.querySelector(e._selectors.EMPTYLIST).setAttribute("hidden","hidden");e.div.querySelector(e._selectors.SEARCH).disabled=!1});e.storedMaps.push(t)}}(t);e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))}t.currentMap=null;p(t,o.url);t.setReadyState()}).on(TC.Consts.event.MAPCACHEDELETE,function(o){t.isDownloading=!1;var r=g(t,o.url)||t.currentMap&&t.currentMap.name;p(t,o.url);t.currentMap=null;if(r){document.cookie=t.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";e.toast(t.getLocaleString("mapDeleted",{mapName:r}))}t.setReadyState()}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var o=e.total;!o&&t.requestSchemas&&(o=t.requestSchemas[0].tileCount);var r=e.loaded;if(r)t._loadedCount=r;else{t._loadedCount+=1;r=t._loadedCount}t.showDownloadProgress(r,o)}).on(TC.Consts.event.MAPCACHEERROR,function(e){t.isDownloading=!1;p(t,e.url);t.setReadyState();var o=t.getLocaleString("cb.mapCreation.error"),r=!0;switch(e.reason){case"quota":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&g(t,e.url);r=!1;break;case"already_exists":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(r)if(TC.Util.detectIE()){TC.error(o);TC.alert(t.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(o);t.currentMap=null});return r};r.setExtent=function(e){if($.isArray(e)&&e.length>=4){this.extent=e;this.updateRequestSchemas()}};r._updateReadyState=function(){this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!this.extent||0===this._dialogDiv.querySelector(this._selectors.NAMETB).value.length||this._dialogDiv.querySelector(this._selectors.RNGMAXRES).disabled};r.setReadyState=function(){const e=this;e._state=e._states.READY;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.remove(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()};r.setEditState=function(){this._state=this._states.EDITING;this.showDownloadProgress(0,1);this.div.querySelector(this._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);this.div.querySelector(this._selectors.DRAWING).classList.remove(TC.Consts.classes.HIDDEN);this.map.toast(this.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});this._dialogDiv.querySelector(this._selectors.OKBTN).disabled=!0;this.div.querySelector(this._selectors.NEWBTN).disabled=!0;this._dialogDiv.querySelector(this._selectors.NAMETB).value="";this.boxDraw.activate()};r.generateCache=function(){const e=this,t={mapName:e._dialogDiv.querySelector(e._selectors.NAMETB).value};if(e.findStoredMap({name:t.mapName}))TC.alert(e.getLocaleString("cb.mapNameAlreadyExists.error",t));else{var r=function(){e.div.querySelector(e._classSelector+"-name").innerHTML=t.mapName;e.map.toast(e.getLocaleString("downloadingMap",{mapName:t.mapName}));!function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.NEW).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.remove(TC.Consts.classes.HIDDEN);e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!0;e.layer.clearFeatures();e.boxDraw.cancel()}(e);e.requestCache(t)},n=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(n.queryUsageAndQuota)n.queryUsageAndQuota(function(o,n){var i=(n-o)/1048576;e.estimatedMapSize<i?r():TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:t.mapName,mapSize:c(e,e.estimatedMapSize),availableStorage:c(e,Math.round(i))}),r)},function(e){TC.error(e)});else{var i=TC.Util.detectIE();if(i){var s=i<12?1e3:2e3,l=0,u=function(){var o=e.tileCount+l;o>s?TC.confirm(e.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:t.mapName,resourceCount:a(o),maxResourceCount:a(s)}),r):r()};o().then(function(e){l=e.urls.length;u()}).catch(u)}else r()}}};r.cacheUrlList=function(e,t){var o=t||{};this.createCache(o.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:e,silent:o.silent})};r.requestCache=function(e){var t=this,o=e||{};if(t.map){var r=o.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:r});if(t.requestSchemas){for(var n=function(e,o,r){var n=e.res>=t.minResolution;!n&&o>0&&(n=r[o-1].res>t.minResolution);return n},i=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},a=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(n)}}),s=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=a.length;l<c;l++){var u=a[l],h=(M=u.tileMatrixLimits[u.tileMatrixLimits.length-1]).res*M.tSize;s[0]=Math.min(s[0],M.origin[0]+h*M.cl);s[1]=Math.min(s[1],M.origin[1]-h*(M.rb+1));s[2]=Math.max(s[2],M.origin[0]+h*(M.cr+1));s[3]=Math.max(s[3],M.origin[1]-h*M.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(i)}var p=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),f={bBox:s=s.map(function(e,t){return(t<3?Math.ceil:Math.floor)(e*p)/p}),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};for(l=0,c=t.baseLayers.length;l<c;l++){var g=t.baseLayers[l],y=0===g.url.indexOf("//")?location.protocol+g.url:g.url,C=$.inArray(y,f.url);C<0&&(C=f.url.push(y)-1);var v=$.inArray(g.matrixSet,f.tms);v<0&&(v=f.tms.push(g.matrixSet)-1);var T=g.format.substr(g.format.indexOf("/")+1),_=$.inArray(T,f.format);_<0&&(_=f.format.push(T)-1);f.layers[l]={urlIdx:C,id:g.layerNames,tmsIdx:v,formatIdx:_}}var S=TC.Util.getQueryStringParams(),E=S[t.MAP_EXTENT_PARAM_NAME]=s.toString();S[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(f));t.serviceWorkerEnabled&&(S[t.SERVICE_WORKER_FLAG]=1);var L=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(S);t.currentMap={name:o.mapName,extent:E,url:L};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(l=0,c=a.length;l<c;l++){for(var w=a[l],b=null,x=0,A=t.baseLayers.length;x<A;x++){var P=t.baseLayers[x];if(P.id===w.layerId){b=t.wrap.getGetTilePattern(P);break}}if(b){urlList=[];var R=0;for(k=0,lenk=w.tileMatrixLimits.length;k<lenk;k++){var M;for(P=(M=w.tileMatrixLimits[k]).cl;P<=M.cr;P++)for(m=M.rt;m<=M.rb;m++)urlList[R++]=b.replace("{TileMatrix}",M.mId).replace("{TileCol}",P).replace("{TileRow}",m)}urlList.push(L);t.cacheUrlList(urlList,{name:L})}}else d(t,L)}}};r.cancelCacheRequest=function(){var e=this;if(e.currentMap){p(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;e.setReadyState()};r.deleteMap=function(e){var t=this,o=t.findStoredMap({name:e});if(o){var r=TC.Util.getQueryStringParams(o.url);t.deleteCache(o.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(r[t.MAP_DEFINITION_PARAM_NAME]));d(t,o.url)}})}};r.startDeleteMap=function(e){const t=this;if(navigator.onLine){if(e){var o=t.getLocaleString("cb.delete.confirm",{mapName:e});t.serviceWorkerEnabled||(o=o+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(o))if(navigator.onLine){!function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);e.div.querySelector(e._selectors.DRAWING).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.PROGRESS).classList.add(TC.Consts.classes.HIDDEN);e.div.querySelector(e._selectors.NEW).classList.remove(TC.Consts.classes.HIDDEN);e.div.querySelectorAll(e._selectors.LISTITEM).forEach(function(e){e.classList.add(TC.Consts.classes.DISABLED)});e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0;e.div.querySelector(e._selectors.NEWBTN).disabled=!1;e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="";e.boxDraw.cancel()}(t);t.deleteMap(e)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))};r.findStoredMap=function(e){return $.grep(this.storedMaps,function(t){var o=!0;e.name&&e.name!==t.name&&(o=!1);o&&e.url&&e.url!==t.url&&(o=!1);return o})[0]};r.showDownloadProgress=function(e,t){const o=this,r=o._classSelector,n=o.div.querySelector(r+"-progress-count");if(t){var i=Math.min(Math.round(100*e/t),100)+"%";o.div.querySelector(r+"-progress-ratio").style.width=i;n.innerHTML=i}else{o.div.querySelector(r+"-progress-bar").classList.add(TC.Consts.classes.HIDDEN);n.innerHTML=o.getLocaleString("xFiles",{quantity:e})}};r.updateRequestSchemas=function(e){var t=e||{};t.extent=t.extent||this.extent;t.layers=t.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(t);return this.requestSchemas};r.getResolutions=function(){for(var e=[],t=function(e){return e.res},o=this.requestSchemas.map(function(e){return e.tileMatrixLimits.map(t)}),r=Number.POSITIVE_INFINITY,n=0,i=0,a=o.length;i<a;i++){var s=o[i];r=Math.min(r,s[0]);n=Math.max(n,s[s.length-1])}for(i=0,a=o.length;i<a;i++)e=e.concat(o[i].filter(function(t){return t<=r&&t>=n&&e.indexOf(t)<0}));e.sort(function(e,t){return t-e});return e}}();TC.control=TC.control||{};TC.control.Container||TC.syncLoadJS(TC.apiLocation+"TC/Control/Container");TC.control.ControlContainer=function(){TC.control.Container.apply(this,arguments);this._classSelector="."+this.CLASS};TC.inherit(TC.control.ControlContainer,TC.control.Container);!function(){var e=TC.control.ControlContainer.prototype;e.CLASS="tc-ctl-cctr";e.SIDE={LEFT:"left",RIGHT:"right"};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ControlContainer.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/ControlContainerNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.write('<ul class="tc-ctl-cctr-left">').section(t.get("controls"),t,{block:o},null).write('</ul><ul class="tc-ctl-cctr-right">').section(t.get("controls"),t,{block:n},null).write("</ul>")}function o(e,t){return e.helper("eq",t,{block:r},{key:t.get("side"),value:"left"})}function r(e,t){return e.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(t.get("index"),t,"h").write('"><div></div></li>')}function n(e,t){return e.helper("eq",t,{block:i},{key:t.get("side"),value:"right"})}function i(e,t){return e.write('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').reference(t.get("index"),t,"h").write('"><div></div></li>')}return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w('<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-').f(t.get(["index"],!1),t,"h").w('"><div></div></li>')}t.__dustBody=!0;return t}}e.onRenderPromise=function(){const e=this;var t=new Array(e.ctlCount);Object.keys(e.controlOptions).forEach(function(o,r){var n=e.controlOptions[o];t[r]=e.map.addControl(o,$.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r).querySelector("div")},n.options))});Promise.all(t).then(function(){for(var t=0,o=arguments.length;t<o;t++){arguments[t].containerControl=e}})};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({controls:Object.keys(t.controlOptions).map(function(e,o){return $.extend(t.controlOptions[e],{index:o})})}))};e.addControl=function(e,t){const o=this;t.side=t.side||o.SIDE.LEFT;return new Promise(function(r,n){o.getRenderedHtml(o.CLASS+"-node",{index:++o.ctlCount},function(n){var i=document.createElement("template");i.innerHTML=n.trim();o.div.querySelector("ul."+o.CLASS+"-"+t.side).appendChild(i.content?i.content.firstChild:i.firstChild);o.map.addControl(e,$.extend({id:o.getUID(),div:o.div.querySelector("."+o.CLASS+"-elm-"+o.ctlCount).querySelector("div")},t)).then(function(e){r(e)})})})};e.addElement=function(e){e.side=e.side||this.SIDE.LEFT;var t=document.createElement("li");t.setAttribute("class",this.CLASS+"-elm "+this.CLASS+"-elm-"+this.ctlCount+++" ");this.div.querySelector("ul."+this.CLASS+"-"+e.side).appendChild(t);var o=t.appendChild(e.htmlElement);o.setAttribute("class",o.getAttribute("class")+" tc-ctl");return o}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);$.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var e=TC.control.Coordinates.prototype;e.CLASS="tc-ctl-coords";var t;e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Coordinates.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CoordinatesDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(t.get(["crs"],!1),t,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",t,{},{$key:"changeCRS"}).w('">').f(t.get(["crs"],!1),t,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(t.get(["isGeo"],!1),t,{else:o,block:n},{}).w("</div>").x(t.get(["showGeo"],!1),t,{block:a},{}).w('<span class="close"></span>')}t.__dustBody=!0;function o(e,t){return e.w('x: <span class="tc-ctl-coords-x">').f(t.get(["x"],!1),t,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(t.get(["y"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('z: <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}r.__dustBody=!0;function n(e,t){return e.h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:i},{})}n.__dustBody=!0;function i(e,t){return e.h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}i.__dustBody=!0;function a(e,t){return e.w('<div class="tc-ctl-coords-alt"><div class="tc-ctl-coords-xy">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:s},{}).w("</div></div>")}a.__dustBody=!0;function s(e,t){return e.h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}s.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",t,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",t,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",t,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.register=function(e){var t=this;const o=TC.control.ProjectionSelector.prototype.register.call(t,e);t.crs=t.map.crs;t.clear();e.on(TC.Consts.event.VIEWCHANGE,function(e){const o=e.view;if(o===TC.Consts.view.PRINTING)return;const r=function(e){t.isPointerOver(e)||t.clear()};if(o===TC.Consts.view.THREED){t.isGeo=!0;t.units=TC.Consts.units.DEGREES;t.crs=t.map.view3D.crs;t.map.view3D.container.addEventListener("mouseout",r);t.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(e){if(e){if(TC.Util.detectMobile()){t.clear();t.coordsToClick({coordinate:[e.lon,e.lat,e.ele],cssClass:t._cssClasses.THREEDMARKER})}t.latLon=[e.lat,e.lon];if(e.ele>0){var o=TC.Util.getMapLocale(t.map);t.latLon.push(e.ele.toLocaleString(o)+"m")}t.update()}else t.clear()})}else if(o===TC.Consts.view.DEFAULT){t.isGeo=t.map.wrap.isGeo();t.units=TC.Consts.units.METERS;t.crs=t.map.crs;t.map.view3D&&t.map.view3D.container.removeEventListener("mouseout",r)}if(t.map.view3D){t.geoCrs=t.map.view3D.crs;t.render()}});e.loaded(function(){t.wrap.register(e).then(function(){t.render(function(){t.clear()})});TC.Util.detectMobile()&&t.renderPromise().then(function(){t.getLayer();t.activateCoords()});e.on(TC.Consts.event.PROJECTIONCHANGE,function(o){if(!e.on3DView){t.isGeo=e.wrap.isGeo();t.crs=o.crs;t.render()}});t.map.wrap.getViewport().then(function(e){t.renderPromise().then(function(){e.addEventListener(TC.Consts.event.MOUSEMOVE,function(e){t.map.on3DView||t.onMouseMove(e)});e.addEventListener(TC.Consts.event.MOUSELEAVE,function(e){t.onMouseLeave(e)})})})});return o};e.render=function(e){const t=this;return t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo},function(){t.div.querySelector("button."+t._cssClasses.CRS).addEventListener(TC.Consts.event.CLICK,function(e){t.showProjectionChangeDialog()});$.isFunction(e)&&e()})}))};e.onMouseMove=function(e){this.wrap.onMouseMove(e)};e.onMouseLeave=function(e){const t=this;setTimeout(function(){if(!t.isPointerOver(e)){t.div.style.visibility="hidden";t.clear()}},200)};e.isPointerOver=function(e){var t=this.div.getBoundingClientRect();return t.left<=e.clientX&&t.left+t.width>=e.clientX&&t.top<=e.clientY&&t.top+t.height>=e.clientY};e.formatCoord=function(e,t){var o;o=e.toFixed(t);t<=3&&(o=o.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));return o=o.replace(".",",").replace(/\|/g,".")};e.update=function(){const e=this;!e.isGeo&&e.options.showGeo&&(e.latLon=TC.Util.reproject(e.xy,e.crs,e.geoCrs).reverse());if(!e.isGeo){e.x=e.formatCoord(e.xy[0],TC.Consts.METER_PRECISION);e.y=e.formatCoord(e.xy[1],TC.Consts.METER_PRECISION)}if(e.isGeo||e.options.showGeo){e.lat=e.formatCoord(e.latLon[0],TC.Consts.DEGREE_PRECISION);e.lon=e.formatCoord(e.latLon[1],TC.Consts.DEGREE_PRECISION)}e.render(function(){const t=e.div.querySelector("span.close");if(TC.Util.detectMobile()){t.addEventListener("click",function(){e.div.classList.add(TC.Consts.classes.HIDDEN);e.clear()});t.style.display=""}else{e.div.classList.remove(TC.Consts.classes.HIDDEN);e.div.style.visibility="visible";t.style.display="none"}})};e.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(e){e.clearFeatures()})};e.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};e.activateCoords=function(){this.wrap.coordsActivate()};e.getCoords=function(){var e=this.map.getControlsByClass(TC.control.Popup);if(e&&e.length>0&&e[0].isVisible())this.coordsToPopup(e[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};e.coordsToPopup=function(e){e&&this.updateCoordsCtrl(e.wrap.popup.getPosition())};e.updateCoordsCtrl=function(e){if(e){if(!this.isGeo){this.x=e[0];this.y=e[1];this.xy=[this.x,this.y];e.length>2&&this.xy.push(e[2])}if(this.isGeo||this.options.showGeo){this.lat=e[0];this.lon=e[1];this.latLon=[this.lat,this.lon];e.length>2&&this.latLon.push(e[2])}this.update()}};e.coordsToClick=function(e){var o=this;if(!o.map.div.classList.contains("tc-ctl-sv-active "+TC.Consts.classes.COLLAPSED)){var r=o.div.getBoundingClientRect();if(r.left<=e.clientX&&e.clientX<=r.right&&r.top<=e.clientY&&e.clientY<=r.bottom){o.div.classList.add(TC.Consts.classes.HIDDEN);o.clear();return}$(o.div).stop(!0,!0);t&&clearTimeout(t);o.updateCoordsCtrl(e.coordinate);o.map.on3DView||o.coordsMarkerAdd(e.coordinate,e.cssClass);o.div.classList.remove(TC.Consts.classes.HIDDEN);o.div.style.visibility="visible";o.div.style.opacity="0.7";t=setTimeout(function(){$(o.div).animate({opacity:0},3e3,"linear",function(){o.clear()})},5e3)}};e.coordsMarkerAdd=function(e,t){var o=this;o.currentCoordsMarker?o.currentCoordsMarker.setCoords(e):o.getLayer().then(function(r){r.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:t||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(e){o.currentCoordsMarker=e})})};e.getLayer=function(){const e=this;return new Promise(function(t,o){void 0==e.layer?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"}).then(function(o){e.layer=o;e.layer.map.putLayerOnTop(e.layer);t(e.layer)}):t(e.layer)})}}();TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.DataLoader=function(){TC.control.TabContainer.apply(this,arguments);this.controlOptions=[{name:"externalWMS",title:"addWMS",options:{suggestions:this.options.wmsSuggestions}},{name:"fileImport",options:{enableDragAndDrop:this.options.enableDragAndDrop}}];this.defaultSelection=0};TC.inherit(TC.control.DataLoader,TC.control.TabContainer);TC.control.DataLoader.prototype.register=function(e){this.title=this.getLocaleString("addMaps");return TC.control.TabContainer.prototype.register.call(this,e)};TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");TC.control.Download=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this._hiddenElms=[];var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv)};TC.inherit(TC.control.Download,TC.control.MapInfo);!function(){var e=TC.control.Download.prototype;e.CLASS="tc-ctl-download";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Download.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"download"}).w(' </h2><div class="tc-ctl-tctr tc-ctl-tctr-select"><form><label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",t,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",t,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-collapsed"><div><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format-image" class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr" class="tc-ctl-download-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-ctl-download-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w('</p></div></div></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-collapsed"><div><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",t,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",t,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",t,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",t,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",t,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",t,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",t,{},{$key:"noData"}).w(": </strong>").h("i18n",t,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg"><strong>').h("i18n",t,{},{$key:"noValidService"}).w(": </strong>").h("i18n",t,{},{$key:"noValidService.instructions"}).w("</p></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadData"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",t,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",t,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,function(){const o=".tc-ctl-tctr";t._selectors={TAB:o+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:o+"-elm"};const r=function(e){for(var o=this;o&&!o.matches(t._selectors.TAB);)o=o.parentElement;if(o){const e=o.querySelector(t._selectors.RADIOBUTTON),r=e.value,n=t.div.querySelectorAll(t._selectors.ELEMENT);if(t._oldValue===r&&t.options.deselectable){setTimeout(function(){e.checked=!1},0);t._oldValue=null;t._activeElm=null;n.forEach(function(e){t._hiddenElms.push(e)})}else{n.forEach(function(e){e.matches(t._selectors.ELEMENT+"-"+r)?t._activeElm=e:t._hiddenElms.push(e)});t._oldValue=r}t._hiddenElms.forEach(function(e){e.classList.add(TC.Consts.classes.COLLAPSED)});t._activeElm&&t._activeElm.classList.remove(TC.Consts.classes.COLLAPSED);e.checked=!0}};t.div.querySelectorAll("span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,r)});e&&e()})})};e.register=function(e){var t=this;const o=TC.control.MapInfo.prototype.register.call(t,e);t.map.mustBeExportable=!0;var r=function(e,o){const r=t.div.querySelector(".alert-warning:not(."+t.CLASS+"-alert)");var n;switch(e.key){case TC.Consts.WFSErrors.NumMaxFeatures:n=r.querySelector("#zoom-msg").innerHTML.format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoLayers:n=t.getLocaleString("noLayersLoaded");break;case TC.Consts.WFSErrors.GetCapabilities:n=r.querySelector("#novalid-msg").innerHTML.format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoFeatures:n=r.querySelector("#noFeatures-msg").innerHTML;break;case TC.Consts.WFSErrors.Indeterminate:n=t.getLocaleString("wfs.IndeterminateError");t.map.toast(n,{type:TC.Consts.msgType.ERROR});TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:e.params.err,descripcion:e.params.errorThrown,serviceName:e.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);t.map.getLoadingIndicator().removeWait(o);return;default:n=t.getLocaleString("wfs."+e.key,e.params)}t.map.toast(n,{type:TC.Consts.msgType.WARNING});t.map.getLoadingIndicator().removeWait(o)};t.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-btn",function(){var e=t.map.getLoadingIndicator().addWait(),o="";t._activeElm&&(o=t._activeElm.querySelector("select").value);if(o.indexOf("image")>-1)new Promise(function(o,r){var n=t.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],i=TC.Util.cloneCanvas(n);t.map.getControlsByClass(TC.control.ScaleBar)&&t.drawScaleBarIntoCanvas({canvas:i,fill:!0});if(t._activeElm.querySelector("#"+t.CLASS+"-image-qr:checked")){const r="qrcode";var a=document.getElementById(r);if(a)a.innerHTML="";else{(a=document.createElement("div")).setAttribute("id",r);document.body.appendChild(a)}a.style.top="-200px";a.style.left="-200px";a.style.position="absolute";t.makeQRCode(a,87,87).then(function(r){if(r){var n=i.getContext("2d");n.fillStyle="#ffffff";n.fillRect(i.width-91,i.height-91,91,91);TC.Util.addToCanvas(i,r,{x:i.width-88,y:i.height-88}).then(function(e){o(e)})}else{TC.error(t.getLocaleString("dl.export.map.error")+": QR");t.map.getLoadingIndicator().removeWait(e)}})}else o(i)}).then(function(r){try{const e=r.toDataURL(o);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+o.split("/")[1],o,e)}catch(e){TC.error(t.getLocaleString("dl.export.map.error")+": "+e.message)}t.map.getLoadingIndicator().removeWait(e)});else{var n=t.map.getExtent(),i=TC.Util.reproject(n.slice(0,2),t.map.crs,TC.Defaults.crs),a=TC.Util.reproject(n.slice(2),t.map.crs,TC.Defaults.crs),s=TC.WFSGetFeatureBuilder(t.map,new TC.filter.bbox([i[0],i[1],a[0],a[1]]),o,!0);Promise.all(s).then(function(o){var n=$.grep(o,function(e){return null!=e});if(0!==n.length){for(var i=[],a=0;a<n.length;a++)if(n[a].errors&&n[a].errors.length)for(var s=0;s<n[a].errors.length;s++){var l=n[a].errors[s];r(l,e)}else{var c=n[a].data,u=n[a].url;c&&u&&i.push({url:u+"?download=zip",data:c})}TC.Util.downloadFileForm(i);t.map.getLoadingIndicator().removeWait(e)}else r({key:TC.Consts.WFSErrors.NoLayers},e)})}}));t.div.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector(".tc-ctl-download-help",function(e){e.stopPropagation();TC.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-help-dialog"))}));t.div.addEventListener("change",TC.EventTarget.listenerBySelector("#"+t.CLASS+"-image-qr",function(e){e.target.checked?t.generateLink():t.div.querySelector("."+t.CLASS+"-alert").classList.add(TC.Consts.classes.HIDDEN)}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){t.generateLink();t.registerListeners()}));return o};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");document.getElementById(this.CLASS+"-image-qr").checked?e.qr?t.classList.remove(TC.Consts.classes.HIDDEN):e.qr||t.classList.add(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change";!function(){TC.control.Draw=function(){var e=this;TC.Control.apply(e,arguments);if(!Modernizr.inputtypes.color&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}e._classSelector="."+e.CLASS;e._pointClass=e.CLASS+"-point";e._lineClass=e.CLASS+"-line";e._polygonClass=e.CLASS+"-polygon";e.history=[];e.historyIndex=0;e.exportsState=!0;e.on(TC.Consts.event.DRAWSTART,function(t){e.resetValues()}).on(TC.Consts.event.POINT,function(o){e.layer&&!e.persistent&&e.layer.features&&e.layer.features.length>0&&e.layer.clearFeatures();e.history.length=e.historyIndex;e.history[e.historyIndex++]=o.point;t(e)}).on(TC.Consts.event.DRAWEND,function(t){o(e);t.feature.setId(TC.getUID(e.getLocaleString("sketch")+"."));e.callBack&&e.callBack(t.feature)});e._layerPromise=null};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var t=function(e){e._endBtn.disabled=0===e.historyIndex||e.mode===TC.Consts.geom.POLYGON&&e.historyIndex<3||e.mode===TC.Consts.geom.POLYLINE&&e.historyIndex<2;e._redoBtn.disabled=e.history.length===e.historyIndex;e._undoBtn.disabled=0===e.historyIndex},o=function(e){e.resetValues();e._endBtn.disabled=!0;e._cancelBtn.disabled=!1};TC.isDebug?e.template=TC.apiLocation+"TC/templates/Draw.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-draw-tools"><button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(t.get(["tooltip"],!1),t,"h").w('">').h("i18n",t,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",t,{},{$key:"undo"}).w('">').h("i18n",t,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",t,{},{$key:"redo"}).w('">').h("i18n",t,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="').h("i18n",t,{},{$key:"end"}).w('">').h("i18n",t,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",t,{},{$key:"cancel"}).w('">').h("i18n",t,{},{$key:"cancel"}).w("</button></div>").x(t.get(["styleTools"],!1),t,{block:o},{})}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-draw-style">').h("i18n",t,{},{$key:"strokeColor"}).w('<input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="').f(t.get(["strokeColor"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"selectColor"}).w('" />').h("i18n",t,{},{$key:"strokeWidth"}).w('<div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:').f(t.get(["strokeWidth"],!1),t,"h").w('px;"> </div><input type="number" class="tc-ctl-draw-str-w tc-textbox" value="').f(t.get(["strokeWidth"],!1),t,"h").w('" min="1" max="15" /></div>')}o.__dustBody=!0;return t};e.render=function(e){var t,o,r,n=this;switch(n.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t=n.getLocaleString("drawLine");n.div.classList.add(n._lineClass);o=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t=n.getLocaleString("drawPolygon");n.div.classList.add(n._polygonClass);o=TC.Cfg.styles.polygon.strokeColor;r=TC.Cfg.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t=n.getLocaleString("drawPoint");n.div.classList.add(n._pointClass);o=TC.Cfg.styles.point.strokeColor;r=TC.Cfg.styles.point.strokeWidth;break;default:t=n.getLocaleString("draw");o=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth}const i={tooltip:t,strokeColor:function(e){const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return t&&t.length?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e}(o),strokeWidth:r,styleTools:n.options.styleTools};return n._set1stRenderPromise(n.renderData(i,function(){if(!Modernizr.inputtypes.color){const e=n.div.querySelector("input[type=color]");if(e){e.style.backgroundColor=e.value;e.style.color="transparent";const t=new CP(e,"click",document.body);e.onclick=function(e){e.preventDefault()};e.onfocus=function(e){this.blur()};e.onchange=function(e){this.style.backgroundColor=this.value};n.map.loaded(function(){t.on("change",function(e){n.setStrokeColor("#"+e)})})}}n.reset=!0;n.callBack=null;n.measure=!1;n._cancelClick=!1;n.mode=n.options.mode||TC.Consts.geom.POLYLINE;n.options.measure&&(n.measure=n.options.measure);$.isFunction(n.options.callback)&&(n.callBack=n.options.callback);void 0===n.options.persistent?n.persistent=!0:n.persistent=n.options.persistent;n.wrap=new TC.wrap.control.Draw(n);n._newBtn=n.div.querySelector(n._classSelector+"-btn-new");n._newBtn.addEventListener(TC.Consts.event.CLICK,function(){n.new()});n._cancelBtn=n.div.querySelector(n._classSelector+"-btn-cancel");n._cancelBtn.addEventListener(TC.Consts.event.CLICK,function(){n.cancel()});n._endBtn=n.div.querySelector(n._classSelector+"-btn-end");n._endBtn.addEventListener(TC.Consts.event.CLICK,function(){n.end()});n._undoBtn=n.div.querySelector(n._classSelector+"-btn-undo");n._undoBtn.addEventListener(TC.Consts.event.CLICK,function(){n.undo()});n._redoBtn=n.div.querySelector(n._classSelector+"-btn-redo");n._redoBtn.addEventListener(TC.Consts.event.CLICK,function(){n.redo()});if(n.options.styleTools){n._strokeColorPicker=n.div.querySelector(n._classSelector+"-str-c");n._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE,function(e){n.setStrokeColor(e.target.value)});n._strokeWidthSelector=n.div.querySelector(n._classSelector+"-str-w");n._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE,function(e){n.setStrokeWidth(e.target.value)});n._strokeWidthWatch=n.div.querySelector(n._classSelector+"-str-w-watch")}$.isFunction(e)&&e()}))};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.end()});const r=function(){t.styles={};$.extend(!0,t.styles,t.options.styles||t.layer.options.styles)};t._layerPromise=new Promise(function(o,n){e.loaded(function(){if(t.options.layer){t.setLayer(t.options.layer);o(t.layer);r()}else if(!1===t.options.layer){t.setLayer(null);o(null)}else e.addLayer({id:t.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}}).then(function(n){e.putLayerOnTop(n);t.setLayer(n);o(t.layer);r()})})});return o};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._cancelBtn.disabled=!1;this.setMode(this.mode,!0);return this};e.undo=function(){var e=this.wrap.undo();if(e){this.historyIndex--;t(this);this.historyIndex<=0&&this.resetValues();this.trigger(TC.Consts.event.DRAWUNDO)}return e};e.redo=function(){var e=this.wrap.redo();if(e){this.historyIndex++;t(this);this.trigger(TC.Consts.event.DRAWREDO)}return e};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();o(this);this._cancelBtn.disabled=!0;this.trigger(TC.Consts.event.DRAWCANCEL,{ctrl:this});return this};e.activate=function(){this._newBtn.classList.add(TC.Consts.classes.ACTIVE);this._cancelBtn.disabled=!1;TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this.div.classList.remove(this._pointClass);this.div.classList.remove(this._lineClass);this.div.classList.remove(this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this.div.classList.add(this._pointClass);break;case TC.Consts.geom.POLYLINE:this.div.classList.add(this._lineClass);break;case TC.Consts.geom.POLYGON:this.div.classList.add(this._polygonClass)}};e.deactivate=function(){this._newBtn&&this._newBtn.classList.remove(TC.Consts.classes.ACTIVE);this._cancelBtn&&(this._cancelBtn.disabled=!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();e.resetValues();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(e,t){const o=this;e&&(o.mode=e);if(t&&e){o.layer&&o.layer.map.putLayerOnTop(o.layer);o.activate()}else o.deactivate();return o};e.setStyle=function(e){const t=this;if(e)$.extend(t.style,e);else switch(t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e={line:t.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e={polygon:t.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:e={point:t.styles.point};break;default:e={}}t.isActive&&t.wrap.setStyle(e)};e.getModeStyle=function(e){const t=this;switch(e=e||t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return t.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return t.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return t.styles.point;default:return null}};e.setStrokeColorWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeColor);const o=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);o&&o.length&&(e="#"+o[1]+o[1]+o[2]+o[2]+o[3]+o[3]);t._strokeColorPicker.value=e;if(!Modernizr.inputtypes.color){const o=t._strokeColorPicker;o.style.backgroundColor=e;o.blur()}}return t};e.setStrokeColor=function(e){const t=this,o=t.getModeStyle();o&&(o.strokeColor=e);t.isActive&&t.setStyle();t.setStrokeColorWatch(e);t.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:e});return t};e.setStrokeWidthWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeWidth);if((e=parseInt(e,10))!==Number.NaN){t._strokeWidthSelector.value=e;t._strokeWidthWatch.style.borderBottomWidth=e+"px"}}return t};e.setStrokeWidth=function(e){const t=this;if((e=parseInt(e,10))!==Number.NaN){const o=t.getModeStyle();o&&(o.strokeWidth=e);t.isActive&&t.setStyle();t.setStrokeWidthWatch(e);t.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:e})}return t};e.getLayer=function(){return this._layerPromise};e.setLayer=function(e){this.map&&(this.layer="string"==typeof e?this.map.getLayer(e):e)};e.resetValues=function(){this.history.length=0;this.historyIndex=0;t(this);return this};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.getLayer().then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var e=this;TC.control.Measure.apply(e,arguments);e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv);const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]"};e.persistentDrawControls=!0;e.renderPromise().then(function(){e._1stCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-1-t");e._2ndCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-2-t");e._1stCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-1-v");e._2ndCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-2-v");e._elevationText=e.div.querySelector(".tc-ctl-meas-val-coord-ele-t");e._elevationValue=e.div.querySelector(".tc-ctl-meas-val-coord-ele-v")});if(e.options.displayElevation){e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var e=TC.control.DrawMeasureModify.prototype;e.CLASS="tc-ctl-dmm";var t="tcValue";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATURESSELECT=TC.Consts.event.FEATURESSELECT||"featuresselect.tc";const o=[],r=function(e){return o.filter(function(t){return t.feature===e})[0]},n=function(e){const t=o.reduce(function(t,o,r){return o.feature===e?r:t},-1);t>=0&&o.splice(t,1)};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"drawAndMeasure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",t,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"search.list.coordinates"}).w(' <span class="tc-ctl-meas-val-coord"><span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",t,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",t,{},{$key:"deleteAll"}).w('">').h("i18n",t,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w("...</button></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadSketch"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:o},{}).w('<div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-dmm-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox" checked /><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}r.__dustBody=!0;return t}}e.render=function(e){const t=this,o=t._set1stRenderPromise(TC.control.Measure.prototype.render.call(t,function(){t._clearBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr");t._clearBtn.addEventListener(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteAll.confirm"),function(){t.clear()})});t._downloadBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl");t._downloadBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.showSketchDownloadDialog()});t._elevProfileBtn=t.div.querySelector(".tc-ctl-meas-prof-btn");t._elevProfileBtn.addEventListener(TC.Consts.event.CLICK,function(e){t.elevationProfileActive?t.deactivateElevationProfile():t.activateElevationProfile()});t.options.displayElevation||(t._elevProfileBtn.style.display="none");$.isFunction(e)&&e()})),r={checkboxId:t.getUID(),elevation:t.options.displayElevation};t.getRenderedHtml(t.CLASS+"-dialog",r,function(e){const o=function(e){TC.Util.closeModal();const o={fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:e},r=t._dialogDiv.querySelector(t._selectors.ELEVATION_CHECKBOX).checked;if(r){const e="1"===t._dialogDiv.querySelector("input[type=radio][name=ip-coords]:checked").value,r=t.map.getLoadingIndicator(),n=r&&r.addWait(),i={crs:t.map.crs,features:t.layer.features.map(function(t){return t.getGeometryStride()>=3&&(!e||TC.feature.Point&&t instanceof TC.feature.Point)?null:t.clone()}),maxCoordQuantity:t.options.displayElevation.maxCoordQuantity,sampleNumber:0};e&&(i.resolution=parseFloat(t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m input[type=number]").value)||t.options.displayElevation.resolution);t.elevation.setGeometry(i).then(function(e){e.forEach(function(o,r){o||(e[r]=t.layer.features[r])});t.map.exportFeatures(e,o)}).catch(function(e){e!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(t.getLocaleString("elevation.error")):TC.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){r&&r.removeWait(n)})}else{var n;n=t.options.displayElevation&&!r?t.layer.features.map(function(e){var t=e.clone();if(t.getGeometryStride()>2){t.getCoordsArray().forEach(function(e){e.length=2});t.setCoords(t.geometry)}return t}):t.layer.features;t.map.exportFeatures(n,o)}};t._dialogDiv.innerHTML=e;t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(t._selectors.ELEVATION_CHECKBOX,function(e){t.showSketchDownloadDialog()}));t._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio][name=ip-coords]",function(e){const o=t._dialogDiv.querySelector("."+t.CLASS+"-dialog-ip-m");"0"===e.target.value?o.classList.add(TC.Consts.classes.HIDDEN):o.classList.remove(TC.Consts.classes.HIDDEN)}));t._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){const r=e.target.dataset.format;r===TC.Consts.format.GPX&&t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon})?TC.confirm(t.getLocaleString("gpxNotCompatible.confirm"),function(){o(r)}):o(r)}))});return o};e.register=function(e){const t=this;return new Promise(function(i,a){TC.control.Measure.prototype.register.call(t,e).then(function(){const a=t.getUID(),s=t.getUID();Promise.all([t.layerPromise,t.renderPromise()]).then(function(l){const c=l[0];c.title=t.getLocaleString("sketch");t._modifyPromise=e.addControl("modify",{id:s,div:t.div.querySelector("."+t.CLASS+"-mod"),layer:c});t._modifyPromise.then(function(o){t.modify=o;o.on(TC.Consts.event.FEATURESSELECT,function(e){t.resultsPanelChart&&!e.features.some(function(e){return t.resultsPanelChart.currentFeature===e})&&t.resultsPanelChart.setCurrentFeature(null);const o=e.features[e.features.length-1];if(o){t.showMeasures(t.getFeatureMeasureData(o));const e=o._originalStyle||o.getStyle();switch(!0){case TC.feature.Polygon&&o instanceof TC.feature.Polygon:t.displayMode(TC.Consts.geom.POLYGON);t.drawPolygons.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);break;case TC.feature.Polyline&&o instanceof TC.feature.Polyline:t.displayMode(TC.Consts.geom.POLYLINE);t.drawLines.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);const n=r(o);if(n){t.resultsPanelChart.setCurrentFeature(o);t.renderElevationChart(n.data)}break;case TC.feature.Point&&o instanceof TC.feature.Point:t.displayMode(TC.Consts.geom.POINT);t.drawPoints.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth)}t.modify.setFontColorWatch(e.fontColor).setFontSizeWatch(e.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(e){t.modify.getSelectedFeatures().length||t.resetDrawWatches();t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}).on(TC.Consts.event.FEATUREMODIFY,function(e){if(e.layer===t.layer){n(e.feature);const o=function(e){const o=t.getFeatureMeasureData(e);t.showMeasures(o);t.setFeatureMeasureData(e)};o(e.feature);t.options.displayElevation&&TC.feature.Point&&e.feature instanceof TC.feature.Point&&t.elevation.setGeometry({features:[e.feature],crs:t.map.crs}).then(function(e){o(e[0])});t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e.feature&&t.hide()})}});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){const o=e.control;if(o===t.modify){t.resetDrawWatches();t.resetElevationProfile();if(t.resultsPanelChart){t.resultsPanelChart.setCurrentFeature(null);t.resultsPanelChart.close()}}else if(o===t.drawLines){t.resetElevationProfile();t.resultsPanelChart&&t.resultsPanelChart.close()}}).on(TC.Consts.event.FEATURECLICK,function(o){const n=o.feature;if(!(e.activeControl instanceof TC.control.Draw||e.activeControl instanceof TC.control.Modify)&&TC.feature.Polyline&&n instanceof TC.feature.Polyline&&t.layer.features.indexOf(n)>=0){if(t.elevationProfileActive){t.resultsPanelChart&&t.resultsPanelChart.setCurrentFeature(n);e.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===n&&e.hide()})}const o=r(n);t.resultsPanelChart&&t.resultsPanelChart.isMinimized()&&t.resultsPanelChart.maximize();o?t.renderElevationChart(o.data):t.displayElevationProfile(n.geometry)}})});t._drawLinesPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resultsPanelChart&&t.resultsPanelChart.currentFeature&&t.resultsPanelChart.setCurrentFeature(null);t.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){t.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.DRAWEND,function(e){t.resultsPanelChart&&(t.resultsPanelChart.currentFeature=e.feature)}).on(TC.Consts.event.POINT,function(e){const o=this.history.slice(0,this.historyIndex),r=o[o.length-1];r[0]===e.point[0]&&r[1]===e.point[1]||o.push(e.point);t.displayElevationProfile(o)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPolygonsPromise.then(function(e){e.on(TC.Consts.event.DRAWSTART,function(){t.resetValues()}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)})});t._drawPointsPromise=e.addControl("draw",{id:a,div:t.div.querySelector("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:t.persistentDrawControls,styleTools:!0,layer:t.layer});t._drawPointsPromise.then(function(o){o.containerControl=t;t.drawControls.push(o);t.drawPoints=o;t.resetValues();o.on(TC.Consts.event.DRAWEND,function(o){const r=function(o){t.showMeasures({coords:o.geometry,units:e.wrap.isGeo()?"degrees":"m"});t.setFeatureMeasureData(o)};r(o.feature);t.options.displayElevation&&t.elevation.setGeometry({features:[o.feature],crs:t.map.crs}).then(function(e){r(e[0])})}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)}).on(TC.Consts.event.STYLECHANGE,function(e){t.onStyleChange(e)});o.exportsState=!1});t.setMode(t.options.mode);e.on(TC.Consts.event.FEATUREADD,function(e){const o=e.layer,r=e.feature;if(o===t.layer){t.setFeatureMeasureData(r);t._modifyPromise.then(function(e){e.displayLabelText(r.getStyle().label)});t._clearBtn.disabled=!1;t._downloadBtn.disabled=!1}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const r=e.layer,i=e.feature;if(r===t.layer)if(0===t.layer.features.length){t._clearBtn.disabled=!0;t._downloadBtn.disabled=!0;t.resetValues();o.length=0}else i&&n(i)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(e){const t=e.control;t.setCurrentFeature&&t.setCurrentFeature(null)});i(t)})}).catch(function(e){a(e)})})};e.displayMode=function(e){const t=this;e===TC.Consts.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt"));t.modify&&t.modify.div.classList.remove(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(t,e)};e.setMode=function(e){const t=this;e===TC.Consts.geom.POINT&&t.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(t,e)};e.setFeatureMeasureData=function(e){const o=this,r={};switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:const n=o._1stCoordText.innerHTML,i=o._2ndCoordText.innerHTML,a=o._elevationText.innerHTML;if(o._1stCoordValue.textContent.trim().length>0&&o._2ndCoordValue.textContent.trim().length>0){r.CRS=o.map.crs;r[n.substr(0,n.indexOf(":"))]=$(o._1stCoordValue).data(t);r[i.substr(0,i.indexOf(":"))]=$(o._2ndCoordValue).data(t);a&&(r[o.getLocaleString("ele")]=$(o._elevationValue).data(t));e.setData(r)}break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:if(o._len.innerHTML.trim()!==o.NOMEASURE){r[o.getLocaleString("2dLength")]=o._len.innerHTML;e.setData(r)}break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:if(o._area.innerHTML.trim()!==o.NOMEASURE&&o._peri.innerHTML.trim()!==o.NOMEASURE){r[o.getLocaleString("area")]=o._area.innerHTML;r[o.getLocaleString("2dPerimeter")]=o._peri.innerHTML;e.setData(r)}}return o};e.getFeatureMeasureData=function(e){const t=this,o={units:"m"},n={};t.map.wrap.isGeo()&&(n.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:o.area=e.getArea(n);o.perimeter=e.getLength(n);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:o.length=e.getLength(n);const i=r(e);i?t.renderElevationChart(i.data):t.displayElevationProfile(e.geometry);break;case TC.feature.Point&&e instanceof TC.feature.Point:o.coords=e.geometry}return o};e.showMeasures=function(e){const o=this;TC.control.Measure.prototype.showMeasures.call(o,e);(e=e||{}).units;const r=o.map.options.locale||TC.Cfg.locale;if(e.coords){var n,i,a;if("m"===e.units){n=TC.Consts.METER_PRECISION;i=e.coords[0];a=e.coords[1];o._1stCoordText.innerHTML="x: ";o._2ndCoordText.innerHTML="y: "}else{n=TC.Consts.DEGREE_PRECISION;i=e.coords[1];a=e.coords[0];o._1stCoordText.innerHTML="lat: ";o._2ndCoordText.innerHTML="lon: "}const s=Math.pow(10,n),l=function(e){return Math.round(e*s)/s};o._1stCoordValue.innerHTML=TC.Util.formatNumber(i.toFixed(n),r);$(o._1stCoordValue).data(t,l(i));o._2ndCoordValue.innerHTML=TC.Util.formatNumber(a.toFixed(n),r);$(o._2ndCoordValue).data(t,l(a));if(e.coords.length>2){const n=Math.round(e.coords[2]);o._elevationText.innerHTML=o.getLocaleString("ele").toLowerCase()+": ";o._elevationValue.innerHTML=TC.Util.formatNumber(n.toFixed(TC.Consts.METER_PRECISION),r)+" m";$(o._elevationValue).data(t,n)}else{o._elevationText.innerHTML="";o._elevationValue.innerHTML="";$(o._elevationValue).data(t,null)}}return o};e.resetValues=function(){const e=this;TC.control.Measure.prototype.resetValues.call(e);if(e._1stCoordText){e._1stCoordText.innerHTML=e.NOMEASURE;e._2ndCoordText.innerHTML="";e._1stCoordValue.innerHTML="";$(e._1stCoordValue).data(t,null);e._2ndCoordValue.innerHTML="";$(e._2ndCoordValue).data(t,null);e._elevationText.innerHTML="";e._elevationValue.innerHTML="";$(e._elevationValue).data(t,null)}return e};e.resetDrawWatches=function(){this.drawControls.forEach(function(e){e.setStrokeColorWatch().setStrokeWidthWatch()})};e.clear=function(){const e=this;e.resetValues();e.layer.clearFeatures();e.modify.isActive&&e.modify.deactivate();if(e.options.displayElevation){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()}e._clearBtn.disabled=!0;e._downloadBtn.disabled=!0;return e};e.showSketchDownloadDialog=function(e){const t=this._dialogDiv.querySelector("."+this.CLASS+"-dialog"),o=($(t),this.layer.features.some(function(e){return TC.feature.Point&&e instanceof TC.feature.Point||TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint})),r=this.layer.features.some(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline}),n=this.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon}),i=t.querySelector("."+this.CLASS+"-dialog-ip");this._dialogDiv.querySelector(this._selectors.ELEVATION_CHECKBOX).checked&&(r||n)?i.classList.remove(TC.Consts.classes.HIDDEN):i.classList.add(TC.Consts.classes.HIDDEN);const a=t.querySelector("button[data-format=GPX]");r||o?a.classList.remove(TC.Consts.classes.HIDDEN):a.classList.add(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,e);return this};e.onStyleChange=function(e){const t=this;var o;switch(e.target.mode){case TC.Consts.geom.POLYGON:o=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:o=TC.feature.Polyline;break;case TC.Consts.geom.POINT:o=TC.feature.Point}o&&t.modify.getSelectedFeatures().forEach(function(t){if(t instanceof o){const o={};o[e.property]=e.value;t.setStyle(o)}})};e.displayElevationProfile=function(e){const t=this;1===e.length&&(e=e.slice()).push(e[0]);const n=t.map.getLoadingIndicator(),i=n&&n.addWait();t.elevation.getElevation({crs:t.map.crs,coordinates:e}).then(function(a){n&&n.removeWait(i);var s=0,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const u=a.map(function(e,t,o){const r=0===t?e:o[t-1],n=e[0]-r[0],i=e[1]-r[1];s+=Math.sqrt(n*n+i*i);var a=e[2];if("number"==typeof a){l=Math.max(a,l);c=Math.min(a,c)}return[s,a]});t.elevationProfileData={x:u.map(function(e){return e[0]}),ele:u.map(function(e){return e[1]}),coords:a};const h={coords:a};"object"==typeof t.options.displayElevation&&(h.hillDeltaThreshold=t.options.displayElevation.hillDeltaThreshold);$.extend(t.elevationProfileData,TC.tool.Elevation.getElevationGain(h));const d=t.layer.features.filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline}).filter(function(t){for(var o=0,r=t.geometry.length;o<r;o++){const r=e[o],n=t.geometry[o];if(!r||r[0]!==n[0]||r[1]!==n[1])return!1}return!0})[0];d&&function(e,t){var n=r(e);if(!n){n={feature:e};o.push(n)}n.data=t}(d,t.elevationProfileData);t.resultsPanelChart?t.renderElevationChart():t.createChartPanel().then(function(e){t.resultsPanelChart.renderPromise().then(function(){t.renderElevationChart()})})},function(e){t.resetElevationProfile();n&&n.removeWait(i)})};e.createChartPanel=function(){const t=this,o={id:t.getUID(),content:"chart",titles:{main:t.getLocaleString("geo.trk.chart.chpe"),max:t.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:t,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};return new Promise(function(e,r){var n;const i=function(e){o.side=e.SIDE.RIGHT;n=e.addControl("resultsPanel",o)};if(t.options.displayElevation.displayOn){var a=t.map.getControlsByClass("TC.control."+t.options.displayElevation.displayOn[0].toUpperCase()+t.options.displayElevation.displayOn.substring(1))[0];a?i(a):t.map.addControl(t.options.displayElevation.displayOn).then(i)}else{o.div=document.createElement("div");t.map.div.appendChild(o.div);n=t.map.addControl("resultsPanel",o)}n.then(function(o){o.caller=t;t.resultsPanelChart=o;t._decorateChartPanel();e(o)})})};e._decorateChartPanel=function(){this.resultsPanelChart.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1);t.currentFeature=e;e&&e.toggleSelectedStyle(!0)}};e.renderElevationChart=function(e){const t=this;t.elevationProfileData=e||t.elevationProfileData;if(t.resultsPanelChart&&t.elevationProfileActive){t.resultsPanelChart.openChart(t.elevationProfileData);t.resultsPanelChart.isMinimized()||t.resultsPanelChart.show()}};e.getElevationTooltip=function(e){this.resultsPanelChart.wrap.showElevationMarker({data:e,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};e.activateElevationProfile=function(){const e=this;e.elevationProfileActive=!0;e._elevProfileBtn.classList.add(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("deactivateElevationProfile"));var t=!1;if(e.drawLines.historyIndex>1){e.displayElevationProfile(e.drawLines.history.slice(0,e.drawLines.historyIndex));t=!0}else{const o=e.modify.getActiveFeatures().filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline});if(o.length){const r=o[o.length-1];e.displayElevationProfile(r.geometry);t=!0}}t||e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.show()};e.deactivateElevationProfile=function(){const e=this;e.elevationProfileActive=!1;e._elevProfileBtn.classList.remove(TC.Consts.classes.ACTIVE);e._elevProfileBtn.setAttribute("title",e.getLocaleString("activateElevationProfile"));e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.close()};e.resetElevationProfile=function(){const e=this;if(e.options.displayElevation&&e.resultsPanelChart){e.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};e.resultsPanelChart.openChart(e.elevationProfileData)}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var e=0,t=function(e,t){return new Promise(function(o,r){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var n,i;switch(!0){case t instanceof TC.feature.Polygon:i=TC.Consts.geom.POLYGON;break;case t instanceof TC.feature.Polyline:i=TC.Consts.geom.POLYLINE;break;case t instanceof TC.feature.Point:i=TC.Consts.geom.POINT;break;case t instanceof TC.feature.MultiPolygon:i=TC.Consts.geom.MULTIPOLYGON;break;case t instanceof TC.feature.MultiPolyline:i=TC.Consts.geom.MULTIPOLYLINE}n={id:t.id||t.provId,attributes:t.data,type:i,geometry:t.geometry};localforage.setItem(e,n).then(function(){o({feature:t})}).catch(function(e){r({feature:t,error:e})})})})},o=function(e){return new Promise(function(t,o){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(e).then(function(){t(e)}).catch(function(e){o(Error(e))})})})},r=function(e){return new Promise(function(t,o){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e).then(function(o){t({key:e,feature:o})}).catch(function(e){o(e)})})})},n=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+(t||e.layer.id)},i=function(e,t){return n(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},a=function(e,t){return n(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},s=function(e,t){return n(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},l=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t},c=function(e,t){e._deleteBtn.disabled=0===t.length;e._joinBtn.disabled=t.length<2;e._splitBtn.disabled=0===t.filter(l).length},u=function(e,t){e._saveBtn.disabled=t;e._discardBtn.disabled=t;self.checkedOut=!t},h=function(e,t){void 0!==t?u(e,!t):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var t=n(e);localforage.keys().then(function(o){if(o){for(var r=!0,n=0,i=o.length;n<i;n++)if(0===o[n].indexOf(t)){r=!1;break}u(e,r)}})})},d=function(e,t){return new Promise(function(o,r){var n=e._changesLayers[t.id];if(n)o(n);else{n=e._changesLayers[t.id]=new TC.layer.Vector({id:TC.getUID(),title:t.title+" - cambios pendientes",stealth:!0,styles:e.getChangesLayerStyle(t)});var i=e.map.layers.indexOf(t);e.map.insertLayer(n,i+1,function(){o(n)})}})};TC.control.Edit=function(){var r=this;TC.control.SWCacheClient.apply(this,arguments);r._classSelector="."+r.CLASS;r.wrap=new TC.wrap.control.Edit(r);r.layer=null;r.checkedOut=!1;r.callback=arguments[2]&&$.isFunction(arguments[2])?arguments[2]:r.options.callback?r.options.callback:null;r.multi=!!r.options.multi&&r.options.multi;r.eraseActionConfirmTxt=r.options.eraseText?r.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";r.cancelActionConfirmTxt=r.options.cancelText?r.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";r.styles=r.options.styles;r.features={};r.attributeEditor=null;r.pointDraw=null;r.lineDraw=null;r.polygonDraw=null;r.snapping="boolean"!=typeof r.options.snapping||r.options.snapping;r._changesLayers={};r._showsChanges="boolean"!=typeof r.options.showChanges||r.options.showChanges;$.isFunction(r.options.getChangesLayerStyleFunction)&&(r.getChangesLayerStyleFunction=r.getChangesLayerStyle);r.on(TC.Consts.event.FEATUREADD,function(o){var n=o.feature;n.provId="NewFeature."+e++;var a=r._changesLayers[r.layer.id];r.features[r.layer.id].added.push(n);a.addFeature(n);t(i(r)+n.provId,n).then(function(){h(r,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(e){var n=e.feature,l=n.provId||n.id,c=function(){h(r);TC.toast("Eliminaci\xf3n guardada")},u=function(){TC.error("Fallo al guardar eliminaci\xf3n")},d=r._changesLayers[r.layer.id],p=r.features[r.layer.id],f=p.added.indexOf(n);if(f<0){var g=s(r);if((f=p.modified.indexOf(n))<0){if((f=p.removed.indexOf(n))<0){p.removed.push(n);d.addFeature(n);t(g+n.id,n).then(c,u)}}else{p.modified.splice(f,1);p.removed.push(n);o(a(r)+n.id).then(function(){c();t(g+n.id,n).then(c,u)},u)}}else{d.removeFeature(n);p.added.splice(f,1);o(i(r)+l).then(c,u)}}).on(TC.Consts.event.FEATUREMODIFY,function(e){var o=e.feature,n=o.provId||o.id,s=function(){h(r,!0);TC.toast("Modificaci\xf3n guardada")},l=function(){TC.error("Fallo al guardar modificaci\xf3n")},c=r._changesLayers[r.layer.id],u=r.features[r.layer.id],d=u.added.indexOf(o);if(d<0){if((d=u.modified.indexOf(o))<0){c.addFeature(o);u.modified.push(o)}t(a(r)+n,o).then(s,l)}else t(i(r)+n,o).then(s,l)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(e){if(r.serviceWorkerEnabled&&navigator.onLine){var t=r.layer.wrap.getGetFeatureUrl(),o=r.layer.wrap.getDescribeFeatureTypeUrl();t&&o&&r.createCache(r.LOCAL_STORAGE_KEY_PREFIX+r.layer.id,{urlList:[t,o]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(e){}).on(TC.Consts.event.FEATURESSELECT,function(e){var t=r.getSelectedFeatures();c(r,t);t.length&&t[0].showPopup(r.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(e){c(r,r.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var p=TC.control.Edit.prototype;p.CLASS="tc-ctl-edit";p.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";p.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";p.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";p.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";p.template={};if(TC.isDebug){p.template[p.CLASS]=TC.apiLocation+"TC/templates/Edit.html";p.template[p.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{p.template[p.CLASS]=function(){dust.register(p.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"featureEdit"}).w('</h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",r,{},{$key:"selectLayerToEdit"}).w("</option>").s(r.get(["layers"],!1),r,{block:t},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(r.get(["showChanges"],!1),r,{block:o},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",r,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",r,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",r,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",r,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",r,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",r,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",r,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",r,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",r,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",r,{},{$key:"delete"}).w('">').h("i18n",r,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",r,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",r,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",r,{},{$key:"splitGeometry"}).w('">').h("i18n",r,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",r,{},{$key:"syncChanges"}).w('">').h("i18n",r,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",r,{},{$key:"discardChanges"}).w('">').h("i18n",r,{},{$key:"discardChanges"}).w("</button></div>")}e.__dustBody=!0;function t(e,t){return e.w('<option value="').f(t.get(["id"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}t.__dustBody=!0;function o(e,t){return e.w(" checked")}o.__dustBody=!0;return e};p.template[p.CLASS+"-attr"]=function(){dust.register(p.CLASS+"-attr",t);var e={inputText:P,inputNumber:R,inputCheckbox:M,inputDate:O,inputTime:N,inputDatetime:D};function t(t,r){r=r.shiftBlocks(e);return t.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",r,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(r.get(["data"],!1),r,{block:o},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",r,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}t.__dustBody=!0;function o(t,o){o=o.shiftBlocks(e);return t.w("<tr><th>").f(o.get(["name"],!1),o,"h").w("</th><td>").x(o.get(["readOnly"],!1),o,{else:r,block:F},{}).w("</td></tr>")}o.__dustBody=!0;function r(t,o){o=o.shiftBlocks(e);return t.x(o.get(["availableValues"],!1),o,{block:n},{}).h("select",o,{block:a},{key:o.get(["type"],!1)})}r.__dustBody=!0;function n(t,o){o=o.shiftBlocks(e);return t.w('<select class="tc-combo" name="').f(o.get(["name"],!1),o,"h").w('"><option value=""></option>').s(o.get(["availableValues"],!1),o,{block:i},{}).w("</select>")}n.__dustBody=!0;function i(t,o){o=o.shiftBlocks(e);return t.w('<option value="').f(o.getPath(!0,[]),o,"h").w('">').f(o.getPath(!0,[]),o,"h").w("</option>")}i.__dustBody=!0;function a(t,o){o=o.shiftBlocks(e);return t.h("none",o,{block:s},{}).h("eq",o,{block:l},{value:"int"}).h("eq",o,{block:c},{value:"integer"}).h("eq",o,{block:u},{value:"double"}).h("eq",o,{block:h},{value:"boolean"}).h("eq",o,{block:d},{value:"date"}).h("eq",o,{block:f},{value:"time"}).h("eq",o,{block:g},{value:"dateTime"}).h("eq",o,{block:m},{value:"byte"}).h("eq",o,{block:y},{value:"long"}).h("eq",o,{block:C},{value:"negativeInteger"}).h("eq",o,{block:v},{value:"nonNegativeInteger"}).h("eq",o,{block:T},{value:"nonPositiveInteger"}).h("eq",o,{block:_},{value:"positiveInteger"}).h("eq",o,{block:S},{value:"short"}).h("eq",o,{block:E},{value:"unsignedLong"}).h("eq",o,{block:L},{value:"unsignedInt"}).h("eq",o,{block:w},{value:"unsignedShort"}).h("eq",o,{block:b},{value:"unsignedByte"}).h("eq",o,{block:x},{value:"float"}).h("eq",o,{block:A},{value:"decimal"})}a.__dustBody=!0;function s(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputText"),o,{},{})}s.__dustBody=!0;function l(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}l.__dustBody=!0;function c(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}c.__dustBody=!0;function u(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}u.__dustBody=!0;function h(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputCheckbox"),o,{},{})}h.__dustBody=!0;function d(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputDate"),o,{},{})}d.__dustBody=!0;function f(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputTime"),o,{},{})}f.__dustBody=!0;function g(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputDatetime"),o,{},{})}g.__dustBody=!0;function m(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}m.__dustBody=!0;function y(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}y.__dustBody=!0;function C(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}C.__dustBody=!0;function v(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}v.__dustBody=!0;function T(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}T.__dustBody=!0;function _(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}_.__dustBody=!0;function S(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}S.__dustBody=!0;function E(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}E.__dustBody=!0;function L(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}L.__dustBody=!0;function w(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}w.__dustBody=!0;function b(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}b.__dustBody=!0;function x(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}x.__dustBody=!0;function A(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}A.__dustBody=!0;function P(t,o){o=o.shiftBlocks(e);return t.w('<input type="text" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}P.__dustBody=!0;function R(t,o){o=o.shiftBlocks(e);return t.w('<input type="number" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}R.__dustBody=!0;function M(t,o){o=o.shiftBlocks(e);return t.w('<input type="checkbox" name="').f(o.get(["name"],!1),o,"h").w('"').x(o.get(["value"],!1),o,{block:I},{}).w("/>")}M.__dustBody=!0;function I(t,o){o=o.shiftBlocks(e);return t.w(" checked")}I.__dustBody=!0;function O(t,o){o=o.shiftBlocks(e);return t.w('<input type="date" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}O.__dustBody=!0;function N(t,o){o=o.shiftBlocks(e);return t.w('<input type="time" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}N.__dustBody=!0;function D(t,o){o=o.shiftBlocks(e);return t.w('<input type="datetime" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}D.__dustBody=!0;function F(t,o){o=o.shiftBlocks(e);return t.f(o.get(["value"],!1),o,"h")}F.__dustBody=!0;return t}}p.register=function(t){var o=this;const l=TC.control.SWCacheClient.prototype.register.call(o,t),c=o.getUID(),u=o.getUID(),h=o.getUID();t.addControl("popup",{closeButton:!0}).then(function(e){o.attributeEditor=e});t.on(TC.Consts.event.LAYERUPDATE,function(t){const l=t.layer;if(l.type===TC.Consts.layerType.WFS&&!l.options.stealth){var c=o.features[l.id]=o.features[l.id]||{added:[],modified:[],removed:[]};d(o,l).then(function(t){o.layer!==l&&t.setVisibility(!1);var u=n(o,l.id),h=i(o,l.id),d=a(o,l.id),p=s(o,l.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(o){if(o)for(var n=0,i=o.length;n<i;n++){var a=o[n];0===a.indexOf(u)&&r(a).then(function(o){var r,n=o.key;if(0===n.indexOf(p)){r=n.substr(p.length);var i=l.getFeatureById(r);l.removeFeature(i);t.addFeature(i);c.removed.push(i)}else if(0===n.indexOf(d)){r=n.substr(d.length);if(i=l.getFeatureById(r)){t.addFeature(i);c.modified.push(i);i.wrap.setGeometry(o.feature.geometry);i.setData(o.feature.attributes)}}else if(0===n.indexOf(h)){r=n.substr(h.length);var a,s=parseInt(r.substr(r.lastIndexOf(".")+1));e=Math.max(e,s+1);switch(o.feature.type){case TC.Consts.geom.POINT:a=l.addPoint(o.feature.geometry);break;case TC.Consts.geom.POLYLINE:a=l.addPolyline(o.feature.geometry);break;case TC.Consts.geom.POLYGON:a=l.addPolygon(o.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:a=l.addMultiPolyline(o.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:a=l.addMultiPolygon(o.feature.geometry)}a.then(function(e){t.addFeature(e);c.added.push(e);e.provId=r;e.setData(o.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(e){const t=e.layer;if(t.type===TC.Consts.layerType.WFS&&!t.options.stealth){o.features[t.id]=o.features[t.id]||{added:[],modified:[],removed:[]};const e=document.createElement("option");e.setAttribute("value",t.id);e.innerHTML=t.title||t.id;o._layerSelect.appendChild(e)}}).on(TC.Consts.event.LAYERREMOVE,function(e){const t=e.layer;if(t.type===TC.Consts.layerType.WFS&&!t.options.stealth){var r=o._layerSelect.querySelector("option[value="+t.id+"]");r.selected&&o.setLayer(null);r.parentElement.removeChild(r)}}).on(TC.Consts.event.POPUP,function(e){if(e.control===o.attributeEditor){for(var t=e.control.currentFeature,r=o.attributes.slice(),n={},i=o._joinedFeatureAttributes||[],a=0,s=r.length;a<s;a++){var l=t.getData()||{},c=r[a];c.value=l[c.name];"id"===c.name&&(c.readOnly=!0);c.availableValues=[];for(var u=0,h=i.length;u<h;u++){var d=i[u][c.name];void 0!==d&&""!==d&&(c.availableValues[c.availableValues.length]=d)}n[c.name]=c.type}r.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});o.getRenderedHtml(o.CLASS+"-attr",{data:r},function(e){const r=o.attributeEditor.contentDiv;r.innerHTML=e;const i=r.querySelectorAll("input"),a=r.querySelectorAll("select");i.forEach(function(e){e.addEventListener("input",function(e){const t=e.target;for(var o=0,r=a.length;o<r;o++){const r=a[o];if(r.matches("[name="+e.target.getAttribute("name")+"]")&&r.value!==t.value){r.value="";break}}})});a.forEach(function(e){e.addEventListener("change",function(e){const t=e.target;for(var o=0,r=i.length;o<r;o++){const e=i[o];if(e.matches("[name="+t.getAttribute("name")+"]")){e.value=t.value;break}}})});r.querySelector("."+o.CLASS+"-btn-attr-ok").addEventListener("click",function(){var e={};i.forEach(function(t){var o=t.getAttribute("name"),r=t.value;switch(n[o]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":r=parseInt(r);Number.isNaN(r)||(e[o]=r);break;case"double":case"float":case"decimal":r=parseFloat(r);Number.isNaN(r)||(e[o]=r);break;case"date":case"time":case"dateTime":e[o]=new Date(r);break;case"boolean":e[o]=!!r;break;case void 0:break;default:e[o]=r}});t.setData(e);o.trigger(TC.Consts.event.FEATUREMODIFY,{feature:t,layer:o.layer});o.attributeEditor.hide()});r.querySelector("."+o.CLASS+"-btn-attr-cancel").addEventListener("click",function(){o.attributeEditor.hide()})})}});t.loaded(function(){if(o.options.layer)o.setLayer(o.options.layer);else{var e=t.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WFS&&!e.options.stealth});1===e.length?o.setLayer(e[0].id):o.setLayer(null)}o.showChanges(o._showsChanges);o.renderPromise().then(function(){Promise.all([t.addControl("draw",{id:c,div:o.div.querySelector("."+o.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),t.addControl("draw",{id:u,div:o.div.querySelector("."+o.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),t.addControl("draw",{id:h,div:o.div.querySelector("."+o.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(e){o.pointDraw=e[0];o.lineDraw=e[1];o.polygonDraw=e[2];var t=function(e){var t,r=e.feature;switch(o.geometryType){case TC.Consts.geom.POINT:t=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:t=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:t=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:t=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:t=TC.feature.MultiPolygon}t&&(r=new t(r.geometry,{geometryName:o.layer.options.geometryName}));o.layer.addFeature(r);o.trigger(TC.Consts.event.FEATUREADD,{feature:r})},r=function(){o.cancel()};o.pointDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);o.lineDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);o.polygonDraw.on(TC.Consts.event.DRAWEND,t).on(TC.Consts.event.DRAWCANCEL,r);o.options.modes&&$.isArray(o.options.modes)&&1==o.options.modes.length&&o.setMode(o.options.modes[0],null)})})});return l};p.render=function(e){var t=this,o=[];if(t.map)for(var r=0,n=t.map.workLayers.length;r<n;r++){var i=t.map.workLayers[r];i.type!==TC.Consts.layerType.WFS||i.options.stealth||o.push({id:i.id,title:i.title||i.id})}return t._set1stRenderPromise(TC.Control.prototype.renderData.call(t,{layers:o,showChanges:t.showChanges},function(){t._layerDiv=t.div.querySelector(t._classSelector+"-layer");t._layerSelect=t._layerDiv.querySelector(t._classSelector+"-layer-sel");t._layerSelect.addEventListener("change",function(e){t.setLayer(t._layerSelect.value)});t._layerDiv.querySelector("#"+t.CLASS+"-view-changes-cb").addEventListener("change",function(e){t.showChanges(e.target.checked)});t._cancelBtn=t.div.querySelector(t._classSelector+"-btn-cancel");t._cancelBtn.addEventListener("click",function(){t.cancel()});t._deleteBtn=t.div.querySelector(t._classSelector+"-btn-delete");t._deleteBtn.addEventListener("click",function(){TC.confirm(t.eraseActionConfirmTxt,function(){t.deleteFeatures(t.getSelectedFeatures())})});t._joinBtn=t.div.querySelector(t._classSelector+"-btn-join");t._joinBtn.addEventListener("click",function(){t.joinFeatures(t.getSelectedFeatures())});t._splitBtn=t.div.querySelector(t._classSelector+"-btn-split");t._splitBtn.addEventListener("click",function(){t.splitFeatures(t.getSelectedFeatures())});t._saveBtn=t.div.querySelector(t._classSelector+"-btn-save");t._saveBtn.addEventListener("click",function(){t.applyEdits()});t._discardBtn=t.div.querySelector(t._classSelector+"-btn-discard");t._discardBtn.addEventListener("click",function(){t.discardEdits()});if(t.options.modes&&$.isArray(t.options.modes)&&t.options.modes.length>0){for(var o in TC.Consts.editMode)if("string"==typeof o&&t.options.modes.indexOf(TC.Consts.editMode[o])<0){const e=t.div.querySelector("label"+t._classSelector+"-btn-"+TC.Consts.editMode[o]);e.parentElement.removeChild(e);const r=t.div.querySelector("div"+t._classSelector+"-"+TC.Consts.editMode[o]);r.parentElement.removeChild(r)}if(1===t.options.modes.length){var r=t.options.modes[0];t.div.querySelector("label"+t._classSelector+"-btn-"+r).style.display="none"}}t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.addEventListener("change",function(){var e=this.value,o=t.mode===e?void 0:e;t.setMode(o)})});$.isFunction(e)&&e()}))};p.setLayer=function(e){var t=this;t.layer=map.getLayer(e);t.setMode(null);if(t.layer){d(t,t.layer).then(function(e){for(var o in t._changesLayers){var r=t._changesLayers[o];r.setVisibility(t._showsChanges&&r===e)}});t.layer.describeFeatureType().then(function(e){t.attributes=e.filter(function(e){switch(e.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":t.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":t.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":t.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":t.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var o=0,r=t.attributes.length;o<r;o++){var n=t.attributes[o];n.type=n.type.substr(n.type.indexOf(":")+1)}t.renderPromise().then(function(){h(t);t.div.querySelector(t._classSelector+"-layer-sel").value=t.layer.id;const e=t.div.querySelectorAll("input[type=radio][name=mode]");var o;switch(t.geometryType){case TC.Consts.geom.POINT:o="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:o="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:o="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:o="[value]"}e.forEach(function(e){e.disabled=!e.matches(o)})})})}else{t.renderPromise().then(function(){h(t,!1);t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.disabled=!0;e.checked=!1})});t.layer=null}};p.setMode=function(e){var t=this;t.mode=e;!function(e){e._deleteBtn.disabled=!0;e._joinBtn.disabled=!0;e._splitBtn.disabled=!0}(t);var o,r,n=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};switch(e){case TC.Consts.editMode.SELECT:o=t.div.querySelector(t._classSelector+"-select");r=t.div.querySelectorAll(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.activate();break;case TC.Consts.editMode.ADDPOINT:o=t.div.querySelector(t._classSelector+"-point");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-line,"+t._classSelector+"-polygon");n(t.pointDraw);break;case TC.Consts.editMode.ADDLINE:o=t.div.querySelector(t._classSelector+"-line");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-polygon");n(t.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:o=t.div.querySelector(t._classSelector+"-polygon");r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line");n(t.polygonDraw);break;default:o=null;r=t.div.querySelectorAll(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.isActive&&t.deactivate();t.pointDraw&&t.pointDraw.isActive&&t.pointDraw.deactivate();t.lineDraw&&t.lineDraw.isActive&&t.lineDraw.deactivate();t.polygonDraw&&t.polygonDraw.isActive&&t.polygonDraw.deactivate()}if(e){const o=t.div.querySelector("input[type=radio][name=mode][value="+e+"]");o.checked=!0;o.classList.add(TC.Consts.classes.CHECKED);o.nextSibling.classList.add(TC.Consts.classes.CHECKED)}else t.div.querySelectorAll("input[type=radio][name=mode]").forEach(function(e){e.checked=!1;e.classList.remove(TC.Consts.classes.CHECKED);e.nextSibling.classList.remove(TC.Consts.classes.CHECKED)});o&&o.classList.remove(TC.Consts.classes.HIDDEN);r.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})};p.showChanges=function(e){this._showsChanges=e;for(var t in this._changesLayers){this._changesLayers[t].setVisibility(e&&this.layer&&t===this.layer.id)}};p.cancel=function(){this.options.modes&&$.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};p.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};p.activate=function(e){TC.Control.prototype.activate.call(this);var t=e||{};this._cancelBtn.disabled=!1;this.wrap.activate(t.mode?t.mode:this.mode);TC.Control.prototype.activate.call(this)};p.deactivate=function(){TC.Control.prototype.deactivate.call(this);this.wrap.cancel(!0);this._cancelBtn.disabled=!0;this.wrap.deactivate()};p.isExclusive=function(){return!0};p.joinFeatures=function(e){var t=this;if(t.geometryType===TC.Consts.geom.MULTIPOLYLINE||t.geometryType===TC.Consts.geom.MULTIPOLYGON||t.geometryType===TC.Consts.geom.MULTIPOINT){t._joinedFeatureAttributes=[];if(e.length>1){for(var o=e.map(function(e){t._joinedFeatureAttributes[t._joinedFeatureAttributes.length]=e.getData();return e.geometry}).reduce(function(e,t){return e.concat(t)}),r=new e[0].constructor(o),n=0,i=e.length;n<i;n++){var a=e[n];t.layer.removeFeature(a);t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:a})}t.layer.addFeature(r).then(function(e){t.setSelectedFeatures([r]);t.trigger(TC.Consts.event.FEATUREADD,{feature:e});e.showPopup(t.attributeEditor)})}c(t,[r])}};p.splitFeatures=function(e){for(var t=this,o=e.filter(l),r=o.map(function(e){return e.geometry}),n=[],i=0,a=o.length;i<a;i++)for(var s=(f=o[i]).getData(),u=r[i],h=0,d=u.length;h<d;h++)n[n.length]=new f.constructor([u[h]],{data:s});i=0;for(var p=o.length;i<p;i++){var f=o[i];t.layer.removeFeature(f);t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:f})}var g=new Array(n.length);for(i=0,p=n.length;i<p;i++){(g[i]=t.layer.addFeature(n[i])).then(function(e){t.trigger(TC.Consts.event.FEATUREADD,{feature:e})})}Promise.all(g).then(function(){t.setSelectedFeatures(n)});c(t,n)};p.deleteFeatures=function(e){this.wrap.deleteFeatures(e);0===this.layer.features.length&&(this._deleteBtn.disabled=!0)};p.applyEdits=function(){var e=this;if(e.layer){var t=e.features[e.layer.id];e.layer.applyEdits(t.added,t.modified,t.removed).then(function(){e.discardEdits();e.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(e){TC.error("Error ["+e.code+"] al guardar cambios: "+e.reason)})}};p.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=n(e);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(o){if(o){for(var r=0,n=o.length;r<n;r++){var i=o[r];0===i.indexOf(t)&&localforage.removeItem(i)}if(e.layer){var a=e.features[e.layer.id];a.added.length=0;a.modified.length=0;a.removed.length=0;e.setSelectedFeatures([]);e.attributeEditor.hide();e._changesLayers[e.layer.id].clearFeatures();e.deleteCache(t).then(function(){e.layer.refresh()})}h(e,!1)}})})};p.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};p.setSelectedFeatures=function(e){return this.wrap.setSelectedFeatures(e)};p.getLayer=function(){return this.layer};p.getChangesLayerStyle=function(e){var t=function(t){for(var o,r=e.wrap.getRGBA(t),n=0;n<3;n++)r[n]=255-r[n];4===(o=(65536*r[0]+256*r[1]+r[2]).toString(16)).length?o="00"+o:5===o.length&&(o="0"+o);return"#"+o},o=[1,3],r=$.extend(!0,{},e.options.styles);if(r.point){r.point.strokeColor=t(r.point.strokeColor);r.point.lineDash=o}if(r.line){r.line.strokeColor=t(r.line.strokeColor);r.line.lineDash=o}if(r.polygon){r.polygon.strokeColor=t(r.polygon.strokeColor);r.polygon.lineDash=o}return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection="boolean"!=typeof this.options.allowReprojection||this.options.allowReprojection}};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){const t=e[0];t.disabled=!0;t.classList.add("tc-ctl-xwms-option-selected")}};e.register=function(e){if(TC.isLegacy){console.warn("El control ExternalWMS no soporta modo legacy");return}const t=this,o=TC.Control.prototype.register.call(t,e);t.div.addEventListener("change",TC.EventTarget.listenerBySelector("select",function(e){if(""!==e.target.value){var o=e.target.value;0===o.indexOf("//")&&(o=location.protocol+o);t.div.querySelector("input").value=o;e.target.value=""}}));t.div.addEventListener("click",TC.EventTarget.listenerBySelector('button[name="agregar"]',function(e){var o=t.div.querySelector("input").value.trim();if(o)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(o))if(t._addedUrls.some(function(e){return e.replace(/https?:\/\/|\/\//,"")===o.replace(/https?:\/\/|\/\//,"")}))TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{var r=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var n=TC.Util.getQueryStringParams(o);/https?:\/\/|\/\//i.test(o)||(o="//"+o);var i=["version","service","request"],a=function(e,t){for(var o=0;o<t.length;o++)e=TC.Util.removeURLParameter(e,t[o]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e}(o,Object.keys(n));for(var s in n)i.indexOf(s.toLowerCase())>=0&&delete n[s];const e=t.div.querySelector("button");e.disabled=!0;for(var l={id:"xwms"+ ++t.count,type:"WMS",url:a,hideTree:!1,queryParams:n},c=0;c<t.options.suggestions.length;c++){var u=$.grep(t.options.suggestions[c].items,function(e,t){return e.url===o});if(u.length>0&&u[0].layerNames){l.layerNames=u[0].layerNames;break}}var h=new TC.layer.Raster(l);h.getCapabilitiesPromise().then(function(n){if(void 0!==n.Capability){var i=n.Capability.Layer;if(i.CRS&&-1==i.CRS.indexOf(t.map.crs)&&!t.allowReprojection){TC.alert(t.getLocaleString("serviceSrsNotCompatible"));r.hide();e.disabled=!1;return}t.map.trigger(TC.Consts.event.EXTERNALSERVICEADDED,{layer:h});t.div.querySelector("input").value="";const a=[];t.div.querySelectorAll("select option").forEach(function(e){e.value.replace(/https?:\/\/|\/\//,"")===o.replace(/https?:\/\/|\/\//,"")&&a.push(e)});t.markServicesAsSelected(a);t._addedUrls.push(o);r.hide();e.disabled=!1}else{TC.alert(t.getLocaleString("noLayersFoundInService"));r.hide();e.disabled=!1}},function(o){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+o);r.hide();e.disabled=!1})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))}));e.on(TC.Consts.event.LAYERADD,function(e){const o=e.layer;if(o&&!o.isBase){var r=o.url;if(r){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];0===t.div.querySelectorAll("select option").length&&r&&-1===t.pending_markServicesAsSelected.indexOf(r)&&t.pending_markServicesAsSelected.push(r);const e=[];t.div.querySelectorAll("select option").forEach(function(t){t.value.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")&&e.push(t)});t.markServicesAsSelected(e);t._addedUrls.push(r)}}});return o};e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/ExternalWMS.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.x(t.get(["title"],!1),t,{block:o},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(t.get(["suggestions"],!1),t,{block:r},{}).w('</select><input type="url" class="tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",t,{},{$key:"addService"}).w("</button></div></div>")}t.__dustBody=!0;function o(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"addMaps"}).w("</h2>")}o.__dustBody=!0;function r(e,t){return e.x(t.get(["group"],!1),t,{block:n},{}).s(t.get(["items"],!1),t,{block:i},{}).x(t.get(["group"],!1),t,{block:a},{})}r.__dustBody=!0;function n(e,t){return e.w('<optgroup label="').f(t.get(["group"],!1),t,"h").w('">')}n.__dustBody=!0;function i(e,t){return e.w('<option value="').f(t.get(["url"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w("</option>")}i.__dustBody=!0;function a(e,t){return e.w("\t</optgroup>")}a.__dustBody=!0;return t};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(t.options,function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];t.pending_markServicesAsSelected.forEach(function(e){const o=[];t.div.querySelectorAll("select option").forEach(function(t){TC.Util.addProtocol(t.value)===TC.Util.addProtocol(e)&&o.push(t)});t.markServicesAsSelected(o);t._addedUrls.push(e)});t.pending_markServicesAsSelected=[]}))}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.FeatureInfo(e);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";e.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.FeatureInfo.prototype,t=function e(t,o){var r;if($.isArray(t))for(var n=0,i=(r=t.slice()).length;n<i;n++)r[n]=e(r[n]);else r="number"==typeof t?Math.round(t.toFixed(o)):t;return r};e.register=function(e){const t=TC.control.FeatureInfoCommons.prototype.register.call(this,e);document.createElement("div").appendChild(this.div);return t};e.callback=function(e,t){var o=this;if(o.elevation){o.querying=!0;o.elevationRequest=o.elevation.getElevation({crs:o.map.crs,coordinates:e})}if(o.map&&o.filterLayer){var r=o.getLocaleString("featureInfo"),n=$.extend({},o.map.options.styles.marker,o.markerStyle,{title:r,set:r,showsPopup:!1});o.filterLayer.clearFeatures();o.filterLayer.addMarker(e,n).then(function(t){o.map.putLayerOnTop(o.filterLayer);o.filterFeature=t;for(var r=!1,n=0;n<o.map.workLayers.length;n++){var i=o.map.workLayers[n];if(i.type===TC.Consts.layerType.WMS&&i.getVisibility()&&i.names.length>0){r=!0;break}}var a=o.map.getResolution();r?o.wrap.getFeatureInfo(e,a):setTimeout(function(){o.responseCallback({coords:e})})})}};e.responseCallback=function(e){var o=this;const r=function(r){TC.control.FeatureInfoCommons.prototype.responseCallback.call(o,e);if(o.filterFeature){var n=e.services;if(n)for(var i=0;i<n.length;i++){for(var a=n[i],s=0;s<a.layers.length;s++)if(!a.layers[s].features.length){a.layers.splice(s,1);s-=1}if(!a.layers.length){n.splice(i,1);i-=1}}o.info.defaultFeature=e.defaultFeature;var l=o.map.options.locale||TC.Cfg.locale;e.isGeo=o.map.wrap.isGeo();if(r.length){const t=r[0][2];e.elevation=null===t?null:TC.Util.formatNumber(Math.round(t),l)}if(e.coords){e.crs=o.map.crs;e.coords=e.coords.map(function(t){return TC.Util.formatNumber(t.toFixed(e.isGeo?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),l)})}if(n&&n.length||null!==e.elevation)o.renderData(e,function(){o.insertLinks();if(o.sharedFeatureInfo){o.div.querySelectorAll("ul."+o.CLASS+"-services li").forEach(function(e){e.classList.add(TC.Consts.classes.CHECKED)});for(var e,r=o.sharedFeatureInfo,n=0,i=o.info.services.length;n<i;n++){var a=o.info.services[n];if(a.mapLayers.some(function(e){return e.url===r.s})){for(var s=0,l=a.layers.length;s<l;s++){var c=a.layers[s];if(c.name===r.l){for(var u=0,h=c.features.length;u<h;u++){var d=c.features[u];if(d.id===r.f){e=d;var p=hex_md5(JSON.stringify({data:d.getData(),geometry:t(d.geometry,TC.Consts.DEGREE_PRECISION)}));r.h!==p&&TC.alert(o.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}if(e){o.highlightedFeature=e;o.map.addLayer({id:o.getUID(),type:TC.Consts.layerType.VECTOR,title:o.getLocaleString("foi"),stealth:!0}).then(function(t){o.sharedFeatureLayer=t;o.filterLayer.clearFeatures();t.addFeature(e);o.map.zoomToFeatures([e])})}delete o.sharedFeatureInfo}else o.displayResults()});else{o.resultsLayer.clearFeatures();o.filterLayer.clearFeatures()}}};o.elevationRequest?o.elevationRequest.then(r):r([])};e.loadSharedFeature=function(e){const t=this;if(e){if(0===jQuery.grep(t.map.workLayers,function(t,o){return t.type===TC.Consts.layerType.WMS&&t.url===e.s&&t.getDisgregatedLayerNames().indexOf(e.l)>=0}).length){TC.error(t.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST);return}t.sharedFeatureInfo=e;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){const o=[-100,-100];t.beforeRequest({xy:o});t.filterLayer.clearFeatures();t.filterLayer.addMarker(o).then(function(o){t.filterFeature=o;t.wrap.getFeatureInfo(e.xy,e.r,{serviceUrl:e.s,layerName:e.l,featureId:e.f})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.control.FeatureTools=function(){const e=this;TC.Control.apply(e,arguments);e.layer=null;e.exportsState=!0;const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:t+"-dialog-ip-m"};e.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)});e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);e._$dialogDiv=$(e._dialogDiv);e.options.dialogDiv||document.body.appendChild(e._dialogDiv)};TC.inherit(TC.control.FeatureTools,TC.Control);!function(){var e=TC.control.FeatureTools.prototype;e.CLASS="tc-ctl-ftools";e.TITLE_SEPARATOR=" \u2022 ";e.FILE_TITLE_SEPARATOR="__";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureTools.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureToolsDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ftools"><button class="tc-ctl-ftools-dl-btn" title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w('</button><button class="tc-ctl-ftools-share-btn" title="').h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"share"}).w('</button><button class="tc-ctl-ftools-zoom-btn" title="').h("i18n",t,{},{$key:"zoomToFeature"}).w('">').h("i18n",t,{},{$key:"zoomToFeature"}).w('</button><button class="tc-ctl-ftools-del-btn" title="').h("i18n",t,{},{$key:"deleteFeature"}).w('">').h("i18n",t,{},{$key:"deleteFeature"}).w("</button></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-ftools-dialog tc-ctl-ftools-dl-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w(" - ").h("i18n",t,{},{$key:"download"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body">').s(t.get(["elevation"],!1),t,{block:o},{}).w('<div class="tc-ctl-ftools-dialog-dl"><div><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-ftools-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div></div><div class="tc-ctl-ftools-dialog tc-ctl-ftools-share-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w(" - ").h("i18n",t,{},{$key:"share"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-ftools-share-dialog-ctl"></div></div></div></div>')}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-ftools-dialog-elev"><input id="').f(t.get(["checkboxId"],!1),t,"h").w('" type="checkbox"><label for="').f(t.get(["checkboxId"],!1),t,"h").w('" class="tc-ctl-ftools-dialog-elev-label">').h("i18n",t,{},{$key:"includeElevations"}).w("</label></div>").x(t.get(["resolution"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-ftools-dialog-ip tc-hidden"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="finfo-ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="finfo-ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-ftools-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["resolution"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w("</div></div>")}r.__dustBody=!0;return t}}e.register=function(e){const t=this;e.on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){t.currentDisplay=e.control;if(t.currentDisplay.caller||!t.currentDisplay.caller&&t.currentDisplay.currentFeature){t.highlightedFeature=t.currentDisplay.caller||!t.currentDisplay.currentFeature?t.currentDisplay.caller.highlightedFeature:t.currentDisplay.currentFeature;t.highlightedFeature&&(t.highlightedFeature.showsPopup=!0);t.addUI(t.currentDisplay)}}).on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){t.currentDisplay=null}).on(TC.Consts.event.FEATUREADD,function(e){const o=e.feature;if(t.currentDisplay&&t.currentDisplay.caller&&o===t.currentDisplay.caller.highlightedFeature){t.highlightedFeature=o;t.highlightedFeature.showsPopup=!0}}).on(TC.Consts.event.FEATUREREMOVE,function(o){const r=o.feature;if(r===t.highlightedFeature){const o=r.clone();o.showsPopup=!0;e.getControlsByClass("TC.control.Popup").concat(e.getControlsByClass("TC.control.ResultsPanel")).forEach(function(e){e.currentFeature===t.highlightedFeature&&(e.currentFeature=o)});t.getHighlightLayer().then(function(e){e.addFeature(o)})}});return new Promise(function(o,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){t.map.addControl("share",{id:t.getUID(),div:t._dialogDiv.querySelector(".tc-modal-body ."+t.CLASS+"-share-dialog-ctl"),includeControls:!1}).then(function(e){t._shareCtl=e;o(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})})};e.render=function(e){const o=this;return o._set1stRenderPromise(o.getRenderedHtml(o.CLASS+"-dialog",{checkboxId:o.getUID(),elevation:o.options.displayElevation},function(r){o._dialogDiv.innerHTML=r;o._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(e){TC.Util.closeModal();const r=o.map.getLoadingIndicator(),n=r&&r.addWait(),i={};if(o._dialogDiv.querySelector(o._selectors.ELEVATION_CHECKBOX)&&o._dialogDiv.querySelector(o._selectors.ELEVATION_CHECKBOX).checked){const e="1"===o._dialogDiv.querySelector(o._selectors.INTERPOLATION_RADIO+":checked").value;i.elevation={resolution:e?parseFloat(o._dialogDiv.querySelector(o._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||o.options.displayElevation.resolution:0}}t(o,i).then(function(t){o.map.exportFeatures([t],{fileName:o._getFeatureFilename(t),format:e.target.dataset.format})},function(e){e!==TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.error(o.getLocaleString("elevation.error")):TC.alert(o.getLocaleString("tooManyCoordinatesForElevation.warning"))}).finally(function(){r&&r.removeWait(n)})}));o._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(o._selectors.ELEVATION_CHECKBOX,function(e){o.showDownloadDialog()}));o._dialogDiv.addEventListener("change",TC.EventTarget.listenerBySelector(o._selectors.INTERPOLATION_RADIO,function(e){const t=o._dialogDiv.querySelector(o._selectors.INTERPOLATION_DISTANCE);"0"===e.target.value?t.classList.add(TC.Consts.classes.HIDDEN):t.classList.remove(TC.Consts.classes.HIDDEN)}));o.trigger(TC.Consts.event.CONTROLRENDER);$.isFunction(e)&&e()}))};e.addUI=function(e){const t=this,o=e.getMenuElement(),r=function(){return o&&!o.querySelector("."+t.CLASS)};r()?t.getRenderedHtml(t.CLASS,null,function(n){if(r()){const r=(new DOMParser).parseFromString(n,"text/html").body.firstChild;o.appendChild(r);t.updateUI(e);if(!t.map.options.stateful){const e=r.querySelector("."+t.CLASS+"-share-btn");e.parentElement.removeChild(e)}t._setToolButtonHandlers(r);t._decorateDisplay(e.getContainerElement())}}):t.updateUI(e)};e._decorateDisplay=function(e){const t=this;if(t.highlightedFeature){if(e.querySelector("table.tc-attr")){e.querySelector("table.tc-attr").addEventListener(TC.Consts.event.CLICK,function(e){t.zoomToCurrentFeature()});e.querySelector("table.tc-attr").classList.add(t.CLASS+"-zoom");e.querySelector("table.tc-attr").setAttribute("title",t.getLocaleString("clickToCenter"))}TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){var o="";if(t.highlightedFeature){o=t.highlightedFeature.id;!0===t.highlightedFeature.showsPopup&&new TC.control.Print({target:e,title:o})}})}};e.updateUI=function(e){const t=this,o=e.getMenuElement().querySelector("."+t.CLASS);o.classList.remove(TC.Consts.classes.ACTIVE);clearTimeout(t._uiUpdateTimeout);t._uiUpdateTimeout=setTimeout(function(){const e=t.getCurrentFeature();e&&e.showsPopup?o.classList.add(TC.Consts.classes.ACTIVE):o.classList.remove(TC.Consts.classes.ACTIVE)},100)};e._setToolButtonHandlers=function(e){const t=this;e.querySelector("."+t.CLASS+"-dl-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.showDownloadDialog()});t.map.options.stateful&&e.querySelector("."+t.CLASS+"-share-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.showShareDialog()});e.querySelector("."+t.CLASS+"-zoom-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.zoomToCurrentFeature()});e.querySelector("."+t.CLASS+"-del-btn").addEventListener(TC.Consts.event.CLICK,function(e){t.removeCurrentFeature()})};e.getHighlightLayer=function(){const e=this;return new Promise(function(t,o){e.layer?t(e.layer):e.map.addLayer({id:e.getUID(),title:e.CLASS+": Highlighted features layer",type:TC.Consts.layerType.VECTOR,stealth:!0}).then(function(o){e.layer||(e.layer=o);t(e.layer)})})};e.showDownloadDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-dialog"),o=e.getCurrentFeature(),r=(TC.feature.Point&&o instanceof TC.feature.Point||TC.feature.MultiPoint&&TC.feature.MultiPoint,TC.feature.Polyline&&o instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&o instanceof TC.feature.MultiPolyline),n=TC.feature.Polygon&&o instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&o instanceof TC.feature.MultiPolygon,i=t.querySelector("."+e.CLASS+"-dialog-ip");i&&(e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX)&&!e._dialogDiv.querySelector(e._selectors.ELEVATION_CHECKBOX).checked||!r&&!n?i.classList.add(TC.Consts.classes.HIDDEN):i.classList.remove(TC.Consts.classes.HIDDEN));const a=t.querySelector("button[data-format=GPX]");n?a.classList.add(TC.Consts.classes.HIDDEN):a.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(e._dialogDiv.querySelector("."+e.CLASS+"-dl-dialog"))};e.showShareDialog=function(){const e=this;TC.Util.showModal(e._dialogDiv.querySelector("."+e.CLASS+"-share-dialog"),{openCallback:function(){e.onShowShareDialog()},closeCallback:function(){e._shareCtl.featureToShare=null}})};e.getCurrentFeature=function(){return this.currentDisplay&&(this.currentDisplay.caller&&this.currentDisplay.caller.highlightedFeature||this.currentDisplay.currentFeature)};e.zoomToCurrentFeature=function(){const e=this;e.map&&e.map.zoomToFeatures([e.getCurrentFeature()],{animate:!0})};e.removeCurrentFeature=function(){const e=this,t=e.getCurrentFeature(),o=function(){e.highlightedFeature=null;t&&t.layer&&t.layer.removeFeature(t)},r=function(){e.currentDisplay&&(e.currentDisplay.close?e.currentDisplay.close():e.currentDisplay.hide())};if(e.currentDisplay&&e.currentDisplay.caller&&e.currentDisplay.caller.highlightedFeature===t||t.layer===e.layer){o();r()}else TC.confirm(e.getLocaleString("deleteFeature.confirm"),function(){o();r()})};const t=function(e,t){t=t||{};return new Promise(function(o,r){const n=e.getCurrentFeature();if(n){const a=n.clone();a.setId(n.id);a.layer=n.layer;if(t.elevation){var i=!0;!t.elevation.resolution&&a.getGeometryStride()>2&&(i=!1);if(i){const n={crs:e.map.crs,features:[a],maxCoordQuantity:e.options.displayElevation&&e.options.displayElevation.maxCoordQuantity,resolution:t.elevation.resolution,sampleNumber:0};e.elevation.setGeometry(n).then(function(e){o(e[0])},function(e){r(Error(e))})}else o(a)}else{const e=a.getCoordsArray(),t=e[0];if(t&&t.length>2){e.forEach(function(e){e.length=2});a.setCoords(a.geometry)}o(a)}}else o(null)})};e.onShowShareDialog=function(){const e=this._shareCtl;e.extraParams=null;t(this).then(function(t){e.featureToShare=t;const o=e.div,r=e.generateLink();o.querySelector(".tc-url input[type=text]").value=r;o.querySelector(".tc-iframe input[type=text]").value=e.generateIframe(r)})};e.getFeatureTitle=function(e){var t="";e&&(t=e.id);return t};e._getFeatureFilename=function(e){return(this.getFeatureTitle(e).toString().replace(new RegExp(this.TITLE_SEPARATOR,"g"),this.FILE_TITLE_SEPARATOR)||this.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){const t=this;e.layer&&t.getHighlightLayer().then(function(t){t.importState(e.layer)})}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){TC.Control.apply(this,arguments);$.isArray(this.options.formats)?this.formats=this.options.formats:this.formats=[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];this.layers=[];this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[];this.exportsState=!0};TC.inherit(TC.control.FileImport,TC.Control);!function(){var e=TC.control.FileImport.prototype;e.CLASS="tc-ctl-file";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FileImport.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",t,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(t.get(["formats"],!1),t,{block:o},{}).w('" />').h("i18n",t,{},{$key:"openFile"}).w("</label></div></div>")}t.__dustBody=!0;function o(e,t){return e.w(".").f(t.getPath(!0,[]),t,"h").h("sep",t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w(",")}r.__dustBody=!0;return t};e.register=function(e){var t=this;const o=TC.Control.prototype.register.call(t,e);t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options);e.on(TC.Consts.event.FEATURESIMPORT,function(o){const r=o.fileName,n=o.dropTarget,i=o.features;var a="."+TC.Consts.format.GPX.toLowerCase();r.toLowerCase().indexOf(a)===r.length-a.length||n!==t.map.div&&n!==t||e.addLayer({id:t.getUID(),title:r,type:TC.Consts.layerType.VECTOR}).then(function(o){t.layers.push(o);const r=function(e,t){return e.concat(t)};for(var n=function(e){var o=e.geometry;if(o){var n;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:n=[o];break;case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:case TC.feature.Polyline&&e instanceof TC.feature.Polyline:n=o;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:case TC.feature.Polygon&&e instanceof TC.feature.Polygon:n=o.reduce(r);break;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:n=o.reduce(r).reduce(r)}n.every(function(e){return Math.abs(e[0])<=180&&Math.abs(e[1])<=90})&&e.setCoords(TC.Util.reproject(o,"EPSG:4326",t.map.crs))}return e},a=0,s=i.length;a<s;a++){var l=n(i[a]);o.addFeature(l)}setTimeout(function(){e.zoomToFeatures(o.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(e){var o,r=e.file.name;o=".kmz"===r.toLowerCase().substr(r.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(t.getLocaleString(o,{fileName:r}),TC.Consts.msgErrorMode.TOAST);var n=new FileReader;n.onload=function(e){TC.error("Nombre del archivo: "+r+" \n Contenido del archivo: \n\n"+e.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};n.readAsText(e.file)}).on(TC.Consts.event.FEATUREREMOVE,function(e){const o=e.layer;t.layers.indexOf(o)>=0&&(o.features.length||t.map.removeLayer(o))}).on(TC.Consts.event.LAYERREMOVE,function(e){const o=t.layers.indexOf(e.layer);o>=0&&t.layers.splice(o,1)});return o};e.render=function(){const e=this;return e._set1stRenderPromise(e.renderData({formats:e.formats},function(){const t=e.div.querySelector("input[type=file]");t.addEventListener(TC.Consts.event.CLICK,function(e){const t=document.createElement("form"),o=this.parentElement;o.insertBefore(t,this);t.appendChild(this);t.reset();t.insertAdjacentElement("afterend",this);o.removeChild(t)});t.addEventListener("change",function(t){if(e.map){console.log("salta el change");e.map.wrap.loadFiles(t.target.files,{control:e})}})}))};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,layers:e.layers.map(function(e){return{title:e.title,state:e.exportState()}})}:null};e.importState=function(e){const t=this;if(t.map){const o=[];e.layers.forEach(function(e){o.push(t.map.addLayer({id:t.getUID(),title:e.title,type:TC.Consts.layerType.VECTOR}))});Promise.all(o).then(function(o){for(var r=0,n=o.length;r<n;r++){const n=o[r];n.importState(e.layers[r].state);t.layers.push(n)}})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){TC.Control.apply(this,arguments);this.fullScreenElement=document.documentElement};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var e=TC.control.FullScreen.prototype;e.CLASS="tc-ctl-fscreen";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FullScreen.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",t,{},{$key:"fscreen.tip"}).w('"></button>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);o.then(function(){const e=t.div.querySelector("."+t.CLASS+"-btn");if(t.enabledFullScreen()){e.addEventListener(TC.Consts.event.CLICK,function(){t.toggleFullScreen()});const o=function(){t.isFullScreen()?e.classList.add(TC.Consts.classes.ACTIVE):e.classList.remove(TC.Consts.classes.ACTIVE);e.setAttribute("title",t.isFullScreen()?t.getLocaleString("fscreen.tip.return"):t.getLocaleString("fscreen.tip"))};document.addEventListener("fullscreenchange",o);document.addEventListener("mozfullscreenchange",o);document.addEventListener("webkitfullscreenchange",o);document.addEventListener("MSFullscreenChange",o)}else t.disable()});return o};e.requestFullScreen=function(){var e=this.fullScreenElement;document.documentElement.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()};e.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};e.isFullScreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.toggleFullScreen=function(){this.isFullScreen()?this.cancelFullScreen():this.requestFullScreen()};e.enabledFullScreen=function(){var e=this.fullScreenElement,t=document.documentElement.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;return t&&"function"==typeof t}}();Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,o=0;o<t;o++){if(arguments[o]===1/0||arguments[o]===-1/0)return 1/0;e+=arguments[o]*arguments[o]}return Math.sqrt(e)};!function(){for(var e=0,t=["ms","moz","webkit","o"],o=!(!window.performance||!window.performance.now),r=0,n=t.length;r<n&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var r=(new Date).getTime(),n=Math.max(0,16-(r-e)),i=window.setTimeout(function(){t(r+n)},n);e=r+n;return i});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!o){var i=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(e,t){i(function(t){return e(t<1e12?t:t-a)},t)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(e){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv);this.delta=500;this.walkingSpeed=5e3;this.gapHill=this.options.gapHill||20;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var e=TC.control.Geolocation.prototype;e.CLASS="tc-ctl-geolocation";e.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:300,MEDIUM_WIDTH:310,MAX_WIDTH:445};e.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";e.template[e.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";e.template[e.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";e.template[e.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div> \x3c!-- img se insertan en el div del mapa--\x3e <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;"></div> <div class="tc-ctl-geolocation-track-panel-block" ><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",t,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",t,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" checked value="tracks" /><span>').h("i18n",t,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",t,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",t,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",t,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",t,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",t,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",t,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",t,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel"> <div class="tc-alert alert-warning tc-hidden" ><p id="panel-msg">').h("i18n",t,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",t,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",t,{},{$key:"geo.trk.render"}).w('">').h("i18n",t,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",t,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",t,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",t,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><div class="tc-ctl-geolocation-track-center tc-hidden"><button title="').h("i18n",t,{},{$key:"geo.trk.center"}).w('"></button></div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-node"]=function(){dust.register(e.CLASS+"-track-node",t);function t(e,t){return e.w('<li data-id="').f(t.get(["id"],!1),t,"h").w('" data-uid="').f(t.get(["uid"],!1),t,"h").w('"><span class="tc-draw tc-selectable" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",t,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",t,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",t,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",t,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",t,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",t,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",t,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",t,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-snapping-node"]=function(){dust.register(e.CLASS+"-track-snapping-node",t);function t(e,t){return e.w("<ul>").x(t.get(["n"],!1),t,{block:o},{}).w("<li> <span>").x(t.get(["isGeo"],!1),t,{else:r,block:n},{}).w(":</span> ").f(t.get(["x"],!1),t,"h").w("</li><li> <span>").x(t.get(["isGeo"],!1),t,{else:i,block:a},{}).w(":</span> ").f(t.get(["y"],!1),t,"h").w(" </li>").x(t.get(["z"],!1),t,{block:s},{}).x(t.get(["m"],!1),t,{block:c},{}).w("</ul>")}t.__dustBody=!0;function o(e,t){return e.w("<li><span>").h("i18n",t,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(t.get(["n"],!1),t,"h").w("</li>")}o.__dustBody=!0;function r(e,t){return e.w("X")}r.__dustBody=!0;function n(e,t){return e.h("i18n",t,{},{$key:"lon"})}n.__dustBody=!0;function i(e,t){return e.w("Y")}i.__dustBody=!0;function a(e,t){return e.h("i18n",t,{},{$key:"lat"})}a.__dustBody=!0;function s(e,t){return e.h("ne",t,{block:l},{key:t.get(["z"],!1),value:0})}s.__dustBody=!0;function l(e,t){return e.w("<li> <span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" </li>")}l.__dustBody=!0;function c(e,t){return e.w("<li> ").f(t.get(["m"],!1),t,"h").w(" </li>")}c.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.gps"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",t,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",t,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",t,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",t,{},{$key:"ok"}).w(" </button></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-tracking-toast"]=function(){dust.register(e.CLASS+"-tracking-toast",t);function t(e,t){return e.w('<table class="tc-ctl-geolocation-info-tracking"><tr><th>').x(t.get(["isGeo"],!1),t,{else:o,block:r},{}).w(":</th><td> ").f(t.get(["x"],!1),t,"h").w(" </td>").x(t.get(["accuracy"],!1),t,{block:n},{}).w("</tr><tr><th>").x(t.get(["isGeo"],!1),t,{else:i,block:a},{}).w(":</th><td> ").f(t.get(["y"],!1),t,"h").w(" </td>").x(t.get(["speed"],!1),t,{block:s},{}).w("</tr><tr>").x(t.get(["z"],!1),t,{block:l},{}).x(t.get(["mdt"],!1),t,{block:h},{}).w("</tr> </table>")}t.__dustBody=!0;function o(e,t){return e.w("X")}o.__dustBody=!0;function r(e,t){return e.h("i18n",t,{},{$key:"lon"})}r.__dustBody=!0;function n(e,t){return e.w("<th>").h("i18n",t,{},{$key:"geo.trk.accuracy"}).w(":</th><td> ").f(t.get(["accuracy"],!1),t,"h").w(" m </td>")}n.__dustBody=!0;function i(e,t){return e.w("Y")}i.__dustBody=!0;function a(e,t){return e.h("i18n",t,{},{$key:"lat"})}a.__dustBody=!0;function s(e,t){return e.w("<th>").h("i18n",t,{},{$key:"geo.trk.speed"}).w(":</th><td>").f(t.get(["speed"],!1),t,"h").w(" km/h</td>")}s.__dustBody=!0;function l(e,t){return e.w("<th>").x(t.get(["isGeo"],!1),t,{else:c,block:u},{}).w(":</th><td> ").f(t.get(["z"],!1),t,"h").w(" m </td>")}l.__dustBody=!0;function c(e,t){return e.w("Z")}c.__dustBody=!0;function u(e,t){return e.h("i18n",t,{},{$key:"ele"})}u.__dustBody=!0;function h(e,t){return e.w('<th title="').h("i18n",t,{},{$key:" mdt.title"}).w('">').h("i18n",t,{},{$key:"ele"}).w(" (").h("i18n",t,{},{$key:"mdt"}).w("):</th><td>").f(t.get(["mdt"],!1),t,"h").w(" m </td>")}h.__dustBody=!0;return t}}e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.wrap=new TC.wrap.control.Geolocation(t);t.wrap.register(e);e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"}).then(function(e){t.layerGPS=e});e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(e){t.layerTracking=e});e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(e){var t=e.getData().name;return t&&(t+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}}}}).then(function(e){t.layerTrack=e});e.on(TC.Consts.event.FEATURESIMPORT,function(e){const t=this,o=e.fileName,r=e.dropTarget;var n="."+TC.Consts.format.KML.toLowerCase(),i="."+TC.Consts.format.GPX.toLowerCase();if(o.toLowerCase().indexOf(i)===o.length-i.length||o.toLowerCase().indexOf(n)===o.length-n.length&&r===t){t.clear(t.Const.Layers.TRACK);t.importTrack(e);/.kml$/g.test(o.toLowerCase())&&t.layerTrack&&t.layerTrack.styles&&t.layerTrack.features.forEach(function(e){e instanceof TC.feature.Point&&t.layerTrack.styles.point?e.setStyle(t.layerTrack.styles.point):e instanceof TC.feature.Polyline&&t.layerTrack.styles.line&&e.setStyle(t.layerTrack.styles.line)})}}.bind(t));return o};e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,e)})};e.importTrack=function(e){var t=this;if(t.isDisabled)/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(e.fileName&&e.features&&e.features.length>0){var o=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;const i=[];for(var r=0,n=e.features.length;r<n;r++)i.push(t.layerTrack.addFeature(e.features[r]));Promise.all(i).then(function(){t.wrap.processImportedFeatures({wait:o,notReproject:e.notReproject});if(t.layerTrack){t.map&&t.map.layout&&t.map.layout.accordion&&t.div.classList.contains(TC.Consts.classes.COLLAPSED)&&t.map.controls.filter(function(e){return e!==t&&!e.containerControl}).forEach(function(e){e.div.classList.add(TC.Consts.classes.COLLAPSED)});t.div.classList.remove(TC.Consts.classes.COLLAPSED);t.div.querySelector("."+t.CLASS+"-btn-tracks > span").click();e.isShared||t.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};e.prepareFeaturesToShare=function(e){const t=this;return new Promise(function(o,r){if(e){var n=t.availableTracks.filter(function(t){return t.uid.toString()===e.toString()})[0].data,i=Math.pow(10,TC.Consts.DEGREE_PRECISION+1),a=(new ol.format.GeoJSON).readFeatures(n);const r=new Array(a.length);a.forEach(function(e,t){r[t]=TC.wrap.Feature.createFeature(e)});Promise.all(r).then(function(e){t.featuresToShare=e.map(function(e){const t={};switch(!0){case TC.feature.Marker&&e instanceof TC.feature.Marker:t.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&e instanceof TC.feature.Point:t.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:t.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:t.type=TC.Consts.geom.MULTIPOLYLINE}t.id=e.id;t.geom=TC.Util.compactGeometry(e.geometry,i);t.data=e.getData();return t});o()})}else o()})};var t=!0;e.renderData=function(a,s){const l=this;var c=l.Const.Selector;return TC.Control.prototype.renderData.call(l,a,function(){const a=l.div.querySelectorAll(l._classSelector+"-panel");l.div.querySelectorAll("."+l.CLASS+"-select span").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var t=e.target;t&&"LABEL"!==t.tagName;)t=t.parentElement;const o=t.querySelector("input[type=radio][name=mode]").value;a.forEach(function(e){e.matches("."+l.CLASS+"-"+o)?e.classList.remove(TC.Consts.classes.HIDDEN):e.classList.add(TC.Consts.classes.HIDDEN)})})});l.track={activateButton:l.div.querySelector(l._classSelector+"-track-ui-activate"),deactivateButton:l.div.querySelector(l._classSelector+"-track-ui-deactivate"),trackSearch:l.div.querySelector(l._classSelector+"-track-available-srch"),trackImportFile:l.div.querySelector(l._classSelector+"-track-import"),trackSave:l.div.querySelector(l._classSelector+"-track-save"),trackAdd:l.div.querySelector(l._classSelector+"-track-add-wpt"),trackContinue:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-continue"),trackRenew:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-new"),trackClose:l._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:l._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-ok")};l.track.trackList=l.div.querySelector(l._classSelector+"-track-available-lst");l.track.trackToolPanelOpened=l.div.querySelector("#tc-ctl-geolocation-track-panel-opened");l.div.querySelector("."+e.CLASS+"-track-panel-help").addEventListener("click",function(){i.call(l)});l.track.trackName=l.div.querySelector(l._classSelector+"-track-title");l.track.trackWPT=l.div.querySelector(l._classSelector+"-track-waypoint");TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&(l.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.trackImportFile.disabled=!1;l.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(e){const t=document.createElement("form"),o=this.parentElement;o.insertBefore(t,this);t.appendChild(this);t.reset();t.insertAdjacentElement("afterend",this);o.removeChild(t)});l.track.trackImportFile.addEventListener("change",function(e){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,o);l.map.wrap.loadFiles(e.target.files,{control:l})}}})}else console.log("no es posible la importaci\xf3n");l.track.activateButton.addEventListener("click",function(){l.activateTracking();r.call(l)});l.track.deactivateButton.addEventListener("click",function(){l.deactivateTracking();n.call(l)});var h=function(e){e=e.toLowerCase();const t=Array.from(l.track.trackList.querySelectorAll("li"));t.forEach(function(e){e.style.display="none"});const o=t.filter(function(e){return e.matches("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK)}),r=l.div.querySelector(l._classSelector+"-track-search-icon");if(0===e.length){o.forEach(function(e){e.style.display=""});r.style.visibility="visible"}else{r.style.visibility="hidden";var n=new RegExp(e,"i");o.forEach(function(e){e.style.display=n.test(e.querySelector("span").textContent)?"":"none"});o.some(function(e){return""===e.style.display})||t.forEach(function(e){e.matches('[class^="tc-ctl-geolocation-track-not"]')&&(e.style.display="")})}};const d=function(){h(this.value.toLowerCase().trim())};l.track.trackSearch.addEventListener("keyup",d);l.track.trackSearch.addEventListener("search",d);try{if(l.track.trackSearch.querySelector("::-ms-clear")){l.track.trackSearch.addEventListener("mouseup",function(e){""!==l.track.trackSearch.value&&setTimeout(function(){var e=l.track.trackSearch.value;""===e&&h(e)},1)})}}catch(e){}l.track.trackSave.addEventListener("click",l.saveTrack.bind(l));l.track.trackAdd.addEventListener("click",l.addWaypoint.bind(l));const p=l.div.querySelector(l._classSelector+"-track-available-lst");var f=function(e,t){"LI"!==t.tagName&&(t=t.parentElement);const o=t.querySelector("input"),r=t.querySelector("span");if(e){o.classList.remove(TC.Consts.classes.HIDDEN);o.focus();o.value=r.textContent;r.classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EDIT).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.DELETE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.DRAW).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_GPX).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_KML).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.SAVE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{o.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EDIT).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.DELETE).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.DRAW).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_GPX).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.EXPORT_KML).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(c.SAVE).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(c.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(e,t){if(t){var o=[c.SIMULATE,c.EDIT,c.DELETE,c.EXPORT_GPX,c.EXPORT_KML],r=[c.STOP,c.PAUSE,c.BACKWARD,c.FORWARD,c.SPEED],n="LI"===t.tagName?t:t.parentNode;o.forEach(function(t){n.querySelector(t).hidden=e});r.forEach(function(t){n.querySelector(t).hidden=!e})}};p.addEventListener("click",TC.EventTarget.listenerBySelector(c.SIMULATE,function(e){var t=l.getLoadingIndicator().addWait();e.target.parentElement.querySelector(c.SPEED).textContent="x 1";y(l,e.target).then(function(){l.getLoadingIndicator().removeWait(t)})}));p.addEventListener("click",TC.EventTarget.listenerBySelector(c.DRAW,function(e){var t=l.getLoadingIndicator().addWait();m(l,e.target).then(function(){l.getLoadingIndicator().removeWait(t)})}));l.on(l.Const.Event.IMPORTEDTRACK,function(e){if(l.isDisabled)l.map.toast(l.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const t=l.track.trackList.querySelector('li[data-id="'+e.index+'"]');m(l,t.querySelector(c.DRAW));$(l.track.trackList).animate({scrollTop:e.index*t.offsetHeight},"slow")}});const g=function(e,t){e.track.trackList.querySelectorAll("li[data-id]").forEach(function(o){if(o.dataset.id!==t){const t=o.querySelector(c.SIMULATE),r=o.querySelector(c.PAUSE);t.classList.remove(e.Const.Classes.SIMULATIONACTIVATED);t.setAttribute("title",e.getLocaleString("tr.lst.simulate"));r.classList.remove("play");r.setAttribute("title",e.getLocaleString("tr.lst.pause"));e.uiSimulate(!1,o);f(!1,o)}});e.clear(e.Const.Layers.TRACK)};var m=function(e,t){return new Promise(function(o,r){const n=t.parentElement;setTimeout(function(){if(n.classList.contains(e.Const.Classes.SELECTEDTRACK)){e.uiSimulate(!1,t);e.clear(e.Const.Layers.TRACK);t.setAttribute("title",t.textContent)}else if(e.getSelectedTrack()){g(e,n.dataset.id);e.drawTrack(n)}else e.drawTrack(n);n.classList.contains(e.Const.Classes.SELECTEDTRACK)?e.prepareFeaturesToShare(n.dataset.uid).then(function(){o()}):o()},0)})},y=function(e,t){return new Promise(function(o,r){setTimeout(function(){const r=t.parentElement;g(e,r.dataset.id);e.uiSimulate(!1,e.getSelectedTrack());e.uiSimulate(!0,t);e.simulate_paused=!1;e.simulateTrack(r);o()},0)})};p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EDIT,function(e){f(!0,e.target)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.DELETE,function(e){l.removeTrack(e.target.parentElement)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.SAVE,function(e){if(0===e.target.parentElement.querySelector("input").value.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName(e.target.parentElement.dataset.id,e.target.parentElement.querySelector("input").value);f(!1,e.target)}}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.CANCEL,function(e){f(!1,e.target)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.EXPORT_GPX+","+l._classSelector+" "+c.EXPORT_KML,function(e){const t=e.target.parentElement;var o=Array.from(e.target.classList).filter(function(e){return 0===e.indexOf("tc-btn-export-")})[0].replace("tc-btn-export-","").toUpperCase();l.export(o,t).then(function(e){if(e){var r=t.querySelector("span").textContent,n=new RegExp(l.Const.SupportedFileExtensions.join("|"),"gi"),i=r.replace(n,"");TC.Util.downloadFile(i+"."+o.toLowerCase(),l.Const.MimeMap[o],e)}else TC.alert(l.getLocaleString("geo.error.export"))})}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.STOP,function(e){l.uiSimulate(!1,e.target);l.wrap.simulateTrackEnd();const t=e.target.parentElement.querySelector(c.PAUSE);t.classList.remove("play");t.setAttribute("title",l.getLocaleString("tr.lst.pause"));e.target.parentElement.querySelector(c.SPEED).textContent="x 1";l.simulate_speed=1}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.PAUSE,function(e){l.simulate_paused=!e.target.classList.contains("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);e.target.setAttribute("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));l.simulate_paused?e.target.classList.add("play"):e.target.classList.remove("play")}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.BACKWARD,function(e){1==l.simulate_speed?l.simulate_speed=.5:l.simulate_speed=l.simulate_speed/2;e.target.parentElement.querySelector(l._classSelector+" "+c.FORWARD).disabled=!1;e.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;.000244140625==l.simulate_speed&&(e.target.disabled=!0)}));p.addEventListener("click",TC.EventTarget.listenerBySelector(l._classSelector+" "+c.FORWARD,function(e){l.simulate_speed=l.simulate_speed/.5;e.target.parentElement.querySelector(c.SPEED).textContent=l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed;e.target.parentElement.querySelector(l._classSelector+" "+c.BACKWARD).disabled=!1;4096==l.simulate_speed&&(e.target.disabled=!0)}));l.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();u.call(l)});l.track.trackRenew.addEventListener("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.trackClose.addEventListener("click",function(){n.call(l)});l.track.trackAdvertisementOK.addEventListener("click",function(){const e=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(e.length>0){new Promise(function(e,t){window.localforage?e():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){e()})}).then(function(){localforage.setItem(e[0].getAttribute("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=document.querySelector("#tc-ctl-geolocation-track-render");l.track.renderTrack.addEventListener("change",function(){l.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&l.layerTracking.setVisibility(this.checked);t=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()});$.isFunction(s)&&s()})};e.activate=function(){};e.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var o=function(){this.map.off(TC.Consts.event.LAYERERROR,o);this.clearFileInput(this.track.trackImportFile);TC.alert(this.getLocaleString("geo.trk.upload.error3"))},r=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},n=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},i=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};e.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};e.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};e.setFormatInfoNewPosition=function(e){var t={},o=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var r=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(e.position,this.map.crs,this.map.view3D.crs):e.position;t.x=r[0].toLocaleString(o);t.y=r[1].toLocaleString(o);t.mdt=Math.round(this.map.view3D.getHeightFromMDT(r)).toLocaleString(o);t.isGeo=!0}else{t.x=Math.round(e.position[0]).toLocaleString(o);t.y=Math.round(e.position[1]).toLocaleString(o)}t.z=Math.round(e.altitude).toLocaleString(o);t.accuracy=Math.round(e.accuracy).toLocaleString(o);t.speed=e.speed.toLocaleString(o,{minimumFractionDigits:1,maximumFractionDigits:1});return t};e.renderInfoNewPosition=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",t.setFormatInfoNewPosition(e.pd),function(e){if(t.track.infoPanel)"boolean"==typeof t.track.infoPanel||t.track.infoPanel.isMinimized()||t.track.infoPanel.renderPromise().then(function(){t.track.infoPanel.getTableContainer().innerHTML=e;t.track.infoPanel.isVisible()||t.track.infoPanel.doVisible()});else{t.track.infoPanel=!0;var o,r={content:"table",titles:{main:t.getLocaleString("geo.mylocation"),max:t.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const i=function(e){r.side=e.SIDE.RIGHT;o=e.addControl("resultsPanel",r)};if(t.options.displayOn){var n=t.map.getControlsByClass("TC.control."+t.options.displayOn[0].toUpperCase()+t.options.displayOn.substring(1))[0];n?i(n):t.map.addControl(t.options.displayOn).then(i)}else{r.div=document.createElement("div");t.map.div.appendChild(r.div);o=t.map.addControl("resultsPanel",r)}o.then(function(o){o.caller=t;t.map.getControlsByClass("TC.control.ResultsPanel").filter(function(e){return"table"===e.content&&e!==o}).forEach(function(e){e.close()});t.track.infoPanel=o;o.renderPromise().then(function(){o.open(e)})})}})};var a,s,l,c=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},u=function(){var e=this;e.activate();r.call(e);c.call(e);e.on(e.Const.Event.POSITIONCHANGE,function(t){e.currentPoint=t.pd;e.renderInfoNewPosition(t);e.track.trackName.disabled=!1;e.track.trackSave.disabled=!1;e.track.trackWPT.disabled=!1;e.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking).features)});e.on(e.Const.Event.STATEUPDATED,function(e){});e.clear(e.Const.Layers.TRACKING);m.call(e,e.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);e.wrap.setTracking(!0)},h=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();g.apply(this)},d=function(){var e=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();document[e]||h.apply(this);console.log("video is: "+this.videoScreenOn.paused)},p=function(){l||(l=d.bind(this));a||(a=function(){f.apply(this)}.bind(this));s||(s=h.bind(this));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",a,!1);window.addEventListener("pageshow",s,!1)}else{window.addEventListener("blur",a,!1);window.addEventListener("focus",s,!1)}},f=function(){var e=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);e&&e.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e))},g=function(){var e=this;localforage.getItem(e.Const.LocalStorageKey.TRACKINGTEMP).then(function(t){null!==t&&"null"!==t&&t.length>0&&TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,t)})},m=function(e){var t=this;new Promise(function(e,t){window.localforage?e():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){e()})}).then(function(){localforage.getItem(e).then(function(o){if(null==o){const o=t._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),r=o.querySelector('input[type="checkbox"]');r.setAttribute("name",e);r.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop");o.querySelector("h3").textContent=e==t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title");TC.Util.showModal(t._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});t.map.toast(TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};e._askTracking=function(e){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){$.isFunction(e)&&e()}});return!0};e.activateTracking=function(){var e=this,t=!0;e.isActive||e.activate();e.clear(e.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TEST,e.Const.LocalStorageKey.TEST)}catch(o){o.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(e.getLocaleString("geo.error.trackinglocalstorage")):TC.error(o);t=!1}if(t){(function(){if(!this.videoScreenOn){var e={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var t=document.createElement("source");t.src=e.WebM;t.type="video/webm";this.videoScreenOn.appendChild(t);var o=document.createElement("source");o.src=e.MP4;o.type="video/mp4";this.videoScreenOn.appendChild(o)}this.videoScreenOn.play()}).apply(e);p.apply(e);e.sessionTracking=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);if(e.sessionTracking){e._askTracking(function(){n.call(e)})||e.track.trackRenew.click()}else u.call(e)}else n.call(e)};e.deactivateTracking=function(){var e=this,o=function(){e.track.infoPanel.close();f.apply(e);e.wrap.setTracking(!1);delete e.geopositionTracking;t||e.div.querySelector(e._classSelector+"-track-render").querySelector("label").click();(function(){this.videoScreenOn&&this.videoScreenOn.pause()}).apply(e);(function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",a,!1);window.removeEventListener("pageshow",s,!1)}else{window.removeEventListener("blur",a,!1);window.removeEventListener("focus",s,!1)}}).apply(e);e.off(e.Const.Event.POSITIONCHANGE);e.off(e.Const.Event.STATEUPDATED);n.call(e);e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.clear(e.Const.Layers.TRACKING);e.clear(e.Const.Layers.GPS);return!0};if(e.wrap.hasCoordinates()){e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return o()}return o()};e.getStoredTracks=function(){const e=this;return new Promise(function(t,o){var r=[];localforage.keys().then(function(o){if(0==(o=o.filter(function(t){return 0!==t.indexOf(e.Const.LocalStorageKey.TRACKINGTEMP)&&0===t.indexOf(e.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(t)})).length){e.availableTracks=r;t(r)}const n=new Array(o.length);o.forEach(function(e,t){n[t]=new Promise(function(t,o){localforage.getItem(e,function(e,o){t(o)})})});Promise.all(n).then(function(o){if(o&&o.length){o.forEach(function(e){(e=JSON.parse(e))instanceof Array?r=r.concat(e):r.push(e)});var n=r.length>1?y(r):r;e.availableTracks=n;t(n)}})})})};var y=function(e){var t=[];for(var o in e)if(e[o]&&"object"==typeof e[o]){t.push(e[o]);t.sort(function(e,t){return"string"==typeof e.name&&$.isFunction(e.name.localeCompare)?e.name.localeCompare(t.name):0})}return t};e.setStoredTracks=function(e){const t=this;return new Promise(function(o,r){const n=[];e.forEach(function(e){n.push(new Promise(function(o,r){localforage.setItem(t.Const.LocalStorageKey.TRACKING+"#"+e.uid,JSON.stringify(e),function(e,t){o(t)})}))});Promise.all(n).then(function(){t.getStoredTracks().then(function(){t.bindTracks();o()})})})};e.getAvailableTracks=function(){const e=this;return new Promise(function(t,o){e.availableTracks?t(e.availableTracks):e.getStoredTracks().then(function(e){t(e)})})};e.bindTracks=function(){var e=this;e.track.trackList.querySelectorAll("li").forEach(function(e){e.style.display="none"});e.getAvailableTracks().then(function(t){if(C(t)){e.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(e){e.style.display=""});e.track.trackSearch.disabled=!0}else{const i=e.getSelectedTrack();var o;i&&(o=i.dataset.uid);e.track.trackList.querySelectorAll("li[data-id]").forEach(function(t){e.track.trackList.removeChild(t)});for(var r=0;r<t.length;r++){var n=t[r];"object"==typeof n&&e.getRenderedHtml(e.CLASS+"-track-node",{id:r,uid:n.uid,name:n.name?n.name.trim():""},function(t){const o=(new DOMParser).parseFromString(t,"text/html").body.firstChild;e.track.trackList.appendChild(o)})}o&&e.setSelectedTrack(e.track.trackList.querySelector('li[data-uid="'+o+'"]'));e.track.trackSearch.disabled=!1}})};e.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);const e=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();this.miDiv=document.createElement("div");this.miDiv.classList.add("miDiv");this.miDiv.style.width=e.width+"px";this.miDiv.style.height=e.height+"px";this.miProgressDiv=document.createElement("div");this.miProgressDiv.classList.add("miProgressDiv");this.miProgressDiv.classList.add(this.CLASS+"-track-elevation-chart-progress");this.miProgressDiv.classList.add(TC.Consts.classes.HIDDEN);this.miProgressDiv.style.width="0%";this.miProgressDiv.style.height=e.height+"px";this.miProgressTextDiv=document.createElement("div");this.miProgressTextDiv.classList.add("miProgressTextDiv");this.miProgressTextDiv.classList.add("tc-ctl-geolocation-track-elevation-chart-progress");this.miProgressTextDiv.classList.add("text");this.miProgressTextDiv.style.width=e.width+"px";this.miProgressTextDiv.style.height=e.height+"px";this.miDiv.style.top=e.top+"px";this.miDiv.style.left=e.left+"px";this.miDiv.style.bottom=e.bottom+"px";this.miDiv.style.right=e.right+"px";this.miDiv.style.position="absolute";this.miDiv.style.zIndex=10008;this.miDiv.style.display="none";this.miProgressDiv.appendChild(this.miProgressTextDiv);this.miDiv.appendChild(this.miProgressDiv);document.body.appendChild(this.miDiv)};e.chartProgressClear=function(){const e=this;if(e.miDiv){e.miDiv.parentElement.removeChild(e.miDiv);e.miDiv=null;e.miProgressDiv=null;e.miProgressTextDiv=null}};e.chartSetProgress=function(e,t,o,r){if(this.miDiv){"none"===this.miDiv.style.display&&(this.miDiv.style.display="");this.miProgressDiv.classList.remove(TC.Consts.classes.HIDDEN);var n=e.d,i=(n+Math.hypot(e.p[0]-t[0],e.p[1]-t[1]))/o*100;this.miProgressDiv.style.width=i+"%";var a,s,l=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,c=parseInt(t[2].toFixed(0)).toLocaleString(l);if(n/1e3<1){a=Math.round(n/1e3*1e3);s=" m"}else{a=Math.round(n/1e3*100)/100;s=" km"}a=a.toLocaleString(l);this.miProgressTextDiv.innerHTML="<div><span>"+c+" m</span><br><span>"+a+s+"</span></div>"+(r?"<br><span>"+r.toString+"</span>":"")}};e._getTime=function(e,t){var o=t-e,r={},n=Math.floor(o/1e3/60/60/24);o-=1e3*n*60*60*24;var i=Math.floor(o/1e3/60/60);o-=1e3*i*60*60;r.h=i+24*n;var a=Math.floor(o/1e3/60);o-=1e3*a*60;r.m=a;r.s=Math.floor(o/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};e.simulateTrack=function(e){var t=this;t.simulate_speed=1;t.drawTrack(e,!1).then(function(){t.wrap.simulateTrack()})};e.drawTrack=function(e,t){var o=this;c.call(o);return new Promise(function(t,r){o.setSelectedTrack(e);o.drawTrackingData(e).then(function(){o.elevationTrack(e);o.activate();t()})})};e.elevationTrack=function(t,o){var r=this;if(o){r.wrap.simulateTrackEnd();r.uiSimulate(!1,t)}else{if(!r.onResize){r.onResize=r.elevationTrack.bind(r,t,!0);window.addEventListener("resize",r.onResize,!1)}r.chart={coordinates:[]};r.track.elevationChart&&(r.track.elevationChart=r.track.elevationChart.destroy());(function(e){return new Promise(function(t,o){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){r.getTrackingData(e).then(function(e){var o=e.data;if(o){var n,i;n=[];i=[];var a,s,l,c=!0,u={},h={},d=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZ||l.getLayout()==ol.geom.GeometryLayout.XYZM){var e=0;if(r.map.crs!==r.map.options.utmCrs){line=new ol.geom.LineString(TC.Util.reproject(l.getCoordinates(),r.map.crs,r.map.options.utmCrs));e=line.getLength()}else e=l.getLength();return parseFloat((e/1e3).toFixed(2))}return null},p=function(){if(l.getLayout()==ol.geom.GeometryLayout.XYZM||l.getLayout()==ol.geom.GeometryLayout.XYM){var e=l.getLastCoordinate()[3]-l.getFirstCoordinate()[3];return{s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}return null},f=function(e){if(r.chart.coordinates.length>0){var t=0;r.chart.coordinates.forEach(function(o,n,i){var a=0===n?o:i[n-1];if(r.map.crs!==r.map.options.utmCrs){o=TC.Util.reproject(o,r.map.crs,r.map.options.utmCrs);a=TC.Util.reproject(a,r.map.crs,r.map.options.utmCrs)}const s=o[0]-a[0],l=o[1]-a[1];t+=Math.sqrt(s*s+l*l);e.push(parseFloat(t.toFixed(2)))})}},g=function(e){for(var o=0;o<r.chart.coordinates.length;o++){if(!(r.chart.coordinates[o].length>2)){t(null);return}var n=Math.round(10*r.chart.coordinates[o][2])/10;c&&n>0&&(c=!1);e.push(n);0==o&&(a=s=n);a=Math.min(a,n);s=Math.max(s,n)}};(new ol.format.GeoJSON).readFeatures(o).filter(function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()}).forEach(function(t){switch((l=t.getGeometry()).getType().toLowerCase()){case"linestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ){h=p();d();u=TC.tool.Elevation.getElevationGain({coords:l.getCoordinates(),hillDeltaThreshold:r.gapHill});r.chart.coordinates=r.chart.coordinates.concat(l.getCoordinates());f(n);g(i)}break;case"multilinestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ)for(var o,a=l.getLineStrings(),s=0;s<a.length;s++){d(a[s]);a[s].getLayout()==ol.geom.GeometryLayout.XYZM&&(o+=a[s].getLastCoordinate()[3]-a[s].getFirstCoordinate()[3]);r.chart.coordinates=r.chart.coordinates.concat(a[s].getCoordinates());o&&(h=p());f(n);g(i)}break;default:return null}});i instanceof Array&&0==i.length&&(c=!0);r.chartData=c?null:$.extend({},{time:h,ele:i,x:n,miny:a,maxy:s},u);t(r.chartData)}else t(null)})})})})(t).then(function(t){TC.Util.getMapLocale(r.map);if(null!=t){t.time&&(t.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));t.coords=r.chart.coordinates;r.hasElevation=!0}else{r.hasElevation=!1;t={msg:r.getLocaleString("geo.trk.chart.chpe.empty")}}t.minHeight=r.CHART_SIZE.MIN_HEIGHT;t.maxHeight=r.CHART_SIZE.MAX_HEIGHT;t.minWidth=r.CHART_SIZE.MIN_WIDTH;t.mediumWidth=r.CHART_SIZE.MEDIUM_WIDTH;t.maxWidth=r.CHART_SIZE.MAX_WIDTH;r.map.one(TC.Consts.event.DRAWCHART,function(e){r.chartProgressInit()});if(r.resultsPanelChart){r.resultsPanelChart.open();r.map.trigger(r.Const.Event.DRAWTRACK,{data:t})}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");var o,n={content:"chart",titles:{main:r.getLocaleString("geo.trk.chart.chpe"),max:r.getLocaleString("geo.trk.chart.chpe")},openOn:r.Const.Event.DRAWTRACK,closeOn:r.Const.Event.CLEARTRACK,chart:{ctx:r,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};const a=function(e){n.side=e.SIDE.RIGHT;o=e.addControl("resultsPanel",n)};if(r.options.displayOn){var i=r.map.getControlsByClass("TC.control."+r.options.displayOn[0].toUpperCase()+r.options.displayOn.substring(1))[0];i?a(i):r.map.addControl(r.options.displayOn).then(a)}else{n.div=document.createElement("div");r.map.div.appendChild(n.div);o=r.map.addControl("resultsPanel",n)}o.then(function(e){e.caller=r;r.resultsPanelChart=e;e.renderPromise().then(function(){e.activateSnapping=function(e){r.layerTrack&&!r.layerTrack.getVisibility()&&0==r.layerTrack.getOpacity()&&r.wrap.deactivateSnapping.call(r.wrap)};e.deactivateSnapping=function(e){r.layerTrack&&r.layerTrack.getVisibility()&&r.layerTrack.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)};e.div.addEventListener("mouseover",e.deactivateSnapping);e.div.addEventListener("mouseout",e.activateSnapping);r.map.on(TC.Consts.event.RESULTSPANELMIN,function(){r.miDiv&&(r.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELMAX,function(){r.miDiv&&(r.miDiv.style.display="")}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){r.miDiv&&(r.miDiv.style.display="none")});r.map.trigger(r.Const.Event.DRAWTRACK,{data:t})})})}})}};e.clear=function(e){var t=this;if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}if(e==t.Const.Layers.TRACK){t.layerTrack.clearFeatures();t.resultsPanelChart&&t.resultsPanelChart.close();delete t.chartData;t.wrap.simulateTrackEnd();t.wrap.clear();t.track.trackList.querySelectorAll("li").forEach(function(e){e.classList.remove(t.Const.Classes.SELECTEDTRACK)});t.map.trigger(t.Const.Event.CLEARTRACK);t.featuresToShare=[]}else{t.layerTracking.clearFeatures();t.layerGPS.clearFeatures()}};e.saveTrack=function(e){const t=this;return new Promise(function(o,r){var n=e.message||t.getLocaleString("geo.trk.save.alert"),i=function(i){var a;a=t.getLoadingIndicator().addWait();var s=e.importedFileName||t.track.trackName.value.trim(),l=t.availableTracks;l||(l=[]);var u=t.wrap.formattedToStorage(i,!0,e.notReproject),h=function(e){t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.getLoadingIndicator().removeWait(e);c.call(t)},d={name:s,data:u.features,layout:u.layout,crs:t.storageCRS};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var e=hex_md5(JSON.stringify(d)),i=l.map(function(t){var o=JSON.parse(JSON.stringify(t));delete o.uid;if(e===hex_md5(JSON.stringify(o)))return t.uid;{const i=new ol.format.GeoJSON;var r=i.readFeatures(o.data),n=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);r.forEach(function(e){var t=TC.Util.explodeGeometry(TC.Util.compactGeometry(e.getGeometry().getCoordinates(),n));e.getGeometry().setCoordinates(t)});o.data=i.writeFeatures(r);return e===hex_md5(JSON.stringify(o))?t.uid:null}}).filter(function(e){return null!==e});const s=function(e){return t.getStoredTracks().then(function(){t.bindTracks();for(var o,r=0;r<t.availableTracks.length;r++)if(t.availableTracks[r].uid===e){o=r;break}return o})};if(0===i.length){d.uid=Date.now()+Math.random();l.push(d);l=y(l);try{t.setStoredTracks(l).then(function(){t.map.toast(n,{duration:3e3});h(a);s(d.uid).then(function(e){o(e)})})}catch(e){TC.alert(t.getLocaleString("geo.error.savelocalstorage")+": "+e.message);h(a);r()}}else{console.log("Ya existe un track con ese mismo hash");h(a);s(i[0]).then(function(e){o(e)})}})};if(t.importedFileName)i(t.layerTrack);else if(0==t.track.trackName.value.trim().length){t.track.trackName.value=(new Date).toLocaleString();i(t.layerTracking)}else i(t.layerTracking)})};e.addWaypoint=function(){var e=this.track.trackWPT.value.trim();e||(e=(new Date).toLocaleString());var t=this.getLoadingIndicator().addWait();c.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:e,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(t)};e.editTrackName=function(e,t){var o=this;o.getAvailableTracks().then(function(r){if(r&&r[e]){r[e].name=t;o.setStoredTracks(r)}})};e.removeTrack=function(e){var t=this;t.getAvailableTracks().then(function(o){if(o){var r=e.dataset.id;if(o[r]){var n=o[r].uid;TC.confirm(t.getLocaleString("geo.trk.delete.alert"),function(){const e=t.getSelectedTrack();e&&e.dataset.id===r&&t.clear(t.Const.Layers.TRACK);localforage.removeItem(t.Const.LocalStorageKey.TRACKING+"#"+n).then(function(){t.getStoredTracks().then(function(){t.bindTracks()})}).catch(function(e){console.log(e)})},function(){})}}})};e.setSelectedTrack=function(e){var t=this;t.isActive||t.activate();t.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(e){e.setAttribute("title",e.textContent)});t.track.trackList.querySelectorAll("li").forEach(function(e){e.classList.remove(t.Const.Classes.SELECTEDTRACK)});e.classList.add(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",t.getLocaleString("tr.lst.clear")+" "+e.querySelector("span").textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"))};e.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};e.clearSelectedTrack=function(){const e=this,t=e.getSelectedTrack();if(t){if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}t.classList.remove(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",t.textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"))}};e.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};e.drawTrackingData=function(e){const t=this;return new Promise(function(o,r){t.wrap.clear();t.getTrackingData(e).then(function(e){e.data;e.data&&t.wrap.drawTrackingData(e).then(function(){var e=t.layerTrack.features;if(e&&e.length>0){var r=e.filter(function(e){e.showsPopup=!1;return!!(TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)||e instanceof TC.feature.Polyline}).map(function(e){return TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?e.geometry[0]:e instanceof TC.feature.Polyline?e.geometry:void 0})[0];if(r){var n=r[0],i=r[r.length-1];n&&n!==i&&t.layerTrack.addMarker(n.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});i&&t.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}t.layerTrack.setVisibility(!0);o()})})})};e.getTrackingData=function(e){const t=this;return new Promise(function(o,r){t.getAvailableTracks().then(function(r){if(r){const i=e.dataset.id;if(r[i]){var n=r[i].data;n=t.wrap.formattedFromStorage(n);o({data:n,layout:r[i].layout})}}else o()})})};e.export=function(e,t){return this.wrap.export(e,t)};e.getElevationTooltip=function(e){this.wrap.showElevationMarker(e);return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};e.clearFileInput=function(e){const t=document.createElement("form"),o=e.parentElement;o.insertBefore(t,e);t.appendChild(e);t.reset();t.insertAdjacentElement("afterend",e);o.removeChild(t)};e.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};e.onGeolocateError=function(e){var t;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(e){navigator.geolocation.clearWatch(e)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(e.code){case e.PERMISSION_DENIED:t=this.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:t=this.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:t=this.getLocaleString("geo.error.timeout");break;default:t=this.getLocaleString("geo.error.default")}this.map.toast(t,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var C=function(e){return!e||0===e.length};e.exportState=function(){const e=this;if(e.exportsState){const o={};if(e.layerTrack){var t=e.layerTrack.features;if(t.length>0&&e.featuresToShare&&e.featuresToShare.length>0)o.features=e.featuresToShare;else{const r=e.layerTrack.exportState({features:t});o.features=r.features}o.id=e.id;const r=e.getSelectedTrack();r&&(o.trackName=r.querySelector("span").innerHTML);return o}}return null};e.importState=function(e){const t=this;if(t.map&&e.features&&e.features.length){t.enable();if(e.features.length>0){const o=new Array(e.features.length);e.features.forEach(function(e,t){const r={data:e.data,id:e.id,showsPopup:e.showsPopup};var n=TC.Util.explodeGeometry(e.geom);switch(e.type){case TC.Consts.geom.POLYLINE:o[t]=new TC.feature.Polyline(n,r);break;case TC.Consts.geom.MULTIPOLYLINE:o[t]=new TC.feature.MultiPolyline(n,r);break;case TC.Consts.geom.MARKER:o[t]=new TC.feature.Marker(n,r);break;case TC.Consts.geom.POINT:o[t]=new TC.feature.Point(n,r)}});Promise.all(o).then(function(o){var r={features:o,fileName:e.trackName,notReproject:!0,isShared:!0};t.availableTracks?t.importTrack(r):t.getStoredTracks().then(function(){t.importTrack(r)})})}}}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");!function(){TC.control.GeometryFeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.GeometryFeatureInfo(this);this.lineColor=this.options.lineColor?this.options.lineColor:"#c00";this._isDrawing=!1;this._isSearching=!1;this._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.GeometryFeatureInfo.prototype;e.register=function(e){const t=this,o=TC.control.FeatureInfoCommons.prototype.register.call(t,e);t.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){t.wrap.cancelDraw()});return o};e.callback=function(e,t){var o=this;if(!o._drawToken){o.closeResults();for(var r=!1,n=0;n<o.map.workLayers.length;n++){var i=o.map.workLayers[n];if(i.type===TC.Consts.layerType.WMS&&i.getVisibility()&&i.names.length>0){r=!0;break}}if(r){o.closeResults();o.wrap.beginDraw({geometryType:o.geometryType,xy:e,layer:o.filterLayer,callback:function(e){o.wrap.getFeaturesByGeometry(e)}})}}};e.responseCallback=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(t,e);if(t.filterFeature){for(var o=e.services,r=0;r<o.length;r++){var n=o[r];if(n.hasLimits){delete n.layers;n.hasLimits=n.hasLimits}else{for(var i=0;i<n.layers.length;i++)if(!n.layers[i].features.length){n.layers.splice(i,1);i-=1}if(!n.layers.length){o.splice(r,1);r-=1}}}o.length?t.renderData(e,function(){t.insertLinks();t.displayResults()}):t.resultsLayer.clearFeatures()}}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";e.template[e.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";e.template[e.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/LayerCatalogDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"availableLayers"}).x(t.get(["enableSearch"],!1),t,{block:o},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",t,{},{$key:"textToSearchInLayers"}).w('"></input></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(t.get(["layerTrees"],!1),t,{else:n,block:i},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",t,t.rebase(t.getPath(!0,[])),{}).w("</div>")}t.__dustBody=!0;function o(e,t){return e.x(t.get(["layerTrees"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",t,{},{$key:"searchLayersbytext"}).w('"></button>')}r.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",t,{},{$key:"loadingLayerTree"}).w("...</span></div>")}n.__dustBody=!0;function i(e,t){return e.w('<ul class="tc-ctl-lcat-branch">').s(t.get(["layerTrees"],!1),t,{block:a},{}).w("</ul>")}i.__dustBody=!0;function a(e,t){return e.p("tc-ctl-lcat-branch",t,t.rebase(t.getPath(!0,[])),{})}a.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><button class="tc-ctl-lcat-collapse-btn"></button><span>').f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:n},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}r.__dustBody=!0;function n(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["isVisible"],!1),t,{block:o},{})}t.__dustBody=!0;function o(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('">').x(t.get(["children"],!1),t,{block:i},{}).w('<span data-tooltip="').x(t.get(["name"],!1),t,{block:a},{}).w('">').f(t.get(["title"],!1),t,"h").w("</span>").x(t.get(["name"],!1),t,{block:s},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:l},{}).w("</ul></li>")}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}r.__dustBody=!0;function n(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}n.__dustBody=!0;function i(e,t){return e.w('<button class="tc-ctl-lcat-collapse-btn"></button>')}i.__dustBody=!0;function a(e,t){return e.h("i18n",t,{},{$key:"clickToAddToMap"})}a.__dustBody=!0;function s(e,t){return e.w('<button title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('" class="tc-ctl-lcat-btn-info"></button>')}s.__dustBody=!0;function l(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}l.__dustBody=!0;return t};e.template[e.CLASS+"-info"]=function(){dust.register(e.CLASS+"-info",t);function t(e,t){return e.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",t,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(t.get(["title"],!1),t,"h").w("</h3>").x(t.get(["abstract"],!1),t,{block:o},{}).x(t.get(["metadata"],!1),t,{block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div><pre>").f(t.get(["abstract"],!1),t,"h",["s"]).w("</pre></div></div>")}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:n},{}).w("</ul></div>")}r.__dustBody=!0;function n(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h",["s"]).w("</a></li>")}n.__dustBody=!0;return t};e.template[e.CLASS+"-results"]=function(){dust.register(e.CLASS+"-results",t);function t(e,t){return e.s(t.get(["servicesFound"],!1),t,{else:o,block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",t,{},{$key:"noMatches"}).w("</h5></li>")}o.__dustBody=!0;function r(e,t){return e.h("gt",t,{block:n},{key:t.get(["servicesLooked"],!1),value:1}).s(t.get(["founds"],!1),t,{block:a},{}).h("gt",t,{block:c},{key:t.get(["servicesLooked"],!1),value:1})}r.__dustBody=!0;function n(e,t){return e.w('<li class="tc-ctl-lcat-search-group ').x(t.getPath(!1,["service","isCollapsed"]),t,{block:i},{}).w('" data-tc-service-index="').f(t.getPath(!1,["service","index"]),t,"h").w('"><h5>').f(t.getPath(!1,["service","title"]),t,"h").w("</h5><ul>")}n.__dustBody=!0;function i(e,t){return e.w("tc-collapsed")}i.__dustBody=!0;function a(e,t){return e.w('<li data-tc-layer-name="').f(t.get(["Name"],!1),t,"h").w('" ').x(t.get(["alreadyAdded"],!1),t,{else:s,block:l},{}).w('><h5 class="tc-selectable">').f(t.get(["Title"],!1),t,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></button></li>')}a.__dustBody=!0;function s(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"clickToAddToMap"}).w('" ')}s.__dustBody=!0;function l(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}l.__dustBody=!0;function c(e,t){return e.w("</ul></li>")}c.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerName",r="tcLayerInfo",n="tcServiceIndex";const i=function(e,t){e.showProjectionChangeDialog({layer:t,closeCallback:function(){e.getLayerNodes(t).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.querySelector("span").setAttribute(a,e.getLocaleString("clickToAddToMap"))})}})};var a="data-tooltip";e.register=function(e){const o=this,r=TC.control.ProjectionSelector.prototype.register.call(o,e),n=function(e,t){if($.isArray(o.options.layers)){for(var r=0;r<o.options.layers.length;r++){var n=o.options.layers[r];if(!n.type||n.type===TC.Consts.layerType.WMS){n.id||(n.id=TC.getUID());$.isPlainObject(n)&&(n=new TC.layer.Raster(n));o.layers.push(n)}}o.render(function(){e()})}else e()};o._readyPromise=new Promise(function(t,o){const r=function(o){if(o.layer===e.baseLayer){n(t);e.off(TC.Consts.event.LAYERUPDATE,r)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,r):n(t)})});var i=function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);o.textInput&&o.textInput.dispatchEvent(e)}else o.textInput&&o.textInput.fireEvent("keyup")};var s=o.getLocaleString("layerAlreadyAdded"),l=o.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){o.getLayerNodes(e.layer).forEach(function(e){e.classList.add(TC.Consts.classes.LOADING);e.querySelector("span").removeAttribute(a)})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){const t=e.layer;t.isBase||t.type!==TC.Consts.layerType.WMS||o.loaded().then(function(){const e=function(){o.getLayerNodes(t).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(a,s)});i()};if(o.getLayerRootNode(t))e();else{for(var r=!1,n=0,l=o.layers.length;n<l;n++){var c=o.layers[n];if(c.type===t.type&&c.options.url===t.options.url){r=!0;break}}r||o.addLayer(new TC.layer.Raster({url:t.options.url,type:t.type,layerNames:[],title:t.title||t.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){e()})}})}).on(TC.Consts.event.LAYERERROR,function(e){const t=e.reason;t&&TC.alert(o.getLocaleString(t,{url:e.layer.url}));o.getLayerNodes(e.layer).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING)})}).on(TC.Consts.event.LAYERREMOVE,function(e){const r=e.layer;o.getLayerNodes(r).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(a,l)});(function(e){const r=[];if(!e.isBase){var n=e.options.url;o.list&&o.list.querySelectorAll("li").forEach(function(o){var i=$(o).data(t);if(i&&i.type===e.type&&i.options.url===n)for(var a=0;a<e.names.length;a++)o.dataset.tcLayerName===e.names[a]&&r.push(o)})}return r})(r).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.setAttribute(a,l)});!function(e){var t=o.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(t)for(var r=t.layers,n=0;n<r.length;n++){var i=r[n];i!==e&&o.getLayerNodes(i).forEach(function(e){e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").setAttribute(a,s)})}}(r);i()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){o.addLayer(e.layer);o.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(e){o.update()});return r};const s=function(e){e.target.blur();e.stopPropagation();const t=e.target.parentElement;if("LI"===t.tagName&&!t.classList.contains(self.CLASS+"-leaf")){t.classList.contains(TC.Consts.classes.COLLAPSED)?t.classList.remove(TC.Consts.classes.COLLAPSED):t.classList.add(TC.Consts.classes.COLLAPSED);const e=t.querySelector("ul");e.classList.contains(TC.Consts.classes.COLLAPSED)?e.classList.remove(TC.Consts.classes.COLLAPSED):e.classList.add(TC.Consts.classes.COLLAPSED)}};e.render=function(e){const l=this;return l._set1stRenderPromise(new Promise(function(c,u){const h=$.map(l.layers,function(e){return e.wrap.getLayer()});Promise.all(h).then(function(){var h=$.map(l.layers,function(e){var t=e.getTree();!function t(o){for(var r=!1,n=0;n<o.children.length;n++)t(o.children[n])&&(r=!0);o.hasOwnProperty("isVisible")&&(o.isVisible=!e.names||!e.names.length||r||o.isVisible);return o.isVisible}(t);return t});l.renderData({layerTrees:h,enableSearch:l.options.enableSearch},function(){const c=l.getLocaleString("layerAlreadyAdded");l.div.querySelectorAll("li > button."+l.CLASS+"-collapse-btn").forEach(function(e){e.addEventListener("click",s)});l.div.querySelectorAll("span").forEach(function(e){e.addEventListener("click",function(e){!function(e,r){const n=e.target.parentNode;if(!n.classList.contains(TC.Consts.classes.LOADING)&&!n.classList.contains(TC.Consts.classes.CHECKED)){e.preventDefault;var i,s=$(n).data(o);s=void 0!==s?s.toString():"";for(var l=0,c=r._roots.length;l<c;l++){const e=r._roots[l];if(e.contains(n)){i=$(e).data(t);break}}i||(i=$(n).data(t));if(i&&s){var u=1;/iPad/i.test(navigator.userAgent)?u=10:TC.Util.detectFirefox()&&(u=250);i.title||(i.title=i.getTree().title);n.classList.add(TC.Consts.classes.LOADING);n.querySelector("span").setAttribute(a,"");(h=n,new Promise(function(e,t){setTimeout(function(){h.offsetHeight=h.offsetHeight;h.offsetWidth=h.offsetWidth;e()},u)})).then(function(){r.addLayerToMap(i,s)});e.stopPropagation()}}var h}(e,l)})});l._roots=l.div.querySelectorAll(l._selectors.LAYER_ROOT);l._roots.forEach(function(e,n){var i=l.layers[n];$(e).data(t,i);var s={};e.querySelectorAll("."+l.CLASS+"-btn-info").forEach(function(e){const t=e.parentElement.querySelector("span"),n=$(e.parentElement).data(o).toString();if(n){t.classList.add(TC.Consts.classes.SELECTABLE);var u=i.wrap.getInfo(n);if(u.hasOwnProperty("abstract")||u.hasOwnProperty("legend")||u.hasOwnProperty("metadata")){if(u.metadata)for(var h=0,d=u.metadata.length;h<d;h++){var p=u.metadata[h];p.formatDescription=s[p.format]=s[p.format]||l.getLocaleString(TC.Util.getSimpleMimeType(p.format))||l.getLocaleString("viewMetadata")}$(e).data(r,u);e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation();const t=this;if(t.classList.contains(TC.Consts.classes.CHECKED)){t.classList.remove(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{l.showLayerInfo(i,n);t.classList.add(TC.Consts.classes.CHECKED)}})}else e.parentElement.removeChild(e);if(i.compatibleLayers&&i.compatibleLayers.indexOf(n)<0){t.classList.add(TC.Consts.classes.INCOMPATIBLE);t.setAttribute("title",l.getLocaleString("reprojectionNeeded"))}if(l.map)for(h=0,d=l.map.workLayers.length;h<d;h++){var f=l.map.workLayers[h];if(f.type===TC.Consts.layerType.WMS&&f.url===i.url&&1===f.names.length&&f.names[0]===n){t.parentElement.classList.add(TC.Consts.classes.CHECKED);t.setAttribute(a,c)}}}else{t.setAttribute(a,"");e.parentElement.removeChild(e)}})});l.getRenderedHtml(l.CLASS+"-dialog",null,function(e){l._dialogDiv.innerHTML=e});l.textInput=l.div.querySelector("."+l.CLASS+"-input");l.list=l.div.querySelector("."+l.CLASS+"-search ul");l.textInput.addEventListener("mouseup",function(e){""!==l.textInput.value&&setTimeout(function(){""===l.textInput.value&&(l.list.innerHTML="")},1)});var u=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(l.textInput,{link:"#",target:l.list,minLength:0,source:function(e,t){u=[];l._roots.forEach(function(e){e.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(e){u.push($(e).data(o).toString())})});if((e=e.trim()).length<3)l.list.innerHTML="";else if(e.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var o=[],r=0;r<l.layers.length;r++){var n=l.layers[r].searchSubLayers(e);n.length&&o.push({service:{index:r,title:l.layers[r].title||l.layers[r].id},founds:n})}t({servicesFound:o,servicesLooked:l.layers.length})},TC._search.interval)}},callback:function(e){l.textInput.value=e.target.text||e.target.innerText;TC._search.lastPattern=l.textInput.value;l.goToResult(unescape(e.target.hash).substring(1));TC.UI.autocomplete.call(l.textInput,"clear")},buildHTML:function(e){if(e.results&&e.results.servicesFound.length>0)for(var t=l.map.getLayerTree().workLayers,o=0;o<e.results.servicesFound.length;o++){for(var r=e.results.servicesFound[o].founds,n=0;n<r.length;n++){delete r[n].alreadyAdded;for(var i=0;i<t.length;i++)if(u.indexOf(r[n].Name)>=0){r[n].alreadyAdded=!0;break}if(!r[n].Name){r.splice(n,1);n--}}e.results.servicesFound[o].founds.length?l.div.querySelectorAll(".tc-ctl-lcat-search-group")[o]&&(e.results.servicesFound[o].service.isCollapsed=l.div.querySelectorAll(".tc-ctl-lcat-search-group")[o].classList.contains(TC.Consts.classes.COLLAPSED)):e.results.servicesFound.splice(o,1)}var a="";dust.render(l.CLASS+"-results",e.results,function(e,t){a=t});return a}})});if(!l.searchInit){l.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2 button",function(e){const t=l.div.classList.contains(TC.Consts.classes.COLLAPSED);l.div.classList.remove(TC.Consts.classes.COLLAPSED);const o=l.div.querySelector("."+l.CLASS+"-search"),r=l.div.querySelector("."+l.CLASS+"-tree"),n=l.div.querySelector("."+l.CLASS+"-info");if(o.classList.contains(TC.Consts.classes.HIDDEN)||t){o.classList.remove(TC.Consts.classes.HIDDEN);r.classList.add(TC.Consts.classes.HIDDEN);l.textInput.focus();e.target.classList.add(l.CLASS+"-btn-tree");e.target.setAttribute("title",l.getLocaleString("viewAvailableLayersTree"));e.target.classList.remove(l.CLASS+"-btn-search");0===l.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&n.classList.add(TC.Consts.classes.HIDDEN)}else{o.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);e.target.classList.add(l.CLASS+"-btn-search");e.target.setAttribute("title",l.getLocaleString("searchLayersByText"));e.target.classList.remove(l.CLASS+"-btn-tree");l.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&n.classList.remove(TC.Consts.classes.HIDDEN)}}));l.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+l.CLASS+"-search button."+l.CLASS+"-search-btn-info",function(e){e.stopPropagation();const t=e.target;if(t.classList.contains(TC.Consts.classes.CHECKED)){t.classList.remove(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{const e=t.parentElement;var r=e;do{r=r.parentElement}while(r&&"LI"!==r.tagName);l.showLayerInfo(l.layers.length>1?l.layers[$(r).data(n)]:l.layers[0],$(e).data(o));t.classList.add(TC.Consts.classes.CHECKED)}}));const e="."+l.CLASS+" li";l.div.addEventListener("click",TC.EventTarget.listenerBySelector(e,function(r){r.stopPropagation();for(var s=r.target;s&&!s.matches(e);)s=s.parentElement;if(!s.classList.contains(l.CLASS+"-no-results"))if(s.classList.contains(l.CLASS+"-search-group"))s.classList.contains(TC.Consts.classes.COLLAPSED)?s.classList.remove(TC.Consts.classes.COLLAPSED):s.classList.add(TC.Consts.classes.COLLAPSED);else{var u=$(s).data(o);if(u){u=u.toString();if(!s.classList.contains(TC.Consts.classes.CHECKED)){var h=s;do{h=h.parentElement}while(h&&!h.matches("li."+l.CLASS+"-search-group"));const e=h?$(h).data(n):0,o=l.layers[e].options.url,r=l.layers[e].title,d=new TC.layer.Raster({id:l.getUID(),url:o,title:r,hideTitle:l.layers[e].hideTitle||l.layers[e].options.hideTitle,hideTree:!1,layerNames:[u]});if(d.isCompatible(l.map.crs)){l.map.addLayer(d,function(e){$(s).data(t,e);e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});s.classList.add(TC.Consts.classes.CHECKED);s.setAttribute(a,c)}else i(l,d)}}}}));l.searchInit=!0}$.isFunction(e)&&e()}).then(function(){c()}).catch(function(e){u(e)})})}))};e.getLayerRootNode=function(e){const o=this;var r=null;if(!e.isBase){var n=e.options.url;o._roots&&o._roots.forEach(function(o){var i=$(o).data(t);i&&i.type===e.type&&i.options.url===n&&(r=o)})}return r};e.getLayerNodes=function(e){const t=[],o=this.getLayerRootNode(e);if(o)for(var r=0;r<e.names.length;r++){const n=o.querySelector('li[data-tc-layer-name="'+e.names[r]+'"]');if(n){t[t.length]=n;n.querySelectorAll("li").forEach(function(e){t[t.length]=e})}}return t};e.showLayerInfo=function(e,n){const i=this;var a=null,s=i.div.querySelector("."+i.CLASS+"-info");const l=function(e,t){var r=!1;$(s).data(o);if(t){r=!0;$(s).data(o,e);s.classList.remove(TC.Consts.classes.HIDDEN);dust.render(i.CLASS+"-info",t,function(e,t){s.innerHTML=t;e&&TC.error(e);s.querySelector("."+i.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){i.hideLayerInfo()})})}return r};i.div.querySelectorAll("."+i.CLASS+"-btn-info, ."+i.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});for(var c=0,u=i._roots.length;c<u;c++){const s=i._roots[c];if($(s).data(t)===e){const e=s.querySelectorAll("."+i.CLASS+"-btn-info");for(var h=0,d=e.length;h<d;h++){const t=e[h];var p=$(t.parentElement).data(o).toString();if(p===n){const e=$(t).data(r),o=(l(p,e),i.div.querySelector('li [data-tc-layer-name="'+p+'"] > button.'+i.CLASS+"-btn-info"));l(p,e)?o.classList.add(TC.Consts.classes.CHECKED):o.classList.remove(TC.Consts.classes.CHECKED);a=e;break}}break}}return a};e.update=function(){const e=this;e.layers.forEach(function(t){t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);const r=e.getLayerRootNode(t);r&&r.querySelectorAll("li[data-tc-layer-name]").forEach(function(r){const n=$(r).data(o),i=r.querySelector("span."+TC.Consts.classes.SELECTABLE);if(t.compatibleLayers.indexOf(n)<0){i.classList.add(TC.Consts.classes.INCOMPATIBLE);i.setAttribute("title",e.getLocaleString("reprojectionNeeded"))}else{i.classList.remove(TC.Consts.classes.INCOMPATIBLE);i.removeAttribute("title")}})})})};e.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){const t=this;return new Promise(function(o,r){var n=[];t.options.layers&&t.options.layers.length&&(n=$.grep(t.options.layers,function(t){var o=TC.Util.reqGetMapOnCapabilities(t.url);return o&&o.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==n.length&&(n=$.grep(t.layers,function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==n.length){t.layers.push(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);e.title=e.title||e.wrap.getServiceTitle();t.render(function(){o()})})}else o()})};e.addLayerToMap=function(e,t){const o=this,r=$.extend({},e.options);r.id=o.getUID();r.layerNames=[t];r.title=e.title;const n=new TC.layer.Raster(r);n.isCompatible(o.map.crs)?o.map.addLayer(r).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})}):i(o,n)};e.loaded=function(){return this._readyPromise};e.getAvailableCRS=function(e){e=e||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,e.layer),includeFallbacks:!0})};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e).then(function(){t._layerToAdd&&t.map.addLayer(t._layerToAdd);TC.Util.closeModal()})}})};e.showProjectionChangeDialog=function(e){this._layerToAdd=e.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,e)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{else:o,block:r},{}).w("</ul></div>")}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}o.__dustBody=!0;function r(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["customLegend"],!1),t,{else:o,block:d},{})}t.__dustBody=!0;function o(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:i},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:h},{}).w("</ul></li>")}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}r.__dustBody=!0;function n(e,t){return e.w('class="tc-ctl-legend-node" ')}n.__dustBody=!0;function i(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{else:a,block:c},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}i.__dustBody=!0;function a(e,t){return e.x(t.getPath(!1,["legend","width"]),t,{block:s},{})}a.__dustBody=!0;function s(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:l},{}).w('"></div>')}s.__dustBody=!0;function l(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}l.__dustBody=!0;function c(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:u},{}).w(" />")}c.__dustBody=!0;function u(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;" ')}u.__dustBody=!0;function h(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}h.__dustBody=!0;function d(e,t){return e.f(t.get(["customLegend"],!1),t,"h",["s"])}d.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerUid";e.register=function(e){const t=this;e.on(TC.Consts.event.VIEWCHANGE,function(o){const r=o.view,n=t.loadGraphics.bind(t);r===TC.Consts.view.THREED?e.on(TC.Consts.event.LAYERADD,n):r===TC.Consts.view.DEFAULT&&e.off(TC.Consts.event.LAYERADD,n)});return TC.control.MapContents.prototype.register.call(t,e)};e.loadGraphics=function(){var e=this;e.getLayerUIElements().forEach(function(o){var r=$(o).data(t);r&&o.querySelectorAll("li."+e.CLASS+"-node-visible").forEach(function(t){const o=t.querySelector("img");o&&void 0!==o.getAttribute("src")&&0===o.getAttribute("src").length&&e.styleLegendImage(o,r)})})};e.updateScale=function(){var e=this,r=e.CLASS+"-node-inscale",n=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach(function(i){var a=$(i).data(t);if(a){var s=!1;i.querySelectorAll("li").forEach(function(t){if(t.classList.contains(e.CLASS+"-node-visible")){var i=$(t).data(o);if(a.isVisibleByScale(i)){s=!0;t.classList.remove(n);t.classList.add(r);const o=t.querySelector("img");o&&e.styleLegendImage(o,a)}else{t.classList.add(n);t.classList.remove(r)}}});if(s){i.classList.remove(n);i.classList.add(r)}else{i.classList.remove(r);i.classList.add(n)}}})};e.update=function(){var e=this;e.getLayerUIElements().forEach(function(r){var n=$(r).data(t);if(n){n.getTree();r.querySelectorAll("li").forEach(function(t){var r=$(t).data(o),i=e.CLASS+"-node-visible",a=e.CLASS+"-node-notvisible",s=e.CLASS+"-node-hasvisible";switch(n._cache.visibilityStates[r]){case TC.Consts.visibility.NOT_VISIBLE:t.classList.remove(i);t.classList.remove(s);t.classList.add(a);break;case TC.Consts.visibility.HAS_VISIBLE:t.classList.remove(i);t.classList.remove(a);t.classList.add(s);break;default:t.classList.remove(a);t.classList.remove(s);t.classList.add(i)}});e.updateLayerVisibility(n)}});e.updateScale()};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){if(e.hideTree||e.options.hideTree){e.tree=null;e.hideTree=e.options.hideTree=!1;e._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(r,e);r.div.querySelector("."+r.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r.CLASS+"-node",r.layerTrees[e.id],function(n,i){const a=(new DOMParser).parseFromString(i,"text/html").body.firstChild,s=$(a).data(o),l=r.div.querySelector("ul."+r.CLASS+"-branch"),c=l.querySelectorAll('li[data-tc-layer-uid="'+s+'"]');if(1===c.length){const e=c[0];e.innerHTML=a.innerHTML;e.setAttribute("class",a.getAttribute("class"))}else{$(a).data(t,e);l.insertBefore(a,l.firstChild)}n&&TC.error(n)});r.update()})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var o=this;o.getLayerUIElements().forEach(function(r){$(r).data(t)===e&&(e.getVisibility()?r.classList.remove(o.CLASS+"-node-notvisible"):r.classList.add(o.CLASS+"-node-notvisible"))})};e.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYLINE};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.LineFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.control.WorkLayerManager||TC.syncLoadJS(TC.apiLocation+"TC/control/WorkLayerManager");TC.control.ListTOC=TC.control.WorkLayerManager;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){const e=this;TC.Control.apply(e,arguments);e._waits={};window.addEventListener("error",function(){e.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var e=TC.control.LoadingIndicator.prototype;e.CLASS="tc-ctl-load";TC.isDebug?e.template=TC.apiLocation+"TC/templates/LoadingIndicator.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}t.__dustBody=!0;return t};e.startWait=function(e){const t=this,o=e.layer.id;void 0===t._waits[o]&&(t._waits[o]=0);t._waits[o]=t._waits[o]+1;t.show();t.map.trigger(TC.Consts.event.STARTLOADING)};e.stopWait=function(e){const t=this,o=e.layer.id;var r=t._waits[o];r>0&&(r=t._waits[o]=r-1);r||delete t._waits[o];var n=0;for(var i in t._waits)n++;if(!n){t.hide();t.map.trigger(TC.Consts.event.STOPLOADING)}};e.reset=function(e){this._waits={};this.hide();this.map.trigger(TC.Consts.event.STOPLOADING)};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(e){t.startWait(e)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(e){t.stopWait(e)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(){t.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(){t.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(e,o,r,n,i){t.reset();return!1});$(document).ajaxError(function(e,o,r){t.reset()})}return o};e.addWait=function(e){const t=e||TC.getUID();this.startWait({layer:{id:t}});return t};e.removeWait=function(e){this.stopWait({layer:{id:e}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featuresselect.tc";TC.Consts.event.FEATURESUNSELECT="featuresunselect.tc";TC.Consts.event.CHANGE="change";!function(){TC.control.Modify=function(){TC.Control.apply(this,arguments);if(!Modernizr.inputtypes.color&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}this.styles=$.extend(!0,TC.Cfg.styles.selection,this.options.styles);this.styles.text=this.styles.text||{fontSize:this.styles.line.fontSize,fontColor:this.styles.line.fontColor,labelOutlineColor:this.styles.line.labelOutlineColor,labelOutlineWidth:this.styles.line.labelOutlineWidth};this._classSelector="."+this.CLASS;this.wrap=new TC.wrap.control.Modify(this)};TC.inherit(TC.control.Modify,TC.Control);var e=TC.control.Modify.prototype;e.CLASS="tc-ctl-mod";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Modify.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="').h("i18n",t,{},{$key:"select"}).w('">').h("i18n",t,{},{$key:"select"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="').h("i18n",t,{},{$key:"deleteSelection"}).w('">').h("i18n",t,{},{$key:"deleteSelection"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="').h("i18n",t,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",t,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="').h("i18n",t,{},{$key:"splitGeometry"}).w('">').h("i18n",t,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="').h("i18n",t,{},{$key:"addText"}).w('">').h("i18n",t,{},{$key:"addText"}).w('</button><div class="tc-ctl-mod-style tc-hidden"><input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeTextForSketch"}).w('" style="font-size:').f(t.get(["fontSize"],!1),t,"h").w("pt;font-color:").f(t.get(["fontColor"],!1),t,"h").w(";text-shadow: 0 0 ").f(t.get(["labelOutlineWidth"],!1),t,"h").w("px ").f(t.get(["labelOutlineColor"],!1),t,"h").w(';" />').h("i18n",t,{},{$key:"textColor"}).w('<input type="color" class="tc-ctl-mod-fnt-c" value="').f(t.get(["fontColor"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"fontSize"}).w('<input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="').f(t.get(["fontSize"],!1),t,"h").w('" min="7" max="20" /></div>')}t.__dustBody=!0;return t};const t=function(e,t){e._deleteBtn.disabled=0===t.length;e._joinBtn.disabled=t.length<2;e._splitBtn.disabled=0===t.filter(o).length;e.displayLabelText()},o=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t};e.register=function(e){const o=this,r=TC.Control.prototype.register.call(o,e);if(o.options.layer){o.setLayer(o.options.layer);e.on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){Promise.all([o.getLayer(),o.renderPromise()]).then(function(t){const r=t[0];if(e.layer===r){o._selectBtn.disabled=!1;o._textBtn.disabled=!1}})}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){const r=e.layer,n=e.feature;Promise.all([o.getLayer(),o.renderPromise()]).then(function(e){if(r===e[0]){n?o.unselectFeatures([n]):o.unselectFeatures();t(o,o.getSelectedFeatures());if(0===o.layer.features.length){o._selectBtn.disabled=!0;o.setTextMode(!1);o._textBtn.disabled=!0}}})});const r=function(){const e=o.getSelectedFeatures();t(o,e);o.layer.features.filter(function(t){return e.indexOf(t)<0}).forEach(function(e){e.toggleSelectedStyle(!1)});e.forEach(function(e){e.toggleSelectedStyle(!0)})};o.on(TC.Consts.event.FEATURESSELECT,r).on(TC.Consts.event.FEATURESUNSELECT,r)}return r};e.render=function(e){const t=this,o=function(){t._selectBtn=t.div.querySelector("."+t.CLASS+"-btn-select");t._selectBtn.addEventListener(TC.Consts.event.CLICK,function(e){e.target.disabled||(t.isActive?t.deactivate():t.activate())});t._deleteBtn=t.div.querySelector("."+t.CLASS+"-btn-delete");t._deleteBtn.addEventListener(TC.Consts.event.CLICK,function(){t.deleteSelectedFeatures()});t._textBtn=t.div.querySelector("."+t.CLASS+"-btn-text");t._textBtn.addEventListener(TC.Consts.event.CLICK,function(){t.setTextMode(!t.textActive)});t._joinBtn=t.div.querySelector("."+t.CLASS+"-btn-join");t._splitBtn=t.div.querySelector("."+t.CLASS+"-btn-split");t._textInput=t.div.querySelector("input."+t.CLASS+"-txt");t._textInput.addEventListener("input",function(e){t.labelFeatures(e.target.value)});t._styleSection=t.div.querySelector("."+t.CLASS+"-style");t._fontColorPicker=t.div.querySelector(t._classSelector+"-fnt-c");t._fontColorPicker.addEventListener(TC.Consts.event.CHANGE,function(e){t.setFontColor(e.target.value)});t._fontSizeSelector=t.div.querySelector("."+t.CLASS+"-fnt-s");t._fontSizeSelector.addEventListener(TC.Consts.event.CHANGE,function(e){t.setFontSize(e.target.value)});$.isFunction(e)&&e()},r={fontSize:t.styles.text.fontSize,fontColor:t.styles.text.fontColor,labelOutlineColor:t.styles.text.labelOutlineColor,labelOutlineWidth:t.styles.text.labelOutlineWidth};return Modernizr.inputtypes.color?t._set1stRenderPromise(t.renderData(r,o)):t._set1stRenderPromise(t.renderData(r,function(){const e=t.div.querySelector("input[type=color]");e.style.backgroundColor=e.value;e.style.color="transparent";const r=new CP(e,"click",document.body);e.onclick=function(e){e.preventDefault()};e.onfocus=function(e){this.blur()};e.onchange=function(e){this.style.backgroundColor=this.value};t.map.loaded(function(){r.on("change",function(e){t.setFontColor("#"+e)})});o()}))};e.activate=function(){this._selectBtn.classList.add(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode)};e.deactivate=function(){const e=this;TC.Control.prototype.deactivate.call(e);e._selectBtn&&t(e,[]);e.wrap&&e.wrap.deactivate();if(e._selectBtn){e._selectBtn.classList.remove(TC.Consts.classes.ACTIVE);e.layer.features.forEach(function(e){e.toggleSelectedStyle(!1)})}};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();return this};e.setMode=function(e,t){const o=this;e&&(o.mode=e);if(t&&e){o.layer&&o.layer.map.putLayerOnTop(o.layer);o.activate()}else o.deactivate();return o};e.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?Promise.resolve(null):this.layer?Promise.resolve(this.layer):this._layerPromise};e.setLayer=function(e){var t=this;t.map&&(t._layerPromise=new Promise(function(o,r){if("string"==typeof e)t.map.loaded(function(){t.layer=t.map.getLayer(e);o(t.layer)});else{t.layer=e;o(t.layer)}}))};e.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};e.setSelectedFeatures=function(e){const t=this.wrap.setSelectedFeatures(e);this.displayLabelText();return t};e.getActiveFeatures=function(){const e=this,t=e.getSelectedFeatures();!t.length&&e.layer.features.length&&t.push(e.layer.features[e.layer.features.length-1]);return t};e.unselectFeatures=function(e){e=e||[];this.wrap.unselectFeatures(e.map(function(e){return e.wrap.feature}));return this};e.deleteSelectedFeatures=function(){const e=this,t=e.getSelectedFeatures();e.wrap.unselectFeatures(t);t.forEach(function(t){e.layer.removeFeature(t)});return e};e.styleFunction=function(e,t){var o;const r=this.map.options.styles.selection;switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:o=$.extend({},r.polygon);break;case TC.feature.Point&&e instanceof TC.feature.Point:case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:o=$.extend({},r.point);break;default:o=$.extend({},r.line)}const n=e.getStyle();if(n.label){o.label=n.label;o.fontSize=n.fontSize;o.fontColor=n.fontColor;o.labelOutlineColor=n.labelOutlineColor;o.labelOutlineWidth=n.labelOutlineWidth}return o};e.setTextMode=function(e){const t=this;t.textActive=e;if(e){t._textBtn.classList.add(TC.Consts.classes.ACTIVE);t._textBtn.classList.add(e)}else{t._textBtn.classList.remove(TC.Consts.classes.ACTIVE);t._textBtn.classList.remove(e)}e?t._styleSection.classList.remove(TC.Consts.classes.HIDDEN):t._styleSection.classList.add(TC.Consts.classes.HIDDEN);t.displayLabelText();return t};e.setFontColorWatch=function(e,t){const o=this;void 0===e&&(e=o.styles.text.fontColor);e=TC.Util.colorArrayToString(e);t=t||o.getLabelOutlineColor(e);o.renderPromise().then(function(){o._fontColorPicker.value=e;o._textInput.style.color=e;o._textInput.style.textShadow="0 0 "+o.styles.text.labelOutlineWidth+"px "+t;if(!Modernizr.inputtypes.color){o._fontColorPicker.style.backgroundColor=e;o._fontColorPicker.blur()}});return o};e.setFontColor=function(e){const t=this;t.styles.text.fontColor=e;t.styles.text.labelOutlineColor=t.getLabelOutlineColor(e);t.setFontColorWatch(e,t.styles.text.labelOutlineColor);t.getActiveFeatures().forEach(function(o){const r=o.getStyle();r.fontColor=e;r.labelOutlineColor=t.styles.text.labelOutlineColor;o.setStyle(r)});return t};e.setFontSizeWatch=function(e){const t=this;void 0===e&&(e=t.styles.text.fontSize);const o=parseInt(e);o!==Number.NaN&&t.renderPromise().then(function(){t._fontSizeSelector.value=o;t._textInput.style.fontSize=o+"pt"});return t};e.setFontSize=function(e){const t=this,o=parseInt(e);if(o!==Number.NaN){t.styles.text.fontSize=o;t.setFontSizeWatch(o);t.getActiveFeatures().forEach(function(e){const t=e.getStyle();t.fontSize=o;e.setStyle(t)})}return t};e.getLabelOutlineColor=function(e){if(e){const t=(e=TC.Util.colorArrayToString(e)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const o=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(o&&o.length){return(parseInt(o[1],16)+parseInt(o[2],16)+parseInt(o[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"};e.displayLabelText=function(){const e=this,t=e.getSelectedFeatures();var o,r,n;if(e.isActive&&t.length){const e=t[t.length-1].getStyle();o=e.label;n=e.fontColor;r=e.fontSize}else{o="";n=e.styles.text.fontColor;r=e.styles.text.fontSize}e.renderPromise().then(function(){e.setFontSizeWatch(r).setFontColorWatch(n)._textInput.value=o});return e};e.labelFeatures=function(e){const t=this,o=t.getActiveFeatures();if(o.length){const r=o[0].getStyle();o.forEach(function(o){const n=$.extend({},t.styles.text,r);r.label=e;r.labelOffset=n.labelOffset;r.fontColor=n.fontColor;r.fontSize=n.fontSize;r.labelOutlineColor=n.labelOutlineColor;r.labelOutlineWidth=n.labelOutlineWidth;o.setStyle(r)})}return t}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){this.lineColor=null;TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.fInfoCtrl=null;this.lineFInfoCtrl=null;this.polygonFInfoCtrl=null;this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";TC.isDebug?e.template=TC.apiLocation+"TC/templates/MultiFeatureInfo.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",t,{},{$key:"selection"}).w("</span>").x(t.get(["pointSelectValue"],!1),t,{block:o},{}).x(t.get(["lineSelectValue"],!1),t,{block:r},{}).x(t.get(["polygonSelectValue"],!1),t,{block:n},{}).w("</form></div>")}t.__dustBody=!0;function o(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",t,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["pointSelectValue"],!1),t,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPoint"}).w("</span></label>")}o.__dustBody=!0;function r(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",t,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["lineSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byLine"}).w("</span></label>")}r.__dustBody=!0;function n(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",t,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["polygonSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPrecinct"}).w("</span></label>")}n.__dustBody=!0;return t};const t=function(e,t){if(!0===e){e={};return $.extend(e,t)}return e};e.register=function(e){const o=this;return new Promise(function(r,n){const i=[TC.Control.prototype.register.call(o,e)];o.modes[TC.Consts.geom.POINT]&&i.push(e.addControl("featureInfo",t(o.modes[TC.Consts.geom.POINT],{displayMode:o.options.displayMode})).then(function(e){o.fInfoCtrl=e;return e}));o.modes[TC.Consts.geom.POLYLINE]&&i.push(e.addControl("lineFeatureInfo",t(o.modes[TC.Consts.geom.POLYLINE],{displayMode:o.options.displayMode,lineColor:o.lineColor})).then(function(e){o.lineFInfoCtrl=e;return e}));o.modes[TC.Consts.geom.POLYGON]&&i.push(e.addControl("polygonFeatureInfo",t(o.modes[TC.Consts.geom.POLYGON],{displayMode:o.options.displayMode,lineColor:o.lineColor})).then(function(e){o.polygonFInfoCtrl=e;return e}));Promise.all(i).then(function(){if(o.fInfoCtrl){o.fInfoCtrl.activate();o.lastCtrlActive=o.fInfoCtrl}r(o)})})};e.render=function(e){const t=this;t.lineColor=t.options.lineColor?t.options.lineColor:"#c00";var o={};t.modes[TC.Consts.geom.POINT]&&(o.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(o.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(o.polygonSelectValue=TC.Consts.geom.POLYGON);return TC.Control.prototype.renderData.call(t,o,function(){var o=function(){switch(this.value){case TC.Consts.geom.POLYLINE:console.log("seleccion por l\xednea");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.polygonFInfoCtrl||t.lineFInfoCtrl.activate();t.lastCtrlActive=t.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:console.log("seleccion por pol\xedgono");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.polygonFInfoCtrl.activate();t.lastCtrlActive=t.polygonFInfoCtrl;break;default:console.log("seleccion por punto");t.map.activeControl!==t.polygonFInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}};t.div.querySelectorAll("input[type=radio]").forEach(function(e){e.addEventListener("change",o)});$.isFunction(e)&&e()})};e.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};e.deactivate=function(){this.lastCtrlActive.deactivate(!1)};TC.Map.prototype.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.MultiFeatureInfo");return e&&e.length?e[0].lastCtrlActive:(e=this.getControlsByClass("TC.control.FeatureInfo"))&&e.length?e[0]:null}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var e=TC.control.NavBar.prototype;e.CLASS="tc-ctl-nav";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBar(this));return this._set1stRenderPromise(Promise.resolve())};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.wrap.register(e);(void 0===t.options.home||t.options.home)&&e.addControl("navBarHome");e.loaded(function(){t.wrap.refresh()});return o}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBarHome=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBarHome,TC.Control);!function(){var e=TC.control.NavBarHome.prototype;e.CLASS="tc-ctl-nav-home";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBarHome(this));return Promise.resolve()};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.wrap.register(e);e.on(TC.Consts.event.PROJECTIONCHANGE,function(o){const r=o.crs;var n=TC.Util.reproject([e.options.initialExtent[0],e.options.initialExtent[1]],e.options.crs,r),i=TC.Util.reproject([e.options.initialExtent[2],e.options.initialExtent[3]],e.options.crs,r);t.wrap.setInitialExtent([n[0],n[1],i[0],i[1]])});return o}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.isLoaded=!1;this.layer=null};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";TC.isDebug?e.template=TC.apiLocation+"TC/templates/OverviewMap.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,o=function(t){return function(t){var o,r=function(e,t){for(var o=null,r=0;r<t.length;r++){var n=t[r];if((n.id||n)===e){o=n;break}}return o};if("string"==typeof t){var n=r(t,e.options.availableBaseLayers);$.isPlainObject(n)||(n=r(t,e.options.baseLayers));$.isPlainObject(n)&&(o=new TC.layer.Raster(n))}else o=t instanceof TC.Layer?t:t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t);return o}(t)};return new Promise(function(r,n){TC.Control.prototype.register.call(t,e).then(function(n){t.wrap=new TC.wrap.control.OverviewMap(t);e.loaded(function(){t.defaultLayer=o(t.options.layer);t.layer=o(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.options.availableBaseLayers[0]);t.wrap.register(e);!function(o){const r={};t.layer.getCapabilitiesPromise().then(function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(r.layer=t.layer.getFallbackLayer());t.wrap.reset(r)})}(e.crs);e.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(e){const t=this;if(t.map.baseLayer.type===TC.Consts.layerType.WMS||t.map.baseLayer.type===TC.Consts.layerType.WMTS||t.options.layer){var r=t.map.baseLayer.overviewMapLayer||t.options.layer;if(t.layer.id!==r){var n=o(r);t.wrap.reset({layer:n}).then(function(e){t.layer=e})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(e.type)>-1&&t.wrap.reset({layer:t.layer}).then(function(e){t.layer=e})}}.bind(t))});r(n)}).catch(function(e){n(e)})})};e.loaded=function(e){$.isFunction(e)&&(this.isLoaded&&this.map&&this.map.isLoaded?e():this.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};e.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYGON};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);TC.control.PolygonFeatureInfo.prototype.CLASS="tc-ctl-finfo"}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var e=TC.control.Popup.prototype;e.CLASS="tc-ctl-popup";e.render=function(){const e=this;return e._set1stRenderPromise(new Promise(function(t,o){e.map.wrap.addPopup(e).then(function(){e.trigger(TC.Consts.event.CONTROLRENDER);t()},function(e){o(e instanceof Error?e:Error(e))})}))};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);return new Promise(function(r,n){Promise.all([o,t.renderPromise()]).then(function(){e.on(TC.Consts.event.VIEWCHANGE,function(){e.view===TC.Consts.view.PRINTING&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.LAYERREMOVE,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.UPDATE,function(){t.currentFeature&&t.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||t.isVisible()&&t.hide()});e.on(TC.Consts.event.FEATUREREMOVE,function(e){t.currentFeature===e.feature&&t.isVisible()&&t.hide()});r(t)}).catch(function(e){n(e instanceof Error?e:Error(e))})})};e.fitToView=function(e){var t=this;e?setTimeout(function(){t.wrap.fitToView()},1e3):t.wrap.fitToView()};e.hide=function(){if(this.map){this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.trigger(TC.Consts.event.POPUPHIDE,{control:this})}};e.getContainerElement=function(){return this.contentDiv||null};e.getMenuElement=function(){return this.menuDiv||null};e.setDragged=function(e){const t=this;t.dragged=e;t.popupDiv&&(e?t.popupDiv.classList.add(TC.Consts.classes.DRAGGED):t.popupDiv.classList.remove(TC.Consts.classes.DRAGGED));t.wrap.setDragged(e)};e.setDragging=function(e){const t=this;if(e){t.setDragged(!0);t.popupDiv.classList.add(TC.Consts.classes.DRAG)}else t.popupDiv.classList.remove(TC.Consts.classes.DRAG)};e.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(e){var t=this,o=e||{};t.ready=!1;t.title=o.title||TC.Util.getLocaleString(TC.Cfg.locale,"printPage");t.cssUrl=o.cssUrl||TC.apiLocation+"TC/css/print.css";if(o.target){const e=o.target;if(!e.querySelector("."+t.CLASS+"-btn")){for(var r in t.template)dust.cache[r]||t.template[r]();e.classList.add(TC.Consts.classes.PRINTABLE);var n=function(o){var r=open(null,t.CLASS),n=e.innerHTML;dust.render(t.CLASS+"-page",{title:t.title,content:n,cssUrl:t.cssUrl},function(e,t){r.document.write(t);r.document.close();r.focus();e&&TC.error(e)})};dust.render(t.CLASS,null,function(o,r){e.firstChild?e.firstChild.insertAdjacentHTML("beforebegin",r):e.innerHTML=r;e.querySelector("."+t.CLASS+"-btn").addEventListener("click",n)})}}};!function(){var e=TC.control.Print.prototype;e.CLASS="tc-ctl-print";e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<a class="tc-ctl-print-btn" title="').h("i18n",t,{},{$key:"printThisWindow"}).w('">').h("i18n",t,{},{$key:"print"}).w("</a>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-page"]=function(){dust.register(e.CLASS+"-page",t);function t(e,t){return e.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(t.get(["title"],!1),t,"h").w('</title><link rel="stylesheet" href="').f(t.get(["cssUrl"],!1),t,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(t.get(["title"],!1),t,"h").w("</h1>").f(t.get(["content"],!1),t,"h",["s"]).w("</body></html>")}t.__dustBody=!0;return t}}();TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.PrintMap=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintMap,TC.control.MapInfo);!function(){var e=TC.control.PrintMap.prototype;e.CLASS="tc-ctl-printMap";const t="portrait",o="landscape",r="A4",n="A3";var i={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},a={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},s={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},l={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}};const c=function(e,c){switch(e){case t:switch(c){case r:return i;case n:return s}break;case o:switch(c){case r:return a;case n:return l}break;default:return i}},u=function(e){return e.layoutPDF.content[0].columns[0]},h=function(e){return e.layoutPDF.content[0].columns[2]},d={sideLength:85};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/PrintMap.html";e.template[e.CLASS+"-view"]=TC.apiLocation+"TC/templates/PrintMapView.html";e.template[e.CLASS+"-tools"]=TC.apiLocation+"TC/templates/PrintMapTools.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",t,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",t,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",t,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt tc-ctl-printMap-cnt-btn"><input id="tc-ctl-printMap-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-printMap-image-qr" class="tc-ctl-printMap-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"printMap"}).w('">').h("i18n",t,{},{$key:"print"}).w('</button></div><div class="tc-group tc-ctl-printMap-cnt"><div class="tc-ctl-printMap-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w("</p></div></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-view"]=function(){dust.register(e.CLASS+"-view",t);function t(e,t){return e.w('<div class="tc-ctl-printMap-view"> </div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-tools"]=function(){dust.register(e.CLASS+"-tools",t);function t(e,t){return e.w('<div class="tc-ctl-printMap-tools"><div class="tc-ctl-printMap-btn-pdf" title="').h("i18n",t,{},{$key:"printpdf"}).w('"></div><div class="tc-ctl-printMap-btn-close" title="').h("i18n",t,{},{$key:"close"}).w('"></div></div> ')}t.__dustBody=!0;return t}}const p=function(){return this.map.workLayers.some(function(e){return e.type===TC.Consts.layerType.WMS&&e.getVisibility()})};e.register=function(e){const o=this,r=TC.control.MapInfo.prototype.register.call(o,e);o.map.mustBeExportable=!0;const n=function(){c(o.orientation||t,o.format.toString().toUpperCase()||"A4").reset()};o.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+o.CLASS+"-btn",function(){o.map.setView(TC.Consts.view.PRINTING);var e=document.querySelector("."+o.CLASS+"-qrcode");if(document.querySelector("#"+o.CLASS+"-image-qr").checked){if(!e){(e=document.createElement("div")).classList.add(o.CLASS+"-qrcode");o.map.div.appendChild(e)}e.innerHTML="";o.makeQRCode(e,d.sideLength,d.sideLength)}else e&&(e.innerHTML="");const r="."+o.CLASS+"-btn";o.map.on(TC.Consts.event.STARTLOADING,function(){const e=o.div.querySelector(r);e.classList.add("disabled");e.disabled=!0});o.map.on(TC.Consts.event.STOPLOADING,function(){const e=o.div.querySelector(r);e.classList.remove("disabled");e.disabled=!1});p.call(o)&&o.map.on(TC.Consts.event.ZOOM,n);const i=function(e){if(e){o.map.div.classList.add(e);var t=o.map.div.getBoundingClientRect();Number.isInteger(t.width)||(o.map.div.style.width=Math.round(t.width)+"px");Number.isInteger(t.height)||(o.map.div.style.height=Math.round(t.height)+"px");o.map.toast(o.getLocaleString("print.advice.title")+": "+o.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3})}o.map.wrap.map.updateSize()},a=function(){c(o.orientation||t,o.format.toString().toUpperCase()||"A4").reset();p.call(o)&&o.map.off(TC.Consts.event.ZOOM,n);o.map.toastHide(o.getLocaleString("print.advice.title")+": "+o.getLocaleString("print.advice.desc"));o.map.div.classList.remove(o.currentFormat);o.map.div.classList.remove(o.CLASS+"-printing");o.map.div.style.removeProperty("width");o.map.div.style.removeProperty("height");i();o.map.setView(TC.Consts.view.DEFAULT);o._viewDiv.classList.add(TC.Consts.classes.HIDDEN)};if(!o._viewDiv){o._viewDiv=TC.Util.getDiv();document.body.appendChild(o._viewDiv);o.getRenderedHtml(o.CLASS+"-view",null,function(e){o._viewDiv.innerHTML=e});o.getRenderedHtml(o.CLASS+"-tools",null,function(e){o.map.div.lastElementChild.insertAdjacentHTML("afterend",e);o.map.div.querySelector("."+o.CLASS+"-btn-close").addEventListener("click",a);o.map.div.querySelector("."+o.CLASS+"-btn-pdf").addEventListener("click",o.createPdf.bind(o))})}o.orientation=o.div.querySelector("#print-design").value;o.format=o.div.querySelector("#print-size").value;o.currentFormat=o.CLASS+"-"+o.orientation+"-"+o.format;o._viewDiv.classList.remove(TC.Consts.classes.HIDDEN);o.map.div.classList.add(o.CLASS+"-printing");i(o.currentFormat)}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("#"+o.CLASS+"-image-qr",function(e){o.generateLink()}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){o.generateLink();o.registerListeners()}));return r};e.createPdf=function(){var e=this,o=e.map.getControlsByClass(TC.control.LoadingIndicator)[0],r=o.addWait();TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){const n=e.map.div.querySelectorAll(".ol-viewport");for(var i=0,a=n.length;i<a;i++){const t=n[i];if(!t.parentElement.classList.contains("ol-overviewmap-map")){e.canvas=t.querySelector("canvas");break}}var s=c(e.orientation||t,e.format.toString().toUpperCase()||"A4"),l=s.layoutPDF;const p=function(t){var n=window.location.host+"_",i=e.div.querySelector("."+e.CLASS+"-title").value.trim();if(i)n+=i;else{n+=TC.Util.getFormattedDate((new Date).toString(),!0)}try{pdfMake.createPdf(t).download(n.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(t){e.map.toast(e.getLocaleString("print.error"),{type:TC.Consts.msgType.ERROR});TC.error(t.message+"  "+t.stack,TC.Consts.msgErrorMode.EMAIL)}o.removeWait(r)},f=function(t){TC.error(e.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},g=function(){var t=[],o=[],r=function(e,t,o){if(t.isVisibleByScale(e.name)){var r,n;t.options&&t.options.params&&t.options.params.base64LegendSrc?n=t.options.params.base64LegendSrc:e.legend&&(r=e.legend.src);result.push({src:r,title:e.title,level:o,srcBase64:n})}},n=function(e,t,o,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)n(e[i],t,o,r);else if(e&&e.hasOwnProperty("children")&&e.children.length>0){e.title&&e.name&&result.push({header:e.title,level:r});n(e.children,t,o,++r)}if(e&&e.hasOwnProperty("children")&&0==e.children.length){t.apply(this,[e,o,r]);r--}};e.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS&&e.getVisibility()}).forEach(function(e){result=[];var t=e.options.hideTree;e.tree=null;e.options.hideTree=!0;n(e.getTree(),r,e,0);e.options.hideTree=t;result.length>0&&o.push({title:e.title,layers:result})});return new Promise(function(e,r){Promise.all(function(){for(var e=[],t=0;t<o.length;t++)for(var r=o[t].layers,n=0;n<r.length;n++)!function(r,n){var i=o[t].layers[n],a=i.src||i.srcBase64;if(a){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");e.push(new Promise(function(e,t){new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!0}).fetchImage(a,{exportable:!0}).then(function(t){if(t.complete){var o=TC.Util.imgTagToDataUrl(t,"image/png");i.image={base64:o.base64,canvas:o.canvas}}else f(a);e()},function(e){f(a);t()})}))}}(0,n);return e}()).then(function(){o.map(function(e,t){return{groupIndex:t,height:e.layers.filter(function(e){return e.image&&e.image.canvas}).reduce(function(e,t,o,r){return e+r[o].image.canvas.height},0)}}).sort(function(e,t){return e.height>t.height?1:e.height<t.height?-1:0}).forEach(function(e,r){!function(e,o){var r=[[{text:e.title,colSpan:2,alignment:"left",fontSize:11,margin:[0,o>0?10:0,0,5]},{}]];const n=(r=r.concat(e.layers.filter(function(t){return t.hasOwnProperty("header")&&t.header.trim().toLowerCase()!==e.title.trim().toLowerCase()}).map(function(e){return[{text:e.header.trim(),colSpan:2,alignment:"left",margin:[10*e.level,0,0,3]},{}]}))).length;var i=null,a=null;e.layers.forEach(function(e,t){if(e.header){i=e;a&&(a=null)}else{a||(a=1);var o;i&&(o=r.map(function(e){return e[0].text}).indexOf(i.header)+a++);if(e.image){var n=e.image.canvas.width/2,s=n*e.image.canvas.height/e.image.canvas.width,l=[{text:e.title,fontSize:9,width:"auto",margin:[10*e.level,0,0,2]},{image:e.image.base64,width:n,height:s,margin:[10*e.level,0,0,2]}];o?r.splice(o,0,l):r.push(l)}else{l=[{text:e.title,fontSize:9,colSpan:2,margin:[10*e.level,0,0,2]},{}];o?r.splice(o,0,l):r.push(l)}}});t.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:n,body:r}})}(o[e.groupIndex],r)});e(t)},function(){r([])})})},m=[function(){const t=function(){var e=u(s);delete e.image;e.text="";return e};return e.options.logo?TC.Util.imgToDataUrl(e.options.logo,"image/png").then(function(e){const t=e.canvas,o=e.dataUrl;TC.Util.calculateAspectRatioFit(t.width,t.height,s.logoWidth,s.logoHeight);var r=u(s);r.image=o;return r},function(){f(e.options.logo);return t()}):t()},function(){var t=function(e){return e.layoutPDF.content[0].columns[1]}(s);t.text=e.div.querySelector("."+e.CLASS+"-title").value.trim();return t},function(){const t=function(){var e=h(s);delete e.image;e.text="";e.width="auto";return e};var o=e.map.getControlsByClass(TC.control.ScaleBar)[0];if(o){var r=document.getElementsByClassName("ol-scale-line-inner"),n=r[0].getBoundingClientRect();if(n){var i=getComputedStyle(r[0],null),a=parseInt(i.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(i.getPropertyValue("border-right-width").replace("px",""))||0,c=h(s);c.table={widths:[.75*((n.width>n.height?n.width:n.height)-a-l)],body:[[{border:[!0,!1,!0,!0],text:o.getText(),fontSize:10,alignment:"center"}]]};c.layout={paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}};return c}t()}else t()},function(){if(document.querySelector("#"+e.CLASS+"-image-qr").checked){const t=document.querySelector("."+e.CLASS+"-qrcode");t.innerHTML="";return e.makeQRCode(t,d.sideLength,d.sideLength).then(function(t){if(t)return TC.Util.addToCanvas(e.canvas,t,{x:e.canvas.width-d.sideLength,y:e.canvas.height-d.sideLength},{width:d.sideLength,height:d.sideLength}).then(function(e){return e});TC.error(e.getLocaleString("print.qr.error"));return e.canvas})}return e.canvas}];Promise.all(m.map(function(e){return e()})).then(function(t){t[2].table&&(s.layoutPDF.content[0].columns[1].width=s.layoutPDF.pageSize.width-(s.layoutPDF.pageMargins[0]+s.layoutPDF.pageMargins[2])-s.layoutPDF.content[0].columns[0].width-(s.layoutPDF.content[0].columns[2].table.widths[0]+2));var o=function(e){return e.layoutPDF.content[1].table.body[0][0]}(s),r=t[3]||e.canvas;o.image=r.toDataURL();if(e.options.legend&&e.options.legend.visible&&function(){return this.map.workLayers.some(function(e){if(e.type===TC.Consts.layerType.WMS&&e.getVisibility()){for(var t=0;t<e.names.length;t++)if(e.isVisibleByScale(e.names[t]))return!0;return!1}return!1})}.call(e)&&2==l.content.length){const t=e.div.querySelector("."+e.CLASS+"-title").value.trim();l.content.push({pageBreak:"before",pageOrientation:e.options.legend.orientation||"portrait",text:t.length>0?t:"",fontSize:14,margin:[0,20,0,10]});g().then(function(e){l.content=l.content.concat(e);p(l)})}else p(l)})})};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");document.querySelector("#"+this.CLASS+"-image-qr").checked&&e.qr?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa",SHOW_IN:"showIn",SHOW_OUT:"showOut"};this.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};this.content=this.contentType.TABLE;$.isEmptyObject(this.options)&&(this.options={content:"table"});this.options;this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.template={};ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};if(TC.isDebug){ctlProto.template[ctlProto.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";ctlProto.template[ctlProto.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";ctlProto.template[ctlProto.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{ctlProto.template[ctlProto.CLASS]=function(){dust.register(ctlProto.CLASS,e);function e(e,t){return e.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><span class="prpanel-title-text"></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="').h("i18n",t,{},{$key:"export.excel"}).w('"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="tc-ctl-p-results-menu"></div><div class="prpanel-body list-group tc-ctl-p-results-info"></div><div class="prpanel-body list-group tc-ctl-p-results-table"></div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"expand"}).w('" data-no-cb><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}e.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-table"]=function(){dust.register(ctlProto.CLASS+"-table",e);function e(e,r){return e.w('<table class="table" style="display:none;"><thead>').s(r.get(["columns"],!1),r,{block:t},{}).w("</thead><tbody>").s(r.get(["results"],!1),r,{block:o},{}).w("</tbody></table>")}e.__dustBody=!0;function t(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}t.__dustBody=!0;function o(e,t){return e.w("<tr>").h("iterate",t,{block:r},{on:t.getPath(!0,[])}).w("</tr>")}o.__dustBody=!0;function r(e,t){return e.w("<td>").f(t.get(["value"],!1),t,"h").w("</td>")}r.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-chart"]=function(){dust.register(ctlProto.CLASS+"-chart",e);function e(e,r){return e.w('<div class="tc-track-chart">').x(r.get(["msg"],!1),r,{else:t,block:o},{}).w("</div>")}e.__dustBody=!0;function t(e,t){return e.w('<span id="elevationGain" >').h("i18n",t,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(t.get(["upHill"],!1),t,"h").w("m, -").f(t.get(["downHill"],!1),t,"h").w('m</span><div class="tc-chart"></div>')}t.__dustBody=!0;function o(e,t){return e.f(t.get(["msg"],!1),t,"h")}o.__dustBody=!0;return e}}const isElementVisible=function(e){const t=getComputedStyle(e);return e&&!e.hidden&&"none"!==t.display&&"hidden"!==t.visibility};ctlProto.isVisible=function(){const e=this.div.querySelector(".prsidebar-body"),t=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)||isElementVisible(t)};ctlProto.isMinimized=function(){const e=this.div.querySelector(".prsidebar-body"),t=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)&&!isElementVisible(e)};const manageClassList=function(e,t,o){const r=this.div.querySelector("."+e);if(r){r.classList.add(t);r.classList.remove(o)}};ctlProto.show=function(e){const t=this.div.querySelector("."+e);t&&"none"===t.style.display&&(t.style.display="");manageClassList.call(this,e,this.classes.SHOW_IN,this.classes.SHOW_OUT)};ctlProto.hide=function(e){manageClassList.call(this,e,this.classes.SHOW_OUT,this.classes.SHOW_IN);const t=this.div.querySelector("."+e);t&&(t.style.display="none")};ctlProto.doVisible=function(){this.div.classList.remove(TC.Consts.classes.HIDDEN);this.show("prsidebar-body")};ctlProto.render=function(e){const t=this;t.div.classList.add(TC.Consts.classes.HIDDEN);return TC.Control.prototype.render.call(t,function(){t.mainTitleElm=t.div.querySelector(".prpanel-title-text");t.minimizeButton=t.div.querySelector(".prcollapsed-slide-submenu-min");t.minimizeButton.addEventListener("click",function(){t.minimize()});t.closeButton=t.div.querySelector(".prcollapsed-slide-submenu-close");t.closeButton.addEventListener("click",function(){t.close()});t.maximizeButton=t.div.querySelector(".prcollapsed-max");t.maximizeButton.addEventListener("click",function(){t.maximize()});if(t.save){t.saveButton=t.div.querySelector(".prcollapsed-slide-submenu-csv");t.saveButton.addEventListener("click",function(){t.exportToExcel()});t.saveButton.removeAttribute("hidden")}if(t.content){t.content=t.content;if(t.options.titles){if(t.options.titles.main){t.mainTitleElm.setAttribute("title",t.options.titles.main);t.mainTitleElm.innerHTML=t.options.titles.main}t.options.titles.max&&t.maximizeButton.setAttribute("title",t.options.titles.max)}else{t.mainTitleElm.setAttribute("title",t.getLocaleString("rsp.title"));t.mainTitleElm.innerHTML=t.getLocaleString("rsp.title")}}t.div.querySelector(t.content.collapsedClass).classList.add(t.classes.FA);t.infoDiv=t.div.querySelector("."+t.CLASS+"-info");t.tableDiv=t.div.querySelector("."+t.CLASS+"-table");t.menuDiv=t.div.querySelector("."+t.CLASS+"-menu");Modernizr.touch&&TC.Util.swipe(t.div,{left:function(){t.minimize()}});e&&"function"==typeof e&&e.call()})};ctlProto.minimize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);if(!isElementVisible(t)){t.classList.add(e.classes.FA);t.hidden=!1;e.hide("prsidebar-body");e.show("prcollapsed-max");e.map.trigger(TC.Consts.event.RESULTSPANELMIN,{control:e})}};ctlProto.maximize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);if(isElementVisible(t)){t.hidden=!0;e.show("prsidebar-body");e.hide("prcollapsed-max");e.map.trigger(TC.Consts.event.RESULTSPANELMAX,{control:e})}};ctlProto.close=function(){const e=this;e.div.classList.add(TC.Consts.classes.HIDDEN);e.chart&&e.chart.chart&&(e.chart.chart=e.chart.chart.destroy());const t=e.div.querySelector(".prsidebar-body");if(t){t.style.display="none";e.div.querySelector(".prcollapsed-max").style.display="none";const o=e.div.querySelector(e.content.collapsedClass);o.hidden=!0;o.classList.remove(e.classes.FA);e.map.trigger(TC.Consts.event.RESULTSPANELCLOSE,{control:e})}};ctlProto.openChart=function(e){const t=this;t.div.classList.remove(TC.Consts.classes.HIDDEN);t.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return e!==t}).filter(function(e){return"chart"===e.options.content}).forEach(function(e){e.close()});if(e)if(e.msg)t.map.toast(e.msg);else{t.elevationProfileCoordinates=e.coords;t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+ctlProto.CLASS+"-chart")})}else t.map.toast(options.msg);t.map.getLoadingIndicator().hide()};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data,div=options.div;var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(ctlProto.CLASS+"-chart",{upHill:data.upHill.toLocaleString(locale),downHill:data.downHill.toLocaleString(locale)},function(out){div.innerHTML=out;div.style.display="";if(self.options.titles){if(self.options.titles.main){const e=self.div.querySelector(".prpanel-title-text");e.setAttribute("title",self.options.titles.main);e.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var chartOptions=$.extend({bindto:div.querySelector(".tc-chart"),padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){$.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.trigger(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(e,t){var o=this,r=o.config,n=o.d3.svg.line(),i=o.generateGetLinePoints(e,t),a=t?o.getSubYScale:o.getYScale,s=function(e){return(t?o.subxx:o.xx).call(o,e)},l=function(e,t){return r.data_groups.length>0?i(e,t)[0][1]:a.call(o,e.id)(e.value)};n=r.axis_rotated?n.x(l).y(s):n.x(s).y(l);r.line_connectNull||(n=n.defined(function(e){return null!=e.value}));return function(e){var i,s=r.line_connectNull?o.filterRemoveNull(e.values):e.values,l=t?o.x:o.subX,c=a.call(o,e.id),u=0,h=0;if(o.isLineType(e))if(r.data_regions[e.id])i=o.lineWithRegions(s,l,c,r.data_regions[e.id]);else{o.isStepType(e)&&(s=o.convertValuesToStep(s));i=n.interpolate("linear")(s)}else{if(s[0]){u=l(s[0].x);h=c(s[0].value)}i=r.axis_rotated?"M "+h+" "+u:"M "+u+" "+h}return i||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(e,t){var o=this,r=o.config,n=o.d3.svg.area(),i=o.generateGetAreaPoints(e,t),a=t?o.getSubYScale:o.getYScale,s=function(e){return(t?o.subxx:o.xx).call(o,e)},l=function(e,t){return r.data_groups.length>0?i(e,t)[0][1]:a.call(o,e.id)(0)},c=function(e,t){return r.data_groups.length>0?i(e,t)[1][1]:a.call(o,e.id)(e.value)};n=r.axis_rotated?n.x0(l).x1(c).y(s):n.x(s).y0(l).y1(c);r.line_connectNull||(n=n.defined(function(e){return null!==e.value}));return function(e){var t,i=r.line_connectNull?o.filterRemoveNull(e.values):e.values,a=0,s=0;if(o.isAreaType(e)){o.isStepType(e)&&(i=o.convertValuesToStep(i));t=n.interpolate("linear")(i)}else{if(i[0]){a=o.x(i[0].x);s=o.getYScale(e.id)(i[0].value)}t=r.axis_rotated?"M "+s+" "+a:"M "+a+" "+s}return t||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};const closeOpenedTableResultsPanel=function(){const e=this;e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return t!==e&&t.isVisible()}).filter(function(t){return t.options.content!==e.contentType.CHART}).forEach(function(e){e.close()})};ctlProto.openTable=function(){var e=this;e.div.classList.remove(TC.Consts.classes.HIDDEN);if(o=arguments[0]){var t;o.css&&(t=o.css);var o,r=o.callback,n=o.columns;if((o=o.data)&&o.length>0){if(!n){n=[];for(var i in o[0])n.push(i)}e.tableData={columns:n,results:o,css:t,callback:r};e.getRenderedHtml(e.CLASS+"-table",e.tableData).then(function(t){const o=e.div.querySelector("."+e.CLASS+"-table"),r=o.parentElement;r.removeChild(o);o.innerHTML=t;r.appendChild(o);e.tableData.callback&&e.tableData.callback(o);closeOpenedTableResultsPanel.call(e);e.map.trigger(TC.Consts.event.DRAWTABLE,{control:e})});e.div.querySelector("."+e.CLASS+"-chart").style.display="none";e.div.querySelector("."+e.CLASS+"-info").style.display="none";e.show("prsidebar-body")}}e.map.getLoadingIndicator().hide()};ctlProto.open=function(e,t){const o=this;o.div.classList.remove(TC.Consts.classes.HIDDEN);const r=t||o.div.querySelector("."+o.CLASS+"-table");o.requestIsRendered=window.requestAnimationFrame(function(){var e=r.getBoundingClientRect();if(e&&e.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.trigger(TC.Consts.event.DRAWTABLE,{control:o})}}.bind(o));o.div.querySelector("."+o.CLASS+"-chart").style.display="none";const n=o.div.querySelector("."+o.CLASS+"-table");n.style.display="none";o.div.querySelector("."+o.CLASS+"-info").style.display="none";if(e)if(t){o.getTableContainer=function(){return t};t.innerHTML=e;t.style.display=""}else{n.innerHTML=e;n.style.display=""}const i=o.div.querySelector(".prcollapsed-max");if(o.options.titles){if(o.options.titles.main){const e=o.div.querySelector(".prpanel-title-text");e.setAttribute("title",o.options.titles.main);e.innerHTML=o.options.titles.main}o.options.titles.max&&i.setAttribute("title",o.options.titles.max)}o.options.classes&&o.options.classes.collapsed&&i.querySelector("i.fa-list-alt").classList.add(o.options.classes.collapsed);const a=o.div.querySelector(o.content.collapsedClass);isElementVisible(a)&&o.maximize();o.show("prsidebar-body");o.hide("prcollapsed-max");o.map.getLoadingIndicator().hide()};ctlProto.createChartOptions=function(e){const t=this;var o={};const r=(e=e||{}).locale||TC.Util.getMapLocale(t.map);e.chartType;if(null!=e.ele){const a=function(){const o=document.documentElement.clientWidth/100*40;return{height:o>445?e.maxHeight||t.CHART_SIZE.MAX_HEIGHT:e.minHeight||t.CHART_SIZE.MIN_HEIGHT,width:o>445?e.maxWidth||t.CHART_SIZE.MAX_WIDTH:o>310?e.mediumWidth||t.CHART_SIZE.MEDIUM_WIDTH:e.minWidth||t.CHART_SIZE.MIN_WIDTH}};var n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;e.ele.forEach(function(e){if("number"==typeof e){n=Math.max(e,n);i=Math.min(e,i)}});const s="grad"+TC.getUID();o={data:{x:"x",columns:[["x"].concat(e.x),["ele"].concat(e.ele)],types:{ele:"area-spline"},colors:{ele:"url(#"+s+")"}},size:a(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(e){var t,o;if((e/=1e3)<1){t=Math.round(1e3*e);o=" m"}else{t=Math.round(100*e)/100;o=" km"}return(t=t.toLocaleString(r))+o}}},y:{padding:{top:0,bottom:0},max:n,min:i,tick:{count:2,format:function(e){return(parseInt(e.toFixed(0))||0).toLocaleString(r)+"m"}}}},onresize:function(){this.api.resize(a())}};e.time&&(o.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));o._onrendered=function(){const e=this.svg[0][0];var o=e.getElementsByTagName("defs")[0],r="http://www.w3.org/2000/svg",n=document.createElementNS(r,"linearGradient");n.setAttributeNS(null,"id",s);n.setAttributeNS(null,"x1","0%");n.setAttributeNS(null,"x2","0%");n.setAttributeNS(null,"y1","0%");n.setAttributeNS(null,"y2","100%");n.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const i=document.createElementNS(r,"stop");i.setAttributeNS(null,"offset","0%");i.setAttributeNS(null,"stop-color","red");i.setAttributeNS(null,"stop-opacity","0.7");n.appendChild(i);const a=document.createElementNS(r,"stop");a.setAttributeNS(null,"offset","50%");a.setAttributeNS(null,"stop-color","orange");a.setAttributeNS(null,"stop-opacity","0.9");n.appendChild(a);const l=document.createElementNS(r,"stop");l.setAttributeNS(null,"offset","100%");l.setAttributeNS(null,"stop-color","green");l.setAttributeNS(null,"stop-opacity","1");n.appendChild(l);o.appendChild(n);const c=d3.select(".c3-brush").node();c&&c.parentNode.removeChild(c);d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(e){d3.event.stopPropagation();const o=t.elevationProfileCoordinates[e.index].slice(0,2);o&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t.map.zoomToFeatures([new TC.feature.Point(o)])})});var u=d3.select(".c3-axis.c3-axis-x").select("path").attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(u)){u=u.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(u)){u=u.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}}const h=e.getBoundingClientRect(),d={width:h.width,height:h.height};var p=function(){var e=d3.scale.ordinal().rangeRoundBands([0,d.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(e,t){e.each(function(){e.each(function(e,t){if(0!=t){d3text=d3.select(this);if(1===d3text.node().childNodes.length){var o=d3text.select("tspan").node().cloneNode(),r=d3text.text().split(" ");d3text.select("tspan").text(r[0]);o.textContent=r[1];var n=o.getAttribute("dy");n=(n=n?parseFloat(o.getAttribute("dy")):.71)+.18+"em";o.setAttribute("dy",n);d3text.node().appendChild(o)}}})})},e.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p();else{if(t.elevationChartLabelsRAF){window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0}t.elevationChartLabelsRAF=requestAnimationFrame(function e(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())t.elevationChartLabelsRAF=requestAnimationFrame(e);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)t.elevationChartLabelsRAF=requestAnimationFrame(e);else{window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(d.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p()}})}if(!t.isMinimized()){t.show("prsidebar-body");t.hide("prcollapsed-max")}t.div.querySelector("."+t.CLASS+"-table").style.display="";t.div.querySelector("."+t.CLASS+"-info").style.display=""}}else o={msg:t.getLocaleString("geo.trk.chart.chpe.empty")};return o};const getTime=function(e,t){var o=t-e,r={},n=Math.floor(o/1e3/60/60/24);o-=1e3*n*60*60*24;var i=Math.floor(o/1e3/60/60);o-=1e3*i*60*60;r.h=i+24*n;var a=Math.floor(o/1e3/60);o-=1e3*a*60;r.m=a;r.s=Math.floor(o/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(e){const t=this.elevationProfileCoordinates;var o=e[0].x;o/=1e3;const r=t[e[0].index];var n;4==t[0].length&&t[0][3]>0&&(n=getTime(t[0][3],r[3]));const i=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,a=parseInt(e[0].value.toFixed(0)).toLocaleString(i);var s,l;if(o<1){s=Math.round(1e3*o);l=" m"}else{s=Math.round(100*o)/100;l=" km"}return'<div class="track-elevation-tooltip"><div><span>'+a+" m </span><br><span>"+(s=s.toLocaleString(i))+l+" </span></div>"+(n?"<span>"+n.toString+"</span><div/>":"")};ctlProto.getTableContainer=function(){return this.tableDiv};ctlProto.getInfoContainer=function(){return this.infoDiv};ctlProto.getMenuElement=function(){return this.menuDiv};ctlProto.getContainerElement=function(){return this.div||null};ctlProto.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t.wrap.register(e);t.openOn&&t.map.one(t.openOn,function(e,o){t.content.fnOpen.call(t,e.data)});t.closeOn&&t.map.one(t.closeOn,function(e,o){t.close()});t.options.openOn&&t.map.on(t.options.openOn,function(e,o){t.content.fnOpen.call(t,e.data)});t.options.closeOn&&t.map.on(t.options.closeOn,function(e,o){t.close()});return o};ctlProto.exportToExcel=function(){var e=this,t=[e.tableData.columns];$.each(e.tableData.results,function(e,o){var r=[];for(var n in o)o.hasOwnProperty(n)&&"Id"!==n&&"Geom"!==n&&r.push(o[n]);t.push(r)});var o=function(o){var r=e.save.fileName?e.save.fileName:"resultados.xls",n=e.options.titles&&e.options.titles.main?e.options.titles.main:null;o.Save(r,t,n)};TC.Util.ExcelExport?o(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/TC.Util.ExcelExport",function(){o(new TC.Util.ExcelExport)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var e=TC.control.ScaleBar.prototype;e.CLASS="tc-ctl-sb";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.ScaleBar(this));this.wrap.render();return this._set1stRenderPromise(Promise.resolve())};e.register=function(e){const t=this;return new Promise(function(o,r){Promise.all([TC.Control.prototype.register.call(t,e),e.wrap.getMap()]).then(function(e){e[1].addControl(t.wrap.ctl);o(t)})})};e.getText=function(){return this.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";TC.isDebug?e.template=TC.apiLocation+"TC/templates/ScaleSelector.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:o},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}t.__dustBody=!0;function o(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:r},{key:n,value:i}).w(">1:").h("math",t,{},{key:a,method:"round"}).w("</option>\n")}o.__dustBody=!0;function r(e,t){return e.w(' selected="true"')}r.__dustBody=!0;function n(e,t){return e.f(t.getPath(!0,[]),t,"h")}n.__dustBody=!0;function i(e,t){return e.f(t.get(["scale"],!1),t,"h")}i.__dustBody=!0;function a(e,t){return e.f(t.getPath(!0,[]),t,"h")}a.__dustBody=!0;return t};e.render=function(e){var t=this;return t._set1stRenderPromise(new Promise(function(o,r){if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var n=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t.div.querySelectorAll("option").forEach(function(e){e.textContent="1:"+t.format(e.textContent.substr(2))});t.div.querySelector('input[type="button"]').addEventListener(TC.Consts.event.CLICK,function(){t.setScreenSize()});t.div.querySelector("select").addEventListener("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e();o()}).catch(function(e){r(e instanceof Error?e:Error(e))})};t.scales?n():t.map.wrap.getMap().then(n)}else r(Error("ScaleSelector no registrado"))}))};e.setScale=function(e){var t=.0254*e/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(t/=window.devicePixelRatio);this.metersPerDegree&&(t/=this.metersPerDegree);this.map.wrap.setResolution(t);return t}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(e,t,o){var r=this;r.parent=o;r._featureTypes=[];$.extend(r,t);r.typeName=e;r._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};r.getFeatureTypes=function(e){if(e)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var t=this.featureType instanceof Array?this.featureType:[this.featureType],o=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=t.concat(o)}return this._featureTypes};r.isFeatureOfThisType=function(e){return this.getFeatureTypes().indexOf(e)>-1};r.getStyleByFeatureType=function(e){return this.getFeatureTypes().indexOf(e)>-1?this.styles[this.getFeatureTypes().indexOf(e)]:null};var n=function(e,t,o){var r=function(e,t,o){if(t){if(e.hasOwnProperty(t)&&e[t].hasOwnProperty(o))return e[t][o]}else for(var t in e)if(e[t].hasOwnProperty(o))return e[t][o]};if(o){return r(this.getStyleByFeatureType(o),t,e)}for(var n=0;n<this.styles.length;n++){var i=r(this.styles[n],t,e);if(i)return i}};r.getSuggestionListHead=function(){var e,t,o,r=this;if("function"==typeof r.suggestionListHead){e=r.suggestionListHead();t=e.label;o=[{color:e.color,title:e.label}]}else{e=r.suggestionListHead;t=r.parent.getLocaleString(e.label);if("string"==typeof e.color)o=[{color:n.call(r,e.color),title:t}];else if(e.color instanceof Array){var i=r.getFeatureTypes();e.color.length===i.length?o=e.color.map(function(e,o){return{color:n.call(r,e[i[o]].color.css,e[i[o]].color.geomType,i[o]),title:r.parent.getLocaleString(e[i[o]].title)||t}}):r._throwConfigError()}else"object"==typeof e.color&&(o=[{color:n.call(r,e.color.css,e.color.geomType),title:t}])}if(t&&o){var a='<li header><span class="header">'+t+"</span>";return a+=o.map(function(e){if(e.color)return'<span class="header-color" title="'+e.title+'" style="color: '+e.color+';"></span>'}).join("")+"</li>"}r._throwConfigError()};r.getSuggestionListElements=function(e){var t=this,o=[],r=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(isNaN(e)&&isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},n=function(e){for(var t=[],o=0;o<e.length;o++)-1==jQuery.inArray(e[o],t)&&t.push(e[o]);return t};t.parseFeatures(e).forEach(function(e){var i=[],a=[],s="",l=t.outputProperties,c=t.dataIdProperty,u=t.outputFormatLabel,h=e.id.split(".").slice(0,1).shift();if(!(t.outputProperties instanceof Array)){l=t.outputProperties[h];c=t.dataIdProperty[h];u=u[h]}for(var d=0;d<l.length;d++)i.push(e.data[l[d]]);for(d=0;d<c.length;d++)a.push(e.data[c[d]]);for(var p={},f=0;f<t.outputProperties.length;f++)p[t.outputProperties[f]]=i[f];i instanceof Array&&u&&n(i).length>1?s=u.tcFormat(i):i instanceof Array&&1==n(i).length&&(s=i[0]);var g=s.toCamelCase();(function(e){for(var t=0;t<o.length;t++){var n=0,i=[];for(var a in e){i.push(r(e[a],o[t].properties[a]));n++}if(i.filter(function(e){return e}).length===n)return!0}return!1})(p)||o.push({text:g,label:g,id:a.join("#"),dataRole:t.typeName,dataLayer:h,properties:p})});return o};r.parseFeatures=function(e){return(r.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:r.featurePrefix,featureType:r.featureType})).read(e)};r.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};r.filter=function(e){const t=function(t,o){var r=[];if(o!=e.parent.rootCfg.active.root)if(-1!==o.indexOf("#")||e.parent.rootCfg.active.limit)for(var n=o.split("#"),i=0;i<e.parent.rootCfg.active.dataIdProperty.length;i++){0==i&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[i],n.length>i?n[i]:n[0]));i==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}else{var a=e.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(t,r){return e.filter.getFilterNode(t,e.parent._LIKE_PATTERN+o+e.parent._LIKE_PATTERN)});if(a.length>1){r.push("<ogc:And>");(r=r.concat(a)).push("</ogc:And>")}else r=r.concat(a)}else{for(var s=0;s<e.parent.rootCfg.active.root.length;s++){n=e.parent.rootCfg.active.root[s];0==s&&e.parent.rootCfg.active.root.length>1&&r.push("<ogc:Or>");for(i=0;i<e.parent.rootCfg.active.dataIdProperty.length;i++){0==i&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[i],n.length>i?n[i]:n[0]));i==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}}e.parent.rootCfg.active.root.length>1&&r.push("</ogc:Or>")}return t.concat(r)};return{getPropertyValue:function(t,o){return e.getSearchTypeByRole(t)[o]},getIsLikeNode:function(t,o){var r=/([\-\"\.\xba\(\)\/])/g;r.test(o)&&(o=o.replace(r,"\\$1"));return o.toString().indexOf(e.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+o.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+o.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+o.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(t,o){var r=/([\-\"\xba\(\)\/])/g;r.test(o)&&(o=o.replace(r,"\\$1"));if(o.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var n=o;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+t+"</ogc:PropertyName> <ogc:Literal>(?i)"+(n=(n=(n=(n=(n=n.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+o.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,o){var r,n=e.filter.getIsLikeNode;if(e.filterByMatch){n=e.filter.getFunctionStrMatches;var i=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");o=o.replace(i,e.parent._MATCH_PATTERN)}if(t instanceof Array||"string"==typeof t){if(t instanceof Array&&t.length>1){r="<ogc:Or>";for(l=0;l<t.length;l++)r+=n(t[l].trim(),o);return r+"</ogc:Or>"}return n(t instanceof Array&&1===t.length?t[0].trim():t.trim(),o)}var a=[];for(var s in t)if(t[s]instanceof Array&&t[s].length>1){r="<Or>";for(var l=0;l<t[s].length;l++)r+=n(t[s][l].trim(),o);r+="</Or>";a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+r+"</Filter>)")}else{var c=t[s];t[s]instanceof Array&&1==t[s].length&&(c=t[s][0]);a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+n(c.trim(),o)+"</Or></Filter>)")}return a.join("")},getFilter:function(o){var r={multiL:!1,f:""};switch(!0){case e.typeName===TC.Consts.searchType.NUMBER:i=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(o.t)&&!/(\<|\>|\<\>)/gi.exec(o.s)){e.parent.rootCfg.active?i=t(i,o.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}else{(n=/(\<|\>|\<\>)/gi.exec(o.t))?i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t.substring(0,o.t.indexOf(n[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?i=t(i,o.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));(n=/(\<|\>|\<\>)/gi.exec(o.s))?i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s.substring(0,o.s.indexOf(n[0])).trim()+e.parent._LIKE_PATTERN)):i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}i.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,o.p+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.STREET:i=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(o.t)&&!/(\<|\>|\<\>)/gi.exec(o.s)){e.parent.rootCfg.active?i=t(i,o.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}else{var n;(n=/(\<|\>|\<\>)/gi.exec(o.t))?i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t.substring(0,o.t.indexOf(n[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?i=t(i,o.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));(n=/(\<|\>|\<\>)/gi.exec(o.s))?i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s.substring(0,o.s.indexOf(n[0])).trim()+e.parent._LIKE_PATTERN)):i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.LOCALITY:r.f=e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN);r.multiL=!0;break;case e.queryProperties.hasOwnProperty("secondQueryWord"):var i;(i=[]).push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;default:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN)+"</ogc:Filter>"}return r},getParams:function(t){var o=e.filter.getFilter(t),r={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},n=e.getFeatureTypes(!0);if(n instanceof Array){for(var i=[],a=0;a<n.length;a++)i.push(e.featurePrefix?e.featurePrefix+":"+n[a].trim():n[a].trim());r.TYPENAME=i.join(",")}else r.TYPENAME=e.featurePrefix?e.featurePrefix+":"+n.trim():n.trim();var s=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var o in e){var r=e[o][0];e[o].length>1&&(r=e[o].join(","));t.push(r)}return t}},l=s(e.outputProperties),c=s(e.dataIdProperty);if(l instanceof Array&&c instanceof Array){r.PROPERTYNAME="";for(a=0;a<l.length;a++)r.PROPERTYNAME+="("+l[a]+","+c[a]+")"}else r.PROPERTYNAME=l+","+c;r.FILTER=o.f;return $.param(r)},getGoToFilter:function(t){var o=[],r=t.split("#"),n=e.dataIdProperty,i=e.getFeatureTypes();if(n&&i)if(t.indexOf("#")>-1&&i instanceof Array&&i.length>1)for(var a=0;a<i.length;a++)for(var s=0;s<n[i[a]].length;s++)o.push({name:n[i[a]][s],value:r[s]});else if(-1==t.indexOf("#")&&i instanceof Array){var l=n;for(a=0;a<i.length;a++)if(!o.hasOwnProperty(i[a])){l instanceof Object&&n.hasOwnProperty(i[a])&&(l=n[i[a]]);for(s=0;s<l.length;s++)s<r.length&&o.push({name:l[s],value:r[s]})}}else{n instanceof Object&&n.hasOwnProperty(i)&&(n=n[i]);for(a=0;a<n.length;a++)o.push({name:n[a],value:r[a]})}return e.filter.transformFilter(o)},transformFilter:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}}}(r)};TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);e.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e.options&&e.options.url&&(e.url=e.options.url);e._LIKE_PATTERN="*";e._MATCH_PATTERN=".*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="Mun";e.POL="Pol";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:e.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:e.getRoad,goTo:e.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};e.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:e.getPK,goTo:e.goToPK,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};e.rootCfg={};e.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise(function(t,o){if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(e){return["CMUNICIPIO"].map(function(t,o){return t+"="+e[o]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");TC.ajax({url:e.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+$.param(r),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(o){if(o.totalFeatures>0){e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=o.features.map(function(t){return{id:["CMUNICIPIO"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).catch(function(){t([])})}else t(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)})}};e.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise(function(t,o){if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.LOCALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.LOCALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(e){return["CMUNICIPIO","CENTIDAD"].map(function(t,o){return t+"="+e[o]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");TC.ajax({url:e.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+$.param(r),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(o){if(o.totalFeatures>0){e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=o.features.map(function(t){return{id:["CMUNICIPIO","CENTIDAD"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).catch(function(){t([])})}else t(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)})}};e.allowedSearchTypes=[];if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes){if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){if(e.availableSearchTypes[t].renderFeatureType&&e.availableSearchTypes[t].renderFeatureType.length>0&&e.options.allowedSearchTypes[t].featureType&&!e.options.allowedSearchTypes[t].renderFeatureType){delete e.availableSearchTypes[t].renderFeatureType;e.availableSearchTypes[t].styles=e.availableSearchTypes[t].styles.slice(0,e.availableSearchTypes[t].styles.length-1)}$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(e.options.allowedSearchTypes[t].root&&t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.MUNICIPALITY||t!=TC.Consts.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.LOCALITY){e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType];e.rootCfg.active.root=e.options.allowedSearchTypes[t].root;e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty}}e.options.allowedSearchTypes[t]?e.addAllowedSearchType(t,e.availableSearchTypes[t]?e.availableSearchTypes[t]:e.options.allowedSearchTypes[t],e):delete e.options.allowedSearchTypes[t]}e.rootCfg.active&&e.rootCfg.active.getRootLabel();e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Search.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list tc-hidden"></ul></div>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);t._search={data:[]};t.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function o(o,r,n){var i=t.getSearchTypeByFeature(n);if(i){var a=i.getStyleByFeatureType(e(n));if(a&&a.hasOwnProperty(r))return a[r][o]}return TC.Cfg.styles[r][o]}return function(t,r,n,i){!TC.Feature||i instanceof TC.Feature||this.map.trigger(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:i.geom});var a=o(r,t,e(i.id));if(n){if(a instanceof Array){var s=a.map(function(e){return i.getData().hasOwnProperty(e)?i.getData()[e]:""}),l=this.getSearchTypeByFeature(e(i.id));return l?l.outputFormatLabel.tcFormat(s):s.join(" ")}return i.getData().hasOwnProperty(a)?i.getData()[a]:""}return a}}();var r=t.layerStyleFN;t.layerPromise=e.addLayer({id:t.getUID(),title:"B\xfasquedas",stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:r.bind(t,"polygon","fillColor",!1),fillOpacity:r.bind(t,"polygon","fillOpacity",!1),strokeColor:r.bind(t,"polygon","strokeColor",!1),strokeOpacity:r.bind(t,"polygon","strokeOpacity",!1),strokeWidth:r.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:r.bind(t,"line","strokeColor",!1),strokeOpacity:r.bind(t,"line","strokeOpacity",!1),strokeWidth:r.bind(t,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:r.bind(t,"point","radius",!1),height:r.bind(t,"point","height",!1),width:r.bind(t,"point","width",!1),fillColor:r.bind(t,"point","fillColor",!1),fillOpacity:r.bind(t,"point","fillOpacity",!1),strokeColor:r.bind(t,"point","strokeColor",!1),strokeWidth:r.bind(t,"point","strokeWidth",!1),fontSize:r.bind(t,"point","fontSize",!1),fontColor:r.bind(t,"point","fontColor",!1),labelOutlineColor:r.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:r.bind(t,"point","labelOutlineWidth",!1),label:r.bind(t,"point","label",!0),angle:r.bind(t,"point","angle",!0)}}}).then(function(e){t.layer=e;return e});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"];return o};e.renderData=function(e,t){var o=this;o._search=o._search||{};var r=function(){o.search(o.textInput.value,function(e){if(1===e.length){o.textInput.value=e[0].label;o._goToResult(e[0].id,o.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));o.resultsList.classList.add(TC.Consts.classes.HIDDEN)}else 0===e.length&&o.resultsList.classList.add(TC.Consts.classes.HIDDEN)})};return TC.Control.prototype.renderData.call(o,e,function(){var e=function(){o.textInput.value=o.resultsList.label||o.resultsList.querySelector("li:not([header]) > a > span").textContent;o.lastPattern=o.textInput.value;o._goToResult(o.resultsList.id||unescape(o.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),o.resultsList.querySelector("li:not([header])").getAttribute("dataRole"));o.resultsList.classList.add(TC.Consts.classes.HIDDEN)};o.textInput=o.div.querySelector("input.tc-ctl-search-txt");o.options&&o.options.placeHolder&&o.textInput.setAttribute("placeHolder",o.options.placeHolder.trim());o.resultsList=o.div.querySelector(".tc-ctl-search-list");o.$list=$(o.resultsList);o.button=o.div.querySelector(".tc-ctl-search-btn");o.button.addEventListener(TC.Consts.event.CLICK,function(){o.getLayer().then(function(t){o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?e():o.textInput.dispatchEvent(new Event("keyup")))})});if(o.options.instructions){o.textInput.setAttribute("title",o.options.instructions.trim());o.button.setAttribute("title",o.options.instructions.trim())}o.resultsList.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("a.tc-ctl-search-li-empty",function(){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);o.textInput.focus()}));try{if(o.textInput.classList.contains("::-ms-clear")){o.textInput.addEventListener("mouseup",function(e){""!==o.textInput.value&&setTimeout(function(){if(""===o.textInput.value){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}},1)})}}catch(e){}o.textInput.addEventListener("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();o.lastPattern="";1===o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?e():r();return!1}});o.textInput.addEventListener("search",function(){if(0===o.textInput.value.length){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}});o.textInput.addEventListener("input",function(){if(0===o.textInput.value.length){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);r()}});o.textInput.addEventListener("targetCleared.autocomplete",function(){o.resultsList.classList.add(TC.Consts.classes.HIDDEN)});o.textInput.addEventListener("targetUpdated.autocomplete",function(){o.resultsList.querySelectorAll("li").length>0&&o.resultsList.classList.remove(TC.Consts.classes.HIDDEN)});o.lastPattern="";o.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){var e;TC.UI.autocomplete.call(o.textInput,{link:"#",target:o.resultsList,minLength:2,ctx:o,source:function(t,r){o.lastpress=performance.now();e||(e=requestAnimationFrame(function t(){var n=o.textInput.value.trim();if(n.length>0&&(!o.lastPattern||n!=o.lastPattern)&&performance.now()-o.lastpress>o.interval){window.cancelAnimationFrame(e);e=void 0;o.resultsList.classList.add(TC.Consts.classes.HIDDEN);o.lastPattern=n;o.search(n,r)}else e=requestAnimationFrame(t)}))},callback:function(e){var t=e.target;"a"!==e.target.tagName.toLowerCase()&&(t=function(e,t){const o=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;for(;e;){if(o.call(e,t))return e;e=e.parentElement}return null}(e.target,"a"));if(t.querySelector("span[hidden]")){o.textInput.value=t.querySelector("span[hidden]").textContent;o.lastPattern=o.textInput.value;o._goToResult(unescape(t.getAttribute("href")).substring(1),t.parentNode.getAttribute("dataRole"));TC.UI.autocomplete.call(o.textInput,"clear")}},buildHTML:function(e){var t=[],r=[],n=/[^a-zA-Z]/g,i=/[^0-9]/g;function a(e,t){var o=parseInt(e,10),r=parseInt(t,10);if(isNaN(o)&&isNaN(r)){var a=e.replace(n,""),s=t.replace(n,"");if(a===s){var l=parseInt(e.replace(i,""),10),c=parseInt(t.replace(i,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return isNaN(o)?1:isNaN(r)?-1:o>r?1:-1}var s=e.results.sort(function(e,t){return this.ctx.getSearchTypeByRole(e.dataRole).searchWeight&&this.ctx.getSearchTypeByRole(t.dataRole).searchWeight?(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:a(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:a(e.label,t.label)}.bind(this));o.rootCfg.active&&(s=s.sort(function(e,t){const o=function(){var o,r,n=this.rootCfg.active.root[0]instanceof Array?this.rootCfg.active.root[0].join("-"):this.rootCfg.active.root[0];if(e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0){o=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-");r=this.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-")}else{o=e.id;r=t.id}return o!==n&&r===n?1:o===n&&r!==n?-1:a(e.label,t.label)}.bind(this);return this.getSearchTypeByRole(e.dataRole).searchWeight&&this.getSearchTypeByRole(t.dataRole).searchWeight?(this.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:o():o()}.bind(o)));for(var l=0;l<s.length;l++){var c=s[l];if(-1==r.indexOf(c.dataRole)){var u=this.ctx.getSearchTypeByRole(c.dataRole);t[t.length]=u.getSuggestionListHead();r.push(c.dataRole)}const e=function(){c.label;var e=[];0===this.ctx.lastPattern.trim().length&&o.textInput.value.trim().length>0&&(this.ctx.lastPattern=o.textInput.value.trim());var t=this.ctx.lastPattern,r=[],n=",";-1==(t=o.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(o.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(o.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(n)&&(n=" ");r=t.trim().split(n);if(c.label.indexOf(this.ctx.LAT_LABEL)>-1&&c.label.indexOf(this.ctx.LON_LABEL)>-1||c.label.indexOf(this.ctx.UTMX_LABEL)>-1&&c.label.indexOf(this.ctx.UTMY_LABEL)>-1){r=this.ctx.lastPattern.split(" ");for(var i=0;i<r.length;i++)","==r[i].trim().slice(-1)&&(r[i]=r[i].slice(0,-1))}for(var a=0;a<r.length;a++)if(r[a].trim().length>0){e.push("("+r[a].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(u=/((\<)|(\>)|(\<\>))/gi.exec(r[a].trim()))for(var s=r[a].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),l=0;l<s.length;l++)s[l].trim().length>0&&e.push("("+s[l].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(c.dataRole==TC.Consts.searchType.ROAD||c.dataRole==TC.Consts.searchType.ROADPK){var u;if(u=o.getSearchTypeByRole(c.dataRole).getPattern().exec(this.ctx.lastPattern)){e=[];u[2]&&u[3]&&u[4]?e.push("("+u[2]+"-"+u[3]+"-"+u[4]+")"):u[2]&&u[3]?e.push("("+u[2]+"-"+u[3]+")"):u[3]&&u[4]?e.push("("+u[3]+"-"+u[4]+")"):(u[2]||u[3])&&e.push("("+(u[2]||u[3])+")");u[5]&&e.push("(?:"+o.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}else u&&u[5]&&(e=[]).push("(?:"+o.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+u[5]+")\\d*")}var h="("+e.join("|")+")";h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=h.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var d=new RegExp(h,"gi"),p=c.label;return c.dataRole!==TC.Consts.searchType.ROAD||c.dataRole!==TC.Consts.searchType.ROADPK?p.replace(d,function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"}):p.replace(d,"<b>$1</b>")}.bind(this);t[t.length]='<li dataRole="'+c.dataRole+'"><a href="#'+encodeURIComponent(c.id)+'"><span hidden>'+c.label+"</span>"+e()+"</a></li>"}return t.join("")}});const t=function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){o.textInput==document.activeElement&&o.resultsList.querySelector("li:not([header]) a")?o.resultsList.querySelector("li:not([header]) a").focus():o.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?o.textInput.focus():function(e,t){var o=e.nextElementSibling;if(!t)return o;for(;o;){if(o.matches(t))return o;o=o.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){o.textInput==document.activeElement?o.resultsList.querySelector("li:not([header]):last-child a").focus():document.activeElement==o.resultsList.querySelector("li:not([header]) a")?o.resultsList.querySelector("li:not([header]):last-child a").focus():function(e,t){var o=e.previousElementSibling;if(!t)return o;for(;o;){if(o.matches(t))return o;o=o.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()};o.textInput.addEventListener("keydown",t);o.resultsList.addEventListener("keydown",t)});$.isFunction(t)&&t()})};e.addAllowedSearchType=function(e,t){this.allowedSearchTypes.push(new SearchType(e,t,this))};e.getSearchTypeByRole=function(e){return this.allowedSearchTypes.filter(function(t){return t.typeName==e})[0]};e.getSearchTypeByFeature=function(e){var t=this.allowedSearchTypes.filter(function(t){return t.isFeatureOfThisType(e)});return t.length>0?t[0]:null};e.getElementOnSuggestionList=function(e,t){const o=this;for(var r=0;r<o._search.data.length;r++)if(o._search.data[r].id==e&&(!t||t&&o._search.data[r].dataRole===t))return o._search.data[r]};e.getLayer=function(){return this.layerPromise};e.getFeatures=function(){return this.layer.features};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){var o=t.features.slice();t.clearFeatures();e.map.trigger(TC.Consts.event.FEATUREREMOVE,{layer:t,feature:o});for(var r=0;r<e.WFS_TYPE_ATTRS.length;r++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[r])&&delete t[e.WFS_TYPE_ATTRS[r]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};e._municipalitiesPromise=new Promise(function(t,o){if(TC.cache.search.municipalities)t(TC.cache.search.municipalities);else{var r=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(r.municipality&&r.municipality.featureType&&r.municipality.labelProperty&&r.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+r.typeName+". Error en el objeto municipality");var n={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:r.municipality.featureType,VERSION:r.version,PROPERTYNAME:r.municipality.labelProperty+","+r.municipality.idProperty,OUTPUTFORMAT:r.outputFormat};r.featurePrefix&&(n.TYPENAME=r.featurePrefix+":"+n.TYPENAME);var i=r.url+"?"+$.param(n);TC.ajax({url:i,method:"GET",responseType:"text"}).then(function(e){var o=(r.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:r.municipality.featurePrefix,featureType:r.municipality.featureType})).read(e);TC.cache.search.municipalities=[];for(var n=0;n<o.length;n++){var i=o[n];TC.cache.search.municipalities.push({label:i.data[r.municipality.labelProperty],id:i.data[r.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0});t(TC.cache.search.municipalities)}).catch(function(){t()})}});return e._municipalitiesPromise};e.getCoordinates=function(e){const t=this;return new Promise(function(o,r){var n=e.match(new RegExp("^"+$.trim(t.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));n&&(e=n[1]+" "+n[2]);(n=e.match(new RegExp("^"+$.trim(t.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=n[1]+" "+n[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){if((n=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e))&&(n[1].indexOf(",")>-1||n[3].indexOf(",")>-1)){n[1]=n[1].replace(",",".");n[3]=n[3].replace(",",".");e=n[1]+" "+n[3]}if(!n||n&&(n[1].indexOf(",")>-1?n[1].replace(",","."):n[1])<=180&&(n[3].indexOf(",")>-1?n[3].replace(",","."):n[3])<=90){if((n=new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e))&&(n[1].indexOf(",")>-1||n[2].indexOf(",")>-1)){n[1]=n[1].replace(",",".");n[2]=n[2].replace(",",".");e=n[1]+" "+n[2]}e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var i=TC.Util.parseCoords(e);if(i){var a=i[0].value,s=i[1].value,l=i[0].type===TC.Consts.UTM?t.UTMX:t.LAT,c=i[1].type===TC.Consts.UTM?t.UTMY:t.LON,u=l+a+c+s,h=t.getPoint(u);if(h&&!t.insideLimit(h)){a=i[1].value;s=i[0].value;u=(l=i[1].type===TC.Consts.UTM?t.UTMX:t.LAT)+a+(c=i[0].type===TC.Consts.UTM?t.UTMY:t.LON)+s;h=t.getPoint(u)}if(h){t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(u)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo");o([{id:u,label:t.getLabel(u),dataRole:TC.Consts.searchType.COORDINATES}])}else o([])}else o([])}else o([])}else o([])})};e.getCadastralRef=function(e){const t=this;return new Promise(function(o,r){var n=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));n&&(e=n[1]+", "+n[2]+", "+n[3]);var i=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(i=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(i)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?t.getMunicipalities().then(function(e){var r=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(i);if(r){var n=new RegExp($.trim(r[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),a=[];const i=function(e,o,r,n){var i=[];i.push[t.MUN]=e;i.push[t.POL]=r;i.push[t.PAR]=n;return{id:t.MUN+e+t.POL+r+t.PAR+n,label:t.getLabel(t.MUN+o+t.POL+r+t.PAR+n),dataRole:TC.Consts.searchType.CADASTRAL,properties:i}};if((a=$.grep(e,function(e){e=e.label||e.id||e;return n.test(e)||n.test(t.removePunctuation(e))})).length>0)for(var s=0;s<a.length;s++)a[s]=i(a[s].id,a[s].label,$.trim(r[2]),$.trim(r[3]));if(/^[0-9]*$/g.test(r[1])){if(r[1].trim()===t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var l=e.filter(function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];l&&o([i(l.id,l.label,$.trim(r[2]),$.trim(r[3]))])}a.push(i($.trim(r[1]),$.trim(r[1]),$.trim(r[2]),$.trim(r[3])))}o(a)}}):o([])})};e.stringPatternsValidators={tsp:function(e,r,n,i){var a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(a&&a[1]&&a[2]){var s=function(){return t((a[3]||a[4]||a[5]||a[6]).trim())};if(/^([^0-9]+)$/i.test(a[1].trim())&&/^([^0-9]+)$/i.test(a[2].trim())){r.push({t:a[1].trim(),s:a[2].trim(),p:s()});r.push({t:a[2].trim(),s:a[1].trim(),p:s()})}else/^([^0-9]+)$/i.test(a[1].trim())?r.push({t:a[1].trim(),s:a[2].trim(),p:s()}):r.push({s:a[1].trim(),t:a[2].trim(),p:s()});o.call(this,r,n,i);return!0}return!1},spt:function(e,r,n,i){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(a&&a[6]&&a[1]){var s=function(){return t((a[2]||a[3]||a[4]||a[5]).trim())};if(/^([^0-9]+)$/i.test(a[6].trim())&&/^([^0-9]+)$/i.test(a[1].trim())){r.push({t:a[6].trim(),s:a[1].trim(),p:s()});r.push({t:a[1].trim(),s:a[6].trim(),p:s()})}else/^([^0-9]+)$/i.test(a[6].trim())?r.push({t:a[6].trim(),s:a[1].trim(),p:s()}):r.push({s:a[6].trim(),t:a[1].trim(),p:s()});o.call(this,r,n,i);return!0}return!1},tnsp:function(e,r,n,i){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(a&&a[1]&&a[2]){r.push({t:a[2].trim(),s:a[1].trim(),p:t((a[3]||a[4]||a[5]||a[6]).trim())});o.call(this,r,n,i);return!0}return!1},ts:function(e,t,r,n){var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!i&&/^[^0-9]*$/i.test(e.trim())){var a=e.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(i&&i[1]&&i[2]){if(/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim())){t.push({t:i[1].trim(),s:i[2].trim()});t.push({s:i[1].trim(),t:i[2].trim()});o.call(this,t,r,n)}else{var s=function(e){for(var t=e.split(" ").reverse(),o=[],r=0;r<t.length;r++)if(1==t[r].length){o.push(t[r]);t[r]=""}return o.length>0?t.reverse().join(" ").trim()+self._LIKE_PATTERN+o.reverse().join(self._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(i[1].trim())?t.push({t:i[1].trim(),s:s(i[2].trim())}):t.push({s:s(i[1].trim()),t:i[2].trim()});o.call(this,t,r,n,!0)}return!0}return!1},st:function(e,r,n,i){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!a){var s=e.split(",").reverse();a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(s.join(","))}if(a){for(var l={},c=(s=e.split(",").reverse(),0);c<s.length;c++)if(/^([^0-9\,]+)$/i.test(s[c].trim()))l.t=s[c].trim();else if(/(\s*\d+)/i.test(s[c].trim()))if(-1==s[c].trim().indexOf(" "))l.s=s[c].trim();else{for(var u=s[c].trim().split(" ").reverse(),h=function(e){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())){l.p=t(e.trim());return!0}return!1},d=0,p=u[d].trim();d<u.length&&!h(p);)++d<u.length&&(p+=u[d]);if(l.p){for(var f=u,g=0;g<f.length;g++){for(var m=!1,y=0;y<f[g].split("").length;y++)l.p.indexOf(f[g][y])>-1&&(m=!0);if(m){f[g];f[g]="";if(l.p==t(p))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(u.reverse().join(" ").trim())){for(var C=[],v=u.reverse(),T=0;T<v.length;T++)if(1==v[T].trim().length){C.push(v[T].trim());v[T]=""}l.s=C.length>0?v.reverse().join(" ").trim()+self._LIKE_PATTERN+C.reverse().join(self._LIKE_PATTERN):v.reverse().join(" ").trim()}r.push({t:l.t,s:l.s+" "+l.p})}else l.s=s[c].trim()}r.push(l);o.call(this,r,n,i);return!0}return!1},s_or_t:function(e,t,o,r){var n=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(n&&n[1]){if(o){t.push({t:n[1].trim()});t.push({t:o,s:n[1].trim()})}else t.push({t:n[1].trim()});return!0}return!1},sp:function(e,o,r,n){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(i&&i[1]&&i[2]){r?o.push({t:r,s:i[1].trim(),p:t(i[2].trim())}):o.push({t:i[1].trim(),s:i[2].trim()});return!0}return!1},snp:function(e,o,r,n){var i=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(i&&i[1]&&i[2]&&r){o.push({t:r,s:i[1].trim(),p:t(i[2].trim())});return!0}return!1}};const t=function(e){for(var t=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],o=[function(e){var t=[],o=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(o){for(var r=1;r<o.length;r++)o[r].trim().length>0&&t.push(o[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){var t=[],o=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(o){for(var r=1;r<o.length;r++)o[r].trim().length>0&&t.push(o[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return e}],r=0;r<o.length&&!t[r].call(self,e);)r++;return r<o.length?o[r].call(self,e):e},o=function(e,t,o,r){const n=this;if(t)for(var i=e.length;i--;)if(r)e.push($.extend({},e[i],{t:t}));else if(e[i].t){var a=n.rootCfg.active.rootLabel.filter(function(t){return t.label.indexOf(n.removePunctuation(e[i].t).toLowerCase())>-1}.bind(n));1==a.length?e[i].t=a[0].id:a.length>1?a.map(function(t){var o=$.extend({},e[i]);o.t=t.id;e.push(o)}):0==a.length&&o&&e.splice(i,1)}},r=function(e,t){const o=this,r=o.rootCfg.active&&o.rootCfg.active.root||"",n=o.rootCfg.active&&o.rootCfg.active.limit||!1;var i=[];","==(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1));if(function(){for(var e=[function(e){return e.length>=3},function(e){return!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)}],r=0;r<e.length;r++)if(!e[r].call(o,t))return!1;return!0}()){var a=[];if(0===(a=e.map(function(e){return o.getSearchTypeByRole(e)}).filter(function(e){return e.stringPatternToCheck}).map(function(e){return e.stringPatternToCheck})).length){a=[o.stringPatternsValidators.tsp,o.stringPatternsValidators.spt,o.stringPatternsValidators.tnsp,o.stringPatternsValidators.ts,o.stringPatternsValidators.st];a=r&&t.split(",").length<3?[o.stringPatternsValidators.sp,o.stringPatternsValidators.snp,o.stringPatternsValidators.s_or_t].concat(a):a.concat([o.stringPatternsValidators.sp,o.stringPatternsValidators.snp,o.stringPatternsValidators.s_or_t])}var s=0;try{for(;s<a.length&&!a[s].call(o,t,i,r,n);)s++}catch(e){TC.error("Error seg\xfan el patr\xf3n: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return i}return null},n=function(e,t,o,r){const n=this;if(r){var i=[];n._search.data=i;n.request||(n.request=[]);r.forEach(function(t,o){e.filter(function(e){var o=n.getSearchTypeByRole(e);return Object.keys(o.queryProperties).length===Object.keys(t).length}).map(function(e){var o=n.getSearchTypeByRole(e);n.request.push(function(e,t,o){this.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+this.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';this.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));return TC.ajax({url:e.url,method:"POST",responseType:"text",data:e.filter.getParams(o)}).then(t).catch(function(e){"abort"!==e.statusText&&alert("error")})}.call(n,o,function(e){i=i.concat(o.getSuggestionListElements(e))},t))})});Promise.all(n.request).then(function(){t(i)})}else t([])};e.getStringPattern=function(e,t){const o=this;return new Promise(function(i,a){t=function(e){e=this.removePunctuation(e);return(e=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(o,t);var s=/(.*)\((.*)\)/.exec(t);if(s&&s.length>2){var l=r.call(o,e,s[1]),c=r.call(o,e,s[1]+","+s[2]);c=(c||[]).concat(l||[]);n.call(o,e,i,a,c)}else{l=r.call(o,e,t);n.call(o,e,i,a,l)}})};e.getRoad=function(e){const t=this;return new Promise(function(o,r){if((e=e.trim()).length<2)o([]);else{var n=t.getSearchTypeByRole(TC.Consts.searchType.ROAD),i=n.getPattern().exec(e);if(i&&i[3]){var a=i[2]?i[2].trim()+"-"+i[3].trim():i[3].trim();i[4]&&i[4].length>0&&(a=a+"-"+i[4].trim());t.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:n.url+"?"+n.filter.getParams({t:a}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var o=n.outputProperties;if(!t.some(function(t){return t.text==e.properties[o[0]]})){var r=n.outputFormatLabel.tcFormat(n.outputProperties.map(function(t){return e.properties[t]})),i=n.outputProperties.map(function(t){return e.properties[t]}).join("-");t.push({id:n.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:r,text:i,dataLayer:e.id.split(".")[0],dataRole:n.typeName})}});o(t)}else o([])}).catch(function(e){o([])})}else o([])}})};e.getPK=function(e){var t=this;return new Promise(function(o,r){if((e=e.trim()).length<3)o([]);else{var n=t.getSearchTypeByRole(TC.Consts.searchType.ROADPK),i=n.getPattern().exec(e);if(i&&i[3]&&i[5]){var a=i[2]?i[2].trim()+"-"+i[3].trim():i[3].trim();i[4]&&i[4].length>0&&(a=a+"-"+i[4].trim());t.resultsList.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));TC.ajax({url:n.url+"?"+n.filter.getParams({t:a,s:i[5].trim()}),method:"GET",responseType:TC.Consts.mimeType.JSON}).then(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var o=n.outputProperties;if(!t.some(function(t){return t.label==e.properties[o[0]]})){var r=n.outputFormatLabel.tcFormat(n.outputProperties.map(function(t){return e.properties[t]}));t.push({id:n.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:r,text:r,dataLayer:e.id.split(".")[0],dataRole:n.typeName})}});o(t)}else o([])}).catch(function(e){o([])})}else o([])}})};e.search=function(e,t){var o=this,r=[];if(o.request){for(var n=0;n<o.request.length;n++)console.log("new criteria: search promise/s aborted");o.request=[]}if((e=$.trim(e)).length>0){e=e.toLowerCase();var i=[];o.allowedSearchTypes.forEach(function(t){t.parser?(n=t.parser,i.push(new Promise(function(t,i){n.call(o,e).then(function(e){r=r.concat(e);t(r)})}))):console.log("Falta implementaci\xf3n del m\xe9todo parser");var n});Promise.all(i).then(function(){r&&(o._search.data=r=r.sort(function(e,t){var o,r=/(\d+)/,n="";if(r.test(e.label)&&r.test(t.label)){o=e.label.match(r)[1];n=t.label.match(r)[1]}else{o=e.label;n=t.label}return o>n?1:o<n?-1:0}.bind(o)));t&&t(r);if(0===r.length){o.cleanMap();if(!o.layer||o.layer&&0===o.layer.features.length){o.resultsList.innerHTML='<li><a title="'+o.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+o.EMPTY_RESULTS_LABEL+"</a></li>";o.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"))}}o.lastPattern=""})}else o.cleanMap()};e._goToResult=function(e,t){var o=this,r=null;return new Promise(function(n,i){o.loading||(o.loading=o.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var a;a=o.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){o.textInput.blur();o.map.trigger(TC.Consts.event.TOOLSCLOSE)}o.cleanMap();var s=!1,l=!0;o.allowedSearchTypes.forEach(function(n){if(l)if(o.availableSearchTypes[n.typeName]){var i=t||o.getElementOnSuggestionList.call(o,e).dataRole;if(i){var a=o.getSearchTypeByRole(i);if(o.availableSearchTypes[i]&&a&&a.goTo)null!==(r=a.goTo.call(o,e,i))&&(l=!1);else if(!o.availableSearchTypes[i]&&a&&a.goTo){s=!0;null!==(r=a.goTo.call(o,e,i))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(n.goTo){s=!0;null!==(r=n.goTo.call(o,e))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});o.loading.removeWait(a);if(r){o.getLayer().then(function(e){switch(!0){case r.params.type==TC.Consts.layerType.VECTOR:for(var t=0;t<o.WFS_TYPE_ATTRS.length;t++)e.hasOwnProperty(o.WFS_TYPE_ATTRS[t])&&delete e[o.WFS_TYPE_ATTRS[t]];break;case r.params.type==TC.Consts.layerType.WFS:for(t=0;t<o.WFS_TYPE_ATTRS.length;t++)e[o.WFS_TYPE_ATTRS[t]]=r.params[o.WFS_TYPE_ATTRS[t]];a=o.loading.addWait()}e.type=r.params.type;o.map.on(TC.Consts.event.FEATURESADD,function(e){e.layer===o.layer&&function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)e[t].showsPopup!=this.queryableFeatures&&(e[t].showsPopup=this.queryableFeatures)}.call(o,e.features)});e.refresh().then(function(){o.map.one(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer==e){o.map.one(TC.Consts.event.FEATURESADD,function(t){if(t.layer==e){if(!t.layer.features||0==t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);var n=t.layer.wrap.layer.getSource().getExtent(),i=t.layer.map.options.pointBoundsRadius;if(n[2]-n[0]==0){n[0]=n[0]-i;n[2]=n[2]+i}if(n[3]-n[1]==0){n[1]=n[1]-i;n[3]=n[3]+i}t.layer.map.setExtent(n);o.map.trigger(TC.Consts.event.ZOOMTO,{extent:n,layer:t.layer})}else if(t.layer.features&&t.layer.features.length>0){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);o.layer.map.zoomToFeatures(t.layer.features);o.map.trigger(TC.Consts.event.FEATURESADD,{layer:o.layer,features:o.layer.features})}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){o.resultsList.inner=r.emptyResultHTML;o.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));o.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}o.loading.removeWait(a)}});if(t.layer.features&&t.layer.features.length>0){o.resultsList.classList.add(TC.Consts.classes.HIDDEN);o.layer.map.zoomToFeatures(o.layer.features);o.map.trigger(TC.Consts.event.FEATURESADD,{layer:o.layer,features:o.layer.features});o.loading.removeWait(a)}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){o.resultsList.innerHTML=r.emptyResultHTML;o.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));t.newData&&t.newData.features&&t.newData.features.length>0||o.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY);o.loading.removeWait(a)}}})})});n(r)}else{i();s||o.map.trigger(TC.Consts.event.SEARCHQUERYEMPTY)}})};e.goToResult=function(e,t){if(this.getSearchTypeByRole(t))return this._goToResult(e,t);if(this.availableSearchTypes[t]){this.addAllowedSearchType(t,this.availableSearchTypes[t],this);return this._goToResult(e,t)}alert("No se reconoce el tipo de b\xfasqueda: "+t)};e.goToCoordinates=function(e){var t={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){t.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};t.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(e){var t=this;wait=t.loading.addWait();var o,r,n=t.getPoint(e);if(n){o=t.getLabel(e);r=t.layer.addMarker(n,$.extend({},t.map.options.styles.point,{title:o,group:o}))}else{var i=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=t.LAT+i[2]+t.LON+i[1];if(n=t.getPoint(e)){o=t.getLabel(e);r=t.layer.addMarker(n,$.extend({},t.map.options.styles.point,{title:o,group:o}));t.textInput.value=o}}r.then(function(e){t.map.trigger(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]});t.map.zoomToFeatures([e]);t.loading.removeWait(wait)})}).call(this,e);return t}return null};e.goToCadastralRef=function(e){var t={},o=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(o.test(e)){var r=o.exec(e);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var n=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);t.params={type:TC.Consts.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.featureType,properties:new TC.filter.and(new TC.filter.equalTo(n.queryProperties.firstQueryWord,$.trim(r[1])),new TC.filter.equalTo(n.queryProperties.secondQueryWord,$.trim(r[2])),new TC.filter.equalTo(n.queryProperties.thirdQueryWord,$.trim(r[3]))),outputFormat:n.outputFormat,styles:n.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t}return null};e.goToRoad=function(e){var t={},o=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);t.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(e),outputFormat:o.outputFormat,styles:o.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToPK=function(e){var t={},o=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);t.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(e),outputFormat:o.outputFormat,styles:o.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToStringPattern=function(e,t){var o={},r=this.getSearchTypeByRole(t);o.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(e),outputFormat:r.outputFormat,styles:r.styles};return o};e.getPoint=function(e){var t,o=this.map.wrap.isGeo(),r=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(r&&3===r.length){t=[parseFloat(r[1]),parseFloat(r[2])];o&&(t=TC.Util.reproject(t,this.map.options.utmCrs,this.map.crs))}else{if((r=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!o)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}if((r=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!o)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}}return t};e.insideLimit=function(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)};e.getPattern=function(){return this.textInput.value};e.getLabel=function(e){var t=e,o=TC.Util.getMapLocale(this.map);if(e.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(n=(t=t.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(n[1],parseFloat(n[1]).toLocaleString(o))).replace(n[3],parseFloat(n[3]).toLocaleString(o)));var r=1.1.toLocaleString(o).substring(1,2);if(n=t.match(new RegExp("^"+$.trim(this.UTMX_LABEL)+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL)+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(n[1]))||(t=t.replace(n[1],n[1].replace(".",r)));Number.isInteger(parseFloat(n[2]))||(t=t.replace(n[2],n[2].replace(".",r)))}}else if(e.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(n=(t=t.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(n[1],parseFloat(n[1]).toLocaleString(o))).replace(n[3],parseFloat(n[3]).toLocaleString(o)))}else if(e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var n=e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));t=this.MUN_LABEL+n[2]+", "+this.POL_LABEL+n[4]+", "+this.PAR_LABEL+n[6]}return t};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),o={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},r=0,n=e.length;r<n;r++)t[r]=o[e.charAt(r)]||e.charAt(r);return t.join("")};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,searchText:e.textInput.value,layer:e.layer.exportState({exportStyles:!1})}:null};e.importState=function(e){const t=this;t.textInput.value=e.searchText;t.layer.importState(e.layer).then(function(){t.layer.features.forEach(function(e){e.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,o){return void 0!==e[o]?e[o]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],o=this.split(e),r=0;r<o.length;r++)o[r].trim().length>0&&t.push(o[r].trim());return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(t)for(var o=0;o<t.length;o++)/[-;:.<>\{\}\[\]\/\s()]/g.test(t[o])&&(e=e.replace(t[o],t[o].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var o=0;o<this.length;o++)if(this[o][e]==t)return this[o]}});String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var o=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>o.length)&&(t=o.length);t-=e.length;var r=o.indexOf(e,t);return-1!==r&&r===t});TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.SelectContainer=TC.control.TabContainer;TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);this._$dialogDiv=$(this._dialogDiv);t.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.MAILTO_MAX_LENGTH=256;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.FEATURE_PARAM="showfeature";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.render.call(t,function(){if(TC.Util.detectChrome()||TC.Util.detectIE()>=10||TC.Util.detectFirefox()>=41){t.div.querySelectorAll("button").forEach(function(e){e.classList.remove("hide")});t.div.querySelectorAll("input[type=text]").forEach(function(e){delete e.dataset.dataOriginalTitle})}TC.Util.detectMobile()||t.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const o=t.div.querySelectorAll("."+t.CLASS+"-url-box");t.div.querySelectorAll("span:not(.tc-beta)").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var t=this;t&&"LABEL"!==t.tagName;)t=t.parentElement;const r=t.querySelector("input[type=radio][name=format]").value;o.forEach(function(e){e.matches(".tc-"+r)?e.classList.remove(TC.Consts.classes.HIDDEN):e.classList.add(TC.Consts.classes.HIDDEN)})})});$.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.manageMaxLengthExceed=function(e){const t=this.div.querySelector("."+this.CLASS+"-alert");e.browser?t.classList.remove(TC.Consts.classes.HIDDEN):t.classList.add(TC.Consts.classes.HIDDEN);const o=this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert");e.qr?o.classList.remove(TC.Consts.classes.HIDDEN):o.classList.add(TC.Consts.classes.HIDDEN)};e.generateIframe=function(e){var t=e||this.generateLink();if(t)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+t+'"></iframe>'};e.loadParamFeature=function(){const e=this;var t=null,o=TC.Util.getParameterByName(e.FEATURE_PARAM);if(o){var r;try{r=JSON.parse(decodeURIComponent(escape(window.atob(o))))}catch(t){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}r&&e.map&&(r.geom?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then(function(t){e.paramFeatureLayer=t;t.importState({features:[r]}).then(function(){e.map.zoomToFeatures(t.features)})}):t=r)}return t};e.register=function(t){const o=this,r=TC.control.MapInfo.prototype.register.call(o,t);o.exportsState=!0;o.MOBILEFAV=o.getLocaleString("mobileBookmarks.instructions");o.NAVALERT=o.getLocaleString("bookmarks.instructions");var n=function(e){const t=e.parentElement.querySelector("input[type=text]");t.value=t.classList.contains("tc-url")?o.generateLink():o.generateIframe();t.select()};o.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(e){const t=o.generateLink();o.registerListeners();o.div.querySelector(".tc-url input[type=text]").value=t;o.div.querySelector(".tc-iframe input[type=text]").value=o.generateIframe(t)}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(e){const t=e.target;n(t);document.execCommand("copy");t.textContent=o.getLocaleString("copied");setTimeout(function(){t.textContent=o.getLocaleString("copy");!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(e){n(e.target)}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",function(e){e.preventDefault();var r=o.generateLink();if(r){const e=encodeURIComponent(r+"\n");e.length>o.MAILTO_MAX_LENGTH&&t.toast(o.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+e}}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(e){e.preventDefault();const t=o._dialogDiv.querySelector(".qrcode");t.innerHTML="";o._dialogDiv.querySelector("."+o.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?o.makeQRCode(t,256,256).then(function(e){e&&TC.Util.showModal(o._$dialogDiv.get(0).querySelector(o._classSelector+"-qr-dialog"))}):TC.Util.showModal(o._$dialogDiv.get(0).querySelector(o._classSelector+"-qr-dialog"))}));const i=function(e,t,r){if(t&&t.trim().length>0)e.location.href=r(t);else{TC.error(o.getLocaleString("urlTooLongForShortener"));e.close()}};o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(e){e.preventDefault();const t=window.open();o.shortenedLink().then(function(e){i(t,e,function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)})});return!1}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(e){e.preventDefault();const t=window.open();o.shortenedLink().then(function(e){i(t,e,function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&amp;url="+encodeURIComponent(e)})});return!1}));TC.Util.detectMobile()&&o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(e){e.preventDefault();o.shortenedLink().then(function(e){var t="whatsapp://send?text=";location.href=void 0!==e?t+encodeURIComponent(e):t+encodeURIComponent(o.generateLink())});return!1}));o.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",function(t){t.preventDefault();var r=o.generateLink(),n=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(n,r,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(r,n);else{window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1}));return r};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Share.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w(' </h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url" title="').h("i18n",t,{},{$key:"shareLink"}).w('"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe" title="').h("i18n",t,{},{$key:"embedMap"}).w('"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p></div> </div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div> <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"qrAdvice|s"}).w('</p></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){this._sv=null;this._mapActiveControl=null;TC.Control.apply(this,arguments);this.options.googleMapsKey&&(e+="&key="+this.options.googleMapsKey);this.viewDiv=null;this._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var t=TC.control.StreetView.prototype;t.CLASS="tc-ctl-sv";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn" title="').h("i18n",t,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){dust.register(t.CLASS+"-view",e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",t,{},{$key:"closeStreetView"}).w('"></div>')}e.__dustBody=!0;return e}}const o=function(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1);this.map.div.querySelector("canvas").dispatchEvent(e)};var r=function(e){const t=e.viewDiv,r=["webkitTransitionEnd","msTransitionEnd","oTransitionEnd","transitionend"],n=function(){TC.Util.detectSafari()||r.forEach(function(e){t.removeEventListener(e,n)});o.call(e)};TC.Util.detectSafari()?setTimeout(function(){o.call(e)},500):r.forEach(function(e){t.addEventListener(e,n)});e.layer.clearFeatures();e.div.querySelector("."+e.CLASS+"-btn").classList.remove(TC.Consts.classes.CHECKED);e.div.querySelector("."+e.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);e.map.div.classList.remove(e.CLASS+"-active");e._startLonLat=null};t.register=function(e){const t=this;if(!t.viewDiv){t.viewDiv=TC.Util.getDiv(t.options.viewDiv);t.viewDiv.classList.add(t.CLASS+"-view");t.viewDiv.classList.add(TC.Consts.classes.HIDDEN);t.options.viewDiv||e.div.insertAdjacentElement("beforebegin",t.viewDiv)}const o=TC.Control.prototype.register.call(t,e);t.layer=null;for(var n=t.getUID(),i=0;i<e.workLayers.length;i++){var a=e.workLayers[i];if(a.type===TC.Consts.layerType.VECTOR&&a.id===n){t.layer=a;break}}t.layer||e.loaded(function(){e.addLayer({id:n,stealth:!0,type:TC.Consts.layerType.VECTOR}).then(function(e){t.layer=e})});t.renderPromise().then(function(){TC.loadJS(!window.Draggabilly,[TC.apiLocation+"lib/draggabilly/draggabilly.pkgd.min.js"],function(){const e=new Draggabilly(t.div.querySelector("."+t.CLASS+"-drag"),{containment:t.map.div});e.on("dragStart",function(e){!function(e){e.div.querySelector("."+e.CLASS+"-btn").classList.add(TC.Consts.classes.CHECKED);e.map.div.classList.add(e.CLASS+"-active")}(t)});e.on("dragEnd",function(o){!function(e){var t=!1;const o=e.div.querySelector("."+e.CLASS+"-btn"),n=e.div.querySelector("."+e.CLASS+"-drag");var i=o.getBoundingClientRect(),a=n.getBoundingClientRect();n.classList.add(TC.Consts.classes.HIDDEN);if(a.top<i.top||a.top>i.bottom||a.left<i.left||a.left>i.right){t=!0;for(var s=e.map.getExtent(),l=[s[2],s[3]],c=(new Array(16),0);c<16;c++)e.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=e.map.div.getBoundingClientRect(),h=(a.left*window.devicePixelRatio+a.right*window.devicePixelRatio)/2-u.left*window.devicePixelRatio,d=a.bottom*window.devicePixelRatio-u.top*window.devicePixelRatio,p=e.map.wrap.getCoordinateFromPixel([h,d]);e.callback(p)}else r(e)}(t);e.setPosition(0,0)})});const e=t.viewDiv;e.querySelector("."+t.CLASS+"-btn-close").addEventListener(TC.Consts.event.CLICK,function(o){const n=t.map.div,i=function(){n.classList.remove(TC.Consts.classes.COLLAPSED);const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1);n.dispatchEvent(e)},a=function(t){if("width"===t.propertyName||"height"===t.propertyName){e.removeEventListener("transitionend",a);i()}};e.removeEventListener("transitionend",a);e.addEventListener("transitionend",a);setTimeout(i,1e3);e.classList.add(TC.Consts.classes.HIDDEN);e.classList.remove(TC.Consts.classes.VISIBLE);t.div.querySelector("."+t.CLASS+"-drag").classList.remove(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);r(t);t._sv.setVisible(!1);o.stopPropagation();const s=document.body.querySelector("header");s&&(s.style.display="");t._previousActiveControl&&t._previousActiveControl.activate()})},function(e,t,o){TC.error("Error de renderizado StreetView")});return o};t.render=function(){const e=this;return e._set1stRenderPromise(new Promise(function(t,o){e.renderData(null,function(){if(dust.cache[e.CLASS+"-view"])dust.render(e.CLASS+"-view",null,function(o,r){setTimeout(function(){e.viewDiv.innerHTML=r;o&&TC.error(o);t(e)},300)});else{TC.error("No hay dust.cache para StreetView");t(e)}})}))};var n=0;t.callback=function(t){var i=this,a=function(e){if(i._sv){var t=e.getBounds();lonLat=TC.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],i.map.crs,"EPSG:4326");i._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},s=function(e){if(i._sv){var t=e.getBounds();i._startLonLat=[(t[0]+t[2])/2,(t[1]+t[3])/2]}},l=i.map.getLoadingIndicator();l&&(n=l.addWait(n));const c=i.map.div;var u=function(e,o){i.layer.clearFeatures();var r,n;if(e){var l=e.getPosition();r=TC.Util.reproject([l.lng(),l.lat()],"EPSG:4326",i.map.crs);n=e.getPov().heading}else{r=t;n=0}i.map.addMarker(r,{cssClass:"tc-marker-sv-"+(Math.round(16*n/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:i.layer,showsPopup:!1});Promise.all(i.map._markerPromises).then(function(){i.layer.wrap.setDraggable(!0,a,s)});if(o){var u=function(){i.map.setCenter(r)};c.classList.contains(TC.Consts.classes.COLLAPSED)?u():setTimeout(u,1200)}};TC.loadJS(!window.google||!google.maps,e,function(){if(window.google){u();const h=i.viewDiv;var e=TC.Util.reproject(t,i.map.crs,"EPSG:4326"),a=h.classList.contains(TC.Consts.classes.VISIBLE),s={position:new google.maps.LatLng(e[1],e[0]),pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(i._sv)i._sv.setOptions(s);else{i._sv=new google.maps.StreetViewPanorama(h,s);google.maps.event.addListener(i._sv,"position_changed",function(){u(i._sv,h.classList.contains(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(i._sv,"pov_changed",function(){if(i.layer.features&&i.layer.features.length>0){var e=i.layer.features[0];delete e.options.url;e.options.cssClass="tc-marker-sv-"+(Math.round(16*i._sv.getPov().heading/360)+16)%16;e.setStyle(e.options);i.layer.refresh()}});google.maps.event.addListener(i._sv,"status_changed",function(){var e=i._sv.getStatus();l&&l.removeWait(n);if(e===google.maps.StreetViewStatus.OK){c.classList.add(TC.Consts.classes.COLLAPSED);const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1);c.dispatchEvent(e);const t=function(){google.maps.event.trigger(i._sv,"resize");o.call(i)};const r=function(e){if(("width"===e.propertyName||"height"===e.propertyName)&&!a){a=!0;h.removeEventListener("transitionend",r);t()}};h.removeEventListener("transitionend",r);h.addEventListener("transitionend",r);setTimeout(t,1e3);if(!h.classList.contains(TC.Consts.classes.VISIBLE)){i._sv.setVisible(!0);u(i._sv,!0);if(i.map.activeControl){i._previousActiveControl=i.map.activeControl;i.map.activeControl.deactivate(!0)}setTimeout(function(){h.style.left="";h.style.top="";h.classList.remove(TC.Consts.classes.HIDDEN);h.classList.add(TC.Consts.classes.VISIBLE)},200);const e=document.body.querySelector("header");e&&(e.style.display="none")}}else{TC.alert(e===google.maps.StreetViewStatus.ZERO_RESULTS?i.getLocaleString("noStreetView"):i.getLocaleString("streetViewUnknownError"));if(i._startLonLat)i.callback(i._startLonLat);else{i.layer.wrap.setDraggable(!1);r(i)}}})}u(i._sv)}else r(i)},!1,!0)}}();TC.control=TC.control||{};!function(){TC.control.ThreeD=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ThreeD,TC.Control);var e=TC.control.ThreeD.prototype;e.CLASS="tc-ctl-threed";e.classes={BETA:"tc-beta-button",BTNACTIVE:"active"};e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",t,{},{$key:"threed.tip"}).w('"></button>')}t.__dustBody=!0;return t};e.register=function(e){const t=this,o=TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.VIEWCHANGE,function(e){e.view==TC.Consts.view.THREED&&t.activate()});return o};e.renderData=function(e,t){const o=this;return TC.Control.prototype.renderData.call(o,e,function(){o.button=o.div.querySelector("."+o.CLASS+"-btn");if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12){o.button.setAttribute("title",o.getLocaleString("threed.not.supported"));o.button.classList.remove(o.classes.BETA)}o.button.addEventListener(TC.Consts.event.CLICK,function(){if("disabled"!==o.button.getAttribute("disabled"))if(Number.isInteger(TC.Util.detectIE())&&TC.Util.detectIE()<12)o.map.toast(o.getLocaleString("threed.not.supported"),{type:TC.Consts.msgType.ERROR});else if(o.map.on3DView){o.button.setAttribute("disabled","disabled");TC.view.ThreeD.unapply({callback:function(){o.button.setAttribute("title",o.getLocaleString("threed.tip"));o.button.classList.remove(o.classes.BTNACTIVE);o.button.removeAttribute("disabled")}})}else o.activate()});$.isFunction(t)&&t()})};e.activate=function(){var e=this;e.button.setAttribute("disabled","disabled");e.browserSupportWebGL.call(e);const t=function(){e.button.removeAttribute("disabled")};e.map.view3D?e.map.on3DView||TC.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:t}):TC.loadJS(!TC.view||!TC.view.ThreeD,TC.apiLocation+"TC/view/ThreeD",function(){TC.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:t})});!function(){e.button.setAttribute("title",e.getLocaleString("threed.two.tip"));e.button.classList.remove(e.classes.BETA);e.button.classList.add(e.classes.BTNACTIVE)}()};e.deactivate=function(){TC.Control.prototype.deactivate.call(this)};e.browserSupportWebGL=function(){var e=!1;if(window.WebGLRenderingContext){var t=document.createElement("canvas"),o={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var r=t.getContext("webgl",o)||t.getContext("experimental-webgl",o)||t.getContext("webkit-3d",o)||t.getContext("moz-webgl",o);if(r)e=!0;else{o.failIfMajorPerformanceCaveat=!1;if(r=t.getContext("webgl",o)||t.getContext("experimental-webgl",o)||t.getContext("webkit-3d",o)||t.getContext("moz-webgl",o)){e="slow";this.isSlower=!0}else e=!1}}catch(e){console.log(E)}if("slow"===e||!e){var n="slow"===e?"threed.slowSupport.supported":"threed.not.supported";this.map.toast(this.getLocaleString(n),{type:TC.Consts.msgType.WARNING,duration:1e4})}return e}e=!1}}();TC.control=TC.control||{};HTMLElement.prototype.appendHTML||(HTMLElement.prototype.appendHTML=function(e){var t=document.createElement("div");t.innerHTML=e;if(t.childNodes.length>1)for(var o=0;o<t.childNodes.length;o++)this.appendChild(t.childNodes[o]);t.childNodes.length>0&&this.appendChild(t.firstChild);return null});Document.prototype.createHTMLElement||(Document.prototype.createHTMLElement=function(e){var t=document.createElement("div");t.innerHTML=e;return t.childNodes.length>0?t.firstChild:null});HTMLElement.prototype.empty||(HTMLElement.prototype.empty=function(){for(;this.children.length;)this.removeChild(this.children[0])});"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])}return o},writable:!0,configurable:!0});TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.WFSQuery=function(e){TC.Control.apply(this,arguments);this.styles=this.options.styles;this.highLightStyles=this.options.highLightStyles};TC.inherit(TC.control.WFSQuery,TC.Control);!function(){var e=TC.control.WFSQuery.prototype,t=null,o=null,r=null,n=null,i=(TC.Consts.logicalOperator.AND,null),a=null,s=null,l={eq:TC.filter.equalTo,not:TC.filter.notEqualTo,gt:TC.filter.greaterThan,lt:TC.filter.lessThan,ge:TC.filter.greaterThanOrEqualTo,le:TC.filter.lessThanOrEqualTo,like:TC.filter.like,contains:TC.filter.like,start:TC.filter.like,end:TC.filter.like,bw:TC.filter.between},c=null,u=null,h=null,d=null,p=null,f=null,g=function(){return null},m=function(){return null},y=null;e.CLASS="tc-ctl-wfsquery";e.template={};if(TC.isDebug){e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/WFSQueryDialog.html";e.template[e.CLASS+"-form"]=TC.apiLocation+"TC/templates/WFSQueryForm.html";e.template[e.CLASS+"-filter"]=TC.apiLocation+"TC/templates/WFSQueryfilter.html"}else{e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-wfsquery-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window tc-ctl-wfsquery-modal-window" ><div class="tc-modal-header"><h3>').f(t.get(["layerName"],!1),t,"h").w('</h3><div title="').h("i18n",t,{},{$key:"query.tooltipCloseDialogBtn"}).w('" class="tc-modal-close"></div></div><div class="tc-modal-body">').h("gt",t,{block:o},{key:t.getPath(!1,["layers","length"]),value:1}).w('<div class="tc-modal-form"></div><div class="tc-ctl-wfsquery-message tc-hidden"></div> </div><div class="tc-modal-footer"><button type="button" title="').h("i18n",t,{},{$key:"query.tooltipSendQueryBtn"}).w('" class="tc-button tc-ctl-wlm-btn-launch">').h("i18n",t,{},{$key:"query.sendQueryBtnText"}).w('</button><button type="button" title="').h("i18n",t,{},{$key:"query.cancelQueryTooltip"}).w('" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"query.cancelQueryButton"}).w("</button></div></div></div>")}t.__dustBody=!0;function o(e,t){return e.w(' <div><select class="tc-combo" name="availableLayers"><option value="">').h("i18n",t,{},{$key:"query.chooseALayerCombo"}).w("</option>").s(t.get(["layers"],!1),t,{block:r},{}).w("</select></div> ")}o.__dustBody=!0;function r(e,t){return e.w('<option value="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}r.__dustBody=!0;return t};e.template[e.CLASS+"-form"]=function(){dust.register(e.CLASS+"-form",t);function t(e,t){return e.w("<div>").h("countif",t,{else:o,block:r},{key:t.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w('</div><div class="tc-ctl-wfsquery-operacion tc-hidden"><div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden"><input type="radio" id="cond_1" name="codicion" value="eq" /><label for="cond_1" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_2" name="codicion" value="not" /><label for="cond_2" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_3" name="codicion" value="gt" /><label for="cond_3" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_4" name="codicion" value="lt" /><label for="cond_4" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_5" name="codicion" value="ge" /><label for="cond_5" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_6" name="codicion" value="le" /><label for="cond_6" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden"><input type="radio" id="cond_8" name="codicion" value="eq" /><label for="cond_8" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_9" name="codicion" value="contains" /><label for="cond_9" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.containsBtn"}).w('</label><input type="radio" id="cond_10" name="codicion" value="start" /><label for="cond_10" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.startsByBtn"}).w('</label><input type="radio" id="cond_11" name="codicion" value="end" /><label for="cond_11" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.endsByBtn"}).w('</label></div><div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden"><input type="radio" id="cond_12" name="codicion" value="bw" /><label for="cond_12" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.equalToBtn"}).w('</label><input type="radio" id="cond_13" name="codicion" value="nbw" /><label for="cond_13" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.notEqualToBtn"}).w('</label><input type="radio" id="cond_14" name="codicion" value="gt" /><label for="cond_14" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherThanBtn"}).w('</label><input type="radio" id="cond_15" name="codicion" value="lt" /><label for="cond_15" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerThanBtn"}).w('</label><input type="radio" id="cond_16" name="codicion" value="ge" /><label for="cond_16" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.greatherOrEqualThanBtn"}).w('</label><input type="radio" id="cond_17" name="codicion" value="le" /><label for="cond_17" class="tc-ctl-btn tc-ctl-wfsquery-cond">').h("i18n",t,{},{$key:"query.lowerOrEqualThanBtn"}).w('</label>\x3c!--<input type="radio" id="cond_7" name="codicion" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e</div><div class="tc-ctl-wfsquery-where tc-hidden"><input type="search" placeholder="').h("i18n",t,{},{$key:"query.searchFieldPhd"}).w('" class="tc-textbox" /><button type="button" title="').h("i18n",t,{},{$key:"query.tooltipAddCondBtn"}).w('" class="tc-button">').h("i18n",t,{},{$key:"query.textAddCondBtn"}).w('</button><ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul><div class="tc-ctl-wfsquery-key"><label>').h("i18n",t,{},{$key:"query.logicalOpLbl"}).w('</label></div><div class="tc-ctl-wfsquery-value"><input type="radio" id="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" checked name="log_op" value="AND" /><label for="log_op_1" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",t,{},{$key:"query.logicalOpAndLbl"}).w('</label><input type="radio" id="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOpRadio" name="log_op" value="OR" /><label for="log_op_2" class="tc-ctl-btn tc-ctl-wfsquery-logOp">').h("i18n",t,{},{$key:"query.logicalOpOrLbl"}).w('</label></div><div class="tc-ctl-wfsquery-whereList"></div></div></div>')}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-wfsquery-message tc-msg-warning">').h("i18n",t,{},{$key:"query.noAttributes"}).w("</div>")}o.__dustBody=!0;function r(e,t){return e.w('<select class="tc-combo" id="attributes" name="attributes"><option value="">').h("i18n",t,{},{$key:"query.chooseAttrCombo"}).w("</option>").h("iterate",t,{block:n},{on:t.get(["attributes"],!1),excludedKeys:"the_geom,FEATURE"}).w("</select>")}r.__dustBody=!0;function n(e,t){return e.w('<option value="').f(t.get(["key"],!1),t,"h").w('">').f(t.get(["key"],!1),t,"h").w("</option>")}n.__dustBody=!0;return t};e.template[e.CLASS+"-filter"]=function(){dust.register(e.CLASS+"-filter",t);function t(e,t){return e.s(t.get(["conditions"],!1),t,{block:o},{})}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-wfsquery-where-cond">').f(t.get(["field"],!1),t,"h").w("&nbsp;").f(t.get(["opText"],!1),t,"h").w("&nbsp;").x(t.get(["isString"],!1),t,{block:r},{}).f(t.get(["valueToShow"],!1),t,"h",["numberSeparator"]).x(t.get(["isString"],!1),t,{block:n},{}).w('</div><div class="tc-ctl-wfsquery-del-cond" title="').h("i18n",t,{},{$key:"query.tooltipRemoveCond"}).w('"></div>\t')}o.__dustBody=!0;function r(e,t){return e.w("&quot;")}r.__dustBody=!0;function n(e,t){return e.w("&quot;")}n.__dustBody=!0;return t}}var C=function(e){var t=document.createElement("input");t.setAttribute("type",e);return t.type==e},v=function(e){var o=e[0],r=e[1],n=e[2];h=n;p=n.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"];f=n.Operations.GetFeature.CountDefault?n.Operations.GetFeature.CountDefault.DefaultValue:null;var i=o.getDisgregatedLayerNames();if((i=i.filter(function(e){return n.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))})).length>1){t.classList.remove("tc-loading");r.getElementsByClassName("tc-combo")[0].addEventListener("change",function(){if(this.value){r.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",r).classList.add(TC.Consts.classes.HIDDEN);d=this.options[this.selectedIndex].text;t.classList.add("tc-loading");T(this.value,n).then(function(e){w(e,r)},function(){var e=r.getElementsByClassName("tc-modal-body")[0];e.classList.remove("tc-loading");e.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+y("query.LayerNotAvailable")+"</div>");e.empty()})}else{var e=r.getElementsByClassName("tc-modal-form")[0];e.empty();for(var o=0;o<e.children.length;o++)e.removeChild(e.children[o]);x()}})}else{if(n.FeatureTypes[i[0].substring(i[0].indexOf(":")+1)]){d=n.FeatureTypes[i[0].substring(i[0].indexOf(":")+1)].Title;T(i[0],n).then(function(e){w(e,r)},function(){var e=r.getElementsByClassName("tc-modal-body")[0];e.classList.remove("tc-loading");e.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+y("query.LayerNotAvailable")+"</div>");e.empty()})}else{var a=r.getElementsByClassName("tc-modal-body")[0];a.classList.remove("tc-loading");a.appendHTML('<div class="tc-ctl-wfsquery-message tc-msg-warning">'+y("query.LayerNotAvailable")+"</div>")}}},T=function(e,t){u=e;return new Promise(function(o,r){if(t.Operations.DescribeFeatureType){var n=t.Operations.DescribeFeatureType.DCP.HTTP.Get["xlink:href"]+"?REQUEST=DescribeFeatureType&TYPENAME="+e+"&OUTPUTFORMAT="+t.Operations.DescribeFeatureType.outputFormat;TC.ajax({url:n,method:"GET",responseType:"application/xml"}).then(function(t){var n=xml2json(t),i=n[e.substring(e.indexOf(":")+1)];if(i){var a=i.type;o(n[a.substring(a.indexOf(":")+1)].complexContent.extension.sequence)}else r()}).catch(function(e){TC.error(e)})}else TC.error("No est\xe1 habilitado DescribeFeatureType en este servicio",TC.Consts.msgErrorMode.TOAST)})},_=null,S=null,E=function(e){if(C("date"))e.type="date";else{e.type="search";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){_=new IMask(e,{mask:Date,pattern:s&&"es-ES"!==s?"eu-ES"===s?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(e){var t=e.getDate(),o=e.getMonth()+1,r=e.getFullYear();t<10&&(t="0"+t);o<10&&(o="0"+o);switch(s){case"eu-ES":return[r,o,t].join("/");case"en-US":return[o,t,r].join("/");case"es-ES":default:return[t,o,r].join("/")}},parse:function(e){switch(s){case"eu-ES":return new Date(e.split("/")[1]+"/"+e.split("/")[2]+"/"+e.split("/")[0]);case"en-US":return new Date(e);case"es-ES":default:return new Date(e.split("/")[1]+"/"+e.split("/")[0]+"/"+e.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})}},L=function(){if(_){var e=_.el.input;_.destroy();_=null;e.value="";e.type="search"}},w=function(o,r){x();_internalGetDataTypes=function(){return o};e.getRenderedHtml(e.CLASS+"-form",{attributes:o},function(n){var i=r.getElementsByClassName("tc-modal-form")[0];i.empty();i.appendHTML(n);t.classList.remove("tc-loading");TC.loadJS(!0,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){console.log("autocomplete loaded")});var a=null,c=i.getElementsByClassName("tc-combo");if(0==c.length)r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled");c[0].addEventListener("change",function(){var t=i.querySelector(".tc-ctl-wfsquery-where .tc-textbox");t.dataset.autocomplete&&TC.UI.autocomplete.call(t,"clear");if(o[this.value]){a=o[this.value].type;i.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.remove("tc-hidden");TC.UI.autocomplete.call(t,"clear");!function(){if(S){var e=S.el.input;S.destroy();S=null;e.value="";e.type="search"}}();t.type="search";switch(!0){case a.indexOf("int")>=0:case a.indexOf("float")>=0:case a.indexOf("double")>=0:case a.indexOf("long")>=0:case a.indexOf("decimal")>=0:i.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.remove("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===i.querySelectorAll("tc-ctl-wfsquery-numeric input:checked").length&&(i.querySelector(".tc-ctl-wfsquery-numeric :first-child").checked=!0);L();if(C("number"))if(TC.Util.detectIE()){t.type="text";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){S=new IMask(t,{mask:Number,scale:a.indexOf("int")>=0||a.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:s&&"en-US"===s?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:s&&"en-US"===s?".":","})})}else{t.type="number";a.indexOf("int")>=0||a.indexOf("long")>=0?t.step="1":t.step="0.0001"}break;case a.indexOf("dateTime")>=0:i.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.remove("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===i.querySelectorAll("tc-ctl-wfsquery-date input:checked").length&&(i.querySelector(".tc-ctl-wfsquery-date :first-child").checked=!0);E(t);break;case a.indexOf("string")>=0:i.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.remove("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.remove("tc-hidden");0===i.querySelectorAll("tc-ctl-wfsquery-text input:checked").length&&(i.querySelector(".tc-ctl-wfsquery-text :first-child").checked=!0);L();k(t,this.value,i.getElementsByClassName(e.CLASS+"-list tc-ctl-search-list")[0])}}else{i.getElementsByClassName("tc-ctl-wfsquery-numeric")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-date")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-text")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-where")[0].classList.add("tc-hidden");i.getElementsByClassName("tc-ctl-wfsquery-operacion")[0].classList.add("tc-hidden")}});i.querySelector(".tc-ctl-wfsquery-where  input[type='radio']").addEventListener("change",function(){"OR"===this.value?TC.Consts.logicalOperator.OR:TC.Consts.logicalOperator.AND;i.getElementsByClassName("tc-ctl-wfsquery-whereList-op")[0].innerHTML=this.nextElementSibling.innerHTML});i.querySelector(".tc-button").addEventListener("click",function(){var e=i.querySelector("input.tc-textbox");TC.UI.autocomplete.call(e,"clear");S&&S.masked.remove();if(A(i)){var t,o,r=i.querySelector(".tc-combo").value,n=i.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked'),c=n.value,u=n.nextElementSibling.innerText,h=(t=e,S?S.unmaskedValue:_?_.unmaskedValue.substring(4)+"-"+_.unmaskedValue.substring(2,4)+"-"+_.unmaskedValue.substring(0,2):t.value),d=function(e){if(S)return S.value;if(_)return _.value;if("date"===e.type)return new Date(e.value).toLocaleDateString(s);if("number"===e.type){var t=1.1.toLocaleString(s).substring(1,2);return e.value.replace(".",t)}return e.value}(e);i.querySelector('.tc-ctl-wfsquery-where  input[type="radio"]:checked').nextElementSibling.innerText;h=h.replace("<","&lt;").replace(">","&gt;");(o=a.indexOf("dateTime")>=0?"nbw"!==c?new l[c](r,h+"T00:00:00Z",h+"T23:59:59Z"):new TC.filter.not(TC.filter.between(r,h+"T00:00:00Z",h+"T23:59:59Z")):new l[c](r,("end"===c||"contains"===c?"*":"")+h+("start"===c||"contains"===c?"*":""))).matchCase=!1;whereObjList.push(o);switch(!0){case a.indexOf("int")>=0:d=parseInt(h,10);break;case a.indexOf("float")>=0:case a.indexOf("double")>=0:case a.indexOf("long")>=0:case a.indexOf("decimal")>=0:d=parseFloat(h,10)}whereFilterList.push({field:r,opText:u,isString:a.indexOf("string")>=0,valueToShow:d});b(i);e.value=""}})}})},b=function(t){dust.filters.numberSeparator||(dust.filters.numberSeparator=function(e){return e.toLocaleString(s)});t.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].empty();e.getRenderedHtml(e.CLASS+"-filter",{conditions:whereFilterList},function(e){t.getElementsByClassName("tc-ctl-wfsquery-whereList")[0].innerHTML=e;for(var o=t.getElementsByClassName("tc-ctl-wfsquery-del-cond"),r=0;r<o.length;r++)o[r].addEventListener("click",function(){var e=Array.prototype.indexOf.call(o,this);whereObjList.splice(e,1);whereFilterList.splice(e,1);b(t)})})},x=function(){whereObjList=[];whereFilterList=[]},A=function(e){var t,o=e.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');if(_&&!_.masked.isComplete){!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&F("Fecha "+str+" inv\xe1lida",TC.Consts.msgType.ERROR);return!1}if(0==o.length){F(y("query.msgNoCondition"));return!1}if(e.querySelectorAll("input[type='date']").length&&!e.querySelector("input[type='date']").checkValidity()){F(y("query.msgNoValidDate"));return!1}if(e.querySelectorAll("input[type='number']").length&&null!=(t=e.querySelector("input[type='number']"))&&!t.checkValidity()){"1"===t.step?F(y("query.msgNoValidNumberMustInt")):F(y("query.msgNoValidNumber"));return!1}if(""===e.querySelector("input.tc-textbox").value.trim()){F(y("query.msgNoValueCondition"));return!1}return!0},P=function(){if(D()){o.getElementsByClassName("tc-modal-body")[0].classList.add("tc-loading");var e=function(){var e=M();O(d);if(n){n.setVisibility(!1);n.clearFeatures();c.off(TC.Consts.event.LAYERUPDATE,I);c.on(TC.Consts.event.LAYERUPDATE,I);n.url=p;n.featurePrefix=u.substring(0,u.indexOf(":"));n.featureType=u.substring(u.indexOf(":")+1);n.maxFeatures=f;n.properties=e;n.setVisibility(!0);n.refresh()}else{R({id:"WFSQueryResults",type:TC.Consts.layerType.WFS,url:p,version:"1.1.0",stealth:!0,geometryName:"the_geom",featurePrefix:u.substring(0,u.indexOf(":")),featureType:u.substring(u.indexOf(":")+1),maxFeatures:f,properties:e,outputFormat:TC.Consts.format.JSON,styles:g()});c.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===r){Modernizr.touch&&TC.Util.swipe(e.control.div,"enable");n.clearFeatures();n.setVisibility(!1);c.off(TC.Consts.event.LAYERUPDATE,I)}})}};f?B().then(e,function(e){o.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");if("NumMaxFeatures"===e.err)F(y("query.msgTooManyResults",{limit:e.limit}),TC.Consts.msgType.WARNING);else if("Empty"===e.err)F(y("query.msgNoResults"),TC.Consts.msgType.INFO);else{console.error(e.errorThrown);F(y("query.errorUndefined"),TC.Consts.msgType.ERROR)}}):e()}else F(y("query.msgNoQueryFilter"))},R=function(e){c.addLayer(e).then(function(e){n=e;e.map.on(TC.Consts.event.LAYERUPDATE,I)})},M=function(){if(whereObjList.length>1){var e=document.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;return TC.filter[TC.Consts.logicalOperator[e]].apply(null,whereObjList)}return 0===whereObjList.length?null:whereObjList[0]},I=function(e){if(e.layer==n){var t=e.layer.features;if(t.length>0){c.zoomToFeatures(t);N(t.length>1?t.reduce(function(e,t,o){return(e instanceof Array?e:[e.data]).concat([t.data])}):[t[0].data],n,d)}else{o.getElementsByClassName("tc-modal-body")[0].classList.remove("tc-loading");F("No hay resultados",TC.Consts.msgType.INFO);e.layer.map.off(TC.Consts.event.LAYERUPDATE,I)}}},O=function(e){var t=e;new Promise(function(e,t){TC.control.ResultsPanel?e(TC.control.ResultsPanel):TC.loadJS(!0,TC.apiLocation+"TC/control/ResultsPanel",function(){e(TC.control.ResultsPanel)})}).then(function(e){if(r){r.options.save.fileName=t+".xls";r.options.titles.max=r.getLocaleString("geo.trk.chart.exp")}else{var o=function(e){r=e;delete dust.cache[r.CLASS+"-table"];if(!TC.isDebug){r.template[r.CLASS+"-table"]=dust.register(r.CLASS+"-table",t);function t(e,t){return e.w('<table class="table"><thead>').s(t.get(["columns"],!1),t,{block:o},{}).w("</thead><tbody>").s(t.get(["results"],!1),t,{block:n},{}).w("</tbody></table>")}t.__dustBody=!0;function o(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}o.__dustBody=!0;function n(e,t){return e.w('<tr title="').h("i18n",t,{},{$key:"zoomToFeature"}).w('" data-id="').f(t.get(["Id"],!1),t,"h").w('" data-index="').f(t.get(["$idx"],!1),t,"h").w('" class="tc-selectable">').h("iterate",t,{block:i},{on:t.getPath(!0,[])}).w("</tr>")}n.__dustBody=!0;function i(e,t){return e.h("select",t,{block:a},{key:t.get(["key"],!1)})}i.__dustBody=!0;function a(e,t){return e.w('<td class="').f(t.get(["key"],!1),t,"h",["removeAccents","downcase"]).w('">').h("startsWith",t,{else:s,block:l},{key:t.get(["value"],!1),value:"http"}).w("</td>")}a.__dustBody=!0;function s(e,t){return e.f(t.get(["value"],!1),t,"h",["numberSeparator"])}s.__dustBody=!0;function l(e,t){return e.w('<a href="').f(t.get(["value"],!1),t,"h").w('" target="_blank" title="').h("i18n",t,{},{$key:"query.linkOpenAtNewTab"}).w('">').h("i18n",t,{},{$key:"query.linkText"}).w("</a>")}l.__dustBody=!0;return t}r.template[r.CLASS+"-table"]=TC.apiLocation+"TC/templates/WFSQueryResultsTable.html";r.options.titles.max=r.getLocaleString("geo.trk.chart.exp")},n=c.getControlsByClass(TC.control.ControlContainer);0==n.length?c.addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:t+".xls"}}).then(o):n[0].addControl("ResultsPanel",{content:"table",titles:{main:"",max:""},save:{fileName:t+".xls"},side:"right"}).then(o)}})},N=function(e,t,n){r.div.querySelector(".prpanel-title-text").innerText=r.getLocaleString(e.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.length,layerName:n});r.div.classList.add("tc-ctl-wfsquery-results");o.parentElement.removeChild(o);r.openTable({data:e,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},callback:function(o){r.maximize();console.log("render del panel de resultados");var n=o.getElementsByTagName("tr"),i=_internalGetDataTypes(),a=1;for(var s in e[0]){if(i.hasOwnProperty(s)&&(i[s].type.indexOf("int")>=0||i[s].type.indexOf("float")>=0||i[s].type.indexOf("double")>=0||i[s].type.indexOf("long")>=0||i[s].type.indexOf("decimal")>=0))for(var l=o.querySelectorAll("td:nth-child("+a+")"),c=0;c<l.length;c++)l[c].classList.add("tc-numeric");a++}for(s=0;s<n.length;s++){n[s].addEventListener("click",function(e){e.stopPropagation();var o=this.dataset.index;void 0!=o&&t.map.zoomToFeatures([t.features[o]])});n[s].addEventListener("mouseenter",function(){var e=this.dataset.index;if(void 0!=e){var o=t.features[e];o&&o.geometry&&U(o);for(var r=0;r<this.children.length;r++){var n=this.children[r];n.offsetWidth<n.scrollWidth&&(n.title=n.innerText)}}});n[s].addEventListener("mouseleave",function(){var e=this.dataset.index;if(void 0!=e){var o=t.features[e];o&&o.geometry&&j(o)}})}Modernizr.touch&&TC.Util.swipe(r.div,"disable");var u=document.getElementById("tools-panel")||document.body.querySelector(".tools-panel");u&&r.div.getElementsByClassName("prpanel-group")[0].colliding(u)&&u.classList.add("right-collapsed")}})},D=function(){return whereObjList.length>0},F=function(e,o){var r=t.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(i)clearTimeout(i);else{r.innerHTML=e;switch(o){case TC.Consts.msgType.INFO:r.classList.add("tc-msg-info");break;case TC.Consts.msgType.WARNING:r.classList.add("tc-msg-warning");break;case TC.Consts.msgType.ERROR:default:r.classList.add("tc-msg-error")}r.classList.remove(TC.Consts.classes.HIDDEN)}i=setTimeout(function(){i=null;r.classList.add(TC.Consts.classes.HIDDEN)},3e3)},k=function(e,t,o){TC.UI.autocomplete.call(e,{minLength:3,target:o,source:function(e,o){var r,n,i=this;i.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+y("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';i.target.classList.remove("tc-hidden");(r=t,n=e,new Promise(function(e,t){var o=Object.assign({},h);o.version="1.1.0";switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"start":n+="*";break;case"contains":case"eq":n="*"+n+"*";break;case"end":n="*"+n}a&&(a=null);(a=TC.ajax({url:p+"?"+Date.now(),data:TC.Util.WFSQueryBuilder([u],TC.filter.like(r,n,void 0,void 0,void 0,!1),o,"JSON",!1),contentType:"application/xml",responseType:"application/json",method:"POST"})).then(function(o){if(o.features&&o.features.length>0){var n;1===o.features.length&&(n=[o.features[0].properties[r]]);o.features.length>1&&(n=o.features.reduce(function(e,t){return e&&e instanceof Array?e.indexOf(t.properties[r])<0?e.concat(t.properties[r]):e:e.properties[r]===t.properties[r]?[e.properties[r]]:[e.properties[r],t.properties[r]]}));e(n)}else t(null)})})).then(o).catch(function(){i.target.classList.add("tc-hidden")})},callback:function(t){e.value=t.currentTarget.dataset.value;this.target.classList.add("tc-hidden")},buildHTML:function(t){var o=e.value;this.target.style.maxHeight="";return t.results.length>1?t.results.reduce(function(e,t,r){return(r>1?e:G(e,o))+G(t,o)}):G(t.results[0],o)}});e.addEventListener("targetCleared.autocomplete",function(){o.classList.add("tc-hidden")});e.addEventListener("keypress",function(t){13==t.which&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("search",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("input",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")})},G=function(e,t){t=new RegExp(t,"gi");return'<li><a href="#" data-value="'+e+'">'+e.replace(t,"<b>$&</b>")+"</a></li>"},B=function(){return new Promise(function(e,t){var o=M(),r=Object.assign({},h);r.version="1.1.0";TC.ajax({url:p,data:TC.Util.WFSQueryBuilder([u],o,r,null,!0),contentType:"application/xml",method:"POST"}).then(function(){var o=xml2json((new DOMParser).parseFromString(arguments[0],"application/xml"));if(o.Exception)t({err:o.Exception.exceptionCode,errorThrown:o.Exception.ExceptionText});else{var r=parseInt(o.numberMatched||o.numberOfFeatures,10);isNaN(r)||r>=parseInt(f,10)?t({err:"NumMaxFeatures",limit:f}):isNaN(r)||0!==r?e():t({err:"Empty"})}},function(e,o,r){t({err:o,errorThrown:r})})})},U=function(e){var t=function(e,t){var o;t instanceof TC.feature.Point?o=e.addPoint(t.getCoords()):t instanceof TC.feature.Polyline?o=e.addPolyline(t.getCoords()):t instanceof TC.feature.Polygon?o=e.addPolygon(t.getCoords()):t instanceof TC.feature.MultiPolygon?o=e.addMultiPolygon(t.getCoords()):t instanceof TC.feature.MultiPolyline&&(o=e.addMultiPolyline(t.getCoords()));return o};if(e.layer){var o=e.layer.map.getLayer("WFSQueryResultsHighlight");o?t(o,e):e.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:TC.Consts.layerType.VECTOR,stealth:!0,styles:m()},function(o){t(o,e)})}},j=function(e){var t=e.layer.map.getLayer("WFSQueryResultsHighlight");t&&t.clearFeatures()};e.render=function(e){return TC.Control.prototype.render.call(this,e)};e.register=function(e){const t=this;c=e;return new Promise(function(e){dust.helpers.countif=function(e,t,o,r){r=r||{};var n=o.block,i=o.else,a=r.key||t.current(),s=null!=r.excludedKeys?r.excludedKeys.split(","):null,l=0;for(var c in a)(null==s||s.indexOf(c)<0)&&l++;l>0?e=e.render(n,t):i&&(e=e.render(i,t));return e};TC.Control.prototype.register.call(t,c).then(function(){g=function(){var e=$.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#ffffff",fillOpacity:0,strokeColor:"#ff0000",strokeWidth:2},polyline:{strokeColor:"#ff0000",strokeWidth:2},point:{strokeColor:"#ff0000"}});return t.styles?Object.assign(e,t.styles):e};m=function(){var e=$.extend(!0,{},TC.Cfg.styles,{polygon:{fillColor:"#0099FF",fillOpacity:0,strokeColor:"#0099FF",strokeWidth:4},polyline:{strokeColor:"#0099FF",strokeWidth:4},point:{strokeColor:"#0099FF"}});return t.highLightStyles?Object.assign(e,t.highLightStyles):e};s=c.options.locale;y=function(e,t){return TC.Util.getLocaleString(s,e,t)};e()})})};e.renderModalDialog=function(r){var n=r.getPath(),i=new Promise(function(i,a){r.getWFSCapabilitiesPromise().then(function(a){!function(r,n,i,a){var s=[];r.getDisgregatedLayerNames().forEach(function(e,t){var o=r.getPath(e);i.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))&&s.push({name:e,title:o[o.length-1]})});s.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0});e.getRenderedHtml(e.CLASS+"-dialog",{layerName:y("query.titleDialog",{layerName:n}),layers:s},function(e){var r=document.createHTMLElement(e);document.body.appendChild(r);(t=r.getElementsByClassName("tc-modal-body")[0]).classList.add("tc-loading");TC.Util.showModal(r,{closeCallback:function(){r.parentElement.removeChild(r)}});if(TC.Util.detectIE()){var n=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:n=.8;case document.body.clientWidth>1140:n=.7}t.style.maxHeight=document.body.clientHeight*n-t.nextElementSibling.clientHeight-t.previousElementSibling.clientHeight}o=r;r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",function(){P()});a&&a(r)})}(r,n[n.length-1],a,function(e){i(e)})})});Promise.all([r,i,r.getWFSCapabilitiesPromise()]).then(v)}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var e={};const t=!TC.isLegacy&&window.hasOwnProperty("Worker"),o=new Promise(function(e,o){if(t){var r=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?e(r):TC.ajax({url:r,method:"GET",responseType:"text"}).then(function(t){var o=new Blob([t],{type:"text/javascript"}),r=window.URL.createObjectURL(o);e(r)},function(e){o(Error(e))})}}),r=function(e,t){const o="No se pudo obtener el documento de capacidades del servicio "+e.url+": ["+t+"]";TC.error(o);e.map&&e.map.trigger(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"});e.wrap.setLayer(null);return o},n=function(e){const n=e.url;return new Promise(function(a,s){var l;const c={};if(e.type===TC.Consts.layerType.WMTS)if(e.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var u="/1.0.0/WMTSCapabilities.xml";const e=n.indexOf(u);if(e<0||e<n.length-u.length){"/"===n[n.length-1]&&(u=u.substr(1));l=n+u}else l=n}else{l=n;c.SERVICE="WMTS";c.VERSION="1.0.0";c.REQUEST="GetCapabilities"}else{l=n;c.SERVICE="WMS";c.VERSION="1.3.0";c.REQUEST="GetCapabilities"}l=l+"?"+$.param($.extend(c,e.queryParams));e.toolProxification.fetch(l,{retryAttempts:2}).then(function(n){(function(e,r){var n;if(r.documentElement){const t=r.getElementsByTagName("ServiceException")[0];if(t)n={error:t.textContent};else{var a=e.type===TC.Consts.layerType.WMTS?new e.wrap.WmtsParser:new e.wrap.WmsParser;n=a.read(r);if(e.type===TC.Consts.layerType.WMTS&&n.Contents&&n.Contents.Layer){const e=r.getElementsByTagName("Layer");for(var s=0,l=e.length;s<l;s++){const t=e[s];var c=TC.Util.getElementByNodeName(t,"ows:Identifier")[0].firstChild.data,u=n.Contents.Layer.filter(function(e){return e.Identifier==c});if(u.length){u=u[0];for(var h=0;h<u.TileMatrixSetLink.length;h++){var d=u.TileMatrixSetLink[h];matrixId=d.TileMatrixSet;xmlLink=t.getElementsByTagName("TileMatrixSetLink").each(function(e,t){return $(t).find("TileMatrixSet:first").text()==matrixId});if(xmlLink.length){xmlLink=xmlLink[0];d.TileMatrixSetLimits=[];const e=xmlLink.getElementsByTagName("TileMatrixLimits");for(var p=0,f=e.length;p<f;p++){const t=e[p];d.TileMatrixSetLimits.push({TileMatrix:t.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(t.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(t.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(t.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(t.getElementsByTagName("MaxTileCol")[0].textContent)})}}}}}}}i(e,n);return Promise.resolve(n)}return new Promise(function(a,s){t&&"string"==typeof r?o.then(function(t){var o=new Worker(t);o.onmessage=function(t){if("success"===t.data.state){n=t.data.capabilities;i(e,n)}else s((n={error:"Web worker error"}).error);a(n);o.terminate()};o.postMessage({type:e.type,text:r})}):a(n=r)})})(e,n.responseText).then(function(t){t.error?s(Error(r(e,t.error))):a(t)}).catch(function(e){s(Error(e))})}).catch(function(t){s(Error(r(e,t)))})})},i=function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var o=e.CAPABILITIES_STORE_KEY_PREFIX+e.options.url,r=function(){t.hasOwnProperty("error")||e.getCapabilitiesPromise().then(function(){localforage.setItem(o,t).then(function(){}).catch(function(e){console.log(e)})})};e.map?e.map.loaded(r):r()})},a=function e(t,o){var r=$.inArray(o.name,t.availableNames);if(-1===r)for(var n=0,i=o.children.length;n<i&&-1===(r=e(t,o.children[n]));n++);return r},s=function e(t,o,r){var n=!1;r.count=r.count+1;if(t.name===o)n=!0;else for(var i=t.children.length-1;i>=0;i--)if(e(t.children[i],o,r)){n=!0;break}return n};TC.layer.Raster=function(){var t=this;TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");this.toolProxification=new TC.tool.Proxification(TC.proxify);this._capabilitiesPromise=null;TC.Layer.apply(t,arguments);t.wrap=new TC.wrap.layer.Raster(t);t.transparent=!1!==t.options.transparent;t.url=t.options.url;t.capabilities=TC.capabilities[t.url];t.params=t.options.params;if("string"==typeof t.options.layerNames)t.names=t.availableNames=t.options.layerNames.split(",");else{t.names=[];t.availableNames=[];if($.isArray(t.options.layerNames))for(var o=0;o<t.options.layerNames.length;o++){if("string"==typeof(l=t.options.layerNames[o])){t.names.push(l);t.availableNames.push(l)}else if(l.hasOwnProperty("name")){t.availableNames.push(l.name);(void 0===l.isVisible||l.isVisible)&&t.names.push(l.name)}}else{var r=t.options.params?t.options.params.sld_body:null;if(r){var i=$.parseXML(r),a=TC.Util.getElementByNodeName(i,"sld:NamedLayer");if(a&&a.length>0){var s=TC.Util.getElementByNodeName(a[0],"sld:Name");if(s&&s.length>0){var l=s[0].textContent;t.names.push(l);t.availableNames.push(l)}}}}}t.ignorePrefixes=void 0===t.options.ignorePrefixes||t.options.ignorePrefixes;t._capabilitiesNodes={};t.wrap._promise=new Promise(function(o,r){var i=function(){var e,r;if(!t.wrap.layer){switch(t.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:e=(r=t).wrap.createWMTSLayer(r.options);break;default:e=function(e){var t=$.isArray(e.names)?e.names.join(","):e.names,o=e.options.format,r=e.options,n={LAYERS:t,FORMAT:o,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&$.extend(n,e.params);e.queryParams&&$.extend(n,e.queryParams);var i=e.getPreferredInfoFormat();null!==i&&(n.INFO_FORMAT=i);return e.wrap.createWMSLayer(e.getGetMapUrl(),n,r)}(t)}t.wrap.setLayer(e);o(e)}};const a=function(e){t.capabilities=t.capabilities||e;var o=t.getGetMapUrl();TC.capabilities[t.options.url]=TC.capabilities[t.options.url]||e;TC.capabilities[o]=TC.capabilities[o]||e;i()};if(t.capabilities){a(t.capabilities);t._capabilitiesPromise=Promise.resolve(t.capabilities);return}const s=e[t.url];e[t.url]=t._capabilitiesPromise=s||new Promise(function(e,o){var r=!1,i=!1;const a=n(t),s=(l=t,new Promise(function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(l.CAPABILITIES_STORE_KEY_PREFIX+l.url).then(function(o){o?e(o):t("Capabilities not in storage")}).catch(function(){t("Undefined storage error")})})}));var l;a.then(function(t){e(t)}).catch(function(e){r=!0;i&&o(Error(e))});s.then(function(t){e(t)}).catch(function(e){i=!0;r&&o(Error(e))})});t.getCapabilitiesPromise().then(function(e){a(e)}).catch(function(e){r(Error(e))})});t._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==t.type&&t.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);var l=TC.layer.Raster.prototype;l.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i;l.capabilitiesState_={PENDING:0,DONE:1};l.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";l.getByProxy_=function(e){return TC.proxify(e)};l.getBySSL_=function(e){return e.replace(this.PROTOCOL_REGEX,"https://")};l.getByUrl_=function(e){return e};l.setVisibility=function(e){this.tree=null;this._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(this,e)};var c=function e(t,o,r){var n=!1,i=t.wrap.getLayerNodes(r);if(i.length){for(var a=0,s=i.length;a<s;a++)e(t,o,i[a])&&(n=!0);var l,c,u=$.map(i,function(e){return t.wrap.getName(e)}).reverse(),h=!1;c=l=$.inArray(u[0],o);if(l<0)h=!0;else for(a=1,s=u.length;a<s;a++)if(u[a]!=o[++l]){h=!0;break}if(!h){var d=t.wrap.getName(r);if(d&&u.length>1){o.splice(c,u.length,d);n=!0}}}return n},u=function(e,t){for(var o=[],r=t.slice(),n=e.wrap.getRootLayerNode(),i=0,a=r.length;i<a;i++)o=o.concat(h(e,r[i],n));return o},h=function e(t,o,r,n){for(var i=[],a=t.wrap.getName(r),s=t.compareNames(o,a),l=!1,c=t.wrap.getLayerNodes(r),u=0;u<c.length;u++){var h=e(t,o,c[u],n||s);h.length?i=i.concat(h):l=!0}c.length&&!l||(n||s)&&(i=[a]);return i},d=function(e){return $.extend({aggregate:!0,lazy:!1},e)},p=function(e,t,o){var r,n,i=[];r=t||[];n=o||[];for(var a=(e||[]).concat(r),s=0;s<a.length;s++)$.inArray(a[s],a)===s&&-1===$.inArray(a[s],n)&&(i[i.length]=a[s]);return i},f=function(e,t){var o="string"==typeof t?t.split(","):t;if(e.capabilities){var r=e.getTree();o.sort(function(e,t){var o={count:0},n={count:0};s(r,e,o);s(r,t,n);return o.count-n.count})}return o},g=function(e,t,o,r){return $.grep(o,function(o){return e.compareNames(t,o,r)}).length>0};l.getLimitedMatrixSet=function(){return function(e){var t=e.layerNames,o=e.matrixSet,r=e.capabilities,n=[],i=r.Contents.TileMatrixSet.filter(function(e){return e.Identifier==o});if(i.length){i=i[0];var a=r.Contents.Layer.filter(function(e){return e.Identifier==t})[0];if(a.TileMatrixSetLink&&a.TileMatrixSetLink.length&&a.TileMatrixSetLink[0].TileMatrixSetLimits){for(var s,l=a.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){s=l[c];var u=i.TileMatrix.filter(function(e){return e.Identifier==s.TileMatrix});if(u.length){var h=$.extend({matrixIndex:i.TileMatrix.indexOf(u[0])},u[0],s);n.push(h)}}return n}return i.TileMatrix}return null}(this)};l.setLayerNames=function(e,t){var o=this;return new Promise(function(r,n){o.wrap.getLayer().then(function(){var n=$.isArray(e)?e:e.split(",");o.names=n;var i=d(t);i.aggregate&&(n=function(e,t){if(e.type!==TC.Consts.layerType.WMS)return t;var o=t.slice();c(e,o,e.wrap.getRootLayerNode());return o}(o,n));o._disgregatedLayerNames=null;var a={LAYERS:n.join(","),TRANSPARENT:!0};n.length||o.setVisibility(!1);if(i.lazy){var s=o._newParams||o.wrap.getParams();o._newParams=$.extend(s,a)}else{o.map&&o.map.trigger(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:o});o.tree=null;o._cache.visibilityStates={};o.wrap.setParams(a);!i.reset&&o.map||(o.availableNames=o.names);o.map&&o.map.trigger(TC.Consts.event.UPDATEPARAMS,{layer:o})}r(o.names)})})};l.addLayerNames=function(e,t){const o=this;return new Promise(function(r,n){o.wrap.getLayer().then(function(){var n=d(t),i=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(n.aggregate){i=u(o,i);a=o.getDisgregatedLayerNames()}o.setLayerNames(f(o,p(a,i,null)),t).then(function(e){r(e)})})})};l.removeLayerNames=function(e,t){const o=this;return new Promise(function(r,n){o.wrap.getLayer().then(function(){var n=d(t),i=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(n.aggregate){i=u(o,i);a=o.getDisgregatedLayerNames()}o.setLayerNames(f(o,p(a,null,i)),t).then(function(e){r(e)})})})};l.toggleLayerNames=function(e,t){const o=this;return new Promise(function(r,n){o.wrap.getLayer().then(function(){var n=d(t),i=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(n.aggregate){i=u(o,i);a=o.getDisgregatedLayerNames()}for(var s=[],l=[],c=0;c<i.length;c++){var h=i[c];$.inArray(h,a)<0?s[s.length]=h:l[l.length]=h}var p=[];s.length>0&&p.push(o.addLayerNames(s,n));l.length>0&&p.push(o.removeLayerNames(l,n));Promise.all(p).then(function(e){const t=e[0],o=e[1];r(t?o?t.concat(o):t:[])})})})};l.getDisgregatedLayerNames=function(){var e=this.wrap.layer;if(this.wrap.isNative(e)&&this.type===TC.Consts.layerType.WMS){if(!this._disgregatedLayerNames){var t=this.wrap.getParams().LAYERS;t=$.isArray(t)?t:t.split(",");this._disgregatedLayerNames=u(this,t)}}else this._disgregatedLayerNames=this.names;return this._disgregatedLayerNames.slice()};l.isValidFromNames=function(){for(var e=!0,t=0,o=this.names.length;t<o;t++)if(!this.getLayerNodeByName(this.names[t])){e=!1;break}return e};l.isCompatible=function(e){var t=!1;switch(this.type){case TC.Consts.layerType.WMTS:t=this.wrap.isCompatible(e)||this.wrap.getCompatibleMatrixSets(e).length>0;break;case TC.Consts.layerType.WMS:t=this.wrap.isCompatible(e)}return t};l.getCompatibleCRS=function(e){const t=this;e=e||{};var o=t.wrap.getCompatibleCRS();if(e.includeFallback&&t.fallbackLayer){const e=t.getFallbackLayer();e instanceof TC.Layer&&(o=o.concat(e.wrap.getCompatibleCRS()))}e.normalized&&(o=o.map(function(e){return TC.Util.getCRSCode(e)}).filter(function(e){return null!==e}).reduce(function(e,t){e.indexOf(t)<0&&(e[e.length]=t);return e},[]).map(function(e){return"EPSG:"+e}));return o};l.getProjection=function(){switch(this.type){case TC.Consts.layerType.WMTS:return this.wrap.layer.getSource().getProjection().getCode();case TC.Consts.layerType.WMS:return this.map.crs}};l.setProjection=function(e){if((e=e||{}).crs)switch(this.type){case TC.Consts.layerType.WMTS:var t=this.wrap.getCompatibleMatrixSets(e.crs)[0];if(t){this.matrixSet=t;this.wrap.setMatrixSet(t)}else this.wrap.setProjection(e);this.mustReproject=!t;break;case TC.Consts.layerType.WMS:this.wrap.setProjection(e);this.mustReproject=!this.isCompatible(e.crs)}};l.isVisibleByScale=function(e,t){var o,r,n,i=this,a=function(){return i.map.wrap.getResolution()*i.map.getMetersPerUnit()/28e-5};switch(i.type){case TC.Consts.layerType.WMTS:o=!1;var s=i.wrap.getTileMatrix(i.options.matrixSet);if(s){r=a();for(n=0;n<s.length;n++){if((h=i.wrap.getScaleDenominators(s[n]))[0]===r){o=!0;break}}}break;case TC.Consts.layerType.WMS:o=!0;var l=i.wrap.getAllLayerNodes();if(l.length>0){r=a();var c;if("number"==typeof e)c=i._capabilitiesNodes[e];else for(n=0;n<l.length;n++){var u=l[n];if(i.compareNames(i.wrap.getName(u),e,t)){c=u;break}}if(c){var h=i.wrap.getScaleDenominators(c);if(!(o=!(parseFloat(h[1])>r||parseFloat(h[0])<r))&&c.Layer&&c.Layer.length>0)return c.Layer.some(function(e){var t=i.wrap.getScaleDenominators(e);return!(parseFloat(t[1])>r||parseFloat(t[0])<r)})}}break;default:o=!0}return o};l.isVisibleByName=function(e,t){var o=this,r=!1;switch(o.type){case TC.Consts.layerType.WMTS:if(o.wrap.getWMTSLayer()){r=!0;break}break;case TC.Consts.layerType.WMS:var n=function e(r,n){var i=null,a=o.wrap.getName(n);if(o.compareNames(a,r,t))i=[a];else for(var s=o.wrap.getLayerNodes(n),l=0;l<s.length;l++){var c=e(r,s[l]);if(c){TC.Util.fastUnshift(c,a);i=c;break}}return i},i=function(e){return n(e,o.wrap.getRootLayerNode())}(e);if(i)for(var a=0;a<i.length;a++)if(g(o,i[a],o.names)){r=!0;break}break;default:r=!0}return r};l.getTree=function(){var e=this,t=e.tree;if(!t){var o,r=function t(r,n,i){var a;for(var s in e._capabilitiesNodes)if(e._capabilitiesNodes[s]===r){a=s;break}if(!a){a=TC.getUID();e._capabilitiesNodes[a]=r}var l,c,u={name:e.wrap.getName(r),title:r.title||r.Title,uid:a,children:[]};i&&(o=u);g(e,u.name,e.availableNames)&&(n=!0);if(e.options.isBase){u.name=e.names.join(",");u.title=e.title||u.title;u.isBase=e.isDefault;e.options.thumbnail&&(u.legend={src:e.options.thumbnail})}else{u.isVisible=u===o?e.getVisibility():e.isVisibleByName(u.name);var h,d=e.wrap.getLayerNodes(r);for(h=0;h<d.length;h++){var p=t(d[h],n);p&&(l=u,c=p,e.options.inverseTree?TC.Util.fastUnshift(l.children,c):l.children[l.children.length]=c)}u.legend=e.wrap.getLegend(r);if(!n&&!i){o.children=o.children.concat(u.children);u=null}}return u};switch(e.type){case TC.Consts.layerType.WMTS:t=r(e.wrap.getWMTSLayer(),!e.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(e.capabilities){t=r(e.wrap.getRootLayerNode(),!e.options.hideTree,!0);var n=e._cache.visibilityStates;!function e(t){var o=TC.Consts.visibility.NOT_VISIBLE;if(t){if(void 0!==n[t.uid])o=n[t.uid];else{if(t.children)for(var r=!1,i=!1,a=0,s=t.children.length;a<s;a++){switch(e(t.children[a])){case TC.Consts.visibility.VISIBLE:r=!0;break;case TC.Consts.visibility.NOT_VISIBLE:i=!0;break;case TC.Consts.visibility.HAS_VISIBLE:r=!0;i=!0}r&&(o=i?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}t.isVisible&&(o=TC.Consts.visibility.VISIBLE);n[t.uid]=o}t.visibilityState=o}return o}(t);e.options.hideTree&&function e(t,o){o.children.sort(function(e,o){return a(t,o)-a(t,e)});for(var r=0,n=o.children.length;r<n;r++)e(t,o.children[r])}(e,t)}}t||(t={name:e.name,title:e.title});t.title=e.title||t.title;t.customLegend=e.customLegend||t.customLegend;e.tree=t}return t};l.setNodeVisibility=function(e,t){var o=this;o.tree||(o.tree=o.getTree());var r=o.findNode(e,o.tree);if(r===o.tree)t&&0===o.names.length?o.addLayerNames(o.availableNames).then(function(){o.setVisibility(!0)}):o.setVisibility(t);else{var n=function e(t){var o=[];if(t.name)o[0]=t.name;else for(var r=0;r<t.children.length;r++)o=o.concat(e(t.children[r]));return o}(r);t?o.addLayerNames(n):o.removeLayerNames(n)}};l.getNodeVisibility=function(e){this.tree||(this.tree=this.getTree());return this._cache.visibilityStates[e]};l.getNodePath=function(e,t){var o=this,r=[];if(o.type===TC.Consts.layerType.WMS&&o.capabilities){e=e||o.names[0];r=function r(n){var i=[],a=o.wrap.getName(n);if(o.compareNames(a,e,t))i.push(n);else for(var s=o.wrap.getLayerNodes(n),l=0;l<s.length;l++){var c=r(s[l]);if(c.length){i=c;TC.Util.fastUnshift(i,n);break}}return i}(o.wrap.getRootLayerNode())}return r};l.getPath=function(e,t){return $.map(this.getNodePath(e,t),function(e){return e.title||e.Title})};l.getLayerNodeByName=function(e){for(var t=null,o=this.wrap.getServiceType()===TC.Consts.layerType.WMTS?this.wrap.getIdentifier:this.wrap.getName,r=this.wrap.getAllLayerNodes(),n=0,i=r.length;n<i;n++)if(this.compareNames(o(r[n]),e)){t=r[n];break}return t};l.getChildrenLayers=function(e){var t=[],o=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var r=0;r<e.Layer.length;r++){t[t.length]=e.Layer[r];o(e.Layer[r],t)}};o(e,t);return t};l.compareNames=function(e,t,o){var r=e===t,n=void 0!==o?o:this.ignorePrefixes;if(!r&&n&&e&&t){var i=e.indexOf(":"),a=t.indexOf(":");i>=0&&a<0?r=e.substr(i+1)===t:a>=0&&i<0&&(r=e===t.substr(a+1))}return r};l.getCapabilitiesPromise=function(){return this._capabilitiesPromise};l.getResolutions=function(){return this.wrap.getResolutions()};l.searchSubLayers=function(e){this.patternFn||(this.patternFn=function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/[^a-z\d\xe1\xe9\xed\xf3\xfa\xfc\xf1]/gi,"\\$&")).replace(/(a|\xe1)/gi,"(a|\xe1)")).replace(/(e|\xe9)/gi,"(e|\xe9)")).replace(/(i|\xed)/gi,"(i|\xed)")).replace(/(o|\xf3)/gi,"(o|\xf3)")).replace(/(u|\xfa|\xfc)/gi,"(u|\xfa|\xfc)")).replace(/n/gi,"(n|\xf1)")});if(e&&e.length&&e.length>=3){var t=this,o=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)o=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){o=[];for(var r=0;r<t.availableNames.length;r++){var n=t.getLayerNodeByName(t.availableNames[r]);if(n){o[o.length]=n;o=o.concat(t.getChildrenLayers(n))}}}else o=t.wrap.getAllLayerNodes();var i=this.patternFn(e),a=new RegExp(i,"i"),s=o.map(function(e,o){delete e.tcScore;e.tcPosition=o;t.wrap.normalizeLayerNode(e);var r=e.Title.trim(),n=a.exec(r),i=n?n.index:-1,s=-1;if(e.Abstract){var l=e.Abstract.trim(),c=a.exec(l);s=c?c.index:-1}n&&r==n[0]?e.tcScore=20:0==i?e.tcScore=15:i>-1?e.tcScore=10:0==s?e.tcScore=5:s>-1&&(e.tcScore=1);return e.tcScore?e:null}).filter(function(e){return null!=e}).sort(function(e,t){if(t.tcScore===e.tcScore){var o=TC.Util.replaceAccent(e.Title),r=TC.Util.replaceAccent(t.Title);return o<r?-1:o>r?1:0}return t.tcScore-e.tcScore});this.lastPattern=e;this.lastMatches=s;return s}return[]};l.getGetMapUrl=function(){return function(e){var t=e;if(e){var o=e.match(/\??SERVICE=\w+&/i);o&&(t=t.replace(o[0],""))}return t}(this.wrap.getGetMapUrl())};l.getPreferredInfoFormat=function(){var e=null,t=this.wrap.getInfoFormats();if(t)for(var o=0;o<TC.wrap.layer.Raster.infoFormatPreference.length;o++){var r=TC.wrap.layer.Raster.infoFormatPreference[o];if($.inArray(r,t)>=0){e=r;break}}return e};l.getLegendGraphicImage=function(){const e=this;return new Promise(function(t,o){if(e.options.params.base64LegendSrc)return t(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var r=e.names[0],n=e.wrap.getInfo(r),i=new XMLHttpRequest,a=n.legend[0].src.split("?"),s=a[1].split("&"),l=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}e.options.params.env&&(l+="&"+e.options.params.env);i.open("POST",a[0],!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.responseType="arraybuffer";i.onload=function(o){if(200===this.status){for(var r=new Uint8Array(this.response),n=r.length,a=new Array(n);n--;)a[n]=String.fromCharCode(r[n]);var s=a.join(""),l=i.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(s);e.options.params.base64LegendSrc=c;t(c)}}};i.send(l)}else o(Error("Funci\xf3n window.btoa no soportada por el navegador"))})};l.getUrl=function(e){return e};l.getWebGLUrl=function(e,t){const o=this;return new Promise(function(t,r){var n=!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(o.url))?o.getBySSL_(e):e;if(o.ignoreProxification)t(n);else{const e={exportable:!0,ignoreProxification:o.ignoreProxification};o.toolProxification.fetchImage(n,e).then(function(){o.toolProxification.cacheHost.getAction(n,e).then(function(e){e&&e.action&&t(e.action.call(o.toolProxification,n))})}).catch(function(e){r(Error(e))})}})};l.getFeatureUrl=function(e){var t=this;return t.toolProxification.cacheHost.getAction(e).then(function(o){return o.action.call(t.toolProxification,e)})};l.getSiblingLoadedLayer=function(e){var t=this;if(t.map){return t.map.baseLayers.slice(0).concat(t.map.workLayers.slice(0)).filter(function(o){return(o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WMTS)&&(o.capabilities===t.capabilities||o.url===t.url)&&(!e||!$.isFunction(e)||e(o))})[0]||null}return null};l.getImageLoad=function(e,t,o){const r=this;if(r.names&&r.names.length>0){const o=function(t){var o=e.getImage();TC.Util.isSameOrigin(t.src)||(!r.map||r.map&&r.map.mustBeExportable)&&(o.crossOrigin=null!==t.crossOrigin?t.crossOrigin:"anonymous");o.setAttribute("src",t.src);m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})},g=function(t){m.call(r).trigger(TC.Consts.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}});o({src:TC.Consts.BLANK_IMAGE})};if(r.type===TC.Consts.layerType.WMTS){var n,i,a;if("KVP"!=r.encoding){var s=t.replace("."+r.format.split("/")[1],"");n=(l=s.split("/").slice(s.split("/").length-3).map(function(e){return parseInt(e)}))[0];i=l[1];a=l[2]}else{var l;if((l=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(t))&&4==l.length){n=(l=l.slice(1).map(function(e){return parseInt(e)}))[0];i=l[2];a=l[1]}}if(n&&i&&a){var c=r.wrap.getWMTSLayer();if(c){var u=c.TileMatrixSetLink.filter(function(e){return e.TileMatrixSet===r.matrixSet});if(u.length>0&&u[0].TileMatrixSetLimits.length>0){var h=u[0].TileMatrixSetLimits.sort(function(e,t){return parseInt(e.TileMatrix)>parseInt(t.TileMatrix)?1:parseInt(e.TileMatrix)<parseInt(t.TileMatrix)?-1:0})[n];if(h&&r.map&&r.map.on3DView&&!(h.MinTileRow<=i&&h.MaxTileRow>=i&&h.MinTileCol<=a&&h.MaxTileCol>=a)){console.log("Prevenimos petici\xf3n fuera de matrix set, cargamos imagen en blanco");o({src:TC.Consts.BLANK_IMAGE});return}}}}}m.call(r).trigger(TC.Consts.event.BEFORETILELOAD,{tile:e});var d="";if("POST"===r.options.method){var p=t.split("?");d=p[1].split("&").filter(function(e){const t=e.split("=");return t.length>1&&t[1].trim().length>0&&"layers"!==t[0].trim().toLowerCase()}).join("&");r.toolProxification.fetchImageAsBlob(p[0],{type:"POST",data:d,contentType:"application/x-www-form-urlencoded"}).then(function(t){const r=URL.createObjectURL(t);e.getImage().onload=function(e){URL.revokeObjectURL(r)};o({src:r})}).catch(g)}else if(r.ignoreProxification){o({src:t});var f=e.getImage();TC.Util.isSameOrigin(t)||(!r.map||r.map&&r.map.mustBeExportable)&&(f.crossOrigin="anonymous");f.onload=function(){m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})};f.onerror=function(t){f.src=TC.Consts.BLANK_IMAGE;m.call(r).trigger(TC.Consts.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})};f.src=r.names.length?t:TC.Consts.BLANK_IMAGE}else r.toolProxification.fetchImage(t,{exportable:!r.map||r.map&&r.map.mustBeExportable}).then(function(e){o(e)}).catch(g)}else m.call(r).trigger(TC.Consts.event.TILELOAD,{tile:e})};var m=function(){const e=this;return e.wrap&&e.wrap.$events?e.wrap.$events:null};l.getWFSCapabilitiesPromise=function(){const e=this;void 0===WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser");var t=this.options.url.replace(/service=wms/i,"service=wfs").replace(/\/wms(\/|\?|\b)/i,"$'/wfs/"),o=!TC.Util.isSecureURL(t)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(t))?e.getBySSL_(t):t,r=t.substring(t.indexOf("://")<0?0:t.indexOf("://")+3);if(TC.WFScapabilities[r])return TC.WFScapabilities[r]instanceof Promise?TC.WFScapabilities[r]:new Promise(function(e,t){setTimeout(function(){e(TC.WFScapabilities[r])},100)});TC.WFScapabilities[r]=new Promise(function(t,n){var i={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"},a=e.getUrl(o+"?"+TC.Util.getParamString(i));e.toolProxification.fetch(a,{retryAttempts:2}).then(function(e){var o,i;const a=e.responseText&&(e.responseText.ownerDocument||e.responseText).documentElement;var s=(i=!!a&&"HTML"!==a.nodeName?e.responseText:(new DOMParser).parseFromString(e.responseText,"text/xml")).getElementsByTagName("ServiceException")[0];s||(s=i.getElementsByTagName("ExceptionText")[0]);if(s)n(Error(s.innerHTML));else{try{o=WFSCapabilities.Parse(i)}catch(e){n(e instanceof Error?e:Error(e));return}if(o.Operations){var l=o.Operations.GetCapabilities.DCP&&o.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||o.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[l]=o;TC.WFScapabilities[r]=o;t(o)}else n(null)}}).catch(function(e){n(e instanceof Error?e:Error(e))})});return TC.WFScapabilities[r]};l.getFallbackLayer=function(){const e=this;if(e.fallbackLayer instanceof TC.Layer)return e.fallbackLayer;if(e.options.fallbackLayer){var t=e.options.fallbackLayer;if("string"==typeof t){(e.map?e.map.options.availableBaseLayers:TC.Cfg.availableBaseLayers).forEach(function(t){if(e.options.fallbackLayer===t.id){e.fallbackLayer=new TC.layer.Raster($.extend({},t,{isBase:!0,stealth:!0,map:e.map}));e.fallbackLayer.firstOption=e}})}else if(t instanceof TC.Layer){e.fallbackLayer=t;e.fallbackLayer.firstOption=e}else{e.fallbackLayer=new TC.layer.Raster($.extend({},t,{id:TC.getUID(),isBase:!0,stealth:!0,title:layer.title,map:e.map}));e.fallbackLayer.firstOption=e}return e.fallbackLayer}return null}}();var esriParser={parse:function(e){var t=[],o=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===o.documentElement.tagName)for(var r=o.documentElement.getElementsByTagName("FeatureInfoCollection"),n=0,i=r.length;n<i;n++)for(var a=r[n],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var h=l[c].getElementsByTagName("Field"),d={},p=0,f=h.length;p<f;p++){var g=h[p];d[getElementText(g.getElementsByTagName("FieldName")[0])]=getElementText(g.getElementsByTagName("FieldValue")[0])}var m=new ol.Feature(d);m.setId(s+"."+TC.getUID());t[t.length]=m}return t}};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.layer.Vector=function(){TC.Layer.apply(this,arguments);this.type=this.options.type||TC.Consts.layerType.VECTOR;this.features=[];this.selectedFeatures=[];const e=function(e){var t=(e=e||"").indexOf("?");t>=0?e=e.substr(0,t):(t=e.indexOf("#"))>=0&&(e=e.substr(0,t));return e.substr(e.lastIndexOf(".")).toLowerCase()}(this.url),t=function(e){switch(e){case TC.Consts.mimeType.KML:return TC.Consts.format.KML;case TC.Consts.mimeType.GPX:return TC.Consts.format.GPX;case TC.Consts.mimeType.JSON:case TC.Consts.mimeType.GEOJSON:return TC.Consts.format.GEOJSON;case TC.Consts.mimeType.GML:return TC.Consts.format.GML;default:return null}}(this.options.format)||function(e){switch(e){case".kml":return TC.Consts.format.KML;case".gpx":return TC.Consts.format.GPX;case".json":case".geojson":return TC.Consts.format.GEOJSON;case".gml":return TC.Consts.format.GML;case".wkt":return TC.Consts.format.WKT;case".topojson":return TC.Consts.format.TOPOJSON;default:return null}}(e);if(t||this.type===TC.Consts.layerType.KML){t===TC.Consts.format.KML&&(this.type=TC.Consts.layerType.KML);this.title=this.options.title||function(t){for(var o=t=t||"",r=new RegExp("([^/]+"+e+")","i"),n=0;n<3;n++){t=decodeURIComponent(t);var i=r.exec(t);if(i.length>1){o=i[1];break}}return o}(this.url)}this.wrap=new TC.wrap.layer.Vector(this);var o=this.wrap.createVectorLayer();this.wrap.setLayer(o);this.wrap._promise=Promise.resolve(o)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){var e=null;if(!this.options.stealth){(e={}).children=[];for(var t=0;t<this.features.length;t++){var o=this.features[t].getPath();if(o.length){var r=TC.Util.addArrayToTree(o,e);r&&(r.legend=this.features[t].getLegend())}}e.name=this.name||e.name;e.customLegend=this.options.customLegend;e.title=this.title||e.title;e.uid=this.id}return e};var t=function(e,t,o,r){return new Promise(function(n,i){t.call(e,[o],r).then(function(t){n(t[0]);e.map&&e.map.trigger(TC.Consts.event.FEATUREADD,{layer:e,feature:t[0]})})})},o=function(e,t,o,r,n){var i=e.options.styles&&e.options.styles[r]||TC.Cfg.styles[r],a=$.extend(!0,{},i,n);return new Promise(function(r,n){var i;const s=function(){i=i||TC.feature[o];for(var n=new Array(t.length),s=[],l=0,c=t.length;l<c;l++){var u,h=t[l];const r=TC.wrap.Feature.prototype.isNative(h);if(h instanceof i||"TC.feature."+o===h.CLASSNAME)u=h;else{a.layer=e;r&&(u=h._wrap&&h._wrap.parent);u||(u=new i(h,a))}u.layer=e;n[l]=u;e.features[e.features.length]=u;r||(s[s.length]=u.wrap.feature);u.options.showPopup&&u.showPopup()}s.length&&e.wrap.addFeatures(s);r(n)};if(o)TC.loadJS(!TC.feature||TC.feature&&!TC.feature[o],[TC.apiLocation+"TC/feature/"+o],s);else{i=TC.Feature;s()}})};e.addPoint=function(e,o){return t(this,this.addPoints,e,o)};e.addPoints=function(e,t){return o(this,e,"Point",TC.Consts.geom.POINT,t)};e.addMarker=function(e,o){return t(this,this.addMarkers,e,o)};e.addMarkers=function(e,t){return o(this,e,"Marker","marker",t)};e.addPolyline=function(e,o){return t(this,this.addPolylines,e,o)};e.addPolylines=function(e,t){return o(this,e,"Polyline",TC.Consts.geom.POLYLINE,t)};e.addMultiPolyline=function(e,o){return t(this,this.addMultiPolylines,e,o)};e.addMultiPolylines=function(e,t){return o(this,e,"MultiPolyline",TC.Consts.geom.POLYLINE,t)};e.addPolygon=function(e,o){return t(this,this.addPolygons,e,o)};e.addPolygons=function(e,t){return o(this,e,"Polygon",TC.Consts.geom.POLYGON,t)};e.addMultiPolygon=function(e,o){return t(this,this.addMultiPolygons,e,o)};e.addMultiPolygons=function(e,t){return o(this,e,"MultiPolygon",TC.Consts.geom.POLYGON,t)};e.addCircle=function(e,o){return t(this,this.addCircles,e,o)};e.addCircles=function(e,t){return o(this,e,"Circle",TC.Consts.geom.POLYGON,t)};e.addFeature=function(e){const t=this;var r;TC.feature&&(r=TC.feature.Point&&e instanceof TC.feature.Point||"TC.feature.Point"===e.CLASSNAME?t.addPoint(e):TC.feature.Polyline&&e instanceof TC.feature.Polyline||"TC.feature.Polyline"===e.CLASSNAME?t.addPolyline(e):TC.feature.Polygon&&e instanceof TC.feature.Polygon||"TC.feature.Polygon"===e.CLASSNAME?t.addPolygon(e):TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||"TC.feature.MultiPolygon"===e.CLASSNAME?t.addMultiPolygon(e):TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline||"TC.feature.MultiPolyline"===e.CLASSNAME?t.addMultiPolyline(e):TC.feature.Circle&&e instanceof TC.feature.Circle||"TC.feature.Circle"===e.CLASSNAME?t.addCircle(e):o(t,[e]));return r};e.removeFeature=function(e){const t=this;if(e.layer&&t.features.indexOf(e)>=0){if(t.map){t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e&&t.hide()});t.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.isVisible()&&t.currentFeature===e&&t.close()})}t.wrap.removeFeature(e);e.layer=null}};e.getFeatureById=function(e){var t=null,o=this.wrap.getFeatureById(e);o&&(t=o._wrap.parent);return t};e.clearFeatures=function(){var e=this;if(e.features&&e.wrap){if(e.map){e.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&e.features.indexOf(t.currentFeature)>=0&&t.hide()})}e.features.length=0;e.wrap.clearFeatures()}};e.describeFeatureType=function(e,t){const o=this;new Promise(function(e,t){TC.ajax({url:o.wrap.getDescribeFeatureTypeUrl(),method:"GET",responseType:TC.Consts.mimeType.XML}).then(function(o){var r="http://www.w3.org/2001/XMLSchema",n=o.getElementsByTagNameNS(r,"complexType")[0];if(n){for(var i=n.getElementsByTagNameNS(r,"element"),a=new Array(i.length),s=0,l=i.length;s<l;s++){var c=i[s];a[s]={name:c.getAttribute("name"),type:c.getAttribute("type"),nillable:"true"===c.getAttribute("nillable"),minOccurs:parseInt(c.getAttribute("minOccurs")),maxOccurs:parseInt(c.getAttribute("maxOccurs"))}}e(a)}else{var u=o.getElementsByTagName("Exception")[0];u&&t(u.getElementsByTagName("ExceptionText")[0].innerHTML)}}).catch(function(e,o,r){t(Error(r))})}).then(function(t){$.isFunction(e)&&e(t)},function(e){$.isFunction(t)&&t(e)})};e.import=function(e){this.wrap.import(e)};e.setNodeVisibility=function(e,t){this.state=TC.Layer.state.LOADING;this.map.trigger(TC.Consts.event.BEFOREUPDATE);this.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:this});this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)this.setVisibility(t);else{this._cache.visibilityStates[e]=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var o,r,n=!1;for(o=0;o<this.features.length;o++)if((r=this.features[o]).id==e){n=!0;r.setVisibility(t);break}if(!n)for(o=0;o<this.features.length;o++){void 0===(r=this.features[o])._path&&(r._path="/"+r.getPath().join("/"));r._path===e&&r.setVisibility(t)}}this.state=TC.Layer.state.IDLE;this.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:this});this.map.trigger(TC.Consts.event.UPDATE)};e.getNodeVisibility=function(e){var t=TC.Layer.prototype.getNodeVisibility.call(this,e);this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)t=this.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var o=this._cache.visibilityStates[e];void 0!==o&&(t=o)}return t};e.setModifiable=function(e){this.wrap.setModifiable(e)};e.applyEdits=function(e,t,o){return this.wrap.sendTransaction(e,t,o)};e.refresh=function(){return this.wrap.reloadSource()};e.getFeaturesInCurrentExtent=function(e){var t=this.map.getExtent();return this.getFeaturesInExtent(t,e)};e.getFeaturesInExtent=function(e,t){return this.wrap.getFeaturesInExtent(e,t)};e.setProjection=function(e){const t=this;t.wrap.setProjection(e);if(e.crs&&e.oldCrs){t.map.trigger(TC.Consts.event.BEFORELAYERUPDATE,{layer:t});t.features.forEach(function(t){t.wrap.setGeometry(TC.Util.reproject(t.geometry,e.oldCrs,e.crs));t.geometry=t.wrap.getGeometry()});t.map.trigger(TC.Consts.event.LAYERUPDATE,{layer:t})}};e.exportState=function(e){const t=this;e=e||{};const o={id:t.id};t.map&&t.map.crs!==t.map.options.crs&&(o.crs=t.map.crs);var r=Math.pow(10,(t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)+1);const n=e.features||t.features;o.features=n.map(function(o){const n={};var i;switch(!0){case TC.feature.Marker&&o instanceof TC.feature.Marker:n.type=TC.Consts.geom.POINT;i=t.options.styles&&t.options.styles.marker;break;case TC.feature.Point&&o instanceof TC.feature.Point:n.type=TC.Consts.geom.POINT;i=t.options.styles&&t.options.styles.point;break;case TC.feature.Polyline&&o instanceof TC.feature.Polyline:n.type=TC.Consts.geom.POLYLINE;i=t.options.styles&&t.options.styles.line;break;case TC.feature.MultiPolyline&&o instanceof TC.feature.MultiPolyline:n.type=TC.Consts.geom.MULTIPOLYLINE;i=t.options.styles&&t.options.styles.line;break;case TC.feature.Polygon&&o instanceof TC.feature.Polygon:n.type=TC.Consts.geom.POLYGON;i=t.options.styles&&t.options.styles.polygon;break;case TC.feature.MultiPolygon&&o instanceof TC.feature.MultiPolygon:n.type=TC.Consts.geom.MULTIPOLYGON;i=t.options.styles&&t.options.styles.polygon;break;case TC.feature.Circle&&o instanceof TC.feature.Circle:n.type=TC.Consts.geom.CIRCLE;i=t.options.styles&&t.options.styles.polygon}n.id=o.id;n.geom=TC.Util.compactGeometry(o.geometry,r);n.data=o.getData();n.showsPopup=o.showsPopup;if(void 0===e.exportStyles||e.exportStyles){i=$.extend({},i);for(var a in i){var s=i[a];$.isFunction(s)&&(i[a]=s(o))}n.style=$.extend(i,o.getStyle())}return n});return o};e.importState=function(e){const t=this;return new Promise(function(o,r){const n=new Array(e.features.length);e.features.forEach(function(o,r){const i=$.extend(o.style,{data:o.data,id:o.id,showsPopup:o.showsPopup});var a;switch(o.type){case TC.Consts.geom.POLYGON:a=t.addPolygon;break;case TC.Consts.geom.MULTIPOLYGON:a=t.addMultiPolygon;break;case TC.Consts.geom.POLYLINE:a=t.addPolyline;break;case TC.Consts.geom.MULTIPOLYLINE:a=t.addMultiPolyline;break;case TC.Consts.geom.CIRCLE:a=t.addCircle;break;case TC.Consts.geom.POINT:a=o.style&&(o.style.url||o.style.className)?t.addMarker:t.addPoint}if(a){var s=TC.Util.explodeGeometry(o.geom);e.crs&&t.map.crs!==e.crs?n[r]=new Promise(function(e,o){t.map.one(TC.Consts.event.PROJECTIONCHANGE,function(r){a.call(t,s,i).then(function(){e()},function(){o()})})}):n[r]=a.call(t,s,i)}});Promise.all(n).then(function(){o()},function(e){r(e instanceof Error?e:Error(e))})})}}();function xml2json(e){var t={toObj:function(e){var o={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)"name"!==e.attributes[r].nodeName&&(o[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString());if(e.firstChild){for(var n=0,i=0,a=!1,s=e.firstChild;s;s=s.nextSibling)1==s.nodeType?a=!0:3==s.nodeType&&s.nodeValue.match(/[^ \f\n\r\t\v]/)?n++:4==s.nodeType&&i++;if(a)if(2>n&&2>i){t.removeWhite(e);for(s=e.firstChild;s;s=s.nextSibling){var l=t.removePrefix(s.nodeName);if(3==s.nodeType)o["#text"]=t.escape(s.nodeValue);else if(4==s.nodeType)o["#cdata"]=t.escape(s.nodeValue);else if(o[l])o[l]instanceof Array?o[l][o[l].length]=t.toObj(s):o[l]=[o[l],t.toObj(s)];else{var c=null;s.attributes.getNamedItem("name")&&(c=s.attributes.getNamedItem("name").nodeValue),o[c||l]=t.toObj(s)}}}else e.attributes.length?o["#text"]=t.escape(t.innerXml(e)):o=t.escape(t.innerXml(e));else if(n)e.attributes.length?o["#text"]=t.escape(t.innerXml(e)):o=t.escape(t.innerXml(e));else if(i)if(i>1)o=t.escape(t.innerXml(e));else for(s=e.firstChild;s;s=s.nextSibling)o["#cdata"]=t.escape(s.nodeValue)}e.attributes.length||e.firstChild||(o=null)}else 9==e.nodeType?o=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return o},toJson:function(e,o,r){var n=o?'"'+o+'"':"";if(e instanceof Array){for(var i=0,a=e.length;a>i;i++)e[i]=t.toJson(e[i],"",r+"\t");n+=(o?":[":"[")+(e.length>1?"\n"+r+"\t"+e.join(",\n"+r+"\t")+"\n"+r:e.join(""))+"]"}else if(null==e)n+=(o&&":")+"null";else if("object"==typeof e){var s=[];for(var l in e)s[s.length]=t.toJson(e[l],l,r+"\t");n+=(o?":{":"{")+(s.length>1?"\n"+r+"\t"+s.join(",\n"+r+"\t")+"\n"+r:s.join(""))+"}"}else n+="string"==typeof e?(o&&":")+'"'+e.toString()+'"':(o&&":")+e.toString();return n},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var o=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var n=e.firstChild;n;n=n.nextSibling)t+=o(n);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},r=e.firstChild;r;r=r.nextSibling)t+=o(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var o=e.firstChild;o;)if(3==o.nodeType)if(o.nodeValue.match(/[^ \f\n\r\t\v]/))o=o.nextSibling;else{var r=o.nextSibling;e.removeChild(o),o=r}else 1==o.nodeType?(t.removeWhite(o),o=o.nextSibling):o=o.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}var WFSCapabilities=function(){var e="1.0.0",t="1.1.0",o="2.0.0",r=function(r,n){switch(n){case e:var i=r.Capability.Request;if(i.GetFeature){var a=[];for(var s in i.GetFeature.ResultFormat)a.push(s.toLowerCase());i.GetFeature.outputFormat=a,delete i.GetFeature.ResultFormat,i.GetFeature.Operations=r.FeatureTypeList.Operations}return i;case t:return{};case o:var l={};for(var s in r.OperationsMetadata){var c={};c[s]=r.OperationsMetadata[s];for(var u in c[s])c[s][u]&&c[s][u].hasOwnProperty("AllowedValues")&&(c[s][u]=c[s][u].AllowedValues.Value);$.extend(l,c)}return l}return null},n=function(r,n){switch(n){case e:for(var i={},a=0;a<r.FeatureTypeList.FeatureType.length;a++){i[(s=r.FeatureTypeList.FeatureType[a].Name).substring(s.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[a]}return i;case t:return{};case o:for(i={},a=0;a<r.FeatureTypeList.FeatureType.length;a++){var s;i[(s=r.FeatureTypeList.FeatureType[a].Name).substring(s.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[a]}return i}return null},i=function(r,n){switch(n){case e:return r.Filter_Capabilities;case t:return{};case o:return r.Filter_Capabilities}return null},a=function(r,n){switch(n){case e:var i={};for(var a in r)"string"==typeof r[a]&&(i[a]=r[a]);return i;case t:return{};case o:i={};for(var a in r)"string"==typeof r[a]&&(i[a]=r[a]);return i}return{}};return{Promises:function(e){var t=(e=e).substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[t])return Promise.resolve(TC.capabilities[t]);var o={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return new Promise(function(r,n){TC.ajax({url:TC.proxify(e)+"?"+$.param(o),method:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),o=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[o]=e,TC.capabilities[t]=e,r(WFSCapabilities.Parse(arguments[0]))})})},Parse:function(){var s,l,c,u,h=xml2json(arguments[0]);switch(h.version){case e:s=e;break;case t:s=t;break;case o:s=o}l=r(h,s),c=n(h,s),u=i(h,s);var d=a(h,s),p={Operations:l,FeatureTypes:c,Filters:u};return $.extend(p,d),p}}}(),TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Geometry=t()}(TC,function(){const e={isPoint:function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(t){return $.isArray(t)&&(0===t.length||e.isPoint(t[0]))},isRingCollection:function(t){return $.isArray(t)&&(0===t.length||e.isRing(t[0]))},isMultiRingCollection:function(t){return $.isArray(t)&&(0===t.length||e.isRingCollection(t[0]))},getNearest:function(e,t){return TC.wrap.Geometry.getNearest(e,t)},isInside:function t(o,r){var n=!1;if(e.isPoint(o))if(e.isPoint(r))n=o[0]===r[0]&&o[1]===r[1];else if(e.isRing(r))for(var i=0,a=r.length-1;i<r.length;a=i++){var s=r[i][0],l=r[i][1],c=r[a][0],u=r[a][1];l>o[1]!=u>o[1]&&o[0]<(c-s)*(o[1]-l)/(u-l)+s&&(n=!n)}else if(e.isRingCollection(r)&&r.length>0){if(t(o,r[0])){var h=!1;for(i=1;i<r.length;i++)if(t(o,r[i])){h=!0;break}h||(n=!0)}}else if(e.isMultiRingCollection(r)&&r.length>0){i=0;for(var d=r.length;i<d;i++)if(t(o,r[i])){n=!0;break}}return n}};return e});var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var o=e.getAttribute("src");TC.apiLocation=o.substr(0,o.lastIndexOf("/")+1);var r=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),n=new XMLHttpRequest;n.open("GET",r,!1);n.send(null);var i=document.getElementsByTagName("head")[0];(e=document.createElement("script")).type="text/javascript";e.text=n.responseText;i.appendChild(e)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(e,t){var o=this;TC.Cfg.controls.search.allowedSearchTypes=$.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(t&&t.controls&&t.controls.search){var r=Object.keys(t.controls.search),n=$.extend(t.controls.search,{allowedSearchTypes:{}});r.forEach(function(e){if("boolean"==typeof t.controls.search[e]||$.isPlainObject(t.controls.search[e])){if(t.controls.search[e])switch(!0){case"postalAddress"===e:n.allowedSearchTypes[TC.Consts.searchType.NUMBER]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"cadastralParcel"===e:n.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"town"===e:n.allowedSearchTypes[TC.Consts.searchType.URBAN]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;default:n.allowedSearchTypes[e]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{}}delete n[e]}});t.controls.search=n}var i,a,s=new TC.Map(e,t);o.addLayer=function(e,t){s.addLayer(e,t)};o.setBaseLayer=function(e,t){s.setBaseLayer(e,t)};o.addMarker=function(e,t){s.addMarker(e,t)};o.zoomToMarkers=function(e){s.zoomToMarkers(e)};o.loaded=function(e){s.loaded(e)};s.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(i=new TC.control.Search).register(s);i.getLayer().then(function(e){a=e})});if(!s.activeControl){var e=s.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});o.getQueryableData=function(e,t){var o=i.availableSearchTypes[e];if(o.queryableData)t&&t(o.queryableData);else{var r={request:"GetFeature",service:"WFS",typename:o.featurePrefix+":"+o.featureType,version:o.version,propertyname:(o.dataIdProperty instanceof Array?o.dataIdProperty:[o.dataIdProperty]).concat(o.outputProperties instanceof Array?o.outputProperties:[o.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},n=o.url+"?"+$.param(r);TC.ajax({url:n,responseType:TC.Consts.mimeType.JSON}).then(function(e){o.queryableData=[];if(e.features)for(var r=e.features,n=0;n<r.length;n++){var a=r[n];e={id:[]};o.dataIdProperty instanceof Array||(o.dataIdProperty=[o.dataIdProperty]);for(var s=0;s<o.dataIdProperty.length;s++)a.properties.hasOwnProperty(o.dataIdProperty[s])&&e.id.push(a.properties[o.dataIdProperty[s]]);e.id=o.idPropertiesIdentifier?e.id.join(o.idPropertiesIdentifier):e.id.join("");e.label=[];o.outputProperties instanceof Array||(o.outputProperties=[o.outputProperties]);for(var l=0;l<o.outputProperties.length;l++)a.properties.hasOwnProperty(o.outputProperties[l])&&e.label.push(a.properties[o.outputProperties[l]]);var c=e.label instanceof Array&&e.label.join("").trim().length>0||!(e.label instanceof Array)&&e.label.trim().length>0;e.label=o.outputFormatLabel?o.outputFormatLabel.tcFormat(e.label):e.label.join("-");c&&o.queryableData.push(e)}o.queryableData=o.queryableData.sort(function(e,t){return o.idPropertiesIdentifier&&-1==e.id.indexOf(o.idPropertiesIdentifier)?i.removePunctuation(e.label)<i.removePunctuation(t.label)?-1:i.removePunctuation(e.label)>i.removePunctuation(t.label)?1:0:i.removePunctuation(e.label.split(" ")[0])<i.removePunctuation(t.label.split(" ")[0])?-1:i.removePunctuation(e.label.split(" ")[0])>i.removePunctuation(t.label.split(" ")[0])?1:0});o.queryableData=o.queryableData.filter(function(e,t,o){return t<1||e.id!==o[t-1].id&&e.label!==o[t-1].label});t&&t(o.queryableData)})}};o.getMunicipalities=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};o.getUrbanAreas=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};o.getCommonwealths=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};o.getCouncils=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};o.searchCommonwealth=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};o.searchCouncil=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};o.searchUrbanArea=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};o.searchMunicipality=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};o.searchTyped=function(e,t,r){var n=TC.getUID(),l=i.availableSearchTypes[e];t instanceof Array&&l.goToIdFormat&&(t=l.goToIdFormat.tcFormat(t));i._search.data=i._search.data||[];i._search.data.push({dataLayer:l.featureType,dataRole:e,id:t,label:"",text:""});o.removeSearch();if(i.availableSearchTypes[e]&&!i.getSearchTypeByRole(e)){i.availableSearchTypes[e].goTo||(i.availableSearchTypes[e].goTo=function(e){var t=function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var t=[];l.idPropertiesIdentifier&&(e=e.split(l.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var o=0;o<l.dataIdProperty.length;o++)t.push(new TC.filter.equalTo(l.dataIdProperty[o],$.trim(e[o])));return t=t.length>1?new TC.filter.and(t):t[0]}(e);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:t,outputFormat:this.outputFormat,styles:this.styles}}}.bind(l));i.addAllowedSearchType(e,i.availableSearchTypes[e],i)}s.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){s.toast(i.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});r&&r(null)});s.one(TC.Consts.event.FEATURESADD,function(t){t.layer==a&&t.layer.features&&t.layer.features.length>0&&s.zoomToFeatures(t.layer.features);o.search={layer:t.layer,type:e};r&&r(t.layer.id!==n?t.layer.id:n)});i.goToResult(t,e)};o.searchFeature=function(e,t,r,n){var a=TC.getUID(),l=i.featurePrefix;o.removeSearch();e=(e||"").trim();t=(t||"").trim();r=(r||"").trim();if(0==e.length||0==t.length||0==r.length){s.toast(i.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});n&&n(null)}else{if(e.indexOf(":")>-1){l=e.split(":")[0];e=e.split(":")[1]}var c,u={id:a,type:SITNA.Consts.layerType.WFS,url:i.url,version:i.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:e,maxFeatures:1,properties:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}([{name:t,value:r,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};s.addLayer(u).then(function(e){c=e;o.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});s.on(TC.Consts.event.FEATURESADD,function(e){const t=e.layer;if(t==c&&t.features&&t.features.length>0){for(var o=0;o<t.features.length;o++)t.features[o].showsPopup!=i.queryableFeatures&&(t.features[o].showsPopup=i.queryableFeatures);s.zoomToFeatures(t.features)}});s.on(TC.Consts.event.LAYERUPDATE,function(e){const t=e.layer,o=e.newData;t==c&&o&&o.features&&0==o.features.length&&s.toast(i.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});n&&n(t==c&&o&&o.features&&0==o.features.length?null:a)})}};o.removeSearch=function(e){if(o.search)if(i.availableSearchTypes[o.search.type]&&i.availableSearchTypes[o.search.type].hasOwnProperty("goTo")){for(var t=0;t<o.search.layer.features.length;t++)o.search.layer.removeFeature(o.search.layer.features[t]);o.search=null}else s.removeLayer(o.search.layer).then(function(){o.search=null});e&&e()};o.exportImage=function(){return s.exportImage()};o.search=null};
//# sourceMappingURL=maps/sitna.ol.min.js.map
