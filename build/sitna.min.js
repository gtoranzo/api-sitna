var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var a=e.getAttribute("src");TC.apiLocation=a.substr(0,a.lastIndexOf("/")+1);var r=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),o=new XMLHttpRequest;o.open("GET",r,!1);o.send(null);var n=document.getElementsByTagName("head")[0];(e=document.createElement("script")).type="text/javascript";e.text=o.responseText;n.appendChild(e)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(e,t){var a=this;TC.Cfg.controls.search.allowedSearchTypes=TC.Util.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(t&&t.controls&&t.controls.search){var r=Object.keys(t.controls.search),o=TC.Util.extend(t.controls.search,{allowedSearchTypes:{}});r.forEach(function(e){if("boolean"==typeof t.controls.search[e]||TC.Util.isPlainObject(t.controls.search[e])){if(t.controls.search[e])switch(!0){case"postalAddress"===e:o.allowedSearchTypes[TC.Consts.searchType.NUMBER]=TC.Util.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"cadastralParcel"===e:o.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=TC.Util.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"town"===e:o.allowedSearchTypes[TC.Consts.searchType.URBAN]=TC.Util.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;default:o.allowedSearchTypes[e]=TC.Util.isPlainObject(t.controls.search[e])?t.controls.search[e]:{}}delete o[e]}});t.controls.search=o}var n,s,i=new TC.Map(e,t);a.addLayer=function(e,t){i.addLayer(e,t)};a.setBaseLayer=function(e,t){i.setBaseLayer(e,t)};a.addMarker=function(e,t){i.addMarker(e,t)};a.zoomToMarkers=function(e){i.zoomToMarkers(e)};a.loaded=function(e){i.loaded(e)};i.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(n=new TC.control.Search).register(i);n.getLayer().then(function(e){s=e})});if(!i.activeControl){var e=i.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});a.getQueryableData=function(e,t){var a=n.availableSearchTypes[e];if(a.queryableData)t&&t(a.queryableData);else{var r={request:"GetFeature",service:"WFS",typename:a.featurePrefix+":"+a.featureType,version:a.version,propertyname:(a.dataIdProperty instanceof Array?a.dataIdProperty:[a.dataIdProperty]).concat(a.outputProperties instanceof Array?a.outputProperties:[a.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},o=a.url+"?"+TC.Util.getParamString(r);TC.ajax({url:o,responseType:TC.Consts.mimeType.JSON}).then(function(e){const r=e.data;a.queryableData=[];if(r.features)for(var o=r.features,s=0;s<o.length;s++){var i=o[s],l={id:[]};a.dataIdProperty instanceof Array||(a.dataIdProperty=[a.dataIdProperty]);for(var c=0;c<a.dataIdProperty.length;c++)i.properties.hasOwnProperty(a.dataIdProperty[c])&&l.id.push(i.properties[a.dataIdProperty[c]]);l.id=a.idPropertiesIdentifier?l.id.join(a.idPropertiesIdentifier):l.id.join("");l.label=[];a.outputProperties instanceof Array||(a.outputProperties=[a.outputProperties]);for(var u=0;u<a.outputProperties.length;u++)i.properties.hasOwnProperty(a.outputProperties[u])&&l.label.push(i.properties[a.outputProperties[u]]);var p=l.label instanceof Array&&l.label.join("").trim().length>0||!(l.label instanceof Array)&&l.label.trim().length>0;l.label=a.outputFormatLabel?a.outputFormatLabel.tcFormat(l.label):l.label.join("-");p&&a.queryableData.push(l)}a.queryableData=a.queryableData.sort(function(e,t){return a.idPropertiesIdentifier&&-1==e.id.indexOf(a.idPropertiesIdentifier)?n.removePunctuation(e.label)<n.removePunctuation(t.label)?-1:n.removePunctuation(e.label)>n.removePunctuation(t.label)?1:0:n.removePunctuation(e.label.split(" ")[0])<n.removePunctuation(t.label.split(" ")[0])?-1:n.removePunctuation(e.label.split(" ")[0])>n.removePunctuation(t.label.split(" ")[0])?1:0});a.queryableData=a.queryableData.filter(function(e,t,a){return t<1||e.id!==a[t-1].id&&e.label!==a[t-1].label});t&&t(a.queryableData)})}};a.getMunicipalities=function(e){a.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};a.getUrbanAreas=function(e){a.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};a.getCommonwealths=function(e){a.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};a.getCouncils=function(e){a.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};a.searchCommonwealth=function(e,t){a.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};a.searchCouncil=function(e,t){a.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};a.searchUrbanArea=function(e,t){a.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};a.searchMunicipality=function(e,t){a.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};a.searchTyped=function(e,t,r){var o=TC.getUID(),l=n.availableSearchTypes[e];t instanceof Array&&l.goToIdFormat&&(t=l.goToIdFormat.tcFormat(t));n._search.data=n._search.data||[];n._search.data.push({dataLayer:l.featureType,dataRole:e,id:t,label:"",text:""});a.removeSearch();if(n.availableSearchTypes[e]&&!n.getSearchTypeByRole(e)){n.availableSearchTypes[e].goTo||(n.availableSearchTypes[e].goTo=function(e){var t=function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var t=[];l.idPropertiesIdentifier&&(e=e.split(l.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var a=0;a<l.dataIdProperty.length;a++)t.push(new TC.filter.equalTo(l.dataIdProperty[a],e[a].trim()));return t=t.length>1?new TC.filter.and(t):t[0]}(e);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:t,outputFormat:this.outputFormat,styles:this.styles}}}.bind(l));n.addAllowedSearchType(e,n.availableSearchTypes[e],n)}i.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){i.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});r&&r(null)});i.one(TC.Consts.event.FEATURESADD,function(t){t.layer==s&&t.layer.features&&t.layer.features.length>0&&i.zoomToFeatures(t.layer.features);a.search={layer:t.layer,type:e};r&&r(t.layer.id!==o?t.layer.id:o)});n.goToResult(t,e)};a.searchFeature=function(e,t,r,o){var s=TC.getUID(),l=n.featurePrefix;a.removeSearch();e=(e||"").trim();t=(t||"").trim();r=(r||"").trim();if(0==e.length||0==t.length||0==r.length){i.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});o&&o(null)}else{if(e.indexOf(":")>-1){l=e.split(":")[0];e=e.split(":")[1]}var c,u={id:s,type:SITNA.Consts.layerType.WFS,url:n.url,version:n.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:e,maxFeatures:1,properties:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}([{name:t,value:r,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};i.addLayer(u).then(function(e){c=e;a.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});i.on(TC.Consts.event.FEATURESADD,function(e){const t=e.layer;if(t==c&&t.features&&t.features.length>0){for(var a=0;a<t.features.length;a++)t.features[a].showsPopup!=n.queryableFeatures&&(t.features[a].showsPopup=n.queryableFeatures);i.zoomToFeatures(t.features)}});i.on(TC.Consts.event.LAYERUPDATE,function(e){const t=e.layer,a=e.newData;t==c&&a&&a.features&&0==a.features.length&&i.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});o&&o(t==c&&a&&a.features&&0==a.features.length?null:s)})}};a.removeSearch=function(e){if(a.search)if(n.availableSearchTypes[a.search.type]&&n.availableSearchTypes[a.search.type].hasOwnProperty("goTo")){for(var t=0;t<a.search.layer.features.length;t++)a.search.layer.removeFeature(a.search.layer.features[t]);a.search=null}else i.removeLayer(a.search.layer).then(function(){a.search=null});e&&e()};a.exportImage=function(){return i.exportImage()};a.search=null};
//# sourceMappingURL=maps/sitna.min.js.map